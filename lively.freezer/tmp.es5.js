function _toArray2(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableRest();}function _get2(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get2=Reflect.get;}else{_get2=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver);}return desc.value;};}return _get2(target,property,receiver||target);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof2(call)==="object"||typeof call==="function")){return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e6){throw _e6;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]();},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e7){didErr=true;err=_e7;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _toConsumableArray2(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _slicedToArray2(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _typeof2(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof2=function _typeof2(obj){return typeof obj;};}else{_typeof2=function _typeof2(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof2(obj);}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _typeof=typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"?function(obj){return _typeof2(obj);}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj);};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr);}(/*global self,global,System*/ /*

Code in here will not be directly executed but stringified and embedded in bundles!

*/function runtimeDefinition(){var G=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:this;if(_typeof(G.lively)!=="object")G.lively={};function prepareGlobal(moduleName,exports,globals,encapsulate){// disable module detection
var curDefine=G.define;G.define=undefined;// set globals
var oldGlobals;if(globals){oldGlobals={};for(var g in globals){oldGlobals[g]=G[g];G[g]=globals[g];}}// store a complete copy of the global object in order to detect changes
if(!exports){globalSnapshot={};forEachGlobalValue(function(name,value){globalSnapshot[name]=value;});}// return function to retrieve global
return function(){var globalValue=exports?getGlobalValue(exports):{};var singleGlobal;var multipleExports=!!exports;if(!exports||encapsulate)forEachGlobalValue(function(name,value){if(globalSnapshot[name]===value)return;if(typeof value=='undefined')return;// allow global encapsulation where globals are removed
if(encapsulate)G[name]=undefined;if(!exports){globalValue[name]=value;if(typeof singleGlobal!='undefined'){if(!multipleExports&&singleGlobal!==value)multipleExports=true;}else{singleGlobal=value;}}});globalValue=multipleExports?globalValue:singleGlobal;// revert globals
if(oldGlobals){for(var g in oldGlobals){G[g]=oldGlobals[g];}}G.define=curDefine;return globalValue;};}G.prepareGlobal=prepareGlobal;// set as global
var version,registry={},globalModules={},globalSnapshot={};// bare minimum ignores from SystemJS
var ignoredGlobalProps=['_g','sessionStorage','localStorage','clipboardData','frames','frameElement','external','mozAnimationStartTime','webkitStorageInfo','webkitIndexedDB','mozInnerScreenY','mozInnerScreenX'];// taken from SystemJS
function forEachGlobal(callback){if(Object.keys)Object.keys(G).forEach(callback);else for(var g in G){if(!Object.hasOwnProperty.call(G,g))continue;callback(g);}};function forEachGlobalValue(callback){forEachGlobal(function(globalName){var value;if(ignoredGlobalProps.indexOf(globalName)!=-1)return;try{value=G[globalName];}catch(e){ignoredGlobalProps.push(globalName);}callback(globalName,value);});};function readMemberExpression(p,value){var pParts=p.split('.');while(pParts.length){value=value[pParts.shift()];}return value;}function getGlobalValue(exports){if(typeof exports=='string')return readMemberExpression(exports,G);if(!(exports instanceof Array))throw new Error('Global exports must be a string or array.');var globalValue={};var first=true;for(var i=0;i<exports.length;i++){var val=readMemberExpression(exports[i],G);if(first){globalValue['default']=val;first=false;}globalValue[exports[i].split('.').pop()]=val;}return globalValue;}if(G.lively.FreezerRuntime){var _version$split$map=version.split(".").map(Number),_version$split$map2=_slicedToArray(_version$split$map,3),myMajor=_version$split$map2[0],myMinor=_version$split$map2[1],myPatch=_version$split$map2[2],_G$lively$FreezerRunt=G.lively.FreezerRuntime.version.split(".").map(Number),_G$lively$FreezerRunt2=_slicedToArray(_G$lively$FreezerRunt,3),otherMajor=_G$lively$FreezerRunt2[0],otherMinor=_G$lively$FreezerRunt2[1],otherPatch=_G$lively$FreezerRunt2[2],update=false;if(isNaN(otherMajor)||!isNaN(myMajor)&&myMajor>otherMajor)update=true;if(!update&&(isNaN(otherMinor)||!isNaN(myMinor)&&myMinor>otherMinor))update=true;if(!update&&(isNaN(otherPatch)||!isNaN(myPatch)&&myPatch>otherPatch))update=true;if(!update)return;registry=G.lively.FreezerRuntime.registry;}globalModules["@lively-env"]={executed:true,options:{},// this is for lively.serializer2 locateClass()
moduleEnv:function moduleEnv(id){var m=System.get(id,false)||System.fetchStandaloneFor(id)||System.get(id+'index.js',false);return{recorder:m.recorder||m.exports};}};globalModules["@system-env"]={executed:true,browser:true};G.lively.FreezerRuntime={global:G,location:G.document&&G.document.location.href.split('?')[0],version:version,registry:registry,globalModules:globalModules,get:function get(moduleId){var recorder=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(moduleId&&moduleId.startsWith('@'))return this.globalModules[moduleId];var mod=this.registry[moduleId];return recorder?mod&&mod.recorder:mod;},set:function set(moduleId,module){return this.registry[moduleId]=module;},add:function add(id){var dependencies=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var exports=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var executed=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var module={id:id,dependencies:dependencies,executed:executed,exports:exports,execute:function execute(){},setters:[],subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){},"package":function _package(){}};this.set(id,module);return module;},decanonicalize:function decanonicalize(name){if(name.endsWith('.json'))return G.lively.resources.resource(G.origin).join(name).url;if(!name.endsWith('.js')&&!name.endsWith('/'))// just import via package name
return name.split('/').concat(['index.js']).filter(Boolean).join('/');return name;// this decanonicalize forces all modules to contain version numbers (if not provided)
// and to start with the local:// prefix.
// This only applies to modules, that is all .js file that are requested in this context.
// assets such as .css files etc, keep their usual decanonicalization
// is global id?
if(G.lively.FreezerRuntime.globalModules[name])return name;// check if this is a submodule of a global module, that can be 
var localName=name.replace("lively-object-modules/","").replace(G.System.baseURL,'');// includes local prefix?
localName=localName.includes('local://')?localName:'local://'+localName;// includes package version? 
// this fucks up if there are packages wich share a prefix in their naming
if(!localName.match(/\@\S*\//)){(function(){var _localName$replace$sp=localName.replace('local://','').split('/'),_localName$replace$sp2=_toArray(_localName$replace$sp),packageName=_localName$replace$sp2[0],rest=_localName$replace$sp2.slice(1),pkg=Object.keys(G.lively.FreezerRuntime.registry).find(function(k){return k.replace('local://','').split('@')[0]==packageName;}),version=pkg&&pkg.match(/\@[\d|\.|\-|\~]*\//)[0];//if (!pkg) return proceed(name, parent, isPlugin);
// return pkg;
localName="local://"+packageName+version+rest;})();}return localName;},loadObjectFromPartsbinFolder:function loadObjectFromPartsbinFolder(name){var location=this.location;var r=G.lively.resources.resource(location);if(!r.isDirectory())r=r.parent();return r.join("dynamicParts/"+name+".json").readJson().then(function(snapshot){return G.lively.morphic.loadMorphFromSnapshot(snapshot,{onDeserializationStart:false,migrations:[]});});},fetchStandaloneFor:function fetchStandaloneFor(name){for(var glob in this.globalModules){if(name.match(glob.replace("local://","").replace(/\@.*\//,"/").replace("/index.js","")))return this.globalModules[glob];}},resolveSync:function resolveSync(name,parentName){var mod=this.get(name);if(mod)return mod;// try global
if(!name.includes("/")){var parts=name.split("."),_obj=G;while(_obj&&parts.length){_obj=_obj[parts.shift()];}if(_obj)return{executed:true,exports:_obj,dependencies:[]};}var obj=this.get(this.decanonicalize(name,parentName));if(obj)return{executed:true,exports:obj,dependencies:[]};mod=this.fetchStandaloneFor(name);if(mod)return mod;throw new Error("Module "+name+" cannot be found in lively.freezer bundle!");},"import":function _import(id){return Promise.resolve(this.registry[id]?this.registry[id].exports:{});},register:function register(id,dependencies,defineFn){var module=this.add(id,dependencies),body=defineFn(function(name,val){if(typeof name==="string"){module.exports[name]=val;}else{// * export
var prevExports={};for(var key in module.exports){prevExports[key]=module.exports[key];}module.exports=name;for(var _key in prevExports){if(!module.exports[_key])module.exports[_key]=prevExports[_key];}}});module.execute=body.execute;module.setters=body.setters;// how to actually propagate module information inside system?
// window.System._loader.modules[id] = {module: module.exports};
return module;},updateImports:function updateImports(module){if(!module.dependencies)return;for(var i=0;i<module.dependencies.length;i++){var depName=module.dependencies[i],mod=depName!='@empty'&&this.resolveSync(depName,module.id);mod&&module.setters[i](mod.exports);}},updateDependent:function updateDependent(module,dependentModule){for(var i=0;i<dependentModule.dependencies.length;i++){var depName=dependentModule.dependencies[i];if(depName!='@empty'&&module==this.resolveSync(depName,dependentModule.id)){dependentModule.setters[i](module.exports);}}},computeUniqDepGraphs:function computeUniqDepGraphs(depGraph){var dependencies=[],remainingSeen={},uniqDepGraph={"@empty":[]},inverseDepGraph={"@empty":[]};if(!depGraph){var g={},r=lively.FreezerRuntime.registry;for(var modName in r){g[modName]=r[modName].dependencies;}depGraph=g;}for(var key in depGraph){if(!remainingSeen.hasOwnProperty(key)){remainingSeen[key]=true;dependencies.push(key);}var deps=depGraph[key],uniqDeps={};if(deps){uniqDepGraph[key]=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=deps[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var dep=_step.value;if(uniqDeps.hasOwnProperty(dep)||key===dep)continue;var inverse=inverseDepGraph[dep]||(inverseDepGraph[dep]=[]);if(!inverse.includes(key))inverse.push(key);uniqDeps[dep]=true;uniqDepGraph[key].push(dep);if(!remainingSeen.hasOwnProperty(dep)){remainingSeen[dep]=true;dependencies.push(dep);}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]();}}finally{if(_didIteratorError){throw _iteratorError;}}}}}return{uniqDepGraph:uniqDepGraph,inverseDepGraph:inverseDepGraph,dependencies:dependencies};},sortForLoad:function sortForLoad(entry){var debug=false;// establish unique list of keys
var _computeUniqDepGraphs=this.computeUniqDepGraphs(),remaining=_computeUniqDepGraphs.dependencies,uniqDepGraph=_computeUniqDepGraphs.uniqDepGraph,inverseDepGraph=_computeUniqDepGraphs.inverseDepGraph,groups=[],packages={},moduleId;function getPackageName(m){return m.split('/')[0];}function getPackageRefs(m){return(uniqDepGraph[moduleId]||[]).filter(function(m){return!isGlobalModule(m);}).map(function(d){return getPackageName(d);});}function isGlobalModule(m){return m=='@empty'||!!lively.FreezerRuntime.globalModules[m];}// this should just be pre computed once for each package
function reachable(m,id){var seen=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Set();if(m==id)return true;if(uniqDepGraph[m]){return uniqDepGraph[m].includes(id)||uniqDepGraph[m].some(function(m){return!seen.has(m)&&reachable(m,id,new Set([].concat(_toConsumableArray(seen),_toConsumableArray(uniqDepGraph[m]))));});}return false;}for(var _i=remaining.length;_i--;){moduleId=remaining[_i];if(isGlobalModule(moduleId)){// 0.) exclude all global modules
groups.push(moduleId);}else{// 1.) identify packages
var _packageId=getPackageName(moduleId);// only add module to package, if reachable from index.js
if(!reachable(_packageId+'/index.js',moduleId))continue;if(packages[_packageId]){var _packages$_packageId$;packages[_packageId].modules.push(moduleId);(_packages$_packageId$=packages[_packageId].deps).push.apply(_packages$_packageId$,_toConsumableArray(getPackageRefs(moduleId)));}else{packages[_packageId]={modules:[moduleId],deps:getPackageRefs(moduleId)};}}remaining.splice(_i,1);}var detachedModules=remaining;// these are modules part of a package, yet not reachable via index;
// free floating modules are worth excluding at this stage, since they can confuse the static load order for packages
debug&&console.log('unreachable from package index: ',detachedModules);// 2.) try to order package partitions such that their dependencies are satisfied
for(var p in packages){packages[p].deps=new Set(packages[p].deps.filter(function(d){return d!=p;}));}debug&&console.log('Identified packages: ',packages);function haveBeenDeclared(deps){for(var _len=arguments.length,declared=Array(_len>1?_len-1:0),_key2=1;_key2<_len;_key2++){declared[_key2-1]=arguments[_key2];}return deps.filter(function(dep){return dep!='@empty'&&!dep.includes('/index.js');}).every(function(d){return declared.some(function(dcls){return dcls.includes(d);});});}remaining=Object.keys(packages);var orderedPackages=[];while(remaining.length){var minDepCount=Infinity,minKeys=[],minKeyIndexes=[],affectedKeys=[];for(var i=0;i<remaining.length;i++){var key=remaining[i];var deps=[].concat(_toConsumableArray(packages[key].deps));if(deps.length>minDepCount)continue;if(deps.length===minDepCount&&haveBeenDeclared(deps,orderedPackages,minKeys)){minKeys.push(key);minKeyIndexes.push(i);continue;}minDepCount=deps.length;if(!haveBeenDeclared(deps,orderedPackages,minKeys))continue;minKeys=[key];minKeyIndexes=[i];}if(minKeys.length==0)break;// this means that the remaining modules contain a cycle somewhere
for(var i=minKeyIndexes.length;i--;){var key=remaining[minKeyIndexes[i]];remaining.splice(minKeyIndexes[i],1);}orderedPackages.push.apply(orderedPackages,_toConsumableArray(minKeys));}debug&&console.log('could not sort: ',remaining);var unsortablePackages=remaining;// the remaining packages will be sorted by breaking up package bounds together with the non reachable packages
//orderedPackages.push(...remaining);
debug&&console.log('Sorting Packages in order: ',orderedPackages);// 3.) sort packages in isolation
// for each iteration find the keys with the minimum number of dependencies
// and add them to the result group list
var packageModules;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=orderedPackages[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var packageId=_step2.value;packageModules=packages[packageId].modules;while(packageModules.length){var minDepCount=Infinity,minKeys=[],minKeyIndexes=[],affectedKeys=[];for(var i=0;i<packageModules.length;i++){var key=packageModules[i];var _deps2=uniqDepGraph[key]||[];if(_deps2.length>minDepCount)continue;if(_deps2.length===minDepCount&&haveBeenDeclared(_deps2,groups,minKeys)){var _affectedKeys2;minKeys.push(key);minKeyIndexes.push(i);(_affectedKeys2=affectedKeys).push.apply(_affectedKeys2,_toConsumableArray(inverseDepGraph[key]||[]));continue;}minDepCount=_deps2.length;if(!haveBeenDeclared(_deps2,groups,minKeys))continue;minKeys=[key];minKeyIndexes=[i];affectedKeys=(inverseDepGraph[key]||[]).slice();}if(minKeys.length==0)break;// this means that the remaining modules contain a cycle somewhere
for(var i=minKeyIndexes.length;i--;){var key=packageModules[minKeyIndexes[i]];inverseDepGraph[key]=[];packageModules.splice(minKeyIndexes[i],1);}var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=affectedKeys[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var key=_step5.value;uniqDepGraph[key]=uniqDepGraph[key].filter(function(ea){return!minKeys.includes(ea);});}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]){_iterator5["return"]();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}groups.push.apply(groups,_toConsumableArray(minKeys));}debug&&console.log(packageId+' could not order modules ',packageModules);groups.push.apply(groups,_toConsumableArray(packageModules));// insert them anyway and let async load hanlde those things later in the game
}// return groups;
// 4.) attempt to sort the unsortable packages together with the free standing modules
// var groups = [];
// 
// function haveBeenDeclared(deps, ...declared) {
//   return deps.every(d => declared.some(dcls => dcls.includes(d)))
// }
// 
}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}remaining=detachedModules;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=unsortablePackages[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _remaining;var packageId=_step3.value;(_remaining=remaining).push.apply(_remaining,_toConsumableArray(packages[packageId].modules));}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}debug&&console.log('sorting remaining: ',remaining);while(remaining.length){var minDepCount=Infinity,minKeys=[],minKeyIndexes=[],affectedKeys=[];for(var i=0;i<remaining.length;i++){var key=remaining[i];var _deps=uniqDepGraph[key]||[];if(_deps.length>minDepCount)continue;if(_deps.length===minDepCount&&haveBeenDeclared(_deps,groups,minKeys)){var _affectedKeys;minKeys.push(key);minKeyIndexes.push(i);(_affectedKeys=affectedKeys).push.apply(_affectedKeys,_toConsumableArray(inverseDepGraph[key]||[]));continue;}minDepCount=_deps.length;if(!haveBeenDeclared(_deps,groups,minKeys))continue;minKeys=[key];minKeyIndexes=[i];affectedKeys=(inverseDepGraph[key]||[]).slice();}if(minKeys.length==0)break;// this means that the remaining modules contain a cycle somewhere
for(var i=minKeyIndexes.length;i--;){var key=remaining[minKeyIndexes[i]];inverseDepGraph[key]=[];remaining.splice(minKeyIndexes[i],1);}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=affectedKeys[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var key=_step4.value;uniqDepGraph[key]=uniqDepGraph[key].filter(function(ea){return!minKeys.includes(ea);});}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}groups.push.apply(groups,_toConsumableArray(minKeys));}debug&&console.log('totally unsortable and probably cyclic: ',remaining);var asyncModules=[];for(var _key3 in groups){if((uniqDepGraph[_key3]||[]).length)asyncModules.push(_key3);}console.log('async modules due to preserved module structures: ',[].concat(asyncModules,_toConsumableArray(remaining)));return[groups,remaining];},initializeClass:function initializeClass(constructorFunc,superclassSpec){var instanceMethods=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var classMethods=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var classHolder=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var currentModule=arguments[5];var sourceLoc=arguments[6];if(typeof superclassSpec=='undefined')throw Error('Superclass can not be undefined!');G.System.initializeClass._get=G.lively.classes.runtime.initializeClass._get;G.System.initializeClass._set=G.lively.classes.runtime.initializeClass._set;return lively.classes.runtime.initializeClass(constructorFunc,superclassSpec,instanceMethods,classMethods,classHolder,currentModule,sourceLoc);},prepareGlobal:function prepareGlobal(moduleName,exports,globals,encapsulate){// disable module detection
var curDefine=G.define;G.define=undefined;// set globals
var oldGlobals;if(globals){oldGlobals={};for(var g in globals){oldGlobals[g]=G[g];G[g]=globals[g];}}// store a complete copy of the global object in order to detect changes
if(!exports){globalSnapshot={};forEachGlobalValue(function(name,value){globalSnapshot[name]=value;});}// return function to retrieve global
return function(){var globalValue=exports?getGlobalValue(exports):{};var singleGlobal;var multipleExports=!!exports;if(!exports||encapsulate)forEachGlobalValue(function(name,value){if(globalSnapshot[name]===value)return;if(typeof value=='undefined')return;// allow global encapsulation where globals are removed
if(encapsulate)G[name]=undefined;if(!exports){globalValue[name]=value;if(typeof singleGlobal!='undefined'){if(!multipleExports&&singleGlobal!==value)multipleExports=true;}else{singleGlobal=value;}}});globalValue=multipleExports?globalValue:singleGlobal;// revert globals
if(oldGlobals){for(var g in oldGlobals){G[g]=oldGlobals[g];}}G.define=curDefine;return globalValue;};},recorderFor:function recorderFor(moduleId){var rec={};return(this.registry[moduleId]=this.registry[moduleId]||{recorder:rec,exports:rec}).recorder;},load:function load(moduleId){var _this=this;var _sortForLoad=this.sortForLoad(moduleId),_sortForLoad2=_slicedToArray(_sortForLoad,2),syncLoad=_sortForLoad2[0],cyclicLoad=_sortForLoad2[1],_computeUniqDepGraphs2=this.computeUniqDepGraphs(),inverseDepGraph=_computeUniqDepGraphs2.inverseDepGraph,modulesToLoad=[].concat(_toConsumableArray(syncLoad),_toConsumableArray(cyclicLoad)),failedModules=[],maxAttempts=5,updateDependents=function updateDependents(m){var dependents=inverseDepGraph[m.id]||[];dependents.forEach(function(dependent){var dm=_this.get(dependent);try{_this.updateDependent(m,dm);}catch(e){m.executed=false;}});},loadModules=function loadModules(modulesToLoad){var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=modulesToLoad[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var modName=_step6.value;var m=_this.get(modName);if(!m||m.executed)continue;m.executed=true;try{_this.updateImports(m);m.execute();}catch(e){m.executed=false;}updateDependents(m);}}catch(err){_didIteratorError6=true;_iteratorError6=err;}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]){_iterator6["return"]();}}finally{if(_didIteratorError6){throw _iteratorError6;}}}};for(var i=0;modulesToLoad.some(function(m){return _this.get(m)&&!_this.get(m).executed;})&&i<maxAttempts;i++){loadModules(modulesToLoad);}return this.get(moduleId).exports;}};G.loadCompiledFrozenPart=G.lively.FreezerRuntime.loadObjectFromPartsbinFolder.bind(G.lively.FreezerRuntime);})();/*!
 * PEP v0.4.3 | https://github.com/jquery/PEP
 * Copyright jQuery Foundation and other contributors | http://jquery.org/license
 */!function(a,b){"object"==(typeof exports==="undefined"?"undefined":_typeof2(exports))&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.PointerEventsPolyfill=b();}(this,function(){"use strict";function a(a,b){b=b||Object.create(null);var c=document.createEvent("Event");c.initEvent(a,b.bubbles||!1,b.cancelable||!1);// define inherited MouseEvent properties
// skip bubbles and cancelable since they're set above in initEvent()
for(var d,e=2;e<m.length;e++){d=m[e],c[d]=b[d]||n[e];}c.buttons=b.buttons||0;// Spec requires that pointers without pressure specified use 0.5 for down
// state and 0 for up state.
var f=0;// add x/y properties aliased to clientX/Y
// define the properties of the PointerEvent interface
return f=b.pressure&&c.buttons?b.pressure:c.buttons?.5:0,c.x=c.clientX,c.y=c.clientY,c.pointerId=b.pointerId||0,c.width=b.width||0,c.height=b.height||0,c.pressure=f,c.tiltX=b.tiltX||0,c.tiltY=b.tiltY||0,c.twist=b.twist||0,c.tangentialPressure=b.tangentialPressure||0,c.pointerType=b.pointerType||"",c.hwTimestamp=b.hwTimestamp||0,c.isPrimary=b.isPrimary||!1,c;}function b(){this.array=[],this.size=0;}function c(a,b,c,d){this.addCallback=a.bind(d),this.removeCallback=b.bind(d),this.changedCallback=c.bind(d),A&&(this.observer=new A(this.mutationWatcher.bind(this)));}function d(a){return"body /shadow-deep/ "+e(a);}function e(a){return'[touch-action="'+a+'"]';}function f(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; }";}function g(){if(F){D.forEach(function(a){String(a)===a?(E+=e(a)+f(a)+"\n",G&&(E+=d(a)+f(a)+"\n")):(E+=a.selectors.map(e)+f(a.rule)+"\n",G&&(E+=a.selectors.map(d)+f(a.rule)+"\n"));});var a=document.createElement("style");a.textContent=E,document.head.appendChild(a);}}function h(){// only activate if this platform does not have pointer events
if(!window.PointerEvent){if(window.PointerEvent=a,window.navigator.msPointerEnabled){var b=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:b,enumerable:!0}),u.registerSource("ms",_);}else Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),u.registerSource("mouse",N),void 0!==window.ontouchstart&&u.registerSource("touch",V);u.register(document);}}function i(a){if(!u.pointermap.has(a)){var b=new Error("InvalidPointerId");throw b.name="InvalidPointerId",b;}}function j(a){for(var b=a.parentNode;b&&b!==a.ownerDocument;){b=b.parentNode;}if(!b){var c=new Error("InvalidStateError");throw c.name="InvalidStateError",c;}}function k(a){var b=u.pointermap.get(a);return 0!==b.buttons;}function l(){window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:W},releasePointerCapture:{value:X},hasPointerCapture:{value:Y}});}/**
   * This is the constructor for new PointerEvents.
   *
   * New Pointer Events must be given a type, and an optional dictionary of
   * initialization properties.
   *
   * Due to certain platform requirements, events returned from the constructor
   * identify as MouseEvents.
   *
   * @constructor
   * @param {String} inType The type of the event to create.
   * @param {Object} [inDict] An optional dictionary of initial event properties.
   * @return {Event} A new PointerEvent of type `inType`, initialized with properties from `inDict`.
   */var m=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],n=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],o=window.Map&&window.Map.prototype.forEach,p=o?Map:b;b.prototype={set:function set(a,b){return void 0===b?this["delete"](a):(this.has(a)||this.size++,void(this.array[a]=b));},has:function has(a){return void 0!==this.array[a];},"delete":function _delete(a){this.has(a)&&(delete this.array[a],this.size--);},get:function get(a){return this.array[a];},clear:function clear(){this.array.length=0,this.size=0;},// return value, key, map
forEach:function forEach(a,b){return this.array.forEach(function(c,d){a.call(b,c,d,this);},this);}};var q=[// MouseEvent
"bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget",// DOM Level 3
"buttons",// PointerEvent
"pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary",// event instance
"type","target","currentTarget","which","pageX","pageY","timeStamp"],r=[// MouseEvent
!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,// DOM Level 3
0,// PointerEvent
0,0,0,0,0,0,"",0,!1,// event instance
"",null,null,0,0,0,0],s={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},t="undefined"!=typeof SVGElementInstance,u={pointermap:new p(),eventMap:Object.create(null),captureInfo:Object.create(null),// Scope objects for native events.
// This exists for ease of testing.
eventSources:Object.create(null),eventSourceList:[],/**
     * Add a new event source that will generate pointer events.
     *
     * `inSource` must contain an array of event names named `events`, and
     * functions with the names specified in the `events` array.
     * @param {string} name A name for the event source
     * @param {Object} source A new source of platform events.
     */registerSource:function registerSource(a,b){var c=b,d=c.events;d&&(d.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c));},this),this.eventSources[a]=c,this.eventSourceList.push(c));},register:function register(a){for(var b,c=this.eventSourceList.length,d=0;d<c&&(b=this.eventSourceList[d]);d++){// call eventsource register
b.register.call(b,a);}},unregister:function unregister(a){for(var b,c=this.eventSourceList.length,d=0;d<c&&(b=this.eventSourceList[d]);d++){// call eventsource register
b.unregister.call(b,a);}},contains:/*scope.external.contains || */function contains(a,b){try{return a.contains(b);}catch(c){// most likely: https://bugzilla.mozilla.org/show_bug.cgi?id=208427
return!1;}},// EVENTS
down:function down(a){a.bubbles=!0,this.fireEvent("pointerdown",a);},move:function move(a){a.bubbles=!0,this.fireEvent("pointermove",a);},up:function up(a){a.bubbles=!0,this.fireEvent("pointerup",a);},enter:function enter(a){a.bubbles=!1,this.fireEvent("pointerenter",a);},leave:function leave(a){a.bubbles=!1,this.fireEvent("pointerleave",a);},over:function over(a){a.bubbles=!0,this.fireEvent("pointerover",a);},out:function out(a){a.bubbles=!0,this.fireEvent("pointerout",a);},cancel:function cancel(a){a.bubbles=!0,this.fireEvent("pointercancel",a);},leaveOut:function leaveOut(a){this.out(a),this.propagate(a,this.leave,!1);},enterOver:function enterOver(a){this.over(a),this.propagate(a,this.enter,!0);},// LISTENER LOGIC
eventHandler:function eventHandler(a){// This is used to prevent multiple dispatch of pointerevents from
// platform events. This can happen when two elements in different scopes
// are set up to create pointer events, which is relevant to Shadow DOM.
if(!a._handledByPE){var b=a.type,c=this.eventMap&&this.eventMap[b];c&&c(a),a._handledByPE=!0;}},// set up event listeners
listen:function listen(a,b){b.forEach(function(b){this.addEvent(a,b);},this);},// remove event listeners
unlisten:function unlisten(a,b){b.forEach(function(b){this.removeEvent(a,b);},this);},addEvent:/*scope.external.addEvent || */function addEvent(a,b){a.addEventListener(b,this.boundHandler);},removeEvent:/*scope.external.removeEvent || */function removeEvent(a,b){a.removeEventListener(b,this.boundHandler);},// EVENT CREATION AND TRACKING
/**
     * Creates a new Event of type `inType`, based on the information in
     * `inEvent`.
     *
     * @param {string} inType A string representing the type of event to create
     * @param {Event} inEvent A platform event with a target
     * @return {Event} A PointerEvent of type `inType`
     */makeEvent:function makeEvent(b,c){// relatedTarget must be null if pointer is captured
this.captureInfo[c.pointerId]&&(c.relatedTarget=null);var d=new a(b,c);return c.preventDefault&&(d.preventDefault=c.preventDefault),d._target=d._target||c.target,d;},// make and dispatch an event in one call
fireEvent:function fireEvent(a,b){var c=this.makeEvent(a,b);return this.dispatchEvent(c);},/**
     * Returns a snapshot of inEvent, with writable properties.
     *
     * @param {Event} inEvent An event that contains properties to copy.
     * @return {Object} An object containing shallow copies of `inEvent`'s
     *    properties.
     */cloneEvent:function cloneEvent(a){for(var b,c=Object.create(null),d=0;d<q.length;d++){b=q[d],c[b]=a[b]||r[d],// Work around SVGInstanceElement shadow tree
// Return the <use> element that is represented by the instance for Safari, Chrome, IE.
// This is the behavior implemented by Firefox.
!t||"target"!==b&&"relatedTarget"!==b||c[b]instanceof SVGElementInstance&&(c[b]=c[b].correspondingUseElement);}// keep the semantics of preventDefault
return a.preventDefault&&(c.preventDefault=function(){a.preventDefault();}),c;},getTarget:function getTarget(a){var b=this.captureInfo[a.pointerId];return b?a._target!==b&&a.type in s?void 0:b:a._target;},propagate:function propagate(a,b,c){// Order of conditions due to document.contains() missing in IE.
for(var d=a.target,e=[];d!==document&&!d.contains(a.relatedTarget);){// Touch: Do not propagate if node is detached.
if(e.push(d),d=d.parentNode,!d)return;}c&&e.reverse(),e.forEach(function(c){a.target=c,b.call(this,a);},this);},setCapture:function setCapture(b,c,d){this.captureInfo[b]&&this.releaseCapture(b,d),this.captureInfo[b]=c,this.implicitRelease=this.releaseCapture.bind(this,b,d),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease);var e=new a("gotpointercapture");e.pointerId=b,e._target=c,d||this.asyncDispatchEvent(e);},releaseCapture:function releaseCapture(b,c){var d=this.captureInfo[b];if(d){this.captureInfo[b]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease);var e=new a("lostpointercapture");e.pointerId=b,e._target=d,c||this.asyncDispatchEvent(e);}},/**
     * Dispatches the event to its target.
     *
     * @param {Event} inEvent The event to be dispatched.
     * @return {Boolean} True if an event handler returns true, false otherwise.
     */dispatchEvent:/*scope.external.dispatchEvent || */function dispatchEvent(a){var b=this.getTarget(a);if(b)return b.dispatchEvent(a);},asyncDispatchEvent:function asyncDispatchEvent(a){requestAnimationFrame(this.dispatchEvent.bind(this,a));}};u.boundHandler=u.eventHandler.bind(u);var v={shadow:function shadow(a){if(a)return a.shadowRoot||a.webkitShadowRoot;},canTarget:function canTarget(a){return a&&Boolean(a.elementFromPoint);},targetingShadow:function targetingShadow(a){var b=this.shadow(a);if(this.canTarget(b))return b;},olderShadow:function olderShadow(a){var b=a.olderShadowRoot;if(!b){var c=a.querySelector("shadow");c&&(b=c.olderShadowRoot);}return b;},allShadows:function allShadows(a){for(var b=[],c=this.shadow(a);c;){b.push(c),c=this.olderShadow(c);}return b;},searchRoot:function searchRoot(a,b,c){if(a){var d,e,f=a.elementFromPoint(b,c);for(// is element a shadow host?
e=this.targetingShadow(f);e;){if(// find the the element inside the shadow root
d=e.elementFromPoint(b,c)){// shadowed element may contain a shadow root
var g=this.targetingShadow(d);return this.searchRoot(g,b,c)||d;}// check for older shadows
e=this.olderShadow(e);}// light dom element is the target
return f;}},owner:function owner(a){// walk up until you hit the shadow root or document
for(var b=a;b.parentNode;){b=b.parentNode;}// the owner element is expected to be a Document or ShadowRoot
return b.nodeType!==Node.DOCUMENT_NODE&&b.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(b=document),b;},findTarget:function findTarget(a){var b=a.clientX,c=a.clientY,d=this.owner(a.target);// if x, y is not in this root, fall back to document search
return d.elementFromPoint(b,c)||(d=document),this.searchRoot(d,b,c);}},w=Array.prototype.forEach.call.bind(Array.prototype.forEach),x=Array.prototype.map.call.bind(Array.prototype.map),y=Array.prototype.slice.call.bind(Array.prototype.slice),z=Array.prototype.filter.call.bind(Array.prototype.filter),A=window.MutationObserver||window.WebKitMutationObserver,B="[touch-action]",C={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};c.prototype={watchSubtree:function watchSubtree(a){// Only watch scopes that can target find, as these are top-level.
// Otherwise we can see duplicate additions and removals that add noise.
//
// TODO(dfreedman): For some instances with ShadowDOMPolyfill, we can see
// a removal without an insertion when a node is redistributed among
// shadows. Since it all ends up correct in the document, watching only
// the document will yield the correct mutations to watch.
this.observer&&v.canTarget(a)&&this.observer.observe(a,C);},enableOnSubtree:function enableOnSubtree(a){this.watchSubtree(a),a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a);},installNewSubtree:function installNewSubtree(a){w(this.findElements(a),this.addElement,this);},findElements:function findElements(a){return a.querySelectorAll?a.querySelectorAll(B):[];},removeElement:function removeElement(a){this.removeCallback(a);},addElement:function addElement(a){this.addCallback(a);},elementChanged:function elementChanged(a,b){this.changedCallback(a,b);},concatLists:function concatLists(a,b){return a.concat(y(b));},// register all touch-action = none nodes on document load
installOnLoad:function installOnLoad(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document);}.bind(this));},isElement:function isElement(a){return a.nodeType===Node.ELEMENT_NODE;},flattenMutationTree:function flattenMutationTree(a){// find children with touch-action
var b=x(a,this.findElements,this);// flatten the list
// make sure the added nodes are accounted for
return b.push(z(a,this.isElement)),b.reduce(this.concatLists,[]);},mutationWatcher:function mutationWatcher(a){a.forEach(this.mutationHandler,this);},mutationHandler:function mutationHandler(a){if("childList"===a.type){var b=this.flattenMutationTree(a.addedNodes);b.forEach(this.addElement,this);var c=this.flattenMutationTree(a.removedNodes);c.forEach(this.removeElement,this);}else"attributes"===a.type&&this.elementChanged(a.target,a.oldValue);}};var D=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],E="",F=window.PointerEvent||window.MSPointerEvent,G=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,H=u.pointermap,I=25,J=[1,4,2,8,16],K=!1;try{K=1===new MouseEvent("test",{buttons:1}).buttons;}catch(L){}// handler block for native mouse events
var M,N={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function register(a){u.listen(a,this.events);},unregister:function unregister(a){u.unlisten(a,this.events);},lastTouches:[],// collide with the global mouse listener
isEventSimulatedFromTouch:function isEventSimulatedFromTouch(a){for(var b,c=this.lastTouches,d=a.clientX,e=a.clientY,f=0,g=c.length;f<g&&(b=c[f]);f++){// simulated mouse events will be swallowed near a primary touchend
var h=Math.abs(d-b.x),i=Math.abs(e-b.y);if(h<=I&&i<=I)return!0;}},prepareEvent:function prepareEvent(a){var b=u.cloneEvent(a),c=b.preventDefault;return b.preventDefault=function(){a.preventDefault(),c();},b.pointerId=this.POINTER_ID,b.isPrimary=!0,b.pointerType=this.POINTER_TYPE,b;},prepareButtonsForMove:function prepareButtonsForMove(a,b){var c=H.get(this.POINTER_ID);// Update buttons state after possible out-of-document mouseup.
0!==b.which&&c?a.buttons=c.buttons:a.buttons=0,b.buttons=a.buttons;},mousedown:function mousedown(a){if(!this.isEventSimulatedFromTouch(a)){var b=H.get(this.POINTER_ID),c=this.prepareEvent(a);K||(c.buttons=J[c.button],b&&(c.buttons|=b.buttons),a.buttons=c.buttons),H.set(this.POINTER_ID,a),b&&0!==b.buttons?u.move(c):u.down(c);}},mousemove:function mousemove(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);K||this.prepareButtonsForMove(b,a),b.button=-1,H.set(this.POINTER_ID,a),u.move(b);}},mouseup:function mouseup(a){if(!this.isEventSimulatedFromTouch(a)){var b=H.get(this.POINTER_ID),c=this.prepareEvent(a);if(!K){var d=J[c.button];// Produces wrong state of buttons in Browsers without `buttons` support
// when a mouse button that was pressed outside the document is released
// inside and other buttons are still pressed down.
c.buttons=b?b.buttons&~d:0,a.buttons=c.buttons;}H.set(this.POINTER_ID,a),// Support: Firefox <=44 only
// FF Ubuntu includes the lifted button in the `buttons` property on
// mouseup.
// https://bugzilla.mozilla.org/show_bug.cgi?id=1223366
c.buttons&=~J[c.button],0===c.buttons?u.up(c):u.move(c);}},mouseover:function mouseover(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);K||this.prepareButtonsForMove(b,a),b.button=-1,H.set(this.POINTER_ID,a),u.enterOver(b);}},mouseout:function mouseout(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);K||this.prepareButtonsForMove(b,a),b.button=-1,u.leaveOut(b);}},cancel:function cancel(a){var b=this.prepareEvent(a);u.cancel(b),this.deactivateMouse();},deactivateMouse:function deactivateMouse(){H["delete"](this.POINTER_ID);}},O=u.captureInfo,P=v.findTarget.bind(v),Q=v.allShadows.bind(v),R=u.pointermap,S=2500,T=200,U="touch-action",V={events:["touchstart","touchmove","touchend","touchcancel"],register:function register(a){M.enableOnSubtree(a);},unregister:function unregister(){},elementAdded:function elementAdded(a){var b=a.getAttribute(U),c=this.touchActionToScrollType(b);c&&(a._scrollType=c,u.listen(a,this.events),// set touch-action on shadows as well
Q(a).forEach(function(a){a._scrollType=c,u.listen(a,this.events);},this));},elementRemoved:function elementRemoved(a){a._scrollType=void 0,u.unlisten(a,this.events),// remove touch-action from shadow
Q(a).forEach(function(a){a._scrollType=void 0,u.unlisten(a,this.events);},this);},elementChanged:function elementChanged(a,b){var c=a.getAttribute(U),d=this.touchActionToScrollType(c),e=this.touchActionToScrollType(b);// simply update scrollType if listeners are already established
d&&e?(a._scrollType=d,Q(a).forEach(function(a){a._scrollType=d;},this)):e?this.elementRemoved(a):d&&this.elementAdded(a);},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function touchActionToScrollType(a){var b=a,c=this.scrollTypes;return"none"===b?"none":b===c.XSCROLLER?"X":b===c.YSCROLLER?"Y":c.SCROLLER.exec(b)?"XY":void 0;},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function isPrimaryTouch(a){return this.firstTouch===a.identifier;},setPrimaryTouch:function setPrimaryTouch(a){// set primary touch if there no pointers, or the only pointer is the mouse
(0===R.size||1===R.size&&R.has(1))&&(this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount());},removePrimaryPointer:function removePrimaryPointer(a){a.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount());},clickCount:0,resetId:null,resetClickCount:function resetClickCount(){var a=function(){this.clickCount=0,this.resetId=null;}.bind(this);this.resetId=setTimeout(a,T);},cancelResetClickCount:function cancelResetClickCount(){this.resetId&&clearTimeout(this.resetId);},typeToButtons:function typeToButtons(a){var b=0;return"touchstart"!==a&&"touchmove"!==a||(b=1),b;},touchToPointer:function touchToPointer(a){var b=this.currentTouchEvent,c=u.cloneEvent(a),d=c.pointerId=a.identifier+2;c.target=O[d]||P(c),c.bubbles=!0,c.cancelable=!0,c.detail=this.clickCount,c.button=0,c.buttons=this.typeToButtons(b.type),c.width=2*(a.radiusX||a.webkitRadiusX||0),c.height=2*(a.radiusY||a.webkitRadiusY||0),c.pressure=a.force||a.webkitForce||.5,c.isPrimary=this.isPrimaryTouch(a),c.pointerType=this.POINTER_TYPE,// forward modifier keys
c.altKey=b.altKey,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey;// forward touch preventDefaults
var e=this;return c.preventDefault=function(){e.scrolling=!1,e.firstXY=null,b.preventDefault();},c;},processTouches:function processTouches(a,b){var c=a.changedTouches;this.currentTouchEvent=a;for(var d,e=0;e<c.length;e++){d=c[e],b.call(this,this.touchToPointer(d));}},// For single axis scrollers, determines whether the element should emit
// pointer events or behave as a scroller
shouldScroll:function shouldScroll(a){if(this.firstXY){var b,c=a.currentTarget._scrollType;if("none"===c)// this element is a touch-action: none, should never scroll
b=!1;else if("XY"===c)// this element should always scroll
b=!0;else{var d=a.changedTouches[0],e=c,f="Y"===c?"X":"Y",g=Math.abs(d["client"+e]-this.firstXY[e]),h=Math.abs(d["client"+f]-this.firstXY[f]);// if delta in the scroll axis > delta other axis, scroll instead of
// making events
b=g>=h;}return this.firstXY=null,b;}},findTouch:function findTouch(a,b){for(var c,d=0,e=a.length;d<e&&(c=a[d]);d++){if(c.identifier===b)return!0;}},// In some instances, a touchstart can happen without a touchend. This
// leaves the pointermap in a broken state.
// Therefore, on every touchstart, we remove the touches that did not fire a
// touchend event.
// To keep state globally consistent, we fire a
// pointercancel for this "abandoned" touch
vacuumTouches:function vacuumTouches(a){var b=a.touches;// pointermap.size should be < tl.length here, as the touchstart has not
// been processed yet.
if(R.size>=b.length){var c=[];R.forEach(function(a,d){// Never remove pointerId == 1, which is mouse.
// Touch identifiers are 2 smaller than their pointerId, which is the
// index in pointermap.
if(1!==d&&!this.findTouch(b,d-2)){var e=a.out;c.push(e);}},this),c.forEach(this.cancelOut,this);}},touchstart:function touchstart(a){this.vacuumTouches(a),this.setPrimaryTouch(a.changedTouches[0]),this.dedupSynthMouse(a),this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown));},overDown:function overDown(a){R.set(a.pointerId,{target:a.target,out:a,outTarget:a.target}),u.enterOver(a),u.down(a);},touchmove:function touchmove(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)));},moveOverOut:function moveOverOut(a){var b=a,c=R.get(b.pointerId);// a finger drifted off the screen, ignore it
if(c){var d=c.out,e=c.outTarget;u.move(b),d&&e!==b.target&&(d.relatedTarget=b.target,b.relatedTarget=e,// recover from retargeting by shadow
d.target=e,b.target?(u.leaveOut(d),u.enterOver(b)):(// clean up case when finger leaves the screen
b.target=e,b.relatedTarget=null,this.cancelOut(b))),c.out=b,c.outTarget=b.target;}},touchend:function touchend(a){this.dedupSynthMouse(a),this.processTouches(a,this.upOut);},upOut:function upOut(a){this.scrolling||(u.up(a),u.leaveOut(a)),this.cleanUpPointer(a);},touchcancel:function touchcancel(a){this.processTouches(a,this.cancelOut);},cancelOut:function cancelOut(a){u.cancel(a),u.leaveOut(a),this.cleanUpPointer(a);},cleanUpPointer:function cleanUpPointer(a){R["delete"](a.pointerId),this.removePrimaryPointer(a);},// prevent synth mouse events from creating pointer events
dedupSynthMouse:function dedupSynthMouse(a){var b=N.lastTouches,c=a.changedTouches[0];// only the primary finger will synth mouse events
if(this.isPrimaryTouch(c)){// remember x/y of last touch
var d={x:c.clientX,y:c.clientY};b.push(d);var e=function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1);}.bind(null,b,d);setTimeout(e,S);}}};M=new c(V.elementAdded,V.elementRemoved,V.elementChanged,V);var W,X,Y,Z=u.pointermap,$=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,_={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function register(a){u.listen(a,this.events);},unregister:function unregister(a){u.unlisten(a,this.events);},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function prepareEvent(a){var b=a;return $&&(b=u.cloneEvent(a),b.pointerType=this.POINTER_TYPES[a.pointerType]),b;},cleanup:function cleanup(a){Z["delete"](a);},MSPointerDown:function MSPointerDown(a){Z.set(a.pointerId,a);var b=this.prepareEvent(a);u.down(b);},MSPointerMove:function MSPointerMove(a){var b=this.prepareEvent(a);u.move(b);},MSPointerUp:function MSPointerUp(a){var b=this.prepareEvent(a);u.up(b),this.cleanup(a.pointerId);},MSPointerOut:function MSPointerOut(a){var b=this.prepareEvent(a);u.leaveOut(b);},MSPointerOver:function MSPointerOver(a){var b=this.prepareEvent(a);u.enterOver(b);},MSPointerCancel:function MSPointerCancel(a){var b=this.prepareEvent(a);u.cancel(b),this.cleanup(a.pointerId);},MSLostPointerCapture:function MSLostPointerCapture(a){var b=u.makeEvent("lostpointercapture",a);u.dispatchEvent(b);},MSGotPointerCapture:function MSGotPointerCapture(a){var b=u.makeEvent("gotpointercapture",a);u.dispatchEvent(b);}},aa=window.navigator;aa.msPointerEnabled?(W=function W(a){i(a),j(this),k(a)&&(u.setCapture(a,this,!0),this.msSetPointerCapture(a));},X=function X(a){i(a),u.releaseCapture(a,!0),this.msReleasePointerCapture(a);}):(W=function W(a){i(a),j(this),k(a)&&u.setCapture(a,this);},X=function X(a){i(a),u.releaseCapture(a);}),Y=function Y(a){return!!u.captureInfo[a];},g(),h(),l();var ba={dispatcher:u,Installer:c,PointerEvent:a,PointerMap:p,targetFinding:v};return ba;});(function(global,factory){(typeof exports==="undefined"?"undefined":_typeof2(exports))==='object'&&typeof module!=='undefined'?factory(exports):typeof define==='function'&&define.amd?define(['exports'],factory):factory(global.WHATWGFetch={});})(this,function(exports){'use strict';var support={searchParams:'URLSearchParams'in self,iterable:'Symbol'in self&&'iterator'in Symbol,blob:'FileReader'in self&&'Blob'in self&&function(){try{new Blob();return true;}catch(e){return false;}}(),formData:'FormData'in self,arrayBuffer:'ArrayBuffer'in self};function isDataView(obj){return obj&&DataView.prototype.isPrototypeOf(obj);}if(support.arrayBuffer){var viewClasses=['[object Int8Array]','[object Uint8Array]','[object Uint8ClampedArray]','[object Int16Array]','[object Uint16Array]','[object Int32Array]','[object Uint32Array]','[object Float32Array]','[object Float64Array]'];var isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1;};}function normalizeName(name){if(typeof name!=='string'){name=String(name);}if(/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(name)){throw new TypeError('Invalid character in header field name');}return name.toLowerCase();}function normalizeValue(value){if(typeof value!=='string'){value=String(value);}return value;}// Build a destructive iterator for the value list
function iteratorFor(items){var iterator={next:function next(){var value=items.shift();return{done:value===undefined,value:value};}};if(support.iterable){iterator[Symbol.iterator]=function(){return iterator;};}return iterator;}function Headers(headers){this.map={};if(headers instanceof Headers){headers.forEach(function(value,name){this.append(name,value);},this);}else if(Array.isArray(headers)){headers.forEach(function(header){this.append(header[0],header[1]);},this);}else if(headers){Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name]);},this);}}Headers.prototype.append=function(name,value){name=normalizeName(name);value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+', '+value:value;};Headers.prototype['delete']=function(name){delete this.map[normalizeName(name)];};Headers.prototype.get=function(name){name=normalizeName(name);return this.has(name)?this.map[name]:null;};Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name));};Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value);};Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map){if(this.map.hasOwnProperty(name)){callback.call(thisArg,this.map[name],name,this);}}};Headers.prototype.keys=function(){var items=[];this.forEach(function(value,name){items.push(name);});return iteratorFor(items);};Headers.prototype.values=function(){var items=[];this.forEach(function(value){items.push(value);});return iteratorFor(items);};Headers.prototype.entries=function(){var items=[];this.forEach(function(value,name){items.push([name,value]);});return iteratorFor(items);};if(support.iterable){Headers.prototype[Symbol.iterator]=Headers.prototype.entries;}function consumed(body){if(body.bodyUsed){return Promise.reject(new TypeError('Already read'));}body.bodyUsed=true;}function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result);};reader.onerror=function(){reject(reader.error);};});}function readBlobAsArrayBuffer(blob){var reader=new FileReader();var promise=fileReaderReady(reader);reader.readAsArrayBuffer(blob);return promise;}function readBlobAsText(blob){var reader=new FileReader();var promise=fileReaderReady(reader);reader.readAsText(blob);return promise;}function readArrayBufferAsText(buf){var view=new Uint8Array(buf);var chars=new Array(view.length);for(var i=0;i<view.length;i++){chars[i]=String.fromCharCode(view[i]);}return chars.join('');}function bufferClone(buf){if(buf.slice){return buf.slice(0);}else{var view=new Uint8Array(buf.byteLength);view.set(new Uint8Array(buf));return view.buffer;}}function Body(){this.bodyUsed=false;this._initBody=function(body){this._bodyInit=body;if(!body){this._bodyText='';}else if(typeof body==='string'){this._bodyText=body;}else if(support.blob&&Blob.prototype.isPrototypeOf(body)){this._bodyBlob=body;}else if(support.formData&&FormData.prototype.isPrototypeOf(body)){this._bodyFormData=body;}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this._bodyText=body.toString();}else if(support.arrayBuffer&&support.blob&&isDataView(body)){this._bodyArrayBuffer=bufferClone(body.buffer);// IE 10-11 can't handle a DataView body.
this._bodyInit=new Blob([this._bodyArrayBuffer]);}else if(support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))){this._bodyArrayBuffer=bufferClone(body);}else{this._bodyText=body=Object.prototype.toString.call(body);}if(!this.headers.get('content-type')){if(typeof body==='string'){this.headers.set('content-type','text/plain;charset=UTF-8');}else if(this._bodyBlob&&this._bodyBlob.type){this.headers.set('content-type',this._bodyBlob.type);}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this.headers.set('content-type','application/x-www-form-urlencoded;charset=UTF-8');}}};if(support.blob){this.blob=function(){var rejected=consumed(this);if(rejected){return rejected;}if(this._bodyBlob){return Promise.resolve(this._bodyBlob);}else if(this._bodyArrayBuffer){return Promise.resolve(new Blob([this._bodyArrayBuffer]));}else if(this._bodyFormData){throw new Error('could not read FormData body as blob');}else{return Promise.resolve(new Blob([this._bodyText]));}};this.arrayBuffer=function(){if(this._bodyArrayBuffer){return consumed(this)||Promise.resolve(this._bodyArrayBuffer);}else{return this.blob().then(readBlobAsArrayBuffer);}};}this.text=function(){var rejected=consumed(this);if(rejected){return rejected;}if(this._bodyBlob){return readBlobAsText(this._bodyBlob);}else if(this._bodyArrayBuffer){return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));}else if(this._bodyFormData){throw new Error('could not read FormData body as text');}else{return Promise.resolve(this._bodyText);}};if(support.formData){this.formData=function(){return this.text().then(decode);};}this.json=function(){return this.text().then(JSON.parse);};return this;}// HTTP methods whose capitalization should be normalized
var methods=['DELETE','GET','HEAD','OPTIONS','POST','PUT'];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method;}function Request(input,options){options=options||{};var body=options.body;if(input instanceof Request){if(input.bodyUsed){throw new TypeError('Already read');}this.url=input.url;this.credentials=input.credentials;if(!options.headers){this.headers=new Headers(input.headers);}this.method=input.method;this.mode=input.mode;this.signal=input.signal;if(!body&&input._bodyInit!=null){body=input._bodyInit;input.bodyUsed=true;}}else{this.url=String(input);}this.credentials=options.credentials||this.credentials||'same-origin';if(options.headers||!this.headers){this.headers=new Headers(options.headers);}this.method=normalizeMethod(options.method||this.method||'GET');this.mode=options.mode||this.mode||null;this.signal=options.signal||this.signal;this.referrer=null;if((this.method==='GET'||this.method==='HEAD')&&body){throw new TypeError('Body not allowed for GET or HEAD requests');}this._initBody(body);}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit});};function decode(body){var form=new FormData();body.trim().split('&').forEach(function(bytes){if(bytes){var split=bytes.split('=');var name=split.shift().replace(/\+/g,' ');var value=split.join('=').replace(/\+/g,' ');form.append(decodeURIComponent(name),decodeURIComponent(value));}});return form;}function parseHeaders(rawHeaders){var headers=new Headers();// Replace instances of \r\n and \n followed by at least one space or horizontal tab with a space
// https://tools.ietf.org/html/rfc7230#section-3.2
var preProcessedHeaders=rawHeaders.replace(/\r?\n[\t ]+/g,' ');preProcessedHeaders.split(/\r?\n/).forEach(function(line){var parts=line.split(':');var key=parts.shift().trim();if(key){var value=parts.join(':').trim();headers.append(key,value);}});return headers;}Body.call(Request.prototype);function Response(bodyInit,options){if(!options){options={};}this.type='default';this.status=options.status===undefined?200:options.status;this.ok=this.status>=200&&this.status<300;this.statusText='statusText'in options?options.statusText:'OK';this.headers=new Headers(options.headers);this.url=options.url||'';this._initBody(bodyInit);}Body.call(Response.prototype);Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url});};Response.error=function(){var response=new Response(null,{status:0,statusText:''});response.type='error';return response;};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(redirectStatuses.indexOf(status)===-1){throw new RangeError('Invalid status code');}return new Response(null,{status:status,headers:{location:url}});};exports.DOMException=self.DOMException;try{new exports.DOMException();}catch(err){exports.DOMException=function(message,name){this.message=message;this.name=name;var error=Error(message);this.stack=error.stack;};exports.DOMException.prototype=Object.create(Error.prototype);exports.DOMException.prototype.constructor=exports.DOMException;}function fetch(input,init){return new Promise(function(resolve,reject){var request=new Request(input,init);if(request.signal&&request.signal.aborted){return reject(new exports.DOMException('Aborted','AbortError'));}var xhr=new XMLHttpRequest();function abortXhr(){xhr.abort();}xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||'')};options.url='responseURL'in xhr?xhr.responseURL:options.headers.get('X-Request-URL');var body='response'in xhr?xhr.response:xhr.responseText;resolve(new Response(body,options));};xhr.onerror=function(){reject(new TypeError('Network request failed'));};xhr.ontimeout=function(){reject(new TypeError('Network request failed'));};xhr.onabort=function(){reject(new exports.DOMException('Aborted','AbortError'));};xhr.open(request.method,request.url,true);if(request.credentials==='include'){xhr.withCredentials=true;}else if(request.credentials==='omit'){xhr.withCredentials=false;}if('responseType'in xhr&&support.blob){xhr.responseType='blob';}request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value);});if(request.signal){request.signal.addEventListener('abort',abortXhr);xhr.onreadystatechange=function(){// DONE (success or failure)
if(xhr.readyState===4){request.signal.removeEventListener('abort',abortXhr);}};}xhr.send(typeof request._bodyInit==='undefined'?null:request._bodyInit);});}fetch.polyfill=true;if(!self.fetch){self.fetch=fetch;self.Headers=Headers;self.Request=Request;self.Response=Response;}exports.Headers=Headers;exports.Request=Request;exports.Response=Response;exports.fetch=fetch;Object.defineProperty(exports,'__esModule',{value:true});});/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var runtime=function(exports){"use strict";var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var undefined;// More compressible than void 0.
var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});return obj[key];}try{// IE 8 has a broken Object.defineProperty that only works on DOM objects.
define({},"");}catch(err){define=function define(obj,key,value){return obj[key]=value;};}function wrap(innerFn,outerFn,self,tryLocsList){// If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);// The ._invoke method unifies the implementations of the .next,
// .throw, and .return methods.
generator._invoke=makeInvokeMethod(innerFn,self,context);return generator;}exports.wrap=wrap;// Try/catch helper to minimize deoptimizations. Returns a completion
// record like context.tryEntries[i].completion. This interface could
// have been (and was previously) designed to take a closure to be
// invoked without arguments, but in all the cases we care about we
// already have an existing method we want to call, so there's no need
// to create a new function object. We can even get away with assuming
// the method takes exactly one argument, since that happens to be true
// in every case, so we don't have to touch the arguments object. The
// only additional allocation required is the completion record, which
// has a stable shape and so hopefully should be cheap to allocate.
function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)};}catch(err){return{type:"throw",arg:err};}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";// Returning this object from the innerFn has the same effect as
// breaking out of the dispatch switch statement.
var ContinueSentinel={};// Dummy constructor functions that we use as the .constructor and
// .constructor.prototype properties for functions that return Generator
// objects. For full spec compliance, you may wish to configure your
// minifier not to mangle the names of these two functions.
function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}// This is a polyfill for %IteratorPrototype% for environments that
// don't natively support it.
var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this;};var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){// This environment has a native %IteratorPrototype%; use it instead
// of the polyfill.
IteratorPrototype=NativeIteratorPrototype;}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction");// Helper for defining the .next, .throw, and .return methods of the
// Iterator interface in terms of a single ._invoke method.
function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg);});});}exports.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||// For the native GeneratorFunction constructor, the best we can
// do is to check its .name property.
(ctor.displayName||ctor.name)==="GeneratorFunction":false;};exports.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype);}else{genFun.__proto__=GeneratorFunctionPrototype;define(genFun,toStringTagSymbol,"GeneratorFunction");}genFun.prototype=Object.create(Gp);return genFun;};// Within the body of any async function, `await x` is transformed to
// `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
// `hasOwn.call(value, "__await")` to determine if the yielded value is
// meant to be awaited.
exports.awrap=function(arg){return{__await:arg};};function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg);}else{var result=record.arg;var value=result.value;if(value&&_typeof2(value)==="object"&&hasOwn.call(value,"__await")){return PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject);},function(err){invoke("throw",err,resolve,reject);});}return PromiseImpl.resolve(value).then(function(unwrapped){// When a yielded Promise is resolved, its final value becomes
// the .value of the Promise<{value,done}> result for the
// current iteration.
result.value=unwrapped;resolve(result);},function(error){// If a rejected Promise was yielded, throw the rejection back
// into the async generator function so it can be handled there.
return invoke("throw",error,resolve,reject);});}}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject);});}return previousPromise=// If enqueue has been called before, then we want to wait until
// all previous Promises have been resolved before calling invoke,
// so that results are always delivered in the correct order. If
// enqueue has not been called before, then it is important to
// call invoke immediately, without waiting on a callback to fire,
// so that the async generator function has the opportunity to do
// any necessary setup in a predictable way. This predictability
// is why the Promise constructor synchronously invokes its
// executor callback, and why async functions synchronously
// execute code before the first await. Since we implement simple
// async functions in terms of async generators, it is especially
// important to get this right, even though it requires care.
previousPromise?previousPromise.then(callInvokeWithMethodAndArg,// Avoid propagating failures to Promises returned by later
// invocations of the iterator.
callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();}// Define the unified helper method that is used to implement .next,
// .throw, and .return (see defineIteratorMethods).
this._invoke=enqueue;}defineIteratorMethods(AsyncIterator.prototype);AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this;};exports.AsyncIterator=AsyncIterator;// Note that simple async functions are implemented on top of
// AsyncIterator objects; they just return a Promise for the value of
// the final result produced by the iterator.
exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){if(PromiseImpl===void 0)PromiseImpl=Promise;var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter// If outerFn is a generator, return the full iterator.
:iter.next().then(function(result){return result.done?result.value:iter.next();});};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running");}if(state===GenStateCompleted){if(method==="throw"){throw arg;}// Be forgiving, per 25.3.3.3.3 of the spec:
// https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
return doneResult();}context.method=method;context.arg=arg;while(true){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult;}}if(context.method==="next"){// Setting context._sent for legacy support of Babel's
// function.sent implementation.
context.sent=context._sent=context.arg;}else if(context.method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw context.arg;}context.dispatchException(context.arg);}else if(context.method==="return"){context.abrupt("return",context.arg);}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){// If an exception is thrown from innerFn, we leave state ===
// GenStateExecuting and loop back for another invocation.
state=context.done?GenStateCompleted:GenStateSuspendedYield;if(record.arg===ContinueSentinel){continue;}return{value:record.arg,done:context.done};}else if(record.type==="throw"){state=GenStateCompleted;// Dispatch the exception by looping back around to the
// context.dispatchException(context.arg) call above.
context.method="throw";context.arg=record.arg;}}};}// Call delegate.iterator[context.method](context.arg) and handle the
// result, either by returning a { value, done } result from the
// delegate iterator, or by modifying context.method and context.arg,
// setting context.delegate to null, and returning the ContinueSentinel.
function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){// A .throw or .return when the delegate iterator has no .throw
// method always terminates the yield* loop.
context.delegate=null;if(context.method==="throw"){// Note: ["return"] must be used for ES3 parsing compatibility.
if(delegate.iterator["return"]){// If the delegate iterator has a return method, give it a
// chance to clean up.
context.method="return";context.arg=undefined;maybeInvokeDelegate(delegate,context);if(context.method==="throw"){// If maybeInvokeDelegate(context) changed context.method from
// "return" to "throw", let that override the TypeError below.
return ContinueSentinel;}}context.method="throw";context.arg=new TypeError("The iterator does not provide a 'throw' method");}return ContinueSentinel;}var record=tryCatch(method,delegate.iterator,context.arg);if(record.type==="throw"){context.method="throw";context.arg=record.arg;context.delegate=null;return ContinueSentinel;}var info=record.arg;if(!info){context.method="throw";context.arg=new TypeError("iterator result is not an object");context.delegate=null;return ContinueSentinel;}if(info.done){// Assign the result of the finished delegate to the temporary
// variable specified by delegate.resultName (see delegateYield).
context[delegate.resultName]=info.value;// Resume execution at the desired location (see delegateYield).
context.next=delegate.nextLoc;// If context.method was "throw" but the delegate handled the
// exception, let the outer generator proceed normally. If
// context.method was "next", forget context.arg since it has been
// "consumed" by the delegate iterator. If context.method was
// "return", allow the original .return call to continue in the
// outer generator.
if(context.method!=="return"){context.method="next";context.arg=undefined;}}else{// Re-yield the result returned by the delegate method.
return info;}// The delegate iterator is finished, so forget it and continue with
// the outer generator.
context.delegate=null;return ContinueSentinel;}// Define Generator.prototype.{next,throw,return} in terms of the
// unified ._invoke helper method.
defineIteratorMethods(Gp);define(Gp,toStringTagSymbol,"Generator");// A Generator should always return itself as the iterator object when the
// @@iterator function is called on it. Some browsers' implementations of the
// iterator prototype chain incorrectly implement this, causing the Generator
// object to not be returned from this call. This ensures that doesn't happen.
// See https://github.com/facebook/regenerator/issues/274 for more details.
Gp[iteratorSymbol]=function(){return this;};Gp.toString=function(){return"[object Generator]";};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1];}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3];}this.tryEntries.push(entry);}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record;}function Context(tryLocsList){// The root entry object (effectively a try statement without a catch
// or a finally block) gives us a place to store values thrown from
// locations where there is no enclosing try statement.
this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true);}exports.keys=function(object){var keys=[];for(var key in object){keys.push(key);}keys.reverse();// Rather than returning an object with a next method, we keep
// things simple and return the next function itself.
return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next;}}// To avoid creating an additional object, we just hang the .value
// and .done properties off the next function object itself. This
// also ensures that the minifier will not anonymize the function.
next.done=true;return next;};};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable);}if(typeof iterable.next==="function"){return iterable;}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next;}}next.value=undefined;next.done=true;return next;};return next.next=next;}}// Return an iterator with no values.
return{next:doneResult};}exports.values=values;function doneResult(){return{value:undefined,done:true};}Context.prototype={constructor:Context,reset:function reset(skipTempReset){this.prev=0;this.next=0;// Resetting context._sent for legacy support of Babel's
// function.sent implementation.
this.sent=this._sent=undefined;this.done=false;this.delegate=null;this.method="next";this.arg=undefined;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){// Not sure about the optimal order of these conditions:
if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined;}}}},stop:function stop(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg;}return this.rval;},dispatchException:function dispatchException(exception){if(this.done){throw exception;}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;if(caught){// If the dispatched exception was caught by a catch block,
// then let that catch block handle the exception normally.
context.method="next";context.arg=undefined;}return!!caught;}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){// Exception thrown outside of any try block that could handle
// it, so set the completion value of the entire function to
// throw the exception.
return handle("end");}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true);}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc);}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true);}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc);}}else{throw new Error("try statement without catch or finally");}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break;}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){// Ignore the finally entry if control is not jumping to a
// location outside the try/catch block.
finallyEntry=null;}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.method="next";this.next=finallyEntry.finallyLoc;return ContinueSentinel;}return this.complete(record);},complete:function complete(record,afterLoc){if(record.type==="throw"){throw record.arg;}if(record.type==="break"||record.type==="continue"){this.next=record.arg;}else if(record.type==="return"){this.rval=this.arg=record.arg;this.method="return";this.next="end";}else if(record.type==="normal"&&afterLoc){this.next=afterLoc;}return ContinueSentinel;},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel;}}},"catch":function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry);}return thrown;}}// The context.catch method must only be called with a location
// argument that corresponds to a known catch block.
throw new Error("illegal catch attempt");},delegateYield:function delegateYield(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};if(this.method==="next"){// Deliberately forget the last sent value so that we don't
// accidentally pass it on to the delegate.
this.arg=undefined;}return ContinueSentinel;}};// Regardless of whether this script is executing as a CommonJS module
// or not, return the runtime object so that we can declare the variable
// regeneratorRuntime in the outer scope, which allows this module to be
// injected easily by `bin/regenerator --include-runtime script.js`.
return exports;}(// If this script is executing as a CommonJS module, use module.exports
// as the regeneratorRuntime namespace. Otherwise create a new empty
// object. Either way, the resulting object will be used to initialize
// the regeneratorRuntime variable at the top of this file.
(typeof module==="undefined"?"undefined":_typeof2(module))==="object"?module.exports:{});try{regeneratorRuntime=runtime;}catch(accidentalStrictMode){// This module should not be running in strict mode, so the above
// assignment should always work unless something is misconfigured. Just
// in case runtime.js accidentally runs in strict mode, we can escape
// strict mode using a global Function call. This could conceivably fail
// if a Content Security Policy forbids using Function, but in that case
// the proper solution is to fix the accidental strict mode problem. If
// you've misconfigured your bundler to force strict mode and applied a
// CSP to forbid Function, and you're not willing to fix either of those
// problems, please detail your unique predicament in a GitHub issue.
Function("r","regeneratorRuntime = r")(runtime);}/*
* SystemJS v0.21.6 Dev
*/(function(){'use strict';/*
   * Environment
   */var isBrowser=typeof window!=='undefined'&&typeof document!=='undefined';var isNode=typeof process!=='undefined'&&process.versions&&process.versions.node;var isWindows=typeof process!=='undefined'&&typeof process.platform==='string'&&process.platform.match(/^win/);var envGlobal=typeof self!=='undefined'?self:global;/*
   * Simple Symbol() shim
   */var hasSymbol=typeof Symbol!=='undefined';function createSymbol(name){return hasSymbol?Symbol():'@@'+name;}var toStringTag=hasSymbol&&Symbol.toStringTag;/*
   * Environment baseURI
   */var baseURI;// environent baseURI detection
if(typeof document!='undefined'&&document.getElementsByTagName){baseURI=document.baseURI;if(!baseURI){var bases=document.getElementsByTagName('base');baseURI=bases[0]&&bases[0].href||window.location.href;}}else if(typeof location!='undefined'){baseURI=location.href;}// sanitize out the hash and querystring
if(baseURI){baseURI=baseURI.split('#')[0].split('?')[0];var slashIndex=baseURI.lastIndexOf('/');if(slashIndex!==-1)baseURI=baseURI.substr(0,slashIndex+1);}else if(typeof process!=='undefined'&&process.cwd){baseURI='file://'+(isWindows?'/':'')+process.cwd();if(isWindows)baseURI=baseURI.replace(/\\/g,'/');}else{throw new TypeError('No environment baseURI');}// ensure baseURI has trailing "/"
if(baseURI[baseURI.length-1]!=='/')baseURI+='/';/*
   * LoaderError with chaining for loader stacks
   */var errArgs=new Error(0,'_').fileName=='_';function LoaderError__Check_error_message_for_loader_stack(childErr,newMessage){// Convert file:/// URLs to paths in Node
if(!isBrowser)newMessage=newMessage.replace(isWindows?/file:\/\/\//g:/file:\/\//g,'');var message=(childErr.message||childErr)+'\n  '+newMessage;var err;if(errArgs&&childErr.fileName)err=new Error(message,childErr.fileName,childErr.lineNumber);else err=new Error(message);var stack=childErr.originalErr?childErr.originalErr.stack:childErr.stack;if(isNode)// node doesn't show the message otherwise
err.stack=message+'\n  '+stack;else err.stack=stack;err.originalErr=childErr.originalErr||childErr;return err;}/*
   * Optimized URL normalization assuming a syntax-valid URL parent
   */function throwResolveError(relUrl,parentUrl){throw new RangeError('Unable to resolve "'+relUrl+'" to '+parentUrl);}var backslashRegEx=/\\/g;function resolveIfNotPlain(relUrl,parentUrl){if(relUrl[0]===' '||relUrl[relUrl.length-1]===' ')relUrl=relUrl.trim();var parentProtocol=parentUrl&&parentUrl.substr(0,parentUrl.indexOf(':')+1);var firstChar=relUrl[0];var secondChar=relUrl[1];// protocol-relative
if(firstChar==='/'&&secondChar==='/'){if(!parentProtocol)throwResolveError(relUrl,parentUrl);if(relUrl.indexOf('\\')!==-1)relUrl=relUrl.replace(backslashRegEx,'/');return parentProtocol+relUrl;}// relative-url
else if(firstChar==='.'&&(secondChar==='/'||secondChar==='.'&&(relUrl[2]==='/'||relUrl.length===2&&(relUrl+='/'))||relUrl.length===1&&(relUrl+='/'))||firstChar==='/'){if(relUrl.indexOf('\\')!==-1)relUrl=relUrl.replace(backslashRegEx,'/');var parentIsPlain=!parentProtocol||parentUrl[parentProtocol.length]!=='/';// read pathname from parent if a URL
// pathname taken to be part after leading "/"
var pathname;if(parentIsPlain){// resolving to a plain parent -> skip standard URL prefix, and treat entire parent as pathname
if(parentUrl===undefined)throwResolveError(relUrl,parentUrl);pathname=parentUrl;}else if(parentUrl[parentProtocol.length+1]==='/'){// resolving to a :// so we need to read out the auth and host
if(parentProtocol!=='file:'){pathname=parentUrl.substr(parentProtocol.length+2);pathname=pathname.substr(pathname.indexOf('/')+1);}else{pathname=parentUrl.substr(8);}}else{// resolving to :/ so pathname is the /... part
pathname=parentUrl.substr(parentProtocol.length+1);}if(firstChar==='/'){if(parentIsPlain)throwResolveError(relUrl,parentUrl);else return parentUrl.substr(0,parentUrl.length-pathname.length-1)+relUrl;}// join together and split for removal of .. and . segments
// looping the string instead of anything fancy for perf reasons
// '../../../../../z' resolved to 'x/y' is just 'z' regardless of parentIsPlain
var segmented=pathname.substr(0,pathname.lastIndexOf('/')+1)+relUrl;var output=[];var segmentIndex=-1;for(var i=0;i<segmented.length;i++){// busy reading a segment - only terminate on '/'
if(segmentIndex!==-1){if(segmented[i]==='/'){output.push(segmented.substring(segmentIndex,i+1));segmentIndex=-1;}continue;}// new segment - check if it is relative
if(segmented[i]==='.'){// ../ segment
if(segmented[i+1]==='.'&&(segmented[i+2]==='/'||i+2===segmented.length)){output.pop();i+=2;}// ./ segment
else if(segmented[i+1]==='/'||i+1===segmented.length){i+=1;}else{// the start of a new segment as below
segmentIndex=i;continue;}// this is the plain URI backtracking error (../, package:x -> error)
if(parentIsPlain&&output.length===0)throwResolveError(relUrl,parentUrl);continue;}// it is the start of a new segment
segmentIndex=i;}// finish reading out the last segment
if(segmentIndex!==-1)output.push(segmented.substr(segmentIndex));return parentUrl.substr(0,parentUrl.length-pathname.length)+output.join('');}// sanitizes and verifies (by returning undefined if not a valid URL-like form)
// Windows filepath compatibility is an added convenience here
var protocolIndex=relUrl.indexOf(':');if(protocolIndex!==-1){if(isNode){// C:\x becomes file:///c:/x (we don't support C|\x)
if(relUrl[1]===':'&&relUrl[2]==='\\'&&relUrl[0].match(/[a-z]/i))return'file:///'+relUrl.replace(backslashRegEx,'/');}return relUrl;}}var resolvedPromise=Promise.resolve();/*
   * Simple Array values shim
   */function arrayValues(arr){if(arr.values)return arr.values();if(typeof Symbol==='undefined'||!Symbol.iterator)throw new Error('Symbol.iterator not supported in this browser');var iterable={};iterable[Symbol.iterator]=function(){var keys=Object.keys(arr);var keyIndex=0;return{next:function next(){if(keyIndex<keys.length)return{value:arr[keys[keyIndex++]],done:false};else return{value:undefined,done:true};}};};return iterable;}/*
   * 3. Reflect.Loader
   *
   * We skip the entire native internal pipeline, just providing the bare API
   */ // 3.1.1
function Loader(){this.registry=new Registry();}// 3.3.1
Loader.prototype.constructor=Loader;function ensureInstantiated(module){if(module===undefined)return;if(module instanceof ModuleNamespace===false&&module[toStringTag]!=='module')throw new TypeError('Module instantiation did not return a valid namespace object.');return module;}// 3.3.2
Loader.prototype["import"]=function(key,parent){if(typeof key!=='string')throw new TypeError('Loader import method must be passed a module key string');// custom resolveInstantiate combined hook for better perf
var loader=this;return resolvedPromise.then(function(){return loader[RESOLVE_INSTANTIATE](key,parent);}).then(ensureInstantiated)//.then(Module.evaluate)
["catch"](function(err){throw LoaderError__Check_error_message_for_loader_stack(err,'Loading '+key+(parent?' from '+parent:''));});};// 3.3.3
var RESOLVE=Loader.resolve=createSymbol('resolve');/*
   * Combined resolve / instantiate hook
   *
   * Not in current reduced spec, but necessary to separate RESOLVE from RESOLVE + INSTANTIATE as described
   * in the spec notes of this repo to ensure that loader.resolve doesn't instantiate when not wanted.
   *
   * We implement RESOLVE_INSTANTIATE as a single hook instead of a separate INSTANTIATE in order to avoid
   * the need for double registry lookups as a performance optimization.
   */var RESOLVE_INSTANTIATE=Loader.resolveInstantiate=createSymbol('resolveInstantiate');// default resolveInstantiate is just to call resolve and then get from the registry
// this provides compatibility for the resolveInstantiate optimization
Loader.prototype[RESOLVE_INSTANTIATE]=function(key,parent){var loader=this;return loader.resolve(key,parent).then(function(resolved){return loader.registry.get(resolved);});};function ensureResolution(resolvedKey){if(resolvedKey===undefined)throw new RangeError('No resolution found.');return resolvedKey;}Loader.prototype.resolve=function(key,parent){var loader=this;return resolvedPromise.then(function(){return loader[RESOLVE](key,parent);}).then(ensureResolution)["catch"](function(err){throw LoaderError__Check_error_message_for_loader_stack(err,'Resolving '+key+(parent?' to '+parent:''));});};// 3.3.4 (import without evaluate)
// this is not documented because the use of deferred evaluation as in Module.evaluate is not
// documented, as it is not considered a stable feature to be encouraged
// Loader.prototype.load may well be deprecated if this stays disabled
/* Loader.prototype.load = function (key, parent) {
    return Promise.resolve(this[RESOLVE_INSTANTIATE](key, parent || this.key))
    .catch(function (err) {
      throw addToError(err, 'Loading ' + key + (parent ? ' from ' + parent : ''));
    });
  }; */ /*
   * 4. Registry
   *
   * Instead of structuring through a Map, just use a dictionary object
   * We throw for construction attempts so this doesn't affect the public API
   *
   * Registry has been adjusted to use Namespace objects over ModuleStatus objects
   * as part of simplifying loader API implementation
   */var iteratorSupport=typeof Symbol!=='undefined'&&Symbol.iterator;var REGISTRY=createSymbol('registry');function Registry(){this[REGISTRY]={};}// 4.4.1
if(iteratorSupport){// 4.4.2
Registry.prototype[Symbol.iterator]=function(){return this.entries()[Symbol.iterator]();};// 4.4.3
Registry.prototype.entries=function(){var registry=this[REGISTRY];return arrayValues(Object.keys(registry).map(function(key){return[key,registry[key]];}));};}// 4.4.4
Registry.prototype.keys=function(){return arrayValues(Object.keys(this[REGISTRY]));};// 4.4.5
Registry.prototype.values=function(){var registry=this[REGISTRY];return arrayValues(Object.keys(registry).map(function(key){return registry[key];}));};// 4.4.6
Registry.prototype.get=function(key){return this[REGISTRY][key];};// 4.4.7
Registry.prototype.set=function(key,namespace){if(!(namespace instanceof ModuleNamespace||namespace[toStringTag]==='module'))throw new Error('Registry must be set with an instance of Module Namespace');this[REGISTRY][key]=namespace;return this;};// 4.4.8
Registry.prototype.has=function(key){return Object.hasOwnProperty.call(this[REGISTRY],key);};// 4.4.9
Registry.prototype["delete"]=function(key){if(Object.hasOwnProperty.call(this[REGISTRY],key)){delete this[REGISTRY][key];return true;}return false;};/*
   * Simple ModuleNamespace Exotic object based on a baseObject
   * We export this for allowing a fast-path for module namespace creation over Module descriptors
   */ // var EVALUATE = createSymbol('evaluate');
var BASE_OBJECT=createSymbol('baseObject');// 8.3.1 Reflect.Module
/*
   * Best-effort simplified non-spec implementation based on
   * a baseObject referenced via getters.
   *
   * Allows:
   *
   *   loader.registry.set('x', new Module({ default: 'x' }));
   *
   * Optional evaluation function provides experimental Module.evaluate
   * support for non-executed modules in registry.
   */function ModuleNamespace(baseObject/*, evaluate*/){Object.defineProperty(this,BASE_OBJECT,{value:baseObject});// evaluate defers namespace population
/* if (evaluate) {
      Object.defineProperty(this, EVALUATE, {
        value: evaluate,
        configurable: true,
        writable: true
      });
    }
    else { */Object.keys(baseObject).forEach(extendNamespace,this);//}
}// 8.4.2
ModuleNamespace.prototype=Object.create(null);if(toStringTag)Object.defineProperty(ModuleNamespace.prototype,toStringTag,{value:'Module'});function extendNamespace(key){Object.defineProperty(this,key,{enumerable:true,get:function get(){return this[BASE_OBJECT][key];}});}/* function doEvaluate (evaluate, context) {
    try {
      evaluate.call(context);
    }
    catch (e) {
      return e;
    }
  }

  // 8.4.1 Module.evaluate... not documented or used because this is potentially unstable
  Module.evaluate = function (ns) {
    var evaluate = ns[EVALUATE];
    if (evaluate) {
      ns[EVALUATE] = undefined;
      var err = doEvaluate(evaluate);
      if (err) {
        // cache the error
        ns[EVALUATE] = function () {
          throw err;
        };
        throw err;
      }
      Object.keys(ns[BASE_OBJECT]).forEach(extendNamespace, ns);
    }
    // make chainable
    return ns;
  }; */var resolvedPromise$1=Promise.resolve();/*
   * Register Loader
   *
   * Builds directly on top of loader polyfill to provide:
   * - loader.register support
   * - hookable higher-level resolve
   * - instantiate hook returning a ModuleNamespace or undefined for es module loading
   * - loader error behaviour as in HTML and loader specs, caching load and eval errors separately
   * - build tracing support by providing a .trace=true and .loads object format
   */var REGISTER_INTERNAL=createSymbol('register-internal');function RegisterLoader(){Loader.call(this);var registryDelete=this.registry["delete"];this.registry["delete"]=function(key){var deleted=registryDelete.call(this,key);// also delete from register registry if linked
if(records.hasOwnProperty(key)&&!records[key].linkRecord){delete records[key];deleted=true;}return deleted;};var records={};this[REGISTER_INTERNAL]={// last anonymous System.register call
lastRegister:undefined,// in-flight es module load records
records:records};// tracing
this.trace=false;}RegisterLoader.prototype=Object.create(Loader.prototype);RegisterLoader.prototype.constructor=RegisterLoader;var INSTANTIATE=RegisterLoader.instantiate=createSymbol('instantiate');// default normalize is the WhatWG style normalizer
RegisterLoader.prototype[RegisterLoader.resolve=Loader.resolve]=function(key,parentKey){return resolveIfNotPlain(key,parentKey||baseURI);};RegisterLoader.prototype[INSTANTIATE]=function(key,processAnonRegister){};// once evaluated, the linkRecord is set to undefined leaving just the other load record properties
// this allows tracking new binding listeners for es modules through importerSetters
// for dynamic modules, the load record is removed entirely.
function createLoadRecord(state,key,registration){return state.records[key]={key:key,// defined System.register cache
registration:registration,// module namespace object
module:undefined,// es-only
// this sticks around so new module loads can listen to binding changes
// for already-loaded modules by adding themselves to their importerSetters
importerSetters:undefined,loadError:undefined,evalError:undefined,// in-flight linking record
linkRecord:{// promise for instantiated
instantiatePromise:undefined,dependencies:undefined,execute:undefined,executingRequire:false,// underlying module object bindings
moduleObj:undefined,// es only, also indicates if es or not
setters:undefined,// promise for instantiated dependencies (dependencyInstantiations populated)
depsInstantiatePromise:undefined,// will be the array of dependency load record or a module namespace
dependencyInstantiations:undefined,// top-level await!
evaluatePromise:undefined// NB optimization and way of ensuring module objects in setters
// indicates setters which should run pre-execution of that dependency
// setters is then just for completely executed module objects
// alternatively we just pass the partially filled module objects as
// arguments into the execute function
// hoisted: undefined
}};}RegisterLoader.prototype[Loader.resolveInstantiate]=function(key,parentKey){var loader=this;var state=this[REGISTER_INTERNAL];var registry=this.registry[REGISTRY];return resolveInstantiate(loader,key,parentKey,registry,state).then(function(instantiated){if(instantiated instanceof ModuleNamespace||instantiated[toStringTag]==='module')return instantiated;// resolveInstantiate always returns a load record with a link record and no module value
var link=instantiated.linkRecord;// if already beaten to done, return
if(!link){if(instantiated.module)return instantiated.module;throw instantiated.evalError;}return deepInstantiateDeps(loader,instantiated,link,registry,state).then(function(){return ensureEvaluate(loader,instantiated,link,registry,state);});});};function resolveInstantiate(loader,key,parentKey,registry,state){// normalization shortpath for already-normalized key
// could add a plain name filter, but doesn't yet seem necessary for perf
var module=registry[key];if(module)return Promise.resolve(module);var load=state.records[key];// already linked but not in main registry is ignored
if(load&&!load.module){if(load.loadError)return Promise.reject(load.loadError);return instantiate(loader,load,load.linkRecord,registry,state);}return loader.resolve(key,parentKey).then(function(resolvedKey){// main loader registry always takes preference
module=registry[resolvedKey];if(module)return module;load=state.records[resolvedKey];// already has a module value but not already in the registry (load.module)
// means it was removed by registry.delete, so we should
// disgard the current load record creating a new one over it
// but keep any existing registration
if(!load||load.module)load=createLoadRecord(state,resolvedKey,load&&load.registration);if(load.loadError)return Promise.reject(load.loadError);var link=load.linkRecord;if(!link)return load;return instantiate(loader,load,link,registry,state);});}function createProcessAnonRegister(loader,load,state){return function(){var lastRegister=state.lastRegister;if(!lastRegister)return!!load.registration;state.lastRegister=undefined;load.registration=lastRegister;return true;};}function instantiate(loader,load,link,registry,state){return link.instantiatePromise||(link.instantiatePromise=// if there is already an existing registration, skip running instantiate
(load.registration?resolvedPromise$1:resolvedPromise$1.then(function(){state.lastRegister=undefined;return loader[INSTANTIATE](load.key,loader[INSTANTIATE].length>1&&createProcessAnonRegister(loader,load,state));})).then(function(instantiation){// direct module return from instantiate -> we're done
if(instantiation!==undefined){if(!(instantiation instanceof ModuleNamespace||instantiation[toStringTag]==='module'))throw new TypeError('Instantiate did not return a valid Module object.');delete state.records[load.key];if(loader.trace)traceLoad(loader,load,link);return registry[load.key]=instantiation;}// run the cached loader.register declaration if there is one
var registration=load.registration;// clear to allow new registrations for future loads (combined with registry delete)
load.registration=undefined;if(!registration)throw new TypeError('Module instantiation did not call an anonymous or correctly named System.register.');link.dependencies=registration[0];load.importerSetters=[];link.moduleObj={};// process System.registerDynamic declaration
if(registration[2]){link.moduleObj["default"]=link.moduleObj.__useDefault={};link.executingRequire=registration[1];link.execute=registration[2];}// process System.register declaration
else{registerDeclarative(loader,load,link,registration[1]);}return load;})["catch"](function(err){load.linkRecord=undefined;throw load.loadError=load.loadError||LoaderError__Check_error_message_for_loader_stack(err,'Instantiating '+load.key);}));}// like resolveInstantiate, but returning load records for linking
function resolveInstantiateDep(loader,key,parentKey,registry,state,traceDepMap){// normalization shortpaths for already-normalized key
// DISABLED to prioritise consistent resolver calls
// could add a plain name filter, but doesn't yet seem necessary for perf
/* var load = state.records[key];
    var module = registry[key];

    if (module) {
      if (traceDepMap)
        traceDepMap[key] = key;

      // registry authority check in case module was deleted or replaced in main registry
      if (load && load.module && load.module === module)
        return load;
      else
        return module;
    }

    // already linked but not in main registry is ignored
    if (load && !load.module) {
      if (traceDepMap)
        traceDepMap[key] = key;
      return instantiate(loader, load, load.linkRecord, registry, state);
    } */return loader.resolve(key,parentKey).then(function(resolvedKey){if(traceDepMap)traceDepMap[key]=resolvedKey;// normalization shortpaths for already-normalized key
var load=state.records[resolvedKey];var module=registry[resolvedKey];// main loader registry always takes preference
if(module&&(!load||load.module&&module!==load.module))return module;if(load&&load.loadError)throw load.loadError;// already has a module value but not already in the registry (load.module)
// means it was removed by registry.delete, so we should
// disgard the current load record creating a new one over it
// but keep any existing registration
if(!load||!module&&load.module)load=createLoadRecord(state,resolvedKey,load&&load.registration);var link=load.linkRecord;if(!link)return load;return instantiate(loader,load,link,registry,state);});}function traceLoad(loader,load,link){loader.loads=loader.loads||{};loader.loads[load.key]={key:load.key,deps:link.dependencies,dynamicDeps:[],depMap:link.depMap||{}};}/*
   * Convert a CJS module.exports into a valid object for new Module:
   *
   *   new Module(getEsModule(module.exports))
   *
   * Sets the default value to the module, while also reading off named exports carefully.
   */function registerDeclarative(loader,load,link,declare){var moduleObj=link.moduleObj;var importerSetters=load.importerSetters;var definedExports=false;// closure especially not based on link to allow link record disposal
var declared=declare.call(envGlobal,function(name,value){if(_typeof2(name)==='object'){var changed=false;for(var p in name){value=name[p];if(p!=='__useDefault'&&(!(p in moduleObj)||moduleObj[p]!==value)){changed=true;moduleObj[p]=value;}}if(changed===false)return value;}else{if((definedExports||name in moduleObj)&&moduleObj[name]===value)return value;moduleObj[name]=value;}for(var i=0;i<importerSetters.length;i++){importerSetters[i](moduleObj);}return value;},new ContextualLoader(loader,load.key));link.setters=declared.setters||[];link.execute=declared.execute;if(declared.exports){link.moduleObj=moduleObj=declared.exports;definedExports=true;}}function instantiateDeps(loader,load,link,registry,state){if(link.depsInstantiatePromise)return link.depsInstantiatePromise;var depsInstantiatePromises=Array(link.dependencies.length);for(var i=0;i<link.dependencies.length;i++){depsInstantiatePromises[i]=resolveInstantiateDep(loader,link.dependencies[i],load.key,registry,state,loader.trace&&link.depMap||(link.depMap={}));}var depsInstantiatePromise=Promise.all(depsInstantiatePromises).then(function(dependencyInstantiations){link.dependencyInstantiations=dependencyInstantiations;// run setters to set up bindings to instantiated dependencies
if(link.setters){for(var i=0;i<dependencyInstantiations.length;i++){var setter=link.setters[i];if(setter){var instantiation=dependencyInstantiations[i];if(instantiation instanceof ModuleNamespace||instantiation[toStringTag]==='module'){setter(instantiation);}else{if(instantiation.loadError)throw instantiation.loadError;setter(instantiation.module||instantiation.linkRecord.moduleObj);// this applies to both es and dynamic registrations
if(instantiation.importerSetters)instantiation.importerSetters.push(setter);}}}}return load;});if(loader.trace)depsInstantiatePromise=depsInstantiatePromise.then(function(){traceLoad(loader,load,link);return load;});depsInstantiatePromise=depsInstantiatePromise["catch"](function(err){// throw up the instantiateDeps stack
link.depsInstantiatePromise=undefined;throw LoaderError__Check_error_message_for_loader_stack(err,'Loading '+load.key);});depsInstantiatePromise["catch"](function(){});return link.depsInstantiatePromise=depsInstantiatePromise;}function deepInstantiateDeps(loader,load,link,registry,state){var seen=[];function addDeps(load,link){if(!link)return resolvedPromise$1;if(seen.indexOf(load)!==-1)return resolvedPromise$1;seen.push(load);return instantiateDeps(loader,load,link,registry,state).then(function(){var depPromises;for(var i=0;i<link.dependencies.length;i++){var depLoad=link.dependencyInstantiations[i];if(!(depLoad instanceof ModuleNamespace||depLoad[toStringTag]==='module')){depPromises=depPromises||[];depPromises.push(addDeps(depLoad,depLoad.linkRecord));}}if(depPromises)return Promise.all(depPromises);});}return addDeps(load,link);}/*
   * System.register
   */RegisterLoader.prototype.register=function(key,deps,declare){var state=this[REGISTER_INTERNAL];// anonymous modules get stored as lastAnon
if(declare===undefined){state.lastRegister=[key,deps,undefined];}// everything else registers into the register cache
else{var load=state.records[key]||createLoadRecord(state,key,undefined);load.registration=[deps,declare,undefined];}};/*
   * System.registerDyanmic
   */RegisterLoader.prototype.registerDynamic=function(key,deps,executingRequire,execute){var state=this[REGISTER_INTERNAL];// anonymous modules get stored as lastAnon
if(typeof key!=='string'){state.lastRegister=[key,deps,executingRequire];}// everything else registers into the register cache
else{var load=state.records[key]||createLoadRecord(state,key,undefined);load.registration=[deps,executingRequire,execute];}};// ContextualLoader class
// backwards-compatible with previous System.register context argument by exposing .id, .key
function ContextualLoader(loader,key){this.loader=loader;this.key=this.id=key;this.meta={url:key// scriptElement: null
};}/*ContextualLoader.prototype.constructor = function () {
    throw new TypeError('Cannot subclass the contextual loader only Reflect.Loader.');
  };*/ContextualLoader.prototype["import"]=function(key){if(this.loader.trace)this.loader.loads[this.key].dynamicDeps.push(key);return this.loader["import"](key,this.key);};/*ContextualLoader.prototype.resolve = function (key) {
    return this.loader.resolve(key, this.key);
  };*/function ensureEvaluate(loader,load,link,registry,state){if(load.module)return load.module;if(load.evalError)throw load.evalError;if(link.evaluatePromise)return link.evaluatePromise;if(link.setters){var evaluatePromise=doEvaluateDeclarative(loader,load,link,registry,state,[load]);if(evaluatePromise)return evaluatePromise;}else{doEvaluateDynamic(loader,load,link,registry,state,[load]);}return load.module;}function makeDynamicRequire(loader,key,dependencies,dependencyInstantiations,registry,state,seen){// we can only require from already-known dependencies
return function(name){for(var i=0;i<dependencies.length;i++){if(dependencies[i]===name){var depLoad=dependencyInstantiations[i];var module;if(depLoad instanceof ModuleNamespace||depLoad[toStringTag]==='module'){module=depLoad;}else{if(depLoad.evalError)throw depLoad.evalError;if(depLoad.module===undefined&&seen.indexOf(depLoad)===-1&&!depLoad.linkRecord.evaluatePromise){if(depLoad.linkRecord.setters){doEvaluateDeclarative(loader,depLoad,depLoad.linkRecord,registry,state,[depLoad]);}else{seen.push(depLoad);doEvaluateDynamic(loader,depLoad,depLoad.linkRecord,registry,state,seen);}}module=depLoad.module||depLoad.linkRecord.moduleObj;}return'__useDefault'in module?module.__useDefault:module;}}throw new Error('Module '+name+' not declared as a System.registerDynamic dependency of '+key);};}function evalError(load,err){load.linkRecord=undefined;var evalError=LoaderError__Check_error_message_for_loader_stack(err,'Evaluating '+load.key);if(load.evalError===undefined)load.evalError=evalError;throw evalError;}// es modules evaluate dependencies first
// returns the error if any
function doEvaluateDeclarative(loader,load,link,registry,state,seen){var depLoad,depLink;var depLoadPromises;for(var i=0;i<link.dependencies.length;i++){var depLoad=link.dependencyInstantiations[i];if(depLoad instanceof ModuleNamespace||depLoad[toStringTag]==='module')continue;// custom Module returned from instantiate
depLink=depLoad.linkRecord;if(depLink){if(depLoad.evalError){evalError(load,depLoad.evalError);}else if(depLink.setters){if(seen.indexOf(depLoad)===-1){seen.push(depLoad);try{var depLoadPromise=doEvaluateDeclarative(loader,depLoad,depLink,registry,state,seen);}catch(e){evalError(load,e);}if(depLoadPromise){depLoadPromises=depLoadPromises||[];depLoadPromises.push(depLoadPromise["catch"](function(err){evalError(load,err);}));}}}else{try{doEvaluateDynamic(loader,depLoad,depLink,registry,state,[depLoad]);}catch(e){evalError(load,e);}}}}if(depLoadPromises)return link.evaluatePromise=Promise.all(depLoadPromises).then(function(){if(link.execute){// ES System.register execute
// "this" is null in ES
try{var execPromise=link.execute.call(nullContext);}catch(e){evalError(load,e);}if(execPromise)return execPromise["catch"](function(e){evalError(load,e);}).then(function(){load.linkRecord=undefined;return registry[load.key]=load.module=new ModuleNamespace(link.moduleObj);});}// dispose link record
load.linkRecord=undefined;registry[load.key]=load.module=new ModuleNamespace(link.moduleObj);});if(link.execute){// ES System.register execute
// "this" is null in ES
try{var execPromise=link.execute.call(nullContext);}catch(e){evalError(load,e);}if(execPromise)return link.evaluatePromise=execPromise["catch"](function(e){evalError(load,e);}).then(function(){load.linkRecord=undefined;return registry[load.key]=load.module=new ModuleNamespace(link.moduleObj);});}// dispose link record
load.linkRecord=undefined;registry[load.key]=load.module=new ModuleNamespace(link.moduleObj);}// non es modules explicitly call moduleEvaluate through require
function doEvaluateDynamic(loader,load,link,registry,state,seen){// System.registerDynamic execute
// "this" is "exports" in CJS
var module={id:load.key};var moduleObj=link.moduleObj;Object.defineProperty(module,'exports',{configurable:true,set:function set(exports){moduleObj["default"]=moduleObj.__useDefault=exports;},get:function get(){return moduleObj.__useDefault;}});var require=makeDynamicRequire(loader,load.key,link.dependencies,link.dependencyInstantiations,registry,state,seen);// evaluate deps first
if(!link.executingRequire)for(var i=0;i<link.dependencies.length;i++){require(link.dependencies[i]);}try{var output=link.execute.call(envGlobal,require,moduleObj["default"],module);if(output!==undefined)module.exports=output;}catch(e){evalError(load,e);}load.linkRecord=undefined;// pick up defineProperty calls to module.exports when we can
if(module.exports!==moduleObj.__useDefault)moduleObj["default"]=moduleObj.__useDefault=module.exports;var moduleDefault=moduleObj["default"];// __esModule flag extension support via lifting
if(moduleDefault&&moduleDefault.__esModule){for(var p in moduleDefault){if(Object.hasOwnProperty.call(moduleDefault,p))moduleObj[p]=moduleDefault[p];}}registry[load.key]=load.module=new ModuleNamespace(link.moduleObj);// run importer setters and clear them
// this allows dynamic modules to update themselves into es modules
// as soon as execution has completed
if(load.importerSetters)for(var i=0;i<load.importerSetters.length;i++){load.importerSetters[i](load.module);}load.importerSetters=undefined;}// the closest we can get to call(undefined)
var nullContext=Object.create(null);if(Object.freeze)Object.freeze(nullContext);var resolvedPromise$2=Promise.resolve();function noop(){}var emptyModule=new ModuleNamespace({});function protectedCreateNamespace(bindings){if(bindings){if(bindings instanceof ModuleNamespace||bindings[toStringTag]==='module')return bindings;if(bindings.__esModule)return new ModuleNamespace(bindings);}return new ModuleNamespace({"default":bindings,__useDefault:bindings});}function isModule(m){return m instanceof ModuleNamespace||m[toStringTag]==='module';}var CONFIG=createSymbol('loader-config');var METADATA=createSymbol('metadata');var isWorker=typeof window==='undefined'&&typeof self!=='undefined'&&typeof importScripts!=='undefined';function warn(msg,force){if(force||this.warnings&&typeof console!=='undefined'&&console.warn)console.warn(msg);}function checkInstantiateWasm(loader,wasmBuffer,processAnonRegister){var bytes=new Uint8Array(wasmBuffer);// detect by leading bytes
// Can be (new Uint32Array(fetched))[0] === 0x6D736100 when working in Node
if(bytes[0]===0&&bytes[1]===97&&bytes[2]===115){return WebAssembly.compile(wasmBuffer).then(function(m){var deps=[];var setters=[];var importObj={};// we can only set imports if supported (eg Safari doesnt support)
if(WebAssembly.Module.imports)WebAssembly.Module.imports(m).forEach(function(i){var key=i.module;setters.push(function(m){importObj[key]=m;});if(deps.indexOf(key)===-1)deps.push(key);});loader.register(deps,function(_export){return{setters:setters,execute:function execute(){_export(new WebAssembly.Instance(m,importObj).exports);}};});processAnonRegister();return true;});}return Promise.resolve(false);}var parentModuleContext;function loadNodeModule(key,baseURL){if(key[0]==='.')throw new Error('Node module '+key+' can\'t be loaded as it is not a package require.');if(!parentModuleContext){var Module=this._nodeRequire('module');var base=decodeURI(baseURL.substr(isWindows?8:7));parentModuleContext=new Module(base);parentModuleContext.paths=Module._nodeModulePaths(base);}return parentModuleContext.require(key);}function extend(a,b){for(var p in b){if(!Object.hasOwnProperty.call(b,p))continue;a[p]=b[p];}return a;}function prepend(a,b){for(var p in b){if(!Object.hasOwnProperty.call(b,p))continue;if(a[p]===undefined)a[p]=b[p];}return a;}// meta first-level extends where:
// array + array appends
// object + object extends
// other properties replace
function extendMeta(a,b,_prepend){for(var p in b){if(!Object.hasOwnProperty.call(b,p))continue;var val=b[p];if(a[p]===undefined)a[p]=val;else if(val instanceof Array&&a[p]instanceof Array)a[p]=[].concat(_prepend?val:a[p]).concat(_prepend?a[p]:val);else if(_typeof2(val)=='object'&&val!==null&&_typeof2(a[p])=='object')a[p]=(_prepend?prepend:extend)(extend({},a[p]),val);else if(!_prepend)a[p]=val;}}var supportsPreload=false,supportsPrefetch=false;if(isBrowser)(function(){var relList=document.createElement('link').relList;if(relList&&relList.supports){supportsPrefetch=true;try{supportsPreload=relList.supports('preload');}catch(e){}}})();function preloadScript(url){// fallback to old fashioned image technique which still works in safari
if(!supportsPreload&&!supportsPrefetch){var preloadImage=new Image();preloadImage.src=url;return;}var link=document.createElement('link');if(supportsPreload){link.rel='preload';link.as='script';}else{// this works for all except Safari (detected by relList.supports lacking)
link.rel='prefetch';}link.href=url;document.head.appendChild(link);}function workerImport(src,resolve,reject){try{importScripts(src);}catch(e){reject(e);}resolve();}if(isBrowser){var onerror=window.onerror;window.onerror=function globalOnerror(msg,src){if(onerror)onerror.apply(this,arguments);};}function scriptLoad(src,crossOrigin,integrity,resolve,reject){// percent encode just "#" for HTTP requests
src=src.replace(/#/g,'%23');// subresource integrity is not supported in web workers
if(isWorker)return workerImport(src,resolve,reject);var script=document.createElement('script');script.type='text/javascript';script.charset='utf-8';script.async=true;if(crossOrigin)script.crossOrigin=crossOrigin;if(integrity)script.integrity=integrity;script.addEventListener('load',load,false);script.addEventListener('error',error,false);script.src=src;document.head.appendChild(script);function load(){resolve();cleanup();}// note this does not catch execution errors
function error(err){cleanup();reject(new Error('Fetching '+src));}function cleanup(){script.removeEventListener('load',load,false);script.removeEventListener('error',error,false);document.head.removeChild(script);}}function readMemberExpression(p,value){var pParts=p.split('.');while(pParts.length){value=value[pParts.shift()];}return value;}// separate out paths cache as a baseURL lock process
function applyPaths(baseURL,paths,key){var mapMatch=getMapMatch(paths,key);if(mapMatch){var target=paths[mapMatch]+key.substr(mapMatch.length);var resolved=resolveIfNotPlain(target,baseURI);if(resolved!==undefined)return resolved;return baseURL+target;}else if(key.indexOf(':')!==-1){return key;}else{return baseURL+key;}}function checkMap(p){var name=this.name;// can add ':' here if we want paths to match the behaviour of map
if(name.substr(0,p.length)===p&&(name.length===p.length||name[p.length]==='/'||p[p.length-1]==='/'||p[p.length-1]===':')){var curLen=p.split('/').length;if(curLen>this.len){this.match=p;this.len=curLen;}}}function getMapMatch(map,name){if(Object.hasOwnProperty.call(map,name))return name;var bestMatch={name:name,match:undefined,len:0};Object.keys(map).forEach(checkMap,bestMatch);return bestMatch.match;}// RegEx adjusted from https://github.com/jbrantly/yabble/blob/master/lib/yabble.js#L339
var cjsRequireRegEx=/(?:^\uFEFF?|[^$_a-zA-Z\xA0-\uFFFF."'])require\s*\(\s*("[^"\\]*(?:\\.[^"\\]*)*"|'[^'\\]*(?:\\.[^'\\]*)*'|`[^`\\]*(?:\\.[^`\\]*)*`)\s*\)/g;/*
   * Source loading
   */function fetchFetch(url,authorization,integrity,asBuffer){// fetch doesn't support file:/// urls
if(url.substr(0,8)==='file:///'){if(hasXhr)return xhrFetch(url,authorization,integrity,asBuffer);else throw new Error('Unable to fetch file URLs in this environment.');}// percent encode just "#" for HTTP requests
url=url.replace(/#/g,'%23');var opts={// NB deprecate
headers:{Accept:'application/x-es-module, */*'}};if(integrity)opts.integrity=integrity;if(authorization){if(typeof authorization=='string')opts.headers['Authorization']=authorization;opts.credentials='include';}return fetch(url,opts).then(function(res){if(res.ok)return asBuffer?res.arrayBuffer():res.text();else throw new Error('Fetch error: '+res.status+' '+res.statusText);});}function xhrFetch(url,authorization,integrity,asBuffer){return new Promise(function(resolve,reject){// percent encode just "#" for HTTP requests
url=url.replace(/#/g,'%23');var xhr=new XMLHttpRequest();if(asBuffer)xhr.responseType='arraybuffer';function load(){resolve(asBuffer?xhr.response:xhr.responseText);}function error(){reject(new Error('XHR error: '+(xhr.status?' ('+xhr.status+(xhr.statusText?' '+xhr.statusText:'')+')':'')+' loading '+url));}xhr.onreadystatechange=function(){if(xhr.readyState===4){// in Chrome on file:/// URLs, status is 0
if(xhr.status==0){if(xhr.response){load();}else{// when responseText is empty, wait for load or error event
// to inform if it is a 404 or empty file
xhr.addEventListener('error',error);xhr.addEventListener('load',load);}}else if(xhr.status===200){load();}else{error();}}};xhr.open("GET",url,true);if(xhr.setRequestHeader){xhr.setRequestHeader('Accept','application/x-es-module, */*');// can set "authorization: true" to enable withCredentials only
if(authorization){if(typeof authorization=='string')xhr.setRequestHeader('Authorization',authorization);xhr.withCredentials=true;}}xhr.send(null);});}var fs;function nodeFetch(url,authorization,integrity,asBuffer){if(url.substr(0,8)!='file:///'){if(hasFetch)return fetchFetch(url,authorization,integrity,asBuffer);else return Promise.reject(new Error('Unable to fetch "'+url+'". Only file URLs of the form file:/// supported running in Node without fetch.'));}fs=fs||require('fs');if(isWindows)url=url.replace(/\//g,'\\').substr(8);else url=url.substr(7);return new Promise(function(resolve,reject){fs.readFile(url,function(err,data){if(err){return reject(err);}else{if(asBuffer){resolve(data);}else{// Strip Byte Order Mark out if it's the leading char
var dataString=data+'';if(dataString[0]==="\uFEFF")dataString=dataString.substr(1);resolve(dataString);}}});});}function noFetch(){throw new Error('No fetch method is defined for this environment.');}var fetchFunction;var hasXhr=typeof XMLHttpRequest!=='undefined';var hasFetch=typeof fetch!=='undefined';if(typeof self!=='undefined'&&typeof self.fetch!=='undefined')fetchFunction=fetchFetch;else if(hasXhr)fetchFunction=xhrFetch;else if(typeof require!=='undefined'&&typeof process!=='undefined')fetchFunction=nodeFetch;else fetchFunction=noFetch;var fetch$1=fetchFunction;function createMetadata(){return{pluginKey:undefined,pluginArgument:undefined,pluginModule:undefined,packageKey:undefined,packageConfig:undefined,load:undefined};}function getParentMetadata(loader,config,parentKey){var parentMetadata=createMetadata();if(parentKey){// detect parent plugin
// we just need pluginKey to be truthy for package configurations
// so we duplicate it as pluginArgument - although not correct its not used
var parentPluginIndex;if(config.pluginFirst){if((parentPluginIndex=parentKey.lastIndexOf('!'))!==-1)parentMetadata.pluginArgument=parentMetadata.pluginKey=parentKey.substr(0,parentPluginIndex);}else{if((parentPluginIndex=parentKey.indexOf('!'))!==-1)parentMetadata.pluginArgument=parentMetadata.pluginKey=parentKey.substr(parentPluginIndex+1);}// detect parent package
parentMetadata.packageKey=getMapMatch(config.packages,parentKey);if(parentMetadata.packageKey)parentMetadata.packageConfig=config.packages[parentMetadata.packageKey];}return parentMetadata;}function normalize(key,parentKey){var config=this[CONFIG];var metadata=createMetadata();var parentMetadata=getParentMetadata(this,config,parentKey);var loader=this;return Promise.resolve()// boolean conditional
.then(function(){// first we normalize the conditional
var booleanIndex=key.lastIndexOf('#?');if(booleanIndex===-1)return Promise.resolve(key);var conditionObj=parseCondition.call(loader,key.substr(booleanIndex+2));// in builds, return normalized conditional
/*if (this.builder)
        return this.resolve(conditionObj.module, parentKey)
        .then(function (conditionModule) {
          conditionObj.module = conditionModule;
          return key.substr(0, booleanIndex) + '#?' + serializeCondition(conditionObj);
        });*/return resolveCondition.call(loader,conditionObj,parentKey,true).then(function(conditionValue){return conditionValue?key.substr(0,booleanIndex):'@empty';});})// plugin
.then(function(key){var parsed=parsePlugin(config.pluginFirst,key);if(!parsed)return packageResolve.call(loader,config,key,parentMetadata&&parentMetadata.pluginArgument||parentKey,metadata,parentMetadata,false);metadata.pluginKey=parsed.plugin;return Promise.all([packageResolve.call(loader,config,parsed.argument,parentMetadata&&parentMetadata.pluginArgument||parentKey,metadata,parentMetadata,true),loader.resolve(parsed.plugin,parentKey)]).then(function(normalized){metadata.pluginArgument=normalized[0];metadata.pluginKey=normalized[1];// don't allow a plugin to load itself
if(metadata.pluginArgument===metadata.pluginKey)throw new Error('Plugin '+metadata.pluginArgument+' cannot load itself, make sure it is excluded from any wildcard meta configuration via a custom loader: false rule.');return combinePluginParts(config.pluginFirst,normalized[0],normalized[1]);});}).then(function(normalized){return interpolateConditional.call(loader,normalized,parentKey,parentMetadata);}).then(function(normalized){setMeta.call(loader,config,normalized,metadata);if(metadata.pluginKey||!metadata.load.loader)return normalized;// loader by configuration
// normalizes to parent to support package loaders
return loader.resolve(metadata.load.loader,normalized).then(function(pluginKey){metadata.pluginKey=pluginKey;metadata.pluginArgument=normalized;return normalized;});}).then(function(normalized){loader[METADATA][normalized]=metadata;return normalized;});}// normalization function used for registry keys
// just does coreResolve without map
function decanonicalize(config,key){var parsed=parsePlugin(config.pluginFirst,key);// plugin
if(parsed){var pluginKey=decanonicalize.call(this,config,parsed.plugin);return combinePluginParts(config.pluginFirst,coreResolve.call(this,config,parsed.argument,undefined,false,false),pluginKey);}return coreResolve.call(this,config,key,undefined,false,false);}function normalizeSync(key,parentKey){var config=this[CONFIG];// normalizeSync is metadataless, so create metadata
var metadata=createMetadata();var parentMetadata=parentMetadata||getParentMetadata(this,config,parentKey);var parsed=parsePlugin(config.pluginFirst,key);// plugin
if(parsed){metadata.pluginKey=normalizeSync.call(this,parsed.plugin,parentKey);return combinePluginParts(config.pluginFirst,packageResolveSync.call(this,config,parsed.argument,parentMetadata.pluginArgument||parentKey,metadata,parentMetadata,!!metadata.pluginKey),metadata.pluginKey);}return packageResolveSync.call(this,config,key,parentMetadata.pluginArgument||parentKey,metadata,parentMetadata,!!metadata.pluginKey);}function coreResolve(config,key,parentKey,doMap,packageName){var relativeResolved=resolveIfNotPlain(key,parentKey||baseURI);// standard URL resolution
if(relativeResolved)return applyPaths(config.baseURL,config.paths,relativeResolved);// plain keys not starting with './', 'x://' and '/' go through custom resolution
if(doMap){var mapMatch=getMapMatch(config.map,key);if(mapMatch){key=config.map[mapMatch]+key.substr(mapMatch.length);relativeResolved=resolveIfNotPlain(key,baseURI);if(relativeResolved)return applyPaths(config.baseURL,config.paths,relativeResolved);}}if(this.registry.has(key))return key;if(key.substr(0,6)==='@node/')return key;var trailingSlash=packageName&&key[key.length-1]!=='/';var resolved=applyPaths(config.baseURL,config.paths,trailingSlash?key+'/':key);if(trailingSlash)return resolved.substr(0,resolved.length-1);return resolved;}function packageResolveSync(config,key,parentKey,metadata,parentMetadata,skipExtensions){// ignore . since internal maps handled by standard package resolution
if(parentMetadata&&parentMetadata.packageConfig&&key[0]!=='.'){var parentMap=parentMetadata.packageConfig.map;var parentMapMatch=parentMap&&getMapMatch(parentMap,key);if(parentMapMatch&&typeof parentMap[parentMapMatch]==='string'){var mapped=doMapSync(this,config,parentMetadata.packageConfig,parentMetadata.packageKey,parentMapMatch,key,metadata,skipExtensions);if(mapped)return mapped;}}var normalized=coreResolve.call(this,config,key,parentKey,true,true);var pkgConfigMatch=getPackageConfigMatch(config,normalized);metadata.packageKey=pkgConfigMatch&&pkgConfigMatch.packageKey||getMapMatch(config.packages,normalized);if(!metadata.packageKey)return normalized;if(config.packageConfigKeys.indexOf(normalized)!==-1){metadata.packageKey=undefined;return normalized;}metadata.packageConfig=config.packages[metadata.packageKey]||(config.packages[metadata.packageKey]=createPackage());var subPath=normalized.substr(metadata.packageKey.length+1);return applyPackageConfigSync(this,config,metadata.packageConfig,metadata.packageKey,subPath,metadata,skipExtensions);}function packageResolve(config,key,parentKey,metadata,parentMetadata,skipExtensions){var loader=this;return resolvedPromise$2.then(function(){// ignore . since internal maps handled by standard package resolution
if(parentMetadata&&parentMetadata.packageConfig&&key.substr(0,2)!=='./'){var parentMap=parentMetadata.packageConfig.map;var parentMapMatch=parentMap&&getMapMatch(parentMap,key);if(parentMapMatch)return doMap(loader,config,parentMetadata.packageConfig,parentMetadata.packageKey,parentMapMatch,key,metadata,skipExtensions);}return resolvedPromise$2;}).then(function(mapped){if(mapped)return mapped;// apply map, core, paths, contextual package map
var normalized=coreResolve.call(loader,config,key,parentKey,true,true);var pkgConfigMatch=getPackageConfigMatch(config,normalized);metadata.packageKey=pkgConfigMatch&&pkgConfigMatch.packageKey||getMapMatch(config.packages,normalized);if(!metadata.packageKey)return Promise.resolve(normalized);if(config.packageConfigKeys.indexOf(normalized)!==-1){metadata.packageKey=undefined;metadata.load=createMeta();metadata.load.format='json';// ensure no loader
metadata.load.loader='';return Promise.resolve(normalized);}metadata.packageConfig=config.packages[metadata.packageKey]||(config.packages[metadata.packageKey]=createPackage());// load configuration when it matches packageConfigPaths, not already configured, and not the config itself
var loadConfig=pkgConfigMatch&&!metadata.packageConfig.configured;return(loadConfig?loadPackageConfigPath(loader,config,pkgConfigMatch.configPath,metadata):resolvedPromise$2).then(function(){var subPath=normalized.substr(metadata.packageKey.length+1);return applyPackageConfig(loader,config,metadata.packageConfig,metadata.packageKey,subPath,metadata,skipExtensions);});});}function createMeta(){return{extension:'',deps:undefined,format:undefined,loader:undefined,scriptLoad:undefined,globals:undefined,nonce:undefined,integrity:undefined,sourceMap:undefined,exports:undefined,encapsulateGlobal:false,crossOrigin:undefined,cjsRequireDetection:true,cjsDeferDepsExecute:false,esModule:false};}function setMeta(config,key,metadata){metadata.load=metadata.load||createMeta();// apply wildcard metas
var bestDepth=0;var wildcardIndex;for(var module in config.meta){wildcardIndex=module.indexOf('*');if(wildcardIndex===-1)continue;if(module.substr(0,wildcardIndex)===key.substr(0,wildcardIndex)&&module.substr(wildcardIndex+1)===key.substr(key.length-module.length+wildcardIndex+1)){var depth=module.split('/').length;if(depth>bestDepth)bestDepth=depth;extendMeta(metadata.load,config.meta[module],bestDepth!==depth);}}// apply exact meta
if(config.meta[key])extendMeta(metadata.load,config.meta[key],false);// apply package meta
if(metadata.packageKey){var subPath=key.substr(metadata.packageKey.length+1);var meta={};if(metadata.packageConfig.meta){var bestDepth=0;getMetaMatches(metadata.packageConfig.meta,subPath,function(metaPattern,matchMeta,matchDepth){if(matchDepth>bestDepth)bestDepth=matchDepth;extendMeta(meta,matchMeta,matchDepth&&bestDepth>matchDepth);});extendMeta(metadata.load,meta,false);}// format
if(metadata.packageConfig.format&&!metadata.pluginKey&&!metadata.load.loader)metadata.load.format=metadata.load.format||metadata.packageConfig.format;}}function parsePlugin(pluginFirst,key){var argumentKey;var pluginKey;var pluginIndex=pluginFirst?key.indexOf('!'):key.lastIndexOf('!');if(pluginIndex===-1)return;if(pluginFirst){argumentKey=key.substr(pluginIndex+1);pluginKey=key.substr(0,pluginIndex);}else{argumentKey=key.substr(0,pluginIndex);pluginKey=key.substr(pluginIndex+1)||argumentKey.substr(argumentKey.lastIndexOf('.')+1);}return{argument:argumentKey,plugin:pluginKey};}// put key back together after parts have been normalized
function combinePluginParts(pluginFirst,argumentKey,pluginKey){if(pluginFirst)return pluginKey+'!'+argumentKey;else return argumentKey+'!'+pluginKey;}/*
   * Package Configuration Extension
   *
   * Example:
   *
   * SystemJS.packages = {
   *   jquery: {
   *     main: 'index.js', // when not set, package key is requested directly
   *     format: 'amd',
   *     defaultExtension: 'ts', // defaults to 'js', can be set to false
   *     modules: {
   *       '*.ts': {
   *         loader: 'typescript'
   *       },
   *       'vendor/sizzle.js': {
   *         format: 'global'
   *       }
   *     },
   *     map: {
   *        // map internal require('sizzle') to local require('./vendor/sizzle')
   *        sizzle: './vendor/sizzle.js',
   *        // map any internal or external require of 'jquery/vendor/another' to 'another/index.js'
   *        './vendor/another.js': './another/index.js',
   *        // test.js / test -> lib/test.js
   *        './test.js': './lib/test.js',
   *
   *        // environment-specific map configurations
   *        './index.js': {
   *          '~browser': './index-node.js',
   *          './custom-condition.js|~export': './index-custom.js'
   *        }
   *     },
   *     // allows for setting package-prefixed depCache
   *     // keys are normalized module keys relative to the package itself
   *     depCache: {
   *       // import 'package/index.js' loads in parallel package/lib/test.js,package/vendor/sizzle.js
   *       './index.js': ['./test'],
   *       './test.js': ['external-dep'],
   *       'external-dep/path.js': ['./another.js']
   *     }
   *   }
   * };
   *
   * Then:
   *   import 'jquery'                       -> jquery/index.js
   *   import 'jquery/submodule'             -> jquery/submodule.js
   *   import 'jquery/submodule.ts'          -> jquery/submodule.ts loaded as typescript
   *   import 'jquery/vendor/another'        -> another/index.js
   *
   * Detailed Behaviours
   * - main can have a leading "./" can be added optionally
   * - map and defaultExtension are applied to the main
   * - defaultExtension adds the extension only if the exact extension is not present

   * - if a meta value is available for a module, map and defaultExtension are skipped
   * - like global map, package map also applies to subpaths (sizzle/x, ./vendor/another/sub)
   * - condition module map is '@env' module in package or '@system-env' globally
   * - map targets support conditional interpolation ('./x': './x.#{|env}.js')
   * - internal package map targets cannot use boolean conditionals
   *
   * Package Configuration Loading
   *
   * Not all packages may already have their configuration present in the System config
   * For these cases, a list of packageConfigPaths can be provided, which when matched against
   * a request, will first request a ".json" file by the package key to derive the package
   * configuration from. This allows dynamic loading of non-predetermined code, a key use
   * case in SystemJS.
   *
   * Example:
   *
   *   SystemJS.packageConfigPaths = ['packages/test/package.json', 'packages/*.json'];
   *
   *   // will first request 'packages/new-package/package.json' for the package config
   *   // before completing the package request to 'packages/new-package/path'
   *   SystemJS.import('packages/new-package/path');
   *
   *   // will first request 'packages/test/package.json' before the main
   *   SystemJS.import('packages/test');
   *
   * When a package matches packageConfigPaths, it will always send a config request for
   * the package configuration.
   * The package key itself is taken to be the match up to and including the last wildcard
   * or trailing slash.
   * The most specific package config path will be used.
   * Any existing package configurations for the package will deeply merge with the
   * package config, with the existing package configurations taking preference.
   * To opt-out of the package configuration request for a package that matches
   * packageConfigPaths, use the { configured: true } package config option.
   *
   */function addDefaultExtension(config,pkg,pkgKey,subPath,skipExtensions){// don't apply extensions to folders or if defaultExtension = false
if(!subPath||!pkg.defaultExtension||subPath[subPath.length-1]==='/'||skipExtensions)return subPath;var metaMatch=false;// exact meta or meta with any content after the last wildcard skips extension
if(pkg.meta)getMetaMatches(pkg.meta,subPath,function(metaPattern,matchMeta,matchDepth){if(matchDepth===0||metaPattern.lastIndexOf('*')!==metaPattern.length-1)return metaMatch=true;});// exact global meta or meta with any content after the last wildcard skips extension
if(!metaMatch&&config.meta)getMetaMatches(config.meta,pkgKey+'/'+subPath,function(metaPattern,matchMeta,matchDepth){if(matchDepth===0||metaPattern.lastIndexOf('*')!==metaPattern.length-1)return metaMatch=true;});if(metaMatch)return subPath;// work out what the defaultExtension is and add if not there already
var defaultExtension='.'+pkg.defaultExtension;if(subPath.substr(subPath.length-defaultExtension.length)!==defaultExtension)return subPath+defaultExtension;else return subPath;}function applyPackageConfigSync(loader,config,pkg,pkgKey,subPath,metadata,skipExtensions){// main
if(!subPath){if(pkg.main)subPath=pkg.main.substr(0,2)==='./'?pkg.main.substr(2):pkg.main;else// also no submap if key is package itself (import 'pkg' -> 'path/to/pkg.js')
// NB can add a default package main convention here
// if it becomes internal to the package then it would no longer be an exit path
return pkgKey;}// map config checking without then with extensions
if(pkg.map){var mapPath='./'+subPath;var mapMatch=getMapMatch(pkg.map,mapPath);// we then check map with the default extension adding
if(!mapMatch){mapPath='./'+addDefaultExtension(config,pkg,pkgKey,subPath,skipExtensions);if(mapPath!=='./'+subPath)mapMatch=getMapMatch(pkg.map,mapPath);}if(mapMatch){var mapped=doMapSync(loader,config,pkg,pkgKey,mapMatch,mapPath,metadata,skipExtensions);if(mapped)return mapped;}}// normal package resolution
return pkgKey+'/'+addDefaultExtension(config,pkg,pkgKey,subPath,skipExtensions);}function validMapping(mapMatch,mapped,path){// allow internal ./x -> ./x/y or ./x/ -> ./x/y recursive maps
// but only if the path is exactly ./x and not ./x/z
if(mapped.substr(0,mapMatch.length)===mapMatch&&path.length>mapMatch.length)return false;return true;}function doMapSync(loader,config,pkg,pkgKey,mapMatch,path,metadata,skipExtensions){if(path[path.length-1]==='/')path=path.substr(0,path.length-1);var mapped=pkg.map[mapMatch];if(_typeof2(mapped)==='object')throw new Error('Synchronous conditional normalization not supported sync normalizing '+mapMatch+' in '+pkgKey);if(!validMapping(mapMatch,mapped,path)||typeof mapped!=='string')return;return packageResolveSync.call(loader,config,mapped+path.substr(mapMatch.length),pkgKey+'/',metadata,metadata,skipExtensions);}function applyPackageConfig(loader,config,pkg,pkgKey,subPath,metadata,skipExtensions){// main
if(!subPath){if(pkg.main)subPath=pkg.main.substr(0,2)==='./'?pkg.main.substr(2):pkg.main;// also no submap if key is package itself (import 'pkg' -> 'path/to/pkg.js')
else// NB can add a default package main convention here
// if it becomes internal to the package then it would no longer be an exit path
return Promise.resolve(pkgKey);}// map config checking without then with extensions
var mapPath,mapMatch;if(pkg.map){mapPath='./'+subPath;mapMatch=getMapMatch(pkg.map,mapPath);// we then check map with the default extension adding
if(!mapMatch){mapPath='./'+addDefaultExtension(config,pkg,pkgKey,subPath,skipExtensions);if(mapPath!=='./'+subPath)mapMatch=getMapMatch(pkg.map,mapPath);}}return(mapMatch?doMap(loader,config,pkg,pkgKey,mapMatch,mapPath,metadata,skipExtensions):resolvedPromise$2).then(function(mapped){if(mapped)return Promise.resolve(mapped);// normal package resolution / fallback resolution for no conditional match
return Promise.resolve(pkgKey+'/'+addDefaultExtension(config,pkg,pkgKey,subPath,skipExtensions));});}function doMap(loader,config,pkg,pkgKey,mapMatch,path,metadata,skipExtensions){if(path[path.length-1]==='/')path=path.substr(0,path.length-1);var mapped=pkg.map[mapMatch];if(typeof mapped==='string'){if(!validMapping(mapMatch,mapped,path))return resolvedPromise$2;return packageResolve.call(loader,config,mapped+path.substr(mapMatch.length),pkgKey+'/',metadata,metadata,skipExtensions).then(function(normalized){return interpolateConditional.call(loader,normalized,pkgKey+'/',metadata);});}// we use a special conditional syntax to allow the builder to handle conditional branch points further
/*if (loader.builder)
      return Promise.resolve(pkgKey + '/#:' + path);*/ // we load all conditions upfront
var conditionPromises=[];var conditions=[];for(var e in mapped){var c=parseCondition(e);conditions.push({condition:c,map:mapped[e]});conditionPromises.push(RegisterLoader.prototype["import"].call(loader,c.module,pkgKey));}// map object -> conditional map
return Promise.all(conditionPromises).then(function(conditionValues){// first map condition to match is used
for(var i=0;i<conditions.length;i++){var c=conditions[i].condition;var value=readMemberExpression(c.prop,'__useDefault'in conditionValues[i]?conditionValues[i].__useDefault:conditionValues[i]);if(!c.negate&&value||c.negate&&!value)return conditions[i].map;}}).then(function(mapped){if(mapped){if(!validMapping(mapMatch,mapped,path))return resolvedPromise$2;return packageResolve.call(loader,config,mapped+path.substr(mapMatch.length),pkgKey+'/',metadata,metadata,skipExtensions).then(function(normalized){return interpolateConditional.call(loader,normalized,pkgKey+'/',metadata);});}// no environment match -> fallback to original subPath by returning undefined
});}// check if the given normalized key matches a packageConfigPath
// if so, loads the config
var packageConfigPaths={};// data object for quick checks against package paths
function createPkgConfigPathObj(path){var lastWildcard=path.lastIndexOf('*');var length=Math.max(lastWildcard+1,path.lastIndexOf('/'));return{length:length,regEx:new RegExp('^('+path.substr(0,length).replace(/[.+?^${}()|[\]\\]/g,'\\$&').replace(/\*/g,'[^\\/]+')+')(\\/|$)'),wildcard:lastWildcard!==-1};}// most specific match wins
function getPackageConfigMatch(config,normalized){var pkgKey,exactMatch=false,configPath;for(var i=0;i<config.packageConfigPaths.length;i++){var packageConfigPath=config.packageConfigPaths[i];var p=packageConfigPaths[packageConfigPath]||(packageConfigPaths[packageConfigPath]=createPkgConfigPathObj(packageConfigPath));if(normalized.length<p.length)continue;var match=normalized.match(p.regEx);if(match&&(!pkgKey||!(exactMatch&&p.wildcard)&&pkgKey.length<match[1].length)){pkgKey=match[1];exactMatch=!p.wildcard;configPath=pkgKey+packageConfigPath.substr(p.length);}}if(!pkgKey)return;return{packageKey:pkgKey,configPath:configPath};}function loadPackageConfigPath(loader,config,pkgConfigPath,metadata,normalized){var configLoader=loader.pluginLoader||loader;// ensure we note this is a package config file path
// it will then be skipped from getting other normalizations itself to ensure idempotency
if(config.packageConfigKeys.indexOf(pkgConfigPath)===-1)config.packageConfigKeys.push(pkgConfigPath);return configLoader["import"](pkgConfigPath).then(function(pkgConfig){setPkgConfig(metadata.packageConfig,pkgConfig,metadata.packageKey,true,config);metadata.packageConfig.configured=true;})["catch"](function(err){throw LoaderError__Check_error_message_for_loader_stack(err,'Unable to fetch package configuration file '+pkgConfigPath);});}function getMetaMatches(pkgMeta,subPath,matchFn){// wildcard meta
var wildcardIndex;for(var module in pkgMeta){// allow meta to start with ./ for flexibility
var dotRel=module.substr(0,2)==='./'?'./':'';if(dotRel)module=module.substr(2);wildcardIndex=module.indexOf('*');if(wildcardIndex===-1)continue;if(module.substr(0,wildcardIndex)===subPath.substr(0,wildcardIndex)&&module.substr(wildcardIndex+1)===subPath.substr(subPath.length-module.length+wildcardIndex+1)){// alow match function to return true for an exit path
if(matchFn(module,pkgMeta[dotRel+module],module.split('/').length))return;}}// exact meta
var exactMeta=pkgMeta[subPath]&&Object.hasOwnProperty.call(pkgMeta,subPath)?pkgMeta[subPath]:pkgMeta['./'+subPath];if(exactMeta)matchFn(exactMeta,exactMeta,0);}/*
   * Conditions Extension
   *
   *   Allows a condition module to alter the resolution of an import via syntax:
   *
   *     import $ from 'jquery/#{browser}';
   *
   *   Will first load the module 'browser' via `SystemJS.import('browser')` and
   *   take the default export of that module.
   *   If the default export is not a string, an error is thrown.
   *
   *   We then substitute the string into the require to get the conditional resolution
   *   enabling environment-specific variations like:
   *
   *     import $ from 'jquery/ie'
   *     import $ from 'jquery/firefox'
   *     import $ from 'jquery/chrome'
   *     import $ from 'jquery/safari'
   *
   *   It can be useful for a condition module to define multiple conditions.
   *   This can be done via the `|` modifier to specify an export member expression:
   *
   *     import 'jquery/#{./browser.js|grade.version}'
   *
   *   Where the `grade` export `version` member in the `browser.js` module  is substituted.
   *
   *
   * Boolean Conditionals
   *
   *   For polyfill modules, that are used as imports but have no module value,
   *   a binary conditional allows a module not to be loaded at all if not needed:
   *
   *     import 'es5-shim#?./conditions.js|needs-es5shim'
   *
   *   These conditions can also be negated via:
   *
   *     import 'es5-shim#?./conditions.js|~es6'
   *
   */var sysConditions=['browser','node','dev','build','production','default'];function parseCondition(condition){var conditionExport,conditionModule,negation;var negation;var conditionExportIndex=condition.lastIndexOf('|');if(conditionExportIndex!==-1){conditionExport=condition.substr(conditionExportIndex+1);conditionModule=condition.substr(0,conditionExportIndex);if(conditionExport[0]==='~'){negation=true;conditionExport=conditionExport.substr(1);}}else{negation=condition[0]==='~';conditionExport='default';conditionModule=condition.substr(negation);if(sysConditions.indexOf(conditionModule)!==-1){conditionExport=conditionModule;conditionModule=null;}}return{module:conditionModule||'@system-env',prop:conditionExport,negate:negation};}function resolveCondition(conditionObj,parentKey,bool){// import without __useDefault handling here
return RegisterLoader.prototype["import"].call(this,conditionObj.module,parentKey).then(function(condition){var m=readMemberExpression(conditionObj.prop,condition);if(bool&&typeof m!=='boolean')throw new TypeError('Condition did not resolve to a boolean.');return conditionObj.negate?!m:m;});}var interpolationRegEx=/#\{[^\}]+\}/;function interpolateConditional(key,parentKey,parentMetadata){// first we normalize the conditional
var conditionalMatch=key.match(interpolationRegEx);if(!conditionalMatch)return Promise.resolve(key);var conditionObj=parseCondition.call(this,conditionalMatch[0].substr(2,conditionalMatch[0].length-3));// in builds, return normalized conditional
/*if (this.builder)
      return this.normalize(conditionObj.module, parentKey, createMetadata(), parentMetadata)
      .then(function (conditionModule) {
        conditionObj.module = conditionModule;
        return key.replace(interpolationRegEx, '#{' + serializeCondition(conditionObj) + '}');
      });*/return resolveCondition.call(this,conditionObj,parentKey,false).then(function(conditionValue){if(typeof conditionValue!=='string')throw new TypeError('The condition value for '+key+' doesn\'t resolve to a string.');if(conditionValue.indexOf('/')!==-1)throw new TypeError('Unabled to interpolate conditional '+key+(parentKey?' in '+parentKey:'')+'\n\tThe condition value '+conditionValue+' cannot contain a "/" separator.');return key.replace(interpolationRegEx,conditionValue);});}/*
   Extend config merging one deep only

    loader.config({
      some: 'random',
      config: 'here',
      deep: {
        config: { too: 'too' }
      }
    });

    <=>

    loader.some = 'random';
    loader.config = 'here'
    loader.deep = loader.deep || {};
    loader.deep.config = { too: 'too' };


    Normalizes meta and package configs allowing for:

    SystemJS.config({
      meta: {
        './index.js': {}
      }
    });

    To become

    SystemJS.meta['https://thissite.com/index.js'] = {};

    For easy normalization canonicalization with latest URL support.

  */var envConfigNames=['browserConfig','nodeConfig','devConfig','buildConfig','productionConfig'];function envSet(loader,cfg,envCallback){for(var i=0;i<envConfigNames.length;i++){var envConfig=envConfigNames[i];if(cfg[envConfig]&&envModule[envConfig.substr(0,envConfig.length-6)])envCallback(cfg[envConfig]);}}function cloneObj(obj,maxDepth){var clone={};for(var p in obj){var prop=obj[p];if(maxDepth>1){if(prop instanceof Array)clone[p]=[].concat(prop);else if(_typeof2(prop)==='object')clone[p]=cloneObj(prop,maxDepth-1);else if(p!=='packageConfig')clone[p]=prop;}else{clone[p]=prop;}}return clone;}function getConfigItem(config,p){var cfgItem=config[p];// getConfig must return an unmodifiable clone of the configuration
if(cfgItem instanceof Array)return config[p].concat([]);else if(_typeof2(cfgItem)==='object')return cloneObj(cfgItem,3);else return config[p];}function getConfig(configName){if(configName){if(configNames.indexOf(configName)!==-1)return getConfigItem(this[CONFIG],configName);throw new Error('"'+configName+'" is not a valid configuration name. Must be one of '+configNames.join(', ')+'.');}var cfg={};for(var i=0;i<configNames.length;i++){var p=configNames[i];var configItem=getConfigItem(this[CONFIG],p);if(configItem!==undefined)cfg[p]=configItem;}return cfg;}function setConfig(cfg,isEnvConfig){var loader=this;var config=this[CONFIG];if('warnings'in cfg)config.warnings=cfg.warnings;if('wasm'in cfg)config.wasm=typeof WebAssembly!=='undefined'&&cfg.wasm;if('production'in cfg||'build'in cfg)setProduction.call(loader,!!cfg.production,!!(cfg.build||envModule&&envModule.build));if(!isEnvConfig){// if using nodeConfig / browserConfig / productionConfig, take baseURL from there
// these exceptions will be unnecessary when we can properly implement config queuings
var baseURL;envSet(loader,cfg,function(cfg){baseURL=baseURL||cfg.baseURL;});baseURL=baseURL||cfg.baseURL;// always configure baseURL first
if(baseURL){config.baseURL=resolveIfNotPlain(baseURL,baseURI)||resolveIfNotPlain('./'+baseURL,baseURI);if(config.baseURL[config.baseURL.length-1]!=='/')config.baseURL+='/';}if(cfg.paths)extend(config.paths,cfg.paths);envSet(loader,cfg,function(cfg){if(cfg.paths)extend(config.paths,cfg.paths);});for(var p in config.paths){if(config.paths[p].indexOf('*')===-1)continue;warn.call(config,'Path config '+p+' -> '+config.paths[p]+' is no longer supported as wildcards are deprecated.');delete config.paths[p];}}if(cfg.defaultJSExtensions)warn.call(config,'The defaultJSExtensions configuration option is deprecated.\n  Use packages defaultExtension instead.',true);if(typeof cfg.pluginFirst==='boolean')config.pluginFirst=cfg.pluginFirst;if(cfg.map){for(var p in cfg.map){var v=cfg.map[p];if(typeof v==='string'){var mapped=coreResolve.call(loader,config,v,undefined,false,false);if(mapped[mapped.length-1]==='/'&&p[p.length-1]!==':'&&p[p.length-1]!=='/')mapped=mapped.substr(0,mapped.length-1);config.map[p]=mapped;}// object map
else{var pkgName=coreResolve.call(loader,config,p[p.length-1]!=='/'?p+'/':p,undefined,true,true);pkgName=pkgName.substr(0,pkgName.length-1);var pkg=config.packages[pkgName];if(!pkg){pkg=config.packages[pkgName]=createPackage();// use '' instead of false to keep type consistent
pkg.defaultExtension='';}setPkgConfig(pkg,{map:v},pkgName,false,config);}}}if(cfg.packageConfigPaths){var packageConfigPaths=[];for(var i=0;i<cfg.packageConfigPaths.length;i++){var path=cfg.packageConfigPaths[i];var packageLength=Math.max(path.lastIndexOf('*')+1,path.lastIndexOf('/'));var normalized=coreResolve.call(loader,config,path.substr(0,packageLength),undefined,false,false);packageConfigPaths[i]=normalized+path.substr(packageLength);}config.packageConfigPaths=packageConfigPaths;}if(cfg.bundles){for(var p in cfg.bundles){var bundle=[];for(var i=0;i<cfg.bundles[p].length;i++){bundle.push(loader.normalizeSync(cfg.bundles[p][i]));}config.bundles[p]=bundle;}}if(cfg.packages){for(var p in cfg.packages){if(p.match(/^([^\/]+:)?\/\/$/))throw new TypeError('"'+p+'" is not a valid package name.');var pkgName=coreResolve.call(loader,config,p[p.length-1]!=='/'?p+'/':p,undefined,true,true);pkgName=pkgName.substr(0,pkgName.length-1);setPkgConfig(config.packages[pkgName]=config.packages[pkgName]||createPackage(),cfg.packages[p],pkgName,false,config);}}if(cfg.depCache){for(var p in cfg.depCache){config.depCache[loader.normalizeSync(p)]=[].concat(cfg.depCache[p]);}}if(cfg.meta){for(var p in cfg.meta){// base wildcard stays base
if(p[0]==='*'){extend(config.meta[p]=config.meta[p]||{},cfg.meta[p]);}else{var resolved=coreResolve.call(loader,config,p,undefined,true,true);extend(config.meta[resolved]=config.meta[resolved]||{},cfg.meta[p]);}}}if('transpiler'in cfg)config.transpiler=cfg.transpiler;// copy any remaining non-standard configuration properties
for(var c in cfg){if(configNames.indexOf(c)!==-1)continue;if(envConfigNames.indexOf(c)!==-1)continue;// warn.call(config, 'Setting custom config option `System.config({ ' + c + ': ... })` is deprecated. Avoid custom config options or set SystemJS.' + c + ' = ... directly.');
loader[c]=cfg[c];}envSet(loader,cfg,function(cfg){loader.config(cfg,true);});}function createPackage(){return{defaultExtension:undefined,main:undefined,format:undefined,meta:undefined,map:undefined,packageConfig:undefined,configured:false};}// deeply-merge (to first level) config with any existing package config
function setPkgConfig(pkg,cfg,pkgName,prependConfig,config){for(var prop in cfg){if(prop==='main'||prop==='format'||prop==='defaultExtension'||prop==='configured'){if(!prependConfig||pkg[prop]===undefined)pkg[prop]=cfg[prop];}else if(prop==='map'){(prependConfig?prepend:extend)(pkg.map=pkg.map||{},cfg.map);}else if(prop==='meta'){(prependConfig?prepend:extend)(pkg.meta=pkg.meta||{},cfg.meta);}else if(Object.hasOwnProperty.call(cfg,prop)){warn.call(config,'"'+prop+'" is not a valid package configuration option in package '+pkgName);}}// default defaultExtension for packages only
if(pkg.defaultExtension===undefined)pkg.defaultExtension='js';if(pkg.main===undefined&&pkg.map&&pkg.map['.']){pkg.main=pkg.map['.'];delete pkg.map['.'];}// main object becomes main map
else if(_typeof2(pkg.main)==='object'){pkg.map=pkg.map||{};pkg.map['./@main']=pkg.main;pkg.main['default']=pkg.main['default']||'./';pkg.main='@main';}return pkg;}var hasBuffer=typeof Buffer!=='undefined';try{if(hasBuffer&&new Buffer('a').toString('base64')!=='YQ==')hasBuffer=false;}catch(e){hasBuffer=false;}var sourceMapPrefix='\n//# sourceMapping'+'URL=data:application/json;base64,';function inlineSourceMap(sourceMapString){if(hasBuffer)return sourceMapPrefix+new Buffer(sourceMapString).toString('base64');else if(typeof btoa!=='undefined')return sourceMapPrefix+btoa(unescape(encodeURIComponent(sourceMapString)));else return'';}function getSource(source,sourceMap,address,wrap){var lastLineIndex=source.lastIndexOf('\n');if(sourceMap){if(_typeof2(sourceMap)!='object')throw new TypeError('load.metadata.sourceMap must be set to an object.');sourceMap=JSON.stringify(sourceMap);}return(wrap?'(function(System, SystemJS) {':'')+source+(wrap?'\n})(System, System);':'')// adds the sourceURL comment if not already present
+(source.substr(lastLineIndex,15)!='\n//# sourceURL='?'\n//# sourceURL='+address+(sourceMap?'!transpiled':''):'')// add sourceMappingURL if load.metadata.sourceMap is set
+(sourceMap&&inlineSourceMap(sourceMap)||'');}// script execution via injecting a script tag into the page
// this allows CSP nonce to be set for CSP environments
var head;function scriptExec(loader,source,sourceMap,address,nonce){if(!head)head=document.head||document.body||document.documentElement;var script=document.createElement('script');script.text=getSource(source,sourceMap,address,false);var onerror=window.onerror;var e;window.onerror=function(_e){e=addToError(_e,'Evaluating '+address);if(onerror)onerror.apply(this,arguments);};preExec(loader);if(nonce)script.setAttribute('nonce',nonce);head.appendChild(script);head.removeChild(script);postExec();window.onerror=onerror;if(e)return e;}var vm;var useVm;var curSystem;var callCounter=0;function preExec(loader){if(callCounter++==0)curSystem=envGlobal.System;envGlobal.System=envGlobal.SystemJS=loader;}function postExec(){if(--callCounter==0)envGlobal.System=envGlobal.SystemJS=curSystem;}var supportsScriptExec=false;if(isBrowser&&typeof document!='undefined'&&document.getElementsByTagName){if(!(window.chrome&&window.chrome.extension||navigator.userAgent.match(/^Node\.js/)))supportsScriptExec=true;}function evaluate(loader,source,sourceMap,address,integrity,nonce,noWrap){if(!source)return;if(nonce&&supportsScriptExec)return scriptExec(loader,source,sourceMap,address,nonce);try{preExec(loader);// global scoped eval for node (avoids require scope leak)
if(!vm&&loader._nodeRequire){vm=loader._nodeRequire('vm');useVm=vm.runInThisContext("typeof System !== 'undefined' && System")===loader;}if(useVm)vm.runInThisContext(getSource(source,sourceMap,address,!noWrap),{filename:address+(sourceMap?'!transpiled':'')});else(0,eval)(getSource(source,sourceMap,address,!noWrap));postExec();}catch(e){postExec();return e;}}function setHelpers(loader){loader.set('@@cjs-helpers',loader.newModule({requireResolve:requireResolve.bind(loader),getPathVars:getPathVars}));loader.set('@@global-helpers',loader.newModule({prepareGlobal:prepareGlobal}));}function setAmdHelper(loader){/*
      AMD-compatible require
      To copy RequireJS, set window.require = window.requirejs = loader.amdRequire
    */function require(names,callback,errback,referer){// in amd, first arg can be a config object... we just ignore
if(_typeof2(names)==='object'&&!(names instanceof Array))return require.apply(null,Array.prototype.splice.call(arguments,1,arguments.length-1));// amd require
if(typeof names==='string'&&typeof callback==='function')names=[names];if(names instanceof Array){var dynamicRequires=[];for(var i=0;i<names.length;i++){dynamicRequires.push(loader["import"](names[i],referer));}Promise.all(dynamicRequires).then(function(modules){if(callback)callback.apply(null,modules);},errback);}// commonjs require
else if(typeof names==='string'){var normalized=loader.decanonicalize(names,referer);var module=loader.get(normalized);if(!module)throw new Error('Module not already loaded loading "'+names+'" as '+normalized+(referer?' from "'+referer+'".':'.'));return'__useDefault'in module?module.__useDefault:module;}else throw new TypeError('Invalid require');}function define(name,deps,factory){if(typeof name!=='string'){factory=deps;deps=name;name=null;}if(!(deps instanceof Array)){factory=deps;deps=['require','exports','module'].splice(0,factory.length);}if(typeof factory!=='function')factory=function(factory){return function(){return factory;};}(factory);if(!name){if(curMetaDeps){deps=deps.concat(curMetaDeps);curMetaDeps=undefined;}}// remove system dependencies
var requireIndex,exportsIndex,moduleIndex;if((requireIndex=deps.indexOf('require'))!==-1){deps.splice(requireIndex,1);// only trace cjs requires for non-named
// named defines assume the trace has already been done
if(!name)deps=deps.concat(amdGetCJSDeps(factory.toString(),requireIndex));}if((exportsIndex=deps.indexOf('exports'))!==-1)deps.splice(exportsIndex,1);if((moduleIndex=deps.indexOf('module'))!==-1)deps.splice(moduleIndex,1);function execute(req,exports,module){var depValues=[];for(var i=0;i<deps.length;i++){depValues.push(req(deps[i]));}module.uri=module.id;module.config=noop;// add back in system dependencies
if(moduleIndex!==-1)depValues.splice(moduleIndex,0,module);if(exportsIndex!==-1)depValues.splice(exportsIndex,0,exports);if(requireIndex!==-1){var contextualRequire=function contextualRequire(names,callback,errback){if(typeof names==='string'&&typeof callback!=='function')return req(names);return require.call(loader,names,callback,errback,module.id);};contextualRequire.toUrl=function(name){return loader.normalizeSync(name,module.id);};depValues.splice(requireIndex,0,contextualRequire);}// set global require to AMD require
var curRequire=envGlobal.require;envGlobal.require=require;var output=factory.apply(exportsIndex===-1?envGlobal:exports,depValues);envGlobal.require=curRequire;if(typeof output!=='undefined')module.exports=output;}// anonymous define
if(!name){loader.registerDynamic(deps,false,curEsModule?wrapEsModuleExecute(execute):execute);}else{loader.registerDynamic(name,deps,false,execute);// if we don't have any other defines,
// then let this be an anonymous define
// this is just to support single modules of the form:
// define('jquery')
// still loading anonymously
// because it is done widely enough to be useful
// as soon as there is more than one define, this gets removed though
if(lastNamedDefine){lastNamedDefine=undefined;multipleNamedDefines=true;}else if(!multipleNamedDefines){lastNamedDefine=[deps,execute];}}}define.amd={};loader.amdDefine=define;loader.amdRequire=require;}// CJS
var windowOrigin;if(typeof window!=='undefined'&&typeof document!=='undefined'&&window.location)windowOrigin=location.protocol+'//'+location.hostname+(location.port?':'+location.port:'');function stripOrigin(path){if(path.substr(0,8)==='file:///')return path.substr(7+!!isWindows);if(windowOrigin&&path.substr(0,windowOrigin.length)===windowOrigin)return path.substr(windowOrigin.length);return path;}function requireResolve(request,parentId){return stripOrigin(this.normalizeSync(request,parentId));}function getPathVars(moduleId){// remove any plugin syntax
var pluginIndex=moduleId.lastIndexOf('!');var filename;if(pluginIndex!==-1)filename=moduleId.substr(0,pluginIndex);else filename=moduleId;var dirname=filename.split('/');dirname.pop();dirname=dirname.join('/');return{filename:stripOrigin(filename),dirname:stripOrigin(dirname)};}var commentRegEx=/(^|[^\\])(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg;var stringRegEx=/("[^"\\\n\r]*(\\.[^"\\\n\r]*)*"|'[^'\\\n\r]*(\\.[^'\\\n\r]*)*')/g;// extract CJS dependencies from source text via regex static analysis
// read require('x') statements not in comments or strings
function getCJSDeps(source){cjsRequireRegEx.lastIndex=commentRegEx.lastIndex=stringRegEx.lastIndex=0;var deps=[];var match;// track string and comment locations for unminified source
var stringLocations=[],commentLocations=[];function inLocation(locations,match){for(var i=0;i<locations.length;i++){if(locations[i][0]<match.index&&locations[i][1]>match.index)return true;}return false;}if(source.length/source.split('\n').length<200){while(match=stringRegEx.exec(source)){stringLocations.push([match.index,match.index+match[0].length]);}// TODO: track template literals here before comments
while(match=commentRegEx.exec(source)){// only track comments not starting in strings
if(!inLocation(stringLocations,match))commentLocations.push([match.index+match[1].length,match.index+match[0].length-1]);}}while(match=cjsRequireRegEx.exec(source)){// ensure we're not within a string or comment location
if(!inLocation(stringLocations,match)&&!inLocation(commentLocations,match)){var dep=match[1].substr(1,match[1].length-2);// skip cases like require('" + file + "')
if(dep.match(/"|'/))continue;deps.push(dep);}}return deps;}// Global
// bare minimum ignores
var ignoredGlobalProps=['_g','sessionStorage','localStorage','clipboardData','frames','frameElement','external','mozAnimationStartTime','mozPaintCount','webkitStorageInfo','webkitIndexedDB','mozInnerScreenY','mozInnerScreenX'];var globalSnapshot;function globalIterator(globalName){if(ignoredGlobalProps.indexOf(globalName)!==-1)return;try{var value=envGlobal[globalName];}catch(e){ignoredGlobalProps.push(globalName);}this(globalName,value);}function getGlobalValue(exports){if(typeof exports==='string')return readMemberExpression(exports,envGlobal);if(!(exports instanceof Array))throw new Error('Global exports must be a string or array.');var globalValue={};for(var i=0;i<exports.length;i++){globalValue[exports[i].split('.').pop()]=readMemberExpression(exports[i],envGlobal);}return globalValue;}function prepareGlobal(moduleName,exports,globals,encapsulate){// disable module detection
var curDefine=envGlobal.define;envGlobal.define=undefined;// set globals
var oldGlobals;if(globals){oldGlobals={};for(var g in globals){oldGlobals[g]=envGlobal[g];envGlobal[g]=globals[g];}}// store a complete copy of the global object in order to detect changes
if(!exports){globalSnapshot={};Object.keys(envGlobal).forEach(globalIterator,function(name,value){globalSnapshot[name]=value;});}// return function to retrieve global
return function(){var globalValue=exports?getGlobalValue(exports):{};var singleGlobal;var multipleExports=!!exports;if(!exports||encapsulate)Object.keys(envGlobal).forEach(globalIterator,function(name,value){if(globalSnapshot[name]===value)return;if(value===undefined)return;// allow global encapsulation where globals are removed
if(encapsulate)envGlobal[name]=undefined;if(!exports){globalValue[name]=value;if(singleGlobal!==undefined){if(!multipleExports&&singleGlobal!==value)multipleExports=true;}else{singleGlobal=value;}}});globalValue=multipleExports?globalValue:singleGlobal;// revert globals
if(oldGlobals){for(var g in oldGlobals){envGlobal[g]=oldGlobals[g];}}envGlobal.define=curDefine;return globalValue;};}// AMD
var cjsRequirePre="(?:^|[^$_a-zA-Z\\xA0-\\uFFFF.])";var cjsRequirePost="\\s*\\(\\s*(\"([^\"]+)\"|'([^']+)')\\s*\\)";var fnBracketRegEx=/\(([^\)]*)\)/;var wsRegEx=/^\s+|\s+$/g;var requireRegExs={};function amdGetCJSDeps(source,requireIndex){// remove comments
source=source.replace(commentRegEx,'');// determine the require alias
var params=source.match(fnBracketRegEx);var requireAlias=(params[1].split(',')[requireIndex]||'require').replace(wsRegEx,'');// find or generate the regex for this requireAlias
var requireRegEx=requireRegExs[requireAlias]||(requireRegExs[requireAlias]=new RegExp(cjsRequirePre+requireAlias+cjsRequirePost,'g'));requireRegEx.lastIndex=0;var deps=[];var match;while(match=requireRegEx.exec(source)){deps.push(match[2]||match[3]);}return deps;}function wrapEsModuleExecute(execute){return function(require,exports,module){execute(require,exports,module);exports=module.exports;if((_typeof2(exports)==='object'||typeof exports==='function')&&!('__esModule'in exports))Object.defineProperty(module.exports,'__esModule',{value:true});};}// generate anonymous define from singular named define
var multipleNamedDefines=false;var lastNamedDefine;var curMetaDeps;var curEsModule=false;function clearLastDefine(metaDeps,esModule){curMetaDeps=metaDeps;curEsModule=esModule;lastNamedDefine=undefined;multipleNamedDefines=false;}function registerLastDefine(loader){if(lastNamedDefine)loader.registerDynamic(curMetaDeps?lastNamedDefine[0].concat(curMetaDeps):lastNamedDefine[0],false,curEsModule?wrapEsModuleExecute(lastNamedDefine[1]):lastNamedDefine[1]);// bundles are an empty module
else if(multipleNamedDefines)loader.registerDynamic([],false,noop);}var supportsScriptLoad=(isBrowser||isWorker)&&typeof navigator!=='undefined'&&navigator.userAgent&&!navigator.userAgent.match(/MSIE (9|10).0/);// include the node require since we're overriding it
var nodeRequire;if(typeof require!=='undefined'&&typeof process!=='undefined'&&!process.browser)nodeRequire=require;function setMetaEsModule(metadata,moduleValue){if(metadata.load.esModule&&(_typeof2(moduleValue)==='object'||typeof moduleValue==='function')&&!('__esModule'in moduleValue))Object.defineProperty(moduleValue,'__esModule',{value:true});}function instantiate$1(key,processAnonRegister){var loader=this;var config=this[CONFIG];// first do bundles and depCache
return(loadBundlesAndDepCache(config,this,key)||resolvedPromise$2).then(function(){if(processAnonRegister())return;var metadata=loader[METADATA][key];// node module loading
if(key.substr(0,6)==='@node/'){if(!loader._nodeRequire)throw new TypeError('Error loading '+key+'. Can only load node core modules in Node.');loader.registerDynamic([],false,function(){return loadNodeModule.call(loader,key.substr(6),loader.baseURL);});processAnonRegister();return;}if(metadata.load.scriptLoad){if(metadata.pluginKey||!supportsScriptLoad){metadata.load.scriptLoad=false;warn.call(config,'scriptLoad not supported for "'+key+'"');}}else if(metadata.load.scriptLoad!==false&&!metadata.pluginKey&&supportsScriptLoad){// auto script load AMD, global without deps
if(!metadata.load.deps&&!metadata.load.globals&&(metadata.load.format==='system'||metadata.load.format==='register'||metadata.load.format==='global'&&metadata.load.exports))metadata.load.scriptLoad=true;}// fetch / translate / instantiate pipeline
if(!metadata.load.scriptLoad)return initializePlugin(loader,key,metadata).then(function(){return runFetchPipeline(loader,key,metadata,processAnonRegister,config.wasm);});// just script loading
return new Promise(function(resolve,reject){if(metadata.load.format==='amd'&&envGlobal.define!==loader.amdDefine)throw new Error('Loading AMD with scriptLoad requires setting the global `'+globalName+'.define = SystemJS.amdDefine`');scriptLoad(key,metadata.load.crossOrigin,metadata.load.integrity,function(){if(!processAnonRegister()){metadata.load.format='global';var globalValue=metadata.load.exports&&getGlobalValue(metadata.load.exports);loader.registerDynamic([],false,function(){setMetaEsModule(metadata,globalValue);return globalValue;});processAnonRegister();}resolve();},reject);});}).then(function(instantiated){delete loader[METADATA][key];return instantiated;});}function initializePlugin(loader,key,metadata){if(!metadata.pluginKey)return resolvedPromise$2;return loader["import"](metadata.pluginKey).then(function(plugin){metadata.pluginModule=plugin;metadata.pluginLoad={name:key,address:metadata.pluginArgument,source:undefined,metadata:metadata.load};metadata.load.deps=metadata.load.deps||[];});}function loadBundlesAndDepCache(config,loader,key){// load direct deps, in turn will pick up their trace trees
var deps;if(isBrowser&&(deps=config.depCache[key])){for(var i=0;i<deps.length;i++){loader.normalize(deps[i],key).then(preloadScript);}}else{var matched=false;for(var b in config.bundles){for(var i=0;i<config.bundles[b].length;i++){var curModule=config.bundles[b][i];if(curModule===key){matched=true;break;}// wildcard in bundles includes / boundaries
if(curModule.indexOf('*')!==-1){var parts=curModule.split('*');if(parts.length!==2){config.bundles[b].splice(i--,1);continue;}if(key.substr(0,parts[0].length)===parts[0]&&key.substr(key.length-parts[1].length,parts[1].length)===parts[1]){matched=true;break;}}}if(matched)return loader["import"](b);}}}function runFetchPipeline(loader,key,metadata,processAnonRegister,wasm){if(metadata.load.exports&&!metadata.load.format)metadata.load.format='global';return resolvedPromise$2// locate
.then(function(){if(!metadata.pluginModule||!metadata.pluginModule.locate)return;return Promise.resolve(metadata.pluginModule.locate.call(loader,metadata.pluginLoad)).then(function(address){if(address)metadata.pluginLoad.address=address;});})// fetch
.then(function(){if(!metadata.pluginModule)return fetch$1(key,metadata.load.authorization,metadata.load.integrity,wasm);wasm=false;if(!metadata.pluginModule.fetch)return fetch$1(metadata.pluginLoad.address,metadata.load.authorization,metadata.load.integrity,false);return metadata.pluginModule.fetch.call(loader,metadata.pluginLoad,function(load){return fetch$1(load.address,metadata.load.authorization,metadata.load.integrity,false);});}).then(function(fetched){// fetch is already a utf-8 string if not doing wasm detection
if(!wasm||typeof fetched==='string')return translateAndInstantiate(loader,key,fetched,metadata,processAnonRegister);return checkInstantiateWasm(loader,fetched,processAnonRegister).then(function(wasmInstantiated){if(wasmInstantiated)return;// not wasm -> convert buffer into utf-8 string to execute as a module
// TextDecoder compatibility matches WASM currently. Need to keep checking this.
// The TextDecoder interface is documented at http://encoding.spec.whatwg.org/#interface-textdecoder
var stringSource=isBrowser?new TextDecoder('utf-8').decode(new Uint8Array(fetched)):fetched.toString();return translateAndInstantiate(loader,key,stringSource,metadata,processAnonRegister);});});}function translateAndInstantiate(loader,key,source,metadata,processAnonRegister){return Promise.resolve(source)// translate
.then(function(source){if(metadata.load.format==='detect')metadata.load.format=undefined;readMetaSyntax(source,metadata);if(!metadata.pluginModule)return source;metadata.pluginLoad.source=source;if(!metadata.pluginModule.translate)return source;return Promise.resolve(metadata.pluginModule.translate.call(loader,metadata.pluginLoad,metadata.traceOpts)).then(function(translated){if(metadata.load.sourceMap){if(_typeof2(metadata.load.sourceMap)!=='object')throw new Error('metadata.load.sourceMap must be set to an object.');sanitizeSourceMap(metadata.pluginLoad.address,metadata.load.sourceMap);}if(typeof translated==='string')return translated;else return metadata.pluginLoad.source;});}).then(function(source){if(!metadata.load.format&&source.substring(0,8)==='"bundle"'){metadata.load.format='system';return source;}if(metadata.load.format==='register'||!metadata.load.format&&detectRegisterFormat(source)){metadata.load.format='register';return source;}if(metadata.load.format!=='esm'&&(metadata.load.format||!source.match(esmRegEx))){return source;}metadata.load.format='esm';return transpile(loader,source,key,metadata,processAnonRegister);})// instantiate
.then(function(translated){if(typeof translated!=='string'||!metadata.pluginModule||!metadata.pluginModule.instantiate)return translated;var calledInstantiate=false;metadata.pluginLoad.source=translated;return Promise.resolve(metadata.pluginModule.instantiate.call(loader,metadata.pluginLoad,function(load){translated=load.source;metadata.load=load.metadata;if(calledInstantiate)throw new Error('Instantiate must only be called once.');calledInstantiate=true;})).then(function(result){if(calledInstantiate)return translated;return protectedCreateNamespace(result);});}).then(function(source){// plugin instantiate result case
if(typeof source!=='string')return source;if(!metadata.load.format)metadata.load.format=detectLegacyFormat(source);var registered=false;switch(metadata.load.format){case'esm':case'register':case'system':var err=evaluate(loader,source,metadata.load.sourceMap,key,metadata.load.integrity,metadata.load.nonce,false);if(err)throw err;if(!processAnonRegister())return emptyModule;return;break;case'json':// warn.call(config, '"json" module format is deprecated.');
var parsed=JSON.parse(source);return loader.newModule({"default":parsed,__useDefault:parsed});case'amd':var curDefine=envGlobal.define;envGlobal.define=loader.amdDefine;clearLastDefine(metadata.load.deps,metadata.load.esModule);var err=evaluate(loader,source,metadata.load.sourceMap,key,metadata.load.integrity,metadata.load.nonce,false);// if didn't register anonymously, use the last named define if only one
registered=processAnonRegister();if(!registered){registerLastDefine(loader);registered=processAnonRegister();}envGlobal.define=curDefine;if(err)throw err;break;case'cjs':var metaDeps=metadata.load.deps;var deps=(metadata.load.deps||[]).concat(metadata.load.cjsRequireDetection?getCJSDeps(source):[]);for(var g in metadata.load.globals){if(metadata.load.globals[g])deps.push(metadata.load.globals[g]);}loader.registerDynamic(deps,true,function(require,exports,module){require.resolve=function(key){return requireResolve.call(loader,key,module.id);};// support module.paths ish
module.paths=[];module.require=require;// ensure meta deps execute first
if(!metadata.load.cjsDeferDepsExecute&&metaDeps)for(var i=0;i<metaDeps.length;i++){require(metaDeps[i]);}var pathVars=getPathVars(module.id);var __cjsWrapper={exports:exports,args:[require,exports,module,pathVars.filename,pathVars.dirname,envGlobal,envGlobal]};var cjsWrapper="(function (require, exports, module, __filename, __dirname, global, GLOBAL";// add metadata.globals to the wrapper arguments
if(metadata.load.globals)for(var g in metadata.load.globals){__cjsWrapper.args.push(require(metadata.load.globals[g]));cjsWrapper+=", "+g;}// disable AMD detection
var define=envGlobal.define;envGlobal.define=undefined;envGlobal.__cjsWrapper=__cjsWrapper;source=cjsWrapper+") {"+source.replace(hashBangRegEx$1,'')+"\n}).apply(__cjsWrapper.exports, __cjsWrapper.args);";var err=evaluate(loader,source,metadata.load.sourceMap,key,metadata.load.integrity,metadata.load.nonce,false);if(err)throw err;setMetaEsModule(metadata,exports);envGlobal.__cjsWrapper=undefined;envGlobal.define=define;});registered=processAnonRegister();break;case'global':var deps=metadata.load.deps||[];for(var g in metadata.load.globals){var gl=metadata.load.globals[g];if(gl)deps.push(gl);}loader.registerDynamic(deps,false,function(require,exports,module){var globals;if(metadata.load.globals){globals={};for(var g in metadata.load.globals){if(metadata.load.globals[g])globals[g]=require(metadata.load.globals[g]);}}var exportName=metadata.load.exports;if(exportName)source+='\n'+globalName+'["'+exportName+'"] = '+exportName+';';var retrieveGlobal=prepareGlobal(module.id,exportName,globals,metadata.load.encapsulateGlobal);var err=evaluate(loader,source,metadata.load.sourceMap,key,metadata.load.integrity,metadata.load.nonce,true);if(err)throw err;var output=retrieveGlobal();setMetaEsModule(metadata,output);return output;});registered=processAnonRegister();break;default:throw new TypeError('Unknown module format "'+metadata.load.format+'" for "'+key+'".'+(metadata.load.format==='es6'?' Use "esm" instead here.':''));}if(!registered)throw new Error('Module '+key+' detected as '+metadata.load.format+' but didn\'t execute correctly.');});}var globalName=typeof self!='undefined'?'self':'global';// good enough ES6 module detection regex - format detections not designed to be accurate, but to handle the 99% use case
var esmRegEx=/(^\s*|[}\);\n]\s*)(import\s*(['"]|(\*\s+as\s+)?(?!type)([^"'\(\)\n; ]+)\s*from\s*['"]|\{)|export\s+\*\s+from\s+["']|export\s*(\{|default|function|class|var|const|let|async\s+function))/;var leadingCommentAndMetaRegEx=/^(\s*\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\s*\/\/[^\n]*|\s*"[^"]+"\s*;?|\s*'[^']+'\s*;?)*\s*/;function detectRegisterFormat(source){var leadingCommentAndMeta=source.match(leadingCommentAndMetaRegEx);if(!leadingCommentAndMeta)return false;var codeStart=leadingCommentAndMeta[0].length;return source.substr(codeStart,17)==='SystemJS.register'||source.substr(codeStart,15)==='System.register';}// AMD Module Format Detection RegEx
// define([.., .., ..], ...)
// define(varName); || define(function(require, exports) {}); || define({})
var amdRegEx=/(?:^\uFEFF?|[^$_a-zA-Z\xA0-\uFFFF.])define\s*\(\s*("[^"]+"\s*,\s*|'[^']+'\s*,\s*)?\s*(\[(\s*(("[^"]+"|'[^']+')\s*,|\/\/.*\r?\n|\/\*(.|\s)*?\*\/))*(\s*("[^"]+"|'[^']+')\s*,?)?(\s*(\/\/.*\r?\n|\/\*(.|\s)*?\*\/))*\s*\]|function\s*|{|[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*\))/;/// require('...') || exports[''] = ... || exports.asd = ... || module.exports = ...
var cjsExportsRegEx=/(?:^\uFEFF?|[^$_a-zA-Z\xA0-\uFFFF.])(exports\s*(\[['"]|\.)|module(\.exports|\['exports'\]|\["exports"\])\s*(\[['"]|[=,\.]))/;// used to support leading #!/usr/bin/env in scripts as supported in Node
var hashBangRegEx$1=/^\#\!.*/;function detectLegacyFormat(source){if(source.match(amdRegEx))return'amd';cjsExportsRegEx.lastIndex=0;cjsRequireRegEx.lastIndex=0;if(cjsRequireRegEx.exec(source)||cjsExportsRegEx.exec(source))return'cjs';// global is the fallback format
return'global';}function sanitizeSourceMap(address,sourceMap){var originalName=address.split('!')[0];// force set the filename of the original file
if(!sourceMap.file||sourceMap.file==address)sourceMap.file=originalName+'!transpiled';// force set the sources list if only one source
if(!sourceMap.sources||sourceMap.sources.length<=1&&(!sourceMap.sources[0]||sourceMap.sources[0]===address))sourceMap.sources=[originalName];}function transpile(loader,source,key,metadata,processAnonRegister){if(!loader.transpiler)throw new TypeError('Unable to dynamically transpile ES module\n   A loader plugin needs to be configured via `SystemJS.config({ transpiler: \'transpiler-module\' })`.');// deps support for es transpile
if(metadata.load.deps){var depsPrefix='';for(var i=0;i<metadata.load.deps.length;i++){depsPrefix+='import "'+metadata.load.deps[i]+'"; ';}source=depsPrefix+source;}// do transpilation
return loader["import"].call(loader,loader.transpiler).then(function(transpiler){transpiler=transpiler.__useDefault||transpiler;// translate hooks means this is a transpiler plugin instead of a raw implementation
if(!transpiler.translate)throw new Error(loader.transpiler+' is not a valid transpiler plugin.');// if transpiler is the same as the plugin loader, then don't run twice
if(transpiler===metadata.pluginModule)return source;// convert the source map into an object for transpilation chaining
if(typeof metadata.load.sourceMap==='string')metadata.load.sourceMap=JSON.parse(metadata.load.sourceMap);metadata.pluginLoad=metadata.pluginLoad||{name:key,address:key,source:source,metadata:metadata.load};metadata.load.deps=metadata.load.deps||[];return Promise.resolve(transpiler.translate.call(loader,metadata.pluginLoad,metadata.traceOpts)).then(function(source){// sanitize sourceMap if an object not a JSON string
var sourceMap=metadata.load.sourceMap;if(sourceMap&&_typeof2(sourceMap)==='object')sanitizeSourceMap(key,sourceMap);if(metadata.load.format==='esm'&&detectRegisterFormat(source))metadata.load.format='register';return source;});},function(err){throw LoaderError__Check_error_message_for_loader_stack(err,'Unable to load transpiler to transpile '+key);});}// detect any meta header syntax
// only set if not already set
var metaRegEx=/^(\s*\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\s*\/\/[^\n]*|\s*"[^"]+"\s*;?|\s*'[^']+'\s*;?)+/;var metaPartRegEx=/\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\/\/[^\n]*|"[^"]+"\s*;?|'[^']+'\s*;?/g;function setMetaProperty(target,p,value){var pParts=p.split('.');var curPart;while(pParts.length>1){curPart=pParts.shift();target=target[curPart]=target[curPart]||{};}curPart=pParts.shift();if(target[curPart]===undefined)target[curPart]=value;}function readMetaSyntax(source,metadata){var meta=source.match(metaRegEx);if(!meta)return;var metaParts=meta[0].match(metaPartRegEx);for(var i=0;i<metaParts.length;i++){var curPart=metaParts[i];var len=curPart.length;var firstChar=curPart.substr(0,1);if(curPart.substr(len-1,1)==';')len--;if(firstChar!='"'&&firstChar!="'")continue;var metaString=curPart.substr(1,curPart.length-3);var metaName=metaString.substr(0,metaString.indexOf(' '));if(metaName){var metaValue=metaString.substr(metaName.length+1,metaString.length-metaName.length-1);if(metaName==='deps')metaName='deps[]';if(metaName.substr(metaName.length-2,2)==='[]'){metaName=metaName.substr(0,metaName.length-2);metadata.load[metaName]=metadata.load[metaName]||[];metadata.load[metaName].push(metaValue);}// "use strict" is not meta
else if(metaName!=='use'){setMetaProperty(metadata.load,metaName,metaValue);}}else{metadata.load[metaString]=true;}}}var scriptSrc;// Promise detection and error message
if(typeof Promise==='undefined')throw new Error('SystemJS needs a Promise polyfill.');if(typeof document!=='undefined'){var scripts=document.getElementsByTagName('script');var curScript=scripts[scripts.length-1];if(document.currentScript&&(curScript.defer||curScript.async))curScript=document.currentScript;scriptSrc=curScript&&curScript.src;}// worker
else if(typeof importScripts!=='undefined'){try{throw new Error('_');}catch(e){e.stack.replace(/(?:at|@).*(http.+):[\d]+:[\d]+/,function(m,url){scriptSrc=url;});}}// node
else if(typeof __filename!=='undefined'){scriptSrc=__filename;}function SystemJSLoader(){RegisterLoader.call(this);// NB deprecate
this._loader={};// internal metadata store
this[METADATA]={};// internal configuration
this[CONFIG]={baseURL:baseURI,paths:{},packageConfigPaths:[],packageConfigKeys:[],map:{},packages:{},depCache:{},meta:{},bundles:{},production:false,transpiler:undefined,loadedBundles:{},// global behaviour flags
warnings:false,pluginFirst:false,// enable wasm loading and detection when supported
wasm:false};// make the location of the system.js script accessible (if any)
this.scriptSrc=scriptSrc;this._nodeRequire=nodeRequire;// support the empty module, as a concept
this.registry.set('@empty',emptyModule);setProduction.call(this,false,false);// add module format helpers
setHelpers(this);setAmdHelper(this);}var envModule;function setProduction(isProduction,isBuilder){this[CONFIG].production=isProduction;this.registry.set('@system-env',envModule=this.newModule({browser:isBrowser,node:!!this._nodeRequire,production:!isBuilder&&isProduction,dev:isBuilder||!isProduction,build:isBuilder,'default':true}));}SystemJSLoader.prototype=Object.create(RegisterLoader.prototype);SystemJSLoader.prototype.constructor=SystemJSLoader;// NB deprecate normalize
SystemJSLoader.prototype[SystemJSLoader.resolve=RegisterLoader.resolve]=SystemJSLoader.prototype.normalize=normalize;SystemJSLoader.prototype.load=function(key,parentKey){warn.call(this[CONFIG],'System.load is deprecated.');return this["import"](key,parentKey);};// NB deprecate decanonicalize, normalizeSync
SystemJSLoader.prototype.decanonicalize=SystemJSLoader.prototype.normalizeSync=SystemJSLoader.prototype.resolveSync=normalizeSync;SystemJSLoader.prototype[SystemJSLoader.instantiate=RegisterLoader.instantiate]=instantiate$1;SystemJSLoader.prototype.config=setConfig;SystemJSLoader.prototype.getConfig=getConfig;SystemJSLoader.prototype.global=envGlobal;SystemJSLoader.prototype["import"]=function(){return RegisterLoader.prototype["import"].apply(this,arguments).then(function(m){return'__useDefault'in m?m.__useDefault:m;});};var configNames=['baseURL','map','paths','packages','packageConfigPaths','depCache','meta','bundles','transpiler','warnings','pluginFirst','production','wasm'];var hasProxy=typeof Proxy!=='undefined';for(var i=0;i<configNames.length;i++){(function(configName){Object.defineProperty(SystemJSLoader.prototype,configName,{get:function get(){var cfg=getConfigItem(this[CONFIG],configName);if(hasProxy&&_typeof2(cfg)==='object')cfg=new Proxy(cfg,{set:function set(target,option){throw new Error('Cannot set SystemJS.'+configName+'["'+option+'"] directly. Use SystemJS.config({ '+configName+': { "'+option+'": ... } }) rather.');}});//if (typeof cfg === 'object')
//  warn.call(this[CONFIG], 'Referencing `SystemJS.' + configName + '` is deprecated. Use the config getter `SystemJS.getConfig(\'' + configName + '\')`');
return cfg;},set:function set(name){throw new Error('Setting `SystemJS.'+configName+'` directly is no longer supported. Use `SystemJS.config({ '+configName+': ... })`.');}});})(configNames[i]);}/*
   * Backwards-compatible registry API, to be deprecated
   */function registryWarn(loader,method){warn.call(loader[CONFIG],'SystemJS.'+method+' is deprecated for SystemJS.registry.'+method);}SystemJSLoader.prototype["delete"]=function(key){registryWarn(this,'delete');return this.registry["delete"](key);};SystemJSLoader.prototype.get=function(key){registryWarn(this,'get');return this.registry.get(key);};SystemJSLoader.prototype.has=function(key){registryWarn(this,'has');return this.registry.has(key);};SystemJSLoader.prototype.set=function(key,module){registryWarn(this,'set');return this.registry.set(key,module);};SystemJSLoader.prototype.newModule=function(bindings){return new ModuleNamespace(bindings);};SystemJSLoader.prototype.isModule=isModule;// ensure System.register and System.registerDynamic decanonicalize
SystemJSLoader.prototype.register=function(key,deps,declare){if(typeof key==='string')key=decanonicalize.call(this,this[CONFIG],key);return RegisterLoader.prototype.register.call(this,key,deps,declare);};SystemJSLoader.prototype.registerDynamic=function(key,deps,executingRequire,execute){if(typeof key==='string')key=decanonicalize.call(this,this[CONFIG],key);return RegisterLoader.prototype.registerDynamic.call(this,key,deps,executingRequire,execute);};SystemJSLoader.prototype.version="0.21.6 Dev";var System=new SystemJSLoader();// only set the global System on the global in browsers
if(isBrowser||isWorker)envGlobal.SystemJS=envGlobal.System=System;if(typeof module!=='undefined'&&module.exports)module.exports=System;})();var _origGet=System.get.bind(System);System.get=function(id){var recorder=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return lively.FreezerRuntime&&lively.FreezerRuntime.get(id,recorder)||_origGet(id);};var _origDecanonicalize=System.decanonicalize.bind(System);System.decanonicalize=function(id){return lively.FreezerRuntime?lively.FreezerRuntime.decanonicalize(id):_origDecanonicalize(id);};window._missingExportShim=function(){};var _originalRegister=System.register.bind(System);System.register=function(name,deps,def){if(typeof name!='string'){def=deps;deps=name;return _originalRegister(deps,function(exports,module){var res=def(exports,module);if(!res.setters)res.setters=[];return res;});}return _originalRegister(name,deps,function(exports,module){var res=def(exports,module);if(!res.setters)res.setters=[];return res;});};System.set('stub-transpiler',System.newModule({translate:function translate(load){return load.source;}}));System.config({transpiler:'stub-transpiler'});System.trace=false;System.set("lively.ast",System.newModule({"default":{}}));System.set("lively.vm",System.newModule({"default":{}}));System.set("lively.ide",System.newModule({"default":{}}));System.set("lively.modules",System.newModule({"default":{}}));System.set("babel-plugin-transform-jsx",System.newModule({"default":{}}));System.set("lively-system-interface",System.newModule({"default":{}}));System.set("lively.storage",System.newModule({"default":{}}));System.set("fs",System.newModule({"default":{}}));System.set("events",System.newModule({"default":{}}));System.config({meta:{'./__root_module__.js':{format:"system"},'./__root_module__-5782ff42.js':{format:"system"},'./mobile-665c08fb.js':{format:"system"},'./index-602cf476.js':{format:"system"},'./desktop-1a35b40d.js':{format:"system"},'./mobile-384e06d1.js':{format:"system"},'./services-bc1b0444.js':{format:"system"},'./index-d275e3ad.js':{format:"system"},'./desktop-fece4314.js':{format:"system"},'./index-a3af1ede.js':{format:"system"},'./mobile-165b034a.js':{format:"system"},'./index-83723532.js':{format:"system"},'./index-6da14585.js':{format:"system"},'./desktop-aaf636c8.js':{format:"system"},'./intro-fa1347e2.js':{format:"system"},'./about-b3734ecf.js':{format:"system"},'./projects-16c7e60a.js':{format:"system"},'./services-472d436a.js':{format:"system"},'./agency-7f59a25d.js':{format:"system"},'./references-3132a301.js':{format:"system"},'./contact-031a3b35.js':{format:"system"},'./footer-62ad4f8b.js':{format:"system"}}});System["import"]("./__root_module__.js").then(function(m){System.trace=false;m.renderFrozenPart();});System.register("0",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage'],function(exports){'use strict';return{setters:[function(module){exports('renderFrozenPart',module.l);},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){}};});System.register("1",['lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage'],function(exports,module){'use strict';var parseFunction,ReplaceVisitor,stringify,transformJSX,modules,ObjectDBHTTPInterface,Database;return{setters:[function(module){parseFunction=module.parseFunction;ReplaceVisitor=module.ReplaceVisitor;stringify=module.stringify;},function(){},function(module){transformJSX=module["default"];},function(module){modules=module;},function(module){ObjectDBHTTPInterface=module.ObjectDBHTTPInterface;Database=module.Database;}],execute:function execute(){var _varRecorder__$Q$com,_varRecorder__$Q$com2;exports({P:Path,a:promise,b:signal,c:connect,h:rect,i:initializeClass,l:renderFrozenPart,o:once$1,p:pt,r:resource});var parameterRegex=/function[^\(]*\(([^\)]*)\)|\(?([^\)=]*)\)?\s*=>/;var Closure=/*#__PURE__*/function(){_createClass(Closure,null,[{key:"fromFunction",value:function fromFunction(func,varMapping){/* show-in-doc */return new this(func,varMapping||{});}},{key:"fromSource",value:function fromSource(source,varMapping){/* show-in-doc */return new this(null,varMapping||{},source);}}]);function Closure(func,varMapping,source,funcProperties){_classCallCheck(this,Closure);this.originalFunc=func;this.varMapping=varMapping||{};this.setFuncSource(source||func);this.setFuncProperties(func||funcProperties);}_createClass(Closure,[{key:"setFuncSource",// accessing
value:function setFuncSource(src){/* show-in-doc */src=typeof lively!=='undefined'&&lively.sourceTransform&&typeof lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder==='function'?lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder(src):String(src);return this.source=src;}},{key:"getFuncSource",value:function getFuncSource(){/* show-in-doc */return this.source||this.setFuncSource(this.originalFunc);}},{key:"hasFuncSource",value:function hasFuncSource(){/* show-in-doc */return this.source&&true;}},{key:"getFunc",value:function getFunc(){/* show-in-doc */return this.originalFunc||this.recreateFunc();}},{key:"getFuncProperties",value:function getFuncProperties(){// ignore-in-doc
// a function may have state attached
return this.funcProperties||(this.funcProperties={});}},{key:"setFuncProperties",value:function setFuncProperties(obj){// ignore-in-doc
var props=this.getFuncProperties();for(var name in obj){// The AST implementation assumes that Function objects are some
// kind of value object. When their identity changes cached state
// should not be carried over to new function instances. This is a
// pretty intransparent way to invalidate attributes that are used
// for caches.
// @cschuster, can you please fix this by making invalidation more
// explicit?
if(obj.hasOwnProperty(name))props[name]=obj[name];}}},{key:"lookup",value:function lookup(name){/* show-in-doc */return this.varMapping[name];}},{key:"parameterNames",value:function parameterNames(methodString){// ignore-in-doc
if(typeof lively!=='undefined'&&lively.ast&&lively.ast.parseFunction){return(lively.ast.parseFunction(methodString).params||[]).map(function(ea){if(ea.type==='Identifier')return ea.name;if(ea.left&&ea.left.type==='Identifier')return ea.left.name;return null;}).filter(Boolean);}var paramsMatch=parameterRegex.exec(methodString);if(!paramsMatch)return[];var paramsString=paramsMatch[1]||paramsMatch[2]||'';return paramsString.split(',').map(function(ea){return ea.trim();});}},{key:"firstParameter",value:function firstParameter(src){// ignore-in-doc
return this.parameterNames(src)[0]||null;}// -=-=-=-=-=-=-=-=-=-
// function creation
// -=-=-=-=-=-=-=-=-=-
},{key:"recreateFunc",value:function recreateFunc(){// Creates a real function object
return this.recreateFuncFromSource(this.getFuncSource(),this.originalFunc);}},{key:"recreateFuncFromSource",value:function recreateFuncFromSource(funcSource,optFunc){// ignore-in-doc
// what about objects that are copied by value, e.g. numbers?
// when those are modified after the originalFunc we captured
// varMapping then we will have divergent state
var closureVars=[];var specificSuperHandling=this.firstParameter(funcSource)==='$super';for(var name in this.varMapping){if(!this.varMapping.hasOwnProperty(name))continue;if(name=='this'){continue;}// closureVars.push(`var ${name} = this.varMapping.${name};\n`);
closureVars.push('var '+name+' = this.varMapping.'+name+';\n');}var src='';if(closureVars.length>0)src+=closureVars.join('\n');if(specificSuperHandling)src+='(function superWrapperForClosure() { return ';src+='('+funcSource+')';if(specificSuperHandling){src+='.apply(this, [$super.bind(this)]'+'.concat(Array.from(arguments))) })';}try{var func=evalJS.call(this,src)||this.couldNotCreateFunc(src);this.addFuncProperties(func);this.originalFunc=func;return func;}catch(e){// var msg = `Cannot create function ${e} src: ${src}`;
var msg='Cannot create function '+e+' src: '+src;console.error(msg);throw new Error(msg);}}},{key:"addFuncProperties",value:function addFuncProperties(func){// ignore-in-doc
var props=this.getFuncProperties();for(var name in props){if(props.hasOwnProperty(name)){func[name]=props[name];}}this.addClosureInformation(func);}},{key:"couldNotCreateFunc",value:function couldNotCreateFunc(src){// ignore-in-doc
var msg='Could not recreate closure from source: \n'+src;console.error(msg);return function(){throw new Error(msg);};}// -=-=-=-=-=-
// conversion
// -=-=-=-=-=-
},{key:"asFunction",value:function asFunction(){/* ignore-in-doc */return this.recreateFunc();}// -=-=-=-=-=-=-=-=-=-=-=-
// function modification
// -=-=-=-=-=-=-=-=-=-=-=-
},{key:"addClosureInformation",value:function addClosureInformation(f){/* ignore-in-doc-in-doc */f.hasLivelyClosure=true;f.livelyClosure=this;return f;}},{key:"isLivelyClosure",get:function get(){return true;}// serialization
},{key:"doNotSerialize",get:function get(){return['originalFunc'];}}]);return Closure;}();// show-in-doc
var Group=/*#__PURE__*/function(){function Group(){_classCallCheck(this,Group);}_createClass(Group,[{key:"toArray",value:function toArray(){// Example:
// var group = arr.groupBy([1,2,3,4,5], function(n) { return n % 2; })
// group.toArray(); // => [[2,4],[1,3,5]]
return this.reduceGroups(function(all,_,group){return all.concat([group]);},[]);}},{key:"forEach",value:function forEach(iterator,context){// Iteration for each item in each group, called like `iterator(groupKey, groupItem)`
var groups=this;Object.keys(groups).forEach(function(groupName){groups[groupName].forEach(iterator.bind(context,groupName));});return groups;}},{key:"forEachGroup",value:function forEachGroup(iterator,context){// Iteration for each group, called like `iterator(groupKey, group)`
var groups=this;Object.keys(groups).forEach(function(groupName){iterator.call(context,groupName,groups[groupName]);});return groups;}},{key:"map",value:function map(iterator,context){// Map for each item in each group, called like `iterator(groupKey, group)`
var result=new Group();this.forEachGroup(function(groupName,group){result[groupName]=group.map(iterator.bind(context,groupName));});return result;}},{key:"mapGroups",value:function mapGroups(iterator,context){// Map for each group, called like `iterator(groupKey, group)`
var result=new Group();this.forEachGroup(function(groupName,group){result[groupName]=iterator.call(context,groupName,group);});return result;}},{key:"keys",value:function keys(){// show-in-docs
return Object.keys(this);}},{key:"reduceGroups",value:function reduceGroups(iterator,carryOver,context){// Reduce/fold for each group, called like `iterator(carryOver, groupKey, group)`
this.forEachGroup(function(groupName,group){carryOver=iterator.call(context,carryOver,groupName,group);});return carryOver;}},{key:"count",value:function count(){// counts the elements of each group
return this.reduceGroups(function(groupCount,groupName,group){groupCount[groupName]=group.length;return groupCount;},{});}}],[{key:"fromArray",value:function fromArray(array,hashFunc,context){// Example:
// Group.fromArray([1,2,3,4,5,6], function(n) { return n % 2; })
// // => {"0": [2,4,6], "1": [1,3,5]}
var grouping=new Group();for(var _i2=0,len=array.length;_i2<len;_i2++){var _hash=hashFunc.call(context,array[_i2],_i2);if(Group.prototype.hasOwnProperty(_hash))_hash='_'+_hash;if(!grouping[_hash])grouping[_hash]=[];grouping[_hash].push(array[_i2]);}return grouping;}},{key:"by",get:function get(){return groupBy;}}]);return Group;}();/* global System, global */var GLOBAL=typeof System!=='undefined'?System.global:typeof window!=='undefined'?window:global;var features={from:!!Array.from,filter:!!Array.prototype.filter,find:!!Array.prototype.find,findIndex:!!Array.prototype.findIndex,includes:!!Array.prototype.includes};// variety of functions for Arrays
// -=-=-=-=-=-=-=-
// array creations
// -=-=-=-=-=-=-=-
function range(begin,end,step){// Examples:
//   arr.range(0,5) // => [0,1,2,3,4,5]
//   arr.range(0,10,2) // => [0,2,4,6,8,10]
step=step||0;var result=[];if(begin<=end){if(step<=0)step=-step||1;for(var i=begin;i<=end;i+=step){result.push(i);}}else{if(step>=0)step=-step||-1;for(var i=begin;i>=end;i+=step){result.push(i);}}return result;}var from=features.from?Array.from:function(iterable){// Makes JS arrays out of array like objects like `arguments` or DOM `childNodes`
if(!iterable)return[];if(Array.isArray(iterable))return iterable;if(iterable.toArray)return iterable.toArray();var length=iterable.length;var results=new Array(length);while(length--){results[length]=iterable[length];}return results;};function withN(n,obj){// Example:
//   arr.withN(3, "Hello") // => ["Hello","Hello","Hello"]
var result=new Array(n);while(n>0){result[--n]=obj;}return result;}function genN(n,generator){// Number -> Function -> Array
// Takes a generator function that is called for each `n`.
// Example:
//   arr.genN(3, num.random) // => [46,77,95]
var result=new Array(n);while(n>0){result[--n]=generator(n);}return result;}// -=-=-=-=-
// filtering
// -=-=-=-=-
function filter(array,iterator,context){// [a] -> (a -> Boolean) -> c? -> [a]
// Calls `iterator` for each element in `array` and returns a subset of it
// including the elements for which `iterator` returned a truthy value.
// Like `Array.prototype.filter`.
var res=[];for(var idx=0;idx<array.length;idx++){var currentItem=array[idx];if(iterator.call(context,currentItem)){res.push(currentItem);}}return res;}var detect=features.find?function(arr,iterator,context){return arr.find(iterator,context);}:function(arr,iterator,context){// [a] -> (a -> Boolean) -> c? -> a
// returns the first occurrence of an element in `arr` for which iterator
// returns a truthy value
for(var value,i=0,len=arr.length;i<len;i++){value=arr[i];if(iterator.call(context,value,i))return value;}return undefined;};var findIndex=features.findIndex?function(arr,iterator,context){return arr.findIndex(iterator,context);}:function(arr,iterator,context){var i=-1;return arr.find(function(ea,j){i=j;return iterator.call(ea,context);})?i:-1;};function findAndGet(arr,iterator){// find the first occurence for which `iterator` returns a truthy value and
// return *this* value, i.e. unlike find the iterator result and not the
// element of the list is returned
var result;arr.find(function(ea,i){return result=iterator(ea,i);});return result;}function filterByKey(arr,key){// [a] -> String -> [a]
// Example:
//   var objects = [{x: 3}, {y: 4}, {x:5}]
//   arr.filterByKey(objects, "x") // => [{x: 3},{x: 5}]
return arr.filter(function(ea){return!!ea[key];});}function grep(arr,test,context){// [a] -> String|RegExp -> [a]
// `filter` can be a String or RegExp. Will stringify each element in
// Example:
// ["Hello", "World", "Lively", "User"].grep("l") // => ["Hello","World","Lively"]
if(typeof test==='string')test=new RegExp(test,'i');return filter(arr,filter.test.bind(test));}function mask(array,mask){// select every element in array for which array's element is truthy
// Example: [1,2,3].mask([false, true, false]) => [2]
return filter(array,function(_,i){return!!mask[i];});}function reject(array,func,context){// show-in-doc
function iterator(val,i){return!func.call(context,val,i);}return filter(array,iterator);}function rejectByKey(array,key){// show-in-doc
return filter(array,function(ea){return!ea[key];});}function without(array,elem){// non-mutating
// Example:
// arr.without([1,2,3,4,5,6], 3) // => [1,2,4,5,6]
return filter(array,function(val){return val!==elem;});}function withoutAll(array,otherArr){// non-mutating
// Example:
// arr.withoutAll([1,2,3,4,5,6], [3,4]) // => [1,2,5,6]
return filter(array,function(val){return otherArr.indexOf(val)===-1;});}function uniq(array,sorted){// non-mutating
// Removes duplicates from array.
// if sorted == true then assume array is sorted which allows uniq to be more
// efficient
// uniq([3,5,6,2,3,4,2,6,4])
if(!array.length)return array;var result=[array[0]];if(sorted){for(var _i3=1;_i3<array.length;_i3++){var val=array[_i3];if(val!==result[result.length]){result.push(val);}}}else{for(var _i4=1;_i4<array.length;_i4++){var _val=array[_i4];if(result.indexOf(_val)===-1){result.push(_val);}}}return result;}function uniqBy(array,comparator,context){// like `arr.uniq` but with custom equality: `comparator(a,b)` returns
// BOOL. True if a and be should be regarded equal, false otherwise.
var result=array.slice();for(var _i5=result.length;_i5--;){var item=array[_i5];for(var _j=_i5+1;_j<result.length;_j++){if(comparator.call(context,item,result[_j])){result.splice(_j--,1);}}}return result;}function uniqByKey(array,key){// like `arr.uniq` but with equality based on item[key]
var seen={};var result=[];for(var _i6=0;_i6<array.length;_i6++){var item=array[_i6];if(!seen[item[key]]){seen[item[key]]=true;result.push(item);}}return result;}function compact(array){// removes falsy values
// Example:
// arr.compact([1,2,undefined,4,0]) // => [1,2,4]
return filter(array,Boolean);}function mutableCompact(array){// fix gaps that were created with 'delete'
var i=0;var j=0;var len=array.length;while(i<len){if(array.hasOwnProperty(i))array[j++]=array[i];i++;}while(j++<len){array.pop();}return array;}// -=-=-=-=-
// iteration
// -=-=-=-=-
function forEach(array,iterator,context){// [a] -> (a -> Undefined) -> c? -> Undefined
// `iterator` is called on each element in `array` for side effects. Like
// `Array.prototype.forEach`.
return array.forEach(iterator,context);}function zip()/* arr, arr2, arr3 */{// Takes any number of lists as arguments. Combines them elment-wise.
// Example:
// arr.zip([1,2,3], ["a", "b", "c"], ["A", "B"])
// // => [[1,"a","A"],[2,"b","B"],[3,"c",undefined]]
var args=Array.from(arguments);var array=args.shift();var iterator=typeof last(args)==='function'?args.pop():function(x){return x;};var collections=[array].concat(args).map(function(ea){return Array.from(ea);});return array.map(function(value,index){return iterator(pluck(collections,index),index);});}function flatten(array,optDepth){// Turns a nested collection into a flat one.
// Example:
// arr.flatten([1, [2, [3,4,5], [6]], 7,8])
// // => [1,2,3,4,5,6,7,8]
if(typeof optDepth==='number'){if(optDepth<=0)return array;optDepth--;}return array.reduce(function(flattened,value){return flattened.concat(Array.isArray(value)?flatten(value,optDepth):[value]);},[]);}function flatmap(array,it,ctx){// the simple version
// Array.prototype.concat.apply([], array.map(it, ctx));
// causes stack overflows with really big arrays
var results=[];for(var _i7=0;_i7<array.length;_i7++){results.push.apply(results,it.call(ctx,array[_i7],_i7));}return results;}function interpose(array,delim){// Injects delim between elements of array
// Example:
// lively.lang.arr.interpose(["test", "abc", 444], "aha"));
// // => ["test","aha","abc","aha",444]
return array.reduce(function(xs,x){if(xs.length>0)xs.push(delim);xs.push(x);return xs;},[]);}function delimWith(array,delim){// ignore-in-doc
// previously used, use interpose now!
return interpose(array,delim);}// -=-=-=-=-
// mapping
// -=-=-=-=-
function map(array,iterator,context){// [a] -> (a -> b) -> c? -> [b]
// Applies `iterator` to each element of `array` and returns a new Array
// with the results of those calls. Like `Array.prototype.some`.
return array.map(iterator,context);}function invoke(array,method,arg1,arg2,arg3,arg4,arg5,arg6){// Calls `method` on each element in `array`, passing all arguments. Often
// a handy way to avoid verbose `map` calls.
// Example: arr.invoke(["hello", "world"], "toUpperCase") // => ["HELLO","WORLD"]
return array.map(function(ea){return ea[method](arg1,arg2,arg3,arg4,arg5,arg6);});}function pluck(array,property){// Returns `property` or undefined from each element of array. For quick
// `map`s and similar to `invoke`.
// Example: arr.pluck(["hello", "world"], 0) // => ["h","w"]
return array.map(function(ea){return ea[property];});}// -=-=-=-=-
// folding
// -=-=-=-=-
function reduce(array,iterator,memo,context){// Array -> Function -> Object? -> Object? -> Object?
// Applies `iterator` to each element of `array` and returns a new Array
// with the results of those calls. Like `Array.prototype.some`.
return array.reduce(iterator,memo,context);}function reduceRight(array,iterator,memo,context){// show-in-doc
return array.reduceRight(iterator,memo,context);}// -=-=-=-=-
// testing
// -=-=-=-=-
var isArray=Array.isArray;var includes=features.includes?function(array,object){return array.includes(object);}:function(array,object){// Example: arr.include([1,2,3], 2) // => true
return array.indexOf(object)!==-1;};var include=includes;function some(array,iterator,context){// [a] -> (a -> Boolean) -> c? -> Boolean
// Returns true if there is at least one abject in `array` for which
// `iterator` returns a truthy result. Like `Array.prototype.some`.
return array.some(iterator,context);}function every(array,iterator,context){// [a] -> (a -> Boolean) -> c? -> Boolean
// Returns true if for all abjects in `array` `iterator` returns a truthy
// result. Like `Array.prototype.every`.
return array.every(iterator,context);}function equals(array,otherArray){// Returns true iff each element in `array` is equal (`==`) to its
// corresponding element in `otherArray`
var len=array.length;if(!otherArray||len!==otherArray.length)return false;for(var _i8=0;_i8<len;_i8++){if(array[_i8]&&otherArray[_i8]&&array[_i8].equals&&otherArray[_i8].equals){if(!array[_i8].equals(otherArray[_i8])){return false;}else{continue;}}if(array[_i8]!=otherArray[_i8])return false;}return true;}function deepEquals(array,otherArray){// Returns true iff each element in `array` is structurally equal
// (`lang.obj.equals`) to its corresponding element in `otherArray`
var len=array.length;if(!otherArray||len!==otherArray.length)return false;for(var _i9=0;_i9<len;_i9++){if(!equals$1(array[_i9],otherArray[_i9]))return false;}return true;}// -=-=-=-=-
// sorting
// -=-=-=-=-
function isSorted(array,descending){if(descending){for(var i=1;i<array.length;i++){if(array[i-1]<array[i])return false;}}else{for(var i=1;i<array.length;i++){if(array[i-1]>array[i])return false;}}return true;}function sort(array,sortFunc){// [a] -> (a -> Number)? -> [a]
// Just `Array.prototype.sort`
return array.sort(sortFunc);}function sortBy(array,iterator,context){// Example:
// arr.sortBy(["Hello", "Lively", "User"], function(ea) {
//   return ea.charCodeAt(ea.length-1); }) // => ["Hello","User","Lively"]
return pluck(array.map(function(value,index){return{value:value,criteria:iterator.call(context,value,index)};}).sort(function(left,right){var a=left.criteria;var b=right.criteria;return a<b?-1:a>b?1:0;}),'value');}function sortByKey(array,key){// Example:
// lively.lang.arr.sortByKey([{x: 3}, {x: 2}, {x: 8}], "x")
// // => [{x: 2},{x: 3},{x: 8}]
return sortBy(array,function(ea){return ea[key];});}function reverse(array){return array.reverse();}function reversed(array){return array.slice().reverse();}// -=-=-=-=-=-=-=-=-=-=-=-=-
// RegExp / String matching
// -=-=-=-=-=-=-=-=-=-=-=-=-
function reMatches(arr,re,stringifier){// result might include null items if re did not match (usful for masking)
// Example:
//   var morphs = $world.withAllSubmorphsDo(function(x) { return x; ;
//   morphs.mask(morphs.reMatches(/code/i))
stringifier=stringifier||String;return arr.map(function(ea){return stringifier(ea).match(re);});}// -=-=-=-=-=-
// accessors
// -=-=-=-=-=-
function first(array){return array[0];}function last(array){return array[array.length-1];}// -=-=-=-=-=-=-=-
// Set operations
// -=-=-=-=-=-=-=-
function intersect(array1,array2){// set-like intersection
return filter(uniq(array1),function(item){return array2.indexOf(item)>-1;});}function union(array1,array2){// set-like union
var result=array1.slice();for(var _i10=0;_i10<array2.length;_i10++){var item=array2[_i10];if(result.indexOf(item)===-1)result.push(item);}return result;}function pushAt(array,item,index){// inserts `item` at `index`, mutating
array.splice(index,0,item);}function removeAt(array,index){// inserts item at `index`, mutating
array.splice(index,1);}function remove(array,item){// removes first occurrence of item in `array`, mutating
var index=array.indexOf(item);if(index>=0)removeAt(array,index);return item;}function pushAll(array,items){// appends all `items`, mutating
array.push.apply(array,items);return array;}function pushAllAt(array,items,idx){// inserts all `items` at `idx`, mutating
array.splice.apply(array,[idx,0].concat(items));}function pushIfNotIncluded(array,item){// only appends `item` if its not already in `array`, mutating
if(!array.includes(item))array.push(item);}function replaceAt(array,item,index){// mutating
array.splice(index,1,item);}function clear(array){// removes all items, mutating
array.length=0;return array;}function isSubset(list1,list2){// are all elements in list1 in list2?
for(var _i11=0;_i11<list1.length;_i11++){if(!list2.includes(list1[_i11])){return false;}}return true;}// -=-=-=-=-=-=-=-=-=-=-=-
// asynchronous iteration
// -=-=-=-=-=-=-=-=-=-=-=-
function doAndContinue(array,iterator,endFunc,context){// Iterates over array but instead of consecutively calling iterator,
// iterator gets passed in the invocation for the next iteration step
// as a function as first parameter. This allows to wait arbitrarily
// between operation steps, great for managing dependencies between tasks.
// Related is [`fun.composeAsync`]().
// Example:
// arr.doAndContinue([1,2,3,4], function(next, n) {
//   alert("At " + n);
//   setTimeout(next, 100);
// }, function() { alert("Done"); })
// // If the elements are functions you can leave out the iterator:
// arr.doAndContinue([
//   function(next) { alert("At " + 1); next(); },
//   function(next) { alert("At " + 2); next(); }
// ], null, function() { alert("Done"); });
endFunc=endFunc||Null;context=context||GLOBAL;iterator=iterator||function(next,ea,idx){ea.call(context,next,idx);};return array.reduceRight(function(nextFunc,ea,idx){return function(){iterator.call(context,nextFunc,ea,idx);};},endFunc)();}function nestedDelay(array,iterator,waitSecs,endFunc,context,optSynchronChunks){// Calls `iterator` for every element in `array` and waits between iterator
// calls `waitSecs`. Eventually `endFunc` is called. When passing a number n
// as `optSynchronChunks`, only every nth iteration is delayed.
endFunc=endFunc||function(){};return array.clone().reverse().reduce(function(nextFunc,ea,idx){return function(){iterator.call(context||GLOBAL,ea,idx);// only really delay every n'th call optionally
if(optSynchronChunks&&idx%optSynchronChunks!==0){nextFunc();}else{nextFunc.delay(waitSecs);}};},endFunc)();}function forEachShowingProgress()/* array, progressBar, iterator, labelFunc, whenDoneFunc, context or spec */{// ignore-in-doc
var args=Array.from(arguments);var array=args.shift();var steps=array.length;var progressBar;var iterator;var labelFunc;var whenDoneFunc;var context;var progressBarAdded=false;// init args
if(args.length===1){progressBar=args[0].progressBar;iterator=args[0].iterator;labelFunc=args[0].labelFunction;whenDoneFunc=args[0].whenDone;context=args[0].context;}else{progressBar=args[0];iterator=args[1];labelFunc=args[2];whenDoneFunc=args[3];context=args[4];}if(!context)context=typeof window!=='undefined'?window:global;if(!labelFunc)labelFunc=function labelFunc(x){return x;};// init progressbar
if(!progressBar){progressBarAdded=true;var Global=typeof window!=='undefined'?window:global;var world=Global.lively&&lively.morphic&&lively.morphic.World.current();progressBar=world?world.addProgressBar():{value:null,label:null,remove:function remove(){}};}progressBar.value=0;// nest functions so that the iterator calls the next after a delay
array.reduceRight(function(nextFunc,item,idx){return function(){try{progressBar.value=idx/steps;if(labelFunc)progressBar.label=labelFunc.call(context,item,idx);iterator.call(context,item,idx);}catch(e){console.error('Error in forEachShowingProgress at %s (%s)\n%s\n%s',idx,item,e,e.stack);}delay(nextFunc,0);};},function(){progressBar.value=1;if(progressBarAdded)(function(){progressBar.remove();}).delay(0);if(whenDoneFunc)whenDoneFunc.call(context);})();return array;}function swap(array,index1,index2){// mutating
// Example:
// var a = [1,2,3,4];
// arr.swap(a, 3, 1);
// a // => [1,4,3,2]
if(index1<0)index1=array.length+index1;if(index2<0)index2=array.length+index2;var temp=array[index1];array[index1]=array[index2];array[index2]=temp;return array;}function rotate(array,times){// non-mutating
// Example:
// arr.rotate([1,2,3]) // => [2,3,1]
times=times||1;return array.slice(times).concat(array.slice(0,times));}// -=-=-=-=-
// grouping
// -=-=-=-=-
function groupBy(array,iterator,context){// Applies `iterator` to each element in `array`, and puts the return value
// into a collection (the group) associated to it's stringified representation
// (the "hash").
// See [`Group.prototype`] for available operations on groups.
// Example:
// Example 1: Groups characters by how often they occur in a string:
// var chars = arr.from("Hello World");
// arr.groupBy(arr.uniq(chars), function(c) {
//   return arr.count(chars, c); })
// // => {
// //   "1": ["H","e"," ","W","r","d"],
// //   "2": ["o"],
// //   "3": ["l"]
// // }
// // Example 2: Group numbers by a custom qualifier:
// arr.groupBy([3,4,1,7,4,3,8,4], function(n) {
//   if (n <= 3) return "small";
//   if (n <= 7) return "medium";
//   return "large";
// });
// // => {
// //   large: [8],
// //   medium: [4,7,4,4],
// //   small: [3,1,3]
// // }
return Group.fromArray(array,iterator,context);}function groupByKey(array,key){// var objects = [{x: }]
// arr.groupBy(arr.uniq(chars), function(c) {
//   return arr.count(chars, c); })
// // => {
// //   "1": ["H","e"," ","W","r","d"],
// //   "2": ["o"],
// //   "3": ["l"]
// // }
return groupBy(array,function(ea){return ea[key];});}function partition(array,iterator,context){// Example:
// var array = [1,2,3,4,5,6];
// arr.partition(array, function(ea) { return ea > 3; })
// // => [[1,2,3,4],[5,6]]
iterator=iterator||function(x){return x;};var trues=[];var falses=[];array.forEach(function(value,index){(iterator.call(context,value,index)?trues:falses).push(value);});return[trues,falses];}function batchify(array,constrainedFunc,context){// Takes elements and fits them into subarrays (= batches) so that for
// each batch constrainedFunc returns true. Note that contrained func
// should at least produce 1-length batches, otherwise an error is raised
// Example:
// // Assume you have list of things that have different sizes and you want to
// // create sub-arrays of these things, with each sub-array having if possible
// // less than a `batchMaxSize` of combined things in it:
// var sizes = [
//   Math.pow(2, 15), // 32KB
//   Math.pow(2, 29), // 512MB
//   Math.pow(2, 29), // 512MB
//   Math.pow(2, 27), // 128MB
//   Math.pow(2, 26), // 64MB
//   Math.pow(2, 26), // 64MB
//   Math.pow(2, 24), // 16MB
//   Math.pow(2, 26)] // 64MB
// var batchMaxSize = Math.pow(2, 28)/*256MB*/;
// function batchConstrained(batch) {
//   return batch.length == 1 || batch.sum() < batchMaxSize;
// }
// var batches = sizes.batchify(batchConstrained);
// batches.pluck('length') // => [4,1,1,2]
// batches.map(arr.sum).map(num.humanReadableByteSize) // => ["208.03MB","512MB","512MB","128MB"]
return findBatches([],array);// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function extractBatch(batch,sizes){// ignore-in-doc
// Array -> Array -> Array[Array,Array]
// case 1: no sizes to distribute, we are done
if(!sizes.length)return[batch,[]];var first=sizes[0];var rest=sizes.slice(1);// if batch is empty we have to take at least one
// if batch and first still fits, add first
var candidate=batch.concat([first]);if(constrainedFunc.call(context,candidate))return extractBatch(candidate,rest);// otherwise leave first out for now
var batchAndSizes=extractBatch(batch,rest);return[batchAndSizes[0],[first].concat(batchAndSizes[1])];}function findBatches(batches,sizes){if(!sizes.length)return batches;var extracted=extractBatch([],sizes);if(!extracted[0].length){throw new Error('Batchify constrained does not ensure consumption '+'of at least one item per batch!');}return findBatches(batches.concat([extracted[0]]),extracted[1]);}}function toTuples(array,tupleLength){// Creates sub-arrays with length `tupleLength`
// Example:
// arr.toTuples(["H","e","l","l","o"," ","W","o","r","l","d"], 4)
// // => [["H","e","l","l"],["o"," ","W","o"],["r","l","d"]]
tupleLength=tupleLength||1;return range(0,Math.ceil(array.length/tupleLength)-1).map(function(n){return array.slice(n*tupleLength,n*tupleLength+tupleLength);},array);}var permutations=function(){function computePermutations(restArray,values){return!restArray.length?[values]:flatmap(restArray,function(ea,i){return computePermutations(restArray.slice(0,i).concat(restArray.slice(i+1)),values.concat([ea]));});}return function(array){return computePermutations(array,[]);};}();function combinationsPick(listOfListsOfValues,pickIndices){// Given a "listOfListsOfValues" in the form of an array of arrays and
// `pickIndices` list with the size of the number of arrays which indicates what
// values to pick from each of the arrays, return a list with two values:
// 1. values picked from each of the arrays, 2. the next pickIndices or null if at end
// Example:
//  var searchSpace = [["a", "b", "c"], [1,2]];
//  arr.combinationsPick(searchSpace, [0,1]);
//    // => [["a",2], [1,0]]
//  arr.combinationsPick(searchSpace, [1,0]);
//    // => [["b",1], [1,1]]
var values=listOfListsOfValues.map(function(subspace,i){return subspace[pickIndices[i]];});var nextState=pickIndices.slice();for(var _i12=listOfListsOfValues.length;_i12--;_i12>=0){var subspace=listOfListsOfValues[_i12];var nextIndex=nextState[_i12]+1;if(subspace[nextIndex]){nextState[_i12]=nextIndex;break;}else if(_i12===0){nextState=undefined;break;}else{nextState[_i12]=0;}}return[values,nextState];}function combinations(listOfListsOfValues){// Given a "listOfListsOfValues" in the form of an array of arrays,
// retrieve all the combinations by picking one item from each array.
// This basically creates a search tree, traverses it and gathers all node
// values whenever a leaf node is reached.
// Example:
//   lively.lang.arr.combinations([['a', 'b', 'c'], [1, 2]])
//    // => [["a", 1], ["a", 2], ["b", 1], ["b", 2], ["c", 1], ["c", 2]]
var size=listOfListsOfValues.reduce(function(prod,space){return prod*space.length;},1);var searchState=listOfListsOfValues.map(function(_){return 0;});var results=new Array(size);for(var _i13=0;_i13<size;_i13++){var result=combinationsPick(listOfListsOfValues,searchState);results[_i13]=result[0];searchState=result[1];}return results;}function take(arr,n){return arr.slice(0,n);}function drop(arr,n){return arr.slice(n);}function takeWhile(arr,fun,context){var i=0;for(;i<arr.length;i++){if(!fun.call(context,arr[i],i))break;}return arr.slice(0,i);}function dropWhile(arr,fun,context){var i=0;for(;i<arr.length;i++){if(!fun.call(context,arr[i],i))break;}return arr.slice(i);}// -=-=-=-=-=-
// randomness
// -=-=-=-=-=-
function shuffle(array){// Ramdomize the order of elements of array. Does not mutate array.
// Example:
// shuffle([1,2,3,4,5]) // => [3,1,2,5,4]
var unusedIndexes=range(0,array.length-1);var shuffled=Array(array.length);for(var _i14=0;_i14<array.length;_i14++){var shuffledIndex=unusedIndexes.splice(Math.round(Math.random()*(unusedIndexes.length-1)),1);shuffled[shuffledIndex]=array[_i14];}return shuffled;}// -=-=-=-=-=-=-=-
// Number related
// -=-=-=-=-=-=-=-
function max(array,iterator,context){// Example:
//   var array = [{x:3,y:2}, {x:5,y:1}, {x:1,y:5}];
//   arr.max(array, function(ea) { return ea.x; }) // => {x: 5, y: 1}
iterator=iterator||function(x){return x;};var result;array.reduce(function(max,ea,i){var val=iterator.call(context,ea,i);if(typeof val!=='number'||val<=max)return max;result=ea;return val;},-Infinity);return result;}function min(array,iterator,context){// Similar to `arr.max`.
iterator=iterator||function(x){return x;};return max(array,function(ea,i){return-iterator.call(context,ea,i);});}function sum(array){// show-in-doc
var sum=0;for(var _i15=0;_i15<array.length;_i15++){sum+=array[_i15];}return sum;}function count(array,item){return array.reduce(function(count,ea){return ea===item?count+1:count;},0);}function size(array){return array.length;}function histogram(data,binSpec){// ignore-in-doc
// Without a `binSpec` argument partition the data
// var numbers = arr.genN(10, num.random);
// var numbers = arr.withN(10, "a");
// => [65,73,34,94,92,31,27,55,95,48]
// => [[65,73],[34,94],[92,31],[27,55],[95,48]]
// => [[82,50,16],[25,43,77],[40,64,31],[51,39,13],[17,34,87],[51,33,30]]
if(typeof binSpec==='undefined'||typeof binSpec==='number'){var binNumber=binSpec||function sturge(){return Math.ceil(Math.log(data.length)/Math.log(2)+1);}();var binSize=Math.ceil(Math.round(data.length/binNumber));return range(0,binNumber-1).map(function(i){return data.slice(i*binSize,(i+1)*binSize);});}else if(binSpec instanceof Array){// ignore-in-doc
// bins specifies n threshold values that will create n-1 bins.
// Each data value d is placed inside a bin i if:
// threshold[i] >= d && threshold[i+1] < d
var thresholds=binSpec;return data.reduce(function(bins,d){if(d<thresholds[1]){bins[0].push(d);return bins;}for(var _i16=1;_i16<thresholds.length;_i16++){if(d>=thresholds[_i16]&&(!thresholds[_i16+1]||d<=thresholds[_i16+1])){bins[_i16].push(d);return bins;}}throw new Error("Histogram creation: Cannot group data ".concat(d," into thresholds ").concat(thresholds));},range(1,thresholds.length).map(function(){return[];}));}}// -=-=-=-=-
// Copying
// -=-=-=-=-
function clone(array){// shallow copy
return[].concat(array);}// -=-=-=-=-=-
// conversion
// -=-=-=-=-=-
function toArray(array){return from(array);}// -=-=-=-=-=-
// DEPRECATED
// -=-=-=-=-=-
function each(arr,iterator,context){return arr.forEach(iterator,context);}function all(arr,iterator,context){return arr.every(iterator,context);}function any(arr,iterator,context){return arr.some(iterator,context);}function collect(arr,iterator,context){return arr.map(iterator,context);}function findAll(arr,iterator,context){return filter(arr,iterator,context);}function inject(array,memo,iterator,context){if(context)iterator=iterator.bind(context);return array.reduce(iterator,memo);}// asynch methods
function mapAsyncSeries(array,iterator,callback){// Apply `iterator` over `array`. Unlike `mapAsync` the invocation of
// the iterator happens step by step in the order of the items of the array
// and not concurrently.
// ignore-in-doc
// Could simply be:
// return exports.arr.mapAsync(array, {parallel: 1}, iterator, callback);
// but the version below is 2x faster
var result=[];var callbackTriggered=false;return array.reduceRight(function(nextFunc,ea,idx){if(callbackTriggered)return;return function(err,eaResult){if(err)return maybeDone(err);if(idx>0)result.push(eaResult);try{iterator(ea,idx,once(nextFunc));}catch(e){maybeDone(e);}};},function(err,eaResult){result.push(eaResult);maybeDone(err,true);})();function maybeDone(err,finalCall){if(callbackTriggered||!err&&!finalCall)return;callbackTriggered=true;try{callback(err,result);}catch(e){console.error('Error in mapAsyncSeries - callback invocation error:\n'+(e.stack||e));}}}function mapAsync(array,options,iterator,callback){// Apply `iterator` over `array`. In each iterator gets a callback as third
// argument that should be called when the iteration is done. After all
// iterators have called their callbacks, the main `callback` function is
// invoked with the result array.
// Example:
// lively.lang.arr.mapAsync([1,2,3,4],
//   function(n, i, next) { setTimeout(function() { next(null, n + i); }, 20); },
//   function(err, result) { /* result => [1,3,5,7] */ });
if(typeof options==='function'){callback=iterator;iterator=options;options=null;}options=options||{};if(!array.length)return callback&&callback(null,[]);if(!options.parallel)options.parallel=Infinity;var results=[];var completed=[];var callbackTriggered=false;var lastIteratorIndex=0;var nActive=0;var iterators=array.map(function(item,i){return function(){nActive++;try{iterator(item,i,once(function(err,result){results[i]=err||result;maybeDone(i,err);}));}catch(e){maybeDone(i,e);}};});return activate();// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function activate(){while(nActive<options.parallel&&lastIteratorIndex<array.length){iterators[lastIteratorIndex++]();}}function maybeDone(idx,err){if(completed.indexOf(idx)>-1)return;completed.push(idx);nActive--;if(callbackTriggered)return;if(!err&&completed.length<array.length){activate();return;}callbackTriggered=true;try{callback&&callback(err,results);}catch(e){console.error('Error in mapAsync - main callback invocation error:\n'+(e.stack||e));}}}// poly-filling...
if(!features.from)Array.from=from;if(!features.filter)Array.prototype.filter=function(it,ctx){return filter(this,it,ctx);};if(!features.find)Array.prototype.find=function(it,ctx){return detect(this,it,ctx);};if(!features.findIndex)Array.prototype.findIndex=function(it,ctx){return findIndex(this,it,ctx);};if(!features.includes)Array.prototype.includes=function(x){return includes(this,x);};var arr=/*#__PURE__*/Object.freeze({__proto__:null,range:range,from:from,withN:withN,genN:genN,filter:filter,detect:detect,findIndex:findIndex,findAndGet:findAndGet,filterByKey:filterByKey,grep:grep,mask:mask,reject:reject,rejectByKey:rejectByKey,without:without,withoutAll:withoutAll,uniq:uniq,uniqBy:uniqBy,uniqByKey:uniqByKey,compact:compact,mutableCompact:mutableCompact,forEach:forEach,zip:zip,flatten:flatten,flatmap:flatmap,interpose:interpose,delimWith:delimWith,map:map,invoke:invoke,pluck:pluck,reduce:reduce,reduceRight:reduceRight,isArray:isArray,includes:includes,include:include,some:some,every:every,equals:equals,deepEquals:deepEquals,isSorted:isSorted,sort:sort,sortBy:sortBy,sortByKey:sortByKey,reverse:reverse,reversed:reversed,reMatches:reMatches,first:first,last:last,intersect:intersect,union:union,pushAt:pushAt,removeAt:removeAt,remove:remove,pushAll:pushAll,pushAllAt:pushAllAt,pushIfNotIncluded:pushIfNotIncluded,replaceAt:replaceAt,clear:clear,isSubset:isSubset,doAndContinue:doAndContinue,nestedDelay:nestedDelay,forEachShowingProgress:forEachShowingProgress,swap:swap,rotate:rotate,groupBy:groupBy,groupByKey:groupByKey,partition:partition,batchify:batchify,toTuples:toTuples,permutations:permutations,combinationsPick:combinationsPick,combinations:combinations,take:take,drop:drop,takeWhile:takeWhile,dropWhile:dropWhile,shuffle:shuffle,max:max,min:min,sum:sum,count:count,size:size,histogram:histogram,clone:clone,toArray:toArray,each:each,all:all,any:any,collect:collect,findAll:findAll,inject:inject,mapAsyncSeries:mapAsyncSeries,mapAsync:mapAsync});exports('k',arr);/* global clearTimeout, setTimeout */ // -=-=-=-=-=-=-=-=-
// static functions
// -=-=-=-=-=-=-=-=-
function Empty(){/* `function() {}` */return function(){};}function K(){/* `function(arg) { return arg; }` */return function(arg){return arg;};}function Null(){/* `function() { return null; }` */return function(){return null;};}function False(){/* `function() { return false; }` */return function(){return false;};}function True(){/* `function() { return true; }` */return function(){return true;};}function notYetImplemented(){return function(){throw new Error('Not yet implemented');};}// -=-=-=-=-=-
// accessing
// -=-=-=-=-=-
function all$1(object){// Returns all property names of `object` that reference a function.
// Example:
// var obj = {foo: 23, bar: function() { return 42; }};
// all(obj) // => ["bar"]
var a=[];for(var name in object){if(!object.__lookupGetter__(name)&&typeof object[name]==='function')a.push(name);}return a;}function own(object){// Returns all local (non-prototype) property names of `object` that
// reference a function.
// Example:
// var obj1 = {foo: 23, bar: function() { return 42; }};
// var obj2 = {baz: function() { return 43; }};
// obj2.__proto__ = obj1
// own(obj2) // => ["baz"]
// /*vs.*/ all(obj2) // => ["baz","bar"]
var a=[];for(var name in object){if(!object.__lookupGetter__(name)&&object.hasOwnProperty(name)&&typeof object[name]==='function')a.push(name);}return a;}// -=-=-=-=-=-
// inspection
// -=-=-=-=-=-
function argumentNames(f){// Example:
// argumentNames(function(arg1, arg2) {}) // => ["arg1","arg2"]
// argumentNames(function(/*var args*/) {}) // => []
if(f.superclass)return[];// it's a class...
var src=f.toString();var names='';var arrowMatch=src.match(/(?:\(([^\)]*)\)|([^\(\)-+!]+))\s*=>/);if(arrowMatch)names=arrowMatch[1]||arrowMatch[2]||'';else{var headerMatch=src.match(/^[\s\(]*function[^(]*\(([^)]*)\)/);if(headerMatch&&headerMatch[1])names=headerMatch[1];}return names.replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,'').replace(/\s+/g,'').split(',').map(function(ea){return ea.trim();}).filter(function(name){return!!name;});}function qualifiedMethodName(f){// ignore-in-doc
var objString='';if(f.declaredClass){objString+=f.declaredClass+'>>';}else if(f.declaredObject){objString+=f.declaredObject+'.';}return objString+(f.methodName||f.displayName||f.name||'anonymous');}function extractBody(func){// superflous indent. Useful when you have to stringify code but not want
// to construct strings by hand.
// Example:
// extractBody(function(arg) {
//   var x = 34;
//   alert(2 + arg);
// }) => "var x = 34;\nalert(2 + arg);"
var codeString=String(func).replace(/^function[^\{]+\{\s*/,'').replace(/\}$/,'').trim();var lines=codeString.split(/\n|\r/);var indent;for(var _i17=0;_i17<lines.length;_i17++){var _m=lines[_i17].match(/^(\s+)[^\s]/);if(_m&&(indent===undefined||_m[1].length<indent.length))indent=_m[1];}return indent?codeString.replace(new RegExp('^'+indent,'gm'),''):codeString;}// -=-=-=-
// timing
// -=-=-=-
function timeToRun(func){// returns synchronous runtime of calling `func` in ms
// Example:
// timeToRun(function() { new WebResource("http://google.de").beSync().get() });
// // => 278 (or something else...)
var startTime=Date.now();func();return Date.now()-startTime;}function timeToRunN(func,n){// Like `timeToRun` but calls function `n` times instead of once. Returns
// the average runtime of a call in ms.
var startTime=Date.now();for(var _i18=0;_i18<n;_i18++){func();}return(Date.now()-startTime)/n;}function delay(func,timeout/*, arg1...argN */){// Delays calling `func` for `timeout` seconds(!).
// Example:
// (function() { alert("Run in the future!"); }).delay(1);
var args=Array.prototype.slice.call(arguments);var __method=args.shift();var timeout=args.shift()*1000;return setTimeout(function delayed(){return __method.apply(__method,args);},timeout);}// these last two methods are Underscore.js 1.3.3 and are slightly adapted
// Underscore.js license:
// (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Underscore is distributed under the MIT license.
function throttle(func,wait){// Exec func at most once every wait ms even when called more often
// useful to calm down eagerly running updaters and such.
// Example:
// var i = 0;
// var throttled = throttle(function() { alert(++i + '-' + Date.now()) }, 500);
// Array.range(0,100).forEach(function(n) { throttled() });
var context;var args;var timeout;var throttling;var more;var result;var whenDone=debounce(wait,function(){more=throttling=false;});return function(){context=this;args=arguments;var later=function later(){timeout=null;if(more)func.apply(context,args);whenDone();};if(!timeout)timeout=setTimeout(later,wait);if(throttling){more=true;}else{result=func.apply(context,args);}whenDone();throttling=true;return result;};}function debounce(wait,func,immediate){// Call `func` after `wait` milliseconds elapsed since the last invocation.
// Unlike `throttle` an invocation will restart the wait period. This is
// useful if you have a stream of events that you want to wait for to finish
// and run a subsequent function afterwards. When you pass arguments to the
// debounced functions then the arguments from the last call will be use for
// the invocation.
//
// With `immediate` set to true, immediately call `func` but when called again during `wait` before
// wait ms are done nothing happens. E.g. to not exec a user invoked
// action twice accidentally.
// Example:
// var start = Date.now();
// var f = debounce(200, function(arg1) {
//   alert("running after " + (Date.now()-start) + "ms with arg " + arg1);
// });
// f("call1");
// delay(curry(f, "call2"), 0.1);
// delay(curry(f, "call3"), 0.15);
// => Will eventually output: "running after 352ms with arg call3"
var timeout;return function(){var context=this;var args=arguments;var later=function later(){timeout=null;if(!immediate)func.apply(context,args);};if(immediate&&!timeout)func.apply(context,args);clearTimeout(timeout);timeout=setTimeout(later,wait);};}var _throttledByName={};function throttleNamed(name,wait,func){// Like `throttle` but remembers the throttled function once created and
// repeated calls to `throttleNamed` with the identical name will use the same
// throttled function. This allows to throttle functions in a central place
// that might be called various times in different contexts without having to
// manually store the throttled function.
var store=_throttledByName;if(store[name])return store[name];function throttleNamedWrapper(){// ignore-in-doc, cleaning up
debounceNamed(name,wait,function(){delete store[name];})();return func.apply(this,arguments);}return store[name]=throttle(throttleNamedWrapper,wait);}var _debouncedByName={};function debounceNamed(name,wait,func,immediate){// Like `debounce` but remembers the debounced function once created and
// repeated calls to `debounceNamed` with the identical name will use the same
// debounced function. This allows to debounce functions in a central place
// that might be called various times in different contexts without having to
// manually store the debounced function.
var store=_debouncedByName;if(store[name])return store[name];function debounceNamedWrapper(){// ignore-in-doc, cleaning up
delete store[name];return func.apply(this,arguments);}return store[name]=debounce(wait,debounceNamedWrapper,immediate);}var _queues={};function createQueue(id,workerFunc){// A simple queue with an attached asynchronous `workerFunc` to process
// queued tasks. Calling `createQueue` will return an object with the
// following interface:
// ```js
// {
//   push: function(task) {/**/},
//   pushAll: function(tasks) {/**/},
//   handleError: function(err) {}, // Overwrite to handle errors
//   drain: function() {}, // Overwrite to react when the queue empties
// }
// Example:
// var sum = 0;
// var q = createQueue("example-queue", function(arg, thenDo) { sum += arg; thenDo(); });
// q.pushAll([1,2,3]);
// queues will be remembered by their name
// createQueue("example-queue").push(4);
// sum // => 6
var store=_queues;var queue=store[id]||(store[id]={_workerActive:false,worker:workerFunc,tasks:[],drain:null,// can be overwritten by a function
push:function push(task){queue.tasks.push(task);if(!queue._workerActive)queue.activateWorker();},pushAll:function pushAll(tasks){tasks.forEach(function(ea){queue.tasks.push(ea);});if(!queue._workerActive)queue.activateWorker();},pushNoActivate:function pushNoActivate(task){queue.tasks.push(task);},handleError:function handleError(err){// can be overwritten
err&&console.error('Error in queue: '+err);},activateWorker:function activateWorker(){function callback(err){queue.handleError(err);queue.activateWorker();}var tasks=queue.tasks;var active=queue._workerActive;if(tasks.length===0){if(active){queue._workerActive=false;if(typeof queue.drain==='function')queue.drain();}delete store[id];}else{if(!active)queue._workerActive=true;try{queue.worker(tasks.shift(),callback);}catch(err){callback(err);}}}});return queue;}var _queueUntilCallbacks={};function workerWithCallbackQueue(id,workerFunc,optTimeout){// This functions helps when you have a long running computation that
// multiple call sites (independent from each other) depend on. This
// function does the housekeeping to start the long running computation
// just once and returns an object that allows to schedule callbacks
// once the workerFunc is done.
// Example:
// var worker = workerWithCallbackQueue("example",
//   function slowFunction(thenDo) {
//     var theAnswer = 42;
//     setTimeout(function() { thenDo(null, theAnswer); });
//   });
// // all "call sites" depend on `slowFunction` but don't have to know about
// // each other
// worker.whenDone(function callsite1(err, theAnswer) { alert("callback1: " + theAnswer); })
// worker.whenDone(function callsite2(err, theAnswer) { alert("callback2: " + theAnswer); })
// workerWithCallbackQueue("example").whenDone(function callsite3(err, theAnswer) { alert("callback3: " + theAnswer); })
// // => Will eventually show: callback1: 42, callback2: 42 and callback3: 42
// ignore-in-doc
// This is how it works:
// If `id` does not exist, workerFunc is called, otherwise ignored.
// workerFunc is expected to call thenDoFunc with arguments: error, arg1, ..., argN
// if called subsequently before workerFunc is done, the other thenDoFunc
// will "pile up" and called with the same arguments as the first
// thenDoFunc once workerFunc is done
var store=_queueUntilCallbacks;var queueCallbacks=store[id];var isRunning=!!queueCallbacks;if(isRunning)return queueCallbacks;var callbacksRun=false;var canceled=false;function cleanup(){if(timeoutProc)clearTimeout(timeoutProc);callbacksRun=true;delete store[id];}function runCallbacks(args){if(callbacksRun)return;cleanup();queueCallbacks.callbacks.forEach(function(cb){try{cb.apply(null,args);}catch(e){console.error('Error when invoking callbacks in queueUntil ['+id+']:\n'+String(e.stack||e));}});}// timeout
if(optTimeout){var timeoutProc=setTimeout(function(){if(callbacksRun)return;runCallbacks([new Error('timeout')]);},optTimeout);}// init the store
queueCallbacks=store[id]={callbacks:[],cancel:function cancel(){canceled=true;cleanup();},whenDone:function whenDone(cb){queueCallbacks.callbacks.push(cb);return queueCallbacks;}};// call worker, but delay so we can immediately return
setTimeout(function(){if(canceled)return;try{workerFunc(function()/* args */{runCallbacks(arguments);});}catch(e){runCallbacks([e]);}},0);return queueCallbacks;}function _composeAsyncDefaultEndCallback(err,arg1/* err + args */){if(err)console.error('lively.lang.composeAsync error',err);}function composeAsync()/* functions */{// Composes functions that are asynchronous and expecting continuations to
// be called in node.js callback style (error is first argument, real
// arguments follow).
// A call like `composeAsync(f,g,h)(arg1, arg2)` has a flow of control like:
//  `f(arg1, arg2, thenDo1)` -> `thenDo1(err, fResult)`
// -> `g(fResult, thenDo2)` -> `thenDo2(err, gResult)` ->
// -> `h(fResult, thenDo3)` -> `thenDo2(err, hResult)`
// Example:
// composeAsync(
//   function(a,b, thenDo) { thenDo(null, a+b); },
//   function(x, thenDo) { thenDo(x*4); }
//  )(3,2, function(err, result) { alert(result); });
var toArray=Array.prototype.slice;var functions=toArray.call(arguments);var defaultEndCb=_composeAsyncDefaultEndCallback;var endCallback=defaultEndCb;var endSuccess;var endFailure;var endPromise=new Promise(function(resolve,reject){endSuccess=resolve;endFailure=reject;});return functions.reverse().reduce(function(prevFunc,funcOrPromise,i){var nextActivated=false;return function(){var args=toArray.call(arguments);// ignore-in-doc
// the last arg needs to be function, discard all non-args
// following it. This allows to have an optional callback func that can
// even be `undefined`, e.g. when calling this func from a callsite
// using var args;
if(endCallback===defaultEndCb&&i===functions.length-1/* first function */){while(args.length&&typeof args[args.length-1]!=='function'){args.pop();}if(typeof args[args.length-1]==='function')endCallback=args.pop();}function next()/* err and args */{nextActivated=true;var args=toArray.call(arguments);var err=args.shift();if(err){endCallback(err);endFailure(err);}else prevFunc.apply(null,args);}if(typeof funcOrPromise==='function'){try{var result=funcOrPromise.apply(this,args.concat([next]));if(result&&typeof result.then==='function'&&typeof result["catch"]==='function'){result.then(function(value){return next(null,value);})["catch"](function(err){return next(err);});}}catch(e){console.error('composeAsync: ',e.stack||e);if(!nextActivated){endCallback(e);endFailure(e);}}}else if(funcOrPromise&&typeof funcOrPromise.then==='function'&&typeof funcOrPromise["catch"]==='function'){funcOrPromise.then(function(value){next(null,value);})["catch"](function(err){next(err);});}else{var err=new Error('Invalid argument to composeAsync: '+funcOrPromise);endCallback(err);endFailure(err);}return endPromise;};},function(){var args=toArray.call(arguments);endCallback.apply(null,[null].concat(args));endSuccess(args[0]);});}function compose()/* functions */{// Composes synchronousefunctions:
// `compose(f,g,h)(arg1, arg2)` = `h(g(f(arg1, arg2)))`
// Example:
// compose(
//   function(a,b) { return a+b; },
//   function(x) {return x*4}
// )(3,2) // => 20
var functions=Array.prototype.slice.call(arguments);return functions.reverse().reduce(function(prevFunc,func){return function(){return prevFunc(func.apply(this,arguments));};},function(x){return x;});}function flip(f){// Swaps the first two args
// Example:
// flip(function(a, b, c) {
//   return a + b + c; })(' World', 'Hello', '!') // => "Hello World!"
return function flipped()/* args */{var args=Array.prototype.slice.call(arguments);var flippedArgs=[args[1],args[0]].concat(args.slice(2));return f.apply(null,flippedArgs);};}function withNull(func){// returns a modified version of func that will have `null` always curried
// as first arg. Usful e.g. to make a nodejs-style callback work with a
// then-able:
// Example:
// promise.then(withNull(cb)).catch(cb);
func=func||function(){};return function()/* args */{var args=from(arguments);func.apply(null,[null].concat(args));};}function waitFor(timeoutMs,waitTesterFunc,thenDo){// Wait for waitTesterFunc to return true, then run thenDo, passing
// failure/timout err as first parameter. A timout occurs after
// timeoutMs. During the wait period waitTesterFunc might be called
// multiple times.
var start=Date.now();var timeStep=50;if(!thenDo){thenDo=waitTesterFunc;waitTesterFunc=timeoutMs;timeoutMs=undefined;}(function test(){if(waitTesterFunc())return thenDo();if(timeoutMs){var duration=Date.now()-start;var timeLeft=timeoutMs-duration;if(timeLeft<=0)return thenDo(new Error('timeout'));if(timeLeft<timeStep)timeStep=timeLeft;}setTimeout(test,timeStep);})();}function waitForAll(options,funcs,thenDo){// Wait for multiple asynchronous functions. Once all have called the
// continuation, call `thenDo`.
// options can be: `{timeout: NUMBER}` (how long to wait in milliseconds).
if(!thenDo){thenDo=funcs;funcs=options;options=null;}options=options||{};var results=funcs.map(function(){return null;});if(!funcs.length){thenDo(null,results);return;}var leftFuncs=Array.prototype.slice.call(funcs);funcs.forEach(function(f,i){try{f(function()/* err and args */{var args=Array.prototype.slice.call(arguments);var err=args.shift();markAsDone(f,i,err,args);});}catch(e){markAsDone(f,i,e,null);}});if(options.timeout){setTimeout(function(){if(!leftFuncs.length)return;var missing=results.map(function(ea,i){return ea===null&&i;}).filter(function(ea){return typeof ea==='number';}).join(', ');var err=new Error('waitForAll timed out, functions at '+missing+' not done');markAsDone(null,null,err,null);},options.timeout);}function markAsDone(f,i,err,result){if(!leftFuncs.length)return;var waitForAllErr=null;var fidx=leftFuncs.indexOf(f);fidx>-1&&leftFuncs.splice(fidx,1);if(err){leftFuncs.length=0;waitForAllErr=new Error('in waitForAll at'+(typeof i==='number'?' '+i:'')+': \n'+(err.stack||String(err)));}else if(result)results[i]=result;if(!leftFuncs.length){setTimeout(function(){thenDo(waitForAllErr,results);},0);}}}// -=-=-=-=-
// wrapping
// -=-=-=-=-
function curry(func,arg1,arg2,argN/* func and curry args */){// Return a version of `func` with args applied.
// Example:
// var add1 = (function(a, b) { return a + b; }).curry(1);
// add1(3) // => 4
if(arguments.length<=1)return arguments[0];var args=Array.prototype.slice.call(arguments);var func=args.shift();function wrappedFunc(){return func.apply(this,args.concat(Array.prototype.slice.call(arguments)));}wrappedFunc.isWrapper=true;wrappedFunc.originalFunction=func;return wrappedFunc;}function wrap(func,wrapper){// A `wrapper` is another function that is being called with the arguments
// of `func` and a proceed function that, when called, runs the originally
// wrapped function.
// Example:
// function original(a, b) { return a+b }
// var wrapped = wrap(original, function logWrapper(proceed, a, b) {
//   alert("original called with " + a + "and " + b);
//   return proceed(a, b);
// })
// wrapped(3,4) // => 7 and a message will pop up
var __method=func;var wrappedFunc=function wrapped(){var args=Array.prototype.slice.call(arguments);var wrapperArgs=wrapper.isWrapper?args:[__method.bind(this)].concat(args);return wrapper.apply(this,wrapperArgs);};wrappedFunc.isWrapper=true;wrappedFunc.originalFunction=__method;return wrappedFunc;}function getOriginal(func){// Get the original function that was augmented by `wrap`. `getOriginal`
// will traversed as many wrappers as necessary.
while(func.originalFunction){func=func.originalFunction;}return func;}function wrapperChain(method){// Function wrappers used for wrapping, cop, and other method
// manipulations attach a property "originalFunction" to the wrapper. By
// convention this property references the wrapped method like wrapper
// -> cop wrapper -> real method.
// tThis method gives access to the linked list starting with the outmost
// wrapper.
var result=[];do{result.push(method);method=method.originalFunction;}while(method);return result;}function replaceMethodForOneCall(obj,methodName,replacement){// Change an objects method for a single invocation.
// Example:
// var obj = {foo: function() { return "foo"}};
// lively.lang.replaceMethodForOneCall(obj, "foo", function() { return "bar"; });
// obj.foo(); // => "bar"
// obj.foo(); // => "foo"
replacement.originalFunction=obj[methodName];var reinstall=obj.hasOwnProperty(methodName);obj[methodName]=function(){if(reinstall)obj[methodName]=replacement.originalFunction;else delete obj[methodName];return replacement.apply(this,arguments);};return obj;}function once(func){// Ensure that `func` is only executed once. Multiple calls will not call
// `func` again but will return the original result.
if(!func)return undefined;if(typeof func!=='function'){throw new Error('once() expecting a function');}var invoked=false;var result;return function(){if(invoked)return result;invoked=true;return result=func.apply(this,arguments);};}function either()/* funcs */{// Accepts multiple functions and returns an array of wrapped
// functions. Those wrapped functions ensure that only one of the original
// function is run (the first on to be invoked).
//
// This is useful if you have multiple asynchronous choices of how the
// control flow might continue but want to ensure that a continuation
// is  only triggered once, like in a timeout situation:
//
// ```js
// function outerFunction(callback) {
//   function timeoutAction() { callback(new Error('timeout!')); }
//   function otherAction() { callback(null, "All OK"); }
//   setTimeout(timeoutAction, 200);
//   doSomethingAsync(otherAction);
// }
// ```
//
// To ensure that `callback` only runs once you would normally have to write boilerplate like this:
//
// ```js
// var ran = false;
// function timeoutAction() { if (ran) return; ran = true; callback(new Error('timeout!')); }
// function otherAction() { if (ran) return; ran = true; callback(null, "All OK"); }
// ```
//
// Since this can get tedious an error prone, especially if more than two choices are involved, `either` can be used like this:
// Example:
// function outerFunction(callback) {
//   var actions = either(
//     function() { callback(new Error('timeout!')); },
//     function() { callback(null, "All OK"); });
//   setTimeout(actions[0], 200);
//   doSomethingAsync(actions[1]);
// }
var funcs=Array.prototype.slice.call(arguments);var wasCalled=false;return funcs.map(function(func){return function(){if(wasCalled)return undefined;wasCalled=true;return func.apply(this,arguments);};});}var _eitherNameRegistry={};function eitherNamed(name,func){// Works like [`either`](#) but usage does not require to wrap all
// functions at once:
// Example:
// var log = "", name = "either-example-" + Date.now();
// function a() { log += "aRun"; };
// function b() { log += "bRun"; };
// function c() { log += "cRun"; };
// setTimeout(eitherNamed(name, a), 100);
// setTimeout(eitherNamed(name, b), 40);
// setTimeout(eitherNamed(name, c), 80);
// setTimeout(function() { alert(log); /* => "bRun" */ }, 150);
var funcs=Array.prototype.slice.call(arguments);var registry=_eitherNameRegistry;var name=funcs.shift();var eitherCall=registry[name]||(registry[name]={wasCalled:false,callsLeft:0});eitherCall.callsLeft++;return function(){eitherCall.callsLeft--;// cleanup the storage if all registered functions fired
if(eitherCall.callsLeft<=0)delete registry[name];if(eitherCall.wasCalled)return undefined;eitherCall.wasCalled=true;return func.apply(this,arguments);};}// -=-=-=-=-
// creation
// -=-=-=-=-
function evalJS(src){return eval(src);}function fromString(funcOrString){// Example:
// fromString("function() { return 3; }")() // => 3
return evalJS('('+funcOrString.toString()+');');}function asScript(func,optVarMapping){// Lifts `func` to become a `Closure`, that is that free variables referenced
// in `func` will be bound to the values of an object that can be passed in as
// the second parameter. Keys of this object are mapped to the free variables.
//
// Please see [`Closure`](#) for a more detailed explanation and examples.
return Closure.fromFunction(func,optVarMapping).recreateFunc();}function asScriptOf(f,obj,optName,optMapping){// Like `asScript` but makes `f` a method of `obj` as `optName` or the name
// of the function.
var name=optName||f.name;if(!name){throw Error('Function that wants to be a script needs a name: '+this);}var proto=Object.getPrototypeOf(obj);var mapping={"this":obj};if(optMapping)mapping=merge([mapping,optMapping]);if(proto&&proto[name]){var superFunc=function superFunc(){try{// FIXME super is supposed to be static
return Object.getPrototypeOf(obj)[name].apply(obj,arguments);}catch(e){if(typeof $world!=='undefined')$world.logError(e,'Error in $super call');else console.error('Error in $super call: '+e+'\n'+e.stack);return null;}};mapping.$super=Closure.fromFunction(superFunc,{obj:obj,name:name}).recreateFunc();}return addToObject(asScript(f,mapping),obj,name);}// -=-=-=-=-=-=-=-=-
// closure related
// -=-=-=-=-=-=-=-=-
function addToObject(f,obj,name){// ignore-in-doc
f.displayName=name;var methodConnections=obj.attributeConnections?obj.attributeConnections.filter(function(con){return con.getSourceAttrName()==='update';}):[];if(methodConnections){methodConnections.forEach(function(ea){ea.disconnect();});}obj[name]=f;if(_typeof2(obj))f.declaredObject=safeToString(obj);// suppport for tracing
if(typeof lively!=='undefined'&&obj&&lively.Tracing&&lively.Tracing.stackTracingEnabled){lively.Tracing.instrumentMethod(obj,name,{declaredObject:safeToString(obj)});}if(methodConnections){methodConnections.forEach(function(ea){ea.connect();});}return f;}function binds(f,varMapping){// ignore-in-doc
// convenience function
return Closure.fromFunction(f,varMapping||{}).recreateFunc();}function setLocalVarValue(f,name,value){// ignore-in-doc
if(f.hasLivelyClosure)f.livelyClosure.funcProperties[name]=value;}function getVarMapping(f){// ignore-in-doc
if(f.hasLivelyClosure)return f.livelyClosure.varMapping;if(f.isWrapper)return f.originalFunction.varMapping;if(f.varMapping)return f.varMapping;return{};}function setProperty(func,name,value){func[name]=value;if(func.hasLivelyClosure)func.livelyClosure.funcProperties[name]=value;}// -=-=-=-=-=-=-=-=-=-=-=-=-
// class-related functions
// -=-=-=-=-=-=-=-=-=-=-=-=-
function functionNames(klass){// Treats passed function as class (constructor).
// Example:
// var Klass1 = function() {}
// Klass1.prototype.foo = function(a, b) { return a + b; };
// Klass1.prototype.bar = function(a) { return this.foo(a, 3); };
// Klass1.prototype.baz = 23;
// functionNames(Klass1); // => ["bar","foo"]
var result=[];var lookupObj=klass.prototype;while(lookupObj){result=Object.keys(lookupObj).reduce(function(result,name){if(typeof lookupObj[name]==='function'&&result.indexOf(name)===-1){result.push(name);}return result;},result);lookupObj=Object.getPrototypeOf(lookupObj);}return result;}function localFunctionNames(func){return Object.keys(func.prototype).filter(function(name){return typeof func.prototype[name]==='function';});}// -=-=-=-=-=-=-=-=-=-=-
// tracing and logging
// -=-=-=-=-=-=-=-=-=-=-
function logErrors(func,prefix){var advice=function logErrorsAdvice(proceed/*, args */){var args=Array.prototype.slice.call(arguments);args.shift();try{return proceed.apply(func,args);}catch(er){if(typeof lively!=='undefined'&&lively.morphic&&lively.morphic.World&&lively.morphic.World.current()){lively.morphic.World.current().logError(er);throw er;}if(prefix)console.warn('ERROR: %s.%s(%s): err: %s %s',func,prefix,args,er,er.stack||'');else console.warn('ERROR: %s %s',er,er.stack||'');throw er;}};advice.methodName='$logErrorsAdvice';var result=wrap(func,advice);result.originalFunction=func;result.methodName='$logErrorsWrapper';return result;}function logCompletion(func,module){var advice=function logCompletionAdvice(proceed){var args=Array.prototype.slice.call(arguments);args.shift();try{var result=proceed.apply(func,args);}catch(er){console.warn('failed to load '+module+': '+er);if(typeof lively!=='undefined'&&lively.lang.Execution){lively.lang.Execution.showStack();}throw er;}console.log('completed '+module);return result;};advice.methodName='$logCompletionAdvice::'+module;var result=wrap(func,advice);result.methodName='$logCompletionWrapper::'+module;result.originalFunction=func;return result;}function logCalls(func,isUrgent){var original=func;var advice=function logCallsAdvice(proceed){var args=Array.prototype.slice.call(arguments);args.shift(),result=proceed.apply(func,args);if(isUrgent){console.warn('%s(%s) -> %s',qualifiedMethodName(original),args,result);}else{console.log('%s(%s) -> %s',qualifiedMethodName(original),args,result);}return result;};advice.methodName='$logCallsAdvice::'+qualifiedMethodName(func);var result=wrap(func,advice);result.originalFunction=func;result.methodName='$logCallsWrapper::'+qualifiedMethodName(func);return result;}function traceCalls(func,stack){var advice=function traceCallsAdvice(proceed){var args=Array.prototype.slice.call(arguments);args.shift();stack.push(args);var result=proceed.apply(func,args);stack.pop();return result;};return wrap(func,advice);}function webkitStack(){// this won't work in every browser
try{throw new Error();}catch(e){// remove "Error" and this function from stack, rewrite it nicely
return String(e.stack).split(/\n/).slice(2).map(function(line){return line.replace(/^\s*at\s*([^\s]+).*/,'$1');}).join('\n');}}var fun=/*#__PURE__*/Object.freeze({__proto__:null,Empty:Empty,K:K,Null:Null,False:False,True:True,notYetImplemented:notYetImplemented,withNull:withNull,all:all$1,own:own,argumentNames:argumentNames,qualifiedMethodName:qualifiedMethodName,extractBody:extractBody,timeToRun:timeToRun,timeToRunN:timeToRunN,delay:delay,throttle:throttle,debounce:debounce,throttleNamed:throttleNamed,debounceNamed:debounceNamed,createQueue:createQueue,workerWithCallbackQueue:workerWithCallbackQueue,composeAsync:composeAsync,compose:compose,waitFor:waitFor,waitForAll:waitForAll,flip:flip,curry:curry,wrap:wrap,binds:binds,getOriginal:getOriginal,wrapperChain:wrapperChain,replaceMethodForOneCall:replaceMethodForOneCall,once:once,either:either,eitherNamed:eitherNamed,evalJS:evalJS,fromString:fromString,asScript:asScript,asScriptOf:asScriptOf,addToObject:addToObject,setLocalVarValue:setLocalVarValue,getVarMapping:getVarMapping,setProperty:setProperty,functionNames:functionNames,localFunctionNames:localFunctionNames,logErrors:logErrors,logCompletion:logCompletion,logCalls:logCalls,traceCalls:traceCalls,webkitStack:webkitStack});exports('f',fun);/*
       * Utility functions that help to inspect, enumerate, and create JS objects
       */ // -=-=-=-=-=-=-=-=-
// internal helper
// -=-=-=-=-=-=-=-=-
// serveral methods in lib/object.js are inspired or derived from
// Prototype JavaScript framework, version 1.6.0_rc1
// (c) 2005-2007 Sam Stephenson
// Prototype is freely distributable under the terms of an MIT-style license.
// For details, see the Prototype web site: http://www.prototypejs.org/
function print(object){if(object&&Array.isArray(object)){return'['+object.map(print)+']';}if(typeof object!=='string'){return String(object);}var result=String(object);result=result.replace(/\n/g,'\\n\\\n');result=result.replace(/(")/g,'\\$1');result='\"'+result+'\"';return result;}function indent(str,indentString,depth){if(!depth||depth<=0)return str;while(depth>0){depth--;str=indentString+str;}return str;}var getOwnPropertyDescriptors=typeof Object.getOwnPropertyDescriptors==='function'?Object.getOwnPropertyDescriptors:function getOwnPropertyDescriptors(object){var descriptors={};for(var name in object){if(!Object.prototype.hasOwnProperty.call(object,name))continue;Object.defineProperty(descriptors,name,{configurable:true,enumerable:true,writable:true,value:Object.getOwnPropertyDescriptor(object,name)});}return descriptors;};// show-in-doc
// -=-=-=-=-
// testing
// -=-=-=-=-
function isArray$1(obj){/* show-in-doc */return Array.isArray(obj);}function isElement(object){/* show-in-doc */return object&&object.nodeType==1;}function isFunction(object){/* show-in-doc */return object instanceof Function;}function isBoolean(object){/* show-in-doc */return typeof object==='boolean';}function isString(object){/* show-in-doc */return typeof object==='string';}function isNumber(object){/* show-in-doc */return typeof object==='number';}function isUndefined(object){/* show-in-doc */return typeof object==='undefined';}function isRegExp(object){/* show-in-doc */return object instanceof RegExp;}function isObject(object){/* show-in-doc */return _typeof2(object)==='object';}function isPrimitive(obj){// show-in-doc
if(!obj)return true;switch(_typeof2(obj)){case'string':case'number':case'boolean':return true;}return false;}function isEmpty(object){/* show-in-doc */for(var key in object){if(object.hasOwnProperty(key))return false;}return true;}function equals$1(a,b){// Is object `a` structurally equivalent to object `b`? Deep comparison.
if(a===b)return true;if(!a||!b)return a==b;if(Array.isArray(a))return deepEquals(a,b);switch(a.constructor){case String:case Date:case Boolean:case Number:return a==b;}if(typeof a.isEqualNode==='function')return a.isEqualNode(b);if(typeof a.equals==='function')return a.equals(b);var seenInA=[];for(var name in a){seenInA.push(name);if(typeof a[name]==='function')continue;if(!equals$1(a[name],b[name]))return false;}for(var name in b){if(seenInA.indexOf(name)!==-1)continue;if(typeof b[name]==='function')continue;if(!equals$1(b[name],a[name]))return false;}return true;}// -=-=-=-=-=-
// accessing
// -=-=-=-=-=-
var keys=Object.keys;function values(object){// Example:
// var obj1 = {x: 22}, obj2 = {x: 23, y: {z: 3}};
// obj2.__proto__ = obj1;
// obj.values(obj1) // => [22]
// obj.values(obj2) // => [23,{z: 3}]
return object?Object.keys(object).map(function(k){return object[k];}):[];}function select(obj,keys){// return a new object that copies all properties with `keys` from `obj`
var selected={};for(var _i19=0;_i19<keys.length;_i19++){selected[keys[_i19]]=obj[keys[_i19]];}return selected;}function dissoc(object,keys){object=object||{};var descriptors=getOwnPropertyDescriptors(object);for(var _i20=0;_i20<keys.length;_i20++){if(keys[_i20]in descriptors)delete descriptors[keys[_i20]];}return Object.defineProperties({},descriptors);}function addScript(object,funcOrString,optName,optMapping){var func=fromString(funcOrString);return asScriptOf(func,object,optName,optMapping);}// -=-=-=-=-
// mutation
// -=-=-=-=-
function extend(destination,source){// Add all properties of `source` to `destination`.
// Example:
// var dest = {x: 22}, src = {x: 23, y: 24}
// obj.extend(dest, src);
// dest // => {x: 23,y: 24}
var currentCategoryNames=null;for(var _i21=1;_i21<arguments.length;_i21++){if(typeof arguments[_i21]==='string'){var catName=arguments[_i21];if(!destination.categories)destination.categories={};if(!destination.categories[catName])destination.categories[catName]=[];currentCategoryNames=destination.categories[catName];continue;}var source=arguments[_i21];for(var property in source){var getter=source.__lookupGetter__(property);var setter=source.__lookupSetter__(property);if(getter){destination.__defineGetter__(property,getter);}if(setter){destination.__defineSetter__(property,setter);}if(getter||setter){continue;}var sourceObj=source[property];destination[property]=sourceObj;if(currentCategoryNames){currentCategoryNames.push(property);}if(typeof sourceObj==='function'){if(!sourceObj.displayName){sourceObj.displayName=property;}// remember the module that contains the definition
if(typeof lively!=='undefined'&&lively.Module&&lively.Module.current){sourceObj.sourceModule=lively.Module.current();}}}}return destination;}// -=-=-=-=-
// clone
// -=-=-=-=-
function clone$1(object){// Shallow copy
if(isPrimitive(object))return object;if(Array.isArray(object))return Array.prototype.slice.call(object);var clone={};for(var key in object){if(object.hasOwnProperty(key)){clone[key]=object[key];}}return clone;}function extract(object,properties,mapFunc){// Takes a list of properties and returns a new object with those
// properties shallow-copied from object
var copied={};for(var _i22=0;_i22<properties.length;_i22++){if(properties[_i22]in object){copied[properties[_i22]]=mapFunc?mapFunc(properties[_i22],object[properties[_i22]]):object[properties[_i22]];}}return copied;}// -=-=-=-=-=-
// inspection
// -=-=-=-=-=-
function inspect(object,options,depth){// Prints a human-readable representation of `obj`. The printed
// representation will be syntactically correct JavaScript but will not
// necessarily evaluate to a structurally identical object. `inspect` is
// meant to be used while interactivively exploring JavaScript programs and
// state.
//
// `options` can be {
//   printFunctionSource: BOOLEAN,
//   escapeKeys: BOOLEAN,
//   maxDepth: NUMBER,
//   customPrinter: FUNCTION,
//   maxNumberOfKeys: NUMBER
// }
options=options||{};depth=depth||0;if(options.customPrinter){var ignoreSignal=options._ignoreSignal||(options._ignoreSignal={});var continueInspectFn=function continueInspectFn(obj){return inspect(obj,options,depth+1);};var customInspected=options.customPrinter(object,ignoreSignal,continueInspectFn);if(customInspected!==ignoreSignal)return customInspected;}if(!object)return print(object);// print function
if(typeof object==='function'){return options.printFunctionSource?String(object):'function'+(object.name?' '+object.name:'')+'('+argumentNames(object).join(',')+') {/*...*/}';}// print "primitive"
switch(object.constructor){case String:case Boolean:case RegExp:case Number:return print(object);}if(typeof object.serializeExpr==='function'){return object.serializeExpr();}var isArray=object&&Array.isArray(object);var openBr=isArray?'[':'{';var closeBr=isArray?']':'}';if(options.maxDepth&&depth>=options.maxDepth){return openBr+'/*...*/'+closeBr;}var printedProps=[];if(isArray){printedProps=object.map(function(ea){return inspect(ea,options,depth+1);});}else{var propsToPrint=Object.keys(object).sort(function(a,b){var aIsFunc=typeof object[a]==='function';var bIsFunc=typeof object[b]==='function';if(aIsFunc===bIsFunc){if(a<b)return-1;if(a>b)return 1;return 0;}return aIsFunc?1:-1;});for(var _i23=0;_i23<propsToPrint.length;_i23++){if(_i23>(options.maxNumberOfKeys||Infinity)){var hiddenEntryCount=propsToPrint.length-_i23;printedProps.push("...".concat(hiddenEntryCount," hidden ").concat(hiddenEntryCount>1?'entries':'entry',"..."));break;}var key=propsToPrint[_i23];if(isArray)inspect(object[key],options,depth+1);var printedVal=inspect(object[key],options,depth+1);printedProps.push((options.escapeKeys?JSON.stringify(key):key)+': '+printedVal);}}if(printedProps.length===0){return openBr+closeBr;}var printedPropsJoined=printedProps.join(', ');var useNewLines=(!isArray||options.newLineInArrays)&&(!options.minLengthForNewLine||printedPropsJoined.length>=options.minLengthForNewLine);var ind=indent('',options.indent||'  ',depth);var propIndent=indent('',options.indent||'  ',depth+1);var startBreak=useNewLines&&!isArray?'\n'+propIndent:'';var eachBreak=useNewLines?'\n'+propIndent:'';var endBreak=useNewLines&&!isArray?'\n'+ind:'';if(useNewLines)printedPropsJoined=printedProps.join(','+eachBreak);return openBr+startBreak+printedPropsJoined+endBreak+closeBr;}// -=-=-=-=-
// merging
// -=-=-=-=-
function merge(objs){// `objs` can be a list of objects. The return value will be a new object,
// containing all properties of all objects. If the same property exist in
// multiple objects, the right-most property takes precedence.
//
// Like `extend` but will not mutate objects in `objs`.
// if objs are arrays just concat them
// if objs are real objs then merge propertdies
if(arguments.length>1){return merge(Array.prototype.slice.call(arguments));}if(Array.isArray(objs[0])){// test for all?
return Array.prototype.concat.apply([],objs);}return objs.reduce(function(merged,ea){for(var name in ea){if(ea.hasOwnProperty(name)){merged[name]=ea[name];}}return merged;},{});}function deepMerge(objA,objB){// `objs` can be a list of objects. The return value will be a new object,
// containing all properties of all objects. If the same property exist in
// multiple objects, the right-most property takes precedence.
//
// Like `extend` but will not mutate objects in `objs`.
// if objs are arrays just concat them
// if objs are real objs then merge propertdies
if(!objA)return objB;if(!objB)return objA;if(Array.isArray(objA)){if(!Array.isArray(objB))return objB;var merged=objA.map(function(ea,i){return deepMerge(ea,objB[i]);});if(objB.length>objA.length)merged=merged.concat(objB.slice(objA.length));return merged;}if(_typeof2(objA)!=='object'||_typeof2(objB)!=='object')return objB;return Object.keys(objA).concat(Object.keys(objB)).reduce(function(merged,name){if(!objA[name])merged[name]=objB[name];else if(!objB[name])merged[name]=objA[name];else if(_typeof2(objA[name])!=='object'||_typeof2(objB[name])!=='object')merged[name]=objB[name];else merged[name]=deepMerge(objA[name],objB[name]);return merged;},{});}function sortKeysWithBeforeAndAfterConstraints(properties){var throwErrorOnMissing=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var remaining=[];for(var key in properties){var prop=properties[key];var before=prop.hasOwnProperty('before')?prop.before:prop.before=[];var after=prop.hasOwnProperty('after')?prop.after:prop.after=[];for(var _i24=before.length;_i24--;){var beforePropName=before[_i24];var beforeProp=properties[beforePropName];if(!beforeProp){console.warn("[initializeProperties] ".concat(this," sortProperties: ")+"Property ".concat(key," requires to be initialized before ").concat(beforePropName," ")+'but that property cannot be found.');before.splice(_i24,1);continue;}if(!beforeProp.hasOwnProperty('after'))beforeProp.after=[];beforeProp.after.push(key);}for(var _i25=after.length;_i25--;){var afterPropName=after[_i25];var afterProp=properties[afterPropName];if(!afterProp){console.warn("[initializeProperties] ".concat(this," sortProperties: ")+"Property ".concat(key," requires to be initialized after ").concat(afterPropName," ")+'but that property cannot be found.');after.splice(_i25,1);}}remaining.push(key);}// ignore-in-doc
// compute order
var resolvedGroups=[];var resolvedKeys=[];var lastLength=remaining.length+1;while(remaining.length){if(lastLength===remaining.length){throw new Error('Circular dependencies in handler order, could not resolve properties '+remaining.map(function(key){var before=properties[key].before;var after=properties[key].after;if((!before||!before.length)&&(!after||!after.length))return'';var report="".concat(key,"\n");if(before&&before.length)report+="  - before ".concat(before.join(','),"\n");if(after&&after.length)report+="  - after ".concat(after.join(','),"\n");return report;}).join(''));}lastLength=remaining.length;var resolvedGroup=[];for(var _i26=remaining.length;_i26--;){var _key4=remaining[_i26];if(isSubset(properties[_key4].after,resolvedKeys)){remaining.splice(_i26,1);resolvedKeys.push(_key4);resolvedGroup.push(_key4);}}resolvedGroups.push(resolvedGroup);}return flatten(resolvedGroups,1);}// -=-=-=-=-=-=-
// inheritance
// -=-=-=-=-=-=-
function inherit(obj){return Object.create(obj);}function valuesInPropertyHierarchy(obj,name){// Lookup all properties named name in the proto hierarchy of obj.
// Example:
// var a = {foo: 3}, b = Object.create(a), c = Object.create(b);
// c.foo = 4;
// obj.valuesInPropertyHierarchy(c, "foo") // => [3,4]
var result=[];var lookupObj=obj;while(lookupObj){if(lookupObj.hasOwnProperty(name))result.unshift(lookupObj[name]);lookupObj=Object.getPrototypeOf(lookupObj);}return result;}function mergePropertyInHierarchy(obj,propName){// like `merge` but automatically gets all definitions of the value in the
// prototype chain and merges those.
// Example:
// var o1 = {x: {foo: 23}}, o2 = {x: {foo: 24, bar: 15}}, o3 = {x: {baz: "zork"}};
// o2.__proto__ = o1; o3.__proto__ = o2;
// obj.mergePropertyInHierarchy(o3, "x");
// // => {bar: 15, baz: "zork",foo: 24}
return merge(valuesInPropertyHierarchy(obj,propName));}function deepCopy(object){// Recursively traverses `object` and its properties to create a copy.
if(!object||_typeof2(object)!=='object'||object instanceof RegExp)return object;var result=Array.isArray(object)?Array(object.length):{};for(var key in object){if(object.hasOwnProperty(key)){result[key]=deepCopy(object[key]);}}return result;}// -=-=-=-=-=-=-=-=-
// stringification
// -=-=-=-=-=-=-=-=-
function typeStringOf(obj){// ignore-in-doc
if(obj===null)return'null';if(typeof obj==='undefined')return'undefined';return obj.constructor.name;}function shortPrintStringOf(obj){// ignore-in-doc
// primitive values
if(!isMutableType(obj))return safeToString(obj);// constructed objects
if(obj.constructor.name!=='Object'&&!Array.isArray(obj)){if(obj.constructor.name){return obj.constructor.name?obj.constructor.name:Object.prototype.toString.call(obj).split(' ')[1].split(']')[0];}}// arrays or plain objects
var typeString='';function displayTypeAndLength(obj,collectionType,firstBracket,secondBracket){if(obj.constructor.name===collectionType){typeString+=firstBracket;if(obj.length||Object.keys(obj).length)typeString+='...';typeString+=secondBracket;}}displayTypeAndLength(obj,'Object','{','}');displayTypeAndLength(obj,'Array','[',']');return typeString;}function isMutableType(obj){// Is `obj` a value or mutable type?
var immutableTypes=['null','undefined','Boolean','Number','String'];return immutableTypes.indexOf(typeStringOf(obj))===-1;}function safeToString(obj){// Like `toString` but catches errors.
try{return(obj?obj.toString():String(obj)).replace('\n','');}catch(e){return'<error printing object>';}}function asObject(obj){switch(_typeof2(obj)){case'string':return new String(obj);case'boolean':return new Boolean(obj);case'number':return new Number(obj);default:return obj;}}function newKeyIn(obj){var base=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'_';var i=1;var key;do{key=base+'-'+i++;}while(key in obj);return key;}var obj=/*#__PURE__*/Object.freeze({__proto__:null,isArray:isArray$1,isElement:isElement,isFunction:isFunction,isBoolean:isBoolean,isString:isString,isNumber:isNumber,isUndefined:isUndefined,isRegExp:isRegExp,isObject:isObject,isPrimitive:isPrimitive,isEmpty:isEmpty,equals:equals$1,keys:keys,values:values,select:select,dissoc:dissoc,addScript:addScript,extend:extend,clone:clone$1,extract:extract,inspect:inspect,merge:merge,deepMerge:deepMerge,inherit:inherit,valuesInPropertyHierarchy:valuesInPropertyHierarchy,mergePropertyInHierarchy:mergePropertyInHierarchy,sortKeysWithBeforeAndAfterConstraints:sortKeysWithBeforeAndAfterConstraints,deepCopy:deepCopy,typeStringOf:typeStringOf,shortPrintStringOf:shortPrintStringOf,isMutableType:isMutableType,safeToString:safeToString,asObject:asObject,newKeyIn:newKeyIn,getOwnPropertyDescriptors:getOwnPropertyDescriptors});/*global btoa,JsDiff*/var features$1={repeat:!!String.prototype.repeat,includes:!!String.prototype.includes,startsWith:!!String.prototype.startsWith,endsWith:!!String.prototype.endsWith};// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// printing and formatting strings
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function format(){// String+ -> String
// Takes a variable number of arguments. The first argument is the format
// string. Placeholders in the format string are marked with `"%s"`.
// Example:
//   lively.lang.string.format("Hello %s!", "Lively User"); // => "Hello Lively User!"
return formatFromArray(Array.prototype.slice.call(arguments));}function formatFromArray(objects){var self=objects.shift();if(!self){console.log("Error in Strings>>formatFromArray, first arg is undefined");}function appendText(object,string){return""+object;}function appendInteger(value,string){return value.toString();}function appendFloat(value,string,precision){if(precision>-1)return value.toFixed(precision);else return value.toString();}function appendObject(value,string){return inspect(value);}var appenderMap={s:appendText,d:appendInteger,i:appendInteger,f:appendFloat,o:appendObject};var reg=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/;function parseFormat(fmt){var parts=[];for(var m=reg.exec(fmt);m;m=reg.exec(fmt)){var type=m[8]||m[5],appender=type in appenderMap?appenderMap[type]:appendObject,precision=m[3]?parseInt(m[3]):m[4]=="."?-1:0;parts.push(fmt.substr(0,m[0][0]=="%"?m.index:m.index+1));parts.push({appender:appender,precision:precision});fmt=fmt.substr(m.index+m[0].length);}if(fmt)parts.push(fmt.toString());return parts;}var parts=parseFormat(self),str="",objIndex=0;for(var i=0;i<parts.length;++i){var part=parts[i];if(part&&_typeof2(part)=="object"){var object=objects[objIndex++];str+=(part.appender||appendText)(object,str,part.precision);}else{str+=appendText(part);}}return str;}function indent$1(str,indentString,depth){// String -> String -> String? -> String
// Example:
//   string.indent("Hello", "  ", 2) // => "    Hello"
if(!depth||depth<=0)return str;var indent="";while(depth>0){depth--;indent+=indentString;}return lines(str).map(function(line){return indent+line;}).join("\n");}function minIndent(str,indentString){// Find out what the minum indentation of the text in str is
// Example:
//   minIndent("    Hello", "  ") // => 2
if(!indentString)indentString="  ";var indentRe=new RegExp("^("+indentString+")*","gm");return min(str.match(indentRe).map(function(ea){return Math.floor(ea.length/indentString.length);}));}function changeIndent(str,indentString,depth){// Add or remove indent from lines in str to match depth
// Example:
//   string.changeIndent("    Hello", "  ", 1) // => "  Hello"
if(!indentString)indentString="  ";if(!depth)depth=0;var existingIndent=minIndent(str,indentString);if(existingIndent===depth)return str;if(existingIndent<depth)return indent$1(str,indentString,depth-existingIndent);var prefixToRemove=indentString.repeat(existingIndent-depth);return lines(str).map(function(line){return line.slice(prefixToRemove.length);}).join("\n");}function quote(str){// Example:
//   string.print("fo\"o") // => "\"fo\\\"o\""
return'"'+str.replace(/"/g,'\\"')+'"';}function print$1(obj){// Prints Arrays and escapes quotations. See `obj.inspect` for how to
// completely print / inspect JavaScript data strcutures
// Example:
//   string.print([[1,2,3], "string", {foo: 23}])
//      // => [[1,2,3],"string",[object Object]]
if(obj&&Array.isArray(obj))return'['+obj.map(print$1)+']';if(typeof obj!=="string")return String(obj);var result=String(obj);result=result.replace(/\n/g,'\\n\\\n');result=result.replace(/(")/g,'\\$1');result='\"'+result+'\"';return result;}function printNested(list,depth){// Example:
//   string.printNested([1,2,[3,4,5]]) // => "1\n2\n  3\n  4\n  5\n"
depth=depth||0;return list.reduce(function(s,ea){return s+=Array.isArray(ea)?printNested(ea,depth+1):indent$1(ea+"\n",'  ',depth);},"");}function pad(string,n,left){// Examples:
// pad("Foo", 2) // => "Foo  "
// pad("Foo", 2, true) // => "  Foo"
return left?' '.repeat(n)+string:string+' '.repeat(n);}function printTable(tableArray,options){// Array -> Object? -> String
// Takes a 2D Array and prints a table string. Kind of the reverse
// operation to `tableize`
// Example:
//   string.printTable([["aaa", "b", "c"], ["d", "e","f"]])
//    // =>
//    // aaa b c
//    // d   e f
var columnWidths=[],separator=options&&options.separator||' ',alignLeftAll=!options||!options.align||options.align==='left',alignRightAll=options&&options.align==='right';function alignRight(columnIndex){if(alignLeftAll)return false;if(alignRightAll)return true;return options&&Array.isArray(options.align)&&options.align[columnIndex]==='right';}tableArray.forEach(function(row){row.forEach(function(cellVal,i){if(columnWidths[i]===undefined)columnWidths[i]=0;columnWidths[i]=Math.max(columnWidths[i],String(cellVal).length);});});return tableArray.map(function(row){return row.map(function(cellVal,i){var cellString=String(cellVal);return pad(cellString,columnWidths[i]-cellString.length,alignRight(i));}).join(separator);}).join('\n');}function printTree(rootNode,nodePrinter,childGetter,indent){// Object -> Function -> Function -> Number? -> String
// A generic function to print a tree representation from a nested data structure.
// Receives three arguments:
// - `rootNode` an object representing the root node of the tree
// - `nodePrinter` is a function that gets a tree node and should return stringified version of it
// - `childGetter` is a function that gets a tree node and should return a list of child nodes
// Example:
// var root = {name: "a", subs: [{name: "b", subs: [{name: "c"}]}, {name: "d"}]};
// string.printTree(root, function(n) { return n.name; }, function(n) { return n.subs; });
// // =>
// // a
// // |-b
// // | \-c
// // \-d
var nodeList=[];indent=indent||'  ';iterator(0,0,rootNode);return nodeList.join('\n');// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function iterator(depth,index,node){// ignore-in-doc
// 1. Create stringified representation of node
nodeList[index]=indent.repeat(depth)+nodePrinter(node,depth);var children=childGetter(node,depth),childIndex=index+1;if(!children||!children.length)return childIndex;// 2. If there are children then assemble those linear inside nodeList
// The childIndex is the pointer of the current items of childList into
// nodeList.
var lastIndex=childIndex,lastI=children.length-1;children.forEach(function(ea,i){childIndex=iterator(depth+1,childIndex,ea);// 3. When we have printed the recursive version then augment the
// printed version of the direct children with horizontal slashes
// directly in front of the represented representation
var isLast=lastI===i,cs=nodeList[lastIndex].split(''),fromSlash=depth*indent.length+1,toSlash=depth*indent.length+indent.length;for(var i=fromSlash;i<toSlash;i++){cs[i]='-';}if(isLast)cs[depth*indent.length]='\\';nodeList[lastIndex]=cs.join('');// 4. For all children (direct and indirect) except for the
// last one (itself and all its children) add vertical bars in
// front of each at position of the current nodes depth. This
// makes is much easier to see which child node belongs to which
// parent
if(!isLast)nodeList.slice(lastIndex,childIndex).forEach(function(ea,i){var cs2=ea.split('');cs2[depth*indent.length]='|';nodeList[lastIndex+i]=cs2.join('');});lastIndex=childIndex;});return childIndex;}}function toArray$1(s){// Example:
// string.toArray("fooo") // => ["f","o","o","o"]
return s.split('');}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// parsing strings into other entities
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function lines(str){// Example: string.lines("foo\nbar\n\rbaz") // => ["foo","bar","baz"]
return str.split(/\n\r?/);}function paragraphs(string,options){// Examples:
// var text = "Hello, this is a pretty long sentence\nthat even includes new lines."
//         + "\n\n\nThis is a sentence in  a new paragraph.";
// string.paragraphs(text) // => [
//   // "Hello, this is a pretty long sentence\nthat even includes new lines.",
//   // "This is a sentence in  a new paragraph."]
// string.paragraphs(text, {keepEmptyLines: true}) // => [
//   // "Hello, this is a pretty long sentence\n that even includes new lines.",
//   // "\n ",
//   // "This is a sentence in  a new paragraph."]
var sep=options?options.sep:'\n\n';if(!options||!options.keepEmptyLines)return string.split(new RegExp(sep+'+'));function isWhiteSpace(s){return /^\s*$/.test(s);}return string.split('\n').concat('').reduce(function(parasAndLast,line){var paras=parasAndLast[0],last=parasAndLast[1];if(isWhiteSpace(last)===isWhiteSpace(line)){last+='\n'+line;}else{last.length&&paras.push(last);last=line;}return[paras,last];},[[],''])[0];}function nonEmptyLines(str){// Example: string.nonEmptyLines("foo\n\nbar\n") // => ["foo","bar"]
return lines(str).compact();}function tokens(str,regex){// Example:
// string.tokens(' a b c') => ['a', 'b', 'c']
return str.split(regex||/\s+/).filter(function(tok){return!/^\s*$/.test(tok);});}function tableize(s,options){// String -> Object? -> Array
// Takes a String representing a "table" and parses it into a 2D-Array (as
// accepted by the `collection.Grid` methods or `string.printTable`)
// ```js
// options = {
//     convertTypes: BOOLEAN, // automatically convert to Numbers, Dates, ...?
//     cellSplitter: REGEXP // how to recognize "cells", by default just spaces
// }
// ```
// Examples:
// string.tableize('a b c\nd e f')
// // => [["a","b","c"],["d","e","f"]]
// // can also parse csv like
// var csv = '"Symbol","Name","LastSale",\n'
//         + '"FLWS","1-800 FLOWERS.COM, Inc.","5.65",\n'
//         + '"FCTY","1st Century Bancshares, Inc","5.65",'
// string.tableize(csv, {cellSplitter: /^\s*"|","|",?\s*$/g})
// // => [["Symbol","Name","LastSale"],
// //     ["FLWS","1-800 FLOWERS.COM, Inc.",5.65],
// //     ["FCTY","1st Century Bancshares, Inc",5.65]]
options=options||{};var splitter=options.cellSplitter||/\s+/,emptyStringRe=/^\s*$/,convertTypes=options.hasOwnProperty('convertTypes')?!!options.convertTypes:true,_lines=lines(s),table=[];for(var i=0;i<_lines.length;i++){var _tokens=tokens(_lines[i],splitter);if(convertTypes){_tokens=_tokens.map(function(tok){if(tok.match(emptyStringRe))return tok;var num=Number(tok);if(!isNaN(num))return num;var date=new Date(tok);if(!isNaN(+date))return date;return tok.trim();});}if(_tokens.length>0)table.push(_tokens);}return table;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// (un)escape / encoding / decoding
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function unescapeCharacterEntities(s){// Converts [character entities](http://dev.w3.org/html5/html-author/charref)
// into utf-8 strings
// Example:
//   string.unescapeCharacterEntities("foo &amp;&amp; bar") // => "foo && bar"
if(typeof document==='undefined')throw new Error("Cannot unescapeCharacterEntities");var div=document.createElement('div');div.innerHTML=s;return div.textContent;}function toQueryParams(s,separator){// Example:
// string.toQueryParams("http://example.com?foo=23&bar=test")
//   // => {bar: "test", foo: "23"}
var match=s.trim().match(/([^?#]*)(#.*)?$/);if(!match)return{};var hash=match[1].split(separator||'&').inject({},function(hash,pair){if((pair=pair.split('='))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash){if(!Array.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}else hash[key]=value;}return hash;});return hash;}function base64EncodeUnicode(str){// [https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem]()
// Base64 encode a unicode string
// First we use encodeURIComponent to get percent-encoded UTF-8,
// then we convert the percent encodings into raw bytes which
// can be fed into btoa.
return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function toSolidBytes(match,p1){return String.fromCharCode('0x'+p1);}));}function base64DecodeUnicode(str){// [https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem]()
// Decode a base64 encoded string to a unicode string
// Going backwards: from bytestream, to percent-encoding, to original string.
return decodeURIComponent(atob(str).split('').map(function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));}// -=-=-=-=-=-=-=-=-=-=-=-=-
// file system path support
// -=-=-=-=-=-=-=-=-=-=-=-=-
var pathDotRe=/\/\.\//g,pathDoubleDotRe=/\/[^\/]+\/\.\./,pathDoubleSlashRe=/(^|[^:])[\/]+/g,urlStartRe=/^[a-z0-9-_\.]+:\/\//;function normalizePath(pathString){var urlStartMatch=pathString.match(urlStartRe),urlStart=urlStartMatch?urlStartMatch[0]:null,result=urlStart?pathString.slice(urlStart.length):pathString;// /foo/../bar --> /bar
do{pathString=result;result=pathString.replace(pathDoubleDotRe,'');}while(result!=pathString);// foo//bar --> foo/bar
result=result.replace(pathDoubleSlashRe,'$1/');// foo/./bar --> foo/bar
result=result.replace(pathDotRe,'/');if(urlStart)result=urlStart+result;return result;}function joinPath()/*paths*/{// Joins the strings passed as paramters together so that ea string is
// connected via a single "/".
// Example:
// string.joinPath("foo", "bar") // => "foo/bar";
return normalizePath(Array.prototype.slice.call(arguments).reduce(function(path,ea){return typeof ea==="string"?path.replace(/\/*$/,"")+"/"+ea.replace(/^\/*/,""):path;}));}// -=-=-=-=-=-=-=-=-
// ids and hashing
// -=-=-=-=-=-=-=-=-
var newUUIDTemplate='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx',newUUIDRe=/[xy]/g,newUUIDReplacer=function newUUIDReplacer(c){var r=Math.random()*16|0,v=c=='x'?r:r&0x3|0x8;return v.toString(16);};function newUUID(){// Example:
//   newUUID() // => "3B3E74D0-85EA-45F2-901C-23ECF3EAB9FB"
return newUUIDTemplate.replace(newUUIDRe,newUUIDReplacer).toUpperCase();}function createDataURI(content,mimeType){// String -> String -> String
// Takes some string representing content and a mime type.
// For a list of mime types see: [http://www.iana.org/assignments/media-types/media-types.xhtml]()
// More about data URIs: [https://developer.mozilla.org/en-US/docs/Web/HTTP/data_URIs]()
// Example:
//   window.open(string.createDataURI('<h1>test</h1>', 'text/html'));
mimeType=mimeType||"text/plain";return"data:"+mimeType+";base64,"+base64EncodeUnicode(content);}function hashCode(s){// [http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/]()
// Example: string.hashCode("foo") // => 101574
var hash=0,len=s.length;if(len==0)return hash;for(var i=0;i<len;i++){var c=s.charCodeAt(i);hash=(hash<<5)-hash+c;hash=hash&hash;// Convert to 32bit integer
}return hash;}function md5(string){//  Joseph Myers [http://www.myersdaily.org/joseph/javascript/md5-text.html]()
// Example:
//   string.md5("foo") // => "acbd18db4cc2f85cedef654fccc4a4d8"
/* ignore-in-doc
      		this function is much faster,
      		so if possible we use it. Some IEs
      		are the only ones I know of that
      		need the idiotic second function,
      		generated by an if clause.  */ // var add32 = hex(md51("hello")) === "5d41402abc4b2a76b9719d911017c592" ?
//   function add32(a, b) { return (a + b) & 0xFFFFFFFF; } :
var add32=function add32(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&0xFFFF;};function cmn(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32(a<<s|a>>>32-s,b);}function ff(a,b,c,d,x,s,t){return cmn(b&c|~b&d,a,b,x,s,t);}function gg(a,b,c,d,x,s,t){return cmn(b&d|c&~d,a,b,x,s,t);}function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t);}function ii(a,b,c,d,x,s,t){return cmn(c^(b|~d),a,b,x,s,t);}function md5cycle(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3]);}function md51(s){var n=s.length,state=[1732584193,-271733879,-1732584194,271733878],i;for(i=64;i<=n;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)));}s=s.substring(i-64);var tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],sl=s.length;for(i=0;i<sl;i++){tail[i>>2]|=s.charCodeAt(i)<<(i%4<<3);}tail[i>>2]|=0x80<<(i%4<<3);if(i>55){md5cycle(state,tail);i=16;while(i--){tail[i]=0;}//			for (i=0; i<16; i++) tail[i] = 0;
}tail[14]=n*8;md5cycle(state,tail);return state;}/* ignore-in-doc
      		 * there needs to be support for Unicode here,
      		 * unless we pretend that we can redefine the MD-5
      		 * algorithm for multi-byte characters (perhaps
      		 * by adding every four 16-bit characters and
      		 * shortening the sum to 32 bits). Otherwise
      		 * I suggest performing MD-5 as if every character
      		 * was two bytes--e.g., 0040 0025 = @%--but then
      		 * how will an ordinary MD-5 sum be matched?
      		 * There is no way to standardize text to something
      		 * like UTF-8 before transformation; speed cost is
      		 * utterly prohibitive. The JavaScript standard
      		 * itself needs to look at this: it should start
      		 * providing access to strings as preformed UTF-8
      		 * 8-bit unsigned value arrays.
      		 */function md5blk(s){// ignore-in-doc
/* I figured global was faster.   */var md5blks=[],i;/* Andy King said do it this way. */for(i=0;i<64;i+=4){md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24);}return md5blks;}var hex_chr='0123456789abcdef'.split('');function rhex(n){var s='',j=0;for(;j<4;j++){s+=hex_chr[n>>j*8+4&0x0F]+hex_chr[n>>j*8&0x0F];}return s;}function hex(x){var l=x.length;for(var i=0;i<l;i++){x[i]=rhex(x[i]);}return x.join('');}return hex(md51(string));}// -=-=-=-=-=-=-=-=-=-=-=-=-=-
// matching strings / regexps
// -=-=-=-=-=-=-=-=-=-=-=-=-=-
function reMatches$1(string,re){// Different to the native `match` function this method returns an object
// with `start`, `end`, and `match` fields
// Example:
//   string.reMatches("Hello World", /o/g)
//   // => [{start: 4, end: 5, match: "o"},{start: 7, end: 8, match: "o"}]
var matches=[];string.replace(re,function(match,idx){matches.push({match:match,start:idx,end:idx+match.length});});return matches;}function stringMatch(s,patternString,options){// returns `{matched: true}` if success otherwise
// `{matched: false, error: EXPLANATION, pattern: STRING|RE, pos: NUMBER}`
// Example:
//   string.stringMatch("foo 123 bar", "foo __/[0-9]+/__ bar") // => {matched: true}
//   string.stringMatch("foo aaa bar", "foo __/[0-9]+/__ bar")
//     // => {
//     //   error: "foo <--UNMATCHED-->aaa bar",
//     //   matched: false,
//     //   pattern: /[0-9]+/,
//     //   pos: 4
//     // }
options=options||{};if(!!options.normalizeWhiteSpace)s=s.replace(/\s+/g,' ');if(!!options.ignoreIndent){s=s.replace(/^\s+/gm,'');patternString=patternString.replace(/^\s+/gm,'');}return s==patternString?{matched:true}:embeddedReMatch(s,patternString);// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function splitInThree(string,start,end,startGap,endGap){// ignore-in-doc
// split string at start and end
// return (0, start), (start, end), (end, ...)
startGap=startGap||0;endGap=endGap||0;return[string.slice(0,start),string.slice(start+startGap,end-endGap),string.slice(end)];}function matchStringForward(s,pattern){// ignore-in-doc
// try to match pattern at beginning of string. if matched, return
// result object with {
//   match: STRING,
//   REST: STRING -- remaining string after pattern was consumed
// }
if(pattern.constructor!==RegExp){var idx=s.indexOf(pattern);if(idx===0)return{match:pattern,rest:s.slice(pattern.length)};// no match
for(var i=0;i<pattern.length;i++){// figure out where we failed
if(pattern[i]!=s[i])return{match:null,pos:i};}return{match:null};}var matches=reMatches$1(s,pattern);// show(matches)
// show(string.slice(matches[0].end));
return!matches||!matches.length||matches[0].start!==0?{match:null}:{match:matches[0].match,rest:s.slice(matches[0].end)};}function matchStringForwardWithAllPatterns(s,patterns){// ignore-in-doc
// like matchStringForward, just apply list of patterns
var pos=0;for(var i=0;i<patterns.length;i++){var p=patterns[i],result=matchStringForward(s,p);if(!result.match)return{matched:false,pos:pos+(result.pos||0),pattern:p};pos+=result.match.length;s=result.rest;}return s.length?{matched:false,pos:pos}:{matched:true};}function splitIntoPatterns(matcher){var starts=reMatches$1(matcher,/__\//g),ends=reMatches$1(matcher,/\/__/g);if(starts.length!==ends.length){throw new Error("pattern invalid: "+matcher+" cannot be split into __/.../__ embedded RegExps"+"\nstarts: "+JSON.stringify(starts)+'\nvs ends:\n'+JSON.stringify(ends));}var consumed=0;return starts.reduce(function(patterns,start,i){var end=ends[i];var matcher=patterns.pop();var splitted=splitInThree(matcher,start.start-consumed,end.end-consumed,3,3);if(splitted[0].length){patterns.push(splitted[0]);consumed+=splitted[0].length;}try{if(splitted[1].length){patterns.push(new RegExp(splitted[1]));consumed+=splitted[1].length+3+3;}}catch(e){throw new Error("Cannot create pattern re from: "+inspect(splitted));}if(splitted[2].length){patterns.push(splitted[2]);}return patterns;},[matcher]);}function embeddedReMatch(s,patternString){// ignore-in-doc
// the main match func
var patterns=splitIntoPatterns(patternString);var result=matchStringForwardWithAllPatterns(s,patterns);if(result.matched)return result;result.error=s.slice(0,result.pos)+'<--UNMATCHED-->'+s.slice(result.pos);return result;}}function peekRight(s,start,needle){// Finds the next occurence of `needle` (String or RegExp). Returns delta
// index.
// Example:
// peekRight("Hello World", 0, /o/g) // => 4
// peekRight("Hello World", 5, /o/) // => 2
s=s.slice(start);if(typeof needle==='string'){var idx=s.indexOf(needle);return idx===-1?null:idx+start;}else if(needle.constructor===RegExp){var matches=reMatches$1(s,needle);return matches[0]?matches[0].start:null;}return null;}function peekLeft(s,start,needle){// Similar to `peekRight`
s=s.slice(0,start);if(typeof needle==='string'){var idx=s.lastIndexOf(needle);return idx===-1?null:idx;}else if(needle.constructor===RegExp){var matches=reMatches$1(s,needle);return last(matches)?last(matches).start:null;}return null;}function lineIndexComputer(s){// String -> Function
// For converting character positions to line numbers.
// Returns a function accepting char positions. If the char pos is outside
// of the line ranges -1 is returned.
// Example:
// var idxComp = lineIndexComputer("Hello\nWorld\n\nfoo");
// idxComp(3) // => 0 (index 3 is "l")
// idxComp(6) // => 1 (index 6 is "W")
// idxComp(12) // => 2 (index 12 is "\n")
// ignore-in-doc
// line ranges: list of numbers, each line has two entries:
// i -> start of line, i+1 -> end of line
var _lineRanges=lineRanges(s);// ignore-in-doc
// FIXME, this is O(n). Make cumputation more efficient, binary lookup?
return function(pos){for(var line=0;line<_lineRanges.length;line++){var lineRange=_lineRanges[line];if(pos>=lineRange[0]&&pos<lineRange[1])return line;}return-1;};}function lineNumberToIndexesComputer(s){// String -> Function
// For converting line numbers to [startIndex, endIndex]
// Example:
// var idxComp = lineNumberToIndexesComputer("Hello\nWorld\n\nfoo");
// idxComp(1) // => [6,12]
return function(lineNo){return lineRanges(s)[lineNo];};}function lineRanges(s){var from=0,to=0,linesOfS=lines(s),result=[];for(var _i27=0;_i27<linesOfS.length;_i27++){var line=linesOfS[_i27];to=from+line.length+1;result.push([from,to]);from=to;}return result;}function findLineWithIndexInLineRanges(lineRanges,idx){// given a list of `lineRanges` (produced by
// `livley.lang.string.lineRanges(string)`) like lineRanges = [[0, 12], [12, 33]]
// and an string index `idx` into `string`, find the line no (the index into
// `lineRanges`) that includes idx.  The index intervals include start and exclude end:
// Example:
// findLineWithIndex2(lineRanges, 2); // => 0
// findLineWithIndex2(lineRanges, 12); // => 1
// findLineWithIndex2(lineRanges, 33); // => 1
// findLineWithIndex2(lineRanges, 34); // => -1
// findLineWithIndex2(lineRanges, -4); // => -1
var nRows=lineRanges.length;if(nRows===0)return-1;// let currentRow = Math.floor(nRows/2), lastRow = nRows;
var startRow=0,endRow=nRows;while(true){var middle=startRow+Math.floor((endRow-startRow)/2),_lineRanges$middle=_slicedToArray2(lineRanges[middle],2),_from=_lineRanges$middle[0],to=_lineRanges$middle[1];if(idx<_from){if(middle===0)return-1;endRow=middle;continue;}if(idx>to){startRow=middle;continue;}return middle;}return-1;}function regexIndexOf(string,regex){var startpos=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var indexOf=this.substring(startpos||0).search(regex);return indexOf>=0?indexOf+(startpos||0):indexOf;}function regexLastIndexOf(string,regex){var startpos=arguments.length>2&&arguments[2]!==undefined?arguments[2]:string.length;regex=regex.global?regex:new RegExp(regex.source,"g"+(regex.ignoreCase?"i":"")+(regex.multiLine?"m":""));var stringToWorkWith=this.substring(0,startpos+1),lastIndexOf=-1,nextStop=0,result;while((result=regex.exec(stringToWorkWith))!=null){lastIndexOf=result.index;regex.lastIndex=++nextStop;}return lastIndexOf;}// -=-=-=-=-
// diffing
// -=-=-=-=-
function diff(s1,s2){if(typeof JsDiff==="undefined")return'diff not supported';return JsDiff.convertChangesToXML(JsDiff.diffWordsWithSpace(s1,s2));}// -=-=-=-=-
// testing
// -=-=-=-=-
function empty(s){// show-in-doc
return s=='';}var includes$1=features$1.includes?function(s,pattern){return s.includes(pattern);}:function(s,pattern){// Example:
// include("fooo!", "oo") // => true
return s.indexOf(pattern)>-1;};var include$1=includes$1;var startsWith=features$1.startsWith?function(s,pattern){return s.startsWith(pattern);}:function(s,pattern){// Example:
// startsWith("fooo!", "foo") // => true
return s.indexOf(pattern)===0;};function startsWithVowel(s){// show-in-doc
var c=s[0];return c==='A'||c==='E'||c==='I'||c==='O'||c==='U'||c==='a'||c==='e'||c==='i'||c==='o'||c==='u'||false;}var endsWith=features$1.endsWith?function(s,pattern){return s.endsWith(pattern);}:function(s,pattern){// Example:
// endsWith("fooo!", "o!") // => true
var d=s.length-pattern.length;return d>=0&&s.lastIndexOf(pattern)===d;};// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// string conversion and manipulation
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function withDecimalPrecision(str,precision){// String -> Number -> String
// Example: withDecimalPrecision("1.12345678", 3) // => "1.123"
var floatValue=parseFloat(str);return isNaN(floatValue)?str:floatValue.toFixed(precision);}function capitalize(s){// Example:
// capitalize("foo bar") // => "Foo bar"
return s.length?s.charAt(0).toUpperCase()+s.slice(1):s;}function camelCaseString(s){// Spaces to camels, including first char
// Example: camelCaseString("foo bar baz") // => "FooBarBaz"
return s.split(" ").map(capitalize).join("");}function camelize(s){// Dashes to camels, excluding first char
// Example: camelize("foo-bar-baz") // => "fooBarBaz"
var parts=s.split('-'),len=parts.length;if(len==1)return parts[0];var camelized=s.charAt(0)=='-'?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++){camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1);}return camelized;}function truncate(s,length,truncation){// Enforces that s is not more then `length` characters long.
// Example:
// truncate("123456789", 5) // => "12..."
length=length||30;truncation=truncation===undefined?'...':truncation;return s.length>length?s.slice(0,length-truncation.length)+truncation:String(s);}function truncateLeft(s,length,truncation){// Enforces that s is not more then `length` characters long.
// Example:
// truncate("123456789", 5) // => "12..."
length=length||30;truncation=truncation===undefined?'...':truncation;return s.length>length?truncation+s.slice(-length):String(s);}function regExpEscape(s){// For creating RegExps from strings and not worrying about proper escaping
// of RegExp special characters to literally match those.
// Example:
// var re = new RegExp(regExpEscape("fooo{20}"));
// re.test("fooo") // => false
// re.test("fooo{20}") // => true
return s.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,'\\$1').replace(/\x08/g,'\\x08');}function succ(s){// Uses char code.
// Example:
// succ("a") // => "b"
// succ("Z") // => "["
return s.slice(0,s.length-1)+String.fromCharCode(s.charCodeAt(s.length-1)+1);}function digitValue(s){// ignore-in-doc
return s.charCodeAt(0)-"0".charCodeAt(0);}var times=features$1.repeat?function(s,count){return s.repeat(count);}:function(s,count){// Example:
// string.times("test", 3) // => "testtesttest"
return count<1?'':new Array(count+1).join(s);};function longestCommonSubstring(a,b){// Example:
// longestCommonSubstring("bar foo barrr", "hello fooo world");
// => {indexA: 3, indexB: 5, length: 4, string: " foo"}
var lcs=[];for(var _i28=0;_i28<a.length;_i28++){lcs[_i28]=[];for(var _j2=0;_j2<b.length;_j2++){lcs[_i28][_j2]=0;}}// if B is null then LCS of A, B =0
for(var _i29=0;_i29<a.length;_i29++){lcs[_i29][0]=0;}// fill the rest of the matrix
for(var _i30=1;_i30<a.length;_i30++){for(var _j3=1;_j3<b.length;_j3++){lcs[_i30][_j3]=a[_i30-1]==b[_j3-1]?lcs[_i30-1][_j3-1]+1:0;}}var maxLength=-1,indexA=-1,indexB=-1;for(var _i31=0;_i31<a.length;_i31++){for(var _j4=0;_j4<b.length;_j4++){var length=lcs[_i31][_j4];if(maxLength<length){maxLength=length;indexA=_i31-length;indexB=_j4-length;}}}return{length:maxLength,indexA:indexA,indexB:indexB,string:maxLength>0?a.slice(indexA,indexA+maxLength):""};}function applyChange(string,change){// change is of the form
// `{start: Number, end: Number, lines: [String], action: "insert"|"remove"}`
if(change.action==="insert"){return string.slice(0,change.start)+change.lines.join("\n")+string.slice(change.start);}else if(change.action==="remove"){return string.slice(0,change.start)+string.slice(change.end);}return string;}function applyChanges(s,changes){return changes.reduce(function(result,change){return applyChange(s,change);},s);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// diffing / comparing
function levenshtein(a,b){// How many edit operations separate string a from b?
// MIT licensed, https://gist.github.com/andrei-
// Copyright (c) 2011 Andrei Mackenzie and https://github.com/kigiri
if(a.length===0)return b.length;if(b.length===0)return a.length;var tmp,i,j,prev,val,row;// swap to save some memory O(min(a,b)) instead of O(a)
if(a.length>b.length){tmp=a;a=b;b=tmp;}row=Array(a.length+1);// init the row
for(i=0;i<=a.length;i++){row[i]=i;}// fill in the rest
for(i=1;i<=b.length;i++){prev=i;for(j=1;j<=a.length;j++){if(b[i-1]===a[j-1]){val=row[j-1];// match
}else{val=Math.min(row[j-1]+1,// substitution
Math.min(prev+1,// insertion
row[j]+1));// deletion
}row[j-1]=prev;prev=val;}row[a.length]=prev;}return row[a.length];}var string=/*#__PURE__*/Object.freeze({__proto__:null,format:format,formatFromArray:formatFromArray,indent:indent$1,minIndent:minIndent,changeIndent:changeIndent,quote:quote,print:print$1,printNested:printNested,pad:pad,printTable:printTable,printTree:printTree,toArray:toArray$1,lines:lines,paragraphs:paragraphs,nonEmptyLines:nonEmptyLines,tokens:tokens,tableize:tableize,unescapeCharacterEntities:unescapeCharacterEntities,base64EncodeUnicode:base64EncodeUnicode,base64DecodeUnicode:base64DecodeUnicode,toQueryParams:toQueryParams,normalizePath:normalizePath,joinPath:joinPath,newUUID:newUUID,createDataURI:createDataURI,hashCode:hashCode,md5:md5,reMatches:reMatches$1,stringMatch:stringMatch,peekRight:peekRight,peekLeft:peekLeft,lineIndexComputer:lineIndexComputer,lineNumberToIndexesComputer:lineNumberToIndexesComputer,findLineWithIndexInLineRanges:findLineWithIndexInLineRanges,regexIndexOf:regexIndexOf,regexLastIndexOf:regexLastIndexOf,lineRanges:lineRanges,diff:diff,empty:empty,includes:includes$1,include:include$1,startsWith:startsWith,startsWithVowel:startsWithVowel,endsWith:endsWith,withDecimalPrecision:withDecimalPrecision,capitalize:capitalize,camelCaseString:camelCaseString,camelize:camelize,truncate:truncate,truncateLeft:truncateLeft,regExpEscape:regExpEscape,succ:succ,digitValue:digitValue,times:times,longestCommonSubstring:longestCommonSubstring,applyChange:applyChange,applyChanges:applyChanges,levenshtein:levenshtein});exports('s',string);/*
       * Utility functions for JS Numbers.
       */function random(min,max){// random number between (and including) `min` and `max`
min=min||0;max=max||100;return Math.round(Math.random()*(max-min)+min);}var normalRandom=function(mean,stdDev){// returns randomized numbers in a normal distribution that can be
// controlled ising the `mean` and `stdDev` parameters
var spare;var isSpareReady=false;return function(mean,stdDev){if(isSpareReady){isSpareReady=false;return spare*stdDev+mean;}else{var _u,_v2,_s2;do{_u=Math.random()*2-1;_v2=Math.random()*2-1;_s2=_u*_u+_v2*_v2;}while(_s2>=1||_s2==0);var mul=Math.sqrt(-2.0*Math.log(_s2)/_s2);spare=_v2*mul;isSpareReady=true;return mean+stdDev*_u*mul;}};}();function randomSmallerInteger(n){return Math.floor(Math.random()*n);}function humanReadableByteSize(n){// interpret `n` as byte size and print a more readable version
// Example:
//   num.humanReadableByteSize(Math.pow(2,32)) // => "4096MB"
function round(n){return Math.round(n*100)/100;}if(n<1000)return String(round(n))+'B';n=n/1024;if(n<1000)return String(round(n))+'KB';n=n/1024;return String(round(n))+'MB';}function average(numbers){// show-in-doc
return numbers.reduce(function(sum,n){return sum+n;},0)/numbers.length;}function averageInc(newVal,oldAvg,n){// show-in-doc
// Example:
//   let nums = range(0, 10).map(() => random(0, 10))
//   nums.reduce((avg, ea, i) => avgInc(ea, avg, i+1), 0);
return(newVal-oldAvg)/n+oldAvg;}function median(numbers){// show-in-doc
var sorted=numbers.sort(function(a,b){return b-a;});var len=numbers.length;return len%2===0?0.5*(sorted[len/2-1]+sorted[len/2]):sorted[(len-1)/2];}function between(x,a,b,eps){// is `a` <= `x` <= `y`?
eps=eps||0;var min,max;if(a<b){min=a,max=b;}else{max=a,min=b;}return max-x+eps>=0&&min-x-eps<=0;}function clamp(x,lower,upper){return Math.max(lower,Math.min(upper,x));}function sort$1(arr){// numerical sort, JavaScript native `sort` function is lexical by default.
return arr.sort(function(a,b){return a-b;});}function parseLength(string,toUnit){// This converts the length value to pixels or the specified `toUnit`.
// length converstion, supported units are: mm, cm, in, px, pt, pc
// Examples:
// num.parseLength('3cm') // => 113.38582677165354
// num.parseLength('3cm', "in") // => 1.1811023622047243
toUnit=toUnit||'px';var match=string.match(/([0-9\.]+)\s*(.*)/);if(!match||!match[1])return undefined;var length=parseFloat(match[1]);var fromUnit=match[2];return convertLength(length,fromUnit,toUnit);}var convertLength=function(){// ignore-in-doc
// num.convertLength(20, 'px', 'pt').roundTo(0.01)
function toCm(n,unit){// as defined in http://www.w3.org/TR/css3-values/#absolute-lengths
if(unit==='cm')return n;else if(unit==='mm')return n*0.1;else if(unit==='in')return n*2.54;else if(unit==='px')return n*toCm(1/96,'in');else if(unit==='pt')return n*toCm(1/72,'in');else if(unit==='pc')return n*toCm(12,'pt');}return function to(length,fromUnit,toUnit){if(fromUnit===toUnit)return length;else if(toUnit==='cm')return toCm(length,fromUnit);else if(fromUnit==='cm')return length/toCm(1,toUnit);else return to(to(length,fromUnit,'cm'),'cm',toUnit);};}();function precision(f){// given a float value, returns the number of decimals
if(!isFinite(f))return 0;var e=1;var p=0;while(Math.round(f*e)/e!==f){e*=10;p++;}return p;}function roundTo(n,quantum){// `quantum` is something like 0.01,
// for JS rounding to work we need the reciprocal
quantum=1/quantum;return Math.round(n*quantum)/quantum;}function detent(n,detent,grid,snap){// This function is useful to implement smooth transitions and snapping.
// Map all values that are within detent/2 of any multiple of grid to
// that multiple. Otherwise, if snap is true, return self, meaning that
// the values in the dead zone will never be returned. If snap is
// false, then expand the range between dead zone so that it covers the
// range between multiples of the grid, and scale the value by that
// factor.
// Examples:
// // With snapping:
// num.detent(0.11, 0.2, 0.5, true) // => 0.11
// num.detent(0.39, 0.2, 0.5, true) // => 0.39
// num.detent(0.55, 0.2, 0.5, true)  // => 0.5
// num.detent(0.61, 0.2, 0.5, true)   // => 0.61
// // Smooth transitions without snapping:
// num.detent(0.1,  0.2, 0.5) // => 0
// num.detent(0.11,  0.2, 0.5) // => 0.0166666
// num.detent(0.34,  0.2, 0.5)  // => 0.4
// num.detent(0.39,  0.2, 0.5) // => 0.4833334
// num.detent(0.4,  0.2, 0.5) // => 0.5
// num.detent(0.6,  0.2, 0.5) // => 0.5
var r1=roundTo(n,grid);// Nearest multiple of grid
if(Math.abs(n-r1)<detent/2)return r1;// Snap to that multiple...
if(snap)return n;// ...and return n
// or compute nearest end of dead zone
var r2=n<r1?r1-detent/2:r1+detent/2;// and scale values between dead zones to fill range between multiples
return r1+(n-r2)*grid/(grid-detent);}function toDegrees(n){// Example:
// num.toDegrees(Math.PI/2) // => 90
return n*180/Math.PI%360;}function toRadians(n){// Example:
// num.toRadians(180) // => 3.141592653589793
return n/180*Math.PI;}function backoff(attempt)/* ms */{var base=arguments.length>1&&arguments[1]!==undefined?arguments[1]:5;var cap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:30000;// exponential backoff function
// https://www.awsarchitectureblog.com/2015/03/backoff.html
var temp=Math.min(cap,base*Math.pow(2,attempt));var sleep=temp/2+Math.round(Math.random()*(temp/2));return Math.min(cap,base+Math.random()*(sleep*3-base));}function interpolate(i,a,b){return a+i*(b-a);}var num=/*#__PURE__*/Object.freeze({__proto__:null,random:random,normalRandom:normalRandom,randomSmallerInteger:randomSmallerInteger,humanReadableByteSize:humanReadableByteSize,average:average,averageInc:averageInc,median:median,between:between,sort:sort$1,parseLength:parseLength,convertLength:convertLength,roundTo:roundTo,detent:detent,toDegrees:toDegrees,toRadians:toRadians,backoff:backoff,interpolate:interpolate,clamp:clamp,precision:precision});exports('n',num);function all$2(object,predicate){// ignore-in-doc
var a=[];for(var name in object){if((object.__lookupGetter__(name)||typeof object[name]!=='function')&&(predicate?predicate(name,object):true)){a.push(name);}}return a;}function allOwnPropertiesOrFunctions(obj,predicate){// ignore-in-doc
return Object.getOwnPropertyNames(obj).reduce(function(result,name){if(predicate?predicate(obj,name):true)result.push(name);return result;},[]);}function own$1(object){// ignore-in-doc
var a=[];for(var name in object){if(object.hasOwnProperty(name)&&(object.__lookupGetter__(name)||object[name]!=='function')){a.push(name);}}return a;}function forEachOwn(object,func,context){// ignore-in-doc
var result=[];for(var name in object){if(!object.hasOwnProperty(name))continue;var value=object[name];if(value!=='function'){result.push(func.call(context||this,name,value));}}return result;}function nameFor(object,value){// ignore-in-doc
for(var name in object){if(object[name]===value){return name;}}return undefined;}function values$1(obj){// ignore-in-doc
var values=[];for(var name in obj){values.push(obj[name]);}return values;}function ownValues(obj){// ignore-in-doc
var values=[];for(var name in obj){if(obj.hasOwnProperty(name)){values.push(obj[name]);}}return values;}function any$1(obj,predicate){// ignore-in-doc
for(var name in obj){if(predicate(obj,name)){return true;}}return false;}function allProperties(obj,predicate){// ignore-in-doc
var result=[];for(var name in obj){if(predicate?predicate(obj,name):true){result.push(name);}}return result;}function hash(obj){// ignore-in-doc
// Using the property names of `obj` to generate a hash value.
return Object.keys(obj).sort().join('').hashCode();}var properties=/*#__PURE__*/Object.freeze({__proto__:null,all:all$2,allOwnPropertiesOrFunctions:allOwnPropertiesOrFunctions,own:own$1,forEachOwn:forEachOwn,nameFor:nameFor,values:values$1,ownValues:ownValues,any:any$1,allProperties:allProperties,hash:hash});/*
       * Util functions to print and work with JS date objects.
       */var dateFormat=function setupDateFormat(){/*
         * Date Format 1.2.3
         * (c) 2007-2009 Steven Levithan <stevenlevithan.com>
         * MIT license
         *
         * Includes enhancements by Scott Trenda <scott.trenda.net>
         * and Kris Kowal <cixar.com/~kris.kowal/>
         *
         * Accepts a date, a mask, or a date and a mask.
         * Returns a formatted version of the given date.
         * The date defaults to the current date/time.
         * The mask defaults to dateFormat.masks.default.
         */ // http://blog.stevenlevithan.com/archives/date-time-format
var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g;var timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g;var timezoneClip=/[^-+\dA-Z]/g;var pad=function pad(val,len){val=String(val);len=len||2;while(val.length<len){val='0'+val;}return val;};// Regexes and supporting functions are cached through closure
return function(date,mask,utc){var dF=dateFormat;// You can't provide utc if you skip other args (use the "UTC:" mask prefix)
if(arguments.length==1&&Object.prototype.toString.call(date)=='[object String]'&&!/\d/.test(date)){mask=date;date=undefined;}// Passing date through Date applies Date.parse, if necessary
date=date?new Date(date):new Date();if(isNaN(date))throw SyntaxError('invalid date');mask=String(dF.masks[mask]||mask||dF.masks["default"]);// Allow setting the utc argument via the mask
if(mask.slice(0,4)=='UTC:'){mask=mask.slice(4);utc=true;}var _=utc?'getUTC':'get';var d=date[_+'Date']();var D=date[_+'Day']();var m=date[_+'Month']();var y=date[_+'FullYear']();var H=date[_+'Hours']();var M=date[_+'Minutes']();var s=date[_+'Seconds']();var L=date[_+'Milliseconds']();var o=utc?0:date.getTimezoneOffset();var flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?'a':'p',tt:H<12?'am':'pm',T:H<12?'A':'P',TT:H<12?'AM':'PM',Z:utc?'UTC':(String(date).match(timezone)||['']).pop().replace(timezoneClip,''),o:(o>0?'-':'+')+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:['th','st','nd','rd'][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1);});};}();// Some common format strings
dateFormat.masks={"default":'ddd mmm dd yyyy HH:MM:ss',shortDate:'m/d/yy',mediumDate:'mmm d, yyyy',longDate:'mmmm d, yyyy',fullDate:'dddd, mmmm d, yyyy',shortTime:'h:MM TT',mediumTime:'h:MM:ss TT',longTime:'h:MM:ss TT Z',isoDate:'yyyy-mm-dd',isoTime:'HH:MM:ss',isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};// Internationalization strings
dateFormat.i18n={dayNames:['Sun','Mon','Tue','Wed','Thu','Fri','Sat','Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],monthNames:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec','January','February','March','April','May','June','July','August','September','October','November','December']};return dateFormat;}();// end of setupDateFormat
function format$1(date,mask,utc){// Custom date / time stringifier. Provides default masks:
//
// Mask           | Pattern
// ---------------|--------------------------------
// default        | `"ddd mmm dd yyyy HH:MM:ss"`
// shortDate      | `"m/d/yy"`
// mediumDate     | `"mmm d, yyyy"`
// longDate       | `"mmmm d, yyyy"`
// fullDate       | `"dddd, mmmm d, yyyy"`
// shortTime      | `"h:MM TT"`
// mediumTime     | `"h:MM:ss TT"`
// longTime       | `"h:MM:ss TT Z"`
// isoDate        | `"yyyy-mm-dd"`
// isoTime        | `"HH:MM:ss"`
// isoDateTime    | `"yyyy-mm-dd'T'HH:MM:ss"`
// isoUtcDateTime | `"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"`
//
// and internationalized strings via `date.format.i18n.dayNames`
// and `date.format.i18n.dayNames`
// Examples:
//   date.format(new Date(), date.format.masks.longTime) // => "7:13:31 PM PDT"
//   date.format(new Date(), "yyyy/mm/dd") // => "2014/10/09"
return dateFormat(date,mask,utc);}function equals$2(date,otherDate){// show-in-doc
return otherDate&&otherDate instanceof Date&&otherDate.getTime()===date.getTime();}function relativeTo(date,otherDate){var opts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};// Prints a human readable difference of two Date objects. The older date
// goes first.
// Examples:
//   var now = new Date();
//   date.relativeTo(new Date(now-2000), now) // => "2 secs"
//   date.relativeTo(new Date("10/11/2014"), new Date("10/12/2014")) // => "1 day"
if(!(otherDate instanceof Date))return'';if(otherDate<date)return'';if(otherDate===date)return'now';var minuteString='min';var secondString='sec';var hourString='hour';var dayString='day';var diff=otherDate-date;var totalSecs=Math.round(diff/1000);var secs=totalSecs%60;var mins=Math.floor(totalSecs/60)%60;var hours=Math.floor(totalSecs/60/60)%24;var days=Math.floor(totalSecs/60/60/24);var parts=[];if(days>0){parts.push(days);if(days>1)dayString+='s';parts.push(dayString);}if(opts.forceHours||hours>0&&days<2){parts.push(hours);if(hours>1)hourString+='s';parts.push(hourString);}if(opts.forceMinutes||mins>0&&hours<3&&days===0){parts.push(mins);if(mins>1)minuteString+='s';parts.push(minuteString);}if(opts.forceSeconds||secs>0&&mins<3&&hours===0&&days===0){parts.push(secs);if(secs>1)secondString+='s';parts.push(secondString);}return parts.join(' ');}var date=/*#__PURE__*/Object.freeze({__proto__:null,format:format$1,equals:equals$2,relativeTo:relativeTo,dateFormat:dateFormat});/* global require, process, Promise, System */ /*
       * Methods helping with promises (Promise/A+ model). Not a promise shim.
       */function promise(obj){// Promise object / function converter
// Example:
// promise("foo");
//   // => Promise({state: "fullfilled", value: "foo"})
// lively.lang.promise({then: (resolve, reject) => resolve(23)})
//   // => Promise({state: "fullfilled", value: 23})
// lively.lang.promise(function(val, thenDo) { thenDo(null, val + 1) })(3)
//   // => Promise({state: "fullfilled", value: 4})
return typeof obj==='function'?promise.convertCallbackFun(obj):Promise.resolve(obj);}function delay$1(ms,resolveVal){// Like `Promise.resolve(resolveVal)` but waits for `ms` milliseconds
// before resolving
return new Promise(function(resolve){return setTimeout(resolve,ms,resolveVal);});}function delayReject(ms,rejectVal){// like `promise.delay` but rejects
return new Promise(function(_,reject){return setTimeout(reject,ms,rejectVal);});}function timeout(ms,promise){// Takes a promise and either resolves to the value of the original promise
// when it succeeds before `ms` milliseconds passed or fails with a timeout
// error
return new Promise(function(resolve,reject){var done=false;setTimeout(function(){return!done&&(done=true)&&reject(new Error('Promise timed out'));},ms);promise.then(function(val){return!done&&(done=true)&&resolve(val);},function(err){return!done&&(done=true)&&reject(err);});});}function waitFor$1(ms,tester,timeoutObj){// Tests for a condition calling function `tester` until the result is
// truthy. Resolves with last return value of `tester`. If `ms` is defined
// and `ms` milliseconds passed, reject with timeout error
// if timeoutObj is passed will resolve(!) with this object instead of raise
// an error
if(typeof ms==='function'){tester=ms;ms=undefined;}return new Promise(function(resolve,reject){var stopped=false;var timedout=false;var error;var value;var stopWaiting=function stopWaiting(i){clearInterval(i);};var i=setInterval(function(){if(stopped)return stopWaiting(i);try{value=tester();}catch(e){error=e;}if(!value&&!error&&!timedout)return;stopped=true;stopWaiting(i);if(error)return reject(error);if(timedout){return typeof timeoutObj==='undefined'?reject(new Error('timeout')):resolve(timeoutObj);}return resolve(value);},10);if(typeof ms==='number')setTimeout(function(){return timedout=true;},ms);});}function deferred(){// returns an object
// `{resolve: FUNCTION, reject: FUNCTION, promise: PROMISE}`
// that separates the resolve/reject handling from the promise itself
// Similar to the deprecated `Promise.defer()`
var resolve;var reject;var promise=new Promise(function(_resolve,_reject){resolve=_resolve;reject=_reject;});return{resolve:resolve,reject:reject,promise:promise};}function convertCallbackFun(func){// Takes a function that accepts a nodejs-style callback function as a last
// parameter and converts it to a function *not* taking the callback but
// producing a promise instead. The promise will be resolved with the
// *first* non-error argument.
// nodejs callback convention: a function that takes as first parameter an
// error arg and second+ parameters are the result(s).
// Example:
// var fs = require("fs"),
//     readFile = promise.convertCallbackFun(fs.readFile);
// readFile("./some-file.txt")
//   .then(content => console.log(String(content)))
//   .catch(err => console.error("Could not read file!", err));
return function promiseGenerator()/* args */{var args=Array.from(arguments);var self=this;return new Promise(function(resolve,reject){args.push(function(err,result){return err?reject(err):resolve(result);});func.apply(self,args);});};}function convertCallbackFunWithManyArgs(func){// like convertCallbackFun but the promise will be resolved with the
// all non-error arguments wrapped in an array.
return function promiseGenerator()/* args */{var args=Array.from(arguments);var self=this;return new Promise(function(resolve,reject){args.push(function()/* err + args */{var args=Array.from(arguments);var err=args.shift();return err?reject(err):resolve(args);});func.apply(self,args);});};}function _chainResolveNext(promiseFuncs,prevResult,akku,resolve,reject){var next=promiseFuncs.shift();if(!next)resolve(prevResult);else{try{Promise.resolve(next(prevResult,akku)).then(function(result){return _chainResolveNext(promiseFuncs,result,akku,resolve,reject);})["catch"](function(err){reject(err);});}catch(err){reject(err);}}}function chain(promiseFuncs){// Similar to Promise.all but takes a list of promise-producing functions
// (instead of Promises directly) that are run sequentially. Each function
// gets the result of the previous promise and a shared "state" object passed
// in. The function should return either a value or a promise. The result of
// the entire chain call is a promise itself that either resolves to the last
// returned value or rejects with an error that appeared somewhere in the
// promise chain. In case of an error the chain stops at that point.
// Example:
// lively.lang.promise.chain([
//   () => Promise.resolve(23),
//   (prevVal, state) => { state.first = prevVal; return prevVal + 2 },
//   (prevVal, state) => { state.second = prevVal; return state }
// ]).then(result => console.log(result));
// // => prints {first: 23,second: 25}
return new Promise(function(resolve,reject){return _chainResolveNext(promiseFuncs.slice(),undefined,{},resolve,reject);});}function promise_finally(promise,finallyFn){return Promise.resolve(promise).then(function(result){try{finallyFn();}catch(err){console.error('Error in promise finally: '+err.stack||err);}return result;})["catch"](function(err){try{finallyFn();}catch(err){console.error('Error in promise finally: '+err.stack||err);}throw err;});}function parallel(promiseGenFns){var parallelLimit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Infinity;// Starts functions from promiseGenFns that are expected to return a promise
// Once `parallelLimit` promises are unresolved at the same time, stops
// spawning further promises until a running promise resolves
if(!promiseGenFns.length)return Promise.resolve([]);var results=[];var error=null;var index=0;var left=promiseGenFns.length;var resolve;var reject;return new Promise(function(res,rej){resolve=function resolve(){return res(results);};reject=function reject(err){return rej(error=err);};spawnMore();});function spawn(){parallelLimit--;try{var _i32=index++;var prom=promiseGenFns[_i32]();prom.then(function(result){parallelLimit++;results[_i32]=result;if(--left===0)resolve();else spawnMore();})["catch"](function(err){return reject(err);});}catch(err){reject(err);}}function spawnMore(){while(!error&&left>0&&index<promiseGenFns.length&&parallelLimit>0){spawn();}}}// FIXME!
Object.assign(promise,{delay:delay$1,delayReject:delayReject,timeout:timeout,waitFor:waitFor$1,deferred:deferred,convertCallbackFun:convertCallbackFun,convertCallbackFunWithManyArgs:convertCallbackFunWithManyArgs,chain:chain,"finally":promise_finally,parallel:parallel});// -=-=-=-=-=-=-=-=-=-=-=-=-=-
function Path(p,splitter){if(p instanceof Path)return p;if(!(this instanceof Path))return new Path(p,splitter);this.setSplitter(splitter||'.');this.fromPath(p);}Object.assign(Path.prototype,{get isPathAccessor(){return true;},fromPath:function fromPath(path){// ignore-in-doc
if(typeof path==='string'&&path!==''&&path!==this.splitter){this._parts=path.split(this.splitter);this._path=path;}else if(Array.isArray(path)){this._parts=[].concat(path);this._path=path.join(this.splitter);}else{this._parts=[];this._path='';}return this;},setSplitter:function setSplitter(splitter){// ignore-in-doc
if(splitter)this.splitter=splitter;return this;},map:function map(fn){this._mapper=fn;return this;},parts:function parts(){/* key names as array */return this._parts;},size:function size(){/* show-in-doc */return this._parts.length;},slice:function slice(n,m){/* show-in-doc */return Path(this.parts().slice(n,m));},normalizePath:function normalizePath(){// ignore-in-doc
// FIXME: define normalization
return this._path;},isRoot:function isRoot(obj){return this._parts.length===0;},isIn:function isIn(obj){// Does the Path resolve to a value when applied to `obj`?
if(this.isRoot())return true;var parent=this.get(obj,-1);return parent&&parent.hasOwnProperty(this._parts[this._parts.length-1]);},equals:function equals(obj){// Example:
// var p1 = Path("foo.1.bar.baz"), p2 = Path(["foo", 1, "bar", "baz"]);
// // Path's can be both created via strings or pre-parsed with keys in a list.
// p1.equals(p2) // => true
return obj&&obj.isPathAccessor&&this.parts().equals(obj.parts());},isParentPathOf:function isParentPathOf(otherPath){// Example:
// var p1 = Path("foo.1.bar.baz"), p2 = Path("foo.1.bar");
// p2.isParentPathOf(p1) // => true
// p1.isParentPathOf(p2) // => false
otherPath=otherPath&&otherPath.isPathAccessor?otherPath:Path(otherPath);var parts=this.parts();var otherParts=otherPath.parts();for(var _i33=0;_i33<parts.length;_i33++){if(parts[_i33]!=otherParts[_i33])return false;}return true;},relativePathTo:function relativePathTo(otherPath){// Example:
// var p1 = Path("foo.1.bar.baz"), p2 = Path("foo.1");
// p2.relativePathTo(p1) // => Path(["bar","baz"])
// p1.relativePathTo(p2) // => undefined
otherPath=Path(otherPath);return this.isParentPathOf(otherPath)?otherPath.slice(this.size(),otherPath.size()):undefined;},del:function del(obj){if(this.isRoot())return false;var parent=obj;for(var _i34=0;_i34<this._parts.length-1;_i34++){var part=this._parts[_i34];if(parent.hasOwnProperty(part)){parent=parent[part];}else return false;}return delete parent[this._parts[this._parts.length-1]];},withParentAndKeyDo:function withParentAndKeyDo(obj,ensure,doFunc){// Deeply resolve path in `obj`, not fully, however, only to the parent
// element of the last part of path. Take the parent, the key (the last
// part of path) and pass it to `doFunc`. When `ensure` is true, create
// objects along path it path does not resolve
if(this.isRoot())return doFunc(null,null);var parent=obj;for(var _i35=0;_i35<this._parts.length-1;_i35++){var part=this._parts[_i35];if(parent.hasOwnProperty(part)&&(_typeof2(parent[part])==='object'||typeof parent[part]==='function')){parent=parent[part];}else if(ensure){parent=parent[part]={};}else{return doFunc(null,part);}}return doFunc(parent,this._parts[this._parts.length-1]);},set:function set(obj,val,ensure){// Deeply resolve path in `obj` and set the resulting property to `val`. If
// `ensure` is true, create nested structure in between as necessary.
// Example:
// var o1 = {foo: {bar: {baz: 42}}};
// var path = Path("foo.bar.baz");
// path.set(o1, 43)
// o1 // => {foo: {bar: {baz: 43}}}
// var o2 = {foo: {}};
// path.set(o2, 43, true)
// o2 // => {foo: {bar: {baz: 43}}}
return this.withParentAndKeyDo(obj,ensure,function(parent,key){return parent?parent[key]=val:undefined;});},defineProperty:function defineProperty(obj,propertySpec,ensure){// like `Path>>set`, however uses Objeect.defineProperty
return this.withParentAndKeyDo(obj,ensure,function(parent,key){return parent?Object.defineProperty(parent,key,propertySpec):undefined;});},get:function get(obj,n){// show-in-doc
var parts=n?this._parts.slice(0,n):this._parts;var self=this;return parts.reduce(function(current,pathPart){return current?self._mapper?self._mapper(pathPart,current[pathPart]):current[pathPart]:current;},obj);},concat:function concat(p,splitter){// show-in-doc
return Path(this.parts().concat(Path(p,splitter).parts()));},toString:function toString(){return this.normalizePath();},serializeExpr:function serializeExpr(){// ignore-in-doc
return'lively.lang.Path('+inspect(this.parts())+')';},watch:function watch(options){// React or be notified on reads or writes to a path in a `target`. Options:
// ```js
// {
//   target: OBJECT,
//   uninstall: BOOLEAN,
//   onGet: FUNCTION,
//   onSet: FUNCTION,
//   haltWhenChanged: BOOLEAN,
//   verbose: BOOLEAN
// }
// ```
// Example:
// // Quite useful for debugging to find out what call-sites change an object.
// var o = {foo: {bar: 23}};
// Path("foo.bar").watch({target: o, verbose: true});
// o.foo.bar = 24; // => You should see: "[object Object].bar changed: 23 -> 24"
if(!options||this.isRoot())return;var target=options.target;var parent=this.get(target,-1);var propName=this.parts().slice(-1)[0];var newPropName='propertyWatcher$'+propName;var watcherIsInstalled=parent&&parent.hasOwnProperty(newPropName);var uninstall=options.uninstall;var haltWhenChanged=options.haltWhenChanged;var showStack=options.showStack;var getter=parent.__lookupGetter__(propName);var setter=parent.__lookupSetter__(propName);if(!target||!propName||!parent)return;if(uninstall){if(!watcherIsInstalled)return;delete parent[propName];parent[propName]=parent[newPropName];delete parent[newPropName];var msg='Watcher for '+parent+'.'+propName+' uninstalled';return;}if(watcherIsInstalled){var msg='Watcher for '+parent+'.'+propName+' already installed';return;}if(getter||setter){var msg=parent+'["'+propName+'"] is a getter/setter, watching not support';console.log(msg);return;}// observe slots, for debugging
parent[newPropName]=parent[propName];parent.__defineSetter__(propName,function(v){var oldValue=parent[newPropName];if(options.onSet)options.onSet(v,oldValue);var msg=parent+'.'+propName+' changed: '+oldValue+' -> '+v;if(showStack){msg+='\n'+(typeof lively!=='undefined'?lively.printStack():console.trace());}if(options.verbose){console.log(msg);}if(haltWhenChanged)debugger;return parent[newPropName]=v;});parent.__defineGetter__(propName,function(){if(options.onGet)options.onGet(parent[newPropName]);return parent[newPropName];});var msg='Watcher for '+parent+'.'+propName+' installed';console.log(msg);},debugFunctionWrapper:function debugFunctionWrapper(options){// ignore-in-doc
// options = {target, [haltWhenChanged, showStack, verbose, uninstall]}
var target=options.target;var parent=this.get(target,-1);var funcName=this.parts().slice(-1)[0];var uninstall=options.uninstall;var haltWhenChanged=options.haltWhenChanged===undefined?true:options.haltWhenChanged;var showStack=options.showStack;var func=parent&&funcName&&parent[funcName];var debuggerInstalled=func&&func.isDebugFunctionWrapper;if(!target||!funcName||!func||!parent)return;if(uninstall){if(!debuggerInstalled)return;parent[funcName]=parent[funcName].debugTargetFunction;var msg='Uninstalled debugFunctionWrapper for '+parent+'.'+funcName;console.log(msg);return;}if(debuggerInstalled){var msg='debugFunctionWrapper for '+parent+'.'+funcName+' already installed';console.log(msg);return;}var debugFunc=parent[funcName]=func.wrap(function(proceed){var args=Array.from(arguments);if(haltWhenChanged)debugger;return args.shift().apply(parent,args);});debugFunc.isDebugFunctionWrapper=true;debugFunc.debugTargetFunction=func;var msg='debugFunctionWrapper for '+parent+'.'+funcName+' installed';console.log(msg);}});/*
      Computation over graphs. Unless otherwise specified a graph is a simple JS
      object whose properties are interpreted as nodes that refer to arrays whose
      elements describe edges. Example:

      ```js
      var testGraph = {
        "a": ["b", "c"],
        "b": ["c", "d", "e", "f"],
        "d": ["c", "f"],
        "e": ["a", "f"],
        "f": []
      }
      ```
      */ // show-in-doc
function clone$2(graph){// return a copy of graph map
var cloned={};for(var id in graph){cloned[id]=graph[id].slice();}return cloned;}function without$1(graph,ids){// return a copy of graph map with ids removed
var cloned={};for(var id in graph){if(ids.includes(id))continue;cloned[id]=[];var refs=graph[id];for(var _i36=0;_i36<refs.length;_i36++){var ref=refs[_i36];if(!ids.includes(ref)){cloned[id].push(ref);}}}return cloned;}function hull(g,id){var ignoredKeyList=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var maxDepth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Infinity;// Takes a graph in object format and a start id and then traverses the
// graph and gathers all nodes that can be reached from that start id.
// Returns a list of those nodes.
// Optionally use `ignore` list to filter out certain nodes that shouldn't
// be considered and maxDepth to stop early. By default a maxDepth of 20 is
// used.
// Example:
// var testGraph = {
// "a": ["b", "c"],
// "b": ["c", "d", "e", "f"],
// "d": ["c", "f"],
// "e": ["a", "f"],
// "f": []
// }
// hull(testGraph, "d") // => ["c", "f"]
// hull(testGraph, "e") // => ['a', 'f', 'b', 'c', 'd', 'e']
// hull(testGraph, "e", ["b"]) // => ["a", "f", "c"]
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// below is an optimized variant, the functional but slow version:
// return uniq(
//         flatten(
//           values(
//             subgraphReachableBy(
//               graphMap, id, ignore, maxDepth))));
if(!Array.isArray(g[id]))return[];var hull=[];var visited={};var ignoredKeys={};for(var _i37=0;_i37<ignoredKeyList.length;_i37++){ignoredKeys[ignoredKeyList[_i37]]=true;}var toVisitList=g[id].slice();var toVisitMapAndDistFromRoot={};for(var _i38=toVisitList.length;_i38--;){var key=toVisitList[_i38];if(key in ignoredKeys)toVisitList.splice(_i38,1);else toVisitMapAndDistFromRoot[key]=1;}if(ignoredKeyList){while(true){if(toVisitList.length===0)break;for(var _i39=0;_i39<toVisitList.length;_i39++){var _key5=toVisitList.shift();if(_key5 in visited||_key5 in ignoredKeys)continue;var dist=toVisitMapAndDistFromRoot[_key5]||0;if(dist>maxDepth)continue;hull.push(_key5);visited[_key5]=true;var refs=g[_key5];if(!refs)continue;for(var _j5=0;_j5<refs.length;_j5++){var refKey=refs[_j5];if(refKey in visited||refKey in toVisitMapAndDistFromRoot)continue;toVisitMapAndDistFromRoot[refKey]=dist+1;toVisitList.push(refKey);}}}}return hull;}function subgraphReachableBy(graphMap,startId,ignore){var maxDepth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Infinity;// show-in-doc
// Like hull but returns subgraph map of `graphMap`
// Example:
// subgraphReachableBy(testGraph, "e", [], 2);
// // => {e: [ 'a', 'f' ], a: [ 'b', 'c' ], f: []}
if(ignore)graphMap=without$1(graphMap,ignore);var ids=[startId];var step=0;var subgraph={};while(ids.length&&step++<maxDepth){var id=ids.shift();if(subgraph[id])continue;var newIds=graphMap[id]||[];subgraph[id]=newIds;ids.push.apply(ids,_toConsumableArray2(newIds));}return subgraph;}function invert(g){// inverts the references of graph object `g`.
// Example:
// invert({a: ["b"], b: ["a", "c"]})
//   // => {a: ["b"], b: ["a"], c: ["b"]}
var inverted={};for(var key in g){var refs=g[key];for(var _i40=0;_i40<refs.length;_i40++){var key2=refs[_i40];if(!inverted[key2])inverted[key2]=[key];else inverted[key2].push(key);}}return inverted;}function sortByReference(depGraph,startNode){// Sorts graph into an array of arrays. Each "bucket" contains the graph
// nodes that have no other incoming nodes than those already visited. This
// means, we start with the leaf nodes and then walk our way up.
// This is useful for computing how to traverse a dependency graph: You get
// a sorted list of dependencies that also allows circular references.
// Example:
// var depGraph = {a: ["b", "c"], b: ["c"], c: ["b"]};
// sortByReference(depGraph, "a");
// // => [["c"], ["b"], ["a"]]
// establish unique list of keys
var remaining=[];var remainingSeen={};var uniqDepGraph={};var inverseDepGraph={};for(var _key6 in depGraph){if(!remainingSeen.hasOwnProperty(_key6)){remainingSeen[_key6]=true;remaining.push(_key6);}var deps=depGraph[_key6];var uniqDeps={};if(deps){uniqDepGraph[_key6]=[];var _iterator7=_createForOfIteratorHelper(deps),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var dep=_step7.value;if(uniqDeps.hasOwnProperty(dep)||_key6===dep)continue;var inverse=inverseDepGraph[dep]||(inverseDepGraph[dep]=[]);if(!inverse.includes(_key6))inverse.push(_key6);uniqDeps[dep]=true;uniqDepGraph[_key6].push(dep);if(!remainingSeen.hasOwnProperty(dep)){remainingSeen[dep]=true;remaining.push(dep);}}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}}}// for each iteration find the keys with the minimum number of dependencies
// and add them to the result group list
var groups=[];while(remaining.length){var minDepCount=Infinity;var minKeys=[];var minKeyIndexes=[];var affectedKeys=[];for(var i=0;i<remaining.length;i++){var key=remaining[i];var _deps3=uniqDepGraph[key]||[];if(_deps3.length>minDepCount)continue;// if (deps.length === minDepCount && !minKeys.some(ea => deps.includes(ea))) {
if(_deps3.length===minDepCount&&!_deps3.some(function(ea){return minKeys.includes(ea);})){var _affectedKeys3;minKeys.push(key);minKeyIndexes.push(i);(_affectedKeys3=affectedKeys).push.apply(_affectedKeys3,_toConsumableArray2(inverseDepGraph[key]||[]));continue;}minDepCount=_deps3.length;minKeys=[key];minKeyIndexes=[i];affectedKeys=(inverseDepGraph[key]||[]).slice();}for(var i=minKeyIndexes.length;i--;){var key=remaining[minKeyIndexes[i]];inverseDepGraph[key]=[];remaining.splice(minKeyIndexes[i],1);}var _iterator8=_createForOfIteratorHelper(affectedKeys),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var key=_step8.value;uniqDepGraph[key]=uniqDepGraph[key].filter(function(ea){return!minKeys.includes(ea);});}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}groups.push(minKeys);}return groups;}function reduce$1(doFunc,graph,rootNode,carryOver,ignore,context){// Starts with `rootNode` and visits all (in)directly related nodes, calling
// `doFunc` at each node. The result of `doFunc` is passed as first
// argument to the next iterator call. For the first call the value
// `carryOver` is used.
// Example:
// var depGraph = {a: ["b", "c"],b: ["c"]}
// graphReduce((_, ea, i) => console.log("%s %s", ea, i), depGraph, "a")
var visitedNodes=ignore||[];var index=0;iterator(rootNode);return carryOver;function iterator(currentNode){if(visitedNodes.indexOf(currentNode)>-1)return;carryOver=doFunc.call(context,carryOver,currentNode,index++);visitedNodes=visitedNodes.concat([currentNode]);var next=withoutAll(graph[currentNode]||[],visitedNodes);next.forEach(function(ea){return iterator(ea);});}}function random$1(){var nKeys=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;var g={};var keys=range(1,nKeys).map(String);for(var _i41=0;_i41<keys.length;_i41++){var _r=Math.floor(Math.random()*nKeys);g[keys[_i41]]=shuffle(keys).slice(0,_r);}return g;}var graph=/*#__PURE__*/Object.freeze({__proto__:null,clone:clone$2,without:without$1,hull:hull,subgraphReachableBy:subgraphReachableBy,invert:invert,sortByReference:sortByReference,reduce:reduce$1,random:random$1});/* global System, global */ // show-in-doc
// Intervals are arrays whose first two elements are numbers and the
// first element should be less or equal the second element, see
// [`interval.isInterval`](). This abstraction is useful when working with text
// ranges in rich text, for example.
var GLOBAL$1=typeof System!=='undefined'?System.global:typeof window!=='undefined'?window:global;// show-in-doc
// A grid is a two-dimaensional array, representing a table-like data
function get(grid,nRow,nCol){var row=grid[nRow];return row?row[nCol]:undefined;}function set(grid,nRow,nCol,obj){var row=grid[nRow];if(row)row[nCol]=obj;return obj;}function getRow(grid,nRow){return grid[nRow];}function setRow(grid,nRow,newRow){return grid[nRow]=newRow;}function getCol(grid,nCol){return grid.reduce(function(col,row){col.push(row[nCol]);return col;},[]);}function setCol(grid,nCol,newCol){return grid.map(function(row,i){return row[nCol]?row[nCol]=newCol[i]:undefined;});}function create(rows,columns,initialObj){// Example:
// grid.create(3, 2, "empty")
// // => [["empty","empty"],
// //     ["empty","empty"],
// //     ["empty","empty"]]
var result=new Array(rows);while(rows>0){result[--rows]=withN(columns,initialObj);}return result;}function mapCreate(rows,cols,func,context){// like `grid.create` but takes generator function for cells
var result=new Array(rows);for(var _i42=0;_i42<rows;_i42++){result[_i42]=new Array(cols);for(var _j6=0;_j6<cols;_j6++){result[_i42][_j6]=func.call(context||this,_i42,_j6);}}return result;}function forEach$1(grid,func,context){// iterate, `func` is called as `func(cellValue, i, j)`
grid.forEach(function(row,i){row.forEach(function(val,j){func.call(context||this,val,i,j);});});}function map$1(grid,func,context){// map, `func` is called as `func(cellValue, i, j)`
var result=new Array(grid.length);grid.forEach(function(row,i){result[i]=new Array(row.length);row.forEach(function(val,j){result[i][j]=func.call(context||this,val,i,j);});});return result;}function toObjects(grid){// The first row of the grid defines the propNames
// for each following row create a new object with those porperties
// mapped to the cells of the row as values
// Example:
// grid.toObjects([['a', 'b'],[1,2],[3,4]])
// // => [{a:1,b:2},{a:3,b:4}]
var props=grid[0];var objects=new Array(grid.length-1);for(var _i43=1;_i43<grid.length;_i43++){var _obj2=objects[_i43-1]={};for(var _j7=0;_j7<props.length;_j7++){_obj2[props[_j7]]=grid[_i43][_j7];}}return objects;}function tableFromObjects(objects,valueForUndefined){// Reverse operation to `grid.toObjects`. Useful for example to convert objectified
// SQL result sets into tables that can be printed via Strings.printTable.
// Objects are key/values like [{x:1,y:2},{x:3},{z:4}]. Keys are interpreted as
// column names and objects as rows.
// Example:
// grid.tableFromObjects([{x:1,y:2},{x:3},{z:4}])
// // => [["x","y","z"],
// //    [1,2,null],
// //    [3,null,null],
// //    [null,null,4]]
if(!Array.isArray(objects))objects=[objects];var table=[[]];var columns=table[0];var rows=objects.reduce(function(rows,ea){return rows.concat([Object.keys(ea).reduce(function(row,col){var colIdx=columns.indexOf(col);if(colIdx===-1){colIdx=columns.length;columns.push(col);}row[colIdx]=ea[col];return row;},[])]);},[]);valueForUndefined=arguments.length===1?null:valueForUndefined;rows.forEach(function(row){// fill cells with no value with null
for(var _i44=0;_i44<columns.length;_i44++){if(!row[_i44])row[_i44]=valueForUndefined;}});return table.concat(rows);}var grid=/*#__PURE__*/Object.freeze({__proto__:null,get:get,set:set,getRow:getRow,setRow:setRow,getCol:getCol,setCol:setCol,create:create,mapCreate:mapCreate,forEach:forEach$1,map:map$1,toObjects:toObjects,tableFromObjects:tableFromObjects});/*
       * Methods for traversing and transforming tree structures.
       */function prewalk(treeNode,iterator,childGetter){var counter=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{i:0};var depth=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var i=counter.i++;iterator(treeNode,i,depth);(childGetter(treeNode,i,depth)||[]).forEach(function(ea){return prewalk(ea,iterator,childGetter,counter,depth+1);});}function postwalk(treeNode,iterator,childGetter){var counter=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{i:0};var depth=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var i=counter.i++;(childGetter(treeNode,i,depth)||[]).forEach(function(ea){return postwalk(ea,iterator,childGetter,counter,depth);});iterator(treeNode,i,depth);}function find(treeNode,testFunc,childGetter){// Traverses a `treeNode` recursively and returns the first node for which
// `testFunc` returns true. `childGetter` is a function to retrieve the
// children from a node.
if(testFunc(treeNode))return treeNode;var children=childGetter(treeNode);if(!children||!children.length)return undefined;for(var i=0;i<children.length;i++){var found=find(children[i],testFunc,childGetter);if(found)return found;}return undefined;}var detect$1=find;function filter$1(treeNode,testFunc,childGetter){// Traverses a `treeNode` recursively and returns all nodes for which
// `testFunc` returns true. `childGetter` is a function to retrieve the
// children from a node.
var result=[];if(testFunc(treeNode))result.push(treeNode);return result.concat(flatten((childGetter(treeNode)||[]).map(function(n){return filter$1(n,testFunc,childGetter);})));}function map$2(treeNode,mapFunc,childGetter){var depth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;// Traverses a `treeNode` recursively and call `mapFunc` on each node. The
// return values of all mapFunc calls is the result. `childGetter` is a
// function to retrieve the children from a node.
return[mapFunc(treeNode,depth)].concat(flatten((childGetter(treeNode)||[]).map(function(n){return map$2(n,mapFunc,childGetter,depth+1);})));}function mapTree(treeNode,mapFunc,childGetter){var depth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;// Traverses the tree and creates a structurally identical tree but with
// mapped nodes
var mappedNodes=(childGetter(treeNode)||[]).map(function(n){return mapTree(n,mapFunc,childGetter,depth+1);});return mapFunc(treeNode,mappedNodes,depth);}var tree=/*#__PURE__*/Object.freeze({__proto__:null,prewalk:prewalk,postwalk:postwalk,find:find,detect:detect$1,filter:filter$1,map:map$2,mapTree:mapTree});/* global process, require */ /*
       * A simple node.js-like cross-platform event emitter implementation that can
       * be used as a mixin. Emitters support the methods: `on(eventName, handlerFunc)`,
       * `once(eventName, handlerFunc)`, `emit(eventName, eventData)`,
       * `removeListener(eventName, handlerFunc)`, `removeAllListeners(eventName)`
       * Example:
       * var emitter = events.makeEmitter({});
       * var log = [];
       * emitter.on("test", function() { log.push("listener1"); });
       * emitter.once("test", function() { log.push("listener2"); });
       * emitter.emit("test");
       * emitter.emit("test");
       * log // => ["listener1","listener2","listener1"]
       * emitter.removeAllListeners("test");
       * emitter.emit("test");
       * log // => is still ["listener1","listener2","listener1"]
       */var isNode=typeof process!=='undefined'&&process.versions&&process.versions.node;var makeEmitter=isNode?function(obj,options){if(obj.on&&obj.removeListener)return obj;var events=typeof System!=='undefined'?System._nodeRequire('events'):require('events');Object.assign(obj,events.EventEmitter.prototype);events.EventEmitter.call(obj);if(options&&options.maxListenerLimit){obj.setMaxListeners(options.maxListenerLimit);}return obj;}:function(obj){if(obj.on&&obj.removeListener)return obj;obj.listeners={};obj.on=function(type,handler){if(!handler)return;if(!obj.listeners[type]){obj.listeners[type]=[];}obj.listeners[type].push(handler);};obj.once=function(type,handler){if(!handler)return;function onceHandler/* ignore-in-docs args */(){obj.removeListener(type,onceHandler);handler.apply(this,arguments);}obj.on(type,onceHandler);};obj.removeListener=function(type,handler){if(!obj.listeners[type])return;obj.listeners[type]=obj.listeners[type].filter(function(h){return h!==handler;});};obj.removeAllListeners=function(type){if(!obj.listeners[type])return;obj.listeners[type]=[];};obj.emit=function()/* type and args */{var args=Array.prototype.slice.call(arguments);var type=args.shift();var handlers=obj.listeners[type];if(!handlers||!handlers.length)return;handlers.forEach(function(handler){try{handler.apply(null,args);}catch(e){console.error('Error in event handler: %s',e.stack||String(e));}});};return obj;};var events=/*#__PURE__*/Object.freeze({__proto__:null,makeEmitter:makeEmitter});/* global global,self,process */var isNode$1=typeof process!=='undefined'&&process.env&&typeof process.exit==='function';function chain$1(object){if(!object)return object;if(Array.isArray(object))return createChain(arr,object);if(object.constructor.name==='Date')return createChain(date,object);switch(_typeof2(object)){case'string':return createChain(string,object);case'object':return createChain(obj,object);case'function':return createChain(fun,object);case'number':return createChain(num,object);}throw new Error('Chain for object '+object+' ('+object.constructor.name+') no supported');}function createChain(interfaceObj,obj){return Object.keys(interfaceObj).reduce(function(chained,methodName){chained[methodName]=function()/* args */{var args=Array.prototype.slice.call(arguments);var result=interfaceObj[methodName].apply(null,[obj].concat(args));return chain$1(result);};return chained;},{value:function value(){return obj;}});}var __varRecorder__=lively.FreezerRuntime.recorderFor("lively.graphics/convert-css-length.js");function parseUnit(str,out){if(!out)out=[0,""];str=String(str);var num=parseFloat(str,10);out[0]=num;out[1]=str.match(/[\d.\-\+]*\s*(.*)/)[1]||"";return out;}__varRecorder__.parseUnit=parseUnit;function unit(length){return __varRecorder__.parseUnit(length)[1];}__varRecorder__.unit=unit;function unitLess(length){return __varRecorder__.parseUnit(length)[0];}__varRecorder__.unitLess=unitLess;function genericCssLengthParser(baseFontSize){if(baseFontSize==null){baseFontSize=baseFontSize;}return function(length,toUnit,fromContext,toContext){var fromUnit,outputLength,pxLength;if(fromContext==null){fromContext=baseFontSize;}if(toContext==null){toContext=fromContext;}if(toUnit==null){toUnit=__varRecorder__.unit(length);}fromUnit=__varRecorder__.unit(length);if(fromUnit===toUnit){return length;}pxLength=__varRecorder__.unitLess(length);if(__varRecorder__.unit(fromContext)!=="px"){console.warn("Parameter fromContext must resolve to a value in pixel units.");}if(__varRecorder__.unit(toContext)!=="px"){console.warn("Parameter toContext must resolve to a value in pixel units.");}if(fromUnit!=="px"){if(fromUnit==="em"){pxLength=__varRecorder__.unitLess(length)*__varRecorder__.unitLess(fromContext);}else if(fromUnit==="rem"){pxLength=__varRecorder__.unitLess(length)*__varRecorder__.unitLess(baseFontSize);}else if(fromUnit==="ex"){pxLength=__varRecorder__.unitLess(length)*__varRecorder__.unitLess(fromContext)*2;}else if(fromUnit==="ch"||fromUnit==="vw"||fromUnit==="vh"||fromUnit==="vmin"){console.warn(fromUnit+" units can't be reliably converted; Returning original value.");return length;}else{console.warn(fromUnit+" is an unknown or unsupported length unit; Returning original value.");return length;}}outputLength=pxLength;if(toUnit!=="px"){if(toUnit==="em"){outputLength=pxLength/__varRecorder__.unitLess(toContext);}else if(toUnit==="rem"){outputLength=pxLength/__varRecorder__.unitLess(baseFontSize);}else if(toUnit==="ex"){outputLength=pxLength/__varRecorder__.unitLess(toContext)/2;}else if(toUnit==="ch"||toUnit==="vw"||toUnit==="vh"||toUnit==="vmin"){console.warn(toUnit+" units can't be reliably converted; Returning original value.");return length;}else{console.warn(toUnit+" is an unknown or unsupported length unit; Returning original value.");return length;}}return parseFloat(outputLength.toFixed(5))+toUnit;};}__varRecorder__.genericCssLengthParser=genericCssLengthParser;function cssLengthToPixels(length){return Number(__varRecorder__.parseCssLength(length,"px").slice(0,-2));}__varRecorder__.cssLengthToPixels=cssLengthToPixels;__varRecorder__.baseFontSize="16px";if(System.get("@system-env").browser){try{__varRecorder__.newBaseFontSize=__varRecorder__.genericCssLengthParser(__varRecorder__.baseFontSize)(window.getComputedStyle(document.body).fontSize);if(__varRecorder__.newBaseFontSize&&__varRecorder__.newBaseFontSize.slice(0,3)!=="NaN")__varRecorder__.baseFontSize=__varRecorder__.newBaseFontSize;}catch(e){}}__varRecorder__.genericCssLengthParser=genericCssLengthParser;__varRecorder__.genericCssLengthParser=genericCssLengthParser;var parseCssLength=__varRecorder__.genericCssLengthParser(__varRecorder__.baseFontSize);__varRecorder__.parseCssLength=parseCssLength;__varRecorder__.parseCssLength=parseCssLength;__varRecorder__.parseCssLength=parseCssLength;__varRecorder__.cssLengthToPixels=cssLengthToPixels;__varRecorder__.cssLengthToPixels=cssLengthToPixels;var __varRecorder__$1=lively.FreezerRuntime.recorderFor("lively.graphics/geometry-2d.js");function rect(arg1,arg2,arg3,arg4){var x,y,w,h;if(typeof arg1==="number"){x=arg1,y=arg2,w=arg3,h=arg4;}else{x=arg1.x;y=arg1.y;w=arg2.x-x;h=arg2.y-y;}return new __varRecorder__$1.Rectangle(x,y,w,h);}__varRecorder__$1.rect=rect;function pt(x,y){return new __varRecorder__$1.Point(x,y);}__varRecorder__$1.pt=pt;__varRecorder__$1.num=num;__varRecorder__$1.string=string;__varRecorder__$1.grid=grid;__varRecorder__$1.cssLengthToPixels=cssLengthToPixels;var Point=/*#__PURE__*/function(){_createClass(Point,null,[{key:"ensure",value:function ensure(duck){return duck instanceof __varRecorder__$1.Point?duck:new __varRecorder__$1.Point(duck.x,duck.y);}},{key:"polar",value:function polar(r,theta){return new __varRecorder__$1.Point(r*Math.cos(theta),r*Math.sin(theta));}},{key:"random",value:function random(scalePt){return new __varRecorder__$1.Point(__varRecorder__$1.num.randomSmallerInteger(scalePt.x),__varRecorder__$1.num.randomSmallerInteger(scalePt.y));}},{key:"fromLiteral",value:function fromLiteral(literal){return __varRecorder__$1.pt(literal.x,literal.y);}},{key:"fromTuple",value:function fromTuple(tuple){return __varRecorder__$1.pt(tuple[0],tuple[1]);}}]);function Point(x,y){_classCallCheck(this,Point);this.x=x||0;this.y=y||0;}_createClass(Point,[{key:"getX",value:function getX(){return this.x;}},{key:"getY",value:function getY(){return this.y;}},{key:"toFixed",value:function toFixed(val){return new __varRecorder__$1.Point(this.x.toFixed(val),this.y.toFixed(val));}},{key:"addPt",value:function addPt(p){return new __varRecorder__$1.Point(this.x+p.x,this.y+p.y);}},{key:"addXY",value:function addXY(dx,dy){return new __varRecorder__$1.Point(this.x+dx,this.y+dy);}},{key:"midPt",value:function midPt(p){return new __varRecorder__$1.Point((this.x+p.x)/2,(this.y+p.y)/2);}},{key:"subPt",value:function subPt(p){return new __varRecorder__$1.Point(this.x-p.x,this.y-p.y);}},{key:"subXY",value:function subXY(dx,dy){return new __varRecorder__$1.Point(this.x-dx,this.y-dy);}},{key:"scaleBy",value:function scaleBy(scaleX,scaleYOrUndefined){return new __varRecorder__$1.Point(this.x*scaleX,this.y*(scaleYOrUndefined||scaleX));}},{key:"scaleByPt",value:function scaleByPt(scalePt){return new __varRecorder__$1.Point(this.x*scalePt.x,this.y*scalePt.y);}},{key:"negated",value:function negated(){return new __varRecorder__$1.Point(-this.x,-this.y);}},{key:"inverted",value:function inverted(){return new __varRecorder__$1.Point(1/this.x,1/this.y);}},{key:"invertedSafely",value:function invertedSafely(){return new __varRecorder__$1.Point(this.x&&1/this.x,this.y&&1/this.y);}},{key:"lessPt",value:function lessPt(p){return this.x<p.x&&this.y<p.y;}},{key:"leqPt",value:function leqPt(p){return this.x<=p.x&&this.y<=p.y;}},{key:"eqPt",value:function eqPt(p){return this.x==p.x&&this.y==p.y;}},{key:"equals",value:function equals(p){return this.x==p.x&&this.y==p.y;}},{key:"withX",value:function withX(x){return __varRecorder__$1.pt(x,this.y);}},{key:"withY",value:function withY(y){return __varRecorder__$1.pt(this.x,y);}},{key:"copy",value:function copy(){return new __varRecorder__$1.Point(this.x,this.y);}},{key:"minPt",value:function minPt(p,acc){if(!acc)acc=new __varRecorder__$1.Point(0,0);acc.x=Math.min(this.x,p.x);acc.y=Math.min(this.y,p.y);return acc;}},{key:"maxPt",value:function maxPt(p,acc){if(!acc)acc=new __varRecorder__$1.Point(0,0);acc.x=Math.max(this.x,p.x);acc.y=Math.max(this.y,p.y);return acc;}},{key:"random",value:function random(){return __varRecorder__$1.Point.random(this);}},{key:"normalized",value:function normalized(){var r=this.r();return __varRecorder__$1.pt(this.x/r,this.y/r);}},{key:"fastNormalized",value:function fastNormalized(){var r=this.fastR();return __varRecorder__$1.pt(this.x/r,this.y/r);}},{key:"dotProduct",value:function dotProduct(p){return this.x*p.x+this.y*p.y;}},{key:"matrixTransform",value:function matrixTransform(mx,acc){var x=mx.a*this.x+mx.c*this.y+mx.e,y=mx.b*this.x+mx.d*this.y+mx.f;return!acc?__varRecorder__$1.pt(x,y):Object.assign(acc,{x:x,y:y});}},{key:"matrixTransformDirection",value:function matrixTransformDirection(mx,acc){var x=mx.a*this.x+mx.c*this.y,y=mx.b*this.x+mx.d*this.y;return!acc?__varRecorder__$1.pt(x,y):Object.assign(acc,{x:x,y:y});}},{key:"griddedBy",value:function griddedBy(grid){return __varRecorder__$1.pt(this.x-this.x%grid.x,this.y-this.y%grid.y);}},{key:"roundTo",value:function roundTo(quantum){return new __varRecorder__$1.Point(__varRecorder__$1.num.roundTo(this.x,quantum),__varRecorder__$1.num.roundTo(this.y,quantum));}},{key:"dist",value:function dist(p){var dx=this.x-p.x,dy=this.y-p.y;return Math.sqrt(dx*dx+dy*dy);}},{key:"distSquared",value:function distSquared(p){var dx=this.x-p.x,dy=this.y-p.y;return dx*dx+dy*dy;}},{key:"nearestPointOnLineBetween",value:function nearestPointOnLineBetween(p1,p2){if(p1.x==p2.x)return __varRecorder__$1.pt(p1.x,this.y);if(p1.y==p2.y)return __varRecorder__$1.pt(this.x,p1.y);var x1=p1.x,y1=p1.y,x21=p2.x-x1,y21=p2.y-y1,t=((this.y-y1)/x21+(this.x-x1)/y21)/(x21/y21+y21/x21);return __varRecorder__$1.pt(x1+t*x21,y1+t*y21);}},{key:"interpolate",value:function interpolate(i,p){var transformLinear=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(transformLinear)return __varRecorder__$1.pt(__varRecorder__$1.num.interpolate(i,this.x,p.x),__varRecorder__$1.num.interpolate(i,this.y,p.y));return __varRecorder__$1.Point.polar(__varRecorder__$1.num.interpolate(i,this.r(),p.r()),__varRecorder__$1.num.interpolate(i,this.theta(),p.theta()));}},{key:"r",value:function r(){return Math.sqrt(this.x*this.x+this.y*this.y);}},{key:"fastR",value:function fastR(){var a=this.x*this.x+this.y*this.y;var x=17;for(var i=0;i<6;i++){x=(x+a/x)/2;}return x;}},{key:"theta",value:function theta(){return Math.atan2(this.y,this.x);}},{key:"asRectangle",value:function asRectangle(){return new __varRecorder__$1.Rectangle(this.x,this.y,0,0);}},{key:"extent",value:function extent(ext){return new __varRecorder__$1.Rectangle(this.x,this.y,ext.x,ext.y);}},{key:"extentAsRectangle",value:function extentAsRectangle(){return new __varRecorder__$1.Rectangle(0,0,this.x,this.y);}},{key:"lineTo",value:function lineTo(end){return new __varRecorder__$1.Line(this,end);}},{key:"toTuple",value:function toTuple(){return[this.x,this.y];}},{key:"toLiteral",value:function toLiteral(){return{x:this.x,y:this.y};}},{key:"toString",value:function toString(){var truncate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;return truncate?__varRecorder__$1.string.format("pt(%1.f,%1.f)",this.x,this.y):__varRecorder__$1.string.format("pt(%10.d,%10.d)",this.x,this.y);}},{key:"inspect",value:function inspect(){return JSON.stringify(this);}},{key:"__serialize__",value:function __serialize__(){return{__expr__:this.toString(false),bindings:{"lively.graphics/geometry-2d.js":["pt"]}};}},{key:"isPoint",get:function get(){return true;}}]);return Point;}();exports('g',Point);__varRecorder__$1.Point=Point;var Rectangle=/*#__PURE__*/function(){_createClass(Rectangle,[{key:"corners",get:function get(){return["topLeft","topRight","bottomRight","bottomLeft"];}},{key:"sides",get:function get(){return["leftCenter","rightCenter","topCenter","bottomCenter"];}}],[{key:"fromAny",value:function fromAny(ptA,ptB){return __varRecorder__$1.rect(ptA.minPt(ptB),ptA.maxPt(ptB));}},{key:"fromLiteral",value:function fromLiteral(literal){return new __varRecorder__$1.Rectangle(literal.x,literal.y,literal.width,literal.height);}},{key:"fromTuple",value:function fromTuple(tuple){return new __varRecorder__$1.Rectangle(tuple[0],tuple[1],tuple[2],tuple[3]);}},{key:"unionPts",value:function unionPts(points){var min=points[0],max=points[0];for(var i=1;i<points.length;i++){min=min.minPt(points[i]);max=max.maxPt(points[i]);}return __varRecorder__$1.rect(min,max);}},{key:"ensure",value:function ensure(duck){return duck instanceof __varRecorder__$1.Rectangle?duck:new __varRecorder__$1.Rectangle(duck.x,duck.y,duck.width,duck.height);}},{key:"fromElement",value:function fromElement(element){if(typeof element.getBoundingClientRect==="function"){var b=element.getBoundingClientRect();return __varRecorder__$1.rect(b.left,b.top,b.width,b.height);}else if(element.namespaceURI=="http://www.w3.org/1999/xhtml"){var x=__varRecorder__$1.cssLengthToPixels(element.style.left||"0px"),y=__varRecorder__$1.cssLengthToPixels(element.style.top||"0px"),width=__varRecorder__$1.cssLengthToPixels(element.style.width||"0px"),height=__varRecorder__$1.cssLengthToPixels(element.style.hieght||"0px");return new __varRecorder__$1.Rectangle(x,y,width,height);}if(element.namespaceURI=="http://www.w3.org/2000/svg"){return new __varRecorder__$1.Rectangle(element.x.baseVal.value,element.y.baseVal.value,element.width.baseVal.value,element.height.baseVal.value);}throw new Error("Cannot create Rectangle from "+element);}},{key:"inset",value:function inset(left,top,right,bottom){if(top===undefined)top=left;if(right===undefined)right=left;if(bottom===undefined)bottom=top;return new __varRecorder__$1.Rectangle(left,top,right-left,bottom-top);}}]);function Rectangle(x,y,w,h){_classCallCheck(this,Rectangle);this.x=x||0;this.y=y||0;this.width=w||0;this.height=h||0;}_createClass(Rectangle,[{key:"getX",value:function getX(){return this.x;}},{key:"getY",value:function getY(){return this.y;}},{key:"getWidth",value:function getWidth(){return this.width;}},{key:"getHeight",value:function getHeight(){return this.height;}},{key:"copy",value:function copy(){return new __varRecorder__$1.Rectangle(this.x,this.y,this.width,this.height);}},{key:"toFixed",value:function toFixed(val){return new __varRecorder__$1.Rectangle(this.x.toFixed(val),this.y.toFixed(val),this.width.toFixed(val),this.height.toFixed(val));}},{key:"withWidth",value:function withWidth(w){return new __varRecorder__$1.Rectangle(this.x,this.y,w,this.height);}},{key:"withHeight",value:function withHeight(h){return new __varRecorder__$1.Rectangle(this.x,this.y,this.width,h);}},{key:"withX",value:function withX(x){return new __varRecorder__$1.Rectangle(x,this.y,this.width,this.height);}},{key:"withY",value:function withY(y){return new __varRecorder__$1.Rectangle(this.x,y,this.width,this.height);}},{key:"withExtent",value:function withExtent(ext){return new __varRecorder__$1.Rectangle(this.x,this.y,ext.x,ext.y);}},{key:"withTopLeft",value:function withTopLeft(p){return __varRecorder__$1.Rectangle.fromAny(p,this.bottomRight());}},{key:"withTopRight",value:function withTopRight(p){return __varRecorder__$1.Rectangle.fromAny(this.bottomLeft(),p);}},{key:"withBottomRight",value:function withBottomRight(p){return __varRecorder__$1.Rectangle.fromAny(p,this.topLeft());}},{key:"withBottomLeft",value:function withBottomLeft(p){return __varRecorder__$1.Rectangle.fromAny(p,this.topRight());}},{key:"withLeftCenter",value:function withLeftCenter(p){return new __varRecorder__$1.Rectangle(p.x,this.y,this.width+(this.x-p.x),this.height);}},{key:"withRightCenter",value:function withRightCenter(p){return new __varRecorder__$1.Rectangle(this.x,this.y,p.x-this.x,this.height);}},{key:"withTopCenter",value:function withTopCenter(p){return new __varRecorder__$1.Rectangle(this.x,p.y,this.width,this.height+(this.y-p.y));}},{key:"withBottomCenter",value:function withBottomCenter(p){return new __varRecorder__$1.Rectangle(this.x,this.y,this.width,p.y-this.y);}},{key:"withCenter",value:function withCenter(p){return new __varRecorder__$1.Rectangle(p.x-this.width/2,p.y-this.height/2,this.width,this.height);}},{key:"insetBy",value:function insetBy(d){return new __varRecorder__$1.Rectangle(this.x+d,this.y+d,this.width-d*2,this.height-d*2);}},{key:"insetByPt",value:function insetByPt(p){return new __varRecorder__$1.Rectangle(this.x+p.x,this.y+p.y,this.width-p.x*2,this.height-p.y*2);}},{key:"grid",value:function grid(rows,cols){var w=this.width/cols,h=this.height/rows;return __varRecorder__$1.grid.mapCreate(rows,cols,function(i,j){return new __varRecorder__$1.Rectangle(w*j,h*i,w,h);});}},{key:"divide",value:function divide(relativeRects){var orig=this;return relativeRects.map(function(relRect){return __varRecorder__$1.rect(orig.x+orig.width*relRect.x,orig.y+orig.height*relRect.y,orig.width*relRect.width,orig.height*relRect.height);});}},{key:"toTuple",value:function toTuple(){return[this.x,this.y,this.width,this.height];}},{key:"lineTo",value:function lineTo(otherRect){var center1=this.center(),center2=otherRect.center(),lineBetween=center1.lineTo(center2),start=this.lineIntersection(lineBetween)[0],end=otherRect.lineIntersection(lineBetween)[0];return start&&end&&start.lineTo(end);}},{key:"equals",value:function equals(other){if(!other){return false;}return this.x==other.x&&this.y==other.y&&this.width==other.width&&this.height==other.height;}},{key:"inspect",value:function inspect(){return JSON.stringify(this);}},{key:"topLeft",value:function topLeft(){return new __varRecorder__$1.Point(this.x,this.y);}},{key:"topRight",value:function topRight(){return new __varRecorder__$1.Point(this.maxX(),this.y);}},{key:"bottomRight",value:function bottomRight(){return new __varRecorder__$1.Point(this.maxX(),this.maxY());}},{key:"bottomLeft",value:function bottomLeft(){return new __varRecorder__$1.Point(this.x,this.maxY());}},{key:"leftCenter",value:function leftCenter(){return new __varRecorder__$1.Point(this.x,this.center().y);}},{key:"rightCenter",value:function rightCenter(){return new __varRecorder__$1.Point(this.maxX(),this.center().y);}},{key:"topCenter",value:function topCenter(){return new __varRecorder__$1.Point(this.center().x,this.y);}},{key:"bottomCenter",value:function bottomCenter(){return new __varRecorder__$1.Point(this.center().x,this.maxY());}},{key:"extent",value:function extent(){return new __varRecorder__$1.Point(this.width,this.height);}},{key:"center",value:function center(){return new __varRecorder__$1.Point(this.x+this.width/2,this.y+this.height/2);}},{key:"topEdge",value:function topEdge(){return new __varRecorder__$1.Line(this.topLeft(),this.topRight());}},{key:"bottomEdge",value:function bottomEdge(){return new __varRecorder__$1.Line(this.bottomLeft(),this.bottomRight());}},{key:"leftEdge",value:function leftEdge(){return new __varRecorder__$1.Line(this.topLeft(),this.bottomLeft());}},{key:"rightEdge",value:function rightEdge(){return new __varRecorder__$1.Line(this.topRight(),this.bottomRight());}},{key:"edges",value:function edges(){return[this.topEdge(),this.rightEdge(),this.bottomEdge(),this.leftEdge()];}},{key:"allPoints",value:function allPoints(){var x=this.x,y=this.y,w=this.width,h=this.height,points=[];for(var j=y;j<y+h;j++){for(var i=x;i<x+w;i++){points.push(__varRecorder__$1.pt(i,j));}}return points;}},{key:"isNonEmpty",value:function isNonEmpty(rect){return this.width>0&&this.height>0;}},{key:"containsRect",value:function containsRect(r){return this.x<=r.x&&this.y<=r.y&&r.maxX()<=this.maxX()&&r.maxY()<=this.maxY();}},{key:"intersects",value:function intersects(r){return this.intersection(r).isNonEmpty();}},{key:"containsPoint",value:function containsPoint(p){return this.x<=p.x&&p.x<=this.x+this.width&&this.y<=p.y&&p.y<=this.y+this.height;}},{key:"translatedBy",value:function translatedBy(d){return new __varRecorder__$1.Rectangle(this.x+d.x,this.y+d.y,this.width,this.height);}},{key:"scaleByRect",value:function scaleByRect(r){return new __varRecorder__$1.Rectangle(this.x+r.x*this.width,this.y+r.y*this.height,r.width*this.width,r.height*this.height);}},{key:"scaleRectIn",value:function scaleRectIn(fullRect){return new __varRecorder__$1.Rectangle((this.x-fullRect.x)/fullRect.width,(this.y-fullRect.y)/fullRect.height,this.width/fullRect.width,this.height/fullRect.height);}},{key:"scaleRectTo",value:function scaleRectTo(fullRect){var height,width,scale;if(this.width>this.height){width=this.width;}else{height=this.height;}if(width){scale=fullRect.width/width;}else{scale=fullRect.height/height;}return this.withExtent(this.extent().scaleBy(scale)).withCenter(this.center());}},{key:"expandBy",value:function expandBy(delta){return this.insetBy(0-delta);}},{key:"translateForInclusion",value:function translateForInclusion(other){var x=other.x,y=other.y,r=x+other.width,b=y+other.height;if(r>this.right())x-=r-this.right();if(b>this.bottom())y-=b-this.bottom();if(x<this.x)x=this.x;if(y<this.y)y=this.y;return __varRecorder__$1.rect(x,y,other.width,other.height);}},{key:"transformRectForInclusion",value:function transformRectForInclusion(other){var topLeft=this.topLeft().maxPt(other.topLeft()),newBottomRight=topLeft.addPt(other.extent()),innerBottomRight=this.bottomRight().minPt(newBottomRight);return __varRecorder__$1.rect(topLeft,innerBottomRight);}},{key:"insetByRect",value:function insetByRect(r){return new __varRecorder__$1.Rectangle(this.x+r.left(),this.y+r.top(),this.width-(r.left()+r.right()),this.height-(r.top()+r.bottom()));}},{key:"outsetByRect",value:function outsetByRect(r){return new __varRecorder__$1.Rectangle(this.x-r.left(),this.y-r.top(),this.width+(r.left()+r.right()),this.height+(r.top()+r.bottom()));}},{key:"interpolate",value:function interpolate(i,r){var tl1=this.topLeft(),br1=this.bottomRight(),tl2=r.topLeft(),br2=r.bottomRight();return __varRecorder__$1.Rectangle.fromAny(tl1.interpolate(i,tl2),br1.interpolate(i,br2));}},{key:"intersection",value:function intersection(rect){var nx=Math.max(this.x,rect.x);var ny=Math.max(this.y,rect.y);var nw=Math.min(this.x+this.width,rect.x+rect.width)-nx;var nh=Math.min(this.y+this.height,rect.y+rect.height)-ny;return new __varRecorder__$1.Rectangle(nx,ny,nw,nh);}},{key:"union",value:function union(r){return __varRecorder__$1.rect(this.topLeft().minPt(r.topLeft()),this.bottomRight().maxPt(r.bottomRight()));}},{key:"lineIntersection",value:function lineIntersection(line){return this.edges().map(function(edge){return edge.intersection(line);}).filter(function(ea){return!!ea;});}},{key:"dist",value:function dist(rect){var p1=this.closestPointToPt(rect.center());var p2=rect.closestPointToPt(p1);return p1.dist(p2);}},{key:"relativeToAbsPoint",value:function relativeToAbsPoint(relPt){return new __varRecorder__$1.Point(this.x+this.width*relPt.x,this.y+this.height*relPt.y);}},{key:"closestPointToPt",value:function closestPointToPt(p){return __varRecorder__$1.pt(Math.min(Math.max(this.x,p.x),this.maxX()),Math.min(Math.max(this.y,p.y),this.maxY()));}},{key:"maxX",value:function maxX(){return this.x+this.width;}},{key:"maxY",value:function maxY(){return this.y+this.height;}},{key:"realWidth",value:function realWidth(){return this.x<0?-this.x+this.width:this.width;}},{key:"realHeight",value:function realHeight(){return this.y<0?-this.y+this.height:this.height;}},{key:"area",value:function area(){var area=this.width*this.height,sign=this.width<0&&this.height<0?-1:1;return sign*area;}},{key:"randomPoint",value:function randomPoint(){return __varRecorder__$1.Point.random(__varRecorder__$1.pt(this.width,this.height)).addPt(this.topLeft());}},{key:"constrainPt",value:function constrainPt(pt){return pt.maxPt(this.topLeft()).minPt(this.bottomRight());}},{key:"left",value:function left(){return this.x;}},{key:"right",value:function right(){return this.maxX();}},{key:"top",value:function top(){return this.y;}},{key:"bottom",value:function bottom(){return this.maxY();}},{key:"toInsetTuple",value:function toInsetTuple(){return[this.left(),this.top(),this.right(),this.bottom()];}},{key:"toAttributeValue",value:function toAttributeValue(d){var d=0.01,result=[this.left()];if(this.top()===this.bottom()&&this.left()===this.right()){if(this.top()===this.left())result.push(this.top());}else result=result.concat([this.top(),this.right(),this.bottom()]);return result.invoke("roundTo",d||0.01);}},{key:"toLiteral",value:function toLiteral(){return{x:this.x,y:this.y,width:this.width,height:this.height};}},{key:"partNamed",value:function partNamed(partName){return this[partName].call(this);}},{key:"withPartNamed",value:function withPartNamed(partName,newValue){return this[this.setterName(partName)].call(this,newValue);}},{key:"setterName",value:function setterName(partName){return"with"+partName[0].toUpperCase()+partName.slice(1);}},{key:"partNameNear",value:function partNameNear(partNames,p,dist){var partName=this.partNameNearest(partNames,p);return p.dist(this.partNamed(partName))<dist?partName:null;}},{key:"partNameNearest",value:function partNameNearest(partNames,p){var dist=1e+99,partName=partNames[0];for(var i=0;i<partNames.length;i++){var partName=partNames[i],pDist=p.dist(this.partNamed(partName));if(pDist<dist){var nearest=partName;dist=pDist;}}return nearest;}},{key:"toString",value:function toString(){return __varRecorder__$1.string.format("rect(%s,%s,%s,%s)",this.x,this.y,this.width,this.height);}},{key:"__serialize__",value:function __serialize__(){return{__expr__:this.toString(),bindings:{"lively.graphics/geometry-2d.js":["rect"]}};}},{key:"isRectangle",get:function get(){return true;}}]);return Rectangle;}();__varRecorder__$1.Rectangle=Rectangle;var Transform=/*#__PURE__*/function(){_createClass(Transform,[{key:"exp",get:function get(){return 0.0001;}}]);function Transform(translation,rotation,scale){_classCallCheck(this,Transform);if(translation){if(translation instanceof __varRecorder__$1.Point){var delta=translation,angleInRadians=rotation||0,scale=scale;if(scale===undefined){scale=__varRecorder__$1.pt(1,1);}this.a=this.ensureNumber(scale.x*Math.cos(angleInRadians));this.b=this.ensureNumber(scale.y*Math.sin(angleInRadians));this.c=this.ensureNumber(scale.x*-Math.sin(angleInRadians));this.d=this.ensureNumber(scale.y*Math.cos(angleInRadians));this.e=this.ensureNumber(delta.x);this.f=this.ensureNumber(delta.y);if(this.a>1)this.a=Math.round(this.a*Math.pow(10,2))/Math.pow(10,2);if(this.d>1)this.d=Math.round(this.d*Math.pow(10,2))/Math.pow(10,2);}else{this.fromMatrix(translation);}}else{this.a=this.d=1;this.b=this.c=this.e=this.f=0;}}_createClass(Transform,[{key:"copy",value:function copy(){return new __varRecorder__$1.Transform(this);}},{key:"fromMatrix",value:function fromMatrix(mx){this.a=this.ensureNumber(mx.a);this.b=this.ensureNumber(mx.b);this.c=this.ensureNumber(mx.c);this.d=this.ensureNumber(mx.d);this.e=this.ensureNumber(mx.e);this.f=this.ensureNumber(mx.f);}},{key:"getRotation",value:function getRotation(){var r=__varRecorder__$1.num.toDegrees(Math.atan2(-this.c,this.a));return Math.abs(r)<this.eps?0:r;}},{key:"getScale",value:function getScale(){var a=this.a,c=this.c,s=Math.sqrt(a*a+c*c);return Math.abs(s-1)<this.eps?1:s;}},{key:"getScalePoint",value:function getScalePoint(){var a=this.a,b=this.b,c=this.c,d=this.d,sx=Math.sqrt(a*a+c*c),r=Math.atan2(-c,a),sy=Math.abs(b)>Math.abs(d)?b/Math.sin(r):d/Math.cos(r);return __varRecorder__$1.pt(sx,sy);}},{key:"getTranslation",value:function getTranslation(){return __varRecorder__$1.pt(this.e,this.f);}},{key:"isTranslation",value:function isTranslation(){return this.a==1&&this.b==0&&this.c==0&&this.d==1;}},{key:"toSVGAttributeValue",value:function toSVGAttributeValue(){var delta=this.getTranslation(),attr="translate("+delta.x+","+delta.y+")",theta=this.getRotation(),sp=this.getScalePoint();if(theta!=0)attr+=" rotate("+this.getRotation()+")";if(sp.x!=1||sp.y!=1)attr+=" scale("+sp.x+","+sp.y+")";return attr;}},{key:"toCSSValue",value:function toCSSValue(bounds){var attr="",delta=this.getTranslation();attr+="translate("+delta.x.toFixed(2)+"px,"+delta.y.toFixed(2)+"px)";if(bounds){var offsetX=bounds.width/2;var offsetY=bounds.height/2;attr+=" translate("+offsetX.toFixed(2)+"px,"+offsetY.toFixed(2)+"px)";}var theta=this.getRotation();if(theta!=0)attr+=" rotate("+this.getRotation().toFixed(2)+"deg)";if(bounds){var offsetX=bounds.width/2;var offsetY=bounds.height/2;attr+=" translate("+(offsetX*-1).toFixed(2)+"px,"+(offsetY*-1).toFixed(2)+"px)";}var sp=this.getScalePoint();if(sp.x!=1||sp.y!=1){attr+=" scale("+sp.x.toFixed(2)+","+sp.y.toFixed(2)+")";}return attr;}},{key:"toCSSTransformString",value:function toCSSTransformString(){var rot=this.getRotation(),scale=this.getScale();return"translate(".concat(this.e,"px,").concat(this.f,"px) rotate(").concat(rot,"deg) scale(").concat(scale,",").concat(scale,")");}},{key:"toString",value:function toString(){return this.toCSSTransformString();}},{key:"toMatrix",value:function toMatrix(){return this.copy();}},{key:"transformPoint",value:function transformPoint(p,acc){return p.matrixTransform(this,acc);}},{key:"transformDirection",value:function transformDirection(p,acc){return p.matrixTransformDirection(this,acc);}},{key:"matrixTransformForMinMax",value:function matrixTransformForMinMax(pt,minPt,maxPt){var x=this.a*pt.x+this.c*pt.y+this.e,y=this.b*pt.x+this.d*pt.y+this.f;if(x>maxPt.x)maxPt.x=x;if(y>maxPt.y)maxPt.y=y;if(x<minPt.x)minPt.x=x;if(y<minPt.y)minPt.y=y;}},{key:"transformRectToRect",value:function transformRectToRect(r){var minPt=__varRecorder__$1.pt(Infinity,Infinity),maxPt=__varRecorder__$1.pt(-Infinity,-Infinity);this.matrixTransformForMinMax(r.topLeft(),minPt,maxPt);this.matrixTransformForMinMax(r.bottomRight(),minPt,maxPt);if(!this.isTranslation()){this.matrixTransformForMinMax(r.topRight(),minPt,maxPt);this.matrixTransformForMinMax(r.bottomLeft(),minPt,maxPt);}return __varRecorder__$1.rect(minPt,maxPt);}},{key:"preConcatenate",value:function preConcatenate(t){var m=this.matrix_||this.toMatrix();this.a=t.a*m.a+t.c*m.b;this.b=t.b*m.a+t.d*m.b;this.c=t.a*m.c+t.c*m.d;this.d=t.b*m.c+t.d*m.d;this.e=t.a*m.e+t.c*m.f+t.e;this.f=t.b*m.e+t.d*m.f+t.f;this.matrix_=this.toMatrix();return this;}},{key:"invert",value:function invert(){var m=this.copy();var det=m.a*m.d-m.c*m.b,invdet=1/det;this.a=m.d*invdet;this.b=-m.b*invdet;this.c=-m.c*invdet;this.d=m.a*invdet;this.e=(m.c*m.f-m.e*m.d)*invdet;this.f=-(m.a*m.f-m.b*m.e)*invdet;return this;}},{key:"inverse",value:function inverse(){var matrix=this.matrix_||this.toMatrix();var result=new this.constructor(matrix);result.invert();return result;}},{key:"ensureNumber",value:function ensureNumber(value){if(isNaN(value)){throw new Error("not a number");}return value;}},{key:"__serialize__",value:function __serialize__(){return{__expr__:"new Transform({a: ".concat(this.a,", b: ").concat(this.b,", c: ").concat(this.c,", d: ").concat(this.d,", e: ").concat(this.e,", f: ").concat(this.f,"})"),bindings:{"lively.graphics/geometry-2d.js":["Transform"]}};}},{key:"isTransform",get:function get(){return true;}}]);return Transform;}();__varRecorder__$1.Transform=Transform;var Line=/*#__PURE__*/function(){_createClass(Line,null,[{key:"fromCoords",value:function fromCoords(startX,startY,endX,endY){return new __varRecorder__$1.Line(__varRecorder__$1.pt(startX,startY),__varRecorder__$1.pt(endX,endY));}}]);function Line(start,end){_classCallCheck(this,Line);this.start=start;this.end=end;}_createClass(Line,[{key:"withStart",value:function withStart(start){return new __varRecorder__$1.Line(start,this.end);}},{key:"withEnd",value:function withEnd(end){return new __varRecorder__$1.Line(this.start,end);}},{key:"sampleN",value:function sampleN(n){n=n||10;var vector=this.end.subPt(this.start),stepPt=vector.scaleBy(1/n),result=[];for(var i=0;i<=n;i++){result.push(this.start.addPt(stepPt.scaleBy(i)));}return result;}},{key:"sample",value:function sample(length){return this.sampleN(this.length()/length);}},{key:"length",value:function length(){return this.start.dist(this.end);}},{key:"equals",value:function equals(otherLine){if(!otherLine)return false;return this.start.eqPt(otherLine.start)&&this.end.eqPt(otherLine.end);}},{key:"distanceFromLine",value:function distanceFromLine(p){var x1=this.start.x,y1=this.start.y,x2=this.end.x,y2=this.end.y,x3=p.x,y3=p.y;return Math.abs((y2-y1)*x3-(x2-x1)*y3+x2*y1-y2*x1)/Math.sqrt(Math.pow(y2-y1,2)+Math.pow(x2-x1,2));}},{key:"includesPoint",value:function includesPoint(p,unconstrained){var x1=this.start.x,y1=this.start.y,x2=this.end.x,y2=this.end.y,x3=p.x,y3=p.y,collinear=(x2-x1)*(y3-y1)-(x3-x1)*(y2-y1)===0;if(unconstrained||!collinear)return collinear;var xMin=Math.min(x1,x2),yMin=Math.min(y1,y2),xMax=Math.max(x1,x2),yMax=Math.max(y1,y2);return xMin<=x3&&x3<=xMax&&yMin<=y3&&y3<=yMax;}},{key:"intersection",value:function intersection(otherLine,unconstrained){var eps=0.0001,start1=this.start,end1=this.end,start2=otherLine.start,end2=otherLine.end,x1=start1.x,y1=start1.y,x2=end1.x,y2=end1.y,x3=start2.x,y3=start2.y,x4=end2.x,y4=end2.y;var x=((x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4))/((x1-x2)*(y3-y4)-(y1-y2)*(x3-x4)),y=((x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4))/((x1-x2)*(y3-y4)-(y1-y2)*(x3-x4));if(x===Infinity||y===Infinity)return null;if(!unconstrained){if(!__varRecorder__$1.num.between(x,x1,x2,eps)||!__varRecorder__$1.num.between(y,y1,y2,eps)||!__varRecorder__$1.num.between(x,x3,x4,eps)||!__varRecorder__$1.num.between(y,y3,y4,eps))return null;}return __varRecorder__$1.pt(x,y);}},{key:"perpendicularLine",value:function perpendicularLine(){var relPos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var magn=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var rot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"cc";var start=this.start,vec=this.toVector(),fromPos=start.addPt(vec.scaleBy(relPos)),thetaOrtho=vec.theta()+(rot==="cc"?-1:1)*Math.PI/2;return new __varRecorder__$1.Line(fromPos,fromPos.addPt(__varRecorder__$1.Point.polar(magn,thetaOrtho)));}},{key:"toVector",value:function toVector(){var start=this.start,end=this.end;return end.subPt(start);}},{key:"toString",value:function toString(){return __varRecorder__$1.string.format("Line((%s,%s), (%s,%s))",this.start.x,this.start.y,this.end.x,this.end.y);}},{key:"__serialize__",value:function __serialize__(){return{__expr__:"Line.fromCoords(".concat(this.start.x,", ").concat(this.start.y,", ").concat(this.end.x,", ").concat(this.end.y,")"),bindings:{"lively.graphics/geometry-2d.js":["Line"]}};}},{key:"isLine",get:function get(){return true;}}]);return Line;}();__varRecorder__$1.Line=Line;__varRecorder__$1.rect=rect;__varRecorder__$1.rect=rect;__varRecorder__$1.pt=pt;__varRecorder__$1.pt=pt;var __captured2__=/*#__PURE__*/Object.freeze({__proto__:null,Point:Point,Rectangle:Rectangle,Transform:Transform,Line:Line,rect:rect,pt:pt});var initializeSymbol=Symbol["for"]('lively-instance-initialize');var superclassSymbol=Symbol["for"]('lively-instance-superclass');var moduleMetaSymbol=Symbol["for"]('lively-module-meta');var objMetaSymbol=Symbol["for"]('lively-object-meta');var moduleSubscribeToToplevelChangesSym=Symbol["for"]('lively-klass-changes-subscriber');function getClassHierarchy(klass){var curr=klass;var hierarchy=[];do{hierarchy.push(curr);curr=curr[superclassSymbol];}while(curr&&curr.name);return hierarchy.map(function(c){return c.name;}).join('->');}// compactness
var defaultPropertiesKey="properties",propertiesAndSettingsCacheSym=Symbol["for"]("lively.classes-properties-and-settings");var defaultPropertySettings={defaultSetter:null,defaultGetter:null,valueStoreProperty:"_state"};function prepareClassForManagedPropertiesAfterCreation(klass){var _propertiesAndSetting=propertiesAndSettingsInHierarchyOf(klass),properties=_propertiesAndSetting.properties,propertySettings=_propertiesAndSetting.propertySettings;klass[propertiesAndSettingsCacheSym]={properties:properties,order:sortKeysWithBeforeAndAfterConstraints(properties),propertySettings:propertySettings,classHierarchy:getClassHierarchy(klass)};if(!properties||_typeof2(properties)!=="object"){console.warn("Class ".concat(klass.name," indicates it has managed properties but its ")+"properties accessor (".concat(defaultPropertiesKey,") does not return ")+"a valid property descriptor map");return;}prepareClassForProperties(klass,propertySettings,properties);}function prepareClassForProperties(klass,propertySettings,properties){ensurePropertyInitializer(klass);var valueStoreProperty=propertySettings.valueStoreProperty,defaultGetter=propertySettings.defaultGetter,defaultSetter=propertySettings.defaultSetter,myProto=klass.prototype,keys=Object.keys(properties);keys.forEach(function(key){var descriptor=properties[key];// ... define a getter to the property for the outside world...
var hasGetter=myProto.hasOwnProperty(key)&&myProto.__lookupGetter__(key);if(!hasGetter||hasGetter._wasGenerated){var getter=descriptor.get||typeof defaultGetter==="function"&&function(){return defaultGetter.call(this,key);}||function(){return this[valueStoreProperty][key];};getter._wasGenerated=true;myProto.__defineGetter__(key,getter);}// ...define a setter if necessary
var hasSetter=myProto.hasOwnProperty(key)&&myProto.__lookupSetter__(key);if(!hasSetter||hasSetter._wasGenerated){var descrHasSetter=descriptor.hasOwnProperty("set"),setterNeeded=descrHasSetter||!descriptor.readOnly;if(setterNeeded){var setter=descriptor.set||typeof defaultSetter==="function"&&function(val){defaultSetter.call(this,key,val);}||function(val){this[valueStoreProperty][key]=val;};setter._wasGenerated=true;myProto.__defineSetter__(key,setter);}}});}function ensurePropertyInitializer(klass){// when we inherit from "conventional classes" those don't have an
// initializer method. We install a stub that calls the superclass function
// itself
Object.defineProperty(klass.prototype,"propertiesAndPropertySettings",{enumerable:false,configurable:true,writable:true,value:function value(){var klass=this.constructor,cached=klass[propertiesAndSettingsCacheSym];if(cached){if(cached.classHierarchy!=getClassHierarchy(klass)){var _propertiesAndSetting2=propertiesAndSettingsInHierarchyOf(klass),_properties=_propertiesAndSetting2.properties,propertySettings=_propertiesAndSetting2.propertySettings;klass[propertiesAndSettingsCacheSym]={properties:_properties,propertySettings:propertySettings,order:sortKeysWithBeforeAndAfterConstraints(_properties),classHierarchy:getClassHierarchy(klass)};prepareClassForProperties(klass,propertySettings,_properties);}else{return cached;}}return klass[propertiesAndSettingsCacheSym]||propertiesAndSettingsInHierarchyOf(klass);}});Object.defineProperty(klass.prototype,"initializeProperties",{enumerable:false,configurable:true,writable:true,value:function value(values){var _this$propertiesAndPr=this.propertiesAndPropertySettings(),properties=_this$propertiesAndPr.properties,propertySettings=_this$propertiesAndPr.propertySettings,order=_this$propertiesAndPr.order;prepareInstanceForProperties(this,propertySettings,properties,values,order);return this;}});}function propertiesAndSettingsInHierarchyOf(klass){// walks class proto chain
var propertySettings=_objectSpread({},defaultPropertySettings),properties={},allPropSettings=valuesInPropertyHierarchy(klass,"propertySettings"),allProps=valuesInPropertyHierarchy(klass,"properties");for(var i=0;i<allPropSettings.length;i++){var current=allPropSettings[i];current&&_typeof2(current)==="object"&&Object.assign(propertySettings,current);}for(var i=0;i<allProps.length;i++){var _current=allProps[i];if(_typeof2(_current)!=="object"){console.error("[initializeProperties] ".concat(klass," encountered property declaration ")+"that is not a JS object: ".concat(_current));continue;}// "deep" merge
for(var name in _current){if(!properties.hasOwnProperty(name))properties[name]=_current[name];else Object.assign(properties[name],_current[name]);}}return{properties:properties,propertySettings:propertySettings};}function prepareInstanceForProperties(instance,propertySettings,properties,values,sortedKeys){var valueStoreProperty=propertySettings.valueStoreProperty,sortedKeys=sortedKeys||sortKeysWithBeforeAndAfterConstraints(properties),propsNeedingInitialize=[],initActions={};// 1. this[valueStoreProperty] is were the actual values will be stored
if(!instance.hasOwnProperty(valueStoreProperty))instance[valueStoreProperty]={};for(var i=0;i<sortedKeys.length;i++){var key=sortedKeys[i],descriptor=properties[key];var derived=descriptor.derived,foldable=!!descriptor.foldable,defaultValue=descriptor.hasOwnProperty("defaultValue")?descriptor.defaultValue:undefined;if(Array.isArray(defaultValue))defaultValue=defaultValue.slice();if(!derived&&!foldable)instance[valueStoreProperty][key]=defaultValue;var initAction=void 0;if(descriptor.hasOwnProperty("initialize")){initAction=initActions[key]={initialize:defaultValue};propsNeedingInitialize.push(key);}else if(derived&&defaultValue!==undefined){initAction=initActions[key]={derived:defaultValue};propsNeedingInitialize.push(key);}else if(foldable&&defaultValue!==undefined){initAction=initActions[key]={folded:defaultValue};propsNeedingInitialize.push(key);}if(values&&key in values){if(descriptor.readOnly){console.warn("Trying to initialize read-only property ".concat(key," in ").concat(instance,", ")+"skipping setting value");}else{if(!initAction){initAction=initActions[key]={};propsNeedingInitialize.push(key);}initAction.value=values[key];}}}// 2. Run init code for properties
// and if we have values we will initialize the properties from it. Values
// is expected to be a JS object mapping property names to property values
for(var i=0;i<propsNeedingInitialize.length;i++){var _key7=propsNeedingInitialize[i],actions=initActions[_key7],hasValue=actions.hasOwnProperty("value");// if we have an initialize function we call it either with the value from
// values or with the defaultValue
if(actions.hasOwnProperty("initialize")){var value=hasValue?actions.value:actions.initialize;properties[_key7].initialize.call(instance,value);if(hasValue)instance[_key7]=actions.value;}// if we have a derived property we will call the setter with the default
// value or the value from values
else if(actions.hasOwnProperty("derived")){instance[_key7]=hasValue?actions.value:actions.derived;}else if(actions.hasOwnProperty("folded")){instance[_key7]=hasValue?actions.value:actions.folded;}// if we only have the value from values we simply call the setter with it
else if(hasValue){instance[_key7]=actions.value;}}}var constructorArgMatcher=/\([^\\)]*\)/;var defaultPropertyDescriptorForGetterSetter={enumerable:false,configurable:true};var defaultPropertyDescriptorForValue={enumerable:false,configurable:true,writable:true};var setPrototypeOf=typeof Object.setPrototypeOf==="function"?function(obj,proto){return Object.setPrototypeOf(obj,proto);}:function(obj,proto){return obj.__proto__=proto;};function setSuperclass(klass,superclassOrSpec){// define klass.prototype, klass.prototype[constructor], klass[superclassSymbol]
var superclass=!superclassOrSpec?Object:typeof superclassOrSpec==="function"?superclassOrSpec:superclassOrSpec.value?superclassOrSpec.value:Object;var existingSuperclass=klass&&klass[superclassSymbol];// set the superclass if necessary and set prototype
if(!existingSuperclass||existingSuperclass!==superclass){ensureInitializeStub(superclass);klass[superclassSymbol]=superclass;setPrototypeOf(klass.prototype,superclass.prototype);if(superclass!==Object)setPrototypeOf(klass,superclass);}return superclass;}function installValueDescriptor(object,klass,descr){descr=Object.assign(descr,defaultPropertyDescriptorForValue);descr.value.displayName=descr.key;if(descr.needsDeclaringClass){var orig=descr.value.originalFunction||descr.value;descr.value=Object.assign(function declaring_class_wrapper()/*args*/{return orig.call.apply(orig,[this,klass].concat(Array.prototype.slice.call(arguments)));},{originalFunction:orig,toString:function toString(){return orig.toString();},displayName:descr.key});}Object.defineProperty(object,descr.key,descr);}function installGetterSetterDescriptor(klass,descr){descr=Object.assign(descr,defaultPropertyDescriptorForGetterSetter);Object.defineProperty(klass,descr.key,descr);}function installMethods(klass,instanceMethods,classMethods){// install methods from two lists (static + instance) of {key, value} or
// {key, get/set} descriptors
classMethods&&classMethods.forEach(function(ea){ea.value?installValueDescriptor(klass,klass,ea):installGetterSetterDescriptor(klass,ea);});instanceMethods&&instanceMethods.forEach(function(ea){ea.value?installValueDescriptor(klass.prototype,klass,ea):installGetterSetterDescriptor(klass.prototype,ea);});// 4. define initializer method, in our class system the constructor is
// generic and re-directs to the initializer method. This way we can change
// the constructor without loosing the identity of the class
if(!klass.prototype[initializeSymbol]){Object.defineProperty(klass.prototype,initializeSymbol,{enumerable:false,configurable:true,writable:true,value:function value(){}});klass.prototype[initializeSymbol].isDefaultInitializer=true;klass.prototype[initializeSymbol].displayName="lively-initialize";}else{if(Object.getOwnPropertySymbols(klass.prototype).includes(initializeSymbol)){if(klass.prototype[initializeSymbol].isDefaultInitializer){if(klass[superclassSymbol].prototype[initializeSymbol]){delete klass.prototype[initializeSymbol];}}}}// 5. undefine properties that were removed form class definition
var instanceMethodsInClass=instanceMethods.map(function(m){return m.key;}).concat(["constructor","arguments","caller"]),instanceAttributes=Object.getOwnPropertyNames(klass.prototype);for(var _i45=0;_i45<instanceAttributes.length;_i45++){var name=instanceAttributes[_i45];if(!instanceMethodsInClass.includes(name))delete klass.prototype[name];}var classMethodsInClass=classMethods.map(function(m){return m.key;}).concat(["length","name","prototype","arguments","caller"]),classAttributes=Object.getOwnPropertyNames(klass);for(var _i46=0;_i46<classAttributes.length;_i46++){var _name=classAttributes[_i46];if(!classMethodsInClass.includes(_name))delete klass[_name];}}function ensureInitializeStub(superclass){// when we inherit from "conventional classes" those don't have an
// initializer method. We install a stub that calls the superclass function
// itself
if(superclass===Object||superclass.prototype[initializeSymbol])return;Object.defineProperty(superclass.prototype,initializeSymbol,{enumerable:false,configurable:true,writable:true,value:function value()/*args*/{superclass.apply(this,arguments);}});superclass.prototype[initializeSymbol].displayName="lively-initialize-stub";}function initializeClass(constructorFunc,superclassSpec){var instanceMethods=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var classMethods=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var classHolder=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var currentModule=arguments.length>5?arguments[5]:undefined;var sourceLoc=arguments.length>6?arguments[6]:undefined;// Given a `classHolder` object as "environment", will try to find a "class"
// (JS constructor function) inside it. If no class is found it will create a
// new costructor function object and will attach the methods to it. If a class
// is found it will be modified.
// This is being used as the compile target for es6 class syntax by the
// lively.ast capturing / transform logic
// Example:
// var Foo = function(superclass) {
//   function Foo() {}
//   return initializeClass(Foo, superclass, [{key: "m", value: function m() { return 23 }}])
// }();
// new Foo().m() // => 23
// 1. create a new constructor function if necessary, re-use an exisiting if the
// classHolder object has it
var className=constructorFunc.name,klass=className&&classHolder.hasOwnProperty(className)&&classHolder[className],existingSuperclass=klass&&klass[superclassSymbol];if(!klass||typeof klass!=="function"||!existingSuperclass)klass=constructorFunc;// 2. set the superclass if necessary and set prototype
var superclass=setSuperclass(klass,superclassSpec);// 3. Install methods
installMethods(klass,instanceMethods,classMethods);klass[objMetaSymbol]=sourceLoc;// 4. If we have a `currentModule` instance (from lively.modules/src/module.js)
// then we also store some meta data about the module. This allows us to
// (de)serialize class instances in lively.serializer
if(currentModule){var p=currentModule["package"]();var prevMeta=klass[moduleMetaSymbol];var t=Date.now();klass[moduleMetaSymbol]={"package":p?{name:p.name,version:p.version}:{},pathInPackage:p?currentModule.pathInPackage():currentModule.id,lastChange:prevMeta&&prevMeta.lastChange&&t<=prevMeta.lastChange?prevMeta.lastChange+1:t,lastSuperclassChange:0};// if we have a module, we can listen to toplevel changes of it in case the
// superclass binding changes. With that we can keep our class up-to-date
// even if the superclass binding changes. This is especially useful for
// situations where modules have a circular dependency and classes in modules
// won't get defined correctly when loaded first. See
// https://github.com/LivelyKernel/lively.modules/issues/27 for more details
if(superclassSpec&&superclassSpec.referencedAs){if(klass.hasOwnProperty(moduleSubscribeToToplevelChangesSym)){currentModule.unsubscribeFromToplevelDefinitionChanges(klass[moduleSubscribeToToplevelChangesSym]);}klass[moduleSubscribeToToplevelChangesSym]=currentModule.subscribeToToplevelDefinitionChanges(function(name,val){if(name!==superclassSpec.referencedAs)return;// console.log(`class ${className}: new superclass ${name} ${name !== superclassSpec.referencedAs ? '(' + superclassSpec.referencedAs + ')' : ''} was defined via module bindings`)
// Only run through the (expensive) updates if superclass really has changes
var superMeta=val&&val[moduleMetaSymbol],myMeta=klass[moduleMetaSymbol];if(superMeta){if(superMeta.lastChange===myMeta.lastSuperclassChange)return;myMeta.lastSuperclassChange=superMeta.lastChange;}setSuperclass(klass,val);installMethods(klass,instanceMethods,classMethods);prepareClassForManagedPropertiesAfterCreation(klass);});}}// 6. Add a toString method for the class to allows us to see its constructor arguments
klass.toString=function(){var constructorArgs=String(this.prototype[initializeSymbol]).match(constructorArgMatcher),className=this.name,superclass=this[superclassSymbol];return"class ".concat(className," ").concat(superclass?"extends ".concat(superclass.name):""," {\n")+"  constructor".concat(constructorArgs?constructorArgs[0]:"()"," { /*...*/ }")+"\n}";};// 7. If the class allows managed properties (auto getters/setters etc., see
// managed-properties.js) then setup those
prepareClassForManagedPropertiesAfterCreation(klass);return klass;}initializeClass._get=function _get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);return parent===null?undefined:_get(parent,property,receiver);}if("value"in desc)return desc.value;var getter=desc.get;return getter===undefined?undefined:getter.call(receiver);};initializeClass._set=function _set(object,property,value,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent!==null)_set(parent,property,value,receiver);}else if("value"in desc&&desc.writable)desc.value=value;else{var setter=desc.set;if(setter!==undefined)setter.call(receiver,value);}return value;};var __varRecorder__$2=lively.FreezerRuntime.recorderFor("lively.graphics/color-parser.js");function parse(string){var color=new __varRecorder__$2.Color(string);return{red:color.red()/255,green:color.green()/255,blue:color.blue()/255,alpha:color.alpha()};}__varRecorder__$2.parse=parse;function Color(value){this._listeners={};this.subscribe(__varRecorder__$2.Events.RGB_UPDATED,this._RGBUpdated);this.subscribe(__varRecorder__$2.Events.HEX_UPDATED,this._HEXUpdated);this.subscribe(__varRecorder__$2.Events.HSL_UPDATED,this._HSLUpdated);this.subscribe(__varRecorder__$2.Events.HSV_UPDATED,this._HSVUpdated);this.subscribe(__varRecorder__$2.Events.INT_UPDATED,this._INTUpdated);this.parse(value);}__varRecorder__$2.Color=Color;__varRecorder__$2.parse=parse;__varRecorder__$2.parse=parse;__varRecorder__$2.Events={RGB_UPDATED:"RGBUpdated",HSL_UPDATED:"HSLUpdated",HSV_UPDATED:"HSVUpdated",HEX_UPDATED:"HexUpdated",INT_UPDATED:"IntUpdated",UPDATED:"updated"};__varRecorder__$2.namedColors={"transparent":"rgba(0, 0, 0, 0)","aliceblue":"#F0F8FF","antiquewhite":"#FAEBD7","aqua":"#00FFFF","aquamarine":"#7FFFD4","azure":"#F0FFFF","beige":"#F5F5DC","bisque":"#FFE4C4","black":"#000000","blanchedalmond":"#FFEBCD","blue":"#0000FF","blueviolet":"#8A2BE2","brown":"#A52A2A","burlywood":"#DEB887","cadetblue":"#5F9EA0","chartreuse":"#7FFF00","chocolate":"#D2691E","coral":"#FF7F50","cornflowerblue":"#6495ED","cornsilk":"#FFF8DC","crimson":"#DC143C","cyan":"#00FFFF","darkblue":"#00008B","darkcyan":"#008B8B","darkgoldenrod":"#B8860B","darkgray":"#A9A9A9","darkgrey":"#A9A9A9","darkgreen":"#006400","darkkhaki":"#BDB76B","darkmagenta":"#8B008B","darkolivegreen":"#556B2F","darkorange":"#FF8C00","darkorchid":"#9932CC","darkred":"#8B0000","darksalmon":"#E9967A","darkseagreen":"#8FBC8F","darkslateblue":"#483D8B","darkslategray":"#2F4F4F","darkslategrey":"#2F4F4F","darkturquoise":"#00CED1","darkviolet":"#9400D3","deeppink":"#FF1493","deepskyblue":"#00BFFF","dimgray":"#696969","dimgrey":"#696969","dodgerblue":"#1E90FF","firebrick":"#B22222","floralwhite":"#FFFAF0","forestgreen":"#228B22","fuchsia":"#FF00FF","gainsboro":"#DCDCDC","ghostwhite":"#F8F8FF","gold":"#FFD700","goldenrod":"#DAA520","gray":"#808080","grey":"#808080","green":"#008000","greenyellow":"#ADFF2F","honeydew":"#F0FFF0","hotpink":"#FF69B4","indianred":"#CD5C5C","indigo":"#4B0082","ivory":"#FFFFF0","khaki":"#F0E68C","lavender":"#E6E6FA","lavenderblush":"#FFF0F5","lawngreen":"#7CFC00","lemonchiffon":"#FFFACD","lightblue":"#ADD8E6","lightcoral":"#F08080","lightcyan":"#E0FFFF","lightgoldenrodyellow":"#FAFAD2","lightgray":"#D3D3D3","lightgrey":"#D3D3D3","lightgreen":"#90EE90","lightpink":"#FFB6C1","lightsalmon":"#FFA07A","lightseagreen":"#20B2AA","lightskyblue":"#87CEFA","lightslategray":"#778899","lightslategrey":"#778899","lightsteelblue":"#B0C4DE","lightyellow":"#FFFFE0","lime":"#00FF00","limegreen":"#32CD32","linen":"#FAF0E6","magenta":"#FF00FF","maroon":"#800000","mediumaquamarine":"#66CDAA","mediumblue":"#0000CD","mediumorchid":"#BA55D3","mediumpurple":"#9370D8","mediumseagreen":"#3CB371","mediumslateblue":"#7B68EE","mediumspringgreen":"#00FA9A","mediumturquoise":"#48D1CC","mediumvioletred":"#C71585","midnightblue":"#191970","mintcream":"#F5FFFA","mistyrose":"#FFE4E1","moccasin":"#FFE4B5","navajowhite":"#FFDEAD","navy":"#000080","oldlace":"#FDF5E6","olive":"#808000","olivedrab":"#6B8E23","orange":"#FFA500","orangered":"#FF4500","orchid":"#DA70D6","palegoldenrod":"#EEE8AA","palegreen":"#98FB98","paleturquoise":"#AFEEEE","palevioletred":"#D87093","papayawhip":"#FFEFD5","peachpuff":"#FFDAB9","peru":"#CD853F","pink":"#FFC0CB","plum":"#DDA0DD","powderblue":"#B0E0E6","purple":"#800080","red":"#FF0000","rosybrown":"#BC8F8F","royalblue":"#4169E1","saddlebrown":"#8B4513","salmon":"#FA8072","sandybrown":"#F4A460","seagreen":"#2E8B57","seashell":"#FFF5EE","sienna":"#A0522D","silver":"#C0C0C0","skyblue":"#87CEEB","slateblue":"#6A5ACD","slategray":"#708090","slategrey":"#708090","snow":"#FFFAFA","springgreen":"#00FF7F","steelblue":"#4682B4","tan":"#D2B48C","teal":"#008080","thistle":"#D8BFD8","tomato":"#FF6347","turquoise":"#40E0D0","violet":"#EE82EE"};__varRecorder__$2.absround=function(number){return 0.5+number<<0;};__varRecorder__$2.hue2rgb=function(a,b,c){if(c<0)c+=1;if(c>1)c-=1;if(c<1/6)return a+(b-a)*6*c;if(c<1/2)return b;if(c<2/3)return a+(b-a)*(2/3-c)*6;return a;};__varRecorder__$2.p2v=function(p){return __varRecorder__$2.isPercent.test(p)?__varRecorder__$2.absround(parseInt(p)*2.55):p;};__varRecorder__$2.isHex=/^#?([0-9a-f]{3}|[0-9a-f]{6})$/i;__varRecorder__$2.isHSL=/^hsla?\((\d{1,3}?),\s*(\d{1,3}%),\s*(\d{1,3}%)(,\s*[01]?\.?\d*)?\)$/;__varRecorder__$2.isRGB=/^rgba?\((\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d{1,3}%?)(,\s*[01]?\.?\d*)?\)$/;__varRecorder__$2.isPercent=/^\d+(\.\d+)*%$/;__varRecorder__$2.hexBit=/([0-9a-f])/gi;__varRecorder__$2.leadHex=/^#/;__varRecorder__$2.matchHSL=/^hsla?\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%(,\s*([01]?\.?\d*))?\)$/;__varRecorder__$2.matchRGB=/^rgba?\((\d{1,3}%?),\s*(\d{1,3}%?),\s*(\d{1,3}%?)(,\s*([01]?\.?\d*))?\)$/;__varRecorder__$2.Color.prototype._decimal=0;__varRecorder__$2.Color.prototype._hex="#000000";__varRecorder__$2.Color.prototype._red=0;__varRecorder__$2.Color.prototype._green=0;__varRecorder__$2.Color.prototype._blue=0;__varRecorder__$2.Color.prototype._hue=0;__varRecorder__$2.Color.prototype._saturation=0;__varRecorder__$2.Color.prototype._lightness=0;__varRecorder__$2.Color.prototype._brightness=0;__varRecorder__$2.Color.prototype._alpha=1;__varRecorder__$2.Color.prototype.parse=function(value){if(typeof value=="undefined"){return this;}switch(true){case isFinite(value):this.decimal(value);this.output=__varRecorder__$2.Color.INT;return this;case value instanceof __varRecorder__$2.Color:this.copy(value);return this;default:switch(_typeof2(value)){case"object":this.set(value);return this;case"string":switch(true){case __varRecorder__$2.namedColors.hasOwnProperty(value):value=__varRecorder__$2.namedColors[value];var stripped=value.replace(__varRecorder__$2.leadHex,"");this.decimal(parseInt(stripped,16));return this;case __varRecorder__$2.isHex.test(value):var stripped=value.replace(__varRecorder__$2.leadHex,"");if(stripped.length==3){stripped=stripped.replace(__varRecorder__$2.hexBit,"$1$1");}this.decimal(parseInt(stripped,16));return this;case __varRecorder__$2.isRGB.test(value):var parts=value.match(__varRecorder__$2.matchRGB);this.red(__varRecorder__$2.p2v(parts[1]));this.green(__varRecorder__$2.p2v(parts[2]));this.blue(__varRecorder__$2.p2v(parts[3]));this.alpha(parseFloat(parts[5])||1);this.output=(__varRecorder__$2.isPercent.test(parts[1])?2:1)+(parts[5]?2:0);return this;case __varRecorder__$2.isHSL.test(value):var parts=value.match(__varRecorder__$2.matchHSL);this.hue(parseInt(parts[1]));this.saturation(parseInt(parts[2]));this.lightness(parseInt(parts[3]));this.alpha(parseFloat(parts[5])||1);this.output=parts[5]?6:5;return this;}}}return this;};__varRecorder__$2.Color.prototype.clone=function(){return new __varRecorder__$2.Color(this.decimal());};__varRecorder__$2.Color.prototype.copy=function(color){this.set(color.decimal());return this;};__varRecorder__$2.Color.prototype.set=function(key,value){if(arguments.length==1){if(_typeof2(key)=="object"){for(var p in key){if(typeof this[p]=="function"){this[p](key[p]);}}}else if(isFinite(key)){this.decimal(key);}}else if(typeof this[key]=="function"){this[key](value);}return this;};__varRecorder__$2.Color.prototype.interpolate=function(destination,factor){if(!(destination instanceof __varRecorder__$2.Color)){destination=new __varRecorder__$2.Color(destination);}this._red=__varRecorder__$2.absround(+this._red+(destination._red-this._red)*factor);this._green=__varRecorder__$2.absround(+this._green+(destination._green-this._green)*factor);this._blue=__varRecorder__$2.absround(+this._blue+(destination._blue-this._blue)*factor);this._alpha=__varRecorder__$2.absround(+this._alpha+(destination._alpha-this._alpha)*factor);this.broadcast(__varRecorder__$2.Events.RGB_UPDATED);this.broadcast(__varRecorder__$2.Events.UPDATED);return this;};__varRecorder__$2.Color.prototype._RGB2HSL=function(){var r=this._red/255;var g=this._green/255;var b=this._blue/255;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var l=(max+min)/2;var v=max;if(max==min){this._hue=0;this._saturation=0;this._lightness=__varRecorder__$2.absround(l*100);this._brightness=__varRecorder__$2.absround(v*100);return;}var d=max-min;var s=d/(l<=0.5?max+min:2-max-min);var h=(max==r?(g-b)/d+(g<b?6:0):max==g?(b-r)/d+2:(r-g)/d+4)/6;this._hue=__varRecorder__$2.absround(h*360);this._saturation=__varRecorder__$2.absround(s*100);this._lightness=__varRecorder__$2.absround(l*100);this._brightness=__varRecorder__$2.absround(v*100);};__varRecorder__$2.Color.prototype._HSL2RGB=function(){var h=this._hue/360;var s=this._saturation/100;var l=this._lightness/100;var q=l<0.5?l*(1+s):l+s-l*s;var p=2*l-q;this._red=__varRecorder__$2.absround(__varRecorder__$2.hue2rgb(p,q,h+1/3)*255);this._green=__varRecorder__$2.absround(__varRecorder__$2.hue2rgb(p,q,h)*255);this._blue=__varRecorder__$2.absround(__varRecorder__$2.hue2rgb(p,q,h-1/3)*255);};__varRecorder__$2.Color.prototype._HSV2RGB=function(){var h=this._hue/360;var s=this._saturation/100;var v=this._brightness/100;var r=0;var g=0;var b=0;var i=Math.floor(h*6);var f=h*6-i;var p=v*(1-s);var q=v*(1-f*s);var t=v*(1-(1-f)*s);switch(i%6){case 0:r=v,g=t,b=p;break;case 1:r=q,g=v,b=p;break;case 2:r=p,g=v,b=t;break;case 3:r=p,g=q,b=v;break;case 4:r=t,g=p,b=v;break;case 5:r=v,g=p,b=q;break;}this._red=__varRecorder__$2.absround(r*255);this._green=__varRecorder__$2.absround(g*255);this._blue=__varRecorder__$2.absround(b*255);};__varRecorder__$2.Color.prototype._INT2HEX=function(){var x=this._decimal.toString(16);x="000000".substr(0,6-x.length)+x;this._hex="#"+x.toUpperCase();};__varRecorder__$2.Color.prototype._INT2RGB=function(){this._red=this._decimal>>16;this._green=this._decimal>>8&255;this._blue=this._decimal&255;};__varRecorder__$2.Color.prototype._HEX2INT=function(){this._decimal=parseInt(this._hex,16);};__varRecorder__$2.Color.prototype._RGB2INT=function(){this._decimal=this._red<<16|this._green<<8&65535|this._blue;};__varRecorder__$2.Color.prototype._RGBUpdated=function(){this._RGB2INT();this._RGB2HSL();this._INT2HEX();};__varRecorder__$2.Color.prototype._HSLUpdated=function(){this._HSL2RGB();this._RGB2INT();this._INT2HEX();};__varRecorder__$2.Color.prototype._HSVUpdated=function(){this._HSV2RGB();this._RGB2INT();this._INT2HEX();};__varRecorder__$2.Color.prototype._HEXUpdated=function(){this._HEX2INT();this._INT2RGB();this._RGB2HSL();};__varRecorder__$2.Color.prototype._INTUpdated=function(){this._INT2RGB();this._RGB2HSL();this._INT2HEX();};__varRecorder__$2.Color.prototype._broadcastUpdate=function(){this.broadcast(__varRecorder__$2.Events.UPDATED);};__varRecorder__$2.Color.prototype.decimal=function(value){return this._handle("_decimal",value,__varRecorder__$2.Events.INT_UPDATED);};__varRecorder__$2.Color.prototype.hex=function(value){return this._handle("_hex",value,__varRecorder__$2.Events.HEX_UPDATED);};__varRecorder__$2.Color.prototype.red=function(value){return this._handle("_red",value,__varRecorder__$2.Events.RGB_UPDATED);};__varRecorder__$2.Color.prototype.green=function(value){return this._handle("_green",value,__varRecorder__$2.Events.RGB_UPDATED);};__varRecorder__$2.Color.prototype.blue=function(value){return this._handle("_blue",value,__varRecorder__$2.Events.RGB_UPDATED);};__varRecorder__$2.Color.prototype.hue=function(value){return this._handle("_hue",value,__varRecorder__$2.Events.HSL_UPDATED);};__varRecorder__$2.Color.prototype.saturation=function(value){return this._handle("_saturation",value,__varRecorder__$2.Events.HSL_UPDATED);};__varRecorder__$2.Color.prototype.lightness=function(value){return this._handle("_lightness",value,__varRecorder__$2.Events.HSL_UPDATED);};__varRecorder__$2.Color.prototype.brightness=function(value){return this._handle("_brightness",value,__varRecorder__$2.Events.HSV_UPDATED);};__varRecorder__$2.Color.prototype.alpha=function(value){return this._handle("_alpha",value);};__varRecorder__$2.Color.prototype._handle=function(prop,value,event){if(typeof this[prop]!="undefined"){if(typeof value!="undefined"){if(value!=this[prop]){this[prop]=value;if(event){this.broadcast(event);}}this.broadcast(__varRecorder__$2.Events.UPDATED);}}return this[prop];};__varRecorder__$2.Color.prototype.getHex=function(){return this._hex;};__varRecorder__$2.Color.prototype.getRGB=function(){var components=[__varRecorder__$2.absround(this._red),__varRecorder__$2.absround(this._green),__varRecorder__$2.absround(this._blue)];return"rgb("+components.join(", ")+")";};__varRecorder__$2.Color.prototype.getPRGB=function(){var components=[__varRecorder__$2.absround(100*this._red/255)+"%",__varRecorder__$2.absround(100*this._green/255)+"%",__varRecorder__$2.absround(100*this._blue/255)+"%"];return"rgb("+components.join(", ")+")";};__varRecorder__$2.Color.prototype.getRGBA=function(){var components=[__varRecorder__$2.absround(this._red),__varRecorder__$2.absround(this._green),__varRecorder__$2.absround(this._blue),this._alpha];return"rgba("+components.join(", ")+")";};__varRecorder__$2.Color.prototype.getPRGBA=function(){var components=[__varRecorder__$2.absround(100*this._red/255)+"%",__varRecorder__$2.absround(100*this._green/255)+"%",__varRecorder__$2.absround(100*this._blue/255)+"%",this._alpha];return"rgba("+components.join(", ")+")";};__varRecorder__$2.Color.prototype.getHSL=function(){var components=[__varRecorder__$2.absround(this._hue),__varRecorder__$2.absround(this._saturation)+"%",__varRecorder__$2.absround(this._lightness)+"%"];return"hsl("+components.join(", ")+")";};__varRecorder__$2.Color.prototype.getHSLA=function(){var components=[__varRecorder__$2.absround(this._hue),__varRecorder__$2.absround(this._saturation)+"%",__varRecorder__$2.absround(this._lightness)+"%",this._alpha];return"hsla("+components.join(", ")+")";};__varRecorder__$2.Color.prototype.format=function(string){var tokens={r:this._red,g:this._green,b:this._blue,h:this._hue,s:this._saturation,l:this._lightness,v:this._brightness,a:this._alpha,x:this._hex,d:this._decimal};for(var token in tokens){string=string.split("%"+token+"%").join(tokens[token]);}return string;};__varRecorder__$2.Color.prototype.output=0;__varRecorder__$2.Color.HEX=0;__varRecorder__$2.Color.RGB=1;__varRecorder__$2.Color.PRGB=2;__varRecorder__$2.Color.RGBA=3;__varRecorder__$2.Color.PRGBA=4;__varRecorder__$2.Color.HSL=5;__varRecorder__$2.Color.HSLA=6;__varRecorder__$2.Color.INT=7;__varRecorder__$2.Color.prototype.toString=function(){switch(this.output){case 0:return this.getHex();case 1:return this.getRGB();case 2:return this.getPRGB();case 3:return this.getRGBA();case 4:return this.getPRGBA();case 5:return this.getHSL();case 6:return this.getHSLA();case 7:return this._decimal;}return this.getHex();};__varRecorder__$2.Color.prototype._listeners=null;__varRecorder__$2.Color.prototype._isSubscribed=function(type){return this._listeners[type]!=null;};__varRecorder__$2.Color.prototype.subscribe=function(type,callback){if(!this._isSubscribed(type)){this._listeners[type]=[];}this._listeners[type].push(callback);};__varRecorder__$2.Color.prototype.unsubscribe=function(type,callback){if(!this._isSubscribed(type)){return;}var stack=this._listeners[type];for(var i=0,l=stack.length;i<l;i++){if(stack[i]===callback){stack.splice(i,1);return this.unsubscribe(type,callback);}}};__varRecorder__$2.Color.prototype.broadcast=function(type,params){if(!this._isSubscribed(type)){return;}var stack=this._listeners[type];var l=stack.length;for(var i=0;i<l;i++){stack[i].apply(this,params);}};__varRecorder__$2.Color.prototype.tween=function(duration,color){if(!(color instanceof __varRecorder__$2.Color)){color=new __varRecorder__$2.Color(color);}var start=+new Date();var ref=this;this.broadcast("tweenStart");var interval=setInterval(function(){var ellapsed=+new Date()-start;var delta=Math.min(1,ellapsed/duration);ref.interpolate(color,delta);ref.broadcast("tweenProgress");if(delta==1){clearInterval(interval);ref.broadcast("tweenComplete");}},20);return interval;};__varRecorder__$2.Color.prototype.bind=function(object,property){var ref=this;this.subscribe("updated",function(){object[property]=ref.toString();});};__varRecorder__$2.Color.random=function(){return new __varRecorder__$2.Color(__varRecorder__$2.absround(Math.random()*16777215));};__varRecorder__$2.Color.bind=function(object,property){var color=new __varRecorder__$2.Color(object[property]);color.bind(object,property);return color;};var __varRecorder__$3=lively.FreezerRuntime.recorderFor("lively.graphics/color.js");function floor(x){return Math.floor(x*255.99);}__varRecorder__$3.floor=floor;function pad$1(array,n){var getPadElement=arguments.length>2&&arguments[2]!==undefined?arguments[2]:__varRecorder__$3.arr.last;return[].concat(_toConsumableArray2(array),_toConsumableArray2(new Array(Math.max(n-array.length,0)).fill(getPadElement(array))));}__varRecorder__$3.pad=pad$1;__varRecorder__$3.num=num;__varRecorder__$3.obj=obj;__varRecorder__$3.arr=arr;__varRecorder__$3.parse=parse;__varRecorder__$3.Rectangle=Rectangle;__varRecorder__$3.rect=rect;__varRecorder__$3.pt=pt;__varRecorder__$3.Point=Point;__varRecorder__$3.rgbaRegex=new RegExp("\\s*rgba?\\s*\\(\\s*(\\d+)(%?)\\s*,\\s*(\\d+)(%?)\\s*,\\s*(\\d+)(%?)\\s*(?:,\\s*([0-9\\.]+)\\s*)?\\)\\s*");var ColorHarmony=/*#__PURE__*/function(){function ColorHarmony(){_classCallCheck(this,ColorHarmony);}_createClass(ColorHarmony,[{key:"offsets",value:function offsets(){return null;}},{key:"stepCount",value:function stepCount(){return 0;}},{key:"stepSize",value:function stepSize(){return 0;}},{key:"chord",value:function chord(_ref){var _this2=this;var hue=_ref.hue,saturation=_ref.saturation,brightness=_ref.brightness;var offsets=this.offsets()||__varRecorder__$3.arr.range(0,this.steps()).map(function(i){return i*_this2.stepSize();});return offsets.map(function(offset){return __varRecorder__$3.Color.hsb(hue+offset%360,saturation,brightness);});}},{key:"name",get:function get(){return"Color Harmony";}}]);return ColorHarmony;}();__varRecorder__$3.ColorHarmony=ColorHarmony;var Complementary=/*#__PURE__*/function(_varRecorder__$3$Col){_inherits(Complementary,_varRecorder__$3$Col);var _super=_createSuper(Complementary);function Complementary(){_classCallCheck(this,Complementary);return _super.apply(this,arguments);}_createClass(Complementary,[{key:"steps",value:function steps(){return 1;}},{key:"stepSize",value:function stepSize(){return 180;}},{key:"name",get:function get(){return"Complement";}}]);return Complementary;}(__varRecorder__$3.ColorHarmony);__varRecorder__$3.Complementary=Complementary;var Triadic=/*#__PURE__*/function(_varRecorder__$3$Col2){_inherits(Triadic,_varRecorder__$3$Col2);var _super2=_createSuper(Triadic);function Triadic(){_classCallCheck(this,Triadic);return _super2.apply(this,arguments);}_createClass(Triadic,[{key:"steps",value:function steps(){return 2;}},{key:"stepSize",value:function stepSize(){return 120;}},{key:"name",get:function get(){return"Triadic";}}]);return Triadic;}(__varRecorder__$3.ColorHarmony);__varRecorder__$3.Triadic=Triadic;var Tetradic=/*#__PURE__*/function(_varRecorder__$3$Col3){_inherits(Tetradic,_varRecorder__$3$Col3);var _super3=_createSuper(Tetradic);function Tetradic(){_classCallCheck(this,Tetradic);return _super3.apply(this,arguments);}_createClass(Tetradic,[{key:"offsets",value:function offsets(){return[0,60,180,240];}},{key:"name",get:function get(){return"Tetradic";}}]);return Tetradic;}(__varRecorder__$3.ColorHarmony);__varRecorder__$3.Tetradic=Tetradic;var Quadratic=/*#__PURE__*/function(_varRecorder__$3$Col4){_inherits(Quadratic,_varRecorder__$3$Col4);var _super4=_createSuper(Quadratic);function Quadratic(){_classCallCheck(this,Quadratic);return _super4.apply(this,arguments);}_createClass(Quadratic,[{key:"steps",value:function steps(){return 3;}},{key:"stepSize",value:function stepSize(){return 90;}},{key:"name",get:function get(){return"Quadratic";}}]);return Quadratic;}(__varRecorder__$3.ColorHarmony);__varRecorder__$3.Quadratic=Quadratic;var Analogous=/*#__PURE__*/function(_varRecorder__$3$Col5){_inherits(Analogous,_varRecorder__$3$Col5);var _super5=_createSuper(Analogous);function Analogous(){_classCallCheck(this,Analogous);return _super5.apply(this,arguments);}_createClass(Analogous,[{key:"steps",value:function steps(){return 5;}},{key:"offsets",value:function offsets(){return[-60,-30,0,30,60];}},{key:"name",get:function get(){return"Analogous";}}]);return Analogous;}(__varRecorder__$3.ColorHarmony);__varRecorder__$3.Analogous=Analogous;var Neutral=/*#__PURE__*/function(_varRecorder__$3$Col6){_inherits(Neutral,_varRecorder__$3$Col6);var _super6=_createSuper(Neutral);function Neutral(){_classCallCheck(this,Neutral);return _super6.apply(this,arguments);}_createClass(Neutral,[{key:"offsets",value:function offsets(){return[-30,-15,0,15,30];}},{key:"name",get:function get(){return"Neutral";}}]);return Neutral;}(__varRecorder__$3.ColorHarmony);__varRecorder__$3.Neutral=Neutral;var Color$1=/*#__PURE__*/function(){_createClass(Color$1,[{key:"isColor",get:function get(){return true;}}],[{key:"random",value:function random(min,max){if(min===undefined)min=0;if(max===undefined)max=255;return __varRecorder__$3.Color.rgb(__varRecorder__$3.num.random(min,max),__varRecorder__$3.num.random(min,max),__varRecorder__$3.num.random(min,max));}},{key:"hsb",value:function hsb(hue,sat,brt){var s=sat,b=brt;if(sat==0)return new __varRecorder__$3.Color(b,b,b);var h=hue%360,h60=h/60,i=Math.floor(h60),f=h60-i,p=(1-s)*b,q=(1-s*f)*b,t=(1-s*(1-f))*b;switch(i){case 0:return new __varRecorder__$3.Color(b,t,p);case 1:return new __varRecorder__$3.Color(q,b,p);case 2:return new __varRecorder__$3.Color(p,b,t);case 3:return new __varRecorder__$3.Color(p,q,b);case 4:return new __varRecorder__$3.Color(t,p,b);case 5:return new __varRecorder__$3.Color(b,p,q);default:return new __varRecorder__$3.Color(0,0,0);}}},{key:"wheel",value:function wheel(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;return __varRecorder__$3.Color.wheelHsb(n,0,0.9,0.7);}},{key:"wheelHsb",value:function wheelHsb(n,hue,sat,brt){var a=new Array(n),step=360/Math.max(n,1);for(var i=0;i<n;i++){a[i]=__varRecorder__$3.Color.hsb(hue+i*step,sat,brt);}return a;}},{key:"rgb",value:function rgb(r,g,b){return new __varRecorder__$3.Color(r/255,g/255,b/255);}},{key:"rgbHex",value:function rgbHex(colorHexString){var colorData=this.parseHex(colorHexString);if(colorData&&colorData[0]>=0&&colorData[1]>=0&&colorData[2]>=0){return new __varRecorder__$3.Color(colorData[0],colorData[1],colorData[2]);}else{return null;}}},{key:"rgba",value:function rgba(r,g,b,a){return new __varRecorder__$3.Color(r/255,g/255,b/255,a);}},{key:"fromLiteral",value:function fromLiteral(spec){return new __varRecorder__$3.Color(spec.r,spec.g,spec.b,spec.a);}},{key:"fromTuple",value:function fromTuple(tuple){return new __varRecorder__$3.Color(tuple[0],tuple[1],tuple[2],tuple[3]);}},{key:"fromTuple8Bit",value:function fromTuple8Bit(tuple){return new __varRecorder__$3.Color(tuple[0]/255,tuple[1]/255,tuple[2]/255,tuple[3]/255);}},{key:"fromString",value:function fromString(str){if(!str||str==="none"){return null;}else{return this.fromTuple(this.parse(str));}}},{key:"parse",value:function parse(str){var color;if(!str||str==="none"){return null;}else{color=__varRecorder__$3.parse(str);return[color.red,color.green,color.blue,color.alpha];}}},{key:"parseRGB",value:function parseRGB(str){var match=str.match(this.rgbaRegex);if(match){var r=parseInt(match[1])/(match[2]?100:255);var g=parseInt(match[3])/(match[4]?100:255);var b=parseInt(match[5])/(match[6]?100:255);var a=match[7]?parseFloat(match[7]):1;return[r,g,b,a];}return null;}},{key:"parseHex",value:function parseHex(colStr){var rHex,gHex,bHex,str="";for(var i=0;i<colStr.length;i++){var c=colStr[i].toLowerCase();if(c=="a"||c=="b"||c=="c"||c=="d"||c=="e"||c=="f"||c=="0"||c=="1"||c=="2"||c=="3"||c=="4"||c=="5"||c=="6"||c=="7"||c=="8"||c=="9"){str+=c;}}if(str.length==6){rHex=str.substring(0,2);gHex=str.substring(2,4);bHex=str.substring(4,6);}else if(str.length==3){rHex=str.substring(0,1);rHex+=rHex;gHex=str.substring(1,2);gHex+=gHex;bHex=str.substring(2,3);bHex+=bHex;}else{return null;}var r=parseInt(rHex,16)/255,g=parseInt(gHex,16)/255,b=parseInt(bHex,16)/255;return[r,g,b];}},{key:"rgbaRegex",get:function get(){return __varRecorder__$3.rgbaRegex;}},{key:"named",get:function get(){if(this._named)return this._named;return this._named={black:new __varRecorder__$3.Color(0,0,0),almostBlack:__varRecorder__$3.Color.rgb(64,64,64),white:new __varRecorder__$3.Color(1,1,1),gray:new __varRecorder__$3.Color(0.8,0.8,0.8),red:new __varRecorder__$3.Color(0.8,0,0),green:new __varRecorder__$3.Color(0,0.8,0),yellow:new __varRecorder__$3.Color(0.8,0.8,0),blue:new __varRecorder__$3.Color(0,0,0.8),purple:new __varRecorder__$3.Color(0.5,0,0.5),magenta:new __varRecorder__$3.Color(1,0,1),pink:__varRecorder__$3.Color.rgb(255,30,153),turquoise:__varRecorder__$3.Color.rgb(0,240,255),tangerine:__varRecorder__$3.Color.rgb(242,133,0),orange:__varRecorder__$3.Color.rgb(255,153,0),cyan:__varRecorder__$3.Color.rgb(0,255,255),brown:__varRecorder__$3.Color.rgb(182,67,0),limeGreen:__varRecorder__$3.Color.rgb(51,255,0),darkGray:__varRecorder__$3.Color.rgb(102,102,102),lightGray:__varRecorder__$3.Color.rgb(230,230,230),veryLightGray:__varRecorder__$3.Color.rgb(243,243,243),transparent:__varRecorder__$3.Color.rgba(0,0,0,0),lively:__varRecorder__$3.Color.rgb(245,124,0)};}}]);function Color$1(r,g,b,a){_classCallCheck(this,Color$1);this.r=r||0;this.g=g||0;this.b=b||0;this.a=a||(a===0?0:1);}_createClass(Color$1,[{key:"grayValue",value:function grayValue(){return(this.r+this.g+this.b)/3;}},{key:"equals",value:function equals(other){if(!other)return false;return this.r===other.r&&this.g===other.g&&this.b===other.b&&this.a===other.a;}},{key:"darker",value:function darker(recursion){var result=this.mixedWith(__varRecorder__$3.Color.black,0.5);return recursion>1?result.darker(recursion-1):result;}},{key:"lighter",value:function lighter(recursion){if(recursion==0)return this;var result=this.mixedWith(__varRecorder__$3.Color.white,0.5);return recursion>1?result.lighter(recursion-1):result;}},{key:"interpolate",value:function interpolate(p,other){if(other.isGradient){return other.interpolate(1-p,this);}other=__varRecorder__$3.obj.isArray(other)?other:other.toTuple();return __varRecorder__$3.Color.fromTuple(this.toTuple().map(function(v,k){return __varRecorder__$3.num.interpolate(p,v,other[k]);}));}},{key:"toString",value:function toString(){return this.a===1?"rgb("+__varRecorder__$3.floor(this.r)+","+__varRecorder__$3.floor(this.g)+","+__varRecorder__$3.floor(this.b)+")":this.toRGBAString();}},{key:"toRGBAString",value:function toRGBAString(){function floor(x){return Math.floor(x*255.99);}return"rgba("+floor(this.r)+","+floor(this.g)+","+floor(this.b)+","+this.a+")";}},{key:"toHexString",value:function toHexString(){function floor(x){return Math.floor(x*255.99);}function addLeadingZero(string){var s=string;while(s.length<2){s="0"+s;}return s;}return addLeadingZero(floor(this.r).toString(16))+addLeadingZero(floor(this.g).toString(16))+addLeadingZero(floor(this.b).toString(16));}},{key:"toTuple",value:function toTuple(){return[this.r,this.g,this.b,this.a];}},{key:"toTuple8Bit",value:function toTuple8Bit(){return[this.r*255,this.g*255,this.b*255,this.a*255];}},{key:"toHSB",value:function toHSB(){var max=Math.max(this.r,this.g,this.b),min=Math.min(this.r,this.g,this.b),h,s,b=max;if(max==min){h=0;}else if(max==this.r){h=60*(0+(this.g-this.b)/(max-min));}else if(max==this.g){h=60*(2+(this.b-this.r)/(max-min));}else if(max==this.b){h=60*(4+(this.r-this.g)/(max-min));}h=(h+360)%360;s=max==0?0:(max-min)/max;return[h,s,b];}},{key:"withA",value:function withA(a){return new __varRecorder__$3.Color(this.r,this.g,this.b,a);}},{key:"mixedWith",value:function mixedWith(other,proportion){var p=proportion,q=1-p;return new __varRecorder__$3.Color(this.r*p+other.r*q,this.g*p+other.g*q,this.b*p+other.b*q,this.a*p+other.a*q);}},{key:"invert",value:function invert(){return __varRecorder__$3.Color.rgb(255*(1-this.r),255*(1-this.g),255*(1-this.b));}},{key:"toCSSString",value:function toCSSString(){return this.toRGBAString();}},{key:"__serialize__",value:function __serialize__(){return{__expr__:"Color."+this.toString(),bindings:{"lively.graphics/color.js":["Color"]}};}},{key:"toJSExpr",value:function toJSExpr(){return"Color.".concat(this.name||this.toString());}},{key:"name",get:function get(){var _this3=this;var named=__varRecorder__$3.Color.named;return Object.keys(named).find(function(ea){return named[ea].equals(_this3);});}}]);return Color$1;}();exports('C',Color$1);__varRecorder__$3.Color=Color$1;Object.assign(__varRecorder__$3.Color,__varRecorder__$3.Color.named);var Gradient=/*#__PURE__*/function(){_createClass(Gradient,null,[{key:"create",value:function create(offsetAndColors){var parsedStops=[];for(var offset in offsetAndColors){parsedStops.push({offset:Number(offset),color:offsetAndColors[offset]});}return new this({stops:parsedStops});}},{key:"parse",value:function parse(str){if(str.startsWith("radial-gradient")){return __varRecorder__$3.RadialGradient.parse(str);}if(str.startsWith("linear-gradient")){return __varRecorder__$3.LinearGradient.parse(str);}return __varRecorder__$3.Color.fromTuple(__varRecorder__$3.Color.parse(str));}}]);function Gradient(stops){_classCallCheck(this,Gradient);this.stops=stops?stops.map(function(s){return s;}):[];}_createClass(Gradient,[{key:"equals",value:function equals(other){if(other&&other.isGradient){return this.toString()==other.toString();}return false;}},{key:"getStopsLighter",value:function getStopsLighter(n){return __varRecorder__$3.arr.collect(this.stops,function(ea){return{offset:ea.offset,color:ea.color.lighter(n)};});}},{key:"getStopsDarker",value:function getStopsDarker(n){return __varRecorder__$3.arr.collect(this.stops,function(ea){return{offset:ea.offset,color:ea.color.darker(n)};});}},{key:"interpolateStops",value:function interpolateStops(i,stops){var ownStops=__varRecorder__$3.pad(this.stops,stops.length),otherStops=__varRecorder__$3.pad(stops,this.stops.length),interpolatedStops=[];var idx,c1,c2,off1,off2;for(idx=0;idx<ownStops.length;idx++){var _ownStops$idx=ownStops[idx];c1=_ownStops$idx.color;off1=_ownStops$idx.offset;var _otherStops$idx=otherStops[idx];c2=_otherStops$idx.color;off2=_otherStops$idx.offset;interpolatedStops.push({color:c1.interpolate(i,c2),offset:__varRecorder__$3.num.interpolate(i,off1,off2)});}return interpolatedStops;}},{key:"__serialize__",value:function __serialize__(){return{__expr__:this.toJSExpr(),bindings:{"lively.graphics/color.js":["Color","RadialGradient","LinearGradient"],"lively.graphics/geometry-2d.js":["pt","rect"]}};}},{key:"isGradient",get:function get(){return true;}}]);return Gradient;}();__varRecorder__$3.Gradient=Gradient;var LinearGradient=/*#__PURE__*/function(_varRecorder__$3$Gra){_inherits(LinearGradient,_varRecorder__$3$Gra);var _super7=_createSuper(LinearGradient);_createClass(LinearGradient,null,[{key:"parse",value:function parse(str){var params=str.match(/\((.*)\)/)[1].split(",");}}]);function LinearGradient(){var _this4;var _ref2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},stops=_ref2.stops,vector=_ref2.vector;_classCallCheck(this,LinearGradient);_this4=_super7.call(this,stops);_this4.vector=vector;return _this4;}_createClass(LinearGradient,[{key:"angleToRect",value:function angleToRect(rad){return __varRecorder__$3.Point.polar(1,rad).extentAsRectangle().withCenter(__varRecorder__$3.pt(0.5,0.5));}},{key:"vectorAsAngle",value:function vectorAsAngle(){return this.vector.extent().theta();}},{key:"toString",value:function toString(){return this.toCSSString();}},{key:"lighter",value:function lighter(n){return new this.constructor({stops:this.getStopsLighter(n),vector:this.vector});}},{key:"darker",value:function darker(){return new this.constructor({stops:this.getStopsDarker(),vector:this.vector});}},{key:"interpolate",value:function interpolate(i,other){var target=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{width:1000,height:1000};if(other.isColor){other=new __varRecorder__$3.LinearGradient({vector:this.vector,stops:this.stops.map(function(_ref3){var offset=_ref3.offset;return{color:other,offset:offset};})});}if(other.type=="radialGradient"){if(i<0.5){return new __varRecorder__$3.LinearGradient({vector:this.vector.interpolate(i,__varRecorder__$3.rect(0,0,0,1)),stops:this.interpolateStops(i,other.stops.map(function(_ref4,i){var color=_ref4.color,offset=_ref4.offset;return{color:color,offset:1};}))});}if(i>=0.5){return new __varRecorder__$3.RadialGradient({stops:this.interpolateStops(i,other.stops),focus:__varRecorder__$3.pt(0.5,0).interpolate(i,other.focus),bounds:__varRecorder__$3.rect(0,0,target.width*100,target.height*2).interpolate(i,other.bounds)});}}return new __varRecorder__$3.LinearGradient({stops:this.interpolateStops(i,other.stops),vector:this.vector.interpolate(i,other.vector)});}},{key:"toCSSString",value:function toCSSString(){var deg=__varRecorder__$3.num.toDegrees(this.vectorAsAngle())+90,str="linear-gradient("+(deg+"deg,");str+=this.stops.map(function(s){return"".concat(s.color.toRGBAString()," ").concat((s.offset*100).toFixed()+"%");}).join(",");str+=")";return str;}},{key:"toJSExpr",value:function toJSExpr(){var stops=this.stops.map(function(ea){return"{offset: ".concat(ea.offset,", color: ").concat(ea.color.toJSExpr(),"}");}).join(", ");return"new LinearGradient({stops: [".concat(stops,"], vector: ").concat(this.vector,"})");}},{key:"type",get:function get(){return"linearGradient";}},{key:"vectors",get:function get(){return{northsouth:__varRecorder__$3.rect(__varRecorder__$3.pt(0,0),__varRecorder__$3.pt(0,1)),northeast:__varRecorder__$3.rect(__varRecorder__$3.pt(1,0),__varRecorder__$3.pt(0,1)),westeast:__varRecorder__$3.rect(__varRecorder__$3.pt(1,0),__varRecorder__$3.pt(0,0)),southeast:__varRecorder__$3.rect(__varRecorder__$3.pt(1,1),__varRecorder__$3.pt(0,0)),southnorth:__varRecorder__$3.rect(__varRecorder__$3.pt(0,1),__varRecorder__$3.pt(0,0)),southwest:__varRecorder__$3.rect(__varRecorder__$3.pt(0,1),__varRecorder__$3.pt(1,0)),eastwest:__varRecorder__$3.rect(__varRecorder__$3.pt(0,0),__varRecorder__$3.pt(1,0)),northwest:__varRecorder__$3.rect(__varRecorder__$3.pt(0,0),__varRecorder__$3.pt(1,1))};}},{key:"vector",get:function get(){return this._vector;},set:function set(value){if(!value)this._vector=this.vectors.northsouth;else if(typeof value==="string")this._vector=this.vectors[value.toLowerCase()];else if(typeof value==="number")this._vector=this.angleToRect(value);else this._vector=value;}}]);return LinearGradient;}(__varRecorder__$3.Gradient);__varRecorder__$3.LinearGradient=LinearGradient;var RadialGradient=/*#__PURE__*/function(_varRecorder__$3$Gra2){_inherits(RadialGradient,_varRecorder__$3$Gra2);var _super8=_createSuper(RadialGradient);_createClass(RadialGradient,null,[{key:"parse",value:function parse(str){var params=str.match(/\((.*)\)/)[1].split(",");}}]);function RadialGradient(){var _this5;var _ref5=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},stops=_ref5.stops,focus=_ref5.focus,bounds=_ref5.bounds;_classCallCheck(this,RadialGradient);_this5=_super8.call(this,stops);_this5.focus=focus||__varRecorder__$3.pt(0.5,0.5);_this5.bounds=bounds||new __varRecorder__$3.Rectangle(0,0,20,20);return _this5;}_createClass(RadialGradient,[{key:"toString",value:function toString(){return this.toCSSString();}},{key:"lighter",value:function lighter(n){return new this.constructor({stops:this.getStopsLighter(n),focus:this.focus,bounds:this.bounds});}},{key:"darker",value:function darker(){return new this.constructor({stops:this.getStopsDarker(),focus:this.focus,bounds:this.bounds});}},{key:"interpolate",value:function interpolate(i,other){var target=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{height:1000,width:1000};if(other.isColor){other=new __varRecorder__$3.RadialGradient({vector:this.vector,bounds:this.bounds,stops:this.stops.map(function(_ref6){var offset=_ref6.offset;return{color:other,offset:offset};})});}if(other.type=="linearGradient"){return other.interpolate(1-i,this,target);}return new __varRecorder__$3.RadialGradient({bounds:this.bounds.interpolate(i,other.bounds),stops:this.interpolateStops(i,other.stops),focus:this.focus.interpolate(i,other.focus)});}},{key:"toCSSString",value:function toCSSString(){var innerCircle=this.focus.scaleBy(100),ext=this.bounds.extent();var str="radial-gradient(".concat(ext.x/2,"px ").concat(ext.y/2,"px at ").concat(innerCircle.x,"% ").concat(innerCircle.y,"%");for(var i=0;i<this.stops.length;i++){str+=",".concat(this.stops[i].color.toRGBAString()," ").concat((this.stops[i].offset*100).toFixed()+"%");}str+=")";return str;}},{key:"toJSExpr",value:function toJSExpr(){var stops=this.stops.map(function(ea){return"{offset: ".concat(ea.offset,", color: ").concat(ea.color.toJSExpr(),"}");}).join(", ");return"new RadialGradient({stops: [".concat(stops,"], bounds: ").concat(this.bounds,", focus: ").concat(this.focus.toString(false),"})");}},{key:"type",get:function get(){return"radialGradient";}}]);return RadialGradient;}(__varRecorder__$3.Gradient);__varRecorder__$3.RadialGradient=RadialGradient;var flatDesignColors=["#1abc9c","#e8f8f5","#d1f2eb","#a3e4d7","#76d7c4","#48c9b0","#1abc9c","#17a589","#148f77","#117864","#0e6251","#16a085","#e8f6f3","#d0ece7","#a2d9ce","#73c6b6","#45b39d","#16a085","#138d75","#117a65","#0e6655","#0b5345","#2ecc71","#eafaf1","#d5f5e3","#abebc6","#82e0aa","#58d68d","#2ecc71","#28b463","#239b56","#1d8348","#186a3b","#27ae60","#e9f7ef","#d4efdf","#a9dfbf","#7dcea0","#52be80","#27ae60","#229954","#1e8449","#196f3d","#145a32","#3498db","#ebf5fb","#d6eaf8","#aed6f1","#85c1e9","#5dade2","#3498db","#2e86c1","#2874a6","#21618c","#1b4f72","#2980b9","#eaf2f8","#d4e6f1","#a9cce3","#7fb3d5","#5499c7","#2980b9","#2471a3","#1f618d","#1a5276","#154360","#9b59b6","#f5eef8","#ebdef0","#d7bde2","#c39bd3","#af7ac5","#9b59b6","#884ea0","#76448a","#633974","#512e5f","#8e44ad","#f4ecf7","#e8daef","#d2b4de","#bb8fce","#a569bd","#8e44ad","#7d3c98","#6c3483","#5b2c6f","#4a235a","#34495e","#ebedef","#d6dbdf","#aeb6bf","#85929e","#5d6d7e","#34495e","#2e4053","#283747","#212f3c","#1b2631","#2c3e50","#eaecee","#d5d8dc","#abb2b9","#808b96","#566573","#2c3e50","#273746","#212f3d","#1c2833","#17202a","#f1c40f","#fef9e7","#fcf3cf","#f9e79f","#f7dc6f","#f4d03f","#f1c40f","#d4ac0d","#b7950b","#9a7d0a","#7d6608","#f39c12","#fef5e7","#fdebd0","#fad7a0","#f8c471","#f5b041","#f39c12","#d68910","#b9770e","#9c640c","#7e5109","#e67e22","#fdf2e9","#fae5d3","#f5cba7","#f0b27a","#eb984e","#e67e22","#ca6f1e","#af601a","#935116","#784212","#d35400","#fbeee6","#f6ddcc","#edbb99","#e59866","#dc7633","#d35400","#ba4a00","#a04000","#873600","#6e2c00","#e74c3c","#fdedec","#fadbd8","#f5b7b1","#f1948a","#ec7063","#e74c3c","#cb4335","#b03a2e","#943126","#78281f","#c0392b","#f9ebea","#f2d7d5","#e6b0aa","#d98880","#cd6155","#c0392b","#a93226","#922b21","#7b241c","#641e16","#ecf0f1","#fdfefe","#fbfcfc","#f7f9f9","#f4f6f7","#f0f3f4","#ecf0f1","#d0d3d4","#b3b6b7","#979a9a","#7b7d7d","#bdc3c7","#f8f9f9","#f2f3f4","#e5e7e9","#d7dbdd","#cacfd2","#bdc3c7","#a6acaf","#909497","#797d7f","#626567","#95a5a6","#f4f6f6","#eaeded","#d5dbdb","#bfc9ca","#aab7b8","#95a5a6","#839192","#717d7e","#5f6a6a","#4d5656","#7f8c8d","#f2f4f4","#e5e8e8","#ccd1d1","#b2babb","#99a3a4","#7f8c8d","#707b7c","#616a6b","#515a5a","#424949"];__varRecorder__$3.flatDesignColors=flatDesignColors;__varRecorder__$3.flatDesignColors=flatDesignColors;__varRecorder__$3.flatDesignColors=flatDesignColors;var materialDesignColors=["#f44336","#ffebee","#ffcdd2","#ef9a9a","#e57373","#ef5350","#f44336","#e53935","#d32f2f","#c62828","#b71c1c","#ff8a80","#ff5252","#ff1744","#d50000","#e91e63","#fce4ec","#f8bbd0","#f48fb1","#f06292","#ec407a","#e91e63","#d81b60","#c2185b","#ad1457","#880e4f","#ff80ab","#ff4081","#f50057","#c51162","#9c27b0","#f3e5f5","#e1bee7","#ce93d8","#ba68c8","#ab47bc","#9c27b0","#8e24aa","#7b1fa2","#6a1b9a","#4a148c","#ea80fc","#e040fb","#d500f9","#aa00ff","#673ab7","#ede7f6","#d1c4e9","#b39ddb","#9575cd","#7e57c2","#673ab7","#5e35b1","#512da8","#4527a0","#311b92","#b388ff","#7c4dff","#651fff","#6200ea","#3f51b5","#e8eaf6","#c5cae9","#9fa8da","#7986cb","#5c6bc0","#3f51b5","#3949ab","#303f9f","#283593","#1a237e","#8c9eff","#536dfe","#3d5afe","#304ffe","#2196f3","#e3f2fd","#bbdefb","#90caf9","#64b5f6","#42a5f5","#2196f3","#1e88e5","#1976d2","#1565c0","#0d47a1","#82b1ff","#448aff","#2979ff","#2962ff","#03a9f4","#e1f5fe","#b3e5fc","#81d4fa","#4fc3f7","#29b6f6","#03a9f4","#039be5","#0288d1","#0277bd","#01579b","#80d8ff","#40c4ff","#00b0ff","#0091ea","#00bcd4","#e0f7fa","#b2ebf2","#80deea","#4dd0e1","#26c6da","#00bcd4","#00acc1","#0097a7","#00838f","#006064","#84ffff","#18ffff","#00e5ff","#00b8d4","#009688","#e0f2f1","#b2dfdb","#80cbc4","#4db6ac","#26a69a","#009688","#00897b","#00796b","#00695c","#004d40","#a7ffeb","#64ffda","#1de9b6","#00bfa5","#4caf50","#e8f5e9","#c8e6c9","#a5d6a7","#81c784","#66bb6a","#4caf50","#43a047","#388e3c","#2e7d32","#1b5e20","#b9f6ca","#69f0ae","#00e676","#00c853","#8bc34a","#f1f8e9","#dcedc8","#c5e1a5","#aed581","#9ccc65","#8bc34a","#7cb342","#689f38","#558b2f","#33691e","#ccff90","#b2ff59","#76ff03","#64dd17","#cddc39","#f9fbe7","#f0f4c3","#e6ee9c","#dce775","#d4e157","#cddc39","#c0ca33","#afb42b","#9e9d24","#827717","#f4ff81","#eeff41","#c6ff00","#aeea00","#ffeb3b","#fffde7","#fff9c4","#fff59d","#fff176","#ffee58","#ffeb3b","#fdd835","#fbc02d","#f9a825","#f57f17","#ffff8d","#ffff00","#ffea00","#ffd600","#ffc107","#fff8e1","#ffecb3","#ffe082","#ffd54f","#ffca28","#ffc107","#ffb300","#ffa000","#ff8f00","#ff6f00","#ffe57f","#ffd740","#ffc400","#ffab00","#ff9800","#fff3e0","#ffe0b2","#ffcc80","#ffb74d","#ffa726","#ff9800","#fb8c00","#f57c00","#ef6c00","#e65100","#ffd180","#ffab40","#ff9100","#ff6d00","#ff5722","#fbe9e7","#ffccbc","#ffab91","#ff8a65","#ff7043","#ff5722","#f4511e","#e64a19","#d84315","#bf360c","#ff9e80","#ff6e40","#ff3d00","#dd2c00","#795548","#efebe9","#d7ccc8","#bcaaa4","#a1887f","#8d6e63","#795548","#6d4c41","#5d4037","#4e342e","#3e2723","#9e9e9e","#fafafa","#f5f5f5","#eeeeee","#e0e0e0","#bdbdbd","#9e9e9e","#757575","#616161","#424242","#212121","#607d8b","#eceff1","#cfd8dc","#b0bec5","#90a4ae","#78909c","#607d8b","#546e7a","#455a64","#37474f","#263238","#ffffff","#000000"];__varRecorder__$3.materialDesignColors=materialDesignColors;__varRecorder__$3.materialDesignColors=materialDesignColors;__varRecorder__$3.materialDesignColors=materialDesignColors;var webSafeColors=["ccff00","ccff33","ccff66","ccff99","ccffcc","ccffff","ffffff","ffffcc","ffff99","ffff66","ffff33","ffff00","cccc00","cccc33","cccc66","cccc99","cccccc","ccccff","ffccff","ffcccc","ffcc99","ffcc66","ffcc33","ffcc00","cc9900","cc9933","cc9966","cc9999","cc99cc","cc99ff","ff99ff","ff99cc","ff9999","ff9966","ff9933","ff9900","cc6600","cc6633","cc6666","cc6699","cc66cc","cc66ff","ff66ff","ff66cc","ff6699","ff6666","ff6633","ff6600","cc3300","cc3333","cc3366","cc3399","cc33cc","cc33ff","ff33ff","ff33cc","ff3399","ff3366","ff3333","ff3300","cc0000","cc0033","cc0066","cc0099","cc00cc","cc00ff","ff00ff","ff00cc","ff0099","ff0066","ff0033","ff0000","660000","660033","660066","660099","6600cc","6600ff","9900ff","9900cc","990099","990066","990033","990000","663300","663333","663366","663399","6633cc","6633ff","9933ff","9933cc","993399","993366","993333","993300","666600","666633","666666","666699","6666cc","6666ff","9966ff","9966cc","996699","996666","996633","996600","669900","669933","669966","669999","6699cc","6699ff","9999ff","9999cc","999999","999966","999933","999900","66cc00","66cc33","66cc66","66cc99","66cccc","66ccff","99ccff","99cccc","99cc99","99cc66","99cc33","99cc00","66ff00","66ff33","66ff66","66ff99","66ffcc","66ffff","99ffff","99ffcc","99ff99","99ff66","99ff33","99ff00","00ff00","00ff33","00ff66","00ff99","00ffcc","00ffff","33ffff","33ffcc","33ff99","33ff66","33ff33","33ff00","00cc00","00cc33","00cc66","00cc99","00cccc","00ccff","33ccff","33cccc","33cc99","33cc66","33cc33","33cc00","009900","009933","009966","009999","0099cc","0099ff","3399ff","3399cc","339999","339966","339933","339900","006600","006633","006666","006699","0066cc","0066ff","3366ff","3366cc","336699","336666","336633","336600","003300","003333","003366","003399","0033cc","0033ff","3333ff","3333cc","333399","333366","333333","333300","000000","000033","000066","000099","0000cc","0000ff","3300ff","3300cc","330099","330066","330033","330000"];__varRecorder__$3.webSafeColors=webSafeColors;__varRecorder__$3.webSafeColors=webSafeColors;__varRecorder__$3.webSafeColors=webSafeColors;var __captured1__=/*#__PURE__*/Object.freeze({__proto__:null,Complementary:Complementary,Triadic:Triadic,Tetradic:Tetradic,Quadratic:Quadratic,Analogous:Analogous,Neutral:Neutral,Color:Color$1,LinearGradient:LinearGradient,RadialGradient:RadialGradient,flatDesignColors:flatDesignColors,materialDesignColors:materialDesignColors,webSafeColors:webSafeColors});var __varRecorder__$4=lively.FreezerRuntime.recorderFor("lively.graphics/index.js");Object.assign(__varRecorder__$4,__captured1__);Object.assign(__varRecorder__$4,__captured2__);var _global=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$1={};/*!
       * Bowser - a browser detector
       * https://github.com/ded/bowser
       * MIT License | (c) Dustin Diaz 2015
       */!function(name,definition){if(exports$1)exports$1=definition();else(this||_global)[name]=definition();}("bowser",function(){/**
          * See useragents.js for examples of navigator.userAgent
          */var t=true;function detect(ua){function getFirstMatch(regex){var match=ua.match(regex);return match&&match.length>1&&match[1]||"";}function getSecondMatch(regex){var match=ua.match(regex);return match&&match.length>1&&match[2]||"";}var iosdevice=getFirstMatch(/(ipod|iphone|ipad)/i).toLowerCase(),likeAndroid=/like android/i.test(ua),android=!likeAndroid&&/android/i.test(ua),nexusMobile=/nexus\s*[0-6]\s*/i.test(ua),nexusTablet=!nexusMobile&&/nexus\s*[0-9]+/i.test(ua),chromeos=/CrOS/.test(ua),silk=/silk/i.test(ua),sailfish=/sailfish/i.test(ua),tizen=/tizen/i.test(ua),webos=/(web|hpw)os/i.test(ua),windowsphone=/windows phone/i.test(ua),windows=!windowsphone&&/windows/i.test(ua),mac=!iosdevice&&!silk&&/macintosh/i.test(ua),linux=!android&&!sailfish&&!tizen&&!webos&&/linux/i.test(ua),edgeVersion=getFirstMatch(/edge\/(\d+(\.\d+)?)/i),versionIdentifier=getFirstMatch(/version\/(\d+(\.\d+)?)/i),tablet=/tablet/i.test(ua),mobile=!tablet&&/[^-]mobi/i.test(ua),xbox=/xbox/i.test(ua),result;if(/opera|opr|opios/i.test(ua)){result={name:"Opera",opera:t,version:versionIdentifier||getFirstMatch(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)};}else if(/coast/i.test(ua)){result={name:"Opera Coast",coast:t,version:versionIdentifier||getFirstMatch(/(?:coast)[\s\/](\d+(\.\d+)?)/i)};}else if(/yabrowser/i.test(ua)){result={name:"Yandex Browser",yandexbrowser:t,version:versionIdentifier||getFirstMatch(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)};}else if(/ucbrowser/i.test(ua)){result={name:"UC Browser",ucbrowser:t,version:getFirstMatch(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)};}else if(/mxios/i.test(ua)){result={name:"Maxthon",maxthon:t,version:getFirstMatch(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)};}else if(/epiphany/i.test(ua)){result={name:"Epiphany",epiphany:t,version:getFirstMatch(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)};}else if(/puffin/i.test(ua)){result={name:"Puffin",puffin:t,version:getFirstMatch(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)};}else if(/sleipnir/i.test(ua)){result={name:"Sleipnir",sleipnir:t,version:getFirstMatch(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)};}else if(/k-meleon/i.test(ua)){result={name:"K-Meleon",kMeleon:t,version:getFirstMatch(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)};}else if(windowsphone){result={name:"Windows Phone",windowsphone:t};if(edgeVersion){result.msedge=t;result.version=edgeVersion;}else{result.msie=t;result.version=getFirstMatch(/iemobile\/(\d+(\.\d+)?)/i);}}else if(/msie|trident/i.test(ua)){result={name:"Internet Explorer",msie:t,version:getFirstMatch(/(?:msie |rv:)(\d+(\.\d+)?)/i)};}else if(chromeos){result={name:"Chrome",chromeos:t,chromeBook:t,chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)};}else if(/chrome.+? edge/i.test(ua)){result={name:"Microsoft Edge",msedge:t,version:edgeVersion};}else if(/vivaldi/i.test(ua)){result={name:"Vivaldi",vivaldi:t,version:getFirstMatch(/vivaldi\/(\d+(\.\d+)?)/i)||versionIdentifier};}else if(sailfish){result={name:"Sailfish",sailfish:t,version:getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i)};}else if(/seamonkey\//i.test(ua)){result={name:"SeaMonkey",seamonkey:t,version:getFirstMatch(/seamonkey\/(\d+(\.\d+)?)/i)};}else if(/firefox|iceweasel|fxios/i.test(ua)){result={name:"Firefox",firefox:t,version:getFirstMatch(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)};if(/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(ua)){result.firefoxos=t;}}else if(silk){result={name:"Amazon Silk",silk:t,version:getFirstMatch(/silk\/(\d+(\.\d+)?)/i)};}else if(/phantom/i.test(ua)){result={name:"PhantomJS",phantom:t,version:getFirstMatch(/phantomjs\/(\d+(\.\d+)?)/i)};}else if(/slimerjs/i.test(ua)){result={name:"SlimerJS",slimer:t,version:getFirstMatch(/slimerjs\/(\d+(\.\d+)?)/i)};}else if(/blackberry|\bbb\d+/i.test(ua)||/rim\stablet/i.test(ua)){result={name:"BlackBerry",blackberry:t,version:versionIdentifier||getFirstMatch(/blackberry[\d]+\/(\d+(\.\d+)?)/i)};}else if(webos){result={name:"WebOS",webos:t,version:versionIdentifier||getFirstMatch(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)};/touchpad\//i.test(ua)&&(result.touchpad=t);}else if(/bada/i.test(ua)){result={name:"Bada",bada:t,version:getFirstMatch(/dolfin\/(\d+(\.\d+)?)/i)};}else if(tizen){result={name:"Tizen",tizen:t,version:getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||versionIdentifier};}else if(/qupzilla/i.test(ua)){result={name:"QupZilla",qupzilla:t,version:getFirstMatch(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||versionIdentifier};}else if(/chromium/i.test(ua)){result={name:"Chromium",chromium:t,version:getFirstMatch(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||versionIdentifier};}else if(/chrome|crios|crmo/i.test(ua)){result={name:"Chrome",chrome:t,version:getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)};}else if(android){result={name:"Android",version:versionIdentifier};}else if(/safari|applewebkit/i.test(ua)){result={name:"Safari",safari:t};if(versionIdentifier){result.version=versionIdentifier;}}else if(iosdevice){result={name:iosdevice=="iphone"?"iPhone":iosdevice=="ipad"?"iPad":"iPod"};// WTF: version is not part of user agent in web apps
if(versionIdentifier){result.version=versionIdentifier;}}else if(/googlebot/i.test(ua)){result={name:"Googlebot",googlebot:t,version:getFirstMatch(/googlebot\/(\d+(\.\d+))/i)||versionIdentifier};}else{result={name:getFirstMatch(/^(.*)\/(.*) /),version:getSecondMatch(/^(.*)\/(.*) /)};}// set webkit or gecko flag for browsers based on these engines
if(!result.msedge&&/(apple)?webkit/i.test(ua)){if(/(apple)?webkit\/537\.36/i.test(ua)){result.name=result.name||"Blink";result.blink=t;}else{result.name=result.name||"Webkit";result.webkit=t;}if(!result.version&&versionIdentifier){result.version=versionIdentifier;}}else if(!result.opera&&/gecko\//i.test(ua)){result.name=result.name||"Gecko";result.gecko=t;result.version=result.version||getFirstMatch(/gecko\/(\d+(\.\d+)?)/i);}// set OS flags for platforms that have multiple browsers
if(!result.msedge&&(android||result.silk)){result.android=t;}else if(iosdevice){result[iosdevice]=t;result.ios=t;}else if(mac){result.mac=t;}else if(xbox){result.xbox=t;}else if(windows){result.windows=t;}else if(linux){result.linux=t;}// OS version extraction
var osVersion="";if(result.windowsphone){osVersion=getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i);}else if(iosdevice){osVersion=getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i);osVersion=osVersion.replace(/[_\s]/g,".");}else if(android){osVersion=getFirstMatch(/android[ \/-](\d+(\.\d+)*)/i);}else if(result.webos){osVersion=getFirstMatch(/(?:web|hpw)os\/(\d+(\.\d+)*)/i);}else if(result.blackberry){osVersion=getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i);}else if(result.bada){osVersion=getFirstMatch(/bada\/(\d+(\.\d+)*)/i);}else if(result.tizen){osVersion=getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i);}if(osVersion){result.osversion=osVersion;}// device type extraction
var osMajorVersion=osVersion.split(".")[0];if(tablet||nexusTablet||iosdevice=="ipad"||android&&(osMajorVersion==3||osMajorVersion>=4&&!mobile)||result.silk){result.tablet=t;}else if(mobile||iosdevice=="iphone"||iosdevice=="ipod"||android||nexusMobile||result.blackberry||result.webos||result.bada){result.mobile=t;}// Graded Browser Support
// http://developer.yahoo.com/yui/articles/gbs
if(result.msedge||result.msie&&result.version>=10||result.yandexbrowser&&result.version>=15||result.vivaldi&&result.version>=1||result.chrome&&result.version>=20||result.firefox&&result.version>=20||result.safari&&result.version>=6||result.opera&&result.version>=10||result.ios&&result.osversion&&result.osversion.split(".")[0]>=6||result.blackberry&&result.version>=10.1||result.chromium&&result.version>=20){result.a=t;}else if(result.msie&&result.version<10||result.chrome&&result.version<20||result.firefox&&result.version<20||result.safari&&result.version<6||result.opera&&result.version<10||result.ios&&result.osversion&&result.osversion.split(".")[0]<6||result.chromium&&result.version<20){result.c=t;}else result.x=t;return result;}var bowser=detect(typeof navigator!=="undefined"?navigator.userAgent:"");bowser.test=function(browserList){for(var i=0;i<browserList.length;++i){var browserItem=browserList[i];if(typeof browserItem==="string"){if(browserItem in bowser){return true;}}}return false;};/**
         * Get version precisions count
         *
         * @example
         *   getVersionPrecision("1.10.3") // 3
         *
         * @param  {string} version
         * @return {number}
         */function getVersionPrecision(version){return version.split(".").length;}/**
         * Array::map polyfill
         *
         * @param  {Array} arr
         * @param  {Function} iterator
         * @return {Array}
         */function map(arr,iterator){var result=[],i;if(Array.prototype.map){return Array.prototype.map.call(arr,iterator);}for(i=0;i<arr.length;i++){result=iterator(arr[i]);}return result;}/**
         * Calculate browser version weight
         *
         * @example
         *   compareVersions(['1.10.2.1',  '1.8.2.1.90'])    // 1
         *   compareVersions(['1.010.2.1', '1.09.2.1.90']);  // 1
         *   compareVersions(['1.10.2.1',  '1.10.2.1']);     // 0
         *   compareVersions(['1.10.2.1',  '1.0800.2']);     // -1
         *
         * @param  {Array<String>} versions versions to compare
         * @return {Number} comparison result
         */function compareVersions(versions){// 1) get common precision for both versions, for example for "10.0" and "9" it should be 2
var precision=Math.max(getVersionPrecision(versions[0]),getVersionPrecision(versions[1]));var chunks=map(versions,function(version){var delta=precision-getVersionPrecision(version);// 2) "9" -> "9.0" (for precision = 2)
version=version+new Array(delta+1).join(".0");// 3) "9.0" -> ["000000000"", "000000009"]
return map(version.split("."),function(chunk){return new Array(20-chunk.length).join("0")+chunk;}).reverse();});// iterate in reverse order by reversed chunks array
while(--precision>=0){// 4) compare: "000000009" > "000000010" = false (but "9" > "10" = true)
if(chunks[0][precision]>chunks[1][precision]){return 1;}else if(chunks[0][precision]===chunks[1][precision]){if(precision===0){// all version chunks are same
return 0;}}else{return-1;}}}/**
         * Check if browser is unsupported
         *
         * @example
         *   bowser.isUnsupportedBrowser({
         *     msie: "10",
         *     firefox: "23",
         *     chrome: "29",
         *     safari: "5.1",
         *     opera: "16",
         *     phantom: "534"
         *   });
         *
         * @param  {Object}  minVersions map of minimal version to browser
         * @param  {Boolean} [strictMode = false] flag to return false if browser wasn't found in map
         * @param  {String}  [ua] user agent string
         * @return {Boolean}
         */function isUnsupportedBrowser(minVersions,strictMode,ua){var _bowser=bowser;// make strictMode param optional with ua param usage
if(typeof strictMode==="string"){ua=strictMode;strictMode=void 0;}if(strictMode===void 0){strictMode=false;}if(ua){_bowser=detect(ua);}var version=""+_bowser.version;for(var browser in minVersions){if(minVersions.hasOwnProperty(browser)){if(_bowser[browser]){// browser version and min supported version.
return compareVersions([version,minVersions[browser]])<0;}}}return strictMode;// not found
}/**
         * Check if browser is supported
         *
         * @param  {Object} minVersions map of minimal version to browser
         * @param  {Boolean} [strictMode = false] flag to return false if browser wasn't found in map
         * @param  {String}  [ua] user agent string
         * @return {Boolean}
         */function check(minVersions,strictMode,ua){return!isUnsupportedBrowser(minVersions,strictMode,ua);}bowser.isUnsupportedBrowser=isUnsupportedBrowser;bowser.compareVersions=compareVersions;bowser.check=check;/*
         * Set our detect method to the main bowser object so we can
         * reuse it to test other user agents.
         * This is needed to implement future tests.
         */bowser._detect=detect;return bowser;});var exports$1$1=exports('d',exports$1);var __varRecorder__$5=lively.FreezerRuntime.recorderFor("lively.morphic/config.js");function parseURLQuery(){if(typeof document==="undefined"||!document.location)return{};var search=(document.location.hash||document.location.search).slice(1);var args=search&&search.split("&");var options={};if(args){for(var _i47=0;_i47<args.length;_i47++){var keyAndVal=args[_i47].split("=");var key=keyAndVal[0];var val=true;if(keyAndVal.length>1){val=decodeURIComponent(keyAndVal.slice(1).join("="));if(val.match(/^(true|false|null|[0-9"[{].*)$/)){try{val=JSON.parse(val);}catch(e){if(val[0]==="[")val=val.slice(1,-1).split(",");}}}options[key]=val;}}return options;}__varRecorder__$5.parseURLQuery=parseURLQuery;__varRecorder__$5.Rectangle=Rectangle;__varRecorder__$5.Color=Color$1;__varRecorder__$5.bowser=exports$1$1;__varRecorder__$5.isMac=!!__varRecorder__$5.bowser.mac;if(typeof $world!=="undefined"){$world.withAllSubmorphsDo(function(ea){return ea.hasOwnProperty("_cachedKeyhandlers")&&(ea._cachedKeyhandlers=null);});}__varRecorder__$5.config={onloadURLQuery:__varRecorder__$5.parseURLQuery(),defaultShadow:{fast:true,distance:18,blur:30,color:__varRecorder__$5.Color.black.withA(0.2),spread:0},undoLevels:20,halosEnabled:true,altClickDefinesThat:true,verboseLogging:true,maxStatusMessages:5,repeatClickInterval:250,longClick:{minDur:500,maxDur:1000,maxDist:2},showTooltipsAfter:0.8,users:{authServerURL:"https://auth.lively-next.org",autoLoginAsGuest:false},ide:{workerEnabled:false,js:{ignoredPackages:["lively.web","no group",function(url){return url.includes("lively.morphic/objectdb")||url.includes("lively.next-node_modules")||url.includes("node_modules")||url.includes("custom-npm-modules")||url.includes("mocha-es6")||url.includes("test-resources/es6");}]},modes:{aliases:{text:"text",sh:"shell",markdown:"md",javascript:"js",htmlmixed:"html",haskell:"hs",python:"py"}}},globalKeyBindings:[{keys:{mac:"Meta-Z",win:"Ctrl-Z"},command:"undo"},{keys:{mac:"Meta-Shift-Z",win:"Ctrl-Shift-Z"},command:"redo"},{keys:"Alt-X",command:"run command"},{keys:{mac:"Meta-S",win:"Ctrl-S"},command:"save world"},{keys:"Meta-Shift-L s a v e",command:"save this world"},{keys:"Meta-H",command:"show halo for focused morph"},{keys:"Meta-Shift-L C O P Y",command:"copy morph"},{keys:"Alt-M",command:"select morph"},{keys:"Escape",command:"escape"},{keys:{win:"Ctrl-Escape",mac:"Meta-Escape"},command:"close active window or morph"},{keys:"Alt-Shift-C",command:"toggle minimize active window"},{keys:{mac:"Meta-Shift-L W S",win:"Ctrl-Shift-L W S"},command:"search workspaces"},{keys:{mac:"Meta-O",win:"Ctrl-O"},command:"open status message of focused morph"},{keys:{win:"Ctrl-K",mac:"Meta-K"},command:{command:"open javascript workspace",onlyWhenFocused:false}},{keys:"Alt-Shift-1",command:{command:"open shell terminal",onlyWhenFocused:false}},{keys:{win:"Ctrl-B",mac:"Meta-B"},command:{command:"open browser",onlyWhenFocused:false}},{keys:{win:"Ctrl-P",mac:"Meta-P"},command:{command:"open PartsBin",onlyWhenFocused:true}},{keys:"Alt-T",command:{command:"choose and browse module",onlyWhenFocused:false}},{keys:"Alt-Shift-T",command:{command:"choose and browse package resources",onlyWhenFocused:false}},{keys:{mac:"Ctrl-X D"},command:"open file browser"},{keys:{mac:"Ctrl-X Ctrl-F"},command:"open file"},{keys:{win:"Ctrl-Shift-F",mac:"Meta-Shift-F"},command:{command:"open code search",onlyWhenFocused:false}},{keys:"Left",command:{command:"move or resize halo target",args:{what:"move",direction:"left",offset:1}}},{keys:"Right",command:{command:"move or resize halo target",args:{what:"move",direction:"right",offset:1}}},{keys:"Up",command:{command:"move or resize halo target",args:{what:"move",direction:"up",offset:1}}},{keys:"Down",command:{command:"move or resize halo target",args:{what:"move",direction:"down",offset:1}}},{keys:"Meta-Left",command:{command:"move or resize halo target",args:{what:"move",direction:"left",offset:10}}},{keys:"Meta-Right",command:{command:"move or resize halo target",args:{what:"move",direction:"right",offset:10}}},{keys:"Meta-Up",command:{command:"move or resize halo target",args:{what:"move",direction:"up",offset:10}}},{keys:"Meta-Down",command:{command:"move or resize halo target",args:{what:"move",direction:"down",offset:10}}},{keys:"Alt-Left",command:{command:"move or resize halo target",args:{what:"move",direction:"left",offset:100}}},{keys:"Alt-Right",command:{command:"move or resize halo target",args:{what:"move",direction:"right",offset:100}}},{keys:"Alt-Up",command:{command:"move or resize halo target",args:{what:"move",direction:"up",offset:100}}},{keys:"Alt-Down",command:{command:"move or resize halo target",args:{what:"move",direction:"down",offset:100}}},{keys:"Shift-Left",command:{command:"move or resize halo target",args:{what:"resize",direction:"left",offset:1}}},{keys:"Shift-Right",command:{command:"move or resize halo target",args:{what:"resize",direction:"right",offset:1}}},{keys:"Shift-Up",command:{command:"move or resize halo target",args:{what:"resize",direction:"up",offset:1}}},{keys:"Shift-Down",command:{command:"move or resize halo target",args:{what:"resize",direction:"down",offset:1}}},{keys:"Meta-Shift-Left",command:{command:"move or resize halo target",args:{what:"resize",direction:"left",offset:10}}},{keys:"Meta-Shift-Right",command:{command:"move or resize halo target",args:{what:"resize",direction:"right",offset:10}}},{keys:"Meta-Shift-Up",command:{command:"move or resize halo target",args:{what:"resize",direction:"up",offset:10}}},{keys:"Meta-Shift-Down",command:{command:"move or resize halo target",args:{what:"resize",direction:"down",offset:10}}},{keys:"Alt-Shift-Left",command:{command:"move or resize halo target",args:{what:"resize",direction:"left",offset:100}}},{keys:"Alt-Shift-Right",command:{command:"move or resize halo target",args:{what:"resize",direction:"right",offset:100}}},{keys:"Alt-Shift-Up",command:{command:"move or resize halo target",args:{what:"resize",direction:"up",offset:100}}},{keys:"Alt-Shift-Down",command:{command:"move or resize halo target",args:{what:"resize",direction:"down",offset:100}}},{keys:{win:"Delete",mac:"Delete|Ctrl-D"},command:"close halo target"},{keys:{win:"Ctrl-`|Alt-`",mac:"Meta-1"},command:"window switcher"},{keys:{mac:"Meta-Shift-L R E S 1",win:"Ctrl-Shift-L R E S 1"},command:{command:"resize active window",args:{how:"col1"}}},{keys:{mac:"Meta-Shift-L R E S 2",win:"Ctrl-Shift-L R E S 2"},command:{command:"resize active window",args:{how:"col2"}}},{keys:{mac:"Meta-Shift-L R E S 3",win:"Ctrl-Shift-L R E S 3"},command:{command:"resize active window",args:{how:"col3"}}},{keys:{mac:"Meta-Shift-L R E S C",win:"Ctrl-Shift-L R E S C"},command:{command:"resize active window",args:{how:"center"}}},{keys:{mac:"Meta-Shift-L R E S L",win:"Ctrl-Shift-L R E S L"},command:{command:"resize active window",args:{how:"left"}}},{keys:{mac:"Meta-Shift-L R E S R",win:"Ctrl-Shift-L R E S R"},command:{command:"resize active window",args:{how:"right"}}},{keys:{mac:"Meta-Shift-L R E S F",win:"Ctrl-Shift-L R E S F"},command:{command:"resize active window",args:{how:"full"}}},{keys:{mac:"Meta-Shift-L R E S T",win:"Ctrl-Shift-L R E S T"},command:{command:"resize active window",args:{how:"top"}}},{keys:{mac:"Meta-Shift-L R E S B",win:"Ctrl-Shift-L R E S B"},command:{command:"resize active window",args:{how:"bottom"}}},{keys:{mac:"Meta-Shift-L R E S Escape",win:"Ctrl-Shift-L R E S Escape"},command:{command:"resize active window",args:{how:"reset"}}}],text:{basicFontItems:["Sans-serif","serif","Monospace","Arial Black","Arial Narrow","Comic Sans MS","Garamond","Tahoma","Trebuchet MS","Verdana","custom..."],cursorBlinkPeriod:0.5,useSoftTabs:true,tabWidth:2,markStackSize:16,undoLevels:50,clipboardBufferLength:100,useMultiSelect:true,undoGroupDelay:600,defaultKeyBindings:[{keys:{win:"Ctrl-C",mac:"Meta-C"},command:{command:"clipboard copy",passEvent:true}},{keys:"Ctrl-W",command:{command:"manual clipboard copy",args:{"delete":true}}},{keys:"Alt-W",command:"manual clipboard copy"},{keys:"Ctrl-Y",command:"manual clipboard paste"},{keys:"Alt-Y",command:{command:"manual clipboard paste",args:{killRingCycleBack:true}}},{keys:{win:"Ctrl-X",mac:"Meta-X"},command:{command:"clipboard cut",passEvent:true}},{keys:{win:"Ctrl-V",mac:"Meta-V"},command:{command:"clipboard paste",passEvent:true}},{keys:{win:"Ctrl-Z|Ctrl-Shift--",mac:"Meta-Z|Ctrl-Shift--|Ctrl-x u"},command:"text undo"},{keys:{win:"Ctrl-Shift-Z",mac:"Meta-Shift-Z"},command:"text redo"},{keys:{win:"Ctrl-A|Ctrl-X H",mac:"Meta-A|Ctrl-X H"},command:"select all"},{keys:{win:"Alt-Enter",mac:"Meta-D|Alt-Enter"},command:"doit"},{keys:{mac:"Meta-Shift-L X B"},command:"eval all"},{keys:{win:"Alt-Ctrl-Enter",mac:"Meta-P"},command:"printit"},{keys:{win:"Alt-Ctrl-Shift-Enter",mac:"Meta-I"},command:"print inspectit"},{keys:{win:"Ctrl-Shift-I",mac:"Meta-Shift-I"},command:"inspectit"},{keys:{win:"Ctrl-Shift-E",mac:"Meta-Shift-E"},command:"editit"},{keys:{win:"Ctrl-Shift-U",mac:"Meta-Shift-U"},command:"undefine variable"},{keys:"Backspace",command:"delete backwards"},{keys:{win:"Delete",mac:"Delete|Ctrl-D"},command:"delete"},{keys:{win:"Left|Ctrl-B",mac:"Left|Ctrl-B"},command:"go left"},{keys:{win:"Right|Ctrl-F",mac:"Right|Ctrl-F"},command:"go right"},{keys:{win:"Up|Ctrl-P",mac:"Up|Ctrl-P"},command:"go up"},{keys:{win:"Down|Ctrl-N",mac:"Down|Ctrl-N"},command:"go down"},{keys:"Shift-Left",command:"select left"},{keys:"Shift-Right",command:"select right"},{keys:"Shift-Up",command:"select up"},{keys:"Shift-Down",command:"select down"},{keys:{win:"Ctrl-Right",mac:"Alt-Right|Alt-F"},command:"goto word right"},{keys:{win:"Ctrl-Left",mac:"Alt-Left|Alt-B"},command:"goto word left"},{keys:{win:"Ctrl-Shift-Right",mac:"Alt-Shift-Right|Alt-Shift-F"},command:{command:"goto word right",args:{select:true}}},{keys:{win:"Ctrl-Shift-Left",mac:"Alt-Shift-Left|Alt-Shift-B"},command:{command:"goto word left",args:{select:true}}},{keys:{win:"Ctrl-Backspace",mac:"Alt-Backspace"},command:"delete word left"},{keys:"Alt-D",command:"delete word right"},{keys:{win:"Alt-Ctrl-K",mac:"Alt-Ctrl-K"},command:"delete word right"},{keys:"Alt-Shift-2",command:"select word right"},{keys:"Ctrl-X Ctrl-X",command:"reverse selection"},{keys:{win:"Ctrl-Shift-L",mac:"Meta-L"},command:"select line"},{keys:{win:"Shift-Home",mac:"Shift-Home|Ctrl-Shift-A"},command:{command:"goto line start",args:{select:true}}},{keys:{win:"Home",mac:"Home|Ctrl-A"},command:{command:"goto line start",args:{select:false}}},{keys:{win:"Shift-End",mac:"Shift-End|Ctrl-Shift-E"},command:{command:"goto line end",args:{select:true}}},{keys:{win:"End",mac:"End|Ctrl-E"},command:{command:"goto line end",args:{select:false}}},{keys:"Ctrl-C J",command:{command:"join line",args:{withLine:"before"}}},{keys:"Ctrl-C Shift-J",command:{command:"join line",args:{withLine:"after"}}},{keys:{win:"Ctrl-Shift-D",mac:"Meta-Shift-D|Ctrl-C P"},command:"duplicate line or selection"},{keys:{win:"Ctrl-Shift-Backspace",mac:"Meta-Backspace"},command:"delete left until beginning of line"},{keys:"Ctrl-K",command:"delete emtpy line or until end of line"},{keys:{win:"Ctrl-Alt-Up|Ctrl-Alt-P",mac:"Ctrl-Meta-Up|Ctrl-Meta-P"},command:"move lines up"},{keys:{win:"Ctrl-Alt-Down|Ctrl-Alt-N",mac:"Ctrl-Meta-Down|Ctrl-Meta-N"},command:"move lines down"},{keys:{win:"PageDown",mac:"PageDown|Ctrl-V"},command:"goto page down"},{keys:{win:"PageUp",mac:"PageUp|Alt-V"},command:"goto page up"},{keys:{win:"Shift-PageDown",mac:"Shift-PageDown"},command:"goto page down and select"},{keys:{win:"Shift-PageUp",mac:"Shift-PageUp"},command:"goto page up and select"},{keys:"Alt-Ctrl-,",command:"move cursor to screen top in 1/3 steps"},{keys:"Alt-Ctrl-.",command:"move cursor to screen bottom in 1/3 steps"},{keys:{win:"Alt-Left",mac:"Meta-Left"},command:"goto matching left"},{keys:{win:"Alt-Shift-Left",mac:"Meta-Shift-Left"},command:{command:"goto matching left",args:{select:true}}},{keys:{win:"Alt-Right",mac:"Meta-Right"},command:"goto matching right"},{keys:{win:"Alt-Shift-Right",mac:"Meta-Shift-Right"},command:{command:"goto matching right",args:{select:true}}},{keys:"Alt-Ctrl-B",command:"goto matching left"},{keys:"Alt-Ctrl-F",command:"goto matching right"},{keys:"Ctrl-Up",command:"goto paragraph above"},{keys:"Ctrl-Down",command:"goto paragraph below"},{keys:{win:"Ctrl-Shift-Home",mac:"Meta-Shift-Up"},command:{command:"goto start",args:{select:true}}},{keys:{win:"Ctrl-Shift-End",mac:"Meta-Shift-Down"},command:{command:"goto end",args:{select:true}}},{keys:{win:"Ctrl-Home",mac:"Meta-Up|Meta-Home|Alt-Shift-,"},command:"goto start"},{keys:{win:"Ctrl-End",mac:"Meta-Down|Meta-End|Alt-Shift-."},command:"goto end"},{keys:"Ctrl-L",command:"realign top-bottom-center"},{keys:{win:"Ctrl-Shift-L",mac:"Ctrl-Shift-L|Alt-G G"},command:"goto line"},{keys:"Enter",command:"newline"},{keys:"Space",command:{command:"insertstring",args:{string:" ",undoGroup:true}}},{keys:"Tab",command:{command:"tab - snippet expand or indent"}},{keys:{win:"Ctrl-]",mac:"Meta-]"},command:"indent"},{keys:{win:"Ctrl-[",mac:"Meta-["},command:"outdent"},{keys:{win:"Ctrl-Enter",mac:"Meta-Enter"},command:{command:"insert line",args:{where:"below"}}},{keys:"Shift-Enter",command:{command:"insert line",args:{where:"above"}}},{keys:"Ctrl-O",command:"split line"},{keys:{mac:"Ctrl-X Ctrl-T"},command:"transpose chars"},{keys:{mac:"Ctrl-C Ctrl-U"},command:"uppercase"},{keys:{mac:"Ctrl-C Ctrl-L"},command:"lowercase"},{keys:{mac:"Meta-Shift-L W t"},command:"remove trailing whitespace"},{keys:{mac:"Ctrl-Space"},command:"toggle active mark"},{keys:{mac:"Meta-Shift-L M O D E"},command:"change editor mode"},{keys:{mac:"Meta-Shift-L L T"},command:"toggle line wrapping"},{keys:"Esc|Ctrl-G",command:"cancel input"},{keys:{win:"Ctrl-/",mac:"Meta-/"},command:"toggle comment"},{keys:{win:"Alt-Ctrl-/",mac:"Alt-Meta-/|Alt-Meta-\xF7"},command:"toggle block comment"},{keys:"Meta-Shift-L /  D",command:"comment box"},{keys:{win:"Ctrl-.",mac:"Meta-."},command:"[IyGotoChar] activate"},{keys:{win:"Ctrl-,",mac:"Meta-,"},command:{command:"[IyGotoChar] activate",args:{backwards:true}}},{keys:{win:"Ctrl-Space|Ctrl-Shift-P",mac:"Alt-Shift-Space|Alt-Space|Meta-Shift-P"},command:"text completion"},{keys:"\xF7|Alt-/",command:"text completion first match"},{keys:"Alt-Q",command:"fit text to column"},{keys:{win:"Ctrl-F|Ctrl-G|F3",mac:"Meta-F|Meta-G|Ctrl-S"},command:"search in text"},{keys:{win:"Ctrl-Shift-F|Ctrl-Shift-G",mac:"Meta-Shift-F|Meta-Shift-G|Ctrl-R"},command:{command:"search in text",args:{backwards:true}}},{keys:"Ctrl-Shift-/|Ctrl-C Ctrl-Shift-,",command:"[multi select] all like this"},{keys:"Alt-Ctrl-P",command:"[multi select] add cursor above"},{keys:"Alt-Ctrl-N",command:"[multi select] add cursor below"},{keys:"Ctrl-Shift-,",command:"[multi select] more like this backward"},{keys:"Ctrl-Shift-.",command:"[multi select] more like this forward"},{keys:{mac:"Meta-Shift-,"},command:"[multi select] goto previous focused cursor"},{keys:{mac:"Meta-Shift-."},command:"[multi select] goto next focused cursor"},{keys:"Ctrl-Shift-;",command:"[multi select] remove focused cursor"},{keys:"Alt-Ctrl-A",command:"[multi select] align cursors"},{keys:"Ctrl-X R",command:"[multi select] create rectangular selection"},{keys:{win:"Shift-Ctrl-S|Ctrl-Alt-Space",mac:"Ctrl-Command-space|Ctrl-Alt-Space"},command:"contractRegion"},{keys:{win:"Shift-Ctrl-E|Ctrl-Shift-Space",mac:"Shift-Command-Space|Ctrl-Shift-Space"},command:"expandRegion"},{keys:"Ctrl-Alt-h",command:"markDefun"},{keys:"Ctrl-Alt-d|Ctrl-Alt-Down",command:"forwardDownSexp"},{keys:"Ctrl-Alt-u|Ctrl-Alt-Up",command:"backwardUpSexp"},{keys:"Ctrl-Alt-b|Ctrl-Alt-Left",command:"backwardSexp"},{keys:"Ctrl-Alt-f|Ctrl-Alt-Right",command:"forwardSexp"},{keys:"Alt-.",command:"selectDefinition"},{keys:"Ctrl-Shift-'",command:"selectSymbolReferenceOrDeclaration"},{keys:"Ctrl-Shift-[",command:"selectSymbolReferenceOrDeclarationPrev"},{keys:"Ctrl-Shift-]",command:"selectSymbolReferenceOrDeclarationNext"},{keys:{win:"Ctrl-=",mac:"Meta-="},command:"increase font size"},{keys:{win:"Ctrl--",mac:"Meta--"},command:"decrease font size"},{keys:"Alt-K",command:"set link of selection"},{keys:"Alt-O",command:"set doit of selection"},{keys:{win:"Ctrl-\\",mac:"Meta-\\"},command:"reset text style"},{keys:{win:"Ctrl-Shift-L T U I",mac:"Meta-Shift-L T U I"},command:"open text attribute controls"},{keys:{win:"Ctrl-Shift-L T D",mac:"Meta-Shift-L T D"},command:"[todo] toggle todo marker"},{keys:{win:"Ctrl-Shift-L D A T E",mac:"Meta-Shift-L D A T E"},command:"insert date"},{keys:"Ctrl-C Ctrl-I",command:"change string inflection"},{keys:"Alt-Shift-4",command:"spell check word"},{keys:"Alt-Shift-\\",command:"[shell] run shell command on region"},{keys:"Alt-Shift-;",command:"run code on text morph"},{keys:{win:"Ctrl-Shift-L O P E N",mac:"Meta-Shift-L O P E N"},command:"open file at cursor"},{keys:"Meta-F1",command:"report token at cursor"}]},codeEditor:{defaultTheme:"default",collapseSelection:false,search:{maxCharsPerLine:10000,fastHighlightLineCount:4000,showTextMap:true},defaultStyle:{fontFamily:"IBM Plex Mono",padding:__varRecorder__$5.Rectangle.inset(4,2,4,2),fontSize:12,clipMode:"auto"},modes:{text:{style:{}}}},systemBrowser:{fixUndeclaredVarsOnSave:true},objectEditor:{fixUndeclaredVarsOnSave:true},remotes:{server:System.get("@system-env").browser?"".concat(document.location.origin,"/eval"):null},css:{ibmPlex:"/lively.morphic/assets/ibm-plex/css/ibm-plex.css",fontAwesome:"/lively.morphic/assets/fontawesome-free-5.12.1/css/all.css",inconsolata:"/lively.morphic/assets/inconsolata/inconsolata.css"}};var config=__varRecorder__$5.config;__varRecorder__$5["default"]=config;var exports$2={};Object.defineProperty(exports$2,"__esModule",{value:true});exports$2.declare=declare;function declare(builder){return function(api,options,dirname){if(!api.assertVersion){api=Object.assign(copyApiObject(api),{assertVersion:function assertVersion(range){throwVersionError(range,api.version);}});}return builder(api,options||{},dirname);};}function copyApiObject(api){var proto=null;if(typeof api.version==="string"&&/^7\./.test(api.version)){proto=Object.getPrototypeOf(api);if(proto&&(!has(proto,"version")||!has(proto,"transform")||!has(proto,"template")||!has(proto,"types"))){proto=null;}}return Object.assign({},proto,api);}function has(obj,key){return Object.prototype.hasOwnProperty.call(obj,key);}function throwVersionError(range,version){if(typeof range==="number"){if(!Number.isInteger(range)){throw new Error("Expected string or integer value.");}range="^".concat(range,".0.0-0");}if(typeof range!=="string"){throw new Error("Expected string or integer value.");}var limit=Error.stackTraceLimit;if(typeof limit==="number"&&limit<25){Error.stackTraceLimit=25;}var err;if(version.slice(0,2)==="7."){err=new Error("Requires Babel \"^7.0.0-beta.41\", but was loaded with \"".concat(version,"\". ")+"You'll need to update your @babel/core version.");}else{err=new Error("Requires Babel \"".concat(range,"\", but was loaded with \"").concat(version,"\". ")+"If you are sure you have a compatible version of @babel/core, "+"it is likely that something in your build process is loading the "+"wrong version. Inspect the stack trace of this error to look for "+"the first entry that doesn't mention \"@babel/core\" or \"babel-core\" "+"to see what is calling Babel.");}if(typeof limit==="number"){Error.stackTraceLimit=limit;}throw Object.assign(err,{code:"BABEL_VERSION_UNSUPPORTED",version:version,range:range});}var exports$3={};Object.defineProperty(exports$3,"__esModule",{value:true});exports$3["default"]=void 0;var _helperPluginUtils=exports$2;var _default=(0,_helperPluginUtils.declare)(function(api){api.assertVersion(7);return{name:"syntax-optional-catch-binding",manipulateOptions:function manipulateOptions(opts,parserOpts){parserOpts.plugins.push("optionalCatchBinding");}};});exports$3["default"]=_default;var exports$4={};Object.defineProperty(exports$4,"__esModule",{value:true});exports$4["default"]=void 0;var _helperPluginUtils$1=exports$2;var _pluginSyntaxOptionalCatchBinding=_interopRequireDefault(exports$3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj};}var _default$1=(0,_helperPluginUtils$1.declare)(function(api){api.assertVersion(7);return{name:"proposal-optional-catch-binding",inherits:_pluginSyntaxOptionalCatchBinding["default"],visitor:{CatchClause:function CatchClause(path){if(!path.node.param){var uid=path.scope.generateUidIdentifier("unused");var paramPath=path.get("param");paramPath.replaceWith(uid);}}}};});exports$4["default"]=_default$1;var exports$5={};Object.defineProperty(exports$5,"__esModule",{value:true});exports$5["default"]=void 0;var _helperPluginUtils$2=exports$2;var _default$2=(0,_helperPluginUtils$2.declare)(function(api){api.assertVersion(7);return{name:"syntax-import-meta",manipulateOptions:function manipulateOptions(opts,parserOpts){parserOpts.plugins.push("importMeta");}};});exports$5["default"]=_default$2;/*global global, babel*/ // fixme: this is a sort of bad placement
function ensureJSXPlugin(){if(!transformJSX)return;typeof babel!=='undefined'&&!babel.availablePlugins['transform-jsx']&&!(lively||global.lively).FreezerRuntime&&babel.registerPlugin('transform-jsx',transformJSX["default"]);}function stringifyFunctionWithoutToplevelRecorder(funcOrSourceOrAst){var varRecorderName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"__lvVarRecorder";ensureJSXPlugin();// stringifyFunctionWithoutToplevelRecorder((x) => hello + x)
// => x => hello + x
// instead of String((x) => hello + x) // => x => __lvVarRecorder.hello + x
// when run in toplevel scope
if(typeof funcOrSourceOrAst==="function")funcOrSourceOrAst=String(funcOrSourceOrAst);if(lively.FreezerRuntime){// rms 6.11.18: We currently try to not load lively.ast within the freezer context since it increases the payload
//     of the core dependencies quite substantially. In turn perform a less sophisticated but mostly working
//     find and replace of the recorder    
return funcOrSourceOrAst.split(varRecorderName+'.').join('');}var parsed=typeof funcOrSourceOrAst==="string"?parseFunction(funcOrSourceOrAst):funcOrSourceOrAst,replaced=ReplaceVisitor.run(parsed,function(node){var isVarRecorderMember=node.type==="MemberExpression"&&node.object.type==="Identifier"&&node.object.name===varRecorderName;return isVarRecorderMember?node.property:node;});return stringify(replaced);}var __varRecorder__$6=lively.FreezerRuntime.recorderFor("lively.bindings/index.js");function connect(sourceObj,attrName,targetObj,targetMethodName,specOrConverter){if(typeof targetObj==="function"&&(typeof targetMethodName==="undefined"||_typeof2(targetMethodName)==="object")){specOrConverter=targetMethodName;targetMethodName="call";if(!specOrConverter)specOrConverter={};if(!specOrConverter.updater)specOrConverter.updater=function($upd,val){return $upd(null,val);};}var connectionPoints=sourceObj.getConnectionPoints&&sourceObj.getConnectionPoints()||sourceObj.connections,connectionPoint=connectionPoints&&connectionPoints[attrName],klass=connectionPoint&&connectionPoint.map&&lively.morphic&&lively.morphic.GeometryConnection||connectionPoint&&connectionPoint.connectionClassType&&lively.Class.forName(connectionPoint.connectionClassType)||__varRecorder__$6.AttributeConnection,spec;if(typeof specOrConverter==="function"){console.warn("Directly passing a converter function to connect() "+"is deprecated! Use spec object instead!");spec={converter:specOrConverter};}else spec=specOrConverter;if(connectionPoint)spec=__varRecorder__$6.obj.merge(connectionPoint,spec);var connection=new klass(sourceObj,attrName,targetObj,targetMethodName,spec),existing=connection.getExistingConnection();if(existing){existing.resetSpec();existing.init(sourceObj,attrName,targetObj,targetMethodName,spec);return existing;}var result=connection.connect();if(typeof sourceObj.onConnect==="function")sourceObj.onConnect(attrName,targetObj,targetMethodName);if(connectionPoint&&connectionPoint.updateOnConnect)connection.update(sourceObj[attrName]);return result;}__varRecorder__$6.connect=connect;function disconnect(sourceObj,attrName,targetObj,targetMethodName){if(typeof targetObj==="function"&&(typeof targetMethodName==="undefined"||_typeof2(targetMethodName)==="object")){targetMethodName="call";}if(!sourceObj.attributeConnections)return;var _iterator9=_createForOfIteratorHelper(sourceObj.attributeConnections.slice()),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var con=_step9.value;if(con.getSourceAttrName()==attrName&&con.getTargetObj()===targetObj&&con.getTargetMethodName()==targetMethodName)con.disconnect();}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}if(typeof sourceObj.onDisconnect=="function")sourceObj.onDisconnect(attrName,targetObj,targetMethodName);}__varRecorder__$6.disconnect=disconnect;function disconnectAll(sourceObj){var con;while(sourceObj.attributeConnections&&(con=sourceObj.attributeConnections[0])){con.disconnect();}}__varRecorder__$6.disconnectAll=disconnectAll;function once$1(sourceObj,attrName,targetObj,targetMethodName,spec){if(typeof targetObj==="function"&&(typeof targetMethodName==="undefined"||_typeof2(targetMethodName)==="object")){spec=targetMethodName;targetMethodName="call";spec=spec||{};if(!spec)spec={};if(!spec.updater)spec.updater=function($upd,val){return $upd(null,val);};}else spec=spec||{};spec=spec||{};spec.removeAfterUpdate=true;return __varRecorder__$6.connect(sourceObj,attrName,targetObj,targetMethodName,spec);}__varRecorder__$6.once=once$1;function signal(sourceObj,attrName,newVal){var connections=sourceObj.attributeConnections;if(!connections)return;var oldVal=sourceObj[attrName];for(var i=0,len=connections.length;i<len;i++){var c=connections[i];if(c.getSourceAttrName()==attrName)c.update(newVal,oldVal);}}__varRecorder__$6.signal=signal;function callWhenNotNull(sourceObj,sourceProp,targetObj,targetSelector){if(sourceObj[sourceProp]!=null){targetObj[targetSelector](sourceObj[sourceProp]);}else{__varRecorder__$6.connect(sourceObj,sourceProp,targetObj,targetSelector,{removeAfterUpdate:true});}}__varRecorder__$6.callWhenNotNull=callWhenNotNull;function callWhenPathNotNull(source,path,target,targetProp){var helper={key:path.pop(),whenDefined:function whenDefined(context){__varRecorder__$6.callWhenNotNull(context,this.key,target,targetProp);}};while(path.length>0){helper={key:path.pop(),next:helper,whenDefined:function whenDefined(context){__varRecorder__$6.callWhenNotNull(context,this.key,this.next,"whenDefined");}};}helper.whenDefined(source);}__varRecorder__$6.callWhenPathNotNull=callWhenPathNotNull;function noUpdate(noUpdateSpec,func){var globalNoUpdate=false,result;if(!func&&typeof noUpdateSpec==="function"){func=noUpdateSpec;globalNoUpdate=true;}if(globalNoUpdate){var proto=__varRecorder__$6.AttributeConnection.prototype;if(!proto.isActive)proto.isActive=0;proto.isActive++;try{result=func();}finally{proto.isActive--;if(proto.isActive<=0)delete proto.isActive;}}else{var obj=noUpdateSpec.sourceObj,attr=noUpdateSpec.sourceAttribute,targetObj=noUpdateSpec.targetObj,targetAttr=noUpdateSpec.targetAttribute,filter=targetObj&&targetAttr?function(ea){return ea.getSourceAttrName()===attr&&targetObj===ea.getTargetObj()&&targetAttr===ea.getTargetMethodName();}:function(ea){return ea.getSourceAttrName()===attr;},conns=obj.attributeConnections&&obj.attributeConnections.filter(filter);conns&&__varRecorder__$6.arr.invoke(conns,"activate");try{result=func();}finally{conns&&__varRecorder__$6.arr.invoke(conns,"deactivate");}}return result;}__varRecorder__$6.noUpdate=noUpdate;__varRecorder__$6.string=string;__varRecorder__$6.arr=arr;__varRecorder__$6.Closure=Closure;__varRecorder__$6.obj=obj;__varRecorder__$6.stringifyFunctionWithoutToplevelRecorder=stringifyFunctionWithoutToplevelRecorder;__varRecorder__$6.connect=connect;__varRecorder__$6.connect=connect;__varRecorder__$6.disconnect=disconnect;__varRecorder__$6.disconnect=disconnect;__varRecorder__$6.disconnectAll=disconnectAll;__varRecorder__$6.disconnectAll=disconnectAll;__varRecorder__$6.once=once$1;__varRecorder__$6.once=once$1;__varRecorder__$6.signal=signal;__varRecorder__$6.signal=signal;__varRecorder__$6.noUpdate=noUpdate;__varRecorder__$6.noUpdate=noUpdate;var AttributeConnection=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.bindings/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("AttributeConnection")&&typeof __lively_classholder__.AttributeConnection==="function"?__lively_classholder__.AttributeConnection:__lively_classholder__.AttributeConnection=function AttributeConnection(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function AttributeConnection_initialize_(source,sourceProp,target,targetProp,spec){this.init(source,sourceProp,target,targetProp,spec);}},{key:"init",value:function AttributeConnection_init_(source,sourceProp,target,targetProp,spec){this.doNotSerialize=["isActive","converter","updater","varMapping"];this.sourceObj=source;this.sourceAttrName=sourceProp;this.targetObj=target;this.targetMethodName=targetProp;this.varMapping={source:source,target:target};spec=Object.assign({removeAfterUpdate:false,forceAttributeConnection:false,garbageCollect:false,signalOnAssignment:true},spec);if(spec.removeAfterUpdate)this.removeAfterUpdate=true;if(spec.forceAttributeConnection)this.forceAttributeConnection=true;if(typeof spec.garbageCollect==="boolean")this.garbageCollect=spec.garbageCollect;if(typeof spec.signalOnAssignment==="boolean")this.signalOnAssignment=spec.signalOnAssignment;if(spec.converter)this.setConverter(spec.converter);if(spec.updater)this.setUpdater(spec.updater);if(spec.varMapping)this.varMapping=Object.assign(spec.varMapping,this.varMapping);this.getSpec();return this;}},{key:"__additionally_serialize__",value:function AttributeConnection___additionally_serialize___(snapshot,ref,pool,addFn){if(!__varRecorder__$6.arr.equals(__varRecorder__$6.arr.without(Object.keys(this.varMapping),"_rev"),["source","target"])){addFn("varMapping",this.varMapping);}else if(snapshot.props.varMapping){delete snapshot.props.varMapping;}}},{key:"__after_deserialize__",value:function AttributeConnection___after_deserialize___(snapshot,objRef){if(!this.varMapping)this.varMapping={};this.varMapping.source=this.sourceObj;this.varMapping.target=this.targetObj;this.onSourceAndTargetRestored();}},{key:"onSourceAndTargetRestored",value:function AttributeConnection_onSourceAndTargetRestored_(){if(this.sourceObj&&this.targetObj)this.connect();}},{key:"copy",value:function AttributeConnection_copy_(copier){return __varRecorder__$6.AttributeConnection.fromLiteral(this.toLiteral(),copier);}},{key:"fixInstanceAfterCopyingFromSite",value:function AttributeConnection_fixInstanceAfterCopyingFromSite_(name,ref,index){this.disconnect();}},{key:"clone",value:function AttributeConnection_clone_(){var con=new this.constructor(this.getSourceObj(),this.getSourceAttrName(),this.getTargetObj(),this.getTargetMethodName(),this.getSpec());if(this.dependedBy)con.dependedBy=this.dependedBy;return con;}},{key:"getTargetObj",value:function AttributeConnection_getTargetObj_(){return this.targetObj;}},{key:"getSourceObj",value:function AttributeConnection_getSourceObj_(){return this.sourceObj;}},{key:"getSourceAttrName",value:function AttributeConnection_getSourceAttrName_(){return this.sourceAttrName;}},{key:"getTargetMethodName",value:function AttributeConnection_getTargetMethodName_(){return this.targetMethodName;}},{key:"getSourceValue",value:function AttributeConnection_getSourceValue_(){return this.getSourceObj()[this.getSourceAttrName()];}},{key:"getPrivateSourceValue",value:function AttributeConnection_getPrivateSourceValue_(){return this.sourceObj[this.privateAttrName(this.sourceAttrName)];}},{key:"getConverter",value:function AttributeConnection_getConverter_(){if(!this.converterString)return null;if(!this.converter)this.converter=__varRecorder__$6.Closure.fromSource(this.converterString,this.varMapping).recreateFunc();return this.converter;}},{key:"setConverter",value:function AttributeConnection_setConverter_(funcOrSource){delete this.converter;return this.converterString=funcOrSource?String(funcOrSource):null;}},{key:"getUpdater",value:function AttributeConnection_getUpdater_(){if(!this.updaterString)return null;if(!this.updater){this.updater=__varRecorder__$6.Closure.fromSource(this.updaterString,this.varMapping).recreateFunc();}return this.updater;}},{key:"setUpdater",value:function AttributeConnection_setUpdater_(funcOrSource){delete this.updater;return this.updaterString=funcOrSource?__varRecorder__$6.stringifyFunctionWithoutToplevelRecorder(funcOrSource):null;}},{key:"getSpec",value:function AttributeConnection_getSpec_(){var spec={};if(this.updaterString)spec.updater=this.getUpdater();if(this.converterString)spec.converter=this.getConverter();if(this.removeAfterUpdate)spec.removeAfterUpdate=true;if(this.forceAttributeConnection)spec.forceAttributeConnection=true;if(this.hasOwnProperty("garbageCollect"))spec.garbageCollect=this.garbageCollect;if(this.hasOwnProperty("signalOnAssignment"))spec.signalOnAssignment=this.signalOnAssignment;return spec;}},{key:"resetSpec",value:function AttributeConnection_resetSpec_(){delete this.garbageCollect;delete this.signalOnAssignment;delete this.removeAfterUpdate;delete this.forceAttributeConnection;delete this.converter;delete this.converterString;delete this.updater;delete this.updaterString;}},{key:"privateAttrName",value:function AttributeConnection_privateAttrName_(attrName){return"$$"+attrName;}},{key:"activate",value:function AttributeConnection_activate_(){this.isActive=true;}},{key:"deactivate",value:function AttributeConnection_deactivate_(){delete this.isActive;}},{key:"connect",value:function AttributeConnection_connect_(){var existing=this.getExistingConnection();if(existing!==this){existing&&existing.disconnect();this.addAttributeConnection();}var sourceObj=this.sourceObj,sourceAttrName=this.sourceAttrName,forceAttributeConnection=this.forceAttributeConnection,existingSetter=sourceObj.__lookupSetter__(sourceAttrName),existingGetter=sourceObj.__lookupGetter__(sourceAttrName);var methodOrValue=!existingSetter&&!existingGetter&&(this.getSourceValue()||this.getPrivateSourceValue());if(typeof methodOrValue==="function"&&!forceAttributeConnection){if(!methodOrValue.isWrapped){this.addConnectionWrapper(sourceObj,sourceAttrName,methodOrValue);}}else{this.addSourceObjGetterAndSetter(existingGetter,existingSetter);}return this;}},{key:"disconnect",value:function AttributeConnection_disconnect_(){var _this6=this;var sourceObj=this.sourceObj;if(!sourceObj||!sourceObj.attributeConnections)return this.removeSourceObjGetterAndSetter();sourceObj.attributeConnections=sourceObj.attributeConnections.filter(function(con){return!_this6.isSimilarConnection(con);});var connectionsWithSameSourceAttr=sourceObj.attributeConnections.filter(function(con){return _this6.getSourceAttrName()==con.getSourceAttrName();});if(sourceObj.attributeConnections.length==0)delete sourceObj.attributeConnections;if(connectionsWithSameSourceAttr.length==0)this.removeSourceObjGetterAndSetter();return null;}},{key:"update",value:function AttributeConnection_update_(newValue,oldValue){if(this.isActive)return null;var connection=this,updater=this.getUpdater(),converter=this.getConverter(),target=this.targetObj,propName=this.targetMethodName;if(!target||!propName){var msg="Cannot update "+this.toString(newValue)+" because of no target ("+target+") or targetProp ("+propName+") ";if(this.isWeakConnection){this.disconnect();}console.error(msg);return null;}var targetMethod=target[propName],callOrSetTarget=function callOrSetTarget(arg1,arg2,arg3,arg4,arg5,arg6){var args=[arg1,arg2,arg3,arg4,arg5,arg6];if(converter){newValue=converter.call(connection,arg1,arg2);arg1=args[0]=newValue;}var result=typeof targetMethod==="function"?targetMethod.apply(target,args):target[propName]=arg1;if(connection.removeAfterUpdate)connection.disconnect();return result;};try{this.isActive=true;return updater?updater.call(this,callOrSetTarget,newValue,oldValue):callOrSetTarget(newValue,oldValue);}catch(e){var world=this.sourceObj&&typeof this.sourceObj.world==="function"&&this.sourceObj.world()||this.targetObj&&typeof this.targetObj.world==="function"&&this.targetObj.world();if(world){world.logError(e,"AttributeConnection>>update: ");}else{console.error("Error when trying to update "+this+" with value "+newValue+":\n"+e+"\n"+e.stack);}}finally{delete this.isActive;}return null;}},{key:"addSourceObjGetterAndSetter",value:function AttributeConnection_addSourceObjGetterAndSetter_(existingGetter,existingSetter){if(existingGetter&&existingGetter.isAttributeConnectionGetter||existingSetter&&existingSetter.isAttributeConnectionSetter){return;}var sourceObj=this.sourceObj,sourceAttrName=this.sourceAttrName,newAttrName=this.privateAttrName(sourceAttrName);if(sourceObj[newAttrName]){console.warn("newAttrName "+newAttrName+" already exists."+"Are there already other connections?");}if(!sourceObj.hasOwnProperty("doNotSerialize"))sourceObj.doNotSerialize=[];__varRecorder__$6.arr.pushIfNotIncluded(sourceObj.doNotSerialize,newAttrName);if(!sourceObj.hasOwnProperty("doNotCopyProperties"))sourceObj.doNotCopyProperties=[];__varRecorder__$6.arr.pushIfNotIncluded(sourceObj.doNotCopyProperties,newAttrName);if(existingGetter){if(!sourceObj.hasOwnProperty(sourceAttrName)){sourceObj.__defineGetter__(newAttrName,function(){return sourceObj.constructor.prototype.__lookupGetter__(sourceAttrName).bind(sourceObj)();});}else{sourceObj.__defineGetter__(newAttrName,existingGetter);}}if(existingSetter){if(!sourceObj.hasOwnProperty(sourceAttrName)){sourceObj.__defineSetter__(newAttrName,function(newVal){sourceObj.constructor.prototype.__lookupSetter__(sourceAttrName).bind(sourceObj)(newVal);});}else{sourceObj.__defineSetter__(newAttrName,existingSetter);}}if(!existingGetter&&!existingSetter&&sourceObj.hasOwnProperty(sourceAttrName))sourceObj[newAttrName]=sourceObj[sourceAttrName];sourceObj.__defineSetter__(sourceAttrName,function(newVal){var oldVal=sourceObj[newAttrName];sourceObj[newAttrName]=newVal;if(sourceObj.attributeConnections===undefined){console.error("Sth wrong with sourceObj, has no attributeConnections");return null;}sourceObj.attributeConnections.forEach(function(c){if(c&&c.getSourceAttrName()===sourceAttrName&&c.signalOnAssignment)c.update(newVal,oldVal);});return newVal;});sourceObj.__lookupSetter__(sourceAttrName).isAttributeConnectionSetter=true;sourceObj.__defineGetter__(sourceAttrName,function(){return sourceObj[newAttrName];});sourceObj.__lookupGetter__(sourceAttrName).isAttributeConnectionGetter=true;}},{key:"addConnectionWrapper",value:function AttributeConnection_addConnectionWrapper_(sourceObj,methodName,origMethod){if(typeof origMethod!=="function"){throw new Error("addConnectionWrapper didnt get a method to wrap");}var getOriginal,isOwnProperty;if(isOwnProperty=sourceObj.hasOwnProperty(methodName)){sourceObj[this.privateAttrName(methodName)]=origMethod;getOriginal=function getOriginal(){return origMethod;};}else{getOriginal=function getOriginal(){return Object.getPrototypeOf(sourceObj)[methodName];};}sourceObj[methodName]=function connectionWrapper(){if(this.attributeConnections===undefined)throw new Error("[lively.bindings] Something is wrong with connection source object, it has no attributeConnections");var conns=this.attributeConnections.slice(),result=this[methodName].originalFunction.apply(this,arguments);for(var i=0;i<conns.length;i++){var c=conns[i];if(c.getSourceAttrName()===methodName)c.update(arguments[0]);}return result;};sourceObj[methodName].isOwnProperty=isOwnProperty;sourceObj[methodName].isWrapped=true;sourceObj[methodName].isConnectionWrapper=true;Object.defineProperty(sourceObj[methodName],"originalFunction",{get:getOriginal});sourceObj[methodName].toString=function(){return"<Wrapped ".concat(getOriginal(),">");};}},{key:"removeSourceObjGetterAndSetter",value:function AttributeConnection_removeSourceObjGetterAndSetter_(){var realAttrName=this.sourceAttrName,helperAttrName=this.privateAttrName(realAttrName),srcObj=this.sourceObj;if(!srcObj)return;if(srcObj.__lookupGetter__(realAttrName)){delete srcObj[realAttrName];if(srcObj.hasOwnProperty(helperAttrName)){try{srcObj[realAttrName]=srcObj[helperAttrName];}catch(err){}delete srcObj[helperAttrName];}}else if(srcObj[realAttrName]&&srcObj[realAttrName].isConnectionWrapper){var wrapper=srcObj[realAttrName];delete srcObj[realAttrName];if(!srcObj[realAttrName])srcObj[realAttrName]=wrapper.originalFunction;}if(srcObj.doNotSerialize&&srcObj.doNotSerialize.includes(helperAttrName)){srcObj.doNotSerialize=__varRecorder__$6.arr.without(srcObj.doNotSerialize,helperAttrName);if(srcObj.doNotSerialize.length==0)delete srcObj.doNotSerialize;}if(srcObj.doNotCopyProperties&&srcObj.doNotCopyProperties.includes(helperAttrName)){srcObj.doNotCopyProperties=__varRecorder__$6.arr.without(srcObj.doNotCopyProperties,helperAttrName);if(srcObj.doNotCopyProperties.length==0)delete srcObj.doNotCopyProperties;}}},{key:"addAttributeConnection",value:function AttributeConnection_addAttributeConnection_(){if(!this.sourceObj.attributeConnections)this.sourceObj.attributeConnections=[];this.sourceObj.attributeConnections.push(this);}},{key:"getExistingConnection",value:function AttributeConnection_getExistingConnection_(){var conns=this.sourceObj&&this.sourceObj.attributeConnections;if(!conns)return null;for(var i=0,len=conns.length;i<len;i++){if(this.isSimilarConnection(conns[i]))return conns[i];}return null;}},{key:"isRecursivelyActivated",value:function AttributeConnection_isRecursivelyActivated_(){return this.isActive;}},{key:"isSimilarConnection",value:function AttributeConnection_isSimilarConnection_(other){if(!other||other.constructor!=this.constructor)return false;return this.sourceObj==other.sourceObj&&this.sourceAttrName==other.sourceAttrName&&this.targetObj==other.targetObj&&this.targetMethodName==other.targetMethodName;}},{key:"toString",value:function AttributeConnection_toString_(optValue){try{return __varRecorder__$6.string.format("AttributeConnection(%s.%s %s %s.%s)",this.getSourceObj(),this.getSourceAttrName(),optValue?"-->"+String(optValue)+"-->":"-->",this.getTargetObj(),this.getTargetMethodName());}catch(e){return"<Error in AttributeConnection>>toString>";}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"AttributeConnection";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.bindings",version:"0.1.2"};}},{start:221,end:16605});}(undefined);__varRecorder__$6.AttributeConnection=AttributeConnection;__varRecorder__$6.AttributeConnection=AttributeConnection;__varRecorder__$6.AttributeConnection=AttributeConnection;__varRecorder__$6.callWhenNotNull=callWhenNotNull;__varRecorder__$6.callWhenNotNull=callWhenNotNull;__varRecorder__$6.callWhenPathNotNull=callWhenPathNotNull;__varRecorder__$6.callWhenPathNotNull=callWhenPathNotNull;/*global Map, System*/ // extensions to native JS objects to support serialization
// Symbol
Object.defineProperty(Symbol.prototype,"__serialize__",{configurable:true,value:function(){var knownSymbols=function(){return Object.getOwnPropertyNames(Symbol).filter(function(ea){return _typeof2(Symbol[ea])==="symbol";}).reduce(function(map,ea){return map.set(Symbol[ea],"Symbol."+ea);},new Map());}(),symMatcher=/^Symbol\((.*)\)$/;return function(){// turns a symbol into a __expr__ object.
var sym=typeof this[Symbol.toPrimitive]==="function"?this[Symbol.toPrimitive]():this,symKey=Symbol.keyFor(sym);if(symKey)return{__expr__:"Symbol.for(\"".concat(symKey,"\")")};if(knownSymbols.get(sym))return{__expr__:knownSymbols.get(sym)};var match=String(sym).match(symMatcher);return{__expr__:match?"Symbol(\"".concat(match[1],"\")"):"Symbol()"};};}()});// System
Object.defineProperty(System,"__serialize__",{configurable:true,value:function value(){return{__expr__:"System"};}});// window/global
Object.defineProperty(System.global,"__serialize__",{configurable:true,value:function value(){return{__expr__:"System.global"};}});// Map
Object.defineProperty(Map.prototype,"__serialize__",{configurable:true,value:function value(pool,snapshots,path){// ensure ObjectRef and snapshot object for map
var ref=pool.add(this),rev=ref.currentRev,snapshot=ref.currentSnapshot,entries=snapshot.entries=[],i=0;snapshots[ref.id]=snapshot;// store class info
pool.classHelper.addClassInfo(ref,this,snapshot);var _iterator10=_createForOfIteratorHelper(this),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var _step10$value=_slicedToArray2(_step10.value,2),key=_step10$value[0],value=_step10$value[1];i++;// serialize all entries into snapshot.entries
var serializedKey=ref.snapshotProperty(ref.id,key,path.concat("key",String(i)),snapshots,pool),serializedValue=ref.snapshotProperty(ref.id,value,path.concat("value",String(i)),snapshots,pool);entries.push(serializedKey,serializedValue);}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}return ref.asRefForSerializedObjMap(rev);}});Object.defineProperty(Map.prototype,"__deserialize__",{configurable:true,value:function value(snapshot,ref,serializedObjMap,pool,path){// deserialize entries from snapshot.entries
var entries=snapshot.entries;for(var _i48=0;_i48<entries.length;_i48=_i48+2){var key=entries[_i48],value=entries[_i48+1],deserializedKey=ref.recreateProperty("key."+_i48,key,serializedObjMap,pool,path.concat("key",_i48)),deserializedValue=ref.recreateProperty("value."+_i48,value,serializedObjMap,pool,path.concat("value",_i48));this.set(deserializedKey,deserializedValue);}}});// Set
Object.defineProperty(Set.prototype,"__serialize__",{configurable:true,value:function value(pool,snapshots,path){// ensure ObjectRef and snapshot object for set
var ref=pool.add(this),rev=ref.currentRev,snapshot=ref.currentSnapshot,entries=snapshot.entries=[],i=0;snapshots[ref.id]=snapshot;// store class info
pool.classHelper.addClassInfo(ref,this,snapshot);var _iterator11=_createForOfIteratorHelper(this),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var entry=_step11.value;i++;// serialize all entries into snapshot.entries
var serializedEntry=ref.snapshotProperty(ref.id,entry,path.concat("entry",String(i)),snapshots,pool);entries.push(serializedEntry);}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}return ref.asRefForSerializedObjMap(rev);}});Object.defineProperty(Set.prototype,"__deserialize__",{configurable:true,value:function value(snapshot,ref,serializedObjMap,pool,path){// deserialize entries from snapshot.entries
var entries=snapshot.entries;for(var _i49=0;_i49<entries.length;_i49++){var deserializedEntry=ref.recreateProperty("entry."+_i49,entries[_i49],serializedObjMap,pool,path.concat("key",_i49));this.add(deserializedEntry);}}});function isPrimitive$1(obj){// primitive objects don't need to be registered
if(obj==null)return true;var t=_typeof2(obj);if("boolean"===t||"number"===t||"string"===t)return true;return false;}/*global System*/var classMetaForSerializationProp="lively.serializer-class-info",classSuperClassProp=Symbol["for"]('lively-instance-superclass'),classNameProp=Symbol["for"]('__LivelyClassName__'),moduleMetaInClassProp=Symbol["for"]("lively-module-meta");function getClassName(obj){return obj.constructor[classNameProp]||obj.constructor.name;}function getSerializableClassMeta(realObj){if(!realObj||!realObj.constructor)return;var className=getClassName(realObj);if(!className){console.warn("Cannot serialize class info of anonymous class of instance ".concat(realObj));return;}var moduleMeta=realObj.constructor[moduleMetaInClassProp];if(className==="Object"&&!moduleMeta)return;// Errrr FIXME
if(moduleMeta){delete moduleMeta.lastChange;delete moduleMeta.lastSuperclassChange;}return{className:className,module:moduleMeta};}function locateClass(meta){// meta = {className, module: {package, pathInPackage}}
var m=meta.module;if(m){var moduleId=m.pathInPackage;if(m["package"]&&m["package"].name&&m["package"].name!=='no group'/*FIXME*/){var packagePath=System.decanonicalize(m["package"].name.replace(/\/*$/,'/'));moduleId=joinPath(packagePath,moduleId);}var livelyEnv=System.get('@lively-env');var realModule=livelyEnv.moduleEnv(moduleId)||livelyEnv.moduleEnv(m.pathInPackage);if(!realModule){console.warn("Trying to deserialize instance of class ".concat(meta.className," but the module ").concat(moduleId," is not yet loaded"));}else{return realModule.recorder[meta.className];}}// is it a global?
return System.global[meta.className];}var ClassHelper=/*#__PURE__*/function(){_createClass(ClassHelper,[{key:"sourceModuleNameProperty",get:function get(){return'__SourceModuleName__';}}],[{key:"moduleMetaInClassProp",get:function get(){return moduleMetaInClassProp;}},{key:"classMetaForSerializationProp",get:function get(){return classMetaForSerializationProp;}},{key:"classSuperClassProp",get:function get(){return classSuperClassProp;}},{key:"classNameProperty",get:function get(){return classNameProp;}}]);function ClassHelper(options){_classCallCheck(this,ClassHelper);this.options=_objectSpread({ignoreClassNotFound:true},options);this[Symbol["for"]('lively-instance-restorer')]=true;// for Class.intializer
}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// class info persistence
_createClass(ClassHelper,[{key:"addClassInfo",value:function addClassInfo(objRef,realObj,snapshot){// store class into persistentCopy if original is an instance
var meta=getSerializableClassMeta(realObj);if(!meta)return;snapshot[classMetaForSerializationProp]=meta;}},{key:"restoreIfClassInstance",value:function restoreIfClassInstance(objRef,snapshot){if(!snapshot.hasOwnProperty(classMetaForSerializationProp))return;var meta=snapshot[classMetaForSerializationProp];if(!meta.className)return;var klass=locateClass(meta);if(!klass||typeof klass!=="function"){var msg="Trying to deserialize instance of ".concat(JSON.stringify(meta)," but this class cannot be found!");if(!this.options.ignoreClassNotFound)throw new Error(msg);console.error(msg);return{isClassPlaceHolder:true,className:meta.className};}// non-lively classes don't understand our instance restorer arg...!'
var isLivelyClass=klass.hasOwnProperty(Symbol["for"]("lively-instance-superclass"));return isLivelyClass?new klass(this):new klass();}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// searching
}],[{key:"sourceModulesInObjRef",value:function sourceModulesInObjRef(snapshotedObjRef){//                                  /--- that's the ref
// from snapshot = {[key]: {..., props: [...]}}
var modules=[],prop=snapshotedObjRef&&snapshotedObjRef[classMetaForSerializationProp];if(prop&&prop.module)modules.push(prop.module);return modules;}},{key:"sourceModulesIn",value:function sourceModulesIn(snapshots){var modules=[];Object.keys(snapshots).forEach(function(id){var snapshot=snapshots[id];if(snapshot&&snapshot[classMetaForSerializationProp])modules.push(snapshot[classMetaForSerializationProp]);});return uniqBy(modules,function(a,b){var modA=a.module,modB=b.module;if(!modA&&!modB||modA&&!modB||!modA&&modB)return a.className===b.className;return a.className===b.className&&modA["package"].name==modB["package"].name&&modA["package"].pathInPackage==modB["package"].pathInPackage;});}}]);return ClassHelper;}();/*global System*/var ExpressionSerializer=/*#__PURE__*/function(){function ExpressionSerializer(opts){_classCallCheck(this,ExpressionSerializer);var _prefix$opts=_objectSpread({prefix:"__lv_expr__"},opts),prefix=_prefix$opts.prefix;this.prefix=prefix+":";}_createClass(ExpressionSerializer,[{key:"isSerializedExpression",value:function isSerializedExpression(string){return string.indexOf(this.prefix)===0;}},{key:"requiredModulesOf__expr__",value:function requiredModulesOf__expr__(__expr__){if(!this.isSerializedExpression(__expr__))return null;var _this$exprStringDecod=this.exprStringDecode(__expr__),bindings=_this$exprStringDecod.bindings;return bindings?Object.keys(bindings):null;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// encode / decode of serialized expressions
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"exprStringDecode",value:function exprStringDecode(string){// 1. read prefix
// string = "_prefix:{foo}:package/foo.js:foo()"
// => {expr: "foo()", bindings: {"package/foo.js": ["foo"]}}
var idx=string.indexOf(":"),prefix=string.slice(0,idx),rest=string.slice(idx+1),bindings={},httpPlaceholder="__HTTP_PLACEHOLDER__",hasBindings=false;// 2. bindings?
while(rest&&rest.startsWith("{")&&(idx=rest.indexOf("}:"))>=0){hasBindings=true;var importedVars=rest.slice(1,idx);rest=rest.slice(idx+2);// skip }:
if(rest.includes('https:')&&rest.indexOf('https:')<rest.indexOf(':')){rest=rest.replace('https:',httpPlaceholder);idx=rest.indexOf(":")-httpPlaceholder.length+'https:'.length;rest=rest.replace(httpPlaceholder,'https:');}else idx=rest.indexOf(":");// end of package
var _from2=rest.slice(0,idx),imports=importedVars.split(",").filter(function(ea){return Boolean(ea.trim());}).map(function(ea){if(!ea.includes(":"))return ea;var _ea$split=ea.split(":"),_ea$split2=_slicedToArray2(_ea$split,2),exported=_ea$split2[0],local=_ea$split2[1];return{exported:exported,local:local};});bindings[_from2]=imports;rest=rest.slice(idx+1);// skip :
}return{__expr__:rest,bindings:hasBindings?bindings:null};}},{key:"exprStringEncode",value:function exprStringEncode(_ref7){var __expr__=_ref7.__expr__,bindings=_ref7.bindings;// {expr: "foo()", bindings: {"package/foo.js": ["foo"]}}
// => "_prefix:{foo}:package/foo.js:foo()"
var string=String(__expr__);if(bindings){var keys=Object.keys(bindings);for(var i=0;i<keys.length;i++){var from=keys[i],binding=bindings[from];if(Array.isArray(binding)){binding=binding.map(function(ea){return typeof ea==="string"?ea:ea.exported+":"+ea.local;}).join(",");}string="{".concat(binding,"}:").concat(from,":").concat(string);}}return this.prefix+string;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// serialization
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"convert__expr__obj",value:function convert__expr__obj(obj){// obj.__expr__ is encoded serialized expression *without* prefix
console.assert("__expr__"in obj,"obj has no property __expr__");return this.prefix+obj.__expr__;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// deserialization
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// note __boundValues__ becomes a dynamically scoped "variable" inside eval
},{key:"__eval__",value:function __eval__(source,boundValues){return _eval__(source,boundValues);}},{key:"deserializeExpr",value:function deserializeExpr(encoded){if(!encoded.startsWith(this.prefix))throw new Error("\"".concat(encoded,"\" is not a serialized expression, missing prefix \"").concat(this.prefix,"\""));return this.deserializeExprObj(this.exprStringDecode(encoded));}},{key:"deserializeExprObj",value:function deserializeExprObj(_ref8){var source=_ref8.__expr__,bindings=_ref8.bindings;var __boundValues__={};if(bindings){var mods=bindings?Object.keys(bindings):[];// synchronously get modules specified in bindings object and pull out
// the vars needed for evaluating source. Add those to __boundValues__
for(var _i50=0;_i50<mods.length;_i50++){var modName=mods[_i50],vars=bindings[modName],_exports=void 0;if(lively.FreezerRuntime){_exports=lively.FreezerRuntime.get(lively.FreezerRuntime.decanonicalize(modName));if(!_exports){// try to fetch if global is defined
var mod=lively.FreezerRuntime.fetchStandaloneFor(modName);if(mod)_exports=mod.exports;}if(_exports.exports)_exports=_exports.exports;}else{_exports=System.get(System.decanonicalize(modName));}if(!_exports){throw new Error("[lively.serializer] expression eval: bindings specify to import ".concat(modName," but this module is not loaded!\nSource: ").concat(source));}for(var _j8=0;_j8<vars.length;_j8++){var varName=vars[_j8],local=void 0,exported=void 0;if(typeof varName==="string"){local=varName;exported=varName;}else if(_typeof2(varName)==="object"){// alias
local=varName.local;exported=varName.exported;}__boundValues__[local]=_exports[exported];source="var ".concat(local," = __boundValues__.").concat(local,";\n").concat(source);}}}// evaluate
return this.__eval__(source,__boundValues__);}}]);return ExpressionSerializer;}();/*
       22.06.19 rms:
       The following two functions are helpers that allow us to convert non cyclical morph hierarchies
       into nested serialized expressions. As of now it is kinda morph specific, however could be easily
       generalized to become suitable for more general object trees.
      */ // 25.5.20 rms: this function requires the parameters to be unchanged when we run this through google closure. This is why we construct if from source.
var _eval__=Closure.fromSource("function __eval__(__source__, __boundValues__) { \n  return eval(__source__); \n}").getFunc();function deserializeSpec(serializedSpec){var subSpecHandler=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(spec){return spec;};var base=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var exprSerializer=new ExpressionSerializer();var deserializedSpec=base;var props=base.isMorph?base.propertiesAndPropertySettings().order:[];props=props.length?props:keys(serializedSpec);var _iterator12=_createForOfIteratorHelper(props),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var _prop=_step12.value;var value=serializedSpec[_prop];if(_prop==='_env'||_prop==='env'||_prop==='__connections__'||_prop==='__refs__')return;if(isString(value)&&exprSerializer.isSerializedExpression(value)){value=exprSerializer.deserializeExpr(value);}if(['borderColor','borderWidth','borderStyle','borderRadius'].includes(_prop)){value=deserializeSpec(value,subSpecHandler);}if(value&&value._id){value=subSpecHandler(deserializeSpec(value,subSpecHandler));}deserializedSpec[_prop]=value;}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}if(serializedSpec.submorphs)deserializedSpec.submorphs=serializedSpec.submorphs.map(function(spec){return deserializeSpec(spec,subSpecHandler);});if(base){var _iterator13=_createForOfIteratorHelper(props.filter(function(key){return!!serializedSpec[key];})),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var prop=_step13.value;base[prop]=deserializedSpec[prop];}}catch(err){_iterator13.e(err);}finally{_iterator13.f();}}if(serializedSpec.__refs__){var _iterator14=_createForOfIteratorHelper(serializedSpec.__refs__),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var _step14$value=_slicedToArray2(_step14.value,2),pathToParent=_step14$value[0],pathToVal=_step14$value[1];Path(pathToParent).set(deserializedSpec,Path(pathToVal).get(deserializedSpec));}}catch(err){_iterator14.e(err);}finally{_iterator14.f();}}if(serializedSpec.__connections__){var _iterator15=_createForOfIteratorHelper(serializedSpec.__connections__),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var conn=_step15.value;connect(Path(conn.pathToSource).get(deserializedSpec),conn.sourceAttrName,Path(conn.pathToTarget).get(deserializedSpec),conn.targetMethodName,_objectSpread({},select(conn,['garbageCollect','converterString','updaterString','varMapping'])));}}catch(err){_iterator15.e(err);}finally{_iterator15.f();}}return deserializedSpec;}// this.exportToJSON()
function serializeSpec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};// quick hack to "snapshot" into JSON or serialized expression
var _opts$keepFunctions=opts.keepFunctions,keepFunctions=_opts$keepFunctions===void 0?true:_opts$keepFunctions,_opts$skipAttributes=opts.skipAttributes,skipAttributes=_opts$skipAttributes===void 0?[]:_opts$skipAttributes,_opts$keepConnections=opts.keepConnections,keepConnections=_opts$keepConnections===void 0?true:_opts$keepConnections,_opts$asExpression=opts.asExpression,asExpression=_opts$asExpression===void 0?false:_opts$asExpression,_opts$root=opts.root,root=_opts$root===void 0?true:_opts$root,_opts$path=opts.path,path=_opts$path===void 0?'':_opts$path,_opts$skipUnchangedFr=opts.skipUnchangedFromDefault,skipUnchangedFromDefault=_opts$skipUnchangedFr===void 0?false:_opts$skipUnchangedFr,_opts$nestedExpressio=opts.nestedExpressions,nestedExpressions=_opts$nestedExpressio===void 0?{}:_opts$nestedExpressio,_opts$objToPath=opts.objToPath,objToPath=_opts$objToPath===void 0?new WeakMap():_opts$objToPath,_opts$objRefs=opts.objRefs,objRefs=_opts$objRefs===void 0?[]:_opts$objRefs,_opts$connections=opts.connections,connections=_opts$connections===void 0?[]:_opts$connections;var subopts={skipAttributes:skipAttributes,skipUnchangedFromDefault:skipUnchangedFromDefault,root:false,keepFunctions:keepFunctions,asExpression:asExpression,nestedExpressions:nestedExpressions,connections:connections,objRefs:objRefs,objToPath:objToPath,keepConnections:keepConnections};if(objToPath.has(morph)){// morph was already serialized, add ref and return
objRefs.push([path,/* => */objToPath.get(morph)]);// store assignment
return null;}else objToPath.set(morph,path);if(asExpression)keepFunctions=false;var exprSerializer=new ExpressionSerializer();var getExpression=function getExpression(name,val){try{val=val.__serialize__();// serializeble expressions
if(asExpression){var exprId=newUUID();nestedExpressions[exprId]=val;val=exprId;}else val=val.__expr__?exprSerializer.exprStringEncode(val):val;}catch(e){console.log("[export to JSON] failed converting ".concat(name," to serialized expression"));}return val;};var exported={};objToPath.set(morph,path);if(keepConnections&&morph.attributeConnections)connections.push.apply(connections,_toConsumableArray2(morph.attributeConnections));if(morph.isText){exported.textAndAttributes=morph.textAndAttributes.map(function(ea,i){return ea&&ea.isMorph?serializeSpec(ea,_objectSpread(_objectSpread({},subopts),{},{path:path?path+'.textAndAttributes.'+i:'textAndAttributes.'+i})):ea;});}if(morph.submorphs&&morph.submorphs.length>0){exported.submorphs=morph.submorphs.map(function(ea,i){return serializeSpec(ea,_objectSpread(_objectSpread({},subopts),{},{path:path?path+'.submorphs.'+i:'submorphs.'+i}));}).filter(Boolean);}var _loop=function _loop(name){var val=morph[name];if(val&&_typeof2(val)==='object'&&!Array.isArray(val)&&!val.isMorph){objToPath.set(val,path?path+'.'+name:name);}if(name==="submorphs")return"continue";if(skipAttributes.includes(name))return"continue";if(name==='metadata'&&Path('commit.__serialize__').get(val)){exported[name]=_objectSpread(_objectSpread({},val),{},{commit:getExpression(name+'.commit',val.commit)});return"continue";}if(['borderColor','borderWidth','borderStyle','borderRadius'].includes(name)){var serializedVal={};for(var _i51=0,_arr2=['top','left','right','bottom'];_i51<_arr2.length;_i51++){var mem=_arr2[_i51];var memberValue=val[mem];if(memberValue&&memberValue.__serialize__){memberValue=memberValue.__serialize__();if(memberValue&&memberValue.__expr__){if(asExpression){var uuid=newUUID();nestedExpressions[uuid]=memberValue;memberValue=uuid;}else memberValue=exprSerializer.exprStringEncode(memberValue);}}serializedVal[mem]=memberValue;}exported[name]=serializedVal;return"continue";}if(val&&val.isMorph){exported[name]=serializeSpec(val,_objectSpread(_objectSpread({},subopts),{},{path:path?path+"."+name:name}));return"continue";}if(val&&val.__serialize__){exported[name]=getExpression(name,val);return"continue";}if(Array.isArray(val)){// check if each array member is seralizable
exported[name]=val.map(function(v,i){if(v&&v.isMorph)return serializeSpec(v,_objectSpread(_objectSpread({},subopts),{},{path:path?path+'.'+name+'.'+i:name+'.'+i}));if(v&&v.__serialize__){return getExpression(name+'.'+i,v);}return v;});return"continue";}if(val&&!isString(val)&&!isNumber(val)&&allOwnPropertiesOrFunctions(val).length>0){for(var prop in val){if(val[prop]&&val[prop].isMorph)val[prop]=serializeSpec(val[prop],_objectSpread(_objectSpread({},subopts),{},{path:path?path+'.'+name+'.'+prop:name+'.'+prop}));}}exported[name]=val;};for(var name in morph.spec(skipUnchangedFromDefault)){var _ret=_loop(name);if(_ret==="continue")continue;}if(morph.isText)delete exported.textString;if(!asExpression)exported._id=morph._id;if(keepFunctions){exported.type=morph.constructor;// not JSON!
Object.keys(morph).forEach(function(name){return typeof morph[name]==="function"&&(exported[name]=morph[name]);});}else{if(exported.styleSheets)exported.styleSheets=[];exported.type=getSerializableClassMeta(morph);}// this.exportToJSON()
if(keepConnections&&root){/*
               Right now we can only reconstruct connections which are between morphs 
               or objects which are directly referenced by a morph. Other ones are skipped.
             */var connectionExpressions=[];var _iterator16=_createForOfIteratorHelper(connections),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var conn=_step16.value;var sourceAttrName=conn.sourceAttrName,targetMethodName=conn.targetMethodName,sourceObj=conn.sourceObj,targetObj=conn.targetObj,updaterString=conn.updaterString,converterString=conn.converterString,varMapping=conn.varMapping,garbageCollect=conn.garbageCollect;var pathToSource=objToPath.get(sourceObj);var pathToTarget=objToPath.get(targetObj);if(typeof pathToSource==='string'&&typeof pathToTarget==='string'){connectionExpressions.push({pathToSource:pathToSource,pathToTarget:pathToTarget,garbageCollect:garbageCollect,updaterString:updaterString,converterString:converterString,sourceAttrName:sourceAttrName,targetMethodName:targetMethodName,varMapping:{properties:properties}});continue;}console.log('skipping:',conn);}}catch(err){_iterator16.e(err);}finally{_iterator16.f();}if(!asExpression)exported.__connections__=connectionExpressions;}if(asExpression&&root){var _ret2=function(){// replace the nestedExpressions after stringification
var __expr__="morph(".concat(inspect(exported),")");var bindings={'lively.morphic':['morph']};for(var exprId in nestedExpressions){__expr__=__expr__.replace('\"'+exprId+'\"',nestedExpressions[exprId].__expr__);Object.entries(nestedExpressions[exprId].bindings||{}).forEach(function(_ref9){var _ref10=_slicedToArray2(_ref9,2),binding=_ref10[0],imports=_ref10[1];if(bindings[binding])bindings[binding]=uniq([].concat(_toConsumableArray2(bindings[binding]),_toConsumableArray2(imports)));else bindings[binding]=imports;});}return{v:{__expr__:__expr__,bindings:bindings}};}();if(_typeof2(_ret2)==="object")return _ret2.v;}if(root)exported.__refs__=objRefs;return exported;}var CustomSerializePlugin=/*#__PURE__*/function(){function CustomSerializePlugin(){_classCallCheck(this,CustomSerializePlugin);}_createClass(CustomSerializePlugin,[{key:"serializeObject",// can realObj be manually serialized, e.g. into an expression?
value:function serializeObject(realObj,isProperty,pool,serializedObjMap,path){if(typeof realObj.__serialize__!=="function")return null;var serialized=realObj.__serialize__(pool,serializedObjMap,path);if(serialized&&serialized.hasOwnProperty("__expr__")){var expr=pool.expressionSerializer.exprStringEncode(serialized);serialized=isProperty?expr:{__expr__:expr};}return serialized;}},{key:"deserializeObject",value:function deserializeObject(pool,ref,snapshot,path){var __expr__=snapshot.__expr__;return __expr__?pool.expressionSerializer.deserializeExpr(__expr__):null;}}]);return CustomSerializePlugin;}();var ClassPlugin=/*#__PURE__*/function(){function ClassPlugin(){_classCallCheck(this,ClassPlugin);}_createClass(ClassPlugin,[{key:"additionallySerialize",// record class meta info for re-instantiating
value:function additionallySerialize(pool,ref,snapshot,addFn){pool.classHelper.addClassInfo(ref,ref.realObj,snapshot);}},{key:"deserializeObject",value:function deserializeObject(pool,ref,snapshot,path){return pool.classHelper.restoreIfClassInstance(ref,snapshot);}}]);return ClassPlugin;}();var SerializationIndicationPlugin=/*#__PURE__*/function(){function SerializationIndicationPlugin(){_classCallCheck(this,SerializationIndicationPlugin);}_createClass(SerializationIndicationPlugin,[{key:"serializeObject",value:function serializeObject(realObj,isProperty,pool,serializedObjMap,path){if(realObj&&realObj.isMorph)realObj.__isBeingSerialized__=true;return null;// do not intercept serialization
}}]);return SerializationIndicationPlugin;}();var SerializationFinishPlugin=/*#__PURE__*/function(){function SerializationFinishPlugin(){_classCallCheck(this,SerializationFinishPlugin);}_createClass(SerializationFinishPlugin,[{key:"additionallySerialize",value:function additionallySerialize(pool,ref,snapshot,addFn){if(ref.realObj&&ref.realObj.isMorph)ref.realObj.__isBeingSerialized__=false;}}]);return SerializationFinishPlugin;}();var AdditionallySerializePlugin=/*#__PURE__*/function(){function AdditionallySerializePlugin(){_classCallCheck(this,AdditionallySerializePlugin);}_createClass(AdditionallySerializePlugin,[{key:"additionallySerialize",// for objects with __additionally_serialize__(snapshot, ref, pool, addFn) method
value:function additionallySerialize(pool,ref,snapshot,addFn){var realObj=ref.realObj;if(realObj&&typeof realObj.__additionally_serialize__==="function")realObj.__additionally_serialize__(snapshot,ref,pool,addFn);}},{key:"additionallyDeserializeBeforeProperties",value:function additionallyDeserializeBeforeProperties(pool,ref,newObj,props,snapshot,serializedObjMap,path){if(typeof newObj.__deserialize__==="function")newObj.__deserialize__(snapshot,ref,serializedObjMap,pool,path);}},{key:"additionallyDeserializeAfterProperties",value:function additionallyDeserializeAfterProperties(pool,ref,newObj,snapshot,serializedObjMap,path){if(typeof newObj.__after_deserialize__==="function")newObj.__after_deserialize__(snapshot,ref,pool);}}]);return AdditionallySerializePlugin;}();var OnlySerializePropsPlugin=/*#__PURE__*/function(){function OnlySerializePropsPlugin(){_classCallCheck(this,OnlySerializePropsPlugin);}_createClass(OnlySerializePropsPlugin,[{key:"propertiesToSerialize",value:function propertiesToSerialize(pool,ref,snapshot,keysSoFar){var realObj=ref.realObj;return realObj&&realObj.__only_serialize__||null;}}]);return OnlySerializePropsPlugin;}();var DontSerializePropsPlugin=/*#__PURE__*/function(){function DontSerializePropsPlugin(){_classCallCheck(this,DontSerializePropsPlugin);}_createClass(DontSerializePropsPlugin,[{key:"propertiesToSerialize",value:function propertiesToSerialize(pool,ref,snapshot,keysSoFar){var realObj=ref.realObj;if(!realObj||!realObj.__dont_serialize__)return null;var ignoredKeys=mergePropertyInHierarchy(realObj,"__dont_serialize__"),keys=[];for(var _i52=0;_i52<keysSoFar.length;_i52++){var key=keysSoFar[_i52];if(!ignoredKeys.includes(key))keys.push(key);}return keys;}}]);return DontSerializePropsPlugin;}();var LivelyClassPropertiesPlugin=/*#__PURE__*/function(){function LivelyClassPropertiesPlugin(){_classCallCheck(this,LivelyClassPropertiesPlugin);}_createClass(LivelyClassPropertiesPlugin,[{key:"propertiesToSerialize",value:function propertiesToSerialize(pool,ref,snapshot,keysSoFar){// serialize class properties as indicated by realObj.constructor.properties
var realObj=ref.realObj,classProperties=realObj.constructor[Symbol["for"]("lively.classes-properties-and-settings")];if(!classProperties)return null;var properties=classProperties.properties,propertySettings=classProperties.propertySettings,valueStoreProperty=propertySettings.valueStoreProperty||"_state",valueStore=realObj[valueStoreProperty],only=!!realObj.__only_serialize__,keys=[];if(!valueStore)return;// if __only_serialize__ is defined we will only consider those properties
// that are in keysSoFar  it is expected that the OnlySerializePropsPlugin
// was producing that list.
if(only){for(var i=0;i<keysSoFar.length;i++){var _key8=keysSoFar[i],_spec=properties[_key8];if(_key8===valueStoreProperty)continue;if(_spec){if(_spec&&(_spec.derived||_spec.readOnly||_spec.hasOwnProperty("serialize")&&!_spec.serialize))continue;}keys.push(_key8);}return keys;}// Otherwise properties add to keysSoFar
var valueStoreKeyIdx=keysSoFar.indexOf(valueStoreProperty);if(valueStoreKeyIdx>-1)keysSoFar.splice(valueStoreKeyIdx,1);for(var key in properties){var spec=properties[key],idx=keysSoFar.indexOf(key);if(spec.derived||spec.readOnly||spec.hasOwnProperty("serialize")&&!spec.serialize){if(idx>-1)keysSoFar.splice(idx,1);}else if(idx===-1)keys.push(key);}return keys.concat(keysSoFar);}},{key:"additionallyDeserializeBeforeProperties",value:function additionallyDeserializeBeforeProperties(pool,ref,newObj,props,snapshot,serializedObjMap,path){// deserialize class properties as indicated by realObj.constructor.properties
var classProperties=newObj.constructor[Symbol["for"]("lively.classes-properties-and-settings")];if(!classProperties)return props;var properties=classProperties.properties,propertySettings=classProperties.propertySettings,sortedKeys=classProperties.order,valueStoreProperty=propertySettings.valueStoreProperty||"_state",props=snapshot.props;// if props has a valueStoreProperty then we directly deserialize that.
// As of 2017-02-26 this is for backwards compat.
if(props[valueStoreProperty])return props;props=clone$1(props);if(!newObj.hasOwnProperty(valueStoreProperty))newObj.initializeProperties();var valueStore=newObj[valueStoreProperty];for(var i=0;i<sortedKeys.length;i++){var key=sortedKeys[i],spec=properties[key];if(!props.hasOwnProperty(key))continue;ref.recreatePropertyAndSetProperty(newObj,props,key,serializedObjMap,pool,path);delete props[key];}return props;}}]);return LivelyClassPropertiesPlugin;}();// export class LeakDetectorPlugin {
//   
//   afterSerialization(pool, snapshot, realObj) {
//     let i = SnapshotInspector.forPoolAndSnapshot(snapshot, pool),
//         weakRefs = new Set([...(i.classes.AttributeConnection || {objects: []}).objects, 
//                             ...(i.classes["{source, target}"] || {objects: []}).objects,
//                             ...(i.classes["{_rev, source, target}"] || {objects: []}).objects].map(c => c[0])),
//         G = i.referenceGraph(), invG = graph.invert(G),
//         memoryLeaks = arr.compact(
//                       arr.flatten(Object.entries(invG)
//                          .filter(([id, c]) => 
//                              c.length < 3 
//                              && snapshot.id != id 
//                              && !weakRefs.has(id) 
//                              && c.every(r => weakRefs.has(r)))
//                          .map(([id]) => {
//                            let subgraph = graph.subgraphReachableBy(G, id), obj = pool.resolveToObj(id);
//                            if (Object.keys(subgraph).length > 1)
//                               return arr.compact(invG[id].map(ref => {
//                                 let conn = pool.resolveToObj(ref);
//                                 if (conn.constructor.name === 'AttributeConnection') return conn
//                               })).map(conn => ({conn, obj}))
//                           })));
//      if (memoryLeaks.length > 0) this.memoryLeaks = memoryLeaks;
//     return snapshot;
//   }
// }
var plugins={livelyClassPropertiesPlugin:new LivelyClassPropertiesPlugin(),dontSerializePropsPlugin:new DontSerializePropsPlugin(),onlySerializePropsPlugin:new OnlySerializePropsPlugin(),additionallySerializePlugin:new AdditionallySerializePlugin(),classPlugin:new ClassPlugin(),customSerializePlugin:new CustomSerializePlugin(),indicationPlugin:new SerializationIndicationPlugin(),finishPlugin:new SerializationFinishPlugin()};var allPlugins=[plugins.indicationPlugin,plugins.customSerializePlugin,plugins.classPlugin,plugins.additionallySerializePlugin,plugins.onlySerializePropsPlugin,plugins.dontSerializePropsPlugin,plugins.livelyClassPropertiesPlugin,plugins.finishPlugin];var ObjectPool=/*#__PURE__*/function(){_createClass(ObjectPool,null,[{key:"withDefaultPlugins",value:function withDefaultPlugins(options){return new this(_objectSpread({plugins:allPlugins},options));}},{key:"resolveFromSnapshotAndId",value:function resolveFromSnapshotAndId(snapshotAndId,options){return new this(options).resolveFromSnapshotAndId(snapshotAndId);}},{key:"fromSnapshot",value:function fromSnapshot(snapshoted,options){return new this(options).readSnapshot(snapshoted);}},{key:"withObject",value:function withObject(obj,options){var pool=new this(options);pool.add(obj);return pool;}}]);function ObjectPool(options){_classCallCheck(this,ObjectPool);this.options=_objectSpread({checkForLeaks:false,ignoreClassNotFound:true,idPropertyName:"id"},options);this.reset();}_createClass(ObjectPool,[{key:"reset",value:function reset(){this.uuidGen=newUUID;this._obj_ref_map=new Map();this._id_ref_map={};var options=this.options;this.classHelper=new ClassHelper(options);this.expressionSerializer=new ExpressionSerializer();if(options.idPropertyName)this.idPropertyName=options.idPropertyName;if(options.uuidGen)this.uuidGen=options.uuidGen;if(options.reinitializeIds)this.reinitializeIds=options.reinitializeIds;if(options.hasOwnProperty("ignoreClassNotFound"))this.classHelper.options.ignoreClassNotFound=options.ignoreClassNotFound;var ps=this.plugins={serializeObject:[],additionallySerialize:[],propertiesToSerialize:[],deserializeObject:[],additionallyDeserializeBeforeProperties:[],additionallyDeserializeAfterProperties:[],afterDeserialization:[],beforeDeserialization:[],afterSerialization:[],beforeSerialization:[]};if(options.plugins){options.plugins.forEach(function(p){if(typeof p.serializeObject==="function")ps.serializeObject.push(p);if(typeof p.additionallySerialize==="function")ps.additionallySerialize.push(p);if(typeof p.propertiesToSerialize==="function")ps.propertiesToSerialize.push(p);if(typeof p.deserializeObject==="function")ps.deserializeObject.push(p);if(typeof p.additionallyDeserializeBeforeProperties==="function")ps.additionallyDeserializeBeforeProperties.push(p);if(typeof p.additionallyDeserializeAfterProperties==="function")ps.additionallyDeserializeAfterProperties.push(p);if(typeof p.beforeDeserialization==="function")ps.beforeDeserialization.push(p);if(typeof p.afterDeserialization==="function")ps.afterDeserialization.push(p);if(typeof p.beforeSerialization==="function")ps.beforeSerialization.push(p);if(typeof p.afterSerialization==="function")ps.afterSerialization.push(p);});}}},{key:"knowsId",value:function knowsId(id){return!!this._id_ref_map[id];}},{key:"refForId",value:function refForId(id){return this._id_ref_map[id];}},{key:"resolveToObj",value:function resolveToObj(id){var ref=this._id_ref_map[id];return ref?ref.realObj:undefined;}},{key:"ref",value:function ref(obj){return this._obj_ref_map.get(obj);}},{key:"objects",value:function objects(){return Array.from(this._obj_ref_map.keys());}},{key:"objectRefs",value:function objectRefs(){return Array.from(this._obj_ref_map.values());}},{key:"internalAddRef",value:function internalAddRef(ref){if(ref.realObj)this._obj_ref_map.set(ref.realObj,ref);this._id_ref_map[ref.id]=ref;return ref;}},{key:"add",value:function add(obj){var _this7=this;// adds an object to the object pool and returns a "ref" object
// that is guaranteed to be JSON.stringifyable and that can be used as a place
// holder in a serialized graph / list
// primitive objects don't need to be registered
if(isPrimitive$1(obj))return undefined;if(Array.isArray(obj))return obj.map(function(element){return _this7.add(element);});var idPropertyName=obj.__serialization_id_property__||this.idPropertyName;return this.ref(obj)||this.internalAddRef(new ObjectRef(obj[idPropertyName]||this.uuidGen(),obj,undefined,this.idPropertyName));}},{key:"snapshot",value:function snapshot(id){// traverses the object graph and create serialized representation => snapshot
var snapshot={};this.plugin_beforeSerialization(snapshot,id);for(var _i53=0,ids=Object.keys(this._id_ref_map);_i53<ids.length;_i53++){var ref=this._id_ref_map[ids[_i53]];ref.snapshotObject(snapshot,this);}snapshot=this.plugin_afterSerialization(snapshot,id);return snapshot;}},{key:"snapshotObject",value:function snapshotObject(obj){var _this$add=this.add(obj),id=_this$add.id,snapshot=this.snapshot(id);return{id:id,snapshot:snapshot};}},{key:"readSnapshot",value:function readSnapshot(snapshot,rootId){// populates object pool with object refs read from the dead snapshot
if(snapshot.hasOwnProperty("id")){throw new Error("readSnapshot expects simple serialized object map, not id-snapshot pair!");}if(this.options.skipMigrations){// just recreate the root for now;
ObjectRef.fromSnapshot(rootId,snapshot,this,[],this.idPropertyName);}else{for(var i=0,ids=Object.keys(snapshot);i<ids.length;i++){if(!this.resolveToObj(ids[i]))ObjectRef.fromSnapshot(ids[i],snapshot,this,[],this.idPropertyName);}}return this;}},{key:"resolveFromSnapshotAndId",value:function resolveFromSnapshotAndId(idAndSnapshot){if(!idAndSnapshot.hasOwnProperty("id"))throw new Error("idAndSnapshot does not have id");if(!idAndSnapshot.hasOwnProperty("snapshot"))throw new Error("idAndSnapshot does not have snapshot");idAndSnapshot=this.plugin_beforeDeserialization(idAndSnapshot);var _idAndSnapshot=idAndSnapshot,id=_idAndSnapshot.id,snapshot=_idAndSnapshot.snapshot;this.readSnapshot(snapshot,id);this.plugin_afterDeserialization(idAndSnapshot);return this.resolveToObj(id);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"plugin_beforeSerialization",value:function plugin_beforeSerialization(snapshot,rootId){for(var i=0;i<this.plugins.beforeSerialization.length;i++){var p=this.plugins.beforeSerialization[i];p.beforeSerialization(this,snapshot,rootId);}}},{key:"plugin_afterSerialization",value:function plugin_afterSerialization(snapshot,rootId){for(var i=0;i<this.plugins.afterSerialization.length;i++){var p=this.plugins.afterSerialization[i],result=p.afterSerialization(this,snapshot,rootId);if(result)snapshot=result;}return snapshot;}},{key:"plugin_beforeDeserialization",value:function plugin_beforeDeserialization(idAndSnapshot){for(var i=0;i<this.plugins.beforeDeserialization.length;i++){var p=this.plugins.beforeDeserialization[i],result=p.beforeDeserialization(this,idAndSnapshot);if(result)idAndSnapshot=result;}return idAndSnapshot;}},{key:"plugin_afterDeserialization",value:function plugin_afterDeserialization(idAndSnapshot){for(var i=0;i<this.plugins.afterDeserialization.length;i++){var p=this.plugins.afterDeserialization[i];p.afterDeserialization(this,idAndSnapshot);}}},{key:"plugin_serializeObject",value:function plugin_serializeObject(realObj,isProperty,serializedObjMap,path){for(var i=0;i<this.plugins.serializeObject.length;i++){var p=this.plugins.serializeObject[i],serialized=p.serializeObject(realObj,isProperty,this,serializedObjMap,path);if(serialized)return serialized;}}},{key:"plugin_propertiesToSerialize",value:function plugin_propertiesToSerialize(ref,snapshot,keys){for(var i=0;i<this.plugins.propertiesToSerialize.length;i++){var p=this.plugins.propertiesToSerialize[i],result=p.propertiesToSerialize(this,ref,snapshot,keys);if(result)keys=result;}return keys;}},{key:"plugin_additionallySerialize",value:function plugin_additionallySerialize(ref,snapshot,serializedObjMap,path){// add more / custom stuff to snapshot or modify it somehow
var addFn=this.plugins.additionallySerialize.length?__additionally_serialize__addObjectFunction(ref,snapshot,serializedObjMap,this,path):null;for(var i=0;i<this.plugins.additionallySerialize.length;i++){var p=this.plugins.additionallySerialize[i];p.additionallySerialize(this,ref,snapshot,addFn);}}},{key:"plugin_deserializeObject",value:function plugin_deserializeObject(ref,snapshot,path){for(var _i54=0;_i54<this.plugins.deserializeObject.length;_i54++){var _p2=this.plugins.deserializeObject[_i54],newObj=_p2.deserializeObject(this,ref,snapshot,path);if(newObj)return newObj;}}},{key:"plugin_additionallyDeserializeBeforeProperties",value:function plugin_additionallyDeserializeBeforeProperties(ref,newObj,props,snapshot,serializedObjMap,path){for(var _i55=0;_i55<this.plugins.additionallyDeserializeBeforeProperties.length;_i55++){var _p3=this.plugins.additionallyDeserializeBeforeProperties[_i55],result=_p3.additionallyDeserializeBeforeProperties(this,ref,newObj,props,snapshot,serializedObjMap,path);if(result)props=result;}return props;}},{key:"plugin_additionallyDeserializeAfterProperties",value:function plugin_additionallyDeserializeAfterProperties(ref,newObj,snapshot,serializedObjMap,path){for(var _i56=0;_i56<this.plugins.additionallyDeserializeAfterProperties.length;_i56++){var _p4=this.plugins.additionallyDeserializeAfterProperties[_i56];_p4.additionallyDeserializeAfterProperties(this,ref,newObj,snapshot,serializedObjMap,path);}}}]);return ObjectPool;}();// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// ObjectRef
function __additionally_serialize__addObjectFunction(objRef,snapshot,serializedObjMap,pool){var path=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];// passed into __additionally_serialize__ as a parameter to allow object to add
// other objects to serialization
return function(key,value){var verbatim=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return snapshot.props[key]=verbatim?{value:value,verbatim:verbatim}:{value:objRef.snapshotProperty(objRef.id,value,path.concat([key]),serializedObjMap,pool)};};}var ObjectRef=/*#__PURE__*/function(){_createClass(ObjectRef,null,[{key:"fromSnapshot",value:function fromSnapshot(id,snapshot,pool){var path=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var idPropertyName=arguments.length>4?arguments[4]:undefined;var ref=new this(id,undefined,undefined,idPropertyName);try{return pool.internalAddRef(ref).recreateObjFromSnapshot(snapshot,pool,path);}catch(err){if(pool.options.highlightBuggyMorphs){var _m2;while(path.length){_m2=Path(path).map(function(key,value){if(key=="submorphs")return value.filter(function(m){return!m.isHand&&!m.isEpiMorph;});return value;}).get(pool.options.rootObject);// filter the submorph props via epiMorph
if(_m2&&_m2.isMorph&&_m2.world()){_m2.show(true);pool.options.highlightBuggyMorphs=false;break;}path.pop();}}throw err;}}}]);function ObjectRef(id,realObj,snapshot){var idPropertyName=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"id";_classCallCheck(this,ObjectRef);this.id=id;this.idPropertyName=idPropertyName;this.realObj=realObj;this.snapshotVersions=[];this.snapshots={};if(snapshot){var rev=snapshot.rev||0;this.snapshotVersions.push(rev);this.snapshots[rev]=snapshot;}}_createClass(ObjectRef,[{key:"asRefForSerializedObjMap",value:function asRefForSerializedObjMap(){var rev=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"????";return{__ref__:true,id:this.id,rev:rev};}},{key:"snapshotObject",value:function snapshotObject(serializedObjMap,pool){var path=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(path.length>100)throw new Error("Stopping serializer, encountered a possibly infinit loop: ".concat(path.join(".")));var id=this.id,realObj=this.realObj,snapshots=this.snapshots,rev,ref;if(!realObj){console.error("Cannot marshall object ref ".concat(id,", no real object!"));return _objectSpread(_objectSpread({},this.asRefForSerializedObjMap()),{},{isMissing:true});}rev=realObj._rev||0;ref=this.asRefForSerializedObjMap(rev);pushIfNotIncluded(this.snapshotVersions,rev);// do we already have serialized a current version of realObj?
if(snapshots[rev]){if(!serializedObjMap[id])serializedObjMap[id]=snapshots[rev];return ref;}var idType=_typeof2(id);if(idType==="number"){id=String(id);idType="string";}if(idType!=="string"){throw new Error("Error snapshoting ".concat(realObj,": ")+"id is not a string but ".concat(id," ")+"(serialization path: ".concat(path.join("."),")"));}var serialized=pool.plugin_serializeObject(realObj,false,serializedObjMap,path);if(serialized){snapshots[rev]=serializedObjMap[id]=serialized;return ref;}// serialize properties
var keys=Object.getOwnPropertyNames(realObj),props={},snapshot=snapshots[rev]=serializedObjMap[id]={rev:rev,props:props},pluginKeys=pool.plugin_propertiesToSerialize(this,snapshot,keys);if(pluginKeys)keys=pluginKeys;// do the generic serialization, i.e. enumerate all properties and
for(var i=0;i<keys.length;i++){var key=keys[i];props[key]={value:this.snapshotProperty(id,realObj[key],path.concat([key]),serializedObjMap,pool)};}// add more / custom stuff to snapshot or modify it somehow    
pool.plugin_additionallySerialize(this,snapshot,serializedObjMap,path);return ref;}},{key:"snapshotProperty",value:function snapshotProperty(sourceObjId,value,path,serializedObjMap,pool){var _this8=this;// returns the value to serialize, i.e. what to put into the snapshot object
if(isPrimitive$1(value))return value;// stored as is
var serialized=pool.plugin_serializeObject(value,true,serializedObjMap,path);if(serialized)return serialized;if(typeof value==="function")return undefined;// FIXME
if(Array.isArray(value))return value.map(function(ea,i){return _this8.snapshotProperty(sourceObjId,ea,path.concat(i),serializedObjMap,pool);});var objectRef=pool.add(value);return!objectRef||!objectRef.isObjectRef?objectRef:objectRef.snapshotObject(serializedObjMap,pool,path);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"recreateObjFromSnapshot",value:function recreateObjFromSnapshot(serializedObjMap,pool,path){// serializedObjMap: map from ids to object snapshots
if(this.realObj)return this;var snapshot=serializedObjMap[this.id];if(!snapshot){console.error("Cannot recreateObjFromSnapshot ObjectRef "+"".concat(this.id," b/c of missing snapshot in snapshot map!"));return this;}var rev=snapshot.rev,newObj;rev=rev||0;this.snapshotVersions.push(rev);this.snapshots[rev]=snapshot;newObj=pool.plugin_deserializeObject(this,snapshot,path);if(!newObj)newObj={};if(typeof newObj._rev==="undefined"&&_typeof2(newObj)==="object")newObj._rev=rev||0;this.realObj=newObj;pool.internalAddRef(this);// for updating realObj
if(!newObj)return this;var props=snapshot.props;var pluginProps=pool.plugin_additionallyDeserializeBeforeProperties(this,newObj,props,snapshot,serializedObjMap,path);if(pluginProps)props=pluginProps;if(props){// deserialize generic properties
for(var key in props){this.recreatePropertyAndSetProperty(newObj,props,key,serializedObjMap,pool,path);}}var idPropertyName=newObj.__serialization_id_property__||this.idPropertyName;if(pool.reinitializeIds&&newObj.hasOwnProperty(idPropertyName))newObj[idPropertyName]=pool.reinitializeIds(this.id,this);pool.plugin_additionallyDeserializeAfterProperties(this,newObj,snapshot,serializedObjMap,path);return this;}},{key:"recreatePropertyAndSetProperty",value:function recreatePropertyAndSetProperty(newObj,props,key,serializedObjMap,pool,path){try{var _ref11=props[key]||{value:"NON EXISTING"},verbatim=_ref11.verbatim,value=_ref11.value;newObj[key]=verbatim?value:this.recreateProperty(key,value,serializedObjMap,pool,path.concat(key));}catch(e){var objString;try{objString=String(newObj);}catch(e){objString="[some ".concat(newObj.constructor.name,"]");}if(!e.__seen){var printedProp="".concat(key," of ").concat(objString," (").concat(JSON.stringify(value),")");console.error("Error deserializing property ".concat(printedProp));e.__seen=true;}else console.error("Error deserializing property ".concat(key," of ").concat(objString));throw e;}}},{key:"recreateProperty",value:function recreateProperty(key,value,serializedObjMap,pool,path){var _this9=this;if(typeof value==="string"&&pool.expressionSerializer.isSerializedExpression(value))return pool.expressionSerializer.deserializeExpr(value);if(isPrimitive$1(value))return value;if(Array.isArray(value))return value.map(function(ea,i){return _this9.recreateProperty(i,ea,serializedObjMap,pool,path.concat(i));});var idPropertyName=value.__serialization_id_property__||this.idPropertyName,valueRef=pool.refForId(value[idPropertyName])||ObjectRef.fromSnapshot(value[idPropertyName],serializedObjMap,pool,path,this.idPropertyName);return valueRef.realObj;}},{key:"isObjectRef",get:function get(){return true;}},{key:"currentSnapshot",get:function get(){var rev;if(!this.snapshotVersions.length){rev=0;this.snapshotVersions.push(rev);}else rev=last(this.snapshotVersions);return this.snapshots[rev]||(this.snapshots[rev]={rev:rev,props:{}});}},{key:"currentRev",get:function get(){return this.snapshotVersions.length?last(this.snapshotVersions):0;}}]);return ObjectRef;}();var version="0.1.3";/* global alert */function referenceGraph(snapshot){var g={};for(var id in snapshot){g[id]=referencesOfId(snapshot,id);}return g;}function isReference(value){return value&&value.__ref__;}function referencesOfId(snapshot,id,withPath){// all the ids an regObj (given by id) points to
var ref=snapshot[id];var result=[];for(var key in ref.props){var _ref12=ref.props[key]||{},value=_ref12.value,verbatim=_ref12.verbatim;if(Array.isArray(value)){result.push.apply(result,_toConsumableArray2(referencesInArray(value,withPath&&key)));continue;}if(verbatim||!value||!isReference(value))continue;result.push(withPath?{key:key,id:value.id}:value.id);}// FIXME hack for maps and sets...
if(ref.hasOwnProperty('entries')){for(var _i57=0;_i57<ref.entries.length;_i57++){var entry=ref.entries[_i57];if(Array.isArray(entry)){result.push.apply(result,_toConsumableArray2(referencesInArray(entry,withPath&&entry)));continue;}else if(!entry||!isReference(entry));else result.push(withPath?{key:entry,id:entry.id}:entry.id);}}return result;}function referencesInArray(arr,optPath){// helper for referencesOfId
var result=[];for(var _i58=0;_i58<arr.length;_i58++){var value=arr[_i58];if(Array.isArray(value)){var _path=optPath?optPath+'['+_i58+']':undefined;result.push.apply(result,_toConsumableArray2(referencesInArray(value,_path)));continue;}if(!value||!isReference(value))continue;result.push(optPath?{key:optPath+'['+_i58+']',id:value.id}:value.id);}return result;}function classNameOfId(snapshot,id){var ref=snapshot[id];var _ref13=ref[ClassHelper.classMetaForSerializationProp]||{},className=_ref13.className;return className||'Object';}function removeUnreachableObjects(rootIds,snapshot){var idsToRemove=withoutAll(Object.keys(snapshot),rootIds);var garbageCollectedConnections=idsToRemove.filter(function(id){if(classNameOfId(snapshot,id)==='AttributeConnection'){return snapshot[id].props.garbageCollect.value;}});var refGraph=referenceGraph(dissoc(_objectSpread({},snapshot),garbageCollectedConnections));rootIds.forEach(function(rootId){var subGraph=subgraphReachableBy(refGraph,rootId);for(var _i59=idsToRemove.length;_i59--;){var id=idsToRemove[_i59];if(id in subGraph)idsToRemove.splice(_i59,1);}});idsToRemove.forEach(function(id){return delete snapshot[id];});return idsToRemove;}function clearDanglingConnections(snapshot){var _loop2=function _loop2(id){if(classNameOfId(snapshot,id)==='AttributeConnection'){var objSnap=snapshot[id];if(snapshot[Path('props.targetObj.value.id').get(objSnap)])return"continue";var sourceObjSnap=snapshot[Path('props.sourceObj.value.id').get(objSnap)];if(sourceObjSnap){sourceObjSnap.props.attributeConnections.value=sourceObjSnap.props.attributeConnections.value.filter(function(ref){return ref.id!=id;});}delete snapshot[id];}};for(var id in snapshot){var _ret3=_loop2(id);if(_ret3==="continue")continue;}}var defaultExprSerializer=new ExpressionSerializer();function requiredModulesOfSnapshot(snapshot){var exprSerializer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:defaultExprSerializer;// knows how to extract lively.modules packages/modules from __expr__ and
// class data
if(snapshot.snapshot)snapshot=snapshot.snapshot;var modules=[];for(var _i60=0,ids=Object.keys(snapshot);_i60<ids.length;_i60++){var ref=snapshot[ids[_i60]];if(ref.__expr__){var _modules;var exprModules=exprSerializer.requiredModulesOf__expr__(ref.__expr__);if(exprModules)(_modules=modules).push.apply(_modules,_toConsumableArray2(exprModules));continue;}var classModules=ClassHelper.sourceModulesInObjRef(ref);if(classModules&&classModules.length){var _modules2;(_modules2=modules).push.apply(_modules2,_toConsumableArray2(classModules.map(function(spec){return(spec["package"]&&spec["package"].name||'')+'/'+spec.pathInPackage;})));}if(ref.props){for(var _j9 in ref.props){var val=ref.props[_j9].value;if(typeof val==='string'){var _modules3;var _exprModules=exprSerializer.requiredModulesOf__expr__(val);if(_exprModules)(_modules3=modules).push.apply(_modules3,_toConsumableArray2(_exprModules));}if(isArray$1(val)){// scan each array entry for expressions
val.forEach(function(val){if(typeof val==='string'){var _modules4;var _exprModules2=exprSerializer.requiredModulesOf__expr__(val);if(_exprModules2)(_modules4=modules).push.apply(_modules4,_toConsumableArray2(_exprModules2));}});}}}}modules=uniq(modules);return modules;}var e,t,n,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:global,o=e={};function i(){throw new Error("setTimeout has not been defined");}function u(){throw new Error("clearTimeout has not been defined");}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0);}catch(n){try{return t.call(null,e,0);}catch(n){return t.call(this||r,e,0);}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i;}catch(e){t=i;}try{n="function"==typeof clearTimeout?clearTimeout:u;}catch(e){n=u;}}();var l,s=[],f=!1,a=-1;function h(){f&&l&&(f=!1,l.length?s=l.concat(s):a=-1,s.length&&d());}function d(){if(!f){var e=c(h);f=!0;for(var t=s.length;t;){for(l=s,s=[];++a<t;){l&&l[a].run();}a=-1,t=s.length;}l=null,f=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===u||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e);}catch(t){try{return n.call(null,e);}catch(t){return n.call(this||r,e);}}}(e);}}function m(e,t){(this||r).fun=e,(this||r).array=t;}function p(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n];}s.push(new m(e,t)),1!==s.length||f||c(d);},m.prototype.run=function(){(this||r).fun.apply(null,(this||r).array);},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=p,o.addListener=p,o.once=p,o.off=p,o.removeListener=p,o.removeAllListeners=p,o.emit=p,o.prependListener=p,o.prependOnceListener=p,o.listeners=function(e){return[];},o.binding=function(e){throw new Error("process.binding is not supported");},o.cwd=function(){return"/";},o.chdir=function(e){throw new Error("process.chdir is not supported");},o.umask=function(){return 0;};var T=e;var addListener=T.addListener;var argv=T.argv;var binding=T.binding;var browser=T.browser;var chdir=T.chdir;var cwd=T.cwd;var emit=T.emit;var env=T.env;var listeners=T.listeners;var nextTick=T.nextTick;var off=T.off;var on=T.on;var once$2=T.once;var prependListener=T.prependListener;var prependOnceListener=T.prependOnceListener;var removeAllListeners=T.removeAllListeners;var removeListener=T.removeListener;var title=T.title;var umask=T.umask;var version$1=T.version;var versions=T.versions;var exports$6={},_dewExec=false;function dew(){if(_dewExec)return exports$6;_dewExec=true;// Note: this is the semver.org version of the spec that it implements
// Not necessarily the package version of this code.
var SEMVER_SPEC_VERSION="2.0.0";var MAX_LENGTH=256;var MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||/* istanbul ignore next */9007199254740991;// Max safe segment length for coercion.
var MAX_SAFE_COMPONENT_LENGTH=16;exports$6={SEMVER_SPEC_VERSION:SEMVER_SPEC_VERSION,MAX_LENGTH:MAX_LENGTH,MAX_SAFE_INTEGER:MAX_SAFE_INTEGER,MAX_SAFE_COMPONENT_LENGTH:MAX_SAFE_COMPONENT_LENGTH};return exports$6;}var exports$1$2={},_dewExec$1=false;function dew$1(){if(_dewExec$1)return exports$1$2;_dewExec$1=true;var process=T;var debug=_typeof2(process)==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var _console;for(var _len2=arguments.length,args=new Array(_len2),_key9=0;_key9<_len2;_key9++){args[_key9]=arguments[_key9];}return(_console=console).error.apply(_console,["SEMVER"].concat(args));}:function(){};exports$1$2=debug;return exports$1$2;}var exports$2$1={},_dewExec$2=false;function dew$2(){if(_dewExec$2)return exports$2$1;_dewExec$2=true;var _dew=dew(),MAX_SAFE_COMPONENT_LENGTH=_dew.MAX_SAFE_COMPONENT_LENGTH;var debug=dew$1();exports$2$1=exports$2$1={};// The actual regexps go on exports.re
var re=exports$2$1.re=[];var src=exports$2$1.src=[];var t=exports$2$1.t={};var R=0;var createToken=function createToken(name,value,isGlobal){var index=R++;debug(index,value);t[name]=index;src[index]=value;re[index]=new RegExp(value,isGlobal?"g":undefined);};// The following Regular Expressions can be used for tokenizing,
// validating, and parsing SemVer version strings.
// ## Numeric Identifier
// A single `0`, or a non-zero digit followed by zero or more digits.
createToken("NUMERICIDENTIFIER","0|[1-9]\\d*");createToken("NUMERICIDENTIFIERLOOSE","[0-9]+");// ## Non-numeric Identifier
// Zero or more digits, followed by a letter or hyphen, and then zero or
// more letters, digits, or hyphens.
createToken("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");// ## Main Version
// Three dot-separated numeric identifiers.
createToken("MAINVERSION","(".concat(src[t.NUMERICIDENTIFIER],")\\.")+"(".concat(src[t.NUMERICIDENTIFIER],")\\.")+"(".concat(src[t.NUMERICIDENTIFIER],")"));createToken("MAINVERSIONLOOSE","(".concat(src[t.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(src[t.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(src[t.NUMERICIDENTIFIERLOOSE],")"));// ## Pre-release Version Identifier
// A numeric identifier, or a non-numeric identifier.
createToken("PRERELEASEIDENTIFIER","(?:".concat(src[t.NUMERICIDENTIFIER],"|").concat(src[t.NONNUMERICIDENTIFIER],")"));createToken("PRERELEASEIDENTIFIERLOOSE","(?:".concat(src[t.NUMERICIDENTIFIERLOOSE],"|").concat(src[t.NONNUMERICIDENTIFIER],")"));// ## Pre-release Version
// Hyphen, followed by one or more dot-separated pre-release version
// identifiers.
createToken("PRERELEASE","(?:-(".concat(src[t.PRERELEASEIDENTIFIER],"(?:\\.").concat(src[t.PRERELEASEIDENTIFIER],")*))"));createToken("PRERELEASELOOSE","(?:-?(".concat(src[t.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(src[t.PRERELEASEIDENTIFIERLOOSE],")*))"));// ## Build Metadata Identifier
// Any combination of digits, letters, or hyphens.
createToken("BUILDIDENTIFIER","[0-9A-Za-z-]+");// ## Build Metadata
// Plus sign, followed by one or more period-separated build metadata
// identifiers.
createToken("BUILD","(?:\\+(".concat(src[t.BUILDIDENTIFIER],"(?:\\.").concat(src[t.BUILDIDENTIFIER],")*))"));// ## Full Version String
// A main version, followed optionally by a pre-release version and
// build metadata.
// Note that the only major, minor, patch, and pre-release sections of
// the version string are capturing groups.  The build metadata is not a
// capturing group, because it should not ever be used in version
// comparison.
createToken("FULLPLAIN","v?".concat(src[t.MAINVERSION]).concat(src[t.PRERELEASE],"?").concat(src[t.BUILD],"?"));createToken("FULL","^".concat(src[t.FULLPLAIN],"$"));// like full, but allows v1.2.3 and =1.2.3, which people do sometimes.
// also, 1.0.0alpha1 (prerelease without the hyphen) which is pretty
// common in the npm registry.
createToken("LOOSEPLAIN","[v=\\s]*".concat(src[t.MAINVERSIONLOOSE]).concat(src[t.PRERELEASELOOSE],"?").concat(src[t.BUILD],"?"));createToken("LOOSE","^".concat(src[t.LOOSEPLAIN],"$"));createToken("GTLT","((?:<|>)?=?)");// Something like "2.*" or "1.2.x".
// Note that "x.x" is a valid xRange identifer, meaning "any version"
// Only the first item is strictly required.
createToken("XRANGEIDENTIFIERLOOSE","".concat(src[t.NUMERICIDENTIFIERLOOSE],"|x|X|\\*"));createToken("XRANGEIDENTIFIER","".concat(src[t.NUMERICIDENTIFIER],"|x|X|\\*"));createToken("XRANGEPLAIN","[v=\\s]*(".concat(src[t.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(src[t.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(src[t.XRANGEIDENTIFIER],")")+"(?:".concat(src[t.PRERELEASE],")?").concat(src[t.BUILD],"?")+")?)?");createToken("XRANGEPLAINLOOSE","[v=\\s]*(".concat(src[t.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(src[t.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(src[t.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(src[t.PRERELEASELOOSE],")?").concat(src[t.BUILD],"?")+")?)?");createToken("XRANGE","^".concat(src[t.GTLT],"\\s*").concat(src[t.XRANGEPLAIN],"$"));createToken("XRANGELOOSE","^".concat(src[t.GTLT],"\\s*").concat(src[t.XRANGEPLAINLOOSE],"$"));// Coercion.
// Extract anything that could conceivably be a part of a valid semver
createToken("COERCE","".concat("(^|[^\\d])"+"(\\d{1,").concat(MAX_SAFE_COMPONENT_LENGTH,"})")+"(?:\\.(\\d{1,".concat(MAX_SAFE_COMPONENT_LENGTH,"}))?")+"(?:\\.(\\d{1,".concat(MAX_SAFE_COMPONENT_LENGTH,"}))?")+"(?:$|[^\\d])");createToken("COERCERTL",src[t.COERCE],true);// Tilde ranges.
// Meaning is "reasonably at or greater than"
createToken("LONETILDE","(?:~>?)");createToken("TILDETRIM","(\\s*)".concat(src[t.LONETILDE],"\\s+"),true);exports$2$1.tildeTrimReplace="$1~";createToken("TILDE","^".concat(src[t.LONETILDE]).concat(src[t.XRANGEPLAIN],"$"));createToken("TILDELOOSE","^".concat(src[t.LONETILDE]).concat(src[t.XRANGEPLAINLOOSE],"$"));// Caret ranges.
// Meaning is "at least and backwards compatible with"
createToken("LONECARET","(?:\\^)");createToken("CARETTRIM","(\\s*)".concat(src[t.LONECARET],"\\s+"),true);exports$2$1.caretTrimReplace="$1^";createToken("CARET","^".concat(src[t.LONECARET]).concat(src[t.XRANGEPLAIN],"$"));createToken("CARETLOOSE","^".concat(src[t.LONECARET]).concat(src[t.XRANGEPLAINLOOSE],"$"));// A simple gt/lt/eq thing, or just "" to indicate "any version"
createToken("COMPARATORLOOSE","^".concat(src[t.GTLT],"\\s*(").concat(src[t.LOOSEPLAIN],")$|^$"));createToken("COMPARATOR","^".concat(src[t.GTLT],"\\s*(").concat(src[t.FULLPLAIN],")$|^$"));// An expression to strip any whitespace between the gtlt and the thing
// it modifies, so that `> 1.2.3` ==> `>1.2.3`
createToken("COMPARATORTRIM","(\\s*)".concat(src[t.GTLT],"\\s*(").concat(src[t.LOOSEPLAIN],"|").concat(src[t.XRANGEPLAIN],")"),true);exports$2$1.comparatorTrimReplace="$1$2$3";// Something like `1.2.3 - 1.2.4`
// Note that these all use the loose form, because they'll be
// checked against either the strict or loose comparator form
// later.
createToken("HYPHENRANGE","^\\s*(".concat(src[t.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(src[t.XRANGEPLAIN],")")+"\\s*$");createToken("HYPHENRANGELOOSE","^\\s*(".concat(src[t.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(src[t.XRANGEPLAINLOOSE],")")+"\\s*$");// Star ranges basically just allow anything at all.
createToken("STAR","(<|>)?=?\\s*\\*");// >=0.0.0 is like a star
createToken("GTE0","^\\s*>=\\s*0.0.0\\s*$");createToken("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$");return exports$2$1;}var exports$3$1={},_dewExec$3=false;function dew$3(){if(_dewExec$3)return exports$3$1;_dewExec$3=true;// parse out just the options we care about so we always get a consistent
// obj with keys in a consistent order.
var opts=["includePrerelease","loose","rtl"];var parseOptions=function parseOptions(options){return!options?{}:_typeof2(options)!=="object"?{loose:true}:opts.filter(function(k){return options[k];}).reduce(function(options,k){options[k]=true;return options;},{});};exports$3$1=parseOptions;return exports$3$1;}var exports$4$1={},_dewExec$4=false;function dew$4(){if(_dewExec$4)return exports$4$1;_dewExec$4=true;var numeric=/^[0-9]+$/;var compareIdentifiers=function compareIdentifiers(a,b){var anum=numeric.test(a);var bnum=numeric.test(b);if(anum&&bnum){a=+a;b=+b;}return a===b?0:anum&&!bnum?-1:bnum&&!anum?1:a<b?-1:1;};var rcompareIdentifiers=function rcompareIdentifiers(a,b){return compareIdentifiers(b,a);};exports$4$1={compareIdentifiers:compareIdentifiers,rcompareIdentifiers:rcompareIdentifiers};return exports$4$1;}var exports$5$1={},_dewExec$5=false;function dew$5(){if(_dewExec$5)return exports$5$1;_dewExec$5=true;var debug=dew$1();var _dew2=dew(),MAX_LENGTH=_dew2.MAX_LENGTH,MAX_SAFE_INTEGER=_dew2.MAX_SAFE_INTEGER;var _dew$=dew$2(),re=_dew$.re,t=_dew$.t;var parseOptions=dew$3();var _dew$2=dew$4(),compareIdentifiers=_dew$2.compareIdentifiers;var SemVer=/*#__PURE__*/function(){function SemVer(version,options){_classCallCheck(this,SemVer);options=parseOptions(options);if(version instanceof SemVer){if(version.loose===!!options.loose&&version.includePrerelease===!!options.includePrerelease){return version;}else{version=version.version;}}else if(typeof version!=="string"){throw new TypeError("Invalid Version: ".concat(version));}if(version.length>MAX_LENGTH){throw new TypeError("version is longer than ".concat(MAX_LENGTH," characters"));}debug("SemVer",version,options);this.options=options;this.loose=!!options.loose;// this isn't actually relevant for versions, but keep it so that we
// don't run into trouble passing this.options around.
this.includePrerelease=!!options.includePrerelease;var m=version.trim().match(options.loose?re[t.LOOSE]:re[t.FULL]);if(!m){throw new TypeError("Invalid Version: ".concat(version));}this.raw=version;// these are actually numbers
this.major=+m[1];this.minor=+m[2];this.patch=+m[3];if(this.major>MAX_SAFE_INTEGER||this.major<0){throw new TypeError("Invalid major version");}if(this.minor>MAX_SAFE_INTEGER||this.minor<0){throw new TypeError("Invalid minor version");}if(this.patch>MAX_SAFE_INTEGER||this.patch<0){throw new TypeError("Invalid patch version");}// numberify any prerelease numeric ids
if(!m[4]){this.prerelease=[];}else{this.prerelease=m[4].split(".").map(function(id){if(/^[0-9]+$/.test(id)){var _num=+id;if(_num>=0&&_num<MAX_SAFE_INTEGER){return _num;}}return id;});}this.build=m[5]?m[5].split("."):[];this.format();}_createClass(SemVer,[{key:"format",value:function format(){this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch);if(this.prerelease.length){this.version+="-".concat(this.prerelease.join("."));}return this.version;}},{key:"toString",value:function toString(){return this.version;}},{key:"compare",value:function compare(other){debug("SemVer.compare",this.version,this.options,other);if(!(other instanceof SemVer)){if(typeof other==="string"&&other===this.version){return 0;}other=new SemVer(other,this.options);}if(other.version===this.version){return 0;}return this.compareMain(other)||this.comparePre(other);}},{key:"compareMain",value:function compareMain(other){if(!(other instanceof SemVer)){other=new SemVer(other,this.options);}return compareIdentifiers(this.major,other.major)||compareIdentifiers(this.minor,other.minor)||compareIdentifiers(this.patch,other.patch);}},{key:"comparePre",value:function comparePre(other){if(!(other instanceof SemVer)){other=new SemVer(other,this.options);}// NOT having a prerelease is > having one
if(this.prerelease.length&&!other.prerelease.length){return-1;}else if(!this.prerelease.length&&other.prerelease.length){return 1;}else if(!this.prerelease.length&&!other.prerelease.length){return 0;}var i=0;do{var _a2=this.prerelease[i];var _b2=other.prerelease[i];debug("prerelease compare",i,_a2,_b2);if(_a2===undefined&&_b2===undefined){return 0;}else if(_b2===undefined){return 1;}else if(_a2===undefined){return-1;}else if(_a2===_b2){continue;}else{return compareIdentifiers(_a2,_b2);}}while(++i);}},{key:"compareBuild",value:function compareBuild(other){if(!(other instanceof SemVer)){other=new SemVer(other,this.options);}var i=0;do{var _a3=this.build[i];var _b3=other.build[i];debug("prerelease compare",i,_a3,_b3);if(_a3===undefined&&_b3===undefined){return 0;}else if(_b3===undefined){return 1;}else if(_a3===undefined){return-1;}else if(_a3===_b3){continue;}else{return compareIdentifiers(_a3,_b3);}}while(++i);}// preminor will bump the version up to the next minor release, and immediately
// down to pre-release. premajor and prepatch work the same way.
},{key:"inc",value:function inc(release,identifier){switch(release){case"premajor":this.prerelease.length=0;this.patch=0;this.minor=0;this.major++;this.inc("pre",identifier);break;case"preminor":this.prerelease.length=0;this.patch=0;this.minor++;this.inc("pre",identifier);break;case"prepatch":// If this is already a prerelease, it will bump to the next version
// drop any prereleases that might already exist, since they are not
// relevant at this point.
this.prerelease.length=0;this.inc("patch",identifier);this.inc("pre",identifier);break;// If the input is a non-prerelease version, this acts the same as
// prepatch.
case"prerelease":if(this.prerelease.length===0){this.inc("patch",identifier);}this.inc("pre",identifier);break;case"major":// If this is a pre-major version, bump up to the same major version.
// Otherwise increment major.
// 1.0.0-5 bumps to 1.0.0
// 1.1.0 bumps to 2.0.0
if(this.minor!==0||this.patch!==0||this.prerelease.length===0){this.major++;}this.minor=0;this.patch=0;this.prerelease=[];break;case"minor":// If this is a pre-minor version, bump up to the same minor version.
// Otherwise increment minor.
// 1.2.0-5 bumps to 1.2.0
// 1.2.1 bumps to 1.3.0
if(this.patch!==0||this.prerelease.length===0){this.minor++;}this.patch=0;this.prerelease=[];break;case"patch":// If this is not a pre-release version, it will increment the patch.
// If it is a pre-release it will bump up to the same patch version.
// 1.2.0-5 patches to 1.2.0
// 1.2.0 patches to 1.2.1
if(this.prerelease.length===0){this.patch++;}this.prerelease=[];break;// This probably shouldn't be used publicly.
// 1.0.0 'pre' would become 1.0.0-0 which is the wrong direction.
case"pre":if(this.prerelease.length===0){this.prerelease=[0];}else{var _i61=this.prerelease.length;while(--_i61>=0){if(typeof this.prerelease[_i61]==="number"){this.prerelease[_i61]++;_i61=-2;}}if(_i61===-1){// didn't increment anything
this.prerelease.push(0);}}if(identifier){// 1.2.0-beta.1 bumps to 1.2.0-beta.2,
// 1.2.0-beta.fooblz or 1.2.0-beta bumps to 1.2.0-beta.0
if(this.prerelease[0]===identifier){if(isNaN(this.prerelease[1])){this.prerelease=[identifier,0];}}else{this.prerelease=[identifier,0];}}break;default:throw new Error("invalid increment argument: ".concat(release));}this.format();this.raw=this.version;return this;}}]);return SemVer;}();exports$5$1=SemVer;return exports$5$1;}var exports$7={},_dewExec$6=false;function dew$6(){if(_dewExec$6)return exports$7;_dewExec$6=true;var _dew3=dew(),MAX_LENGTH=_dew3.MAX_LENGTH;var _dew$3=dew$2(),re=_dew$3.re,t=_dew$3.t;var SemVer=dew$5();var parseOptions=dew$3();var parse=function parse(version,options){options=parseOptions(options);if(version instanceof SemVer){return version;}if(typeof version!=="string"){return null;}if(version.length>MAX_LENGTH){return null;}var r=options.loose?re[t.LOOSE]:re[t.FULL];if(!r.test(version)){return null;}try{return new SemVer(version,options);}catch(er){return null;}};exports$7=parse;return exports$7;}var exports$8={},_dewExec$7=false;function dew$7(){if(_dewExec$7)return exports$8;_dewExec$7=true;var parse=dew$6();var valid=function valid(version,options){var v=parse(version,options);return v?v.version:null;};exports$8=valid;return exports$8;}var exports$9={},_dewExec$8=false;function dew$8(){if(_dewExec$8)return exports$9;_dewExec$8=true;var SemVer=dew$5();var inc=function inc(version,release,options,identifier){if(typeof options==="string"){identifier=options;options=undefined;}try{return new SemVer(version,options).inc(release,identifier).version;}catch(er){return null;}};exports$9=inc;return exports$9;}var exports$a={},_dewExec$9=false;function dew$9(){if(_dewExec$9)return exports$a;_dewExec$9=true;var SemVer=dew$5();var compare=function compare(a,b,loose){return new SemVer(a,loose).compare(new SemVer(b,loose));};exports$a=compare;return exports$a;}var exports$b={},_dewExec$a=false;function dew$a(){if(_dewExec$a)return exports$b;_dewExec$a=true;var compare=dew$9();var eq=function eq(a,b,loose){return compare(a,b,loose)===0;};exports$b=eq;return exports$b;}var exports$c={},_dewExec$b=false;function dew$b(){if(_dewExec$b)return exports$c;_dewExec$b=true;var parse=dew$6();var eq=dew$a();var diff=function diff(version1,version2){if(eq(version1,version2)){return null;}else{var v1=parse(version1);var v2=parse(version2);var hasPre=v1.prerelease.length||v2.prerelease.length;var prefix=hasPre?"pre":"";var defaultResult=hasPre?"prerelease":"";for(var key in v1){if(key==="major"||key==="minor"||key==="patch"){if(v1[key]!==v2[key]){return prefix+key;}}}return defaultResult;// may be undefined
}};exports$c=diff;return exports$c;}var exports$d={},_dewExec$c=false;function dew$c(){if(_dewExec$c)return exports$d;_dewExec$c=true;var SemVer=dew$5();var major=function major(a,loose){return new SemVer(a,loose).major;};exports$d=major;return exports$d;}var exports$e={},_dewExec$d=false;function dew$d(){if(_dewExec$d)return exports$e;_dewExec$d=true;var parse=dew$6();var prerelease=function prerelease(version,options){var parsed=parse(version,options);return parsed&&parsed.prerelease.length?parsed.prerelease:null;};exports$e=prerelease;return exports$e;}var exports$f={},_dewExec$e=false;function dew$e(){if(_dewExec$e)return exports$f;_dewExec$e=true;var compare=dew$9();var rcompare=function rcompare(a,b,loose){return compare(b,a,loose);};exports$f=rcompare;return exports$f;}var exports$g={},_dewExec$f=false;function dew$f(){if(_dewExec$f)return exports$g;_dewExec$f=true;var SemVer=dew$5();var compareBuild=function compareBuild(a,b,loose){var versionA=new SemVer(a,loose);var versionB=new SemVer(b,loose);return versionA.compare(versionB)||versionA.compareBuild(versionB);};exports$g=compareBuild;return exports$g;}var exports$1$3={},_dewExec$1$1=false;function dew$1$1(){if(_dewExec$1$1)return exports$1$3;_dewExec$1$1=true;var compareBuild=dew$f();var rsort=function rsort(list,loose){return list.sort(function(a,b){return compareBuild(b,a,loose);});};exports$1$3=rsort;return exports$1$3;}var exports$h={},_dewExec$g=false;function dew$g(){if(_dewExec$g)return exports$h;_dewExec$g=true;var compare=dew$9();var gt=function gt(a,b,loose){return compare(a,b,loose)>0;};exports$h=gt;return exports$h;}var exports$i={},_dewExec$h=false;function dew$h(){if(_dewExec$h)return exports$i;_dewExec$h=true;var compare=dew$9();var lt=function lt(a,b,loose){return compare(a,b,loose)<0;};exports$i=lt;return exports$i;}var exports$j={},_dewExec$i=false;function dew$i(){if(_dewExec$i)return exports$j;_dewExec$i=true;var compare=dew$9();var gte=function gte(a,b,loose){return compare(a,b,loose)>=0;};exports$j=gte;return exports$j;}var exports$k={},_dewExec$j=false;function dew$j(){if(_dewExec$j)return exports$k;_dewExec$j=true;var compare=dew$9();var neq=function neq(a,b,loose){return compare(a,b,loose)!==0;};exports$k=neq;return exports$k;}var exports$1$4={},_dewExec$1$2=false;function dew$1$2(){if(_dewExec$1$2)return exports$1$4;_dewExec$1$2=true;var compare=dew$9();var lte=function lte(a,b,loose){return compare(a,b,loose)<=0;};exports$1$4=lte;return exports$1$4;}var exports$2$2={},_dewExec$2$1=false;function dew$2$1(){if(_dewExec$2$1)return exports$2$2;_dewExec$2$1=true;var eq=dew$a();var neq=dew$j();var gt=dew$g();var gte=dew$i();var lt=dew$h();var lte=dew$1$2();var cmp=function cmp(a,op,b,loose){switch(op){case"===":if(_typeof2(a)==="object")a=a.version;if(_typeof2(b)==="object")b=b.version;return a===b;case"!==":if(_typeof2(a)==="object")a=a.version;if(_typeof2(b)==="object")b=b.version;return a!==b;case"":case"=":case"==":return eq(a,b,loose);case"!=":return neq(a,b,loose);case">":return gt(a,b,loose);case">=":return gte(a,b,loose);case"<":return lt(a,b,loose);case"<=":return lte(a,b,loose);default:throw new TypeError("Invalid operator: ".concat(op));}};exports$2$2=cmp;return exports$2$2;}var exports$l={},_dewExec$k=false;function dew$k(){if(_dewExec$k)return exports$l;_dewExec$k=true;var SemVer=dew$5();var parse=dew$6();var _dew$4=dew$2(),re=_dew$4.re,t=_dew$4.t;var coerce=function coerce(version,options){if(version instanceof SemVer){return version;}if(typeof version==="number"){version=String(version);}if(typeof version!=="string"){return null;}options=options||{};var match=null;if(!options.rtl){match=version.match(re[t.COERCE]);}else{// Find the right-most coercible string that does not share
// a terminus with a more left-ward coercible string.
// Eg, '1.2.3.4' wants to coerce '2.3.4', not '3.4' or '4'
//
// Walk through the string checking with a /g regexp
// Manually set the index so as to pick up overlapping matches.
// Stop when we get a match that ends at the string end, since no
// coercible string can be more right-ward without the same terminus.
var next;while((next=re[t.COERCERTL].exec(version))&&(!match||match.index+match[0].length!==version.length)){if(!match||next.index+next[0].length!==match.index+match[0].length){match=next;}re[t.COERCERTL].lastIndex=next.index+next[1].length+next[2].length;}// leave it in a clean state
re[t.COERCERTL].lastIndex=-1;}if(match===null)return null;return parse("".concat(match[2],".").concat(match[3]||"0",".").concat(match[4]||"0"),options);};exports$l=coerce;return exports$l;}var exports$m={};exports$m=function exports$m(Yallist){Yallist.prototype[Symbol.iterator]=/*#__PURE__*/regeneratorRuntime.mark(function _callee(){var walker;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:walker=this.head;case 1:if(!walker){_context.next=7;break;}_context.next=4;return walker.value;case 4:walker=walker.next;_context.next=1;break;case 7:case"end":return _context.stop();}}},_callee,this);});};var _iterator=exports$m;var exports$1$5={};exports$1$5=Yallist;Yallist.Node=Node;Yallist.create=Yallist;function Yallist(list){var self=this;if(!(self instanceof Yallist)){self=new Yallist();}self.tail=null;self.head=null;self.length=0;if(list&&typeof list.forEach==="function"){list.forEach(function(item){self.push(item);});}else if(arguments.length>0){for(var i=0,l=arguments.length;i<l;i++){self.push(arguments[i]);}}return self;}Yallist.prototype.removeNode=function(node){if(node.list!==this){throw new Error("removing node which does not belong to this list");}var next=node.next;var prev=node.prev;if(next){next.prev=prev;}if(prev){prev.next=next;}if(node===this.head){this.head=next;}if(node===this.tail){this.tail=prev;}node.list.length--;node.next=null;node.prev=null;node.list=null;return next;};Yallist.prototype.unshiftNode=function(node){if(node===this.head){return;}if(node.list){node.list.removeNode(node);}var head=this.head;node.list=this;node.next=head;if(head){head.prev=node;}this.head=node;if(!this.tail){this.tail=node;}this.length++;};Yallist.prototype.pushNode=function(node){if(node===this.tail){return;}if(node.list){node.list.removeNode(node);}var tail=this.tail;node.list=this;node.prev=tail;if(tail){tail.next=node;}this.tail=node;if(!this.head){this.head=node;}this.length++;};Yallist.prototype.push=function(){for(var i=0,l=arguments.length;i<l;i++){push(this,arguments[i]);}return this.length;};Yallist.prototype.unshift=function(){for(var i=0,l=arguments.length;i<l;i++){unshift(this,arguments[i]);}return this.length;};Yallist.prototype.pop=function(){if(!this.tail){return undefined;}var res=this.tail.value;this.tail=this.tail.prev;if(this.tail){this.tail.next=null;}else{this.head=null;}this.length--;return res;};Yallist.prototype.shift=function(){if(!this.head){return undefined;}var res=this.head.value;this.head=this.head.next;if(this.head){this.head.prev=null;}else{this.tail=null;}this.length--;return res;};Yallist.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=this.head,i=0;walker!==null;i++){fn.call(thisp,walker.value,i,this);walker=walker.next;}};Yallist.prototype.forEachReverse=function(fn,thisp){thisp=thisp||this;for(var walker=this.tail,i=this.length-1;walker!==null;i--){fn.call(thisp,walker.value,i,this);walker=walker.prev;}};Yallist.prototype.get=function(n){for(var i=0,walker=this.head;walker!==null&&i<n;i++){// abort out of the list early if we hit a cycle
walker=walker.next;}if(i===n&&walker!==null){return walker.value;}};Yallist.prototype.getReverse=function(n){for(var i=0,walker=this.tail;walker!==null&&i<n;i++){// abort out of the list early if we hit a cycle
walker=walker.prev;}if(i===n&&walker!==null){return walker.value;}};Yallist.prototype.map=function(fn,thisp){thisp=thisp||this;var res=new Yallist();for(var walker=this.head;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.next;}return res;};Yallist.prototype.mapReverse=function(fn,thisp){thisp=thisp||this;var res=new Yallist();for(var walker=this.tail;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.prev;}return res;};Yallist.prototype.reduce=function(fn,initial){var acc;var walker=this.head;if(arguments.length>1){acc=initial;}else if(this.head){walker=this.head.next;acc=this.head.value;}else{throw new TypeError("Reduce of empty list with no initial value");}for(var i=0;walker!==null;i++){acc=fn(acc,walker.value,i);walker=walker.next;}return acc;};Yallist.prototype.reduceReverse=function(fn,initial){var acc;var walker=this.tail;if(arguments.length>1){acc=initial;}else if(this.tail){walker=this.tail.prev;acc=this.tail.value;}else{throw new TypeError("Reduce of empty list with no initial value");}for(var i=this.length-1;walker!==null;i--){acc=fn(acc,walker.value,i);walker=walker.prev;}return acc;};Yallist.prototype.toArray=function(){var arr=new Array(this.length);for(var i=0,walker=this.head;walker!==null;i++){arr[i]=walker.value;walker=walker.next;}return arr;};Yallist.prototype.toArrayReverse=function(){var arr=new Array(this.length);for(var i=0,walker=this.tail;walker!==null;i++){arr[i]=walker.value;walker=walker.prev;}return arr;};Yallist.prototype.slice=function(from,to){to=to||this.length;if(to<0){to+=this.length;}from=from||0;if(from<0){from+=this.length;}var ret=new Yallist();if(to<from||to<0){return ret;}if(from<0){from=0;}if(to>this.length){to=this.length;}for(var i=0,walker=this.head;walker!==null&&i<from;i++){walker=walker.next;}for(;walker!==null&&i<to;i++,walker=walker.next){ret.push(walker.value);}return ret;};Yallist.prototype.sliceReverse=function(from,to){to=to||this.length;if(to<0){to+=this.length;}from=from||0;if(from<0){from+=this.length;}var ret=new Yallist();if(to<from||to<0){return ret;}if(from<0){from=0;}if(to>this.length){to=this.length;}for(var i=this.length,walker=this.tail;walker!==null&&i>to;i--){walker=walker.prev;}for(;walker!==null&&i>from;i--,walker=walker.prev){ret.push(walker.value);}return ret;};Yallist.prototype.splice=function(start,deleteCount){if(start>this.length){start=this.length-1;}if(start<0){start=this.length+start;}for(var i=0,walker=this.head;walker!==null&&i<start;i++){walker=walker.next;}var ret=[];for(var i=0;walker&&i<deleteCount;i++){ret.push(walker.value);walker=this.removeNode(walker);}if(walker===null){walker=this.tail;}if(walker!==this.head&&walker!==this.tail){walker=walker.prev;}for(var i=0;i<(arguments.length<=2?0:arguments.length-2);i++){walker=insert(this,walker,i+2<2||arguments.length<=i+2?undefined:arguments[i+2]);}return ret;};Yallist.prototype.reverse=function(){var head=this.head;var tail=this.tail;for(var walker=head;walker!==null;walker=walker.prev){var p=walker.prev;walker.prev=walker.next;walker.next=p;}this.head=tail;this.tail=head;return this;};function insert(self,node,value){var inserted=node===self.head?new Node(value,null,node,self):new Node(value,node,node.next,self);if(inserted.next===null){self.tail=inserted;}if(inserted.prev===null){self.head=inserted;}self.length++;return inserted;}function push(self,item){self.tail=new Node(item,self.tail,null,self);if(!self.head){self.head=self.tail;}self.length++;}function unshift(self,item){self.head=new Node(item,null,self.head,self);if(!self.tail){self.tail=self.head;}self.length++;}function Node(value,prev,next,list){if(!(this instanceof Node)){return new Node(value,prev,next,list);}this.list=list;this.value=value;if(prev){prev.next=this;this.prev=prev;}else{this.prev=null;}if(next){next.prev=this;this.next=next;}else{this.next=null;}}try{// add if support for Symbol.iterator is present
_iterator(Yallist);}catch(er){}var exports$2$3=exports$1$5;var exports$n={};// A linked list to keep track of recently-used-ness
var Yallist$1=exports$2$3;var MAX=Symbol("max");var LENGTH=Symbol("length");var LENGTH_CALCULATOR=Symbol("lengthCalculator");var ALLOW_STALE=Symbol("allowStale");var MAX_AGE=Symbol("maxAge");var DISPOSE=Symbol("dispose");var NO_DISPOSE_ON_SET=Symbol("noDisposeOnSet");var LRU_LIST=Symbol("lruList");var CACHE=Symbol("cache");var UPDATE_AGE_ON_GET=Symbol("updateAgeOnGet");var naiveLength=function naiveLength(){return 1;};// lruList is a yallist where the head is the youngest
// item, and the tail is the oldest.  the list contains the Hit
// objects as the entries.
// Each Hit object has a reference to its Yallist.Node.  This
// never changes.
//
// cache is a Map (or PseudoMap) that matches the keys to
// the Yallist.Node object.
var LRUCache=/*#__PURE__*/function(){function LRUCache(options){_classCallCheck(this,LRUCache);if(typeof options==="number")options={max:options};if(!options)options={};if(options.max&&(typeof options.max!=="number"||options.max<0))throw new TypeError("max must be a non-negative number");// Kind of weird to have a default max of Infinity, but oh well.
var max=this[MAX]=options.max||Infinity;var lc=options.length||naiveLength;this[LENGTH_CALCULATOR]=typeof lc!=="function"?naiveLength:lc;this[ALLOW_STALE]=options.stale||false;if(options.maxAge&&typeof options.maxAge!=="number")throw new TypeError("maxAge must be a number");this[MAX_AGE]=options.maxAge||0;this[DISPOSE]=options.dispose;this[NO_DISPOSE_ON_SET]=options.noDisposeOnSet||false;this[UPDATE_AGE_ON_GET]=options.updateAgeOnGet||false;this.reset();}// resize the cache when the max changes.
_createClass(LRUCache,[{key:"rforEach",value:function rforEach(fn,thisp){thisp=thisp||this;for(var walker=this[LRU_LIST].tail;walker!==null;){var prev=walker.prev;forEachStep(this,fn,walker,thisp);walker=prev;}}},{key:"forEach",value:function forEach(fn,thisp){thisp=thisp||this;for(var walker=this[LRU_LIST].head;walker!==null;){var next=walker.next;forEachStep(this,fn,walker,thisp);walker=next;}}},{key:"keys",value:function keys(){return this[LRU_LIST].toArray().map(function(k){return k.key;});}},{key:"values",value:function values(){return this[LRU_LIST].toArray().map(function(k){return k.value;});}},{key:"reset",value:function reset(){var _this10=this;if(this[DISPOSE]&&this[LRU_LIST]&&this[LRU_LIST].length){this[LRU_LIST].forEach(function(hit){return _this10[DISPOSE](hit.key,hit.value);});}this[CACHE]=new Map();// hash of items by key
this[LRU_LIST]=new Yallist$1();// list of items in order of use recency
this[LENGTH]=0;// length of items in the list
}},{key:"dump",value:function dump(){var _this11=this;return this[LRU_LIST].map(function(hit){return isStale(_this11,hit)?false:{k:hit.key,v:hit.value,e:hit.now+(hit.maxAge||0)};}).toArray().filter(function(h){return h;});}},{key:"dumpLru",value:function dumpLru(){return this[LRU_LIST];}},{key:"set",value:function set(key,value,maxAge){maxAge=maxAge||this[MAX_AGE];if(maxAge&&typeof maxAge!=="number")throw new TypeError("maxAge must be a number");var now=maxAge?Date.now():0;var len=this[LENGTH_CALCULATOR](value,key);if(this[CACHE].has(key)){if(len>this[MAX]){_del(this,this[CACHE].get(key));return false;}var node=this[CACHE].get(key);var item=node.value;// dispose of the old one before overwriting
// split out into 2 ifs for better coverage tracking
if(this[DISPOSE]){if(!this[NO_DISPOSE_ON_SET])this[DISPOSE](key,item.value);}item.now=now;item.maxAge=maxAge;item.value=value;this[LENGTH]+=len-item.length;item.length=len;this.get(key);trim(this);return true;}var hit=new Entry(key,value,len,now,maxAge);// oversized objects fall out of cache automatically.
if(hit.length>this[MAX]){if(this[DISPOSE])this[DISPOSE](key,value);return false;}this[LENGTH]+=hit.length;this[LRU_LIST].unshift(hit);this[CACHE].set(key,this[LRU_LIST].head);trim(this);return true;}},{key:"has",value:function has(key){if(!this[CACHE].has(key))return false;var hit=this[CACHE].get(key).value;return!isStale(this,hit);}},{key:"get",value:function get(key){return get$1(this,key,true);}},{key:"peek",value:function peek(key){return get$1(this,key,false);}},{key:"pop",value:function pop(){var node=this[LRU_LIST].tail;if(!node)return null;_del(this,node);return node.value;}},{key:"del",value:function del(key){_del(this,this[CACHE].get(key));}},{key:"load",value:function load(arr){// reset the cache
this.reset();var now=Date.now();// A previous serialized cache has the most recent items first
for(var _l=arr.length-1;_l>=0;_l--){var hit=arr[_l];var expiresAt=hit.e||0;if(expiresAt===0)// the item was created without expiration in a non aged cache
this.set(hit.k,hit.v);else{var maxAge=expiresAt-now;// dont add already expired items
if(maxAge>0){this.set(hit.k,hit.v,maxAge);}}}}},{key:"prune",value:function prune(){var _this12=this;this[CACHE].forEach(function(value,key){return get$1(_this12,key,false);});}},{key:"max",set:function set(mL){if(typeof mL!=="number"||mL<0)throw new TypeError("max must be a non-negative number");this[MAX]=mL||Infinity;trim(this);},get:function get(){return this[MAX];}},{key:"allowStale",set:function set(allowStale){this[ALLOW_STALE]=!!allowStale;},get:function get(){return this[ALLOW_STALE];}},{key:"maxAge",set:function set(mA){if(typeof mA!=="number")throw new TypeError("maxAge must be a non-negative number");this[MAX_AGE]=mA;trim(this);},get:function get(){return this[MAX_AGE];}// resize the cache when the lengthCalculator changes.
},{key:"lengthCalculator",set:function set(lC){var _this13=this;if(typeof lC!=="function")lC=naiveLength;if(lC!==this[LENGTH_CALCULATOR]){this[LENGTH_CALCULATOR]=lC;this[LENGTH]=0;this[LRU_LIST].forEach(function(hit){hit.length=_this13[LENGTH_CALCULATOR](hit.value,hit.key);_this13[LENGTH]+=hit.length;});}trim(this);},get:function get(){return this[LENGTH_CALCULATOR];}},{key:"length",get:function get(){return this[LENGTH];}},{key:"itemCount",get:function get(){return this[LRU_LIST].length;}}]);return LRUCache;}();var get$1=function get$1(self,key,doUse){var node=self[CACHE].get(key);if(node){var hit=node.value;if(isStale(self,hit)){_del(self,node);if(!self[ALLOW_STALE])return undefined;}else{if(doUse){if(self[UPDATE_AGE_ON_GET])node.value.now=Date.now();self[LRU_LIST].unshiftNode(node);}}return hit.value;}};var isStale=function isStale(self,hit){if(!hit||!hit.maxAge&&!self[MAX_AGE])return false;var diff=Date.now()-hit.now;return hit.maxAge?diff>hit.maxAge:self[MAX_AGE]&&diff>self[MAX_AGE];};var trim=function trim(self){if(self[LENGTH]>self[MAX]){for(var walker=self[LRU_LIST].tail;self[LENGTH]>self[MAX]&&walker!==null;){// We know that we're about to delete this one, and also
// what the next least recently used key will be, so just
// go ahead and set it now.
var prev=walker.prev;_del(self,walker);walker=prev;}}};var _del=function _del(self,node){if(node){var hit=node.value;if(self[DISPOSE])self[DISPOSE](hit.key,hit.value);self[LENGTH]-=hit.length;self[CACHE]["delete"](hit.key);self[LRU_LIST].removeNode(node);}};var Entry=function Entry(key,value,length,now,maxAge){_classCallCheck(this,Entry);this.key=key;this.value=value;this.length=length;this.now=now;this.maxAge=maxAge||0;};var forEachStep=function forEachStep(self,fn,node,thisp){var hit=node.value;if(isStale(self,hit)){_del(self,node);if(!self[ALLOW_STALE])hit=undefined;}if(hit)fn.call(thisp,hit.value,hit.key,self);};exports$n=LRUCache;var exports$1$6=exports$n;var exports$o={},_dewExec$l=false;function dew$l(){if(_dewExec$l)return exports$o;_dewExec$l=true;// hoisted class for cyclic dependency
var Range=/*#__PURE__*/function(){function Range(range,options){var _this14=this;_classCallCheck(this,Range);options=parseOptions(options);if(range instanceof Range){if(range.loose===!!options.loose&&range.includePrerelease===!!options.includePrerelease){return range;}else{return new Range(range.raw,options);}}if(range instanceof Comparator){// just put it in the set and return
this.raw=range.value;this.set=[[range]];this.format();return this;}this.options=options;this.loose=!!options.loose;this.includePrerelease=!!options.includePrerelease;// First, split based on boolean or ||
this.raw=range;this.set=range.split(/\s*\|\|\s*/)// map the range to a 2d array of comparators
.map(function(range){return _this14.parseRange(range.trim());})// throw out any comparator lists that are empty
// this generally means that it was not a valid range, which is allowed
// in loose mode, but will still throw if the WHOLE range is invalid.
.filter(function(c){return c.length;});if(!this.set.length){throw new TypeError("Invalid SemVer Range: ".concat(range));}// if we have any that are not the null set, throw out null sets.
if(this.set.length>1){// keep the first one, in case they're all null sets
var _first=this.set[0];this.set=this.set.filter(function(c){return!isNullSet(c[0]);});if(this.set.length===0)this.set=[_first];else if(this.set.length>1){// if we have any that are *, then the range is just *
var _iterator17=_createForOfIteratorHelper(this.set),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var _c2=_step17.value;if(_c2.length===1&&isAny(_c2[0])){this.set=[_c2];break;}}}catch(err){_iterator17.e(err);}finally{_iterator17.f();}}}this.format();}_createClass(Range,[{key:"format",value:function format(){this.range=this.set.map(function(comps){return comps.join(" ").trim();}).join("||").trim();return this.range;}},{key:"toString",value:function toString(){return this.range;}},{key:"parseRange",value:function parseRange(range){var _this15=this;range=range.trim();// memoize range parsing for performance.
// this is a very hot path, and fully deterministic.
var memoOpts=Object.keys(this.options).join(",");var memoKey="parseRange:".concat(memoOpts,":").concat(range);var cached=cache.get(memoKey);if(cached)return cached;var loose=this.options.loose;// `1.2.3 - 1.2.4` => `>=1.2.3 <=1.2.4`
var hr=loose?re[t.HYPHENRANGELOOSE]:re[t.HYPHENRANGE];range=range.replace(hr,hyphenReplace(this.options.includePrerelease));debug("hyphen replace",range);// `> 1.2.3 < 1.2.5` => `>1.2.3 <1.2.5`
range=range.replace(re[t.COMPARATORTRIM],comparatorTrimReplace);debug("comparator trim",range,re[t.COMPARATORTRIM]);// `~ 1.2.3` => `~1.2.3`
range=range.replace(re[t.TILDETRIM],tildeTrimReplace);// `^ 1.2.3` => `^1.2.3`
range=range.replace(re[t.CARETTRIM],caretTrimReplace);// normalize spaces
range=range.split(/\s+/).join(" ");// At this point, the range is completely trimmed and
// ready to be split into comparators.
var compRe=loose?re[t.COMPARATORLOOSE]:re[t.COMPARATOR];var rangeList=range.split(" ").map(function(comp){return parseComparator(comp,_this15.options);}).join(" ").split(/\s+/)// >=0.0.0 is equivalent to *
.map(function(comp){return replaceGTE0(comp,_this15.options);})// in loose mode, throw out any that are not valid comparators
.filter(this.options.loose?function(comp){return!!comp.match(compRe);}:function(){return true;}).map(function(comp){return new Comparator(comp,_this15.options);});// if any comparators are the null set, then replace with JUST null set
// if more than one comparator, remove any * comparators
// also, don't include the same comparator more than once
var l=rangeList.length;var rangeMap=new Map();var _iterator18=_createForOfIteratorHelper(rangeList),_step18;try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var comp=_step18.value;if(isNullSet(comp))return[comp];rangeMap.set(comp.value,comp);}}catch(err){_iterator18.e(err);}finally{_iterator18.f();}if(rangeMap.size>1&&rangeMap.has(""))rangeMap["delete"]("");var result=_toConsumableArray2(rangeMap.values());cache.set(memoKey,result);return result;}},{key:"intersects",value:function intersects(range,options){if(!(range instanceof Range)){throw new TypeError("a Range is required");}return this.set.some(function(thisComparators){return isSatisfiable(thisComparators,options)&&range.set.some(function(rangeComparators){return isSatisfiable(rangeComparators,options)&&thisComparators.every(function(thisComparator){return rangeComparators.every(function(rangeComparator){return thisComparator.intersects(rangeComparator,options);});});});});}// if ANY of the sets match ALL of its comparators, then pass
},{key:"test",value:function test(version){if(!version){return false;}if(typeof version==="string"){try{version=new SemVer(version,this.options);}catch(er){return false;}}for(var _i62=0;_i62<this.set.length;_i62++){if(testSet(this.set[_i62],version,this.options)){return true;}}return false;}}]);return Range;}();exports$o=Range;var LRU=exports$1$6;var cache=new LRU({max:1000});var parseOptions=dew$3();var Comparator=dew$1$3();var debug=dew$1();var SemVer=dew$5();var _dew$5=dew$2(),re=_dew$5.re,t=_dew$5.t,comparatorTrimReplace=_dew$5.comparatorTrimReplace,tildeTrimReplace=_dew$5.tildeTrimReplace,caretTrimReplace=_dew$5.caretTrimReplace;var isNullSet=function isNullSet(c){return c.value==="<0.0.0-0";};var isAny=function isAny(c){return c.value==="";};// take a set of comparators and determine whether there
// exists a version which can satisfy it
var isSatisfiable=function isSatisfiable(comparators,options){var result=true;var remainingComparators=comparators.slice();var testComparator=remainingComparators.pop();while(result&&remainingComparators.length){result=remainingComparators.every(function(otherComparator){return testComparator.intersects(otherComparator,options);});testComparator=remainingComparators.pop();}return result;};// comprised of xranges, tildes, stars, and gtlt's at this point.
// already replaced the hyphen ranges
// turn into a set of JUST comparators.
var parseComparator=function parseComparator(comp,options){debug("comp",comp,options);comp=replaceCarets(comp,options);debug("caret",comp);comp=replaceTildes(comp,options);debug("tildes",comp);comp=replaceXRanges(comp,options);debug("xrange",comp);comp=replaceStars(comp,options);debug("stars",comp);return comp;};var isX=function isX(id){return!id||id.toLowerCase()==="x"||id==="*";};// ~, ~> --> * (any, kinda silly)
// ~2, ~2.x, ~2.x.x, ~>2, ~>2.x ~>2.x.x --> >=2.0.0 <3.0.0-0
// ~2.0, ~2.0.x, ~>2.0, ~>2.0.x --> >=2.0.0 <2.1.0-0
// ~1.2, ~1.2.x, ~>1.2, ~>1.2.x --> >=1.2.0 <1.3.0-0
// ~1.2.3, ~>1.2.3 --> >=1.2.3 <1.3.0-0
// ~1.2.0, ~>1.2.0 --> >=1.2.0 <1.3.0-0
var replaceTildes=function replaceTildes(comp,options){return comp.trim().split(/\s+/).map(function(comp){return replaceTilde(comp,options);}).join(" ");};var replaceTilde=function replaceTilde(comp,options){var r=options.loose?re[t.TILDELOOSE]:re[t.TILDE];return comp.replace(r,function(_,M,m,p,pr){debug("tilde",comp,_,M,m,p,pr);var ret;if(isX(M)){ret="";}else if(isX(m)){ret=">=".concat(M,".0.0 <").concat(+M+1,".0.0-0");}else if(isX(p)){// ~1.2 == >=1.2.0 <1.3.0-0
ret=">=".concat(M,".").concat(m,".0 <").concat(M,".").concat(+m+1,".0-0");}else if(pr){debug("replaceTilde pr",pr);ret=">=".concat(M,".").concat(m,".").concat(p,"-").concat(pr," <").concat(M,".").concat(+m+1,".0-0");}else{// ~1.2.3 == >=1.2.3 <1.3.0-0
ret=">=".concat(M,".").concat(m,".").concat(p," <").concat(M,".").concat(+m+1,".0-0");}debug("tilde return",ret);return ret;});};// ^ --> * (any, kinda silly)
// ^2, ^2.x, ^2.x.x --> >=2.0.0 <3.0.0-0
// ^2.0, ^2.0.x --> >=2.0.0 <3.0.0-0
// ^1.2, ^1.2.x --> >=1.2.0 <2.0.0-0
// ^1.2.3 --> >=1.2.3 <2.0.0-0
// ^1.2.0 --> >=1.2.0 <2.0.0-0
var replaceCarets=function replaceCarets(comp,options){return comp.trim().split(/\s+/).map(function(comp){return replaceCaret(comp,options);}).join(" ");};var replaceCaret=function replaceCaret(comp,options){debug("caret",comp,options);var r=options.loose?re[t.CARETLOOSE]:re[t.CARET];var z=options.includePrerelease?"-0":"";return comp.replace(r,function(_,M,m,p,pr){debug("caret",comp,_,M,m,p,pr);var ret;if(isX(M)){ret="";}else if(isX(m)){ret=">=".concat(M,".0.0").concat(z," <").concat(+M+1,".0.0-0");}else if(isX(p)){if(M==="0"){ret=">=".concat(M,".").concat(m,".0").concat(z," <").concat(M,".").concat(+m+1,".0-0");}else{ret=">=".concat(M,".").concat(m,".0").concat(z," <").concat(+M+1,".0.0-0");}}else if(pr){debug("replaceCaret pr",pr);if(M==="0"){if(m==="0"){ret=">=".concat(M,".").concat(m,".").concat(p,"-").concat(pr," <").concat(M,".").concat(m,".").concat(+p+1,"-0");}else{ret=">=".concat(M,".").concat(m,".").concat(p,"-").concat(pr," <").concat(M,".").concat(+m+1,".0-0");}}else{ret=">=".concat(M,".").concat(m,".").concat(p,"-").concat(pr," <").concat(+M+1,".0.0-0");}}else{debug("no pr");if(M==="0"){if(m==="0"){ret=">=".concat(M,".").concat(m,".").concat(p).concat(z," <").concat(M,".").concat(m,".").concat(+p+1,"-0");}else{ret=">=".concat(M,".").concat(m,".").concat(p).concat(z," <").concat(M,".").concat(+m+1,".0-0");}}else{ret=">=".concat(M,".").concat(m,".").concat(p," <").concat(+M+1,".0.0-0");}}debug("caret return",ret);return ret;});};var replaceXRanges=function replaceXRanges(comp,options){debug("replaceXRanges",comp,options);return comp.split(/\s+/).map(function(comp){return replaceXRange(comp,options);}).join(" ");};var replaceXRange=function replaceXRange(comp,options){comp=comp.trim();var r=options.loose?re[t.XRANGELOOSE]:re[t.XRANGE];return comp.replace(r,function(ret,gtlt,M,m,p,pr){debug("xRange",comp,ret,gtlt,M,m,p,pr);var xM=isX(M);var xm=xM||isX(m);var xp=xm||isX(p);var anyX=xp;if(gtlt==="="&&anyX){gtlt="";}// if we're including prereleases in the match, then we need
// to fix this to -0, the lowest possible prerelease value
pr=options.includePrerelease?"-0":"";if(xM){if(gtlt===">"||gtlt==="<"){// nothing is allowed
ret="<0.0.0-0";}else{// nothing is forbidden
ret="*";}}else if(gtlt&&anyX){// we know patch is an x, because we have any x at all.
// replace X with 0
if(xm){m=0;}p=0;if(gtlt===">"){// >1 => >=2.0.0
// >1.2 => >=1.3.0
gtlt=">=";if(xm){M=+M+1;m=0;p=0;}else{m=+m+1;p=0;}}else if(gtlt==="<="){// <=0.7.x is actually <0.8.0, since any 0.7.x should
// pass.  Similarly, <=7.x is actually <8.0.0, etc.
gtlt="<";if(xm){M=+M+1;}else{m=+m+1;}}if(gtlt==="<")pr="-0";ret="".concat(gtlt+M,".").concat(m,".").concat(p).concat(pr);}else if(xm){ret=">=".concat(M,".0.0").concat(pr," <").concat(+M+1,".0.0-0");}else if(xp){ret=">=".concat(M,".").concat(m,".0").concat(pr," <").concat(M,".").concat(+m+1,".0-0");}debug("xRange return",ret);return ret;});};// Because * is AND-ed with everything else in the comparator,
// and '' means "any version", just remove the *s entirely.
var replaceStars=function replaceStars(comp,options){debug("replaceStars",comp,options);// Looseness is ignored here.  star is always as loose as it gets!
return comp.trim().replace(re[t.STAR],"");};var replaceGTE0=function replaceGTE0(comp,options){debug("replaceGTE0",comp,options);return comp.trim().replace(re[options.includePrerelease?t.GTE0PRE:t.GTE0],"");};// This function is passed to string.replace(re[t.HYPHENRANGE])
// M, m, patch, prerelease, build
// 1.2 - 3.4.5 => >=1.2.0 <=3.4.5
// 1.2.3 - 3.4 => >=1.2.0 <3.5.0-0 Any 3.4.x will do
// 1.2 - 3.4 => >=1.2.0 <3.5.0-0
var hyphenReplace=function hyphenReplace(incPr){return function($0,from,fM,fm,fp,fpr,fb,to,tM,tm,tp,tpr,tb){if(isX(fM)){from="";}else if(isX(fm)){from=">=".concat(fM,".0.0").concat(incPr?"-0":"");}else if(isX(fp)){from=">=".concat(fM,".").concat(fm,".0").concat(incPr?"-0":"");}else if(fpr){from=">=".concat(from);}else{from=">=".concat(from).concat(incPr?"-0":"");}if(isX(tM)){to="";}else if(isX(tm)){to="<".concat(+tM+1,".0.0-0");}else if(isX(tp)){to="<".concat(tM,".").concat(+tm+1,".0-0");}else if(tpr){to="<=".concat(tM,".").concat(tm,".").concat(tp,"-").concat(tpr);}else if(incPr){to="<".concat(tM,".").concat(tm,".").concat(+tp+1,"-0");}else{to="<=".concat(to);}return"".concat(from," ").concat(to).trim();};};var testSet=function testSet(set,version,options){for(var _i63=0;_i63<set.length;_i63++){if(!set[_i63].test(version)){return false;}}if(version.prerelease.length&&!options.includePrerelease){// Find the set of versions that are allowed to have prereleases
// For example, ^1.2.3-pr.1 desugars to >=1.2.3-pr.1 <2.0.0
// That should allow `1.2.3-pr.2` to pass.
// However, `1.2.4-alpha.notready` should NOT be allowed,
// even though it's within the range set by the comparators.
for(var _i64=0;_i64<set.length;_i64++){debug(set[_i64].semver);if(set[_i64].semver===Comparator.ANY){continue;}if(set[_i64].semver.prerelease.length>0){var allowed=set[_i64].semver;if(allowed.major===version.major&&allowed.minor===version.minor&&allowed.patch===version.patch){return true;}}}// Version has a -pre, but it's not one of the ones we like.
return false;}return true;};return exports$o;}var exports$1$7={},_dewExec$1$3=false;function dew$1$3(){if(_dewExec$1$3)return exports$1$7;_dewExec$1$3=true;var ANY=Symbol("SemVer ANY");// hoisted class for cyclic dependency
var Comparator=/*#__PURE__*/function(){_createClass(Comparator,null,[{key:"ANY",get:function get(){return ANY;}}]);function Comparator(comp,options){_classCallCheck(this,Comparator);options=parseOptions(options);if(comp instanceof Comparator){if(comp.loose===!!options.loose){return comp;}else{comp=comp.value;}}debug("comparator",comp,options);this.options=options;this.loose=!!options.loose;this.parse(comp);if(this.semver===ANY){this.value="";}else{this.value=this.operator+this.semver.version;}debug("comp",this);}_createClass(Comparator,[{key:"parse",value:function parse(comp){var r=this.options.loose?re[t.COMPARATORLOOSE]:re[t.COMPARATOR];var m=comp.match(r);if(!m){throw new TypeError("Invalid comparator: ".concat(comp));}this.operator=m[1]!==undefined?m[1]:"";if(this.operator==="="){this.operator="";}// if it literally is just '>' or '' then allow anything.
if(!m[2]){this.semver=ANY;}else{this.semver=new SemVer(m[2],this.options.loose);}}},{key:"toString",value:function toString(){return this.value;}},{key:"test",value:function test(version){debug("Comparator.test",version,this.options.loose);if(this.semver===ANY||version===ANY){return true;}if(typeof version==="string"){try{version=new SemVer(version,this.options);}catch(er){return false;}}return cmp(version,this.operator,this.semver,this.options);}},{key:"intersects",value:function intersects(comp,options){if(!(comp instanceof Comparator)){throw new TypeError("a Comparator is required");}if(!options||_typeof2(options)!=="object"){options={loose:!!options,includePrerelease:false};}if(this.operator===""){if(this.value===""){return true;}return new Range(comp.value,options).test(this.value);}else if(comp.operator===""){if(comp.value===""){return true;}return new Range(this.value,options).test(comp.semver);}var sameDirectionIncreasing=(this.operator===">="||this.operator===">")&&(comp.operator===">="||comp.operator===">");var sameDirectionDecreasing=(this.operator==="<="||this.operator==="<")&&(comp.operator==="<="||comp.operator==="<");var sameSemVer=this.semver.version===comp.semver.version;var differentDirectionsInclusive=(this.operator===">="||this.operator==="<=")&&(comp.operator===">="||comp.operator==="<=");var oppositeDirectionsLessThan=cmp(this.semver,"<",comp.semver,options)&&(this.operator===">="||this.operator===">")&&(comp.operator==="<="||comp.operator==="<");var oppositeDirectionsGreaterThan=cmp(this.semver,">",comp.semver,options)&&(this.operator==="<="||this.operator==="<")&&(comp.operator===">="||comp.operator===">");return sameDirectionIncreasing||sameDirectionDecreasing||sameSemVer&&differentDirectionsInclusive||oppositeDirectionsLessThan||oppositeDirectionsGreaterThan;}}]);return Comparator;}();exports$1$7=Comparator;var parseOptions=dew$3();var _dew$6=dew$2(),re=_dew$6.re,t=_dew$6.t;var cmp=dew$2$1();var debug=dew$1();var SemVer=dew$5();var Range=dew$l();return exports$1$7;}var exports$p={},_dewExec$m=false;function dew$m(){if(_dewExec$m)return exports$p;_dewExec$m=true;var Range=dew$l();var satisfies=function satisfies(version,range,options){try{range=new Range(range,options);}catch(er){return false;}return range.test(version);};exports$p=satisfies;return exports$p;}var exports$q={},_dewExec$n=false;function dew$n(){if(_dewExec$n)return exports$q;_dewExec$n=true;var SemVer=dew$5();var Range=dew$l();var maxSatisfying=function maxSatisfying(versions,range,options){var max=null;var maxSV=null;var rangeObj=null;try{rangeObj=new Range(range,options);}catch(er){return null;}versions.forEach(function(v){if(rangeObj.test(v)){// satisfies(v, range, options)
if(!max||maxSV.compare(v)===-1){// compare(max, v, true)
max=v;maxSV=new SemVer(max,options);}}});return max;};exports$q=maxSatisfying;return exports$q;}var exports$r={},_dewExec$o=false;function dew$o(){if(_dewExec$o)return exports$r;_dewExec$o=true;var Range=dew$l();var validRange=function validRange(range,options){try{// Return '*' instead of '' so that truthiness works.
// This will throw if it's invalid anyway
return new Range(range,options).range||"*";}catch(er){return null;}};exports$r=validRange;return exports$r;}var exports$s={},_dewExec$p=false;function dew$p(){if(_dewExec$p)return exports$s;_dewExec$p=true;var parse=dew$6();var clean=function clean(version,options){var s=parse(version.trim().replace(/^[=v]+/,""),options);return s?s.version:null;};exports$s=clean;return exports$s;}var exports$1$8={},_dewExec$1$4=false;function dew$1$4(){if(_dewExec$1$4)return exports$1$8;_dewExec$1$4=true;var SemVer=dew$5();var minor=function minor(a,loose){return new SemVer(a,loose).minor;};exports$1$8=minor;return exports$1$8;}var exports$2$4={},_dewExec$2$2=false;function dew$2$2(){if(_dewExec$2$2)return exports$2$4;_dewExec$2$2=true;var SemVer=dew$5();var patch=function patch(a,loose){return new SemVer(a,loose).patch;};exports$2$4=patch;return exports$2$4;}var exports$3$2={},_dewExec$3$1=false;function dew$3$1(){if(_dewExec$3$1)return exports$3$2;_dewExec$3$1=true;var compare=dew$9();var compareLoose=function compareLoose(a,b){return compare(a,b,true);};exports$3$2=compareLoose;return exports$3$2;}var exports$4$2={},_dewExec$4$1=false;function dew$4$1(){if(_dewExec$4$1)return exports$4$2;_dewExec$4$1=true;var compareBuild=dew$f();var sort=function sort(list,loose){return list.sort(function(a,b){return compareBuild(a,b,loose);});};exports$4$2=sort;return exports$4$2;}var exports$5$2={},_dewExec$5$1=false;function dew$5$1(){if(_dewExec$5$1)return exports$5$2;_dewExec$5$1=true;var Range=dew$l();// Mostly just for testing and legacy API reasons
var toComparators=function toComparators(range,options){return new Range(range,options).set.map(function(comp){return comp.map(function(c){return c.value;}).join(" ").trim().split(" ");});};exports$5$2=toComparators;return exports$5$2;}var exports$6$1={},_dewExec$6$1=false;function dew$6$1(){if(_dewExec$6$1)return exports$6$1;_dewExec$6$1=true;var SemVer=dew$5();var Range=dew$l();var minSatisfying=function minSatisfying(versions,range,options){var min=null;var minSV=null;var rangeObj=null;try{rangeObj=new Range(range,options);}catch(er){return null;}versions.forEach(function(v){if(rangeObj.test(v)){// satisfies(v, range, options)
if(!min||minSV.compare(v)===1){// compare(min, v, true)
min=v;minSV=new SemVer(min,options);}}});return min;};exports$6$1=minSatisfying;return exports$6$1;}var exports$7$1={},_dewExec$7$1=false;function dew$7$1(){if(_dewExec$7$1)return exports$7$1;_dewExec$7$1=true;var SemVer=dew$5();var Range=dew$l();var gt=dew$g();var minVersion=function minVersion(range,loose){range=new Range(range,loose);var minver=new SemVer("0.0.0");if(range.test(minver)){return minver;}minver=new SemVer("0.0.0-0");if(range.test(minver)){return minver;}minver=null;var _loop3=function _loop3(_i65){var comparators=range.set[_i65];var setMin=null;comparators.forEach(function(comparator){// Clone to avoid manipulating the comparator's semver object.
var compver=new SemVer(comparator.semver.version);switch(comparator.operator){case">":if(compver.prerelease.length===0){compver.patch++;}else{compver.prerelease.push(0);}compver.raw=compver.format();/* fallthrough */case"":case">=":if(!setMin||gt(compver,setMin)){setMin=compver;}break;case"<":case"<=":/* Ignore maximum versions */break;/* istanbul ignore next */default:throw new Error("Unexpected operation: ".concat(comparator.operator));}});if(setMin&&(!minver||gt(minver,setMin)))minver=setMin;};for(var _i65=0;_i65<range.set.length;++_i65){_loop3(_i65);}if(minver&&range.test(minver)){return minver;}return null;};exports$7$1=minVersion;return exports$7$1;}var exports$8$1={},_dewExec$8$1=false;function dew$8$1(){if(_dewExec$8$1)return exports$8$1;_dewExec$8$1=true;var SemVer=dew$5();var Comparator=dew$1$3();var ANY=Comparator.ANY;var Range=dew$l();var satisfies=dew$m();var gt=dew$g();var lt=dew$h();var lte=dew$1$2();var gte=dew$i();var outside=function outside(version,range,hilo,options){version=new SemVer(version,options);range=new Range(range,options);var gtfn,ltefn,ltfn,comp,ecomp;switch(hilo){case">":gtfn=gt;ltefn=lte;ltfn=lt;comp=">";ecomp=">=";break;case"<":gtfn=lt;ltefn=gte;ltfn=gt;comp="<";ecomp="<=";break;default:throw new TypeError("Must provide a hilo val of \"<\" or \">\"");}// If it satisfies the range it is not outside
if(satisfies(version,range,options)){return false;}// From now on, variable terms are as if we're in "gtr" mode.
// but note that everything is flipped for the "ltr" function.
var _loop4=function _loop4(_i66){var comparators=range.set[_i66];var high=null;var low=null;comparators.forEach(function(comparator){if(comparator.semver===ANY){comparator=new Comparator(">=0.0.0");}high=high||comparator;low=low||comparator;if(gtfn(comparator.semver,high.semver,options)){high=comparator;}else if(ltfn(comparator.semver,low.semver,options)){low=comparator;}});// If the edge version comparator has a operator then our version
// isn't outside it
if(high.operator===comp||high.operator===ecomp){return{v:false};}// If the lowest version comparator has an operator and our version
// is less than it then it isn't higher than the range
if((!low.operator||low.operator===comp)&&ltefn(version,low.semver)){return{v:false};}else if(low.operator===ecomp&&ltfn(version,low.semver)){return{v:false};}};for(var _i66=0;_i66<range.set.length;++_i66){var _ret4=_loop4(_i66);if(_typeof2(_ret4)==="object")return _ret4.v;}return true;};exports$8$1=outside;return exports$8$1;}var exports$9$1={},_dewExec$9$1=false;function dew$9$1(){if(_dewExec$9$1)return exports$9$1;_dewExec$9$1=true;// Determine if version is greater than all the versions possible in the range.
var outside=dew$8$1();var gtr=function gtr(version,range,options){return outside(version,range,">",options);};exports$9$1=gtr;return exports$9$1;}var exports$a$1={},_dewExec$a$1=false;function dew$a$1(){if(_dewExec$a$1)return exports$a$1;_dewExec$a$1=true;var outside=dew$8$1();// Determine if version is less than all the versions possible in the range
var ltr=function ltr(version,range,options){return outside(version,range,"<",options);};exports$a$1=ltr;return exports$a$1;}var exports$b$1={},_dewExec$b$1=false;function dew$b$1(){if(_dewExec$b$1)return exports$b$1;_dewExec$b$1=true;var Range=dew$l();var intersects=function intersects(r1,r2,options){r1=new Range(r1,options);r2=new Range(r2,options);return r1.intersects(r2);};exports$b$1=intersects;return exports$b$1;}var exports$c$1={},_dewExec$c$1=false;function dew$c$1(){if(_dewExec$c$1)return exports$c$1;_dewExec$c$1=true;// given a set of versions and a range, create a "simplified" range
// that includes the same versions that the original range does
// If the original range is shorter than the simplified one, return that.
var satisfies=dew$m();var compare=dew$9();exports$c$1=function exports$c$1(versions,range,options){var set=[];var min=null;var prev=null;var v=versions.sort(function(a,b){return compare(a,b,options);});var _iterator19=_createForOfIteratorHelper(v),_step19;try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var _version2=_step19.value;var included=satisfies(_version2,range,options);if(included){prev=_version2;if(!min)min=_version2;}else{if(prev){set.push([min,prev]);}prev=null;min=null;}}}catch(err){_iterator19.e(err);}finally{_iterator19.f();}if(min)set.push([min,null]);var ranges=[];for(var _i67=0,_set2=set;_i67<_set2.length;_i67++){var _set2$_i=_slicedToArray2(_set2[_i67],2),_min=_set2$_i[0],_max=_set2$_i[1];if(_min===_max)ranges.push(_min);else if(!_max&&_min===v[0])ranges.push("*");else if(!_max)ranges.push(">=".concat(_min));else if(_min===v[0])ranges.push("<=".concat(_max));else ranges.push("".concat(_min," - ").concat(_max));}var simplified=ranges.join(" || ");var original=typeof range.raw==="string"?range.raw:String(range);return simplified.length<original.length?simplified:range;};return exports$c$1;}var exports$d$1={},_dewExec$d$1=false;function dew$d$1(){if(_dewExec$d$1)return exports$d$1;_dewExec$d$1=true;var Range=dew$l();var _dew$1$=dew$1$3(),ANY=_dew$1$.ANY;var satisfies=dew$m();var compare=dew$9();// Complex range `r1 || r2 || ...` is a subset of `R1 || R2 || ...` iff:
// - Every simple range `r1, r2, ...` is a subset of some `R1, R2, ...`
//
// Simple range `c1 c2 ...` is a subset of simple range `C1 C2 ...` iff:
// - If c is only the ANY comparator
//   - If C is only the ANY comparator, return true
//   - Else return false
// - Let EQ be the set of = comparators in c
// - If EQ is more than one, return true (null set)
// - Let GT be the highest > or >= comparator in c
// - Let LT be the lowest < or <= comparator in c
// - If GT and LT, and GT.semver > LT.semver, return true (null set)
// - If EQ
//   - If GT, and EQ does not satisfy GT, return true (null set)
//   - If LT, and EQ does not satisfy LT, return true (null set)
//   - If EQ satisfies every C, return true
//   - Else return false
// - If GT
//   - If GT.semver is lower than any > or >= comp in C, return false
//   - If GT is >=, and GT.semver does not satisfy every C, return false
// - If LT
//   - If LT.semver is greater than any < or <= comp in C, return false
//   - If LT is <=, and LT.semver does not satisfy every C, return false
// - If any C is a = range, and GT or LT are set, return false
// - Else return true
var subset=function subset(sub,dom,options){if(sub===dom)return true;sub=new Range(sub,options);dom=new Range(dom,options);var sawNonNull=false;var _iterator20=_createForOfIteratorHelper(sub.set),_step20;try{OUTER:for(_iterator20.s();!(_step20=_iterator20.n()).done;){var simpleSub=_step20.value;var _iterator21=_createForOfIteratorHelper(dom.set),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var simpleDom=_step21.value;var isSub=simpleSubset(simpleSub,simpleDom,options);sawNonNull=sawNonNull||isSub!==null;if(isSub)continue OUTER;}// the null set is a subset of everything, but null simple ranges in
// a complex range should be ignored.  so if we saw a non-null range,
// then we know this isn't a subset, but if EVERY simple range was null,
// then it is a subset.
}catch(err){_iterator21.e(err);}finally{_iterator21.f();}if(sawNonNull)return false;}}catch(err){_iterator20.e(err);}finally{_iterator20.f();}return true;};var simpleSubset=function simpleSubset(sub,dom,options){if(sub===dom)return true;if(sub.length===1&&sub[0].semver===ANY)return dom.length===1&&dom[0].semver===ANY;var eqSet=new Set();var gt,lt;var _iterator22=_createForOfIteratorHelper(sub),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var _c3=_step22.value;if(_c3.operator===">"||_c3.operator===">=")gt=higherGT(gt,_c3,options);else if(_c3.operator==="<"||_c3.operator==="<=")lt=lowerLT(lt,_c3,options);else eqSet.add(_c3.semver);}}catch(err){_iterator22.e(err);}finally{_iterator22.f();}if(eqSet.size>1)return null;var gtltComp;if(gt&&lt){gtltComp=compare(gt.semver,lt.semver,options);if(gtltComp>0)return null;else if(gtltComp===0&&(gt.operator!==">="||lt.operator!=="<="))return null;}// will iterate one or zero times
var _iterator23=_createForOfIteratorHelper(eqSet),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var eq=_step23.value;if(gt&&!satisfies(eq,String(gt),options))return null;if(lt&&!satisfies(eq,String(lt),options))return null;var _iterator25=_createForOfIteratorHelper(dom),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var _c4=_step25.value;if(!satisfies(eq,String(_c4),options))return false;}}catch(err){_iterator25.e(err);}finally{_iterator25.f();}return true;}}catch(err){_iterator23.e(err);}finally{_iterator23.f();}var higher,lower;var hasDomLT,hasDomGT;var _iterator24=_createForOfIteratorHelper(dom),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var _c5=_step24.value;hasDomGT=hasDomGT||_c5.operator===">"||_c5.operator===">=";hasDomLT=hasDomLT||_c5.operator==="<"||_c5.operator==="<=";if(gt){if(_c5.operator===">"||_c5.operator===">="){higher=higherGT(gt,_c5,options);if(higher===_c5&&higher!==gt)return false;}else if(gt.operator===">="&&!satisfies(gt.semver,String(_c5),options))return false;}if(lt){if(_c5.operator==="<"||_c5.operator==="<="){lower=lowerLT(lt,_c5,options);if(lower===_c5&&lower!==lt)return false;}else if(lt.operator==="<="&&!satisfies(lt.semver,String(_c5),options))return false;}if(!_c5.operator&&(lt||gt)&&gtltComp!==0)return false;}// if there was a < or >, and nothing in the dom, then must be false
// UNLESS it was limited by another range in the other direction.
// Eg, >1.0.0 <1.0.1 is still a subset of <2.0.0
}catch(err){_iterator24.e(err);}finally{_iterator24.f();}if(gt&&hasDomLT&&!lt&&gtltComp!==0)return false;if(lt&&hasDomGT&&!gt&&gtltComp!==0)return false;return true;};// >=1.2.3 is lower than >1.2.3
var higherGT=function higherGT(a,b,options){if(!a)return b;var comp=compare(a.semver,b.semver,options);return comp>0?a:comp<0?b:b.operator===">"&&a.operator===">="?b:a;};// <=1.2.3 is higher than <1.2.3
var lowerLT=function lowerLT(a,b,options){if(!a)return b;var comp=compare(a.semver,b.semver,options);return comp<0?a:comp>0?b:b.operator==="<"&&a.operator==="<="?b:a;};exports$d$1=subset;return exports$d$1;}var exports$e$1={},_dewExec$e$1=false;function dew$e$1(){if(_dewExec$e$1)return exports$e$1;_dewExec$e$1=true;// just pre-load all the stuff that index.js lazily exports
var internalRe=dew$2();exports$e$1={re:internalRe.re,src:internalRe.src,tokens:internalRe.t,SEMVER_SPEC_VERSION:dew().SEMVER_SPEC_VERSION,SemVer:dew$5(),compareIdentifiers:dew$4().compareIdentifiers,rcompareIdentifiers:dew$4().rcompareIdentifiers,parse:dew$6(),valid:dew$7(),clean:dew$p(),inc:dew$8(),diff:dew$b(),major:dew$c(),minor:dew$1$4(),patch:dew$2$2(),prerelease:dew$d(),compare:dew$9(),rcompare:dew$e(),compareLoose:dew$3$1(),compareBuild:dew$f(),sort:dew$4$1(),rsort:dew$1$1(),gt:dew$g(),lt:dew$h(),eq:dew$a(),neq:dew$j(),gte:dew$i(),lte:dew$1$2(),cmp:dew$2$1(),coerce:dew$k(),Comparator:dew$1$3(),Range:dew$l(),satisfies:dew$m(),toComparators:dew$5$1(),maxSatisfying:dew$n(),minSatisfying:dew$6$1(),minVersion:dew$7$1(),validRange:dew$o(),outside:dew$8$1(),gtr:dew$9$1(),ltr:dew$a$1(),intersects:dew$b$1(),simplifyRange:dew$c$1(),subset:dew$d$1()};return exports$e$1;}var exports$t=dew$e$1();var _$re=exports$t['re'];function normalizeOptions(options){options=_objectSpread({plugins:allPlugins,reinitializeIds:false,skipMigrations:true},options);if(options.reinitializeIds&&typeof options.reinitializeIds!=="function")throw new Error("serializer option 'reinitializeIds' needs to be a function(id, ref) => id");return options;}function normalizeMigrations(){var migrations=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return{before:migrations.filter(function(ea){return typeof ea.snapshotConverter==="function";}),after:migrations.filter(function(ea){return typeof ea.objectConverter==="function";})};}function runMigrations(migrations,method,idAndSnapshot,pool){for(var _i68=0;_i68<migrations.length;_i68++){var migration=migrations[_i68];try{idAndSnapshot=migration[method](idAndSnapshot,pool);}catch(err){console.error("migration ".concat(migration.name," failed:"));console.error(err);}}return idAndSnapshot;}var majorAndMinorVersionRe=/\.[^\.]+$/;// x.y.z => x.y
function serialize(obj,options){options=normalizeOptions(options);var objPool=options.objPool||new ObjectPool(options),requiredVersion=">="+version.replace(majorAndMinorVersionRe,""),// semver
snapshotAndId=objPool.snapshotObject(obj);removeUnreachableObjects([snapshotAndId.id],snapshotAndId.snapshot);clearDanglingConnections(snapshotAndId.snapshot);snapshotAndId.requiredVersion=requiredVersion;return snapshotAndId;}function deserialize(idAndSnapshot,options){options=normalizeOptions(options);var requiredVersion=idAndSnapshot.requiredVersion;if(requiredVersion&&!exports$t.satisfies(version,requiredVersion))console.warn("[lively.serializer deserialization] snapshot requires version "+"".concat(requiredVersion," but serializer has incompatible version ")+"".concat(version,". Deserialization might fail...!"));var objPool=options.objPool||new ObjectPool(options);return objPool.resolveFromSnapshotAndId(idAndSnapshot);}function deserializeWithMigrations(idAndSnapshot,migrations,options){options=normalizeOptions(options);if(migrations.length)options.skipMigrations=false;var objPool=options.objPool||(options.objPool=new ObjectPool(options)),_normalizeMigrations=normalizeMigrations(migrations),before=_normalizeMigrations.before,after=_normalizeMigrations.after,wait;runMigrations(before,"snapshotConverter",idAndSnapshot,objPool);if(typeof options.onDeserializationStart==="function")wait=options.onDeserializationStart(idAndSnapshot,options);return wait instanceof Promise?wait.then(step2):step2();function step2(){var deserialized=deserialize(idAndSnapshot,options);runMigrations(after,"objectConverter",idAndSnapshot,objPool);return deserialized;}}function copy(obj,options){return deserialize(serialize(obj,options),options);}var exports$u={};var nativeIsArray=Array.isArray;var toString=Object.prototype.toString;exports$u=nativeIsArray||isArray$2;function isArray$2(obj){return toString.call(obj)==="[object Array]";}var exports$1$9=exports$u;var exports$v={};exports$v="2";var _version=exports$v;var _global$1=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$w={};var version$2=_version;VirtualPatch.NONE=0;VirtualPatch.VTEXT=1;VirtualPatch.VNODE=2;VirtualPatch.WIDGET=3;VirtualPatch.PROPS=4;VirtualPatch.ORDER=5;VirtualPatch.INSERT=6;VirtualPatch.REMOVE=7;VirtualPatch.THUNK=8;exports$w=VirtualPatch;function VirtualPatch(type,vNode,patch){(this||_global$1).type=Number(type);(this||_global$1).vNode=vNode;(this||_global$1).patch=patch;}VirtualPatch.prototype.version=version$2;VirtualPatch.prototype.type="VirtualPatch";var _vpatch=exports$w;var exports$x={};var version$3=_version;exports$x=isVirtualNode;function isVirtualNode(x){return x&&x.type==="VirtualNode"&&x.version===version$3;}var _isVnode=exports$x;var exports$y={};var version$4=_version;exports$y=isVirtualText;function isVirtualText(x){return x&&x.type==="VirtualText"&&x.version===version$4;}var _isVtext=exports$y;var exports$z={};exports$z=isWidget;function isWidget(w){return w&&w.type==="Widget";}var _isWidget=exports$z;var exports$A={};exports$A=isThunk;function isThunk(t){return t&&t.type==="Thunk";}var _isThunk=exports$A;var exports$B={};var isVNode=_isVnode;var isVText=_isVtext;var isWidget$1=_isWidget;var isThunk$1=_isThunk;exports$B=handleThunk;function handleThunk(a,b){var renderedA=a;var renderedB=b;if(isThunk$1(b)){renderedB=renderThunk(b,a);}if(isThunk$1(a)){renderedA=renderThunk(a,null);}return{a:renderedA,b:renderedB};}function renderThunk(thunk,previous){var renderedThunk=thunk.vnode;if(!renderedThunk){renderedThunk=thunk.vnode=thunk.render(previous);}if(!(isVNode(renderedThunk)||isVText(renderedThunk)||isWidget$1(renderedThunk))){throw new Error("thunk did not return a valid node");}return renderedThunk;}var _handleThunk=exports$B;var exports$C={};exports$C=function isObject(x){return _typeof2(x)==="object"&&x!==null;};var exports$1$a=exports$C;var exports$D={};exports$D=isHook;function isHook(hook){return hook&&(typeof hook.hook==="function"&&!hook.hasOwnProperty("hook")||typeof hook.unhook==="function"&&!hook.hasOwnProperty("unhook"));}var _isVhook=exports$D;var exports$E={};var isObject$1=exports$1$a;var isHook$1=_isVhook;exports$E=diffProps;function diffProps(a,b){var diff;for(var aKey in a){if(!(aKey in b)){diff=diff||{};diff[aKey]=undefined;}var aValue=a[aKey];var bValue=b[aKey];if(aValue===bValue){continue;}else if(isObject$1(aValue)&&isObject$1(bValue)){if(getPrototype(bValue)!==getPrototype(aValue)){diff=diff||{};diff[aKey]=bValue;}else if(isHook$1(bValue)){diff=diff||{};diff[aKey]=bValue;}else{var objectDiff=diffProps(aValue,bValue);if(objectDiff){diff=diff||{};diff[aKey]=objectDiff;}}}else{diff=diff||{};diff[aKey]=bValue;}}for(var bKey in b){if(!(bKey in a)){diff=diff||{};diff[bKey]=b[bKey];}}return diff;}function getPrototype(value){if(Object.getPrototypeOf){return Object.getPrototypeOf(value);}else if(value.__proto__){return value.__proto__;}else if(value.constructor){return value.constructor.prototype;}}var _diffProps=exports$E;var exports$1$b={};var isArray$3=exports$1$9;var VPatch=_vpatch;var isVNode$1=_isVnode;var isVText$1=_isVtext;var isWidget$2=_isWidget;var isThunk$2=_isThunk;var handleThunk$1=_handleThunk;var diffProps$1=_diffProps;exports$1$b=diff$1;function diff$1(a,b){var patch={a:a};walk(a,b,patch,0);return patch;}function walk(a,b,patch,index){if(a===b){return;}var apply=patch[index];var applyClear=false;if(isThunk$2(a)||isThunk$2(b)){thunks(a,b,patch,index);}else if(b==null){// If a is a widget we will add a remove patch for it
// Otherwise any child widgets/hooks must be destroyed.
// This prevents adding two remove patches for a widget.
if(!isWidget$2(a)){clearState(a,patch,index);apply=patch[index];}apply=appendPatch(apply,new VPatch(VPatch.REMOVE,a,b));}else if(isVNode$1(b)){if(isVNode$1(a)){if(a.tagName===b.tagName&&a.namespace===b.namespace&&a.key===b.key){var propsPatch=diffProps$1(a.properties,b.properties);if(propsPatch){apply=appendPatch(apply,new VPatch(VPatch.PROPS,a,propsPatch));}apply=diffChildren(a,b,patch,apply,index);}else{apply=appendPatch(apply,new VPatch(VPatch.VNODE,a,b));applyClear=true;}}else{apply=appendPatch(apply,new VPatch(VPatch.VNODE,a,b));applyClear=true;}}else if(isVText$1(b)){if(!isVText$1(a)){apply=appendPatch(apply,new VPatch(VPatch.VTEXT,a,b));applyClear=true;}else if(a.text!==b.text){apply=appendPatch(apply,new VPatch(VPatch.VTEXT,a,b));}}else if(isWidget$2(b)){if(!isWidget$2(a)){applyClear=true;}apply=appendPatch(apply,new VPatch(VPatch.WIDGET,a,b));}if(apply){patch[index]=apply;}if(applyClear){clearState(a,patch,index);}}function diffChildren(a,b,patch,apply,index){var aChildren=a.children;var orderedSet=reorder(aChildren,b.children);var bChildren=orderedSet.children;var aLen=aChildren.length;var bLen=bChildren.length;var len=aLen>bLen?aLen:bLen;for(var i=0;i<len;i++){var leftNode=aChildren[i];var rightNode=bChildren[i];index+=1;if(!leftNode){if(rightNode){// Excess nodes in b need to be added
apply=appendPatch(apply,new VPatch(VPatch.INSERT,null,rightNode));}}else{walk(leftNode,rightNode,patch,index);}if(isVNode$1(leftNode)&&leftNode.count){index+=leftNode.count;}}if(orderedSet.moves){// Reorder nodes last
apply=appendPatch(apply,new VPatch(VPatch.ORDER,a,orderedSet.moves));}return apply;}function clearState(vNode,patch,index){// TODO: Make this a single walk, not two
unhook(vNode,patch,index);destroyWidgets(vNode,patch,index);}// Patch records for all destroyed widgets must be added because we need
// a DOM node reference for the destroy function
function destroyWidgets(vNode,patch,index){if(isWidget$2(vNode)){if(typeof vNode.destroy==="function"){patch[index]=appendPatch(patch[index],new VPatch(VPatch.REMOVE,vNode,null));}}else if(isVNode$1(vNode)&&(vNode.hasWidgets||vNode.hasThunks)){var children=vNode.children;var len=children.length;for(var i=0;i<len;i++){var child=children[i];index+=1;destroyWidgets(child,patch,index);if(isVNode$1(child)&&child.count){index+=child.count;}}}else if(isThunk$2(vNode)){thunks(vNode,null,patch,index);}}// Create a sub-patch for thunks
function thunks(a,b,patch,index){var nodes=handleThunk$1(a,b);var thunkPatch=diff$1(nodes.a,nodes.b);if(hasPatches(thunkPatch)){patch[index]=new VPatch(VPatch.THUNK,null,thunkPatch);}}function hasPatches(patch){for(var index in patch){if(index!=="a"){return true;}}return false;}// Execute hooks when two nodes are identical
function unhook(vNode,patch,index){if(isVNode$1(vNode)){if(vNode.hooks){patch[index]=appendPatch(patch[index],new VPatch(VPatch.PROPS,vNode,undefinedKeys(vNode.hooks)));}if(vNode.descendantHooks||vNode.hasThunks){var children=vNode.children;var len=children.length;for(var i=0;i<len;i++){var child=children[i];index+=1;unhook(child,patch,index);if(isVNode$1(child)&&child.count){index+=child.count;}}}}else if(isThunk$2(vNode)){thunks(vNode,null,patch,index);}}function undefinedKeys(obj){var result={};for(var key in obj){result[key]=undefined;}return result;}// List diff, naive left to right reordering
function reorder(aChildren,bChildren){// O(M) time, O(M) memory
var bChildIndex=keyIndex(bChildren);var bKeys=bChildIndex.keys;var bFree=bChildIndex.free;if(bFree.length===bChildren.length){return{children:bChildren,moves:null};}// O(N) time, O(N) memory
var aChildIndex=keyIndex(aChildren);var aKeys=aChildIndex.keys;var aFree=aChildIndex.free;if(aFree.length===aChildren.length){return{children:bChildren,moves:null};}// O(MAX(N, M)) memory
var newChildren=[];var freeIndex=0;var freeCount=bFree.length;var deletedItems=0;// Iterate through a and match a node in b
// O(N) time,
for(var i=0;i<aChildren.length;i++){var aItem=aChildren[i];var itemIndex;if(aItem.key){if(bKeys.hasOwnProperty(aItem.key)){// Match up the old keys
itemIndex=bKeys[aItem.key];newChildren.push(bChildren[itemIndex]);}else{// Remove old keyed items
itemIndex=i-deletedItems++;newChildren.push(null);}}else{// Match the item in a with the next free item in b
if(freeIndex<freeCount){itemIndex=bFree[freeIndex++];newChildren.push(bChildren[itemIndex]);}else{// There are no free items in b to match with
// the free items in a, so the extra free nodes
// are deleted.
itemIndex=i-deletedItems++;newChildren.push(null);}}}var lastFreeIndex=freeIndex>=bFree.length?bChildren.length:bFree[freeIndex];// Iterate through b and append any new keys
// O(M) time
for(var j=0;j<bChildren.length;j++){var newItem=bChildren[j];if(newItem.key){if(!aKeys.hasOwnProperty(newItem.key)){// Add any new keyed items
// We are adding new items to the end and then sorting them
// in place. In future we should insert new items in place.
newChildren.push(newItem);}}else if(j>=lastFreeIndex){// Add any leftover non-keyed items
newChildren.push(newItem);}}var simulate=newChildren.slice();var simulateIndex=0;var removes=[];var inserts=[];var simulateItem;for(var k=0;k<bChildren.length;){var wantedItem=bChildren[k];simulateItem=simulate[simulateIndex];// remove items
while(simulateItem===null&&simulate.length){removes.push(remove$1(simulate,simulateIndex,null));simulateItem=simulate[simulateIndex];}if(!simulateItem||simulateItem.key!==wantedItem.key){// if we need a key in this position...
if(wantedItem.key){if(simulateItem&&simulateItem.key){// if an insert doesn't put this key in place, it needs to move
if(bKeys[simulateItem.key]!==k+1){removes.push(remove$1(simulate,simulateIndex,simulateItem.key));simulateItem=simulate[simulateIndex];// if the remove didn't put the wanted item in place, we need to insert it
if(!simulateItem||simulateItem.key!==wantedItem.key){inserts.push({key:wantedItem.key,to:k});}// items are matching, so skip ahead
else{simulateIndex++;}}else{inserts.push({key:wantedItem.key,to:k});}}else{inserts.push({key:wantedItem.key,to:k});}k++;}// a key in simulate has no matching wanted key, remove it
else if(simulateItem&&simulateItem.key){removes.push(remove$1(simulate,simulateIndex,simulateItem.key));}}else{simulateIndex++;k++;}}// remove all the remaining nodes from simulate
while(simulateIndex<simulate.length){simulateItem=simulate[simulateIndex];removes.push(remove$1(simulate,simulateIndex,simulateItem&&simulateItem.key));}// If the only moves we have are deletes then we can just
// let the delete patch remove these items.
if(removes.length===deletedItems&&!inserts.length){return{children:newChildren,moves:null};}return{children:newChildren,moves:{removes:removes,inserts:inserts}};}function remove$1(arr,index,key){arr.splice(index,1);return{from:index,key:key};}function keyIndex(children){var keys={};var free=[];var length=children.length;for(var i=0;i<length;i++){var child=children[i];if(child.key){keys[child.key]=i;}else{free.push(i);}}return{keys:keys,// A hash of key name to index
free:free// An array of unkeyed item indices
};}function appendPatch(apply,patch){if(apply){if(isArray$3(apply)){apply.push(patch);}else{apply=[apply,patch];}return apply;}else{return patch;}}var _diff=exports$1$b;var exports$F={};var diff$2=_diff;exports$F=diff$2;var _diff$1=exports$F;var _minDocument=Object.freeze({});var _global$2=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$G={};var topLevel=typeof _global$2!=="undefined"?_global$2:typeof window!=="undefined"?window:{};var minDoc=_minDocument;var doccy;if(typeof document!=="undefined"){doccy=document;}else{doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"];if(!doccy){doccy=topLevel["__GLOBAL_DOCUMENT_CACHE@4"]=minDoc;}}exports$G=doccy;var exports$1$c=exports$G;var exports$H={};var isObject$2=exports$1$a;var isHook$2=_isVhook;exports$H=applyProperties;function applyProperties(node,props,previous){for(var propName in props){var propValue=props[propName];if(propValue===undefined){removeProperty(node,propName,propValue,previous);}else if(isHook$2(propValue)){removeProperty(node,propName,propValue,previous);if(propValue.hook){propValue.hook(node,propName,previous?previous[propName]:undefined);}}else{if(isObject$2(propValue)){patchObject(node,props,previous,propName,propValue);}else{node[propName]=propValue;}}}}function removeProperty(node,propName,propValue,previous){if(previous){var previousValue=previous[propName];if(!isHook$2(previousValue)){if(propName==="attributes"){for(var attrName in previousValue){node.removeAttribute(attrName);}}else if(propName==="style"){for(var i in previousValue){node.style[i]="";}}else if(typeof previousValue==="string"){node[propName]="";}else{node[propName]=null;}}else if(previousValue.unhook){previousValue.unhook(node,propName,propValue);}}}function patchObject(node,props,previous,propName,propValue){var previousValue=previous?previous[propName]:undefined;// Set attributes
if(propName==="attributes"){for(var attrName in propValue){var attrValue=propValue[attrName];if(attrValue===undefined){node.removeAttribute(attrName);}else{node.setAttribute(attrName,attrValue);}}return;}if(previousValue&&isObject$2(previousValue)&&getPrototype$1(previousValue)!==getPrototype$1(propValue)){node[propName]=propValue;return;}if(!isObject$2(node[propName])){node[propName]={};}var replacer=propName==="style"?"":undefined;for(var k in propValue){var value=propValue[k];node[propName][k]=value===undefined?replacer:value;}}function getPrototype$1(value){if(Object.getPrototypeOf){return Object.getPrototypeOf(value);}else if(value.__proto__){return value.__proto__;}else if(value.constructor){return value.constructor.prototype;}}var _applyProperties=exports$H;var exports$I={};var document$1=exports$1$c;var applyProperties$1=_applyProperties;var isVNode$2=_isVnode;var isVText$2=_isVtext;var isWidget$3=_isWidget;var handleThunk$2=_handleThunk;exports$I=createElement;function createElement(vnode,opts){var doc=opts?opts.document||document$1:document$1;var warn=opts?opts.warn:null;vnode=handleThunk$2(vnode).a;if(isWidget$3(vnode)){return vnode.init();}else if(isVText$2(vnode)){return doc.createTextNode(vnode.text);}else if(!isVNode$2(vnode)){if(warn){warn("Item is not a valid virtual dom node",vnode);}return null;}var node=vnode.namespace===null?doc.createElement(vnode.tagName):doc.createElementNS(vnode.namespace,vnode.tagName);var props=vnode.properties;applyProperties$1(node,props);var children=vnode.children;for(var i=0;i<children.length;i++){var childNode=createElement(children[i],opts);if(childNode){node.appendChild(childNode);}}return node;}var _createElement=exports$I;var exports$J={};var isWidget$4=_isWidget;exports$J=updateWidget;function updateWidget(a,b){if(isWidget$4(a)&&isWidget$4(b)){if("name"in a&&"name"in b){return a.id===b.id;}else{return a.init===b.init;}}return false;}var _updateWidget=exports$J;var exports$K={};// Maps a virtual DOM tree onto a real DOM tree in an efficient manner.
// We don't want to read all of the DOM nodes in the tree so we use
// the in-order tree indexing to eliminate recursion down certain branches.
// We only recurse into a DOM node if we know that it contains a child of
// interest.
var noChild={};exports$K=domIndex;function domIndex(rootNode,tree,indices,nodes){if(!indices||indices.length===0){return{};}else{indices.sort(ascending);return recurse(rootNode,tree,indices,nodes,0);}}function recurse(rootNode,tree,indices,nodes,rootIndex){nodes=nodes||{};if(rootNode){if(indexInRange(indices,rootIndex,rootIndex)){nodes[rootIndex]=rootNode;}var vChildren=tree.children;if(vChildren){var childNodes=rootNode.childNodes;for(var i=0;i<tree.children.length;i++){rootIndex+=1;var vChild=vChildren[i]||noChild;var nextIndex=rootIndex+(vChild.count||0);// skip recursion down the tree if there are no nodes down here
if(indexInRange(indices,rootIndex,nextIndex)){recurse(childNodes[i],vChild,indices,nodes,rootIndex);}rootIndex=nextIndex;}}}return nodes;}// Binary search for an index in the interval [left, right]
function indexInRange(indices,left,right){if(indices.length===0){return false;}var minIndex=0;var maxIndex=indices.length-1;var currentIndex;var currentItem;while(minIndex<=maxIndex){currentIndex=(maxIndex+minIndex)/2>>0;currentItem=indices[currentIndex];if(minIndex===maxIndex){return currentItem>=left&&currentItem<=right;}else if(currentItem<left){minIndex=currentIndex+1;}else if(currentItem>right){maxIndex=currentIndex-1;}else{return true;}}return false;}function ascending(a,b){return a>b?1:-1;}var _domIndex=exports$K;var exports$1$d={};var applyProperties$2=_applyProperties;var isWidget$5=_isWidget;var VPatch$1=_vpatch;var updateWidget$1=_updateWidget;exports$1$d=applyPatch;function applyPatch(vpatch,domNode,renderOptions){var type=vpatch.type;var vNode=vpatch.vNode;var patch=vpatch.patch;switch(type){case VPatch$1.REMOVE:return removeNode(domNode,vNode);case VPatch$1.INSERT:return insertNode(domNode,patch,renderOptions);case VPatch$1.VTEXT:return stringPatch(domNode,vNode,patch,renderOptions);case VPatch$1.WIDGET:return widgetPatch(domNode,vNode,patch,renderOptions);case VPatch$1.VNODE:return vNodePatch(domNode,vNode,patch,renderOptions);case VPatch$1.ORDER:reorderChildren(domNode,patch);return domNode;case VPatch$1.PROPS:applyProperties$2(domNode,patch,vNode.properties);return domNode;case VPatch$1.THUNK:return replaceRoot(domNode,renderOptions.patch(domNode,patch,renderOptions));default:return domNode;}}function removeNode(domNode,vNode){var parentNode=domNode.parentNode;if(parentNode){parentNode.removeChild(domNode);}destroyWidget(domNode,vNode);return null;}function insertNode(parentNode,vNode,renderOptions){var newNode=renderOptions.render(vNode,renderOptions);if(parentNode){parentNode.appendChild(newNode);}return parentNode;}function stringPatch(domNode,leftVNode,vText,renderOptions){var newNode;if(domNode.nodeType===3){domNode.replaceData(0,domNode.length,vText.text);newNode=domNode;}else{var parentNode=domNode.parentNode;newNode=renderOptions.render(vText,renderOptions);if(parentNode&&newNode!==domNode){parentNode.replaceChild(newNode,domNode);}}return newNode;}function widgetPatch(domNode,leftVNode,widget,renderOptions){var updating=updateWidget$1(leftVNode,widget);var newNode;if(updating){newNode=widget.update(leftVNode,domNode)||domNode;}else{newNode=renderOptions.render(widget,renderOptions);}var parentNode=domNode.parentNode;if(parentNode&&newNode!==domNode){parentNode.replaceChild(newNode,domNode);}if(!updating){destroyWidget(domNode,leftVNode);}return newNode;}function vNodePatch(domNode,leftVNode,vNode,renderOptions){var parentNode=domNode.parentNode;var newNode=renderOptions.render(vNode,renderOptions);if(parentNode&&newNode!==domNode){parentNode.replaceChild(newNode,domNode);}return newNode;}function destroyWidget(domNode,w){if(typeof w.destroy==="function"&&isWidget$5(w)){w.destroy(domNode);}}function reorderChildren(domNode,moves){var childNodes=domNode.childNodes;var keyMap={};var node;var remove;var insert;for(var i=0;i<moves.removes.length;i++){remove=moves.removes[i];node=childNodes[remove.from];if(remove.key){keyMap[remove.key]=node;}domNode.removeChild(node);}var length=childNodes.length;for(var j=0;j<moves.inserts.length;j++){insert=moves.inserts[j];node=keyMap[insert.key];// this is the weirdest bug i've ever seen in webkit
domNode.insertBefore(node,insert.to>=length++?null:childNodes[insert.to]);}}function replaceRoot(oldRoot,newRoot){if(oldRoot&&newRoot&&oldRoot!==newRoot&&oldRoot.parentNode){oldRoot.parentNode.replaceChild(newRoot,oldRoot);}return newRoot;}var _patchOp=exports$1$d;var exports$2$5={};var document$2=exports$1$c;var isArray$4=exports$1$9;var render=_createElement;var domIndex$1=_domIndex;var patchOp=_patchOp;exports$2$5=patch;function patch(rootNode,patches,renderOptions){renderOptions=renderOptions||{};renderOptions.patch=renderOptions.patch&&renderOptions.patch!==patch?renderOptions.patch:patchRecursive;renderOptions.render=renderOptions.render||render;return renderOptions.patch(rootNode,patches,renderOptions);}function patchRecursive(rootNode,patches,renderOptions){var indices=patchIndices(patches);if(indices.length===0){return rootNode;}var index=domIndex$1(rootNode,patches.a,indices);var ownerDocument=rootNode.ownerDocument;if(!renderOptions.document&&ownerDocument!==document$2){renderOptions.document=ownerDocument;}for(var i=0;i<indices.length;i++){var nodeIndex=indices[i];rootNode=applyPatch$1(rootNode,index[nodeIndex],patches[nodeIndex],renderOptions);}return rootNode;}function applyPatch$1(rootNode,domNode,patchList,renderOptions){if(!domNode){return rootNode;}var newNode;if(isArray$4(patchList)){for(var i=0;i<patchList.length;i++){newNode=patchOp(patchList[i],domNode,renderOptions);if(domNode===rootNode){rootNode=newNode;}}}else{newNode=patchOp(patchList,domNode,renderOptions);if(domNode===rootNode){rootNode=newNode;}}return rootNode;}function patchIndices(patches){var indices=[];for(var key in patches){if(key!=="a"){indices.push(Number(key));}}return indices;}var _patch=exports$2$5;var exports$L={};var patch$1=_patch;exports$L=patch$1;var _patch$1=exports$L;var _global$3=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$M={};var version$5=_version;var isVNode$3=_isVnode;var isWidget$6=_isWidget;var isThunk$3=_isThunk;var isVHook=_isVhook;exports$M=VirtualNode;var noProperties={};var noChildren=[];function VirtualNode(tagName,properties,children,key,namespace){(this||_global$3).tagName=tagName;(this||_global$3).properties=properties||noProperties;(this||_global$3).children=children||noChildren;(this||_global$3).key=key!=null?String(key):undefined;(this||_global$3).namespace=typeof namespace==="string"?namespace:null;var count=children&&children.length||0;var descendants=0;var hasWidgets=false;var hasThunks=false;var descendantHooks=false;var hooks;for(var propName in properties){if(properties.hasOwnProperty(propName)){var property=properties[propName];if(isVHook(property)&&property.unhook){if(!hooks){hooks={};}hooks[propName]=property;}}}for(var i=0;i<count;i++){var child=children[i];if(isVNode$3(child)){descendants+=child.count||0;if(!hasWidgets&&child.hasWidgets){hasWidgets=true;}if(!hasThunks&&child.hasThunks){hasThunks=true;}if(!descendantHooks&&(child.hooks||child.descendantHooks)){descendantHooks=true;}}else if(!hasWidgets&&isWidget$6(child)){if(typeof child.destroy==="function"){hasWidgets=true;}}else if(!hasThunks&&isThunk$3(child)){hasThunks=true;}}(this||_global$3).count=count+descendants;(this||_global$3).hasWidgets=hasWidgets;(this||_global$3).hasThunks=hasThunks;(this||_global$3).hooks=hooks;(this||_global$3).descendantHooks=descendantHooks;}VirtualNode.prototype.version=version$5;VirtualNode.prototype.type="VirtualNode";var _vnode=exports$M;var _global$4=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$N={};var version$6=_version;exports$N=VirtualText;function VirtualText(text){(this||_global$4).text=String(text);}VirtualText.prototype.version=version$6;VirtualText.prototype.type="VirtualText";var _vtext=exports$N;var exports$O={};/*!
       * Cross-Browser Split 1.1.1
       * Copyright 2007-2012 Steven Levithan <stevenlevithan.com>
       * Available under the MIT License
       * ECMAScript compliant, uniform cross-browser split method
       */ /**
       * Splits a string into an array of strings using a regex or string separator. Matches of the
       * separator are not included in the result array. However, if `separator` is a regex that contains
       * capturing groups, backreferences are spliced into the result each time `separator` is matched.
       * Fixes browser bugs compared to the native `String.prototype.split` and can be used reliably
       * cross-browser.
       * @param {String} str String to split.
       * @param {RegExp|String} separator Regex or string to use for separating the string.
       * @param {Number} [limit] Maximum number of items to include in the result array.
       * @returns {Array} Array of substrings.
       * @example
       *
       * // Basic use
       * split('a b c d', ' ');
       * // -> ['a', 'b', 'c', 'd']
       *
       * // With limit
       * split('a b c d', ' ', 2);
       * // -> ['a', 'b']
       *
       * // Backreferences in result array
       * split('..word1 word2..', /([a-z]+)(\d+)/i);
       * // -> ['..', 'word', '1', ' ', 'word', '2', '..']
       */exports$O=function split(undef){var nativeSplit=String.prototype.split,compliantExecNpcg=/()??/.exec("")[1]===undef,// NPCG: nonparticipating capturing group
self;self=function self(str,separator,limit){// If `separator` is not a regex, use `nativeSplit`
if(Object.prototype.toString.call(separator)!=="[object RegExp]"){return nativeSplit.call(str,separator,limit);}var output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.extended?"x":"")+(// Proposed for ES6
separator.sticky?"y":""),// Firefox 3+
lastLastIndex=0,// Make `global` and avoid `lastIndex` issues by working with a copy
separator=new RegExp(separator.source,flags+"g"),separator2,match,lastIndex,lastLength;str+="";// Type-convert
if(!compliantExecNpcg){// Doesn't need flags gy, but they don't hurt
separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags);}/* Values for `limit`, per the spec:
           * If undefined: 4294967295 // Math.pow(2, 32) - 1
           * If 0, Infinity, or NaN: 0
           * If positive number: limit = Math.floor(limit); if (limit > 4294967295) limit -= 4294967296;
           * If negative number: 4294967296 - Math.floor(Math.abs(limit))
           * If other: Type-convert, then use the above rules
           */limit=limit===undef?-1>>>0:// Math.pow(2, 32) - 1
limit>>>0;// ToUint32(limit)
while(match=separator.exec(str)){// `separator.lastIndex` is not reliable cross-browser
lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));// Fix browsers whose `exec` methods don't consistently return `undefined` for
// nonparticipating capturing groups
if(!compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undef){match[i]=undef;}}});}if(match.length>1&&match.index<str.length){Array.prototype.push.apply(output,match.slice(1));}lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit){break;}}if(separator.lastIndex===match.index){separator.lastIndex++;// Avoid an infinite loop
}}if(lastLastIndex===str.length){if(lastLength||!separator.test("")){output.push("");}}else{output.push(str.slice(lastLastIndex));}return output.length>limit?output.slice(0,limit):output;};return self;}();var exports$1$e=exports$O;var exports$P={};var split=exports$1$e;var classIdSplit=/([\.#]?[a-zA-Z0-9\u007F-\uFFFF_:-]+)/;var notClassId=/^\.|#/;exports$P=parseTag;function parseTag(tag,props){if(!tag){return"DIV";}var noId=!props.hasOwnProperty("id");var tagParts=split(tag,classIdSplit);var tagName=null;if(notClassId.test(tagParts[1])){tagName="DIV";}var classes,part,type,i;for(i=0;i<tagParts.length;i++){part=tagParts[i];if(!part){continue;}type=part.charAt(0);if(!tagName){tagName=part;}else if(type==="."){classes=classes||[];classes.push(part.substring(1,part.length));}else if(type==="#"&&noId){props.id=part.substring(1,part.length);}}if(classes){if(props.className){classes.push(props.className);}props.className=classes.join(" ");}return props.namespace?tagName:tagName.toUpperCase();}var _parseTag=exports$P;var exports$Q={};exports$Q=SoftSetHook;function SoftSetHook(value){if(!(this instanceof SoftSetHook)){return new SoftSetHook(value);}this.value=value;}SoftSetHook.prototype.hook=function(node,propertyName){if(node[propertyName]!==this.value){node[propertyName]=this.value;}};var _softSetHook=exports$Q;var _global$5=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$R={};/*global window, global*/var root=typeof window!=="undefined"?window:typeof _global$5!=="undefined"?_global$5:{};exports$R=Individual;function Individual(key,value){if(key in root){return root[key];}root[key]=value;return value;}var _index=exports$R;var exports$S={};var Individual$1=_index;exports$S=OneVersion;function OneVersion(moduleName,version,defaultValue){var key="__INDIVIDUAL_ONE_VERSION_"+moduleName;var enforceKey=key+"_ENFORCE_SINGLETON";var versionValue=Individual$1(enforceKey,version);if(versionValue!==version){throw new Error("Can only have one copy of "+moduleName+".\n"+"You already have version "+versionValue+" installed.\n"+"This means you cannot install version "+version);}return Individual$1(key,defaultValue);}var exports$1$f=exports$S;var exports$T={};var OneVersionConstraint=exports$1$f;var MY_VERSION="7";OneVersionConstraint("ev-store",MY_VERSION);var hashKey="__EV_STORE_KEY@"+MY_VERSION;exports$T=EvStore;function EvStore(elem){var hash=elem[hashKey];if(!hash){hash=elem[hashKey]={};}return hash;}var exports$1$g=exports$T;var exports$U={};var EvStore$1=exports$1$g;exports$U=EvHook;function EvHook(value){if(!(this instanceof EvHook)){return new EvHook(value);}this.value=value;}EvHook.prototype.hook=function(node,propertyName){var es=EvStore$1(node);var propName=propertyName.substr(3);es[propName]=this.value;};EvHook.prototype.unhook=function(node,propertyName){var es=EvStore$1(node);var propName=propertyName.substr(3);es[propName]=undefined;};var _evHook=exports$U;var exports$V={};var isArray$5=exports$1$9;var VNode=_vnode;var VText=_vtext;var isVNode$4=_isVnode;var isVText$3=_isVtext;var isWidget$7=_isWidget;var isHook$3=_isVhook;var isVThunk=_isThunk;var parseTag$1=_parseTag;var softSetHook=_softSetHook;var evHook=_evHook;exports$V=h$1;function h$1(tagName,properties,children){var childNodes=[];var tag,props,key,namespace;if(!children&&isChildren(properties)){children=properties;props={};}props=props||properties||{};tag=parseTag$1(tagName,props);// support keys
if(props.hasOwnProperty("key")){key=props.key;props.key=undefined;}// support namespace
if(props.hasOwnProperty("namespace")){namespace=props.namespace;props.namespace=undefined;}// fix cursor bug
if(tag==="INPUT"&&!namespace&&props.hasOwnProperty("value")&&props.value!==undefined&&!isHook$3(props.value)){props.value=softSetHook(props.value);}transformProperties(props);if(children!==undefined&&children!==null){addChild(children,childNodes,tag,props);}return new VNode(tag,props,childNodes,key,namespace);}function addChild(c,childNodes,tag,props){if(typeof c==="string"){childNodes.push(new VText(c));}else if(typeof c==="number"){childNodes.push(new VText(String(c)));}else if(isChild(c)){childNodes.push(c);}else if(isArray$5(c)){for(var i=0;i<c.length;i++){addChild(c[i],childNodes,tag,props);}}else if(c===null||c===undefined){return;}else{throw UnexpectedVirtualElement({foreignObject:c,parentVnode:{tagName:tag,properties:props}});}}function transformProperties(props){for(var propName in props){if(props.hasOwnProperty(propName)){var value=props[propName];if(isHook$3(value)){continue;}if(propName.substr(0,3)==="ev-"){// add ev-foo support
props[propName]=evHook(value);}}}}function isChild(x){return isVNode$4(x)||isVText$3(x)||isWidget$7(x)||isVThunk(x);}function isChildren(x){return typeof x==="string"||isArray$5(x)||isChild(x);}function UnexpectedVirtualElement(data){var err=new Error();err.type="virtual-hyperscript.unexpected.virtual-element";err.message="Unexpected virtual child passed to h().\n"+"Expected a VNode / Vthunk / VWidget / string but:\n"+"got:\n"+errorString(data.foreignObject)+".\n"+"The parent vnode is:\n"+errorString(data.parentVnode);err.foreignObject=data.foreignObject;err.parentVnode=data.parentVnode;return err;}function errorString(obj){try{return JSON.stringify(obj,null,"    ");}catch(e){return String(obj);}}var _index$1=exports$V;var exports$W={};var h$2=_index$1;exports$W=h$2;var _h=exports$W;var exports$X={};var createElement$1=_createElement;exports$X=createElement$1;var _createElement$1=exports$X;var exports$Y={};var diff$3=_diff$1;var patch$2=_patch$1;var h$3=_h;var create$1=_createElement$1;var VNode$1=_vnode;var VText$1=_vtext;exports$Y={diff:diff$3,patch:patch$2,h:h$3,create:create$1,VNode:VNode$1,VText:VText$1};var exports$1$h=exports$Y;var _diff2=exports$Y.diff,_patch2=exports$Y.patch,_h2=exports$Y.h,_create=exports$Y.create,_VNode=exports$Y.VNode,_VText=exports$Y.VText;var exports$Z={};// invert of https://www.npmjs.com/package/html-attributes
var properties$1={"abbr":"abbr","accept":"accept","accept-charset":"acceptCharset","accesskey":"accessKey","action":"action","allowfullscreen":"allowFullScreen","allowtransparency":"allowTransparency","alt":"alt","async":"async","autocomplete":"autoComplete","autofocus":"autoFocus","autoplay":"autoPlay","cellpadding":"cellPadding","cellspacing":"cellSpacing","challenge":"challenge","charset":"charset","checked":"checked","cite":"cite","class":"className","cols":"cols","colspan":"colSpan","command":"command","content":"content","contenteditable":"contentEditable","contextmenu":"contextMenu","controls":"controls","coords":"coords","crossorigin":"crossOrigin","data":"data","datetime":"dateTime","default":"default","defer":"defer","dir":"dir","disabled":"disabled","download":"download","draggable":"draggable","dropzone":"dropzone","enctype":"encType","for":"htmlFor","form":"form","formaction":"formAction","formenctype":"formEncType","formmethod":"formMethod","formnovalidate":"formNoValidate","formtarget":"formTarget","frameBorder":"frameBorder","headers":"headers","height":"height","hidden":"hidden","high":"high","href":"href","hreflang":"hrefLang","http-equiv":"httpEquiv","icon":"icon","id":"id","inputmode":"inputMode","ismap":"isMap","itemid":"itemId","itemprop":"itemProp","itemref":"itemRef","itemscope":"itemScope","itemtype":"itemType","kind":"kind","label":"label","lang":"lang","list":"list","loop":"loop","manifest":"manifest","max":"max","maxlength":"maxLength","media":"media","mediagroup":"mediaGroup","method":"method","min":"min","minlength":"minLength","multiple":"multiple","muted":"muted","name":"name","novalidate":"noValidate","open":"open","optimum":"optimum","pattern":"pattern","ping":"ping","placeholder":"placeholder","poster":"poster","preload":"preload","radiogroup":"radioGroup","readonly":"readOnly","rel":"rel","required":"required","role":"role","rows":"rows","rowspan":"rowSpan","sandbox":"sandbox","scope":"scope","scoped":"scoped","scrolling":"scrolling","seamless":"seamless","selected":"selected","shape":"shape","size":"size","sizes":"sizes","sortable":"sortable","span":"span","spellcheck":"spellCheck","src":"src","srcdoc":"srcDoc","srcset":"srcSet","start":"start","step":"step","style":"style","tabindex":"tabIndex","target":"target","title":"title","translate":"translate","type":"type","typemustmatch":"typeMustMatch","usemap":"useMap","value":"value","width":"width","wmode":"wmode","wrap":"wrap"};exports$Z=properties$1;var _propertyMap=exports$Z;var exports$1$i={};// extracted from https://github.com/Matt-Esch/virtual-dom/blob/master/virtual-hyperscript/svg-attribute-namespace.js
var DEFAULT_NAMESPACE=null;var EV_NAMESPACE="http://www.w3.org/2001/xml-events";var XLINK_NAMESPACE="http://www.w3.org/1999/xlink";var XML_NAMESPACE="http://www.w3.org/XML/1998/namespace";var namespaces={"about":DEFAULT_NAMESPACE,"accent-height":DEFAULT_NAMESPACE,"accumulate":DEFAULT_NAMESPACE,"additive":DEFAULT_NAMESPACE,"alignment-baseline":DEFAULT_NAMESPACE,"alphabetic":DEFAULT_NAMESPACE,"amplitude":DEFAULT_NAMESPACE,"arabic-form":DEFAULT_NAMESPACE,"ascent":DEFAULT_NAMESPACE,"attributeName":DEFAULT_NAMESPACE,"attributeType":DEFAULT_NAMESPACE,"azimuth":DEFAULT_NAMESPACE,"bandwidth":DEFAULT_NAMESPACE,"baseFrequency":DEFAULT_NAMESPACE,"baseProfile":DEFAULT_NAMESPACE,"baseline-shift":DEFAULT_NAMESPACE,"bbox":DEFAULT_NAMESPACE,"begin":DEFAULT_NAMESPACE,"bias":DEFAULT_NAMESPACE,"by":DEFAULT_NAMESPACE,"calcMode":DEFAULT_NAMESPACE,"cap-height":DEFAULT_NAMESPACE,"class":DEFAULT_NAMESPACE,"clip":DEFAULT_NAMESPACE,"clip-path":DEFAULT_NAMESPACE,"clip-rule":DEFAULT_NAMESPACE,"clipPathUnits":DEFAULT_NAMESPACE,"color":DEFAULT_NAMESPACE,"color-interpolation":DEFAULT_NAMESPACE,"color-interpolation-filters":DEFAULT_NAMESPACE,"color-profile":DEFAULT_NAMESPACE,"color-rendering":DEFAULT_NAMESPACE,"content":DEFAULT_NAMESPACE,"contentScriptType":DEFAULT_NAMESPACE,"contentStyleType":DEFAULT_NAMESPACE,"cursor":DEFAULT_NAMESPACE,"cx":DEFAULT_NAMESPACE,"cy":DEFAULT_NAMESPACE,"d":DEFAULT_NAMESPACE,"datatype":DEFAULT_NAMESPACE,"defaultAction":DEFAULT_NAMESPACE,"descent":DEFAULT_NAMESPACE,"diffuseConstant":DEFAULT_NAMESPACE,"direction":DEFAULT_NAMESPACE,"display":DEFAULT_NAMESPACE,"divisor":DEFAULT_NAMESPACE,"dominant-baseline":DEFAULT_NAMESPACE,"dur":DEFAULT_NAMESPACE,"dx":DEFAULT_NAMESPACE,"dy":DEFAULT_NAMESPACE,"edgeMode":DEFAULT_NAMESPACE,"editable":DEFAULT_NAMESPACE,"elevation":DEFAULT_NAMESPACE,"enable-background":DEFAULT_NAMESPACE,"end":DEFAULT_NAMESPACE,"ev:event":EV_NAMESPACE,"event":DEFAULT_NAMESPACE,"exponent":DEFAULT_NAMESPACE,"externalResourcesRequired":DEFAULT_NAMESPACE,"fill":DEFAULT_NAMESPACE,"fill-opacity":DEFAULT_NAMESPACE,"fill-rule":DEFAULT_NAMESPACE,"filter":DEFAULT_NAMESPACE,"filterRes":DEFAULT_NAMESPACE,"filterUnits":DEFAULT_NAMESPACE,"flood-color":DEFAULT_NAMESPACE,"flood-opacity":DEFAULT_NAMESPACE,"focusHighlight":DEFAULT_NAMESPACE,"focusable":DEFAULT_NAMESPACE,"font-family":DEFAULT_NAMESPACE,"font-size":DEFAULT_NAMESPACE,"font-size-adjust":DEFAULT_NAMESPACE,"font-stretch":DEFAULT_NAMESPACE,"font-style":DEFAULT_NAMESPACE,"font-variant":DEFAULT_NAMESPACE,"font-weight":DEFAULT_NAMESPACE,"format":DEFAULT_NAMESPACE,"from":DEFAULT_NAMESPACE,"fx":DEFAULT_NAMESPACE,"fy":DEFAULT_NAMESPACE,"g1":DEFAULT_NAMESPACE,"g2":DEFAULT_NAMESPACE,"glyph-name":DEFAULT_NAMESPACE,"glyph-orientation-horizontal":DEFAULT_NAMESPACE,"glyph-orientation-vertical":DEFAULT_NAMESPACE,"glyphRef":DEFAULT_NAMESPACE,"gradientTransform":DEFAULT_NAMESPACE,"gradientUnits":DEFAULT_NAMESPACE,"handler":DEFAULT_NAMESPACE,"hanging":DEFAULT_NAMESPACE,"height":DEFAULT_NAMESPACE,"horiz-adv-x":DEFAULT_NAMESPACE,"horiz-origin-x":DEFAULT_NAMESPACE,"horiz-origin-y":DEFAULT_NAMESPACE,"id":DEFAULT_NAMESPACE,"ideographic":DEFAULT_NAMESPACE,"image-rendering":DEFAULT_NAMESPACE,"in":DEFAULT_NAMESPACE,"in2":DEFAULT_NAMESPACE,"initialVisibility":DEFAULT_NAMESPACE,"intercept":DEFAULT_NAMESPACE,"k":DEFAULT_NAMESPACE,"k1":DEFAULT_NAMESPACE,"k2":DEFAULT_NAMESPACE,"k3":DEFAULT_NAMESPACE,"k4":DEFAULT_NAMESPACE,"kernelMatrix":DEFAULT_NAMESPACE,"kernelUnitLength":DEFAULT_NAMESPACE,"kerning":DEFAULT_NAMESPACE,"keyPoints":DEFAULT_NAMESPACE,"keySplines":DEFAULT_NAMESPACE,"keyTimes":DEFAULT_NAMESPACE,"lang":DEFAULT_NAMESPACE,"lengthAdjust":DEFAULT_NAMESPACE,"letter-spacing":DEFAULT_NAMESPACE,"lighting-color":DEFAULT_NAMESPACE,"limitingConeAngle":DEFAULT_NAMESPACE,"local":DEFAULT_NAMESPACE,"marker-end":DEFAULT_NAMESPACE,"marker-mid":DEFAULT_NAMESPACE,"marker-start":DEFAULT_NAMESPACE,"markerHeight":DEFAULT_NAMESPACE,"markerUnits":DEFAULT_NAMESPACE,"markerWidth":DEFAULT_NAMESPACE,"mask":DEFAULT_NAMESPACE,"maskContentUnits":DEFAULT_NAMESPACE,"maskUnits":DEFAULT_NAMESPACE,"mathematical":DEFAULT_NAMESPACE,"max":DEFAULT_NAMESPACE,"media":DEFAULT_NAMESPACE,"mediaCharacterEncoding":DEFAULT_NAMESPACE,"mediaContentEncodings":DEFAULT_NAMESPACE,"mediaSize":DEFAULT_NAMESPACE,"mediaTime":DEFAULT_NAMESPACE,"method":DEFAULT_NAMESPACE,"min":DEFAULT_NAMESPACE,"mode":DEFAULT_NAMESPACE,"name":DEFAULT_NAMESPACE,"nav-down":DEFAULT_NAMESPACE,"nav-down-left":DEFAULT_NAMESPACE,"nav-down-right":DEFAULT_NAMESPACE,"nav-left":DEFAULT_NAMESPACE,"nav-next":DEFAULT_NAMESPACE,"nav-prev":DEFAULT_NAMESPACE,"nav-right":DEFAULT_NAMESPACE,"nav-up":DEFAULT_NAMESPACE,"nav-up-left":DEFAULT_NAMESPACE,"nav-up-right":DEFAULT_NAMESPACE,"numOctaves":DEFAULT_NAMESPACE,"observer":DEFAULT_NAMESPACE,"offset":DEFAULT_NAMESPACE,"opacity":DEFAULT_NAMESPACE,"operator":DEFAULT_NAMESPACE,"order":DEFAULT_NAMESPACE,"orient":DEFAULT_NAMESPACE,"orientation":DEFAULT_NAMESPACE,"origin":DEFAULT_NAMESPACE,"overflow":DEFAULT_NAMESPACE,"overlay":DEFAULT_NAMESPACE,"overline-position":DEFAULT_NAMESPACE,"overline-thickness":DEFAULT_NAMESPACE,"panose-1":DEFAULT_NAMESPACE,"path":DEFAULT_NAMESPACE,"pathLength":DEFAULT_NAMESPACE,"patternContentUnits":DEFAULT_NAMESPACE,"patternTransform":DEFAULT_NAMESPACE,"patternUnits":DEFAULT_NAMESPACE,"phase":DEFAULT_NAMESPACE,"playbackOrder":DEFAULT_NAMESPACE,"pointer-events":DEFAULT_NAMESPACE,"points":DEFAULT_NAMESPACE,"pointsAtX":DEFAULT_NAMESPACE,"pointsAtY":DEFAULT_NAMESPACE,"pointsAtZ":DEFAULT_NAMESPACE,"preserveAlpha":DEFAULT_NAMESPACE,"preserveAspectRatio":DEFAULT_NAMESPACE,"primitiveUnits":DEFAULT_NAMESPACE,"propagate":DEFAULT_NAMESPACE,"property":DEFAULT_NAMESPACE,"r":DEFAULT_NAMESPACE,"radius":DEFAULT_NAMESPACE,"refX":DEFAULT_NAMESPACE,"refY":DEFAULT_NAMESPACE,"rel":DEFAULT_NAMESPACE,"rendering-intent":DEFAULT_NAMESPACE,"repeatCount":DEFAULT_NAMESPACE,"repeatDur":DEFAULT_NAMESPACE,"requiredExtensions":DEFAULT_NAMESPACE,"requiredFeatures":DEFAULT_NAMESPACE,"requiredFonts":DEFAULT_NAMESPACE,"requiredFormats":DEFAULT_NAMESPACE,"resource":DEFAULT_NAMESPACE,"restart":DEFAULT_NAMESPACE,"result":DEFAULT_NAMESPACE,"rev":DEFAULT_NAMESPACE,"role":DEFAULT_NAMESPACE,"rotate":DEFAULT_NAMESPACE,"rx":DEFAULT_NAMESPACE,"ry":DEFAULT_NAMESPACE,"scale":DEFAULT_NAMESPACE,"seed":DEFAULT_NAMESPACE,"shape-rendering":DEFAULT_NAMESPACE,"slope":DEFAULT_NAMESPACE,"snapshotTime":DEFAULT_NAMESPACE,"spacing":DEFAULT_NAMESPACE,"specularConstant":DEFAULT_NAMESPACE,"specularExponent":DEFAULT_NAMESPACE,"spreadMethod":DEFAULT_NAMESPACE,"startOffset":DEFAULT_NAMESPACE,"stdDeviation":DEFAULT_NAMESPACE,"stemh":DEFAULT_NAMESPACE,"stemv":DEFAULT_NAMESPACE,"stitchTiles":DEFAULT_NAMESPACE,"stop-color":DEFAULT_NAMESPACE,"stop-opacity":DEFAULT_NAMESPACE,"strikethrough-position":DEFAULT_NAMESPACE,"strikethrough-thickness":DEFAULT_NAMESPACE,"string":DEFAULT_NAMESPACE,"stroke":DEFAULT_NAMESPACE,"stroke-dasharray":DEFAULT_NAMESPACE,"stroke-dashoffset":DEFAULT_NAMESPACE,"stroke-linecap":DEFAULT_NAMESPACE,"stroke-linejoin":DEFAULT_NAMESPACE,"stroke-miterlimit":DEFAULT_NAMESPACE,"stroke-opacity":DEFAULT_NAMESPACE,"stroke-width":DEFAULT_NAMESPACE,"surfaceScale":DEFAULT_NAMESPACE,"syncBehavior":DEFAULT_NAMESPACE,"syncBehaviorDefault":DEFAULT_NAMESPACE,"syncMaster":DEFAULT_NAMESPACE,"syncTolerance":DEFAULT_NAMESPACE,"syncToleranceDefault":DEFAULT_NAMESPACE,"systemLanguage":DEFAULT_NAMESPACE,"tableValues":DEFAULT_NAMESPACE,"target":DEFAULT_NAMESPACE,"targetX":DEFAULT_NAMESPACE,"targetY":DEFAULT_NAMESPACE,"text-anchor":DEFAULT_NAMESPACE,"text-decoration":DEFAULT_NAMESPACE,"text-rendering":DEFAULT_NAMESPACE,"textLength":DEFAULT_NAMESPACE,"timelineBegin":DEFAULT_NAMESPACE,"title":DEFAULT_NAMESPACE,"to":DEFAULT_NAMESPACE,"transform":DEFAULT_NAMESPACE,"transformBehavior":DEFAULT_NAMESPACE,"type":DEFAULT_NAMESPACE,"typeof":DEFAULT_NAMESPACE,"u1":DEFAULT_NAMESPACE,"u2":DEFAULT_NAMESPACE,"underline-position":DEFAULT_NAMESPACE,"underline-thickness":DEFAULT_NAMESPACE,"unicode":DEFAULT_NAMESPACE,"unicode-bidi":DEFAULT_NAMESPACE,"unicode-range":DEFAULT_NAMESPACE,"units-per-em":DEFAULT_NAMESPACE,"v-alphabetic":DEFAULT_NAMESPACE,"v-hanging":DEFAULT_NAMESPACE,"v-ideographic":DEFAULT_NAMESPACE,"v-mathematical":DEFAULT_NAMESPACE,"values":DEFAULT_NAMESPACE,"version":DEFAULT_NAMESPACE,"vert-adv-y":DEFAULT_NAMESPACE,"vert-origin-x":DEFAULT_NAMESPACE,"vert-origin-y":DEFAULT_NAMESPACE,"viewBox":DEFAULT_NAMESPACE,"viewTarget":DEFAULT_NAMESPACE,"visibility":DEFAULT_NAMESPACE,"width":DEFAULT_NAMESPACE,"widths":DEFAULT_NAMESPACE,"word-spacing":DEFAULT_NAMESPACE,"writing-mode":DEFAULT_NAMESPACE,"x":DEFAULT_NAMESPACE,"x-height":DEFAULT_NAMESPACE,"x1":DEFAULT_NAMESPACE,"x2":DEFAULT_NAMESPACE,"xChannelSelector":DEFAULT_NAMESPACE,"xlink:actuate":XLINK_NAMESPACE,"xlink:arcrole":XLINK_NAMESPACE,"xlink:href":XLINK_NAMESPACE,"xlink:role":XLINK_NAMESPACE,"xlink:show":XLINK_NAMESPACE,"xlink:title":XLINK_NAMESPACE,"xlink:type":XLINK_NAMESPACE,"xml:base":XML_NAMESPACE,"xml:id":XML_NAMESPACE,"xml:lang":XML_NAMESPACE,"xml:space":XML_NAMESPACE,"y":DEFAULT_NAMESPACE,"y1":DEFAULT_NAMESPACE,"y2":DEFAULT_NAMESPACE,"yChannelSelector":DEFAULT_NAMESPACE,"z":DEFAULT_NAMESPACE,"zoomAndPan":DEFAULT_NAMESPACE};exports$1$i=namespaces;var _namespaceMap=exports$1$i;var exports$2$6={};var VNode$2=_vnode;var VText$2=_vtext;var domParser;var propertyMap=_propertyMap;var namespaceMap=_namespaceMap;var HTML_NAMESPACE="http://www.w3.org/1999/xhtml";exports$2$6=parser;/**
       * DOM/html string to vdom parser
       *
       * @param   Mixed   el    DOM element or html string
       * @param   String  attr  Attribute name that contains vdom key
       * @return  Object        VNode or VText
       */function parser(el,attr){// empty input fallback to empty text node
if(!el){return createNode(document.createTextNode(""));}if(typeof el==="string"){if(!("DOMParser"in window)){throw new Error("DOMParser is not available, so parsing string to DOM node is not possible.");}domParser=domParser||new DOMParser();var doc=domParser.parseFromString(el,"text/html");// most tags default to body
if(doc.body.firstChild){el=doc.getElementsByTagName("body")[0].firstChild;// some tags, like script and style, default to head
}else if(doc.head.firstChild&&(doc.head.firstChild.tagName!=="TITLE"||doc.title)){el=doc.head.firstChild;// special case for html comment, cdata, doctype
}else if(doc.firstChild&&doc.firstChild.tagName!=="HTML"){el=doc.firstChild;// other element, such as whitespace, or html/body/head tag, fallback to empty text node
}else{el=document.createTextNode("");}}if(_typeof2(el)!=="object"||!el||!el.nodeType){throw new Error("invalid dom node",el);}return createNode(el,attr);}/**
       * Create vdom from dom node
       *
       * @param   Object  el    DOM element
       * @param   String  attr  Attribute name that contains vdom key
       * @return  Object        VNode or VText
       */function createNode(el,attr){// html comment is not currently supported by virtual-dom
if(el.nodeType===3){return createVirtualTextNode(el);// cdata or doctype is not currently supported by virtual-dom
}else if(el.nodeType===1||el.nodeType===9){return createVirtualDomNode(el,attr);}// default to empty text node
return new VText$2("");}/**
       * Create vtext from dom node
       *
       * @param   Object  el  Text node
       * @return  Object      VText
       */function createVirtualTextNode(el){return new VText$2(el.nodeValue);}/**
       * Create vnode from dom node
       *
       * @param   Object  el    DOM element
       * @param   String  attr  Attribute name that contains vdom key
       * @return  Object        VNode
       */function createVirtualDomNode(el,attr){var ns=el.namespaceURI!==HTML_NAMESPACE?el.namespaceURI:null;var key=attr&&el.getAttribute(attr)?el.getAttribute(attr):null;return new VNode$2(el.tagName,createProperties(el),createChildren(el,attr),key,ns);}/**
       * Recursively create vdom
       *
       * @param   Object  el    Parent element
       * @param   String  attr  Attribute name that contains vdom key
       * @return  Array         Child vnode or vtext
       */function createChildren(el,attr){var children=[];for(var i=0;i<el.childNodes.length;i++){children.push(createNode(el.childNodes[i],attr));}return children;}/**
       * Create properties from dom node
       *
       * @param   Object  el  DOM element
       * @return  Object      Node properties and attributes
       */function createProperties(el){var properties={};if(!el.hasAttributes()){return properties;}var ns;if(el.namespaceURI&&el.namespaceURI!==HTML_NAMESPACE){ns=el.namespaceURI;}var attr;for(var i=0;i<el.attributes.length;i++){// use built in css style parsing
if(el.attributes[i].name=="style"){attr=createStyleProperty(el);}else if(ns){attr=createPropertyNS(el.attributes[i]);}else{attr=createProperty(el.attributes[i]);}// special case, namespaced attribute, use properties.foobar
if(attr.ns){properties[attr.name]={namespace:attr.ns,value:attr.value};// special case, use properties.attributes.foobar
}else if(attr.isAttr){// init attributes object only when necessary
if(!properties.attributes){properties.attributes={};}properties.attributes[attr.name]=attr.value;// default case, use properties.foobar
}else{properties[attr.name]=attr.value;}}return properties;}/**
       * Create property from dom attribute
       *
       * @param   Object  attr  DOM attribute
       * @return  Object        Normalized attribute
       */function createProperty(attr){var name,value,isAttr;// using a map to find the correct case of property name
if(propertyMap[attr.name]){name=propertyMap[attr.name];}else{name=attr.name;}// special cases for data attribute, we default to properties.attributes.data
if(name.indexOf("data-")===0||name.indexOf("aria-")===0){value=attr.value;isAttr=true;}else{value=attr.value;}return{name:name,value:value,isAttr:isAttr||false};}/**
       * Create namespaced property from dom attribute
       *
       * @param   Object  attr  DOM attribute
       * @return  Object        Normalized attribute
       */function createPropertyNS(attr){return{name:attr.name,value:attr.value,ns:namespaceMap[attr.name]||""};}/**
       * Create style property from dom node
       *
       * @param   Object  el  DOM node
       * @return  Object        Normalized attribute
       */function createStyleProperty(el){var style=el.style;var output={};for(var i=0;i<style.length;++i){var item=style.item(i);output[item]=String(style[item]);// hack to workaround browser inconsistency with url()
if(output[item].indexOf("url")>-1){output[item]=output[item].replace(/\"/g,"");}}return{name:"style",value:output};}var exports$3$3=exports$2$6;var __varRecorder__$7=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/property-dom-mapping.js");function styleProps(morph){var style={};__varRecorder__$7.addFill(morph,style);__varRecorder__$7.addTransform(morph,style);__varRecorder__$7.addTransformOrigin(morph,style);__varRecorder__$7.addDisplay(morph,style);__varRecorder__$7.addExtentStyle(morph,style);__varRecorder__$7.addBorder(morph,style);__varRecorder__$7.addBorderRadius(morph,style);__varRecorder__$7.addShadowStyle(morph,style);if(morph.grayscale)style.filter="".concat(style.filter||""," grayscale(").concat(100*morph.grayscale,"%)");if(morph.blur)style.filter="".concat(style.filter||""," blur(").concat(morph.blur,"px)");if(morph.opacity!=null)style.opacity=morph.opacity;if(morph.draggable&&!morph.isWorld)style["touch-action"]="none";return style;}__varRecorder__$7.styleProps=styleProps;function addTransform(morph,style){var position=morph.position,origin=morph.origin,scale=morph.scale,rotation=morph.rotation,flipped=morph.flipped,tilted=morph.tilted,perspective=morph.perspective,owner=morph.owner;var x=Math.round(position.x-origin.x-(morph._skipWrapping&&owner?owner.borderWidthLeft:0));var y=Math.round(position.y-origin.y-(morph._skipWrapping&&owner?owner.borderWidthTop:0));var promoteToCompositionLayer=morph.renderOnGPU||morph.dropShadow&&!morph.dropShadow.fast||morph.grayscale>0;if(promoteToCompositionLayer){style.willChange="transform";}if(owner&&owner.isText||promoteToCompositionLayer){style.transform=promoteToCompositionLayer?"translate(".concat(x,"px, ").concat(y,"px)"):"translate(".concat(x,"px, ").concat(y,"px)");}else{style.transform="";style.top="".concat(y,"px");style.left="".concat(x,"px");}style.transform+=" rotate(".concat(rotation.toFixed(2),"rad) scale(").concat(scale.toFixed(5),",").concat(scale.toFixed(5),")");if(perspective)style.perspective="".concat(perspective,"px");if(flipped)style.transform+=" rotateY(".concat(flipped*180,"deg)");if(tilted)style.transform+=" rotateX(".concat(tilted*180,"deg)");}__varRecorder__$7.addTransform=addTransform;function addTransformOrigin(morph,style){var origin=morph.origin;if(origin)style.transformOrigin="".concat(origin.x,"px ").concat(origin.y,"px");}__varRecorder__$7.addTransformOrigin=addTransformOrigin;function addDisplay(morph,style){var visible=morph.visible;if(visible!=null)style.display=visible?"":"none";}__varRecorder__$7.addDisplay=addDisplay;function addBorderRadius(morph,style){var borderRadiusLeft=morph.borderRadiusLeft,borderRadiusRight=morph.borderRadiusRight,borderRadiusBottom=morph.borderRadiusBottom,borderRadiusTop=morph.borderRadiusTop;style.borderRadius="".concat(borderRadiusTop,"px ").concat(borderRadiusTop,"px ").concat(borderRadiusBottom,"px ").concat(borderRadiusBottom,"px / ").concat(borderRadiusLeft,"px ").concat(borderRadiusRight,"px ").concat(borderRadiusRight,"px ").concat(borderRadiusLeft,"px");}__varRecorder__$7.addBorderRadius=addBorderRadius;function addBorder(morph,style){var borderWidthLeft=morph.borderWidthLeft,borderColorLeft=morph.borderColorLeft,borderStyleLeft=morph.borderStyleLeft,borderWidthRight=morph.borderWidthRight,borderColorRight=morph.borderColorRight,borderStyleRight=morph.borderStyleRight,borderColor=morph.borderColor,borderWidthBottom=morph.borderWidthBottom,borderColorBottom=morph.borderColorBottom,borderStyleBottom=morph.borderStyleBottom,borderWidthTop=morph.borderWidthTop,borderColorTop=morph.borderColorTop,borderStyleTop=morph.borderStyleTop;var t=function t(s){return __varRecorder__$7.bowser.safari?__varRecorder__$7.string.camelize(s):s;};style[t("border-left-style")]="".concat(borderStyleLeft);style[t("border-right-style")]="".concat(borderStyleRight);style[t("border-bottom-style")]="".concat(borderStyleBottom);style[t("border-top-style")]="".concat(borderStyleTop);style[t("border-left-width")]="".concat(borderWidthLeft,"px");style[t("border-right-width")]="".concat(borderWidthRight,"px");style[t("border-bottom-width")]="".concat(borderWidthBottom,"px");style[t("border-top-width")]="".concat(borderWidthTop,"px");style[t("border-top-color")]=borderColorTop?borderColorTop.toString():"transparent";style[t("border-right-color")]=borderColorRight?borderColorRight.toString():"transparent";style[t("border-bottom-color")]=borderColorBottom?borderColorBottom.toString():"transparent";style[t("border-left-color")]=borderColorLeft?borderColorLeft.toString():"transparent";if(borderColor&&borderColor.isGradient)style["border-image"]=borderColor.toString();}__varRecorder__$7.addBorder=addBorder;function addFill(morph,style){var fill=morph.fill;if(!fill){style.background=__varRecorder__$7.Color.transparent.toString();return;}if(fill.isGradient)style.backgroundImage=fill.toString();else style.background=fill.toString();}__varRecorder__$7.addFill=addFill;function addExtentStyle(morph,style){var extent=morph.extent;style.width=extent.x+"px";style.height=extent.y+"px";}__varRecorder__$7.addExtentStyle=addExtentStyle;function shadowCss(morph){return morph.dropShadow?morph.dropShadow.toFilterCss():"";}__varRecorder__$7.shadowCss=shadowCss;function addShadowStyle(morph,style){if(morph.isSvgMorph||morph.isImage){style.filter=__varRecorder__$7.shadowCss(morph);return;}var dropShadow=morph.dropShadow;if(dropShadow&&dropShadow.fast||dropShadow&&dropShadow.inset){style.boxShadow=dropShadow?dropShadow.toCss():"none";}else{style.filter=dropShadow?dropShadow.toFilterCss():"";}}__varRecorder__$7.addShadowStyle=addShadowStyle;function addSvgAttributes(morph,style){var width=morph.width,height=morph.height,borderWidth=morph.borderWidth;style.width=width||1;style.height=height||1;style.viewBox=[0,0,width||1,height||1].join(" ");return style;}__varRecorder__$7.addSvgAttributes=addSvgAttributes;function getSvgVertices(vertices){var X,Y,lastV;var d="";if(vertices.length>0){lastV=vertices[0];var _lastV$position=lastV.position,_x=_lastV$position.x,_y=_lastV$position.y;X=_x;Y=_y;d=d+"M ".concat(X," ").concat(Y," ");}for(var _i69=1;_i69<vertices.length-1;_i69++){var vertex=vertices[_i69];var _vertex$position=vertex.position,_x2=_vertex$position.x,_y2=_vertex$position.y;var isSmooth=vertex.isSmooth,_vertex$controlPoints=vertex.controlPoints,_p5=_vertex$controlPoints.previous,_n2=_vertex$controlPoints.next;d=isSmooth?d+"C ".concat(X+lastV.controlPoints.next.x," ").concat(Y+lastV.controlPoints.next.y," ").concat(_x2+_p5.x," ").concat(_y2+_p5.y," ").concat(_x2," ").concat(_y2," "):d+"L ".concat(_x2," ").concat(_y2," ");lastV=vertex;X=_x2;Y=_y2;}if(vertices.length>0){var _vertices$position=vertices[vertices.length-1].position,_x3=_vertices$position.x,_y3=_vertices$position.y;var _vertices=vertices[vertices.length-1],_isSmooth=_vertices.isSmooth,_p6=_vertices.controlPoints.previous;d=_isSmooth?d+"C ".concat(X+lastV.controlPoints.next.x," ").concat(Y+lastV.controlPoints.next.y," ").concat(_x3+_p6.x," ").concat(_y3+_p6.y," ").concat(_x3," ").concat(_y3):d+"L ".concat(_x3," ").concat(_y3);}return d;}__varRecorder__$7.getSvgVertices=getSvgVertices;function addPathAttributes(morph,style){var id=morph.id,vertices=morph.vertices,fill=morph.fill,borderColor=morph.borderColor,borderWidth=morph.borderWidth;if(vertices.length){style.d=__varRecorder__$7.getSvgVertices(vertices);}__varRecorder__$7.addSvgBorderStyle(morph,style);style["stroke-width"]=borderWidth.valueOf();style.fill=fill?fill.isGradient?"url(#gradient-fill"+id+")":fill.toString():"transparent";style.stroke=borderColor.valueOf().isGradient?"url(#gradient-borderColor"+id+")":borderColor.valueOf().toString();return style;}__varRecorder__$7.addPathAttributes=addPathAttributes;function addSvgBorderStyle(morph,style){var bs=morph.borderStyle.valueOf();if(bs==="dashed"){var bw=morph.borderWidth.valueOf();style["stroke-dasharray"]=bw*1.61+" "+bw;}else if(bs==="dotted"){var _bw=morph.borderWidth.valueOf();style["stroke-dasharray"]="1 "+_bw*2;style["stroke-linecap"]="round";style["stroke-linejoin"]="round";}return style;}__varRecorder__$7.addSvgBorderStyle=addSvgBorderStyle;__varRecorder__$7.Color=Color$1;__varRecorder__$7.string=string;__varRecorder__$7.bowser=exports$1$1;__varRecorder__$7.styleProps=styleProps;__varRecorder__$7.styleProps=styleProps;__varRecorder__$7.addTransform=addTransform;__varRecorder__$7.addTransform=addTransform;__varRecorder__$7.addSvgAttributes=addSvgAttributes;__varRecorder__$7.addSvgAttributes=addSvgAttributes;__varRecorder__$7.getSvgVertices=getSvgVertices;__varRecorder__$7.getSvgVertices=getSvgVertices;__varRecorder__$7.addPathAttributes=addPathAttributes;__varRecorder__$7.addPathAttributes=addPathAttributes;var __varRecorder__$8=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/morphic-default.js");function defaultStyle(morph){var opacity=morph.opacity,reactsToPointer=morph.reactsToPointer,nativeCursor=morph.nativeCursor,clipMode=morph.clipMode;var domStyle=__varRecorder__$8.styleProps(morph);var maskedProps=morph._animationQueue.maskedProps("css");if("backgroundImage"in maskedProps)delete domStyle.background;if(clipMode!=="visible"){domStyle.overflow=clipMode;domStyle["-webkit-overflow-scrolling"]="touch";domStyle["overflow-anchor"]="none";}Object.assign(domStyle,maskedProps);domStyle.position="absolute";domStyle["pointer-events"]=reactsToPointer?"auto":"none";domStyle.cursor=nativeCursor;return domStyle;}__varRecorder__$8.defaultStyle=defaultStyle;function MorphAfterRenderHook(morph,renderer){this.morph=morph;this.renderer=renderer;}__varRecorder__$8.MorphAfterRenderHook=MorphAfterRenderHook;function Animation(morph){this.morph=morph;}__varRecorder__$8.Animation=Animation;function SvgAnimation(morph,type){this.morph=morph;this.type=type;}__varRecorder__$8.SvgAnimation=SvgAnimation;function defaultAttributes(morph,renderer){var attrs={animation:new __varRecorder__$8.Animation(morph),key:morph.id,id:morph.id,attributes:{},className:(morph.hideScrollbars?morph.styleClasses.concat("hiddenScrollbar"):morph.styleClasses).join(" "),draggable:false,"morph-after-render-hook":new __varRecorder__$8.MorphAfterRenderHook(morph,renderer)};if(__varRecorder__$8.bowser.ios&&morph.draggable&&!morph.isWorld){attrs.attributes["touch-action"]="none";}else if(__varRecorder__$8.bowser.ios&&morph.clipMode!="visible"&&!morph.isWorld){attrs.attributes["touch-action"]="auto";}else{attrs.attributes["touch-action"]="manipulation";}return attrs;}__varRecorder__$8.defaultAttributes=defaultAttributes;function svgAttributes(svg){var animation=new __varRecorder__$8.SvgAnimation(svg,"svg");var attributes={};__varRecorder__$8.addSvgAttributes(svg,attributes);Object.assign(attributes,svg._animationQueue.maskedProps("svg"));return{animation:animation,attributes:attributes};}__varRecorder__$8.svgAttributes=svgAttributes;function pathAttributes(path){var animation=new __varRecorder__$8.SvgAnimation(path,"path");var attributes={mask:path.drawnProportion!==0?"url(#mask"+path.id+")":""};__varRecorder__$8.addPathAttributes(path,attributes);Object.assign(attributes,path._animationQueue.maskedProps("path"));return{animation:animation,attributes:attributes};}__varRecorder__$8.pathAttributes=pathAttributes;function renderGradient(id,extent,gradient){gradient=gradient.valueOf();var _gradient=gradient,bounds=_gradient.bounds,focus=_gradient.focus,vector=_gradient.vector,stops=_gradient.stops;var width=extent.x,height=extent.y;var props={namespace:"http://www.w3.org/2000/svg",attributes:{id:"gradient-"+id,gradientUnits:"userSpaceOnUse",r:"50%"}};if(vector){props.attributes.gradientTransform="rotate(".concat(__varRecorder__$8.num.toDegrees(vector.extent().theta()),", ").concat(width/2,", ").concat(height/2,")");}if(focus&&bounds){var bw=bounds.width,bh=bounds.height;var _x4=focus.x,_y4=focus.y;props.attributes.gradientTransform="matrix(\n".concat(bw/width,", 0, 0, ").concat(bh/height,",\n").concat(width/2-bw/width*(width/2)+_x4*width-width/2,",\n").concat(height/2-bh/height*(height/2)+_y4*height-height/2,")");}return __varRecorder__$8.h(gradient.type,props,stops.map(function(stop){return __varRecorder__$8.h("stop",{namespace:"http://www.w3.org/2000/svg",attributes:{offset:stop.offset*100+"%","stop-opacity":stop.color.a,"stop-color":stop.color.withA(1).toString()}});}));}__varRecorder__$8.renderGradient=renderGradient;function initDOMState(renderer,world){renderer.rootNode.appendChild(renderer.domNode);renderer.ensureDefaultCSS().then(function(){return __varRecorder__$8.promise.delay(500);}).then(function(){return world.env.fontMetric&&world.env.fontMetric.reset();}).then(function(){return world.withAllSubmorphsDo(function(ea){if(ea.isText||ea.isLabel){var _ref14=ea.metadata||{},serializationInfo=_ref14.serializationInfo;if(serializationInfo&&serializationInfo.recoveredTextBounds)return;ea.forceRerender();}});})["catch"](function(err){return console.error(err);});}__varRecorder__$8.initDOMState=initDOMState;function renderMorph(morph){var renderer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:morph.env.renderer;return __varRecorder__$8.createNode(morph.render(renderer),renderer.domEnvironment);}__varRecorder__$8.renderMorph=renderMorph;function renderSubTree(morph,renderer){var tree=renderer.renderMap.get(morph);var domNode=renderer.getNodeForMorph(morph);if(!domNode||!tree)return;var newTree=renderer.render(morph);var patches=__varRecorder__$8.diff(tree,newTree);var parentNode=renderer.renderMap.get(morph.owner);if(!parentNode)return;var siblings=parentNode.children[0].children;var treeIndex=siblings.indexOf(tree);siblings[treeIndex]=newTree;__varRecorder__$8.patch(domNode,patches);}__varRecorder__$8.renderSubTree=renderSubTree;function renderRootMorph(world,renderer){if(!world.needsRerender())return;var hydrated=false;var domNode=renderer.domNode;var tree=renderer.renderMap.get(world)||domNode&&(hydrated=true)&&__varRecorder__$8.parser(domNode)||renderer.render(world);var newTree=renderer.render(world);if(hydrated)tree.key=newTree.key;var patches=__varRecorder__$8.diff(tree,newTree);domNode=domNode||(renderer.domNode=__varRecorder__$8.createNode(tree,renderer.domEnvironment));if(!domNode.parentNode)__varRecorder__$8.initDOMState(renderer,world);__varRecorder__$8.patch(domNode,patches);renderer.renderFixedMorphs(newTree.fixedMorphs,world);}__varRecorder__$8.renderRootMorph=renderRootMorph;__varRecorder__$8.vdom=exports$1$h;__varRecorder__$8.parser=exports$3$3;__varRecorder__$8.num=num;__varRecorder__$8.obj=obj;__varRecorder__$8.arr=arr;__varRecorder__$8.properties=properties;__varRecorder__$8.promise=promise;__varRecorder__$8.Color=Color$1;__varRecorder__$8.RadialGradient=RadialGradient;__varRecorder__$8.pt=pt;__varRecorder__$8.Point=Point;__varRecorder__$8.LinearGradient=LinearGradient;__varRecorder__$8.rect=rect;__varRecorder__$8.config=config;__varRecorder__$8.styleProps=styleProps;__varRecorder__$8.addSvgAttributes=addSvgAttributes;__varRecorder__$8.addPathAttributes=addPathAttributes;__varRecorder__$8.bowser=exports$1$1;var destructured_1=__varRecorder__$8.vdom;__varRecorder__$8.h=destructured_1.h;__varRecorder__$8.diff=destructured_1.diff;__varRecorder__$8.patch=destructured_1.patch;__varRecorder__$8.createNode=destructured_1.create;var defaultCSS="\n\n/*-=- html fixes -=-*/\n\nhtml {\n  overflow: visible;\n}\n\ntextarea.lively-text-input.debug {\n  z-index: 20 !important;\n  opacity: 1 !important;\n  background: rgba(0,255,0,0.5) !important;\n}\n\n.no-html-select {\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.hiddenScrollbar::-webkit-scrollbar {\n  /* This is the magic bit */\n  display: none;\n}\n\n\n/*-=- generic morphic -=-*/\n\n.Morph {\n  outline: none;\n  /*for aliasing issue in chrome: http://stackoverflow.com/questions/6492027/css-transform-jagged-edges-in-chrome*/\n  /* -webkit-backface-visibility: hidden; */\n\n  /*include border size in extent of element*/\n  box-sizing: border-box;\n\n  /*don't use dom selection on morphs*/\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.Morph img {\n  -moz-user-select: none;\n}\n\n.Tooltip {\n  z-index: 3;\n}\n\n.Hand {\n  z-index: 1;\n}\n\n/*-=- halos -=-*/\n\n.Halo {\n  z-index: 2;\n}\n\n.ProportionalLayoutHalo, .FlexLayoutHalo, .GridLayoutHalo, .TilingLayoutHalo {\n  z-index: auto;\n}\n\n.HaloItem:not(.NameHaloItem) {\n  /*FIXME: we shouldn't need to hardcode the size...*/\n  line-height: 24px !important;\n  text-align: center;\n  vertical-align: middle;\n}\n\n.halo-mesh {\n  background-color:transparent;\n  background-image: linear-gradient(rgba(0,0,0,.1) 2px, transparent 2px),\n  linear-gradient(90deg, rgba(0,0,0,.1) 2px, transparent 2px),\n  linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),\n  linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px);\n  background-size:100px 100px, 100px 100px, 10px 10px, 10px 10px;\n  background-position:-2px -2px, -2px -2px, -1px -1px, -1px -1px;\n}\n\n/*-=- text -=-*/\n\n.center-text {\n  text-align: center;\n}\n\n.v-center-text {\n  position: relative;\n  top: 50%;\n}\n\ndiv.text-layer span {\n  line-height: normal;\n}\n\n/*-=- text -=-*/\n\n.Label span {\n  white-space: pre;\n  float: left;\n  line-height: initial;\n  -moz-user-select: none;\n}\n\n.Text .annotation {\n  text-align: right;\n  position: absolute;\n  right: 0;\n}\n\n.Label .annotation {\n/*  vertical-align: middle;\n  height: 100%;*/\n  /*vertical align*/\n  float: right;\n  position: relative;\n  top: 50%;\n  text-align: right;\n}\n\n.truncated-text {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/*-=- input elements -=-*/\n\ninput::-webkit-input-placeholder {\n  color: rgb(202, 202, 202);\n}\ninput::-moz-placeholder {\n  color: rgb(202, 202, 202);\n}\ninput:-ms-input-placeholder {\n  color: rgb(202, 202, 202);\n}\ninput:-moz-placeholder {\n  color: rgb(202, 202, 202);\n}\ninput:placeholder {\n  color: rgb(202, 202, 202);\n}\n\n/*-=- input elements -=-*/\n.Morph svg .path-point {\n  cursor: move; /* fallback if grab cursor is unsupported */\n  cursor: grab;\n  cursor: -moz-grab;\n  cursor: -webkit-grab;\n  fill: red;\n}\n\n";__varRecorder__$8.defaultCSS=defaultCSS;__varRecorder__$8.defaultCSS=defaultCSS;__varRecorder__$8.defaultCSS=defaultCSS;var ShadowObject=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/morphic-default.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ShadowObject")&&typeof __lively_classholder__.ShadowObject==="function"?__lively_classholder__.ShadowObject:__lively_classholder__.ShadowObject=function ShadowObject(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function ShadowObject_initialize_(args){if(__varRecorder__$8.obj.isBoolean(args))args=__varRecorder__$8.config.defaultShadow;var _args2=args,rotation=_args2.rotation,distance=_args2.distance,blur=_args2.blur,color=_args2.color,morph=_args2.morph,inset=_args2.inset,spread=_args2.spread,fast=_args2.fast;this.rotation=__varRecorder__$8.obj.isNumber(rotation)?rotation:45;this.distance=__varRecorder__$8.obj.isNumber(distance)?distance:2;this.blur=__varRecorder__$8.obj.isNumber(blur)?blur:6;this.inset=inset||false;this.spread=spread||0;this.color=color||__varRecorder__$8.Color.gray.darker();this.morph=morph;this.fast=fast;}},{key:"__dont_serialize__",get:function get(){return["morph"];}},{key:"distance",get:function get(){return this._distance;}},{key:"blur",get:function get(){return this._blur;}},{key:"rotation",get:function get(){return this._rotation;}},{key:"color",get:function get(){return this._color;}},{key:"inset",get:function get(){return this._inset;}},{key:"inset",set:function set(v){this._inset=v;if(this.morph)this.morph.dropShadow=this;}},{key:"distance",set:function set(d){this._distance=d;if(this.morph)this.morph.dropShadow=this;}},{key:"blur",set:function set(b){this._blur=b;if(this.morph)this.morph.dropShadow=this;}},{key:"rotation",set:function set(r){this._rotation=r;if(this.morph)this.morph.dropShadow=this;}},{key:"color",set:function set(c){this._color=c;if(this.morph)this.morph.dropShadow=this;}},{key:"isShadowObject",get:function get(){return true;}},{key:"__serialize__",value:function ShadowObject___serialize___(){var _this$toJson=this.toJson(),distance=_this$toJson.distance,rotation=_this$toJson.rotation,color=_this$toJson.color,inset=_this$toJson.inset,blur=_this$toJson.blur,spread=_this$toJson.spread,fast=_this$toJson.fast;color=color.toJSExpr();return{__expr__:"new ShadowObject({".concat(Object.entries({distance:distance,rotation:rotation,color:color,inset:inset,blur:blur,spread:spread,fast:fast}).map(function(_ref15){var _ref16=_slicedToArray2(_ref15,2),k=_ref16[0],v=_ref16[1];return"".concat(k,":").concat(v);}),"})"),bindings:{"lively.graphics/color.js":["Color"],"lively.morphic":["ShadowObject"]}};}},{key:"with",value:function ShadowObject_with_(props){var distance=this.distance,rotation=this.rotation,color=this.color,inset=this.inset,blur=this.blur,spread=this.spread,fast=this.fast;return new __varRecorder__$8.ShadowObject(Object.assign({distance:distance,rotation:rotation,color:color,inset:inset,blur:blur,spread:spread,fast:fast},props));}},{key:"toCss",value:function ShadowObject_toCss_(){var distance=this.distance,rotation=this.rotation,color=this.color,inset=this.inset,blur=this.blur,spread=this.spread;var _varRecorder__$8$Poi=__varRecorder__$8.Point.polar(distance,__varRecorder__$8.num.toRadians(rotation)),x=_varRecorder__$8$Poi.x,y=_varRecorder__$8$Poi.y;return"".concat(inset?"inset":""," ").concat(color.toString()," ").concat(x.toFixed(2),"px ").concat(y.toFixed(2),"px ").concat(blur,"px ").concat(spread,"px");}},{key:"toJson",value:function ShadowObject_toJson_(){return __varRecorder__$8.obj.select(this,["rotation","distance","blur","color","inset","spread","fast"]);}},{key:"equals",value:function ShadowObject_equals_(other){return!!other&&__varRecorder__$8.obj.equals(this.toJson(),other.toJson());}},{key:"toFilterCss",value:function ShadowObject_toFilterCss_(){var distance=this.distance,rotation=this.rotation,blur=this.blur,color=this.color,spread=this.spread;var _varRecorder__$8$Poi2=__varRecorder__$8.Point.polar(distance,__varRecorder__$8.num.toRadians(rotation)),x=_varRecorder__$8$Poi2.x,y=_varRecorder__$8$Poi2.y;blur=__varRecorder__$8.bowser.chrome?blur/3:blur/2;return"drop-shadow(".concat(x.toFixed(2),"px ").concat(y.toFixed(2),"px ").concat(blur.toFixed(2),"px ").concat(color.toString(),")");}},{key:"interpolate",value:function ShadowObject_interpolate_(p,other){return new __varRecorder__$8.ShadowObject({distance:__varRecorder__$8.num.interpolate(p,this.distance,other.distance),rotation:__varRecorder__$8.num.interpolate(p,this.rotation,other.rotation),color:this.color.interpolate(p,other.color),blur:__varRecorder__$8.num.interpolate(p,this.blur,other.blur),spread:__varRecorder__$8.num.interpolate(p,this.spread,other.spread),inset:other.inset,fast:other.fast});}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ShadowObject";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"rendering/morphic-default.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:3438,end:7097});}(undefined);__varRecorder__$8.ShadowObject=ShadowObject;__varRecorder__$8.ShadowObject=ShadowObject;__varRecorder__$8.ShadowObject=ShadowObject;__varRecorder__$8.defaultStyle=defaultStyle;__varRecorder__$8.defaultStyle=defaultStyle;__varRecorder__$8.MorphAfterRenderHook.prototype.hook=function(node,propertyName,previousValue){var _this16=this;var attempt=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var isInDOM=!!node.parentNode;if(isInDOM){if(this.morph._submorphOrderChanged&&this.morph.submorphs.length){this.morph._submorphOrderChanged=false;this.updateScrollOfSubmorphs(this.morph,this.renderer);}else if(this.morph.isClip())this.updateScroll(this.morph,node);}if(isInDOM||attempt>3){this.morph._rendering=false;this.morph.onAfterRender(node);return;}attempt++;setTimeout(function(){return _this16.hook(node,propertyName,previousValue,attempt);},20*attempt);};__varRecorder__$8.MorphAfterRenderHook.prototype.updateScroll=function(morph,node,fromScroll){var _this17=this;var interactiveScrollInProgress=morph.env.eventDispatcher.eventState.scroll.interactiveScrollInProgress;if(node&&interactiveScrollInProgress){return interactiveScrollInProgress.then(function(){return _this17.updateScroll(morph,node,true);});}if(morph.isWorld)return;if(node){var _morph$scroll=morph.scroll,_x5=_morph$scroll.x,_y5=_morph$scroll.y;if(morph._animationQueue.animations.find(function(anim){return anim.animatedProps.scroll;}))return;var scrollLayer=morph.isText&&morph.viewState.fastScroll?node.querySelector(".scrollLayer"):node;if(morph._skipScrollUpdate)return;if(!scrollLayer)return;scrollLayer.scrollTop!==_y5&&(scrollLayer.scrollTop=_y5);scrollLayer.scrollLeft!==_x5&&(scrollLayer.scrollLeft=_x5);!fromScroll&&requestAnimationFrame(function(){scrollLayer.scrollTop!==_y5&&(scrollLayer.scrollTop=_y5);scrollLayer.scrollLeft!==_x5&&(scrollLayer.scrollLeft=_x5);},morph.id);}};__varRecorder__$8.MorphAfterRenderHook.prototype.unhook=function(morph,renderer){};__varRecorder__$8.MorphAfterRenderHook.prototype.updateScrollOfSubmorphs=function(morph,renderer){var _this18=this;morph.submorphs.forEach(function(m){if(m.isClip()){_this18.updateScroll(m,renderer.getNodeForMorph(m));}_this18.updateScrollOfSubmorphs(m,renderer);});};__varRecorder__$8.Animation.prototype.hook=function(node){this.morph._animationQueue.startAnimationsFor(node);};__varRecorder__$8.SvgAnimation=SvgAnimation;__varRecorder__$8.SvgAnimation=SvgAnimation;__varRecorder__$8.SvgAnimation.prototype.hook=function(node){this.morph._animationQueue.startSvgAnimationsFor(node,this.type);};__varRecorder__$8.defaultAttributes=defaultAttributes;__varRecorder__$8.defaultAttributes=defaultAttributes;__varRecorder__$8.svgAttributes=svgAttributes;__varRecorder__$8.svgAttributes=svgAttributes;__varRecorder__$8.pathAttributes=pathAttributes;__varRecorder__$8.pathAttributes=pathAttributes;__varRecorder__$8.renderGradient=renderGradient;__varRecorder__$8.renderGradient=renderGradient;__varRecorder__$8.renderMorph=renderMorph;__varRecorder__$8.renderMorph=renderMorph;__varRecorder__$8.renderSubTree=renderSubTree;__varRecorder__$8.renderSubTree=renderSubTree;__varRecorder__$8.renderRootMorph=renderRootMorph;__varRecorder__$8.renderRootMorph=renderRootMorph;var _global$6=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$_={};!function(t,n){n(exports$_);}(exports$_,function(t){function n(t){return 10===t||13===t||8232===t||8233===t||32===t||9===t||11===t||12===t||160===t||t>=5760&&an.indexOf(t)>=0;}function e(t){switch(32|t){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:case 114:return!0;}return!1;}function r(t){return t>=48&&t<=57;}function i(t){return t>=48&&t<=57||43===t||45===t||46===t;}function a(t){(this||_global$6).index=0,(this||_global$6).path=t,(this||_global$6).max=t.length,(this||_global$6).result=[],(this||_global$6).param=0,(this||_global$6).err="",(this||_global$6).segmentStart=0,(this||_global$6).data=[];}function o(t){for(;t.index<t.max&&n(t.path.charCodeAt(t.index));){t.index++;}}function s(t){var n,e=t.index,i=e,a=t.max,o=!1,s=!1,h=!1,u=!1;if(i>=a)return void(t.err="SvgPath: missed param (at pos "+i+")");if(n=t.path.charCodeAt(i),43!==n&&45!==n||(i++,n=i<a?t.path.charCodeAt(i):0),!r(n)&&46!==n)return void(t.err="SvgPath: param should start with 0..9 or `.` (at pos "+i+")");if(46!==n){if(o=48===n,i++,n=i<a?t.path.charCodeAt(i):0,o&&i<a&&n&&r(n))return void(t.err="SvgPath: numbers started with `0` such as `09` are ilegal (at pos "+e+")");for(;i<a&&r(t.path.charCodeAt(i));){i++,s=!0;}n=i<a?t.path.charCodeAt(i):0;}if(46===n){for(u=!0,i++;r(t.path.charCodeAt(i));){i++,h=!0;}n=i<a?t.path.charCodeAt(i):0;}if(101===n||69===n){if(u&&!s&&!h)return void(t.err="SvgPath: invalid float exponent (at pos "+i+")");if(i++,n=i<a?t.path.charCodeAt(i):0,43!==n&&45!==n||i++,!(i<a&&r(t.path.charCodeAt(i))))return void(t.err="SvgPath: invalid float exponent (at pos "+i+")");for(;i<a&&r(t.path.charCodeAt(i));){i++;}}t.index=i,t.param=parseFloat(t.path.slice(e,i))+0;}function h(t){var n,e;n=t.path[t.segmentStart],e=n.toLowerCase();var r=t.data;if("m"===e&&r.length>2&&(t.result.push([n,r[0],r[1]]),r=r.slice(2),e="l",n="m"===n?"l":"L"),"r"===e)t.result.push([n].concat(r));else for(;r.length>=rn[e]&&(t.result.push([n].concat(r.splice(0,rn[e]))),rn[e]);){;}}function u(t){var n,r,a,u,c=t.max;if(t.segmentStart=t.index,n=t.path.charCodeAt(t.index),!e(n))return void(t.err="SvgPath: bad command "+t.path[t.index]+" (at pos "+t.index+")");if(a=rn[t.path[t.index].toLowerCase()],t.index++,o(t),t.data=[],!a)return void h(t);for(r=!1;;){for(u=a;u>0;u--){if(s(t),t.err.length)return;t.data.push(t.param),o(t),r=!1,t.index<c&&44===t.path.charCodeAt(t.index)&&(t.index++,o(t),r=!0);}if(!r){if(t.index>=t.max)break;if(!i(t.path.charCodeAt(t.index)))break;}}h(t);}function c(t,n){return[t[0]*n[0]+t[2]*n[1],t[1]*n[0]+t[3]*n[1],t[0]*n[2]+t[2]*n[3],t[1]*n[2]+t[3]*n[3],t[0]*n[4]+t[2]*n[5]+t[4],t[1]*n[4]+t[3]*n[5]+t[5]];}function f(){if(!((this||_global$6)instanceof f))return new f();(this||_global$6).queue=[],(this||_global$6).cache=null;}function l(t,n,e,r){var i=t*r-n*e<0?-1:1,a=Math.sqrt(t*t+n*n),o=Math.sqrt(t*t+n*n),s=t*e+n*r,h=s/(a*o);return h>1&&(h=1),h<-1&&(h=-1),i*Math.acos(h);}function p(t,n,e,r,i,a,o,s,h,u){var c=u*(t-e)/2+h*(n-r)/2,f=-h*(t-e)/2+u*(n-r)/2,p=o*o,g=s*s,v=c*c,x=f*f,y=p*g-p*x-g*v;y<0&&(y=0),y/=p*x+g*v,y=Math.sqrt(y)*(i===a?-1:1);var d=y*o/s*f,m=y*-s/o*c,M=u*d-h*m+(t+e)/2,w=h*d+u*m+(n+r)/2,b=(c-d)/o,L=(f-m)/s,A=(-c-d)/o,q=(-f-m)/s,k=l(1,0,b,L),P=l(b,L,A,q);return 0===a&&P>0&&(P-=ln),1===a&&P<0&&(P+=ln),[M,w,k,P];}function g(t,n){var e=4/3*Math.tan(n/4),r=Math.cos(t),i=Math.sin(t),a=Math.cos(t+n),o=Math.sin(t+n);return[r,i,r-i*e,i+r*e,a+o*e,o-a*e,a,o];}function v(t,n,e){if(!((this||_global$6)instanceof v))return new v(t,n,e);(this||_global$6).rx=t,(this||_global$6).ry=n,(this||_global$6).ax=e;}function x(t){if(!((this||_global$6)instanceof x))return new x(t);var n=on(t);(this||_global$6).segments=n.segments,(this||_global$6).err=n.err,(this||_global$6).__stack=[];}function y(t){var n=t.match(wn);return n?n.map(Number):[];}function d(t,n,e,r,i,a,o,s){(this||_global$6).a={x:t,y:n},(this||_global$6).b={x:e,y:r},(this||_global$6).c={x:i,y:a},(this||_global$6).d={x:o,y:s},null!==o&&void 0!==o&&null!==s&&void 0!==s?((this||_global$6).getArcLength=_,(this||_global$6).getPoint=L,(this||_global$6).getDerivative=M):((this||_global$6).getArcLength=A,(this||_global$6).getPoint=b,(this||_global$6).getDerivative=m),this.init();}function m(t,n,e){return{x:2*(1-e)*(t[1]-t[0])+2*e*(t[2]-t[1]),y:2*(1-e)*(n[1]-n[0])+2*e*(n[2]-n[1])};}function M(t,n,e){return b([3*(t[1]-t[0]),3*(t[2]-t[1]),3*(t[3]-t[2])],[3*(n[1]-n[0]),3*(n[2]-n[1]),3*(n[3]-n[2])],e);}function w(t,n,e,r,i){for(var a=1,o=t/n,s=(t-e(r,i,o))/n;a>0.001;){var h=e(r,i,o+s),u=e(r,i,o-s),c=Math.abs(t-h)/n,f=Math.abs(t-u)/n;c<a?(a=c,o+=s):f<a?(a=f,o-=s):s/=2;}return o;}function b(t,n,e){return{x:(1-e)*(1-e)*t[0]+2*(1-e)*e*t[1]+e*e*t[2],y:(1-e)*(1-e)*n[0]+2*(1-e)*e*n[1]+e*e*n[2]};}function L(t,n,e){return{x:(1-e)*(1-e)*(1-e)*t[0]+3*(1-e)*(1-e)*e*t[1]+3*(1-e)*e*e*t[2]+e*e*e*t[3],y:(1-e)*(1-e)*(1-e)*n[0]+3*(1-e)*(1-e)*e*n[1]+3*(1-e)*e*e*n[2]+e*e*e*n[3]};}function A(t,n,e){void 0===e&&(e=1);var r=t[0]-2*t[1]+t[2],i=n[0]-2*n[1]+n[2],a=2*t[1]-2*t[0],o=2*n[1]-2*n[0],s=4*(r*r+i*i),h=4*(r*a+i*o),u=a*a+o*o;if(0===s)return e*Math.sqrt(Math.pow(t[2]-t[0],2)+Math.pow(n[2]-n[0],2));var c=h/(2*s),f=u/s,l=e+c,p=f-c*c;return Math.sqrt(s)/2*(l*Math.sqrt(l*l+p)-c*Math.sqrt(c*c+p)+p*Math.log(Math.abs((l+Math.sqrt(l*l+p))/(c+Math.sqrt(c*c+p)))));}function q(t,n){return qn[t][n];}function k(t,n,e){var r,i,a,o=e.length-1;if(0===o)return 0;if(0===t){for(i=0,a=0;a<=o;a++){i+=q(o,a)*Math.pow(1-n,o-a)*Math.pow(n,a)*e[a];}return i;}for(r=new Array(o),a=0;a<o;a++){r[a]=o*(e[a+1]-e[a]);}return k(t-1,n,r);}function P(t,n,e){var r=k(1,e,t),i=k(1,e,n),a=r*r+i*i;return Math.sqrt(a);}function _(t,n,e){var r,i,a,o;void 0===e&&(e=1);for(r=e/2,i=0,a=0;a<20;a++){o=r*Ln[20][a]+r,i+=An[20][a]*P(t,n,o);}return r*i;}function E(t,n,e,r){var i=t*r-n*e<0?-1:1,a=t*e+n*r;return a>1&&(a=1),a<-1&&(a=-1),i*Math.acos(a);}function S(t,n,e,r,i,a,o,s,h,u){var c=u*(t-e)/2+h*(n-r)/2,f=-h*(t-e)/2+u*(n-r)/2,l=o*o,p=s*s,g=c*c,v=f*f,x=l*p-l*v-p*g;x<0&&(x=0),x/=l*v+p*g,x=Math.sqrt(x)*(i===a?-1:1);var y=x*o/s*f,d=x*-s/o*c,m=u*y-h*d+(t+e)/2,M=h*y+u*d+(n+r)/2,w=(c-y)/o,b=(f-d)/s,L=(-c-y)/o,A=(-f-d)/s,q=E(1,0,w,b),k=E(w,b,L,A);return 0===a&&k>0&&(k-=kn),1===a&&k<0&&(k+=kn),[m,M,q,k];}function C(t,n){var e=4/3*Math.tan(n/4),r=Math.cos(t),i=Math.sin(t),a=Math.cos(t+n),o=Math.sin(t+n);return[r,i,r-i*e,i+r*e,a+o*e,o-a*e,a,o];}function Z(t,n,e,r,i,a,o,s,h){var u=0,c=[],f=[];Pn(t,n,e,r,i,a,o,s,h).forEach(function(t){var n=new bn(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]),e=n.getTotalLength();u+=e,c.push(e),f.push(n);}),(this||_global$6).length=u,(this||_global$6).partialLengths=c,(this||_global$6).curves=f;}function T(t,n,e,r){(this||_global$6).x0=t,(this||_global$6).x1=n,(this||_global$6).y0=e,(this||_global$6).y1=r;}function F(t,n){return Math.sqrt((t[0]-n[0])*(t[0]-n[0])+(t[1]-n[1])*(t[1]-n[1]));}function z(t,n,e){return[t[0]+(n[0]-t[0])*e,t[1]+(n[1]-t[1])*e];}function j(t,n){return F(t,n)<1e-9;}function I(t,n,e){var r=t.map(function(t,e){return V(t,n[e]);});return function(t){var n=r.map(function(n){return n(t);});return e?H(n):n;};}function V(t,n){return function(e){return t.map(function(t,r){return t+e*(n[r]-t);});};}function X(t){return"number"==typeof t&&isFinite(t);}function Y(t){return G(t)?nn(t):[(t[0][0]+t[t.length-1][0])/2,(t[0][1]+t[t.length-1][1])/2];}function G(t){for(var n=0;n<t.length-2;n++){var e=t[n],r=t[n+1],i=t[n+2];if(e[0]*(r[1]-i[1])+r[0]*(i[1]-e[1])+i[0]*(e[1]-r[1]))return!0;}return!1;}function O(t){return new yn(t).abs();}function D(t){return t.toString().split("M").map(function(t,n){return t=t.trim(),n&&t?"M"+t:t;}).filter(function(t){return t;});}function H(t){return"M"+t.join("L")+"Z";}function N(t){return D(O(t));}function Q(t,n){var e=O(t);return U(e)||R(e,n);}function U(t){var n=t.segments||[],e=[];if(!n.length||"M"!==n[0][0])return!1;for(var r=0;r<n.length;r++){var i=n[r],a=i[0],o=i[1],s=i[2];if("M"===a&&r||"Z"===a)break;if("M"===a||"L"===a)e.push([o,s]);else if("H"===a)e.push([o,e[e.length-1][1]]);else{if("V"!==a)return!1;e.push([e[e.length-1][0],o]);}}return!!e.length&&{ring:e};}function R(t,n){var e,r,i=D(t)[0],a=[],o=3;if(!i)throw new TypeError(Cn);r=B(i),e=r.getTotalLength(),n&&X(n)&&n>0&&(o=Math.max(o,Math.ceil(e/n)));for(var s=0;s<o;s++){var h=r.getPointAtLength(e*s/o);a.push([h.x,h.y]);}return{ring:a,skipBisect:!0};}function B(t){if("undefined"!=typeof window&&window&&window.document)try{var n=window.document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttributeNS(null,"d",t),n;}catch(t){}return Sn(t);}function W(t,n){for(var e=t.length+n,r=en(t)/n,i=0,a=0,o=r/2;t.length<e;){var s=t[i],h=t[(i+1)%t.length],u=F(s,h);o<=a+u?(t.splice(i+1,0,u?z(s,h,(o-a)/u):s.slice(0)),o+=r):(a+=u,i++);}}function $(t,n){void 0===n&&(n=1/0);for(var e=0;e<t.length;e++){for(var r=t[e],i=e===t.length-1?t[0]:t[e+1];F(r,i)>n;){i=z(r,i,0.5),t.splice(e+1,0,i);}}}function J(t,n){var e,r,i;if("string"==typeof t){var a=Q(t,n);t=a.ring,i=a.skipBisect;}else if(!Array.isArray(t))throw new TypeError(Cn);if(e=t.slice(0),!K(e))throw new TypeError(Cn);return e.length>1&&j(e[0],e[e.length-1])&&e.pop(),r=tn(e),r>0&&e.reverse(),!i&&n&&X(n)&&n>0&&$(e,n),e;}function K(t){return t.every(function(t){return Array.isArray(t)&&t.length>=2&&X(t[0])&&X(t[1]);});}function tt(t,n,e){var r;return r=t.length-n.length,W(t,r<0?-1*r:0),W(n,r>0?r:0),Tn(t,n),I(t,n,e);}function nt(t,n,e){e=e||2;var r=n&&n.length,i=r?n[0]*e:t.length,a=et(t,0,i,e,!0),o=[];if(!a)return o;var s,h,u,c,f,l,p;if(r&&(a=ut(t,n,a,e)),t.length>80*e){s=u=t[0],h=c=t[1];for(var g=e;g<i;g+=e){f=t[g],l=t[g+1],f<s&&(s=f),l<h&&(h=l),f>u&&(u=f),l>c&&(c=l);}p=Math.max(u-s,c-h);}return it(a,o,e,s,h,p),o;}function et(t,n,e,r,i){var a,o;if(i===Et(t,n,e,r)>0)for(a=n;a<e;a+=r){o=kt(a,t[a],t[a+1],o);}else for(a=e-r;a>=n;a-=r){o=kt(a,t[a],t[a+1],o);}return o&&Mt(o,o.next)&&(Pt(o),o=o.next),o;}function rt(t,n){if(!t)return t;n||(n=t);var e,r=t;do{if(e=!1,r.steiner||!Mt(r,r.next)&&0!==mt(r.prev,r,r.next))r=r.next;else{if(Pt(r),(r=n=r.prev)===r.next)return null;e=!0;}}while(e||r!==n);return n;}function it(t,n,e,r,i,a,o){if(t){!o&&a&&pt(t,r,i,a);for(var s,h,u=t;t.prev!==t.next;){if(s=t.prev,h=t.next,a?ot(t,r,i,a):at(t))n.push(s.i/e),n.push(t.i/e),n.push(h.i/e),Pt(t),t=h.next,u=h.next;else if((t=h)===u){o?1===o?(t=st(t,n,e),it(t,n,e,r,i,a,2)):2===o&&ht(t,n,e,r,i,a):it(rt(t),n,e,r,i,a,1);break;}}}}function at(t){var n=t.prev,e=t,r=t.next;if(mt(n,e,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(yt(n.x,n.y,e.x,e.y,r.x,r.y,i.x,i.y)&&mt(i.prev,i,i.next)>=0)return!1;i=i.next;}return!0;}function ot(t,n,e,r){var i=t.prev,a=t,o=t.next;if(mt(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,h=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,f=vt(s,h,n,e,r),l=vt(u,c,n,e,r),p=t.nextZ;p&&p.z<=l;){if(p!==t.prev&&p!==t.next&&yt(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&mt(p.prev,p,p.next)>=0)return!1;p=p.nextZ;}for(p=t.prevZ;p&&p.z>=f;){if(p!==t.prev&&p!==t.next&&yt(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&mt(p.prev,p,p.next)>=0)return!1;p=p.prevZ;}return!0;}function st(t,n,e){var r=t;do{var i=r.prev,a=r.next.next;!Mt(i,a)&&wt(i,r,r.next,a)&&Lt(i,a)&&Lt(a,i)&&(n.push(i.i/e),n.push(r.i/e),n.push(a.i/e),Pt(r),Pt(r.next),r=t=a),r=r.next;}while(r!==t);return r;}function ht(t,n,e,r,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&dt(o,s)){var h=qt(o,s);return o=rt(o,o.next),h=rt(h,h.next),it(o,n,e,r,i,a),void it(h,n,e,r,i,a);}s=s.next;}o=o.next;}while(o!==t);}function ut(t,n,e,r){var i,a,o,s,h,u=[];for(i=0,a=n.length;i<a;i++){o=n[i]*r,s=i<a-1?n[i+1]*r:t.length,h=et(t,o,s,r,!1),h===h.next&&(h.steiner=!0),u.push(xt(h));}for(u.sort(ct),i=0;i<u.length;i++){ft(u[i],e),e=rt(e,e.next);}return e;}function ct(t,n){return t.x-n.x;}function ft(t,n){if(n=lt(t,n)){var e=qt(n,t);rt(e,e.next);}}function lt(t,n){var e,r=n,i=t.x,a=t.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next;}e=r.x<r.next.x?r:r.next;}}r=r.next;}while(r!==n);if(!e)return null;if(i===o)return e.prev;var h,u=e,c=e.x,f=e.y,l=1/0;for(r=e.next;r!==u;){i>=r.x&&r.x>=c&&yt(a<f?i:o,a,c,f,a<f?o:i,a,r.x,r.y)&&((h=Math.abs(a-r.y)/(i-r.x))<l||h===l&&r.x>e.x)&&Lt(r,t)&&(e=r,l=h),r=r.next;}return e;}function pt(t,n,e,r){var i=t;do{null===i.z&&(i.z=vt(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,gt(i);}function gt(t){var n,e,r,i,a,o,s,h,u=1;do{for(e=t,t=null,a=null,o=0;e;){for(o++,r=e,s=0,n=0;n<u&&(s++,r=r.nextZ);n++){;}for(h=u;s>0||h>0&&r;){0===s?(i=r,r=r.nextZ,h--):0!==h&&r?e.z<=r.z?(i=e,e=e.nextZ,s--):(i=r,r=r.nextZ,h--):(i=e,e=e.nextZ,s--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;}e=r;}a.nextZ=null,u*=2;}while(o>1);return t;}function vt(t,n,e,r,i){return t=32767*(t-e)/i,n=32767*(n-r)/i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),t|n<<1;}function xt(t){var n=t,e=t;do{n.x<e.x&&(e=n),n=n.next;}while(n!==t);return e;}function yt(t,n,e,r,i,a,o,s){return(i-o)*(n-s)-(t-o)*(a-s)>=0&&(t-o)*(r-s)-(e-o)*(n-s)>=0&&(e-o)*(a-s)-(i-o)*(r-s)>=0;}function dt(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!bt(t,n)&&Lt(t,n)&&Lt(n,t)&&At(t,n);}function mt(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y);}function Mt(t,n){return t.x===n.x&&t.y===n.y;}function wt(t,n,e,r){return!!(Mt(t,n)&&Mt(e,r)||Mt(t,r)&&Mt(e,n))||mt(t,n,e)>0!=mt(t,n,r)>0&&mt(e,r,t)>0!=mt(e,r,n)>0;}function bt(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&wt(e,e.next,t,n))return!0;e=e.next;}while(e!==t);return!1;}function Lt(t,n){return mt(t.prev,t,t.next)<0?mt(t,n,t.next)>=0&&mt(t,t.prev,n)>=0:mt(t,n,t.prev)<0||mt(t,t.next,n)<0;}function At(t,n){var e=t,r=!1,i=(t.x+n.x)/2,a=(t.y+n.y)/2;do{e.y>a!=e.next.y>a&&i<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;}while(e!==t);return r;}function qt(t,n){var e=new _t(t.i,t.x,t.y),r=new _t(n.i,n.x,n.y),i=t.next,a=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,a.next=r,r.prev=a,r;}function kt(t,n,e,r){var i=new _t(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i;}function Pt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function _t(t,n,e){(this||_global$6).i=t,(this||_global$6).x=n,(this||_global$6).y=e,(this||_global$6).prev=null,(this||_global$6).next=null,(this||_global$6).z=null,(this||_global$6).prevZ=null,(this||_global$6).nextZ=null,(this||_global$6).steiner=!1;}function Et(t,n,e,r){for(var i=0,a=n,o=e-r;a<e;a+=r){i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;}return i;}function St(t,n){var e=n.id,r=n.bbox,i=null==n.properties?{}:n.properties,a=Ct(t,n);return null==e&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:e,properties:i,geometry:a}:{type:"Feature",id:e,bbox:r,properties:i,geometry:a};}function Ct(t,n){function e(t,n){n.length&&n.pop();for(var e=u[t<0?~t:t],r=0,i=e.length;r<i;++r){n.push(h(e[r],r));}t<0&&Vn(n,i);}function r(t){return h(t);}function i(t){for(var n=[],r=0,i=t.length;r<i;++r){e(t[r],n);}return n.length<2&&n.push(n[0]),n;}function a(t){for(var n=i(t);n.length<4;){n.push(n[0]);}return n;}function o(t){return t.map(a);}function s(t){var n,e=t.type;switch(e){case"GeometryCollection":return{type:e,geometries:t.geometries.map(s)};case"Point":n=r(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(r);break;case"LineString":n=i(t.arcs);break;case"MultiLineString":n=t.arcs.map(i);break;case"Polygon":n=o(t.arcs);break;case"MultiPolygon":n=t.arcs.map(o);break;default:return null;}return{type:e,coordinates:n};}var h=In(t.transform),u=t.arcs;return s(n);}function Zt(t){for(var n,e=-1,r=t.length,i=t[r-1],a=0;++e<r;){n=i,i=t[e],a+=n[0]*i[1]-n[1]*i[0];}return Math.abs(a);}function Tt(t,n){function e(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"Polygon":r(t.arcs);break;case"MultiPolygon":t.arcs.forEach(r);}}function r(t){t.forEach(function(n){n.forEach(function(n){(a[n=n<0?~n:n]||(a[n]=[])).push(t);});}),o.push(t);}function i(n){return Zt(Ct(t,{type:"Polygon",arcs:[n]}).coordinates[0]);}var a={},o=[],s=[];return n.forEach(e),o.forEach(function(t){if(!t._){var n=[],e=[t];for(t._=1,s.push(n);t=e.pop();){n.push(t),t.forEach(function(t){t.forEach(function(t){a[t<0?~t:t].forEach(function(t){t._||(t._=1,e.push(t));});});});}}}),o.forEach(function(t){delete t._;}),{type:"MultiPolygon",arcs:s.map(function(n){var e,r=[];if(n.forEach(function(t){t.forEach(function(t){t.forEach(function(t){a[t<0?~t:t].length<2&&r.push(t);});});}),r=Yn(t,r),(e=r.length)>1)for(var o,s,h=1,u=i(r[0]);h<e;++h){(o=i(r[h]))>u&&(s=r[0],r[0]=r[h],r[h]=s,u=o);}return r;})};}function Ft(t){return function(n,e){return Dn(t(n),e);};}function zt(t,n){var e={},r={type:"Topology",objects:{triangles:{type:"GeometryCollection",geometries:[]}},arcs:[]};return t.forEach(function(t){var i=[];t.forEach(function(t,a){var o=t[0]<t[1]?t.join(","):t[1]+","+t[0],s=t.map(function(t){return n[t];});o in e?i.push(~e[o]):(i.push(e[o]=r.arcs.length),r.arcs.push(s));}),r.objects.triangles.geometries.push({type:"Polygon",area:Math.abs(tn(t.map(function(t){return n[t[0]];}))),arcs:[i]});}),r.objects.triangles.geometries.sort(function(t,n){return t.area-n.area;}),r;}function jt(t,n){for(var e=t.objects.triangles.geometries,r=Hn(function(t){return t.area;}).left;e.length>n;){!function(){var n=e[0],i=On(e)[0][0],a=e[i],o=Tt(t,[n,a]);o.area=n.area+a.area,o.type="Polygon",o.arcs=o.arcs[0],e.splice(i,1),e.shift(),e.splice(r(e,o.area),0,o);}();}if(n>e.length)throw new RangeError("Can't collapse topology into "+n+" pieces.");return Xn(t,t.objects.triangles).features.map(function(t){return t.geometry.coordinates[0].pop(),t.geometry.coordinates[0];});}function It(t){for(var n=zn(t.reduce(function(t,n){return t.concat([n[0]],[n[1]]);},[])),e=[],r=0,i=n.length;r<i;r+=3){e.push([[n[r],n[r+1]],[n[r+1],n[r+2]],[n[r+2],n[r]]]);}return e;}function Vt(t,n,e){function r(t,n,o){void 0===n&&(n=[]),void 0===o&&(o=0);for(var s=0;s<t.length;s++){var h=t.splice(s,1),u=e[h[0]][n.length];o+u<i&&(t.length?r(t.slice(),n.concat(h),o+u):(i=o+u,a=n.concat(h))),t.length&&t.splice(s,0,h[0]);}}var i=1/0,a=t.map(function(t,n){return n;});return r(a),a;}function Xt(t,n){var e=F(Y(t),Y(n));return e*e;}function Yt(t,n,e){void 0===e&&(e={});var r=e.maxSegmentLength;void 0===r&&(r=10);var i=e.string;void 0===i&&(i=!0);var a=e.single;void 0===a&&(a=!1);var o=J(t,r);o.length<n.length+2&&W(o,n.length+2-o.length);var s,h=Qn(o,n.length),u=n.map(function(t){return J(t,r);}),c="string"==typeof t&&t;return a&&!n.every(function(t){return"string"==typeof t;})||(s=n.slice(0)),Dt(h,u,{match:!0,string:i,single:a,t0:c,t1:s});}function Gt(t,n,e){void 0===e&&(e={});var r=e.maxSegmentLength;void 0===r&&(r=10);var i=e.string;void 0===i&&(i=!0);var a=e.single;void 0===a&&(a=!1);var o=Yt(n,t,{maxSegmentLength:r,string:i,single:a});return a?function(t){return o(1-t);}:o.map(function(t){return function(n){return t(1-n);};});}function Ot(t,n,e){void 0===e&&(e={});var r=e.maxSegmentLength;void 0===r&&(r=10);var i=e.string;void 0===i&&(i=!0);var a=e.single;if(void 0===a&&(a=!1),!Array.isArray(t)||!Array.isArray(n)||t.length!==n.length||!t.length)throw new TypeError(Zn);var o,s,h=function h(t){return J(t,r);},u=t.map(h),c=n.map(h);return a?(t.every(function(t){return"string"==typeof t;})&&(o=t.slice(0)),n.every(function(t){return"string"==typeof t;})&&(s=n.slice(0))):(o=t.slice(0),s=n.slice(0)),Dt(u,c,{string:i,single:a,t0:o,t1:s,match:!1});}function Dt(t,n,e){void 0===e&&(e={});var r=e.string,i=e.single,a=e.t0,o=e.t1,s=e.match,h=s?Un(t,n):t.map(function(t,n){return n;}),u=h.map(function(e,i){return tt(t[e],n[i],r);});if(s&&Array.isArray(a)&&(a=h.map(function(t){return a[t];})),i&&r&&(Array.isArray(a)&&(a=a.join(" ")),Array.isArray(o)&&(o=o.join(" "))),i){var c=r?function(t){return u.map(function(n){return n(t);}).join(" ");}:function(t){return u.map(function(n){return n(t);});};return r&&(a||o)?function(t){return t<0.0001&&a||1-t<0.0001&&o||c(t);}:c;}return r?(a=Array.isArray(a)?a.map(function(t){return"string"==typeof t&&t;}):[],o=Array.isArray(o)?o.map(function(t){return"string"==typeof t&&t;}):[],u.map(function(t,n){return a[n]||o[n]?function(e){return e<0.0001&&a[n]||1-e<0.0001&&o[n]||t(e);}:t;})):u;}function Ht(t,n,e,r,i){return Rt(Bt(t,n,e),r,Jt(t,n,e),2*Math.PI*e,i);}function Nt(t,n,e,r,i){var a=Ht(n,e,r,t,i);return function(t){return a(1-t);};}function Qt(t,n,e,r,i,a){return Rt(Wt(t,n,e,r),i,Kt(t,n,e,r),2*e+2*r,a);}function Ut(t,n,e,r,i,a){var o=Qt(n,e,r,i,t,a);return function(t){return o(1-t);};}function Rt(t,n,e,r,i){void 0===i&&(i={});var a=i.maxSegmentLength;void 0===a&&(a=10);var o=i.string;void 0===o&&(o=!0);var s,h,u=J(n,a);return X(r)&&u.length<r/a&&W(u,Math.ceil(r/a-u.length)),s=t(u),h=I(s,u,o),o?function(t){return t<0.0001?e:h(t);}:h;}function Bt(t,n,e){return function(r){var i=Y(r),a=en(r.concat([r[0]])),o=Math.atan2(r[0][1]-i[1],r[0][0]-i[0]),s=0;return r.map(function(i,h){var u;return h&&(s+=F(i,r[h-1])),u=o+2*Math.PI*(a?s/a:h/r.length),[Math.cos(u)*e+t,Math.sin(u)*e+n];});};}function Wt(t,n,e,r){return function(i){var a=Y(i),o=en(i.concat([i[0]])),s=Math.atan2(i[0][1]-a[1],i[0][0]-a[0]),h=0;s<0&&(s=2*Math.PI+s);var u=s/(2*Math.PI);return i.map(function(a,s){s&&(h+=F(a,i[s-1]));var c=$t((u+(o?h/o:s/i.length))%1);return[t+c[0]*e,n+c[1]*r];});};}function $t(t){return t<=1/8?[1,0.5+4*t]:t<=3/8?[1.5-4*t,1]:t<=5/8?[0,2.5-4*t]:t<=7/8?[4*t-2.5,0]:[1,4*t-3.5];}function Jt(t,n,e){var r=t-e+","+n,i=t+e+","+n,a="A"+e+","+e+",0,1,1,";return"M"+r+a+i+a+r+"Z";}function Kt(t,n,e,r){var i=t+e,a=n+r;return"M"+t+","+n+"L"+i+","+n+"L"+i+","+a+"L"+t+","+a+"Z";}var tn=function tn(t){for(var n,e=-1,r=t.length,i=t[r-1],a=0;++e<r;){n=i,i=t[e],a+=n[1]*i[0]-n[0]*i[1];}return a/2;},nn=function nn(t){for(var n,e,r=-1,i=t.length,a=0,o=0,s=t[i-1],h=0;++r<i;){n=s,s=t[r],h+=e=n[0]*s[1]-s[0]*n[1],a+=(n[0]+s[0])*e,o+=(n[1]+s[1])*e;}return h*=3,[a/h,o/h];},en=function en(t){for(var n,e,r=-1,i=t.length,a=t[i-1],o=a[0],s=a[1],h=0;++r<i;){n=o,e=s,a=t[r],o=a[0],s=a[1],n-=o,e-=s,h+=Math.sqrt(n*n+e*e);}return h;},rn={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},an=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279],on=function on(t){var n=new a(t),e=n.max;for(o(n);n.index<e&&!n.err.length;){u(n);}return n.err.length?n.result=[]:n.result.length&&("mM".indexOf(n.result[0][0])<0?(n.err="SvgPath: string should start with `M` or `m`",n.result=[]):n.result[0][0]="M"),{err:n.err,segments:n.result};};f.prototype.matrix=function(t){return 1===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&0===t[4]&&0===t[5]?this||_global$6:((this||_global$6).cache=null,(this||_global$6).queue.push(t),this||_global$6);},f.prototype.translate=function(t,n){return 0===t&&0===n||((this||_global$6).cache=null,(this||_global$6).queue.push([1,0,0,1,t,n])),this||_global$6;},f.prototype.scale=function(t,n){return 1===t&&1===n||((this||_global$6).cache=null,(this||_global$6).queue.push([t,0,0,n,0,0])),this||_global$6;},f.prototype.rotate=function(t,n,e){var r,i,a;return 0!==t&&(this.translate(n,e),r=t*Math.PI/180,i=Math.cos(r),a=Math.sin(r),(this||_global$6).queue.push([i,a,-a,i,0,0]),(this||_global$6).cache=null,this.translate(-n,-e)),this||_global$6;},f.prototype.skewX=function(t){return 0!==t&&((this||_global$6).cache=null,(this||_global$6).queue.push([1,0,Math.tan(t*Math.PI/180),1,0,0])),this||_global$6;},f.prototype.skewY=function(t){return 0!==t&&((this||_global$6).cache=null,(this||_global$6).queue.push([1,Math.tan(t*Math.PI/180),0,1,0,0])),this||_global$6;},f.prototype.toArray=function(){var t=this||_global$6;if((this||_global$6).cache)return(this||_global$6).cache;if(!(this||_global$6).queue.length)return(this||_global$6).cache=[1,0,0,1,0,0],(this||_global$6).cache;if((this||_global$6).cache=(this||_global$6).queue[0],1===(this||_global$6).queue.length)return(this||_global$6).cache;for(var n=1;n<(this||_global$6).queue.length;n++){t.cache=c(t.cache,t.queue[n]);}return(this||_global$6).cache;},f.prototype.calc=function(t,n,e){var r;return(this||_global$6).queue.length?((this||_global$6).cache||((this||_global$6).cache=this.toArray()),r=(this||_global$6).cache,[t*r[0]+n*r[2]+(e?0:r[4]),t*r[1]+n*r[3]+(e?0:r[5])]):[t,n];};var sn=f,hn={matrix:!0,scale:!0,rotate:!0,translate:!0,skewX:!0,skewY:!0},un=/\s*(matrix|translate|scale|rotate|skewX|skewY)\s*\(\s*(.+?)\s*\)[\s,]*/,cn=/[\s,]+/,fn=function fn(t){var n,e,r=new sn();return t.split(un).forEach(function(t){if(t.length){if(void 0!==hn[t])return void(n=t);switch(e=t.split(cn).map(function(t){return+t||0;}),n){case"matrix":return void(6===e.length&&r.matrix(e));case"scale":return void(1===e.length?r.scale(e[0],e[0]):2===e.length&&r.scale(e[0],e[1]));case"rotate":return void(1===e.length?r.rotate(e[0],0,0):3===e.length&&r.rotate(e[0],e[1],e[2]));case"translate":return void(1===e.length?r.translate(e[0],0):2===e.length&&r.translate(e[0],e[1]));case"skewX":return void(1===e.length&&r.skewX(e[0]));case"skewY":return void(1===e.length&&r.skewY(e[0]));}}}),r;},ln=2*Math.PI,pn=function pn(t,n,e,r,i,a,o,s,h){var u=Math.sin(h*ln/360),c=Math.cos(h*ln/360),f=c*(t-e)/2+u*(n-r)/2,l=-u*(t-e)/2+c*(n-r)/2;if(0===f&&0===l)return[];if(0===o||0===s)return[];o=Math.abs(o),s=Math.abs(s);var v=f*f/(o*o)+l*l/(s*s);v>1&&(o*=Math.sqrt(v),s*=Math.sqrt(v));var x=p(t,n,e,r,i,a,o,s,u,c),y=[],d=x[2],m=x[3],M=Math.max(Math.ceil(Math.abs(m)/(ln/4)),1);m/=M;for(var w=0;w<M;w++){y.push(g(d,m)),d+=m;}return y.map(function(t){for(var n=0;n<t.length;n+=2){var e=t[n+0],r=t[n+1];e*=o,r*=s;var i=c*e-u*r,a=u*e+c*r;t[n+0]=i+x[0],t[n+1]=a+x[1];}return t;});},gn=Math.PI/180;v.prototype.transform=function(t){var n=Math.cos((this||_global$6).ax*gn),e=Math.sin((this||_global$6).ax*gn),r=[(this||_global$6).rx*(t[0]*n+t[2]*e),(this||_global$6).rx*(t[1]*n+t[3]*e),(this||_global$6).ry*(-t[0]*e+t[2]*n),(this||_global$6).ry*(-t[1]*e+t[3]*n)],i=r[0]*r[0]+r[2]*r[2],a=r[1]*r[1]+r[3]*r[3],o=((r[0]-r[3])*(r[0]-r[3])+(r[2]+r[1])*(r[2]+r[1]))*((r[0]+r[3])*(r[0]+r[3])+(r[2]-r[1])*(r[2]-r[1])),s=(i+a)/2;if(o<1e-10*s)return(this||_global$6).rx=(this||_global$6).ry=Math.sqrt(s),(this||_global$6).ax=0,this||_global$6;var h=r[0]*r[1]+r[2]*r[3];o=Math.sqrt(o);var u=s+o/2,c=s-o/2;return(this||_global$6).ax=Math.abs(h)<1e-10&&Math.abs(u-a)<1e-10?90:180*Math.atan(Math.abs(h)>Math.abs(u-a)?(u-i)/h:h/(u-a))/Math.PI,(this||_global$6).ax>=0?((this||_global$6).rx=Math.sqrt(u),(this||_global$6).ry=Math.sqrt(c)):((this||_global$6).ax+=90,(this||_global$6).rx=Math.sqrt(c),(this||_global$6).ry=Math.sqrt(u)),this||_global$6;},v.prototype.isDegenerate=function(){return(this||_global$6).rx<1e-10*(this||_global$6).ry||(this||_global$6).ry<1e-10*(this||_global$6).rx;};var vn=v;x.prototype.__matrix=function(t){var n,e=this||_global$6;t.queue.length&&this.iterate(function(r,i,a,o){var s,h,u,c;switch(r[0]){case"v":s=t.calc(0,r[1],!0),h=0===s[0]?["v",s[1]]:["l",s[0],s[1]];break;case"V":s=t.calc(a,r[1],!1),h=s[0]===t.calc(a,o,!1)[0]?["V",s[1]]:["L",s[0],s[1]];break;case"h":s=t.calc(r[1],0,!0),h=0===s[1]?["h",s[0]]:["l",s[0],s[1]];break;case"H":s=t.calc(r[1],o,!1),h=s[1]===t.calc(a,o,!1)[1]?["H",s[0]]:["L",s[0],s[1]];break;case"a":case"A":var f=t.toArray(),l=vn(r[1],r[2],r[3]).transform(f);if(f[0]*f[3]-f[1]*f[2]<0&&(r[5]=r[5]?"0":"1"),s=t.calc(r[6],r[7],"a"===r[0]),"A"===r[0]&&r[6]===a&&r[7]===o||"a"===r[0]&&0===r[6]&&0===r[7]){h=["a"===r[0]?"l":"L",s[0],s[1]];break;}h=l.isDegenerate()?["a"===r[0]?"l":"L",s[0],s[1]]:[r[0],l.rx,l.ry,l.ax,r[4],r[5],s[0],s[1]];break;case"m":c=i>0,s=t.calc(r[1],r[2],c),h=["m",s[0],s[1]];break;default:for(u=r[0],h=[u],c=u.toLowerCase()===u,n=1;n<r.length;n+=2){s=t.calc(r[n],r[n+1],c),h.push(s[0],s[1]);}}e.segments[i]=h;},!0);},x.prototype.__evaluateStack=function(){var t,n,e=this||_global$6;if((this||_global$6).__stack.length){if(1===(this||_global$6).__stack.length)return this.__matrix((this||_global$6).__stack[0]),void((this||_global$6).__stack=[]);for(t=sn(),n=(this||_global$6).__stack.length;--n>=0;){t.matrix(e.__stack[n].toArray());}this.__matrix(t),(this||_global$6).__stack=[];}},x.prototype.toString=function(){var t,n,e=this||_global$6,r=[];this.__evaluateStack();for(var i=0;i<(this||_global$6).segments.length;i++){n=e.segments[i][0],t=i>0&&"m"!==n&&"M"!==n&&n===e.segments[i-1][0],r=r.concat(t?e.segments[i].slice(1):e.segments[i]);}return r.join(" ").replace(/ ?([achlmqrstvz]) ?/gi,"$1").replace(/ \-/g,"-").replace(/zm/g,"z m");},x.prototype.translate=function(t,n){return(this||_global$6).__stack.push(sn().translate(t,n||0)),this||_global$6;},x.prototype.scale=function(t,n){return(this||_global$6).__stack.push(sn().scale(t,n||0===n?n:t)),this||_global$6;},x.prototype.rotate=function(t,n,e){return(this||_global$6).__stack.push(sn().rotate(t,n||0,e||0)),this||_global$6;},x.prototype.skewX=function(t){return(this||_global$6).__stack.push(sn().skewX(t)),this||_global$6;},x.prototype.skewY=function(t){return(this||_global$6).__stack.push(sn().skewY(t)),this||_global$6;},x.prototype.matrix=function(t){return(this||_global$6).__stack.push(sn().matrix(t)),this||_global$6;},x.prototype.transform=function(t){return t.trim()?((this||_global$6).__stack.push(fn(t)),this||_global$6):this||_global$6;},x.prototype.round=function(t){var n,e=0,r=0,i=0,a=0;return t=t||0,this.__evaluateStack(),(this||_global$6).segments.forEach(function(o){var s=o[0].toLowerCase()===o[0];switch(o[0]){case"H":case"h":return s&&(o[1]+=i),i=o[1]-o[1].toFixed(t),void(o[1]=+o[1].toFixed(t));case"V":case"v":return s&&(o[1]+=a),a=o[1]-o[1].toFixed(t),void(o[1]=+o[1].toFixed(t));case"Z":case"z":return i=e,void(a=r);case"M":case"m":return s&&(o[1]+=i,o[2]+=a),i=o[1]-o[1].toFixed(t),a=o[2]-o[2].toFixed(t),e=i,r=a,o[1]=+o[1].toFixed(t),void(o[2]=+o[2].toFixed(t));case"A":case"a":return s&&(o[6]+=i,o[7]+=a),i=o[6]-o[6].toFixed(t),a=o[7]-o[7].toFixed(t),o[1]=+o[1].toFixed(t),o[2]=+o[2].toFixed(t),o[3]=+o[3].toFixed(t+2),o[6]=+o[6].toFixed(t),void(o[7]=+o[7].toFixed(t));default:return n=o.length,s&&(o[n-2]+=i,o[n-1]+=a),i=o[n-2]-o[n-2].toFixed(t),a=o[n-1]-o[n-1].toFixed(t),void o.forEach(function(n,e){e&&(o[e]=+o[e].toFixed(t));});}}),this||_global$6;},x.prototype.iterate=function(t,n){var e,r,i,a=(this||_global$6).segments,o={},s=!1,h=0,u=0,c=0,f=0;if(n||this.__evaluateStack(),a.forEach(function(n,e){var r=t(n,e,h,u);Array.isArray(r)&&(o[e]=r,s=!0);var i=n[0]===n[0].toLowerCase();switch(n[0]){case"m":case"M":return h=n[1]+(i?h:0),u=n[2]+(i?u:0),c=h,void(f=u);case"h":case"H":return void(h=n[1]+(i?h:0));case"v":case"V":return void(u=n[1]+(i?u:0));case"z":case"Z":return h=c,void(u=f);default:h=n[n.length-2]+(i?h:0),u=n[n.length-1]+(i?u:0);}}),!s)return this||_global$6;for(i=[],e=0;e<a.length;e++){if(void 0!==o[e])for(r=0;r<o[e].length;r++){i.push(o[e][r]);}else i.push(a[e]);}return(this||_global$6).segments=i,this||_global$6;},x.prototype.abs=function(){return this.iterate(function(t,n,e,r){var i,a=t[0],o=a.toUpperCase();if(a!==o)switch(t[0]=o,a){case"v":return void(t[1]+=r);case"a":return t[6]+=e,void(t[7]+=r);default:for(i=1;i<t.length;i++){t[i]+=i%2?e:r;}}},!0),this||_global$6;},x.prototype.rel=function(){return this.iterate(function(t,n,e,r){var i,a=t[0],o=a.toLowerCase();if(a!==o&&(0!==n||"M"!==a))switch(t[0]=o,a){case"V":return void(t[1]-=r);case"A":return t[6]-=e,void(t[7]-=r);default:for(i=1;i<t.length;i++){t[i]-=i%2?e:r;}}},!0),this||_global$6;},x.prototype.unarc=function(){return this.iterate(function(t,n,e,r){var i,a,o,s=[],h=t[0];return"A"!==h&&"a"!==h?null:("a"===h?(a=e+t[6],o=r+t[7]):(a=t[6],o=t[7]),i=pn(e,r,a,o,t[4],t[5],t[1],t[2],t[3]),0===i.length?[["a"===t[0]?"l":"L",t[6],t[7]]]:(i.forEach(function(t){s.push(["C",t[2],t[3],t[4],t[5],t[6],t[7]]);}),s));}),this||_global$6;},x.prototype.unshort=function(){var t,n,e,r,i,a=(this||_global$6).segments;return this.iterate(function(o,s,h,u){var c,f=o[0],l=f.toUpperCase();s&&("T"===l?(c="t"===f,e=a[s-1],"Q"===e[0]?(t=e[1]-h,n=e[2]-u):"q"===e[0]?(t=e[1]-e[3],n=e[2]-e[4]):(t=0,n=0),r=-t,i=-n,c||(r+=h,i+=u),a[s]=[c?"q":"Q",r,i,o[1],o[2]]):"S"===l&&(c="s"===f,e=a[s-1],"C"===e[0]?(t=e[3]-h,n=e[4]-u):"c"===e[0]?(t=e[3]-e[5],n=e[4]-e[6]):(t=0,n=0),r=-t,i=-n,c||(r+=h,i+=u),a[s]=[c?"c":"C",r,i,o[1],o[2],o[3],o[4]]));}),this||_global$6;};var xn=x,yn=xn,dn={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},mn=/([astvzqmhlc])([^astvzqmhlc]*)/gi,Mn=function Mn(t){var n=[];return t.replace(mn,function(t,e,r){var i=e.toLowerCase();for(r=y(r),"m"===i&&r.length>2&&(n.push([e].concat(r.splice(0,2))),i="l",e="m"===e?"l":"L");r.length>=0;){if(r.length===dn[i])return r.unshift(e),n.push(r);if(r.length<dn[i])throw new Error("malformed path data");n.push([e].concat(r.splice(0,dn[i])));}}),n;},wn=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi,bn=function bn(t,n,e,r,i,a,o,s){return new d(t,n,e,r,i,a,o,s);};d.prototype={constructor:d,init:function init(){(this||_global$6).length=this.getArcLength([(this||_global$6).a.x,(this||_global$6).b.x,(this||_global$6).c.x,(this||_global$6).d.x],[(this||_global$6).a.y,(this||_global$6).b.y,(this||_global$6).c.y,(this||_global$6).d.y]);},getTotalLength:function getTotalLength(){return(this||_global$6).length;},getPointAtLength:function getPointAtLength(t){var n=w(t,(this||_global$6).length,(this||_global$6).getArcLength,[(this||_global$6).a.x,(this||_global$6).b.x,(this||_global$6).c.x,(this||_global$6).d.x],[(this||_global$6).a.y,(this||_global$6).b.y,(this||_global$6).c.y,(this||_global$6).d.y]);return this.getPoint([(this||_global$6).a.x,(this||_global$6).b.x,(this||_global$6).c.x,(this||_global$6).d.x],[(this||_global$6).a.y,(this||_global$6).b.y,(this||_global$6).c.y,(this||_global$6).d.y],n);},getTangentAtLength:function getTangentAtLength(t){var n=w(t,(this||_global$6).length,(this||_global$6).getArcLength,[(this||_global$6).a.x,(this||_global$6).b.x,(this||_global$6).c.x,(this||_global$6).d.x],[(this||_global$6).a.y,(this||_global$6).b.y,(this||_global$6).c.y,(this||_global$6).d.y]),e=this.getDerivative([(this||_global$6).a.x,(this||_global$6).b.x,(this||_global$6).c.x,(this||_global$6).d.x],[(this||_global$6).a.y,(this||_global$6).b.y,(this||_global$6).c.y,(this||_global$6).d.y],n),r=Math.sqrt(e.x*e.x+e.y*e.y);return r>0?{x:e.x/r,y:e.y/r}:{x:0,y:0};},getPropertiesAtLength:function getPropertiesAtLength(t){var n,e=w(t,(this||_global$6).length,(this||_global$6).getArcLength,[(this||_global$6).a.x,(this||_global$6).b.x,(this||_global$6).c.x,(this||_global$6).d.x],[(this||_global$6).a.y,(this||_global$6).b.y,(this||_global$6).c.y,(this||_global$6).d.y]),r=this.getDerivative([(this||_global$6).a.x,(this||_global$6).b.x,(this||_global$6).c.x,(this||_global$6).d.x],[(this||_global$6).a.y,(this||_global$6).b.y,(this||_global$6).c.y,(this||_global$6).d.y],e),i=Math.sqrt(r.x*r.x+r.y*r.y);n=i>0?{x:r.x/i,y:r.y/i}:{x:0,y:0};var a=this.getPoint([(this||_global$6).a.x,(this||_global$6).b.x,(this||_global$6).c.x,(this||_global$6).d.x],[(this||_global$6).a.y,(this||_global$6).b.y,(this||_global$6).c.y,(this||_global$6).d.y],e);return{x:a.x,y:a.y,tangentX:n.x,tangentY:n.y};}};var Ln=[[],[],[-0.5773502691896257,0.5773502691896257],[0,-0.7745966692414834,0.7745966692414834],[-0.33998104358485626,0.33998104358485626,-0.8611363115940526,0.8611363115940526],[0,-0.5384693101056831,0.5384693101056831,-0.906179845938664,0.906179845938664],[0.6612093864662645,-0.6612093864662645,-0.2386191860831969,0.2386191860831969,-0.932469514203152,0.932469514203152],[0,0.4058451513773972,-0.4058451513773972,-0.7415311855993945,0.7415311855993945,-0.9491079123427585,0.9491079123427585],[-0.1834346424956498,0.1834346424956498,-0.525532409916329,0.525532409916329,-0.7966664774136267,0.7966664774136267,-0.9602898564975363,0.9602898564975363],[0,-0.8360311073266358,0.8360311073266358,-0.9681602395076261,0.9681602395076261,-0.3242534234038089,0.3242534234038089,-0.6133714327005904,0.6133714327005904],[-0.14887433898163122,0.14887433898163122,-0.4333953941292472,0.4333953941292472,-0.6794095682990244,0.6794095682990244,-0.8650633666889845,0.8650633666889845,-0.9739065285171717,0.9739065285171717],[0,-0.26954315595234496,0.26954315595234496,-0.5190961292068118,0.5190961292068118,-0.7301520055740494,0.7301520055740494,-0.8870625997680953,0.8870625997680953,-0.978228658146057,0.978228658146057],[-0.1252334085114689,0.1252334085114689,-0.3678314989981802,0.3678314989981802,-0.5873179542866175,0.5873179542866175,-0.7699026741943047,0.7699026741943047,-0.9041172563704749,0.9041172563704749,-0.9815606342467192,0.9815606342467192],[0,-0.2304583159551348,0.2304583159551348,-0.44849275103644687,0.44849275103644687,-0.6423493394403402,0.6423493394403402,-0.8015780907333099,0.8015780907333099,-0.9175983992229779,0.9175983992229779,-0.9841830547185881,0.9841830547185881],[-0.10805494870734367,0.10805494870734367,-0.31911236892788974,0.31911236892788974,-0.5152486363581541,0.5152486363581541,-0.6872929048116855,0.6872929048116855,-0.827201315069765,0.827201315069765,-0.9284348836635735,0.9284348836635735,-0.9862838086968123,0.9862838086968123],[0,-0.20119409399743451,0.20119409399743451,-0.3941513470775634,0.3941513470775634,-0.5709721726085388,0.5709721726085388,-0.7244177313601701,0.7244177313601701,-0.8482065834104272,0.8482065834104272,-0.937273392400706,0.937273392400706,-0.9879925180204854,0.9879925180204854],[-0.09501250983763744,0.09501250983763744,-0.2816035507792589,0.2816035507792589,-0.45801677765722737,0.45801677765722737,-0.6178762444026438,0.6178762444026438,-0.755404408355003,0.755404408355003,-0.8656312023878318,0.8656312023878318,-0.9445750230732326,0.9445750230732326,-0.9894009349916499,0.9894009349916499],[0,-0.17848418149584785,0.17848418149584785,-0.3512317634538763,0.3512317634538763,-0.5126905370864769,0.5126905370864769,-0.6576711592166907,0.6576711592166907,-0.7815140038968014,0.7815140038968014,-0.8802391537269859,0.8802391537269859,-0.9506755217687678,0.9506755217687678,-0.9905754753144174,0.9905754753144174],[-0.0847750130417353,0.0847750130417353,-0.2518862256915055,0.2518862256915055,-0.41175116146284263,0.41175116146284263,-0.5597708310739475,0.5597708310739475,-0.6916870430603532,0.6916870430603532,-0.8037049589725231,0.8037049589725231,-0.8926024664975557,0.8926024664975557,-0.9558239495713977,0.9558239495713977,-0.9915651684209309,0.9915651684209309],[0,-0.16035864564022537,0.16035864564022537,-0.31656409996362983,0.31656409996362983,-0.46457074137596094,0.46457074137596094,-0.600545304661681,0.600545304661681,-0.7209661773352294,0.7209661773352294,-0.8227146565371428,0.8227146565371428,-0.9031559036148179,0.9031559036148179,-0.96020815213483,0.96020815213483,-0.9924068438435844,0.9924068438435844],[-0.07652652113349734,0.07652652113349734,-0.22778585114164507,0.22778585114164507,-0.37370608871541955,0.37370608871541955,-0.5108670019508271,0.5108670019508271,-0.636053680726515,0.636053680726515,-0.7463319064601508,0.7463319064601508,-0.8391169718222188,0.8391169718222188,-0.912234428251326,0.912234428251326,-0.9639719272779138,0.9639719272779138,-0.9931285991850949,0.9931285991850949],[0,-0.1455618541608951,0.1455618541608951,-0.2880213168024011,0.2880213168024011,-0.4243421202074388,0.4243421202074388,-0.5516188358872198,0.5516188358872198,-0.6671388041974123,0.6671388041974123,-0.7684399634756779,0.7684399634756779,-0.8533633645833173,0.8533633645833173,-0.9200993341504008,0.9200993341504008,-0.9672268385663063,0.9672268385663063,-0.9937521706203895,0.9937521706203895],[-0.06973927331972223,0.06973927331972223,-0.20786042668822127,0.20786042668822127,-0.34193582089208424,0.34193582089208424,-0.469355837986757,0.469355837986757,-0.5876404035069116,0.5876404035069116,-0.6944872631866827,0.6944872631866827,-0.7878168059792081,0.7878168059792081,-0.8658125777203002,0.8658125777203002,-0.926956772187174,0.926956772187174,-0.9700604978354287,0.9700604978354287,-0.9942945854823992,0.9942945854823992],[0,-0.1332568242984661,0.1332568242984661,-0.26413568097034495,0.26413568097034495,-0.3903010380302908,0.3903010380302908,-0.5095014778460075,0.5095014778460075,-0.6196098757636461,0.6196098757636461,-0.7186613631319502,0.7186613631319502,-0.8048884016188399,0.8048884016188399,-0.8767523582704416,0.8767523582704416,-0.9329710868260161,0.9329710868260161,-0.9725424712181152,0.9725424712181152,-0.9947693349975522,0.9947693349975522],[-0.06405689286260563,0.06405689286260563,-0.1911188674736163,0.1911188674736163,-0.3150426796961634,0.3150426796961634,-0.4337935076260451,0.4337935076260451,-0.5454214713888396,0.5454214713888396,-0.6480936519369755,0.6480936519369755,-0.7401241915785544,0.7401241915785544,-0.820001985973903,0.820001985973903,-0.8864155270044011,0.8864155270044011,-0.9382745520027328,0.9382745520027328,-0.9747285559713095,0.9747285559713095,-0.9951872199970213,0.9951872199970213]],An=[[],[],[1,1],[0.8888888888888888,0.5555555555555556,0.5555555555555556],[0.6521451548625461,0.6521451548625461,0.34785484513745385,0.34785484513745385],[0.5688888888888889,0.47862867049936647,0.47862867049936647,0.23692688505618908,0.23692688505618908],[0.3607615730481386,0.3607615730481386,0.46791393457269104,0.46791393457269104,0.17132449237917036,0.17132449237917036],[0.4179591836734694,0.3818300505051189,0.3818300505051189,0.27970539148927664,0.27970539148927664,0.1294849661688697,0.1294849661688697],[0.362683783378362,0.362683783378362,0.31370664587788727,0.31370664587788727,0.22238103445337448,0.22238103445337448,0.10122853629037626,0.10122853629037626],[0.3302393550012598,0.1806481606948574,0.1806481606948574,0.08127438836157441,0.08127438836157441,0.31234707704000286,0.31234707704000286,0.26061069640293544,0.26061069640293544],[0.29552422471475287,0.29552422471475287,0.26926671930999635,0.26926671930999635,0.21908636251598204,0.21908636251598204,0.1494513491505806,0.1494513491505806,0.06667134430868814,0.06667134430868814],[0.2729250867779006,0.26280454451024665,0.26280454451024665,0.23319376459199048,0.23319376459199048,0.18629021092773426,0.18629021092773426,0.1255803694649046,0.1255803694649046,0.05566856711617366,0.05566856711617366],[0.24914704581340277,0.24914704581340277,0.2334925365383548,0.2334925365383548,0.20316742672306592,0.20316742672306592,0.16007832854334622,0.16007832854334622,0.10693932599531843,0.10693932599531843,0.04717533638651183,0.04717533638651183],[0.2325515532308739,0.22628318026289723,0.22628318026289723,0.2078160475368885,0.2078160475368885,0.17814598076194574,0.17814598076194574,0.13887351021978725,0.13887351021978725,0.09212149983772845,0.09212149983772845,0.04048400476531588,0.04048400476531588],[0.2152638534631578,0.2152638534631578,0.2051984637212956,0.2051984637212956,0.18553839747793782,0.18553839747793782,0.15720316715819355,0.15720316715819355,0.12151857068790319,0.12151857068790319,0.08015808715976021,0.08015808715976021,0.03511946033175186,0.03511946033175186],[0.2025782419255613,0.19843148532711158,0.19843148532711158,0.1861610000155622,0.1861610000155622,0.16626920581699392,0.16626920581699392,0.13957067792615432,0.13957067792615432,0.10715922046717194,0.10715922046717194,0.07036604748810812,0.07036604748810812,0.03075324199611727,0.03075324199611727],[0.1894506104550685,0.1894506104550685,0.18260341504492358,0.18260341504492358,0.16915651939500254,0.16915651939500254,0.14959598881657674,0.14959598881657674,0.12462897125553388,0.12462897125553388,0.09515851168249279,0.09515851168249279,0.062253523938647894,0.062253523938647894,0.027152459411754096,0.027152459411754096],[0.17944647035620653,0.17656270536699264,0.17656270536699264,0.16800410215645004,0.16800410215645004,0.15404576107681028,0.15404576107681028,0.13513636846852548,0.13513636846852548,0.11188384719340397,0.11188384719340397,0.08503614831717918,0.08503614831717918,0.0554595293739872,0.0554595293739872,0.02414830286854793,0.02414830286854793],[0.1691423829631436,0.1691423829631436,0.16427648374583273,0.16427648374583273,0.15468467512626524,0.15468467512626524,0.14064291467065065,0.14064291467065065,0.12255520671147846,0.12255520671147846,0.10094204410628717,0.10094204410628717,0.07642573025488905,0.07642573025488905,0.0497145488949698,0.0497145488949698,0.02161601352648331,0.02161601352648331],[0.1610544498487837,0.15896884339395434,0.15896884339395434,0.15276604206585967,0.15276604206585967,0.1426067021736066,0.1426067021736066,0.12875396253933621,0.12875396253933621,0.11156664554733399,0.11156664554733399,0.09149002162245,0.09149002162245,0.06904454273764123,0.06904454273764123,0.0448142267656996,0.0448142267656996,0.019461788229726478,0.019461788229726478],[0.15275338713072584,0.15275338713072584,0.14917298647260374,0.14917298647260374,0.14209610931838204,0.14209610931838204,0.13168863844917664,0.13168863844917664,0.11819453196151841,0.11819453196151841,0.10193011981724044,0.10193011981724044,0.08327674157670475,0.08327674157670475,0.06267204833410907,0.06267204833410907,0.04060142980038694,0.04060142980038694,0.017614007139152118,0.017614007139152118],[0.14608113364969041,0.14452440398997005,0.14452440398997005,0.13988739479107315,0.13988739479107315,0.13226893863333747,0.13226893863333747,0.12183141605372853,0.12183141605372853,0.10879729916714838,0.10879729916714838,0.09344442345603386,0.09344442345603386,0.0761001136283793,0.0761001136283793,0.057134425426857205,0.057134425426857205,0.036953789770852494,0.036953789770852494,0.016017228257774335,0.016017228257774335],[0.13925187285563198,0.13925187285563198,0.13654149834601517,0.13654149834601517,0.13117350478706238,0.13117350478706238,0.12325237681051242,0.12325237681051242,0.11293229608053922,0.11293229608053922,0.10041414444288096,0.10041414444288096,0.08594160621706773,0.08594160621706773,0.06979646842452049,0.06979646842452049,0.052293335152683286,0.052293335152683286,0.03377490158481415,0.03377490158481415,0.0146279952982722,0.0146279952982722],[0.13365457218610619,0.1324620394046966,0.1324620394046966,0.12890572218808216,0.12890572218808216,0.12304908430672953,0.12304908430672953,0.11499664022241136,0.11499664022241136,0.10489209146454141,0.10489209146454141,0.09291576606003515,0.09291576606003515,0.07928141177671895,0.07928141177671895,0.06423242140852585,0.06423242140852585,0.04803767173108467,0.04803767173108467,0.030988005856979445,0.030988005856979445,0.013411859487141771,0.013411859487141771],[0.12793819534675216,0.12793819534675216,0.1258374563468283,0.1258374563468283,0.12167047292780339,0.12167047292780339,0.1155056680537256,0.1155056680537256,0.10744427011596563,0.10744427011596563,0.09761865210411388,0.09761865210411388,0.08619016153195327,0.08619016153195327,0.0733464814110803,0.0733464814110803,0.05929858491543678,0.05929858491543678,0.04427743881741981,0.04427743881741981,0.028531388628933663,0.028531388628933663,0.0123412297999872,0.0123412297999872]],qn=[[1],[1,1],[1,2,1],[1,3,3,1]],kn=2*Math.PI,Pn=function Pn(t,n,e,r,i,a,o,s,h){var u=Math.sin(i*kn/360),c=Math.cos(i*kn/360),f=c*(t-s)/2+u*(n-h)/2,l=-u*(t-s)/2+c*(n-h)/2;if(0===f&&0===l)return[];if(0===e||0===r)return[];e=Math.abs(e),r=Math.abs(r);var p=f*f/(e*e)+l*l/(r*r);p>1&&(e*=Math.sqrt(p),r*=Math.sqrt(p));var g=S(t,n,s,h,a,o,e,r,u,c),v=[],x=g[2],y=g[3],d=Math.max(Math.ceil(Math.abs(y)/(kn/4)),1);y/=d;for(var m=0;m<d;m++){v.push(C(x,y)),x+=y;}return v.map(function(t){for(var n=0;n<t.length;n+=2){var i=t[n+0],a=t[n+1];i*=e,a*=r;var o=c*i-u*a,s=u*i+c*a;t[n+0]=o+g[0],t[n+1]=s+g[1];}return t;});},_n=function _n(t,n,e,r,i,a,o,s,h){return new Z(t,n,e,r,i,a,o,s,h);};Z.prototype={constructor:Z,init:function init(){},getTotalLength:function getTotalLength(){return(this||_global$6).length;},getPointAtLength:function getPointAtLength(t){var n=this||_global$6;t<0?t=0:t>(this||_global$6).length&&(t=(this||_global$6).length);for(var e=(this||_global$6).partialLengths.length-1;(this||_global$6).partialLengths[e]>=t&&(this||_global$6).partialLengths[e]>0;){e--;}e<(this||_global$6).partialLengths.length-1&&e++;for(var r=0,i=0;i<e;i++){r+=n.partialLengths[i];}return(this||_global$6).curves[e].getPointAtLength(t-r);},getTangentAtLength:function getTangentAtLength(t){var n=this||_global$6;t<0?t=0:t>(this||_global$6).length&&(t=(this||_global$6).length);for(var e=(this||_global$6).partialLengths.length-1;(this||_global$6).partialLengths[e]>=t&&(this||_global$6).partialLengths[e]>0;){e--;}e<(this||_global$6).partialLengths.length-1&&e++;for(var r=0,i=0;i<e;i++){r+=n.partialLengths[i];}return(this||_global$6).curves[e].getTangentAtLength(t-r);},getPropertiesAtLength:function getPropertiesAtLength(t){var n=this.getTangentAtLength(t),e=this.getPointAtLength(t);return{x:e.x,y:e.y,tangentX:n.x,tangentY:n.y};}};var En=function En(t,n,e,r){return new T(t,n,e,r);};T.prototype.getTotalLength=function(){return Math.sqrt(Math.pow((this||_global$6).x0-(this||_global$6).x1,2)+Math.pow((this||_global$6).y0-(this||_global$6).y1,2));},T.prototype.getPointAtLength=function(t){var n=t/Math.sqrt(Math.pow((this||_global$6).x0-(this||_global$6).x1,2)+Math.pow((this||_global$6).y0-(this||_global$6).y1,2)),e=((this||_global$6).x1-(this||_global$6).x0)*n,r=((this||_global$6).y1-(this||_global$6).y0)*n;return{x:(this||_global$6).x0+e,y:(this||_global$6).y0+r};},T.prototype.getTangentAtLength=function(){var t=Math.sqrt(((this||_global$6).x1-(this||_global$6).x0)*((this||_global$6).x1-(this||_global$6).x0)+((this||_global$6).y1-(this||_global$6).y0)*((this||_global$6).y1-(this||_global$6).y0));return{x:((this||_global$6).x1-(this||_global$6).x0)/t,y:((this||_global$6).y1-(this||_global$6).y0)/t};},T.prototype.getPropertiesAtLength=function(t){var n=this.getPointAtLength(t),e=this.getTangentAtLength();return{x:n.x,y:n.y,tangentX:e.x,tangentY:e.y};};var Sn=function Sn(t){function n(t){if(!t)return null;for(var a,o=Mn(t),s=[0,0],h=[0,0],u=0;u<o.length;u++){"M"===o[u][0]?(s=[o[u][1],o[u][2]],i.push(null)):"m"===o[u][0]?(s=[o[u][1]+s[0],o[u][2]+s[1]],i.push(null)):"L"===o[u][0]?(e+=Math.sqrt(Math.pow(s[0]-o[u][1],2)+Math.pow(s[1]-o[u][2],2)),i.push(new En(s[0],o[u][1],s[1],o[u][2])),s=[o[u][1],o[u][2]]):"l"===o[u][0]?(e+=Math.sqrt(Math.pow(o[u][1],2)+Math.pow(o[u][2],2)),i.push(new En(s[0],o[u][1]+s[0],s[1],o[u][2]+s[1])),s=[o[u][1]+s[0],o[u][2]+s[1]]):"H"===o[u][0]?(e+=Math.abs(s[0]-o[u][1]),i.push(new En(s[0],o[u][1],s[1],s[1])),s[0]=o[u][1]):"h"===o[u][0]?(e+=Math.abs(o[u][1]),i.push(new En(s[0],s[0]+o[u][1],s[1],s[1])),s[0]=o[u][1]+s[0]):"V"===o[u][0]?(e+=Math.abs(s[1]-o[u][1]),i.push(new En(s[0],s[0],s[1],o[u][1])),s[1]=o[u][1]):"v"===o[u][0]?(e+=Math.abs(o[u][1]),i.push(new En(s[0],s[0],s[1],s[1]+o[u][1])),s[1]=o[u][1]+s[1]):"z"===o[u][0]||"Z"===o[u][0]?(e+=Math.sqrt(Math.pow(o[0][1]-s[0],2)+Math.pow(o[0][2]-s[1],2)),i.push(new En(s[0],o[0][1],s[1],o[0][2])),s=[o[0][1],o[0][2]]):"C"===o[u][0]?(a=new bn(s[0],s[1],o[u][1],o[u][2],o[u][3],o[u][4],o[u][5],o[u][6]),e+=a.getTotalLength(),s=[o[u][5],o[u][6]],i.push(a)):"c"===o[u][0]?(a=new bn(s[0],s[1],s[0]+o[u][1],s[1]+o[u][2],s[0]+o[u][3],s[1]+o[u][4],s[0]+o[u][5],s[1]+o[u][6]),e+=a.getTotalLength(),s=[o[u][5]+s[0],o[u][6]+s[1]],i.push(a)):"S"===o[u][0]?(a=u>0&&["C","c","S","s"].indexOf(o[u-1][0])>-1?new bn(s[0],s[1],2*s[0]-o[u-1][o[u-1].length-4],2*s[1]-o[u-1][o[u-1].length-3],o[u][1],o[u][2],o[u][3],o[u][4]):new bn(s[0],s[1],s[0],s[1],o[u][1],o[u][2],o[u][3],o[u][4]),e+=a.getTotalLength(),s=[o[u][3],o[u][4]],i.push(a)):"s"===o[u][0]?(a=u>0&&["C","c","S","s"].indexOf(o[u-1][0])>-1?new bn(s[0],s[1],s[0]+a.d.x-a.c.x,s[1]+a.d.y-a.c.y,s[0]+o[u][1],s[1]+o[u][2],s[0]+o[u][3],s[1]+o[u][4]):new bn(s[0],s[1],s[0],s[1],s[0]+o[u][1],s[1]+o[u][2],s[0]+o[u][3],s[1]+o[u][4]),e+=a.getTotalLength(),s=[o[u][3]+s[0],o[u][4]+s[1]],i.push(a)):"Q"===o[u][0]?(a=new bn(s[0],s[1],o[u][1],o[u][2],o[u][3],o[u][4]),e+=a.getTotalLength(),i.push(a),s=[o[u][3],o[u][4]],h=[o[u][1],o[u][2]]):"q"===o[u][0]?(a=new bn(s[0],s[1],s[0]+o[u][1],s[1]+o[u][2],s[0]+o[u][3],s[1]+o[u][4]),e+=a.getTotalLength(),h=[s[0]+o[u][1],s[1]+o[u][2]],s=[o[u][3]+s[0],o[u][4]+s[1]],i.push(a)):"T"===o[u][0]?(a=u>0&&["Q","q","T","t"].indexOf(o[u-1][0])>-1?new bn(s[0],s[1],2*s[0]-h[0],2*s[1]-h[1],o[u][1],o[u][2]):new En(s[0],o[u][1],s[1],o[u][2]),i.push(a),e+=a.getTotalLength(),h=[2*s[0]-h[0],2*s[1]-h[1]],s=[o[u][1],o[u][2]]):"t"===o[u][0]?(a=u>0&&["Q","q","T","t"].indexOf(o[u-1][0])>-1?new bn(s[0],s[1],2*s[0]-h[0],2*s[1]-h[1],s[0]+o[u][1],s[1]+o[u][2]):new En(s[0],s[0]+o[u][1],s[1],s[1]+o[u][2]),e+=a.getTotalLength(),h=[2*s[0]-h[0],2*s[1]-h[1]],s=[o[u][1]+s[0],o[u][2]+s[0]],i.push(a)):"A"===o[u][0]?(a=new _n(s[0],s[1],o[u][1],o[u][2],o[u][3],o[u][4],o[u][5],o[u][6],o[u][7]),e+=a.getTotalLength(),s=[o[u][6],o[u][7]],i.push(a)):"a"===o[u][0]&&(a=new _n(s[0],s[1],o[u][1],o[u][2],o[u][3],o[u][4],o[u][5],s[0]+o[u][6],s[1]+o[u][7]),e+=a.getTotalLength(),s=[s[0]+o[u][6],s[1]+o[u][7]],i.push(a)),r.push(e);}return n;}var e=0,r=[],i=[];n.getTotalLength=function(){return e;},n.getPointAtLength=function(t){var n=a(t);return i[n.i].getPointAtLength(n.fraction);},n.getTangentAtLength=function(t){var n=a(t);return i[n.i].getTangentAtLength(n.fraction);},n.getPropertiesAtLength=function(t){var n=a(t);return i[n.i].getPropertiesAtLength(n.fraction);};var a=function a(t){t<0?t=0:t>e&&(t=e);for(var n=r.length-1;r[n]>=t&&r[n]>0;){n--;}return n++,{fraction:t-r[n-1],i:n};};return n(t);},Cn="All shapes must be supplied as arrays of [x, y] points or an SVG path string (https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d).\nExample valid ways of supplying a shape would be:\n[[0, 0], [10, 0], [10, 10]]\n\"M0,0 L10,0 L10,10Z\"\n",Zn="flubber.all() expects two arrays of equal length as arguments. Each element in both arrays should be an array of [x, y] points or an SVG path string (https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d).",Tn=function Tn(t,n){for(var e,r,i,a=t.length,o=1/0,s=0;s<a;s++){!function(i){r=0,n.forEach(function(n,e){var o=F(t[(i+e)%a],n);r+=o*o;}),r<o&&(o=r,e=i);}(s);}e&&(i=t.splice(0,e),t.splice.apply(t,[t.length,0].concat(i)));},Fn=function Fn(t,n,e){void 0===e&&(e={});var r=e.maxSegmentLength;void 0===r&&(r=10);var i=e.string;void 0===i&&(i=!0);var a=J(t,r),o=J(n,r),s=tt(a,o,i);return!i||"string"!=typeof t&&"string"!=typeof n?s:function(e){return e<0.0001&&"string"==typeof t?t:1-e<0.0001&&"string"==typeof n?n:s(e);};},zn=nt;nt.deviation=function(t,n,e,r){var i=n&&n.length,a=i?n[0]*e:t.length,o=Math.abs(Et(t,0,a,e));if(i)for(var s=0,h=n.length;s<h;s++){var u=n[s]*e,c=s<h-1?n[s+1]*e:t.length;o-=Math.abs(Et(t,u,c,e));}var f=0;for(s=0;s<r.length;s+=3){var l=r[s]*e,p=r[s+1]*e,g=r[s+2]*e;f+=Math.abs((t[l]-t[g])*(t[p+1]-t[l+1])-(t[l]-t[p])*(t[g+1]-t[l+1]));}return 0===o&&0===f?0:Math.abs((f-o)/o);},nt.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++){for(var o=0;o<n;o++){e.vertices.push(t[i][a][o]);}}i>0&&(r+=t[i-1].length,e.holes.push(r));}return e;};var jn=function jn(t){return t;},In=function In(t){if(null==t)return jn;var n,e,r=t.scale[0],i=t.scale[1],a=t.translate[0],o=t.translate[1];return function(t,s){s||(n=e=0);var h=2,u=t.length,c=new Array(u);for(c[0]=(n+=t[0])*r+a,c[1]=(e+=t[1])*i+o;h<u;){c[h]=t[h],++h;}return c;};},Vn=function Vn(t,n){for(var e,r=t.length,i=r-n;i<--r;){e=t[i],t[i++]=t[r],t[r]=e;}},Xn=function Xn(t,n){return"GeometryCollection"===n.type?{type:"FeatureCollection",features:n.geometries.map(function(n){return St(t,n);})}:St(t,n);},Yn=function Yn(t,n){function e(n){var e,r=t.arcs[n<0?~n:n],i=r[0];return t.transform?(e=[0,0],r.forEach(function(t){e[0]+=t[0],e[1]+=t[1];})):e=r[r.length-1],n<0?[e,i]:[i,e];}function r(t,n){for(var e in t){var r=t[e];delete n[r.start],delete r.start,delete r.end,r.forEach(function(t){i[t<0?~t:t]=1;}),s.push(r);}}var i={},a={},o={},s=[],h=-1;return n.forEach(function(e,r){var i,a=t.arcs[e<0?~e:e];a.length<3&&!a[1][0]&&!a[1][1]&&(i=n[++h],n[h]=e,n[r]=i);}),n.forEach(function(t){var n,r,i=e(t),s=i[0],h=i[1];if(n=o[s]){if(delete o[n.end],n.push(t),n.end=h,r=a[h]){delete a[r.start];var u=r===n?n:n.concat(r);a[u.start=n.start]=o[u.end=r.end]=u;}else a[n.start]=o[n.end]=n;}else if(n=a[h]){if(delete a[n.start],n.unshift(t),n.start=s,r=o[s]){delete o[r.end];var c=r===n?n:r.concat(n);a[c.start=r.start]=o[c.end=n.end]=c;}else a[n.start]=o[n.end]=n;}else n=[t],a[n.start=s]=o[n.end=h]=n;}),r(o,a),r(a,o),n.forEach(function(t){i[t<0?~t:t]||s.push([t]);}),s;},Gn=function Gn(t,n){for(var e=0,r=t.length;e<r;){var i=e+r>>>1;t[i]<n?e=i+1:r=i;}return e;},On=function On(t){function n(t,n){t.forEach(function(t){t<0&&(t=~t);var e=i[t];e?e.push(n):i[t]=[n];});}function e(t,e){t.forEach(function(t){n(t,e);});}function r(t,n){"GeometryCollection"===t.type?t.geometries.forEach(function(t){r(t,n);}):t.type in o&&o[t.type](t.arcs,n);}var i={},a=t.map(function(){return[];}),o={LineString:n,MultiLineString:e,Polygon:e,MultiPolygon:function MultiPolygon(t,n){t.forEach(function(t){e(t,n);});}};t.forEach(r);for(var s in i){for(var h=i[s],u=h.length,c=0;c<u;++c){for(var f=c+1;f<u;++f){var l,p=h[c],g=h[f];(l=a[p])[s=Gn(l,g)]!==g&&l.splice(s,0,g),(l=a[g])[s=Gn(l,p)]!==p&&l.splice(s,0,p);}}}return a;},Dn=function Dn(t,n){return t<n?-1:t>n?1:t>=n?0:NaN;},Hn=function Hn(t){return 1===t.length&&(t=Ft(t)),{left:function left(n,e,r,i){for(null==r&&(r=0),null==i&&(i=n.length);r<i;){var a=r+i>>>1;t(n[a],e)<0?r=a+1:i=a;}return r;},right:function right(n,e,r,i){for(null==r&&(r=0),null==i&&(i=n.length);r<i;){var a=r+i>>>1;t(n[a],e)>0?i=a:r=a+1;}return r;}};},Nn=Hn(Dn),Qn=function Qn(t,n){return jt(zt(It(t),t),n);},Un=function Un(t,n){if(t.length>8)return t.map(function(t,n){return n;});var e=t.map(function(t){return n.map(function(n){return Xt(t,n);});});return Vt(t,n,e);};t.interpolate=Fn,t.separate=Yt,t.combine=Gt,t.interpolateAll=Ot,t.splitPathString=N,t.toPathString=H,t.fromCircle=Ht,t.toCircle=Nt,t.fromRect=Qt,t.toRect=Ut,Object.defineProperty(t,"__esModule",{value:!0});});var exports$$={};/**
       * https://github.com/gre/bezier-easing
       * BezierEasing - use bezier curve for transition easing function
       * by Gatan Renaudeau 2014 - 2015  MIT License
       */ // These values are established by empiricism with tests (tradeoff: performance VS precision)
var NEWTON_ITERATIONS=4;var NEWTON_MIN_SLOPE=0.001;var SUBDIVISION_PRECISION=1e-7;var SUBDIVISION_MAX_ITERATIONS=10;var kSplineTableSize=11;var kSampleStepSize=1/(kSplineTableSize-1);var float32ArraySupported=typeof Float32Array==="function";function A(aA1,aA2){return 1-3*aA2+3*aA1;}function B(aA1,aA2){return 3*aA2-6*aA1;}function C(aA1){return 3*aA1;}// Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.
function calcBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT;}// Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.
function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1);}function binarySubdivide(aX,aA,aB,mX1,mX2){var currentX,currentT,i=0;do{currentT=aA+(aB-aA)/2;currentX=calcBezier(currentT,mX1,mX2)-aX;if(currentX>0){aB=currentT;}else{aA=currentT;}}while(Math.abs(currentX)>SUBDIVISION_PRECISION&&++i<SUBDIVISION_MAX_ITERATIONS);return currentT;}function newtonRaphsonIterate(aX,aGuessT,mX1,mX2){for(var i=0;i<NEWTON_ITERATIONS;++i){var currentSlope=getSlope(aGuessT,mX1,mX2);if(currentSlope===0){return aGuessT;}var currentX=calcBezier(aGuessT,mX1,mX2)-aX;aGuessT-=currentX/currentSlope;}return aGuessT;}function LinearEasing(x){return x;}exports$$=function bezier(mX1,mY1,mX2,mY2){if(!(0<=mX1&&mX1<=1&&0<=mX2&&mX2<=1)){throw new Error("bezier x values must be in [0, 1] range");}if(mX1===mY1&&mX2===mY2){return LinearEasing;}// Precompute samples table
var sampleValues=float32ArraySupported?new Float32Array(kSplineTableSize):new Array(kSplineTableSize);for(var i=0;i<kSplineTableSize;++i){sampleValues[i]=calcBezier(i*kSampleStepSize,mX1,mX2);}function getTForX(aX){var intervalStart=0;var currentSample=1;var lastSample=kSplineTableSize-1;for(;currentSample!==lastSample&&sampleValues[currentSample]<=aX;++currentSample){intervalStart+=kSampleStepSize;}--currentSample;// Interpolate to provide an initial guess for t
var dist=(aX-sampleValues[currentSample])/(sampleValues[currentSample+1]-sampleValues[currentSample]);var guessForT=intervalStart+dist*kSampleStepSize;var initialSlope=getSlope(guessForT,mX1,mX2);if(initialSlope>=NEWTON_MIN_SLOPE){return newtonRaphsonIterate(aX,guessForT,mX1,mX2);}else if(initialSlope===0){return guessForT;}else{return binarySubdivide(aX,intervalStart,intervalStart+kSampleStepSize,mX1,mX2);}}return function BezierEasing(x){// Because JavaScript number are imprecise, we should guarantee the extremes are right.
if(x===0){return 0;}if(x===1){return 1;}return calcBezier(getTForX(x),mY1,mY2);};};var exports$1$j=exports$$;var _global$7=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;// Copyright 2014 Google Inc. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
//     You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//     See the License for the specific language governing permissions and
// limitations under the License.
!function(){var a={},b={};!function(a,b){function c(a){if("number"==typeof a)return a;var b={};for(var c in a){b[c]=a[c];}return b;}function d(){(this||_global$7)._delay=0,(this||_global$7)._endDelay=0,(this||_global$7)._fill="none",(this||_global$7)._iterationStart=0,(this||_global$7)._iterations=1,(this||_global$7)._duration=0,(this||_global$7)._playbackRate=1,(this||_global$7)._direction="normal",(this||_global$7)._easing="linear",(this||_global$7)._easingFunction=x;}function e(){return a.isDeprecated("Invalid timing inputs","2016-03-02","TypeError exceptions will be thrown instead.",!0);}function f(b,c,e){var f=new d();return c&&(f.fill="both",f.duration="auto"),"number"!=typeof b||isNaN(b)?void 0!==b&&Object.getOwnPropertyNames(b).forEach(function(c){if("auto"!=b[c]){if(("number"==typeof f[c]||"duration"==c)&&("number"!=typeof b[c]||isNaN(b[c])))return;if("fill"==c&&-1==v.indexOf(b[c]))return;if("direction"==c&&-1==w.indexOf(b[c]))return;if("playbackRate"==c&&1!==b[c]&&a.isDeprecated("AnimationEffectTiming.playbackRate","2014-11-28","Use Animation.playbackRate instead."))return;f[c]=b[c];}}):f.duration=b,f;}function g(a){return"number"==typeof a&&(a=isNaN(a)?{duration:0}:{duration:a}),a;}function h(b,c){return b=a.numericTimingToObject(b),f(b,c);}function i(a,b,c,d){return a<0||a>1||c<0||c>1?x:function(e){function f(a,b,c){return 3*a*(1-c)*(1-c)*c+3*b*(1-c)*c*c+c*c*c;}if(e<=0){var g=0;return a>0?g=b/a:!b&&c>0&&(g=d/c),g*e;}if(e>=1){var h=0;return c<1?h=(d-1)/(c-1):1==c&&a<1&&(h=(b-1)/(a-1)),1+h*(e-1);}for(var i=0,j=1;i<j;){var k=(i+j)/2,l=f(a,c,k);if(Math.abs(e-l)<0.00001)return f(b,d,k);l<e?i=k:j=k;}return f(b,d,k);};}function j(a,b){return function(c){if(c>=1)return 1;var d=1/a;return(c+=b*d)-c%d;};}function k(a){C||(C=document.createElement("div").style),C.animationTimingFunction="",C.animationTimingFunction=a;var b=C.animationTimingFunction;if(""==b&&e())throw new TypeError(a+" is not a valid value for easing");return b;}function l(a){if("linear"==a)return x;var b=E.exec(a);if(b)return i.apply(this||_global$7,b.slice(1).map(Number));var c=F.exec(a);if(c)return j(Number(c[1]),A);var d=G.exec(a);return d?j(Number(d[1]),{start:y,middle:z,end:A}[d[2]]):B[a]||x;}function m(a){return Math.abs(n(a)/a.playbackRate);}function n(a){return 0===a.duration||0===a.iterations?0:a.duration*a.iterations;}function o(a,b,c){if(null==b)return H;var d=c.delay+a+c.endDelay;return b<Math.min(c.delay,d)?I:b>=Math.min(c.delay+a,d)?J:K;}function p(a,b,c,d,e){switch(d){case I:return"backwards"==b||"both"==b?0:null;case K:return c-e;case J:return"forwards"==b||"both"==b?a:null;case H:return null;}}function q(a,b,c,d,e){var f=e;return 0===a?b!==I&&(f+=c):f+=d/a,f;}function r(a,b,c,d,e,f){var g=a===1/0?b%1:a%1;return 0!==g||c!==J||0===d||0===e&&0!==f||(g=1),g;}function s(a,b,c,d){return a===J&&b===1/0?1/0:1===c?Math.floor(d)-1:Math.floor(d);}function t(a,b,c){var d=a;if("normal"!==a&&"reverse"!==a){var e=b;"alternate-reverse"===a&&(e+=1),d="normal",e!==1/0&&e%2!=0&&(d="reverse");}return"normal"===d?c:1-c;}function u(a,b,c){var d=o(a,b,c),e=p(a,c.fill,b,d,c.delay);if(null===e)return null;var f=q(c.duration,d,c.iterations,e,c.iterationStart),g=r(f,c.iterationStart,d,c.iterations,e,c.duration),h=s(d,c.iterations,g,f),i=t(c.direction,h,g);return c._easingFunction(i);}var v="backwards|forwards|both|none".split("|"),w="reverse|alternate|alternate-reverse".split("|"),x=function x(a){return a;};d.prototype={_setMember:function _setMember(b,c){(this||_global$7)["_"+b]=c,(this||_global$7)._effect&&((this||_global$7)._effect._timingInput[b]=c,(this||_global$7)._effect._timing=a.normalizeTimingInput((this||_global$7)._effect._timingInput),(this||_global$7)._effect.activeDuration=a.calculateActiveDuration((this||_global$7)._effect._timing),(this||_global$7)._effect._animation&&(this||_global$7)._effect._animation._rebuildUnderlyingAnimation());},get playbackRate(){return(this||_global$7)._playbackRate;},set delay(a){this._setMember("delay",a);},get delay(){return(this||_global$7)._delay;},set endDelay(a){this._setMember("endDelay",a);},get endDelay(){return(this||_global$7)._endDelay;},set fill(a){this._setMember("fill",a);},get fill(){return(this||_global$7)._fill;},set iterationStart(a){if((isNaN(a)||a<0)&&e())throw new TypeError("iterationStart must be a non-negative number, received: "+a);this._setMember("iterationStart",a);},get iterationStart(){return(this||_global$7)._iterationStart;},set duration(a){if("auto"!=a&&(isNaN(a)||a<0)&&e())throw new TypeError("duration must be non-negative or auto, received: "+a);this._setMember("duration",a);},get duration(){return(this||_global$7)._duration;},set direction(a){this._setMember("direction",a);},get direction(){return(this||_global$7)._direction;},set easing(a){(this||_global$7)._easingFunction=l(k(a)),this._setMember("easing",a);},get easing(){return(this||_global$7)._easing;},set iterations(a){if((isNaN(a)||a<0)&&e())throw new TypeError("iterations must be non-negative, received: "+a);this._setMember("iterations",a);},get iterations(){return(this||_global$7)._iterations;}};var y=1,z=0.5,A=0,B={ease:i(0.25,0.1,0.25,1),"ease-in":i(0.42,0,1,1),"ease-out":i(0,0,0.58,1),"ease-in-out":i(0.42,0,0.58,1),"step-start":j(1,y),"step-middle":j(1,z),"step-end":j(1,A)},C=null,D="\\s*(-?\\d+\\.?\\d*|-?\\.\\d+)\\s*",E=new RegExp("cubic-bezier\\("+D+","+D+","+D+","+D+"\\)"),F=/steps\(\s*(\d+)\s*\)/,G=/steps\(\s*(\d+)\s*,\s*(start|middle|end)\s*\)/,H=0,I=1,J=2,K=3;a.cloneTimingInput=c,a.makeTiming=f,a.numericTimingToObject=g,a.normalizeTimingInput=h,a.calculateActiveDuration=m,a.calculateIterationProgress=u,a.calculatePhase=o,a.normalizeEasing=k,a.parseEasingFunction=l;}(a),function(a,b){function c(a,b){return a in k?k[a][b]||b:b;}function d(a){return"display"===a||0===a.lastIndexOf("animation",0)||0===a.lastIndexOf("transition",0);}function e(a,b,e){if(!d(a)){var f=h[a];if(f){i.style[a]=b;for(var g in f){var j=f[g],k=i.style[j];e[j]=c(j,k);}}else e[a]=c(a,b);}}function f(a){var b=[];for(var c in a){if(!(c in["easing","offset","composite"])){var d=a[c];Array.isArray(d)||(d=[d]);for(var e,f=d.length,g=0;g<f;g++){e={},e.offset="offset"in a?a.offset:1==f?1:g/(f-1),"easing"in a&&(e.easing=a.easing),"composite"in a&&(e.composite=a.composite),e[c]=d[g],b.push(e);}}}return b.sort(function(a,b){return a.offset-b.offset;}),b;}function g(b){function c(){var a=d.length;null==d[a-1].offset&&(d[a-1].offset=1),a>1&&null==d[0].offset&&(d[0].offset=0);for(var b=0,c=d[0].offset,e=1;e<a;e++){var f=d[e].offset;if(null!=f){for(var g=1;g<e-b;g++){d[b+g].offset=c+(f-c)*g/(e-b);}b=e,c=f;}}}if(null==b)return[];window.Symbol&&Symbol.iterator&&Array.prototype.from&&b[Symbol.iterator]&&(b=Array.from(b)),Array.isArray(b)||(b=f(b));for(var d=b.map(function(b){var c={};for(var d in b){var f=b[d];if("offset"==d){if(null!=f){if(f=Number(f),!isFinite(f))throw new TypeError("Keyframe offsets must be numbers.");if(f<0||f>1)throw new TypeError("Keyframe offsets must be between 0 and 1.");}}else if("composite"==d){if("add"==f||"accumulate"==f)throw{type:DOMException.NOT_SUPPORTED_ERR,name:"NotSupportedError",message:"add compositing is not supported"};if("replace"!=f)throw new TypeError("Invalid composite mode "+f+".");}else f="easing"==d?a.normalizeEasing(f):""+f;e(d,f,c);}return void 0==c.offset&&(c.offset=null),void 0==c.easing&&(c.easing="linear"),c;}),g=!0,h=-1/0,i=0;i<d.length;i++){var j=d[i].offset;if(null!=j){if(j<h)throw new TypeError("Keyframes are not loosely sorted by offset. Sort or specify offsets.");h=j;}else g=!1;}return d=d.filter(function(a){return a.offset>=0&&a.offset<=1;}),g||c(),d;}var h={background:["backgroundImage","backgroundPosition","backgroundSize","backgroundRepeat","backgroundAttachment","backgroundOrigin","backgroundClip","backgroundColor"],border:["borderTopColor","borderTopStyle","borderTopWidth","borderRightColor","borderRightStyle","borderRightWidth","borderBottomColor","borderBottomStyle","borderBottomWidth","borderLeftColor","borderLeftStyle","borderLeftWidth"],borderBottom:["borderBottomWidth","borderBottomStyle","borderBottomColor"],borderColor:["borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"],borderLeft:["borderLeftWidth","borderLeftStyle","borderLeftColor"],borderRadius:["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],borderRight:["borderRightWidth","borderRightStyle","borderRightColor"],borderTop:["borderTopWidth","borderTopStyle","borderTopColor"],borderWidth:["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],flex:["flexGrow","flexShrink","flexBasis"],font:["fontFamily","fontSize","fontStyle","fontVariant","fontWeight","lineHeight"],margin:["marginTop","marginRight","marginBottom","marginLeft"],outline:["outlineColor","outlineStyle","outlineWidth"],padding:["paddingTop","paddingRight","paddingBottom","paddingLeft"]},i=document.createElementNS("http://www.w3.org/1999/xhtml","div"),j={thin:"1px",medium:"3px",thick:"5px"},k={borderBottomWidth:j,borderLeftWidth:j,borderRightWidth:j,borderTopWidth:j,fontSize:{"xx-small":"60%","x-small":"75%",small:"89%",medium:"100%",large:"120%","x-large":"150%","xx-large":"200%"},fontWeight:{normal:"400",bold:"700"},outlineWidth:j,textShadow:{none:"0px 0px 0px transparent"},boxShadow:{none:"0px 0px 0px 0px transparent"}};a.convertToArrayForm=f,a.normalizeKeyframes=g;}(a),function(a){var b={};a.isDeprecated=function(a,c,d,e){var f=e?"are":"is",g=new Date(),h=new Date(c);return h.setMonth(h.getMonth()+3),!(g<h&&(a in b||console.warn("Web Animations: "+a+" "+f+" deprecated and will stop working on "+h.toDateString()+". "+d),b[a]=!0,1));},a.deprecated=function(b,c,d,e){var f=e?"are":"is";if(a.isDeprecated(b,c,d,e))throw new Error(b+" "+f+" no longer supported. "+d);};}(a),function(){if(document.documentElement.animate){var c=document.documentElement.animate([],0),d=!0;if(c&&(d=!1,"play|currentTime|pause|reverse|playbackRate|cancel|finish|startTime|playState".split("|").forEach(function(a){void 0===c[a]&&(d=!0);})),!d)return;}!function(a,b,c){function d(a){for(var b={},c=0;c<a.length;c++){for(var d in a[c]){if("offset"!=d&&"easing"!=d&&"composite"!=d){var e={offset:a[c].offset,easing:a[c].easing,value:a[c][d]};b[d]=b[d]||[],b[d].push(e);}}}for(var f in b){var g=b[f];if(0!=g[0].offset||1!=g[g.length-1].offset)throw{type:DOMException.NOT_SUPPORTED_ERR,name:"NotSupportedError",message:"Partial keyframes are not supported"};}return b;}function e(c){var d=[];for(var e in c){for(var f=c[e],g=0;g<f.length-1;g++){var h=g,i=g+1,j=f[h].offset,k=f[i].offset,l=j,m=k;0==g&&(l=-1/0,0==k&&(i=h)),g==f.length-2&&(m=1/0,1==j&&(h=i)),d.push({applyFrom:l,applyTo:m,startOffset:f[h].offset,endOffset:f[i].offset,easingFunction:a.parseEasingFunction(f[h].easing),property:e,interpolation:b.propertyInterpolation(e,f[h].value,f[i].value)});}}return d.sort(function(a,b){return a.startOffset-b.startOffset;}),d;}b.convertEffectInput=function(c){var f=a.normalizeKeyframes(c),g=d(f),h=e(g);return function(a,c){if(null!=c)h.filter(function(a){return c>=a.applyFrom&&c<a.applyTo;}).forEach(function(d){var e=c-d.startOffset,f=d.endOffset-d.startOffset,g=0==f?0:d.easingFunction(e/f);b.apply(a,d.property,d.interpolation(g));});else for(var d in g){"offset"!=d&&"easing"!=d&&"composite"!=d&&b.clear(a,d);}};};}(a,b),function(a,b,c){function d(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase();});}function e(a,b,c){h[c]=h[c]||[],h[c].push([a,b]);}function f(a,b,c){for(var f=0;f<c.length;f++){e(a,b,d(c[f]));}}function g(c,e,f){var g=c;/-/.test(c)&&!a.isDeprecated("Hyphenated property names","2016-03-22","Use camelCase instead.",!0)&&(g=d(c)),"initial"!=e&&"initial"!=f||("initial"==e&&(e=i[g]),"initial"==f&&(f=i[g]));for(var j=e==f?[]:h[g],k=0;j&&k<j.length;k++){var l=j[k][0](e),m=j[k][0](f);if(void 0!==l&&void 0!==m){var n=j[k][1](l,m);if(n){var o=b.Interpolation.apply(null,n);return function(a){return 0==a?e:1==a?f:o(a);};}}}return b.Interpolation(!1,!0,function(a){return a?f:e;});}var h={};b.addPropertiesHandler=f;var i={backgroundColor:"transparent",backgroundPosition:"0% 0%",borderBottomColor:"currentColor",borderBottomLeftRadius:"0px",borderBottomRightRadius:"0px",borderBottomWidth:"3px",borderLeftColor:"currentColor",borderLeftWidth:"3px",borderRightColor:"currentColor",borderRightWidth:"3px",borderSpacing:"2px",borderTopColor:"currentColor",borderTopLeftRadius:"0px",borderTopRightRadius:"0px",borderTopWidth:"3px",bottom:"auto",clip:"rect(0px, 0px, 0px, 0px)",color:"black",fontSize:"100%",fontWeight:"400",height:"auto",left:"auto",letterSpacing:"normal",lineHeight:"120%",marginBottom:"0px",marginLeft:"0px",marginRight:"0px",marginTop:"0px",maxHeight:"none",maxWidth:"none",minHeight:"0px",minWidth:"0px",opacity:"1.0",outlineColor:"invert",outlineOffset:"0px",outlineWidth:"3px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",paddingTop:"0px",right:"auto",strokeDasharray:"none",strokeDashoffset:"0px",textIndent:"0px",textShadow:"0px 0px 0px transparent",top:"auto",transform:"",verticalAlign:"0px",visibility:"visible",width:"auto",wordSpacing:"normal",zIndex:"auto"};b.propertyInterpolation=g;}(a,b),function(a,b,c){function d(b){var c=a.calculateActiveDuration(b),d=function d(_d2){return a.calculateIterationProgress(c,_d2,b);};return d._totalDuration=b.delay+c+b.endDelay,d;}b.KeyframeEffect=function(c,e,f,g){var h,i=d(a.normalizeTimingInput(f)),j=b.convertEffectInput(e),k=function k(){j(c,h);};return k._update=function(a){return null!==(h=i(a));},k._clear=function(){j(c,null);},k._hasSameTarget=function(a){return c===a;},k._target=c,k._totalDuration=i._totalDuration,k._id=g,k;};}(a,b),function(a,b){function c(a,b){return!(!b.namespaceURI||-1==b.namespaceURI.indexOf("/svg"))&&(g in a||(a[g]=/Trident|MSIE|IEMobile|Edge|Android 4/i.test(a.navigator.userAgent)),a[g]);}function d(a,b,c){c.enumerable=!0,c.configurable=!0,Object.defineProperty(a,b,c);}function e(a){(this||_global$7)._element=a,(this||_global$7)._surrogateStyle=document.createElementNS("http://www.w3.org/1999/xhtml","div").style,(this||_global$7)._style=a.style,(this||_global$7)._length=0,(this||_global$7)._isAnimatedProperty={},(this||_global$7)._updateSvgTransformAttr=c(window,a),(this||_global$7)._savedTransformAttr=null;for(var b=0;b<(this||_global$7)._style.length;b++){var d=(this||_global$7)._style[b];(this||_global$7)._surrogateStyle[d]=(this||_global$7)._style[d];}this._updateIndices();}function f(a){if(!a._webAnimationsPatchedStyle){var b=new e(a);try{d(a,"style",{get:function get(){return b;}});}catch(b){a.style._set=function(b,c){a.style[b]=c;},a.style._clear=function(b){a.style[b]="";};}a._webAnimationsPatchedStyle=a.style;}}var g="_webAnimationsUpdateSvgTransformAttr",h={cssText:1,length:1,parentRule:1},i={getPropertyCSSValue:1,getPropertyPriority:1,getPropertyValue:1,item:1,removeProperty:1,setProperty:1},j={removeProperty:1,setProperty:1};e.prototype={get cssText(){return(this||_global$7)._surrogateStyle.cssText;},set cssText(a){for(var b={},c=0;c<(this||_global$7)._surrogateStyle.length;c++){b[(this||_global$7)._surrogateStyle[c]]=!0;}(this||_global$7)._surrogateStyle.cssText=a,this._updateIndices();for(var c=0;c<(this||_global$7)._surrogateStyle.length;c++){b[(this||_global$7)._surrogateStyle[c]]=!0;}for(var d in b){(this||_global$7)._isAnimatedProperty[d]||(this||_global$7)._style.setProperty(d,(this||_global$7)._surrogateStyle.getPropertyValue(d));}},get length(){return(this||_global$7)._surrogateStyle.length;},get parentRule(){return(this||_global$7)._style.parentRule;},_updateIndices:function _updateIndices(){for(;(this||_global$7)._length<(this||_global$7)._surrogateStyle.length;){Object.defineProperty(this||_global$7,(this||_global$7)._length,{configurable:!0,enumerable:!1,get:function(a){return function(){return(this||_global$7)._surrogateStyle[a];};}((this||_global$7)._length)}),(this||_global$7)._length++;}for(;(this||_global$7)._length>(this||_global$7)._surrogateStyle.length;){(this||_global$7)._length--,Object.defineProperty(this||_global$7,(this||_global$7)._length,{configurable:!0,enumerable:!1,value:void 0});}},_set:function _set(b,c){(this||_global$7)._style[b]=c,(this||_global$7)._isAnimatedProperty[b]=!0,(this||_global$7)._updateSvgTransformAttr&&"transform"==a.unprefixedPropertyName(b)&&(null==(this||_global$7)._savedTransformAttr&&((this||_global$7)._savedTransformAttr=(this||_global$7)._element.getAttribute("transform")),(this||_global$7)._element.setAttribute("transform",a.transformToSvgMatrix(c)));},_clear:function _clear(b){(this||_global$7)._style[b]=(this||_global$7)._surrogateStyle[b],(this||_global$7)._updateSvgTransformAttr&&"transform"==a.unprefixedPropertyName(b)&&((this||_global$7)._savedTransformAttr?(this||_global$7)._element.setAttribute("transform",(this||_global$7)._savedTransformAttr):(this||_global$7)._element.removeAttribute("transform"),(this||_global$7)._savedTransformAttr=null),delete(this||_global$7)._isAnimatedProperty[b];}};for(var k in i){e.prototype[k]=function(a,b){return function(){var c=(this||_global$7)._surrogateStyle[a].apply((this||_global$7)._surrogateStyle,arguments);return b&&((this||_global$7)._isAnimatedProperty[arguments[0]]||(this||_global$7)._style[a].apply((this||_global$7)._style,arguments),this._updateIndices()),c;};}(k,k in j);}for(var l in document.documentElement.style){l in h||l in i||function(a){d(e.prototype,a,{get:function get(){return(this||_global$7)._surrogateStyle[a];},set:function set(b){(this||_global$7)._surrogateStyle[a]=b,this._updateIndices(),(this||_global$7)._isAnimatedProperty[a]||((this||_global$7)._style[a]=b);}});}(l);}a.apply=function(b,c,d){f(b),b.style._set(a.propertyName(c),d);},a.clear=function(b,c){b._webAnimationsPatchedStyle&&b.style._clear(a.propertyName(c));};}(b),function(a){window.Element.prototype.animate=function(b,c){var d="";return c&&c.id&&(d=c.id),a.timeline._play(a.KeyframeEffect(this||_global$7,b,c,d));};}(b),function(a,b){function c(a,b,d){if("number"==typeof a&&"number"==typeof b)return a*(1-d)+b*d;if("boolean"==typeof a&&"boolean"==typeof b)return d<0.5?a:b;if(a.length==b.length){for(var e=[],f=0;f<a.length;f++){e.push(c(a[f],b[f],d));}return e;}throw"Mismatched interpolation arguments "+a+":"+b;}a.Interpolation=function(a,b,d){return function(e){return d(c(a,b,e));};};}(b),function(a,b){function c(a,b,c){return Math.max(Math.min(a,c),b);}function d(b,d,e){var f=a.dot(b,d);f=c(f,-1,1);var g=[];if(1===f)g=b;else for(var h=Math.acos(f),i=1*Math.sin(e*h)/Math.sqrt(1-f*f),j=0;j<4;j++){g.push(b[j]*(Math.cos(e*h)-f*i)+d[j]*i);}return g;}var e=function(){function a(a,b){for(var c=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],d=0;d<4;d++){for(var e=0;e<4;e++){for(var f=0;f<4;f++){c[d][e]+=b[d][f]*a[f][e];}}}return c;}function b(a){return 0==a[0][2]&&0==a[0][3]&&0==a[1][2]&&0==a[1][3]&&0==a[2][0]&&0==a[2][1]&&1==a[2][2]&&0==a[2][3]&&0==a[3][2]&&1==a[3][3];}function c(c,d,e,f,g){for(var h=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],i=0;i<4;i++){h[i][3]=g[i];}for(var i=0;i<3;i++){for(var j=0;j<3;j++){h[3][i]+=c[j]*h[j][i];}}var k=f[0],l=f[1],m=f[2],n=f[3],o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];o[0][0]=1-2*(l*l+m*m),o[0][1]=2*(k*l-m*n),o[0][2]=2*(k*m+l*n),o[1][0]=2*(k*l+m*n),o[1][1]=1-2*(k*k+m*m),o[1][2]=2*(l*m-k*n),o[2][0]=2*(k*m-l*n),o[2][1]=2*(l*m+k*n),o[2][2]=1-2*(k*k+l*l),h=a(h,o);var p=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];e[2]&&(p[2][1]=e[2],h=a(h,p)),e[1]&&(p[2][1]=0,p[2][0]=e[0],h=a(h,p)),e[0]&&(p[2][0]=0,p[1][0]=e[0],h=a(h,p));for(var i=0;i<3;i++){for(var j=0;j<3;j++){h[i][j]*=d[i];}}return b(h)?[h[0][0],h[0][1],h[1][0],h[1][1],h[3][0],h[3][1]]:h[0].concat(h[1],h[2],h[3]);}return c;}();a.composeMatrix=e,a.quat=d;}(b),function(a,b,c){a.sequenceNumber=0;var d=function d(a,b,c){(this||_global$7).target=a,(this||_global$7).currentTime=b,(this||_global$7).timelineTime=c,(this||_global$7).type="finish",(this||_global$7).bubbles=!1,(this||_global$7).cancelable=!1,(this||_global$7).currentTarget=a,(this||_global$7).defaultPrevented=!1,(this||_global$7).eventPhase=Event.AT_TARGET,(this||_global$7).timeStamp=Date.now();};b.Animation=function(b){(this||_global$7).id="",b&&b._id&&((this||_global$7).id=b._id),(this||_global$7)._sequenceNumber=a.sequenceNumber++,(this||_global$7)._currentTime=0,(this||_global$7)._startTime=null,(this||_global$7)._paused=!1,(this||_global$7)._playbackRate=1,(this||_global$7)._inTimeline=!0,(this||_global$7)._finishedFlag=!0,(this||_global$7).onfinish=null,(this||_global$7)._finishHandlers=[],(this||_global$7)._effect=b,(this||_global$7)._inEffect=(this||_global$7)._effect._update(0),(this||_global$7)._idle=!0,(this||_global$7)._currentTimePending=!1;},b.Animation.prototype={_ensureAlive:function _ensureAlive(){(this||_global$7).playbackRate<0&&0===(this||_global$7).currentTime?(this||_global$7)._inEffect=(this||_global$7)._effect._update(-1):(this||_global$7)._inEffect=(this||_global$7)._effect._update((this||_global$7).currentTime),(this||_global$7)._inTimeline||!(this||_global$7)._inEffect&&(this||_global$7)._finishedFlag||((this||_global$7)._inTimeline=!0,b.timeline._animations.push(this||_global$7));},_tickCurrentTime:function _tickCurrentTime(a,b){a!=(this||_global$7)._currentTime&&((this||_global$7)._currentTime=a,(this||_global$7)._isFinished&&!b&&((this||_global$7)._currentTime=(this||_global$7)._playbackRate>0?(this||_global$7)._totalDuration:0),this._ensureAlive());},get currentTime(){return(this||_global$7)._idle||(this||_global$7)._currentTimePending?null:(this||_global$7)._currentTime;},set currentTime(a){a=+a,isNaN(a)||(b.restart(),(this||_global$7)._paused||null==(this||_global$7)._startTime||((this||_global$7)._startTime=(this||_global$7)._timeline.currentTime-a/(this||_global$7)._playbackRate),(this||_global$7)._currentTimePending=!1,(this||_global$7)._currentTime!=a&&((this||_global$7)._idle&&((this||_global$7)._idle=!1,(this||_global$7)._paused=!0),this._tickCurrentTime(a,!0),b.applyDirtiedAnimation(this||_global$7)));},get startTime(){return(this||_global$7)._startTime;},set startTime(a){a=+a,isNaN(a)||(this||_global$7)._paused||(this||_global$7)._idle||((this||_global$7)._startTime=a,this._tickCurrentTime(((this||_global$7)._timeline.currentTime-(this||_global$7)._startTime)*(this||_global$7).playbackRate),b.applyDirtiedAnimation(this||_global$7));},get playbackRate(){return(this||_global$7)._playbackRate;},set playbackRate(a){if(a!=(this||_global$7)._playbackRate){var c=(this||_global$7).currentTime;(this||_global$7)._playbackRate=a,(this||_global$7)._startTime=null,"paused"!=(this||_global$7).playState&&"idle"!=(this||_global$7).playState&&((this||_global$7)._finishedFlag=!1,(this||_global$7)._idle=!1,this._ensureAlive(),b.applyDirtiedAnimation(this||_global$7)),null!=c&&((this||_global$7).currentTime=c);}},get _isFinished(){return!(this||_global$7)._idle&&((this||_global$7)._playbackRate>0&&(this||_global$7)._currentTime>=(this||_global$7)._totalDuration||(this||_global$7)._playbackRate<0&&(this||_global$7)._currentTime<=0);},get _totalDuration(){return(this||_global$7)._effect._totalDuration;},get playState(){return(this||_global$7)._idle?"idle":null==(this||_global$7)._startTime&&!(this||_global$7)._paused&&0!=(this||_global$7).playbackRate||(this||_global$7)._currentTimePending?"pending":(this||_global$7)._paused?"paused":(this||_global$7)._isFinished?"finished":"running";},_rewind:function _rewind(){if((this||_global$7)._playbackRate>=0)(this||_global$7)._currentTime=0;else{if(!((this||_global$7)._totalDuration<1/0))throw new DOMException("Unable to rewind negative playback rate animation with infinite duration","InvalidStateError");(this||_global$7)._currentTime=(this||_global$7)._totalDuration;}},play:function play(){(this||_global$7)._paused=!1,((this||_global$7)._isFinished||(this||_global$7)._idle)&&(this._rewind(),(this||_global$7)._startTime=null),(this||_global$7)._finishedFlag=!1,(this||_global$7)._idle=!1,this._ensureAlive(),b.applyDirtiedAnimation(this||_global$7);},pause:function pause(){(this||_global$7)._isFinished||(this||_global$7)._paused||(this||_global$7)._idle?(this||_global$7)._idle&&(this._rewind(),(this||_global$7)._idle=!1):(this||_global$7)._currentTimePending=!0,(this||_global$7)._startTime=null,(this||_global$7)._paused=!0;},finish:function finish(){(this||_global$7)._idle||((this||_global$7).currentTime=(this||_global$7)._playbackRate>0?(this||_global$7)._totalDuration:0,(this||_global$7)._startTime=(this||_global$7)._totalDuration-(this||_global$7).currentTime,(this||_global$7)._currentTimePending=!1,b.applyDirtiedAnimation(this||_global$7));},cancel:function cancel(){(this||_global$7)._inEffect&&((this||_global$7)._inEffect=!1,(this||_global$7)._idle=!0,(this||_global$7)._paused=!1,(this||_global$7)._finishedFlag=!0,(this||_global$7)._currentTime=0,(this||_global$7)._startTime=null,(this||_global$7)._effect._update(null),b.applyDirtiedAnimation(this||_global$7));},reverse:function reverse(){(this||_global$7).playbackRate*=-1,this.play();},addEventListener:function addEventListener(a,b){"function"==typeof b&&"finish"==a&&(this||_global$7)._finishHandlers.push(b);},removeEventListener:function removeEventListener(a,b){if("finish"==a){var c=(this||_global$7)._finishHandlers.indexOf(b);c>=0&&(this||_global$7)._finishHandlers.splice(c,1);}},_fireEvents:function _fireEvents(a){if((this||_global$7)._isFinished){if(!(this||_global$7)._finishedFlag){var b=new d(this||_global$7,(this||_global$7)._currentTime,a),c=(this||_global$7)._finishHandlers.concat((this||_global$7).onfinish?[(this||_global$7).onfinish]:[]);setTimeout(function(){c.forEach(function(a){a.call(b.target,b);});},0),(this||_global$7)._finishedFlag=!0;}}else(this||_global$7)._finishedFlag=!1;},_tick:function _tick(a,b){(this||_global$7)._idle||(this||_global$7)._paused||(null==(this||_global$7)._startTime?b&&((this||_global$7).startTime=a-(this||_global$7)._currentTime/(this||_global$7).playbackRate):(this||_global$7)._isFinished||this._tickCurrentTime((a-(this||_global$7)._startTime)*(this||_global$7).playbackRate)),b&&((this||_global$7)._currentTimePending=!1,this._fireEvents(a));},get _needsTick(){return(this||_global$7).playState in{pending:1,running:1}||!(this||_global$7)._finishedFlag;},_targetAnimations:function _targetAnimations(){var a=(this||_global$7)._effect._target;return a._activeAnimations||(a._activeAnimations=[]),a._activeAnimations;},_markTarget:function _markTarget(){var a=this._targetAnimations();-1===a.indexOf(this||_global$7)&&a.push(this||_global$7);},_unmarkTarget:function _unmarkTarget(){var a=this._targetAnimations(),b=a.indexOf(this||_global$7);-1!==b&&a.splice(b,1);}};}(a,b),function(a,b,c){function d(a){var b=j;j=[],a<q.currentTime&&(a=q.currentTime),q._animations.sort(e),q._animations=h(a,!0,q._animations)[0],b.forEach(function(b){b[1](a);}),g(),l=void 0;}function e(a,b){return a._sequenceNumber-b._sequenceNumber;}function f(){(this||_global$7)._animations=[],(this||_global$7).currentTime=window.performance&&performance.now?performance.now():0;}function g(){o.forEach(function(a){a();}),o.length=0;}function h(a,c,d){p=!0,n=!1,b.timeline.currentTime=a,m=!1;var e=[],f=[],g=[],h=[];return d.forEach(function(b){b._tick(a,c),b._inEffect?(f.push(b._effect),b._markTarget()):(e.push(b._effect),b._unmarkTarget()),b._needsTick&&(m=!0);var d=b._inEffect||b._needsTick;b._inTimeline=d,d?g.push(b):h.push(b);}),o.push.apply(o,e),o.push.apply(o,f),m&&requestAnimationFrame(function(){}),p=!1,[g,h];}var i=window.requestAnimationFrame,j=[],k=0;window.requestAnimationFrame=function(a){var b=k++;return 0==j.length&&i(d),j.push([b,a]),b;},window.cancelAnimationFrame=function(a){j.forEach(function(b){b[0]==a&&(b[1]=function(){});});},f.prototype={_play:function _play(c){c._timing=a.normalizeTimingInput(c.timing);var d=new b.Animation(c);return d._idle=!1,d._timeline=this||_global$7,(this||_global$7)._animations.push(d),b.restart(),b.applyDirtiedAnimation(d),d;}};var l=void 0,m=!1,n=!1;b.restart=function(){return m||(m=!0,requestAnimationFrame(function(){}),n=!0),n;},b.applyDirtiedAnimation=function(a){if(!p){a._markTarget();var c=a._targetAnimations();c.sort(e),h(b.timeline.currentTime,!1,c.slice())[1].forEach(function(a){var b=q._animations.indexOf(a);-1!==b&&q._animations.splice(b,1);}),g();}};var o=[],p=!1,q=new f();b.timeline=q;}(a,b),function(a,b){function c(a,b){for(var c=0,d=0;d<a.length;d++){c+=a[d]*b[d];}return c;}function d(a,b){return[a[0]*b[0]+a[4]*b[1]+a[8]*b[2]+a[12]*b[3],a[1]*b[0]+a[5]*b[1]+a[9]*b[2]+a[13]*b[3],a[2]*b[0]+a[6]*b[1]+a[10]*b[2]+a[14]*b[3],a[3]*b[0]+a[7]*b[1]+a[11]*b[2]+a[15]*b[3],a[0]*b[4]+a[4]*b[5]+a[8]*b[6]+a[12]*b[7],a[1]*b[4]+a[5]*b[5]+a[9]*b[6]+a[13]*b[7],a[2]*b[4]+a[6]*b[5]+a[10]*b[6]+a[14]*b[7],a[3]*b[4]+a[7]*b[5]+a[11]*b[6]+a[15]*b[7],a[0]*b[8]+a[4]*b[9]+a[8]*b[10]+a[12]*b[11],a[1]*b[8]+a[5]*b[9]+a[9]*b[10]+a[13]*b[11],a[2]*b[8]+a[6]*b[9]+a[10]*b[10]+a[14]*b[11],a[3]*b[8]+a[7]*b[9]+a[11]*b[10]+a[15]*b[11],a[0]*b[12]+a[4]*b[13]+a[8]*b[14]+a[12]*b[15],a[1]*b[12]+a[5]*b[13]+a[9]*b[14]+a[13]*b[15],a[2]*b[12]+a[6]*b[13]+a[10]*b[14]+a[14]*b[15],a[3]*b[12]+a[7]*b[13]+a[11]*b[14]+a[15]*b[15]];}function e(a){var b=a.rad||0;return((a.deg||0)/360+(a.grad||0)/400+(a.turn||0))*(2*Math.PI)+b;}function f(a){switch(a.t){case"rotatex":var b=e(a.d[0]);return[1,0,0,0,0,Math.cos(b),Math.sin(b),0,0,-Math.sin(b),Math.cos(b),0,0,0,0,1];case"rotatey":var b=e(a.d[0]);return[Math.cos(b),0,-Math.sin(b),0,0,1,0,0,Math.sin(b),0,Math.cos(b),0,0,0,0,1];case"rotate":case"rotatez":var b=e(a.d[0]);return[Math.cos(b),Math.sin(b),0,0,-Math.sin(b),Math.cos(b),0,0,0,0,1,0,0,0,0,1];case"rotate3d":var c=a.d[0],d=a.d[1],f=a.d[2],b=e(a.d[3]),g=c*c+d*d+f*f;if(0===g)c=1,d=0,f=0;else if(1!==g){var h=Math.sqrt(g);c/=h,d/=h,f/=h;}var i=Math.sin(b/2),j=i*Math.cos(b/2),k=i*i;return[1-2*(d*d+f*f)*k,2*(c*d*k+f*j),2*(c*f*k-d*j),0,2*(c*d*k-f*j),1-2*(c*c+f*f)*k,2*(d*f*k+c*j),0,2*(c*f*k+d*j),2*(d*f*k-c*j),1-2*(c*c+d*d)*k,0,0,0,0,1];case"scale":return[a.d[0],0,0,0,0,a.d[1],0,0,0,0,1,0,0,0,0,1];case"scalex":return[a.d[0],0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaley":return[1,0,0,0,0,a.d[0],0,0,0,0,1,0,0,0,0,1];case"scalez":return[1,0,0,0,0,1,0,0,0,0,a.d[0],0,0,0,0,1];case"scale3d":return[a.d[0],0,0,0,0,a.d[1],0,0,0,0,a.d[2],0,0,0,0,1];case"skew":var l=e(a.d[0]),m=e(a.d[1]);return[1,Math.tan(m),0,0,Math.tan(l),1,0,0,0,0,1,0,0,0,0,1];case"skewx":var b=e(a.d[0]);return[1,0,0,0,Math.tan(b),1,0,0,0,0,1,0,0,0,0,1];case"skewy":var b=e(a.d[0]);return[1,Math.tan(b),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":var c=a.d[0].px||0,d=a.d[1].px||0;return[1,0,0,0,0,1,0,0,0,0,1,0,c,d,0,1];case"translatex":var c=a.d[0].px||0;return[1,0,0,0,0,1,0,0,0,0,1,0,c,0,0,1];case"translatey":var d=a.d[0].px||0;return[1,0,0,0,0,1,0,0,0,0,1,0,0,d,0,1];case"translatez":f=a.d[0].px||0;return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,f,1];case"translate3d":var c=a.d[0].px||0,d=a.d[1].px||0,f=a.d[2].px||0;return[1,0,0,0,0,1,0,0,0,0,1,0,c,d,f,1];case"perspective":return[1,0,0,0,0,1,0,0,0,0,1,a.d[0].px?-1/a.d[0].px:0,0,0,0,1];case"matrix":return[a.d[0],a.d[1],0,0,a.d[2],a.d[3],0,0,0,0,1,0,a.d[4],a.d[5],0,1];case"matrix3d":return a.d;}}function g(a){return 0===a.length?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:a.map(f).reduce(d);}function h(a){return[i(g(a))];}var i=function(){function a(a){return a[0][0]*a[1][1]*a[2][2]+a[1][0]*a[2][1]*a[0][2]+a[2][0]*a[0][1]*a[1][2]-a[0][2]*a[1][1]*a[2][0]-a[1][2]*a[2][1]*a[0][0]-a[2][2]*a[0][1]*a[1][0];}function b(b){for(var c=1/a(b),d=b[0][0],e=b[0][1],f=b[0][2],g=b[1][0],h=b[1][1],i=b[1][2],j=b[2][0],k=b[2][1],l=b[2][2],m=[[(h*l-i*k)*c,(f*k-e*l)*c,(e*i-f*h)*c,0],[(i*j-g*l)*c,(d*l-f*j)*c,(f*g-d*i)*c,0],[(g*k-h*j)*c,(j*e-d*k)*c,(d*h-e*g)*c,0]],n=[],o=0;o<3;o++){for(var p=0,q=0;q<3;q++){p+=b[3][q]*m[q][o];}n.push(p);}return n.push(1),m.push(n),m;}function d(a){return[[a[0][0],a[1][0],a[2][0],a[3][0]],[a[0][1],a[1][1],a[2][1],a[3][1]],[a[0][2],a[1][2],a[2][2],a[3][2]],[a[0][3],a[1][3],a[2][3],a[3][3]]];}function e(a,b){for(var c=[],d=0;d<4;d++){for(var e=0,f=0;f<4;f++){e+=a[f]*b[f][d];}c.push(e);}return c;}function f(a){var b=g(a);return[a[0]/b,a[1]/b,a[2]/b];}function g(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);}function h(a,b,c,d){return[c*a[0]+d*b[0],c*a[1]+d*b[1],c*a[2]+d*b[2]];}function i(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]];}function j(j){var k=[j.slice(0,4),j.slice(4,8),j.slice(8,12),j.slice(12,16)];if(1!==k[3][3])return null;for(var l=[],m=0;m<4;m++){l.push(k[m].slice());}for(var m=0;m<3;m++){l[m][3]=0;}if(0===a(l))return null;var n,o=[];k[0][3]||k[1][3]||k[2][3]?(o.push(k[0][3]),o.push(k[1][3]),o.push(k[2][3]),o.push(k[3][3]),n=e(o,d(b(l)))):n=[0,0,0,1];var p=k[3].slice(0,3),q=[];q.push(k[0].slice(0,3));var r=[];r.push(g(q[0])),q[0]=f(q[0]);var s=[];q.push(k[1].slice(0,3)),s.push(c(q[0],q[1])),q[1]=h(q[1],q[0],1,-s[0]),r.push(g(q[1])),q[1]=f(q[1]),s[0]/=r[1],q.push(k[2].slice(0,3)),s.push(c(q[0],q[2])),q[2]=h(q[2],q[0],1,-s[1]),s.push(c(q[1],q[2])),q[2]=h(q[2],q[1],1,-s[2]),r.push(g(q[2])),q[2]=f(q[2]),s[1]/=r[2],s[2]/=r[2];var t=i(q[1],q[2]);if(c(q[0],t)<0)for(var m=0;m<3;m++){r[m]*=-1,q[m][0]*=-1,q[m][1]*=-1,q[m][2]*=-1;}var u,v,w=q[0][0]+q[1][1]+q[2][2]+1;return w>0.0001?(u=0.5/Math.sqrt(w),v=[(q[2][1]-q[1][2])*u,(q[0][2]-q[2][0])*u,(q[1][0]-q[0][1])*u,0.25/u]):q[0][0]>q[1][1]&&q[0][0]>q[2][2]?(u=2*Math.sqrt(1+q[0][0]-q[1][1]-q[2][2]),v=[0.25*u,(q[0][1]+q[1][0])/u,(q[0][2]+q[2][0])/u,(q[2][1]-q[1][2])/u]):q[1][1]>q[2][2]?(u=2*Math.sqrt(1+q[1][1]-q[0][0]-q[2][2]),v=[(q[0][1]+q[1][0])/u,0.25*u,(q[1][2]+q[2][1])/u,(q[0][2]-q[2][0])/u]):(u=2*Math.sqrt(1+q[2][2]-q[0][0]-q[1][1]),v=[(q[0][2]+q[2][0])/u,(q[1][2]+q[2][1])/u,0.25*u,(q[1][0]-q[0][1])/u]),[p,r,s,v,n];}return j;}();a.dot=c,a.makeMatrixDecomposition=h,a.transformListToMatrix=g;}(b),function(a){function b(a,b){var c=a.exec(b);if(c)return c=a.ignoreCase?c[0].toLowerCase():c[0],[c,b.substr(c.length)];}function c(a,b){b=b.replace(/^\s*/,"");var c=a(b);if(c)return[c[0],c[1].replace(/^\s*/,"")];}function d(a,d,e){a=c.bind(null,a);for(var f=[];;){var g=a(e);if(!g)return[f,e];if(f.push(g[0]),e=g[1],!(g=b(d,e))||""==g[1])return[f,e];e=g[1];}}function e(a,b){for(var c=0,d=0;d<b.length&&(!/\s|,/.test(b[d])||0!=c);d++){if("("==b[d])c++;else if(")"==b[d]&&(c--,0==c&&d++,c<=0))break;}var e=a(b.substr(0,d));return void 0==e?void 0:[e,b.substr(d)];}function f(a,b){for(var c=a,d=b;c&&d;){c>d?c%=d:d%=c;}return c=a*b/(c+d);}function g(a){return function(b){var c=a(b);return c&&(c[0]=void 0),c;};}function h(a,b){return function(c){return a(c)||[b,c];};}function i(b,c){for(var d=[],e=0;e<b.length;e++){var f=a.consumeTrimmed(b[e],c);if(!f||""==f[0])return;void 0!==f[0]&&d.push(f[0]),c=f[1];}if(""==c)return d;}function j(a,b,c,d,e){for(var g=[],h=[],i=[],j=f(d.length,e.length),k=0;k<j;k++){var l=b(d[k%d.length],e[k%e.length]);if(!l)return;g.push(l[0]),h.push(l[1]),i.push(l[2]);}return[g,h,function(b){var d=b.map(function(a,b){return i[b](a);}).join(c);return a?a(d):d;}];}function k(a,b,c){for(var d=[],e=[],f=[],g=0,h=0;h<c.length;h++){if("function"==typeof c[h]){var i=c[h](a[g],b[g++]);d.push(i[0]),e.push(i[1]),f.push(i[2]);}else!function(a){d.push(!1),e.push(!1),f.push(function(){return c[a];});}(h);}return[d,e,function(a){for(var b="",c=0;c<a.length;c++){b+=f[c](a[c]);}return b;}];}a.consumeToken=b,a.consumeTrimmed=c,a.consumeRepeated=d,a.consumeParenthesised=e,a.ignore=g,a.optional=h,a.consumeList=i,a.mergeNestedRepeated=j.bind(null,null),a.mergeWrappedNestedRepeated=j,a.mergeList=k;}(b),function(a){function b(b){function c(b){var c=a.consumeToken(/^inset/i,b);return c?(d.inset=!0,c):(c=a.consumeLengthOrPercent(b))?(d.lengths.push(c[0]),c):(c=a.consumeColor(b),c?(d.color=c[0],c):void 0);}var d={inset:!1,lengths:[],color:null},e=a.consumeRepeated(c,/^/,b);if(e&&e[0].length)return[d,e[1]];}function c(c){var d=a.consumeRepeated(b,/^,/,c);if(d&&""==d[1])return d[0];}function d(b,c){for(;b.lengths.length<Math.max(b.lengths.length,c.lengths.length);){b.lengths.push({px:0});}for(;c.lengths.length<Math.max(b.lengths.length,c.lengths.length);){c.lengths.push({px:0});}if(b.inset==c.inset&&!!b.color==!!c.color){for(var d,e=[],f=[[],0],g=[[],0],h=0;h<b.lengths.length;h++){var i=a.mergeDimensions(b.lengths[h],c.lengths[h],2==h);f[0].push(i[0]),g[0].push(i[1]),e.push(i[2]);}if(b.color&&c.color){var j=a.mergeColors(b.color,c.color);f[1]=j[0],g[1]=j[1],d=j[2];}return[f,g,function(a){for(var c=b.inset?"inset ":" ",f=0;f<e.length;f++){c+=e[f](a[0][f])+" ";}return d&&(c+=d(a[1])),c;}];}}function e(b,c,d,e){function f(a){return{inset:a,color:[0,0,0,0],lengths:[{px:0},{px:0},{px:0},{px:0}]};}for(var g=[],h=[],i=0;i<d.length||i<e.length;i++){var j=d[i]||f(e[i].inset),k=e[i]||f(d[i].inset);g.push(j),h.push(k);}return a.mergeNestedRepeated(b,c,g,h);}var f=e.bind(null,d,", ");a.addPropertiesHandler(c,f,["box-shadow","text-shadow"]);}(b),function(a,b){function c(a){return a.toFixed(3).replace(/0+$/,"").replace(/\.$/,"");}function d(a,b,c){return Math.min(b,Math.max(a,c));}function e(a){if(/^\s*[-+]?(\d*\.)?\d+\s*$/.test(a))return Number(a);}function f(a,b){return[a,b,c];}function g(a,b){if(0!=a)return i(0,1/0)(a,b);}function h(a,b){return[a,b,function(a){return Math.round(d(1,1/0,a));}];}function i(a,b){return function(e,f){return[e,f,function(e){return c(d(a,b,e));}];};}function j(a){var b=a.trim().split(/\s*[\s,]\s*/);if(0!==b.length){for(var c=[],d=0;d<b.length;d++){var f=e(b[d]);if(void 0===f)return;c.push(f);}return c;}}function k(a,b){if(a.length==b.length)return[a,b,function(a){return a.map(c).join(" ");}];}function l(a,b){return[a,b,Math.round];}a.clamp=d,a.addPropertiesHandler(j,k,["stroke-dasharray"]),a.addPropertiesHandler(e,i(0,1/0),["border-image-width","line-height"]),a.addPropertiesHandler(e,i(0,1),["opacity","shape-image-threshold"]),a.addPropertiesHandler(e,g,["flex-grow","flex-shrink"]),a.addPropertiesHandler(e,h,["orphans","widows"]),a.addPropertiesHandler(e,l,["z-index"]),a.parseNumber=e,a.parseNumberList=j,a.mergeNumbers=f,a.numberToString=c;}(b),function(a,b){function c(a,b){if("visible"==a||"visible"==b)return[0,1,function(c){return c<=0?a:c>=1?b:"visible";}];}a.addPropertiesHandler(String,c,["visibility"]);}(b),function(a,b){function c(a){a=a.trim(),f.fillStyle="#000",f.fillStyle=a;var b=f.fillStyle;if(f.fillStyle="#fff",f.fillStyle=a,b==f.fillStyle){f.fillRect(0,0,1,1);var c=f.getImageData(0,0,1,1).data;f.clearRect(0,0,1,1);var d=c[3]/255;return[c[0]*d,c[1]*d,c[2]*d,d];}}function d(b,c){return[b,c,function(b){function c(a){return Math.max(0,Math.min(255,a));}if(b[3])for(var d=0;d<3;d++){b[d]=Math.round(c(b[d]/b[3]));}return b[3]=a.numberToString(a.clamp(0,1,b[3])),"rgba("+b.join(",")+")";}];}var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");e.width=e.height=1;var f=e.getContext("2d");a.addPropertiesHandler(c,d,["background-color","border-bottom-color","border-left-color","border-right-color","border-top-color","color","fill","flood-color","lighting-color","outline-color","stop-color","stroke","text-decoration-color"]),a.consumeColor=a.consumeParenthesised.bind(null,c),a.mergeColors=d;}(b),function(a,b){function c(a){function b(){var b=h.exec(a);g=b?b[0]:void 0;}function c(){var a=Number(g);return b(),a;}function d(){if("("!==g)return c();b();var a=f();return")"!==g?NaN:(b(),a);}function e(){for(var a=d();"*"===g||"/"===g;){var c=g;b();var e=d();"*"===c?a*=e:a/=e;}return a;}function f(){for(var a=e();"+"===g||"-"===g;){var c=g;b();var d=e();"+"===c?a+=d:a-=d;}return a;}var g,h=/([\+\-\w\.]+|[\(\)\*\/])/g;return b(),f();}function d(a,b){if("0"==(b=b.trim().toLowerCase())&&"px".search(a)>=0)return{px:0};if(/^[^(]*$|^calc/.test(b)){b=b.replace(/calc\(/g,"(");var d={};b=b.replace(a,function(a){return d[a]=null,"U"+a;});for(var e="U("+a.source+")",f=b.replace(/[-+]?(\d*\.)?\d+([Ee][-+]?\d+)?/g,"N").replace(new RegExp("N"+e,"g"),"D").replace(/\s[+-]\s/g,"O").replace(/\s/g,""),g=[/N\*(D)/g,/(N|D)[*\/]N/g,/(N|D)O\1/g,/\((N|D)\)/g],h=0;h<g.length;){g[h].test(f)?(f=f.replace(g[h],"$1"),h=0):h++;}if("D"==f){for(var i in d){var j=c(b.replace(new RegExp("U"+i,"g"),"").replace(new RegExp(e,"g"),"*0"));if(!isFinite(j))return;d[i]=j;}return d;}}}function e(a,b){return f(a,b,!0);}function f(b,c,d){var e,f=[];for(e in b){f.push(e);}for(e in c){f.indexOf(e)<0&&f.push(e);}return b=f.map(function(a){return b[a]||0;}),c=f.map(function(a){return c[a]||0;}),[b,c,function(b){var c=b.map(function(c,e){return 1==b.length&&d&&(c=Math.max(c,0)),a.numberToString(c)+f[e];}).join(" + ");return b.length>1?"calc("+c+")":c;}];}var g="px|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc",h=d.bind(null,new RegExp(g,"g")),i=d.bind(null,new RegExp(g+"|%","g")),j=d.bind(null,/deg|rad|grad|turn/g);a.parseLength=h,a.parseLengthOrPercent=i,a.consumeLengthOrPercent=a.consumeParenthesised.bind(null,i),a.parseAngle=j,a.mergeDimensions=f;var k=a.consumeParenthesised.bind(null,h),l=a.consumeRepeated.bind(void 0,k,/^/),m=a.consumeRepeated.bind(void 0,l,/^,/);a.consumeSizePairList=m;var n=function n(a){var b=m(a);if(b&&""==b[1])return b[0];},o=a.mergeNestedRepeated.bind(void 0,e," "),p=a.mergeNestedRepeated.bind(void 0,o,",");a.mergeNonNegativeSizePair=o,a.addPropertiesHandler(n,p,["background-size"]),a.addPropertiesHandler(i,e,["border-bottom-width","border-image-width","border-left-width","border-right-width","border-top-width","flex-basis","font-size","height","line-height","max-height","max-width","outline-width","width"]),a.addPropertiesHandler(i,f,["border-bottom-left-radius","border-bottom-right-radius","border-top-left-radius","border-top-right-radius","bottom","left","letter-spacing","margin-bottom","margin-left","margin-right","margin-top","min-height","min-width","outline-offset","padding-bottom","padding-left","padding-right","padding-top","perspective","right","shape-margin","stroke-dashoffset","text-indent","top","vertical-align","word-spacing"]);}(b),function(a,b){function c(b){return a.consumeLengthOrPercent(b)||a.consumeToken(/^auto/,b);}function d(b){var d=a.consumeList([a.ignore(a.consumeToken.bind(null,/^rect/)),a.ignore(a.consumeToken.bind(null,/^\(/)),a.consumeRepeated.bind(null,c,/^,/),a.ignore(a.consumeToken.bind(null,/^\)/))],b);if(d&&4==d[0].length)return d[0];}function e(b,c){return"auto"==b||"auto"==c?[!0,!1,function(d){var e=d?b:c;if("auto"==e)return"auto";var f=a.mergeDimensions(e,e);return f[2](f[0]);}]:a.mergeDimensions(b,c);}function f(a){return"rect("+a+")";}var g=a.mergeWrappedNestedRepeated.bind(null,f,e,", ");a.parseBox=d,a.mergeBoxes=g,a.addPropertiesHandler(d,g,["clip"]);}(b),function(a,b){function c(a){return function(b){var c=0;return a.map(function(a){return a===k?b[c++]:a;});};}function d(a){return a;}function e(b){if("none"==(b=b.toLowerCase().trim()))return[];for(var c,d=/\s*(\w+)\(([^)]*)\)/g,e=[],f=0;c=d.exec(b);){if(c.index!=f)return;f=c.index+c[0].length;var g=c[1],h=n[g];if(!h)return;var i=c[2].split(","),j=h[0];if(j.length<i.length)return;for(var k=[],o=0;o<j.length;o++){var p,q=i[o],r=j[o];if(void 0===(p=q?{A:function A(b){return"0"==b.trim()?m:a.parseAngle(b);},N:a.parseNumber,T:a.parseLengthOrPercent,L:a.parseLength}[r.toUpperCase()](q):{a:m,n:k[0],t:l}[r]))return;k.push(p);}if(e.push({t:g,d:k}),d.lastIndex==b.length)return e;}}function f(a){return a.toFixed(6).replace(".000000","");}function g(b,c){if(b.decompositionPair!==c){b.decompositionPair=c;var d=a.makeMatrixDecomposition(b);}if(c.decompositionPair!==b){c.decompositionPair=b;var e=a.makeMatrixDecomposition(c);}return null==d[0]||null==e[0]?[[!1],[!0],function(a){return a?c[0].d:b[0].d;}]:(d[0].push(0),e[0].push(1),[d,e,function(b){var c=a.quat(d[0][3],e[0][3],b[5]);return a.composeMatrix(b[0],b[1],b[2],c,b[4]).map(f).join(",");}]);}function h(a){return a.replace(/[xy]/,"");}function i(a){return a.replace(/(x|y|z|3d)?$/,"3d");}function j(b,c){var d=a.makeMatrixDecomposition&&!0,e=!1;if(!b.length||!c.length){b.length||(e=!0,b=c,c=[]);for(var f=0;f<b.length;f++){var j=b[f].t,k=b[f].d,l="scale"==j.substr(0,5)?1:0;c.push({t:j,d:k.map(function(a){if("number"==typeof a)return l;var b={};for(var c in a){b[c]=l;}return b;})});}}var m=function m(a,b){return"perspective"==a&&"perspective"==b||("matrix"==a||"matrix3d"==a)&&("matrix"==b||"matrix3d"==b);},o=[],p=[],q=[];if(b.length!=c.length){if(!d)return;var r=g(b,c);o=[r[0]],p=[r[1]],q=[["matrix",[r[2]]]];}else for(var f=0;f<b.length;f++){var s=b[f].t,t=c[f].t,u=b[f].d,v=c[f].d,w=n[s],x=n[t];if(m(s,t)){if(!d)return;var r=g([b[f]],[c[f]]);o.push(r[0]),p.push(r[1]),q.push(["matrix",[r[2]]]);}else{if(s==t)j=s;else if(w[2]&&x[2]&&h(s)==h(t))j=h(s),u=w[2](u),v=x[2](v);else{if(!w[1]||!x[1]||i(s)!=i(t)){if(!d)return;var r=g(b,c);o=[r[0]],p=[r[1]],q=[["matrix",[r[2]]]];break;}j=i(s),u=w[1](u),v=x[1](v);}for(var y=[],z=[],A=[],B=0;B<u.length;B++){var C="number"==typeof u[B]?a.mergeNumbers:a.mergeDimensions,r=C(u[B],v[B]);y[B]=r[0],z[B]=r[1],A.push(r[2]);}o.push(y),p.push(z),q.push([j,A]);}}if(e){var D=o;o=p,p=D;}return[o,p,function(a){return a.map(function(a,b){var c=a.map(function(a,c){return q[b][1][c](a);}).join(",");return"matrix"==q[b][0]&&16==c.split(",").length&&(q[b][0]="matrix3d"),q[b][0]+"("+c+")";}).join(" ");}];}var k=null,l={px:0},m={deg:0},n={matrix:["NNNNNN",[k,k,0,0,k,k,0,0,0,0,1,0,k,k,0,1],d],matrix3d:["NNNNNNNNNNNNNNNN",d],rotate:["A"],rotatex:["A"],rotatey:["A"],rotatez:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",c([k,k,1]),d],scalex:["N",c([k,1,1]),c([k,1])],scaley:["N",c([1,k,1]),c([1,k])],scalez:["N",c([1,1,k])],scale3d:["NNN",d],skew:["Aa",null,d],skewx:["A",null,c([k,m])],skewy:["A",null,c([m,k])],translate:["Tt",c([k,k,l]),d],translatex:["T",c([k,l,l]),c([k,l])],translatey:["T",c([l,k,l]),c([l,k])],translatez:["L",c([l,l,k])],translate3d:["TTL",d]};a.addPropertiesHandler(e,j,["transform"]),a.transformToSvgMatrix=function(b){var c=a.transformListToMatrix(e(b));return"matrix("+f(c[0])+" "+f(c[1])+" "+f(c[4])+" "+f(c[5])+" "+f(c[12])+" "+f(c[13])+")";};}(b),function(a){function b(a){var b=Number(a);if(!(isNaN(b)||b<100||b>900||b%100!=0))return b;}function c(b){return b=100*Math.round(b/100),b=a.clamp(100,900,b),400===b?"normal":700===b?"bold":String(b);}function d(a,b){return[a,b,c];}a.addPropertiesHandler(b,d,["font-weight"]);}(b),function(a){function b(a){var b={};for(var c in a){b[c]=-a[c];}return b;}function c(b){return a.consumeToken(/^(left|center|right|top|bottom)\b/i,b)||a.consumeLengthOrPercent(b);}function d(b,d){var e=a.consumeRepeated(c,/^/,d);if(e&&""==e[1]){var f=e[0];if(f[0]=f[0]||"center",f[1]=f[1]||"center",3==b&&(f[2]=f[2]||{px:0}),f.length==b){if(/top|bottom/.test(f[0])||/left|right/.test(f[1])){var h=f[0];f[0]=f[1],f[1]=h;}if(/left|right|center|Object/.test(f[0])&&/top|bottom|center|Object/.test(f[1]))return f.map(function(a){return"object"==_typeof2(a)?a:g[a];});}}}function e(d){var e=a.consumeRepeated(c,/^/,d);if(e){for(var f=e[0],h=[{"%":50},{"%":50}],i=0,j=!1,k=0;k<f.length;k++){var l=f[k];"string"==typeof l?(j=/bottom|right/.test(l),i={left:0,right:0,center:i,top:1,bottom:1}[l],h[i]=g[l],"center"==l&&i++):(j&&(l=b(l),l["%"]=(l["%"]||0)+100),h[i]=l,i++,j=!1);}return[h,e[1]];}}function f(b){var c=a.consumeRepeated(e,/^,/,b);if(c&&""==c[1])return c[0];}var g={left:{"%":0},center:{"%":50},right:{"%":100},top:{"%":0},bottom:{"%":100}},h=a.mergeNestedRepeated.bind(null,a.mergeDimensions," ");a.addPropertiesHandler(d.bind(null,3),h,["transform-origin"]),a.addPropertiesHandler(d.bind(null,2),h,["perspective-origin"]),a.consumePosition=e,a.mergeOffsetList=h;var i=a.mergeNestedRepeated.bind(null,h,", ");a.addPropertiesHandler(f,i,["background-position","object-position"]);}(b),function(a){function b(b){var c=a.consumeToken(/^circle/,b);if(c&&c[0])return["circle"].concat(a.consumeList([a.ignore(a.consumeToken.bind(void 0,/^\(/)),d,a.ignore(a.consumeToken.bind(void 0,/^at/)),a.consumePosition,a.ignore(a.consumeToken.bind(void 0,/^\)/))],c[1]));var f=a.consumeToken(/^ellipse/,b);if(f&&f[0])return["ellipse"].concat(a.consumeList([a.ignore(a.consumeToken.bind(void 0,/^\(/)),e,a.ignore(a.consumeToken.bind(void 0,/^at/)),a.consumePosition,a.ignore(a.consumeToken.bind(void 0,/^\)/))],f[1]));var g=a.consumeToken(/^polygon/,b);return g&&g[0]?["polygon"].concat(a.consumeList([a.ignore(a.consumeToken.bind(void 0,/^\(/)),a.optional(a.consumeToken.bind(void 0,/^nonzero\s*,|^evenodd\s*,/),"nonzero,"),a.consumeSizePairList,a.ignore(a.consumeToken.bind(void 0,/^\)/))],g[1])):void 0;}function c(b,c){if(b[0]===c[0])return"circle"==b[0]?a.mergeList(b.slice(1),c.slice(1),["circle(",a.mergeDimensions," at ",a.mergeOffsetList,")"]):"ellipse"==b[0]?a.mergeList(b.slice(1),c.slice(1),["ellipse(",a.mergeNonNegativeSizePair," at ",a.mergeOffsetList,")"]):"polygon"==b[0]&&b[1]==c[1]?a.mergeList(b.slice(2),c.slice(2),["polygon(",b[1],g,")"]):void 0;}var d=a.consumeParenthesised.bind(null,a.parseLengthOrPercent),e=a.consumeRepeated.bind(void 0,d,/^/),f=a.mergeNestedRepeated.bind(void 0,a.mergeDimensions," "),g=a.mergeNestedRepeated.bind(void 0,f,",");a.addPropertiesHandler(b,c,["shape-outside"]);}(b),function(a,b){function c(a,b){b.concat([a]).forEach(function(b){b in document.documentElement.style&&(d[a]=b),e[b]=a;});}var d={},e={};c("transform",["webkitTransform","msTransform"]),c("transformOrigin",["webkitTransformOrigin"]),c("perspective",["webkitPerspective"]),c("perspectiveOrigin",["webkitPerspectiveOrigin"]),a.propertyName=function(a){return d[a]||a;},a.unprefixedPropertyName=function(a){return e[a]||a;};}(b);}(),function(){if(void 0===document.createElement("div").animate([]).oncancel){var a;if(window.performance&&performance.now)var a=function a(){return performance.now();};else var a=function a(){return Date.now();};var b=function b(a,_b4,c){(this||_global$7).target=a,(this||_global$7).currentTime=_b4,(this||_global$7).timelineTime=c,(this||_global$7).type="cancel",(this||_global$7).bubbles=!1,(this||_global$7).cancelable=!1,(this||_global$7).currentTarget=a,(this||_global$7).defaultPrevented=!1,(this||_global$7).eventPhase=Event.AT_TARGET,(this||_global$7).timeStamp=Date.now();},c=window.Element.prototype.animate;window.Element.prototype.animate=function(d,e){var f=c.call(this||_global$7,d,e);f._cancelHandlers=[],f.oncancel=null;var g=f.cancel;f.cancel=function(){g.call(this||_global$7);var c=new b(this||_global$7,null,a()),d=(this||_global$7)._cancelHandlers.concat((this||_global$7).oncancel?[(this||_global$7).oncancel]:[]);setTimeout(function(){d.forEach(function(a){a.call(c.target,c);});},0);};var h=f.addEventListener;f.addEventListener=function(a,b){"function"==typeof b&&"cancel"==a?(this||_global$7)._cancelHandlers.push(b):h.call(this||_global$7,a,b);};var i=f.removeEventListener;return f.removeEventListener=function(a,b){if("cancel"==a){var c=(this||_global$7)._cancelHandlers.indexOf(b);c>=0&&(this||_global$7)._cancelHandlers.splice(c,1);}else i.call(this||_global$7,a,b);},f;};}}(),function(a){var b=document.documentElement,c=null,d=!1;try{var e=getComputedStyle(b).getPropertyValue("opacity"),f="0"==e?"1":"0";c=b.animate({opacity:[f,f]},{duration:1}),c.currentTime=0,d=getComputedStyle(b).getPropertyValue("opacity")==f;}catch(a){}finally{c&&c.cancel();}if(!d){var g=window.Element.prototype.animate;window.Element.prototype.animate=function(b,c){return window.Symbol&&Symbol.iterator&&Array.prototype.from&&b[Symbol.iterator]&&(b=Array.from(b)),Array.isArray(b)||null===b||(b=a.convertToArrayForm(b)),g.call(this||_global$7,b,c);};}}(a);}();var __varRecorder__$9=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/animations.js");function convertToSvgEasing(easing){for(var _k in __varRecorder__$9.easings){if(__varRecorder__$9.easings[_k]!==easing)continue;if(_k.includes("inOut"))return _k.replace("inOut","").toLowerCase()+"InOut";if(_k.includes("out"))return _k.replace("out","").toLowerCase()+"Out";if(_k.includes("in"))return _k.replace("in","").toLowerCase()+"In";}}__varRecorder__$9.convertToSvgEasing=convertToSvgEasing;function stringToEasing(easingString){return __varRecorder__$9.obj.isFunction(easingString)?easingString:__varRecorder__$9.Bezier.apply(__varRecorder__$9,_toConsumableArray2(eval("([".concat(easingString.match(/\((.*)\)/)[1],"])"))));}__varRecorder__$9.stringToEasing=stringToEasing;__varRecorder__$9.obj=obj;__varRecorder__$9.promise=promise;__varRecorder__$9.fun=fun;__varRecorder__$9.num=num;__varRecorder__$9.properties=properties;__varRecorder__$9.arr=arr;__varRecorder__$9.string=string;__varRecorder__$9.Color=Color$1;__varRecorder__$9.styleProps=styleProps;__varRecorder__$9.addPathAttributes=addPathAttributes;__varRecorder__$9.addSvgAttributes=addSvgAttributes;__varRecorder__$9.flubber=exports$_;__varRecorder__$9.Bezier=exports$1$j;__varRecorder__$9.ShadowObject=ShadowObject;var easings=exports('e',{inQuad:"cubic-bezier(0.550,  0.085, 0.680, 0.530)",inCubic:"cubic-bezier(0.550,  0.055, 0.675, 0.190)",inQuart:"cubic-bezier(0.895,  0.030, 0.685, 0.220)",inQuint:"cubic-bezier(0.755,  0.050, 0.855, 0.060)",inSine:"cubic-bezier(0.470,  0.000, 0.745, 0.715)",inExpo:"cubic-bezier(0.950,  0.050, 0.795, 0.035)",inCirc:"cubic-bezier(0.600,  0.040, 0.980, 0.335)",inBack:"cubic-bezier(0.600, -0.280, 0.735, 0.045)",outQuad:"cubic-bezier(0.250,  0.460, 0.450, 0.940)",outCubic:"cubic-bezier(0.215,  0.610, 0.355, 1.000)",outQuart:"cubic-bezier(0.165,  0.840, 0.440, 1.000)",outQuint:"cubic-bezier(0.230,  1.000, 0.320, 1.000)",outSine:"cubic-bezier(0.390,  0.575, 0.565, 1.000)",outExpo:"cubic-bezier(0.190,  1.000, 0.220, 1.000)",outCirc:"cubic-bezier(0.075,  0.820, 0.165, 1.000)",outBack:"cubic-bezier(0.175,  0.885, 0.320, 1.275)",inOutQuad:"cubic-bezier(0.455,  0.030, 0.515, 0.955)",inOutCubic:"cubic-bezier(0.645,  0.045, 0.355, 1.000)",inOutQuart:"cubic-bezier(0.770,  0.000, 0.175, 1.000)",inOutQuint:"cubic-bezier(0.860,  0.000, 0.070, 1.000)",inOutSine:"cubic-bezier(0.445,  0.050, 0.550, 0.950)",inOutExpo:"cubic-bezier(1.000,  0.000, 0.000, 1.000)",inOutCirc:"cubic-bezier(0.785,  0.135, 0.150, 0.860)",inOutBack:"cubic-bezier(0.680, -0.550, 0.265, 1.550)",linear:"cubic-bezier(0.5, 0.5, 0.5, 0.5)"});__varRecorder__$9.easings=easings;__varRecorder__$9.easings=easings;__varRecorder__$9.easings=easings;__varRecorder__$9.stringToEasing=stringToEasing;__varRecorder__$9.stringToEasing=stringToEasing;var AnimationQueue=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/animations.js");var __lively_class__=__lively_classholder__.hasOwnProperty("AnimationQueue")&&typeof __lively_classholder__.AnimationQueue==="function"?__lively_classholder__.AnimationQueue:__lively_classholder__.AnimationQueue=function AnimationQueue(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function AnimationQueue_initialize_(morph){this.morph=morph;this.animations=[];}},{key:"maskedProps",value:function AnimationQueue_maskedProps_(type){var l=this.animations.length;return l>0?__varRecorder__$9.obj.merge(this.animations.map(function(a){return a.getAnimationProps(type)[0];})):{};}},{key:"animationsActive",get:function get(){return true;}},{key:"registerAnimation",value:function AnimationQueue_registerAnimation_(config){var _this19=this;var anim=new __varRecorder__$9.PropertyAnimation(this,this.morph,config);this.morph.makeDirty();return this.morph.withMetaDo({animation:anim},function(){var existing=anim.affectsMorph&&_this19.animations.find(function(a){return a.equals(anim);});if(!existing){var mergeable;if(mergeable=_this19.animations.find(function(a){return a.canMerge(anim);})){mergeable.mergeWith(anim);return mergeable;}else if(anim.affectsMorph){anim.assignProps();_this19.animations.push(anim);return anim;}}return existing;});}},{key:"startAnimationsFor",value:function AnimationQueue_startAnimationsFor_(node){for(var _i70=0;_i70<this.animations.length;_i70++){var anim=this.animations[_i70];anim.start(node);}}},{key:"startSvgAnimationsFor",value:function AnimationQueue_startSvgAnimationsFor_(svgNode,type){this.animations.forEach(function(anim){return anim.startSvg(svgNode,type);});}},{key:"removeAnimation",value:function AnimationQueue_removeAnimation_(animation){__varRecorder__$9.arr.remove(this.animations,animation);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"AnimationQueue";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"rendering/animations.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:2443,end:3747});}(undefined);__varRecorder__$9.AnimationQueue=AnimationQueue;__varRecorder__$9.AnimationQueue=AnimationQueue;__varRecorder__$9.AnimationQueue=AnimationQueue;var PropertyAnimation=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/animations.js");var __lively_class__=__lively_classholder__.hasOwnProperty("PropertyAnimation")&&typeof __lively_classholder__.PropertyAnimation==="function"?__lively_classholder__.PropertyAnimation:__lively_classholder__.PropertyAnimation=function PropertyAnimation(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function PropertyAnimation_initialize_(queue,morph,config){var _this20=this;this.queue=queue;this.morph=morph;if(morph.isPath&&"fill"in config){var fillBefore=morph.fill||__varRecorder__$9.Color.transparent;var fillAfter=config.fill;config.customTween=__varRecorder__$9.fun.compose(function(p){morph.fill=fillBefore.interpolate(p,fillAfter);return p;},config.customTween||function(p){});delete config.fill;morph.fill=fillBefore;}if("dropShadow"in config){var shadowBefore=morph.dropShadow||new __varRecorder__$9.ShadowObject({blur:0,distance:0,spread:0});var shadowAfter=config.dropShadow;config.customTween=__varRecorder__$9.fun.compose(function(p){morph.dropShadow=shadowBefore.interpolate(p,shadowAfter||new __varRecorder__$9.ShadowObject({blur:0,distance:0,spread:0}));if(p==1)morph.dropShadow=shadowAfter;return p;},config.customTween||function(p){});delete config.dropShadow;morph.dropShadow=shadowBefore;}if("visible"in config&&config.visible!=morph.visible){var _queue$originalOpacit=queue.originalOpacity,originalOpacity=_queue$originalOpacit===void 0?morph.opacity:_queue$originalOpacit;queue.originalOpacity=originalOpacity;var targetVisibility=config.visible;config.customTween=__varRecorder__$9.fun.compose(function(p){if(_this20._otherVisibleTransformationInProgress){return p;}if(p==0&&targetVisibility==true){morph.visible=true;}morph.opacity=targetVisibility?__varRecorder__$9.num.interpolate(p,0,originalOpacity):__varRecorder__$9.num.interpolate(p,originalOpacity,0);if(p==1){morph.visible=targetVisibility;morph.opacity=originalOpacity;delete queue.originalOpacity;}return p;},config.customTween||function(p){});this.queue.animations.forEach(function(anim){return anim._otherVisibleTransformationInProgress=true;});delete config.visible;}this.config=this.convertBounds(config);this.needsAnimation={svg:morph.isSvgMorph,path:morph.isPath};this.capturedProperties=__varRecorder__$9.obj.select(this.morph,this.propsToCapture);}},{key:"propsToCapture",get:function get(){return["fill","origin"];}},{key:"asPromise",value:function PropertyAnimation_asPromise_(){var _this21=this;return this._promise||(this._promise=new Promise(function(resolve,reject){_this21.resolveCallback=function(){_this21.onFinish(_this21);if(_this21.subAnimations){_this21.subAnimations.then(resolve);}else{resolve(_this21.morph);}};}));}},{key:"finish",value:function PropertyAnimation_finish_(type){var _this22=this;if(this.config.scale){this.morph.whenRendered().then(function(){return _this22.morph.withAllSubmorphsDo(function(m){return m.isText&&m.invalidateTextLayout(true,true);});});}this.needsAnimation[type]=false;if(!__varRecorder__$9.arr.any(__varRecorder__$9.obj.values(this.needsAnimation),Boolean)){this.queue.removeAnimation(this);this.resolveCallback?this.resolveCallback():this.onFinish();}}},{key:"convertBounds",value:function PropertyAnimation_convertBounds_(config){var bounds=config.bounds,origin=config.origin,rotation=config.rotation,scale=config.scale,layout=config.layout,fill=config.fill;var origin=origin||this.morph.origin;var rotation=rotation||this.morph.rotation;var scale=scale||this.morph.scale;if(bounds){return Object.assign({},__varRecorder__$9.obj.dissoc(config,["bounds"]),{origin:origin,rotation:rotation,scale:scale,position:bounds.topLeft().addPt(origin),extent:bounds.extent()});}else{return config;}}},{key:"equals",value:function PropertyAnimation_equals_(animation){return!this.config.customTween&&!animation.config.customTweem&&__varRecorder__$9.obj.equals(this.animatedProps,animation.animatedProps);}},{key:"canMerge",value:function PropertyAnimation_canMerge_(animation){return this.easing==animation.easing&&this.duration==animation.duration;}},{key:"mergeWith",value:function PropertyAnimation_mergeWith_(animation){var origCustomTween=this.config.customTween;var customTween=function customTween(p){origCustomTween&&origCustomTween(p);animation.config.customTween&&animation.config.customTween(p);return p;};Object.assign(this.morph,animation.animatedProps);Object.assign(this.config,animation.config);this.config.customTween=customTween;this.afterProps=this.gatherAnimationProps();}},{key:"affectsMorph",get:function get(){var _this23=this;return!!this.config.customTween||__varRecorder__$9.properties.any(this.animatedProps,function(animatedProps,prop){return!__varRecorder__$9.obj.equals(animatedProps[prop],_this23.morph[prop]);});}},{key:"animatedProps",get:function get(){return __varRecorder__$9.obj.dissoc(this.config,["customTween","easing","onFinish","duration"]);}},{key:"easing",get:function get(){return this.config.easing||__varRecorder__$9.easings.inOutQuad;}},{key:"onFinish",get:function get(){return this.config.onFinish||function(){};}},{key:"setonFinish",value:function PropertyAnimation_setonFinish_(cb){this.config.onFinish=cb;}},{key:"duration",get:function get(){return this.config.duration||1000;}},{key:"getChangedProps",value:function PropertyAnimation_getChangedProps_(before,after){var unchangedProps=[];for(var prop in before){if(__varRecorder__$9.obj.equals(after[prop],before[prop])){unchangedProps.push(prop);}}return[__varRecorder__$9.obj.dissoc(before,unchangedProps),__varRecorder__$9.obj.dissoc(after,unchangedProps)];}},{key:"getAnimationProps",value:function PropertyAnimation_getAnimationProps_(type){var _this$getChangedProps=this.getChangedProps(this.beforeProps[type],this.afterProps[type]),_this$getChangedProps2=_slicedToArray2(_this$getChangedProps,2),before=_this$getChangedProps2[0],after=_this$getChangedProps2[1];var _this$capturedPropert=this.capturedProperties,fillBefore=_this$capturedPropert.fill,shadowBefore=_this$capturedPropert.dropShadow;var _this$config=this.config,fillAfter=_this$config.fill,shadowAfter=_this$config.dropShadow;if(this.morph.isPolygon&&type=="css"){fillBefore=fillAfter=false;delete before.background;delete after.background;delete before.backgroundImage;delete after.backgroundImage;}if(before.filter=="none"&&after.boxShadow){delete before.filter;before.boxShadow="none";}if(after.filter=="none"&&before.boxShadow){delete after.filter;after.boxShadow="none";}if(fillBefore&&fillAfter&&(fillBefore.isGradient||fillAfter.isGradient)){this.tweenGradient=this.interpolate("gradient",fillBefore,fillAfter);}var _iterator26=_createForOfIteratorHelper(__varRecorder__$9.arr.union(__varRecorder__$9.obj.keys(before),__varRecorder__$9.obj.keys(after))),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var key=_step26.value;if(!(key in before))before[key]=after[key];if(!(key in after))after[key]=before[key];}}catch(err){_iterator26.e(err);}finally{_iterator26.f();}return[__varRecorder__$9.obj.isEmpty(before)?false:before,__varRecorder__$9.obj.isEmpty(after)?false:after];}},{key:"gatherAnimationProps",value:function PropertyAnimation_gatherAnimationProps_(){var morph=this.morph;var isSvgMorph=morph.isSvgMorph,isPath=morph.isPath,isPolygon=morph.isPolygon;var props={};props.css=__varRecorder__$9.styleProps(this.morph);if(isSvgMorph)props.svg=__varRecorder__$9.addSvgAttributes(morph,{});if(isPath)props.path=__varRecorder__$9.addPathAttributes(morph,{});if(isPolygon)props.polygon=__varRecorder__$9.addPathAttributes(morph,{});return props;}},{key:"assignProps",value:function PropertyAnimation_assignProps_(){var styleClassesBefore=this.morph.styleClasses;this.beforeProps=this.gatherAnimationProps();Object.assign(this.morph,this.animatedProps);this.afterProps=this.gatherAnimationProps();if(this.config.styleClasses){this.morph._animatedStyleClasses={removed:__varRecorder__$9.arr.withoutAll(styleClassesBefore,this.morph.styleClasses),added:__varRecorder__$9.arr.withoutAll(this.morph.styleClasses,styleClassesBefore),animation:this};}}},{key:"interpolate",value:function PropertyAnimation_interpolate_(attr,v1,v2){var _this24=this;switch(attr){case"scrollTop":case"scrollLeft":return function(i){return __varRecorder__$9.num.interpolate(i,v1,v2);};case"d":return __varRecorder__$9.flubber.interpolate(v1,v2);case"stroke-width":return function(i){return __varRecorder__$9.num.interpolate(i,v1,v2);};case"stroke":return function(i){return __varRecorder__$9.Color.fromString(v1).interpolate(i,__varRecorder__$9.Color.fromString(v2),_this24.morph.bounds());};case"gradient":return function(i){return v1.interpolate(i,v2,_this24.morph.bounds());};case"fill":v1=__varRecorder__$9.Color.fromString(v1);v2=__varRecorder__$9.Color.fromString(v2);return function(i){return v1.interpolate(i,v2);};}}},{key:"startSvg",value:function PropertyAnimation_startSvg_(svgNode,type){var _this25=this;if(this.needsAnimation[type]){this.needsAnimation[type]=false;var _this$getAnimationPro=this.getAnimationProps(type),_this$getAnimationPro2=_slicedToArray2(_this$getAnimationPro,2),before=_this$getAnimationPro2[0],after=_this$getAnimationPro2[1];var params={};var easingFn=__varRecorder__$9.stringToEasing(this.easing);for(var _k2 in before){params[_k2]=this.interpolate(_k2,before[_k2],after[_k2]);}var startTime;var draw=function draw(time){var t;if(!startTime){startTime=time;}t=time-startTime;if(t/_this25.duration>1)return _this25.finish(type);for(var _k3 in params){if(!params[_k3])continue;svgNode.setAttribute(_k3,params[_k3](easingFn(t/_this25.duration)));}requestAnimationFrame(draw);};requestAnimationFrame(draw);}}},{key:"start",value:function PropertyAnimation_start_(node){if(!this.active){try{this.active=true;var _this$getAnimationPro3=this.getAnimationProps("css"),_this$getAnimationPro4=_slicedToArray2(_this$getAnimationPro3,2),before=_this$getAnimationPro4[0],after=_this$getAnimationPro4[1];node&&this.tween(node,before,after);if(this.config.origin){var _b5=this.capturedProperties.origin;var _a4=this.config.origin;var originNode=node.childNodes[0];originNode&&this.tween(originNode,originNode.style.top?{left:"".concat(_b5.x,"px"),top:"".concat(_b5.y,"px")}:{transform:"translate3d(".concat(_b5.x,"px, ").concat(_b5.y,"px, 0px)")},originNode.style.top?{left:"".concat(_b5.x,"px"),top:"".concat(_b5.y,"px")}:{transform:"translate3d(".concat(_a4.x,"px, ").concat(_a4.y,"px, 0px)")});}}catch(e){this.active=false;}}}},{key:"tween",value:function PropertyAnimation_tween_(node,before,after){var _this26=this;var remove=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var scroll=this.animatedProps.scroll;var customTween=this.config.customTween;var removalScheduled=false;var onComplete=function onComplete(){if(!remove)return;_this26.finish("css");_this26.morph.makeDirty();};if(customTween){var startTime;var easingFn=__varRecorder__$9.stringToEasing(this.easing);var draw=function draw(time){var t,p;if(!startTime){startTime=time;}t=time-startTime;p=Math.min(1,t/_this26.duration);_this26.morph.dontRecordChangesWhile(function(){return customTween(easingFn(p));});if(p>=1)return _this26.finish("css");requestAnimationFrame(draw);};requestAnimationFrame(draw);removalScheduled=true;}if(scroll){var _startTime;var scrollState=this.morph.env.eventDispatcher.eventState;var _varRecorder__$9$pro=__varRecorder__$9.promise.deferred(),_p7=_varRecorder__$9$pro.promise,_resolve2=_varRecorder__$9$pro.resolve;var interpolateScrollX=this.interpolate("scrollLeft",node.scrollLeft,scroll.x);var interpolateScrollY=this.interpolate("scrollTop",node.scrollTop,scroll.y);var _easingFn=__varRecorder__$9.stringToEasing(this.easing);var _draw=function _draw(time){var t,x;if(!_startTime){_startTime=time;}t=time-_startTime;x=Math.min(1,t/_this26.duration);node.scrollTop=interpolateScrollY(_easingFn(x));node.scrollLeft=interpolateScrollX(_easingFn(x));if(t/_this26.duration>=1){scrollState.scroll.interactiveScrollInProgress=null;_resolve2();return _this26.finish("css");}requestAnimationFrame(_draw);};_p7.debounce=function(){};requestAnimationFrame(_draw);removalScheduled=true;}if(this.tweenGradient&&!this.morph.isPolygon){var _startTime2;var _easingFn2=__varRecorder__$9.stringToEasing(this.easing);var _draw2=function _draw2(time){var t;if(!_startTime2){_startTime2=time;}t=time-_startTime2;if(t/_this26.duration>=1)return _this26.finish("css");node.style.setProperty("background-image",_this26.tweenGradient(_easingFn2(t/_this26.duration)));requestAnimationFrame(_draw2);};delete before.backgroundImage;delete after.backgroundImage;delete before.background;delete after.background;requestAnimationFrame(_draw2);removalScheduled=true;}else if(this.tweenGradient){removalScheduled=true;}if(node&&before&&after){var camelBefore={};var camelAfter={};for(var _k4 in before){camelBefore[__varRecorder__$9.string.camelize(_k4)]=before[_k4];}for(var _k5 in after){camelAfter[__varRecorder__$9.string.camelize(_k5)]=after[_k5];}try{var anim=node.animate([camelBefore,camelAfter],{duration:this.duration,easing:this.easing,fill:"forwards",composite:"replace"});anim.onfinish=function(){onComplete();setTimeout(function(){return anim.cancel();},200);};removalScheduled=true;}catch(e){removalScheduled=false;}}if(!removalScheduled)onComplete();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"PropertyAnimation";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"rendering/animations.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:3756,end:17169});}(undefined);__varRecorder__$9.PropertyAnimation=PropertyAnimation;__varRecorder__$9.PropertyAnimation=PropertyAnimation;__varRecorder__$9.PropertyAnimation=PropertyAnimation;var __varRecorder__$a=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/dom-helper.js");function cumulativeOffset(element){var top=0;var left=0;do{top=top+(element.offsetTop||0);left=left+(element.offsetLeft||0);element=element.offsetParent;}while(element);return{top:top,left:left};}__varRecorder__$a.cumulativeOffset=cumulativeOffset;function createIFrame(parentElement){var url=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"about:blank";var bounds=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new __varRecorder__$a.Rectangle(0,0,700,700);return new Promise(function(resolve,reject){if(!parentElement)throw new Error("Need parent element!");var iframe=document.createElement("iframe");iframe.style.position="absolute";iframe.style.top=bounds.top()+"px";iframe.style.left=bounds.left()+"px";iframe.style.width=bounds.width+"px";iframe.style.height=bounds.height+"px";iframe.src=url;var loaded=false;iframe.onload=function(evt){loaded=true;iframe.onload=null;resolve(iframe);};__varRecorder__$a.promise.waitFor(1000,function(){return!!loaded;})["catch"](function(err){return reject(new Error("iframe load timeout"));});parentElement.appendChild(iframe);});}__varRecorder__$a.createIFrame=createIFrame;function requestAnimationFramePolyfill(window){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var _x6=0;_x6<vendors.length&&!window.requestAnimationFrame;++_x6){window.requestAnimationFrame=window[vendors[_x6]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[_x6]+"CancelAnimationFrame"]||window[vendors[_x6]+"CancelRequestAnimationFrame"];}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(callback,element){var currTime=Date.now();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id);};}}__varRecorder__$a.requestAnimationFramePolyfill=requestAnimationFramePolyfill;function createDOMEnvironment_browser(){return _createDOMEnvironment_browser.apply(this,arguments);}function _createDOMEnvironment_browser(){_createDOMEnvironment_browser=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee203(){return regeneratorRuntime.wrap(function _callee203$(_context203){while(1){switch(_context203.prev=_context203.next){case 0:_context203.t0=__varRecorder__$a.IFramedDomEnvironment;_context203.next=3;return __varRecorder__$a.createIFrame(document.body);case 3:_context203.t1=_context203.sent;return _context203.abrupt("return",new _context203.t0(_context203.t1));case 5:case"end":return _context203.stop();}}},_callee203);}));return _createDOMEnvironment_browser.apply(this,arguments);}__varRecorder__$a.createDOMEnvironment_browser=createDOMEnvironment_browser;function createDOMEnvironment_node(){var morphicDir=System.decanonicalize("lively.morphic/").replace(/file:\/\//,"");var jsdom=System._nodeRequire("jsdom");var virtualConsole=jsdom.createVirtualConsole().sendTo(console);return new Promise(function(resolve,reject){jsdom.env("<div></div>",["https://code.jquery.com/pep/0.4.1/pep.js"],{virtualConsole:virtualConsole},function(err,window){return err?reject(err):resolve(new __varRecorder__$a.DomEnvironment(window,window.document,function(){return window.close();}));});});}__varRecorder__$a.createDOMEnvironment_node=createDOMEnvironment_node;function createDOMEnvironment(){return System.get("@system-env").browser?__varRecorder__$a.createDOMEnvironment_browser():__varRecorder__$a.createDOMEnvironment_node();}__varRecorder__$a.createDOMEnvironment=createDOMEnvironment;function defaultDOMEnv(){return __varRecorder__$a._defaultEnv||(__varRecorder__$a._defaultEnv=System.get("@system-env").browser?new __varRecorder__$a.DomEnvironment(window,document,function(){}):__varRecorder__$a.createDOMEnvironment());}__varRecorder__$a.defaultDOMEnv=defaultDOMEnv;function setCSSDef(node,cssDefString,doc){__varRecorder__$a.arr.from(node.childNodes).forEach(function(c){return node.removeChild(c);});var rules=doc.createTextNode(cssDefString);if(node.styleSheet)node.styleSheet.cssText=rules.nodeValue;else node.appendChild(rules);return node;}__varRecorder__$a.setCSSDef=setCSSDef;function addCSSDef(id,cssString,doc){var style=doc.createElement("style");style.type="text/css";if(id)style.setAttribute("id",id);__varRecorder__$a.setCSSDef(style,cssString,doc);doc.head.appendChild(style);return style;}__varRecorder__$a.addCSSDef=addCSSDef;function addOrChangeCSSDeclaration(){var id=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"lively-css";var cssString=arguments.length>1?arguments[1]:undefined;var doc=arguments.length>2&&arguments[2]!==undefined?arguments[2]:document;var node=doc.getElementById(id);return node?__varRecorder__$a.setCSSDef(node,cssString,doc):__varRecorder__$a.addCSSDef(id,cssString,doc);}__varRecorder__$a.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;function addOrChangeLinkedCSS(id,url){var doc=arguments.length>2&&arguments[2]!==undefined?arguments[2]:document;var overwrite=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var link=doc.getElementById(id);var loaded=false;if(!link){link=doc.createElement("link");link.type="text/css";link.rel="stylesheet";link.setAttribute("id",id);link.setAttribute("href",url);link.onload=function(){return loaded=true;};doc.head.appendChild(link);return __varRecorder__$a.promise.waitFor(30000,function(){return!!loaded&&link;});}if(overwrite&&link.getAttribute("href")!==url){link.setAttribute("href",url);link.onload=function(){return loaded=true;};return __varRecorder__$a.promise.waitFor(30000,function(){return!!loaded&&link;});}return Promise.resolve();}__varRecorder__$a.addOrChangeLinkedCSS=addOrChangeLinkedCSS;__varRecorder__$a.promise=promise;__varRecorder__$a.obj=obj;__varRecorder__$a.arr=arr;__varRecorder__$a.Rectangle=Rectangle;__varRecorder__$a.cumulativeOffset=cumulativeOffset;__varRecorder__$a.cumulativeOffset=cumulativeOffset;__varRecorder__$a.createDOMEnvironment=createDOMEnvironment;__varRecorder__$a.createDOMEnvironment=createDOMEnvironment;var DomEnvironment=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/dom-helper.js");var __lively_class__=__lively_classholder__.hasOwnProperty("DomEnvironment")&&typeof __lively_classholder__.DomEnvironment==="function"?__lively_classholder__.DomEnvironment:__lively_classholder__.DomEnvironment=function DomEnvironment(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function DomEnvironment_initialize_(window,document,destroyFn){__varRecorder__$a.requestAnimationFramePolyfill(window);this.window=window;this.document=document;this.destroyFn=destroyFn;}},{key:"destroy",value:function DomEnvironment_destroy_(){if(typeof this.destroyFn==="function"){this.destroyFn();}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"DomEnvironment";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"rendering/dom-helper.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:3079,end:3372});}(undefined);var IFramedDomEnvironment=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/dom-helper.js");var __lively_class__=__lively_classholder__.hasOwnProperty("IFramedDomEnvironment")&&typeof __lively_classholder__.IFramedDomEnvironment==="function"?__lively_classholder__.IFramedDomEnvironment:__lively_classholder__.IFramedDomEnvironment=function IFramedDomEnvironment(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function IFramedDomEnvironment_initialize_(iframe){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,iframe.contentWindow,iframe.contentWindow.document,function(){iframe.contentWindow&&iframe.contentWindow.close();iframe.parentNode&&iframe.parentNode.removeChild(iframe);});this.iframe=iframe;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"IFramedDomEnvironment";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"rendering/dom-helper.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:3374,end:3718});}(__varRecorder__$a.DomEnvironment);__varRecorder__$a._defaultEnv=__varRecorder__$a._defaultEnv||undefined;__varRecorder__$a.defaultDOMEnv=defaultDOMEnv;__varRecorder__$a.defaultDOMEnv=defaultDOMEnv;__varRecorder__$a.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;__varRecorder__$a.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;__varRecorder__$a.addOrChangeLinkedCSS=addOrChangeLinkedCSS;__varRecorder__$a.addOrChangeLinkedCSS=addOrChangeLinkedCSS;var hyperscriptFnForDocument=function(){return function hyperscriptFnForDocument(){var document=arguments.length>0&&arguments[0]!==undefined?arguments[0]:window.document;return h_dom;function h_dom(tagname,childrenOrAttrs,children){var attrs=childrenOrAttrs||undefined;if(typeof children==="undefined"){children=childrenOrAttrs;attrs=undefined;}var id=null;var tokens=tagname.split(".");if(tokens.length>1){tagname=tokens.shift();for(var i=0;i<tokens.length;i++){var _token=tokens[i];var hashIndex;if((hashIndex=_token.indexOf("#"))>-1){id=_token.slice(hashIndex+1);_token=_token.slice(0,hashIndex);}}}var tagnameAndId=tagname.split("#");if(tagnameAndId.length>1){tagname=tagnameAndId[0];id=tagnameAndId[1];}var el=document.createElement(tagname);if(attrs){for(var attrKey in attrs){if(attrKey!=="style"&&attrKey!=="dataset"&&attrKey!=="attributes"){el[attrKey]=attrs[attrKey];}}var style=attrs.style;if(style)for(var styleKey in style){el.style[styleKey]=style[styleKey];}var dataset=attrs.dataset;if(dataset){if(el.dataset)for(var dsKey in dataset){el.dataset[dsKey]=dataset[dsKey];}else for(var dsKey in dataset){el.setAttribute("data-"+dsKey,dataset[dsKey]);}}var attributes=attrs.attributes;if(attributes){for(var attr in attributes){if(attributes[attr]&&__varRecorder__$a.obj.isBoolean(attributes[attr]))el.toggleAttribute(attr);else el.setAttribute(attr,attributes[attr]);}}}if(!children)children="";if(typeof children==="string"){el.appendChild(document.createTextNode(children));}else if(Array.isArray(children)){for(var i=0;i<children.length;i++){var child=children[i];el.appendChild(typeof child==="string"?document.createTextNode(child):child);}}else{el.appendChild(typeof children==="string"?document.createTextNode(children):children);}return el;}};}();__varRecorder__$a.hyperscriptFnForDocument=hyperscriptFnForDocument;__varRecorder__$a.hyperscriptFnForDocument=hyperscriptFnForDocument;__varRecorder__$a.hyperscriptFnForDocument=hyperscriptFnForDocument;function applyExclude(exclude,resources){if(Array.isArray(exclude))return exclude.reduce(function(intersect,exclude){return applyExclude(exclude,intersect);},resources);if(typeof exclude==="string")return resources.filter(function(ea){return ea.path()!==exclude&&ea.name()!==exclude;});if(exclude instanceof RegExp)return resources.filter(function(ea){return!exclude.test(ea.path())&&!exclude.test(ea.name());});if(typeof exclude==="function")return resources.filter(function(ea){return!exclude(ea);});return resources;}/*

      applyExclude(["foo", "foo"], [
        {path: () => "foo", name: () => "foo"},
        {path: () => "bar", name: () => "bar"},
        {path: () => "baz", name: () => "baz"}
      ])

      applyExclude(["bar", "foo"], [
        {path: () => "foo", name: () => "foo"},
        {path: () => "bar", name: () => "bar"},
        {path: () => "baz", name: () => "baz"}
      ])

      */ // parseQuery('?hello=world&x={"foo":{"bar": "baz"}}')
// parseQuery("?db=test-object-db&url=lively.morphic%2Fworlds%2Fdefault.json&type=world&name=default&commitSpec=%7B%22user%22%3A%7B%22name%22%3A%22robert%22%2C%22realm%22%3A%22https%3A%2F%2Fauth.lively-next.org%22%2C%22email%22%3A%22robert%40kra.hn%22%7D%2C%22description%22%3A%22An%20empty%20world.%20A%20place%20to%20start%20from%20scratch.%22%2C%22metadata%22%3A%7B%22belongsToCore%22%3Atrue%7D%7D&purgeHistory=true")
function parseQuery(url){var url=url,_url$split=url.split("?"),_url$split2=_slicedToArray2(_url$split,2),_=_url$split2[0],search=_url$split2[1],query={};if(!search)return query;var args=search.split("&");if(args)for(var i=0;i<args.length;i++){var keyAndVal=args[i].split("="),key=keyAndVal[0],val=true;if(keyAndVal.length>1){val=decodeURIComponent(keyAndVal.slice(1).join("="));if(val==="undefined")val=undefined;else if(val.match(/^(true|false|null|[0-9"[{].*)$/))try{val=JSON.parse(val);}catch(e){if(val[0]==="[")val=val.slice(1,-1).split(",");// handle string arrays
// if not JSON use string itself
}}query[key]=val;}return query;}function stringifyQuery(query){return Object.keys(query).map(function(key){return"".concat(key,"=").concat(encodeURIComponent(String(query[key])));}).join("&");}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var urlRe=/^([^:\/]+):\/\/([^\/]*)(.*)/,// for resolve path:
pathDotRe$1=/\/\.\//g,pathDoubleDotRe$1=/\/[^\/]+\/\.\./,pathDoubleSlashRe$1=/(^|[^:])[\/]+/g;function _withRelativePartsResolved(inputPath){var path=inputPath,result=path;// /foo/../bar --> /bar
do{path=result;result=path.replace(pathDoubleDotRe$1,'');}while(result!=path);// foo//bar --> foo/bar
result=result.replace(pathDoubleSlashRe$1,'$1/');// foo/./bar --> foo/bar
result=result.replace(pathDotRe$1,'/');return result;}function _relativePathBetween_checkPathes(path1,path2){if(path1.startsWith("/"))path1=path1.slice(1);if(path2.startsWith("/"))path2=path2.slice(1);var paths1=path1.split('/'),paths2=path2.split('/');for(var i=0;i<paths2.length;i++){if(!paths1[i]||paths1[i]!=paths2[i])break;}// now that's some JavaScript FOO
var result='../'.repeat(Math.max(0,paths2.length-i-1))+paths1.splice(i,paths1.length).join('/');return result;}// pathA = "http://foo/bar/"
// pathB = "http://foo/bar/oink/baz.js";
function relativePathBetween(pathA,pathB){// produces the relative path to get from `pathA` to `pathB`
// Example:
//   relativePathBetween("/foo/bar/", "/foo/baz.js"); // => ../baz.js
var urlMatchA=pathA.match(urlRe),urlMatchB=pathB.match(urlRe),protocolA,domainA,protocolB,domainB,compatible=true;if(urlMatchA&&!urlMatchB||!urlMatchA&&urlMatchB)compatible=false;if(urlMatchA&&urlMatchB){protocolA=urlMatchA[1];domainA=urlMatchA[2];protocolB=urlMatchB[1];domainB=urlMatchB[2];if(protocolA!==protocolB)compatible=false;else if(domainA!==domainB)compatible=false;else{pathA=urlMatchA[3];pathB=urlMatchB[3];}}if(!compatible)throw new Error("[relativePathBetween] incompatible paths: ".concat(pathA," vs. ").concat(pathB));pathA=_withRelativePartsResolved(pathA);pathB=_withRelativePartsResolved(pathB);if(pathA==pathB)return'';var relPath=_relativePathBetween_checkPathes(pathB,pathA);if(!relPath)throw new Error('pathname differs in relativePathFrom '+pathA+' vs '+pathB);return relPath;}var extensions=[];function resource(url,opts){if(!url)throw new Error("lively.resource resource constructor: expects url but got "+url);if(url.isResource)return url;url=String(url);for(var i=0;i<extensions.length;i++){if(extensions[i].matches(url))return new extensions[i].resourceClass(url,opts);}throw new Error("Cannot find resource type for url ".concat(url));}function createFiles(_x7,_x8,_x9){return _createFiles.apply(this,arguments);}function _createFiles(){_createFiles=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee204(baseDir,fileSpec,opts){var base,name,_resource;return regeneratorRuntime.wrap(function _callee204$(_context204){while(1){switch(_context204.prev=_context204.next){case 0:// creates resources as specified in fileSpec, e.g.
// {"foo.txt": "hello world", "sub-dir/bar.js": "23 + 19"}
// supports both sync and async resources
base=resource(baseDir,opts).asDirectory();_context204.next=3;return base.ensureExistance();case 3:_context204.t0=regeneratorRuntime.keys(fileSpec);case 4:if((_context204.t1=_context204.t0()).done){_context204.next=18;break;}name=_context204.t1.value;if(fileSpec.hasOwnProperty(name)){_context204.next=8;break;}return _context204.abrupt("continue",4);case 8:_resource=base.join(name);if(!(_typeof2(fileSpec[name])==="object")){_context204.next=14;break;}_context204.next=12;return createFiles(_resource,fileSpec[name],opts);case 12:_context204.next=16;break;case 14:_context204.next=16;return _resource.write(fileSpec[name]);case 16:_context204.next=4;break;case 18:return _context204.abrupt("return",base);case 19:case"end":return _context204.stop();}}},_callee204);}));return _createFiles.apply(this,arguments);}function registerExtension(extension){// extension = {name: STRING, matches: FUNCTION, resourceClass: RESOURCE}
// name: uniquely identifying this extension
// predicate matches gets a resource url (string) passed and decides if the
// extension handles it
// resourceClass needs to implement the Resource interface
var name=extension.name;extensions=extensions.filter(function(ea){return ea.name!==name;}).concat(extension);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var windowsURLPrefixRe=/^file:\/\/\/[a-z]:\//i;var windowsPathPrefixRe=/^[a-z]:\//i;var windowsRootPathRe=/^[a-z]:\/$/i;var slashEndRe=/\/+$/,slashStartRe=/^\/+/,protocolRe=/^[a-z0-9-_\.]+:/,slashslashRe=/^\/\/[^\/]+/;function nyi(obj,name){throw new Error("".concat(name," for ").concat(obj.constructor.name," not yet implemented"));}var Resource=/*#__PURE__*/function(){_createClass(Resource,null,[{key:"fromProps",value:function fromProps(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};// props can have the keys contentType, type, size, etag, created, lastModified, url
// it should have at least url
return new this(props.url).assignProperties(props);}}]);function Resource(url){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Resource);if(!url)throw new Error("Cannot create resource without url");this.url=String(url);this.binary=false;this.lastModified=undefined;this.created=undefined;this.etag=undefined;this.size=undefined;this.type=undefined;this.contentType=undefined;this.user=undefined;this.group=undefined;this.mode=undefined;this._isDirectory=undefined;this._isLink=undefined;this.linkCount=undefined;}_createClass(Resource,[{key:"equals",value:function equals(otherResource){if(!otherResource||this.constructor!==otherResource.constructor)return false;var myURL=this.url,otherURL=otherResource.url;if(myURL[myURL.length-1]==="/")myURL=myURL.slice(0,-1);if(otherURL[otherURL.length-1]==="/")otherURL=otherURL.slice(0,-1);return myURL===otherURL;}},{key:"toString",value:function toString(){return"".concat(this.constructor.name,"(\"").concat(this.url,"\")");}},{key:"newResource",value:function newResource(url){return resource(url,this);}},{key:"path",value:function path(){var path=this.url.replace(protocolRe,"").replace(slashslashRe,"");return path===""?"/":path;}},{key:"pathWithoutQuery",value:function pathWithoutQuery(){return this.path().split("?")[0];}},{key:"name",value:function name(){var path=this.path(),queryIndex=path.lastIndexOf("?");if(queryIndex>-1)path=path.slice(0,queryIndex);if(path.endsWith("/"))path=path.slice(0,-1);var parts=path.split("/"),lastPart=parts[parts.length-1];return decodeURIComponent(lastPart);}},{key:"ext",value:function ext(){var url=this.url;if(url.endsWith("/"))return"";var _ref17=url.match(/\.([^\/\.]+$)/)||["",""],_ref18=_slicedToArray2(_ref17,2),_=_ref18[0],ext=_ref18[1];return ext.toLowerCase();}},{key:"nameWithoutExt",value:function nameWithoutExt(){var name=this.name(),extIndex=name.lastIndexOf(".");if(extIndex>0)name=name.slice(0,extIndex);return name;}},{key:"scheme",value:function scheme(){return this.url.split(":")[0];}},{key:"host",value:function host(){var idx=this.url.indexOf("://");if(idx===-1)return null;var noScheme=this.url.slice(idx+3),slashIdx=noScheme.indexOf("/");return noScheme.slice(0,slashIdx>-1?slashIdx:noScheme.length);}},{key:"schemeAndHost",value:function schemeAndHost(){if(this.isRoot())return this.asFile().url;return this.url.slice(0,this.url.length-this.path().length);}},{key:"parent",value:function parent(){// drops the query
return this.isRoot()?null:this.newResource(this.url.split("?")[0].replace(slashEndRe,"").split("/").slice(0,-1).join("/")+"/");}},{key:"parents",value:function parents(){var result=[],p=this.parent();while(p){result.unshift(p);p=p.parent();}return result;}},{key:"isParentOf",value:function isParentOf(otherRes){var _this27=this;return otherRes.schemeAndHost()===this.schemeAndHost()&&otherRes.parents().some(function(p){return p.equals(_this27);});}},{key:"query",value:function query(){return parseQuery(this.url);}},{key:"withQuery",value:function withQuery(queryObj){var query=_objectSpread(_objectSpread({},this.query()),queryObj),_this$url$split=this.url.split("?"),_this$url$split2=_slicedToArray2(_this$url$split,1),url=_this$url$split2[0],queryString=stringifyQuery(query);return this.newResource("".concat(url,"?").concat(queryString));}},{key:"commonDirectory",value:function commonDirectory(other){if(other.schemeAndHost()!==this.schemeAndHost())return null;if(this.isDirectory()&&this.equals(other))return this;if(this.isRoot())return this.asDirectory();if(other.isRoot())return other.asDirectory();var otherParents=other.parents(),myParents=this.parents(),common=this.root();for(var i=0;i<myParents.length;i++){var myP=myParents[i],otherP=otherParents[i];if(!otherP||!myP.equals(otherP))return common;common=myP;}return common;}},{key:"withRelativePartsResolved",value:function withRelativePartsResolved(){var path=this.path(),result=_withRelativePartsResolved(path);if(result===path)return this;if(result.startsWith("/"))result=result.slice(1);if(result[1]===":".startsWith("/"))result=result.slice(1);else if(result[1]===":"&&result.match(windowsPathPrefixRe))result=result.slice(3);return this.newResource(this.root().url+result);}},{key:"relativePathFrom",value:function relativePathFrom(fromResource){return relativePathBetween(fromResource.url,this.url);}},{key:"withPath",value:function withPath(path){var root=this.isRoot()?this:this.root();return root.join(path);}},{key:"join",value:function join(path){return this.newResource(this.url.replace(slashEndRe,"")+"/"+path.replace(slashStartRe,""));}},{key:"isRoot",value:function isRoot(){return this.path()==="/";}},{key:"isFile",value:function isFile(){return!this.isRoot()&&!this.url.match(slashEndRe);}},{key:"isDirectory",value:function isDirectory(){return!this.isFile();}},{key:"asDirectory",value:function asDirectory(){if(this.url.endsWith("/"))return this;return this.newResource(this.url.replace(slashEndRe,"")+"/");}},{key:"root",value:function root(){if(this.isRoot())return this;var toplevel=this.url.slice(0,-this.path().length);return this.newResource(toplevel+"/");}},{key:"asFile",value:function asFile(){if(!this.url.endsWith("/"))return this;return this.newResource(this.url.replace(slashEndRe,""));}},{key:"assignProperties",value:function assignProperties(props){// lastModified, etag, ...
for(var name in props){if(name==="url")continue;// rename some properties to not create conflicts
var myPropName=name;if(name==="isLink"||name==="isDirectory")myPropName="_"+name;this[myPropName]=props[name];}return this;}},{key:"ensureExistance",value:function(){var _ensureExistance=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee2(optionalContent){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return this.exists();case 2:if(!_context2.sent){_context2.next=4;break;}return _context2.abrupt("return",this);case 4:_context2.next=6;return this.parent().ensureExistance();case 6:if(!this.isFile()){_context2.next=11;break;}_context2.next=9;return this.write(optionalContent||"");case 9:_context2.next=13;break;case 11:_context2.next=13;return this.mkdir();case 13:return _context2.abrupt("return",this);case 14:case"end":return _context2.stop();}}},_callee2,this);}));function ensureExistance(_x10){return _ensureExistance.apply(this,arguments);}return ensureExistance;}()},{key:"copyTo",value:function(){var _copyTo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee3(otherResource){var _this28=this;var ensureParent,toFile,fromResources,toResources,_args4=arguments;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:ensureParent=_args4.length>1&&_args4[1]!==undefined?_args4[1]:true;if(!this.isFile()){_context3.next=14;break;}toFile=otherResource.isFile()?otherResource:otherResource.join(this.name());if(!ensureParent){_context3.next=6;break;}_context3.next=6;return toFile.parent().ensureExistance();case 6:_context3.t0=toFile;_context3.next=9;return this.read();case 9:_context3.t1=_context3.sent;_context3.next=12;return _context3.t0.write.call(_context3.t0,_context3.t1);case 12:_context3.next=26;break;case 14:if(otherResource.isDirectory()){_context3.next=16;break;}throw new Error("Cannot copy a directory to a file!");case 16:_context3.next=18;return this.dirList('infinity');case 18:fromResources=_context3.sent;toResources=fromResources.map(function(ea){return otherResource.join(ea.relativePathFrom(_this28));});_context3.next=22;return otherResource.ensureExistance();case 22:_context3.next=24;return fromResources.reduceRight(function(next,ea,i){return function(){return Promise.resolve(ea.isDirectory()&&toResources[i].ensureExistance()).then(next);};},function(){return Promise.resolve();})();case 24:_context3.next=26;return fromResources.reduceRight(function(next,ea,i){return function(){return Promise.resolve(ea.isFile()&&ea.copyTo(toResources[i],false)).then(next);};},function(){return Promise.resolve();})();case 26:return _context3.abrupt("return",this);case 27:case"end":return _context3.stop();}}},_callee3,this);}));function copyTo(_x11){return _copyTo.apply(this,arguments);}return copyTo;}()},{key:"rename",value:function(){var _rename=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee4(otherResource){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return this.copyTo(otherResource);case 2:this.remove();return _context4.abrupt("return",otherResource);case 4:case"end":return _context4.stop();}}},_callee4,this);}));function rename(_x12){return _rename.apply(this,arguments);}return rename;}()},{key:"beBinary",value:function beBinary(bool){return this.setBinary(true);}},{key:"setBinary",value:function setBinary(bool){this.binary=bool;return this;}},{key:"read",value:function(){var _read=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:nyi(this,"read");case 1:case"end":return _context5.stop();}}},_callee5,this);}));function read(){return _read.apply(this,arguments);}return read;}()},{key:"write",value:function(){var _write=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:nyi(this,"write");case 1:case"end":return _context6.stop();}}},_callee6,this);}));function write(){return _write.apply(this,arguments);}return write;}()},{key:"mkdir",value:function(){var _mkdir=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee7(){return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:nyi(this,"mkdir");case 1:case"end":return _context7.stop();}}},_callee7,this);}));function mkdir(){return _mkdir.apply(this,arguments);}return mkdir;}()},{key:"exists",value:function(){var _exists=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee8(){return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:nyi(this,"exists");case 1:case"end":return _context8.stop();}}},_callee8,this);}));function exists(){return _exists.apply(this,arguments);}return exists;}()},{key:"remove",value:function(){var _remove=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee9(){return regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:nyi(this,"remove");case 1:case"end":return _context9.stop();}}},_callee9,this);}));function remove(){return _remove.apply(this,arguments);}return remove;}()},{key:"dirList",value:function(){var _dirList=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee10(depth,opts){return regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:nyi(this,"dirList");case 1:case"end":return _context10.stop();}}},_callee10,this);}));function dirList(_x13,_x14){return _dirList.apply(this,arguments);}return dirList;}()},{key:"readProperties",value:function(){var _readProperties=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee11(opts){return regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:nyi(this,"readProperties");case 1:case"end":return _context11.stop();}}},_callee11,this);}));function readProperties(_x15){return _readProperties.apply(this,arguments);}return readProperties;}()},{key:"writeJson",value:function writeJson(obj){var pretty=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return this.write(pretty?JSON.stringify(obj,null,2):JSON.stringify(obj));}},{key:"readJson",value:function(){var _readJson=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee12(obj){return regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.t0=JSON;_context12.next=3;return this.read();case 3:_context12.t1=_context12.sent;return _context12.abrupt("return",_context12.t0.parse.call(_context12.t0,_context12.t1));case 5:case"end":return _context12.stop();}}},_callee12,this);}));function readJson(_x16){return _readJson.apply(this,arguments);}return readJson;}()// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// serialization
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"__serialize__",value:function __serialize__(){return{__expr__:"var r = null; try { r = resource(\"".concat(this.url,"\");} catch (err) {}; r"),bindings:{"lively.resources":["resource"]}};}},{key:"isResource",get:function get(){return true;}},{key:"canDealWithJSON",get:function get(){return false;}}]);return Resource;}();/*global fetch, DOMParser, XPathEvaluator, XPathResult, Namespace,System,global,process,XMLHttpRequest,Buffer*/var XPathQuery=/*#__PURE__*/function(){function XPathQuery(expression){_classCallCheck(this,XPathQuery);this.expression=expression;this.contextNode=null;this.xpe=new XPathEvaluator();}_createClass(XPathQuery,[{key:"establishContext",value:function establishContext(node){if(this.nsResolver)return;var ctx=node.ownerDocument?node.ownerDocument.documentElement:node.documentElement;if(ctx!==this.contextNode){this.contextNode=ctx;this.nsResolver=this.xpe.createNSResolver(ctx);}}},{key:"manualNSLookup",value:function manualNSLookup(){this.nsResolver=function(prefix){return Namespace[prefix.toUpperCase()]||null;};return this;}},{key:"findAll",value:function findAll(node,defaultValue){this.establishContext(node);var result=this.xpe.evaluate(this.expression,node,this.nsResolver,XPathResult.ANY_TYPE,null),accumulator=[],res=null;while(res=result.iterateNext()){accumulator.push(res);}return accumulator.length>0||defaultValue===undefined?accumulator:defaultValue;}},{key:"findFirst",value:function findFirst(node){this.establishContext(node);var result=this.xpe.evaluate(this.expression,node,this.nsResolver,XPathResult.ANY_TYPE,null);return result.iterateNext();}}]);return XPathQuery;}();function davNs(xmlString){// finds the declaration of the webdav namespace, usually "d" or "D"
var davNSMatch=xmlString.match(/\/([a-z]+?):multistatus/i);return davNSMatch?davNSMatch[1]:"d";}var propertyNodeMap={getlastmodified:"lastModified",creationDate:"created",getetag:"etag",getcontentlength:"size",resourcetype:"type",// collection or file
getcontenttype:"contentType"// mime type
};function readPropertyNode(propNode){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var tagName=propNode.tagName.replace(/[^:]+:/,""),key=propertyNodeMap[tagName],value=propNode.textContent;switch(key){case'lastModified':case'created':value=new Date(value);break;case'size':value=Number(value);break;// code
}result[key]=value;return result;}function readXMLPropfindResult(xmlString){// the xmlString looks like this:
// <?xml version="1.0" encoding="utf-8"?>
// <d:multistatus xmlns:d="DAV:" xmlns:a="http://ajax.org/2005/aml">
//   <d:response>
//     <d:href>sub-dir/</d:href>
//     <d:propstat>
//       <d:prop>
//         <d:getlastmodified xmlns:b="urn:uuid:c2f41010-65b3-11d1-a29f-00aa00c14882/" b:dt="dateTime.rfc1123">Fri, 24 Jun 2016 09:58:20 -0700</d:getlastmodified>
//         <d:resourcetype>
//           <d:collection/>
//         </d:resourcetype>
//       </d:prop>
//       <d:status>HTTP/1.1 200 Ok</d:status>
//     </d:propstat>
//   </d:response>
// ...
// </d:multistatus>
var doc=new DOMParser().parseFromString(xmlString,"text/xml"),ns=davNs(xmlString),nodes=new XPathQuery("/".concat(ns,":multistatus/").concat(ns,":response")).findAll(doc.documentElement),urlQ=new XPathQuery("".concat(ns,":href")),propsQ=new XPathQuery("".concat(ns,":propstat/").concat(ns,":prop"));return nodes.map(function(node){var propsNode=propsQ.findFirst(node),props=Array.from(propsNode.childNodes).reduce(function(props,node){return readPropertyNode(node,props);},{}),urlNode=urlQ.findFirst(node);props.url=urlNode.textContent||urlNode.text;// text is FIX for IE9+;
return props;});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// MIT License Copyright (c) Sindre Sorhus <sindresorhus@gmail.com>
// https://github.com/sindresorhus/binary-extensions
var binaryExtensions=["3ds","3g2","3gp","7z","a","aac","adp","ai","aif","aiff","alz","ape","apk","ar","arj","asf","au","avi","bak","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","csv","cur","dat","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","fli","flv","fpx","fst","fvt","g3","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","o","oga","ogg","ogv","otf","pages","pbm","pcx","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","rgb","rip","rlc","rmf","rmvb","rtf","rz","s3m","s7z","scpt","sgi","shar","sil","sketch","slk","smv","so","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"];// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var isNode$2=typeof System!=="undefined"?System.get("@system-env").node:typeof global!=="undefined"&&typeof process!=="undefined";function defaultOrigin(){// FIXME nodejs usage???
return document.location.origin;}function makeRequest(resource){var method=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"GET";var body=arguments.length>2?arguments[2]:undefined;var headers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var onProgress=arguments.length>4&&arguments[4]!==undefined?arguments[4]:function(){};var url=resource.url,useCors=resource.useCors,useProxy=resource.useProxy,moreHeaders=resource.headers,useCors=typeof useCors!=="undefined"?useCors:true,useProxy=typeof useProxy!=="undefined"?useProxy:true,fetchOpts={method:method};if(useProxy){Object.assign(headers,{'pragma':'no-cache','cache-control':'no-cache',"x-lively-proxy-request":url});url=resource.proxyDomain||defaultOrigin();}if(useCors)fetchOpts.mode="cors";if(body)fetchOpts.body=body;fetchOpts.redirect='follow';fetchOpts.headers=_objectSpread(_objectSpread({},headers),moreHeaders);return fetch(url,fetchOpts);}function upload(resource,body){var _resource$useProxy=resource.useProxy,useProxy=_resource$useProxy===void 0?true:_resource$useProxy,_resource$useCors=resource.useCors,useCors=_resource$useCors===void 0?true:_resource$useCors,url=resource.url,onLoad=resource.onLoad,headers=resource.headers,onProgress=resource.onProgress;var xhr=new XMLHttpRequest();var res=promise.deferred();xhr.open("PUT",url);if(useProxy){Object.assign(headers,{'pragma':'no-cache','cache-control':'no-cache',"x-lively-proxy-request":url});url=resource.proxyDomain||defaultOrigin();}for(var header in headers){xhr.setRequestHeader(header,headers[header]);}xhr.upload.addEventListener("progress",onProgress);xhr.responseType='json';xhr.onload=function(){onLoad(xhr.response);res.resolve(xhr);};if(useCors)xhr.withCredentials=true;xhr.send(body);return res.promise;}var WebDAVResource=/*#__PURE__*/function(_Resource){_inherits(WebDAVResource,_Resource);var _super9=_createSuper(WebDAVResource);function WebDAVResource(url){var _this29;var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,WebDAVResource);_this29=_super9.call(this,url,opts);_this29.onLoad=opts.onLoad||function(){};_this29.onProgress=opts.onProgress||function(){};_this29.useProxy=opts.hasOwnProperty("useProxy")?opts.useProxy:false;_this29.proxyDomain=opts.proxyDomain||undefined;_this29.useCors=opts.hasOwnProperty("useCors")?opts.useCors:false;_this29.headers=opts.headers||{};_this29.binary=_this29.isFile()?binaryExtensions.includes(_this29.ext()):false;_this29.errorOnHTTPStatusCodes=opts.hasOwnProperty("errorOnHTTPStatusCodes")?opts.errorOnHTTPStatusCodes:true;return _this29;}_createClass(WebDAVResource,[{key:"join",value:function join(path){return Object.assign(_get2(_getPrototypeOf(WebDAVResource.prototype),"join",this).call(this,path),{headers:this.headers,useCors:this.useCors,useProxy:this.useProxy,proxyDomain:this.proxyDomain});}},{key:"makeProxied",value:function makeProxied(proxyDomain){if(proxyDomain!==undefined)this.proxyDomain=proxyDomain;return this.useProxy?this:new this.constructor(this.url,{headers:this.headers,useCors:this.useCors,useProxy:true,proxyDomain:this.proxyDomain});}},{key:"noErrorOnHTTPStatusCodes",value:function noErrorOnHTTPStatusCodes(){this.errorOnHTTPStatusCodes=false;return this;}},{key:"read",value:function(){var _read2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee13(){var res;return regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.next=2;return makeRequest(this);case 2:res=_context13.sent;if(!(!res.ok&&this.errorOnHTTPStatusCodes)){_context13.next=5;break;}throw new Error("Cannot read ".concat(this.url,": ").concat(res.statusText," ").concat(res.status));case 5:if(this.binary){_context13.next=7;break;}return _context13.abrupt("return",res.text());case 7:if(!(this.binary==="blob")){_context13.next=9;break;}return _context13.abrupt("return",res.blob());case 9:if(!(typeof res.arrayBuffer==="function")){_context13.next=11;break;}return _context13.abrupt("return",res.arrayBuffer());case 11:if(!(typeof res.buffer==="function")){_context13.next=13;break;}return _context13.abrupt("return",res.buffer());case 13:throw new Error("Don't now how to read binary resource ".concat(this,"'"));case 14:case"end":return _context13.stop();}}},_callee13,this);}));function read(){return _read2.apply(this,arguments);}return read;}()},{key:"write",value:function(){var _write2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee14(content){var res;return regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:if(this.isFile()){_context14.next=2;break;}throw new Error("Cannot write a non-file: ".concat(this.url));case 2:_context14.next=4;return upload(this,content);case 4:res=_context14.sent;if(!(!between(res.status,200,300)&&this.errorOnHTTPStatusCodes)){_context14.next=7;break;}throw new Error("Cannot write ".concat(this.url,": ").concat(res.statusText," ").concat(res.status));case 7:return _context14.abrupt("return",this);case 8:case"end":return _context14.stop();}}},_callee14,this);}));function write(_x17){return _write2.apply(this,arguments);}return write;}()},{key:"mkdir",value:function(){var _mkdir2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee15(){var res;return regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:if(!this.isFile()){_context15.next=2;break;}throw new Error("Cannot mkdir on a file: ".concat(this.url));case 2:_context15.next=4;return makeRequest(this,"MKCOL");case 4:res=_context15.sent;if(!(!res.ok&&this.errorOnHTTPStatusCodes)){_context15.next=7;break;}throw new Error("Cannot create directory ".concat(this.url,": ").concat(res.statusText," ").concat(res.status));case 7:return _context15.abrupt("return",this);case 8:case"end":return _context15.stop();}}},_callee15,this);}));function mkdir(){return _mkdir2.apply(this,arguments);}return mkdir;}()},{key:"exists",value:function(){var _exists2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee16(){return regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:if(!this.isRoot()){_context16.next=4;break;}_context16.t0=true;_context16.next=7;break;case 4:_context16.next=6;return makeRequest(this,"HEAD");case 6:_context16.t0=!!_context16.sent.ok;case 7:return _context16.abrupt("return",_context16.t0);case 8:case"end":return _context16.stop();}}},_callee16,this);}));function exists(){return _exists2.apply(this,arguments);}return exists;}()},{key:"remove",value:function(){var _remove2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee17(){return regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:_context17.next=2;return makeRequest(this,"DELETE");case 2:return _context17.abrupt("return",this);case 3:case"end":return _context17.stop();}}},_callee17,this);}));function remove(){return _remove2.apply(this,arguments);}return remove;}()},{key:"_propfind",value:function(){var _propfind2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee18(){var res,xmlString,root;return regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:_context18.next=2;return makeRequest(this,"PROPFIND",null,// propfindRequestPayload(),
{'Content-Type':'text/xml'// rk 2016-06-24: jsDAV does not support PROPFIND via depth: 'infinity'
// 'Depth': String(depth)
});case 2:res=_context18.sent;if(!(!res.ok&&this.errorOnHTTPStatusCodes)){_context18.next=5;break;}throw new Error("Error in dirList for ".concat(this.url,": ").concat(res.statusText));case 5:_context18.next=7;return res.text();case 7:xmlString=_context18.sent;root=this.root();return _context18.abrupt("return",readXMLPropfindResult(xmlString).map(function(props){return root.join(props.url).assignProperties(props);}));case 10:case"end":return _context18.stop();}}},_callee18,this);}));function _propfind(){return _propfind2.apply(this,arguments);}return _propfind;}()},{key:"dirList",value:function(){var _dirList2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee19(){var depth,opts,exclude,resources,self,subResources,subCollections,_args20=arguments;return regeneratorRuntime.wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:depth=_args20.length>0&&_args20[0]!==undefined?_args20[0]:1;opts=_args20.length>1&&_args20[1]!==undefined?_args20[1]:{};if(!(typeof depth!=="number"&&depth!=='infinity')){_context19.next=4;break;}throw new Error("dirList \u2013 invalid depth argument: ".concat(depth));case 4:exclude=opts.exclude;if(depth<=0)depth=1;if(!(depth===1)){_context19.next=15;break;}_context19.next=9;return this._propfind();case 9:resources=_context19.sent;self=resources.shift();if(exclude)resources=applyExclude(exclude,resources);return _context19.abrupt("return",resources);case 15:_context19.next=17;return this.dirList(1,opts);case 17:subResources=_context19.sent;subCollections=subResources.filter(function(ea){return ea.isDirectory();});return _context19.abrupt("return",Promise.all(subCollections.map(function(col){return col.dirList(typeof depth==="number"?depth-1:depth,opts);})).then(function(recursiveResult){return recursiveResult.reduce(function(all,ea){return all.concat(ea);},subResources);}));case 20:case"end":return _context19.stop();}}},_callee19,this);}));function dirList(){return _dirList2.apply(this,arguments);}return dirList;}()},{key:"readProperties",value:function(){var _readProperties2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee20(opts){var props;return regeneratorRuntime.wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_context20.next=2;return this._propfind();case 2:props=_context20.sent[0];return _context20.abrupt("return",this.assignProperties(props));case 4:case"end":return _context20.stop();}}},_callee20,this);}));function readProperties(_x18){return _readProperties2.apply(this,arguments);}return readProperties;}()},{key:"post",value:function(){var _post=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee21(){var body,res,text,json,_args22=arguments;return regeneratorRuntime.wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:body=_args22.length>0&&_args22[0]!==undefined?_args22[0]:null;if(typeof body!=="string")body=JSON.stringify(body);_context21.next=4;return makeRequest(this,"POST",body,{});case 4:res=_context21.sent;_context21.prev=5;_context21.next=8;return res.text();case 8:text=_context21.sent;_context21.next=13;break;case 11:_context21.prev=11;_context21.t0=_context21["catch"](5);case 13:if(text&&res.headers.get("content-type")==="application/json"){try{json=JSON.parse(text);}catch(err){}}if(!(!res.ok&&this.errorOnHTTPStatusCodes)){_context21.next=18;break;}throw new Error("Error in POST ".concat(this.url,": ").concat(text||res.statusText));case 18:return _context21.abrupt("return",json||text);case 19:case"end":return _context21.stop();}}},_callee21,this,[[5,11]]);}));function post(){return _post.apply(this,arguments);}return post;}()},{key:"copyTo",value:function(){var _copyTo2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee22(otherResource){var ensureParent,toFile,_args23=arguments;return regeneratorRuntime.wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:ensureParent=_args23.length>1&&_args23[1]!==undefined?_args23[1]:true;if(!this.isFile()){_context22.next=8;break;}toFile=otherResource.isFile()?otherResource:otherResource.join(this.name());// optimized copy, using pipes, for HTTP
if(!isNode$2){_context22.next=8;break;}if(!toFile.isHTTPResource){_context22.next=6;break;}return _context22.abrupt("return",this._copyTo_file_nodejs_http(toFile,ensureParent));case 6:if(!toFile.isNodeJSFileResource){_context22.next=8;break;}return _context22.abrupt("return",this._copyTo_file_nodejs_fs(toFile,ensureParent));case 8:return _context22.abrupt("return",_get2(_getPrototypeOf(WebDAVResource.prototype),"copyTo",this).call(this,otherResource,ensureParent));case 9:case"end":return _context22.stop();}}},_callee22,this);}));function copyTo(_x19){return _copyTo2.apply(this,arguments);}return copyTo;}()},{key:"_copyFrom_file_nodejs_fs",value:function(){var _copyFrom_file_nodejs_fs2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee23(fromFile){var ensureParent,error,stream,toRes,_args24=arguments;return regeneratorRuntime.wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:ensureParent=_args24.length>1&&_args24[1]!==undefined?_args24[1]:true;if(!ensureParent){_context23.next=4;break;}_context23.next=4;return this.parent().ensureExistance();case 4:stream=fromFile._createReadStream();stream.on("error",function(err){return error=err;});_context23.next=8;return makeRequest(this,"PUT",stream);case 8:toRes=_context23.sent;if(!error){_context23.next=11;break;}throw error;case 11:if(!(!toRes.ok&&this.errorOnHTTPStatusCodes)){_context23.next=13;break;}throw new Error("copyTo: Cannot GET: ".concat(toRes.statusText," ").concat(toRes.status));case 13:return _context23.abrupt("return",this);case 14:case"end":return _context23.stop();}}},_callee23,this);}));function _copyFrom_file_nodejs_fs(_x20){return _copyFrom_file_nodejs_fs2.apply(this,arguments);}return _copyFrom_file_nodejs_fs;}()},{key:"_copyTo_file_nodejs_fs",value:function(){var _copyTo_file_nodejs_fs2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee24(toFile){var _this30=this;var ensureParent,fromRes,error,_args25=arguments;return regeneratorRuntime.wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:ensureParent=_args25.length>1&&_args25[1]!==undefined?_args25[1]:true;if(!ensureParent){_context24.next=4;break;}_context24.next=4;return toFile.parent().ensureExistance();case 4:_context24.next=6;return makeRequest(this,"GET");case 6:fromRes=_context24.sent;if(!(!fromRes.ok&&this.errorOnHTTPStatusCodes)){_context24.next=9;break;}throw new Error("copyTo: Cannot GET: ".concat(fromRes.statusText," ").concat(fromRes.status));case 9:return _context24.abrupt("return",new Promise(function(resolve,reject){return fromRes.body.pipe(toFile._createWriteStream()).on("error",function(err){return error=err;}).on("finish",function(){return error?reject(error):resolve(_this30);});}));case 10:case"end":return _context24.stop();}}},_callee24,this);}));function _copyTo_file_nodejs_fs(_x21){return _copyTo_file_nodejs_fs2.apply(this,arguments);}return _copyTo_file_nodejs_fs;}()},{key:"_copyTo_file_nodejs_http",value:function(){var _copyTo_file_nodejs_http2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee25(toFile){var ensureParent,fromRes,toRes,_args26=arguments;return regeneratorRuntime.wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:ensureParent=_args26.length>1&&_args26[1]!==undefined?_args26[1]:true;if(!ensureParent){_context25.next=4;break;}_context25.next=4;return toFile.parent().ensureExistance();case 4:_context25.next=6;return makeRequest(this,"GET");case 6:fromRes=_context25.sent;if(!(!fromRes.ok&&this.errorOnHTTPStatusCodes)){_context25.next=9;break;}throw new Error("copyTo: Cannot GET: ".concat(fromRes.statusText," ").concat(fromRes.status));case 9:_context25.next=11;return makeRequest(toFile,"PUT",fromRes.body);case 11:toRes=_context25.sent;if(!(!fromRes.ok&&this.errorOnHTTPStatusCodes)){_context25.next=14;break;}throw new Error("copyTo: Cannot PUT: ".concat(toRes.statusText," ").concat(toRes.status));case 14:case"end":return _context25.stop();}}},_callee25,this);}));function _copyTo_file_nodejs_http(_x22){return _copyTo_file_nodejs_http2.apply(this,arguments);}return _copyTo_file_nodejs_http;}()},{key:"isHTTPResource",get:function get(){return true;}}]);return WebDAVResource;}(Resource);var resourceExtension={name:"http-webdav-resource",matches:function matches(url){return url.startsWith("http:")||url.startsWith("https:");},resourceClass:WebDAVResource};/*global require*/var _ref19=System.get('@system-env').node?require('fs'):{},readFile=_ref19.readFile,writeFile=_ref19.writeFile,exists=_ref19.exists,readdir=_ref19.readdir,mkdir=_ref19.mkdir,rmdir=_ref19.rmdir,unlink=_ref19.unlink,lstat=_ref19.lstat,rename=_ref19.rename,createWriteStream=_ref19.createWriteStream,createReadStream=_ref19.createReadStream;/*global process*/function wrapInPromise(func){return function(){for(var _len3=arguments.length,args=new Array(_len3),_key10=0;_key10<_len3;_key10++){args[_key10]=arguments[_key10];}return new Promise(function(resolve,reject){return func.apply(null,args.concat(function(err,result){return err?reject(err):resolve(result);}));});};}var readFileP=wrapInPromise(readFile),writeFileP=wrapInPromise(writeFile),existsP=function existsP(path){return new Promise(function(resolve,_reject){return exists(path,function(exists){return resolve(!!exists);});});},readdirP=wrapInPromise(readdir),mkdirP=wrapInPromise(mkdir),rmdirP=wrapInPromise(rmdir),unlinkP=wrapInPromise(unlink),lstatP=wrapInPromise(lstat),renameP=wrapInPromise(rename);var NodeJSFileResource=/*#__PURE__*/function(_Resource2){_inherits(NodeJSFileResource,_Resource2);var _super10=_createSuper(NodeJSFileResource);function NodeJSFileResource(){_classCallCheck(this,NodeJSFileResource);return _super10.apply(this,arguments);}_createClass(NodeJSFileResource,[{key:"path",value:function path(){return this.url.replace("file://","");}},{key:"stat",value:function(){var _stat=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee26(){return regeneratorRuntime.wrap(function _callee26$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:return _context26.abrupt("return",lstatP(this.path()));case 1:case"end":return _context26.stop();}}},_callee26,this);}));function stat(){return _stat.apply(this,arguments);}return stat;}()},{key:"read",value:function(){var _read3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee27(){var readP;return regeneratorRuntime.wrap(function _callee27$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:readP=readFileP(this.path());return _context27.abrupt("return",this.binary?readP:readP.then(String));case 2:case"end":return _context27.stop();}}},_callee27,this);}));function read(){return _read3.apply(this,arguments);}return read;}()},{key:"write",value:function(){var _write3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee28(content){return regeneratorRuntime.wrap(function _callee28$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:if(!this.isDirectory()){_context28.next=2;break;}throw new Error("Cannot write into a directory: ".concat(this.path()));case 2:_context28.next=4;return writeFileP(this.path(),content);case 4:return _context28.abrupt("return",this);case 5:case"end":return _context28.stop();}}},_callee28,this);}));function write(_x23){return _write3.apply(this,arguments);}return write;}()},{key:"mkdir",value:function(){var _mkdir3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee29(){return regeneratorRuntime.wrap(function _callee29$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:if(!this.isFile()){_context29.next=2;break;}throw new Error("Cannot mkdir on a file: ".concat(this.path()));case 2:_context29.next=4;return mkdirP(this.path());case 4:return _context29.abrupt("return",this);case 5:case"end":return _context29.stop();}}},_callee29,this);}));function mkdir(){return _mkdir3.apply(this,arguments);}return mkdir;}()},{key:"exists",value:function(){var _exists3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee30(){return regeneratorRuntime.wrap(function _callee30$(_context30){while(1){switch(_context30.prev=_context30.next){case 0:return _context30.abrupt("return",this.isRoot()?true:existsP(this.path()));case 1:case"end":return _context30.stop();}}},_callee30,this);}));function exists(){return _exists3.apply(this,arguments);}return exists;}()},{key:"dirList",value:function(){var _dirList3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee31(){var depth,opts,exclude,_subResources,_iterator27,_step27,name,subResource,stat,subResources,subCollections,_args32=arguments;return regeneratorRuntime.wrap(function _callee31$(_context31){while(1){switch(_context31.prev=_context31.next){case 0:depth=_args32.length>0&&_args32[0]!==undefined?_args32[0]:1;opts=_args32.length>1&&_args32[1]!==undefined?_args32[1]:{};if(!(typeof depth!=="number"&&depth!=='infinity')){_context31.next=4;break;}throw new Error("dirList \u2013 invalid depth argument: ".concat(depth));case 4:exclude=opts.exclude;if(depth<=0)depth=1;if(!(depth===1)){_context31.next=36;break;}_subResources=[];_context31.t0=_createForOfIteratorHelper;_context31.next=11;return readdirP(this.path());case 11:_context31.t1=_context31.sent;_iterator27=(0,_context31.t0)(_context31.t1);_context31.prev=13;_iterator27.s();case 15:if((_step27=_iterator27.n()).done){_context31.next=26;break;}name=_step27.value;subResource=this.join(name);_context31.next=20;return subResource.stat();case 20:stat=_context31.sent;subResource=stat.isDirectory()?subResource.asDirectory():subResource;subResource._assignPropsFromStat(stat);_subResources.push(subResource);case 24:_context31.next=15;break;case 26:_context31.next=31;break;case 28:_context31.prev=28;_context31.t2=_context31["catch"](13);_iterator27.e(_context31.t2);case 31:_context31.prev=31;_iterator27.f();return _context31.finish(31);case 34:if(exclude)_subResources=applyExclude(exclude,_subResources);return _context31.abrupt("return",_subResources);case 36:_context31.next=38;return this.dirList(1,opts);case 38:subResources=_context31.sent;subCollections=subResources.filter(function(ea){return ea.isDirectory();});return _context31.abrupt("return",Promise.all(subCollections.map(function(col){return col.dirList(typeof depth==="number"?depth-1:depth,opts);})).then(function(recursiveResult){return recursiveResult.reduce(function(all,ea){return all.concat(ea);},subResources);}));case 41:case"end":return _context31.stop();}}},_callee31,this,[[13,28,31,34]]);}));function dirList(){return _dirList3.apply(this,arguments);}return dirList;}()},{key:"isEmptyDirectory",value:function(){var _isEmptyDirectory=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee32(){return regeneratorRuntime.wrap(function _callee32$(_context32){while(1){switch(_context32.prev=_context32.next){case 0:_context32.next=2;return this.dirList();case 2:_context32.t0=_context32.sent.length;return _context32.abrupt("return",_context32.t0===0);case 4:case"end":return _context32.stop();}}},_callee32,this);}));function isEmptyDirectory(){return _isEmptyDirectory.apply(this,arguments);}return isEmptyDirectory;}()},{key:"rename",value:function(){var _rename2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee33(toResource){var files,dirs,_iterator28,_step28,subR,_i71,_dirs,subdir,_i72,_files,file;return regeneratorRuntime.wrap(function _callee33$(_context33){while(1){switch(_context33.prev=_context33.next){case 0:if(toResource instanceof this.constructor){_context33.next=2;break;}return _context33.abrupt("return",_get2(_getPrototypeOf(NodeJSFileResource.prototype),"rename",this).call(this,toResource));case 2:if(!this.isFile()){_context33.next=7;break;}toResource=toResource.asFile();renameP(this.path(),toResource.path());_context33.next=35;break;case 7:toResource=toResource.asDirectory();_context33.next=10;return toResource.ensureExistance();case 10:files=[],dirs=[];_context33.t0=_createForOfIteratorHelper;_context33.next=14;return this.dirList("infinity");case 14:_context33.t1=_context33.sent;_iterator28=(0,_context33.t0)(_context33.t1);try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){subR=_step28.value;if(subR.isDirectory())dirs.push(subR);else files.push(subR);}}catch(err){_iterator28.e(err);}finally{_iterator28.f();}_i71=0,_dirs=dirs;case 18:if(!(_i71<_dirs.length)){_context33.next=25;break;}subdir=_dirs[_i71];_context33.next=22;return toResource.join(subdir.relativePathFrom(this)).ensureExistance();case 22:_i71++;_context33.next=18;break;case 25:_i72=0,_files=files;case 26:if(!(_i72<_files.length)){_context33.next=33;break;}file=_files[_i72];_context33.next=30;return file.rename(toResource.join(file.relativePathFrom(this)));case 30:_i72++;_context33.next=26;break;case 33:_context33.next=35;return this.remove();case 35:return _context33.abrupt("return",toResource);case 36:case"end":return _context33.stop();}}},_callee33,this);}));function rename(_x24){return _rename2.apply(this,arguments);}return rename;}()},{key:"remove",value:function(){var _remove3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee34(){var _iterator29,_step29,subResource;return regeneratorRuntime.wrap(function _callee34$(_context34){while(1){switch(_context34.prev=_context34.next){case 0:_context34.next=2;return this.exists();case 2:if(_context34.sent){_context34.next=6;break;};_context34.next=34;break;case 6:if(!this.isDirectory()){_context34.next=32;break;}_context34.t0=_createForOfIteratorHelper;_context34.next=10;return this.dirList();case 10:_context34.t1=_context34.sent;_iterator29=(0,_context34.t0)(_context34.t1);_context34.prev=12;_iterator29.s();case 14:if((_step29=_iterator29.n()).done){_context34.next=20;break;}subResource=_step29.value;_context34.next=18;return subResource.remove();case 18:_context34.next=14;break;case 20:_context34.next=25;break;case 22:_context34.prev=22;_context34.t2=_context34["catch"](12);_iterator29.e(_context34.t2);case 25:_context34.prev=25;_iterator29.f();return _context34.finish(25);case 28:_context34.next=30;return rmdirP(this.path());case 30:_context34.next=34;break;case 32:_context34.next=34;return unlinkP(this.path());case 34:return _context34.abrupt("return",this);case 35:case"end":return _context34.stop();}}},_callee34,this,[[12,22,25,28]]);}));function remove(){return _remove3.apply(this,arguments);}return remove;}()},{key:"readProperties",value:function(){var _readProperties3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee35(){return regeneratorRuntime.wrap(function _callee35$(_context35){while(1){switch(_context35.prev=_context35.next){case 0:_context35.t0=this;_context35.next=3;return this.stat();case 3:_context35.t1=_context35.sent;return _context35.abrupt("return",_context35.t0._assignPropsFromStat.call(_context35.t0,_context35.t1));case 5:case"end":return _context35.stop();}}},_callee35,this);}));function readProperties(){return _readProperties3.apply(this,arguments);}return readProperties;}()},{key:"copyTo",value:function(){var _copyTo3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee36(otherResource){var ensureParent,toFile,_args37=arguments;return regeneratorRuntime.wrap(function _callee36$(_context36){while(1){switch(_context36.prev=_context36.next){case 0:ensureParent=_args37.length>1&&_args37[1]!==undefined?_args37[1]:true;if(!this.isFile()){_context36.next=5;break;}toFile=otherResource.isFile()?otherResource:otherResource.join(this.name());// optimized copy, using pipes, for HTTP
if(!toFile.isHTTPResource){_context36.next=5;break;}return _context36.abrupt("return",toFile._copyFrom_file_nodejs_fs(this,ensureParent=true));case 5:return _context36.abrupt("return",_get2(_getPrototypeOf(NodeJSFileResource.prototype),"copyTo",this).call(this,otherResource,ensureParent));case 6:case"end":return _context36.stop();}}},_callee36,this);}));function copyTo(_x25){return _copyTo3.apply(this,arguments);}return copyTo;}()},{key:"_assignPropsFromStat",value:function _assignPropsFromStat(stat){return this.assignProperties({lastModified:stat.mtime,created:stat.ctime,size:stat.size,type:stat.isDirectory()?"directory":"file",isLink:stat.isSymbolicLink()});}},{key:"_createWriteStream",value:function _createWriteStream(){return createWriteStream(this.path());}},{key:"_createReadStream",value:function _createReadStream(){return createReadStream(this.path());}},{key:"isNodeJSFileResource",get:function get(){return true;}}]);return NodeJSFileResource;}(Resource);var NodeJSWindowsFileResource=/*#__PURE__*/function(_NodeJSFileResource){_inherits(NodeJSWindowsFileResource,_NodeJSFileResource);var _super11=_createSuper(NodeJSWindowsFileResource);function NodeJSWindowsFileResource(url,opts){_classCallCheck(this,NodeJSWindowsFileResource);// rkrk 2019-10-31:
// Windows file uris have three slashes. Since we have used
// file:// throughout the code base we introduce this as a
// single point fix for the time being...
var prefix=url.slice(0,8);if(prefix!=="file:///"&&url.slice(0,7)==="file://"){url="file:///"+url.slice(7);}if(url.includes("\\")){url=url.replace(/\\/g,"/");}return _super11.call(this,url,opts);}_createClass(NodeJSWindowsFileResource,[{key:"path",value:function path(){return this.url.replace("file:///","");}},{key:"isRoot",value:function isRoot(){return!!this.path().match(windowsRootPathRe);}},{key:"root",value:function root(){if(this.isRoot())return this;console.log(this.url);var toplevelMatch=this.url.match(windowsURLPrefixRe);if(toplevelMatch)return this.newResource(toplevelMatch[0]);throw new Error("Could not determine root path of windows file resource for url "+this.url);}}]);return NodeJSWindowsFileResource;}(NodeJSFileResource);var resourceExtension$1={name:"nodejs-file-resource",matches:function matches(url){return url.startsWith("file:");},resourceClass:typeof process!="undefined"&&process.platform==="win32"?NodeJSWindowsFileResource:NodeJSFileResource};var slashRe=/\//g;function applyExclude$1(resource,exclude){if(!exclude)return true;if(typeof exclude==="string")return!resource.url.includes(exclude);if(typeof exclude==="function")return!exclude(resource);if(exclude instanceof RegExp)return!exclude.test(resource.url);return true;}var LocalResourceInMemoryBackend=/*#__PURE__*/function(){_createClass(LocalResourceInMemoryBackend,null,[{key:"removeHost",value:function removeHost(name){delete this.hosts[name];}},{key:"ensure",value:function ensure(filespec){var _this31=this;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var host=this.named(options.host);return Promise.resolve().then(function(){return filespec?createFiles("local://".concat(host.name),filespec):null;}).then(function(){return _this31;});}},{key:"named",value:function named(name){if(!name)name="default";return this.hosts[name]||(this.hosts[name]=new this(name));}},{key:"hosts",get:function get(){return this._hosts||(this._hosts={});}}]);function LocalResourceInMemoryBackend(name){var filespec=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,LocalResourceInMemoryBackend);if(!name||typeof name!=="string")throw new Error("LocalResourceInMemoryBackend needs name!");this.name=name;this._filespec=filespec;}_createClass(LocalResourceInMemoryBackend,[{key:"get",value:function get(path){return this._filespec[path];}},{key:"set",value:function set(path,spec){this._filespec[path]=spec;}},{key:"write",value:function write(path,content){var spec=this._filespec[path];if(!spec)spec=this._filespec[path]={created:new Date()};spec.content=content;spec.isDirectory=false;spec.lastModified=new Date();}},{key:"read",value:function read(path){var spec=this._filespec[path];return!spec||!spec.content?"":spec.content;}},{key:"mkdir",value:function mkdir(path){var spec=this._filespec[path];if(spec&&spec.isDirectory)return;if(!spec)spec=this._filespec[path]={created:new Date()};if(spec.content)delete spec.content;spec.isDirectory=true;spec.lastModified=new Date();}},{key:"partialFilespec",value:function partialFilespec(){var path=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"/";var depth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Infinity;var result={},filespec=this.filespec,paths=Object.keys(filespec);for(var _i73=0;_i73<paths.length;_i73++){var childPath=paths[_i73];if(!childPath.startsWith(path)||path===childPath)continue;var trailing=childPath.slice(path.length),childDepth=trailing.includes("/")?trailing.match(slashRe).length+1:1;if(childDepth>depth)continue;result[childPath]=filespec[childPath];}return result;}},{key:"filespec",get:function get(){return this._filespec;},set:function set(filespec){this._filespec=filespec;}}]);return LocalResourceInMemoryBackend;}();var LocalResource=/*#__PURE__*/function(_Resource3){_inherits(LocalResource,_Resource3);var _super12=_createSuper(LocalResource);function LocalResource(){_classCallCheck(this,LocalResource);return _super12.apply(this,arguments);}_createClass(LocalResource,[{key:"read",value:function read(){return Promise.resolve(this.localBackend.read(this.path()));}},{key:"write",value:function write(content){if(this.isDirectory())throw new Error("Cannot write into a directory! (".concat(this.url,")"));var spec=this.localBackend.get(this.path());if(spec&&spec.isDirectory)throw new Error("".concat(this.url," already exists and is a directory (cannot write into it!)"));this.localBackend.write(this.path(),content);return Promise.resolve(this);}},{key:"mkdir",value:function mkdir(){if(!this.isDirectory())throw new Error("Cannot mkdir a file! (".concat(this.url,")"));var spec=this.localBackend.get(this.path());if(spec&&spec.isDirectory)return Promise.resolve(this);if(spec&&!spec.isDirectory)throw new Error("".concat(this.url," already exists and is a file (cannot mkdir it!)"));this.localBackend.mkdir(this.path());return Promise.resolve(this);}},{key:"exists",value:function exists(){return Promise.resolve(this.isRoot()||this.path()in this.localBackend.filespec);}},{key:"remove",value:function remove(){var _this32=this;var thisPath=this.path();Object.keys(this.localBackend.filespec).forEach(function(path){return path.startsWith(thisPath)&&delete _this32.localBackend.filespec[path];});return Promise.resolve(this);}},{key:"readProperties",value:function readProperties(){throw new Error("not yet implemented");}},{key:"dirList",value:function dirList(){var _this33=this;var depth=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!this.isDirectory())return this.asDirectory().dirList(depth,opts);var exclude=opts.exclude,prefix=this.path(),children=[],paths=Object.keys(this.localBackend.filespec);if(depth==="infinity")depth=Infinity;for(var _i74=0;_i74<paths.length;_i74++){var childPath=paths[_i74];if(!childPath.startsWith(prefix)||prefix===childPath)continue;var trailing=childPath.slice(prefix.length),childDepth=trailing.includes("/")?trailing.match(slashRe).length+1:1;if(childDepth>depth){var _ret5=function(){// add the dir pointing to child
var dirToChild=_this33.join(trailing.split("/").slice(0,depth).join("/")+"/");if(!children.some(function(ea){return ea.equals(dirToChild);}))children.push(dirToChild);return"continue";}();if(_ret5==="continue")continue;}var child=this.join(trailing);if(!exclude||applyExclude$1(child,exclude))children.push(child);}return Promise.resolve(children);}},{key:"localBackend",get:function get(){return LocalResourceInMemoryBackend.named(this.host());}}]);return LocalResource;}(Resource);var resourceExtension$2={name:"local-resource",matches:function matches(url){return url.startsWith("local:");},resourceClass:LocalResource};/*global System,babel*/registerExtension(resourceExtension$2);registerExtension(resourceExtension);registerExtension(resourceExtension$1);function loadViaScript(url,onLoadCb){// load JS code by inserting a <script src="..." /> tag into the
// DOM. This allows cross domain script loading and JSONP
var parentNode=document.head,xmlNamespace=parentNode.namespaceURI,SVGNamespace="http://www.w3.org/2000/svg",XLINKNamespace="http://www.w3.org/1999/xlink";return new Promise(function(resolve,reject){var script=document.createElementNS(xmlNamespace,'script');{script.setAttribute('type','text/ecmascript');}parentNode.appendChild(script);script.setAttributeNS(null,'id',url);script.namespaceURI===SVGNamespace?script.setAttributeNS(XLINKNamespace,'href',url):script.setAttribute('src',url);script.onload=resolve;script.onerror=reject;script.setAttributeNS(null,'async',true);});}var __varRecorder__$b=lively.FreezerRuntime.recorderFor("lively.morphic/helpers.js");function pathForBrowserHistory(worldName,queryString){if(!queryString){queryString=typeof document!=="undefined"?document.location.search:"";}queryString=queryString.trim();var query;if(!queryString||queryString==="?")query={};else query=__varRecorder__$b.parseQuery(queryString);var basePath="/worlds/load";if(worldName.endsWith(".json")){query.file=worldName;delete query.name;}else{delete query.file;query.name=worldName;}return"".concat(basePath,"?").concat(__varRecorder__$b.stringifyQuery(query));}__varRecorder__$b.pathForBrowserHistory=pathForBrowserHistory;function addClassMappings(mapping){Object.assign(__varRecorder__$b.nameToClassMapping,mapping);}__varRecorder__$b.addClassMappings=addClassMappings;function morph(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{restore:false};var klass=__varRecorder__$b.nameToClassMapping["default"];if(props.type){if(typeof props.type==="function")klass=props.type;if(_typeof2(props.type)==="object")klass=__varRecorder__$b.locateClass(props.type);else if(typeof props.type==="string"){klass=__varRecorder__$b.nameToClassMapping[props.type.toLowerCase()]||klass;}}return opts.restore?new klass(_defineProperty({},Symbol["for"]("lively-instance-restorer"),true)).initFromJSON(props):new klass(props);}__varRecorder__$b.morph=morph;function newMorphId(classOrClassName){var prefix=typeof classOrClassName==="function"?classOrClassName[Symbol["for"]("__LivelyClassName__")]:typeof classOrClassName==="string"?classOrClassName.toLowerCase():"";return prefix+"_"+__varRecorder__$b.string.newUUID().replace(/-/g,"_");}__varRecorder__$b.newMorphId=newMorphId;function lazyInspect(_x26){return _lazyInspect.apply(this,arguments);}function _lazyInspect(){_lazyInspect=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee205(obj){var _yield$System$import11,realInspect;return regeneratorRuntime.wrap(function _callee205$(_context205){while(1){switch(_context205.prev=_context205.next){case 0:_context205.next=2;return System["import"]("lively.ide/js/inspector.js");case 2:_yield$System$import11=_context205.sent;realInspect=_yield$System$import11.inspect;__varRecorder__$b.inspect=realInspect;return _context205.abrupt("return",realInspect(obj));case 6:case"end":return _context205.stop();}}},_callee205);}));return _lazyInspect.apply(this,arguments);}__varRecorder__$b.lazyInspect=lazyInspect;__varRecorder__$b.locateClass=locateClass;__varRecorder__$b.string=string;__varRecorder__$b.parseQuery=parseQuery;__varRecorder__$b.stringifyQuery=stringifyQuery;__varRecorder__$b.touchInput=__varRecorder__$b.touchInput||undefined;try{document.createEvent("TouchEvent");__varRecorder__$b.touchInput=true;}catch(e){__varRecorder__$b.touchInput=false;}var touchInputDevice=exports('t',__varRecorder__$b.touchInput);__varRecorder__$b.touchInputDevice=touchInputDevice;__varRecorder__$b.touchInputDevice=touchInputDevice;__varRecorder__$b.touchInputDevice=touchInputDevice;__varRecorder__$b.nameToClassMapping=__varRecorder__$b.nameToClassMapping||{};__varRecorder__$b.pathForBrowserHistory=pathForBrowserHistory;__varRecorder__$b.pathForBrowserHistory=pathForBrowserHistory;__varRecorder__$b.addClassMappings=addClassMappings;__varRecorder__$b.addClassMappings=addClassMappings;__varRecorder__$b.morph=morph;__varRecorder__$b.morph=morph;__varRecorder__$b.newMorphId=newMorphId;__varRecorder__$b.newMorphId=newMorphId;var inspect$1=__varRecorder__$b.lazyInspect;__varRecorder__$b.inspect=inspect$1;__varRecorder__$b.inspect=inspect$1;__varRecorder__$b.inspect=inspect$1;var __varRecorder__$c=lively.FreezerRuntime.recorderFor("lively.morphic/text/icons.js");__varRecorder__$c.obj=obj;__varRecorder__$c.morph=morph;var Icon=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/icons.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Icon")&&typeof __lively_classholder__.Icon==="function"?__lively_classholder__.Icon:__lively_classholder__.Icon=function Icon(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,undefined,[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Icon";}},{key:"makeLabel",value:function Icon_makeLabel_(iconName){var props=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{prefix:"",suffix:""};var prefix=props.prefix,suffix=props.suffix;var textAndAttributes=[];if(prefix)textAndAttributes.push.apply(textAndAttributes,_toConsumableArray2(typeof prefix==="string"?[prefix||"",{}]:prefix));textAndAttributes.push.apply(textAndAttributes,_toConsumableArray2(this.textAttribute(iconName,__varRecorder__$c.obj.dissoc(props,["fontSize"]))));if(suffix)textAndAttributes.push.apply(textAndAttributes,_toConsumableArray2(typeof suffix==="string"?[suffix||"",{}]:suffix));return __varRecorder__$c.morph(Object.assign({type:"label",value:textAndAttributes},__varRecorder__$c.obj.dissoc(props,["prefix","suffix"])));}},{key:"textAttribute",value:function Icon_textAttribute_(iconName){var attrs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var isFar=attrs.textStyleClasses&&attrs.textStyleClasses.includes("far");return[__varRecorder__$c.Icons[iconName].code||"icon ".concat(iconName," not found"),Object.assign({fontFamily:"\"Font Awesome 5 Free\", \"Font Awesome 5 Brands\"",fontWeight:isFar?"400":"900",textStyleClasses:["fas"]},attrs)];}},{key:"setIcon",value:function Icon_setIcon_(label,iconName){label.textAndAttributes=this.textAttribute(iconName);}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/icons.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:683,end:1811});}(undefined);__varRecorder__$c.Icon=Icon;__varRecorder__$c.Icon=Icon;__varRecorder__$c.Icon=Icon;var Icons={"500px":{code:"\uF26E"},"accessible-icon":{code:"\uF368"},"accusoft":{code:"\uF369"},"acquisitions-incorporated":{code:"\uF6AF"},"ad":{code:"\uF641"},"address-book":{code:"\uF2B9"},"address-card":{code:"\uF2BB"},"adjust":{code:"\uF042"},"adn":{code:"\uF170"},"adobe":{code:"\uF778"},"adversal":{code:"\uF36A"},"affiliatetheme":{code:"\uF36B"},"air-freshener":{code:"\uF5D0"},"airbnb":{code:"\uF834"},"algolia":{code:"\uF36C"},"align-center":{code:"\uF037"},"align-justify":{code:"\uF039"},"align-left":{code:"\uF036"},"align-right":{code:"\uF038"},"alipay":{code:"\uF642"},"allergies":{code:"\uF461"},"amazon":{code:"\uF270"},"amazon-pay":{code:"\uF42C"},"ambulance":{code:"\uF0F9"},"american-sign-language-interpreting":{code:"\uF2A3"},"amilia":{code:"\uF36D"},"anchor":{code:"\uF13D"},"android":{code:"\uF17B"},"angellist":{code:"\uF209"},"angle-double-down":{code:"\uF103"},"angle-double-left":{code:"\uF100"},"angle-double-right":{code:"\uF101"},"angle-double-up":{code:"\uF102"},"angle-down":{code:"\uF107"},"angle-left":{code:"\uF104"},"angle-right":{code:"\uF105"},"angle-up":{code:"\uF106"},"angry":{code:"\uF556"},"angrycreative":{code:"\uF36E"},"angular":{code:"\uF420"},"ankh":{code:"\uF644"},"app-store":{code:"\uF36F"},"app-store-ios":{code:"\uF370"},"apper":{code:"\uF371"},"apple":{code:"\uF179"},"apple-alt":{code:"\uF5D1"},"apple-pay":{code:"\uF415"},"archive":{code:"\uF187"},"archway":{code:"\uF557"},"arrow-alt-circle-down":{code:"\uF358"},"arrow-alt-circle-left":{code:"\uF359"},"arrow-alt-circle-right":{code:"\uF35A"},"arrow-alt-circle-up":{code:"\uF35B"},"arrow-circle-down":{code:"\uF0AB"},"arrow-circle-left":{code:"\uF0A8"},"arrow-circle-right":{code:"\uF0A9"},"arrow-circle-up":{code:"\uF0AA"},"arrow-down":{code:"\uF063"},"arrow-left":{code:"\uF060"},"arrow-right":{code:"\uF061"},"arrow-up":{code:"\uF062"},"arrows-alt":{code:"\uF0B2"},"arrows-alt-h":{code:"\uF337"},"arrows-alt-v":{code:"\uF338"},"artstation":{code:"\uF77A"},"assistive-listening-systems":{code:"\uF2A2"},"asterisk":{code:"\uF069"},"asymmetrik":{code:"\uF372"},"at":{code:"\uF1FA"},"atlas":{code:"\uF558"},"atlassian":{code:"\uF77B"},"atom":{code:"\uF5D2"},"audible":{code:"\uF373"},"audio-description":{code:"\uF29E"},"autoprefixer":{code:"\uF41C"},"avianex":{code:"\uF374"},"aviato":{code:"\uF421"},"award":{code:"\uF559"},"aws":{code:"\uF375"},"baby":{code:"\uF77C"},"baby-carriage":{code:"\uF77D"},"backspace":{code:"\uF55A"},"backward":{code:"\uF04A"},"bacon":{code:"\uF7E5"},"bahai":{code:"\uF666"},"balance-scale":{code:"\uF24E"},"balance-scale-left":{code:"\uF515"},"balance-scale-right":{code:"\uF516"},"ban":{code:"\uF05E"},"band-aid":{code:"\uF462"},"bandcamp":{code:"\uF2D5"},"barcode":{code:"\uF02A"},"bars":{code:"\uF0C9"},"baseball-ball":{code:"\uF433"},"basketball-ball":{code:"\uF434"},"bath":{code:"\uF2CD"},"battery-empty":{code:"\uF244"},"battery-full":{code:"\uF240"},"battery-half":{code:"\uF242"},"battery-quarter":{code:"\uF243"},"battery-three-quarters":{code:"\uF241"},"battle-net":{code:"\uF835"},"bed":{code:"\uF236"},"beer":{code:"\uF0FC"},"behance":{code:"\uF1B4"},"behance-square":{code:"\uF1B5"},"bell":{code:"\uF0F3"},"bell-slash":{code:"\uF1F6"},"bezier-curve":{code:"\uF55B"},"bible":{code:"\uF647"},"bicycle":{code:"\uF206"},"biking":{code:"\uF84A"},"bimobject":{code:"\uF378"},"binoculars":{code:"\uF1E5"},"biohazard":{code:"\uF780"},"birthday-cake":{code:"\uF1FD"},"bitbucket":{code:"\uF171"},"bitcoin":{code:"\uF379"},"bity":{code:"\uF37A"},"black-tie":{code:"\uF27E"},"blackberry":{code:"\uF37B"},"blender":{code:"\uF517"},"blender-phone":{code:"\uF6B6"},"blind":{code:"\uF29D"},"blog":{code:"\uF781"},"blogger":{code:"\uF37C"},"blogger-b":{code:"\uF37D"},"bluetooth":{code:"\uF293"},"bluetooth-b":{code:"\uF294"},"bold":{code:"\uF032"},"bolt":{code:"\uF0E7"},"bomb":{code:"\uF1E2"},"bone":{code:"\uF5D7"},"bong":{code:"\uF55C"},"book":{code:"\uF02D"},"book-dead":{code:"\uF6B7"},"book-medical":{code:"\uF7E6"},"book-open":{code:"\uF518"},"book-reader":{code:"\uF5DA"},"bookmark":{code:"\uF02E"},"bootstrap":{code:"\uF836"},"border-all":{code:"\uF84C"},"border-none":{code:"\uF850"},"border-style":{code:"\uF853"},"bowling-ball":{code:"\uF436"},"box":{code:"\uF466"},"box-open":{code:"\uF49E"},"boxes":{code:"\uF468"},"braille":{code:"\uF2A1"},"brain":{code:"\uF5DC"},"bread-slice":{code:"\uF7EC"},"briefcase":{code:"\uF0B1"},"briefcase-medical":{code:"\uF469"},"broadcast-tower":{code:"\uF519"},"broom":{code:"\uF51A"},"brush":{code:"\uF55D"},"btc":{code:"\uF15A"},"buffer":{code:"\uF837"},"bug":{code:"\uF188"},"building":{code:"\uF1AD"},"bullhorn":{code:"\uF0A1"},"bullseye":{code:"\uF140"},"burn":{code:"\uF46A"},"buromobelexperte":{code:"\uF37F"},"bus":{code:"\uF207"},"bus-alt":{code:"\uF55E"},"business-time":{code:"\uF64A"},"buy-n-large":{code:"\uF8A6"},"buysellads":{code:"\uF20D"},"calculator":{code:"\uF1EC"},"calendar":{code:"\uF133"},"calendar-alt":{code:"\uF073"},"calendar-check":{code:"\uF274"},"calendar-day":{code:"\uF783"},"calendar-minus":{code:"\uF272"},"calendar-plus":{code:"\uF271"},"calendar-times":{code:"\uF273"},"calendar-week":{code:"\uF784"},"camera":{code:"\uF030"},"camera-retro":{code:"\uF083"},"campground":{code:"\uF6BB"},"canadian-maple-leaf":{code:"\uF785"},"candy-cane":{code:"\uF786"},"cannabis":{code:"\uF55F"},"capsules":{code:"\uF46B"},"car":{code:"\uF1B9"},"car-alt":{code:"\uF5DE"},"car-battery":{code:"\uF5DF"},"car-crash":{code:"\uF5E1"},"car-side":{code:"\uF5E4"},"caravan":{code:"\uF8FF"},"caret-down":{code:"\uF0D7"},"caret-left":{code:"\uF0D9"},"caret-right":{code:"\uF0DA"},"caret-square-down":{code:"\uF150"},"caret-square-left":{code:"\uF191"},"caret-square-right":{code:"\uF152"},"caret-square-up":{code:"\uF151"},"caret-up":{code:"\uF0D8"},"carrot":{code:"\uF787"},"cart-arrow-down":{code:"\uF218"},"cart-plus":{code:"\uF217"},"cash-register":{code:"\uF788"},"cat":{code:"\uF6BE"},"cc-amazon-pay":{code:"\uF42D"},"cc-amex":{code:"\uF1F3"},"cc-apple-pay":{code:"\uF416"},"cc-diners-club":{code:"\uF24C"},"cc-discover":{code:"\uF1F2"},"cc-jcb":{code:"\uF24B"},"cc-mastercard":{code:"\uF1F1"},"cc-paypal":{code:"\uF1F4"},"cc-stripe":{code:"\uF1F5"},"cc-visa":{code:"\uF1F0"},"centercode":{code:"\uF380"},"centos":{code:"\uF789"},"certificate":{code:"\uF0A3"},"chair":{code:"\uF6C0"},"chalkboard":{code:"\uF51B"},"chalkboard-teacher":{code:"\uF51C"},"charging-station":{code:"\uF5E7"},"chart-area":{code:"\uF1FE"},"chart-bar":{code:"\uF080"},"chart-line":{code:"\uF201"},"chart-pie":{code:"\uF200"},"check":{code:"\uF00C"},"check-circle":{code:"\uF058"},"check-double":{code:"\uF560"},"check-square":{code:"\uF14A"},"cheese":{code:"\uF7EF"},"chess":{code:"\uF439"},"chess-bishop":{code:"\uF43A"},"chess-board":{code:"\uF43C"},"chess-king":{code:"\uF43F"},"chess-knight":{code:"\uF441"},"chess-pawn":{code:"\uF443"},"chess-queen":{code:"\uF445"},"chess-rook":{code:"\uF447"},"chevron-circle-down":{code:"\uF13A"},"chevron-circle-left":{code:"\uF137"},"chevron-circle-right":{code:"\uF138"},"chevron-circle-up":{code:"\uF139"},"chevron-down":{code:"\uF078"},"chevron-left":{code:"\uF053"},"chevron-right":{code:"\uF054"},"chevron-up":{code:"\uF077"},"child":{code:"\uF1AE"},"chrome":{code:"\uF268"},"chromecast":{code:"\uF838"},"church":{code:"\uF51D"},"circle":{code:"\uF111"},"circle-notch":{code:"\uF1CE"},"city":{code:"\uF64F"},"clinic-medical":{code:"\uF7F2"},"clipboard":{code:"\uF328"},"clipboard-check":{code:"\uF46C"},"clipboard-list":{code:"\uF46D"},"clock":{code:"\uF017"},"clone":{code:"\uF24D"},"closed-captioning":{code:"\uF20A"},"cloud":{code:"\uF0C2"},"cloud-download-alt":{code:"\uF381"},"cloud-meatball":{code:"\uF73B"},"cloud-moon":{code:"\uF6C3"},"cloud-moon-rain":{code:"\uF73C"},"cloud-rain":{code:"\uF73D"},"cloud-showers-heavy":{code:"\uF740"},"cloud-sun":{code:"\uF6C4"},"cloud-sun-rain":{code:"\uF743"},"cloud-upload-alt":{code:"\uF382"},"cloudscale":{code:"\uF383"},"cloudsmith":{code:"\uF384"},"cloudversify":{code:"\uF385"},"cocktail":{code:"\uF561"},"code":{code:"\uF121"},"code-branch":{code:"\uF126"},"codepen":{code:"\uF1CB"},"codiepie":{code:"\uF284"},"coffee":{code:"\uF0F4"},"cog":{code:"\uF013"},"cogs":{code:"\uF085"},"coins":{code:"\uF51E"},"columns":{code:"\uF0DB"},"comment":{code:"\uF075"},"comment-alt":{code:"\uF27A"},"comment-dollar":{code:"\uF651"},"comment-dots":{code:"\uF4AD"},"comment-medical":{code:"\uF7F5"},"comment-slash":{code:"\uF4B3"},"comments":{code:"\uF086"},"comments-dollar":{code:"\uF653"},"compact-disc":{code:"\uF51F"},"compass":{code:"\uF14E"},"compress":{code:"\uF066"},"compress-alt":{code:"\uF422"},"compress-arrows-alt":{code:"\uF78C"},"concierge-bell":{code:"\uF562"},"confluence":{code:"\uF78D"},"connectdevelop":{code:"\uF20E"},"contao":{code:"\uF26D"},"cookie":{code:"\uF563"},"cookie-bite":{code:"\uF564"},"copy":{code:"\uF0C5"},"copyright":{code:"\uF1F9"},"cotton-bureau":{code:"\uF89E"},"couch":{code:"\uF4B8"},"cpanel":{code:"\uF388"},"creative-commons":{code:"\uF25E"},"creative-commons-by":{code:"\uF4E7"},"creative-commons-nc":{code:"\uF4E8"},"creative-commons-nc-eu":{code:"\uF4E9"},"creative-commons-nc-jp":{code:"\uF4EA"},"creative-commons-nd":{code:"\uF4EB"},"creative-commons-pd":{code:"\uF4EC"},"creative-commons-pd-alt":{code:"\uF4ED"},"creative-commons-remix":{code:"\uF4EE"},"creative-commons-sa":{code:"\uF4EF"},"creative-commons-sampling":{code:"\uF4F0"},"creative-commons-sampling-plus":{code:"\uF4F1"},"creative-commons-share":{code:"\uF4F2"},"creative-commons-zero":{code:"\uF4F3"},"credit-card":{code:"\uF09D"},"critical-role":{code:"\uF6C9"},"crop":{code:"\uF125"},"crop-alt":{code:"\uF565"},"cross":{code:"\uF654"},"crosshairs":{code:"\uF05B"},"crow":{code:"\uF520"},"crown":{code:"\uF521"},"crutch":{code:"\uF7F7"},"css3":{code:"\uF13C"},"css3-alt":{code:"\uF38B"},"cube":{code:"\uF1B2"},"cubes":{code:"\uF1B3"},"cut":{code:"\uF0C4"},"cuttlefish":{code:"\uF38C"},"d-and-d":{code:"\uF38D"},"d-and-d-beyond":{code:"\uF6CA"},"dailymotion":{code:""},"dashcube":{code:"\uF210"},"database":{code:"\uF1C0"},"deaf":{code:"\uF2A4"},"delicious":{code:"\uF1A5"},"democrat":{code:"\uF747"},"deploydog":{code:"\uF38E"},"deskpro":{code:"\uF38F"},"desktop":{code:"\uF108"},"dev":{code:"\uF6CC"},"deviantart":{code:"\uF1BD"},"dharmachakra":{code:"\uF655"},"dhl":{code:"\uF790"},"diagnoses":{code:"\uF470"},"diaspora":{code:"\uF791"},"dice":{code:"\uF522"},"dice-d20":{code:"\uF6CF"},"dice-d6":{code:"\uF6D1"},"dice-five":{code:"\uF523"},"dice-four":{code:"\uF524"},"dice-one":{code:"\uF525"},"dice-six":{code:"\uF526"},"dice-three":{code:"\uF527"},"dice-two":{code:"\uF528"},"digg":{code:"\uF1A6"},"digital-ocean":{code:"\uF391"},"digital-tachograph":{code:"\uF566"},"directions":{code:"\uF5EB"},"discord":{code:"\uF392"},"discourse":{code:"\uF393"},"divide":{code:"\uF529"},"dizzy":{code:"\uF567"},"dna":{code:"\uF471"},"dochub":{code:"\uF394"},"docker":{code:"\uF395"},"dog":{code:"\uF6D3"},"dollar-sign":{code:"\uF155"},"dolly":{code:"\uF472"},"dolly-flatbed":{code:"\uF474"},"donate":{code:"\uF4B9"},"door-closed":{code:"\uF52A"},"door-open":{code:"\uF52B"},"dot-circle":{code:"\uF192"},"dove":{code:"\uF4BA"},"download":{code:"\uF019"},"draft2digital":{code:"\uF396"},"drafting-compass":{code:"\uF568"},"dragon":{code:"\uF6D5"},"draw-polygon":{code:"\uF5EE"},"dribbble":{code:"\uF17D"},"dribbble-square":{code:"\uF397"},"dropbox":{code:"\uF16B"},"drum":{code:"\uF569"},"drum-steelpan":{code:"\uF56A"},"drumstick-bite":{code:"\uF6D7"},"drupal":{code:"\uF1A9"},"dumbbell":{code:"\uF44B"},"dumpster":{code:"\uF793"},"dumpster-fire":{code:"\uF794"},"dungeon":{code:"\uF6D9"},"dyalog":{code:"\uF399"},"earlybirds":{code:"\uF39A"},"ebay":{code:"\uF4F4"},"edge":{code:"\uF282"},"edit":{code:"\uF044"},"egg":{code:"\uF7FB"},"eject":{code:"\uF052"},"elementor":{code:"\uF430"},"ellipsis-h":{code:"\uF141"},"ellipsis-v":{code:"\uF142"},"ello":{code:"\uF5F1"},"ember":{code:"\uF423"},"empire":{code:"\uF1D1"},"envelope":{code:"\uF0E0"},"envelope-open":{code:"\uF2B6"},"envelope-open-text":{code:"\uF658"},"envelope-square":{code:"\uF199"},"envira":{code:"\uF299"},"equals":{code:"\uF52C"},"eraser":{code:"\uF12D"},"erlang":{code:"\uF39D"},"ethereum":{code:"\uF42E"},"ethernet":{code:"\uF796"},"etsy":{code:"\uF2D7"},"euro-sign":{code:"\uF153"},"evernote":{code:"\uF839"},"exchange-alt":{code:"\uF362"},"exclamation":{code:"\uF12A"},"exclamation-circle":{code:"\uF06A"},"exclamation-triangle":{code:"\uF071"},"expand":{code:"\uF065"},"expand-alt":{code:"\uF424"},"expand-arrows-alt":{code:"\uF31E"},"expeditedssl":{code:"\uF23E"},"external-link-alt":{code:"\uF35D"},"external-link-square-alt":{code:"\uF360"},"eye":{code:"\uF06E"},"eye-dropper":{code:"\uF1FB"},"eye-slash":{code:"\uF070"},"facebook":{code:"\uF09A"},"facebook-f":{code:"\uF39E"},"facebook-messenger":{code:"\uF39F"},"facebook-square":{code:"\uF082"},"fan":{code:"\uF863"},"fantasy-flight-games":{code:"\uF6DC"},"fast-backward":{code:"\uF049"},"fast-forward":{code:"\uF050"},"fax":{code:"\uF1AC"},"feather":{code:"\uF52D"},"feather-alt":{code:"\uF56B"},"fedex":{code:"\uF797"},"fedora":{code:"\uF798"},"female":{code:"\uF182"},"fighter-jet":{code:"\uF0FB"},"figma":{code:"\uF799"},"file":{code:"\uF15B"},"file-alt":{code:"\uF15C"},"file-archive":{code:"\uF1C6"},"file-audio":{code:"\uF1C7"},"file-code":{code:"\uF1C9"},"file-contract":{code:"\uF56C"},"file-csv":{code:"\uF6DD"},"file-download":{code:"\uF56D"},"file-excel":{code:"\uF1C3"},"file-export":{code:"\uF56E"},"file-image":{code:"\uF1C5"},"file-import":{code:"\uF56F"},"file-invoice":{code:"\uF570"},"file-invoice-dollar":{code:"\uF571"},"file-medical":{code:"\uF477"},"file-medical-alt":{code:"\uF478"},"file-pdf":{code:"\uF1C1"},"file-powerpoint":{code:"\uF1C4"},"file-prescription":{code:"\uF572"},"file-signature":{code:"\uF573"},"file-upload":{code:"\uF574"},"file-video":{code:"\uF1C8"},"file-word":{code:"\uF1C2"},"fill":{code:"\uF575"},"fill-drip":{code:"\uF576"},"film":{code:"\uF008"},"filter":{code:"\uF0B0"},"fingerprint":{code:"\uF577"},"fire":{code:"\uF06D"},"fire-alt":{code:"\uF7E4"},"fire-extinguisher":{code:"\uF134"},"firefox":{code:"\uF269"},"firefox-browser":{code:""},"first-aid":{code:"\uF479"},"first-order":{code:"\uF2B0"},"first-order-alt":{code:"\uF50A"},"firstdraft":{code:"\uF3A1"},"fish":{code:"\uF578"},"fist-raised":{code:"\uF6DE"},"flag":{code:"\uF024"},"flag-checkered":{code:"\uF11E"},"flag-usa":{code:"\uF74D"},"flask":{code:"\uF0C3"},"flickr":{code:"\uF16E"},"flipboard":{code:"\uF44D"},"flushed":{code:"\uF579"},"fly":{code:"\uF417"},"folder":{code:"\uF07B"},"folder-minus":{code:"\uF65D"},"folder-open":{code:"\uF07C"},"folder-plus":{code:"\uF65E"},"font":{code:"\uF031"},"font-awesome":{code:"\uF2B4"},"font-awesome-alt":{code:"\uF35C"},"font-awesome-flag":{code:"\uF425"},"font-awesome-logo-full":{code:"\uF4E6"},"fonticons":{code:"\uF280"},"fonticons-fi":{code:"\uF3A2"},"football-ball":{code:"\uF44E"},"fort-awesome":{code:"\uF286"},"fort-awesome-alt":{code:"\uF3A3"},"forumbee":{code:"\uF211"},"forward":{code:"\uF04E"},"foursquare":{code:"\uF180"},"free-code-camp":{code:"\uF2C5"},"freebsd":{code:"\uF3A4"},"frog":{code:"\uF52E"},"frown":{code:"\uF119"},"frown-open":{code:"\uF57A"},"fulcrum":{code:"\uF50B"},"funnel-dollar":{code:"\uF662"},"futbol":{code:"\uF1E3"},"galactic-republic":{code:"\uF50C"},"galactic-senate":{code:"\uF50D"},"gamepad":{code:"\uF11B"},"gas-pump":{code:"\uF52F"},"gavel":{code:"\uF0E3"},"gem":{code:"\uF3A5"},"genderless":{code:"\uF22D"},"get-pocket":{code:"\uF265"},"gg":{code:"\uF260"},"gg-circle":{code:"\uF261"},"ghost":{code:"\uF6E2"},"gift":{code:"\uF06B"},"gifts":{code:"\uF79C"},"git":{code:"\uF1D3"},"git-alt":{code:"\uF841"},"git-square":{code:"\uF1D2"},"github":{code:"\uF09B"},"github-alt":{code:"\uF113"},"github-square":{code:"\uF092"},"gitkraken":{code:"\uF3A6"},"gitlab":{code:"\uF296"},"gitter":{code:"\uF426"},"glass-cheers":{code:"\uF79F"},"glass-martini":{code:"\uF000"},"glass-martini-alt":{code:"\uF57B"},"glass-whiskey":{code:"\uF7A0"},"glasses":{code:"\uF530"},"glide":{code:"\uF2A5"},"glide-g":{code:"\uF2A6"},"globe":{code:"\uF0AC"},"globe-africa":{code:"\uF57C"},"globe-americas":{code:"\uF57D"},"globe-asia":{code:"\uF57E"},"globe-europe":{code:"\uF7A2"},"gofore":{code:"\uF3A7"},"golf-ball":{code:"\uF450"},"goodreads":{code:"\uF3A8"},"goodreads-g":{code:"\uF3A9"},"google":{code:"\uF1A0"},"google-drive":{code:"\uF3AA"},"google-play":{code:"\uF3AB"},"google-plus":{code:"\uF2B3"},"google-plus-g":{code:"\uF0D5"},"google-plus-square":{code:"\uF0D4"},"google-wallet":{code:"\uF1EE"},"gopuram":{code:"\uF664"},"graduation-cap":{code:"\uF19D"},"gratipay":{code:"\uF184"},"grav":{code:"\uF2D6"},"greater-than":{code:"\uF531"},"greater-than-equal":{code:"\uF532"},"grimace":{code:"\uF57F"},"grin":{code:"\uF580"},"grin-alt":{code:"\uF581"},"grin-beam":{code:"\uF582"},"grin-beam-sweat":{code:"\uF583"},"grin-hearts":{code:"\uF584"},"grin-squint":{code:"\uF585"},"grin-squint-tears":{code:"\uF586"},"grin-stars":{code:"\uF587"},"grin-tears":{code:"\uF588"},"grin-tongue":{code:"\uF589"},"grin-tongue-squint":{code:"\uF58A"},"grin-tongue-wink":{code:"\uF58B"},"grin-wink":{code:"\uF58C"},"grip-horizontal":{code:"\uF58D"},"grip-lines":{code:"\uF7A4"},"grip-lines-vertical":{code:"\uF7A5"},"grip-vertical":{code:"\uF58E"},"gripfire":{code:"\uF3AC"},"grunt":{code:"\uF3AD"},"guitar":{code:"\uF7A6"},"gulp":{code:"\uF3AE"},"h-square":{code:"\uF0FD"},"hacker-news":{code:"\uF1D4"},"hacker-news-square":{code:"\uF3AF"},"hackerrank":{code:"\uF5F7"},"hamburger":{code:"\uF805"},"hammer":{code:"\uF6E3"},"hamsa":{code:"\uF665"},"hand-holding":{code:"\uF4BD"},"hand-holding-heart":{code:"\uF4BE"},"hand-holding-usd":{code:"\uF4C0"},"hand-lizard":{code:"\uF258"},"hand-middle-finger":{code:"\uF806"},"hand-paper":{code:"\uF256"},"hand-peace":{code:"\uF25B"},"hand-point-down":{code:"\uF0A7"},"hand-point-left":{code:"\uF0A5"},"hand-point-right":{code:"\uF0A4"},"hand-point-up":{code:"\uF0A6"},"hand-pointer":{code:"\uF25A"},"hand-rock":{code:"\uF255"},"hand-scissors":{code:"\uF257"},"hand-spock":{code:"\uF259"},"hands":{code:"\uF4C2"},"hands-helping":{code:"\uF4C4"},"handshake":{code:"\uF2B5"},"hanukiah":{code:"\uF6E6"},"hard-hat":{code:"\uF807"},"hashtag":{code:"\uF292"},"hat-cowboy":{code:"\uF8C0"},"hat-cowboy-side":{code:"\uF8C1"},"hat-wizard":{code:"\uF6E8"},"hdd":{code:"\uF0A0"},"heading":{code:"\uF1DC"},"headphones":{code:"\uF025"},"headphones-alt":{code:"\uF58F"},"headset":{code:"\uF590"},"heart":{code:"\uF004"},"heart-broken":{code:"\uF7A9"},"heartbeat":{code:"\uF21E"},"helicopter":{code:"\uF533"},"highlighter":{code:"\uF591"},"hiking":{code:"\uF6EC"},"hippo":{code:"\uF6ED"},"hips":{code:"\uF452"},"hire-a-helper":{code:"\uF3B0"},"history":{code:"\uF1DA"},"hockey-puck":{code:"\uF453"},"holly-berry":{code:"\uF7AA"},"home":{code:"\uF015"},"hooli":{code:"\uF427"},"hornbill":{code:"\uF592"},"horse":{code:"\uF6F0"},"horse-head":{code:"\uF7AB"},"hospital":{code:"\uF0F8"},"hospital-alt":{code:"\uF47D"},"hospital-symbol":{code:"\uF47E"},"hot-tub":{code:"\uF593"},"hotdog":{code:"\uF80F"},"hotel":{code:"\uF594"},"hotjar":{code:"\uF3B1"},"hourglass":{code:"\uF254"},"hourglass-end":{code:"\uF253"},"hourglass-half":{code:"\uF252"},"hourglass-start":{code:"\uF251"},"house-damage":{code:"\uF6F1"},"houzz":{code:"\uF27C"},"hryvnia":{code:"\uF6F2"},"html5":{code:"\uF13B"},"hubspot":{code:"\uF3B2"},"i-cursor":{code:"\uF246"},"ice-cream":{code:"\uF810"},"icicles":{code:"\uF7AD"},"icons":{code:"\uF86D"},"id-badge":{code:"\uF2C1"},"id-card":{code:"\uF2C2"},"id-card-alt":{code:"\uF47F"},"ideal":{code:""},"igloo":{code:"\uF7AE"},"image":{code:"\uF03E"},"images":{code:"\uF302"},"imdb":{code:"\uF2D8"},"inbox":{code:"\uF01C"},"indent":{code:"\uF03C"},"industry":{code:"\uF275"},"infinity":{code:"\uF534"},"info":{code:"\uF129"},"info-circle":{code:"\uF05A"},"instagram":{code:"\uF16D"},"instagram-square":{code:""},"intercom":{code:"\uF7AF"},"internet-explorer":{code:"\uF26B"},"invision":{code:"\uF7B0"},"ioxhost":{code:"\uF208"},"italic":{code:"\uF033"},"itch-io":{code:"\uF83A"},"itunes":{code:"\uF3B4"},"itunes-note":{code:"\uF3B5"},"java":{code:"\uF4E4"},"jedi":{code:"\uF669"},"jedi-order":{code:"\uF50E"},"jenkins":{code:"\uF3B6"},"jira":{code:"\uF7B1"},"joget":{code:"\uF3B7"},"joint":{code:"\uF595"},"joomla":{code:"\uF1AA"},"journal-whills":{code:"\uF66A"},"js":{code:"\uF3B8"},"js-square":{code:"\uF3B9"},"jsfiddle":{code:"\uF1CC"},"kaaba":{code:"\uF66B"},"kaggle":{code:"\uF5FA"},"key":{code:"\uF084"},"keybase":{code:"\uF4F5"},"keyboard":{code:"\uF11C"},"keycdn":{code:"\uF3BA"},"khanda":{code:"\uF66D"},"kickstarter":{code:"\uF3BB"},"kickstarter-k":{code:"\uF3BC"},"kiss":{code:"\uF596"},"kiss-beam":{code:"\uF597"},"kiss-wink-heart":{code:"\uF598"},"kiwi-bird":{code:"\uF535"},"korvue":{code:"\uF42F"},"landmark":{code:"\uF66F"},"language":{code:"\uF1AB"},"laptop":{code:"\uF109"},"laptop-code":{code:"\uF5FC"},"laptop-medical":{code:"\uF812"},"laravel":{code:"\uF3BD"},"lastfm":{code:"\uF202"},"lastfm-square":{code:"\uF203"},"laugh":{code:"\uF599"},"laugh-beam":{code:"\uF59A"},"laugh-squint":{code:"\uF59B"},"laugh-wink":{code:"\uF59C"},"layer-group":{code:"\uF5FD"},"leaf":{code:"\uF06C"},"leanpub":{code:"\uF212"},"lemon":{code:"\uF094"},"less":{code:"\uF41D"},"less-than":{code:"\uF536"},"less-than-equal":{code:"\uF537"},"level-down-alt":{code:"\uF3BE"},"level-up-alt":{code:"\uF3BF"},"life-ring":{code:"\uF1CD"},"lightbulb":{code:"\uF0EB"},"line":{code:"\uF3C0"},"link":{code:"\uF0C1"},"linkedin":{code:"\uF08C"},"linkedin-in":{code:"\uF0E1"},"linode":{code:"\uF2B8"},"linux":{code:"\uF17C"},"lira-sign":{code:"\uF195"},"list":{code:"\uF03A"},"list-alt":{code:"\uF022"},"list-ol":{code:"\uF0CB"},"list-ul":{code:"\uF0CA"},"location-arrow":{code:"\uF124"},"lock":{code:"\uF023"},"lock-open":{code:"\uF3C1"},"long-arrow-alt-down":{code:"\uF309"},"long-arrow-alt-left":{code:"\uF30A"},"long-arrow-alt-right":{code:"\uF30B"},"long-arrow-alt-up":{code:"\uF30C"},"low-vision":{code:"\uF2A8"},"luggage-cart":{code:"\uF59D"},"lyft":{code:"\uF3C3"},"magento":{code:"\uF3C4"},"magic":{code:"\uF0D0"},"magnet":{code:"\uF076"},"mail-bulk":{code:"\uF674"},"mailchimp":{code:"\uF59E"},"male":{code:"\uF183"},"mandalorian":{code:"\uF50F"},"map":{code:"\uF279"},"map-marked":{code:"\uF59F"},"map-marked-alt":{code:"\uF5A0"},"map-marker":{code:"\uF041"},"map-marker-alt":{code:"\uF3C5"},"map-pin":{code:"\uF276"},"map-signs":{code:"\uF277"},"markdown":{code:"\uF60F"},"marker":{code:"\uF5A1"},"mars":{code:"\uF222"},"mars-double":{code:"\uF227"},"mars-stroke":{code:"\uF229"},"mars-stroke-h":{code:"\uF22B"},"mars-stroke-v":{code:"\uF22A"},"mask":{code:"\uF6FA"},"mastodon":{code:"\uF4F6"},"maxcdn":{code:"\uF136"},"mdb":{code:"\uF8CA"},"medal":{code:"\uF5A2"},"medapps":{code:"\uF3C6"},"medium":{code:"\uF23A"},"medium-m":{code:"\uF3C7"},"medkit":{code:"\uF0FA"},"medrt":{code:"\uF3C8"},"meetup":{code:"\uF2E0"},"megaport":{code:"\uF5A3"},"meh":{code:"\uF11A"},"meh-blank":{code:"\uF5A4"},"meh-rolling-eyes":{code:"\uF5A5"},"memory":{code:"\uF538"},"mendeley":{code:"\uF7B3"},"menorah":{code:"\uF676"},"mercury":{code:"\uF223"},"meteor":{code:"\uF753"},"microblog":{code:""},"microchip":{code:"\uF2DB"},"microphone":{code:"\uF130"},"microphone-alt":{code:"\uF3C9"},"microphone-alt-slash":{code:"\uF539"},"microphone-slash":{code:"\uF131"},"microscope":{code:"\uF610"},"microsoft":{code:"\uF3CA"},"minus":{code:"\uF068"},"minus-circle":{code:"\uF056"},"minus-square":{code:"\uF146"},"mitten":{code:"\uF7B5"},"mix":{code:"\uF3CB"},"mixcloud":{code:"\uF289"},"mixer":{code:""},"mizuni":{code:"\uF3CC"},"mobile":{code:"\uF10B"},"mobile-alt":{code:"\uF3CD"},"modx":{code:"\uF285"},"monero":{code:"\uF3D0"},"money-bill":{code:"\uF0D6"},"money-bill-alt":{code:"\uF3D1"},"money-bill-wave":{code:"\uF53A"},"money-bill-wave-alt":{code:"\uF53B"},"money-check":{code:"\uF53C"},"money-check-alt":{code:"\uF53D"},"monument":{code:"\uF5A6"},"moon":{code:"\uF186"},"mortar-pestle":{code:"\uF5A7"},"mosque":{code:"\uF678"},"motorcycle":{code:"\uF21C"},"mountain":{code:"\uF6FC"},"mouse":{code:"\uF8CC"},"mouse-pointer":{code:"\uF245"},"mug-hot":{code:"\uF7B6"},"music":{code:"\uF001"},"napster":{code:"\uF3D2"},"neos":{code:"\uF612"},"network-wired":{code:"\uF6FF"},"neuter":{code:"\uF22C"},"newspaper":{code:"\uF1EA"},"nimblr":{code:"\uF5A8"},"node":{code:"\uF419"},"node-js":{code:"\uF3D3"},"not-equal":{code:"\uF53E"},"notes-medical":{code:"\uF481"},"npm":{code:"\uF3D4"},"ns8":{code:"\uF3D5"},"nutritionix":{code:"\uF3D6"},"object-group":{code:"\uF247"},"object-ungroup":{code:"\uF248"},"odnoklassniki":{code:"\uF263"},"odnoklassniki-square":{code:"\uF264"},"oil-can":{code:"\uF613"},"old-republic":{code:"\uF510"},"om":{code:"\uF679"},"opencart":{code:"\uF23D"},"openid":{code:"\uF19B"},"opera":{code:"\uF26A"},"optin-monster":{code:"\uF23C"},"orcid":{code:"\uF8D2"},"osi":{code:"\uF41A"},"otter":{code:"\uF700"},"outdent":{code:"\uF03B"},"page4":{code:"\uF3D7"},"pagelines":{code:"\uF18C"},"pager":{code:"\uF815"},"paint-brush":{code:"\uF1FC"},"paint-roller":{code:"\uF5AA"},"palette":{code:"\uF53F"},"palfed":{code:"\uF3D8"},"pallet":{code:"\uF482"},"paper-plane":{code:"\uF1D8"},"paperclip":{code:"\uF0C6"},"parachute-box":{code:"\uF4CD"},"paragraph":{code:"\uF1DD"},"parking":{code:"\uF540"},"passport":{code:"\uF5AB"},"pastafarianism":{code:"\uF67B"},"paste":{code:"\uF0EA"},"patreon":{code:"\uF3D9"},"pause":{code:"\uF04C"},"pause-circle":{code:"\uF28B"},"paw":{code:"\uF1B0"},"paypal":{code:"\uF1ED"},"peace":{code:"\uF67C"},"pen":{code:"\uF304"},"pen-alt":{code:"\uF305"},"pen-fancy":{code:"\uF5AC"},"pen-nib":{code:"\uF5AD"},"pen-square":{code:"\uF14B"},"pencil-alt":{code:"\uF303"},"pencil-ruler":{code:"\uF5AE"},"penny-arcade":{code:"\uF704"},"people-carry":{code:"\uF4CE"},"pepper-hot":{code:"\uF816"},"percent":{code:"\uF295"},"percentage":{code:"\uF541"},"periscope":{code:"\uF3DA"},"person-booth":{code:"\uF756"},"phabricator":{code:"\uF3DB"},"phoenix-framework":{code:"\uF3DC"},"phoenix-squadron":{code:"\uF511"},"phone":{code:"\uF095"},"phone-alt":{code:"\uF879"},"phone-slash":{code:"\uF3DD"},"phone-square":{code:"\uF098"},"phone-square-alt":{code:"\uF87B"},"phone-volume":{code:"\uF2A0"},"photo-video":{code:"\uF87C"},"php":{code:"\uF457"},"pied-piper":{code:"\uF2AE"},"pied-piper-alt":{code:"\uF1A8"},"pied-piper-hat":{code:"\uF4E5"},"pied-piper-pp":{code:"\uF1A7"},"pied-piper-square":{code:""},"piggy-bank":{code:"\uF4D3"},"pills":{code:"\uF484"},"pinterest":{code:"\uF0D2"},"pinterest-p":{code:"\uF231"},"pinterest-square":{code:"\uF0D3"},"pizza-slice":{code:"\uF818"},"place-of-worship":{code:"\uF67F"},"plane":{code:"\uF072"},"plane-arrival":{code:"\uF5AF"},"plane-departure":{code:"\uF5B0"},"play":{code:"\uF04B"},"play-circle":{code:"\uF144"},"playstation":{code:"\uF3DF"},"plug":{code:"\uF1E6"},"plus":{code:"\uF067"},"plus-circle":{code:"\uF055"},"plus-square":{code:"\uF0FE"},"podcast":{code:"\uF2CE"},"poll":{code:"\uF681"},"poll-h":{code:"\uF682"},"poo":{code:"\uF2FE"},"poo-storm":{code:"\uF75A"},"poop":{code:"\uF619"},"portrait":{code:"\uF3E0"},"pound-sign":{code:"\uF154"},"power-off":{code:"\uF011"},"pray":{code:"\uF683"},"praying-hands":{code:"\uF684"},"prescription":{code:"\uF5B1"},"prescription-bottle":{code:"\uF485"},"prescription-bottle-alt":{code:"\uF486"},"print":{code:"\uF02F"},"procedures":{code:"\uF487"},"product-hunt":{code:"\uF288"},"project-diagram":{code:"\uF542"},"pushed":{code:"\uF3E1"},"puzzle-piece":{code:"\uF12E"},"python":{code:"\uF3E2"},"qq":{code:"\uF1D6"},"qrcode":{code:"\uF029"},"question":{code:"\uF128"},"question-circle":{code:"\uF059"},"quidditch":{code:"\uF458"},"quinscape":{code:"\uF459"},"quora":{code:"\uF2C4"},"quote-left":{code:"\uF10D"},"quote-right":{code:"\uF10E"},"quran":{code:"\uF687"},"r-project":{code:"\uF4F7"},"radiation":{code:"\uF7B9"},"radiation-alt":{code:"\uF7BA"},"rainbow":{code:"\uF75B"},"random":{code:"\uF074"},"raspberry-pi":{code:"\uF7BB"},"ravelry":{code:"\uF2D9"},"react":{code:"\uF41B"},"reacteurope":{code:"\uF75D"},"readme":{code:"\uF4D5"},"rebel":{code:"\uF1D0"},"receipt":{code:"\uF543"},"record-vinyl":{code:"\uF8D9"},"recycle":{code:"\uF1B8"},"red-river":{code:"\uF3E3"},"reddit":{code:"\uF1A1"},"reddit-alien":{code:"\uF281"},"reddit-square":{code:"\uF1A2"},"redhat":{code:"\uF7BC"},"redo":{code:"\uF01E"},"redo-alt":{code:"\uF2F9"},"registered":{code:"\uF25D"},"remove-format":{code:"\uF87D"},"renren":{code:"\uF18B"},"reply":{code:"\uF3E5"},"reply-all":{code:"\uF122"},"replyd":{code:"\uF3E6"},"republican":{code:"\uF75E"},"researchgate":{code:"\uF4F8"},"resolving":{code:"\uF3E7"},"restroom":{code:"\uF7BD"},"retweet":{code:"\uF079"},"rev":{code:"\uF5B2"},"ribbon":{code:"\uF4D6"},"ring":{code:"\uF70B"},"road":{code:"\uF018"},"robot":{code:"\uF544"},"rocket":{code:"\uF135"},"rocketchat":{code:"\uF3E8"},"rockrms":{code:"\uF3E9"},"route":{code:"\uF4D7"},"rss":{code:"\uF09E"},"rss-square":{code:"\uF143"},"ruble-sign":{code:"\uF158"},"ruler":{code:"\uF545"},"ruler-combined":{code:"\uF546"},"ruler-horizontal":{code:"\uF547"},"ruler-vertical":{code:"\uF548"},"running":{code:"\uF70C"},"rupee-sign":{code:"\uF156"},"sad-cry":{code:"\uF5B3"},"sad-tear":{code:"\uF5B4"},"safari":{code:"\uF267"},"salesforce":{code:"\uF83B"},"sass":{code:"\uF41E"},"satellite":{code:"\uF7BF"},"satellite-dish":{code:"\uF7C0"},"save":{code:"\uF0C7"},"schlix":{code:"\uF3EA"},"school":{code:"\uF549"},"screwdriver":{code:"\uF54A"},"scribd":{code:"\uF28A"},"scroll":{code:"\uF70E"},"sd-card":{code:"\uF7C2"},"search":{code:"\uF002"},"search-dollar":{code:"\uF688"},"search-location":{code:"\uF689"},"search-minus":{code:"\uF010"},"search-plus":{code:"\uF00E"},"searchengin":{code:"\uF3EB"},"seedling":{code:"\uF4D8"},"sellcast":{code:"\uF2DA"},"sellsy":{code:"\uF213"},"server":{code:"\uF233"},"servicestack":{code:"\uF3EC"},"shapes":{code:"\uF61F"},"share":{code:"\uF064"},"share-alt":{code:"\uF1E0"},"share-alt-square":{code:"\uF1E1"},"share-square":{code:"\uF14D"},"shekel-sign":{code:"\uF20B"},"shield-alt":{code:"\uF3ED"},"ship":{code:"\uF21A"},"shipping-fast":{code:"\uF48B"},"shirtsinbulk":{code:"\uF214"},"shoe-prints":{code:"\uF54B"},"shopify":{code:""},"shopping-bag":{code:"\uF290"},"shopping-basket":{code:"\uF291"},"shopping-cart":{code:"\uF07A"},"shopware":{code:"\uF5B5"},"shower":{code:"\uF2CC"},"shuttle-van":{code:"\uF5B6"},"sign":{code:"\uF4D9"},"sign-in-alt":{code:"\uF2F6"},"sign-language":{code:"\uF2A7"},"sign-out-alt":{code:"\uF2F5"},"signal":{code:"\uF012"},"signature":{code:"\uF5B7"},"sim-card":{code:"\uF7C4"},"simplybuilt":{code:"\uF215"},"sistrix":{code:"\uF3EE"},"sitemap":{code:"\uF0E8"},"sith":{code:"\uF512"},"skating":{code:"\uF7C5"},"sketch":{code:"\uF7C6"},"skiing":{code:"\uF7C9"},"skiing-nordic":{code:"\uF7CA"},"skull":{code:"\uF54C"},"skull-crossbones":{code:"\uF714"},"skyatlas":{code:"\uF216"},"skype":{code:"\uF17E"},"slack":{code:"\uF198"},"slack-hash":{code:"\uF3EF"},"slash":{code:"\uF715"},"sleigh":{code:"\uF7CC"},"sliders-h":{code:"\uF1DE"},"slideshare":{code:"\uF1E7"},"smile":{code:"\uF118"},"smile-beam":{code:"\uF5B8"},"smile-wink":{code:"\uF4DA"},"smog":{code:"\uF75F"},"smoking":{code:"\uF48D"},"smoking-ban":{code:"\uF54D"},"sms":{code:"\uF7CD"},"snapchat":{code:"\uF2AB"},"snapchat-ghost":{code:"\uF2AC"},"snapchat-square":{code:"\uF2AD"},"snowboarding":{code:"\uF7CE"},"snowflake":{code:"\uF2DC"},"snowman":{code:"\uF7D0"},"snowplow":{code:"\uF7D2"},"socks":{code:"\uF696"},"solar-panel":{code:"\uF5BA"},"sort":{code:"\uF0DC"},"sort-alpha-down":{code:"\uF15D"},"sort-alpha-down-alt":{code:"\uF881"},"sort-alpha-up":{code:"\uF15E"},"sort-alpha-up-alt":{code:"\uF882"},"sort-amount-down":{code:"\uF160"},"sort-amount-down-alt":{code:"\uF884"},"sort-amount-up":{code:"\uF161"},"sort-amount-up-alt":{code:"\uF885"},"sort-down":{code:"\uF0DD"},"sort-numeric-down":{code:"\uF162"},"sort-numeric-down-alt":{code:"\uF886"},"sort-numeric-up":{code:"\uF163"},"sort-numeric-up-alt":{code:"\uF887"},"sort-up":{code:"\uF0DE"},"soundcloud":{code:"\uF1BE"},"sourcetree":{code:"\uF7D3"},"spa":{code:"\uF5BB"},"space-shuttle":{code:"\uF197"},"speakap":{code:"\uF3F3"},"speaker-deck":{code:"\uF83C"},"spell-check":{code:"\uF891"},"spider":{code:"\uF717"},"spinner":{code:"\uF110"},"splotch":{code:"\uF5BC"},"spotify":{code:"\uF1BC"},"spray-can":{code:"\uF5BD"},"square":{code:"\uF0C8"},"square-full":{code:"\uF45C"},"square-root-alt":{code:"\uF698"},"squarespace":{code:"\uF5BE"},"stack-exchange":{code:"\uF18D"},"stack-overflow":{code:"\uF16C"},"stackpath":{code:"\uF842"},"stamp":{code:"\uF5BF"},"star":{code:"\uF005"},"star-and-crescent":{code:"\uF699"},"star-half":{code:"\uF089"},"star-half-alt":{code:"\uF5C0"},"star-of-david":{code:"\uF69A"},"star-of-life":{code:"\uF621"},"staylinked":{code:"\uF3F5"},"steam":{code:"\uF1B6"},"steam-square":{code:"\uF1B7"},"steam-symbol":{code:"\uF3F6"},"step-backward":{code:"\uF048"},"step-forward":{code:"\uF051"},"stethoscope":{code:"\uF0F1"},"sticker-mule":{code:"\uF3F7"},"sticky-note":{code:"\uF249"},"stop":{code:"\uF04D"},"stop-circle":{code:"\uF28D"},"stopwatch":{code:"\uF2F2"},"store":{code:"\uF54E"},"store-alt":{code:"\uF54F"},"strava":{code:"\uF428"},"stream":{code:"\uF550"},"street-view":{code:"\uF21D"},"strikethrough":{code:"\uF0CC"},"stripe":{code:"\uF429"},"stripe-s":{code:"\uF42A"},"stroopwafel":{code:"\uF551"},"studiovinari":{code:"\uF3F8"},"stumbleupon":{code:"\uF1A4"},"stumbleupon-circle":{code:"\uF1A3"},"subscript":{code:"\uF12C"},"subway":{code:"\uF239"},"suitcase":{code:"\uF0F2"},"suitcase-rolling":{code:"\uF5C1"},"sun":{code:"\uF185"},"superpowers":{code:"\uF2DD"},"superscript":{code:"\uF12B"},"supple":{code:"\uF3F9"},"surprise":{code:"\uF5C2"},"suse":{code:"\uF7D6"},"swatchbook":{code:"\uF5C3"},"swift":{code:"\uF8E1"},"swimmer":{code:"\uF5C4"},"swimming-pool":{code:"\uF5C5"},"symfony":{code:"\uF83D"},"synagogue":{code:"\uF69B"},"sync":{code:"\uF021"},"sync-alt":{code:"\uF2F1"},"syringe":{code:"\uF48E"},"table":{code:"\uF0CE"},"table-tennis":{code:"\uF45D"},"tablet":{code:"\uF10A"},"tablet-alt":{code:"\uF3FA"},"tablets":{code:"\uF490"},"tachometer-alt":{code:"\uF3FD"},"tag":{code:"\uF02B"},"tags":{code:"\uF02C"},"tape":{code:"\uF4DB"},"tasks":{code:"\uF0AE"},"taxi":{code:"\uF1BA"},"teamspeak":{code:"\uF4F9"},"teeth":{code:"\uF62E"},"teeth-open":{code:"\uF62F"},"telegram":{code:"\uF2C6"},"telegram-plane":{code:"\uF3FE"},"temperature-high":{code:"\uF769"},"temperature-low":{code:"\uF76B"},"tencent-weibo":{code:"\uF1D5"},"tenge":{code:"\uF7D7"},"terminal":{code:"\uF120"},"text-height":{code:"\uF034"},"text-width":{code:"\uF035"},"th":{code:"\uF00A"},"th-large":{code:"\uF009"},"th-list":{code:"\uF00B"},"the-red-yeti":{code:"\uF69D"},"theater-masks":{code:"\uF630"},"themeco":{code:"\uF5C6"},"themeisle":{code:"\uF2B2"},"thermometer":{code:"\uF491"},"thermometer-empty":{code:"\uF2CB"},"thermometer-full":{code:"\uF2C7"},"thermometer-half":{code:"\uF2C9"},"thermometer-quarter":{code:"\uF2CA"},"thermometer-three-quarters":{code:"\uF2C8"},"think-peaks":{code:"\uF731"},"thumbs-down":{code:"\uF165"},"thumbs-up":{code:"\uF164"},"thumbtack":{code:"\uF08D"},"ticket-alt":{code:"\uF3FF"},"times":{code:"\uF00D"},"times-circle":{code:"\uF057"},"tint":{code:"\uF043"},"tint-slash":{code:"\uF5C7"},"tired":{code:"\uF5C8"},"toggle-off":{code:"\uF204"},"toggle-on":{code:"\uF205"},"toilet":{code:"\uF7D8"},"toilet-paper":{code:"\uF71E"},"toolbox":{code:"\uF552"},"tools":{code:"\uF7D9"},"tooth":{code:"\uF5C9"},"torah":{code:"\uF6A0"},"torii-gate":{code:"\uF6A1"},"tractor":{code:"\uF722"},"trade-federation":{code:"\uF513"},"trademark":{code:"\uF25C"},"traffic-light":{code:"\uF637"},"trailer":{code:""},"train":{code:"\uF238"},"tram":{code:"\uF7DA"},"transgender":{code:"\uF224"},"transgender-alt":{code:"\uF225"},"trash":{code:"\uF1F8"},"trash-alt":{code:"\uF2ED"},"trash-restore":{code:"\uF829"},"trash-restore-alt":{code:"\uF82A"},"tree":{code:"\uF1BB"},"trello":{code:"\uF181"},"tripadvisor":{code:"\uF262"},"trophy":{code:"\uF091"},"truck":{code:"\uF0D1"},"truck-loading":{code:"\uF4DE"},"truck-monster":{code:"\uF63B"},"truck-moving":{code:"\uF4DF"},"truck-pickup":{code:"\uF63C"},"tshirt":{code:"\uF553"},"tty":{code:"\uF1E4"},"tumblr":{code:"\uF173"},"tumblr-square":{code:"\uF174"},"tv":{code:"\uF26C"},"twitch":{code:"\uF1E8"},"twitter":{code:"\uF099"},"twitter-square":{code:"\uF081"},"typo3":{code:"\uF42B"},"uber":{code:"\uF402"},"ubuntu":{code:"\uF7DF"},"uikit":{code:"\uF403"},"umbraco":{code:"\uF8E8"},"umbrella":{code:"\uF0E9"},"umbrella-beach":{code:"\uF5CA"},"underline":{code:"\uF0CD"},"undo":{code:"\uF0E2"},"undo-alt":{code:"\uF2EA"},"uniregistry":{code:"\uF404"},"unity":{code:""},"universal-access":{code:"\uF29A"},"university":{code:"\uF19C"},"unlink":{code:"\uF127"},"unlock":{code:"\uF09C"},"unlock-alt":{code:"\uF13E"},"untappd":{code:"\uF405"},"upload":{code:"\uF093"},"ups":{code:"\uF7E0"},"usb":{code:"\uF287"},"user":{code:"\uF007"},"user-alt":{code:"\uF406"},"user-alt-slash":{code:"\uF4FA"},"user-astronaut":{code:"\uF4FB"},"user-check":{code:"\uF4FC"},"user-circle":{code:"\uF2BD"},"user-clock":{code:"\uF4FD"},"user-cog":{code:"\uF4FE"},"user-edit":{code:"\uF4FF"},"user-friends":{code:"\uF500"},"user-graduate":{code:"\uF501"},"user-injured":{code:"\uF728"},"user-lock":{code:"\uF502"},"user-md":{code:"\uF0F0"},"user-minus":{code:"\uF503"},"user-ninja":{code:"\uF504"},"user-nurse":{code:"\uF82F"},"user-plus":{code:"\uF234"},"user-secret":{code:"\uF21B"},"user-shield":{code:"\uF505"},"user-slash":{code:"\uF506"},"user-tag":{code:"\uF507"},"user-tie":{code:"\uF508"},"user-times":{code:"\uF235"},"users":{code:"\uF0C0"},"users-cog":{code:"\uF509"},"usps":{code:"\uF7E1"},"ussunnah":{code:"\uF407"},"utensil-spoon":{code:"\uF2E5"},"utensils":{code:"\uF2E7"},"vaadin":{code:"\uF408"},"vector-square":{code:"\uF5CB"},"venus":{code:"\uF221"},"venus-double":{code:"\uF226"},"venus-mars":{code:"\uF228"},"viacoin":{code:"\uF237"},"viadeo":{code:"\uF2A9"},"viadeo-square":{code:"\uF2AA"},"vial":{code:"\uF492"},"vials":{code:"\uF493"},"viber":{code:"\uF409"},"video":{code:"\uF03D"},"video-slash":{code:"\uF4E2"},"vihara":{code:"\uF6A7"},"vimeo":{code:"\uF40A"},"vimeo-square":{code:"\uF194"},"vimeo-v":{code:"\uF27D"},"vine":{code:"\uF1CA"},"vk":{code:"\uF189"},"vnv":{code:"\uF40B"},"voicemail":{code:"\uF897"},"volleyball-ball":{code:"\uF45F"},"volume-down":{code:"\uF027"},"volume-mute":{code:"\uF6A9"},"volume-off":{code:"\uF026"},"volume-up":{code:"\uF028"},"vote-yea":{code:"\uF772"},"vr-cardboard":{code:"\uF729"},"vuejs":{code:"\uF41F"},"walking":{code:"\uF554"},"wallet":{code:"\uF555"},"warehouse":{code:"\uF494"},"water":{code:"\uF773"},"wave-square":{code:"\uF83E"},"waze":{code:"\uF83F"},"weebly":{code:"\uF5CC"},"weibo":{code:"\uF18A"},"weight":{code:"\uF496"},"weight-hanging":{code:"\uF5CD"},"weixin":{code:"\uF1D7"},"whatsapp":{code:"\uF232"},"whatsapp-square":{code:"\uF40C"},"wheelchair":{code:"\uF193"},"whmcs":{code:"\uF40D"},"wifi":{code:"\uF1EB"},"wikipedia-w":{code:"\uF266"},"wind":{code:"\uF72E"},"window-close":{code:"\uF410"},"window-maximize":{code:"\uF2D0"},"window-minimize":{code:"\uF2D1"},"window-restore":{code:"\uF2D2"},"windows":{code:"\uF17A"},"wine-bottle":{code:"\uF72F"},"wine-glass":{code:"\uF4E3"},"wine-glass-alt":{code:"\uF5CE"},"wix":{code:"\uF5CF"},"wizards-of-the-coast":{code:"\uF730"},"wolf-pack-battalion":{code:"\uF514"},"won-sign":{code:"\uF159"},"wordpress":{code:"\uF19A"},"wordpress-simple":{code:"\uF411"},"wpbeginner":{code:"\uF297"},"wpexplorer":{code:"\uF2DE"},"wpforms":{code:"\uF298"},"wpressr":{code:"\uF3E4"},"wrench":{code:"\uF0AD"},"x-ray":{code:"\uF497"},"xbox":{code:"\uF412"},"xing":{code:"\uF168"},"xing-square":{code:"\uF169"},"y-combinator":{code:"\uF23B"},"yahoo":{code:"\uF19E"},"yammer":{code:"\uF840"},"yandex":{code:"\uF413"},"yandex-international":{code:"\uF414"},"yarn":{code:"\uF7E3"},"yelp":{code:"\uF1E9"},"yen-sign":{code:"\uF157"},"yin-yang":{code:"\uF6AD"},"yoast":{code:"\uF2B1"},"youtube":{code:"\uF167"},"youtube-square":{code:"\uF431"},"zhihu":{code:"\uF63F"}};__varRecorder__$c.Icons=Icons;__varRecorder__$c.Icons=Icons;__varRecorder__$c.Icons=Icons;var __varRecorder__$d=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/renderer.js");__varRecorder__$d.vdom=exports$1$h;__varRecorder__$d.promise=promise;__varRecorder__$d.arr=arr;__varRecorder__$d.tree=tree;__varRecorder__$d.obj=obj;__varRecorder__$d.string=string;__varRecorder__$d.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;__varRecorder__$d.addOrChangeLinkedCSS=addOrChangeLinkedCSS;__varRecorder__$d.defaultStyle=defaultStyle;__varRecorder__$d.renderGradient=renderGradient;__varRecorder__$d.defaultAttributes=defaultAttributes;__varRecorder__$d.defaultCSS=defaultCSS;__varRecorder__$d.pathAttributes=pathAttributes;__varRecorder__$d.svgAttributes=svgAttributes;__varRecorder__$d.renderMorph=renderMorph;__varRecorder__$d.Transform=Transform;__varRecorder__$d.pt=pt;__varRecorder__$d.getSvgVertices=getSvgVertices;__varRecorder__$d.config=config;var destructured_1$1=__varRecorder__$d.vdom;__varRecorder__$d.h=destructured_1$1.h;__varRecorder__$d.diff=destructured_1$1.diff;__varRecorder__$d.patch=destructured_1$1.patch;__varRecorder__$d.createNode=destructured_1$1.create;__varRecorder__$d.svgNs="http://www.w3.org/2000/svg";__varRecorder__$d.CanvasHook=function(canvas){this.canvasMorph=canvas;};__varRecorder__$d.CanvasHook.prototype.hook=function(node,prop,prev){var hasNewCanvas=this.canvasMorph._canvas!==node&&node.tagName=="CANVAS";this.canvasMorph.afterRender(node,hasNewCanvas);};__varRecorder__$d.InitStroke=function(path,renderer,reverse){this.path=path;this.renderer=renderer;this.reverse=reverse;};__varRecorder__$d.InitStroke.prototype.hook=function(node,propertyName,previousValue){var p=this.path.drawnProportion||0;if(p==0)return;node.setAttribute("stroke-width",this.path.borderWidth.valueOf()+1);node.setAttribute("stroke-dasharray",node.getTotalLength());node.setAttribute("stroke-dashoffset",node.getTotalLength()*(!this.reverse?-1+(1-p):1-p));};var Renderer=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/renderer.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Renderer")&&typeof __lively_classholder__.Renderer==="function"?__lively_classholder__.Renderer:__lively_classholder__.Renderer=function Renderer(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Renderer_initialize_(world,rootNode,domEnvironment){if(!world||!world.isMorph){throw new Error("Trying to initialize renderer with an invalid world morph: ".concat(world));}if(!rootNode||!("nodeType"in rootNode)){throw new Error("Trying to initialize renderer with an invalid root node: ".concat(rootNode));}if(!domEnvironment){var doc=rootNode.ownerDocument;domEnvironment={window:System.global,document:doc};}this.worldMorph=world;world._renderer=this;this.rootNode=rootNode;this.domNode=null;this.domEnvironment=domEnvironment;this.renderMap=new WeakMap();this.fixedMorphNodeMap=new Map();this.renderWorldLoopProcess=null;this.renderWorldLoopLater=null;this.requestAnimationFrame=domEnvironment.window.requestAnimationFrame.bind(domEnvironment.window);}},{key:"clear",value:function(){var _Renderer_clear_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee37(){var domNode,parent;return regeneratorRuntime.wrap(function _callee37$(_context37){while(1){switch(_context37.prev=_context37.next){case 0:domNode=this.domNode;_context37.prev=1;_context37.next=4;return this.stopRenderWorldLoop();case 4:_context37.next=8;break;case 6:_context37.prev=6;_context37.t0=_context37["catch"](1);case 8:if(domNode){parent=domNode.parentNode;parent.removeChild(domNode);_toConsumableArray2(this.fixedMorphNodeMap.values()).forEach(function(n){return parent.removeChild(n);});}this.domNode=null;this.renderMap=new WeakMap();case 11:case"end":return _context37.stop();}}},_callee37,this,[[1,6]]);}));function Renderer_clear_(){return _Renderer_clear_.apply(this,arguments);}return Renderer_clear_;}()},{key:"ensureDefaultCSS",value:function Renderer_ensureDefaultCSS_(){var _this34=this;return __varRecorder__$d.promise.waitFor(3000,function(){return _this34.domNode.ownerDocument;}).then(function(doc){return Promise.all([__varRecorder__$d.addOrChangeCSSDeclaration("lively-morphic-css",__varRecorder__$d.defaultCSS,doc),__varRecorder__$d.addOrChangeLinkedCSS("lively-ibm-plex",__varRecorder__$d.config.css.ibmPlex),__varRecorder__$d.addOrChangeLinkedCSS("lively-font-awesome",__varRecorder__$d.config.css.fontAwesome,doc,false),__varRecorder__$d.addOrChangeLinkedCSS("lively-font-inconsolata",__varRecorder__$d.config.css.inconsolata,doc,false)]);});}},{key:"startRenderWorldLoop",value:function Renderer_startRenderWorldLoop_(){var _this35=this;this._stopped=false;this._renderWorldLoopLater=null;this.renderWorldLoopProcess=this.requestAnimationFrame(function(){return _this35.startRenderWorldLoop();});return this.renderStep();}},{key:"stopRenderWorldLoop",value:function(){var _Renderer_stopRenderWorldLoop_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee38(){var _this36=this;return regeneratorRuntime.wrap(function _callee38$(_context38){while(1){switch(_context38.prev=_context38.next){case 0:this._stopped=true;this.domEnvironment.window.cancelAnimationFrame(this.renderWorldLoopProcess);this.renderWorldLoopProcess=null;this.domEnvironment.window.cancelAnimationFrame(this.renderWorldLoopLater);this.renderWorldLoopLater=null;_context38.next=7;return __varRecorder__$d.promise.waitFor(2000,function(){return!_this36.worldMorph.needsRerender();});case 7:case"end":return _context38.stop();}}},_callee38,this);}));function Renderer_stopRenderWorldLoop_(){return _Renderer_stopRenderWorldLoop_.apply(this,arguments);}return Renderer_stopRenderWorldLoop_;}()},{key:"renderLater",value:function Renderer_renderLater_(){var _this37=this;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:10;this.renderWorldLoopLaterCounter=n;if(this.renderWorldLoopLater||this._stopped)return;this.renderWorldLoopLater=this.requestAnimationFrame(function(){_this37.renderWorldLoopLater=null;if(_this37.renderWorldLoopLaterCounter>0){_this37.renderLater(_this37.renderWorldLoopLaterCounter-1);}try{_this37.renderStep();}catch(err){console.error("Error rendering morphs:",err);}});}},{key:"renderStep",value:function Renderer_renderStep_(){this.worldMorph.renderAsRoot(this);return this;}},{key:"getNodeForMorph",value:function Renderer_getNodeForMorph_(morph){var id="#"+__varRecorder__$d.string.regExpEscape(morph.id);var node=this.domNode&&this.domNode.querySelector(id);if(this.domNode&&this.domNode.id==morph.id)node=this.domNode;if(node)return node;var _iterator30=_createForOfIteratorHelper(this.fixedMorphNodeMap.values()),_step30;try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var fixedNode=_step30.value;node=fixedNode.querySelector(id);if(node)return node;}}catch(err){_iterator30.e(err);}finally{_iterator30.f();}return null;}},{key:"getMorphForNode",value:function Renderer_getMorphForNode_(node){return this.worldMorph?this.worldMorph.withAllSubmorphsDetect(function(morph){return morph.id===node.id;}):null;}},{key:"render",value:function Renderer_render_(morph){if(!morph.needsRerender()){var renderedTree=this.renderMap.get(morph);if(renderedTree)return renderedTree;}morph.aboutToRender(this);var tree=morph.render(this);this.renderMap.set(morph,tree);return tree;}},{key:"renderAsFixed",value:function Renderer_renderAsFixed_(morph){var tree=this.render(morph);if(!morph.isHTMLMorph){tree.properties.style.position="fixed";}return tree;}},{key:"renderFixedMorphs",value:function Renderer_renderFixedMorphs_(fixedMorphs,world){var domNode=this.domNode,fixedMorphNodeMap=this.fixedMorphNodeMap;if(!fixedMorphs.length&&!fixedMorphNodeMap.size)return;if(!domNode||!domNode.parentNode)return;var fixedMorphNode=domNode.parentNode;var _iterator31=_createForOfIteratorHelper(fixedMorphNodeMap),_step31;try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var _step31$value=_slicedToArray2(_step31.value,2),_morph=_step31$value[0],node=_step31$value[1];if(!fixedMorphs.includes(_morph)){if(node.parentNode)node.parentNode.removeChild(node);fixedMorphNodeMap["delete"](_morph);}}}catch(err){_iterator31.e(err);}finally{_iterator31.f();}var currentFixedMorphNodes=fixedMorphs.map(function(m){return fixedMorphNodeMap.get(m);});var supposedOrder=currentFixedMorphNodes.map(function(m){return m&&m.id;});var actualOrder=_toConsumableArray2(fixedMorphNode.children).map(function(m){return m.id;}).filter(function(id){return supposedOrder.includes(id);});if(!__varRecorder__$d.arr.equals(supposedOrder,actualOrder)){currentFixedMorphNodes.map(function(n){return n&&n.parentNode&&n.parentNode.removeChild(n);});}var _iterator32=_createForOfIteratorHelper(fixedMorphs),_step32;try{for(_iterator32.s();!(_step32=_iterator32.n()).done;){var _morph2=_step32.value;var _tree=this.renderMap.get(_morph2)||this.renderAsFixed(_morph2);var newTree=this.renderAsFixed(_morph2);var patches=__varRecorder__$d.diff(_tree,newTree);var morphNode=fixedMorphNodeMap.get(_morph2);if(!morphNode){morphNode=__varRecorder__$d.createNode(_tree,this.domEnvironment);fixedMorphNodeMap.set(_morph2,morphNode);}if(!morphNode.parentNode){fixedMorphNode.appendChild(morphNode);}__varRecorder__$d.patch(morphNode,patches);}}catch(err){_iterator32.e(err);}finally{_iterator32.f();}}},{key:"renderMorph",value:function Renderer_renderMorph_(morph){var submorphs=this.renderSubmorphs(morph);return __varRecorder__$d.h("div",Object.assign({},__varRecorder__$d.defaultAttributes(morph,this),{style:__varRecorder__$d.defaultStyle(morph)}),submorphs);}},{key:"renderSubmorphs",value:function Renderer_renderSubmorphs_(morph){return this.renderSelectedSubmorphs(morph,morph.submorphs);}},{key:"renderSelectedSubmorphs",value:function Renderer_renderSelectedSubmorphs_(morph,submorphs){var borderWidthLeft=morph.borderWidthLeft,borderWidthTop=morph.borderWidthTop,_morph$origin=morph.origin,oX=_morph$origin.x,oY=_morph$origin.y;var i=submorphs.length-1;var renderedSubmorphs=new Array(i+1);var skipWrapping=oX==0&&oY==0&&!morph.isImage&&!morph.isPath&&!morph.isText;for(;i>=0;i--){renderedSubmorphs[i]=this.render(submorphs[i]);}return __varRecorder__$d.h("div",{style:Object.assign({position:"absolute",left:"".concat(oX-(morph.isPath?0:borderWidthLeft),"px"),top:"".concat(oY-(morph.isPath?0:borderWidthTop),"px")},morph.isPolygon?Object.assign({height:"100%",width:"100%",overflow:morph.clipMode},morph.clipMode!=="visible"?_defineProperty({},navigator.userAgent.includes("AppleWebKit")?"-webkit-clip-path":"clip-path","url(#clipPath".concat(morph.id,")")):{}):{})},renderedSubmorphs);}},{key:"renderWorld",value:function Renderer_renderWorld_(world){var submorphs=world.submorphs;var normalSubmorphs=[];var fixedMorphs=[];for(var _i75=0;_i75<submorphs.length;_i75++){var _morph3=submorphs[_i75];if(_morph3.hasFixedPosition)fixedMorphs.push(_morph3);else normalSubmorphs.push(_morph3);}var renderedSubmorphs=this.renderSelectedSubmorphs(world,normalSubmorphs);var vnode=__varRecorder__$d.h("div",Object.assign({},__varRecorder__$d.defaultAttributes(world,this),{style:__varRecorder__$d.defaultStyle(world)}),renderedSubmorphs);vnode.fixedMorphs=fixedMorphs;return vnode;}},{key:"renderImage",value:function Renderer_renderImage_(image){var url=image.imageUrl;if(url.startsWith("data:")){var dataPos=url.indexOf(",");var header=url.substring(5,dataPos);var _header$split=header.split(";"),_header$split2=_slicedToArray2(_header$split,2),mimeType=_header$split2[0],encoding=_header$split2[1];var data=url.substring(dataPos+1);if(encoding!=="base64"){url=__varRecorder__$d.string.createDataURI(data,mimeType);}}return __varRecorder__$d.h("div",Object.assign({},__varRecorder__$d.defaultAttributes(image,this),{style:__varRecorder__$d.defaultStyle(image)}),[__varRecorder__$d.h("img",{src:url,alt:image.tooltip||"",draggable:false,style:{"pointer-events":"none",position:"absolute",left:0,width:"100%",height:"100%"}}),this.renderSubmorphs(image)]);}},{key:"renderCanvas",value:function Renderer_renderCanvas_(canvas){return __varRecorder__$d.h("div",Object.assign({},__varRecorder__$d.defaultAttributes(canvas,this),{style:__varRecorder__$d.defaultStyle(canvas)}),[__varRecorder__$d.h("canvas",{width:canvas.width,height:canvas.height,style:{"pointer-events":"none",position:"absolute"},canvasHook:new __varRecorder__$d.CanvasHook(canvas)}),this.renderSubmorphs(canvas)]);}},{key:"renderCheckBox",value:function Renderer_renderCheckBox_(checkbox){return __varRecorder__$d.h("div",Object.assign({},__varRecorder__$d.defaultAttributes(checkbox,this),{style:__varRecorder__$d.defaultStyle(checkbox)}),[__varRecorder__$d.h("input",{type:"checkbox",checked:checkbox.checked,disabled:!checkbox.active,draggable:false,style:{"pointer-events":"none",width:"15px",height:"15px",position:"absolute"}}),this.renderSubmorphs(checkbox)]);}},{key:"renderPath",value:function Renderer_renderPath_(path){var id=path.id,startMarker=path.startMarker,endMarker=path.endMarker,showControlPoints=path.showControlPoints,origin=path.origin,drawnProportion=path.drawnProportion,borderWidth=path.borderWidth;var d=__varRecorder__$d.getSvgVertices(path.vertices);var el=__varRecorder__$d.h("path",Object.assign({namespace:__varRecorder__$d.svgNs,id:"svg"+path.id},__varRecorder__$d.pathAttributes(path)));var maskPath=__varRecorder__$d.h("mask",{namespace:__varRecorder__$d.svgNs,id:"mask"+path.id},[__varRecorder__$d.h("rect",{namespace:__varRecorder__$d.svgNs,attributes:{fill:"white",x:0,y:0,width:path.width+20,height:path.height+20}}),__varRecorder__$d.h("path",{namespace:__varRecorder__$d.svgNs,initStroke:new __varRecorder__$d.InitStroke(path,this,true),attributes:{d:d,stroke:"black",fill:"none"}}),__varRecorder__$d.h("path",{namespace:__varRecorder__$d.svgNs,initStroke:new __varRecorder__$d.InitStroke(path,this,false),attributes:{d:d,stroke:"white",fill:"none"}})]);var clipPath=__varRecorder__$d.h("clipPath",{namespace:__varRecorder__$d.svgNs,id:"clipPath"+path.id},__varRecorder__$d.h("path",{namespace:__varRecorder__$d.svgNs,attributes:{d:d,fill:"white"}}));var markers=[clipPath,maskPath];if(startMarker){if(!startMarker.id)startMarker.id="start-marker";el.properties.attributes["marker-start"]="url(#".concat(path.id,"-").concat(startMarker.id,")");markers=[];markers.push(this._renderPath_Marker(path,startMarker));}if(endMarker){if(!endMarker.id)endMarker.id="end-marker";el.properties.attributes["marker-end"]="url(#".concat(path.id,"-").concat(endMarker.id,")");if(!markers)markers=[];markers.push(this._renderPath_Marker(path,endMarker));}var controlPoints;if(showControlPoints){controlPoints=__varRecorder__$d.h("g",{namespace:__varRecorder__$d.svgNs},this._renderPath_ControlPoints(path));}return this.renderSvgMorph(path,el,markers,controlPoints);}},{key:"_renderPath_ControlPoints",value:function Renderer__renderPath_ControlPoints_(path,style){var vertices=path.vertices,borderWidth=path.borderWidth,showControlPoints=path.showControlPoints,_controlPointDrag=path._controlPointDrag;var radius=borderWidth==0?6:borderWidth+2;var fill="red";var rendered=[];if(_typeof2(showControlPoints)==="object"){var _r2=showControlPoints.radius,_f2=showControlPoints.fill;if(_f2)fill=String(_f2);if(typeof _r2==="number")radius=_r2;}if(vertices.length){var _i76=0;var X;var _Y;var left_cp;{var _vertices$=vertices[0],_x27=_vertices$.x,_y6=_vertices$.y,_n3=_vertices$.controlPoints.next;var _merge=_controlPointDrag&&_controlPointDrag.maybeMerge&&_controlPointDrag.maybeMerge.includes(_i76);X=_x27;_Y=_y6;rendered.push(circ(X,_Y,_i76,_merge));left_cp=_n3;}for(_i76=1;_i76<vertices.length-1;_i76++){var vertex=vertices[_i76];var isSmooth=vertex.isSmooth,_x28=vertex.x,_y7=vertex.y,_vertex$controlPoints2=vertex.controlPoints,_p8=_vertex$controlPoints2.previous,_n4=_vertex$controlPoints2.next;var _merge2=_controlPointDrag&&_controlPointDrag.maybeMerge&&_controlPointDrag.maybeMerge.includes(_i76);if(isSmooth){rendered.push(circ(_x28,_y7,_i76,_merge2),circ(X+left_cp.x,_Y+left_cp.y,_i76-1,false,"control-2",true),circ(_x28+_p8.x,_y7+_p8.y,_i76,false,"control-1",true));}else{rendered.push(circ(_x28,_y7,_i76,_merge2));}X=_x28;_Y=_y7;left_cp=_n4;}{var _vertices2=vertices[vertices.length-1],_isSmooth2=_vertices2.isSmooth,_x29=_vertices2.x,_y8=_vertices2.y,_p9=_vertices2.controlPoints.previous;var _merge3=_controlPointDrag&&_controlPointDrag.maybeMerge&&_controlPointDrag.maybeMerge.includes(_i76);if(_isSmooth2){rendered.push(circ(_x29,_y8,_i76,_merge3),circ(X+left_cp.x,_Y+left_cp.y,_i76-1,false,"control-2",true),circ(_x29+_p9.x,_y8+_p9.y,_i76,false,"control-1",true));}else{rendered.push(circ(_x29,_y8,_i76,_merge3));}}}return rendered;function circ(cx,cy,n,merge,type,isCtrl){var r=merge?12:Math.min(8,Math.max(3,radius));var cssClass="path-point path-point-"+n;var color=merge?"orange":fill;if(typeof type==="string")cssClass+="-"+type;if(isCtrl)r=Math.max(3,Math.ceil(r/2));return isCtrl?__varRecorder__$d.h("circle",{namespace:__varRecorder__$d.svgNs,style:{fill:"white","stroke-width":2,stroke:color},attributes:{"class":cssClass,cx:cx,cy:cy,r:r}}):__varRecorder__$d.h("circle",{namespace:__varRecorder__$d.svgNs,style:{fill:color},attributes:{"class":cssClass,cx:cx,cy:cy,r:r}});}}},{key:"_renderPath_Marker",value:function Renderer__renderPath_Marker_(path,markerSpec){return specTo_h_svg(markerSpec);function specTo_h_svg(spec){var tagName=spec.tagName,id=spec.id,children=spec.children,style=spec.style;var childNodes=children?children.map(specTo_h_svg):undefined;if(id)id=path.id+"-"+id;return __varRecorder__$d.h(tagName,{namespace:__varRecorder__$d.svgNs,id:id,style:style,attributes:__varRecorder__$d.obj.dissoc(spec,["tagName","id","children","style"])},childNodes);}}},{key:"renderSvgMorph",value:function Renderer_renderSvgMorph_(morph,svgEl,markers){var controlPoints=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var svgAttrs=__varRecorder__$d.svgAttributes(morph);var _morph$innerBounds=morph.innerBounds(),width=_morph$innerBounds.width,height=_morph$innerBounds.height;var defs;var svgElements=[];if(morph.fill&&morph.fill.isGradient){if(!defs)defs=[];defs.push(__varRecorder__$d.renderGradient("fill"+morph.id,morph.extent,morph.fill));}if(morph.borderColor&&morph.borderColor.valueOf().isGradient){if(!defs)defs=[];defs.push(__varRecorder__$d.renderGradient("borderColor"+morph.id,morph.extent,morph.borderColor));}if(markers&&markers.length){var _defs;if(!defs)defs=[];(_defs=defs).push.apply(_defs,_toConsumableArray2(markers));}svgElements.push(svgEl);if(defs)svgElements.push(__varRecorder__$d.h("defs",{namespace:__varRecorder__$d.svgNs},defs));var basicStyle=__varRecorder__$d.obj.select(__varRecorder__$d.defaultStyle(morph),["position","filter","display","opacity","transform","top","left","transformOrigin","cursor","overflow"]);return __varRecorder__$d.h("div",Object.assign({},__varRecorder__$d.defaultAttributes(morph,this),{style:Object.assign({},basicStyle,{width:width+"px",height:height+"px","pointer-events":morph.reactsToPointer?"auto":"none"})}),[__varRecorder__$d.h("svg",Object.assign({namespace:__varRecorder__$d.svgNs,version:"1.1",style:{position:"absolute","stroke-linejoin":morph.cornerStyle||"mint","stroke-linecap":morph.endStyle||"round",overflow:"visible"}},svgAttrs),svgElements),this.renderSubmorphs(morph),__varRecorder__$d.h("svg",Object.assign({namespace:__varRecorder__$d.svgNs,version:"1.1",style:{position:"absolute",overflow:"visible"}},svgAttrs),controlPoints)]);}},{key:"renderPreview",value:function Renderer_renderPreview_(morph,opts){var _opts$width=opts.width,width=_opts$width===void 0?100:_opts$width,_opts$height=opts.height,height=_opts$height===void 0?100:_opts$height,_opts$center=opts.center,center=_opts$center===void 0?true:_opts$center,_opts$ignoreMorphs=opts.ignoreMorphs,ignoreMorphs=_opts$ignoreMorphs===void 0?[]:_opts$ignoreMorphs,_opts$asNode=opts.asNode,asNode=_opts$asNode===void 0?false:_opts$asNode,_opts$includeStyles=opts.includeStyles,includeStyles=_opts$includeStyles===void 0?false:_opts$includeStyles,_opts$disableScroll=opts.disableScroll,disableScroll=_opts$disableScroll===void 0?false:_opts$disableScroll;var borderWidthLeft=morph.borderWidthLeft,borderWidthTop=morph.borderWidthTop,borderWidthBottom=morph.borderWidthBottom,borderWidthRight=morph.borderWidthRight,scale=morph.scale,position=morph.position,origin=morph.origin,rotation=morph.rotation;var goalWidth=width;var goalHeight=height;var safeScale=Math.max(0.1,1/scale);var invTfm=new __varRecorder__$d.Transform(position.negated(),0,__varRecorder__$d.pt(safeScale,safeScale));var bbox=invTfm.transformRectToRect(morph.bounds());var w=bbox.width;var h=bbox.height;var ratio=Math.max(0.1,Math.min(goalWidth/w,goalHeight/h));var tfm=new __varRecorder__$d.Transform(bbox.topLeft().negated().scaleBy(ratio).subPt(origin),rotation,__varRecorder__$d.pt(ratio,ratio));var node=this.getNodeForMorph(morph);if(node)node=node.cloneNode(true);else node=__varRecorder__$d.renderMorph(morph);if(center){var previewBounds=tfm.transformRectToRect(morph.extent.extentAsRectangle());var offsetX=previewBounds.width<goalWidth?(goalWidth-previewBounds.width)/2:0;var offsetY=previewBounds.height<goalHeight?(goalHeight-previewBounds.height)/2:0;tfm=tfm.preConcatenate(new __varRecorder__$d.Transform(__varRecorder__$d.pt(offsetX,offsetY)));}node.style.transform=tfm.toCSSTransformString();node.style.pointerEvents="";__varRecorder__$d.tree.prewalk(node,function(node){if(typeof node.className!=="string")return;var cssClasses=node.className.split(" ").map(function(ea){return ea.trim();}).filter(Boolean);var isMorph=cssClasses.includes("Morph");if(!isMorph)return;node.className=__varRecorder__$d.arr.withoutAll(cssClasses,["morph","Morph"]).join(" ");if(ignoreMorphs.find(function(m){return m.id===node.id;}))node.remove();node.id="";},function(node){return Array.from(node.childNodes);});return asNode?node:node.outerHTML;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Renderer";}},{key:"default",value:function Renderer_default_(){return this._default||new this();}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"rendering/renderer.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1406,end:20500});}(undefined);__varRecorder__$d.Renderer=Renderer;__varRecorder__$d.Renderer=Renderer;__varRecorder__$d.Renderer=Renderer;var __varRecorder__$e=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/font-detector.js");var FontDetector=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/font-detector.js");var __lively_class__=__lively_classholder__.hasOwnProperty("FontDetector")&&typeof __lively_classholder__.FontDetector==="function"?__lively_classholder__.FontDetector:__lively_classholder__.FontDetector=function FontDetector(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function FontDetector_initialize_(document){this.document=document;this.prepared=false;this.defaultWidth={};this.defaultHeight={};this.possibleFontWeights=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"];this.namedToNumeric=new Map(["Thin","Extra Light","Light","Normal","Medium","Semi Bold","Bold","Extra Bold","Ultra Bold"].map(function(name,i){return[name,String((i+1)*100)];}));this.baseFonts=["monospace","sans-serif","serif","Comic Sans MS"];this.span=null;}},{key:"prepare",value:function FontDetector_prepare_(){var defaultWidth=this.defaultWidth;var defaultHeight=this.defaultHeight;var fontWeights=this.possibleFontWeights;var baseFonts=this.baseFonts;var testString="mmmmmmmmmmlli";var testSize="72px";var h=this.document.getElementsByTagName("body")[0];var s=this.span||this.document.createElement("span");s.style.fontSize=testSize;s.style.opacity=0;s.innerHTML=testString;if(!s.parentNode){var _w=this.document.createElement("div");_w.style.position="absolute";_w.style.width="100%";_w.style.overflow="hidden";_w.style["pointer-events"]="none";_w.style["-webkit-user-select"]="none";_w.appendChild(s);h.appendChild(_w);}for(var _j10 in fontWeights){for(var _i77 in baseFonts){s.style.fontFamily=baseFonts[_i77];s.style.fontWeight=fontWeights[_j10];defaultWidth[baseFonts[_i77]+"@"+fontWeights[_j10]]=s.offsetWidth;defaultHeight[baseFonts[_i77]+"@"+fontWeights[_j10]]=s.offsetHeight;}}this.span=s;this.prepared=true;}},{key:"isFontSupported",value:function FontDetector_isFontSupported_(font){var weight=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"normal";if(!this.possibleFontWeights.includes(weight)){weight=this.namedToNumeric.get(weight)||"normal";}if(!this.prepared)this.prepare();var defaultWidth=this.defaultWidth,defaultHeight=this.defaultHeight,baseFonts=this.baseFonts,span=this.span,body=this.document.body;if(!span.parentNode)body.appendChild(span);try{for(var index in baseFonts){span.style.fontWeight=weight;span.style.fontFamily=font+","+baseFonts[index];var matched=span.offsetWidth!=defaultWidth[baseFonts[index]+"@"+weight]||span.offsetHeight!=defaultHeight[baseFonts[index]+"@"+weight];if(matched){return true;}}return false;}finally{}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"FontDetector";}},{key:"fonts",get:function get(){return __varRecorder__$e.fonts;}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"rendering/font-detector.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:15,end:3680});}(undefined);FontDetector=__varRecorder__$e.FontDetector;var FontDetector$1=FontDetector;var fonts=[{name:"serif",type:"default"},{name:"sans-serif",type:"default"},{name:"monospace",type:"default"},{name:"Adobe Jenson",type:"serif"},{name:"Albertus",type:"serif"},{name:"Aldus",type:"serif"},{name:"Alexandria",type:"serif"},{name:"Algerian",type:"serif"},{name:"American Typewriter",type:"serif"},{name:"Antiqua",type:"serif"},{name:"Arno",type:"serif"},{name:"Aster",type:"serif"},{name:"Aurora",type:"serif"},{name:"News 706",type:"serif"},{name:"Baskerville",type:"serif"},{name:"Bell",type:"serif"},{name:"Belwe Roman",type:"serif"},{name:"Bembo",type:"serif"},{name:"Berkeley Old Style",type:"serif"},{name:"Bernhard Modern",type:"serif"},{name:"Bodoni",type:"serif"},{name:"Book Antiqua",type:"serif"},{name:"Bookman",type:"serif"},{name:"Bulmer",type:"serif"},{name:"Caledonia",type:"serif"},{name:"Californian FB",type:"serif"},{name:"Calisto MT",type:"serif"},{name:"Cambria",type:"serif"},{name:"Capitals",type:"serif"},{name:"Cartier",type:"serif"},{name:"Caslon",type:"serif"},{name:"Wyld",type:"serif"},{name:"Caslon Antique / Fifteenth Century",type:"serif"},{name:"Catull",type:"serif"},{name:"Centaur",type:"serif"},{name:"Century Old Style",type:"serif"},{name:"Century Schoolbook",type:"serif"},{name:"New Century Schoolbook",type:"serif"},{name:"Century Schoolbook Infant",type:"serif"},{name:"Charis SIL",type:"serif"},{name:"Charter (typeface)",type:"serif"},{name:"Cheltenham",type:"serif"},{name:"Clearface",type:"serif"},{name:"Cochin",type:"serif"},{name:"Colonna",type:"serif"},{name:"Computer Modern",type:"serif"},{name:"Concrete Roman",type:"serif"},{name:"Constantia",type:"serif"},{name:"Cooper Black",type:"serif"},{name:"Copperplate Gothic",type:"serif"},{name:"Corona",type:"serif"},{name:"News 705",type:"serif"},{name:"DejaVu Serif",type:"serif"},{name:"Didot",type:"serif"},{name:"Droid Serif",type:"serif"},{name:"Elephant",type:"serif"},{name:"Emerson",type:"serif"},{name:"Excelsior",type:"serif"},{name:"News 702",type:"serif"},{name:"Fairfield",type:"serif"},{name:"FF Scala",type:"serif"},{name:"Footlight",type:"serif"},{name:"FreeSerif",type:"serif"},{name:"Friz Quadrata",type:"serif"},{name:"Garamond",type:"serif"},{name:"Gentium",type:"serif"},{name:"Georgia",type:"serif"},{name:"Gloucester",type:"serif"},{name:"Goudy",type:"serif"},{name:"Granjon",type:"serif"},{name:"High Tower Text",type:"serif"},{name:"Hoefler Text",type:"serif"},{name:"Imprint",type:"serif"},{name:"Ionic No. 5",type:"serif"},{name:"News 701",type:"serif"},{name:"ITC Benguiat",type:"serif"},{name:"Janson",type:"serif"},{name:"Jokerman",type:"serif"},{name:"Joanna",type:"serif"},{name:"Korinna",type:"serif"},{name:"Lexicon",type:"serif"},{name:"Liberation Serif",type:"serif"},{name:"Linux Libertine",type:"serif"},{name:"Literaturnaya",type:"serif"},{name:"Lucida Bright",type:"serif"},{name:"Melior",type:"serif"},{name:"Memphis",type:"serif"},{name:"Miller",type:"serif"},{name:"Minion",type:"serif"},{name:"Modern",type:"serif"},{name:"Mona Lisa",type:"serif"},{name:"Mrs Eaves",type:"serif"},{name:"MS Serif",type:"serif"},{name:"New York",type:"serif"},{name:"Nimbus Roman",type:"serif"},{name:"NPS Rawlinson Roadway",type:"serif"},{name:"OCR A Extended",type:"serif"},{name:"Palatino",type:"serif"},{name:"Book Antiqua",type:"serif"},{name:"Perpetua",type:"serif"},{name:"Plantin",type:"serif"},{name:"Playbill",type:"serif"},{name:"Primer",type:"serif"},{name:"Renault",type:"serif"},{name:"Requiem",type:"serif"},{name:"Rotis Serif",type:"serif"},{name:"Sabon",type:"serif"},{name:"Sistina",type:"serif"},{name:"Souvenir",type:"serif"},{name:"XITS",type:"serif"},{name:"Sylfaen",type:"serif"},{name:"Times New Roman",type:"serif"},{name:"Times",type:"serif"},{name:"Torino",type:"serif"},{name:"Trajan",type:"serif"},{name:"Trinit",type:"serif"},{name:"Trump Mediaeval",type:"serif"},{name:"Utopia",type:"serif"},{name:"Vera Serif",type:"serif"},{name:"Wide Latin",type:"serif"},{name:"Windsor",type:"serif"},{name:"XITS",type:"serif"},{name:"Playfair Display",type:"serif",isGoogleFont:true},{name:"Cormorant",type:"serif",isGoogleFont:true},{name:"Eczar",type:"serif",isGoogleFont:true},{name:"Alegreya",type:"serif",isGoogleFont:true},{name:"Lora",type:"serif",isGoogleFont:true},{name:"Source Serif Pro",type:"serif",isGoogleFont:true},{name:"Roboto Slab",type:"serif",isGoogleFont:true},{name:"BioRhyme",type:"serif",isGoogleFont:true},{name:"Libre Baskerville",type:"serif",isGoogleFont:true},{name:"Crimson Text",type:"serif",isGoogleFont:true},{name:"Old Standard TT",type:"serif",isGoogleFont:true},{name:"Domine",type:"serif",isGoogleFont:true},{name:"Bitter",type:"serif",isGoogleFont:true},{name:"Gentium Basic",type:"serif",isGoogleFont:true},{name:"PT Serif",type:"serif",isGoogleFont:true},{name:"Cardo",type:"serif",isGoogleFont:true},{name:"Neuton",type:"serif",isGoogleFont:true},{name:"Arvo",type:"serif",isGoogleFont:true},{name:"Merriweather",type:"serif",isGoogleFont:true},{name:"Alexandria",type:"slab serif"},{name:"American Typewriter",type:"slab serif"},{name:"Archer",type:"slab serif"},{name:"Athens",type:"slab serif"},{name:"Candida",type:"slab serif"},{name:"Cholla Slab",type:"slab serif"},{name:"City",type:"slab serif"},{name:"Clarendon",type:"slab serif"},{name:"Concrete Roman",type:"slab serif"},{name:"Courier",type:"slab serif"},{name:"Egyptienne",type:"slab serif"},{name:"Guardian Egyptian",type:"slab serif"},{name:"Ionic No. 5",type:"slab serif"},{name:"Lexia",type:"slab serif"},{name:"Memphis",type:"slab serif"},{name:"Nilland",type:"slab serif"},{name:"Roboto Slab",type:"slab serif"},{name:"Rockwell",type:"slab serif"},{name:"Schadow",type:"slab serif"},{name:"Serifa",type:"slab serif"},{name:"Skeleton Antique",type:"slab serif"},{name:"Sreda",type:"slab serif"},{name:"Swift",type:"slab serif"},{name:"Tower",type:"slab serif"},{name:"Agency FB",type:"sans-serif"},{name:"Akzidenz-Grotesk",type:"sans-serif"},{name:"Andal Sans",type:"sans-serif"},{name:"Antique Olive",type:"sans-serif"},{name:"Arial",type:"sans-serif"},{name:"Arial Unicode MS",type:"sans-serif"},{name:"Avant Garde Gothic",type:"sans-serif"},{name:"Avenir",type:"sans-serif"},{name:"Bank Gothic",type:"sans-serif"},{name:"Bauhaus",type:"sans-serif"},{name:"Bell Centennial",type:"sans-serif"},{name:"Bell Gothic",type:"sans-serif"},{name:"Benguiat Gothic",type:"sans-serif"},{name:"Berlin Sans",type:"sans-serif"},{name:"Brandon Grotesque",type:"sans-serif"},{name:"Calibri",type:"sans-serif"},{name:"Casey",type:"sans-serif"},{name:"Century Gothic",type:"sans-serif"},{name:"Charcoal",type:"sans-serif"},{name:"Chicago",type:"sans-serif"},{name:"Clearview",type:"sans-serif"},{name:"Comic Sans",type:"sans-serif"},{name:"Compacta",type:"sans-serif"},{name:"Corbel",type:"sans-serif"},{name:"DejaVu Sans",type:"sans-serif"},{name:"DIN",type:"sans-serif"},{name:"Dotum",type:"sans-serif"},{name:"Droid Sans",type:"sans-serif"},{name:"Dyslexie",type:"sans-serif"},{name:"Ecofont",type:"sans-serif"},{name:"Eras",type:"sans-serif"},{name:"Esseltub",type:"sans-serif"},{name:"Espy Sans",type:"sans-serif"},{name:"Eurocrat",type:"sans-serif"},{name:"Eurostile",type:"sans-serif"},{name:"Square 721",type:"sans-serif"},{name:"FF Dax",type:"sans-serif"},{name:"FF Meta",type:"sans-serif"},{name:"FF Scala Sans",type:"sans-serif"},{name:"Fira Sans",type:"sans-serif"},{name:"Folio",type:"sans-serif"},{name:"Franklin Gothic",type:"sans-serif"},{name:"FreeSans",type:"sans-serif"},{name:"Frutiger",type:"sans-serif"},{name:"Futura",type:"sans-serif"},{name:"Geneva",type:"sans-serif"},{name:"Gill Sans",type:"sans-serif"},{name:"Gill Sans Schoolbook",type:"sans-serif"},{name:"Gotham",type:"sans-serif"},{name:"Haettenschweiler",type:"sans-serif"},{name:"Handel Gothic",type:"sans-serif"},{name:"Hei",type:"sans-serif"},{name:"Helvetica",type:"sans-serif"},{name:"Helvetica Neue",type:"sans-serif"},{name:"Swiss 721",type:"sans-serif"},{name:"Highway Gothic",type:"sans-serif"},{name:"Hobo",type:"sans-serif"},{name:"Impact",type:"sans-serif"},{name:"Industria",type:"sans-serif"},{name:"Interstate",type:"sans-serif"},{name:"Johnston/New Johnston",type:"sans-serif"},{name:"Kabel",type:"sans-serif"},{name:"Klavika",type:"sans-serif"},{name:"Lexia Readable",type:"sans-serif"},{name:"Liberation Sans",type:"sans-serif"},{name:"Linux Biolinum",type:"sans-serif"},{name:"Lucida Sans",type:"sans-serif"},{name:"Lucida Grande",type:"sans-serif"},{name:"Lucida Sans Unicode",type:"sans-serif"},{name:"Lydian",type:"sans-serif"},{name:"Meiryo",type:"sans-serif"},{name:"Meta",type:"sans-serif"},{name:"Microgramma",type:"sans-serif"},{name:"Modern",type:"sans-serif"},{name:"Motorway",type:"sans-serif"},{name:"Arial",type:"sans-serif"},{name:"Myriad",type:"sans-serif"},{name:"Neutraface",type:"sans-serif"},{name:"Neuzeit S",type:"sans-serif"},{name:"News Gothic",type:"sans-serif"},{name:"Nimbus Sans L",type:"sans-serif"},{name:"Open Sans",type:"sans-serif"},{name:"Optima",type:"sans-serif"},{name:"Paris",type:"sans-serif"},{name:"Product Sans",type:"sans-serif"},{name:"Proxima Nova",type:"sans-serif"},{name:"Russian Federation",type:"sans-serif"},{name:"Rail Alphabet",type:"sans-serif"},{name:"Roboto",type:"sans-serif"},{name:"Rotis Sans",type:"sans-serif"},{name:"Segoe UI",type:"sans-serif"},{name:"Skia",type:"sans-serif"},{name:"Source Sans Pro",type:"sans-serif"},{name:"Sweden Sans",type:"sans-serif"},{name:"Syntax",type:"sans-serif"},{name:"Tahoma",type:"sans-serif"},{name:"Template Gothic",type:"sans-serif"},{name:"Thesis Sans",type:"sans-serif"},{name:"Tiresias",type:"sans-serif"},{name:"Trade Gothic",type:"sans-serif"},{name:"Transport",type:"sans-serif"},{name:"Trebuchet MS",type:"sans-serif"},{name:"Twentieth Century (Tw Cen MT)",type:"sans-serif"},{name:"Ubuntu",type:"sans-serif"},{name:"Univers",type:"sans-serif"},{name:"Zurich",type:"sans-serif"},{name:"Vera Sans",type:"sans-serif"},{name:"Verdana",type:"sans-serif"},{name:"Work Sans",type:"sans-serif",isGoogleFont:true},{name:"Rubik",type:"sans-serif",isGoogleFont:true},{name:"Libre Franklin",type:"sans-serif",isGoogleFont:true},{name:"Fira Sans",type:"sans-serif",isGoogleFont:true},{name:"Alegreya Sans",type:"sans-serif",isGoogleFont:true},{name:"Chivo",type:"sans-serif",isGoogleFont:true},{name:"Source Sans Pro",type:"sans-serif",isGoogleFont:true},{name:"Roboto",type:"sans-serif",isGoogleFont:true},{name:"Poppins",type:"sans-serif",isGoogleFont:true},{name:"Archivo Narrow",type:"sans-serif",isGoogleFont:true},{name:"Karla",type:"sans-serif",isGoogleFont:true},{name:"Montserrat",type:"sans-serif",isGoogleFont:true},{name:"Rajdhani",type:"sans-serif",isGoogleFont:true},{name:"PT Sans",type:"sans-serif",isGoogleFont:true},{name:"Lato",type:"sans-serif",isGoogleFont:true},{name:"Open Sans",type:"sans-serif",isGoogleFont:true},{name:"Cabin",type:"sans-serif",isGoogleFont:true},{name:"Raleway",type:"sans-serif",isGoogleFont:true},{name:"Nyala",type:"semi-serif"},{name:"Rotis Semi Serif",type:"semi-serif"},{name:"Easyreading",type:"semi-serif"},{name:"Andal Mono",type:"monospace"},{name:"Arial",type:"monospace"},{name:"Bitstream Vera (Vera Sans Mono)",type:"monospace"},{name:"Consolas",type:"monospace"},{name:"Courier",type:"monospace"},{name:"Courier New",type:"monospace"},{name:"DejaVu Sans Mono",type:"monospace"},{name:"Droid Sans Mono",type:"monospace"},{name:"Everson Mono",type:"monospace"},{name:"Fixed",type:"monospace"},{name:"Fixedsys",type:"monospace"},{name:"Fixedsys Excelsior",type:"monospace"},{name:"HyperFont",type:"monospace"},{name:"Inconsolata",type:"monospace"},{name:"Letter Gothic",type:"monospace"},{name:"Liberation Mono",type:"monospace"},{name:"Lucida Console",type:"monospace"},{name:"Lucida Sans Typewriter",type:"monospace"},{name:"Lucida Typewriter",type:"monospace"},{name:"Menlo",type:"monospace"},{name:"MICR",type:"monospace"},{name:"Monaco",type:"monospace"},{name:"Monospace",type:"monospace"},{name:"MS Gothic",type:"monospace"},{name:"MS Mincho",type:"monospace"},{name:"Nimbus Mono L",type:"monospace"},{name:"OCR-A",type:"monospace"},{name:"OCR-B",type:"monospace"},{name:"PragmataPro",type:"monospace"},{name:"Prestige Elite",type:"monospace"},{name:"ProFont",type:"monospace"},{name:"Proggy programming fonts",type:"monospace"},{name:"SimHei",type:"monospace"},{name:"SimSun",type:"monospace"},{name:"Source Code Pro",type:"monospace"},{name:"Terminal",type:"monospace"},{name:"Trixie",type:"monospace"},{name:"Ubuntu Mono",type:"monospace"},{name:"Vera Sans Mono (Bitstream Vera)",type:"monospace"},{name:"Space Mono",type:"monospace",isGoogleFont:true},{name:"Inconsolata",type:"monospace",isGoogleFont:true},{name:"Anonymous Pro",type:"monospace",isGoogleFont:true},{name:"Balloon",type:"script"},{name:"Brush Script",type:"script"},{name:"Choc",type:"script"},{name:"Dom Casual",type:"script"},{name:"Mistral",type:"script"},{name:"Papyrus",type:"script"},{name:"Segoe Script",type:"script"},{name:"Utopia",type:"script"},{name:"Coronet",type:"script"},{name:"Curlz",type:"script"},{name:"Gravura",type:"script"},{name:"Script",type:"script"},{name:"Wiesbaden Swing",type:"script"},{name:"American Scribe",type:"script"},{name:"AMS Euler",type:"script"},{name:"Apple Chancery",type:"script"},{name:"Forte",type:"script"},{name:"French Script",type:"script"},{name:"ITC Zapf Chancery",type:"script"},{name:"Kuenstler Script",type:"script"},{name:"Monotype Corsiva",type:"script"},{name:"Old English Text MT",type:"script"},{name:"Zapfino",type:"script"},{name:"Andy",type:"handwriting"},{name:"Ashley Script",type:"handwriting"},{name:"Czanne",type:"handwriting"},{name:"Chalkboard",type:"handwriting"},{name:"Comic Sans MS",type:"handwriting"},{name:"Dom Casual",type:"handwriting"},{name:"Kristen",type:"handwriting"},{name:"Lucida Handwriting",type:"handwriting"},{name:"Bastard",type:"blackletter"},{name:"Breitkopf Fraktur",type:"blackletter"},{name:"Cloister Black",type:"blackletter"},{name:"Fette Fraktur",type:"blackletter"},{name:"Fletcher",type:"blackletter"},{name:"Fraktur",type:"blackletter"},{name:"Lucida Blackletter",type:"blackletter"},{name:"Old English Text",type:"blackletter"},{name:"Schwabacher",type:"blackletter"},{name:"Aharoni",type:"non-latin"},{name:"Aparajita",type:"non-latin"},{name:"Arial",type:"non-latin"},{name:"Calibri",type:"non-latin"},{name:"Chandas",type:"non-latin"},{name:"Gadugi",type:"non-latin"},{name:"Grecs du roi",type:"non-latin"},{name:"Javanese script",type:"non-latin"},{name:"Japanese Gothic",type:"non-latin"},{name:"Jomolhari",type:"non-latin"},{name:"Kiran",type:"non-latin"},{name:"Kochi",type:"non-latin"},{name:"Koren",type:"non-latin"},{name:"Kruti Dev",type:"non-latin"},{name:"Malgun Gothic",type:"non-latin"},{name:"Meiryo",type:"non-latin"},{name:"Microsoft JhengHei",type:"non-latin"},{name:"Microsoft YaHei",type:"non-latin"},{name:"Minch",type:"non-latin"},{name:"Ming",type:"non-latin"},{name:"Mona",type:"non-latin"},{name:"MS Gothic",type:"non-latin"},{name:"Nastaliq Navees",type:"non-latin"},{name:"Porson",type:"non-latin"},{name:"Segoe UI Symbol",type:"non-latin"},{name:"Shruti",type:"non-latin"},{name:"SimSun",type:"non-latin"},{name:"Sylfaen",type:"non-latin"},{name:"Tahoma",type:"non-latin"},{name:"Tengwar",type:"non-latin"},{name:"Tibetan Machine Uni",type:"non-latin"},{name:"Wilson Greek",type:"non-latin"},{name:"SMP",type:"unicode"},{name:"Microsoft Office",type:"unicode"},{name:"Bitstream Cyberbit",type:"unicode"},{name:"DejaVu fonts",type:"unicode"},{name:"Charis SIL",type:"unicode"},{name:"BMP",type:"unicode"},{name:"SMP",type:"unicode"},{name:"Code2002",type:"unicode"},{name:"DejaVu fonts",type:"unicode"},{name:"IPA",type:"unicode"},{name:"Everson Mono",type:"unicode"},{name:"Windows",type:"unicode"},{name:"Fixedsys Excelsior",type:"unicode"},{name:"FreeFont",type:"unicode"},{name:"Gentium",type:"unicode"},{name:"GNU Unifont",type:"unicode"},{name:"Georgia Ref",type:"unicode"},{name:"Microsoft Office",type:"unicode"},{name:"Junicode",type:"unicode"},{name:"Mac OS 8.5",type:"unicode"},{name:"macOS",type:"unicode"},{name:"ISO 8859-x",type:"unicode"},{name:"MS Gothic",type:"unicode"},{name:"MS Mincho",type:"unicode"},{name:"Nimbus Sans Global",type:"unicode"},{name:"Noto",type:"unicode"},{name:"Fabrizio Schiavi",type:"unicode"},{name:"Squarish Sans CT",type:"unicode"},{name:"XITS",type:"unicode"},{name:"Titus Cyberbit Basic",type:"unicode"},{name:"Verdana Ref",type:"unicode"},{name:"XITS",type:"unicode"},{name:"Apple Symbols",type:"symbol"},{name:"Asana-Math",type:"symbol"},{name:"Blackboard bold",type:"symbol"},{name:"Bookshelf Symbol 7",type:"symbol"},{name:"Cambria Math",type:"symbol"},{name:"Computer Modern",type:"symbol"},{name:"Lucida Math",type:"symbol"},{name:"Marlett",type:"symbol"},{name:"Symbol",type:"symbol"},{name:"Webdings",type:"symbol"},{name:"Wingdings",type:"symbol"},{name:"Wingdings 2",type:"symbol"},{name:"Wingdings 3",type:"symbol"},{name:"Zapf Dingbats",type:"symbol"},{name:"Ad Lib",type:"decorative"},{name:"Allegro",type:"decorative"},{name:"Andreas",type:"decorative"},{name:"Arnold Bcklin",type:"decorative"},{name:"Astur",type:"decorative"},{name:"Banco",type:"decorative"},{name:"Bauhaus",type:"decorative"},{name:"Braggadocio",type:"decorative"},{name:"Broadway",type:"decorative"},{name:"Caslon Antique",type:"decorative"},{name:"Cooper Black",type:"decorative"},{name:"Curlz",type:"decorative"},{name:"Ellington",type:"decorative"},{name:"Exocet",type:"decorative"},{name:"FIG Script",type:"decorative"},{name:"Forte",type:"decorative"},{name:"Gabriola",type:"decorative"},{name:"Horizon",type:"decorative"},{name:"Jim Crow",type:"decorative"},{name:"Lo-Type",type:"decorative"},{name:"Neuland",type:"decorative"},{name:"Peignot",type:"decorative"},{name:"San Francisco",type:"decorative"},{name:"Stencil",type:"decorative"},{name:"Umbra",type:"decorative"},{name:"Westminster",type:"decorative"},{name:"Willow",type:"decorative"},{name:"Windsor",type:"decorative"},{name:"Lithos",type:"mimicry"},{name:"Skia",type:"mimicry"},{name:"3x3",type:"misc"},{name:"Compatil",type:"misc"},{name:"Generis",type:"misc"},{name:"Grasset",type:"misc"},{name:"LED",type:"misc"},{name:"Luxi",type:"misc"},{name:"System",type:"misc"}];__varRecorder__$e.fonts=fonts;__varRecorder__$e.fonts=fonts;__varRecorder__$e.fonts=fonts;__varRecorder__$e["default"]=FontDetector;var __varRecorder__$f=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/font-metric.js");function textlayerNodeForFontMeasure(morph){var _morph$viewState=morph.viewState,text_layer_node=_morph$viewState.text_layer_node,fontmetric_text_layer_node=_morph$viewState.fontmetric_text_layer_node;if(text_layer_node){if(!text_layer_node.className.includes("newtext-text-layer")){morph.viewState.text_layer_node=text_layer_node=text_layer_node.parentNode.querySelector(".newtext-text-layer.actual");}}if(fontmetric_text_layer_node){if(!fontmetric_text_layer_node.className.includes("newtext-text-layer")){morph.viewState.fontmetric_text_layer_node=fontmetric_text_layer_node=null;}}if(text_layer_node&&!fontmetric_text_layer_node&&text_layer_node.parentNode){fontmetric_text_layer_node=morph.viewState.fontmetric_text_layer_node=text_layer_node.parentNode.querySelector(".newtext-text-layer.font-measure");}return fontmetric_text_layer_node;}__varRecorder__$f.textlayerNodeForFontMeasure=textlayerNodeForFontMeasure;function isExtendingChar(ch){return ch.charCodeAt(0)>=768&&__varRecorder__$f.extendingChars.test(ch);}__varRecorder__$f.isExtendingChar=isExtendingChar;function skipExtendingChars(str,pos,dir){while((dir<0?pos>0:pos<str.length)&&__varRecorder__$f.isExtendingChar(str.charAt(pos))){pos=pos+dir;}return pos;}__varRecorder__$f.skipExtendingChars=skipExtendingChars;function charBoundsOfBigMonospacedLine(morph,fontMetric,line,lineNode){var offsetX=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var offsetY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var styleOpts=arguments.length>6?arguments[6]:undefined;var directRenderTextLayerFn=arguments.length>7?arguments[7]:undefined;var textLength=line.text.length;if(textLength<500||fontMetric.isProportional(__varRecorder__$f.getComputedFontFamily(lineNode))){return null;}var lineWidth=Infinity;var lineHeight=Infinity;var defaultTextStyle=styleOpts.defaultTextStyle,lineWrapping=styleOpts.lineWrapping;if(lineWrapping){var _lineNode$getBounding=lineNode.getBoundingClientRect();lineWidth=_lineNode$getBounding.width;lineHeight=_lineNode$getBounding.height;}var _fontMetric$_domMeasu=fontMetric._domMeasure.defaultCharExtent(morph,{defaultTextStyle:defaultTextStyle},directRenderTextLayerFn),width=_fontMetric$_domMeasu.width,height=_fontMetric$_domMeasu.height;var x=offsetX;var y=offsetY;var result=new Array(textLength);for(var _i78=0;_i78<textLength;_i78++){if(x+width>lineWidth){x=0;y=y+height;}result[_i78]={x:x,y:y,width:width,height:height};x=x+width;}return result;}__varRecorder__$f.charBoundsOfBigMonospacedLine=charBoundsOfBigMonospacedLine;function charBoundsOfLine(line,lineNode){var offsetX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var offsetY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var ELEMENT_NODE=lineNode.ELEMENT_NODE,TEXT_NODE=lineNode.TEXT_NODE,childNodes=lineNode.childNodes;var maxLength=Infinity;var document=lineNode.ownerDocument;var result=[];var index=0;var textNode;var left;var top;var width;var height;var x;var y;var emptyNodeFill;var node;if(!lineNode)node=null;else if(lineNode.className.includes("line")){offsetX=offsetX-lineNode.offsetLeft;offsetY=offsetY-lineNode.offsetTop;node=lineNode.childNodes[0];}else{var realLineNode=lineNode.getElementsByClassName("line")[0];node=realLineNode.childNodes[0];offsetX=offsetX-lineNode.offsetLeft+__varRecorder__$f.getComputedMarginLeft(lineNode);offsetY=offsetY-lineNode.offsetTop;}if(!node){emptyNodeFill=node=document.createElement("br");lineNode.appendChild(emptyNodeFill);}while(node){if(index>maxLength)break;textNode=node.tagName!=="BR"&&node.nodeType===ELEMENT_NODE&&node.childNodes[0]||node;if(textNode.nodeType===TEXT_NODE){var length=textNode.length;for(var _i79=0;_i79<length;_i79++){var _varRecorder__$f$mea=__varRecorder__$f.measureCharInner(document,textNode,_i79,"right");left=_varRecorder__$f$mea.left;top=_varRecorder__$f$mea.top;width=_varRecorder__$f$mea.width;height=_varRecorder__$f$mea.height;x=left+offsetX;y=top+offsetY;result[index++]={x:x,y:y,width:width,height:height};}}else if(node.nodeType===ELEMENT_NODE){var _node$getBoundingClie=node.getBoundingClientRect();left=_node$getBoundingClie.left;top=_node$getBoundingClie.top;width=_node$getBoundingClie.width;height=_node$getBoundingClie.height;x=left+offsetX,y=top+offsetY;result[index++]={x:x,y:y,width:width,height:height};}else throw new Error("Cannot deal with node ".concat(node));node=node.nextSibling;}if(emptyNodeFill){emptyNodeFill.parentNode.removeChild(emptyNodeFill);}return result;}__varRecorder__$f.charBoundsOfLine=charBoundsOfLine;function measureCharInner(document,node,index){var bias=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"left";var rect;var start=index;var end=index+1;if(node.nodeType==3){for(var _i80=0;_i80<4;_i80++){rect=__varRecorder__$f.getUsefulRect(__varRecorder__$f.range(document,node,start,end).getClientRects(),bias);if(rect.left||rect.right||start==0)break;end=start;start=start-1;}}return rect;}__varRecorder__$f.measureCharInner=measureCharInner;function range$1(document,node,start,end,endNode){var r=document.createRange();r.setEnd(endNode||node,end);r.setStart(node,start);return r;}__varRecorder__$f.range=range$1;function getUsefulRect(rects,bias){var rect={left:0,right:0,top:0,bottom:0};if(bias=="left"){for(var _i81=0;_i81<rects.length;_i81++){if((rect=rects[_i81]).left!=rect.right)break;}}else{for(var _i82=rects.length-1;_i82>=0;_i82--){if((rect=rects[_i82]).left!=rect.right)break;}}return rect;}__varRecorder__$f.getUsefulRect=getUsefulRect;__varRecorder__$f.string=string;__varRecorder__$f.obj=obj;__varRecorder__$f.FontDetector=FontDetector$1;__varRecorder__$f.cumulativeOffset=cumulativeOffset;__varRecorder__$f.config=config;__varRecorder__$f.debug=!!__varRecorder__$f.config.onloadURLQuery["debug-font-metric"];__varRecorder__$f.checkTimeout=1000;var FontMetric=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/font-metric.js");var __lively_class__=__lively_classholder__.hasOwnProperty("FontMetric")&&typeof __lively_classholder__.FontMetric==="function"?__lively_classholder__.FontMetric:__lively_classholder__.FontMetric=function FontMetric(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function FontMetric_initialize_(){this.charMap={};this.cachedBoundsInfo={};this.supportedFontCache={};this.element=null;this.isProportionalCache={};}},{key:"reset",value:function FontMetric_reset_(debug){var doc,parentNode;if(this.element){parentNode=this.element.parentNode;doc=this.element.ownerDocument;}this.uninstall();this.charMap={};this.cachedBoundsInfo={};if(doc&&parentNode){this.install(doc,parentNode,debug);}}},{key:"install",value:function FontMetric_install_(doc,parentEl,debug){this.element=doc.createElement("div");this.element.name="fontMetric";this.setMeasureNodeStyles(this.element.style,true);parentEl.appendChild(this.element);this._domMeasure=new __varRecorder__$f.DOMTextMeasure().install(doc,parentEl,debug);}},{key:"uninstall",value:function FontMetric_uninstall_(){if(!this.element)return;if(this.element.parentNode)this.element.parentNode.removeChild(this.element);this.element=null;if(this._domMeasure)this._domMeasure.uninstall();}},{key:"setMeasureNodeStyles",value:function FontMetric_setMeasureNodeStyles_(style,isRoot){style.width=style.height="auto";style.left=style.top="0px";style.visibility="hidden";style.position="absolute";style.whiteSpace="pre";style.font="inherit";style.overflow=isRoot?"hidden":"visible";}},{key:"measure",value:function FontMetric_measure_(style,text){var fontFamily=style.fontFamily,fontSize=style.fontSize,fontWeight=style.fontWeight,fontStyle=style.fontStyle,textDecoration=style.textDecoration,textStyleClasses=style.textStyleClasses,transform=style.transform;var el=this.element;if(transform)transform=transform.inverse();el.textContent=text;Object.assign(el.style,{"-webkit-text-size-adjust":"none",fontFamily:fontFamily,fontWeight:fontWeight,fontStyle:fontStyle,textDecoration:textDecoration,transform:transform,fontSize:fontSize+"px"});el.className=textStyleClasses?textStyleClasses.join(" "):"";var width,height;try{var _el$getBoundingClient=el.getBoundingClientRect();width=_el$getBoundingClient.width;height=_el$getBoundingClient.height;}catch(e){return{width:0,height:0};}return{height:height,width:width};}},{key:"charBoundsFor",value:function FontMetric_charBoundsFor_(style,str){var nCols=str.length;var bounds=new Array(nCols);var _this$cachedBoundsInf=this.cachedBoundsInfo,cachedBounds=_this$cachedBoundsInf.bounds,cachedStr=_this$cachedBoundsInf.str,cachedStyle=_this$cachedBoundsInf.style;var isMonospace=!this.isProportional(style.fontFamily);if(isMonospace){var single=this.sizeFor(style,"x",true);var _double=this.sizeFor(style,"xx",true);var width=_double.width-single.width;var height=single.height;var _x30=0;for(var _i83=0;_i83<nCols;_i83++){_x30=width*_i83;bounds[_i83]={x:_x30,y:0,width:width,height:height};}}else{var useCache=cachedBounds&&__varRecorder__$f.obj.equals(cachedStyle,style);var adjustSpacing=!style.fixedCharacterSpacing;for(var col=0,_x31=0;col<nCols;col++){var _width=void 0;var _height=void 0;var _char=str[col];if(adjustSpacing){useCache=useCache&&_char===cachedStr[col];if(useCache){var _cachedBounds$col=cachedBounds[col];_width=_cachedBounds$col.width;_height=_cachedBounds$col.height;}else{var prefix=str.substr(0,col+1);var _this$measure=this.measure(style,prefix);_width=_this$measure.width;_height=_this$measure.height;_width-=_x31;}}else{var _this$sizeFor=this.sizeFor(style,_char);_width=_this$sizeFor.width;_height=_this$sizeFor.height;}bounds[col]={x:_x31,y:0,width:Math.ceil(_width),height:Math.ceil(_height)};_x31=_x31+_width;}if(adjustSpacing)this.cachedBoundsInfo={bounds:bounds,str:str,style:style};}return bounds;}},{key:"isProportional",value:function FontMetric_isProportional_(fontFamily){if(this.isProportionalCache.hasOwnProperty(fontFamily)){return this.isProportionalCache[fontFamily];}var style={fontFamily:fontFamily,fontSize:12};var w_width=this.sizeFor(style,"w").width;var i_width=this.sizeFor(style,"i").width;return this.isProportionalCache[fontFamily]=w_width!==i_width;}},{key:"sizeFor",value:function FontMetric_sizeFor_(style){var string=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var forceCache=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var fontFamily=style.fontFamily,fontSize=style.fontSize,fontWeight=style.fontWeight,fontStyle=style.fontStyle,textDecoration=style.textDecoration,textStyleClasses=style.textStyleClasses;var relevantStyle={fontFamily:fontFamily,fontSize:fontSize,fontWeight:fontWeight,fontStyle:fontStyle,textDecoration:textDecoration,textStyleClasses:textStyleClasses};if(!forceCache&&string.length>1)return this.measure(relevantStyle,string);var className=textStyleClasses?textStyleClasses.join(" "):"";var styleKey=[fontFamily,fontSize,fontWeight,fontStyle,textDecoration,className].join("-");if(!this.charMap[styleKey]){this.charMap[styleKey]={};}if(!this.charMap[styleKey][string]){this.charMap[styleKey][string]=this.measure(relevantStyle,string);}return this.charMap[styleKey][string];}},{key:"defaultLineHeight",value:function FontMetric_defaultLineHeight_(style){return this.sizeFor(style," ").height;}},{key:"isFontSupported",value:function FontMetric_isFontSupported_(font){var weight=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"normal";var fd=this.fontDetector||(this.fontDetector=new __varRecorder__$f.FontDetector(this.element.ownerDocument));if(this.supportedFontCache[font+"-"+weight]){var _this$supportedFontCa=this.supportedFontCache[font+"-"+weight],ts=_this$supportedFontCa.ts,_value2=_this$supportedFontCa.value;if(Date.now()-ts<__varRecorder__$f.checkTimeout)return _value2;}var value=fd.isFontSupported(font,weight);this.supportedFontCache[font+"-"+weight]={ts:Date.now(),value:value};return value;}},{key:"defaultCharExtent",value:function FontMetric_defaultCharExtent_(morph,styleOpts,rendertTextLayerFn){return this._domMeasure.defaultCharExtent(morph,styleOpts,rendertTextLayerFn);}},{key:"manuallyComputeCharBoundsOfLine",value:function FontMetric_manuallyComputeCharBoundsOfLine_(morph,line){var offsetX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var offsetY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var styleOpts=arguments.length>4?arguments[4]:undefined;var rendertTextLayerFn=arguments.length>5?arguments[5]:undefined;var renderLineFn=arguments.length>6?arguments[6]:undefined;return this._domMeasure.computeCharBBoxes(morph,line,offsetX=0,offsetY=0,styleOpts,rendertTextLayerFn,renderLineFn,this);}},{key:"manuallyComputeBoundsOfLines",value:function FontMetric_manuallyComputeBoundsOfLines_(morph,lines){var offsetX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var offsetY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var styleOpts=arguments.length>4?arguments[4]:undefined;var rendertTextLayerFn=arguments.length>5?arguments[5]:undefined;var renderLineFn=arguments.length>6?arguments[6]:undefined;return this._domMeasure.computeBBoxesOfLines(morph,lines,offsetX=0,offsetY=0,styleOpts,rendertTextLayerFn,renderLineFn);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"FontMetric";}},{key:"default",value:function FontMetric_default_(){if(!this._fontMetric){throw new Error("FontMetric has not yet been initialized!");}return this._fontMetric;}},{key:"initDefault",value:function FontMetric_initDefault_(domEnv){if(!this._fontMetric){if(!domEnv&&typeof document==="undefined"){throw new Error("Cannot initialize FontMetric without document");}if(!domEnv)domEnv={document:document};this._fontMetric=this.forDOMEnv(domEnv);}return this._fontMetric;}},{key:"removeDefault",value:function FontMetric_removeDefault_(){if(this._fontMetric){this._fontMetric.uninstall();this._fontMetric=null;}}},{key:"forDOMEnv",value:function FontMetric_forDOMEnv_(_ref21){var document=_ref21.document;var fontMetric=new __varRecorder__$f.FontMetric();fontMetric.install(document,document.body);return fontMetric;}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"rendering/font-metric.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:316,end:7459});}(undefined);FontMetric=__varRecorder__$f.FontMetric;var FontMetric$1=FontMetric;__varRecorder__$f.extendingChars=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;var DOMTextMeasure=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/rendering/font-metric.js");var __lively_class__=__lively_classholder__.hasOwnProperty("DOMTextMeasure")&&typeof __lively_classholder__.DOMTextMeasure==="function"?__lively_classholder__.DOMTextMeasure:__lively_classholder__.DOMTextMeasure=function DOMTextMeasure(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"reset",value:function DOMTextMeasure_reset_(){var doc,parentNode;if(this.element){parentNode=this.element.parentNode;doc=this.element.ownerDocument;}this.uninstall();if(doc&&parentNode){this.install(doc,parentNode);}return this;}},{key:"install",value:function DOMTextMeasure_install_(doc,parentEl){var debug=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this.debug=debug;this.maxLineBBoxCacheCount=debug?1:3000;this.lineBBoxCacheCount=0;this.lineBBoxCache={};this.maxTextlayerNodeCacheCount=debug?1:30;this.textlayerNodeCacheCount=0;this.textlayerNodeCache={};this.defaultCharWidthHeightCache={};this.doc=doc;var el=this.element=doc.createElement("div");el.className="dom-measure"+(debug?" debug":"");this.setMeasureNodeStyles(el.style,true);parentEl.appendChild(el);return this;}},{key:"uninstall",value:function DOMTextMeasure_uninstall_(){var el=this.element;if(!el)return;if(el.parentNode)el.parentNode.removeChild(el);this.element=null;}},{key:"setMeasureNodeStyles",value:function DOMTextMeasure_setMeasureNodeStyles_(style,isRoot){style.width=style.height="auto";if(!this.debug){style.left=style.top="0px";style.visibility="hidden";}style.position="absolute";style.whiteSpace="pre";style.font="inherit";style.overflow=isRoot&&!this.debug?"hidden":"visible";}},{key:"generateStyleKey",value:function DOMTextMeasure_generateStyleKey_(styleOpts){var _styleOpts$defaultTex=styleOpts.defaultTextStyle,fontFamily=_styleOpts$defaultTex.fontFamily,fontSize=_styleOpts$defaultTex.fontSize,fontWeight=_styleOpts$defaultTex.fontWeight,fontStyle=_styleOpts$defaultTex.fontStyle,textDecoration=_styleOpts$defaultTex.textDecoration,textStyleClasses=_styleOpts$defaultTex.textStyleClasses,paddingLeft=styleOpts.paddingLeft,paddingRight=styleOpts.paddingRight,paddingTop=styleOpts.paddingTop,paddingBottom=styleOpts.paddingBottom,width=styleOpts.width,height=styleOpts.height,clipMode=styleOpts.clipMode,lineWrapping=styleOpts.lineWrapping,textAlign=styleOpts.textAlign;return[fontFamily,fontSize,fontWeight,fontStyle,textDecoration,textStyleClasses,paddingLeft,paddingRight,paddingTop,paddingBottom,width,height,clipMode,lineWrapping,textAlign].join("-");}},{key:"defaultCharExtent",value:function DOMTextMeasure_defaultCharExtent_(morph,styleOpts,rendertTextLayerFn){var _this38=this;var styleKey=this.generateStyleKey(styleOpts);var found=this.defaultCharWidthHeightCache[styleKey];if(typeof found!=="undefined"&&(found.height!==0||found.width!==0)){return found;}var doc=this.doc;var testStringW="abcdefghijklmnopqrstufwxyz ABCDEFGHIJKLMNOPQRSTUFWXYZ 1234567890 {}[];,./<>?'\"!@#$%^&*()-=_+";var testStringH="H\ne\nll\no";return this.withTextLayerNodeDo(morph,rendertTextLayerFn,styleOpts,styleKey,function(textNode){var spanW=doc.createElement("span");spanW.className="line";spanW.style.whiteSpace="pre";textNode.appendChild(spanW);spanW.textContent=testStringW;var _spanW$getBoundingCli=spanW.getBoundingClientRect(),width=_spanW$getBoundingCli.width;var spanH=doc.createElement("span");spanH.className="line";spanH.style.whiteSpace="pre";textNode.appendChild(spanH);spanH.textContent=testStringH;var _spanH$getBoundingCli=spanH.getBoundingClientRect(),height=_spanH$getBoundingCli.height;textNode.removeChild(spanW);textNode.removeChild(spanH);return _this38.defaultCharWidthHeightCache[styleKey]={width:width/testStringW.length,height:Math.ceil(height/4)};});}},{key:"computeBBoxesOfLines",value:function DOMTextMeasure_computeBBoxesOfLines_(morph,lines){var _this39=this;var offsetX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var offsetY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var styleOpts=arguments.length>4?arguments[4]:undefined;var rendertTextLayerFn=arguments.length>5?arguments[5]:undefined;var renderLineFn=arguments.length>6?arguments[6]:undefined;var styleKey=this.generateStyleKey(styleOpts);var result=new Array(lines.length);var allInCache=true;for(var _i84=0;_i84<lines.length;_i84++){var line=lines[_i84];var cached=!line.textAttributes.length&&this.lineBBoxCache[styleKey+"_"+lines[_i84].text];if(cached&&cached.height&&cached.width)result[_i84]=cached;else allInCache=false;}if(allInCache)return result;return this.withTextLayerNodeDo(morph,rendertTextLayerFn,styleOpts,styleKey,function(textNode,textNodeOffsetLeft,textNodeOffsetTop){var lineNodes=new Array(lines.length);var results=new Array(lines.length);for(var _i85=0;_i85<lines.length;_i85++){if(results[_i85])continue;var lineNode=renderLineFn(lines[_i85]);lineNode.style.display="inline-block";textNode.appendChild(lineNode);lineNodes[_i85]=lineNode;}for(var _i86=0;_i86<lineNodes.length;_i86++){if(results[_i86])continue;var node=lineNodes[_i86];var _node$getBoundingClie2=node.getBoundingClientRect(),left=_node$getBoundingClie2.left,top=_node$getBoundingClie2.top,width=_node$getBoundingClie2.width,height=_node$getBoundingClie2.height;_this39.lineBBoxCache[styleKey+"_"+lines[_i86].text]=results[_i86]={x:left-node.offsetLeft+offsetX-textNodeOffsetLeft,y:top-node.offsetTop+offsetY-textNodeOffsetTop,width:width,height:height};}for(var _i87=0;_i87<lineNodes.length;_i87++){textNode.removeChild(lineNodes[_i87]);}return results;});}},{key:"computeCharBBoxes",value:function DOMTextMeasure_computeCharBBoxes_(morph,line){var _this40=this;var offsetX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var offsetY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var styleOpts=arguments.length>4?arguments[4]:undefined;var renderTextLayerFn=arguments.length>5?arguments[5]:undefined;var renderLineFn=arguments.length>6?arguments[6]:undefined;var fontMetric=arguments.length>7?arguments[7]:undefined;return this.withTextLayerNodeDo(morph,renderTextLayerFn,styleOpts,this.generateStyleKey(styleOpts),function(textNode,textNodeOffsetLeft,textNodeOffsetTop){var lineNode=renderLineFn(line);var _=textNode.appendChild(lineNode);var result=line.stringSize>10000&&__varRecorder__$f.charBoundsOfBigMonospacedLine(morph,fontMetric,line,lineNode,offsetX,offsetY,styleOpts,renderTextLayerFn)||__varRecorder__$f.charBoundsOfLine(line,lineNode,offsetX-textNodeOffsetLeft,offsetY-textNodeOffsetTop);if(!_this40.debug){lineNode.parentNode.removeChild(lineNode);}return result;});}},{key:"withTextLayerNodeDo",value:function DOMTextMeasure_withTextLayerNodeDo_(morph,rendertTextLayerFn,styleOpts,styleKey,doFn){var document=this.doc,cache=this.textlayerNodeCache,root=this.element;var textNodeOffsetLeft=0;var textNodeOffsetTop=0;var textNode=__varRecorder__$f.textlayerNodeForFontMeasure(morph);if(!textNode)textNode=cache[styleKey];if(!textNode){this.textlayerNodeCacheCount++;textNode=cache[styleKey]=rendertTextLayerFn(styleOpts,[]);textNode.id=styleKey;var width=styleOpts.width,clipMode=styleOpts.clipMode;if(styleOpts.width||styleOpts.clipMode&&styleOpts.clipMode!=="visible"){var clipNode=document.createElement("div");clipNode.style.position="absolute";if(clipMode)clipNode.style.overflow=clipMode;if(width)clipNode.style.width=width+"px";clipNode.id=styleKey;clipNode.appendChild(textNode);root.appendChild(clipNode);}else{root.appendChild(textNode);}}var tfm=morph.getGlobalTransform().inverse();if(morph.env.renderer&&morph.env.renderer.getNodeForMorph(morph)&&(tfm.getScale()!=1||tfm.getRotation()!=0)){tfm.e=tfm.f=0;textNode.style.transform=tfm.toString();}var layerBounds=textNode.getBoundingClientRect();textNodeOffsetLeft=layerBounds.left;textNodeOffsetTop=layerBounds.top;try{return doFn(textNode,textNodeOffsetLeft,textNodeOffsetTop);}finally{textNode.style.transform="";if(!this.debug&&this.textlayerNodeCacheCount>this.maxTextlayerNodeCacheCount){var toRemove=Math.ceil(this.maxTextlayerNodeCacheCount/2);var node;while(toRemove--&&(node=root.childNodes[0])){cache[node.id]=null;root.removeChild(node);}this.textlayerNodeCacheCount=this.textlayerNodeCacheCount-toRemove;}}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"DOMTextMeasure";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"rendering/font-metric.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:11128,end:19574});}(undefined);__varRecorder__$f.GLOBAL=typeof System!=="undefined"?System.global:window||global||self||undefined;__varRecorder__$f.getComputedFontFamily=typeof __varRecorder__$f.GLOBAL.getComputedStyle==="function"?function(node){return __varRecorder__$f.GLOBAL.getComputedStyle(node).fontFamily;}:function(){return"";};__varRecorder__$f.getComputedMarginLeft=typeof __varRecorder__$f.GLOBAL.getComputedStyle==="function"?function(node){return parseInt(__varRecorder__$f.GLOBAL.getComputedStyle(node).marginLeft)||0;}:function(){return 0;};__varRecorder__$f["default"]=FontMetric;var __varRecorder__$g=lively.FreezerRuntime.recorderFor("lively.morphic/changes.js");function signalBindings(obj,name,change){var conns=obj.attributeConnections;if(!conns)return;conns=conns.slice();for(var _i88=0;_i88<conns.length;_i88++){if(conns[_i88].sourceAttrName===name){conns[_i88].update(change);}}}__varRecorder__$g.signalBindings=signalBindings;function informMorph(changeManager,change,morph){try{morph.onChange(change);__varRecorder__$g.signalBindings(morph,"change",change);var owner=morph.owner;while(owner){owner.onSubmorphChange(change,morph);owner=owner.owner;}}catch(err){console.error("Error in informMorph: ".concat(err.stack));}}__varRecorder__$g.informMorph=informMorph;__varRecorder__$g.arr=arr;__varRecorder__$g.string=string;__varRecorder__$g.obj=obj;__varRecorder__$g.connect=connect;__varRecorder__$g.signal=signal;__varRecorder__$g.disconnect=disconnect;var Change=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/changes.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Change")&&typeof __lively_classholder__.Change==="function"?__lively_classholder__.Change:__lively_classholder__.Change=function Change(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Change_initialize_(target){this.target=target;this.group=null;}},{key:"type",get:function get(){return"abstract change";}},{key:"apply",value:function Change_apply_(){throw new Error("Not yet implemented");}},{key:"reverseApply",value:function Change_reverseApply_(){throw new Error("Not yet implemented");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Change";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"changes.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:769,end:1025});}(undefined);var GroupChange=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/changes.js");var __lively_class__=__lively_classholder__.hasOwnProperty("GroupChange")&&typeof __lively_classholder__.GroupChange==="function"?__lively_classholder__.GroupChange:__lively_classholder__.GroupChange=function GroupChange(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function GroupChange_initialize_(target){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,target);this.changes=[];}},{key:"consumesChanges",value:function GroupChange_consumesChanges_(){return true;}},{key:"addChange",value:function GroupChange_addChange_(c){this.changes.push(c);c.group=this;}},{key:"apply",value:function GroupChange_apply_(){this.changes.slice().forEach(function(change){return change.apply();});return this;}},{key:"reverseApply",value:function GroupChange_reverseApply_(){this.changes.slice().reverse().forEach(function(change){return change.reverseApply();});return this;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"GroupChange";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"changes.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1034,end:1463});}(__varRecorder__$g.Change);__varRecorder__$g.GroupChange=GroupChange;__varRecorder__$g.GroupChange=GroupChange;__varRecorder__$g.GroupChange=GroupChange;var ValueChange=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/changes.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ValueChange")&&typeof __lively_classholder__.ValueChange==="function"?__lively_classholder__.ValueChange:__lively_classholder__.ValueChange=function ValueChange(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"type",get:function get(){return"setter";}},{key:Symbol["for"]("lively-instance-initialize"),value:function ValueChange_initialize_(target,prop,value,meta){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,target);this.prop=prop;this.value=value;this.prevValue=null;this.meta=meta;}},{key:"apply",value:function ValueChange_apply_(){var target=this.target,prop=this.prop,value=this.value;target[prop]=value;}},{key:"reverseApply",value:function ValueChange_reverseApply_(){var target=this.target,prop=this.prop,prevValue=this.prevValue;target[prop]=prevValue;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ValueChange";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"changes.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1472,end:1893});}(__varRecorder__$g.Change);__varRecorder__$g.ValueChange=ValueChange;__varRecorder__$g.ValueChange=ValueChange;__varRecorder__$g.ValueChange=ValueChange;var MethodCallChange=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/changes.js");var __lively_class__=__lively_classholder__.hasOwnProperty("MethodCallChange")&&typeof __lively_classholder__.MethodCallChange==="function"?__lively_classholder__.MethodCallChange:__lively_classholder__.MethodCallChange=function MethodCallChange(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"type",get:function get(){return"method-call";}},{key:Symbol["for"]("lively-instance-initialize"),value:function MethodCallChange_initialize_(target,selector,args,undo,meta){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,target);this.selector=selector;this.args=args;this.undo=undo;this.meta=meta;}},{key:"apply",value:function MethodCallChange_apply_(){var target=this.target,selector=this.selector,args=this.args;target[selector].apply(target,args);}},{key:"reverseApply",value:function MethodCallChange_reverseApply_(){if(!this.undo)return;if(typeof this.undo==="function")this.undo();else{var _this$undo=this.undo,target=_this$undo.target,selector=_this$undo.selector,args=_this$undo.args;target[selector].apply(target,args);}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"MethodCallChange";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"changes.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1902,end:2486});}(__varRecorder__$g.GroupChange);__varRecorder__$g.MethodCallChange=MethodCallChange;__varRecorder__$g.MethodCallChange=MethodCallChange;__varRecorder__$g.MethodCallChange=MethodCallChange;var ChangeManager=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/changes.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ChangeManager")&&typeof __lively_classholder__.ChangeManager==="function"?__lively_classholder__.ChangeManager:__lively_classholder__.ChangeManager=function ChangeManager(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function ChangeManager_initialize_(){this.reset();}},{key:"reset",value:function ChangeManager_reset_(){this.changes=[];this.changeRecordedListeners=[];this.revision=0;this.changeRecordersPerMorph=new WeakMap();this.changeRecorders={};this.changeGroupStack=[];this.defaultMeta={};this.metaStack=[];}},{key:"changesFor",value:function ChangeManager_changesFor_(morph){return this.changes.filter(function(c){return c.target===morph;});}},{key:"apply",value:function ChangeManager_apply_(target,change){change.apply();}},{key:"doWithValueChangeMeta",value:function ChangeManager_doWithValueChangeMeta_(meta,morph,doFn){this.defaultMeta=meta;this.metaStack.push(meta);var res=doFn(morph);this.metaStack.pop();this.defaultMeta=__varRecorder__$g.arr.last(this.metaStack)||{};return res;}},{key:"addValueChange",value:function ChangeManager_addValueChange_(morph,prop,value,meta){var change=new __varRecorder__$g.ValueChange(morph,prop,value,Object.assign({},this.defaultMeta,{},meta));return this._record(morph,change);}},{key:"addMethodCallChangeDoing",value:function ChangeManager_addMethodCallChangeDoing_(spec,morph,doFn){var target=spec.target,selector=spec.selector,args=spec.args,undo=spec.undo;if(!undo)undo=function undo(){return console.warn("No undo recorded for ".concat(target,".").concat(selector));};var change=new __varRecorder__$g.MethodCallChange(target,selector,args,undo,this.defaultMeta);morph.groupChangesWhile(change,doFn);return change;}},{key:"_record",value:function ChangeManager__record_(morph,change){__varRecorder__$g.signal(this,"changeRecorded",change);if(change.hasOwnProperty("value")){change.prevValue=morph._morphicState[change.prop];morph._morphicState[change.prop]=change.value;}morph.makeDirty(change);var grouping=__varRecorder__$g.arr.last(this.changeGroupStack);if(grouping&&grouping.consumesChanges()){grouping.addChange(change);}else{this.changes.push(change);morph._rev=++this.revision;this.informChangeListeners(change);}__varRecorder__$g.informMorph(this,change,morph);return change;}},{key:"groupChangesWhile",value:function ChangeManager_groupChangesWhile_(targetMorph,groupChange,whileFn){var record=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(!groupChange)groupChange=new __varRecorder__$g.GroupChange(targetMorph);this.changeGroupStack.push(groupChange);try{whileFn();__varRecorder__$g.arr.remove(this.changeGroupStack,groupChange);return record?this._record(targetMorph,groupChange):groupChange;}catch(err){__varRecorder__$g.arr.remove(this.changeGroupStack,groupChange);throw err;}}},{key:"dontRecordChangesWhile",value:function ChangeManager_dontRecordChangesWhile_(targetMorph,whileFn){return this.groupChangesWhile(targetMorph,undefined,whileFn,false);}},{key:"recordChangesWhile",value:function ChangeManager_recordChangesWhile_(whileFn,optFilter){var from=this.changes.length;whileFn();var changes=this.changes.slice(from,this.changes.length);return optFilter?changes.filter(optFilter):changes;}},{key:"addChangeListener",value:function ChangeManager_addChangeListener_(listenFn){__varRecorder__$g.arr.pushIfNotIncluded(this.changeRecordedListeners,listenFn);}},{key:"removeChangeListener",value:function ChangeManager_removeChangeListener_(listenFn){__varRecorder__$g.arr.remove(this.changeRecordedListeners,listenFn);}},{key:"informChangeListeners",value:function ChangeManager_informChangeListeners_(change){this.changeRecordedListeners.forEach(function(fn){return fn(change);});}},{key:"recordChangesStart",value:function ChangeManager_recordChangesStart_(optFilter){var optName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var id=__varRecorder__$g.obj.newKeyIn(this.changeRecorders,optName+"__change_recorder_"+Date.now());var listener=optFilter?function(change){return optFilter(change)&&recorder.changes.push(change);}:function(change){return recorder.changes.push(change);};var recorder=this.changeRecorders[id]={id:id,filter:optFilter,changes:[],listener:listener};this.addChangeListener(listener);return recorder;}},{key:"recordChangesStop",value:function ChangeManager_recordChangesStop_(id){if(!(id in this.changeRecorders))return[];var _this$changeRecorders=this.changeRecorders[id],changes=_this$changeRecorders.changes,listener=_this$changeRecorders.listener;delete this.changeRecorders[id];this.removeChangeListener(listener);return changes;}},{key:"recordChangesStartForMorph",value:function ChangeManager_recordChangesStartForMorph_(morph,optFilter){var recorder=this.recordChangesStart(optFilter,morph.id);var perMorph=this.changeRecordersPerMorph.get(morph);if(!perMorph){perMorph=[];this.changeRecordersPerMorph.set(morph,perMorph);}perMorph.push(recorder.id);return recorder;}},{key:"recordChangesStopForMorph",value:function ChangeManager_recordChangesStopForMorph_(morph,optId){var perMorph=this.changeRecordersPerMorph.get(morph);if(!perMorph||!perMorph.length){console.warn("Cannot endMorphChangeRecorder for morph ".concat(morph,": recorder not found"));return[];}var id=optId;if(!optId)id=perMorph.pop();else __varRecorder__$g.arr.remove(perMorph,id);return this.recordChangesStop(id);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ChangeManager";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"changes.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:2495,end:7573});}(undefined);__varRecorder__$g.ChangeManager=ChangeManager;__varRecorder__$g.ChangeManager=ChangeManager;__varRecorder__$g.ChangeManager=ChangeManager;var __varRecorder__$h=lively.FreezerRuntime.recorderFor("lively.morphic/undo.js");function printArg(x){return __varRecorder__$h.obj.inspect(x,{maxDepth:1}).replace(/\n/g,"").replace(/\s+/g," ");}__varRecorder__$h.printArg=printArg;__varRecorder__$h.obj=obj;__varRecorder__$h.arr=arr;__varRecorder__$h.events=events;__varRecorder__$h.fun=fun;var Undo=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/undo.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Undo")&&typeof __lively_classholder__.Undo==="function"?__lively_classholder__.Undo:__lively_classholder__.Undo=function Undo(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Undo_initialize_(name){var targets=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var no=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;this.name=name;this.targets=targets;this.recorder=null;this.changes=null;this.timestamp=null;this.no=no;}},{key:"recorded",value:function Undo_recorded_(){return!!this.changes;}},{key:"isRecording",value:function Undo_isRecording_(){return!!this.recorder;}},{key:"startRecording",value:function Undo_startRecording_(filterFn){var _this41=this;if(this.recorded()||this.isRecording()){throw new Error("Undo already recorded / recording");}if(!this.targets.length){throw new Error("Undo has no target morphs");}this.timestamp=Date.now();var morph=this.targets[0];this.recorder=morph.recordChangesStart(function(change){var target=change.target;if(target.isUsedAsEpiMorph())return false;if(!_this41.targets.some(function(undoTarget){return undoTarget===target||undoTarget.isAncestorOf(target);}))return false;if(typeof filterFn==="function")return filterFn(change);return true;});return this;}},{key:"stopRecording",value:function Undo_stopRecording_(){var name=this.name,_this$recorder=this.recorder,id=_this$recorder.id,changes=_this$recorder.changes,_this$targets=_slicedToArray2(this.targets,1),morph=_this$targets[0];this.changes=morph.recordChangesStop(id);this.targets=null;this.recorder=null;}},{key:"apply",value:function Undo_apply_(){if(!this.recorded()){throw new Error("Cannot apply undo that has no changes recorded yet");}this.changes.slice().forEach(function(change){return change.apply();});return this;}},{key:"reverseApply",value:function Undo_reverseApply_(){if(!this.recorded()){throw new Error("Cannot reverseApply undo that has no changes recorded yet");}this.changes.slice().reverse().forEach(function(change){return change.reverseApply();});return this;}},{key:"addTarget",value:function Undo_addTarget_(t){__varRecorder__$h.arr.pushIfNotIncluded(this.targets,t);}},{key:"addUndos",value:function Undo_addUndos_(undos){undos=__varRecorder__$h.arr.sortBy(undos.concat(this).filter(function(ea){return ea.recorded();}),function(_ref22){var no=_ref22.no;return no;});if(!undos.length)return;this.changes=__varRecorder__$h.arr.flatmap(undos,function(_ref23){var changes=_ref23.changes;return changes;});this.timestamp=undos[0].timestamp;this.no=undos[0].no;this.name=undos.map(function(_ref24){var name=_ref24.name;return name;}).join("-");}},{key:"toString",value:function Undo_toString_(){var name=this.name,changes=this.changes,no=this.no;var isRecording=this.isRecording();var changesString=!changes.length?"no changes":"\n  "+changes.map(function(_ref25){var selector=_ref25.selector,args=_ref25.args,prop=_ref25.prop,value=_ref25.value,target=_ref25.target;return selector?"".concat(target,".").concat(selector,"(").concat(args.map(__varRecorder__$h.printArg),")"):"".concat(target,".").concat(prop," = ").concat(__varRecorder__$h.printArg(value));}).join("\n  ");return"Undo(".concat(no,":").concat(name," ").concat(isRecording?"RECORDING ":"").concat(changesString,")");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Undo";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"undo.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:54,end:2498});}(undefined);var UndoManager=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/undo.js");var __lively_class__=__lively_classholder__.hasOwnProperty("UndoManager")&&typeof __lively_classholder__.UndoManager==="function"?__lively_classholder__.UndoManager:__lively_classholder__.UndoManager=function UndoManager(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function UndoManager_initialize_(optFilter){this.reset();this.filter=optFilter;}},{key:"reset",value:function UndoManager_reset_(){this.undos=[];this.redos=[];this.undoInProgress=null;this.applyCount=0;this.counter=0;this.grouping={current:[],debounce:null,debouncedCanceled:false,debounceTime:31};}},{key:"group",value:function UndoManager_group_(){var prevUndo=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.groupLaterCancel();if(prevUndo&&this.undos.includes(prevUndo)){this.grouping.current=__varRecorder__$h.arr.uniq(this.undos.slice(this.undos.indexOf(prevUndo)).concat(this.grouping.current));}if(!this.grouping.current.length)return;var grouped=this.grouping.current.slice(1);var undoGroup=this.grouping.current[0];undoGroup.addUndos(grouped);this.undos=__varRecorder__$h.arr.withoutAll(this.undos,grouped);this.grouping.current=[];}},{key:"ensureNewGroup",value:function UndoManager_ensureNewGroup_(morph){var name=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"new undo group";this.group();this.undoStart(morph,name);return this.undoStop();}},{key:"groupLaterCancel",value:function UndoManager_groupLaterCancel_(){var state=this.grouping;if(!state.debounce)return;state.debouncedCanceled=true;this.grouping=Object.assign({},state,{debounce:null,debouncedCanceled:false});}},{key:"groupLater",value:function UndoManager_groupLater_(time){var _this42=this;var state=this.grouping;(state.debounce||(state.debounce=__varRecorder__$h.fun.debounce(time||state.debounceTime,function(){state.debounce=null;state.debouncedCanceled||_this42.group();})))();}},{key:"undoStart",value:function UndoManager_undoStart_(morph,name){if(this.applyCount)return;if(this.undoInProgress){console.warn("There is already an undo recorded");return;}return this.undoInProgress=new __varRecorder__$h.Undo(name,[morph],this.counter++).startRecording(this.filter);}},{key:"undoStop",value:function UndoManager_undoStop_(){var undo=this.undoInProgress;if(!undo)return null;undo.stopRecording();this.undoInProgress=null;this.undos.push(undo);this.grouping.current.push(undo);if(this.redos.length)this.redos.length=0;return undo;}},{key:"undo",value:function UndoManager_undo_(){this.undoStop();var undo=this.undos.pop();if(!undo)return;__varRecorder__$h.arr.remove(this.grouping.current,undo);this.redos.unshift(undo);this.applyCount++;try{undo.reverseApply();}finally{this.applyCount--;}return undo;}},{key:"redo",value:function UndoManager_redo_(){this.undoStop();var redo=this.redos.shift();if(!redo)return;this.undos.push(redo);this.applyCount++;try{redo.apply();}finally{this.applyCount--;}return redo;}},{key:"toString",value:function UndoManager_toString_(){var undosPrinted=this.undos.length===0?"":"\n  ".concat(this.undos.length>20?"...\n  ":"").concat(this.undos.slice(-20).join("\n  "));var undoInProgress=!!this.undoInProgress;return"UndoManager(".concat(this.undos.length," undos, ").concat(this.redos.length," redos, ").concat(undoInProgress?", UNDO IN PROGRESS":"").concat(undosPrinted,")");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"UndoManager";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"undo.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:2633,end:5684});}(undefined);__varRecorder__$h.UndoManager=UndoManager;__varRecorder__$h.UndoManager=UndoManager;__varRecorder__$h.UndoManager=UndoManager;var __varRecorder__$i=lively.FreezerRuntime.recorderFor("lively.morphic/events/TextInput.js");__varRecorder__$i.promise=promise;__varRecorder__$i.bowser=exports$1$1;__varRecorder__$i.touchInputDevice=touchInputDevice;__varRecorder__$i.placeholderValue="\x01\x01";__varRecorder__$i.placeholderRe=new RegExp("\x01","g");var TextInput=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/events/TextInput.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TextInput")&&typeof __lively_classholder__.TextInput==="function"?__lively_classholder__.TextInput:__lively_classholder__.TextInput=function TextInput(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function TextInput_initialize_(eventDispatcher){this.eventDispatcher=eventDispatcher;this.domState={rootNode:null,textareaNode:null,eventHandlers:[],isInstalled:false};this.inputState={composition:null,manualCopy:null,manualPaste:null,positionChangedTime:0,scrollLeftWhenChanged:0,scrollTopWhenChanged:0};}},{key:"install",value:function TextInput_install_(newRootNode,world){var _this43=this;var domState=this.domState;var isInstalled=domState.isInstalled,rootNode=domState.rootNode;this.world=world;if(isInstalled){if(rootNode===newRootNode)return;this.uninstall();}domState.isInstalled=true;domState.rootNode=newRootNode;newRootNode.tabIndex=1;var doc=newRootNode.ownerDocument;var textareaNode=domState.textareaNode=doc.createElement("textarea");textareaNode.setAttribute("style","\n      position: absolute;\n      /*extent cannot be 0, input won't work correctly in Chrome 52.0*/\n      width: 20px; height: 20px;\n      z-index: 0;\n      opacity: 1;\n      background: transparent;\n      -moz-appearance: none;\n      appearance: none;\n      border: none;\n      resize: none;\n      outline: none;\n      overflow: hidden;\n      font: inherit;\n      padding: 0 1px;\n      margin: 0 -1px;\n      text-indent: -1em;\n      -ms-user-select: text;\n      -moz-user-select: text;\n      -webkit-user-select: text;\n      user-select: text;\n      /*with pre-line chrome inserts &nbsp; instead of space*/\n      white-space: pre!important;");if(__varRecorder__$i.touchInputDevice){textareaNode.setAttribute("x-palm-disable-auto-cap",true);}textareaNode.setAttribute("wrap","off");textareaNode.setAttribute("autocorrect","off");textareaNode.setAttribute("autocapitalize","off");textareaNode.setAttribute("spellcheck",false);textareaNode.setAttribute("aria-label","Lively Textinput Node");textareaNode.className="lively-text-input";textareaNode.value="";newRootNode.insertBefore(textareaNode,newRootNode.firstChild);if(__varRecorder__$i.touchInputDevice){textareaNode.setAttribute("disabled",true);textareaNode.style.setProperty("transform","scale(0)");}domState.eventHandlers=[{type:"focusin",node:newRootNode,fn:function fn(evt){return _this43.onRootNodeFocus(evt);},capturing:true},{type:"focusin",node:domState.textareaNode,fn:function fn(evt){return _this43.onTextAreaFocus(evt);},capturing:true},{type:"blur",node:domState.textareaNode,fn:function fn(evt){return _this43.onTextAreaBlur(evt);},capturing:true},{type:"keydown",node:domState.textareaNode,fn:function fn(evt){return _this43.eventDispatcher.dispatchDOMEvent(evt);},capturing:false},{type:"keyup",node:domState.textareaNode,fn:function fn(evt){return _this43.eventDispatcher.dispatchDOMEvent(evt);},capturing:false},{type:"cut",node:domState.textareaNode,fn:function fn(evt){return _this43.eventDispatcher.dispatchDOMEvent(evt);},capturing:false},{type:"copy",node:domState.textareaNode,fn:function fn(evt){return _this43.inputState.manualCopy?_this43.inputState.manualCopy.onEvent(evt):_this43.eventDispatcher.dispatchDOMEvent(evt);},capturing:false},{type:"paste",node:domState.textareaNode,fn:function fn(evt){return _this43.inputState.manualPaste?_this43.inputState.manualPaste.onEvent(evt):_this43.eventDispatcher.dispatchDOMEvent(evt);},capturing:false},{type:"compositionstart",node:domState.textareaNode,fn:function fn(evt){return _this43.onCompositionStart(evt);},capturing:false},{type:"compositionend",node:domState.textareaNode,fn:function fn(evt){return _this43.onCompositionEnd(evt);},capturing:false},{type:"compositionupdate",node:domState.textareaNode,fn:function fn(evt){return _this43.onCompositionUpdate(evt);},capturing:false},{type:"input",node:domState.textareaNode,fn:function fn(evt){return _this43.onInput(evt);},capturing:false}];domState.eventHandlers.forEach(function(_ref26){var type=_ref26.type,node=_ref26.node,fn=_ref26.fn,capturing=_ref26.capturing;return node.addEventListener(type,fn,capturing);});return this;}},{key:"uninstall",value:function TextInput_uninstall_(){var domState=this.domState;domState.isInstalled=false;domState.eventHandlers.forEach(function(_ref27){var node=_ref27.node,type=_ref27.type,fn=_ref27.fn,capturing=_ref27.capturing;return node.removeEventListener(type,fn,capturing);});var n=domState.textareaNode;n&&n.parentNode&&n.parentNode.removeChild(n);domState.rootNode=null;return this;}},{key:"resetValue",value:function TextInput_resetValue_(){var n=this.domState.textareaNode;n&&(n.value=__varRecorder__$i.placeholderValue);}},{key:"readValue",value:function TextInput_readValue_(){var n=this.domState.textareaNode;return n?n.value.replace(__varRecorder__$i.placeholderRe,""):"";}},{key:"focus",value:function TextInput_focus_(morph,world){var node=this.domState.textareaNode;if(!node)return;if(__varRecorder__$i.touchInputDevice){if(morph&&morph.isText&&!morph.readOnly){node.removeAttribute("disabled");}else if(morph&&!morph.isText);}if(!morph||!morph.stealFocus){node.ownerDocument.activeElement!==node&&node.focus();}if(__varRecorder__$i.bowser.firefox){Promise.resolve().then(function(){return node.ownerDocument.activeElement!==node&&node.focus();});}if(morph&&morph.isText&&morph.focusable){if(__varRecorder__$i.touchInputDevice)node.focus();this.ensureBeingAtCursorOfText(morph);}else if(world)this.ensureBeingInVisibleBoundsOfWorld(world);}},{key:"blur",value:function TextInput_blur_(){var node=this.domState.textareaNode;if(__varRecorder__$i.touchInputDevice){node.setAttribute("disabled",true);}node&&node.blur();}},{key:"doCopyWithMimeTypes",value:function TextInput_doCopyWithMimeTypes_(dataAndTypes){var _this44=this;return this.execCommand("manualCopy",function(){var el=_this44.domState.textareaNode;var h=function h(evt){el.removeEventListener("copy",h);evt.preventDefault();dataAndTypes.forEach(function(_ref28){var data=_ref28.data,type=_ref28.type;return evt.clipboardData.setData(type,data);});};setTimeout(function(){return el.removeEventListener("copy",h);},300);el.addEventListener("copy",h);el.value="";el.select();el.ownerDocument.execCommand("copy");});}},{key:"doCopy",value:function TextInput_doCopy_(content){var _this45=this;return this.execCommand("manualCopy",function(){var el=_this45.domState.textareaNode;el.value=content;el.select();el.ownerDocument.execCommand("copy");});}},{key:"doPaste",value:function TextInput_doPaste_(){var _this46=this;return this.execCommand("manualPaste",function(){var el=_this46.domState.textareaNode;el.value="";el.select();el.ownerDocument.execCommand("paste");});}},{key:"execCommand",value:function(){var _TextInput_execCommand_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee39(stateName,execFn){var state,deferred,isDone;return regeneratorRuntime.wrap(function _callee39$(_context39){while(1){switch(_context39.prev=_context39.next){case 0:if(this.domState.isInstalled){_context39.next=2;break;}throw new Error("Cannot copy to clipboard \u2013 input helper is not installed into DOM!");case 2:state=this.inputState;if(!state[stateName]){_context39.next=11;break;}_context39.prev=4;_context39.next=7;return state[stateName].promise;case 7:_context39.next=11;break;case 9:_context39.prev=9;_context39.t0=_context39["catch"](4);case 11:deferred=__varRecorder__$i.promise.deferred();isDone=false;state[stateName]={onEvent:function onEvent(evt){if(isDone)return;state[stateName]=null;isDone=true;deferred.resolve(evt);},promise:deferred.promise};execFn();_context39.prev=15;_context39.next=18;return __varRecorder__$i.promise.waitFor(1000,function(){return isDone;});case 18:_context39.next=25;break;case 20:_context39.prev=20;_context39.t1=_context39["catch"](15);state[stateName]=null;isDone=true;deferred.reject(_context39.t1);case 25:return _context39.abrupt("return",deferred.promise);case 26:case"end":return _context39.stop();}}},_callee39,this,[[4,9],[15,20]]);}));function TextInput_execCommand_(_x32,_x33){return _TextInput_execCommand_.apply(this,arguments);}return TextInput_execCommand_;}()},{key:"onTextAreaBlur",value:function TextInput_onTextAreaBlur_(evt){var _this47=this;setTimeout(function(){var _ref29=_this47.domState||{},textareaNode=_ref29.textareaNode,rootNode=_ref29.rootNode;if(rootNode&&document.activeElement===rootNode&&!(_this47.world.focusedMorph&&_this47.world.focusedMorph.stealFocus)&&!(__varRecorder__$i.touchInputDevice||lively.FreezerRuntime)){textareaNode&&textareaNode.focus();}});}},{key:"onTextAreaFocus",value:function TextInput_onTextAreaFocus_(evt){}},{key:"onRootNodeFocus",value:function TextInput_onRootNodeFocus_(evt){var _ref30=this.domState||{},textareaNode=_ref30.textareaNode,rootNode=_ref30.rootNode;if(evt.target===textareaNode||evt.target===rootNode){if(!(this.world.focusedMorph&&this.world.focusedMorph.stealFocus)){this.focus();}}this.inputState.composition=null;}},{key:"onInput",value:function TextInput_onInput_(evt){if(this.inputState.composition)return;if(!evt.data){var data=this.readValue();evt.__defineGetter__("data",function(){return data;});}this.resetValue();this.eventDispatcher.dispatchDOMEvent(evt);}},{key:"onCompositionStart",value:function TextInput_onCompositionStart_(evt){this.inputState.composition={};this.eventDispatcher.dispatchDOMEvent(evt);}},{key:"onCompositionUpdate",value:function TextInput_onCompositionUpdate_(evt){var c=this.inputState.composition;var val=this.readValue();if(c.lastValue===val)return;c.lastValue=val;this.eventDispatcher.dispatchDOMEvent(evt);}},{key:"onCompositionEnd",value:function TextInput_onCompositionEnd_(evt){this.inputState.composition=null;this.eventDispatcher.dispatchDOMEvent(evt);}},{key:"setPosition",value:function TextInput_setPosition_(pos){var _ref31=this.domState||{},textareaNode=_ref31.textareaNode;if(!textareaNode)return;textareaNode.style.left=pos.x+"px";textareaNode.style.top=pos.y+"px";}},{key:"ensureBeingInVisibleBoundsOfWorld",value:function TextInput_ensureBeingInVisibleBoundsOfWorld_(world){this.setPosition(world.visibleBounds().center());}},{key:"ensureBeingAtCursorOfText",value:function TextInput_ensureBeingAtCursorOfText_(textMorph){var world=textMorph.world();if(!world)return;var _textMorph$whatsVisib=textMorph.whatsVisible,startRow=_textMorph$whatsVisib.startRow,endRow=_textMorph$whatsVisib.endRow;var _textMorph$cursorPosi=textMorph.cursorPosition,row=_textMorph$cursorPosi.row,column=_textMorph$cursorPosi.column;row=Math.max(startRow,Math.min(row,endRow));var localCursorPos=textMorph.charBoundsFromTextPosition({row:row,column:column}).topLeft();var globalCursorPos=world.visibleBounds().insetBy(10).constrainPt(textMorph.worldPoint(localCursorPos.subPt(textMorph.scroll)));this.inputState.positionChangedTime=Date.now();this.inputState.scrollLeftWhenChanged=document.documentElement.scrollLeft;this.inputState.scrollTopWhenChanged=document.documentElement.scrollTop;this.setPosition(globalCursorPos);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TextInput";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"events/TextInput.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:237,end:12306});}(undefined);TextInput=__varRecorder__$i.TextInput;var TextInput$1=TextInput;__varRecorder__$i["default"]=TextInput;var __varRecorder__$j=lively.FreezerRuntime.recorderFor("lively.morphic/events/KillRing.js");__varRecorder__$j.arr=arr;var KillRing=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/events/KillRing.js");var __lively_class__=__lively_classholder__.hasOwnProperty("KillRing")&&typeof __lively_classholder__.KillRing==="function"?__lively_classholder__.KillRing:__lively_classholder__.KillRing=function KillRing(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function KillRing_initialize_(){var size=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;this.size=size;this.buffer=[];this.pointer=-1;}},{key:"isCycling",value:function KillRing_isCycling_(){return this.pointer!==this.buffer.length-1;}},{key:"add",value:function KillRing_add_(x){var b=this.buffer;b.push(x);if(this.size&&b.length>this.size){b.splice(0,b.length-this.size);}this.pointer=this.buffer.length-1;return x;}},{key:"yank",value:function KillRing_yank_(){return this.buffer[this.pointer]||"";}},{key:"back",value:function KillRing_back_(){this.pointer=(this.pointer<=0?this.buffer.length:this.pointer)-1;return this.yank();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"KillRing";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"events/KillRing.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:51,end:621});}(undefined);KillRing=__varRecorder__$j.KillRing;var KillRing$1=KillRing;__varRecorder__$j["default"]=KillRing;var __varRecorder__$k=lively.FreezerRuntime.recorderFor("lively.morphic/events/Keys.js");function computeHashIdOfEvent(evt){var key=evt.key,ctrlKey=evt.ctrlKey,altKey=evt.altKey,shiftKey=evt.shiftKey,metaKey=evt.metaKey;var hashId=0|(ctrlKey?1:0)|(altKey?2:0)|(shiftKey?4:0)|(metaKey?8:0);if(hashId===0&&!__varRecorder__$k.canonicalizeFunctionKey(key)&&key&&__varRecorder__$k.letterRe.test(key))hashId=-1;return hashId;}__varRecorder__$k.computeHashIdOfEvent=computeHashIdOfEvent;function isModifier(key){if(__varRecorder__$k.isNumber(key))return false;key=key.replace(/-$/,"").toLowerCase();return __varRecorder__$k.arr.withoutAll(Object.keys(__varRecorder__$k.KEY_MODS),["","input-"]).includes(key);}__varRecorder__$k.isModifier=isModifier;function canonicalizeFunctionKey(key){key=key.toLowerCase();switch(key){case"space":key="space";break;case"esc":key="escape";break;case"return":key="enter";break;case"arrowleft":key="left";break;case"arrowright":key="right";break;case"arrowup":key="up";break;case"arrowdown":key="down";break;case"esc":key="escape";break;case"return":key="enter";break;}return __varRecorder__$k.FUNCTION_KEYS.includes(key)?__varRecorder__$k.string.capitalize(key):"";}__varRecorder__$k.canonicalizeFunctionKey=canonicalizeFunctionKey;function decodeKeyIdentifier(identifier,keyCode){var id=identifier;var unicodeDecodeRe=/u\+?([\d\w]{4})/gi;var unicodeReplacer=function unicodeReplacer(match,grp){return String.fromCharCode(parseInt(grp,16));};var key=id&&id.replace(unicodeDecodeRe,unicodeReplacer);if(key==="Command"||key==="Cmd")key="Meta";if(key===" ")key="Space";if(keyCode===8)key="Backspace";return key;}__varRecorder__$k.decodeKeyIdentifier=decodeKeyIdentifier;function identifyKeyFromCode(_ref32){var code=_ref32.code;if(typeof code!=="string")return null;if(code.startsWith("Key"))return code.slice(3);if(code.startsWith("Numpad"))return code;if(code.startsWith("Digit"))return code.slice(5);if(code.startsWith("Arrow"))return code.slice(5);if(code.match(/^F[0-9]{1-2}$/))return code;switch(code){case"Insert":case"Home":case"PageUp":case"PageDown":return code;case"Period":return".";case"Comma":return",";case"Help":return"Insert";case"Equal":return"=";case"Backslash":case"IntlBackslash":return"\\";case"Equal":return"=";case"Minus":return"-";case"BracketRight":return"]";case"BracketLeft":return"[";case"Quote":return"'";case"Backquote":return"`";case"Semicolon":return";";}return null;}__varRecorder__$k.identifyKeyFromCode=identifyKeyFromCode;function dedasherize(keyCombo){var parts=[];while(true){var idx=keyCombo.indexOf("-");if(idx===-1){if(keyCombo)parts.push(keyCombo);return parts;}if(idx===0){parts.push(keyCombo[0]);keyCombo=keyCombo.slice(2);}else{parts.push(keyCombo.slice(0,idx));keyCombo=keyCombo.slice(idx+1);}}}__varRecorder__$k.dedasherize=dedasherize;__varRecorder__$k.bowser=exports$1$1;__varRecorder__$k.arr=arr;__varRecorder__$k.string=string;__varRecorder__$k.letterRe=/[a-z]/i;__varRecorder__$k.MODIFIER_KEYS={16:"Shift",17:"Ctrl",18:"Alt",224:"Meta"};__varRecorder__$k.KEY_MODS=function(){var base={control:1,ctrl:1,alt:2,option:2,shift:4,"super":8,win:8,meta:8,command:8,cmd:8};var mods=["alt","ctrl","meta","shift"];for(var i=Math.pow(2,mods.length);i--;){base[i]=mods.filter(function(x){return i&base[x];}).join("-")+"-";}base[0]="";base[-1]="input-";return base;}();__varRecorder__$k.isNumber=function(){var numberRe=/^[0-9]+$/;return function(key){return numberRe.test(key);};}();__varRecorder__$k.FUNCTION_KEYS=["backspace","tab","enter","pause","escape"," ","pageup","pagedown","end","home","left","up","right","down","print","insert","delete","numpad0","numpad1","numpad2","numpad3","numpad4","numpad5","numpad6","numpad7","numpad8","numpad9","numpadenter","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","numlock","scrolllock"];__varRecorder__$k.Keys={computeHashIdOfEvent:computeHashIdOfEvent,keyComboToEventSpec:function keyComboToEventSpec(keyCombo,flags){var spec=Object.assign({_isLivelyKeyEventSpec:true,keyCombo:"",key:"",ctrlKey:false,shiftKey:false,altKey:false,metaKey:false,altGraphKey:false,isFunctionKey:false,isModified:false,onlyModifiers:false},flags);var keyMods=__varRecorder__$k.dedasherize(keyCombo);var modsToEvent={shift:"shiftKey",control:"ctrlKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey",command:"metaKey",cmd:"metaKey"};if(keyMods[0]==="input"&&keyMods.length===2){spec.keyCombo=keyCombo;spec.key=keyMods[1];return spec;}for(var _i89=keyMods.length-1;_i89>=0;_i89--){var mod=keyMods[_i89];var modEventFlag=modsToEvent[mod.toLowerCase()];if(!modEventFlag)continue;keyMods.splice(_i89,1);spec.isModified=true;spec[modEventFlag]=true;}if(!keyMods.length){spec.keyCombo=__varRecorder__$k.Keys.eventToKeyCombo(spec);spec.key=__varRecorder__$k.arr.last(__varRecorder__$k.dedasherize(spec.keyCombo));spec.onlyModifiers=true;return spec;}if(keyMods.length>1){console.warn("Strange key \"".concat(keyCombo,"\" encountered in keyComboToEventSpec, parsing probably failed"));}var trailing=__varRecorder__$k.arr.last(keyMods);var fnKey=__varRecorder__$k.canonicalizeFunctionKey(trailing);if(fnKey){spec.isFunctionKey=true;spec.key=fnKey;}else if(spec.isModified){spec.key=__varRecorder__$k.string.capitalize(trailing);}else{spec.key=trailing;}spec.keyCombo=__varRecorder__$k.Keys.eventToKeyCombo(spec);return spec;},eventToKeyCombo:function eventToKeyCombo(evt,options){var _Object$assign=Object.assign({ignoreModifiersIfNoCombo:false,ignoreKeys:[]},options),ignoreModifiersIfNoCombo=_Object$assign.ignoreModifiersIfNoCombo,ignoreKeys=_Object$assign.ignoreKeys;var key=evt.key,data=evt.data,keyIdentifier=evt.keyIdentifier;if(typeof data==="string")return"input-"+data;if(!key&&keyIdentifier){key=__varRecorder__$k.decodeKeyIdentifier(keyIdentifier,evt.which||evt.keyCode);evt.key=key=key[evt.shiftKey?"toUpperCase":"toLowerCase"]();if(__varRecorder__$k.isModifier(key))return __varRecorder__$k.string.capitalize(key);}var mod=__varRecorder__$k.KEY_MODS[__varRecorder__$k.computeHashIdOfEvent(evt)];if(mod==="input-")return mod+key;if(evt.code)key=__varRecorder__$k.identifyKeyFromCode(evt)||key;var keyCombo=!key||__varRecorder__$k.isModifier(key)?mod.replace(/-$/,""):mod+key;if(keyCombo.match(/\s$/))keyCombo=keyCombo.replace(/\s$/,"Space");return keyCombo.replace(/(^|-)([a-z])/g,function(_,start,_char2){return start+_char2.toUpperCase();});},canonicalizeKeyCombo:function canonicalizeKeyCombo(string){return __varRecorder__$k.Keys.eventToKeyCombo(__varRecorder__$k.Keys.keyComboToEventSpec(string));},canonicalizeEvent:function canonicalizeEvent(evt){return evt._isLivelyKeyEventSpec?evt:__varRecorder__$k.Keys.keyComboToEventSpec(__varRecorder__$k.Keys.eventToKeyCombo(evt));}};var Keys=__varRecorder__$k.Keys;__varRecorder__$k["default"]=Keys;var __varRecorder__$l=lively.FreezerRuntime.recorderFor("lively.morphic/events/Event.js");__varRecorder__$l.bowser=exports$1$1;__varRecorder__$l.obj=obj;__varRecorder__$l.pt=pt;__varRecorder__$l.Keys=Keys;__varRecorder__$l.cumulativeOffset=cumulativeOffset;var pointerEvents=["pointerover","pointerenter","pointerout","pointerleave","pointerdown","pointermove","pointerup","pointercancel","gotpointercapture","lostpointercapture"];__varRecorder__$l.pointerEvents=pointerEvents;__varRecorder__$l.pointerEvents=pointerEvents;__varRecorder__$l.pointerEvents=pointerEvents;var mouseEvents=["mouseover","mouseenter","mousedown","mousemove","mouseup","mouseout","mouseleave","click","dblclick","contextmenu","mousewheel"];__varRecorder__$l.mouseEvents=mouseEvents;__varRecorder__$l.mouseEvents=mouseEvents;__varRecorder__$l.mouseEvents=mouseEvents;var keyboardEvents=["keydown","keyup","keypress"];__varRecorder__$l.keyboardEvents=keyboardEvents;__varRecorder__$l.keyboardEvents=keyboardEvents;__varRecorder__$l.keyboardEvents=keyboardEvents;var keyLikeEvents=__varRecorder__$l.keyboardEvents.concat("input","compositionstart","compositionupdate","compositionend");__varRecorder__$l.keyLikeEvents=keyLikeEvents;__varRecorder__$l.keyLikeEvents=keyLikeEvents;__varRecorder__$l.keyLikeEvents=keyLikeEvents;var Event$1=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/events/Event.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Event")&&typeof __lively_classholder__.Event==="function"?__lively_classholder__.Event:__lively_classholder__.Event=function Event(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Event_initialize_(type,domEvt,dispatcher,targetMorphs,hand,halo,layoutHalo){this.type=type;this.domEvt=domEvt;this.dispatcher=dispatcher;this.targetMorphs=targetMorphs;this.hand=hand;this.halo=halo;this.layoutHalo=layoutHalo;this.stopped=false;this._keyCombo=undefined;this.onDispatchCallbacks=[];this.onAfterDispatchCallbacks=[];this.onStopCallbacks=[];}},{key:"onDispatch",value:function Event_onDispatch_(cb){this.onDispatchCallbacks.push(cb);return this;}},{key:"onAfterDispatch",value:function Event_onAfterDispatch_(cb){this.onAfterDispatchCallbacks.push(cb);return this;}},{key:"onStop",value:function Event_onStop_(cb){this.onStopCallbacks.push(cb);return this;}},{key:"data",get:function get(){return this.domEvt.data;}},{key:"world",get:function get(){return this.dispatcher.world;}},{key:"state",get:function get(){return this.dispatcher.eventState;}},{key:"keyInputState",get:function get(){return this.state.keyInputState;}},{key:"isMouseEvent",value:function Event_isMouseEvent_(){return __varRecorder__$l.pointerEvents.includes(this.type)||__varRecorder__$l.mouseEvents.includes(this.type);}},{key:"isKeyboardEvent",value:function Event_isKeyboardEvent_(){return!this.isMouseEvent()&&__varRecorder__$l.keyboardEvents.includes(this.type);}},{key:"stop",value:function Event_stop_(){this.stopped=true;this.domEvt&&typeof this.domEvt.stopPropagation==="function"&&this.domEvt.stopPropagation();this.domEvt&&typeof this.domEvt.preventDefault==="function"&&this.domEvt.preventDefault();this.onStopCallbacks.forEach(function(ea){return ea();});}},{key:"targetMorph",get:function get(){return this.targetMorphs[0];}},{key:"timestamp",get:function get(){return this.domEvt.timeStamp;}},{key:"position",get:function get(){if(!this.domEvt)return __varRecorder__$l.pt(0,0);var worldNode=this.domEvt.target;while(worldNode){if(worldNode.id===this.world.id)break;worldNode=worldNode.parentNode;}if(!worldNode){var target=this.domEvt.target;var doc=target.nodeType===target.DOCUMENT_NODE?target:target.ownerDocument;worldNode=doc.getElementById(this.world.id);}if(!worldNode){console.error("event position: cannot find world node for determining the position!");return __varRecorder__$l.pt(0,0);}var _varRecorder__$l$cum=__varRecorder__$l.cumulativeOffset(worldNode),left=_varRecorder__$l$cum.left,top=_varRecorder__$l$cum.top;var _this$domEvt=this.domEvt,pageX=_this$domEvt.pageX,pageY=_this$domEvt.pageY;var pos=__varRecorder__$l.pt((pageX||0)-left,(pageY||0)-top);if(this.world.scale!==1){pos=pos.scaleBy(1/this.world.scale);}return pos;}},{key:"startPosition",get:function get(){return this.state.clickedOnPosition;}},{key:"pressure",get:function get(){if(!this.domEvt)return 0.5;return this.domEvt.pressure;}},{key:"positionIn",value:function Event_positionIn_(aMorph){return aMorph.localize(this.position);}},{key:"isClickTarget",value:function Event_isClickTarget_(morph){var clicked=this.state.clickedOnMorph;return clicked&&(morph===clicked||morph.isAncestorOf(clicked));}},{key:"leftMouseButtonPressed",value:function Event_leftMouseButtonPressed_(){return this.domEvt?(this.domEvt.buttons||0)&1:false;}},{key:"rightMouseButtonPressed",value:function Event_rightMouseButtonPressed_(){return __varRecorder__$l.bowser.firefox?this.domEvt.which===3||this.domEvt.buttons===2:this.domEvt.which===3||this.domEvt.buttons===2;}},{key:"middleMouseButtonPressed",value:function Event_middleMouseButtonPressed_(){return this.domEvt?(this.domEvt.buttons||0)&4:false;}},{key:"isCommandKey",value:function Event_isCommandKey_(){var domEvt=this.domEvt;if(!domEvt)return false;var isCmd=false;if(!__varRecorder__$l.bowser.mac){isCmd=isCmd||domEvt.ctrlKey;}if(__varRecorder__$l.bowser.tablet||__varRecorder__$l.bowser.tablet){isCmd=isCmd||false;}return isCmd||domEvt.metaKey||domEvt.keyIdentifier==="Meta";}},{key:"isShiftDown",value:function Event_isShiftDown_(){return this.domEvt&&!!this.domEvt.shiftKey;}},{key:"isCtrlDown",value:function Event_isCtrlDown_(){return this.domEvt&&!!this.domEvt.ctrlKey;}},{key:"isAltDown",value:function Event_isAltDown_(){return this.domEvt&&!!this.domEvt.altKey;}},{key:"keyCombo",get:function get(){return this._keyCombo||(this._keyCombo=__varRecorder__$l.Keys.eventToKeyCombo(this.domEvt));}},{key:"keyCombo",set:function set(keyCombo){return this._keyCombo=keyCombo;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Event";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"events/Event.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:957,end:5006});}(undefined);__varRecorder__$l.Event=Event$1;__varRecorder__$l.Event=Event$1;__varRecorder__$l.Event=Event$1;var KeyEvent=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/events/Event.js");var __lively_class__=__lively_classholder__.hasOwnProperty("KeyEvent")&&typeof __lively_classholder__.KeyEvent==="function"?__lively_classholder__.KeyEvent:__lively_classholder__.KeyEvent=function KeyEvent(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function KeyEvent_initialize_(type,domEvt,dispatcher,targetMorphs,hand,halo,layoutHalo){console.assert(__varRecorder__$l.keyLikeEvents.includes(type),"not a keyboard event: "+type);initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,type,domEvt,dispatcher,targetMorphs,hand,halo,layoutHalo);Object.assign(this,__varRecorder__$l.Keys.canonicalizeEvent(domEvt));}},{key:"isKeyEvent",get:function get(){return true;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"KeyEvent";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"events/Event.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:5015,end:5385});}(__varRecorder__$l.Event);__varRecorder__$l.KeyEvent=KeyEvent;__varRecorder__$l.KeyEvent=KeyEvent;__varRecorder__$l.KeyEvent=KeyEvent;var SimulatedDOMEvent=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/events/Event.js");var __lively_class__=__lively_classholder__.hasOwnProperty("SimulatedDOMEvent")&&typeof __lively_classholder__.SimulatedDOMEvent==="function"?__lively_classholder__.SimulatedDOMEvent:__lively_classholder__.SimulatedDOMEvent=function SimulatedDOMEvent(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function SimulatedDOMEvent_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(props.position){var _props=props,_props$position=_props.position,_x34=_props$position.x,_y9=_props$position.y,target=_props.target;props=__varRecorder__$l.obj.dissoc(props,["position"]);props.pageX=_x34;props.pageY=_y9;}if(!props.hasOwnProperty("pointerId")&&__varRecorder__$l.mouseEvents.concat(__varRecorder__$l.pointerEvents).includes(props.type)){props=Object.assign({},props,{pointerId:1});}Object.assign(this,Object.assign({type:undefined,target:undefined,pageX:undefined,pageY:undefined,pointerId:undefined,pointerType:"mouse",buttons:0,keyCode:undefined,keyString:"",keyIdentifier:undefined,altKey:false,ctrlKey:false,shiftKey:false,metaKey:false,stopped:false},props));}},{key:"preventDefault",value:function SimulatedDOMEvent_preventDefault_(){this.defaultPrevented=true;}},{key:"stopPropagation",value:function SimulatedDOMEvent_stopPropagation_(){this.propagationStopped=true;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"SimulatedDOMEvent";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"events/Event.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:5394,end:6299});}(undefined);__varRecorder__$l.SimulatedDOMEvent=SimulatedDOMEvent;__varRecorder__$l.SimulatedDOMEvent=SimulatedDOMEvent;__varRecorder__$l.SimulatedDOMEvent=SimulatedDOMEvent;var __varRecorder__$m=lively.FreezerRuntime.recorderFor("lively.morphic/events/EventDispatcher.js");function dragStartEvent(domEvt,dispatcher,targetMorph,state,hand,halo,layoutHalo){var evt=new __varRecorder__$m.Event("morphicdragstart",domEvt,dispatcher,[targetMorph],hand,halo,layoutHalo).onDispatch(function(){state.draggedMorph=targetMorph;state.dragStartMorphPosition=targetMorph.position;state.dragStartPosition=evt.position;state.lastDragPosition=evt.position;state.dragDelta=__varRecorder__$m.pt(0,0);state.absDragDelta=__varRecorder__$m.pt(0,0);}).onStop(function(){state.draggedMorph=null;dispatcher.schedule(__varRecorder__$m.dragEndEvent(domEvt,dispatcher,targetMorph,state,hand,halo,layoutHalo));});return evt;}__varRecorder__$m.dragStartEvent=dragStartEvent;function dragEvent(domEvt,dispatcher,targetMorph,state,hand,halo,layoutHalo){var evt=new __varRecorder__$m.Event("morphicdrag",domEvt,dispatcher,[state.draggedMorph],hand,halo,layoutHalo).onDispatch(function(){state.dragDelta=(state.draggedMorph.owner||dispatcher.world).getInverseTransform().transformDirection(evt.position.subPt(state.lastDragPosition));state.absDragDelta=evt.position.subPt(state.clickedOnPosition);}).onAfterDispatch(function(){return state.lastDragPosition=evt.position;}).onStop(function(){state.draggedMorph=null;dispatcher.schedule(__varRecorder__$m.dragEndEvent(domEvt,dispatcher,targetMorph,state,hand,halo,layoutHalo));});return evt;}__varRecorder__$m.dragEvent=dragEvent;function dragEndEvent(domEvt,dispatcher,targetMorph,state,hand,halo,layoutHalo){var ctx=state.draggedMorph||targetMorph;var evt=new __varRecorder__$m.Event("morphicdragend",domEvt,dispatcher,[ctx],hand,halo,layoutHalo).onDispatch(function(){state.dragDelta=(ctx.owner||dispatcher.world).getInverseTransform().transformDirection(evt.position.subPt(state.lastDragPosition));state.absDragDelta=evt.position.subPt(state.clickedOnPosition);}).onAfterDispatch(function(){state.draggedMorph=null;state.lastDragPosition=null;state.dragDelta=__varRecorder__$m.pt(0,0);state.absDragDelta=__varRecorder__$m.pt(0,0);state.dragStartMorphPosition=null;state.dragStartPosition=null;});return evt;}__varRecorder__$m.dragEndEvent=dragEndEvent;function focusEvents(dispatcher,targetMorph){var state=dispatcher.eventState;if(state.focusedMorph===targetMorph)return[];var domEvt=null;var hand=null;var halo=null;var layoutHalo=null;var events=[];state.focusedMorph&&events.push(new __varRecorder__$m.Event("blur",domEvt,this,[state.focusedMorph],hand,halo,layoutHalo).onDispatch(function(){return state.focusedMorph=null;}));events.push(new __varRecorder__$m.Event("focus",domEvt,this,[targetMorph],hand,halo,layoutHalo).onDispatch(function(){return state.focusedMorph=targetMorph;}));return events;}__varRecorder__$m.focusEvents=focusEvents;__varRecorder__$m.arr=arr;__varRecorder__$m.fun=fun;__varRecorder__$m.Path=Path;__varRecorder__$m.promise=promise;__varRecorder__$m.pt=pt;__varRecorder__$m.config=config;__varRecorder__$m.TextInput=TextInput$1;__varRecorder__$m.KillRing=KillRing$1;__varRecorder__$m.Event=Event$1;__varRecorder__$m.KeyEvent=KeyEvent;__varRecorder__$m.SimulatedDOMEvent=SimulatedDOMEvent;__varRecorder__$m.keyLikeEvents=keyLikeEvents;__varRecorder__$m.cumulativeOffset=cumulativeOffset;__varRecorder__$m.bowser=exports$1$1;__varRecorder__$m.domEventsWeListenTo=[{type:"pointerdown",capturing:false},{type:"pointerup",capturing:false},{type:"pointermove",capturing:false,passive:false},{type:"pointerover",capturing:false,passive:false},{type:"pointerout",capturing:false,passive:false},{type:"contextmenu",capturing:false},{type:"scroll",capturing:true,passive:false},{type:"drag",capturing:false},{type:"dragstart",capturing:false},{type:"dragend",capturing:false},{type:"dragover",capturing:false},{type:"dragenter",capturing:false},{type:"dragleave",capturing:false},{type:"drop",capturing:false}];__varRecorder__$m.eventsCausingImmediateRender=new Set(["pointerdown","pointerup","keydown","keyup","input"]);__varRecorder__$m.globalDomEventsWeListenTo=[{type:"resize",capturing:false,morphMethod:"onWindowResize"},{type:"orientationchange",capturing:false,morphMethod:"onWindowResize"},{type:"scroll",capturing:false,passive:false,morphMethod:"onWindowScroll"},{type:"wheel",capturing:false,passive:false,morphToMethod:"onMouseWheel"},{type:"beforeunload",capturing:false,passive:false,morphMethod:"onBeforeUnload"}];__varRecorder__$m.typeToMethodMap={pointerdown:"onMouseDown",pointerup:"onMouseUp",pointermove:"onMouseMove",longclick:"onLongClick",hoverin:"onHoverIn",hoverout:"onHoverOut",morphicdrag:"onDrag",morphicdragstart:"onDragStart",morphicdragend:"onDragEnd",grab:"onGrab",morphicdrop:"onDrop",morphicdrophoverin:"onDropHoverIn",morphicdrophoverout:"onDropHoverOut",morphicdrophoverupdate:"onDropHoverUpdate",keydown:"onKeyDown",keyup:"onKeyUp",input:"onTextInput",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd",blur:"onBlur",focus:"onFocus",contextmenu:"onContextMenu",cut:"onCut",copy:"onCopy",paste:"onPaste",scroll:"onScroll",wheel:"onMouseWheel",drag:"onNativeDrag",dragstart:"onNativeDragstart",dragend:"onNativeDragend",dragover:"onNativeDragover",dragenter:"onNativeDragenter",dragleave:"onNativeDragleave",drop:"onNativeDrop"};__varRecorder__$m.focusTargetingEvents=["keydown","keyup","keypress","input","compositionstart","compositionupdate","compositionend","cut","copy","paste"];__varRecorder__$m.textOnlyEvents=["input","compositionstart","compositionupdate","compositionend"];var EventDispatcher=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/events/EventDispatcher.js");var __lively_class__=__lively_classholder__.hasOwnProperty("EventDispatcher")&&typeof __lively_classholder__.EventDispatcher==="function"?__lively_classholder__.EventDispatcher:__lively_classholder__.EventDispatcher=function EventDispatcher(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function EventDispatcher_initialize_(domEventEmitter,world){this.activations=0;this.emitter=domEventEmitter;this.keyInputHelper=null;this.world=world;this.installed=false;this.handlerFunctions=[];this.killRing=new __varRecorder__$m.KillRing(__varRecorder__$m.config.text.clipboardBufferLength);this.nodeMorphMap=new WeakMap();this.timestampBase=__varRecorder__$m.Path("performance.timing.navigationStart").get(domEventEmitter)||0;this.resetState();}},{key:"resetState",value:function EventDispatcher_resetState_(){this.eventState={timeOfLastActivity:0,focusedMorph:null,clickedOnPosition:null,clickedOnMorph:null,clickCount:0,prevClick:{},draggedMorph:null,dragDelta:null,absDragDelta:null,lastDragPosition:null,dragStartMorphPosition:null,dragStartPosition:null,hover:{hoveredOverMorphs:[],unresolvedPointerOut:false},scroll:{interactiveScrollInProgress:null},keyInputState:null,pressedKeys:{},html5Drag:{},dropHoverTarget:null};this.resetKeyInputState();}},{key:"resetKeyInputState",value:function EventDispatcher_resetKeyInputState_(){this.eventState.keyInputState={keyChain:"",count:undefined};}},{key:"focusMorph",value:function EventDispatcher_focusMorph_(morph){var _this48=this;this.keyInputHelper&&this.keyInputHelper.focus(morph,this.world);__varRecorder__$m.focusEvents(this,morph).forEach(function(evt){return _this48.dispatchEvent(evt);});}},{key:"isMorphFocused",value:function EventDispatcher_isMorphFocused_(morph){return this.eventState.focusedMorph===morph;}},{key:"isMorphHovered",value:function EventDispatcher_isMorphHovered_(morph){return this.eventState.hover.hoveredOverMorphs.includes(morph);}},{key:"isMorphClicked",value:function EventDispatcher_isMorphClicked_(morph){return this.eventState.clickedMorph==morph;}},{key:"isKeyPressed",value:function EventDispatcher_isKeyPressed_(keyName){return Object.keys(this.eventState.pressedKeys).map(function(ea){return ea.toLowerCase();}).includes(keyName.toLowerCase());}},{key:"whenIdle",value:function EventDispatcher_whenIdle_(){var _this49=this;return __varRecorder__$m.promise.waitFor(function(){return _this49.activations===0;});}},{key:"install",value:function EventDispatcher_install_(rootNode){var _this50=this;if(this.installed)return this;this.installed=true;var emitter=this.emitter;var globalEmitter=System.global;__varRecorder__$m.domEventsWeListenTo.forEach(function(_ref33){var type=_ref33.type,capturing=_ref33.capturing,passive=_ref33.passive;var fn=function fn(evt){return _this50.dispatchDOMEvent(evt);};_this50.handlerFunctions.push({node:emitter,type:type,fn:fn,capturing:capturing});var arg={capture:capturing,passive:passive};emitter.addEventListener(type,fn,arg);});globalEmitter.addEventListener&&__varRecorder__$m.globalDomEventsWeListenTo.forEach(function(_ref34){var type=_ref34.type,capturing=_ref34.capturing,morphMethod=_ref34.morphMethod,passive=_ref34.passive;var fn=function fn(evt){return _this50.dispatchDOMEvent(evt,_this50.world,morphMethod);};_this50.handlerFunctions.push({node:globalEmitter,type:type,fn:fn,capturing:capturing});var arg={capture:capturing,passive:passive};globalEmitter.addEventListener(type,fn,arg);});this.keyInputHelper=new __varRecorder__$m.TextInput(this).install(rootNode,this.world);if(__varRecorder__$m.bowser.ios)rootNode.setAttribute("touch-action","auto");return this;}},{key:"uninstallHandler",value:function EventDispatcher_uninstallHandler_(handler){var handlerToBeRemoved=this.handlerFuntions.find(function(_ref35){var type=_ref35.type;return type==handler;});if(handlerToBeRemoved){handlerToBeRemoved.node.removeEventListener(handlerToBeRemoved.node,handlerToBeRemoved.fn,handlerToBeRemoved.capturing);}}},{key:"uninstall",value:function EventDispatcher_uninstall_(){this.installed=false;var handlerFunctions=this.handlerFunctions;handlerFunctions.forEach(function(_ref36){var node=_ref36.node,type=_ref36.type,fn=_ref36.fn,capturing=_ref36.capturing;var arg=capturing;node.removeEventListener(type,fn,arg);});handlerFunctions.length=0;this.keyInputHelper&&this.keyInputHelper.uninstall();this.keyInputHelper=null;return this;}},{key:"processDOMEvent",value:function EventDispatcher_processDOMEvent_(domEvt,targetMorph){var _this51=this;var type=domEvt.type;var state=this.eventState;var eventTargets=[targetMorph].concat(targetMorph.ownerChain());var touch=domEvt.pointerType==="touch";var pointerId=domEvt.pointerId;var hand=typeof pointerId==="number"?this.world.handForPointerId(pointerId,domEvt.isPrimary):this.world.firstHand;var halo=typeof pointerId==="number"&&!touch?this.world.haloForPointerId(pointerId):null;var layoutHalo=typeof pointerId==="number"&&!touch?this.world.layoutHaloForPointerId(pointerId):null;var klass=__varRecorder__$m.keyLikeEvents.includes(type)?__varRecorder__$m.KeyEvent:__varRecorder__$m.Event;var defaultEvent=new klass(type,domEvt,this,eventTargets,hand,halo,layoutHalo);var events=[defaultEvent];var later=[];switch(type){case"keydown":state.pressedKeys[defaultEvent.key]=true;break;case"keyup":if(defaultEvent.key==="Meta")state.pressedKeys={};else delete state.pressedKeys[defaultEvent.key];break;case"click":var _this$processDOMEvent=this.processDOMEvent(Object.assign({},domEvt,{type:"pointerdown"}),targetMorph),downEvents=_this$processDOMEvent.events;var _this$processDOMEvent2=this.processDOMEvent(Object.assign({},domEvt,{type:"pointerup"}),targetMorph),upEvents=_this$processDOMEvent2.events;events=downEvents.concat(upEvents);break;case"pointerdown":if(typeof domEvt.target.setPointerCapture==="function");defaultEvent.onDispatch(function(){_this51.focusMorph(targetMorph);state.clickedOnMorph=targetMorph;state.clickedOnPosition=defaultEvent.position;state.downTimeStamp=domEvt.timeStamp;var repeatedClick=false;var prevClickCount=0;if(state.prevClick){var _state$prevClick=state.prevClick,clickedOnMorph=_state$prevClick.clickedOnMorph,clickedOnPosition=_state$prevClick.clickedOnPosition,clickedAtTime=_state$prevClick.clickedAtTime,clickCount=_state$prevClick.clickCount;var clickInterval=Date.now()-clickedAtTime;repeatedClick=clickedOnMorph===targetMorph&&clickInterval<__varRecorder__$m.config.repeatClickInterval;prevClickCount=clickCount;}state.clickCount=repeatedClick?prevClickCount+1:1;});break;case"pointerup":defaultEvent.onAfterDispatch(function(){var clickedOnMorph=state.clickedOnMorph,clickedOnPosition=state.clickedOnPosition,clickCount=state.clickCount;var clickedAtTime=Date.now();state.prevClick={clickedOnMorph:clickedOnMorph,clickedOnPosition:clickedOnPosition,clickedAtTime:clickedAtTime,clickCount:clickCount};state.clickedOnMorph=null;state.clickCount=0;var clickDuration=domEvt.timeStamp-state.downTimeStamp;var dist=state.clickedOnPosition.dist(defaultEvent.position);var _varRecorder__$m$con=__varRecorder__$m.config.longClick,maxDist=_varRecorder__$m$con.maxDist,minDur=_varRecorder__$m$con.minDur,maxDur=_varRecorder__$m$con.maxDur;if(dist<maxDist&&clickDuration>=minDur&&clickDuration<=maxDur){var evt=new __varRecorder__$m.Event("longclick",domEvt,_this51,eventTargets,hand,halo,layoutHalo);_this51.schedule(evt);}});if(state.draggedMorph){events.push(__varRecorder__$m.dragEndEvent(domEvt,this,targetMorph,state,hand,halo,layoutHalo));defaultEvent.targetMorphs=[this.world];}if(hand.carriesMorphs()){if(state.dropHoverTarget){events.push(new __varRecorder__$m.Event("morphicdrophoverout",domEvt,this,[state.dropHoverTarget],hand,halo,layoutHalo));targetMorph=state.dropHoverTarget;state.dropHoverTarget=null;}else{targetMorph=hand.findDropTarget(defaultEvent.position,hand.grabbedMorphs);}if(hand.isAncestorOf(targetMorph)){targetMorph=this.world;}events.push(new __varRecorder__$m.Event("morphicdrop",domEvt,this,[targetMorph],hand,halo,layoutHalo));defaultEvent.targetMorphs=[this.world];}break;case"pointermove":if(hand.carriesMorphs()){defaultEvent.targetMorphs=[this.world];var dropTargetMorph=hand.findDropTarget(defaultEvent.position,hand.grabbedMorphs)||this.world;if(state.dropHoverTarget===dropTargetMorph){events.push(new __varRecorder__$m.Event("morphicdrophoverupdate",domEvt,this,[dropTargetMorph],hand,halo,layoutHalo));}else{if(state.dropHoverTarget){events.push(new __varRecorder__$m.Event("morphicdrophoverout",domEvt,this,[state.dropHoverTarget],hand,halo,layoutHalo));}state.dropHoverTarget=dropTargetMorph;events.push(new __varRecorder__$m.Event("morphicdrophoverin",domEvt,this,[dropTargetMorph],hand,halo,layoutHalo));}}else if(state.draggedMorph){defaultEvent.targetMorphs=[this.world];events.push(__varRecorder__$m.dragEvent(domEvt,this,targetMorph,state,hand,halo,layoutHalo));}else if(state.clickedOnMorph&&state.clickedOnPosition&&state.clickedOnMorph.draggable&&!state.draggedMorph&&!hand.carriesMorphs()){var dist=state.clickedOnPosition.dist(defaultEvent.position);var dragTarget=state.clickedOnMorph;if(dist>dragTarget.dragTriggerDistance){if(dragTarget.grabbable){events.push(new __varRecorder__$m.Event("grab",domEvt,this,[dragTarget],hand,halo,layoutHalo));}else if(dragTarget.draggable){events.push(__varRecorder__$m.dragStartEvent(domEvt,this,dragTarget,state,hand,halo,layoutHalo));}defaultEvent.targetMorphs=[this.world];}}break;case"pointerover":if(state.hover.unresolvedPointerOut){state.hover.unresolvedPointerOut=false;}var hoveredOverMorphs=[targetMorph].concat(targetMorph.ownerChain()).reverse();var hoverOutEvents=__varRecorder__$m.arr.withoutAll(state.hover.hoveredOverMorphs,hoveredOverMorphs).map(function(m){return new __varRecorder__$m.Event("hoverout",domEvt,_this51,[m],hand,halo,layoutHalo).onDispatch(function(){return __varRecorder__$m.arr.remove(state.hover.hoveredOverMorphs,m);});});var hoverInEvents=__varRecorder__$m.arr.withoutAll(hoveredOverMorphs,state.hover.hoveredOverMorphs).map(function(m){return new __varRecorder__$m.Event("hoverin",domEvt,_this51,[m],hand,halo,layoutHalo).onDispatch(function(){return __varRecorder__$m.arr.pushIfNotIncluded(state.hover.hoveredOverMorphs,m);});});events=hoverOutEvents.concat(hoverInEvents);break;case"pointerout":events=[];state.hover.unresolvedPointerOut=true;later.push(function(){if(state.hover.unresolvedPointerOut){return Promise.all(state.hover.hoveredOverMorphs.map(function(m){return _this51.schedule(new __varRecorder__$m.Event("hoverout",domEvt,_this51,[m],hand,halo,layoutHalo).onAfterDispatch(function(){return __varRecorder__$m.arr.remove(state.hover.hoveredOverMorphs,m);}));}));}});if(touch){this.world.removeHandForPointerId(pointerId);}break;case"blur":events=[new __varRecorder__$m.Event(type,domEvt,this,[targetMorph],hand,halo,layoutHalo).onDispatch(function(){return state.focusedMorph=null;})];break;case"focus":events=__varRecorder__$m.focusEvents(this,targetMorph);break;case"scroll":events=[new __varRecorder__$m.Event(type,domEvt,this,[targetMorph],hand,halo,layoutHalo).onDispatch(function(){var scrollInProgress=!!state.scroll.interactiveScrollInProgress;if(!scrollInProgress){var _varRecorder__$m$pro=__varRecorder__$m.promise.deferred(),_p10=_varRecorder__$m$pro.promise,_resolve3=_varRecorder__$m$pro.resolve;var _delay=__varRecorder__$m.bowser.name=="Firefox"?500:250;if(__varRecorder__$m.bowser.name=="Safari")_delay=1000;state.scroll.interactiveScrollInProgress=_p10;_p10.debounce=__varRecorder__$m.fun.debounce(_delay,function(){state.scroll.interactiveScrollInProgress=null;_resolve3();});}state.scroll.interactiveScrollInProgress.debounce();var target=domEvt.target.documentElement||domEvt.target;var newX=target.scrollLeft,newY=target.scrollTop,style=target.style;var _targetMorph$scroll=targetMorph.scroll,x=_targetMorph$scroll.x,y=_targetMorph$scroll.y;if(style.overflow!="hidden"&&x!==newX||y!==newY)targetMorph.scroll=__varRecorder__$m.pt(newX,newY);})];break;case"input":case"compositionstart":case"compositionupdate":case"compositionend":if(!targetMorph.isText)events=[];else defaultEvent.targetMorphs=[targetMorph];break;case"drag":case"dragstart":case"dragend":case"dragover":case"dragenter":case"dragleave":case"drop":if(type==="drop"||type==="dragover"){domEvt.preventDefault();}break;}return{events:events,later:later};}},{key:"schedule",value:function EventDispatcher_schedule_(evt){var _this52=this;this.activations++;return Promise.resolve().then(function(){return _this52.dispatchEvent(evt);}).then(function(){return _this52.activations--;},function(err){_this52.activations--;throw err;});}},{key:"dispatchEvent",value:function EventDispatcher_dispatchEvent_(evt,method){method=method||__varRecorder__$m.typeToMethodMap[evt.type];if(!method){throw new Error("dispatchEvent: ".concat(evt.type," not yet supported!"));}evt.onDispatchCallbacks.forEach(function(ea){return ea();});this.activations++;var err;for(var _j11=evt.targetMorphs.length-1;_j11>=0;_j11--){try{evt.targetMorphs[_j11][method](evt);}catch(e){err=new Error("Error in event handler ".concat(evt.targetMorphs[_j11],".").concat(method,": ").concat(e.stack||e));err.originalError=e;typeof this.world!=="undefined"?this.world.logError(err):console.error(err);}if(err||evt.stopped)break;}this.activations--;evt.onAfterDispatchCallbacks.forEach(function(ea){return ea();});if(err)throw err;}},{key:"dispatchDOMEvent",value:function EventDispatcher_dispatchDOMEvent_(domEvt,targetMorph,morphMethod){var _this53=this;var world=this.world,state=this.eventState,nodeMorphMap=this.nodeMorphMap;var timeStamp=domEvt.timeStamp,type=domEvt.type;state.timeOfLastActivity=this.timestampBase+timeStamp;if(!targetMorph&&__varRecorder__$m.focusTargetingEvents.includes(type)){targetMorph=state.focusedMorph||world;}else if(!targetMorph){var targetNode=domEvt.target;while(true){var cssClasses=targetNode.className||"";if(typeof cssClasses!=="string"&&"baseVal"in cssClasses){cssClasses=cssClasses.baseVal;}if(cssClasses&&cssClasses.includes("Morph"))break;if(!(targetNode=targetNode.parentNode))return;}targetMorph=nodeMorphMap.get(targetNode);if(!targetMorph){var targetId=targetNode.id;targetMorph=world.withAllSubmorphsDetect(function(sub){return sub.id===targetId;});if(targetMorph)nodeMorphMap.set(targetNode,targetMorph);}}if(!targetMorph){return;}var _this$processDOMEvent3=this.processDOMEvent(domEvt,targetMorph),events=_this$processDOMEvent3.events,later=_this$processDOMEvent3.later;later.map(function(callback){_this53.activations++;return __varRecorder__$m.promise.delay(0).then(callback).then(function(){return _this53.activations--;},function(err){_this53.activations--;throw err;});});events.forEach(function(evt){return _this53.dispatchEvent(evt,morphMethod);});if(world&&world.needsRerender()&&__varRecorder__$m.eventsCausingImmediateRender.has(type)){world.env.renderer.renderLater();}}},{key:"simulateDOMEvents",value:function EventDispatcher_simulateDOMEvents_(){var doc=this.emitter.document||this.emitter.ownerDocument;var events=[];for(var _len4=arguments.length,eventSpecs=new Array(_len4),_key11=0;_key11<_len4;_key11++){eventSpecs[_key11]=arguments[_key11];}for(var _i90=0,_eventSpecs=eventSpecs;_i90<_eventSpecs.length;_i90++){var spec=_eventSpecs[_i90];var _spec2=spec,target=_spec2.target,position=_spec2.position,type=_spec2.type;if(__varRecorder__$m.focusTargetingEvents.includes(type)){if(!this.keyInputHelper.domState.textareaNode){throw new Error("Cannot simulate event of type ".concat(type,", no keyInputHelper installed!"));}spec=Object.assign({},spec,{target:this.keyInputHelper.textareaNode});}if(!target){if(!position)target=this.world;else target=this.world.morphsContainingPoint(position)[0];}if(target.isMorph){spec=Object.assign({},spec,{target:doc.getElementById(target.id)});}if(spec.position){var _varRecorder__$m$cum=__varRecorder__$m.cumulativeOffset(doc.getElementById(this.world.id)),left=_varRecorder__$m$cum.left,top=_varRecorder__$m$cum.top;spec.position=spec.position.addXY(left,top);}if(type==="scroll"&&("scrollLeft"in spec||"scrollTop"in spec)){spec.target.scrollLeft=spec.scrollLeft||0;spec.target.scrollTop=spec.scrollTop||0;}var evt=new __varRecorder__$m.SimulatedDOMEvent(spec);events.push(evt);this.dispatchDOMEvent(evt);}return events;}},{key:"doCopy",value:function EventDispatcher_doCopy_(content){return this.keyInputHelper.doCopy(content);}},{key:"doCopyWithMimeTypes",value:function EventDispatcher_doCopyWithMimeTypes_(dataAndTypes){return this.keyInputHelper.doCopyWithMimeTypes(dataAndTypes);}},{key:"doPaste",value:function EventDispatcher_doPaste_(){return this.keyInputHelper.doPaste();}},{key:"cancelGrab",value:function EventDispatcher_cancelGrab_(hand,causingEvent){var _this54=this;var cleanupEvents=[];var state=this.eventState;state.clickedOnMorph=null;if(state.dropHoverTarget){cleanupEvents.push(new __varRecorder__$m.Event("morphicdrophoverout",causingEvent.domEvt,this,[state.dropHoverTarget],hand,null,null));state.dropHoverTarget=null;}cleanupEvents.forEach(function(evt){return _this54.dispatchEvent(evt);});}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"EventDispatcher";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"events/EventDispatcher.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:7065,end:29760});}(undefined);EventDispatcher=__varRecorder__$m.EventDispatcher;var EventDispatcher$1=EventDispatcher;__varRecorder__$m["default"]=EventDispatcher;/*global System*/ // type EventType = string
// type EventTime = number
// type Notification = {type: EventType, time: EventTime, ...};
// type Handler = Notification -> ()
// type Notifications = { [number]: Notification, limit: number }
// type Emitter = {isRecording: boolean, isLogging: boolean, ... }
// type Env = {emitter: Emitter, notifications: Notifications}
var env$1=null;function getEnv(_System){// System? -> Env
if(_System===undefined){if(typeof System==="undefined"){// fallback if not System is available
return env$1;}_System=System;}var livelyEnv=_System.get("@lively-env");if(!livelyEnv)_System.set("@lively-env",_System.newModule({options:{}}));var options=livelyEnv.options;if(!options)throw new Error("@lively-env registered read-only");if(!options.emitter){Object.assign(options,{emitter:_System["__lively.notifications_emitter"]||(_System["__lively.notifications_emitter"]=makeEmitter({},{maxListenerLimit:10000})),notifications:_System["__lively.notifications_notifications"]||(_System["__lively.notifications_notifications"]=[])});}var emitter=options.emitter,notifications=options.notifications;return{emitter:emitter,notifications:notifications};}function subscribe(type,handler,system){// EventType, Handler, System? -> Handler
getEnv(system).emitter.on(type,handler);return handler;}function subscribeOnce(type,handler,system){// EventType, Handler, System? -> Handler
getEnv(system).emitter.once(type,handler);return handler;}function emit$1(type){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var time=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Date.now();var system=arguments.length>3?arguments[3]:undefined;// EventType, Notification?, EventTime?, System? -> Notification
var notification=Object.assign({type:type,time:time},data),_getEnv=getEnv(system),emitter=_getEnv.emitter,notifications=_getEnv.notifications;emitter.emit(type,notification);if(emitter.isLogging)log(notification);if(emitter.isRecording)record(notifications,notification);return notification;}function unsubscribe(type,handler,system){// EventType, Handler, System? -> Handler
getEnv(system).emitter.removeListener(type,handler);return handler;}function record(notifications,notification){// Array<Notification>, Notification -> ()
notifications.push(notification);if(notifications.limit){notifications.splice(0,notifications.length-notifications.limit);}}function log(notification){// Notification -> ()
var padded=notification.type+" ".repeat(Math.max(0,32-notification.type.length));console.log(padded+" "+inspect(notification,{maxDepth:2}));}var __varRecorder__$n=lively.FreezerRuntime.recorderFor("lively.morphic/env.js");__varRecorder__$n.defaultDOMEnv=defaultDOMEnv;__varRecorder__$n.Renderer=Renderer;__varRecorder__$n.FontMetric=FontMetric$1;__varRecorder__$n.ChangeManager=ChangeManager;__varRecorder__$n.UndoManager=UndoManager;__varRecorder__$n.EventDispatcher=EventDispatcher$1;__varRecorder__$n.subscribe=subscribe;__varRecorder__$n.unsubscribe=unsubscribe;var MorphicEnv=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/env.js");var __lively_class__=__lively_classholder__.hasOwnProperty("MorphicEnv")&&typeof __lively_classholder__.MorphicEnv==="function"?__lively_classholder__.MorphicEnv:__lively_classholder__.MorphicEnv=function MorphicEnv(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function MorphicEnv_initialize_(){var _this55=this;var domEnv=arguments.length>0&&arguments[0]!==undefined?arguments[0]:__varRecorder__$n.defaultDOMEnv();this.initialized=false;this.fontMetric=null;this.renderer=null;this.eventDispatcher=null;this.world=null;this.systemChangeHandlers=null;this.objPool=null;this.synchronizer=null;this.changeManager=new __varRecorder__$n.ChangeManager();this.undoManager=new __varRecorder__$n.UndoManager();this.installSystemChangeHandlers();this.whenRenderedRequesters=new Map();this.whenRenderedTickingProcess=null;if(typeof domEnv.then==="function"){this._waitForDOMEnv=domEnv.then(function(env){_this55._waitForDOMEnv=null;_this55.initWithDOMEnv(env);_this55.initialized=true;})["catch"](function(err){return console.error("Error initializing MorphicEnv with dom env: ".concat(err.stack));});}else{this.initWithDOMEnv(domEnv);this.initialized=true;}}},{key:"isDefault",value:function MorphicEnv_isDefault_(){return this.constructor["default"]()===this;}},{key:"initWithDOMEnv",value:function MorphicEnv_initWithDOMEnv_(domEnv){this.domEnv=domEnv;this.fontMetric=__varRecorder__$n.FontMetric.forDOMEnv(domEnv);}},{key:"uninstallWorldRelated",value:function MorphicEnv_uninstallWorldRelated_(){this.renderer&&this.renderer.clear();this.eventDispatcher&&this.eventDispatcher.uninstall();this.world&&this.world.suspendSteppingAll();}},{key:"uninstall",value:function MorphicEnv_uninstall_(){var _this56=this;if(this._waitForDOMEnv){return this._waitForDOMEnv.then(function(){return _this56.uninstall();});}this.deleteHistory();this.uninstallWorldRelated();if(this.fontMetric){this.fontMetric.uninstall();this.fontMetric=null;}if(this.domEnv&&this.whenRenderedTickingProcess){this.domEnv.window.cancelAnimationFrame(this.whenRenderedTickingProcess);this.whenRenderedTickingProcess=null;}this.whenRenderedRequesters=new Map();this.domEnv&&this.domEnv.destroy();this.initialized=false;return Promise.resolve();}},{key:"setWorld",value:function MorphicEnv_setWorld_(world){var _this57=this;if(this._waitForDOMEnv){return this._waitForDOMEnv.then(function(){return _this57.setWorld(world);});}return this.setWorldRenderedOn(world,this.domEnv.document.body);}},{key:"setWorldRenderedOn",value:function MorphicEnv_setWorldRenderedOn_(world,rootNode){var _this58=this;var domNode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!world||!world.isWorld){throw new Error("world object does not look like a morphic world");}if(this._waitForDOMEnv){return this._waitForDOMEnv.then(function(){return _this58.setWorldRenderedOn(world,rootNode,domNode);});}this.deleteHistory();this.uninstallWorldRelated();this.world=world;this.renderer=new __varRecorder__$n.Renderer(world,rootNode,this.domEnv);this.renderer.domNode=domNode;this.eventDispatcher=new __varRecorder__$n.EventDispatcher(this.domEnv.window,world).install(rootNode);world.resumeSteppingAll();if(this.isDefault())this.domEnv.window.$world=world;world.focus();world.makeDirty();this.renderer.renderLater();return world.whenRendered().then(function(){return _this58;});}},{key:"installSystemChangeHandlers",value:function MorphicEnv_installSystemChangeHandlers_(){var _this59=this;if(this.systemChangeHandlers)return;var systemChangeHandlers=this.systemChangeHandlers={};systemChangeHandlers["lively.modules/moduleloaded"]=[__varRecorder__$n.subscribe("lively.modules/moduleloaded",function(evt){return _this59.getTargetsFor("onModuleLoaded").forEach(function(ea){return ea.onModuleLoaded(evt);});})];systemChangeHandlers["lively.modules/modulechanged"]=[__varRecorder__$n.subscribe("lively.modules/modulechanged",function(evt){return _this59.getTargetsFor("onModuleChanged").forEach(function(ea){return ea.onModuleChanged(evt);});})];systemChangeHandlers["lively.partsbin/partpublished"]=[__varRecorder__$n.subscribe("lively.partsbin/partpublished",function(evt){return _this59.getTargetsFor("onPartPublished").forEach(function(ea){return ea.onPartPublished(evt);});})];systemChangeHandlers["lively.user/userchanged"]=[__varRecorder__$n.subscribe("lively.user/userchanged",function(evt){return _this59.getTargetsFor("onUserChanged").forEach(function(ea){return ea.onUserChanged(evt);});})];}},{key:"uninstallSystemChangeHandlers",value:function MorphicEnv_uninstallSystemChangeHandlers_(){var systemChangeHandlers=this.systemChangeHandlers;if(!systemChangeHandlers)return;this.systemChangeHandlers=null;Object.keys(systemChangeHandlers).forEach(function(name){return systemChangeHandlers[name].forEach(function(handler){return __varRecorder__$n.unsubscribe(name,handler);});});}},{key:"getTargetsFor",value:function MorphicEnv_getTargetsFor_(selector){var world=this.world;var targets=[];if(!world||!world.submorphs)return targets;if(typeof world[selector]==="function"){targets.push(world);}var _iterator33=_createForOfIteratorHelper(world.submorphs),_step33;try{for(_iterator33.s();!(_step33=_iterator33.n()).done;){var _morph4=_step33.value;if(typeof _morph4[selector]==="function"){targets.push(_morph4);}if(_morph4.isWindow&&_morph4.targetMorph&&typeof _morph4.targetMorph[selector]==="function"){targets.push(_morph4.targetMorph);}}}catch(err){_iterator33.e(err);}finally{_iterator33.f();}return targets;}},{key:"cleanupCaches",value:function MorphicEnv_cleanupCaches_(){this.world.withAllSubmorphsDo(function(m){return m._pathDependants=m._pathDependants.filter(function(m){return m.world();});});}},{key:"deleteHistory",value:function MorphicEnv_deleteHistory_(){var changeManager=this.changeManager,world=this.world,fontMetric=this.fontMetric;changeManager&&(changeManager.changes.length=0);world&&world.withAllSubmorphsDo(function(ea){return ea.undoManager&&ea.undoManager.reset();});fontMetric&&fontMetric.reset();}},{key:"printStatus",value:function MorphicEnv_printStatus_(){var changeManager=this.changeManager,world=this.world,fontMetric=this.fontMetric;var morphsWithUndo=0;var undoChanges=0;world&&world.withAllSubmorphsDo(function(ea){if(!ea.undoManager)return;morphsWithUndo++;undoChanges+=ea.undoManager.undos.length+ea.undoManager.redos.length;});return"".concat(changeManager.changes.length," changes recorded\n").concat(morphsWithUndo," morphs with undos\n").concat(undoChanges," undo changes");}},{key:"updateWhenRenderedRequests",value:function MorphicEnv_updateWhenRenderedRequests_(){var _this60=this;var whenRenderedRequesters=this.whenRenderedRequesters;var nRequesters=0;var _iterator34=_createForOfIteratorHelper(whenRenderedRequesters),_step34;try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){var _step34$value=_slicedToArray2(_step34.value,2),_morph5=_step34$value[0],requestState=_step34$value[1];var maxAttempts=requestState.maxAttempts,currentAttempt=requestState.currentAttempt,_resolve4=requestState.resolve,_reject2=requestState.reject;if(!_morph5._dirty&&!_morph5._rendering){whenRenderedRequesters["delete"](_morph5);_resolve4(_morph5);}else if(++requestState.currentAttempt>maxAttempts){whenRenderedRequesters["delete"](_morph5);_reject2(new Error("Failed to wait for whenRendered of ".concat(_morph5," (tried ").concat(maxAttempts,"x)")));}else nRequesters++;}}catch(err){_iterator34.e(err);}finally{_iterator34.f();}if(!nRequesters)this.whenRenderedTickingProcess=null;else{this.whenRenderedTickingProcess=this.domEnv.window.requestAnimationFrame(function(){return _this60.updateWhenRenderedRequests();});}}},{key:"whenRendered",value:function MorphicEnv_whenRendered_(morph){var _this61=this;var maxAttempts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:50;var whenRenderedRequesters=this.whenRenderedRequesters,whenRenderedTickingProcess=this.whenRenderedTickingProcess;var requestState=whenRenderedRequesters.get(morph);if(!requestState){var _resolve5;var _reject3;var _promise=new Promise(function(rs,rj){_resolve5=rs;_reject3=rj;});whenRenderedRequesters.set(morph,requestState={maxAttempts:maxAttempts,currentAttempt:0,resolve:_resolve5,reject:_reject3,promise:_promise});}if(!whenRenderedTickingProcess){this.whenRenderedTickingProcess=this.domEnv.window.requestAnimationFrame(function(){return _this61.updateWhenRenderedRequests();});}return requestState.promise;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"MorphicEnv";}},{key:"reset",value:function MorphicEnv_reset_(){while(true){var _env=this.popDefault();if(!_env)break;try{_env.uninstall();}catch(err){console.error("Error uninstalling MorphicEnv: ".concat(err.stack||err));}}}},{key:"default",value:function MorphicEnv_default_(){var envs=this.envs;if(!envs.length)this.pushDefault(new this());return envs[envs.length-1];}},{key:"pushDefault",value:function MorphicEnv_pushDefault_(env){this.envs.push(env);return env;}},{key:"popDefault",value:function MorphicEnv_popDefault_(){return this.envs.pop();}},{key:"envs",get:function get(){return this._envs||(this._envs=[]);}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"env.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:405,end:8274});}(undefined);__varRecorder__$n.MorphicEnv=MorphicEnv;__varRecorder__$n.MorphicEnv=MorphicEnv;__varRecorder__$n.MorphicEnv=MorphicEnv;var __captured7__=/*#__PURE__*/Object.freeze({__proto__:null,MorphicEnv:MorphicEnv});var __varRecorder__$o=lively.FreezerRuntime.recorderFor("lively.morphic/CommandHandler.js");function printArg$1(x){return __varRecorder__$o.obj.inspect(x,{maxDepth:1}).replace(/\n/g,"").replace(/\s+/g," ");}__varRecorder__$o.printArg=printArg$1;__varRecorder__$o.obj=obj;__varRecorder__$o.arr=arr;__varRecorder__$o.promise=promise;var CommandHandler=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/CommandHandler.js");var __lively_class__=__lively_classholder__.hasOwnProperty("CommandHandler")&&typeof __lively_classholder__.CommandHandler==="function"?__lively_classholder__.CommandHandler:__lively_classholder__.CommandHandler=function CommandHandler(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function CommandHandler_initialize_(){this.history=[];this.maxHistorySize=1000;}},{key:"addToHistory",value:function CommandHandler_addToHistory_(cmdName){this.history.push(cmdName);if(this.history.length>this.maxHistorySize){this.history.splice(0,this.history.length-this.maxHistorySize);}}},{key:"printHistory",value:function CommandHandler_printHistory_(){return this.history.map(this.printCommand).join("\n");}},{key:"printCommand",value:function CommandHandler_printCommand_(cmd){var name=cmd.name,targetName=cmd.target.string,args=cmd.args,count=cmd.count,evt=cmd.evt,keyCombo=cmd.keyCombo;return"\"".concat(name,"\" ").concat(evt?evt+" ":"").concat(keyCombo?keyCombo+" ":"").concat(args?__varRecorder__$o.printArg(args):"").concat(typeof count==="number"?" x".concat(count):""," ").concat(targetName);}},{key:"lookupCommand",value:function CommandHandler_lookupCommand_(commandOrName,morph){var name,command;if(!commandOrName)return{};if(typeof commandOrName==="string")name=commandOrName;if(typeof commandOrName.command==="string")name=commandOrName.command;if(commandOrName.exec){command=commandOrName;name=command.name;}if(!command)command=morph.commands.find(function(ea){return ea.name===name;});return{name:name,command:command};}},{key:"exec",value:function CommandHandler_exec_(commandOrName,morph,args,count,evt){var _this62=this;var _ref37=this.lookupCommand(commandOrName,morph)||{},name=_ref37.name,command=_ref37.command;if(!command){console.warn("Cannot find command ".concat(name||commandOrName));return null;}if(name){var evtType,keyCombo;if(evt){evtType=evt.type;if(evt.isKeyEvent)keyCombo=evt.keyCombo;}this.addToHistory({name:name,target:{string:String(morph),id:morph.id},args:args,count:count,time:Date.now(),evt:evtType,keyCombo:keyCombo});}var world=morph.world();var result;if(typeof command.progressIndicator==="string"){this.progressIndicator=world.execCommand("open loading indicator",command.progressIndicator);}if(typeof command.exec==="function"){try{result=command.exec(morph,args,command.handlesCount?count:undefined,evt);}catch(err){result=err;var msg="Error in interactive command ".concat(name,": ").concat(err.stack||err);world?world.logError(msg):console.error(msg);}}else{console.error("command ".concat(name," has no exec function!"));}if(this.progressIndicator)this.progressIndicator.remove();if(result&&typeof result["catch"]==="function"){result["catch"](function(err){var msg="Error in interactive command ".concat(name,": ").concat(err,"\n").concat(err.stack||err);world?world.logError(msg):console.error(msg);throw err;});this.progressIndicator&&__varRecorder__$o.promise["finally"](result,function(){return _this62.progressIndicator.remove();});}else{this.progressIndicator&&this.progressIndicator.remove();}if(result&&typeof count==="number"&&count>1&&!command.handlesCount){result=typeof result.then==="function"?result.then(function(){return _this62.exec(command,morph,args,count-1,evt,null);}):this.exec(command,morph,args,count-1,evt,null);}return result;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"CommandHandler";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"CommandHandler.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:194,end:3656});}(undefined);CommandHandler=__varRecorder__$o.CommandHandler;var CommandHandler$1=CommandHandler;__varRecorder__$o["default"]=CommandHandler;var __varRecorder__$p=lively.FreezerRuntime.recorderFor("lively.morphic/events/KeyHandler.js");function ensureSpaces(s){return s.length?s:" ";}__varRecorder__$p.ensureSpaces=ensureSpaces;function invokeKeyHandlers(morph,evt){var noInputEvents=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;evt=__varRecorder__$p.Keys.canonicalizeEvent(evt);var _evt=evt,keyCombo=_evt.keyCombo,key=_evt.key,data=_evt.data;var toExecute;var executed=false;var keyhandlers=morph.keyhandlers;var keyInputState=evt.keyInputState||{};var isInputEvent=keyCombo.startsWith("input-");var nullCommand=false;var carryOverCount=keyInputState.count;var carryOverKeyChain=keyInputState.keyChain||"";var keyInputStateNeedsUpdate=false;if(!keyhandlers||noInputEvents&&isInputEvent)return false;for(var _i91=keyhandlers.length;_i91--;){toExecute=keyhandlers[_i91].eventCommandLookup(morph,evt);if(!toExecute||!toExecute.command)continue;var _toExecute=toExecute,command=_toExecute.command,args=_toExecute.args,passEvent=_toExecute.passEvent,_count2=_toExecute.count,keyChain=_toExecute.keyChain,onlyWhenFocused=_toExecute.onlyWhenFocused;keyInputStateNeedsUpdate=true;carryOverCount=_count2;carryOverKeyChain=keyChain;nullCommand=command==="null";if(onlyWhenFocused){var world=morph.world();if(world&&world.focusedMorph&&world.focusedMorph!==morph){continue;}}executed=nullCommand?false:morph.execCommand(command,args,_count2,evt);if(executed&&(!isInputEvent||command!=="insertstring")&&!passEvent&&typeof evt.stop==="function"){evt.stop();}if(executed||nullCommand)break;}if(!executed&&!nullCommand&&isInputEvent&&morph.onTextInput&&!carryOverKeyChain){var _count3=keyInputState.count;executed=morph.execCommand("insertstring",{string:data||key,undoGroup:__varRecorder__$p.config.text.undoGroupDelay},_count3,evt);}if(keyInputStateNeedsUpdate){if(typeof evt.onAfterDispatch==="function"){evt.onAfterDispatch(function(){keyInputState.count=executed?undefined:carryOverCount;keyInputState.keyChain=executed?"":carryOverKeyChain;});}else{keyInputState.count=executed?undefined:carryOverCount;keyInputState.keyChain=executed?"":carryOverKeyChain;}}return executed&&!nullCommand;}__varRecorder__$p.invokeKeyHandlers=invokeKeyHandlers;function simulateKeys(_x35,_x36){return _simulateKeys.apply(this,arguments);}function _simulateKeys(){_simulateKeys=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee206(morph,keyComboString){var keyInputState,pressedKeys,_iterator99,_step99,_keys,_args207=arguments;return regeneratorRuntime.wrap(function _callee206$(_context206){while(1){switch(_context206.prev=_context206.next){case 0:keyInputState=_args207.length>2&&_args207[2]!==undefined?_args207[2]:{keyChain:undefined,count:undefined};pressedKeys=keyComboString.length===1?[keyComboString]:keyComboString.split(/ /g).map(__varRecorder__$p.ensureSpaces);_iterator99=_createForOfIteratorHelper(pressedKeys);_context206.prev=3;_iterator99.s();case 5:if((_step99=_iterator99.n()).done){_context206.next=11;break;}_keys=_step99.value;_context206.next=9;return __varRecorder__$p.simulateKey(morph,_keys,keyInputState);case 9:_context206.next=5;break;case 11:_context206.next=16;break;case 13:_context206.prev=13;_context206.t0=_context206["catch"](3);_iterator99.e(_context206.t0);case 16:_context206.prev=16;_iterator99.f();return _context206.finish(16);case 19:case"end":return _context206.stop();}}},_callee206,null,[[3,13,16,19]]);}));return _simulateKeys.apply(this,arguments);}__varRecorder__$p.simulateKeys=simulateKeys;function simulateKey(morph,keyComboString,keyInputState){return __varRecorder__$p.invokeKeyHandlers(morph,Object.assign({},__varRecorder__$p.Keys.keyComboToEventSpec(keyComboString),{keyInputState:keyInputState}));}__varRecorder__$p.simulateKey=simulateKey;function bowserOS(){if(__varRecorder__$p.bowser.mac)return"mac";if(__varRecorder__$p.bowser.windows)return"windows";if(__varRecorder__$p.bowser.windowsphone)return"windowsphone";if(__varRecorder__$p.bowser.linux)return"linux";if(__varRecorder__$p.bowser.chromeos)return"chromeos";if(__varRecorder__$p.bowser.android)return"android";if(__varRecorder__$p.bowser.ios)return"ios";if(__varRecorder__$p.bowser.blackberry)return"blackberry";if(__varRecorder__$p.bowser.firefoxos)return"firefoxos";if(__varRecorder__$p.bowser.webos)return"webos";if(__varRecorder__$p.bowser.bada)return"bada";if(__varRecorder__$p.bowser.tizen)return"tizen";if(__varRecorder__$p.bowser.sailfish)return"sailfish";return"unknown";}__varRecorder__$p.bowserOS=bowserOS;function findKeysForPlatform(binding,platform){if(typeof binding==="string")return binding;if(!binding||_typeof2(binding)!=="object")return null;switch(platform){case"ios":return binding.ios||binding.mac;case"mac":return binding.mac||binding.ios;case"win":case"windows":case"windowsphone":return binding.win||binding.windows;case"linux":return binding.linux||binding.win||binding.windows;case"chromeos":return binding.chromeos||binding.linux||binding.win||binding.windows;case"android":return binding.android||binding.linux||binding.win||binding.windows;default:return binding.linux||binding.win||binding.windows;}}__varRecorder__$p.findKeysForPlatform=findKeysForPlatform;__varRecorder__$p.Keys=Keys;__varRecorder__$p.bowser=exports$1$1;__varRecorder__$p.config=config;__varRecorder__$p.arr=arr;__varRecorder__$p.findKeysForPlatform=findKeysForPlatform;__varRecorder__$p.findKeysForPlatform=findKeysForPlatform;__varRecorder__$p.regexps={meta:/Meta|Cmd|Command/gi,alt:/Alt/gi,ctrl:/Ctrl|Control/gi,tab:/Tab/gi,enter:/Enter|Return/gi,shift:/Shift/gi,backspace:/Backspace/gi,"delete":/del(ete)?/gi,left:/left/gi,right:/right/gi,up:/up/gi,down:/down/gi,keySpacer:/([^-])-/g,seqSpacer:/([^\s])\s/g};var KeyHandler=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/events/KeyHandler.js");var __lively_class__=__lively_classholder__.hasOwnProperty("KeyHandler")&&typeof __lively_classholder__.KeyHandler==="function"?__lively_classholder__.KeyHandler:__lively_classholder__.KeyHandler=function KeyHandler(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function KeyHandler_initialize_(){var platform=arguments.length>0&&arguments[0]!==undefined?arguments[0]:__varRecorder__$p.bowserOS();this.platform=platform;this.keyBindings={};}},{key:"eventCommandLookup",value:function KeyHandler_eventCommandLookup_(morph,evt){var keyCombo=evt.keyCombo,keyInputState=evt.keyInputState;return this.lookup(keyCombo,keyInputState);}},{key:"lookup",value:function KeyHandler_lookup_(keyCombo){var _this63=this;var keyInputState=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{keyChain:undefined,count:undefined};keyCombo=__varRecorder__$p.Keys.canonicalizeKeyCombo(keyCombo);var keyChain=keyInputState.keyChain||"";var count=keyInputState.count;if(!keyChain&&keyCombo.startsWith("Ctrl-")){var countMatch=keyCombo.match(/^Ctrl-([0-9]+)/);if(countMatch){var numArg=parseInt((typeof count==="number"?count:"")+countMatch[1]);return{command:"null",count:numArg};}if(keyCombo==="Ctrl-U")return{command:"null",count:4,keyChain:"Ctrl-U"};}var combos=[keyCombo];if(!command&&keyCombo.startsWith("input-")){var upper=keyCombo.replace(/^(input-)(.*)$/,function(_,before,key){return before+key.toUpperCase();});var lower=keyCombo.replace(/^(input-)(.*)$/,function(_,before,key){return before+key.toLowerCase();});combos.push(upper,lower);}var command=combos.map(function(keyCombo){return _this63.keyBindings[keyCombo];})[0];if(keyChain){var chainCombo=combos.find(function(keyCombo){return _this63.keyBindings[keyChain+" "+keyCombo];});if(chainCombo){keyChain+=" "+chainCombo;command=this.keyBindings[keyChain]||command;}}if(command&&command==="chainKeys"){keyChain=keyChain||keyCombo;var result={command:"null",keyChain:keyChain};if(count!==undefined)result.count=count;return result;}if(!command)return undefined;var result=_typeof2(command)==="object"?Object.assign({},command):{command:command};if(count!==undefined)result.count=count;return result;}},{key:"bindKey",value:function KeyHandler_bindKey_(keyCombo,command){var _this64=this;if(_typeof2(keyCombo)==="object"&&keyCombo&&!Array.isArray(keyCombo)){keyCombo=__varRecorder__$p.findKeysForPlatform(keyCombo,this.platform);}if(!keyCombo)return;if(typeof command==="function"){return this.addCommand({exec:command,bindKey:keyCombo,name:command.name||keyCombo});}var allCombos=Array.isArray(keyCombo)?keyCombo:keyCombo.includes("|")?keyCombo.split("|"):[keyCombo];allCombos.forEach(function(keyPart){var chain="";if(keyPart.indexOf(" ")!=-1){var parts=keyPart.split(/\s+/);keyPart=parts.pop();parts.forEach(function(keyPart){var binding=__varRecorder__$p.Keys.canonicalizeKeyCombo(keyPart);chain+=(chain?" ":"")+binding;_this64.addCommandToBinding(chain,"chainKeys");});chain+=" ";}_this64.addCommandToBinding(chain+__varRecorder__$p.Keys.canonicalizeKeyCombo(keyPart),command);});this.cleanupUnusedKeyChains();}},{key:"unbindKey",value:function KeyHandler_unbindKey_(keyCombo){this.bindKey(keyCombo,null);}},{key:"cleanupUnusedKeyChains",value:function KeyHandler_cleanupUnusedKeyChains_(){var _this65=this;var keys=Object.keys(this.keyBindings);var chainedKeys=keys.filter(function(key){return _this65.keyBindings[key]==="chainKeys";});chainedKeys=__varRecorder__$p.arr.sortBy(chainedKeys,function(ea){return ea.length;}).reverse();chainedKeys.forEach(function(key){if(keys.some(function(other){return key!==other&&other.startsWith(key);}))return;delete _this65.keyBindings[key];__varRecorder__$p.arr.remove(keys,key);__varRecorder__$p.arr.remove(chainedKeys,key);});}},{key:"addCommand",value:function KeyHandler_addCommand_(command){return!command||!command.bindKey?undefined:this.addCommandToBinding(command.bindKey,command);}},{key:"addCommandToBinding",value:function KeyHandler_addCommandToBinding_(keyCombo,command){var _this66=this;var prev=this.keyBindings[keyCombo];if(prev==="chainKeys"&&command!="chainKeys"){Object.keys(this.keyBindings).forEach(function(key){if(key.startsWith(keyCombo)){delete _this66.keyBindings[key];}});}if(!command)delete this.keyBindings[keyCombo];else this.keyBindings[keyCombo]=command;if(command!=="chainKeys")this.cleanupUnusedKeyChains();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"KeyHandler";}},{key:"invokeKeyHandlers",value:function KeyHandler_invokeKeyHandlers_(morph,evt){var noInputEvents=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return __varRecorder__$p.invokeKeyHandlers(morph,evt,noInputEvents);}},{key:"simulateKeys",value:function KeyHandler_simulateKeys_(morph,keyCombo,keyInputState){return __varRecorder__$p.simulateKeys(morph,keyCombo,keyInputState);}},{key:"withBindings",value:function KeyHandler_withBindings_(listOfBindings,platform){var handler=new this(platform);listOfBindings.forEach(function(_ref38){var command=_ref38.command,keys=_ref38.keys;return handler.bindKey(keys,command);});return handler;}},{key:"prettyCombo",value:function KeyHandler_prettyCombo_(combo){var map=this._prettyCombos||(this._prettyCombos={});if(this._prettyCombos[combo])return map[combo];return map[combo]=combo.replace(__varRecorder__$p.regexps.meta,"\u2318").replace(__varRecorder__$p.regexps.alt,"\u2325").replace(__varRecorder__$p.regexps.ctrl,"\u2303").replace(__varRecorder__$p.regexps.tab,"\u21E5").replace(__varRecorder__$p.regexps.enter,"\u23CE").replace(__varRecorder__$p.regexps.shift,"\u21E7").replace(__varRecorder__$p.regexps.backspace,"\u232B").replace(__varRecorder__$p.regexps["delete"],"\u2326").replace(__varRecorder__$p.regexps.left,"\u2192").replace(__varRecorder__$p.regexps.right,"\u2190").replace(__varRecorder__$p.regexps.up,"\u2191").replace(__varRecorder__$p.regexps.down,"\u2193").replace(__varRecorder__$p.regexps.keySpacer,"$1").replace(__varRecorder__$p.regexps.seqSpacer,"$1-");}},{key:"generateCommandToKeybindingMap",value:function KeyHandler_generateCommandToKeybindingMap_(morph){var _this67=this;var includeOwnerCommands=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var prettyKeys=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var keyMaps={};var commandsToKeys={};var commands=includeOwnerCommands?morph.commandsIncludingOwners:morph.commands.map(function(command){return{command:command,target:morph};});return commands.map(function(_ref39){var target=_ref39.target,command=_ref39.command;var keys=commandsToKeysFor(target)[command.name];return{keys:keys,target:target,command:command,prettyKeys:keys&&prettyKeys?keys.map(function(ea){return _this67.prettyCombo(ea);}):null};});function commandsToKeysFor(target){if(commandsToKeys[target.id])return commandsToKeys[target.id];var keyMap=keyMaps[target.id]||(keyMaps[target.id]=target.keyCommandMap);return commandsToKeys[target.id]=__varRecorder__$p.arr.groupBy(Object.keys(keyMap),function(combo){return keyMap[combo].name;});}}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"events/KeyHandler.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:6052,end:12969});}(undefined);KeyHandler=__varRecorder__$p.KeyHandler;var KeyHandler$1=KeyHandler;__varRecorder__$p["default"]=KeyHandler;var __varRecorder__$q=lively.FreezerRuntime.recorderFor("lively.morphic/ticking.js");var Script=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/ticking.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Script")&&typeof __lively_classholder__.Script==="function"?__lively_classholder__.Script:__lively_classholder__.Script=function Script(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Script_initialize_(){this.suspended=false;this.stopped=true;this.tickTime=null;this.type=null;this.currentTimeout=null;}},{key:"__additionally_serialize__",value:function Script___additionally_serialize___(snapshot,ref,snapshotFn){snapshot.props.suspended.value=true;}},{key:"isScript",get:function get(){return true;}},{key:"global",get:function get(){return System.global;}},{key:"execute",value:function Script_execute_(){throw new Error("subclass responsibility");}},{key:"tick",value:function Script_tick_(){try{this.execute();}catch(e){console.error("Error executing script "+this+": "+e+"\n"+e.stack);return;}if(!this.stopped)this.startTicking(this.tickTime);}},{key:"startTicking",value:function Script_startTicking_(ms){this.stopped=false;this.tickTime=ms;this.type=typeof ms==="number"?"setTimeout":"requestAnimationFrame";this.currentTimeout=this.type==="setTimeout"?this.global.setTimeout(this.tick.bind(this),ms):this.global.requestAnimationFrame(this.tick.bind(this));}},{key:"stop",value:function Script_stop_(){var sel=this.type==="setTimeout"?"clearTimeout":"cancelAnimationFrame";this.global[sel](this.currentTimeout);this.stopped=true;}},{key:"resume",value:function Script_resume_(){var ms=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.tickTime;if(!this.suspended)return;this.suspended=false;this.startTicking(this.tickTime=ms);}},{key:"suspend",value:function Script_suspend_(){this.stop();this.suspended=true;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Script";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"ticking.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:21,end:1376});}(undefined);var TargetScript=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/ticking.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TargetScript")&&typeof __lively_classholder__.TargetScript==="function"?__lively_classholder__.TargetScript:__lively_classholder__.TargetScript=function TargetScript(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function TargetScript_initialize_(target,selector,args){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this);this.target=target;this.selector=selector;this.args=args||[];}},{key:"execute",value:function TargetScript_execute_(){if(this.target.isMorph&&!this.target.tickingScripts.includes(this))this.stop();typeof this.target[this.selector]==="function"&&this.target[this.selector].apply(this.target,this.args);}},{key:"equals",value:function TargetScript_equals_(other){return other.isScript&&this.target==other.target&&this.selector==other.selector;}},{key:"toString",value:function TargetScript_toString_(){return"Script(".concat(this.target,">>").concat(this.selector,"(").concat(this.args.join(","),"))");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TargetScript";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"ticking.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1378,end:2013});}(__varRecorder__$q.Script);var FunctionScript=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/ticking.js");var __lively_class__=__lively_classholder__.hasOwnProperty("FunctionScript")&&typeof __lively_classholder__.FunctionScript==="function"?__lively_classholder__.FunctionScript:__lively_classholder__.FunctionScript=function FunctionScript(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function FunctionScript_initialize_(callback){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this);this.callback=callback;}},{key:"execute",value:function FunctionScript_execute_(){this.callback();}},{key:"equals",value:function FunctionScript_equals_(other){return other.isScript&&this.callback==other.callback;}},{key:"toString",value:function FunctionScript_toString_(){return"Script(".concat(this.callback.toString().replace(/\n/g,"").slice(0,40)+"...",")");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"FunctionScript";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"ticking.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:2015,end:2354});}(__varRecorder__$q.Script);__varRecorder__$q.Script=Script;__varRecorder__$q.Script=Script;__varRecorder__$q.TargetScript=TargetScript;__varRecorder__$q.TargetScript=TargetScript;__varRecorder__$q.FunctionScript=FunctionScript;__varRecorder__$q.FunctionScript=FunctionScript;var __varRecorder__$r=lively.FreezerRuntime.recorderFor("lively.morphic/object-migration.js");function isReference$1(value){return value&&value.__ref__;}__varRecorder__$r.isReference=isReference$1;__varRecorder__$r.removeUnreachableObjects=removeUnreachableObjects;__varRecorder__$r.obj=obj;__varRecorder__$r.Path=Path;__varRecorder__$r.connect=connect;__varRecorder__$r.disconnectAll=disconnectAll;__varRecorder__$r.isReference=isReference$1;__varRecorder__$r.isReference=isReference$1;var migrations=[{date:"2017-04-08",name:"Text and Label textAndAttributes format change",description:"\nChanging the format from\n  [[string1, attr1_1, attr1_2], [string2, attr2_1, attr2_2], ...]\nto\n  [string1, attr1, string2, attr2, ...].\n    ",snapshotConverter:function snapshotConverter(idAndSnapshot){var snapshot=idAndSnapshot.snapshot;for(var key in snapshot){var serialized=snapshot[key];var textAndAttributes=serialized.props&&serialized.props.textAndAttributes;if(!textAndAttributes)continue;var value=textAndAttributes.value;if(!Array.isArray(value)){console.warn("object migrator found textAndAttributes field but it is not an Array!");continue;}if(!value.length||typeof value[0]==="string")continue;value=[].concat.apply([],value);for(var _i92=0;_i92<value.length;_i92+=2){var text=value[_i92];var attr=value[_i92+1];if(attr&&Array.isArray(attr)){value[_i92+1]=Object.assign.apply(Object,[{}].concat(_toConsumableArray2(attr)));}}serialized.props.textAndAttributes=Object.assign({},textAndAttributes,{value:value});}return idAndSnapshot;}},{date:"2017-04-29",name:"Window button fix",description:"\nA recent change in the structure of windows, that now adds a \"button wrapper\"\nmorph breaks old windows without it.\n",objectConverter:function objectConverter(idAndSnapshot,pool){var snapshot=idAndSnapshot.snapshot,id=idAndSnapshot.id;var rootMorph=pool.refForId(id).realObj;if(rootMorph&&rootMorph.isMorph){rootMorph.withAllSubmorphsDo(function(win){if(!win.isWindow)return;if(!win.submorphs.some(function(m){return m.name==="button wrapper";})||!win.get("button wrapper").submorphs.some(function(m){return m.name==="window menu button";}));win.minimizedBounds=null;__varRecorder__$r.disconnectAll(win.get("minimize"));__varRecorder__$r.connect(win.get("minimize"),"onMouseDown",win,"minimized",{updater:function updater($upd){$upd(!this.targetObj.minimized);}});});}return idAndSnapshot;}},{date:"2017-05-03",name:"Style Sheet Status Fix",description:"\nState management of the style sheets has changes substantially, moving all of the style sheets that are being applied to the world.\n",snapshotConverter:function snapshotConverter(idAndSnapshot){var rootId=idAndSnapshot.id,snapshot=idAndSnapshot.snapshot;for(var id in snapshot){var props=snapshot[id].props;if(!props||!props.styleSheets)continue;if(!props.styleSheets.value)props.styleSheets.value=[];props.styleSheets.value=props.styleSheets.value&&props.styleSheets.value.filter(function(ea){var styleSheet=snapshot[ea.id];var rules=styleSheet.props.rules;var rulesObj=snapshot[rules.value.id];return!styleSheet.props.styledMorphs&&!("lively.serializer-class-info"in rulesObj);});}__varRecorder__$r.removeUnreachableObjects([rootId],snapshot);return idAndSnapshot;}},{date:"2017-05-22",name:"Removal of ChromeTheme and GithubTheme",description:"\nFor now only a simple default theme...\n",snapshotConverter:function snapshotConverter(idAndSnapshot){var snapshot=idAndSnapshot.snapshot;for(var key in snapshot){var serialized=snapshot[key];var klass=serialized["lively.serializer-class-info"];if(!klass)continue;if(klass.className==="ChromeTheme"||klass.className==="GithubTheme"){klass.className="DefaultTheme";klass.module.pathInPackage="ide/themes/default.js";}else if(klass.className==="JavaScriptTokenizer"){delete serialized["lively.serializer-class-info"];}}return idAndSnapshot;}},{date:"2017-06-20",name:"Unwrapped Style Sheet Props",description:"Style Sheets now store foldable props in their nested format.",objectConverter:function objectConverter(idAndSnapshot,pool){var id=idAndSnapshot.id,snapshot=idAndSnapshot.snapshot;var rootMorph=pool.refForId(id).realObj;if(rootMorph&&rootMorph.isMorph){rootMorph.withAllSubmorphsDo(function(m){if(m.styleSheets&&m.styleSheets.length>0){m.styleSheets.forEach(function(ss){for(var rule in __varRecorder__$r.obj.dissoc(ss.rules,["_rev"])){ss.rules[rule]=ss.unwrapFoldedProps(ss.rules[rule]);}});}});}return idAndSnapshot;}},{date:"2017-07-13",name:"Renamed style-rules.js to style-sheets.js",snapshotConverter:function snapshotConverter(idAndSnapshot){var snapshot=idAndSnapshot.snapshot;for(var key in snapshot){var serialized=snapshot[key];var klass=serialized["lively.serializer-class-info"];if(!klass)continue;if(klass.className==="StyleSheet"){klass.module.pathInPackage="style-sheets.js";}}return idAndSnapshot;}},{date:"2017-07-26",name:"components, ide, and halo extraction",snapshotConverter:function snapshotConverter(idAndSnapshot){var snapshot=idAndSnapshot.snapshot,packages=idAndSnapshot.packages;var modules=packages&&packages["local://lively-object-modules/"]||{};var nameToPackages=[["lively.morphic/halo","lively.halos"],["lively.morphic/components/markers.js","lively.halos"],["lively.morphic/components/icons.js","lively.morphic"],["lively.morphic/components/loading-indicator.js","lively.components",function(imports){return"{".concat(imports,"}");}],["lively.morphic/components","lively.components"],["lively.components/markers.js","lively.halos"],["lively.morphic/ide","lively.ide"],["lively.morphic/text/ui.js","lively.ide",null,"text/ui.js"]];for(var mod in modules){var moduleSource=modules[mod]["index.js"];var _iterator35=_createForOfIteratorHelper(nameToPackages),_step35;try{for(_iterator35.s();!(_step35=_iterator35.n()).done;){var _step35$value=_slicedToArray2(_step35.value,3),prefix=_step35$value[0],replacement=_step35$value[1],importTfm=_step35$value[2];if(importTfm){var importMatcher=new RegExp("(import\\s)(.*)(\\sfrom \\\""+prefix+")","g");var match=importMatcher.exec(moduleSource);if(match){moduleSource=moduleSource.replace(importMatcher,"import "+importTfm(match[2])+"from \""+replacement);}}else{var re=new RegExp(prefix,"g");moduleSource=moduleSource.replace(re,replacement);}}}catch(err){_iterator35.e(err);}finally{_iterator35.f();}modules[mod]["index.js"]=moduleSource;}for(var key in snapshot){var serialized=snapshot[key];var klass=serialized["lively.serializer-class-info"];if(!klass||!klass.module)continue;var _p11=klass.module["package"].name+"/"+klass.module.pathInPackage;var _iterator36=_createForOfIteratorHelper(nameToPackages),_step36;try{for(_iterator36.s();!(_step36=_iterator36.n()).done;){var _step36$value=_slicedToArray2(_step36.value,4),_prefix=_step36$value[0],_replacement=_step36$value[1],tfm=_step36$value[2],pathInPackage=_step36$value[3];if(_p11.includes(_prefix)){klass.module["package"].name=_replacement;klass.module["package"].version="0.1.0";klass.module.pathInPackage=pathInPackage||_p11.substring(_p11.indexOf(_prefix)+_prefix.length+1)||"index.js";break;}}}catch(err){_iterator36.e(err);}finally{_iterator36.f();}}return idAndSnapshot;}},{date:"2017-10-16",name:"change scroll implementation of list items",objectConverter:function objectConverter(idAndSnapshot,pool){var _iterator37=_createForOfIteratorHelper(pool.objectRefs()),_step37;try{for(_iterator37.s();!(_step37=_iterator37.n()).done;){var ref=_step37.value;var realObj=ref.realObj;if(!realObj.isList||typeof realObj.initializeSubmorphs!=="function"){continue;}realObj.initializeSubmorphs();}}catch(err){_iterator37.e(err);}finally{_iterator37.f();}return idAndSnapshot;}},{date:"2017-10-30",name:"change implementation of tree",snapshotConverter:function snapshotConverter(idAndSnapshot){var snapshot=idAndSnapshot.snapshot;for(var key in snapshot){var serialized=snapshot[key];var klass=serialized["lively.serializer-class-info"];if(!klass||!klass.module)continue;if(klass.className=="Tree"&&serialized.props.submorphs){serialized.props.submorphs.value=[];}if(klass.className=="TreeNode")delete snapshot[key];if(klass.className=="InspectorTreeData"){delete snapshot[key];}if(["PropertyNode","InspectionNode","MorphNode","FoldedNode"].includes(klass.className)){klass.module.pathInPackage="js/inspector/context.js";}if(serialized.props.name=="nodeItemContainer")delete snapshot[key];}return idAndSnapshot;}},{date:"2019-02-17",name:"change storage of commit metadata",snapshotConverter:function snapshotConverter(idAndSnapshot){var rootId=idAndSnapshot.id,snapshot=idAndSnapshot.snapshot;Object.values(snapshot).map(function(m){if(m.props.metadata&&__varRecorder__$r.isReference(m.props.metadata.value)){var metaObj=snapshot[m.props.metadata.value.id];if(metaObj.props.commit&&__varRecorder__$r.isReference(metaObj.props.commit.value)){var _snapshot$metaObj$pro=snapshot[metaObj.props.commit.value.id].props,type=_snapshot$metaObj$pro.type,name=_snapshot$metaObj$pro.name,_id=_snapshot$metaObj$pro._id;metaObj.props.commit.value="__lv_expr__:({type: \"".concat(type.value,"\", name: \"").concat(name.value,"\", _id: \"").concat(_id.value,"\"})");}}});__varRecorder__$r.removeUnreachableObjects([rootId],snapshot);return idAndSnapshot;}},{date:"2019-07-25",name:"world superclass extraction",snapshotConverter:function snapshotConverter(idAndSnapshot){var packages=idAndSnapshot.packages;var indexjs;var pathToIndex=__varRecorder__$r.Path(["local://lively-object-modules/","EmptyWorld","index.js"]);if(indexjs=pathToIndex.get(packages)){indexjs=indexjs.replace("import { World, morph } from \"lively.morphic\";","import { morph } from \"lively.morphic\";\nimport { LivelyWorld as World } from \"lively.ide/world.js\"").replace("import { World } from \"lively.morphic\";","import { LivelyWorld as World } from \"lively.ide/world.js\"");pathToIndex.set(packages,indexjs);}return idAndSnapshot;}},{date:"2019-08-05",name:"remove Camphor from system",snapshotConverter:function snapshotConverter(idAndSnapshot){var rootId=idAndSnapshot.id,snapshot=idAndSnapshot.snapshot;Object.values(snapshot).map(function(m){if(m.props.fontFamily&&m.props.fontFamily.value=="Camphor"){m.props.fontFamily.value="Nunito";}});return idAndSnapshot;}},{date:"2020-10-09",name:"remove style guide",snapshotConverter:function snapshotConverter(idAndSnapshot){var rootId=idAndSnapshot.id,snapshot=idAndSnapshot.snapshot;Object.values(snapshot).map(function(m){if(m.props.master&&typeof m.props.master.value==="string"){m.props.master.value=m.props.master.value.split("styleguide://style guide").join("styleguide://System");}});return idAndSnapshot;}}];__varRecorder__$r.migrations=migrations;__varRecorder__$r.migrations=migrations;__varRecorder__$r.migrations=migrations;var __varRecorder__$s=lively.FreezerRuntime.recorderFor("lively.morphic/serialization.js");function normalizeOptions$1(options){options=Object.assign({reinitializeIds:false},options);if(options.reinitializeIds){options.reinitializeIds=typeof options.reinitializeIds==="function"?options.reinitializeIds:function(id,ref){return ref.realObj.isMorph?__varRecorder__$s.newMorphId(ref.realObj.constructor):null;};}return options;}__varRecorder__$s.normalizeOptions=normalizeOptions$1;function serializeMorph(m,options){return __varRecorder__$s.serialize(m,__varRecorder__$s.normalizeOptions(options));}__varRecorder__$s.serializeMorph=serializeMorph;function deserializeMorph(idAndSnapshot){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return __varRecorder__$s.deserializeWithMigrations(idAndSnapshot,options.migrations||__varRecorder__$s.migrations,__varRecorder__$s.normalizeOptions(options));}__varRecorder__$s.deserializeMorph=deserializeMorph;function loadWorldFromResource(_x37){return _loadWorldFromResource.apply(this,arguments);}function _loadWorldFromResource(){_loadWorldFromResource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee207(fromResource){return regeneratorRuntime.wrap(function _callee207$(_context207){while(1){switch(_context207.prev=_context207.next){case 0:_context207.t0=__varRecorder__$s;_context207.next=3;return fromResource.readJson();case 3:_context207.t1=_context207.sent;return _context207.abrupt("return",_context207.t0.loadMorphFromSnapshot.call(_context207.t0,_context207.t1));case 5:case"end":return _context207.stop();}}},_callee207);}));return _loadWorldFromResource.apply(this,arguments);}__varRecorder__$s.loadWorldFromResource=loadWorldFromResource;function saveWorldToResource(){return _saveWorldToResource.apply(this,arguments);}function _saveWorldToResource(){_saveWorldToResource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee208(){var world,toResource,options,_ref153,_ref153$prettyPrint,prettyPrint,_ref153$showIndicator,showIndicator,_ref153$changeName,changeName,_ref153$changeBrowser,changeBrowserURL,htmlResource,name,histPath,i,_yield$System$import12,LoadingIndicator,snap,_args209=arguments;return regeneratorRuntime.wrap(function _callee208$(_context208){while(1){switch(_context208.prev=_context208.next){case 0:world=_args209.length>0&&_args209[0]!==undefined?_args209[0]:__varRecorder__$s.MorphicEnv["default"]().world;toResource=_args209.length>1?_args209[1]:undefined;options=_args209.length>2?_args209[2]:undefined;_ref153=options||{},_ref153$prettyPrint=_ref153.prettyPrint,prettyPrint=_ref153$prettyPrint===void 0?true:_ref153$prettyPrint,_ref153$showIndicator=_ref153.showIndicator,showIndicator=_ref153$showIndicator===void 0?true:_ref153$showIndicator,_ref153$changeName=_ref153.changeName,changeName=_ref153$changeName===void 0?true:_ref153$changeName,_ref153$changeBrowser=_ref153.changeBrowserURL,changeBrowserURL=_ref153$changeBrowser===void 0?true:_ref153$changeBrowser;if(!toResource){htmlResource=__varRecorder__$s.resource(document.location.href);name=htmlResource.name();toResource=htmlResource.join("../"+name.replace(/\.[^\.]+/,"-world.json")).withRelativePartsResolved();}if(typeof toResource==="string"){toResource=__varRecorder__$s.resource(toResource);}if(changeName){world.name=toResource.nameWithoutExt();}if(changeBrowserURL){histPath=encodeURI(options.pathForBrowserHistory||__varRecorder__$s.pathForBrowserHistory(toResource.path()));if(window.location.pathname!==histPath){window.history.pushState({},"lively.next",histPath);}}if(!showIndicator){_context208.next=18;break;}_context208.next=11;return System["import"]("lively.components/loading-indicator.js");case 11:_yield$System$import12=_context208.sent;LoadingIndicator=_yield$System$import12.LoadingIndicator;i=LoadingIndicator.open(typeof showIndicator==="string"?showIndicator:"Snapshotting...");_context208.next=16;return i.whenRendered();case 16:_context208.next=18;return __varRecorder__$s.promise.delay(100);case 18:_context208.prev=18;_context208.next=21;return __varRecorder__$s.createMorphSnapshot(world,options);case 21:snap=_context208.sent;i.label="Uploading...";_context208.next=25;return i.whenRendered();case 25:return _context208.abrupt("return",toResource.writeJson(snap));case 26:_context208.prev=26;i&&i.remove();return _context208.finish(26);case 29:case"end":return _context208.stop();}}},_callee208,null,[[18,,26,29]]);}));return _saveWorldToResource.apply(this,arguments);}__varRecorder__$s.saveWorldToResource=saveWorldToResource;function copyMorph(morph){return __varRecorder__$s.deserializeMorph(__varRecorder__$s.serializeMorph(morph),{migrations:migrations,reinitializeIds:true});}__varRecorder__$s.copyMorph=copyMorph;function createMorphSnapshot(_x38){return _createMorphSnapshot.apply(this,arguments);}function _createMorphSnapshot(){_createMorphSnapshot=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee209(aMorph){var options,isNode,_options$addPreview,addPreview,_options$previewWidth,previewWidth,_options$previewHeigh,previewHeight,_options$previewType,previewType,_options$testLoad,testLoad,_options$addPackages,addPackages,_options$ignoreMorphs,ignoreMorphs,_options$frozenSnapsh,frozenSnapshot,snapshot,_yield$__varRecorder_4,packages,depMap,_yield$System$import13,renderMorphToDataURI,width,height,type,_testLoad,_args210=arguments;return regeneratorRuntime.wrap(function _callee209$(_context209){while(1){switch(_context209.prev=_context209.next){case 0:options=_args210.length>1&&_args210[1]!==undefined?_args210[1]:{};isNode=System.get("@system-env").node;_options$addPreview=options.addPreview,addPreview=_options$addPreview===void 0?false:_options$addPreview,_options$previewWidth=options.previewWidth,previewWidth=_options$previewWidth===void 0?100:_options$previewWidth,_options$previewHeigh=options.previewHeight,previewHeight=_options$previewHeigh===void 0?100:_options$previewHeigh,_options$previewType=options.previewType,previewType=_options$previewType===void 0?"png":_options$previewType,_options$testLoad=options.testLoad,testLoad=_options$testLoad===void 0?true:_options$testLoad,_options$addPackages=options.addPackages,addPackages=_options$addPackages===void 0?true:_options$addPackages,_options$ignoreMorphs=options.ignoreMorphs,ignoreMorphs=_options$ignoreMorphs===void 0?[]:_options$ignoreMorphs,_options$frozenSnapsh=options.frozenSnapshot,frozenSnapshot=_options$frozenSnapsh===void 0?false:_options$frozenSnapsh;snapshot=__varRecorder__$s.serializeMorph(aMorph,{frozenSnapshot:frozenSnapshot});if(!addPackages){_context209.next=12;break;}_context209.next=7;return __varRecorder__$s.findRequiredPackagesOfSnapshot(snapshot);case 7:_yield$__varRecorder_4=_context209.sent;packages=_yield$__varRecorder_4.packages;depMap=_yield$__varRecorder_4.depMap;snapshot.packages=packages;snapshot.packageDepMap=depMap;case 12:if(!addPreview){_context209.next=32;break;}_context209.next=15;return System["import"]("lively.morphic/rendering/morph-to-image.js");case 15:_yield$System$import13=_context209.sent;renderMorphToDataURI=_yield$System$import13.renderMorphToDataURI;width=previewWidth||aMorph.width;height=previewHeight||aMorph.height;type=previewType||"png";_context209.prev=20;_context209.next=23;return renderMorphToDataURI(aMorph,{width:width,height:height,type:type,ignoreMorphs:[]});case 23:snapshot.preview=_context209.sent;_context209.next=32;break;case 26:_context209.prev=26;_context209.t0=_context209["catch"](20);console.error("Error generating morph preview: ".concat(_context209.t0));_context209.next=31;return renderMorphToDataURI(__varRecorder__$s.morph({fill:aMorph.fill,width:width,height:height}),{width:width,height:height,type:type,ignoreMorphs:ignoreMorphs});case 31:snapshot.preview=_context209.sent;case 32:if(!snapshot.preview)snapshot.preview="";if(!testLoad){_context209.next=45;break;}_context209.prev=34;_context209.next=37;return __varRecorder__$s.loadMorphFromSnapshot(snapshot,{highlightBuggyMorphs:true,rootObject:aMorph});case 37:_testLoad=_context209.sent;if(!(!_testLoad||!_testLoad.isMorph)){_context209.next=40;break;}throw new Error("reloading snapshot does not create a morph!");case 40:_context209.next=45;break;case 42:_context209.prev=42;_context209.t1=_context209["catch"](34);throw new Error("Error snapshotting morph: Cannot recreate morph from snapshot!\n"+_context209.t1.stack);case 45:return _context209.abrupt("return",snapshot);case 46:case"end":return _context209.stop();}}},_callee209,null,[[20,26],[34,42]]);}));return _createMorphSnapshot.apply(this,arguments);}__varRecorder__$s.createMorphSnapshot=createMorphSnapshot;function loadMorphFromSnapshot(snapshot,options){return __varRecorder__$s.deserializeMorph(snapshot,Object.assign({reinitializeIds:true,ignoreClassNotFound:false,onDeserializationStart:__varRecorder__$s.loadPackagesAndModulesOfSnapshot,migrations:migrations},options));}__varRecorder__$s.loadMorphFromSnapshot=loadMorphFromSnapshot;function resourceToJSON(_x39,_x40){return _resourceToJSON.apply(this,arguments);}function _resourceToJSON(){_resourceToJSON=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee210(currentResource,base){var subBase,files,_iterator100,_step100,_f4;return regeneratorRuntime.wrap(function _callee210$(_context210){while(1){switch(_context210.prev=_context210.next){case 0:if(currentResource.isDirectory()){_context210.next=7;break;}_context210.next=3;return currentResource.read();case 3:base[currentResource.name()]=_context210.sent;return _context210.abrupt("return",base);case 7:subBase=base[currentResource.name()]={};_context210.next=10;return currentResource.dirList();case 10:files=_context210.sent;_iterator100=_createForOfIteratorHelper(files);_context210.prev=12;_iterator100.s();case 14:if((_step100=_iterator100.n()).done){_context210.next=20;break;}_f4=_step100.value;_context210.next=18;return resourceToJSON(_f4,subBase);case 18:_context210.next=14;break;case 20:_context210.next=25;break;case 22:_context210.prev=22;_context210.t0=_context210["catch"](12);_iterator100.e(_context210.t0);case 25:_context210.prev=25;_iterator100.f();return _context210.finish(25);case 28:return _context210.abrupt("return",base);case 29:case"end":return _context210.stop();}}},_callee210,null,[[12,22,25,28]]);}));return _resourceToJSON.apply(this,arguments);}__varRecorder__$s.resourceToJSON=resourceToJSON;function findPackagesInFileSpec(files){var path=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var result=[];if(files.hasOwnProperty("package.json")){var url=path.slice(1).reduceRight(function(r,name){return r.join(name);},__varRecorder__$s.resource(path[0])).url;result.push({files:files,url:url,requiredPackages:files.requiredPackages});}for(var name in files){if(_typeof2(files[name])!=="object")continue;result.push.apply(result,_toConsumableArray2(findPackagesInFileSpec(files[name],path.concat(name))));}return result;}__varRecorder__$s.findPackagesInFileSpec=findPackagesInFileSpec;function packagesOfSnapshot(snapshot){var packages=__varRecorder__$s.findPackagesInFileSpec(snapshot.packages);var packageMap={};var depMap=snapshot.packageDepMap;if(!depMap)return packages;var _iterator38=_createForOfIteratorHelper(packages),_step38;try{for(_iterator38.s();!(_step38=_iterator38.n()).done;){var _p12=_step38.value;packageMap[_p12.url]=_p12;}}catch(err){_iterator38.e(err);}finally{_iterator38.f();}return __varRecorder__$s.arr.flatten(__varRecorder__$s.graph.sortByReference(depMap)).map(function(url){return packageMap[url];});}__varRecorder__$s.packagesOfSnapshot=packagesOfSnapshot;function loadPackagesAndModulesOfSnapshot(_x41){return _loadPackagesAndModulesOfSnapshot.apply(this,arguments);}function _loadPackagesAndModulesOfSnapshot(){_loadPackagesAndModulesOfSnapshot=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee211(snapshot){var _iterator101,_step101,pName,packages,_iterator102,_step102,_step102$value,files,url,packageLookup,_p21,loadedVersion,_JSON$parse,versionInSpec,_r9,_yield$System$import14,ObjectPackage;return regeneratorRuntime.wrap(function _callee211$(_context211){while(1){switch(_context211.prev=_context211.next){case 0:if(!snapshot.packagesToRegister){_context211.next=24;break;}_iterator101=_createForOfIteratorHelper(snapshot.packagesToRegister);_context211.prev=2;_iterator101.s();case 4:if((_step101=_iterator101.n()).done){_context211.next=16;break;}pName=_step101.value;_context211.prev=6;_context211.next=9;return __varRecorder__$s.registerPackage(pName);case 9:_context211.next=14;break;case 11:_context211.prev=11;_context211.t0=_context211["catch"](6);console.error("Failed to register package ".concat(pName));case 14:_context211.next=4;break;case 16:_context211.next=21;break;case 18:_context211.prev=18;_context211.t1=_context211["catch"](2);_iterator101.e(_context211.t1);case 21:_context211.prev=21;_iterator101.f();return _context211.finish(21);case 24:if(!snapshot.packages){_context211.next=69;break;}packages=__varRecorder__$s.packagesOfSnapshot(snapshot);_iterator102=_createForOfIteratorHelper(packages);_context211.prev=27;_iterator102.s();case 29:if((_step102=_iterator102.n()).done){_context211.next=61;break;}_step102$value=_step102.value,files=_step102$value.files,url=_step102$value.url;packageLookup=__varRecorder__$s.lookupPackage(url);_p21=packageLookup&&packageLookup.pkg;if(!_p21){_context211.next=45;break;}loadedVersion=_p21.version;_JSON$parse=JSON.parse(files["package.json"]),versionInSpec=_JSON$parse.version;_context211.prev=36;if(!(versionInSpec&&loadedVersion&&__varRecorder__$s.semver.lte(versionInSpec,loadedVersion,true))){_context211.next=40;break;}console.log("[load morph] Package ".concat(url," is loaded in version ").concat(loadedVersion)+" which is newer than ".concat(versionInSpec,". Will NOT load older variant."));return _context211.abrupt("continue",59);case 40:_context211.next=45;break;case 42:_context211.prev=42;_context211.t2=_context211["catch"](36);console.warn("Error in package version comparison: ",_context211.t2);case 45:_context211.next=47;return __varRecorder__$s.createFiles(url,files);case 47:_r9=_context211.sent;_context211.next=50;return __varRecorder__$s.ensurePackage(url);case 50:_p21=_context211.sent;_context211.next=53;return _p21.reload({forgetEnv:false,forgetDeps:false});case 53:_context211.next=55;return System["import"]("lively.classes/object-classes.js");case 55:_yield$System$import14=_context211.sent;ObjectPackage=_yield$System$import14["default"];__varRecorder__$s.objectScriptingEnabled=!!ObjectPackage;__varRecorder__$s.objectScriptingEnabled&&ObjectPackage.withId(_p21.name);case 59:_context211.next=29;break;case 61:_context211.next=66;break;case 63:_context211.prev=63;_context211.t3=_context211["catch"](27);_iterator102.e(_context211.t3);case 66:_context211.prev=66;_iterator102.f();return _context211.finish(66);case 69:_context211.next=71;return Promise.all(__varRecorder__$s.requiredModulesOfSnapshot(snapshot).map(function(modId){return(System.get(modId)?null:System["import"](modId))["catch"](function(e){return console.error("Error loading ".concat(modId),e);});}));case 71:case"end":return _context211.stop();}}},_callee211,null,[[2,18,21,24],[6,11],[27,63,66,69],[36,42]]);}));return _loadPackagesAndModulesOfSnapshot.apply(this,arguments);}__varRecorder__$s.loadPackagesAndModulesOfSnapshot=loadPackagesAndModulesOfSnapshot;function findRequiredPackagesOfSnapshot(_x42){return _findRequiredPackagesOfSnapshot.apply(this,arguments);}function _findRequiredPackagesOfSnapshot(){_findRequiredPackagesOfSnapshot=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee214(snapshot){var packages,objects,packagesToSave,externalPackageMap,externalPackagesFound,depMap,id,classInfo,_p22,metadata,externalPackages,prop,i,objectPackagesReferenced,_i194,_packagesToSave,pkg,_iterator103,_step103,mod,_iterator104,_step104,fromModule,requiredPackage,_config;return regeneratorRuntime.wrap(function _callee214$(_context214){while(1){switch(_context214.prev=_context214.next){case 0:packages={};objects=snapshot.snapshot;packagesToSave=[];externalPackageMap={};externalPackagesFound=true;depMap={};_context214.t0=regeneratorRuntime.keys(objects);case 7:if((_context214.t1=_context214.t0()).done){_context214.next=18;break;}id=_context214.t1.value;classInfo=objects[id]["lively.serializer-class-info"];if(!(classInfo&&classInfo.module&&classInfo.module["package"])){_context214.next=14;break;}_p22=__varRecorder__$s.getPackage(classInfo.module["package"].name);if(!_p22.address.startsWith("local://")){_context214.next=14;break;}return _context214.delegateYield(/*#__PURE__*/regeneratorRuntime.mark(function _callee212(){var _yield$System$import15,ObjectPackage,_yield$System$import16,withSuperclasses,objPkg,objClass,classes;return regeneratorRuntime.wrap(function _callee212$(_context212){while(1){switch(_context212.prev=_context212.next){case 0:_context212.next=2;return System["import"]("lively.classes/object-classes.js");case 2:_yield$System$import15=_context212.sent;ObjectPackage=_yield$System$import15["default"];_context212.next=6;return System["import"]("lively.classes/util.js");case 6:_yield$System$import16=_context212.sent;withSuperclasses=_yield$System$import16.withSuperclasses;__varRecorder__$s.objectScriptingEnabled=!!ObjectPackage;objPkg=ObjectPackage.forSystemPackage(_p22);objClass=objPkg.objectModule.systemModule._recorder[classInfo.className];classes=withSuperclasses(objClass);classes.forEach(function(klass){var p=ObjectPackage.lookupPackageForClass(klass);p&&packagesToSave.push(p.systemPackage);});case 13:case"end":return _context212.stop();}}},_callee212);})(),"t2",14);case 14:metadata=objects[id].props.metadata;if(metadata){externalPackages=void 0;if(metadata.value&&metadata.value.__ref__){prop=objects[metadata.value.id];if(prop.props.externalPackages){externalPackages=prop.props.externalPackages.value;}}else{externalPackages=metadata.externalPackages;}if(externalPackages){externalPackagesFound=true;for(i=0;i<externalPackages.length;i++){externalPackageMap[externalPackages[i]]=true;}}}_context214.next=7;break;case 18:if(externalPackagesFound){snapshot.packagesToRegister=Object.keys(externalPackageMap);}objectPackagesReferenced=[];_i194=0,_packagesToSave=packagesToSave;case 21:if(!(_i194<_packagesToSave.length)){_context214.next=67;break;}pkg=_packagesToSave[_i194];_iterator103=_createForOfIteratorHelper(pkg.modules());_context214.prev=24;_iterator103.s();case 26:if((_step103=_iterator103.n()).done){_context214.next=56;break;}mod=_step103.value;if(!mod.id.endsWith(".json")){_context214.next=30;break;}return _context214.abrupt("continue",54);case 30:_context214.t3=_createForOfIteratorHelper;_context214.next=33;return mod.imports();case 33:_context214.t4=_context214.sent;_iterator104=(0,_context214.t3)(_context214.t4);_context214.prev=35;_iterator104.s();case 37:if((_step104=_iterator104.n()).done){_context214.next=46;break;}fromModule=_step104.value.fromModule;requiredPackage=__varRecorder__$s.module(fromModule)["package"]();if(requiredPackage){_context214.next=42;break;}return _context214.abrupt("continue",44);case 42:_config=requiredPackage.config;if(_config.lively&&_config.lively.isObjectPackage){objectPackagesReferenced.push(requiredPackage);if(!depMap[pkg.url])depMap[pkg.url]=[requiredPackage.url];else __varRecorder__$s.arr.pushIfNotIncluded(depMap[pkg.url],requiredPackage.url);}case 44:_context214.next=37;break;case 46:_context214.next=51;break;case 48:_context214.prev=48;_context214.t5=_context214["catch"](35);_iterator104.e(_context214.t5);case 51:_context214.prev=51;_iterator104.f();return _context214.finish(51);case 54:_context214.next=26;break;case 56:_context214.next=61;break;case 58:_context214.prev=58;_context214.t6=_context214["catch"](24);_iterator103.e(_context214.t6);case 61:_context214.prev=61;_iterator103.f();return _context214.finish(61);case 64:_i194++;_context214.next=21;break;case 67:packagesToSave=[].concat(objectPackagesReferenced,_toConsumableArray2(packagesToSave));_context214.next=70;return Promise.all(packagesToSave.map(/*#__PURE__*/function(){var _ref154=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee213(p){var root,packageJSON;return regeneratorRuntime.wrap(function _callee213$(_context213){while(1){switch(_context213.prev=_context213.next){case 0:root=__varRecorder__$s.resource(p.address).asDirectory();_context213.next=3;return __varRecorder__$s.resourceToJSON(root,{});case 3:packageJSON=_context213.sent;if(!packages[root.parent().url])packages[root.parent().url]={};Object.assign(packages[root.parent().url],packageJSON);if(!depMap[p.url])depMap[p.url]=[];case 7:case"end":return _context213.stop();}}},_callee213);}));return function(_x241){return _ref154.apply(this,arguments);};}()));case 70:return _context214.abrupt("return",{packages:packages,depMap:depMap});case 71:case"end":return _context214.stop();}}},_callee214,null,[[24,58,61,64],[35,48,51,54]]);}));return _findRequiredPackagesOfSnapshot.apply(this,arguments);}__varRecorder__$s.findRequiredPackagesOfSnapshot=findRequiredPackagesOfSnapshot;__varRecorder__$s.requiredModulesOfSnapshot=requiredModulesOfSnapshot;__varRecorder__$s.deserializeWithMigrations=deserializeWithMigrations;__varRecorder__$s.serialize=serialize;__varRecorder__$s.MorphicEnv=MorphicEnv;__varRecorder__$s.resource=resource;__varRecorder__$s.newMorphId=newMorphId;__varRecorder__$s.morph=morph;__varRecorder__$s.pathForBrowserHistory=pathForBrowserHistory;__varRecorder__$s.serializeMorph=serializeMorph;__varRecorder__$s.serializeMorph=serializeMorph;__varRecorder__$s.deserializeMorph=deserializeMorph;__varRecorder__$s.deserializeMorph=deserializeMorph;__varRecorder__$s.loadWorldFromResource=loadWorldFromResource;__varRecorder__$s.loadWorldFromResource=loadWorldFromResource;__varRecorder__$s.saveWorldToResource=saveWorldToResource;__varRecorder__$s.saveWorldToResource=saveWorldToResource;__varRecorder__$s.copyMorph=copyMorph;__varRecorder__$s.copyMorph=copyMorph;__varRecorder__$s.modules=modules;__varRecorder__$s.createFiles=createFiles;__varRecorder__$s.promise=promise;__varRecorder__$s.graph=graph;__varRecorder__$s.arr=arr;__varRecorder__$s.migrations=migrations;var destructured_1$2=__varRecorder__$s.modules;__varRecorder__$s.registerPackage=destructured_1$2.registerPackage;__varRecorder__$s.module=destructured_1$2.module;__varRecorder__$s.getPackage=destructured_1$2.getPackage;__varRecorder__$s.ensurePackage=destructured_1$2.ensurePackage;__varRecorder__$s.lookupPackage=destructured_1$2.lookupPackage;__varRecorder__$s.semver=destructured_1$2.semver;__varRecorder__$s.objectScriptingEnabled=false;__varRecorder__$s.createMorphSnapshot=createMorphSnapshot;__varRecorder__$s.createMorphSnapshot=createMorphSnapshot;__varRecorder__$s.loadMorphFromSnapshot=loadMorphFromSnapshot;__varRecorder__$s.loadMorphFromSnapshot=loadMorphFromSnapshot;__varRecorder__$s.packagesOfSnapshot=packagesOfSnapshot;__varRecorder__$s.packagesOfSnapshot=packagesOfSnapshot;__varRecorder__$s.loadPackagesAndModulesOfSnapshot=loadPackagesAndModulesOfSnapshot;__varRecorder__$s.loadPackagesAndModulesOfSnapshot=loadPackagesAndModulesOfSnapshot;__varRecorder__$s.findRequiredPackagesOfSnapshot=findRequiredPackagesOfSnapshot;__varRecorder__$s.findRequiredPackagesOfSnapshot=findRequiredPackagesOfSnapshot;var __varRecorder__$t=lively.FreezerRuntime.recorderFor("lively.morphic/morphicdb/db.js");function convertToSerializableCommit(commit){if(commit){commit.__serialize__=function(){var type=commit.type,name=commit.name,_id=commit._id;return{__expr__:"({type: \"".concat(type,"\", name: \"").concat(name,"\", _id: \"").concat(_id,"\"})")};};}return commit;}__varRecorder__$t.convertToSerializableCommit=convertToSerializableCommit;function ensureCommitInfo(_x43){return _ensureCommitInfo.apply(this,arguments);}function _ensureCommitInfo(){_ensureCommitInfo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee215(commit){var type,name,_id;return regeneratorRuntime.wrap(function _callee215$(_context215){while(1){switch(_context215.prev=_context215.next){case 0:if(!(!commit||__varRecorder__$t.obj.isEmpty(commit))){_context215.next=2;break;}return _context215.abrupt("return",false);case 2:if(!(commit&&commit._rev)){_context215.next=4;break;}return _context215.abrupt("return",commit);case 4:type=commit.type,name=commit.name,_id=commit._id;_context215.prev=5;_context215.t0=Object;_context215.t1=commit;_context215.next=10;return __varRecorder__$t.MorphicDB["default"].fetchCommit(type,name,_id);case 10:_context215.t2=_context215.sent;_context215.t0.assign.call(_context215.t0,_context215.t1,_context215.t2);case 12:_context215.prev=12;return _context215.abrupt("return",commit);case 15:case"end":return _context215.stop();}}},_callee215,null,[[5,,12,15]]);}));return _ensureCommitInfo.apply(this,arguments);}__varRecorder__$t.ensureCommitInfo=ensureCommitInfo;__varRecorder__$t.ObjectDBHTTPInterface=ObjectDBHTTPInterface;__varRecorder__$t.Database=Database;__varRecorder__$t.loadMorphFromSnapshot=loadMorphFromSnapshot;__varRecorder__$t.createMorphSnapshot=createMorphSnapshot;__varRecorder__$t.resource=resource;__varRecorder__$t.obj=obj;__varRecorder__$t.Path=Path;__varRecorder__$t.arr=arr;__varRecorder__$t.string=string;__varRecorder__$t.morphicDBs=__varRecorder__$t.morphicDBs||(__varRecorder__$t.morphicDBs=new Map());__varRecorder__$t.defaultServerURL=(typeof document!=="undefined"?document.location.origin:"http://localhost:9001")+"/objectdb/";__varRecorder__$t.convertToSerializableCommit=convertToSerializableCommit;__varRecorder__$t.convertToSerializableCommit=convertToSerializableCommit;__varRecorder__$t.ensureCommitInfo=ensureCommitInfo;__varRecorder__$t.ensureCommitInfo=ensureCommitInfo;var MorphicDB=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morphicdb/db.js");var __lively_class__=__lively_classholder__.hasOwnProperty("MorphicDB")&&typeof __lively_classholder__.MorphicDB==="function"?__lively_classholder__.MorphicDB:__lively_classholder__.MorphicDB=function MorphicDB(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function MorphicDB_initialize_(name,_ref40){var snapshotLocation=_ref40.snapshotLocation,serverURL=_ref40.serverURL;this.name=name;this.serverURL=serverURL;this.snapshotLocation=snapshotLocation||"".concat(name,"/snapshots/");this.httpDB=new __varRecorder__$t.ObjectDBHTTPInterface(serverURL);this._initialized=false;}},{key:"__serialize__",value:function MorphicDB___serialize___(){var name=this.name,serverURL=this.serverURL,snapshotLocation=this.snapshotLocation;return{__expr__:"MorphicDB.named(\"".concat(name,"\", {snapshotLocation: \"").concat(snapshotLocation,"\", serverURL: \"").concat(serverURL,"\"})"),bindings:{"lively.morphic/morphicdb/index.js":["MorphicDB"]}};}},{key:"initializeIfNecessary",value:function(){var _MorphicDB_initializeIfNecessary_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee40(){return regeneratorRuntime.wrap(function _callee40$(_context40){while(1){switch(_context40.prev=_context40.next){case 0:if(!this._initialized){_context40.next=2;break;}return _context40.abrupt("return");case 2:_context40.next=4;return this.ensureDB();case 4:this._initialized=true;case 5:case"end":return _context40.stop();}}},_callee40,this);}));function MorphicDB_initializeIfNecessary_(){return _MorphicDB_initializeIfNecessary_.apply(this,arguments);}return MorphicDB_initializeIfNecessary_;}()},{key:"snapshotResourceFor",value:function MorphicDB_snapshotResourceFor_(commit){var first=commit.content.slice(0,2);var rest=commit.content.slice(2);return __varRecorder__$t.resource(System.decanonicalize(this.snapshotLocation)).join("".concat(first,"/").concat(rest,".json"));}},{key:"ensureDB",value:function MorphicDB_ensureDB_(){var db=this.name,snapshotLocation=this.snapshotLocation;return this.httpDB.ensureDB({db:db,snapshotLocation:snapshotLocation});}},{key:"destroyDB",value:function MorphicDB_destroyDB_(){this._initialized=false;var db=this.name;return this.httpDB.destroyDB({db:db});}},{key:"latestCommits",value:function(){var _MorphicDB_latestCommits_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee41(){var type,includeDeleted,db,ref,knownCommitIds,_args42=arguments;return regeneratorRuntime.wrap(function _callee41$(_context41){while(1){switch(_context41.prev=_context41.next){case 0:type=_args42.length>0&&_args42[0]!==undefined?_args42[0]:"world";includeDeleted=_args42.length>1&&_args42[1]!==undefined?_args42[1]:false;_context41.next=4;return this.initializeIfNecessary();case 4:db=this.name;ref="HEAD";knownCommitIds={};return _context41.abrupt("return",this.httpDB.fetchCommits({db:db,type:type,ref:ref,knownCommitIds:knownCommitIds,includeDeleted:includeDeleted}));case 8:case"end":return _context41.stop();}}},_callee41,this);}));function MorphicDB_latestCommits_(){return _MorphicDB_latestCommits_.apply(this,arguments);}return MorphicDB_latestCommits_;}()},{key:"fetchCommit",value:function(){var _MorphicDB_fetchCommit_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee42(type,name,ref){var typesAndNames,commits,commit;return regeneratorRuntime.wrap(function _callee42$(_context42){while(1){switch(_context42.prev=_context42.next){case 0:_context42.next=2;return this.initializeIfNecessary();case 2:typesAndNames=[{type:type,name:name,ref:ref}];_context42.next=5;return this.httpDB.fetchCommits({db:this.name,ref:ref,type:type,typesAndNames:typesAndNames,knownCommitIds:{}});case 5:commits=_context42.sent;commit=commits[0];return _context42.abrupt("return",__varRecorder__$t.convertToSerializableCommit(commits[0]));case 8:case"end":return _context42.stop();}}},_callee42,this);}));function MorphicDB_fetchCommit_(_x44,_x45,_x46){return _MorphicDB_fetchCommit_.apply(this,arguments);}return MorphicDB_fetchCommit_;}()},{key:"fetchSnapshot",value:function(){var _MorphicDB_fetchSnapshot_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee43(type,name,commitIdOrCommit,ref){var firstArg,db,_args44=arguments;return regeneratorRuntime.wrap(function _callee43$(_context43){while(1){switch(_context43.prev=_context43.next){case 0:firstArg=type;if(_args44.length===1&&firstArg.type&&firstArg.name){type=firstArg.type;name=firstArg.name;commitIdOrCommit=firstArg._id;}_context43.next=4;return this.initializeIfNecessary();case 4:db=this.name;return _context43.abrupt("return",this.httpDB.fetchSnapshot({db:db,type:type,name:name,ref:ref,commit:commitIdOrCommit}));case 6:case"end":return _context43.stop();}}},_callee43,this);}));function MorphicDB_fetchSnapshot_(_x47,_x48,_x49,_x50){return _MorphicDB_fetchSnapshot_.apply(this,arguments);}return MorphicDB_fetchSnapshot_;}()},{key:"exists",value:function(){var _MorphicDB_exists_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee44(type,name,ref){var db;return regeneratorRuntime.wrap(function _callee44$(_context44){while(1){switch(_context44.prev=_context44.next){case 0:_context44.next=2;return this.initializeIfNecessary();case 2:db=this.name;return _context44.abrupt("return",this.httpDB.exists({db:db,type:type,name:name,ref:ref}));case 4:case"end":return _context44.stop();}}},_callee44,this);}));function MorphicDB_exists_(_x51,_x52,_x53){return _MorphicDB_exists_.apply(this,arguments);}return MorphicDB_exists_;}()},{key:"history",value:function(){var _MorphicDB_history_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee45(type,name){var db;return regeneratorRuntime.wrap(function _callee45$(_context45){while(1){switch(_context45.prev=_context45.next){case 0:_context45.next=2;return this.initializeIfNecessary();case 2:db=this.name;return _context45.abrupt("return",this.httpDB.fetchVersionGraph({db:db,type:type,name:name}));case 4:case"end":return _context45.stop();}}},_callee45,this);}));function MorphicDB_history_(_x54,_x55){return _MorphicDB_history_.apply(this,arguments);}return MorphicDB_history_;}()},{key:"log",value:function(){var _MorphicDB_log_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee46(commit,limit){var includeCommits,knownCommitIds,db,_args47=arguments;return regeneratorRuntime.wrap(function _callee46$(_context46){while(1){switch(_context46.prev=_context46.next){case 0:includeCommits=_args47.length>2&&_args47[2]!==undefined?_args47[2]:false;knownCommitIds=_args47.length>3?_args47[3]:undefined;_context46.next=4;return this.initializeIfNecessary();case 4:db=this.name;_context46.next=7;return this.httpDB.fetchLog({db:db,commit:commit,limit:limit,includeCommits:includeCommits,knownCommitIds:knownCommitIds});case 7:_context46.t0=__varRecorder__$t.convertToSerializableCommit;return _context46.abrupt("return",_context46.sent.map(_context46.t0));case 9:case"end":return _context46.stop();}}},_callee46,this);}));function MorphicDB_log_(_x56,_x57){return _MorphicDB_log_.apply(this,arguments);}return MorphicDB_log_;}()},{key:"revert",value:function(){var _MorphicDB_revert_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee47(type,name,toCommitId){var ref,db,_args48=arguments;return regeneratorRuntime.wrap(function _callee47$(_context47){while(1){switch(_context47.prev=_context47.next){case 0:ref=_args48.length>3&&_args48[3]!==undefined?_args48[3]:"HEAD";_context47.next=3;return this.initializeIfNecessary();case 3:db=this.name;return _context47.abrupt("return",this.httpDB.revert({db:db,type:type,name:name,toCommitId:toCommitId,ref:ref}));case 5:case"end":return _context47.stop();}}},_callee47,this);}));function MorphicDB_revert_(_x58,_x59,_x60){return _MorphicDB_revert_.apply(this,arguments);}return MorphicDB_revert_;}()},{key:"snapshotAndCommit",value:function(){var _MorphicDB_snapshotAndCommit_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee48(type,name,morph,snapshotOptions,commitSpec,ref,expectedParentCommit){var snapshot,commit;return regeneratorRuntime.wrap(function _callee48$(_context48){while(1){switch(_context48.prev=_context48.next){case 0:_context48.next=2;return __varRecorder__$t.createMorphSnapshot(morph,snapshotOptions);case 2:snapshot=_context48.sent;_context48.next=5;return this.commit(type,name,snapshot,commitSpec,ref,expectedParentCommit);case 5:commit=_context48.sent;commit=__varRecorder__$t.convertToSerializableCommit(commit);morph.changeMetaData("commit",__varRecorder__$t.obj.dissoc(commit,["preview"]),true,false);return _context48.abrupt("return",commit);case 9:case"end":return _context48.stop();}}},_callee48,this);}));function MorphicDB_snapshotAndCommit_(_x61,_x62,_x63,_x64,_x65,_x66,_x67){return _MorphicDB_snapshotAndCommit_.apply(this,arguments);}return MorphicDB_snapshotAndCommit_;}()},{key:"commit",value:function(){var _MorphicDB_commit_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee49(type,name,snapshot,commitSpec,ref,expectedParentCommit){var firstArg,db,_args50=arguments;return regeneratorRuntime.wrap(function _callee49$(_context49){while(1){switch(_context49.prev=_context49.next){case 0:firstArg=type;if(_args50.length===1&&firstArg.type&&firstArg.name){type=firstArg.type;name=firstArg.name;snapshot=firstArg.snapshot||firstArg.content;commitSpec=__varRecorder__$t.obj.dissoc(firstArg,["snapshot","_rev","_id","ancestors","deleted"]);expectedParentCommit=firstArg._id;}_context49.next=4;return this.initializeIfNecessary();case 4:db=this.name;return _context49.abrupt("return",this.httpDB.commit({db:db,type:type,name:name,ref:ref,expectedParentCommit:expectedParentCommit,commitSpec:commitSpec,snapshot:snapshot}));case 6:case"end":return _context49.stop();}}},_callee49,this);}));function MorphicDB_commit_(_x68,_x69,_x70,_x71,_x72,_x73){return _MorphicDB_commit_.apply(this,arguments);}return MorphicDB_commit_;}()},{key:"load",value:function(){var _MorphicDB_load_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee50(typeOrCommit,name,loadOptions,commitIdOrCommit,ref){var type,commit,_yield$this$log,_yield$this$log2,snapshot,morph;return regeneratorRuntime.wrap(function _callee50$(_context50){while(1){switch(_context50.prev=_context50.next){case 0:if(_typeof2(typeOrCommit)==="object")commitIdOrCommit=typeOrCommit;else type=typeOrCommit;commit=commitIdOrCommit;if(commit){_context50.next=8;break;}_context50.next=5;return this.fetchCommit(type,name,ref);case 5:commit=_context50.sent;_context50.next=14;break;case 8:if(!(typeof commit==="string")){_context50.next=14;break;}_context50.next=11;return this.log(commit,1,true);case 11:_yield$this$log=_context50.sent;_yield$this$log2=_slicedToArray2(_yield$this$log,1);commit=_yield$this$log2[0];case 14:_context50.next=16;return this.fetchSnapshot(undefined,undefined,commit._id);case 16:snapshot=_context50.sent;_context50.next=19;return __varRecorder__$t.loadMorphFromSnapshot(snapshot,loadOptions);case 19:morph=_context50.sent;commit=__varRecorder__$t.convertToSerializableCommit(commit);morph.changeMetaData("commit",__varRecorder__$t.obj.dissoc(commit,["preview"]),true,false);return _context50.abrupt("return",morph);case 23:case"end":return _context50.stop();}}},_callee50,this);}));function MorphicDB_load_(_x74,_x75,_x76,_x77,_x78){return _MorphicDB_load_.apply(this,arguments);}return MorphicDB_load_;}()},{key:"fetchDiff",value:function(){var _MorphicDB_fetchDiff_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee51(otherDBName){var db;return regeneratorRuntime.wrap(function _callee51$(_context51){while(1){switch(_context51.prev=_context51.next){case 0:_context51.next=2;return this.initializeIfNecessary();case 2:db=this.name;return _context51.abrupt("return",this.httpDB.fetchDiff({db:db,otherDB:otherDBName}));case 4:case"end":return _context51.stop();}}},_callee51,this);}));function MorphicDB_fetchDiff_(_x79){return _MorphicDB_fetchDiff_.apply(this,arguments);}return MorphicDB_fetchDiff_;}()},{key:"fetchConflicts",value:function(){var _MorphicDB_fetchConflicts_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee52(includeDocs,only){var db;return regeneratorRuntime.wrap(function _callee52$(_context52){while(1){switch(_context52.prev=_context52.next){case 0:_context52.next=2;return this.initializeIfNecessary();case 2:db=this.name;return _context52.abrupt("return",this.httpDB.fetchConflicts({db:db,includeDocs:includeDocs,only:only}));case 4:case"end":return _context52.stop();}}},_callee52,this);}));function MorphicDB_fetchConflicts_(_x80,_x81){return _MorphicDB_fetchConflicts_.apply(this,arguments);}return MorphicDB_fetchConflicts_;}()},{key:"resolveConflict",value:function(){var _MorphicDB_resolveConflict_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee53(resolved){var db;return regeneratorRuntime.wrap(function _callee53$(_context53){while(1){switch(_context53.prev=_context53.next){case 0:_context53.next=2;return this.initializeIfNecessary();case 2:db=this.name;return _context53.abrupt("return",this.httpDB.resolveConflict(Object.assign({db:db},resolved)));case 4:case"end":return _context53.stop();}}},_callee53,this);}));function MorphicDB_resolveConflict_(_x82){return _MorphicDB_resolveConflict_.apply(this,arguments);}return MorphicDB_resolveConflict_;}()},{key:"synchronize",value:function(){var _MorphicDB_synchronize_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee54(_ref41){var method,otherDB,otherDBSnapshotLocation,onlyTypesAndNames,db;return regeneratorRuntime.wrap(function _callee54$(_context54){while(1){switch(_context54.prev=_context54.next){case 0:method=_ref41.method,otherDB=_ref41.otherDB,otherDBSnapshotLocation=_ref41.otherDBSnapshotLocation,onlyTypesAndNames=_ref41.onlyTypesAndNames;_context54.next=3;return this.initializeIfNecessary();case 3:db=this.name;return _context54.abrupt("return",this.httpDB.synchronize({db:db,method:method,otherDB:otherDB,otherDBSnapshotLocation:otherDBSnapshotLocation,onlyTypesAndNames:onlyTypesAndNames}));case 5:case"end":return _context54.stop();}}},_callee54,this);}));function MorphicDB_synchronize_(_x83){return _MorphicDB_synchronize_.apply(this,arguments);}return MorphicDB_synchronize_;}()},{key:"softDelete",value:function(){var _MorphicDB_softDelete_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee55(typeOrPrevCommit,name,commitSpec,ref,expectedParentCommit){return regeneratorRuntime.wrap(function _callee55$(_context55){while(1){switch(_context55.prev=_context55.next){case 0:return _context55.abrupt("return",this.commit(typeOrPrevCommit,name,undefined,commitSpec,ref,expectedParentCommit));case 1:case"end":return _context55.stop();}}},_callee55,this);}));function MorphicDB_softDelete_(_x84,_x85,_x86,_x87,_x88){return _MorphicDB_softDelete_.apply(this,arguments);}return MorphicDB_softDelete_;}()},{key:"delete",value:function(){var _MorphicDB_delete_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee56(type,name){var dryRun,db,_args57=arguments;return regeneratorRuntime.wrap(function _callee56$(_context56){while(1){switch(_context56.prev=_context56.next){case 0:dryRun=_args57.length>2&&_args57[2]!==undefined?_args57[2]:true;_context56.next=3;return this.initializeIfNecessary();case 3:db=this.name;return _context56.abrupt("return",this.httpDB["delete"]({db:db,type:type,name:name,dryRun:dryRun}));case 5:case"end":return _context56.stop();}}},_callee56,this);}));function MorphicDB_delete_(_x89,_x90){return _MorphicDB_delete_.apply(this,arguments);}return MorphicDB_delete_;}()},{key:"deleteCommit",value:function(){var _MorphicDB_deleteCommit_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee57(commitId){var dryRun,db,_args58=arguments;return regeneratorRuntime.wrap(function _callee57$(_context57){while(1){switch(_context57.prev=_context57.next){case 0:dryRun=_args58.length>1&&_args58[1]!==undefined?_args58[1]:true;_context57.next=3;return this.initializeIfNecessary();case 3:db=this.name;return _context57.abrupt("return",this.httpDB.deleteCommit({db:db,commit:commitId,dryRun:dryRun}));case 5:case"end":return _context57.stop();}}},_callee57,this);}));function MorphicDB_deleteCommit_(_x91){return _MorphicDB_deleteCommit_.apply(this,arguments);}return MorphicDB_deleteCommit_;}()},{key:"codeSearchInPackages",value:function(){var _MorphicDB_codeSearchInPackages_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee58(stringOrRe){var type,onProgress,commitFilter,commits,found,i,_iterator39,_step39,commit,matches,_args59=arguments;return regeneratorRuntime.wrap(function _callee58$(_context58){while(1){switch(_context58.prev=_context58.next){case 0:type=_args59.length>1&&_args59[1]!==undefined?_args59[1]:"part";onProgress=_args59.length>2?_args59[2]:undefined;commitFilter=_args59.length>3?_args59[3]:undefined;_context58.next=5;return this.latestCommits(type);case 5:commits=_context58.sent;found=[];i=0;if(typeof commitFilter==="function"){commits=commits.filter(commitFilter);}_iterator39=_createForOfIteratorHelper(commits);_context58.prev=10;_iterator39.s();case 12:if((_step39=_iterator39.n()).done){_context58.next=21;break;}commit=_step39.value;if(typeof onProgress==="function"){onProgress(commit.name,i++,commits.length);}_context58.next=17;return this._textSearchInSnapshotOfCommit(stringOrRe,commit);case 17:matches=_context58.sent;if(matches.length)found.push.apply(found,_toConsumableArray2(matches));case 19:_context58.next=12;break;case 21:_context58.next=26;break;case 23:_context58.prev=23;_context58.t0=_context58["catch"](10);_iterator39.e(_context58.t0);case 26:_context58.prev=26;_iterator39.f();return _context58.finish(26);case 29:return _context58.abrupt("return",found);case 30:case"end":return _context58.stop();}}},_callee58,this,[[10,23,26,29]]);}));function MorphicDB_codeSearchInPackages_(_x92){return _MorphicDB_codeSearchInPackages_.apply(this,arguments);}return MorphicDB_codeSearchInPackages_;}()},{key:"_textSearchInSnapshotOfCommit",value:function(){var _MorphicDB__textSearchInSnapshotOfCommit_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee59(stringOrRe,commit,optSnapshot){var _id,snapshot;return regeneratorRuntime.wrap(function _callee59$(_context59){while(1){switch(_context59.prev=_context59.next){case 0:_id=commit._id;_context59.t0=optSnapshot;if(_context59.t0){_context59.next=6;break;}_context59.next=5;return this.fetchSnapshot(undefined,undefined,_id);case 5:_context59.t0=_context59.sent;case 6:snapshot=_context59.t0;return _context59.abrupt("return",new __varRecorder__$t.SnapshotPackageHelper(snapshot).textSearch(stringOrRe,commit));case 8:case"end":return _context59.stop();}}},_callee59,this);}));function MorphicDB__textSearchInSnapshotOfCommit_(_x93,_x94,_x95){return _MorphicDB__textSearchInSnapshotOfCommit_.apply(this,arguments);}return MorphicDB__textSearchInSnapshotOfCommit_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"MorphicDB";}},{key:"default",get:function get(){return this.named("lively.morphic/objectdb/morphicdb",{serverURL:__varRecorder__$t.defaultServerURL});}},{key:"named",value:function MorphicDB_named_(name,options){var existing=__varRecorder__$t.morphicDBs.get(name);if(existing)return existing;if(!options.serverURL)throw new Error("Needs serverURL!");var db=new this(name,options);__varRecorder__$t.morphicDBs.set(name,db);return db;}},{key:"wellKnownMorphicDBs",value:function(){var _MorphicDB_wellKnownMorphicDBs_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee60(){var _this68=this;var db,dbSpecs,dbs;return regeneratorRuntime.wrap(function _callee60$(_context60){while(1){switch(_context60.prev=_context60.next){case 0:db=__varRecorder__$t.Database.ensureDB("lively.morphic/morphicdb/well-known-morphic-dbs");_context60.next=3;return db.getAll();case 3:dbSpecs=_context60.sent;dbs=dbSpecs.reduce(function(all,_ref42){var _id=_ref42._id,name=_ref42.name,serverURL=_ref42.serverURL,snapshotLocation=_ref42.snapshotLocation;return Object.assign(all,_defineProperty({},_id,_this68.named(name,{serverURL:serverURL,snapshotLocation:snapshotLocation})));},{});if(!dbs["default"])dbs["default"]=this["default"];return _context60.abrupt("return",dbs);case 7:case"end":return _context60.stop();}}},_callee60,this);}));function MorphicDB_wellKnownMorphicDBs_(){return _MorphicDB_wellKnownMorphicDBs_.apply(this,arguments);}return MorphicDB_wellKnownMorphicDBs_;}()},{key:"addWellKnownMorphicDB",value:function(){var _MorphicDB_addWellKnownMorphicDB_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee61(alias,morphicDB){var name,snapshotLocation,serverURL,db;return regeneratorRuntime.wrap(function _callee61$(_context61){while(1){switch(_context61.prev=_context61.next){case 0:name=morphicDB.name,snapshotLocation=morphicDB.snapshotLocation,serverURL=morphicDB.serverURL;db=__varRecorder__$t.Database.ensureDB("lively.morphic/morphicdb/well-known-morphic-dbs");_context61.next=4;return db.set(alias,{name:name,snapshotLocation:snapshotLocation,serverURL:serverURL});case 4:case"end":return _context61.stop();}}},_callee61);}));function MorphicDB_addWellKnownMorphicDB_(_x96,_x97){return _MorphicDB_addWellKnownMorphicDB_.apply(this,arguments);}return MorphicDB_addWellKnownMorphicDB_;}()},{key:"removeWellKnownMorphicDB",value:function(){var _MorphicDB_removeWellKnownMorphicDB_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee62(alias){var db;return regeneratorRuntime.wrap(function _callee62$(_context62){while(1){switch(_context62.prev=_context62.next){case 0:db=__varRecorder__$t.Database.ensureDB("lively.morphic/morphicdb/well-known-morphic-dbs");_context62.next=3;return db.remove(alias);case 3:case"end":return _context62.stop();}}},_callee62);}));function MorphicDB_removeWellKnownMorphicDB_(_x98){return _MorphicDB_removeWellKnownMorphicDB_.apply(this,arguments);}return MorphicDB_removeWellKnownMorphicDB_;}()}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morphicdb/db.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1452,end:10229});}(undefined);MorphicDB=__varRecorder__$t.MorphicDB;var MorphicDB$1=MorphicDB;var SnapshotPackageHelper=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morphicdb/db.js");var __lively_class__=__lively_classholder__.hasOwnProperty("SnapshotPackageHelper")&&typeof __lively_classholder__.SnapshotPackageHelper==="function"?__lively_classholder__.SnapshotPackageHelper:__lively_classholder__.SnapshotPackageHelper=function SnapshotPackageHelper(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function SnapshotPackageHelper_initialize_(snapshot){this.snapshot=snapshot;}},{key:"textSearch",value:function SnapshotPackageHelper_textSearch_(stringOrRe,commit){var _this69=this;var isRe=stringOrRe&&stringOrRe instanceof RegExp;var found=[];if(!stringOrRe)return found;var _iterator40=_createForOfIteratorHelper(this.filesInPackages()),_step40;try{var _loop5=function _loop5(){var file=_step40.value;var source=file.get(_this69.snapshot);var lineNoFn=__varRecorder__$t.string.lineIndexComputer(source);var lineRanges=__varRecorder__$t.string.lineRanges(source);if(!isRe){var index=0;var offset=0;while((index=source.indexOf(stringOrRe))>=0){var _source;var start=index+offset;var end=start+stringOrRe.length;var line=lineNoFn(start);var lineString=(_source=source).slice.apply(_source,_toConsumableArray2(lineRanges[line]));found.push({match:stringOrRe,start:start,end:end,length:stringOrRe.length,line:line,lineString:lineString,commit:commit,file:file});offset+=index+stringOrRe.length;source=source.slice(index+stringOrRe.length);}}else{var matches=__varRecorder__$t.string.reMatches(source,stringOrRe);if(matches.length){found.push.apply(found,_toConsumableArray2(matches.map(function(ea){return Object.assign(ea,{commit:commit,file:file});})));}}};for(_iterator40.s();!(_step40=_iterator40.n()).done;){_loop5();}}catch(err){_iterator40.e(err);}finally{_iterator40.f();}return found;}},{key:"filesInPackages",value:function SnapshotPackageHelper_filesInPackages_(){var result=[];for(var baseURL in this.snapshot.packages){collectFiles(this.snapshot.packages[baseURL],[baseURL],baseURL,null,result);}return result;function collectFiles(dirObj,path,url,currentPackage){var result=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];if(dirObj["package.json"]&&typeof dirObj["package.json"]==="string"){try{var packageConfig=JSON.parse(dirObj["package.json"]);currentPackage={url:url,path:path,name:packageConfig.name||__varRecorder__$t.arr.last(path)};}catch(err){}}var subDirs=[];for(var fileName in dirObj){if(typeof dirObj[fileName]==="string"){result.push({path:path.concat(fileName),url:__varRecorder__$t.string.joinPath(url,fileName),"package":currentPackage,get:function get(snapshot){return __varRecorder__$t.Path(this.path).get(snapshot.packages);},set:function set(snapshot,content){__varRecorder__$t.Path(this.path).set(snapshot.packages,content);}});}else subDirs.push(fileName);}subDirs.forEach(function(dirName){return collectFiles(dirObj[dirName],path.concat(dirName),__varRecorder__$t.string.joinPath(url,dirName),currentPackage,result);});return result;}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"SnapshotPackageHelper";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morphicdb/db.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:10238,end:13311});}(undefined);__varRecorder__$t.SnapshotPackageHelper=SnapshotPackageHelper;__varRecorder__$t.SnapshotPackageHelper=SnapshotPackageHelper;__varRecorder__$t.SnapshotPackageHelper=SnapshotPackageHelper;__varRecorder__$t["default"]=MorphicDB;var __varRecorder__$u=lively.FreezerRuntime.recorderFor("lively.morphic/style-guide.js");function prefetchCoreStyleguides(_x99){return _prefetchCoreStyleguides.apply(this,arguments);}function _prefetchCoreStyleguides(){_prefetchCoreStyleguides=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee216(li){return regeneratorRuntime.wrap(function _callee216$(_context216){while(1){switch(_context216.prev=_context216.next){case 0:li.label="loading System Elements";li.progress=0;li.status="core elements...";_context216.next=5;return __varRecorder__$u.resource("styleguide://System/buttons/light").read();case 5:li.progress=1/5;li.status="top bar...";_context216.next=9;return __varRecorder__$u.resource("styleguide://SystemIDE/lively top bar master").read();case 9:li.progress=2/5;li.status="scene graph...";_context216.next=13;return __varRecorder__$u.resource("styleguide://SystemIDE/styling side bar master").read();case 13:li.progress=3/5;li.status="styling palette...";_context216.next=17;return __varRecorder__$u.resource("styleguide://SystemIDE/scene graph side bar master").read();case 17:li.progress=4/5;li.status="world loader...";_context216.next=21;return __varRecorder__$u.resource("styleguide://partial freezing/project browser").read();case 21:li.progress=5/5;_context216.next=24;return __varRecorder__$u.promise.delay(500);case 24:case"end":return _context216.stop();}}},_callee216);}));return _prefetchCoreStyleguides.apply(this,arguments);}__varRecorder__$u.prefetchCoreStyleguides=prefetchCoreStyleguides;function getProjectName(world){return __varRecorder__$u.Path("metadata.commit.name").get(world)||world.name;}__varRecorder__$u.getProjectName=getProjectName;function clearSnapshot(name){delete __varRecorder__$u.fetchedSnapshots[name];}__varRecorder__$u.clearSnapshot=clearSnapshot;__varRecorder__$u.arr=arr;__varRecorder__$u.properties=properties;__varRecorder__$u.Path=Path;__varRecorder__$u.promise=promise;__varRecorder__$u.obj=obj;__varRecorder__$u.registerExtension=registerExtension;__varRecorder__$u.Resource=Resource;__varRecorder__$u.resource=resource;__varRecorder__$u.pt=pt;__varRecorder__$u.MorphicDB=MorphicDB$1;__varRecorder__$u.ObjectPool=ObjectPool;__varRecorder__$u.normalizeOptions=normalizeOptions;__varRecorder__$u.deserializeMorph=deserializeMorph;__varRecorder__$u.loadPackagesAndModulesOfSnapshot=loadPackagesAndModulesOfSnapshot;__varRecorder__$u.subscribeOnce=subscribeOnce;__varRecorder__$u.prefetchCoreStyleguides=prefetchCoreStyleguides;__varRecorder__$u.prefetchCoreStyleguides=prefetchCoreStyleguides;var ComponentPolicy=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/style-guide.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ComponentPolicy")&&typeof __lively_classholder__.ComponentPolicy==="function"?__lively_classholder__.ComponentPolicy:__lively_classholder__.ComponentPolicy=function ComponentPolicy(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function ComponentPolicy_initialize_(derivedMorph,args){this.derivedMorph=derivedMorph;this._overriddenProps=new WeakMap();if(args.isMorph||typeof args==="string"){this.auto=args;if(typeof args==="string"){this.auto.isComponent=true;}return;}var click=args.click,auto=args.auto,hover=args.hover,_args$light=args.light,light=_args$light===void 0?{}:_args$light,_args$dark=args.dark,dark=_args$dark===void 0?{}:_args$dark;if(light)this.light=light;if(dark)this.dark=dark;if(click)this.click=click;if(auto)this.auto=auto;if(hover)this.hover=hover;this.resolveMasterComponents();}},{key:"uses",value:function ComponentPolicy_uses_(masterComponent){return[this.auto,this.click,this.hover].includes(masterComponent);}},{key:"spec",value:function ComponentPolicy_spec_(){return __varRecorder__$u.obj.select(this,["auto","click","hover","light","dark"]);}},{key:"equals",value:function ComponentPolicy_equals_(other){if(!other)return false;for(var _i93=0,_arr3=["auto","click","hover"];_i93<_arr3.length;_i93++){var master=_arr3[_i93];if(typeof other[master]==="string"){if(this.getResourceUrlFor(this[master])!=other[master]||null)return false;}else if((this[master]||null)!=(other[master]||null))return false;}return true;}},{key:"getManagedMorphs",value:function ComponentPolicy_getManagedMorphs_(){var _this70=this;var managedMorphs=[];this.derivedMorph.withAllSubmorphsDo(function(m){if(_this70.managesMorph(m)){var propKeys=Object.keys(_this70._overriddenProps.get(m)).filter(function(k){return k!="_rev";});if(propKeys.length>0){managedMorphs.push([m,Object.keys(_this70._overriddenProps.get(m))]);}}});return managedMorphs;}},{key:"__dont_serialize__",get:function get(){var excludedProps=["_overriddenProps","_applying","_appliedMaster","_hasUnresolvedMaster"];if(__varRecorder__$u.obj.isEmpty(this.dark))excludedProps.push("dark");if(__varRecorder__$u.obj.isEmpty(this.light))excludedProps.push("light");return excludedProps;}},{key:"__serialize__",value:function ComponentPolicy___serialize___(){var spec={};if(this.auto)spec.auto=this.getResourceUrlFor(this.auto);if(this.click)spec.click=this.getResourceUrlFor(this.click);if(this.hover)spec.hover=this.getResourceUrlFor(this.hover);return{__expr__:"(".concat(JSON.stringify(spec),")")};}},{key:"__after_deserialize__",value:function ComponentPolicy___after_deserialize___(snapshot,objRef){this._overriddenProps=new WeakMap();delete this.managedMorphs;this.resolveMasterComponents();}},{key:"whenApplied",value:function(){var _ComponentPolicy_whenApplied_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee63(){var _this71=this;return regeneratorRuntime.wrap(function _callee63$(_context63){while(1){switch(_context63.prev=_context63.next){case 0:_context63.next=2;return this._hasUnresolvedMaster;case 2:_context63.next=4;return __varRecorder__$u.promise.waitFor(1000,function(){return _this71._appliedMaster;});case 4:return _context63.abrupt("return",true);case 5:case"end":return _context63.stop();}}},_callee63,this);}));function ComponentPolicy_whenApplied_(){return _ComponentPolicy_whenApplied_.apply(this,arguments);}return ComponentPolicy_whenApplied_;}()},{key:"whenReady",value:function(){var _ComponentPolicy_whenReady_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee64(){return regeneratorRuntime.wrap(function _callee64$(_context64){while(1){switch(_context64.prev=_context64.next){case 0:_context64.next=2;return this._hasUnresolvedMaster;case 2:case"end":return _context64.stop();}}},_callee64,this);}));function ComponentPolicy_whenReady_(){return _ComponentPolicy_whenReady_.apply(this,arguments);}return ComponentPolicy_whenReady_;}()},{key:"getResourceUrlFor",value:function ComponentPolicy_getResourceUrlFor_(component){if(!component)return null;if(component._resourceHandle)return component._resourceHandle.url;if(component.name==undefined)return null;return"styleguide://".concat(__varRecorder__$u.getProjectName($world),"/").concat(component.name);}},{key:"getWorldUrlFor",value:function ComponentPolicy_getWorldUrlFor_(component){var worldOfMaster=__varRecorder__$u.resource(typeof component==="string "?component:this.getResourceUrlFor(component)).worldName;if(worldOfMaster==__varRecorder__$u.getProjectName($world)){return document.location.href;}return __varRecorder__$u.worldToUrl[worldOfMaster];}},{key:"resolveMasterComponents",value:function(){var _ComponentPolicy_resolveMasterComponents_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee65(){var res,_this$light,light,_this$dark,dark,states,resolvedComponents,_i94,_states,state;return regeneratorRuntime.wrap(function _callee65$(_context65){while(1){switch(_context65.prev=_context65.next){case 0:res=__varRecorder__$u.promise.deferred();this._hasUnresolvedMaster=res.promise;_this$light=this.light,light=_this$light===void 0?{}:_this$light,_this$dark=this.dark,dark=_this$dark===void 0?{}:_this$dark;states=["auto","click","hover"];resolvedComponents=[];_context65.prev=5;_i94=0,_states=states;case 7:if(!(_i94<_states.length)){_context65.next=25;break;}state=_states[_i94];if(!(typeof this[state]==="string")){_context65.next=13;break;}_context65.next=12;return __varRecorder__$u.resource(this[state]).read();case 12:this[state]=_context65.sent;case 13:if(!(typeof light[state]==="string")){_context65.next=17;break;}_context65.next=16;return __varRecorder__$u.resource(light[state]).read();case 16:light[state]=_context65.sent;case 17:if(!(typeof dark[state]==="string")){_context65.next=21;break;}_context65.next=20;return __varRecorder__$u.resource(dark[state]).read();case 20:dark[state]=_context65.sent;case 21:resolvedComponents.push(this[state],light[state],dark[state]);case 22:_i94++;_context65.next=7;break;case 25:_context65.next=30;break;case 27:_context65.prev=27;_context65.t0=_context65["catch"](5);throw Error("Encountered invalid master component reference: "+_context65.t0.message);case 30:__varRecorder__$u.arr.compact(resolvedComponents).forEach(function(component){if(!component.isComponent){component.isComponent=true;}});res.resolve();this._hasUnresolvedMaster=false;case 33:case"end":return _context65.stop();}}},_callee65,this,[[5,27]]);}));function ComponentPolicy_resolveMasterComponents_(){return _ComponentPolicy_resolveMasterComponents_.apply(this,arguments);}return ComponentPolicy_resolveMasterComponents_;}()},{key:"applyAnimated",value:function ComponentPolicy_applyAnimated_(){var _this72=this;var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{duration:1000};this.applyIfNeeded(true,config);return __varRecorder__$u.promise.waitFor(config.duration*2,function(){return!_this72._animationConfig;});}},{key:"applyIfNeeded",value:function ComponentPolicy_applyIfNeeded_(){var _this73=this;var needsUpdate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var animationConfig=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(animationConfig)this._animationConfig=animationConfig;if(this._hasUnresolvedMaster){this._originalOpacity=this.derivedMorph.opacity;this.derivedMorph.withMetaDo({metaInteraction:true},function(){if(!animationConfig&&![_this73.derivedMorph].concat(_toConsumableArray2(_this73.derivedMorph.ownerChain())).find(function(m){return m.isComponent;})){_this73.derivedMorph.opacity=0;}});return this._hasUnresolvedMaster.then(function(){_this73.applyIfNeeded(needsUpdate);_this73.derivedMorph.withMetaDo({metaInteraction:true},function(){_this73.derivedMorph.opacity=_this73._originalOpacity;});delete _this73._originalOpacity;delete _this73._capturedExtents;});}var target=this.derivedMorph;var master=this.determineMaster(target);if(master&&this._appliedMaster!=master)needsUpdate=true;if(master&&needsUpdate){this.apply(target,master);this._appliedMaster=master;}}},{key:"getStyleProperties",value:function ComponentPolicy_getStyleProperties_(masterComponent){var _masterComponent$prop=masterComponent.propertiesAndPropertySettings(),properties=_masterComponent$prop.properties,order=_masterComponent$prop.order;var styleProps=[];var _iterator41=_createForOfIteratorHelper(order),_step41;try{for(_iterator41.s();!(_step41=_iterator41.n()).done;){var prop=_step41.value;if(properties[prop].isStyleProp){styleProps.push(prop);}}}catch(err){_iterator41.e(err);}finally{_iterator41.f();}return styleProps;}},{key:"apply",value:function ComponentPolicy_apply_(derivedMorph,master){var _this74=this;var animationConfig=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this._animationConfig;if(this._applying)return;this._applying=true;try{var apply=function apply(){var nameToStylableMorph=_this74.prepareSubmorphsToBeManaged(derivedMorph,master);master.withAllSubmorphsDoExcluding(function(masterSubmorph){var isRoot=masterSubmorph==master;var morphToBeStyled=isRoot?derivedMorph:nameToStylableMorph[masterSubmorph.name];if(!morphToBeStyled)return;if(__varRecorder__$u.obj.isArray(morphToBeStyled))morphToBeStyled=morphToBeStyled.pop();if(masterSubmorph.master&&!isRoot){morphToBeStyled.master=masterSubmorph.master.spec();morphToBeStyled._requestMasterStyling=true;if(!_this74._overriddenProps.get(morphToBeStyled).position){morphToBeStyled.position=masterSubmorph.position;}if(!_this74._overriddenProps.get(morphToBeStyled).extent){morphToBeStyled.extent=masterSubmorph.extent;}return;}var _iterator42=_createForOfIteratorHelper(_this74.getStyleProperties(masterSubmorph)),_step42;try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var propName=_step42.value;if(_this74._overriddenProps.get(morphToBeStyled)[propName])continue;if(propName=="layout"){if(morphToBeStyled.layout&&masterSubmorph.layout&&morphToBeStyled.layout.name()==masterSubmorph.layout.name()&&morphToBeStyled.layout.equals(masterSubmorph.layout)){continue;}morphToBeStyled.layout=masterSubmorph.layout?masterSubmorph.layout.copy():undefined;continue;}if(masterSubmorph==master){if(propName=="extent"&&!morphToBeStyled.extent.equals(__varRecorder__$u.pt(10,10))&&(!morphToBeStyled.owner||morphToBeStyled.owner.isWorld||morphToBeStyled.ownerChain().find(function(m){return m.master&&m.master.managesMorph(morphToBeStyled);})))continue;if(propName=="position")continue;}if(morphToBeStyled.isLabel&&propName=="extent")continue;if(["border","borderTop","borderBottom","borderRight","borderLeft"].includes(propName))continue;if(!__varRecorder__$u.obj.equals(morphToBeStyled[propName],masterSubmorph[propName])){morphToBeStyled[propName]=masterSubmorph[propName];}if(["fixedHeight","fixedWidth"].includes(propName)&&morphToBeStyled._parametrizedProps&&morphToBeStyled._parametrizedProps.extent){morphToBeStyled.extent=morphToBeStyled._parametrizedProps.extent;}}}catch(err){_iterator42.e(err);}finally{_iterator42.f();}if(morphToBeStyled._parametrizedProps){delete morphToBeStyled._parametrizedProps;}},function(masterSubmorph){return master!=masterSubmorph&&masterSubmorph.master;});};if(animationConfig){derivedMorph.withAnimationDo(apply,animationConfig).then(function(){delete _this74._animationConfig;_this74._applying=false;});}else derivedMorph.dontRecordChangesWhile(apply);}finally{if(!animationConfig)this._applying=false;delete derivedMorph._parametrizedProps;}}},{key:"clearOverriddenPropertiesFor",value:function ComponentPolicy_clearOverriddenPropertiesFor_(derivedMorph,propsToClear){var spec=this._overriddenProps.get(derivedMorph);this._overriddenProps.set(derivedMorph,__varRecorder__$u.obj.dissoc(spec,propsToClear));}},{key:"prepareSubmorphsToBeManaged",value:function ComponentPolicy_prepareSubmorphsToBeManaged_(derivedMorph,master){var _this75=this;var nameToStylableMorph={};derivedMorph.withAllSubmorphsDoExcluding(function(m){if(nameToStylableMorph[m.name]){if(!__varRecorder__$u.obj.isArray(nameToStylableMorph[m.name])){nameToStylableMorph[m.name]=[nameToStylableMorph[m.name],m];}else nameToStylableMorph[m.name].push(m);}nameToStylableMorph[m.name]=m;},function(m){return m!=derivedMorph&&m.master;});master.withAllSubmorphsDoExcluding(function(masterSubmorph){var morphToBeStyled=masterSubmorph==master?derivedMorph:nameToStylableMorph[masterSubmorph.name];if(!morphToBeStyled)return;if(__varRecorder__$u.obj.isArray(morphToBeStyled))morphToBeStyled=morphToBeStyled.pop();_this75.prepareMorphToBeManaged(morphToBeStyled);},function(masterSubmorph){return masterSubmorph!=master&&masterSubmorph.master;});return nameToStylableMorph;}},{key:"managedMorphs",get:function get(){var _this76=this;var nameToMorphs=__varRecorder__$u.arr.groupBy(this.derivedMorph.withAllSubmorphsSelect(function(m){return _this76.managesMorph(m);}),function(m){return m.name;});for(var name in nameToMorphs){nameToMorphs[name]=nameToMorphs[name][0];}return nameToMorphs;}},{key:"reconcileSubmorphs",value:function ComponentPolicy_reconcileSubmorphs_(){var _this77=this;var managedMorphs=this.managedMorphs;var insertedMorphs=[];var master=this._appliedMaster;managedMorphs[master.name]=this.derivedMorph;if(!master)return;master.withAllSubmorphsDo(function(masterSubmorph){if(masterSubmorph==master){insertedMorphs.push(masterSubmorph,_this77.derivedMorph);return;}var morphToInsert;if(morphToInsert=managedMorphs[masterSubmorph.name]){if(morphToInsert.owner.name==masterSubmorph.owner.name){insertedMorphs.push(morphToInsert);return;}var ownerToBeAddedTo;if(ownerToBeAddedTo=managedMorphs[masterSubmorph.owner.name]){var insertionIndex=masterSubmorph.owner.submorphs.indexOf(masterSubmorph);insertedMorphs.push(ownerToBeAddedTo.addMorphAt(morphToInsert,insertionIndex));return;}throw new Error("Missing a owner that had to be added previously....");}else{morphToInsert=managedMorphs[masterSubmorph.name]=masterSubmorph.copy();var _ownerToBeAddedTo=managedMorphs[masterSubmorph.owner.name];var _insertionIndex=masterSubmorph.owner.submorphs.indexOf(masterSubmorph);morphToInsert.submorphs=[];insertedMorphs.push(_ownerToBeAddedTo.addMorphAt(morphToInsert,_insertionIndex));}});Object.values(__varRecorder__$u.obj.dissoc(managedMorphs,insertedMorphs.map(function(m){return m.name;}))).forEach(function(removedMorph){console.log(managedMorphs,insertedMorphs.map(function(m){return m.name;}));removedMorph.remove();});}},{key:"managesMorph",value:function ComponentPolicy_managesMorph_(m){return this._overriddenProps.has(m);}},{key:"propsToSerializeForMorph",value:function ComponentPolicy_propsToSerializeForMorph_(m,candidateProps){if(!this.managesMorph(m))return candidateProps;var excludedProps=[];var _iterator43=_createForOfIteratorHelper(this.getStyleProperties(m)),_step43;try{for(_iterator43.s();!(_step43=_iterator43.n()).done;){var propName=_step43.value;if(this._overriddenProps.get(m)[propName])continue;if(propName=="position"&&m==this.derivedMorph)continue;if(propName=="extent"&&m==this.derivedMorph)continue;excludedProps.push(propName);}}catch(err){_iterator43.e(err);}finally{_iterator43.f();}return __varRecorder__$u.arr.withoutAll(candidateProps,excludedProps);}},{key:"prepareMorphToBeManaged",value:function ComponentPolicy_prepareMorphToBeManaged_(derivedSubmorph){if(!this._overriddenProps.has(derivedSubmorph)){var spec={};for(var prop in derivedSubmorph._parametrizedProps){if(prop=="__takenFromSnapshot__")continue;spec[prop]=true;}this._overriddenProps.set(derivedSubmorph,spec);}}},{key:"determineMaster",value:function ComponentPolicy_determineMaster_(target){var mode=target.env.world.colorScheme;var isHovered=target.env.eventDispatcher.isMorphHovered(target);var isClicked=target.env.eventDispatcher.isMorphClicked(target);var master=this.getMasterForState(this,{isHovered:isHovered,isClicked:isClicked});if(this.light&&mode=="light"){master=this.getMasterForState(this.light,{isHovered:isHovered,isClicked:isClicked})||master;}if(this.dark&&mode=="dark"){master=this.getMasterForState(this.light,{isHovered:isHovered,isClicked:isClicked})||master;}return master;}},{key:"getMasterForState",value:function ComponentPolicy_getMasterForState_(_ref43,_ref44){var auto=_ref43.auto,hover=_ref43.hover,click=_ref43.click;var isHovered=_ref44.isHovered,isClicked=_ref44.isClicked;var master=auto;if(isHovered){if(hover)master=hover;else{var superMaster=master&&master.master;while(superMaster){if(superMaster.hover){master=superMaster.hover;break;}superMaster=superMaster.auto;}}}if(isClicked){if(click)master=click;else{var _superMaster=master&&master.master;while(_superMaster){if(_superMaster.click){master=_superMaster.click;break;}_superMaster=_superMaster.auto;}}}return master;}},{key:"onMorphChange",value:function ComponentPolicy_onMorphChange_(morph,change){if(this._applying)return;if(__varRecorder__$u.Path("meta.metaInteraction").get(change))return;if(["_rev","name","master"].includes(change.prop))return;if(change.prop=="opacity")delete this._originalOpacity;if(morph.styleProperties.includes(change.prop)){if(this.managesMorph(morph)){if(morph.master&&morph.master!=this){if(!["extent","position"].includes(change.prop))return;}this._overriddenProps.get(morph)[change.prop]=true;return;}if(morph._parametrizedProps)morph._parametrizedProps[change.prop]=change.value;else morph._parametrizedProps=_defineProperty({},change.prop,change.value);}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ComponentPolicy";}},{key:"for",value:function ComponentPolicy_for_(derivedMorph,args){var newPolicy;if(args.constructor===__varRecorder__$u.ComponentPolicy)newPolicy=args;else newPolicy=new this(derivedMorph,args);if(derivedMorph.master){newPolicy._overriddenProps=derivedMorph.master._overriddenProps;}return newPolicy;}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"style-guide.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:2027,end:22180});}(undefined);__varRecorder__$u.ComponentPolicy=ComponentPolicy;__varRecorder__$u.ComponentPolicy=ComponentPolicy;__varRecorder__$u.ComponentPolicy=ComponentPolicy;__varRecorder__$u.styleGuideURLRe=/^styleguide:\/\/([^\/]+)\/(.*)$/;__varRecorder__$u.fetchedSnapshots=__varRecorder__$u.fetchedSnapshots||{};__varRecorder__$u.objectPools=__varRecorder__$u.objectPools||{};__varRecorder__$u.resolvedMasters=__varRecorder__$u.resolvedMasters||{};__varRecorder__$u.modulesToLoad=__varRecorder__$u.modulesToLoad||{};__varRecorder__$u.li=__varRecorder__$u.li||undefined;__varRecorder__$u.localNamePromise=__varRecorder__$u.localNamePromise||undefined;__varRecorder__$u.masterComponentFetches=__varRecorder__$u.masterComponentFetches||{};__varRecorder__$u.worldToUrl=__varRecorder__$u.worldToUrl||{};var resolvedMasters=__varRecorder__$u.resolvedMasters;__varRecorder__$u.resolvedMasters=resolvedMasters;__varRecorder__$u.resolvedMasters=resolvedMasters;__varRecorder__$u.clearSnapshot=clearSnapshot;__varRecorder__$u.clearSnapshot=clearSnapshot;var StyleGuideResource=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/style-guide.js");var __lively_class__=__lively_classholder__.hasOwnProperty("StyleGuideResource")&&typeof __lively_classholder__.StyleGuideResource==="function"?__lively_classholder__.StyleGuideResource:__lively_classholder__.StyleGuideResource=function StyleGuideResource(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"canDealWithJSON",get:function get(){return false;}},{key:"componentName",get:function get(){var match=this.url.match(__varRecorder__$u.styleGuideURLRe);var _match=_slicedToArray2(match,3),_=_match[0],worldName=_match[1],name=_match[2];return name;}},{key:"worldName",get:function get(){var match=this.url.match(__varRecorder__$u.styleGuideURLRe);var _match2=_slicedToArray2(match,3),_=_match2[0],worldName=_match2[1],name=_match2[2];if(!lively.FreezerRuntime&&worldName=="$world")worldName=this.localWorldName();return worldName;}},{key:"dirList",value:function(){var _StyleGuideResource_dirList_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee66(depth,opts){var remoteMasters;return regeneratorRuntime.wrap(function _callee66$(_context66){while(1){switch(_context66.prev=_context66.next){case 0:if(!(this.worldName==__varRecorder__$u.getProjectName($world))){_context66.next=2;break;}return _context66.abrupt("return",$world.withAllSubmorphsSelect(function(m){return m.isComponent;}));case 2:remoteMasters=__varRecorder__$u.resolvedMasters[this.worldName];if(!remoteMasters){_context66.next=5;break;}return _context66.abrupt("return",Object.values(remoteMasters));case 5:return _context66.abrupt("return",[]);case 6:case"end":return _context66.stop();}}},_callee66,this);}));function StyleGuideResource_dirList_(_x100,_x101){return _StyleGuideResource_dirList_.apply(this,arguments);}return StyleGuideResource_dirList_;}()},{key:"localWorldName",value:function StyleGuideResource_localWorldName_(){var localName;if(localName=__varRecorder__$u.getProjectName($world)){return localName;}if(__varRecorder__$u.localNamePromise){return __varRecorder__$u.localNamePromise;}var resolve;var _varRecorder__$u$pro=__varRecorder__$u.promise.deferred();resolve=_varRecorder__$u$pro.resolve;__varRecorder__$u.localNamePromise=_varRecorder__$u$pro.promise;if(__varRecorder__$u.resource(document.location.href).query().name=="__newWorld__"){resolve("__newWorld__");return __varRecorder__$u.localNamePromise;}__varRecorder__$u.subscribeOnce("world/loaded",function(){resolve(__varRecorder__$u.getProjectName($world));},System);return __varRecorder__$u.localNamePromise;}},{key:"fetchFromMasterDir",value:function StyleGuideResource_fetchFromMasterDir_(masterDir,name){var res=masterDir.join(this.worldName).join(name+".json");if(__varRecorder__$u.masterComponentFetches[res.url])return __varRecorder__$u.masterComponentFetches[res.url];__varRecorder__$u.masterComponentFetches[res.url]=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee67(){return regeneratorRuntime.wrap(function _callee67$(_context67){while(1){switch(_context67.prev=_context67.next){case 0:_context67.t0=__varRecorder__$u;_context67.next=3;return res.readJson();case 3:_context67.t1=_context67.sent;return _context67.abrupt("return",_context67.t0.deserializeMorph.call(_context67.t0,_context67.t1));case 5:case"end":return _context67.stop();}}},_callee67);}))();return __varRecorder__$u.masterComponentFetches[res.url];}},{key:"read",value:function(){var _StyleGuideResource_read_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee68(){var name,component,rootDir,masterDir,resolveSnapshot,_varRecorder__$u$pro2,_snapshot,db,jsonRes,pool,_ref46,_ref47,idToDeserialize,_iterator44,_step44,master;return regeneratorRuntime.wrap(function _callee68$(_context68){while(1){switch(_context68.prev=_context68.next){case 0:name=this.componentName;component=__varRecorder__$u.Path([this.worldName,this.componentName]).get(__varRecorder__$u.resolvedMasters);if(!component){_context68.next=4;break;}return _context68.abrupt("return",component);case 4:if(!lively.FreezerRuntime){_context68.next=11;break;}rootDir=__varRecorder__$u.resource(window.location);if(rootDir.isFile())rootDir=rootDir.parent();masterDir=rootDir.join("masters/");_context68.next=10;return this.fetchFromMasterDir(masterDir,name);case 10:component=_context68.sent;case 11:if(lively.FreezerRuntime){_context68.next=57;break;}if(!__varRecorder__$u.fetchedSnapshots[this.worldName]){console.log("scheduling fetch of",this.worldName);_varRecorder__$u$pro2=__varRecorder__$u.promise.deferred();resolveSnapshot=_varRecorder__$u$pro2.resolve;__varRecorder__$u.fetchedSnapshots[this.worldName]=_varRecorder__$u$pro2.promise;}_context68.next=15;return this.localWorldName();case 15:_context68.t0=_context68.sent;_context68.t1=this.worldName;if(!(_context68.t0==_context68.t1)){_context68.next=22;break;}component=typeof $world!=="undefined"&&$world.getSubmorphNamed(name);if(component){_context68.next=21;break;}throw Error("Master component \"".concat(name,"\" can not be found in \"").concat(this.worldName,"\""));case 21:return _context68.abrupt("return",component);case 22:if(!resolveSnapshot){_context68.next=49;break;}db=__varRecorder__$u.MorphicDB["default"];_context68.next=26;return db.fetchCommit("world",this.worldName);case 26:if(!_context68.sent){_context68.next=33;break;}_context68.next=29;return db.fetchSnapshot("world",this.worldName);case 29:_snapshot=_context68.sent;__varRecorder__$u.worldToUrl[this.worldName]=__varRecorder__$u.resource(System.baseURL).join("worlds/load").withQuery({name:this.worldName}).url;_context68.next=44;break;case 33:jsonRes=__varRecorder__$u.resource(System.baseURL).join("lively.morphic/styleguides").join(this.worldName+".json");_context68.next=36;return jsonRes.exists();case 36:if(!_context68.sent){_context68.next=43;break;}_context68.next=39;return jsonRes.readJson();case 39:_snapshot=_context68.sent;__varRecorder__$u.worldToUrl[this.worldName]=__varRecorder__$u.resource(System.baseURL).join("worlds/load").withQuery({file:"lively.morphic/styleguides/"+this.worldName+".json"}).url;_context68.next=44;break;case 43:resolveSnapshot(null);case 44:_context68.next=46;return __varRecorder__$u.loadPackagesAndModulesOfSnapshot(_snapshot);case 46:resolveSnapshot(_snapshot);_context68.next=52;break;case 49:_context68.next=51;return __varRecorder__$u.fetchedSnapshots[this.worldName];case 51:_snapshot=_context68.sent;case 52:pool=new __varRecorder__$u.ObjectPool(__varRecorder__$u.normalizeOptions({}));_ref46=Object.entries(_snapshot.snapshot).find(function(_ref48){var _ref49=_slicedToArray2(_ref48,2),k=_ref49[0],v=_ref49[1];return __varRecorder__$u.Path("props.isComponent.value").get(v)&&__varRecorder__$u.Path("props.name.value").get(v)==name;})||[],_ref47=_slicedToArray2(_ref46,1),idToDeserialize=_ref47[0];if(idToDeserialize){_context68.next=56;break;}throw Error("Master component \"".concat(name,"\" can not be found in \"").concat(this.worldName,"\""));case 56:component=pool.resolveFromSnapshotAndId(Object.assign({},_snapshot,{id:idToDeserialize}));case 57:if(__varRecorder__$u.resolvedMasters[this.worldName])__varRecorder__$u.resolvedMasters[this.worldName][name]=component;else __varRecorder__$u.resolvedMasters[this.worldName]=_defineProperty({},name,component);component._resourceHandle=this;if(!component._pool.mastersInSubHierarchy){_context68.next=79;break;}_iterator44=_createForOfIteratorHelper(component._pool.mastersInSubHierarchy);_context68.prev=61;_iterator44.s();case 63:if((_step44=_iterator44.n()).done){_context68.next=70;break;}master=_step44.value;_context68.next=67;return master.applyIfNeeded(true);case 67:if(!master.derivedMorph.ownerChain().includes(component)){master.derivedMorph.requestMasterStyling();}case 68:_context68.next=63;break;case 70:_context68.next=75;break;case 72:_context68.prev=72;_context68.t2=_context68["catch"](61);_iterator44.e(_context68.t2);case 75:_context68.prev=75;_iterator44.f();return _context68.finish(75);case 78:delete component._pool;case 79:return _context68.abrupt("return",Promise.resolve(component));case 80:case"end":return _context68.stop();}}},_callee68,this,[[61,72,75,78]]);}));function StyleGuideResource_read_(){return _StyleGuideResource_read_.apply(this,arguments);}return StyleGuideResource_read_;}()},{key:"write",value:function(){var _StyleGuideResource_write_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee69(source){return regeneratorRuntime.wrap(function _callee69$(_context69){while(1){switch(_context69.prev=_context69.next){case 0:throw Error("Master Components can not be written to!");case 1:case"end":return _context69.stop();}}},_callee69);}));function StyleGuideResource_write_(_x102){return _StyleGuideResource_write_.apply(this,arguments);}return StyleGuideResource_write_;}()},{key:"exists",value:function(){var _StyleGuideResource_exists_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee70(){var component;return regeneratorRuntime.wrap(function _callee70$(_context70){while(1){switch(_context70.prev=_context70.next){case 0:component=typeof $world!=="undefined"&&$world.getSubmorphNamed(this.morphName);return _context70.abrupt("return",component&&component.isComponent);case 2:case"end":return _context70.stop();}}},_callee70,this);}));function StyleGuideResource_exists_(){return _StyleGuideResource_exists_.apply(this,arguments);}return StyleGuideResource_exists_;}()},{key:"remove",value:function(){var _StyleGuideResource_remove_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee71(){var component;return regeneratorRuntime.wrap(function _callee71$(_context71){while(1){switch(_context71.prev=_context71.next){case 0:component=typeof $world!=="undefined"&&$world.getSubmorphNamed(this.morphName);if(component)component.isComponent=false;return _context71.abrupt("return",true);case 3:case"end":return _context71.stop();}}},_callee71,this);}));function StyleGuideResource_remove_(){return _StyleGuideResource_remove_.apply(this,arguments);}return StyleGuideResource_remove_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"StyleGuideResource";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"style-guide.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:25891,end:31409});}(__varRecorder__$u.Resource);var resourceExtension$3={name:"styleguide",matches:function matches(url){return url.match(__varRecorder__$u.styleGuideURLRe);},resourceClass:__varRecorder__$u.StyleGuideResource};__varRecorder__$u.resourceExtension=resourceExtension$3;__varRecorder__$u.resourceExtension=resourceExtension$3;__varRecorder__$u.resourceExtension=resourceExtension$3;__varRecorder__$u.registerExtension(__varRecorder__$u.resourceExtension);var StyleGuide=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/style-guide.js");var __lively_class__=__lively_classholder__.hasOwnProperty("StyleGuide")&&typeof __lively_classholder__.StyleGuide==="function"?__lively_classholder__.StyleGuide:__lively_classholder__.StyleGuide=function StyleGuide(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,undefined,undefined,__lively_classholder__,{pathInPackage:function pathInPackage(){return"style-guide.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:31595,end:32079});}(undefined);var __varRecorder__$v=lively.FreezerRuntime.recorderFor("lively.morphic/morph.js");function generateUnfolded(propName){var members=arguments.length>1&&arguments[1]!==undefined?arguments[1]:["top","left","right","bottom"];var group=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"core";var propertyDeclarations={};var _iterator45=_createForOfIteratorHelper(members),_step45;try{var _loop6=function _loop6(){var m=_step45.value;propertyDeclarations[propName+__varRecorder__$v.string.capitalize(m)]={group:group,derived:true,generated:true,after:[propName],get:function get(){return this.getProperty(propName)[m];},set:function set(v){this[propName]=Object.assign({},this.getProperty(propName),_defineProperty({},m,v));}};};for(_iterator45.s();!(_step45=_iterator45.n()).done;){_loop6();}}catch(err){_iterator45.e(err);}finally{_iterator45.f();}return propertyDeclarations;}__varRecorder__$v.generateUnfolded=generateUnfolded;__varRecorder__$v.Color=Color$1;__varRecorder__$v.Line=Line;__varRecorder__$v.Point=Point;__varRecorder__$v.pt=pt;__varRecorder__$v.rect=rect;__varRecorder__$v.Rectangle=Rectangle;__varRecorder__$v.Transform=Transform;__varRecorder__$v.string=string;__varRecorder__$v.properties=properties;__varRecorder__$v.obj=obj;__varRecorder__$v.arr=arr;__varRecorder__$v.num=num;__varRecorder__$v.promise=promise;__varRecorder__$v.tree=tree;__varRecorder__$v.PropertyPath=Path;__varRecorder__$v.signal=signal;__varRecorder__$v.copy=copy;__varRecorder__$v.deserializeSpec=deserializeSpec;__varRecorder__$v.ExpressionSerializer=ExpressionSerializer;__varRecorder__$v.serializeSpec=serializeSpec;__varRecorder__$v.getClassName=getClassName;__varRecorder__$v.renderRootMorph=renderRootMorph;__varRecorder__$v.ShadowObject=ShadowObject;__varRecorder__$v.AnimationQueue=AnimationQueue;__varRecorder__$v.easings=easings;__varRecorder__$v.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;__varRecorder__$v.Icon=Icon;__varRecorder__$v.morph=morph;__varRecorder__$v.newMorphId=newMorphId;__varRecorder__$v.MorphicEnv=MorphicEnv;__varRecorder__$v.config=config;__varRecorder__$v.CommandHandler=CommandHandler$1;__varRecorder__$v.KeyHandler=KeyHandler$1;__varRecorder__$v.findKeysForPlatform=findKeysForPlatform;__varRecorder__$v.TargetScript=TargetScript;__varRecorder__$v.copyMorph=copyMorph;__varRecorder__$v.ComponentPolicy=ComponentPolicy;__varRecorder__$v.defaultCommandHandler=new __varRecorder__$v.CommandHandler();var Morph=exports('M',function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Morph")&&typeof __lively_classholder__.Morph==="function"?__lively_classholder__.Morph:__lively_classholder__.Morph=function Morph(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Morph_initialize_(props){if(!props)props={};var env=props.env||__varRecorder__$v.MorphicEnv["default"]();this._env=env;this._rev=env.changeManager.revision;this._owner=null;this._dirty=true;this._rendering=false;this._submorphOrderChanged=false;this._id=__varRecorder__$v.newMorphId(__varRecorder__$v.getClassName(this));this._animationQueue=new __varRecorder__$v.AnimationQueue(this);this._cachedPaths={};this._pathDependants=[];this._tickingScripts=[];this._parametrizedProps=__varRecorder__$v.obj.select(props,__varRecorder__$v.arr.intersect(Object.keys(props),this.styleProperties));this.initializeProperties(props);if(props.bounds){this.setBounds(props.bounds);this._parametrizedProps.extent=this.extent;this._parametrizedProps.position=this.position;}if(props.height!=undefined||props.width!=undefined){this._parametrizedProps.extent=this.extent;}if(props.layout)this.layout=props.layout;if(typeof this.onLoad==="function"&&!this.isComponent)this.onLoad();}},{key:"__serialization_id_property__",get:function get(){return"_id";}},{key:"__deserialize__",value:function Morph___deserialize___(snapshot,objRef,serializedMap,pool){this._env=__varRecorder__$v.MorphicEnv["default"]();this._rev=snapshot.rev;this._owner=null;this._dirty=true;this._rendering=false;this._submorphOrderChanged=false;this._id=objRef.id;this._animationQueue=new __varRecorder__$v.AnimationQueue(this);this._cachedPaths={};this._pathDependants=[];this._tickingScripts=[];this._parametrizedProps=__varRecorder__$v.obj.select(snapshot.props,__varRecorder__$v.arr.intersect(Object.keys(snapshot.props),this.styleProperties));this._parametrizedProps.__takenFromSnapshot__=true;var s=pool.expressionSerializer;for(var prop in this._parametrizedProps){var _v3=this._parametrizedProps[prop].value;if(_v3&&__varRecorder__$v.obj.isString(_v3)&&s.isSerializedExpression(_v3)){this._parametrizedProps[prop]=s.deserializeExpr(_v3);}}this.initializeProperties();this._pool=pool;}},{key:"__after_deserialize__",value:function Morph___after_deserialize___(snapshot,ref,pool){this.resumeStepping();if(typeof this.onLoad==="function"){try{this.onLoad();}catch(e){console.error("[lively.morphic] ".concat(this,".onLoad() error: ").concat(e.stack));}}if(!this.isComponent||this.owner)delete this._pool;if(this.master){if(pool.mastersInSubHierarchy){pool.mastersInSubHierarchy.push(this.master);}else{pool.mastersInSubHierarchy=[this.master];}}}},{key:"__only_serialize__",get:function get(){var defaults=this.defaultProperties;var properties=this.propertiesAndPropertySettings().properties;var propsToSerialize=[];if(this._tickingScripts.length>0)propsToSerialize.push("_tickingScripts");if(this.attributeConnections)propsToSerialize.push("attributeConnections");var master=[this].concat(_toConsumableArray2(this.ownerChain())).map(function(m){return m.__isBeingSerialized__&&m.master;}).find(Boolean);for(var key in properties){var descr=properties[key];if(master&&master.managesMorph(this)&&master._overriddenProps.get(this)[key]!=undefined){propsToSerialize.push(key);continue;}if(descr.readOnly||descr.derived||__varRecorder__$v.obj.equals(this[key],defaults[key])||descr.hasOwnProperty("serialize")&&!descr.serialize)continue;propsToSerialize.push(key);}if(master&&!this.isComponent){return master.propsToSerializeForMorph(this,propsToSerialize);}return propsToSerialize;}},{key:"__additionally_serialize__",value:function Morph___additionally_serialize___(snapshot,ref,pool,addFn){var submorphs=snapshot.props.submorphs;if(submorphs&&!this.isEpiMorph){submorphs=submorphs.value;for(var _i95=submorphs.length;_i95--;){var id=submorphs[_i95].id;if(pool.refForId(id).realObj.isEpiMorph){__varRecorder__$v.arr.removeAt(submorphs,_i95);}}}var _iterator46=_createForOfIteratorHelper(__varRecorder__$v.arr.intersect(this.__only_serialize__,["borderColor","borderWidth","borderStyle","borderRadius"])),_step46;try{for(_iterator46.s();!(_step46=_iterator46.n()).done;){var foldedProp=_step46.value;snapshot.props[foldedProp]={key:foldedProp,verbatim:true,value:__varRecorder__$v.obj.extract(this[foldedProp],["top","right","bottom","left"],function(prop,value){return value&&value.isColor?value.toTuple():value;})};}}catch(err){_iterator46.e(err);}finally{_iterator46.f();}}},{key:"isMorph",get:function get(){return true;}},{key:"id",get:function get(){return this._id;}},{key:"env",get:function get(){return this._env;}},{key:"spec",value:function Morph_spec_(){var skipUnchangedFromDefault=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var seenMorphs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new WeakMap();var defaults=this.defaultProperties;var properties=this.propertiesAndPropertySettings().properties;var ignored={submorphs:true};var spec={};if(seenMorphs.has(this))return seenMorphs.get(this);seenMorphs.set(this,spec);for(var key in properties){var descr=properties[key];if(!descr)continue;if(descr.readOnly||descr.derived||descr.hasOwnProperty("serialize")&&!descr.serialize||key in ignored)continue;if(skipUnchangedFromDefault){if(__varRecorder__$v.obj.equals(this[key],defaults[key])||this[key]&&defaults[key]&&this[key].valueOf&&defaults[key].valueOf&&__varRecorder__$v.obj.equals(this[key].valueOf(),defaults[key].valueOf())){continue;}}if(this[key]&&this[key].isMorph){spec[key]=this[key].spec(skipUnchangedFromDefault,seenMorphs);continue;}if(this[key]&&key==="layout"){spec[key]=this[key].copy();continue;}spec[key]=this[key];}spec.submorphs=this.submorphs.map(function(ea){return ea.spec(skipUnchangedFromDefault,seenMorphs);});spec.type=this.constructor;return spec;}},{key:"printSpec",value:function Morph_printSpec_(){var spec=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var depth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;spec=spec||this.spec();var priority={name:true,type:true,submorphs:true};var singleIndent="  ";var propIndent=singleIndent.repeat(depth+1);var printed=singleIndent.repeat(depth)+"{\n"+"".concat(propIndent,"name: \"").concat(spec.name,"\",\n")+"".concat(propIndent,"type: \"").concat(spec.type,"\",\n");for(var key in spec){if(!priority[key]){printed=printed+"".concat(propIndent).concat(key,": ").concat(__varRecorder__$v.string.print(spec[key]),",\n");}}if(spec.submorphs){printed+="".concat(propIndent,"submorphs: [\n");var _iterator47=_createForOfIteratorHelper(spec.submorphs),_step47;try{for(_iterator47.s();!(_step47=_iterator47.n()).done;){var subspec=_step47.value;printed+=this.printSpec(subspec,depth+1);}}catch(err){_iterator47.e(err);}finally{_iterator47.f();}printed+="]\n";}printed+=singleIndent.repeat(depth)+"}\n";return printed;}},{key:"defaultProperties",get:function get(){var klass=this.constructor;var superklass=klass[Symbol["for"]("lively-instance-superclass")];if(!klass._morphicDefaultPropertyValues||klass._morphicDefaultPropertyValues==(superklass&&superklass._morphicDefaultPropertyValues)){var defaults=this.constructor._morphicDefaultPropertyValues={};var propDescriptors=this.propertiesAndPropertySettings().properties;for(var key in propDescriptors){var descr=propDescriptors[key];if(descr.hasOwnProperty("defaultValue")){var val=descr.defaultValue;if(Array.isArray(val))val=val.slice();defaults[key]=val;}}}return this.constructor._morphicDefaultPropertyValues;}},{key:"defaultProperty",value:function Morph_defaultProperty_(key){return this.defaultProperties[key];}},{key:"getProperty",value:function Morph_getProperty_(key){return this._morphicState[key];}},{key:"setProperty",value:function Morph_setProperty_(key,value,meta){return this.addValueChange(key,value,meta);}},{key:"changeMetaData",value:function Morph_changeMetaData_(path,data){var serialize=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var merge=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var metadata=this.metadata;if(!metadata)metadata={};new __varRecorder__$v.PropertyPath(path).withParentAndKeyDo(metadata,true,function(parent,key){if(merge)parent[key]=Object.assign({},parent[key],{},data);else parent[key]=data;var dont=parent.__dont_serialize__;if(!serialize){if(!dont)dont=parent.__dont_serialize__=[];__varRecorder__$v.arr.pushIfNotIncluded(dont,key);}else{if(dont&&dont.includes(key)){__varRecorder__$v.arr.remove(dont,key);if(dont.length===0)delete parent.__dont_serialize__;}}});this.metadata=metadata;}},{key:"installFont",value:function Morph_installFont_(name,fontUrl){this.installedFonts=Object.assign({},this.installedFonts,_defineProperty({},name,fontUrl));this.insertFontCSS(name,fontUrl);}},{key:"uninstallFont",value:function Morph_uninstallFont_(name){delete this.installedFonts[name];var node=document.getElementById("".concat(this.id,"-").concat(name));if(node)node.remove();}},{key:"ensureInstalledFonts",value:function Morph_ensureInstalledFonts_(removedFonts,addedFonts){var _iterator48=_createForOfIteratorHelper(removedFonts),_step48;try{for(_iterator48.s();!(_step48=_iterator48.n()).done;){var name=_step48.value;var node=document.getElementById("".concat(this.id,"-").concat(name));if(node)node.remove();}}catch(err){_iterator48.e(err);}finally{_iterator48.f();}var _iterator49=_createForOfIteratorHelper(addedFonts),_step49;try{for(_iterator49.s();!(_step49=_iterator49.n()).done;){var _name2=_step49.value;this.insertFontCSS(_name2,this.installedFonts[_name2]);}}catch(err){_iterator49.e(err);}finally{_iterator49.f();}}},{key:"insertFontCSS",value:function(){var _Morph_insertFontCSS_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee72(name,fontUrl){return regeneratorRuntime.wrap(function _callee72$(_context72){while(1){switch(_context72.prev=_context72.next){case 0:_context72.next=2;return this.whenRendered();case 2:if(fontUrl.endsWith(".otf")){__varRecorder__$v.addOrChangeCSSDeclaration("".concat(this.id,"-").concat(name),"@font-face {\n             font-family: ".concat(name,";\n             src: url(\"").concat(this.installedFonts[name],"\") format(\"opentype\");\n         }"));}else __varRecorder__$v.addOrChangeCSSDeclaration("".concat(this.id,"-").concat(name),"@import url(\"".concat(this.installedFonts[name],"\");"));case 3:case"end":return _context72.stop();}}},_callee72,this);}));function Morph_insertFontCSS_(_x103,_x104){return _Morph_insertFontCSS_.apply(this,arguments);}return Morph_insertFontCSS_;}()},{key:"toString",value:function Morph_toString_(){return"<".concat(__varRecorder__$v.getClassName(this)," - ").concat(this.name?this.name:this.id,">");}},{key:"edit",value:function Morph_edit_(opts){return this.env.world.execCommand("open object editor",Object.assign({className:__varRecorder__$v.getClassName(this)},opts,{target:this}));}},{key:"inspect",value:function Morph_inspect_(opts){return this.env.world.execCommand("open object inspector",Object.assign({},opts,{target:this}));}},{key:"livelyCustomInspect",value:function Morph_livelyCustomInspect_(){var ignored={_id:true,_owner:true};var seen={};var props=this.propertiesAndPropertySettings().properties;var properties=[];for(var key in props){if(ignored[key]||props[key].derived&&!props[key].showInInspector)continue;seen[key]=true;properties.push({key:key,value:this[key]});}properties.push({key:"id",value:this.id});properties.push({key:"owner",value:this.owner});properties=properties.sort(function(a,b){var aK=a.key.toLowerCase();var bK=b.key.toLowerCase();return aK<bK?-1:aK===bK?0:1;});var morphInternals=["attributeConnections","_animationQueue","_morphicState","_dirty","doNotCopyProperties","doNotSerialize","_env","_cachedPaths","_pathDependants","_rendering","_rev","_submorphOrderChanged","_tickingScripts","_transform","_invTransform","_styleSheetProps","_renderer","_tooltipViewer","layout"];if(this.attributeConnections){var _iterator50=_createForOfIteratorHelper(this.attributeConnections),_step50;try{for(_iterator50.s();!(_step50=_iterator50.n()).done;){var _c6=_step50.value;ignored[("$$".concat(_c6.sourceAttrName),"".concat(_c6.sourceAttrName))]=true;}}catch(err){_iterator50.e(err);}finally{_iterator50.f();}}Object.assign(seen,ignored);for(var _i96=0,_morphInternals=morphInternals;_i96<_morphInternals.length;_i96++){var _key12=_morphInternals[_i96];if(!(_key12 in this))continue;seen[_key12]=true;properties.push({key:_key12,value:this[_key12],keyString:"[internal] ".concat(_key12)});}for(var _key13 in this){if(seen[_key13]||!this.hasOwnProperty(_key13))continue;properties.unshift({key:_key13,value:this[_key13],keyString:"[UNKNOWN PROPERTY] ".concat(_key13)});}return{sort:false,includeDefault:false,properties:properties};}},{key:"show",value:function Morph_show_(loop){return $world.execCommand("show morph",{morph:this,loop:loop});}},{key:"setStatusMessage",value:function Morph_setStatusMessage_(msg,color,delay,opts){var w=this.world();opts=Object.assign({maxLines:7},opts);return w?w.setStatusMessageFor(this,msg,color,delay,opts):console.log(msg);}},{key:"showError",value:function Morph_showError_(err){var w=this.world();return w?w.showErrorFor(this,err):console.error(err);}},{key:"onChange",value:function Morph_onChange_(change){var _this78=this;var anim=change.meta&&change.meta.animation;var prop=change.prop,value=change.value;if(prop==="position"||prop==="rotation"||prop==="scale"||prop==="origin"||prop==="reactsToPointer"){this.onBoundsChanged(this.bounds());this.updateTransform(_defineProperty({},prop,value));}else if(prop=="extent"){this.onBoundsChanged(this.bounds());}else if(prop=="layout"){if(anim){value&&value.attachAnimated(anim.duration,this,anim.easing);}else{value&&value.attach();}}this.layout&&this.layout.onChange(change);if(this.isComponent&&!__varRecorder__$v.PropertyPath("meta.metaInteraction").get(change)){var world=this.world();var derivedMorphs=world?world.withAllSubmorphsSelect(function(m){return m.master&&m.master.uses(_this78);}):[];derivedMorphs.forEach(function(m){m.requestMasterStyling();});}if(this.master){this.master.onMorphChange(this,change);}}},{key:"onBoundsChanged",value:function Morph_onBoundsChanged_(bounds){var _this79=this;__varRecorder__$v.signal(this,"bounds",bounds);[].concat(_toConsumableArray2(bounds.corners),_toConsumableArray2(bounds.sides)).forEach(function(c){__varRecorder__$v.signal(_this79,c,bounds.partNamed(c));});}},{key:"onSubmorphChange",value:function Morph_onSubmorphChange_(change,submorph){var _this80=this;if(this.isComponent&&!__varRecorder__$v.PropertyPath("meta.metaInteraction").get(change)&&!__varRecorder__$v.PropertyPath("meta.layoutAction").get(change)){var world=this.world();world&&world.withAllSubmorphsDo(function(m){if(m.master&&m.master.uses(_this80)){m.requestMasterStyling();}});}if(this.master){this.master.onMorphChange(submorph,change);}this.layout&&this.layout.onSubmorphChange(submorph,change);}},{key:"changes",get:function get(){return this.env.changeManager.changesFor(this);}},{key:"applyChange",value:function Morph_applyChange_(change){this.env.changeManager.apply(this,change);}},{key:"addValueChange",value:function Morph_addValueChange_(prop,value,meta){return this.env.changeManager.addValueChange(this,prop,value,meta);}},{key:"addMethodCallChangeDoing",value:function Morph_addMethodCallChangeDoing_(spec,doFn){return this.env.changeManager.addMethodCallChangeDoing(spec,this,doFn);}},{key:"groupChangesWhile",value:function Morph_groupChangesWhile_(groupChange,whileFn){return this.env.changeManager.groupChangesWhile(this,groupChange,whileFn);}},{key:"dontRecordChangesWhile",value:function Morph_dontRecordChangesWhile_(whileFn){return this.env.changeManager.dontRecordChangesWhile(this,whileFn);}},{key:"recordChangesWhile",value:function Morph_recordChangesWhile_(whileFn,optFilter){return this.env.changeManager.recordChangesWhile(whileFn,optFilter);}},{key:"recordChangesStart",value:function Morph_recordChangesStart_(optFilter){return this.env.changeManager.recordChangesStartForMorph(this,optFilter);}},{key:"recordChangesStop",value:function Morph_recordChangesStop_(id){return this.env.changeManager.recordChangesStopForMorph(this,id);}},{key:"withMetaDo",value:function Morph_withMetaDo_(meta,doFn){return this.env.changeManager.doWithValueChangeMeta(meta,this,doFn);}},{key:"undoStart",value:function Morph_undoStart_(name){return this.env.undoManager.undoStart(this,name);}},{key:"undoStop",value:function Morph_undoStop_(name){return this.env.undoManager.undoStop(this,name);}},{key:"undoInProgress",get:function get(){return this.env.undoManager.undoInProgress;}},{key:"animate",value:function(){var _Morph_animate_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee73(config){var anim;return regeneratorRuntime.wrap(function _callee73$(_context73){while(1){switch(_context73.prev=_context73.next){case 0:anim=this._animationQueue.registerAnimation(config);if(this._animationQueue.animationsActive){_context73.next=4;break;}anim&&anim.finish();return _context73.abrupt("return",Promise.resolve(this));case 4:if(!anim){_context73.next=8;break;}_context73.next=7;return anim.asPromise();case 7:return _context73.abrupt("return",_context73.sent);case 8:return _context73.abrupt("return",Promise.resolve(this));case 9:case"end":return _context73.stop();}}},_callee73,this);}));function Morph_animate_(_x105){return _Morph_animate_.apply(this,arguments);}return Morph_animate_;}()},{key:"withAnimationDo",value:function(){var _Morph_withAnimationDo_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee74(cb,config){var _this$groupChangesWhi,changes;return regeneratorRuntime.wrap(function _callee74$(_context74){while(1){switch(_context74.prev=_context74.next){case 0:_this$groupChangesWhi=this.groupChangesWhile(false,cb),changes=_this$groupChangesWhi.changes;_context74.next=3;return Promise.all(Object.values(__varRecorder__$v.arr.groupBy(changes,function(change){return change.target.id;})).map(function(changes){var animConfig=Object.assign({},config);var target;changes.forEach(function(change){target=change.target;change.reverseApply();animConfig[change.prop]=change.value;});return target&&target.animate(animConfig);}));case 3:case"end":return _context74.stop();}}},_callee74,this);}));function Morph_withAnimationDo_(_x106,_x107){return _Morph_withAnimationDo_.apply(this,arguments);}return Morph_withAnimationDo_;}()},{key:"isClip",value:function Morph_isClip_(){return this.clipMode!=="visible";}},{key:"scrollExtent",get:function get(){return(this.submorphs.length?this.innerBounds().union(this.submorphBounds()):this.innerBounds()).extent().addPt(this.scrollbarOffset);}},{key:"scrollBounds",value:function Morph_scrollBounds_(){var _this$scroll=this.scroll,x=_this$scroll.x,y=_this$scroll.y;var _this$scrollExtent=this.scrollExtent,w=_this$scrollExtent.x,h=_this$scrollExtent.y;return new __varRecorder__$v.Rectangle(x,y,w,h);}},{key:"scrollDown",value:function Morph_scrollDown_(n){this.scroll=this.scroll.addXY(0,n);}},{key:"scrollUp",value:function Morph_scrollUp_(n){this.scrollDown(-n*50);}},{key:"scrollLeft",value:function Morph_scrollLeft_(n){this.scroll=this.scroll.addXY(n,0);}},{key:"scrollRight",value:function Morph_scrollRight_(n){this.scrollLeft(-n);}},{key:"scrollPageDown",value:function Morph_scrollPageDown_(){this.scrollDown(this.height);}},{key:"scrollPageUp",value:function Morph_scrollPageUp_(){this.scrollUp(this.height);}},{key:"addStyleClass",value:function Morph_addStyleClass_(className){this.styleClasses=__varRecorder__$v.arr.uniq(this.styleClasses.concat(className));}},{key:"removeStyleClass",value:function Morph_removeStyleClass_(className){this.styleClasses=this.styleClasses.filter(function(ea){return ea!=className;});}},{key:"adjustOrigin",value:function Morph_adjustOrigin_(newOrigin){var oldOrigin=this.origin;var oldPos=this.globalBounds().topLeft();this.origin=newOrigin;this.submorphs.forEach(function(m){return m.position=m.position.subPt(newOrigin.subPt(oldOrigin));});var newPos=this.globalBounds().topLeft();var globalDelta=oldPos.subPt(newPos);this.globalPosition=this.globalPosition.addPt(globalDelta);}},{key:"setBounds",value:function Morph_setBounds_(bounds){this.extent=bounds.extent();this.position=bounds.topLeft().addPt(this.origin);}},{key:"innerBounds",value:function Morph_innerBounds_(){var _this$extent=this.extent,w=_this$extent.x,h=_this$extent.y;return __varRecorder__$v.rect(0,0,w,h);}},{key:"relativeBounds",value:function Morph_relativeBounds_(other){var other=other||this.world();var bounds=this.origin.negated().extent(this.extent);if(other){bounds=this.transformRectToMorph(other,bounds);}else{bounds=this.getGlobalTransform().transformRectToRect(bounds);}if(!this.isClip()){this.submorphs.forEach(function(submorph){bounds=bounds.union(submorph.relativeBounds(other));});}return bounds;}},{key:"bounds",value:function Morph_bounds_(){return this.relativeBounds(this.owner);}},{key:"relativeSubmorphBounds",value:function Morph_relativeSubmorphBounds_(){var bounds=this.innerBounds();return this.submorphs.map(function(ea){var _ea$bounds=ea.bounds(),width=_ea$bounds.width,height=_ea$bounds.height,x=_ea$bounds.x,y=_ea$bounds.y;return __varRecorder__$v.rect(x/bounds.width,y/bounds.height,width/bounds.width,height/bounds.height);});}},{key:"globalBounds",value:function Morph_globalBounds_(){return this.relativeBounds(this.world());}},{key:"submorphBounds",value:function Morph_submorphBounds_(){var filterFn=arguments.length>0&&arguments[0]!==undefined?arguments[0]:function(){return true;};var morphs=__varRecorder__$v.arr.filter(this.submorphs,filterFn);if(morphs.length<1)return this.innerBounds();return morphs.map(function(submorph){return submorph.bounds();}).reduce(function(a,b){return a.union(b);});}},{key:"fitToSubmorphs",value:function Morph_fitToSubmorphs_(){var padding=arguments.length>0&&arguments[0]!==undefined?arguments[0]:__varRecorder__$v.Rectangle.inset(0);var morphs=this.submorphs;if(!morphs.length)return;var bounds=morphs.reduce(function(bnds,ea){return bnds.union(ea.bounds());},morphs[0].bounds());var topOffset=bounds.top()-padding.top();var leftOffset=bounds.left()-padding.left();this.moveBy(__varRecorder__$v.pt(leftOffset,topOffset));__varRecorder__$v.arr.invoke(this.submorphs,"moveBy",__varRecorder__$v.pt(-leftOffset,-topOffset));this.extent=__varRecorder__$v.pt(bounds.width+padding.left()+padding.right(),bounds.height+padding.top()+padding.bottom());}},{key:"align",value:function Morph_align_(p1,p2){return this.moveBy(p2.subPt(p1));}},{key:"moveBy",value:function Morph_moveBy_(delta){this.position=this.position.addPt(delta);return this;}},{key:"rotateBy",value:function Morph_rotateBy_(delta){this.rotation+=delta;}},{key:"resizeBy",value:function Morph_resizeBy_(delta){this.extent=this.extent.addPt(delta);}},{key:"snap",value:function Morph_snap_(grid){this.position=this.position.roundTo(grid||1);}},{key:"isEpiMorph",get:function get(){return this.getProperty("epiMorph")&&!this.isComponent;}},{key:"isUsedAsEpiMorph",value:function Morph_isUsedAsEpiMorph_(){var m=this;while(m){if(m.isEpiMorph)return true;m=m.owner;}return false;}},{key:"replaceWith",value:function Morph_replaceWith_(other,indexForOtherMorph){var replaceSubmorphs=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(this===other||!other)return other;if(this===other.owner){other.replaceWith(this);return other;}var myOwner=this.owner;var mySubmorphs=this.submorphs;var myTfm=this.getTransform().copy();var myIndex=typeof indexForOtherMorph==="number"?indexForOtherMorph:myOwner?myOwner.submorphs.indexOf(this):-1;var otherOwner=other.owner;var otherSubmorphs=__varRecorder__$v.arr.without(other.submorphs,this);var otherTfm=other.getTransform().copy();var otherIndex=otherOwner?otherOwner.submorphs.indexOf(other):-1;myOwner&&this.remove();otherOwner&&other.remove();if(replaceSubmorphs){this.submorphs=[];other.submorphs=[];}if(myOwner===other){otherOwner&&otherOwner.addMorphAt(this,otherIndex);if(replaceSubmorphs){this.submorphs=otherSubmorphs.slice(0,myIndex).concat(other).concat(otherSubmorphs.slice(myIndex));other.submorphs=mySubmorphs;}}else{myOwner&&myOwner.addMorphAt(other,myIndex);otherOwner&&otherOwner.addMorphAt(this,otherIndex);if(replaceSubmorphs){other.submorphs=mySubmorphs;this.submorphs=otherSubmorphs;}}other.setTransform(myTfm);this.setTransform(otherTfm);return other;}},{key:"addMorphAt",value:function Morph_addMorphAt_(submorph,index){var _this81=this;if(!submorph||_typeof2(submorph)!=="object"){throw new Error("".concat(submorph," cannot be added as a submorph to ").concat(this));}if(submorph.isMorph){if(submorph.isAncestorOf(this)){this.env.world.logError(new Error("addMorph: Circular relationships between morphs not allowed\ntried to add ".concat(submorph," to ").concat(this)));return null;}if(submorph===this){this.env.world.logError(new Error("addMorph: Trying to add itself as a submorph: ".concat(this)));return null;}}if(!submorph.isMorph)submorph=__varRecorder__$v.morph(submorph);var existingIndex=this.submorphs.indexOf(submorph);if(existingIndex>-1&&existingIndex===index)return;this.addMethodCallChangeDoing({target:this,selector:"addMorphAt",args:[submorph,index],undo:{target:this,selector:"removeMorph",args:[submorph]}},function(){var prevOwner=submorph.owner;var submorphs=_this81.submorphs;var tfm;if(prevOwner&&prevOwner!==_this81){tfm=submorph.transformForNewOwner(_this81);submorph.remove();}if(submorph._env!==_this81._env)submorph._env=_this81._env;index=Math.min(submorphs.length,Math.max(0,index));if(existingIndex>-1){submorphs.splice(existingIndex,1);if(existingIndex<index)index--;}submorphs.splice(index,0,submorph);submorph._owner=_this81;submorph._cachedPaths={};if(tfm)submorph.setTransform(tfm);submorph.requestStyling();_this81._morphicState.submorphs=submorphs;_this81._submorphOrderChanged=true;_this81.makeDirty();submorph.resumeSteppingAll();submorph.withAllSubmorphsDo(function(ea){return ea.onOwnerChanged(_this81);});if(_this81.world()&&submorph._requestMasterStyling){submorph.master&&submorph.master.applyIfNeeded(true);submorph._requestMasterStyling=false;}});return submorph;}},{key:"addMorph",value:function Morph_addMorph_(submorph,insertBeforeMorph){var submorphs=this.submorphs;var insertBeforeMorphIndex=insertBeforeMorph?submorphs.indexOf(insertBeforeMorph):-1;var insertionIndex=insertBeforeMorphIndex===-1?submorphs.length:insertBeforeMorphIndex;return this.addMorphAt(submorph,insertionIndex);}},{key:"addMorphBack",value:function Morph_addMorphBack_(other){var next=other===this.submorphs[0]?this.submorphs[1]:this.submorphs[0];return this.addMorph(other,next);}},{key:"removeMorph",value:function Morph_removeMorph_(morph){var index=this.submorphs.indexOf(morph);if(index===-1)return;var submorphs=this.getProperty("submorphs")||[];submorphs.splice(index,1);this.addMethodCallChangeDoing({target:this,selector:"removeMorph",args:[morph],undo:{target:this,selector:"addMorphAt",args:[morph,index]}},function(){morph.suspendSteppingAll();morph._owner=null;});this._pathDependants=__varRecorder__$v.arr.withoutAll(this._pathDependants,morph._pathDependants);}},{key:"remove",value:function Morph_remove_(){var _this82=this;this.ownerChain().forEach(function(m){if(m._stylingVisitor){m._stylingVisitor.deleteFromCache(_this82);}});if(this.owner)this.owner.removeMorph(this);this._cachedPaths={};this._pathDependants.forEach(function(dep){return dep._cachedPaths={};});this._pathDependants=[];this.withAllSubmorphsDo(function(ea){return ea.onOwnerChanged(null);});return this;}},{key:"onOwnerChanged",value:function Morph_onOwnerChanged_(newOwner){if(newOwner&&this.master){this.requestMasterStyling();}}},{key:"fadeOut",value:function(){var _Morph_fadeOut_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee75(){var duration,_args76=arguments;return regeneratorRuntime.wrap(function _callee75$(_context75){while(1){switch(_context75.prev=_context75.next){case 0:duration=_args76.length>0&&_args76[0]!==undefined?_args76[0]:1000;_context75.next=3;return this.animate({opacity:0,duration:duration,easing:__varRecorder__$v.easings.outQuad});case 3:this.remove();this.opacity=1;case 5:case"end":return _context75.stop();}}},_callee75,this);}));function Morph_fadeOut_(){return _Morph_fadeOut_.apply(this,arguments);}return Morph_fadeOut_;}()},{key:"fadeIn",value:function(){var _Morph_fadeIn_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee76(){var duration,_args77=arguments;return regeneratorRuntime.wrap(function _callee76$(_context76){while(1){switch(_context76.prev=_context76.next){case 0:duration=_args77.length>0&&_args77[0]!==undefined?_args77[0]:1000;this.opacity=0;this.animate({opacity:1,duration:duration});return _context76.abrupt("return",this);case 4:case"end":return _context76.stop();}}},_callee76,this);}));function Morph_fadeIn_(){return _Morph_fadeIn_.apply(this,arguments);}return Morph_fadeIn_;}()},{key:"fadeIntoWorld",value:function(){var _Morph_fadeIntoWorld_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee77(){var pos,duration,w,world,bounds,_args78=arguments;return regeneratorRuntime.wrap(function _callee77$(_context77){while(1){switch(_context77.prev=_context77.next){case 0:pos=_args78.length>0&&_args78[0]!==undefined?_args78[0]:$world.visibleBounds().center();duration=_args78.length>1&&_args78[1]!==undefined?_args78[1]:200;w=new __varRecorder__$v.Morph({opacity:0,scale:0,epiMorph:true,hasFixedPosition:true,fill:__varRecorder__$v.Color.transparent});world=this.env.world;w.openInWorld();w.addMorph(this);this.position=w.extent.scaleBy(0.5);w.center=pos;w.scale=0.8;_context77.next=11;return w.animate({opacity:1,scale:1,duration:duration});case 11:bounds=this.globalBounds();world.addMorph(this);this.top=bounds.top();this.left=bounds.left();w.remove();return _context77.abrupt("return",this);case 17:case"end":return _context77.stop();}}},_callee77,this);}));function Morph_fadeIntoWorld_(){return _Morph_fadeIntoWorld_.apply(this,arguments);}return Morph_fadeIntoWorld_;}()},{key:"removeAllMorphs",value:function Morph_removeAllMorphs_(){this.submorphs=[];}},{key:"bringToFront",value:function Morph_bringToFront_(){if(this.owner&&__varRecorder__$v.arr.last(this.owner.submorphs)!==this){this.owner.addMorph(this);}return this;}},{key:"owner",get:function get(){return this._owner;}},{key:"withAllSubmorphsDetect",value:function Morph_withAllSubmorphsDetect_(testerFunc){if(testerFunc(this))return this;var _iterator51=_createForOfIteratorHelper(this.submorphs),_step51;try{for(_iterator51.s();!(_step51=_iterator51.n()).done;){var _m3=_step51.value;var found=_m3.withAllSubmorphsDetect(testerFunc);if(found)return found;}}catch(err){_iterator51.e(err);}finally{_iterator51.f();}return undefined;}},{key:"withAllSubmorphsDoExcluding",value:function Morph_withAllSubmorphsDoExcluding_(func,exclusionFunc){var result=[func(this)];if(exclusionFunc(this))return result;var _iterator52=_createForOfIteratorHelper(this.submorphs),_step52;try{for(_iterator52.s();!(_step52=_iterator52.n()).done;){var _m4=_step52.value;__varRecorder__$v.arr.pushAll(result,_m4.withAllSubmorphsDoExcluding(func,exclusionFunc));}}catch(err){_iterator52.e(err);}finally{_iterator52.f();}return result;}},{key:"withAllSubmorphsDo",value:function Morph_withAllSubmorphsDo_(func){var result=[func(this)];var _iterator53=_createForOfIteratorHelper(this.submorphs),_step53;try{for(_iterator53.s();!(_step53=_iterator53.n()).done;){var _m5=_step53.value;__varRecorder__$v.arr.pushAll(result,_m5.withAllSubmorphsDo(func));}}catch(err){_iterator53.e(err);}finally{_iterator53.f();}return result;}},{key:"withAllSubmorphsSelect",value:function Morph_withAllSubmorphsSelect_(testerFunc){var result=[];this.withAllSubmorphsDo(function(m){return testerFunc(m)&&result.push(m);});return result;}},{key:"ownerChain",value:function Morph_ownerChain_(){return this.owner?[this.owner].concat(this.owner.ownerChain()):[];}},{key:"world",value:function Morph_world_(){return this.owner?this.owner.world():null;}},{key:"getWindow",value:function Morph_getWindow_(){return this.isWindow?this:this.ownerChain().find(function(_ref50){var isWindow=_ref50.isWindow;return isWindow;});}},{key:"openInWorldNear",value:function Morph_openInWorldNear_(pos,optWorld){var _this83=this;var world=optWorld||this.world()||this.env.world;if(!world)return this;if(this.master){this.opacity=0;this.master.whenApplied().then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee78(){return regeneratorRuntime.wrap(function _callee78$(_context78){while(1){switch(_context78.prev=_context78.next){case 0:_context78.next=2;return _this83.whenRendered();case 2:_this83.opacity=1;case 3:case"end":return _context78.stop();}}},_callee78);})));}this.center=pos;this.setBounds(world.visibleBoundsExcludingTopBar().translateForInclusion(this.bounds()));return this.openInWorld(this.position);}},{key:"openInWorldNearHand",value:function Morph_openInWorldNearHand_(optWorld){var world=optWorld||this.world()||this.env.world;var pos=world.firstHand?world.firstHand.position:__varRecorder__$v.pt(0,0);return world?this.openInWorldNear(pos):undefined;}},{key:"openInWorld",value:function Morph_openInWorld_(pos,optWorld){var world=optWorld||this.world()||this.env.world;if(!world){console.warn("Cannot open morph ".concat(this,", world morph not found;"));return this;}if(pos)this.position=pos;else{this.center=this.hasFixedPosition?world.visibleBounds().extent().scaleBy(0.5,0.5):world.visibleBounds().center();this.snap();}world.addMorph(this);return this;}},{key:"openInHand",value:function Morph_openInHand_(hand){if(!hand){var world=this.world()||this.env.world;hand=world.firstHand;}hand.grab(this);this.center=__varRecorder__$v.pt(0,0);}},{key:"openInWindow",value:function Morph_openInWindow_(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{title:this.name,name:"window for "+this.name,world:null};var world=opts.world||this.world()||this.env.world;return world.openInWindow(this,__varRecorder__$v.obj.dissoc(opts,["world"]));}},{key:"isAncestorOf",value:function Morph_isAncestorOf_(aMorph){var owner=aMorph.owner;while(owner){if(owner===this)return true;owner=owner.owner;}return false;}},{key:"morphsContainingPoint",value:function Morph_morphsContainingPoint_(point,list){if(!list)list=[];if(!this.fullContainsWorldPoint(point))return list;for(var _i97=this.submorphs.length-1;_i97>=0;_i97--){this.submorphs[_i97].morphsContainingPoint(point,list);}if(this.innerBoundsContainsWorldPoint(point))list.push(this);return list;}},{key:"morphBeneath",value:function Morph_morphBeneath_(pos){var someOwner=this.world()||this.owner;if(!someOwner)return null;var morphs=someOwner.morphsContainingPoint(pos);var myIdx=morphs.indexOf(this);var morphBeneath=morphs[myIdx+1];return morphBeneath;}},{key:"transformTillMorph",value:function Morph_transformTillMorph_(other){var direction=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"up";if(direction=="down")return other.transformTillMorph(this,"up").inverse();var tfm=new __varRecorder__$v.Transform();for(var _morph6=this;_morph6&&_morph6!=other;_morph6=_morph6.owner){var _morph7=_morph6,origin=_morph7.origin,scroll=_morph7.scroll;if(origin.x!==0||origin.y!==0){tfm.preConcatenate(new __varRecorder__$v.Transform(_morph6.origin));}tfm.preConcatenate(_morph6.getTransform());if(_morph6!=this){if((scroll.x!==0||scroll.y!==0)&&_morph6.owner){tfm.preConcatenate(new __varRecorder__$v.Transform(scroll.negated()));}}if(_morph6.hasFixedPosition&&_morph6.owner){tfm.preConcatenate(new __varRecorder__$v.Transform(_morph6.owner.scroll));}}return tfm;}},{key:"localize",value:function Morph_localize_(p){var world=this.world();var x=p.x,y=p.y;return world?world.transformPointToMorph(this,__varRecorder__$v.pt(x,y)):p;}},{key:"worldPoint",value:function Morph_worldPoint_(p){var world=this.world();var x=p.x,y=p.y;return world?this.transformPointToMorph(world,__varRecorder__$v.pt(x,y)):p.addPt(this.position);}},{key:"transformToMorph",value:function Morph_transformToMorph_(other){var tfm=this.getGlobalTransform();var inv=other.getGlobalTransform().inverse();tfm.preConcatenate(inv);var scroll=other.scroll;if((scroll.x!==0||scroll.y!==0)&&other.owner){tfm.preConcatenate(new __varRecorder__$v.Transform(scroll));}return tfm;}},{key:"transformPointToMorph",value:function Morph_transformPointToMorph_(other,p){var hasFixedParent=this.hasFixedPosition;var _iterator54=_createForOfIteratorHelper(this.pathToMorph(other)),_step54;try{for(_iterator54.s();!(_step54=_iterator54.n()).done;){var _step54$value=_slicedToArray2(_step54.value,2),_d3=_step54$value[0],_m6=_step54$value[1];if(this!=_m6&&_d3=="up"){p.x-=_m6.scroll.x;p.y-=_m6.scroll.y;if(_m6.hasFixedPosition)hasFixedParent=_m6.owner&&_m6.owner.isWorld;if(_m6.hasFixedPosition&&_m6.owner&&_m6.owner.owner){p.x+=_m6.owner.scroll.x;p.y+=_m6.owner.scroll.y;}}this.applyTransform(_d3,_m6,p);if(this!=_m6&&_d3=="down"){p.x+=_m6.scroll.x;p.y+=_m6.scroll.y;if(_m6.hasFixedPosition)hasFixedParent=_m6.owner&&_m6.owner.isWorld;if(_m6.hasFixedPosition&&_m6.owner&&_m6.owner.owner){p.x-=_m6.owner.scroll.x;p.y-=_m6.owner.scroll.y;}}}}catch(err){_iterator54.e(err);}finally{_iterator54.f();}if(hasFixedParent&&other.isWorld){p.x=p.x-other.position.x+other.scroll.x;p.y=p.y-other.position.y+other.scroll.y;}if(hasFixedParent&&this.isWorld){p.x=p.x+this.position.x-this.scroll.x;p.y=p.y+this.position.y-this.scroll.y;}return p;}},{key:"transformRectToMorph",value:function Morph_transformRectToMorph_(other,r){var _this84=this;var tl,tr,br,bl;[tl=r.topLeft(),tr=r.topRight(),br=r.bottomRight(),bl=r.bottomLeft()].forEach(function(corner){return _this84.transformPointToMorph(other,corner);});return __varRecorder__$v.Rectangle.unionPts([tl,tr,br,bl]);}},{key:"applyTransform",value:function Morph_applyTransform_(d,m,p){if(d=="up"){p.x+=m.origin.x;p.y+=m.origin.y;p.matrixTransform(m.getTransform(),p);}else{p.matrixTransform(m.getInverseTransform(),p);p.x-=m.origin.x;p.y-=m.origin.y;}}},{key:"_addPathDependant",value:function Morph__addPathDependant_(morph){if(!this._pathDependants.includes(morph)){this._pathDependants.push(morph);}}},{key:"pathToMorph",value:function Morph_pathToMorph_(other){var path;if(path=this._cachedPaths[other.id])return path;var commonRoot=this.closestCommonAncestor(other)||this;var morph=this;var down=[];var up=[];commonRoot._addPathDependant(this);while(morph&&morph!=commonRoot){up.push(["up",morph]);morph._addPathDependant(this);morph=morph.owner;}morph=other;while(morph&&morph!=commonRoot){down.push(["down",morph]);morph._addPathDependant(this);morph=morph.owner;}this._cachedPaths[other.id]=path=[].concat(up,_toConsumableArray2(down.reverse()));return path;}},{key:"closestCommonAncestor",value:function Morph_closestCommonAncestor_(other){return __varRecorder__$v.arr.intersect([this].concat(_toConsumableArray2(this.ownerChain())),[other].concat(_toConsumableArray2(other.ownerChain())))[0];}},{key:"transformForNewOwner",value:function Morph_transformForNewOwner_(newOwner){return new __varRecorder__$v.Transform(this.transformToMorph(newOwner));}},{key:"localizePointFrom",value:function Morph_localizePointFrom_(_ref52,otherMorph){var x=_ref52.x,y=_ref52.y;try{return otherMorph.transformPointToMorph(this,__varRecorder__$v.pt(x,y));}catch(er){console.warn("problem "+er+" in localizePointFrom");return __varRecorder__$v.pt;}}},{key:"getGlobalTransform",value:function Morph_getGlobalTransform_(){return this.transformTillMorph(this.world());}},{key:"globalPosition",get:function get(){return this.worldPoint(__varRecorder__$v.pt(0,0));}},{key:"globalPosition",set:function set(p){return this.position=this.owner?this.owner.localize(p):p;}},{key:"ensureToBeInWorldBounds",value:function Morph_ensureToBeInWorldBounds_(){var w=this.world();if(!w)return;var bnds=this.globalBounds();var translatedBnds=w.innerBounds().translateForInclusion(bnds);var delta=translatedBnds.topLeft().subPt(bnds.topLeft());this.moveBy(delta);}},{key:"getTransform",value:function Morph_getTransform_(){if(!this._transform)this.updateTransform();return this._transform;}},{key:"getInverseTransform",value:function Morph_getInverseTransform_(){if(!this._invTransform)this.updateTransform();return this._invTransform;}},{key:"updateTransform",value:function Morph_updateTransform_(){var _ref53=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},position=_ref53.position,scale=_ref53.scale,origin=_ref53.origin,rotation=_ref53.rotation;var tfm=this._transform||new __varRecorder__$v.Transform();var tfm_inv=this._invTransform||new __varRecorder__$v.Transform();position=position||this.position;origin=origin||this.origin;scale=scale||this.scale;rotation=rotation||this.rotation;tfm.a=scale*Math.cos(rotation);tfm.b=scale*Math.sin(rotation);tfm.c=scale*-Math.sin(rotation);tfm.d=scale*Math.cos(rotation);tfm.e=tfm.a*-origin.x+tfm.c*-origin.y+position.x;tfm.f=tfm.b*-origin.x+tfm.d*-origin.y+position.y;var a=tfm.a,b=tfm.b,c=tfm.c,d=tfm.d,e=tfm.e,f=tfm.f;var det=a*d-c*b;var invdet=1/det;tfm_inv.a=d*invdet;tfm_inv.b=-b*invdet;tfm_inv.c=-c*invdet;tfm_inv.d=a*invdet;tfm_inv.e=(c*f-e*d)*invdet;tfm_inv.f=-(a*f-b*e)*invdet;this._transform=tfm;this._invTransform=tfm_inv;}},{key:"setTransform",value:function Morph_setTransform_(tfm){this.position=tfm.getTranslation();this.rotation=__varRecorder__$v.num.toRadians(tfm.getRotation());this.scale=tfm.getScalePoint().x;this.updateTransform(this);}},{key:"fullContainsWorldPoint",value:function Morph_fullContainsWorldPoint_(p){return this.fullContainsPoint(this.owner==null?p:this.owner.localize(p));}},{key:"fullContainsPoint",value:function Morph_fullContainsPoint_(p){return this.bounds().containsPoint(p);}},{key:"innerBoundsContainsWorldPoint",value:function Morph_innerBoundsContainsWorldPoint_(p){return this.innerBoundsContainsPoint(this.localize(p));}},{key:"innerBoundsContainsPoint",value:function Morph_innerBoundsContainsPoint_(p){return this.innerBounds().containsPoint(p.addPt(this.origin).subPt(this.scroll));}},{key:"get",value:function Morph_get_(name){if(!name)return null;try{return this.getSubmorphNamed(name)||this.getNameTest(this,name)&&this||this.getOwnerOrOwnerSubmorphNamed(name);}catch(e){if(e.constructor==RangeError&&e.message=="Maximum call stack size exceeded"){throw new Error("'get' failed due to a stack overflow. The most\n"+"likely source of the problem is using 'get' as part of\n"+"toString, because 'get' calls 'getOwnerOrOwnerSubmorphNamed', which\n"+"calls 'toString' on this. Try using 'getSubmorphNamed' instead,\n"+"which only searches in this' children.\nOriginal error:\n"+e.stack);}throw e;}}},{key:"getNameTest",value:function Morph_getNameTest_(morph,expectedName){var isRe=__varRecorder__$v.obj.isRegExp(expectedName);if(isRe){if(expectedName.test(morph.name)||expectedName.test(String(morph)))return true;}else{if(morph.name===expectedName||String(morph)===expectedName)return true;}return false;}},{key:"getAllNamed",value:function Morph_getAllNamed_(name){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(!this._morphicState||!this.submorphs.length)return result;for(var _i98=0;_i98<this.submorphs.length;_i98++){var _morph8=this.submorphs[_i98];if(this.getNameTest(_morph8,name))result.push(_morph8);}for(var _i99=0;_i99<this.submorphs.length;_i99++){this.submorphs[_i99].getAllNamed(name,result);}return result;}},{key:"getSubmorphNamed",value:function Morph_getSubmorphNamed_(name){if(!this._morphicState||!this.submorphs.length)return null;for(var _i100=0;_i100<this.submorphs.length;_i100++){var _morph9=this.submorphs[_i100];if(this.getNameTest(_morph9,name))return _morph9;}for(var _i101=0;_i101<this.submorphs.length;_i101++){var _morph10=this.submorphs[_i101].getSubmorphNamed(name);if(_morph10)return _morph10;}return null;}},{key:"getSubmorphsByStyleClassName",value:function Morph_getSubmorphsByStyleClassName_(styleClassName){return this.withAllSubmorphsSelect(function(_ref54){var styleClasses=_ref54.styleClasses;return styleClasses.includes(styleClassName);});}},{key:"getOwnerNamed",value:function Morph_getOwnerNamed_(name){return this.ownerChain().find(function(ea){return ea.name===name;});}},{key:"getOwnerOrOwnerSubmorphNamed",value:function Morph_getOwnerOrOwnerSubmorphNamed_(name){var owner=this.owner;if(!owner)return null;if(owner.name===name)return owner;for(var _i102=0;_i102<owner.submorphs.length;_i102++){var _morph11=owner.submorphs[_i102];if(_morph11===this)continue;if(this.getNameTest(_morph11,name))return _morph11;var foundInMorph=_morph11.getSubmorphNamed(name);if(foundInMorph)return foundInMorph;}return this.owner.getOwnerOrOwnerSubmorphNamed(name);}},{key:"getMorphWithId",value:function Morph_getMorphWithId_(id){return this.withAllSubmorphsDetect(function(_ref55){var morphId=_ref55.id;return id===morphId;});}},{key:"setMirrored",value:function Morph_setMirrored_(bool){if(!bool){this.addStyleClass("hidden-in-mirror");}else{this.removeStyleClass("hidden-in-mirror");}}},{key:"isMirrored",value:function Morph_isMirrored_(){if(this.styleClasses.indexOf("hidden-in-mirror")>=0){return true;}return false;}},{key:"dragTriggerDistance",get:function get(){return 0;}},{key:"onMouseDown",value:function Morph_onMouseDown_(evt){if(this===evt.targetMorph){evt.state.clickedMorph=this;if(evt.state.prevClick.clickCount==1){var timeDiff=Date.now()-evt.state.prevClick.clickedAtTime;if(timeDiff<=200){this.onDoubleMouseDown(evt);return;}}}if(this===evt.targetMorph&&this.master){this.requestMasterStyling();}}},{key:"onDoubleMouseDown",value:function Morph_onDoubleMouseDown_(evt){}},{key:"onMouseUp",value:function Morph_onMouseUp_(evt){evt.state.clickedMorph=null;if(this===evt.targetMorph&&this.master){this.requestMasterStyling();}}},{key:"onMouseMove",value:function Morph_onMouseMove_(evt){}},{key:"onLongClick",value:function Morph_onLongClick_(evt){}},{key:"addKeyBindings",value:function Morph_addKeyBindings_(bindings){var _this85=this;this.addMethodCallChangeDoing({target:this,selector:"addKeyBindings",args:[bindings],undo:null},function(){var _this85$_keybindings;if(!_this85._keybindings)_this85._keybindings=[];_this85._cachedKeyhandlers=null;(_this85$_keybindings=_this85._keybindings).unshift.apply(_this85$_keybindings,_toConsumableArray2(bindings));});}},{key:"keybindings",get:function get(){return this._keybindings||[];}},{key:"keybindings",set:function set(bndgs){this._cachedKeyhandlers=null;return this._keybindings=bndgs;}},{key:"keyhandlers",get:function get(){return this._cachedKeyhandlers||(this._cachedKeyhandlers=[__varRecorder__$v.KeyHandler.withBindings(this.keybindings)]);}},{key:"keyCommandMap",get:function get(){var platform=this.keyhandlers[0].platform;return this.keybindings.reduce(function(keyMap,binding){var keys=binding.keys;var platformKeys=__varRecorder__$v.findKeysForPlatform(keys,platform);var command=binding.command;var name=typeof command==="string"?command:command.command||command.name;if(typeof platformKeys!=="string")return keyMap;return platformKeys.split("|").reduce(function(keyMap,combo){return Object.assign(keyMap,_defineProperty({},combo,{name:name,command:command,prettyKeys:__varRecorder__$v.KeyHandler.prettyCombo(combo)}));},keyMap);},{});}},{key:"keysForCommand",value:function Morph_keysForCommand_(commandName){var pretty=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var map=this.keyCommandMap;var rawKey=Object.keys(map).find(function(key){return map[key].name===commandName;});return rawKey&&pretty?map[rawKey].prettyKeys:rawKey;}},{key:"simulateKeys",value:function Morph_simulateKeys_(keyString){return __varRecorder__$v.KeyHandler.simulateKeys(this,keyString);}},{key:"onKeyDown",value:function Morph_onKeyDown_(evt){if(__varRecorder__$v.KeyHandler.invokeKeyHandlers(this,evt,false)){evt.stop();}}},{key:"onKeyUp",value:function Morph_onKeyUp_(evt){}},{key:"onContextMenu",value:function Morph_onContextMenu_(evt){var _this86=this;if(evt.targetMorph!==this)return;if(!lively.FreezerRuntime)evt.stop();Promise.resolve(this.menuItems()).then(function(items){return _this86.openMenu(items,evt);})["catch"](function(err){return $world.logError(err);});}},{key:"openMenu",value:function Morph_openMenu_(items,optEvt){var world=this.world();return items&&items.length&&world?world.openWorldMenu(optEvt,items):null;}},{key:"menuItems",value:function Morph_menuItems_(){return this.world().defaultMenuItems(this);}},{key:"onCut",value:function Morph_onCut_(evt){}},{key:"onCopy",value:function Morph_onCopy_(evt){}},{key:"onPaste",value:function Morph_onPaste_(evt){}},{key:"onDragStart",value:function Morph_onDragStart_(evt){this.undoStart("drag-move");var _evt$state=evt.state,dragStartMorphPosition=_evt$state.dragStartMorphPosition,absDragDelta=_evt$state.absDragDelta;this.position=dragStartMorphPosition.addPt(absDragDelta);}},{key:"onDragEnd",value:function Morph_onDragEnd_(evt){this.undoStop("drag-move");$world.execCommand("remove snap to guides",this);}},{key:"onDrag",value:function Morph_onDrag_(evt){var _evt$state2=evt.state,dragStartMorphPosition=_evt$state2.dragStartMorphPosition,absDragDelta=_evt$state2.absDragDelta;this.position=dragStartMorphPosition.addPt(absDragDelta);$world.execCommand("show and snap to guides",{target:this,showGuides:evt.isCtrlDown(),snap:evt.isCtrlDown()});}},{key:"onGrab",value:function Morph_onGrab_(evt){if(evt.isShiftDown()){var _copy=this.copy();_copy.position=this.transformPointToMorph(evt.hand,__varRecorder__$v.pt(0,0));evt.hand.grab(_copy);}else{evt.hand.grab(this);}}},{key:"onDrop",value:function Morph_onDrop_(evt){evt.hand.dropMorphsOn(this);}},{key:"doNotAcceptDropsForThisAndSubmorphs",value:function Morph_doNotAcceptDropsForThisAndSubmorphs_(){this.withAllSubmorphsDo(function(m){return m.acceptsDrops=false;});}},{key:"acceptDropsForThisAndSubmorphs",value:function Morph_acceptDropsForThisAndSubmorphs_(){this.withAllSubmorphsDo(function(m){return m.acceptsDrops=true;});}},{key:"wantsToBeDroppedOn",value:function Morph_wantsToBeDroppedOn_(dropTarget){return true;}},{key:"onDropHoverIn",value:function Morph_onDropHoverIn_(evt){}},{key:"onDropHoverUpdate",value:function Morph_onDropHoverUpdate_(evt){}},{key:"onDropHoverOut",value:function Morph_onDropHoverOut_(evt){}},{key:"onBeingDroppedOn",value:function Morph_onBeingDroppedOn_(hand,recipient){recipient.addMorph(this);}},{key:"onHoverIn",value:function Morph_onHoverIn_(evt){if(this.master){this.requestMasterStyling();}}},{key:"onHoverOut",value:function Morph_onHoverOut_(evt){if(this.master){this.requestMasterStyling();}}},{key:"onScroll",value:function Morph_onScroll_(evt){}},{key:"onMouseWheel",value:function Morph_onMouseWheel_(evt){}},{key:"onNativeDrop",value:function Morph_onNativeDrop_(evt){}},{key:"onNativeDragleave",value:function Morph_onNativeDragleave_(evt){}},{key:"onNativeDragenter",value:function Morph_onNativeDragenter_(evt){}},{key:"onNativeDragover",value:function Morph_onNativeDragover_(evt){}},{key:"onNativeDragend",value:function Morph_onNativeDragend_(evt){}},{key:"onNativeDragstart",value:function Morph_onNativeDragstart_(evt){}},{key:"onNativeDrag",value:function Morph_onNativeDrag_(evt){}},{key:"focus",value:function Morph_focus_(){var eventDispatcher=this.env.eventDispatcher;eventDispatcher&&eventDispatcher.focusMorph(this);}},{key:"onFocus",value:function Morph_onFocus_(evt){}},{key:"onBlur",value:function Morph_onBlur_(evt){}},{key:"isFocused",value:function Morph_isFocused_(){var eventDispatcher=this.env.eventDispatcher;return eventDispatcher&&eventDispatcher.isMorphFocused(this);}},{key:"exportToJSON",value:function Morph_exportToJSON_(options){return __varRecorder__$v.serializeSpec(this,options);}},{key:"initFromJSON",value:function Morph_initFromJSON_(spec){var _this87=this;this._env=spec.env||spec._env||__varRecorder__$v.MorphicEnv["default"]();this._rev=0;this._owner=null;this._dirty=true;this._rendering=false;this._submorphOrderChanged=false;this._id=spec._id||__varRecorder__$v.newMorphId(__varRecorder__$v.getClassName(this));this._animationQueue=new __varRecorder__$v.AnimationQueue(this);this._cachedPaths={};this._pathDependants=[];this._tickingScripts=[];this.dontRecordChangesWhile(function(){_this87.initializeProperties();__varRecorder__$v.deserializeSpec(spec,function(spec){return __varRecorder__$v.morph(spec);},_this87);});return this;}},{key:"copyViaJSON",value:function Morph_copyViaJSON_(){var exported=this.exportToJSON();__varRecorder__$v.tree.prewalk(exported,function(spec){return spec._id=__varRecorder__$v.newMorphId(spec.type);},function(_ref56){var submorphs=_ref56.submorphs;return submorphs;});exported.name=exported.name.replace(/copy( [0-9]+)?$/,function(_,num){return"copy ".concat(num&&num.trim()?Number(num)+1:"1");});return __varRecorder__$v.morph({type:exported.type}).initFromJSON(exported);}},{key:"copy",value:function Morph_copy_(){return __varRecorder__$v.copyMorph(this);}},{key:"interactivelyPublish",value:function(){var _Morph_interactivelyPublish_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee79(){var world,_yield$System$import,_interactivelySavePart,commit;return regeneratorRuntime.wrap(function _callee79$(_context79){while(1){switch(_context79.prev=_context79.next){case 0:world=this.world()||this.env.world;_context79.prev=1;_context79.next=4;return System["import"]("lively.morphic/partsbin.js");case 4:_yield$System$import=_context79.sent;_interactivelySavePart=_yield$System$import.interactivelySavePart;_context79.next=8;return _interactivelySavePart(this,{notifications:false,loadingIndicator:true});case 8:commit=_context79.sent;world.setStatusMessage(commit?"Published ".concat(this," as ").concat(commit.name):"Failed to publish part ".concat(this),commit?__varRecorder__$v.Color.green:__varRecorder__$v.Color.red);_context79.next=15;break;case 12:_context79.prev=12;_context79.t0=_context79["catch"](1);_context79.t0!="canceled"&&world.showError(_context79.t0);case 15:case"end":return _context79.stop();}}},_callee79,this,[[1,12]]);}));function Morph_interactivelyPublish_(){return _Morph_interactivelyPublish_.apply(this,arguments);}return Morph_interactivelyPublish_;}()},{key:"makeDirty",value:function Morph_makeDirty_(change){this._dirty=true;if(this.owner)this.owner.makeDirty();}},{key:"needsRerender",value:function Morph_needsRerender_(){return this._dirty;}},{key:"aboutToRender",value:function Morph_aboutToRender_(renderer){this._dirty=false;this._rendering=true;}},{key:"onAfterRender",value:function Morph_onAfterRender_(node){}},{key:"whenRendered",value:function Morph_whenRendered_(){var maxChecks=arguments.length>0&&arguments[0]!==undefined?arguments[0]:50;return this.env.whenRendered(this,maxChecks).then(function(){return true;})["catch"](function(){return false;});}},{key:"render",value:function Morph_render_(renderer){if(this._requestMasterStyling){this.master&&this.master.applyIfNeeded(true);this._requestMasterStyling=false;}return renderer.renderMorph(this);}},{key:"applyLayoutIfNeeded",value:function Morph_applyLayoutIfNeeded_(){if(!this._dirty)return;for(var _i103=0;_i103<this.submorphs.length;_i103++){this.submorphs[_i103].applyLayoutIfNeeded();}this.layout&&!this.layout.manualUpdate&&this.layout.forceLayout();}},{key:"requestMasterStyling",value:function Morph_requestMasterStyling_(){var _this88=this;if(this._rendering)return;if(this.master&&this.master._hasUnresolvedMaster){this.master._capturedExtents=new WeakMap();this.withAllSubmorphsDo(function(m){return _this88.master._capturedExtents.set(m,m.extent);});}if(this.master)this._requestMasterStyling=true;this.makeDirty();}},{key:"requestStyling",value:function Morph_requestStyling_(){this.withAllSubmorphsDo(function(m){m._wantsStyling=true;m.makeDirty();});}},{key:"renderAsRoot",value:function Morph_renderAsRoot_(renderer){var _this89=this;this.dontRecordChangesWhile(function(){_this89.applyLayoutIfNeeded();});return __varRecorder__$v.renderRootMorph(this,renderer);}},{key:"renderPreview",value:function Morph_renderPreview_(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var renderer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.env.renderer;return renderer.renderPreview(this,opts);}},{key:"startStepping",value:function Morph_startStepping_(){var args=Array.from(arguments);var stepTime=typeof args[0]==="number"?args.shift():null;var scriptName=args.shift();var script=new __varRecorder__$v.TargetScript(this,scriptName,args);this.removeEqualScripts(script);this._tickingScripts.push(script);script.startTicking(stepTime);return script;}},{key:"tickingScripts",get:function get(){return this._tickingScripts;}},{key:"stopStepping",value:function Morph_stopStepping_(){__varRecorder__$v.arr.invoke(this._tickingScripts,"stop");this._tickingScripts.length=[];}},{key:"stopSteppingScriptNamed",value:function Morph_stopSteppingScriptNamed_(selector){var scriptsToStop=this._tickingScripts.filter(function(ea){return ea.selector===selector;});this.stopScripts(scriptsToStop);}},{key:"stopScripts",value:function Morph_stopScripts_(scripts){__varRecorder__$v.arr.invoke(scripts,"stop");this._tickingScripts=__varRecorder__$v.arr.withoutAll(this._tickingScripts,scripts);}},{key:"suspendStepping",value:function Morph_suspendStepping_(){if(this._tickingScripts){__varRecorder__$v.arr.invoke(this._tickingScripts,"suspend");}}},{key:"suspendSteppingAll",value:function Morph_suspendSteppingAll_(){this.withAllSubmorphsDo(function(ea){return ea.suspendStepping();});}},{key:"resumeStepping",value:function Morph_resumeStepping_(){__varRecorder__$v.arr.invoke(this._tickingScripts,"resume");}},{key:"resumeSteppingAll",value:function Morph_resumeSteppingAll_(){this.withAllSubmorphsDo(function(ea){return __varRecorder__$v.arr.invoke(ea._tickingScripts,"resume");});}},{key:"removeEqualScripts",value:function Morph_removeEqualScripts_(script){this.stopScripts(this._tickingScripts.filter(function(ea){return ea.equals(script);}));}},{key:"commands",get:function get(){return this._commands||[];}},{key:"commands",set:function set(cmds){if(this._commands)this.removeCommands(this._commands);this.addCommands(cmds);}},{key:"commandsIncludingOwners",get:function get(){return __varRecorder__$v.arr.flatmap([this].concat(this.ownerChain()),function(morph){return __varRecorder__$v.arr.sortByKey(morph.commands,"name").map(function(command){return{target:morph,command:command};});});}},{key:"addCommands",value:function Morph_addCommands_(cmds){var _this90=this;this.addMethodCallChangeDoing({target:this,selector:"addCommands",args:[cmds],undo:{target:this,selector:"removeCommands",args:[cmds]}},function(){_this90.removeCommands(cmds);_this90._commands=(_this90._commands||[]).concat(cmds);});}},{key:"removeCommands",value:function Morph_removeCommands_(cmdsOrNames){var _this91=this;this.addMethodCallChangeDoing({target:this,selector:"removeCommands",args:[cmdsOrNames],undo:{target:this,selector:"addCommands",args:[cmdsOrNames]}},function(){var names=cmdsOrNames.map(function(ea){return typeof ea==="string"?ea:ea.name;});var commands=(_this91._commands||[]).filter(function(_ref57){var name=_ref57.name;return!names.includes(name);});if(!commands.length)delete _this91._commands;else _this91._commands=commands;});}},{key:"commandHandler",get:function get(){return this._commandHandler||__varRecorder__$v.defaultCommandHandler;}},{key:"lookupCommand",value:function Morph_lookupCommand_(commandOrName){var result=this.commandHandler.lookupCommand(commandOrName,this);return result&&result.command?result:null;}},{key:"execCommand",value:function Morph_execCommand_(command,args,count,evt){return this.commandHandler.exec(command,this,args,count,evt);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Morph";}},{key:"propertySettings",get:function get(){return{defaultGetter:function defaultGetter(key){return this.getProperty(key);},defaultSetter:function defaultSetter(key,value){this.setProperty(key,value);},valueStoreProperty:"_morphicState"};}},{key:"properties",get:function get(){return Object.assign({name:{group:"core",initialize:function initialize(name){if(!name){var className=__varRecorder__$v.getClassName(this);name=(__varRecorder__$v.string.startsWithVowel(className)?"an":"a")+className;}this.name=name;}},isComponent:{group:"core",defaultValue:false,after:["master"],set:function set(active){this.setProperty("isComponent",active);if(active){if(!this.master)delete this._parametrizedProps;}}},master:{before:["metadata"],group:"core",set:function set(args){if(this.master&&this.master.equals(args))return;this.setProperty("master",args?__varRecorder__$v.ComponentPolicy["for"](this,args):args==false?false:null);args&&this.requestMasterStyling();}},renderOnGPU:{group:"core",defaultValue:false},draggable:{group:"interaction",isStyleProp:true,defaultValue:false},grabbable:{group:"interaction",isStyleProp:true,defaultValue:false,set:function set(bool){if(bool&&!this.draggable)this.draggable=true;this.setProperty("grabbable",bool);}},acceptsDrops:{group:"interaction",isStyleProp:true,defaultValue:true},grayscale:{group:"styling",type:"Number",isStyleProp:true,defaultValue:0,min:0,max:1,isFloat:true},blur:{group:"styling",type:"Number",isStyleProp:true,defaultValue:0,min:0,isFloat:true},dropShadow:{group:"styling",type:"Shadow",isStyleProp:true,defaultValue:null,set:function set(value){if(value&&!value.isShadowObject){value=new __varRecorder__$v.ShadowObject(value);value.morph=this;}this.setProperty("dropShadow",value);}},tooltip:{group:"core",defaultValue:null},focusable:{group:"interaction",defaultValue:true},nativeCursor:{group:"interaction",type:"Enum",values:["auto","default","none","context-menu","help","pointer","progress","wait","cell","crosshair","text","vertical-text","alias","copy","move","no-drop","not-allowed","e-resize","n-resize","ne-resize","nw-resize","s-resize","se-resize","sw-resize","w-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","col-resize","row-resize","all-scroll","zoom-in","zoom-out","grab","grabbing"],isStyleProp:true,defaultValue:"auto"},halosEnabled:{group:"interaction",isStyleProp:true,defaultValue:!!__varRecorder__$v.config.halosEnabled},reactsToPointer:{group:"interaction",isStyleProp:true,defaultValue:true},position:{group:"geometry",type:"Point",isStyleProp:true,defaultValue:__varRecorder__$v.pt(0,0)},origin:{group:"geometry",type:"Point",isStyleProp:true,defaultValue:__varRecorder__$v.pt(0,0)},extent:{group:"geometry",type:"Point",isStyleProp:true,defaultValue:__varRecorder__$v.pt(10,10),set:function set(ext){var priorExtent=this.extent;this.setProperty("extent",ext);if(!this.origin.equals(__varRecorder__$v.pt(0,0))){var scalePt=__varRecorder__$v.pt(ext.x/priorExtent.x,ext.y/priorExtent.y);this.adjustOrigin(this.origin.scaleByPt(scalePt));}}},width:{group:"geometry",derived:true,after:["extent"],before:["submorphs"],get:function get(){return this.extent.x;},set:function set(v){return this.extent=__varRecorder__$v.pt(v,this.extent.y);}},height:{group:"geometry",derived:true,after:["extent"],before:["submorphs"],get:function get(){return this.extent.y;},set:function set(v){return this.extent=__varRecorder__$v.pt(this.extent.x,v);}},left:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().left();},set:function set(v){return this.moveBy(__varRecorder__$v.pt(v-this.left),0);}},right:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().right();},set:function set(v){return this.moveBy(__varRecorder__$v.pt(v-this.right),0);}},top:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().top();},set:function set(v){return this.moveBy(__varRecorder__$v.pt(0,v-this.top));}},bottom:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().bottom();},set:function set(v){return this.moveBy(__varRecorder__$v.pt(0,v-this.bottom));}},center:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().center();},set:function set(v){return this.align(this.center,v);}},topLeft:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().topLeft();},set:function set(v){return this.align(this.topLeft,v);}},topRight:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().topRight();},set:function set(v){return this.align(this.topRight,v);}},bottomRight:{group:"geometry",derived:true,after:["extent","layout"],get:function get(){return this.bounds().bottomRight();},set:function set(v){return this.align(this.bottomRight,v);}},bottomLeft:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().bottomLeft();},set:function set(v){return this.align(this.bottomLeft,v);}},bottomCenter:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().bottomCenter();},set:function set(v){return this.align(this.bottomCenter,v);}},topCenter:{group:"geometry",derived:true,after:["extent","submorphs","layout"],get:function get(){return this.bounds().topCenter();},set:function set(v){return this.align(this.topCenter,v);}},leftCenter:{group:"geometry",derived:true,after:["extent","submorphs"],get:function get(){return this.bounds().leftCenter();},set:function set(v){return this.align(this.leftCenter,v);}},rightCenter:{group:"geometry",derived:true,after:["extent","submorphs"],get:function get(){return this.bounds().rightCenter();},set:function set(v){return this.align(this.rightCenter,v);}},rotation:{group:"geometry",type:"Number",isFloat:true,isStyleProp:true,defaultValue:0},flipped:{group:"geometry",type:"Number",isFloat:true,isStyleProp:true,defaultValue:0,min:0,max:1},tilted:{group:"geometry",type:"Number",isFloat:true,isStyleProp:true,defaultValue:0,min:0,max:1},perspective:{group:"geometry",type:"Number",isStyleProp:true,defaultValue:0,min:0},scale:{group:"geometry",type:"Number",min:0,isFloat:true,isStyleProp:true,defaultValue:1},hasFixedPosition:{group:"geometry",doc:"When morph is submorph of world hasFixedPosition == true will keep the morph at the same position relative to top left of the browser window. This means, when the world is scrolled, the morph keeps its place.",defaultValue:false},opacity:{group:"styling",type:"Number",isFloat:true,min:0,max:1,isStyleProp:true,defaultValue:1},fill:{group:"styling",type:"ColorGradient",isStyleProp:true,defaultValue:__varRecorder__$v.Color.white},visible:{group:"styling",isStyleProp:true,defaultValue:true,set:function set(bool){if(!bool)this.makeDirty();this.setProperty("visible",bool);}},submorphs:{group:"core",defaultValue:[],after:["isLayoutable","origin","position","rotation","scale"],get:function get(){return(this.getProperty("submorphs")||[]).concat();},set:function set(newSubmorphs){var _this92=this;var layout=this.layout;var activateLayout=layout&&layout.isEnabled();if(activateLayout)layout.disable();this.submorphs.forEach(function(m){return newSubmorphs.includes(m)||m.remove();});newSubmorphs.forEach(function(m,i){return _this92.submorphs[i]!==m&&_this92.addMorph(m,_this92.submorphs[i]);});if(activateLayout)layout.enable();}},clipMode:{group:"styling",type:"Enum",values:["visible","hidden","scroll","auto"],isStyleProp:true,defaultValue:"visible",set:function set(value){this.setProperty("clipMode",value);if(!this.isClip())this.scroll=__varRecorder__$v.pt(0,0);}},scroll:{group:"geometry",defaultValue:__varRecorder__$v.pt(0,0),after:["clipMode","submorphs"],type:"Point",set:function set(_ref58){var x=_ref58.x,y=_ref58.y;if(!this.isClip())return;var _this$scrollExtent$su=this.scrollExtent.subPt(this.extent),maxScrollX=_this$scrollExtent$su.x,maxScrollY=_this$scrollExtent$su.y;x=Math.max(0,Math.min(maxScrollX,x));y=Math.max(0,Math.min(maxScrollY,y));this.setProperty("scroll",__varRecorder__$v.pt(x,y));this.makeDirty();}},scrollbarOffset:{group:"styling",defaultValue:__varRecorder__$v.pt(15,15)},styleClasses:{group:"styling",isStyleProp:true,defaultValue:["morph"],get:function get(){return this._cachedStyleClasses||(this._cachedStyleClasses=this.constructor.styleClasses.concat(this.getProperty("styleClasses")));},set:function set(value){this._cachedStyleClasses=null;this.setProperty("styleClasses",__varRecorder__$v.arr.withoutAll(value,this.constructor.styleClasses));this.requestStyling();}},layout:{group:"layouting",isStyleProp:true,type:"Layout",after:["submorphs","extent","origin","position","isLayoutable"],set:function set(value){if(value)value.container=this;this.setProperty("layout",value);}},isLayoutable:{group:"layouting",isStyleProp:true,defaultValue:true},borderLeft:{group:"styling",isStyleProp:true,derived:true,after:["borderStyleLeft","borderWidthLeft","borderColorLeft"],get:function get(){return{style:this.borderStyleLeft,width:this.borderWidthLeft,color:this.borderColorLeft};},set:function set(x){if("style"in x)this.borderStyleLeft=x.style;if("width"in x)this.borderWidthLeft=x.width;if("color"in x)this.borderColorLeft=x.color;if("radius"in x)this.borderRadiusLeft=x.radius;}},borderRight:{group:"styling",isStyleProp:true,derived:true,after:["borderStyleRight","borderWidthRight","borderColorRight"],get:function get(){return{style:this.borderStyleRight,width:this.borderWidthRight,color:this.borderColorRight};},set:function set(x){if("style"in x)this.borderStyleRight=x.style;if("width"in x)this.borderWidthRight=x.width;if("color"in x)this.borderColorRight=x.color;if("radius"in x)this.borderRadiusRight=x.radius;}},borderBottom:{group:"styling",isStyleProp:true,derived:true,after:["borderStyleBottom","borderWidthBottom","borderColorBottom"],get:function get(){return{style:this.borderStyleBottom,width:this.borderWidthBottom,color:this.borderColorBottom};},set:function set(x){if("style"in x)this.borderStyleBottom=x.style;if("width"in x)this.borderWidthBottom=x.width;if("color"in x)this.borderColorBottom=x.color;if("radius"in x)this.borderRadiusBottom=x.radius;}},borderTop:{group:"styling",isStyleProp:true,derived:true,after:["borderStyleTop","borderWidthTop","borderColorTop"],get:function get(){return{style:this.borderStyleTop,width:this.borderWidthTop,color:this.borderColorTop};},set:function set(x){if("style"in x)this.borderStyleTop=x.style;if("width"in x)this.borderWidthTop=x.width;if("color"in x)this.borderColorTop=x.color;if("radius"in x)this.borderRadiusTop=x.radius;}},borderWidth:{group:"styling",isStyleProp:true,type:"Number",foldable:["top","left","right","bottom"],min:0,defaultValue:{top:0,bottom:0,left:0,right:0,valueOf:function valueOf(){return 0;}},get:function get(){var v=this.getProperty("borderWidth");return Object.assign({},v,{valueOf:function valueOf(){return v.left;}});},set:function set(value){if(__varRecorder__$v.obj.isNumber(value)){var left=value;var right=value;var top=value;var bottom=value;value={left:left,right:right,top:top,bottom:bottom};}this.setProperty("borderWidth",value);}}},__varRecorder__$v.generateUnfolded("borderWidth",undefined,"styling"),{borderRadius:{group:"styling",isStyleProp:true,type:"Number",min:0,foldable:["top","left","right","bottom"],defaultValue:{top:0,bottom:0,right:0,left:0,valueOf:function valueOf(){return 0;}},get:function get(){var v=this.getProperty("borderRadius");return Object.assign({},v,{valueOf:function valueOf(){return v.left;}});},set:function set(value){if(!value)value=0;if(__varRecorder__$v.obj.isNumber(value)){var left=value;var right=value;var top=value;var bottom=value;value={left:left,right:right,top:top,bottom:bottom};}if(value.isRectangle){value={left:value.left(),right:value.right(),top:value.top(),bottom:value.bottom()};}this.setProperty("borderRadius",value);}}},__varRecorder__$v.generateUnfolded("borderRadius",undefined,"styling"),{borderStyle:{group:"styling",isStyleProp:true,type:"Enum",foldable:["top","left","right","bottom"],values:["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset"],defaultValue:{top:"solid",left:"solid",bottom:"solid",right:"solid",valueOf:function valueOf(){return"solid";}},get:function get(){var v=this.getProperty("borderStyle");return Object.assign({},v,{valueOf:function valueOf(){return v.left;}});},set:function set(value){if(__varRecorder__$v.obj.isString(value)){var left=value;var right=value;var top=value;var bottom=value;value={left:left,right:right,top:top,bottom:bottom};}this.setProperty("borderStyle",value);}}},__varRecorder__$v.generateUnfolded("borderStyle",undefined,"styling"),{borderColor:{group:"styling",isStyleProp:true,type:"Color",foldable:["top","left","right","bottom"],defaultValue:{top:__varRecorder__$v.Color.white,left:__varRecorder__$v.Color.white,bottom:__varRecorder__$v.Color.white,right:__varRecorder__$v.Color.white,valueOf:function valueOf(){return __varRecorder__$v.Color.white;}},get:function get(){var v=this.getProperty("borderColor");return Object.assign({},v,{valueOf:function valueOf(){return v.left;}});},set:function set(value){if(!value)value=__varRecorder__$v.Color.white;if(value.isColor){value={top:value,left:value,right:value,bottom:value};}this.setProperty("borderColor",value?__varRecorder__$v.obj.extract(value,["top","left","right","bottom"],function(k,v){return __varRecorder__$v.obj.isArray(v)?__varRecorder__$v.Color.fromTuple(v):v;}):value);}}},__varRecorder__$v.generateUnfolded("borderColor",undefined,"styling"),{border:{group:"styling",isStyleProp:true,derived:true,after:["borderStyle","borderWidth","borderColor"],get:function get(){var self=this;return{get style(){return self.borderStyle;},set style(val){self.borderStyle=val;},get width(){return self.borderWidth;},set width(val){self.borderWidth=val;},get color(){return self.borderColor;},set color(val){self.borderColor=val;},get borderRadius(){return self.borderRadius;},set borderRadius(val){self.borderRadius=val;}};},set:function set(x){if("style"in x)this.borderStyle=x.style;if("width"in x)this.borderWidth=x.width;if("color"in x)this.borderColor=x.color;if("radius"in x)this.borderRadius=x.radius;}},styleProperties:{group:"styling",derived:true,readOnly:true,get:function get(){var _this$propertiesAndPr2=this.propertiesAndPropertySettings(),properties=_this$propertiesAndPr2.properties,order=_this$propertiesAndPr2.order;var styleProps=[];var _iterator55=_createForOfIteratorHelper(order),_step55;try{for(_iterator55.s();!(_step55=_iterator55.n()).done;){var prop=_step55.value;if(properties[prop].isStyleProp){styleProps.push(prop);}}}catch(err){_iterator55.e(err);}finally{_iterator55.f();}return styleProps;}},style:{group:"styling",derived:true,readOnly:true,get:function get(){var styleProperties=this.styleProperties;var style={};for(var _i104=0;_i104<styleProperties.length;_i104++){var prop=styleProperties[_i104];style[prop]=this[prop];}return style;}},epiMorph:{group:"core",doc:"epi morphs are 'transient' morphs, i.e. meta objects that should not be serialized like halo items, menus, etc.",defaultValue:false},respondsToVisibleWindow:{group:"interaction",doc:"Morphs will respond to changes to the visible browser window and a call will be made to the morph's relayout function, supplying the event generated",defaultValue:false},installedFonts:{doc:"custom fonts can be installed from a respective morph, and are then kept as part of this morph's state in order to be loaded again the next time the it is cold loaded. (i.e. deserialization of a part)",defaultValue:{},set:function set(fonts){var fontsBefore=__varRecorder__$v.arr.without(__varRecorder__$v.obj.keys(this.installedFonts||{}),"_rev");var fontsAfter=__varRecorder__$v.arr.without(__varRecorder__$v.obj.keys(fonts||{}),"_rev");this.setProperty("installedFonts",fonts);this.ensureInstalledFonts(fontsBefore,fontsAfter);},get:function get(){return this.getProperty("installedFonts")||{};}},metadata:{group:"core"}});}},{key:"styleClasses",get:function get(){if(this.hasOwnProperty("_styclassNames")){return this._styleClasses;}var klass=this;var classNames=[];while(klass){if(klass===Object)break;classNames.push(klass[Symbol["for"]("__LivelyClassName__")]);klass=klass[Symbol["for"]("lively-instance-superclass")];}return this._styleClasses=classNames;}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1653,end:80548});}(undefined));__varRecorder__$v.Morph=Morph;__varRecorder__$v.Morph=Morph;__varRecorder__$v.Morph=Morph;var Ellipse=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Ellipse")&&typeof __lively_classholder__.Ellipse==="function"?__lively_classholder__.Ellipse:__lively_classholder__.Ellipse=function Ellipse(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,undefined,[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Ellipse";}},{key:"properties",get:function get(){return{borderRadius:{derived:true,get:function get(){var _this93=this;return{top:this.borderRadiusTop,right:this.borderRadiusRight,left:this.borderRadiusLeft,bottom:this.borderRadiusBottom,valueOf:function valueOf(){return _this93.borderRadiusLeft;}};}},borderRadiusLeft:{get:function get(){return this.height;},set:function set(){}},borderRadiusRight:{get:function get(){return this.height;},set:function set(){}},borderRadiusTop:{get:function get(){return this.width;},set:function set(){}},borderRadiusBottom:{get:function get(){return this.width;},set:function set(){}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:80557,end:81314});}(__varRecorder__$v.Morph);__varRecorder__$v.Ellipse=Ellipse;__varRecorder__$v.Ellipse=Ellipse;__varRecorder__$v.Ellipse=Ellipse;var Triangle=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Triangle")&&typeof __lively_classholder__.Triangle==="function"?__lively_classholder__.Triangle:__lively_classholder__.Triangle=function Triangle(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Triangle_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);this.update();}},{key:"onChange",value:function Triangle_onChange_(change){if(change.prop=="extent"||change.prop=="direction"||change.prop=="fill"&&change.value)this.update();initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onChange",this).call(this,change);}},{key:"update",value:function Triangle_update_(){var _Object$assign6;var _this$extent2=this.extent,width=_this$extent2.x,height=_this$extent2.y;if(width!=height)this.extent=__varRecorder__$v.pt(Math.max(width,height),Math.max(width,height));this.origin=__varRecorder__$v.pt(width/2,height/2);var color=this.triangleFill=this.fill||this.triangleFill;this.fill=null;var base={width:width/2,style:"solid",color:color};var side={width:height/2,style:"solid",color:__varRecorder__$v.Color.transparent};var side1;var side2;var bottom;switch(this.direction){case"down":side1="borderLeft";side2="borderRight";bottom="borderTop";break;case"up":side1="borderLeft";side2="borderRight";bottom="borderBottom";break;case"left":side1="borderBottom";side2="borderTop";bottom="borderRight";break;case"right":side1="borderBottom";side2="borderTop";bottom="borderLeft";break;}Object.assign(this,(_Object$assign6={},_defineProperty(_Object$assign6,side1,side),_defineProperty(_Object$assign6,side2,side),_defineProperty(_Object$assign6,bottom,base),_Object$assign6));}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Triangle";}},{key:"properties",get:function get(){return{direction:{defaultValue:"up"},triangleFill:{after:["fill"],initialize:function initialize(){this.triangleFill=this.fill;}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:81323,end:82781});}(__varRecorder__$v.Morph);__varRecorder__$v.Triangle=Triangle;__varRecorder__$v.Triangle=Triangle;__varRecorder__$v.Triangle=Triangle;var Image=exports('j',function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Image")&&typeof __lively_classholder__.Image==="function"?__lively_classholder__.Image:__lively_classholder__.Image=function Image(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"__deserialize__",value:function Image___deserialize___(snapshot,objRef,serializedMap,pool){this._isDeserializing=true;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__deserialize__",this).call(this,snapshot,objRef,serializedMap,pool);}},{key:"__after_deserialize__",value:function Image___after_deserialize___(snapshot,ref,pool){delete this._isDeserializing;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__after_deserialize__",this).call(this,snapshot,ref,pool);}},{key:"isImage",get:function get(){return true;}},{key:"ratio",get:function get(){var _this$naturalExtent=this.naturalExtent,x=_this$naturalExtent.x,y=_this$naturalExtent.y;return x/y;}},{key:"setWidthKeepingRatio",value:function Image_setWidthKeepingRatio_(w){this.width=w;this.height=w/this.ratio;}},{key:"setHeightKeepingRatio",value:function Image_setHeightKeepingRatio_(h){this.width=this.ratio*h;this.height=h;}},{key:"loadUrl",value:function Image_loadUrl_(url){var _this94=this;var autoResize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.autoResize;var prevAutoResize=this.autoResize;this.autoResize=autoResize;this.imageUrl=url;return __varRecorder__$v.promise["finally"](this.whenLoaded(),function(){return _this94.autoResize=prevAutoResize;});}},{key:"whenLoaded",value:function Image_whenLoaded_(){var _this95=this;if(this.isLoaded)return Promise.resolve(this);return new Promise(function(resolve,reject){var url=_this95.imageUrl;_this95.imageElement(function(image){if(_this95.imageUrl!==url)reject(new Error("url changed (".concat(url," => ").concat(_this95.imageUrl,")")));_this95.naturalExtent=__varRecorder__$v.pt(image.width,image.height);_this95.isLoaded=true;resolve(_this95);});});}},{key:"determineNaturalExtent",value:function Image_determineNaturalExtent_(){var _this96=this;return this.whenLoaded().then(function(){return _this96.naturalExtent;});}},{key:"render",value:function Image_render_(renderer){if(this._requestMasterStyling){this.master&&this.master.applyIfNeeded(true);this._requestMasterStyling=false;}return renderer.renderImage(this);}},{key:"clear",value:function Image_clear_(){return this.loadUrl("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",false);}},{key:"imageElement",value:function Image_imageElement_(onloadFn){var _this97=this;return new Promise(function(resolve,reject){var doc=_this97.env.domEnv.document;var image=doc.createElement("img");image.onload=function(){resolve(image);if(typeof onloadFn==="function"){onloadFn(image);}};image.src=_this97.imageUrl;});}},{key:"canvasElementAndContext",value:function(){var _Image_canvasElementAndContext_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee80(){var doc,image,canvas,ctx;return regeneratorRuntime.wrap(function _callee80$(_context80){while(1){switch(_context80.prev=_context80.next){case 0:doc=this.env.domEnv.document;_context80.next=3;return this.imageElement();case 3:image=_context80.sent;canvas=doc.createElement("canvas");ctx=canvas.getContext("2d");canvas.width=image.width;canvas.height=image.height;ctx.drawImage(image,0,0,image.width,image.height);return _context80.abrupt("return",{canvas:canvas,ctx:ctx,image:image});case 10:case"end":return _context80.stop();}}},_callee80,this);}));function Image_canvasElementAndContext_(){return _Image_canvasElementAndContext_.apply(this,arguments);}return Image_canvasElementAndContext_;}()},{key:"imageData",value:function(){var _Image_imageData_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee81(bounds){var _yield$this$canvasEle,ctx,image,_bounds,x,y,width,height;return regeneratorRuntime.wrap(function _callee81$(_context81){while(1){switch(_context81.prev=_context81.next){case 0:_context81.next=2;return this.canvasElementAndContext();case 2:_yield$this$canvasEle=_context81.sent;ctx=_yield$this$canvasEle.ctx;image=_yield$this$canvasEle.image;if(!bounds)bounds=__varRecorder__$v.rect(0,0,image.width,image.height);_bounds=bounds,x=_bounds.x,y=_bounds.y,width=_bounds.width,height=_bounds.height;console.log(x,y);return _context81.abrupt("return",ctx.getImageData(x,y,width,height));case 9:case"end":return _context81.stop();}}},_callee81,this);}));function Image_imageData_(_x108){return _Image_imageData_.apply(this,arguments);}return Image_imageData_;}()},{key:"pixelAt",value:function(){var _Image_pixelAt_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee82(pos){return regeneratorRuntime.wrap(function _callee82$(_context82){while(1){switch(_context82.prev=_context82.next){case 0:_context82.next=2;return this.imageData(pos.extent(__varRecorder__$v.pt(1,1)));case 2:return _context82.abrupt("return",_context82.sent.data);case 3:case"end":return _context82.stop();}}},_callee82,this);}));function Image_pixelAt_(_x109){return _Image_pixelAt_.apply(this,arguments);}return Image_pixelAt_;}()},{key:"colorAt",value:function(){var _Image_colorAt_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee83(pos){return regeneratorRuntime.wrap(function _callee83$(_context83){while(1){switch(_context83.prev=_context83.next){case 0:_context83.t0=__varRecorder__$v.Color;_context83.next=3;return this.pixelAt(pos);case 3:_context83.t1=_context83.sent;return _context83.abrupt("return",_context83.t0.fromTuple8Bit.call(_context83.t0,_context83.t1));case 5:case"end":return _context83.stop();}}},_callee83,this);}));function Image_colorAt_(_x110){return _Image_colorAt_.apply(this,arguments);}return Image_colorAt_;}()},{key:"loadArrayBuffer",value:function Image_loadArrayBuffer_(arrayBuffer){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"image/jpeg";var arrayBufferView=new Uint8Array(arrayBuffer);var blob=new Blob([arrayBufferView],{type:"image/jpeg"});var urlCreator=window.URL||window.webkitURL;var imageUrl=urlCreator.createObjectURL(blob);this.imageUrl=imageUrl;this.makeDirty();}},{key:"convertToBase64",value:function(){var _Image_convertToBase64_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee84(){var urlString,type,_yield$System$import2,runCommand,cmd,_yield$runCommand$whe,stdout;return regeneratorRuntime.wrap(function _callee84$(_context84){while(1){switch(_context84.prev=_context84.next){case 0:urlString=this.imageUrl;type=urlString.slice(urlString.lastIndexOf(".")+1,urlString.length).toLowerCase();if(type==="jpg"){type="jpeg";}else if(type==="svg"){type="svg+xml";}if(!["gif","jpeg","png","tiff","svg+xml"].includes(type)){type="gif";}if(!urlString.startsWith("http")){urlString="".concat(__varRecorder__$v.location.origin,"/").concat(urlString);}_context84.next=7;return System["import"]("lively.ide/shell/shell-interface");case 7:_yield$System$import2=_context84.sent;runCommand=_yield$System$import2.runCommand;cmd="curl --silent \"".concat(urlString,"\" | openssl base64");_context84.next=12;return runCommand(cmd).whenDone();case 12:_yield$runCommand$whe=_context84.sent;stdout=_yield$runCommand$whe.stdout;return _context84.abrupt("return",this.loadUrl("data:image/".concat(type,";base64,").concat(stdout),false));case 15:case"end":return _context84.stop();}}},_callee84,this);}));function Image_convertToBase64_(){return _Image_convertToBase64_.apply(this,arguments);}return Image_convertToBase64_;}()},{key:"downloadImage",value:function Image_downloadImage_(){var url=this.imageUrl;var name;if(url.match(/^data:image/)){name=this.name||"image-from-lively";var typeMatch=url.match(/image\/([^;]+)/);if(typeMatch&&typeMatch[1])name+="."+typeMatch[1];}else{if(!name)name=__varRecorder__$v.arr.last(url.split("/"));}var link=document.createElement("a");link.download=name;link.href=url;link.click();}},{key:"convertTo",value:function Image_convertTo_(type,quality){if(!quality)quality=1;var _this$canvasElementAn=this.canvasElementAndContext(),ctx=_this$canvasElementAn.ctx,canvas=_this$canvasElementAn.canvas,image=_this$canvasElementAn.image;var width=this.width,height=this.height;canvas.width=image.width;canvas.height=image.height;ctx.drawImage(image,0,0,width,height);return this.loadUrl(canvas.toDataURL(type,quality),false);}},{key:"resampleImageToFitBounds",value:function(){var _Image_resampleImageToFitBounds_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee85(){var _yield$this$canvasEle2,ctx,canvas,image,newWidth,newHeight,imageWidth,imageHeight,data;return regeneratorRuntime.wrap(function _callee85$(_context85){while(1){switch(_context85.prev=_context85.next){case 0:_context85.next=2;return this.canvasElementAndContext();case 2:_yield$this$canvasEle2=_context85.sent;ctx=_yield$this$canvasEle2.ctx;canvas=_yield$this$canvasEle2.canvas;image=_yield$this$canvasEle2.image;newWidth=this.width,newHeight=this.height;imageWidth=image.width,imageHeight=image.height;canvas.width=imageWidth;canvas.height=imageHeight;ctx.drawImage(image,0,0,newWidth,newHeight);data=ctx.getImageData(0,0,imageWidth,imageHeight);canvas.width=newWidth;canvas.height=newHeight;ctx.putImageData(data,0,0);return _context85.abrupt("return",this.loadUrl(canvas.toDataURL(),false));case 16:case"end":return _context85.stop();}}},_callee85,this);}));function Image_resampleImageToFitBounds_(){return _Image_resampleImageToFitBounds_.apply(this,arguments);}return Image_resampleImageToFitBounds_;}()},{key:"crop",value:function Image_crop_(cropBounds){var _this$canvasElementAn2=this.canvasElementAndContext(),ctx=_this$canvasElementAn2.ctx,canvas=_this$canvasElementAn2.canvas,image=_this$canvasElementAn2.image;var innerBounds=this.innerBounds();var imageWidth=image.width,imageHeight=image.height;var intersection=innerBounds.intersection(cropBounds);var relativeCrop=new __varRecorder__$v.Rectangle(intersection.x/innerBounds.width,intersection.y/innerBounds.height,intersection.width/innerBounds.width,intersection.height/innerBounds.height);var _varRecorder__$v$Rec=new __varRecorder__$v.Rectangle(0,0,imageWidth,imageHeight).divide([relativeCrop]),_varRecorder__$v$Rec2=_slicedToArray2(_varRecorder__$v$Rec,1),unscaledCropBounds=_varRecorder__$v$Rec2[0];canvas.width=imageWidth;canvas.height=imageHeight;ctx.drawImage(image,0,0,imageWidth,imageHeight);var data=ctx.getImageData(unscaledCropBounds.x,unscaledCropBounds.y,unscaledCropBounds.width,unscaledCropBounds.height);canvas.width=unscaledCropBounds.width;canvas.height=unscaledCropBounds.height;ctx.putImageData(data,0,0);return this.loadUrl(canvas.toDataURL(),false);}},{key:"interactivelyChangeImageURL",value:function(){var _Image_interactivelyChangeImageURL_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee86(){var url;return regeneratorRuntime.wrap(function _callee86$(_context86){while(1){switch(_context86.prev=_context86.next){case 0:_context86.next=2;return this.world().prompt("Enter image url",{historyId:"lively.morphic-image-url-inputs",input:this.imageUrl.startsWith("data:")?"":this.imageUrl,requester:this});case 2:url=_context86.sent;if(typeof url==="string"){this.imageUrl=url;}case 4:case"end":return _context86.stop();}}},_callee86,this);}));function Image_interactivelyChangeImageURL_(){return _Image_interactivelyChangeImageURL_.apply(this,arguments);}return Image_interactivelyChangeImageURL_;}()},{key:"menuItems",value:function Image_menuItems_(){var _this98=this;var items=initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"menuItems",this).call(this);items.unshift(["change image url...",function(){return _this98.interactivelyChangeImageURL();}],["resize image to to fit world",function(){var s=Math.min(_this98.world().visibleBounds().width/_this98.naturalExtent.x,_this98.world().visibleBounds().height/_this98.naturalExtent.y);_this98.extent=_this98.naturalExtent.scaleBy(s);}],["resize image to its real image size",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee87(){return regeneratorRuntime.wrap(function _callee87$(_context87){while(1){switch(_context87.prev=_context87.next){case 0:_context87.next=2;return _this98.determineNaturalExtent();case 2:return _context87.abrupt("return",_this98.extent=_context87.sent);case 3:case"end":return _context87.stop();}}},_callee87);}))],["resample image to fit current bounds",function(){return _this98.resampleImageToFitBounds();}],{isDivider:true});return items;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Image";}},{key:"properties",get:function get(){return{imageUrl:{isStyleProp:true,copyAssetOnFreeze:true,after:["extent","autoResize"],defaultValue:System.decanonicalize("lively.morphic/lively-web-logo-small.svg"),set:function set(url){var _this99=this;this.isLoaded=false;this.setProperty("imageUrl",url);this.setProperty("naturalExtent",null);var autoResize=this.autoResize&&!this._isDeserializing;this.whenLoaded().then(function(){if(_this99.imageUrl!==url)return;_this99.isLoaded=true;if(autoResize)_this99.extent=_this99.naturalExtent;});}},fill:{defaultValue:__varRecorder__$v.Color.transparent},naturalExtent:{defaultValue:null},isLoaded:{defaultValue:false,serialize:false},autoResize:{isStyleProp:true,defaultValue:false}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:82790,end:92151});}(__varRecorder__$v.Morph));__varRecorder__$v.Image=Image;__varRecorder__$v.Image=Image;__varRecorder__$v.Image=Image;var PathPoint=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("PathPoint")&&typeof __lively_classholder__.PathPoint==="function"?__lively_classholder__.PathPoint:__lively_classholder__.PathPoint=function PathPoint(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function PathPoint_initialize_(path){var props=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};this.path=path;this._isSmooth=props.isSmooth||false;this.x=props.position?props.position.x:props.x||0;this.y=props.position?props.position.y:props.y||0;this._controlPoints=props.controlPoints;}},{key:"__dont_serialize__",get:function get(){return["attributeConnections","$$controlPoints","$$position","doNotCopyProperties","doNotSerialize"];}},{key:"isPathPoint",get:function get(){return true;}},{key:"isSmooth",get:function get(){return this._isSmooth||false;}},{key:"isSmooth",set:function set(smooth){var changed=this._isSmooth!==smooth;if(changed){this._isSmooth=smooth;this.adaptControlPoints(smooth);}}},{key:"position",get:function get(){return __varRecorder__$v.pt(this.x,this.y);}},{key:"position",set:function set(_ref60){var x=_ref60.x,y=_ref60.y;this.x=x;this.y=y;this.path.makeDirty();}},{key:"moveBy",value:function PathPoint_moveBy_(delta){this.position=this.position.addPt(delta);this.path.onVertexChanged(this);return this;}},{key:"copy",value:function PathPoint_copy_(){var e=new __varRecorder__$v.ExpressionSerializer();return new __varRecorder__$v.PathPoint(this.path,e.deserializeExprObj(this.__serialize__()));}},{key:"__serialize__",value:function PathPoint___serialize___(){return{__expr__:"({\n         position: ".concat(this.position.toString(false),",\n         isSmooth: ").concat(this.isSmooth,",\n         controlPoints: {\n           next: ").concat(this.controlPoints.next.toString(false),",\n           previous: ").concat(this.controlPoints.previous.toString(false),"\n         }\n      })").replace(/[\n|\s]/g,""),bindings:{"lively.graphics/geometry-2d.js":["pt"]}};}},{key:"controlPoints",get:function get(){return this._controlPoints||{next:__varRecorder__$v.pt(0,0),previous:__varRecorder__$v.pt(0,0)};}},{key:"controlPoints",set:function set(){var cps=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var next=cps.next,previous=cps.previous;this._controlPoints={next:next?__varRecorder__$v.Point.fromLiteral(next):__varRecorder__$v.pt(0,0),previous:previous?__varRecorder__$v.Point.fromLiteral(previous):__varRecorder__$v.pt(0,0)};this.path.makeDirty();}},{key:"moveNextControlPoint",value:function PathPoint_moveNextControlPoint_(delta){this.moveControlPoint("next",delta);}},{key:"movePreviousControlPoint",value:function PathPoint_movePreviousControlPoint_(delta){this.moveControlPoint("previous",delta);}},{key:"moveControlPoint",value:function PathPoint_moveControlPoint_(name,delta){var _this$controlPoints;var acp=this.controlPoints[name];var acp=acp?acp.addPt(delta):delta;var other=name=="next"?"previous":"next";var bcp=this.controlPoints[other];if(this.isSmooth){bcp=acp.negated().normalized().scaleBy(bcp.r());}this.controlPoints=(_this$controlPoints={},_defineProperty(_this$controlPoints,name,acp),_defineProperty(_this$controlPoints,other,bcp),_this$controlPoints);this.path.onVertexChanged(this);}},{key:"pointOnLine",value:function PathPoint_pointOnLine_(a,b,pos,bw){var v0=__varRecorder__$v.pt(a.x,a.y);var v1=__varRecorder__$v.pt(b.x,b.y);var l=v1.subPt(v0);var ln=l.scaleBy(1/l.r());var dot=v1.subPt(pos).dotProduct(ln);return v1.subPt(ln.scaleBy(Math.max(1,Math.min(dot,l.r())))).addXY(bw,bw);}},{key:"nextVertex",get:function get(){return this.path.vertexAfter(this);}},{key:"previousVertex",get:function get(){return this.path.vertexBefore(this);}},{key:"interpolate",value:function PathPoint_interpolate_(p,pos){var interpolated=this.copy();interpolated.position=interpolated.position.interpolate(p,pos);return interpolated;}},{key:"adaptControlPoints",value:function PathPoint_adaptControlPoints_(smooth){var nextVertex=this.nextVertex,previousVertex=this.previousVertex,position=this.position,path=this.path;var vertices=path.vertices;var i=vertices.indexOf(this);var isFirst=i===0;var isLast=i===vertices.length-1;var previousPos=previousVertex?previousVertex.position:position;var nextPos=nextVertex?nextVertex.position:position;if(smooth){var _p13=this.pointOnLine(previousPos,nextPos,position,path.borderWidth);this.controlPoints={previous:isFirst?__varRecorder__$v.pt(0,0):_p13.subPt(nextPos),next:_p13.subPt(previousPos)};}else{this.controlPoints={previous:isFirst?__varRecorder__$v.pt(0,0):previousPos.subPt(position).scaleBy(0.5),next:isLast?__varRecorder__$v.pt(0,0):nextPos.subPt(position).scaleBy(0.5)};}path.onVertexChanged(this);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"PathPoint";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:92160,end:96125});}(undefined);__varRecorder__$v.PathPoint=PathPoint;__varRecorder__$v.PathPoint=PathPoint;__varRecorder__$v.PathPoint=PathPoint;var Path$1=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Path")&&typeof __lively_classholder__.Path==="function"?__lively_classholder__.Path:__lively_classholder__.Path=function Path(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Path_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,Object.assign({},__varRecorder__$v.obj.dissoc(props,"origin")));this.adjustOrigin(props.origin||this.origin);this.position=props.position||this.position;this.updateBounds(this.vertices);}},{key:"__after_deserialize__",value:function Path___after_deserialize___(snapshot,objRef,pool){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__after_deserialize__",this).call(this,snapshot,objRef,pool);this.updateBounds(this.vertices);}},{key:"__additionally_serialize__",value:function Path___additionally_serialize___(snapshot,ref,pool,addFn){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__additionally_serialize__",this).call(this,snapshot,ref,pool,addFn);var draggable=this.getProperty("draggable");if(draggable!=this.propertiesAndPropertySettings().properties.draggable.defaultValue){snapshot.props.draggable={value:draggable};}var c=this.borderColor.valueOf();if(!c)return;snapshot.props.borderColor={key:"borderColor",value:pool.expressionSerializer.exprStringEncode({__expr__:c.toJSExpr(),bindings:{"lively.graphics/geometry-2d.js":["pt","rect"],"lively.graphics/color.js":["Color",__varRecorder__$v.getClassName(c)]}})};}},{key:"isPath",get:function get(){return true;}},{key:"isSvgMorph",get:function get(){return true;}},{key:"onVertexChanged",value:function Path_onVertexChanged_(vertex){this.makeDirty();this.updateBounds(this.vertices);}},{key:"copyVertices",value:function Path_copyVertices_(){return this.vertices.map(function(v){return v.copy();});}},{key:"updateBounds",value:function Path_updateBounds_(){var vertices=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.vertices;if(!vertices.length)return;if(this._adjustingVertices)return;this._adjustingVertices=true;var origin=this.origin,_this$extent3=this.extent,w=_this$extent3.x,h=_this$extent3.y;var relOriginX=origin.x/w;var relOriginY=origin.y/h;var points=[];vertices.forEach(function(vertex,i){var isSmooth=vertex.isSmooth,position=vertex.position,controlPoints=vertex.controlPoints;var _ref61=controlPoints||{},next=_ref61.next,previous=_ref61.previous;points.push(position);if(isSmooth&&i>0&&i<vertices.length-1){points.push(position.addPt(next),position.addPt(previous));}});var b=__varRecorder__$v.Rectangle.unionPts(points);var newOrigin=__varRecorder__$v.pt(b.width*relOriginX,b.height*relOriginY);var offset=b.topLeft();vertices.forEach(function(ea){return ea.moveBy(offset.negated());});this.moveBy(this.getTransform().transformDirection(offset));this.extent=b.extent().maxPt(__varRecorder__$v.pt(this.borderWidth,this.borderWidth));this.origin=newOrigin;this._adjustingVertices=false;}},{key:"onChange",value:function Path_onChange_(change){var prop=change.prop,value=change.value,prevValue=change.prevValue;var _adjustingVertices=this._adjustingVertices,_adjustingOrigin=this._adjustingOrigin;if(prop=="extent"&&value&&prevValue&&!_adjustingVertices){this.adjustVertices(value.scaleByPt(prevValue.inverted()));}if(!_adjustingOrigin&&prop==="vertices"||prop==="borderWidthLeft"){this.updateBounds(prop=="vertices"?value:this.vertices);}if(!_adjustingVertices&&prop==="origin"){this.updateBounds(this.vertices);}initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onChange",this).call(this,change);}},{key:"vertexBefore",value:function Path_vertexBefore_(v){var i=this.vertices.indexOf(v)-1;return this.vertices[i>=0?i:this.vertices.length-1];}},{key:"vertexAfter",value:function Path_vertexAfter_(v){var i=this.vertices.indexOf(v)+1;return this.vertices[i>this.vertices.length-1?0:i];}},{key:"adjustVertices",value:function Path_adjustVertices_(delta){var _this100=this;var vertices=this.vertices;if(!vertices)return;vertices.forEach(function(v){var _v$controlPoints=v.controlPoints,next=_v$controlPoints.next,previous=_v$controlPoints.previous;next=next.scaleByPt(delta);previous=previous.scaleByPt(delta);v.position=v.position.addPt(_this100.origin).scaleByPt(delta).subPt(_this100.origin);v.controlPoints={next:next,previous:previous};});}},{key:"adjustOrigin",value:function Path_adjustOrigin_(newOrigin){this._adjustingOrigin=true;var vertices=this.vertices,origin=this.origin;vertices.forEach(function(v){return v.position=origin.subPt(newOrigin).addXY(v.x,v.y);});initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"adjustOrigin",this).call(this,newOrigin);this._adjustingOrigin=false;}},{key:"addVertex",value:function Path_addVertex_(v){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var vertices=this.vertices;var insertIndex=typeof before==="number"?before:before&&before.isPathPoint?vertices.indexOf(before):undefined;if(typeof insertIndex==="number"&&insertIndex>-1){vertices.splice(insertIndex,0,v);}else vertices.push(v);this.vertices=vertices;}},{key:"addVertexCloseTo",value:function Path_addVertexCloseTo_(point){var _this$verticesCloseTo=this.verticesCloseTo(point),_this$verticesCloseTo2=_this$verticesCloseTo.closest,closestLength=_this$verticesCloseTo2.length,closestV=_this$verticesCloseTo2.vertex,next=_this$verticesCloseTo.next;var _this$findClosestPoin=this.findClosestPointOnPath(point,10,3),length=_this$findClosestPoin.length,insertionPoint=_this$findClosestPoin.point;var insertBefore=length<=closestLength?closestV:next?next.vertex:null;return this.addVertex(insertionPoint,insertBefore);}},{key:"render",value:function Path_render_(renderer){return renderer.renderPath(this);}},{key:"_pathNode",get:function get(){var renderer=__varRecorder__$v.PropertyPath("env.renderer").get(this);var node=renderer&&renderer.getNodeForMorph(this);return node&&node.querySelector("#svg"+__varRecorder__$v.string.regExpEscape(this.id));}},{key:"verticesCloseTo",value:function Path_verticesCloseTo_(point){var withLength=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var vertices=this.vertices;var minDist=Infinity;var minDistIndex=-1;for(var _i105=0;_i105<vertices.length;_i105++){var dist=vertices[_i105].position.dist(point);if(dist>=minDist)continue;minDist=dist;minDistIndex=_i105;}var previous=minDistIndex===0?null:{index:minDistIndex-1,vertex:vertices[minDistIndex-1]};var next=minDistIndex===vertices.length-1?null:{index:minDistIndex+1,vertex:vertices[minDistIndex+1]};var closest={index:minDistIndex,vertex:vertices[minDistIndex]};if(withLength){var _pathNode=this._pathNode;if(previous){var _this$findClosestPoin2=this.findClosestPointOnPath(previous.vertex.position,6,3,_pathNode),length=_this$findClosestPoin2.length;previous.length=length;}if(next){var _this$findClosestPoin3=this.findClosestPointOnPath(next.vertex.position,6,3,_pathNode),_length2=_this$findClosestPoin3.length;next.length=_length2;}{var _this$findClosestPoin4=this.findClosestPointOnPath(closest.vertex.position,20,3,_pathNode),_length3=_this$findClosestPoin4.length;closest.length=_length3;}}return{previous:previous,next:next,closest:closest};}},{key:"findClosestPointOnPath",value:function Path_findClosestPointOnPath_(fromPoint,nSamples,iterations,pathNode){if(!pathNode){var node=this.env.renderer.getNodeForMorph(this);pathNode=node&&node.querySelector("#svg"+__varRecorder__$v.string.regExpEscape(this.id));}return pathNode?findClosestPointOnPath(pathNode,fromPoint,nSamples,iterations):{length:0,point:fromPoint};function findClosestPointOnPath(pathNode,pos){var nSamples=arguments.length>2&&arguments[2]!==undefined?arguments[2]:10;var iterations=arguments.length>3&&arguments[3]!==undefined?arguments[3]:3;var fromLength=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var toLength=arguments.length>5&&arguments[5]!==undefined?arguments[5]:pathNode.getTotalLength();var iteration=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var samples=samplePathPoints(pathNode,toLength,fromLength,nSamples);var minDist=Infinity;var minIndex=-1;var _iterator56=_createForOfIteratorHelper(samples),_step56;try{for(_iterator56.s();!(_step56=_iterator56.n()).done;){var _step56$value=_slicedToArray2(_step56.value,3),_point=_step56$value[0],atLength=_step56$value[1],_i106=_step56$value[2];var dist=pos.dist(_point);if(dist>=minDist)continue;minDist=dist;minIndex=_i106;}}catch(err){_iterator56.e(err);}finally{_iterator56.f();}if(iteration>=iterations){var _samples$minIndex=_slicedToArray2(samples[minIndex],2),point=_samples$minIndex[0],length=_samples$minIndex[1];return{point:point,length:length};}fromLength=samples[Math.max(0,minIndex-1)][1];toLength=samples[Math.min(samples.length-1,minIndex+1)][1];return findClosestPointOnPath(pathNode,pos,nSamples,iterations,fromLength,toLength,iteration+1);function samplePathPoints(pathNode,from,to,sampleSize){var points=[];var step=(to-from)/(sampleSize-1);var i=0;points.push([__varRecorder__$v.Point.ensure(pathNode.getPointAtLength(from)),from,i]);for(i=1;i<sampleSize-1;i++){var _length4=from+i*step;points.push([__varRecorder__$v.Point.ensure(pathNode.getPointAtLength(_length4)),_length4,i]);}points.push([__varRecorder__$v.Point.ensure(pathNode.getPointAtLength(to)),to,i]);return points;}}}},{key:"onDragStart",value:function Path_onDragStart_(evt){var target=evt.domEvt.target;var cssClass=new __varRecorder__$v.PropertyPath("attributes.class.value").get(target);if(cssClass&&cssClass.includes("path-point")){var _cssClass$match=cssClass.match(/path-point-([0-9]+)(?:-control-([0-9]+))?$/),_cssClass$match2=_slicedToArray2(_cssClass$match,3),_4=_cssClass$match2[0],_n5=_cssClass$match2[1],ctrlN=_cssClass$match2[2];this._controlPointDrag={marker:target,n:Number(_n5)};if(ctrlN!==undefined)this._controlPointDrag.ctrlN=Number(ctrlN);}else return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onDragStart",this).call(this,evt);}},{key:"onDrag",value:function Path_onDrag_(evt){if(!this._controlPointDrag)return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onDrag",this).call(this,evt);var _this$_controlPointDr=this._controlPointDrag,target=_this$_controlPointDr.target,n=_this$_controlPointDr.n,ctrlN=_this$_controlPointDr.ctrlN;var vertices=this.vertices;var v=vertices[n];if(v){var delta=this.getInverseTransform().transformDirection(evt.state.dragDelta);if(ctrlN===undefined){v.moveBy(delta);var vp=vertices[n-1];var vn=vertices[n+1];if(vp&&vp.position.dist(v.position)<10){this._controlPointDrag.maybeMerge=[n-1,n];}else if(vn&&vn.position.dist(v.position)<10){this._controlPointDrag.maybeMerge=[n,n+1];}else{this._controlPointDrag.maybeMerge=undefined;}}else if(ctrlN===1)v.movePreviousControlPoint(delta);else if(ctrlN===2)v.moveNextControlPoint(delta);}}},{key:"onDragEnd",value:function Path_onDragEnd_(evt){var vertices=this.vertices,_controlPointDrag=this._controlPointDrag;if(_controlPointDrag){var maybeMerge=_controlPointDrag.maybeMerge;delete this._controlPointDrag;if(maybeMerge){var _maybeMerge=_slicedToArray2(maybeMerge,2),_i107=_maybeMerge[0],_j12=_maybeMerge[1];var v1=vertices[_i107];var v2=vertices[_j12];v1.controlPoints.next=v2.controlPoints.next;vertices.splice(_j12,1);this.vertices=vertices;}}}},{key:"onMouseDown",value:function Path_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);var clickCount=evt.state.clickCount;var _double2=clickCount===2;if(_double2){this.addVertexCloseTo(this.localize(evt.position));}}},{key:"menuItems",value:function Path_menuItems_(){var _this101=this;var checked=__varRecorder__$v.Icon.textAttribute("check-square",{textStyleClasses:["far"]});var unchecked=__varRecorder__$v.Icon.textAttribute("square",{textStyleClasses:["far"]});unchecked[1].paddingRight="7px";checked[1].paddingRight="5px";return[[[].concat(_toConsumableArray2(this.showControlPoints?checked:unchecked),[" control points"]),function(){return _this101.showControlPoints=!_this101.showControlPoints;}],[[].concat(_toConsumableArray2(this.isSmooth?checked:unchecked),[" smooth"]),function(){return _this101.isSmooth=!_this101.isSmooth;}],{isDivider:true}].concat(_toConsumableArray2(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"menuItems",this).call(this)));}},{key:"getPointOnPath",value:function Path_getPointOnPath_(n){if(!this._pathNode)return __varRecorder__$v.pt(0,0);var _ref62=this._pathNode.getPointAtLength(this._pathNode.getTotalLength()*n)||__varRecorder__$v.pt(0,0),x=_ref62.x,y=_ref62.y;return __varRecorder__$v.pt(x,y);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Path";}},{key:"properties",get:function get(){return{borderColor:{isStyleProp:true,type:"ColorGradient",foldable:["top","left","right","bottom"],set:function set(value){if(!value)value=__varRecorder__$v.Color.white;if(value.isColor||value.isGradient){value={top:value,left:value,right:value,bottom:value};}this.setProperty("borderColor",__varRecorder__$v.obj.extract(value,["top","left","right","bottom"],function(k,v){return __varRecorder__$v.obj.isArray(v)?__varRecorder__$v.Color.fromTuple(v):v;}));}},showControlPoints:{defaultValue:false},vertices:{defaultValue:[],isStyleProp:true,after:["isSmooth","borderWidth"],before:["extent","origin"],type:"Vertices",set:function set(vs){var _this102=this;var isSmooth=this.isSmooth;this._adjustingVertices=true;vs=vs.map(function(v){return v.isPathPoint?Object.assign(v,{path:_this102}):new __varRecorder__$v.PathPoint(_this102,Object.assign({isSmooth:isSmooth},v));});this.setProperty("vertices",vs);this._adjustingVertices=false;this.updateBounds(vs);}},startMarker:{defaultValue:null,type:"Object"},endMarker:{defaultValue:null,type:"Object"},endStyle:{isStyleProp:true,type:"Enum",values:["butt","round","square"],defaultValue:"butt"},drawnProportion:{type:"Number",isStyleProp:true,isFloat:true,min:-1,max:1,defaultValue:0},cornerStyle:{type:"Enum",isStyleProp:true,values:["arcs","bevel","miter","miter-clip","round"],defaultValue:"miter"},draggable:{get:function get(){return this.getProperty("draggable")||this.showControlPoints;}},isSmooth:{defaultValue:false,before:["vertices"],type:"Boolean",set:function set(val){this.setProperty("isSmooth",val);if(this.vertices){this._adjustingVertices=true;this.vertices.forEach(function(ea){return ea.isSmooth=val;});this._adjustingVertices=false;this.updateBounds(this.vertices);}}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:96134,end:109805});}(__varRecorder__$v.Morph);__varRecorder__$v.Path=Path$1;__varRecorder__$v.Path=Path$1;__varRecorder__$v.Path=Path$1;var Polygon=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Polygon")&&typeof __lively_classholder__.Polygon==="function"?__lively_classholder__.Polygon:__lively_classholder__.Polygon=function Polygon(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Polygon_initialize_(props){if(props.vertices&&props.vertices.length>2){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);}else{throw new Error("A polygon requires 3 or more vertices!");}}},{key:"isPolygon",get:function get(){return true;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Polygon";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:109814,end:110068});}(__varRecorder__$v.Path);__varRecorder__$v.Polygon=Polygon;__varRecorder__$v.Polygon=Polygon;__varRecorder__$v.Polygon=Polygon;var LineMorph=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("LineMorph")&&typeof __lively_classholder__.LineMorph==="function"?__lively_classholder__.LineMorph:__lively_classholder__.LineMorph=function LineMorph(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"isPolygon",get:function get(){return true;}},{key:"update",value:function LineMorph_update_(){if(this._isUpdating)return;this._isUpdating=true;var line=this.line,height=this.height;var vec=line.toVector();this.setProperty("position",this.position.addPt(line.perpendicularLine(0,height,"cc").toVector()));this.width=vec.fastR();this.rotation=vec.theta();this.vec=vec;this._isUpdating=false;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"LineMorph";}},{key:"properties",get:function get(){return{borderWidth:{defaultValue:0},fill:{defaultValue:__varRecorder__$v.Color.black},height:{defaultValue:1},line:{defaultValue:__varRecorder__$v.Line.fromCoords(0,0,0,0),set:function set(val){this.setProperty("line",val);this.update(val);}},start:{derived:true,after:["line"],get:function get(val){return this.line.start;},set:function set(val){this.line=this.line.withStart(val);}},end:{derived:true,after:["line"],get:function get(val){return this.line.end;},set:function set(val){this.line=this.line.withEnd(val);}},position:{derived:true,after:["line"],get:function get(val){return this.start;},set:function set(val){var delta=val.subPt(this.start);var rotation=this.rotation;this.line=new __varRecorder__$v.Line(val,this.end.addPt(delta));this.rotation=rotation;}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:110077,end:111569});}(__varRecorder__$v.Morph);__varRecorder__$v.LineMorph=LineMorph;__varRecorder__$v.LineMorph=LineMorph;__varRecorder__$v.LineMorph=LineMorph;var __captured1__$1=/*#__PURE__*/Object.freeze({__proto__:null,Morph:Morph,Ellipse:Ellipse,Triangle:Triangle,Image:Image,PathPoint:PathPoint,Path:Path$1,Polygon:Polygon,LineMorph:LineMorph});var __varRecorder__$w=lively.FreezerRuntime.recorderFor("lively.morphic/tooltips.js");__varRecorder__$w.pt=pt;__varRecorder__$w.Morph=Morph;__varRecorder__$w.morph=morph;__varRecorder__$w.config=config;var TooltipViewer=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/tooltips.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TooltipViewer")&&typeof __lively_classholder__.TooltipViewer==="function"?__lively_classholder__.TooltipViewer:__lively_classholder__.TooltipViewer=function TooltipViewer(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function TooltipViewer_initialize_(world){this.currentMorph=world;}},{key:"__dont_serialize__",get:function get(){return["currentTooltip","currentMorph"];}},{key:"notPartOfCurrentTooltip",value:function TooltipViewer_notPartOfCurrentTooltip_(newTarget){return!newTarget.ownerChain().includes(this.currentMorph);}},{key:"invalidatesCurrentTooltip",value:function TooltipViewer_invalidatesCurrentTooltip_(newTarget){return newTarget.tooltip||this.notPartOfCurrentTooltip(newTarget);}},{key:"mouseMove",value:function TooltipViewer_mouseMove_(evt){var hand=evt.hand;var targetMorph=hand.morphBeneath(evt.positionIn($world));while(targetMorph&&!targetMorph.visible){targetMorph=targetMorph.morphBeneath(evt.positionIn($world));}if(!targetMorph)return;if(this.currentMorph===targetMorph||!this.invalidatesCurrentTooltip(targetMorph))return;this.hoverOutOfMorph(this.currentMorph);this.hoverIntoMorph(targetMorph,hand);this.currentMorph=targetMorph;}},{key:"mouseDown",value:function TooltipViewer_mouseDown_(_ref63){var targetMorph=_ref63.targetMorph;this.currentTooltip&&this.currentTooltip.remove();this.currentTooltip=null;}},{key:"hoverIntoMorph",value:function TooltipViewer_hoverIntoMorph_(morph,hand){this.clearScheduledTooltip();if(this.currentTooltip){this.showTooltipFor(morph,hand);}else{this.scheduleTooltipFor(morph,hand);}}},{key:"hoverOutOfMorph",value:function TooltipViewer_hoverOutOfMorph_(morph){var _this103=this;var current=this.currentTooltip;this.currentTooltip&&this.currentTooltip.softRemove(function(tooltip){return _this103.currentTooltip==tooltip&&(_this103.currentTooltip=null);});}},{key:"scheduleTooltipFor",value:function TooltipViewer_scheduleTooltipFor_(morph,hand){var _this104=this;this.timer=setTimeout(function(){return _this104.showTooltipFor(morph,hand);},__varRecorder__$w.config.showTooltipsAfter*1000);}},{key:"clearScheduledTooltip",value:function TooltipViewer_clearScheduledTooltip_(){clearTimeout(this.timer);}},{key:"clearCurrentTooltip",value:function TooltipViewer_clearCurrentTooltip_(){var current=this.currentTooltip;if(current)current.remove();}},{key:"showTooltipFor",value:function TooltipViewer_showTooltipFor_(morph,hand){if(!morph.tooltip||!morph.world())return;this.clearCurrentTooltip();var position=hand?hand.position.addXY(10,7):morph.globalBounds().bottomRight();this.currentTooltip=new __varRecorder__$w.Tooltip({position:position,description:morph.tooltip});morph.world().addMorph(this.currentTooltip);this.currentTooltip.update(morph);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TooltipViewer";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"tooltips.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:154,end:2311});}(undefined);__varRecorder__$w.TooltipViewer=TooltipViewer;__varRecorder__$w.TooltipViewer=TooltipViewer;__varRecorder__$w.TooltipViewer=TooltipViewer;var Tooltip=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/tooltips.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Tooltip")&&typeof __lively_classholder__.Tooltip==="function"?__lively_classholder__.Tooltip:__lively_classholder__.Tooltip=function Tooltip(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"update",value:function Tooltip_update_(target){this.position=target.globalBounds().bottomCenter().subPt(target.world().scroll).addPt(__varRecorder__$w.pt(0,7));}},{key:"softRemove",value:function(){var _Tooltip_softRemove_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee88(cb){return regeneratorRuntime.wrap(function _callee88$(_context88){while(1){switch(_context88.prev=_context88.next){case 0:_context88.next=2;return this.animate({opacity:0,duration:300});case 2:cb&&cb(this);this.remove();case 4:case"end":return _context88.stop();}}},_callee88,this);}));function Tooltip_softRemove_(_x111){return _Tooltip_softRemove_.apply(this,arguments);}return Tooltip_softRemove_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Tooltip";}},{key:"properties",get:function get(){return{hasFixedPosition:{defaultValue:true},reactsToPointer:{defaultValue:false},isEpiMorph:{defaultValue:true},master:{initialize:function initialize(){this.master={auto:"styleguide://System/tooltip"};}},description:{after:["submorphs"],derived:true,get:function get(){var _this$submorphs=_slicedToArray2(this.submorphs,1),descriptor=_this$submorphs[0];return descriptor.value;},set:function set(stringOrAttributes){var _this$submorphs2=_slicedToArray2(this.submorphs,1),descriptor=_this$submorphs2[0];descriptor.value=stringOrAttributes;descriptor.fit();}},submorphs:{initialize:function initialize(){this.submorphs=[new __varRecorder__$w.morph({type:"label",width:200})];}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"tooltips.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:2320,end:3477});}(__varRecorder__$w.Morph);__varRecorder__$w.Tooltip=Tooltip;__varRecorder__$w.Tooltip=Tooltip;__varRecorder__$w.Tooltip=Tooltip;var __captured9__=/*#__PURE__*/Object.freeze({__proto__:null,TooltipViewer:TooltipViewer,Tooltip:Tooltip});var __varRecorder__$x=lively.FreezerRuntime.recorderFor("lively.morphic/morphicdb/index.js");__varRecorder__$x["default"]=MorphicDB$1;__varRecorder__$x.MorphicDB=MorphicDB$1;var __captured10__=/*#__PURE__*/Object.freeze({__proto__:null,MorphicDB:MorphicDB$1});var __varRecorder__$y=lively.FreezerRuntime.recorderFor("lively.ide/shell/shell-interface.js");var CommandInterface=/*#__PURE__*/function(){_createClass(CommandInterface,null,[{key:"findCommand",value:function findCommand(pid){return this.commands.find(function(ea){return ea.pid===pid;});}},{key:"commands",get:function get(){return this._commands||(this._commands=[]);}}]);function CommandInterface(){_classCallCheck(this,CommandInterface);this._stdout="";this._stderr="";this.exitCode=undefined;this.commandString="";this.process=null;this._whenDone=promise.deferred();this._whenStarted=promise.deferred();this.startTime=0;this.lastSignal=null;makeEmitter(this);}_createClass(CommandInterface,[{key:"isRunning",value:function isRunning(){return this.process&&this.exitCode===undefined;}},{key:"isDone",value:function isDone(){return this.exitCode!=undefined;}},{key:"whenStarted",value:function whenStarted(){return this._whenStarted.promise;}},{key:"whenDone",value:function whenDone(){return this._whenDone.promise;}},{key:"spawn",value:function spawn(){var cmdInstructions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{command:null,env:{},cwd:null,stdin:null};throw new Error("not yet implemented");}},{key:"kill",value:function kill(){var signal=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"KILL";this.lastSignal=signal;}},{key:"toString",value:function toString(){return"".concat(this.constructor.name,"(").concat(this.commandString,", ").concat(this.status,")");}},{key:"isShellCommand",get:function get(){return true;}},{key:"status",get:function get(){if(!this.process)return"not started";if(this.exitCode===undefined)return"running, pid ".concat(this.pid);return"exited ".concat(this.exitCode,", pid ").concat(this.pid);}},{key:"pid",get:function get(){return this.process?this.process.pid:null;}},{key:"output",get:function get(){return this.stdout+(this.stderr?"\n"+this.stderr:"");}},{key:"stdout",get:function get(){return this._stdout;}},{key:"stderr",get:function get(){return this._stderr;}}]);return CommandInterface;}();var debug=false;function runCommand(commandString){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var l2lClient=opts.l2lClient;if(!l2lClient)throw new Error("lively.shell client side runCommand needs opts.l2lClient!");ClientCommand.installLively2LivelyServices(l2lClient);var cmd=new ClientCommand(l2lClient);cmd.spawn(_objectSpread({command:commandString},dissoc(opts,["l2lClient"])));return cmd;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var ClientCommand=/*#__PURE__*/function(_CommandInterface){_inherits(ClientCommand,_CommandInterface);var _super13=_createSuper(ClientCommand);_createClass(ClientCommand,null,[{key:"installLively2LivelyServices",value:function installLively2LivelyServices(l2lClient){Object.keys(L2LServices).forEach(function(name){return l2lClient.addService(name,/*#__PURE__*/function(){var _ref64=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee89(tracker,msg,ackFn){return regeneratorRuntime.wrap(function _callee89$(_context89){while(1){switch(_context89.prev=_context89.next){case 0:return _context89.abrupt("return",L2LServices[name](tracker,msg,ackFn));case 1:case"end":return _context89.stop();}}},_callee89);}));return function(_x112,_x113,_x114){return _ref64.apply(this,arguments);};}());});}}]);function ClientCommand(l2lClient){var _this105;_classCallCheck(this,ClientCommand);_this105=_super13.call(this);_this105.debug=debug;_this105.l2lClient=l2lClient;return _this105;}_createClass(ClientCommand,[{key:"envForCommand",value:function envForCommand(opts){// here we set environment variables for the command to be run. the stuff
// below is to support the bin/command2lively.js script and related scripts
// like askpass support
var _this$l2lClient=this.l2lClient,id=_this$l2lClient.id,origin=_this$l2lClient.origin,path=_this$l2lClient.path,namespace=_this$l2lClient.namespace;var _ref65=opts||{},env=_ref65.env,owner=_ref65.owner;env=env||{};if(owner)env.LIVELY_COMMAND_OWNER=owner;return _objectSpread({// L2L_ASKPASS_AUTH_HEADER:
ASKPASS_SESSIONID:id,L2L_EDITOR_SESSIONID:id,L2L_SESSIONTRACKER_SERVER:origin,L2L_SESSIONTRACKER_PATH:path,L2L_SESSIONTRACKER_NS:namespace},env);}},{key:"spawn",value:function(){var _spawn=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee90(){var _this106=this;var cmdInstructions,l2lClient,command,env,cwd,stdin,_yield$l2lClient$send,_yield$l2lClient$send2,status,error,pid,_args91=arguments;return regeneratorRuntime.wrap(function _callee90$(_context90){while(1){switch(_context90.prev=_context90.next){case 0:cmdInstructions=_args91.length>0&&_args91[0]!==undefined?_args91[0]:{command:null,env:{},cwd:null,stdin:null};l2lClient=this.l2lClient,command=cmdInstructions.command,env=cmdInstructions.env,cwd=cmdInstructions.cwd,stdin=cmdInstructions.stdin;this.startTime=new Date();env=this.envForCommand(cmdInstructions);this.debug&&console.log("".concat(this," spawning ").concat(command));this.debug&&this.whenStarted().then(function(){return console.log("".concat(_this106," started"));});this.debug&&this.whenDone().then(function(){return console.log("".concat(_this106," exited"));});pushIfNotIncluded(this.constructor.commands,this);this.commandString=Array.isArray(command)?command.join(""):command;_context90.next=11;return l2lClient.sendToAndWait(l2lClient.trackerId,"lively.shell.spawn",{command:command,env:env,cwd:cwd,stdin:stdin},{ackTimeout:30*1000});case 11:_yield$l2lClient$send=_context90.sent;_yield$l2lClient$send2=_yield$l2lClient$send.data;status=_yield$l2lClient$send2.status;error=_yield$l2lClient$send2.error;pid=_yield$l2lClient$send2.pid;if(!error){_context90.next=21;break;}this.process={error:error};this.exitCode=1;signal(this,"error",error);throw new Error(error);case 21:this.process={pid:pid};signal(this,"pid",pid);this._whenStarted.resolve();return _context90.abrupt("return",this);case 25:case"end":return _context90.stop();}}},_callee90,this);}));function spawn(){return _spawn.apply(this,arguments);}return spawn;}()},{key:"writeToStdin",value:function(){var _writeToStdin=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee91(content){var l2lClient,pid;return regeneratorRuntime.wrap(function _callee91$(_context91){while(1){switch(_context91.prev=_context91.next){case 0:if(this.isRunning()){_context91.next=2;break;}return _context91.abrupt("return");case 2:l2lClient=this.l2lClient,pid=this.pid;_context91.next=5;return l2lClient.sendToAndWait(l2lClient.trackerId,"lively.shell.writeToStdin",{pid:pid,stdin:String(content)});case 5:case"end":return _context91.stop();}}},_callee91,this);}));function writeToStdin(_x115){return _writeToStdin.apply(this,arguments);}return writeToStdin;}()},{key:"kill",value:function(){var _kill=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee92(){var signal,pid,l2lClient,_yield$l2lClient$send3,_yield$l2lClient$send4,status,error,_args93=arguments;return regeneratorRuntime.wrap(function _callee92$(_context92){while(1){switch(_context92.prev=_context92.next){case 0:signal=_args93.length>0&&_args93[0]!==undefined?_args93[0]:"KILL";if(this.isRunning()){_context92.next=3;break;}return _context92.abrupt("return");case 3:this.lastSignal=signal;pid=this.pid;l2lClient=this.l2lClient;_context92.next=8;return l2lClient.sendToAndWait(l2lClient.trackerId,"lively.shell.kill",{pid:pid});case 8:_yield$l2lClient$send3=_context92.sent;_yield$l2lClient$send4=_yield$l2lClient$send3.data;status=_yield$l2lClient$send4.status;error=_yield$l2lClient$send4.error;if(!error){_context92.next=14;break;}throw new Error(error);case 14:return _context92.abrupt("return",this.whenDone());case 15:case"end":return _context92.stop();}}},_callee92,this);}));function kill(){return _kill.apply(this,arguments);}return kill;}()},{key:"onOutput",value:function onOutput(_ref66){var stdout=_ref66.stdout,stderr=_ref66.stderr;if(stdout){this._stdout+=stdout;signal(this,"stdout",stdout);this.emit("stdout",stdout);}if(stderr){this._stderr+=stderr;signal(this,"stderr",stderr);this.emit("stderr",stderr);}}},{key:"onClose",value:function onClose(code){remove(this.constructor.commands,this);this.exitCode=code;this.emit('close',code);signal(this,'close',code);this._whenDone.resolve(this);}},{key:"onError",value:function onError(err){remove(this.constructor.commands,this);this._stderr+=err.stack;this.exitCode=1;this.emit('error',err.stack);signal(this,'error',err.stack);this._whenDone.reject(err);}}]);return ClientCommand;}(CommandInterface);var L2LServices={"lively.shell.onOutput":function(){var _livelyShellOnOutput=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee93(client,_ref67,ackFn,sender){var _ref67$data,pid,stdout,stderr,cmd;return regeneratorRuntime.wrap(function _callee93$(_context93){while(1){switch(_context93.prev=_context93.next){case 0:_ref67$data=_ref67.data,pid=_ref67$data.pid,stdout=_ref67$data.stdout,stderr=_ref67$data.stderr;_context93.prev=1;_context93.next=4;return promise.waitFor(1000,function(){return ClientCommand.findCommand(pid);});case 4:cmd=_context93.sent;_context93.next=11;break;case 7:_context93.prev=7;_context93.t0=_context93["catch"](1);console.warn("[lively.shell] received output for command ".concat(pid," but it isn't registered!'"));return _context93.abrupt("return");case 11:cmd.onOutput({stdout:stdout,stderr:stderr});case 12:case"end":return _context93.stop();}}},_callee93,null,[[1,7]]);}));function livelyShellOnOutput(_x116,_x117,_x118,_x119){return _livelyShellOnOutput.apply(this,arguments);}return livelyShellOnOutput;}(),"lively.shell.onExit":function(){var _livelyShellOnExit=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee94(client,_ref68,ackFn,sender){var _ref68$data,pid,code,error,cmd;return regeneratorRuntime.wrap(function _callee94$(_context94){while(1){switch(_context94.prev=_context94.next){case 0:_ref68$data=_ref68.data,pid=_ref68$data.pid,code=_ref68$data.code,error=_ref68$data.error;_context94.prev=1;_context94.next=4;return promise.waitFor(1000,function(){return ClientCommand.findCommand(pid);});case 4:cmd=_context94.sent;_context94.next=11;break;case 7:_context94.prev=7;_context94.t0=_context94["catch"](1);console.warn("[lively.shell] received exit message for command ".concat(pid," but it isn't registered!'"));return _context94.abrupt("return");case 11:if(error){if(typeof error==="string")error=new Error(error);cmd.onError(error);}else cmd.onClose(code);case 12:case"end":return _context94.stop();}}},_callee94,null,[[1,7]]);}));function livelyShellOnExit(_x120,_x121,_x122,_x123){return _livelyShellOnExit.apply(this,arguments);}return livelyShellOnExit;}()};// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// uses the "ls" shell utility to get file properties
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function fileInfo(_x124,_x125){return _fileInfo.apply(this,arguments);}function _fileInfo(){_fileInfo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee217(fileName,options){var commandString,cmd,err,_parseDirectoryListFr,_parseDirectoryListFr2,fileInfo;return regeneratorRuntime.wrap(function _callee217$(_context217){while(1){switch(_context217.prev=_context217.next){case 0:commandString=fileInfoCommandString(fileName,options),cmd=runCommand(commandString,options);_context217.next=3;return cmd.whenDone();case 3:err=cmd.exitCode!=0?cmd.output:null;if(!err){_context217.next=6;break;}throw err;case 6:_parseDirectoryListFr=parseDirectoryListFromLs(cmd.stdout,options.rootDirectory||"."),_parseDirectoryListFr2=_slicedToArray2(_parseDirectoryListFr,1),fileInfo=_parseDirectoryListFr2[0];return _context217.abrupt("return",fileInfo);case 8:case"end":return _context217.stop();}}},_callee217);}));return _fileInfo.apply(this,arguments);}function fileInfoCommandString(filename){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var rootDirectory=options.rootDirectory,platform=options.platform;rootDirectory=rootDirectory||'.';var slash=platform==='win32'?'\\':'/';if(platform!=='win32'&&!rootDirectory.endsWith(slash))rootDirectory+=slash;// we expect an consistent timeformat across OSs to parse the results
var timeFormatFix="if [ \"$(uname)\" = \"Darwin\" ];\n      then timeformat='-T'; else\n      timeformat=\"--time-style=+%b %d %T %Y\";\n    fi && ";// use GMT for time settings by default so the result is comparable
// also force US ordering of date/time elements, to help with the parsing
var commandString=platform==='win32'?"cd ".concat(rootDirectory," && ls -lLd --time-style=locale \"").concat(filename,"\""):timeFormatFix+"env TZ=GMT LANG=en_US.UTF-8 cd ".concat(rootDirectory," && ls -lLd \"$timeformat\" \"").concat(filename,"\"");return commandString;}function parseDirectoryListFromLs(lsString,rootDirectory){// line like "-rw-rr       1 robert   staff       5298 Dec 17 14:04:02 2012 test.html"
return lines(lsString).map(function(line){return!line.trim().length?null:new FileInfo(rootDirectory).readFromDirectoryListLine(line);}).filter(Boolean);}var FileInfo=/*#__PURE__*/function(){function FileInfo(rootDirectory){_classCallCheck(this,FileInfo);this.rootDirectory=rootDirectory;this.path='';this.fileName='';this.isDirectory=false;this.lastModified=null;this.mode='';this.isLink=false;this.linkCount=0;this.user='';this.group='';this.size=0;this.rootDirectory=null;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// parsing from directory list
_createClass(FileInfo,[{key:"readFromDirectoryListLine",value:function readFromDirectoryListLine(line){var _this107=this;if(!line.trim().length)return null;var lineRest=line;this.reader.forEach(function(reader){return lineRest=reader(lineRest,_this107);});return this;}},{key:"toString",value:function toString(){return this.path;}},{key:"reader",get:function get(){return[// the order is important!
function mode(lineString,fileInfo){var idx=lineString.indexOf(' ');fileInfo.mode=lineString.slice(0,idx);fileInfo.isDirectory=fileInfo.mode[0]==='d';return lineString.slice(idx+1).trim();},function linkCount(lineString,fileInfo){var idx=lineString.indexOf(' ');fileInfo.linkCount=Number(lineString.slice(0,idx));return lineString.slice(idx+1).trim();},function user(lineString,fileInfo){var idx=lineString.indexOf(' ');fileInfo.user=lineString.slice(0,idx);return lineString.slice(idx+1).trim();},function group(lineString,fileInfo){var idx=peekRight(lineString,0,/\s+[0-9]/);fileInfo.group=lineString.slice(0,idx).trim();return lineString.slice(idx).trim();},function size(lineString,fileInfo){var idx=lineString.indexOf(' ');fileInfo.size=Number(lineString.slice(0,idx));return lineString.slice(idx+1).trim();},function lastModified(lineString,fileInfo){var matches=reMatches$1(lineString,/[^s]+\s+[0-9:\s]+/);if(!matches||!matches[0])return lineString;fileInfo.lastModified=new Date(matches[0].match+' GMT');return lineString.slice(matches[0].end).trim();},function fileName(lineString,fileInfo){var string=lineString.replace(/^\.\/+/g,'').replace(/\/\//g,'/'),nameAndLink=string&&string.split(' -> '),isLink=string===''?false:string&&nameAndLink.length===2,path=isLink?nameAndLink[0]:string,fileName=path&&path.indexOf(fileInfo.rootDirectory)===0?path.slice(fileInfo.rootDirectory.length):path;fileInfo.fileName=string===''?'.':fileName;fileInfo.path=path;fileInfo.isLink=isLink;return fileName;}];}}]);return FileInfo;}();// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// use the shell find comannd to list files / search for files
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var findFilesProcesses={};function findFiles(_x126,_x127){return _findFiles.apply(this,arguments);}function _findFiles(){_findFiles=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee218(pattern,options){var _findFilesGroup$optio,findFilesGroup,rootDirectory,stateForThisGroup,commands,promiseState,commandString,cmd;return regeneratorRuntime.wrap(function _callee218$(_context218){while(1){switch(_context218.prev=_context218.next){case 0:// lively.ide.CommandLineSearch.findFiles('*html',
//   {exclude: STRING, re: BOOL, depth: NUMBER, cwd: STRING, matchPath: BOOL});
_findFilesGroup$optio=_objectSpread({findFilesGroup:"default-find-files-process"},options),findFilesGroup=_findFilesGroup$optio.findFilesGroup,rootDirectory=_findFilesGroup$optio.rootDirectory;stateForThisGroup=findFilesProcesses[findFilesGroup]||(findFilesProcesses[findFilesGroup]={promiseState:null,commands:[]}),commands=stateForThisGroup.commands,promiseState=stateForThisGroup.promiseState;if(!promiseState)stateForThisGroup.promiseState=promiseState=promise.deferred();commandString=findFilesCommandString(pattern,options);commands.forEach(function(oldCmd){return oldCmd.kill();});cmd=runCommand(commandString,options);commands.push(cmd);cmd.whenDone().then(function(){remove(commands,cmd);var isOutdated=commands.some(function(otherCmd){return otherCmd.startTime>cmd.startTime;});if(isOutdated){console.log("[findFiles] command ".concat(cmd," exited but a newer findFiles command was started for group ").concat(findFilesGroup,", discarding output"));}else{var err=cmd.exitCode!=0?cmd.output:null;if(err)console.warn(err);var result=err?[]:parseDirectoryListFromLs(cmd.stdout,rootDirectory)||[];promiseState.resolve(result);Object.assign(stateForThisGroup,{promiseState:null,commands:[]});}})["catch"](function(err){return console.error(err);});return _context218.abrupt("return",promiseState.promise);case 9:case"end":return _context218.stop();}}},_callee218);}));return _findFiles.apply(this,arguments);}var defaultExcludes=[".svn",".git","node_modules",".module_cache"];function findFilesCommandString(pattern){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var rootDirectory=options.rootDirectory,exclude=options.exclude,depth=options.depth,platform=options.platform;rootDirectory=rootDirectory||'.';exclude=exclude||"-iname "+defaultExcludes.map(print$1).join(' -o -iname ');var slash=platform==='win32'?'\\':'/';if(platform!=='win32'&&!rootDirectory.endsWith(slash))rootDirectory+=slash;// we expect an consistent timeformat across OSs to parse the results
var timeFormatFix="if [ \"$(uname)\" = \"Darwin\" ];\n      then timeformat='-T'; else\n      timeformat=\"--time-style=+%b %d %T %Y\";\n    fi && ";var searchPart=format('%s "%s"',options.re?'-iregex':options.matchPath?'-ipath':'-iname',pattern);var depth=typeof depth==="number"?' -maxdepth '+depth:'';// use GMT for time settings by default so the result is comparable
// also force US ordering of date/time elements, to help with the parsing
var commandString=platform==='win32'?format("find %s %s ( %s ) -prune -o "+"%s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",rootDirectory,options.re?'-E ':'',exclude.replace(/"/g,''),searchPart.replace(/"/g,''),depth):timeFormatFix+format("env TZ=GMT LANG=en_US.UTF-8 "+"find %s %s \\( %s \\) -prune -o "+"%s %s -print0 | xargs -0 -I{} ls -lLd \"$timeformat\" \"{}\"",rootDirectory,options.re?'-E ':'',exclude,searchPart,depth);return commandString;}var ShellClientResource=/*#__PURE__*/function(_Resource4){_inherits(ShellClientResource,_Resource4);var _super14=_createSuper(ShellClientResource);_createClass(ShellClientResource,null,[{key:"defaultL2lClient",get:function get(){return this._defaultL2lClient||_defaultL2LClient;},set:function set(l2lClient){this._defaultL2lClient=_defaultL2LClient=l2lClient;}}]);function ShellClientResource(url,l2lClient){var _this108;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_classCallCheck(this,ShellClientResource);_this108=_super14.call(this,url);_this108.options=_objectSpread(_objectSpread({},options),{},{l2lClient:l2lClient||_this108.constructor.defaultL2lClient});// passed to commands
return _this108;}_createClass(ShellClientResource,[{key:"newResource",value:function newResource(url){return new this.constructor(url,this.options.l2lClient,this.options);}},{key:"read",value:function read(){var _this109=this;var cmd=runCommand("cat \"".concat(this.url,"\""),this.options);return cmd.whenDone().then(function(){if(cmd.exitCode)throw new Error("Read ".concat(_this109.url," failed: ").concat(cmd.stderr));return cmd.output;});}},{key:"write",value:function(){var _write4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee95(content){var cmd;return regeneratorRuntime.wrap(function _callee95$(_context95){while(1){switch(_context95.prev=_context95.next){case 0:if(content){_context95.next=6;break;}_context95.next=3;return runCommand("echo -n > \"".concat(this.url,"\""),_objectSpread({},this.options)).whenDone();case 3:_context95.t0=_context95.sent;_context95.next=9;break;case 6:_context95.next=8;return runCommand("touch \"".concat(this.url,"\" && tee \"").concat(this.url,"\""),_objectSpread({stdin:String(content)},this.options)).whenDone();case 8:_context95.t0=_context95.sent;case 9:cmd=_context95.t0;if(!cmd.exitCode){_context95.next=12;break;}throw new Error("Write ".concat(this.url," failed: ").concat(cmd.stderr));case 12:return _context95.abrupt("return",this);case 13:case"end":return _context95.stop();}}},_callee95,this);}));function write(_x128){return _write4.apply(this,arguments);}return write;}()},{key:"mkdir",value:function(){var _mkdir4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee96(){var cmd;return regeneratorRuntime.wrap(function _callee96$(_context96){while(1){switch(_context96.prev=_context96.next){case 0:_context96.next=2;return runCommand("mkdir -p \"".concat(this.url,"\""),this.options).whenDone();case 2:cmd=_context96.sent;if(!cmd.exitCode){_context96.next=5;break;}throw new Error("".concat(this," cannot create directory: ").concat(cmd.stderr));case 5:return _context96.abrupt("return",this);case 6:case"end":return _context96.stop();}}},_callee96,this);}));function mkdir(){return _mkdir4.apply(this,arguments);}return mkdir;}()},{key:"exists",value:function exists(){var cmd=runCommand("test -d \"".concat(this.url,"\" || test -f \"").concat(this.url,"\""),this.options);return cmd.whenDone().then(function(){return cmd.exitCode===0;});}},{key:"remove",value:function remove(){var _this110=this;var cmd=runCommand("rm -rf \"".concat(this.url,"\""),this.options);return cmd.whenDone().then(function(){if(cmd.exitCode)throw new Error("Remove of ".concat(_this110.url," failed: ").concat(cmd.stderr));return _this110;});}},{key:"gzip",value:function(){var _gzip=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee97(content){var _this111=this;var cmd;return regeneratorRuntime.wrap(function _callee97$(_context97){while(1){switch(_context97.prev=_context97.next){case 0:// requires gzip to be installed on server!
cmd=runCommand("gzip > \"".concat(this.url,"\""),_objectSpread({stdin:String(content)},this.options));return _context97.abrupt("return",cmd.whenDone().then(function(){if(cmd.exitCode)throw new Error("Gzip compression of ".concat(_this111.url," failed: ").concat(cmd.stderr));return _this111;}));case 2:case"end":return _context97.stop();}}},_callee97,this);}));function gzip(_x129){return _gzip.apply(this,arguments);}return gzip;}()},{key:"brotli",value:function(){var _brotli=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee98(content){var _this112=this;var cmd;return regeneratorRuntime.wrap(function _callee98$(_context98){while(1){switch(_context98.prev=_context98.next){case 0:// requires brotli to be installed on server!
cmd=runCommand("brotli > \"".concat(this.url,"\""),_objectSpread({stdin:String(content)},this.options));return _context98.abrupt("return",cmd.whenDone().then(function(){if(cmd.exitCode)throw new Error("Brotli compression of ".concat(_this112.url," failed: ").concat(cmd.stderr));return _this112;}));case 2:case"end":return _context98.stop();}}},_callee98,this);}));function brotli(_x130){return _brotli.apply(this,arguments);}return brotli;}()},{key:"readProperties",value:function(){var _readProperties4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee99(){var info;return regeneratorRuntime.wrap(function _callee99$(_context99){while(1){switch(_context99.prev=_context99.next){case 0:_context99.next=2;return fileInfo(this.url,this.options);case 2:info=_context99.sent;this.assignProperties(dissoc(info,["fileName","path","rootDirectory"]));return _context99.abrupt("return",this);case 5:case"end":return _context99.stop();}}},_callee99,this);}));function readProperties(){return _readProperties4.apply(this,arguments);}return readProperties;}()},{key:"dirList",value:function(){var _dirList4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee100(){var _this113=this;var depth,opts,exclude,url,l2lClient,fileInfos,_args101=arguments;return regeneratorRuntime.wrap(function _callee100$(_context100){while(1){switch(_context100.prev=_context100.next){case 0:depth=_args101.length>0&&_args101[0]!==undefined?_args101[0]:1;opts=_args101.length>1&&_args101[1]!==undefined?_args101[1]:{};exclude=opts.exclude;if(Array.isArray(exclude))exclude="-iname "+exclude.map(print$1).join(' -o -iname ');url=this.url;l2lClient=this.options.l2lClient;_context100.next=8;return findFiles("*",{exclude:exclude,depth:depth,rootDirectory:url,l2lClient:l2lClient});case 8:fileInfos=_context100.sent;// remove self
if(fileInfos[0].path.replace(/\/$/,"")===this.url.replace(/\/$/,""))fileInfos.shift();return _context100.abrupt("return",fileInfos.map(function(info){var path=info.path,isDirectory=info.isDirectory;if(isDirectory)path=path.replace(/\/?$/,"/");var res=new _this113.constructor(path,l2lClient,_this113.options);res.assignProperties(dissoc(info,["fileName","path","rootDirectory"]));return res;}));case 11:case"end":return _context100.stop();}}},_callee100,this);}));function dirList(){return _dirList4.apply(this,arguments);}return dirList;}()}]);return ShellClientResource;}(Resource);var _defaultL2LClient;var __varRecorder__$z=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");__varRecorder__$z.pt=pt;__varRecorder__$z.Rectangle=Rectangle;__varRecorder__$z.rect=rect;__varRecorder__$z.arr=arr;__varRecorder__$z.Closure=Closure;__varRecorder__$z.num=num;__varRecorder__$z.grid=grid;__varRecorder__$z.obj=obj;__varRecorder__$z.once=once$1;var Layout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Layout")&&typeof __lively_classholder__.Layout==="function"?__lively_classholder__.Layout:__lively_classholder__.Layout=function Layout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Layout_initialize_(){var args=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var spacing=args.spacing,padding=args.padding,border=args.border,container=args.container,manualUpdate=args.manualUpdate,autoResize=args.autoResize,ignore=args.ignore,onScheduleApply=args.onScheduleApply,layoutOrder=args.layoutOrder,reactToSubmorphAnimations=args.reactToSubmorphAnimations;this.applyRequests=false;this.border=Object.assign({top:0,left:0,right:0,bottom:0},border);this.ignore=ignore||[];this.lastBoundsExtent=this.container&&this.container.bounds().extent();this.active=false;this.container=container;this.manualUpdate=manualUpdate;this.reactToSubmorphAnimations=reactToSubmorphAnimations||false;this.autoResize=autoResize!=undefined?autoResize:true;this.onScheduleApply=onScheduleApply||function(submorph,animation,change){};if(layoutOrder){this.layoutOrder=layoutOrder;this.layoutOrderSource=JSON.stringify(String(layoutOrder));}this.spacing=spacing||0;this._padding=!padding?null:typeof padding==="number"?__varRecorder__$z.Rectangle.inset(padding):padding;}},{key:"attach",value:function Layout_attach_(){this.apply();this.refreshBoundsCache();}},{key:"copy",value:function Layout_copy_(){return new this.constructor(this);}},{key:"description",value:function Layout_description_(){return"Describe the layout behavior here.";}},{key:"name",value:function Layout_name_(){return"Name presented to the user.";}},{key:"isEnabled",value:function Layout_isEnabled_(){return!this.active;}},{key:"disable",value:function Layout_disable_(){this.active=true;}},{key:"enable",value:function Layout_enable_(animation){this.active=false;this.scheduleApply(null,animation);}},{key:"padding",get:function get(){return this._padding;}},{key:"padding",set:function set(padding){if(typeof padding==="number"){padding=__varRecorder__$z.Rectangle.inset(padding);}this._padding=padding;this.apply();}},{key:"boundsChanged",value:function Layout_boundsChanged_(container){return!(this.lastBoundsExtent&&container.bounds().extent().equals(this.lastBoundsExtent));}},{key:"extentChanged",value:function Layout_extentChanged_(container){return!(this.lastExtent&&container.extent.equals(this.lastExtent));}},{key:"equals",value:function Layout_equals_(otherLayout){return otherLayout.name()==this.name();}},{key:"layoutableSubmorphs",get:function get(){var _this114=this;if(!this.layoutOrder){this.layoutOrder=__varRecorder__$z.Closure.fromSource(JSON.parse(this.layoutOrderSource)).recreateFunc();}return __varRecorder__$z.arr.sortBy(this.container.submorphs.filter(function(m){return m.isLayoutable&&!_this114.ignore.includes(m.name);}),function(m){return _this114.layoutOrder(m);});}},{key:"layoutOrder",value:function Layout_layoutOrder_(aMorph){return this.container.submorphs.indexOf(aMorph);}},{key:"submorphBoundsChanged",get:function get(){var layoutableSubmorphs=this.layoutableSubmorphs,layoutableSubmorphBounds=this.layoutableSubmorphBounds;if(!layoutableSubmorphBounds||layoutableSubmorphs.length!=layoutableSubmorphBounds.length){return true;}for(var _i108=0;_i108<layoutableSubmorphs.length;_i108++){var _m7=layoutableSubmorphs[_i108];var _b6=layoutableSubmorphBounds[_i108];var nb=void 0;if(!_b6.equals(nb=_m7.bounds())){return true;}}return false;}},{key:"refreshBoundsCache",value:function Layout_refreshBoundsCache_(){this.lastExtent=this.container.extent;this.layoutableSubmorphBounds=this.layoutableSubmorphs.map(function(m){return m.bounds();});}},{key:"onContainerRender",value:function Layout_onContainerRender_(){this.forceLayout();}},{key:"noLayoutActionNeeded",get:function get(){return!this.submorphBoundsChanged&&!this.boundsChanged(this.container)&&!this.extentChanged(this.container)&&!this.submorphsChanged;}},{key:"__dont_serialize__",get:function get(){return["lastAnim","animationPromise"];}},{key:"forceLayout",value:function Layout_forceLayout_(){var _this115=this;if(this.applyRequests){this.applyRequests=false;if(this.noLayoutActionNeeded)return;this.refreshBoundsCache();this.container.withMetaDo({isLayoutAction:true,animation:this.lastAnim},function(){return _this115.apply(_this115.lastAnim);});this.lastAnim=false;}}},{key:"forceLayoutsOfMorph",value:function Layout_forceLayoutsOfMorph_(m){var _this116=this;if(m.layout){m.layout.forceLayout();}else{m.submorphs.forEach(function(m){return _this116.forceLayoutsOfMorph(m);});}}},{key:"forceLayoutsInNextLevel",value:function Layout_forceLayoutsInNextLevel_(){var _this117=this;this.layoutableSubmorphs.forEach(function(m){return _this117.forceLayoutsOfMorph(m);});}},{key:"scheduleApply",value:function Layout_scheduleApply_(submorph,animation){var change=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(typeof this.onScheduleApply==="function"){this.onScheduleApply(submorph,animation,change);}if(this.active)return;if(animation)this.lastAnim=animation;this.applyRequests=true;}},{key:"onSubmorphResized",value:function Layout_onSubmorphResized_(submorph,change){this.scheduleApply(submorph,this.reactToSubmorphAnimations&&change.meta.animation,change);}},{key:"onSubmorphAdded",value:function Layout_onSubmorphAdded_(submorph,animation){this.submorphsChanged=true;this.scheduleApply(submorph,animation);}},{key:"onSubmorphRemoved",value:function Layout_onSubmorphRemoved_(submorph,animation){this.submorphsChanged=true;this.scheduleApply(submorph,animation);}},{key:"onChange",value:function Layout_onChange_(_ref69){var selector=_ref69.selector,args=_ref69.args,prop=_ref69.prop,value=_ref69.value,prevValue=_ref69.prevValue,meta=_ref69.meta;var anim=this.reactToSubmorphAnimations&&meta&&meta.animation;var submorph=args&&args[0];switch(selector){case"removeMorph":this.onSubmorphRemoved(submorph,anim);break;case"addMorphAt":this.onSubmorphAdded(submorph,anim);break;}if(prop==="extent"&&value&&prevValue&&(prevValue.x!==value.x||prevValue.y!==value.y)){this.scheduleApply(submorph,anim);}}},{key:"affectsLayout",value:function Layout_affectsLayout_(submorph,_ref70){var prop=_ref70.prop,value=_ref70.value,prevValue=_ref70.prevValue;return["position","scale","rotation","isLayoutable","extent"].includes(prop)&&!__varRecorder__$z.obj.equals(value,prevValue);}},{key:"onSubmorphChange",value:function Layout_onSubmorphChange_(submorph,change){if(change.meta&&change.meta.isLayoutAction){return this.scheduleApply(submorph,this.reactToSubmorphAnimation&&change.meta.animation);}if(this.affectsLayout(submorph,change)){this.onSubmorphResized(submorph,change);}}},{key:"changePropertyAnimated",value:function Layout_changePropertyAnimated_(target,propName,value,animate){if(animate){var _target$animate;var duration=animate.duration,easing=animate.easing;this.animationPromise=target.animate((_target$animate={},_defineProperty(_target$animate,propName,value),_defineProperty(_target$animate,"duration",duration),_defineProperty(_target$animate,"easing",easing),_target$animate));}else{target[propName]=value;}}},{key:"attachAnimated",value:function Layout_attachAnimated_(){var duration=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var container=arguments.length>1?arguments[1]:undefined;var easing=arguments.length>2?arguments[2]:undefined;if(this.active)return;this.container=container;this.active=true;container.layout=this;this.active=false;this.lastAnim={duration:duration,easing:easing};}},{key:"apply",value:function Layout_apply_(animated){if(this.active)return;this.active=true;this.submorphsChanged=false;this.lastBoundsExtent=this.container&&this.container.bounds().extent();this.active=false;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Layout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:156,end:6611});}(undefined);var CustomLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("CustomLayout")&&typeof __lively_classholder__.CustomLayout==="function"?__lively_classholder__.CustomLayout:__lively_classholder__.CustomLayout=function CustomLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function CustomLayout_initialize_(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.relayout=config.relayout;this.layouterString=JSON.stringify(String(config.relayout));this.varMapping=config.varMapping||{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,config);}},{key:"name",value:function CustomLayout_name_(){return"Custom Layout";}},{key:"apply",value:function CustomLayout_apply_(animate){if(this.active||!this.container)return;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"apply",this).call(this,animate);this.active=true;if(!this.relayout){this.relayout=__varRecorder__$z.Closure.fromSource(JSON.parse(this.layouterString),this.varMapping).recreateFunc();}try{this.relayout(this.container,animate);}catch(err){console.error("Error in relayout() of a custom layout:",err);}this.lastBoundsExtent=this.container&&this.container.bounds().extent();this.active=false;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"CustomLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:6620,end:7548});}(__varRecorder__$z.Layout);__varRecorder__$z.CustomLayout=CustomLayout;__varRecorder__$z.CustomLayout=CustomLayout;__varRecorder__$z.CustomLayout=CustomLayout;var SnapLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("SnapLayout")&&typeof __lively_classholder__.SnapLayout==="function"?__lively_classholder__.SnapLayout:__lively_classholder__.SnapLayout=function SnapLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function SnapLayout_initialize_(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,config);this._spacing=config.spacing;}},{key:"name",value:function SnapLayout_name_(){return"Snap";}},{key:"description",value:function SnapLayout_description_(){return"Fits the parent morph to the combined bounds of all its submorphs.";}},{key:"apply",value:function SnapLayout_apply_(){var _this118=this;var animate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.active||!this.container)return;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"apply",this).call(this,animate);var targetBounds=this.container.submorphBounds().insetBy(-this.spacing);var submorphOffset=__varRecorder__$z.pt(this.spacing,this.spacing).subPt(targetBounds.topLeft());if(submorphOffset.r()){this.container.submorphs.forEach(function(m){return _this118.changePropertyAnimated(m,"position",m.position.addPt(submorphOffset),animate);});}this.changePropertyAnimated(this.container,"extent",targetBounds.extent(),animate);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"SnapLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:7557,end:8354});}(__varRecorder__$z.Layout);__varRecorder__$z.SnapLayout=SnapLayout;__varRecorder__$z.SnapLayout=SnapLayout;__varRecorder__$z.SnapLayout=SnapLayout;var FloatLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("FloatLayout")&&typeof __lively_classholder__.FloatLayout==="function"?__lively_classholder__.FloatLayout:__lively_classholder__.FloatLayout=function FloatLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function FloatLayout_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);this._orderByIndex=props.orderByIndex||false;this._resizeSubmorphs=typeof props.resizeSubmorphs!=="undefined"?props.resizeSubmorphs:false;}},{key:"copy",value:function FloatLayout_copy_(){return new this.constructor(this.getSpec());}},{key:"layoutOrder",value:function FloatLayout_layoutOrder_(aMorph){return this.orderByIndex?this.container.submorphs.indexOf(aMorph):aMorph.left;}},{key:"orderByIndex",get:function get(){return this._orderByIndex;}},{key:"orderByIndex",set:function set(active){this._orderByIndex=active;this.apply();}},{key:"direction",get:function get(){return this._direction;}},{key:"direction",set:function set(d){this._direction=d;this.apply();}},{key:"align",get:function get(){return this._align;}},{key:"align",set:function set(d){this._align=d;this.apply();}},{key:"autoResize",get:function get(){return this._autoResize;}},{key:"autoResize",set:function set(active){this._autoResize=active;this.apply();}},{key:"spacing",get:function get(){return this._spacing;}},{key:"spacing",set:function set(offset){this._spacing=offset;this.apply();}},{key:"resizeSubmorphs",get:function get(){return this._resizeSubmorphs;}},{key:"resizeSubmorphs",set:function set(bool){this._resizeSubmorphs=bool;this.apply();}},{key:"equals",value:function FloatLayout_equals_(other){if(this.spacing!=other.spacing)return false;if(this.align!=other.align)return false;if(this.direction!=other.direction)return false;return true;}},{key:"getSpec",value:function FloatLayout_getSpec_(){var spacing=this.spacing,resizeSubmorphs=this.resizeSubmorphs,autoResize=this.autoResize,align=this.align,direction=this.direction,padding=this.padding,reactToSubmorphAnimations=this.reactToSubmorphAnimations,orderByIndex=this.orderByIndex;return{spacing:spacing,resizeSubmorphs:resizeSubmorphs,autoResize:autoResize,align:align,direction:direction,padding:padding,reactToSubmorphAnimations:reactToSubmorphAnimations,orderByIndex:orderByIndex};}},{key:"inspect",value:function FloatLayout_inspect_(pointerId){}},{key:"apply",value:function(){var _FloatLayout_apply_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee101(){var animate,minExtent,_args102=arguments;return regeneratorRuntime.wrap(function _callee101$(_context101){while(1){switch(_context101.prev=_context101.next){case 0:animate=_args102.length>0&&_args102[0]!==undefined?_args102[0]:false;if(!(this.active||!this.container||!this.container.submorphs.length)){_context101.next=3;break;}return _context101.abrupt("return");case 3:if(this.layoutableSubmorphs.length){_context101.next=5;break;}return _context101.abrupt("return");case 5:if(!this.layoutableSubmorphBounds)this.refreshBoundsCache();initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"apply",this).call(this,animate);this.active=true;try{minExtent=this.computeMinContainerExtent();this.layoutSubmorphs(minExtent,animate);minExtent=this.computeMinContainerExtent();this.resizeContainer(minExtent,animate);this.lastBoundsExtent=this.container.bounds().extent();}finally{this.active=false;this.layoutRequests=false;}return _context101.abrupt("return",this.animationPromise);case 10:case"end":return _context101.stop();}}},_callee101,this);}));function FloatLayout_apply_(){return _FloatLayout_apply_.apply(this,arguments);}return FloatLayout_apply_;}()},{key:"resizeContainer",value:function FloatLayout_resizeContainer_(){}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"FloatLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:8356,end:10764});}(__varRecorder__$z.Layout);var VerticalLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("VerticalLayout")&&typeof __lively_classholder__.VerticalLayout==="function"?__lively_classholder__.VerticalLayout:__lively_classholder__.VerticalLayout=function VerticalLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function VerticalLayout_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);this._align=props.align||"left";this._direction=props.direction||"topToBottom";}},{key:"name",value:function VerticalLayout_name_(){return"Vertical";}},{key:"description",value:function VerticalLayout_description_(){return"Assemble the submorphs in a vertically growing list.";}},{key:"equals",value:function VerticalLayout_equals_(other){if(!initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"equals",this).call(this,other))return false;if(!other.name||other.name()!="Vertical")return false;return true;}},{key:"possibleDirectionValues",get:function get(){return["topToBottom","bottomToTop","centered"];}},{key:"possibleAlignValues",get:function get(){return["left","center","right"];}},{key:"__serialize__",value:function VerticalLayout___serialize___(){return{__expr__:"new VerticalLayout(".concat(__varRecorder__$z.obj.inspect(this.getSpec()),")"),bindings:{"lively.morphic":["VerticalLayout"]}};}},{key:"layoutSubmorphs",value:function VerticalLayout_layoutSubmorphs_(minExtent,animate){var _this119=this;var container=this.container,layoutableSubmorphs=this.layoutableSubmorphs,spacing=this.spacing,autoResize=this.autoResize,align=this.align,resizeSubmorphs=this.resizeSubmorphs;var startY=this.getStartY(minExtent);var layoutableSubmorphBounds=[];var startX=resizeSubmorphs?container.width:minExtent.x;var onlyFitContainer=autoResize&&!resizeSubmorphs;var layoutRoutine=function layoutRoutine(accessor,startPosition){layoutableSubmorphs.reduce(function(pos,m){if(resizeSubmorphs)_this119.changePropertyAnimated(m,"width",container.width-2*spacing,animate);_this119.forceLayoutsOfMorph(m);_this119.changePropertyAnimated(m,accessor,pos,animate);var bounds=m.bounds();layoutableSubmorphBounds.push(bounds);return bounds[accessor]().addXY(0,bounds.height+spacing);},startPosition);};this.layoutableSubmorphBounds=layoutableSubmorphBounds;if(align==="left"){layoutRoutine("topLeft",__varRecorder__$z.pt(spacing,startY));}else if(align==="right"){layoutRoutine("topRight",__varRecorder__$z.pt(startX+(onlyFitContainer?spacing:-spacing),startY));}else{layoutRoutine("topCenter",__varRecorder__$z.pt((startX+(onlyFitContainer?2*spacing:0))/2,startY));}}},{key:"resizeContainer",value:function VerticalLayout_resizeContainer_(minExtent,animate){var autoResize=this.autoResize,direction=this.direction,layoutableSubmorphs=this.layoutableSubmorphs,resizeSubmorphs=this.resizeSubmorphs,spacing=this.spacing,container=this.container;if(autoResize){var _h3=0;if(direction==="centered"){var topOffset=layoutableSubmorphs[0].top;_h3=__varRecorder__$z.arr.last(layoutableSubmorphs).bottom+topOffset;}else{_h3=__varRecorder__$z.arr.last(layoutableSubmorphs).bottom+spacing;}var newExtent=__varRecorder__$z.pt(resizeSubmorphs?container.width:minExtent.x+2*spacing,Math.max(_h3,minExtent.y));this.changePropertyAnimated(container,"extent",newExtent,animate);}}},{key:"getStartY",value:function VerticalLayout_getStartY_(minExtent){var layoutableSubmorphBounds=this.layoutableSubmorphBounds,spacing=this.spacing,direction=this.direction;var submorphH=0;var startY;submorphH+=(layoutableSubmorphBounds.length-1)*spacing;var _iterator57=_createForOfIteratorHelper(layoutableSubmorphBounds),_step57;try{for(_iterator57.s();!(_step57=_iterator57.n()).done;){var bounds=_step57.value;submorphH+=bounds.height;}}catch(err){_iterator57.e(err);}finally{_iterator57.f();}if(direction==="bottomToTop"){startY=minExtent.y-submorphH-2*spacing;}else if(direction==="centered"){startY=minExtent.y/2-submorphH/2-spacing;}else{startY=0;}return Math.max(0,startY)+spacing;}},{key:"computeMinContainerExtent",value:function VerticalLayout_computeMinContainerExtent_(){var spacing=this.spacing,container=this.container,layoutableSubmorphs=this.layoutableSubmorphs,autoResize=this.autoResize;var spacingHeight=(layoutableSubmorphs.length+1)*spacing;var maxW=0;var maxH=0;for(var _i109=0;_i109<layoutableSubmorphs.length;_i109++){var bounds=layoutableSubmorphs[_i109].bounds();var _w2=bounds.width,_h4=bounds.height;maxH+=_h4;maxW=Math.max(_w2,maxW);}var minExtent=__varRecorder__$z.pt(maxW,maxH+spacingHeight);if(!autoResize)minExtent=minExtent.maxPt(container.extent);return minExtent;}},{key:"layoutOrder",value:function VerticalLayout_layoutOrder_(aMorph){return this.orderByIndex?this.container.submorphs.indexOf(aMorph):aMorph.top;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"VerticalLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:10773,end:14741});}(__varRecorder__$z.FloatLayout);__varRecorder__$z.VerticalLayout=VerticalLayout;__varRecorder__$z.VerticalLayout=VerticalLayout;__varRecorder__$z.VerticalLayout=VerticalLayout;var HorizontalLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("HorizontalLayout")&&typeof __lively_classholder__.HorizontalLayout==="function"?__lively_classholder__.HorizontalLayout:__lively_classholder__.HorizontalLayout=function HorizontalLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function HorizontalLayout_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);this._direction=props.direction||"leftToRight";this._align=props.align||"top";}},{key:"name",value:function HorizontalLayout_name_(){return"Horizontal";}},{key:"description",value:function HorizontalLayout_description_(){return"Assemble the submorphs in a horizontally growing list.";}},{key:"possibleDirectionValues",get:function get(){return["leftToRight","rightToLeft","centered"];}},{key:"possibleAlignValues",get:function get(){return["top","center","bottom"];}},{key:"__serialize__",value:function HorizontalLayout___serialize___(){return{__expr__:"new HorizontalLayout(".concat(__varRecorder__$z.obj.inspect(this.getSpec()),")"),bindings:{"lively.morphic":["HorizontalLayout"]}};}},{key:"equals",value:function HorizontalLayout_equals_(other){if(!initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"equals",this).call(this,other))return false;if(!other.name||other.name()!="Horizontal")return false;return true;}},{key:"layoutSubmorphs",value:function HorizontalLayout_layoutSubmorphs_(minExtent,animate){var _this120=this;var container=this.container,layoutableSubmorphs=this.layoutableSubmorphs,resizeSubmorphs=this.resizeSubmorphs,spacing=this.spacing,autoResize=this.autoResize,align=this.align;var startX=this.getStartX(minExtent);var layoutableSubmorphBounds=[];var startY=resizeSubmorphs?container.height:minExtent.y;var onlyFitContainer=autoResize&&!resizeSubmorphs;var layoutRoutine=function layoutRoutine(accessor,startPosition){layoutableSubmorphs.reduce(function(pos,m){if(resizeSubmorphs)_this120.changePropertyAnimated(m,"height",container.height-2*spacing,animate);_this120.forceLayoutsOfMorph(m);_this120.changePropertyAnimated(m,accessor,pos,animate);var bounds=m.bounds();layoutableSubmorphBounds.push(bounds);return bounds[accessor]().addXY(bounds.width+spacing,0);},startPosition);};this.layoutableSubmorphBounds=layoutableSubmorphBounds;if(align==="top"){layoutRoutine("topLeft",__varRecorder__$z.pt(startX,spacing));}else if(align==="bottom"){layoutRoutine("bottomLeft",__varRecorder__$z.pt(startX,startY+(onlyFitContainer?spacing:-spacing)));}else{layoutRoutine("leftCenter",__varRecorder__$z.pt(startX,(startY+(onlyFitContainer?2*spacing:0))/2));}}},{key:"resizeContainer",value:function HorizontalLayout_resizeContainer_(minExtent,animate){var autoResize=this.autoResize,direction=this.direction,layoutableSubmorphBounds=this.layoutableSubmorphBounds,resizeSubmorphs=this.resizeSubmorphs,spacing=this.spacing,container=this.container;if(autoResize){var _w3=0;if(direction==="centered"){var leftOffset=layoutableSubmorphBounds[0].left();_w3=__varRecorder__$z.arr.last(layoutableSubmorphBounds).right()+leftOffset;}else{_w3=__varRecorder__$z.arr.last(layoutableSubmorphBounds).right()+spacing;}var newExtent=__varRecorder__$z.pt(Math.max(minExtent.x,_w3),resizeSubmorphs?container.height:minExtent.y+2*spacing);this.changePropertyAnimated(container,"extent",newExtent,animate);}}},{key:"getStartX",value:function HorizontalLayout_getStartX_(minExtent){var layoutableSubmorphBounds=this.layoutableSubmorphBounds,spacing=this.spacing,direction=this.direction;var submorphW=0;var startX;submorphW+=(layoutableSubmorphBounds.length-1)*spacing;var _iterator58=_createForOfIteratorHelper(layoutableSubmorphBounds),_step58;try{for(_iterator58.s();!(_step58=_iterator58.n()).done;){var bounds=_step58.value;submorphW+=bounds.width;}}catch(err){_iterator58.e(err);}finally{_iterator58.f();}if(direction==="rightToLeft"){startX=minExtent.x-submorphW-2*spacing;}else if(direction==="centered"){startX=minExtent.x/2-submorphW/2-spacing;}else{startX=0;}return Math.max(0,startX)+spacing;}},{key:"computeMinContainerExtent",value:function HorizontalLayout_computeMinContainerExtent_(){var spacing=this.spacing,container=this.container,layoutableSubmorphBounds=this.layoutableSubmorphBounds,autoResize=this.autoResize;var spacingWidth=(layoutableSubmorphBounds.length+1)*spacing;var maxW=0;var maxH=0;for(var _i110=0;_i110<layoutableSubmorphBounds.length;_i110++){var bounds=layoutableSubmorphBounds[_i110];var _w4=bounds.width,_h5=bounds.height;maxW+=_w4;maxH=Math.max(_h5,maxH);}var minExtent=__varRecorder__$z.pt(maxW+spacingWidth,maxH);if(!autoResize)minExtent=minExtent.maxPt(container.extent);return minExtent;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"HorizontalLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:14750,end:18667});}(__varRecorder__$z.FloatLayout);__varRecorder__$z.HorizontalLayout=HorizontalLayout;__varRecorder__$z.HorizontalLayout=HorizontalLayout;__varRecorder__$z.HorizontalLayout=HorizontalLayout;var ProportionalLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ProportionalLayout")&&typeof __lively_classholder__.ProportionalLayout==="function"?__lively_classholder__.ProportionalLayout:__lively_classholder__.ProportionalLayout=function ProportionalLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"name",value:function ProportionalLayout_name_(){return"Proportional";}},{key:"description",value:function ProportionalLayout_description_(){return"Resizes, scales, and moves morphs according to their original position.";}},{key:"inspect",value:function ProportionalLayout_inspect_(pointerId){}},{key:Symbol["for"]("lively-instance-initialize"),value:function ProportionalLayout_initialize_(args){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,args);this.extentDelta=__varRecorder__$z.pt(0,0);this.proportionalLayoutSettingsForMorphs=new WeakMap();this.submorphSettings=args&&args.submorphSettings||[];this.lastExtent=args.lastExtent;delete this.spacing;delete this.autoResize;}},{key:"getSpec",value:function ProportionalLayout_getSpec_(){return{submorphSettings:this.submorphSettings,reactToSubmorphAnimations:this.reactToSubmorphAnimations,lastExtent:this.lastExtent};}},{key:"__serialize__",value:function ProportionalLayout___serialize___(){return{__expr__:"new ProportionalLayout(".concat(__varRecorder__$z.obj.inspect(this.getSpec()),")"),bindings:{"lively.morphic":["ProportionalLayout"]}};}},{key:"__dont_serialize__",get:function get(){return[].concat(_toConsumableArray2(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__dont_serialize__",this)),["extentDelta","lastExtent"]);}},{key:"__after_deserialize__",value:function ProportionalLayout___after_deserialize___(snapshot,ref){var _submorphSettings=this._submorphSettings,container=this.container;var map=this.proportionalLayoutSettingsForMorphs||new WeakMap();this.extentDelta=__varRecorder__$z.pt(0,0);if(!_submorphSettings||!container)return;var _iterator59=_createForOfIteratorHelper(_submorphSettings),_step59;try{for(_iterator59.s();!(_step59=_iterator59.n()).done;){var _step59$value=_slicedToArray2(_step59.value,2),ident=_step59$value[0],setting=_step59$value[1];var _this$_morphsMatching=this._morphsMatchingSelector(container,ident),_this$_morphsMatching2=_slicedToArray2(_this$_morphsMatching,1),_morph12=_this$_morphsMatching2[0];_morph12&&map.set(_morph12,setting);}}catch(err){_iterator59.e(err);}finally{_iterator59.f();}this.proportionalLayoutSettingsForMorphs=map;}},{key:"onSubmorphChange",value:function ProportionalLayout_onSubmorphChange_(submorph,change,x,y){if(change.prop==="name"){var settings=this.proportionalLayoutSettingsForMorphs.get(submorph);if(settings)this.changeSettingsFor(submorph,settings,true);}return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onSubmorphChange",this).call(this,submorph,change);}},{key:"settingsFor",value:function ProportionalLayout_settingsFor_(morph){var settings=this.proportionalLayoutSettingsForMorphs.get(morph);return settings||{x:"scale",y:"scale"};}},{key:"changeSettingsFor",value:function ProportionalLayout_changeSettingsFor_(morph,mergin){var save=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(typeof mergin==="string")mergin={x:mergin,y:mergin};this.proportionalLayoutSettingsForMorphs.set(morph,Object.assign({},this.settingsFor(morph),{},mergin));if(save){var settings=this.submorphSettings.filter(function(ea){return ea[0]!==morph.name;});settings.push([morph.name,this.settingsFor(morph)]);this._submorphSettings=settings;}}},{key:"submorphSettings",get:function get(){return this._submorphSettings;}},{key:"submorphSettings",set:function set(submorphSettings){if(!this.container){__varRecorder__$z.once(this,"container",this,"submorphSettings",{converter:"function () { return submorphSettings }",varMapping:{submorphSettings:submorphSettings}});return;}this._submorphSettings=submorphSettings;this.changeSubmorphSettings(submorphSettings);}},{key:"changeSubmorphSettings",value:function ProportionalLayout_changeSubmorphSettings_(submorphSettings){var _this121=this;var _iterator60=_createForOfIteratorHelper(submorphSettings),_step60;try{var _loop7=function _loop7(){var _step60$value=_slicedToArray2(_step60.value,2),morphSelector=_step60$value[0],setting=_step60$value[1];var morphs=_this121._morphsMatchingSelector(_this121.container,morphSelector);morphs.forEach(function(m){return _this121.changeSettingsFor(m,setting);});};for(_iterator60.s();!(_step60=_iterator60.n()).done;){_loop7();}}catch(err){_iterator60.e(err);}finally{_iterator60.f();}}},{key:"_morphsMatchingSelector",value:function ProportionalLayout__morphsMatchingSelector_(container,selector){var _this122=this;var morphs=[];if(!selector)return morphs;if(selector.isMorph){morphs=[selector];}else if(selector instanceof RegExp){morphs=container.submorphs.filter(function(ea){return ea.name.match(selector);});}else if(typeof selector==="string"){morphs=container.submorphs.filter(function(ea){return ea.name===selector;});}else if(Array.isArray(selector)){morphs=__varRecorder__$z.arr.flatmap(selector,function(sel){return _this122._morphsMatchingSelector(container,sel);});}return morphs;}},{key:"refreshBoundsCache",value:function ProportionalLayout_refreshBoundsCache_(){var extent=this.container.extent,lastExtent=this.lastExtent;if(lastExtent&&!extent.eqPt(lastExtent)){this.extentDelta=this.extentDelta.addPt(extent.subPt(lastExtent));}this.lastExtent=extent;this.layoutableSubmorphBounds=this.layoutableSubmorphs.map(function(m){return m.bounds();});}},{key:"apply",value:function ProportionalLayout_apply_(){var animate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var container=this.container,active=this.active,_this$extentDelta=this.extentDelta,deltaX=_this$extentDelta.x,deltaY=_this$extentDelta.y;var _ref71=container||{},extent=_ref71.extent;if(active||!container||deltaX==0&&deltaY==0){return;}this.extentDelta=__varRecorder__$z.pt(0,0);this.active=true;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"apply",this).call(this,animate);var layoutableSubmorphs=this.layoutableSubmorphs;var scalePt=extent.scaleByPt(extent.addXY(-deltaX,-deltaY).invertedSafely());var _iterator61=_createForOfIteratorHelper(layoutableSubmorphs),_step61;try{for(_iterator61.s();!(_step61=_iterator61.n()).done;){var _m8=_step61.value;var _this$settingsFor=this.settingsFor(_m8),_x131=_this$settingsFor.x,_y10=_this$settingsFor.y;var moveX=0;var moveY=0;var resizeX=0;var resizeY=0;if(_x131==="move")moveX=deltaX;if(_y10==="move")moveY=deltaY;if(_x131==="resize")resizeX=deltaX;if(_y10==="resize")resizeY=deltaY;if(_x131==="scale"||_y10==="scale"){var morphScale=__varRecorder__$z.pt(_x131==="scale"?scalePt.x:1,_y10==="scale"?scalePt.y:1);this.changePropertyAnimated(_m8,"position",_m8.position.scaleByPt(morphScale),animate);this.changePropertyAnimated(_m8,"extent",_m8.extent.scaleByPt(morphScale),animate);}if(moveX||moveY){this.changePropertyAnimated(_m8,"position",_m8.position.addXY(moveX,moveY),animate);}if(resizeX||resizeY){this.changePropertyAnimated(_m8,"extent",_m8.extent.addXY(resizeX,resizeY),animate);}}}catch(err){_iterator61.e(err);}finally{_iterator61.f();}this.forceLayoutsInNextLevel();this.active=false;}},{key:"copy",value:function ProportionalLayout_copy_(){return new this.constructor(this.getSpec());}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ProportionalLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:18676,end:24220});}(__varRecorder__$z.Layout);__varRecorder__$z.ProportionalLayout=ProportionalLayout;__varRecorder__$z.ProportionalLayout=ProportionalLayout;__varRecorder__$z.ProportionalLayout=ProportionalLayout;var CenteredTilingLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("CenteredTilingLayout")&&typeof __lively_classholder__.CenteredTilingLayout==="function"?__lively_classholder__.CenteredTilingLayout:__lively_classholder__.CenteredTilingLayout=function CenteredTilingLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"name",value:function CenteredTilingLayout_name_(){return"CenteredTiling";}},{key:"description",value:function CenteredTilingLayout_description_(){return"Similar to TilingLayout but center the rows.";}},{key:"apply",value:function CenteredTilingLayout_apply_(){var _this123=this;var animate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.active||!this.container)return;this.active=true;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"apply",this).call(this,animate);var width=this.getOptimalWidth(this.container);var spacing=this.spacing,layoutableSubmorphs=this.layoutableSubmorphs;var y=spacing+this.border.top;layoutableSubmorphs=layoutableSubmorphs.slice();var _loop8=function _loop8(){var remainingWidth=width;var rowMorphs=__varRecorder__$z.arr.takeWhile(layoutableSubmorphs,function(m){var newWidth=remainingWidth-(m.width+2*spacing);if(newWidth<0)return false;remainingWidth=newWidth;return true;});if(rowMorphs.length)layoutableSubmorphs=__varRecorder__$z.arr.withoutAll(layoutableSubmorphs,rowMorphs);else{rowMorphs=[layoutableSubmorphs.shift()];remainingWidth=0;}var pos=__varRecorder__$z.pt(remainingWidth/2+spacing+_this123.border.left,y);var _iterator62=_createForOfIteratorHelper(rowMorphs),_step62;try{for(_iterator62.s();!(_step62=_iterator62.n()).done;){var _m9=_step62.value;_m9.position=pos;pos=pos.addXY(2*spacing+_m9.width,0);y=Math.max(y,_m9.bottom);}}catch(err){_iterator62.e(err);}finally{_iterator62.f();}y+=2*spacing;};while(layoutableSubmorphs.length){_loop8();}this.active=false;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"CenteredTilingLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:24229,end:25525});}(__varRecorder__$z.TilingLayout);__varRecorder__$z.CenteredTilingLayout=CenteredTilingLayout;__varRecorder__$z.CenteredTilingLayout=CenteredTilingLayout;__varRecorder__$z.CenteredTilingLayout=CenteredTilingLayout;var TilingLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TilingLayout")&&typeof __lively_classholder__.TilingLayout==="function"?__lively_classholder__.TilingLayout:__lively_classholder__.TilingLayout=function TilingLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function TilingLayout_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);this._axis=props.axis||"row";this._align=props.align||"left";this._verticalAlign=props.verticalAlign||"top";this._orderByIndex=props.orderByIndex||false;delete this.autoResize;}},{key:"name",value:function TilingLayout_name_(){return"Tiling";}},{key:"description",value:function TilingLayout_description_(){return"Make the submorphs fill their owner, inserting breaks to defer intersecting the bounds as much as possible.";}},{key:"inspect",value:function TilingLayout_inspect_(pointerId){}},{key:"__serialize__",value:function TilingLayout___serialize___(){return{__expr__:"new TilingLayout(".concat(__varRecorder__$z.obj.inspect(this.getSpec()),")"),bindings:{"lively.morphic":["TilingLayout"]}};}},{key:"copy",value:function TilingLayout_copy_(){return new this.constructor(this.getSpec());}},{key:"getSpec",value:function TilingLayout_getSpec_(){var axis=this.axis,align=this.align,spacing=this.spacing,layoutOrder=this.layoutOrder,orderByIndex=this.orderByIndex,reactToSubmorphAnimations=this.reactToSubmorphAnimations;return{axis:axis,align:align,spacing:spacing,orderByIndex:orderByIndex,reactToSubmorphAnimations:reactToSubmorphAnimations};}},{key:"possibleAxisValues",get:function get(){return["row","columns"];}},{key:"possibleAlignValues",get:function get(){return["left","center","right"];}},{key:"orderByIndex",get:function get(){return this._orderByIndex;}},{key:"orderByIndex",set:function set(active){this._orderByIndex=active;this.apply();}},{key:"axis",get:function get(){return this._axis;}},{key:"axis",set:function set(a){this._axis=a;this.apply();}},{key:"align",get:function get(){return this._align;}},{key:"align",set:function set(a){this._align=a;this.apply();}},{key:"spacing",get:function get(){return this._spacing;}},{key:"spacing",set:function set(offset){this._spacing=offset;this.apply();}},{key:"apply",value:function TilingLayout_apply_(){var animate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.active||!this.container)return;this.active=true;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"apply",this).call(this,animate);var container=this.container,axis=this.axis,align=this.align,border=this.border,spacing=this.spacing,layoutableSubmorphs=this.layoutableSubmorphs;var width=this.getOptimalWidth(container);var isHorizontal=axis=="row";var widthAccessor=isHorizontal?"left":"top";var heightAccessor=isHorizontal?"top":"left";var normalizedWidthAccessor=isHorizontal?"x":"y";var normalizedHeightAccessor=isHorizontal?"y":"x";var currentRowHeight=0;var previousRowHeight=spacing+border[heightAccessor];var posAccessor="topLeft";switch(this._verticalAlign){case"top":posAccessor="topLeft";break;case"center":posAccessor="leftCenter";break;case"bottom":posAccessor="bottomLeft";break;}while(layoutableSubmorphs.length){var remainingWidth=width-spacing;var rowMorphs=__varRecorder__$z.arr.takeWhile(layoutableSubmorphs,function(m){var ext=m.bounds().extent();var newWidth=remainingWidth-(ext[normalizedWidthAccessor]+spacing);if(newWidth<0)return false;remainingWidth=newWidth;return true;});if(rowMorphs.length)layoutableSubmorphs.splice(0,rowMorphs.length);else{rowMorphs=[layoutableSubmorphs.shift()];remainingWidth=0;}var pos;currentRowHeight=__varRecorder__$z.arr.max(rowMorphs.map(function(m){return m.bounds().extent()[normalizedHeightAccessor];}));if(isHorizontal){switch(align){case"left":pos=__varRecorder__$z.pt(spacing,previousRowHeight);break;case"center":pos=__varRecorder__$z.pt(remainingWidth/2+spacing+border[widthAccessor],previousRowHeight);break;case"right":pos=__varRecorder__$z.pt(remainingWidth-spacing,previousRowHeight);break;}}else{switch(align){case"left":pos=__varRecorder__$z.pt(previousRowHeight,spacing);break;case"center":pos=__varRecorder__$z.pt(previousRowHeight,remainingWidth/2+spacing+border[widthAccessor]);break;case"right":pos=__varRecorder__$z.pt(previousRowHeight,remainingWidth-spacing);break;}}if(posAccessor=="bottomLeft"){pos=pos.addXY(0,currentRowHeight);}var _iterator63=_createForOfIteratorHelper(rowMorphs),_step63;try{for(_iterator63.s();!(_step63=_iterator63.n()).done;){var _m10=_step63.value;this.changePropertyAnimated(_m10,posAccessor,pos,animate);var ext=_m10.bounds().extent();pos=isHorizontal?pos.addXY(spacing+ext[normalizedWidthAccessor],0):pos.addXY(0,spacing+ext[normalizedWidthAccessor]);}}catch(err){_iterator63.e(err);}finally{_iterator63.f();}previousRowHeight+=spacing+currentRowHeight;currentRowHeight=0;}this.active=false;}},{key:"getMinWidth",value:function TilingLayout_getMinWidth_(){var layoutableSubmorphs=this.layoutableSubmorphs,_this$border=this.border,left=_this$border.left,right=_this$border.right;return layoutableSubmorphs.reduce(function(s,m){return m.bounds().width>s?m.bounds().width:s;},0)+left+right;}},{key:"getMinHeight",value:function TilingLayout_getMinHeight_(){var layoutableSubmorphs=this.layoutableSubmorphs,_this$border2=this.border,top=_this$border2.top,bottom=_this$border2.bottom;return layoutableSubmorphs.reduce(function(s,e){return e.bounds().height>s?e.bounds().height:s;},0)+top+bottom;}},{key:"getOptimalWidth",value:function TilingLayout_getOptimalWidth_(container){var axis=this.axis,_this$border3=this.border,left=_this$border3.left,top=_this$border3.top,right=_this$border3.right,bottom=_this$border3.bottom;var width=axis=="row"?container.width-left-right:container.height-top-bottom;var maxSubmorphWidth=axis=="row"?this.getMinWidth():this.getMinHeight();return Math.max(width,maxSubmorphWidth);}},{key:"layoutOrder",value:function TilingLayout_layoutOrder_(morph){if(this.orderByIndex)return this.container.submorphs.indexOf(morph);return this.axis==="row"?(morph.top-morph.top%15)*1000000+morph.left:(morph.left-morph.left%15)*1000000+morph.top;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TilingLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:25534,end:31071});}(__varRecorder__$z.Layout);__varRecorder__$z.TilingLayout=TilingLayout;__varRecorder__$z.TilingLayout=TilingLayout;__varRecorder__$z.TilingLayout=TilingLayout;var CellGroup=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("CellGroup")&&typeof __lively_classholder__.CellGroup==="function"?__lively_classholder__.CellGroup:__lively_classholder__.CellGroup=function CellGroup(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function CellGroup_initialize_(_ref72){var cell=_ref72.cell,morph=_ref72.morph,layout=_ref72.layout,align=_ref72.align;this.state={cells:[cell],layout:layout,align:align,resize:layout.fitToCell};layout&&layout.addGroup(this);this.morph=morph;}},{key:"morph",get:function get(){var _this$state=this.state,morph=_this$state.morph,layout=_this$state.layout;if(morph){if(morph.isMorph)return morph;return layout.layoutableSubmorphs.find(function(m){return m.name==morph;});}return null;}},{key:"compensateOrigin",get:function get(){return this.layout.compensateOrigin;}},{key:"resize",get:function get(){return this.state.resize;}},{key:"resize",set:function set(forceBounds){this.state.resize=forceBounds;this.layout.apply();}},{key:"align",get:function get(){return this.state.align||"topLeft";}},{key:"align",set:function set(orientation){this.state.align=orientation;this.layout.apply();}},{key:"morph",set:function set(value){var conflictingGroup=value&&this.layout.getCellGroupFor(value);if(conflictingGroup){conflictingGroup.morph=null;}this.state.morph=value;this.layout.apply();}},{key:"manages",value:function CellGroup_manages_(morph){return this.morph&&(this.morph==morph||this.morph.name==morph);}},{key:"apply",value:function CellGroup_apply_(){var animate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var target=this.morph;if(target){var bounds=this.bounds();var offset=this.compensateOrigin?this.layout.container.origin.negated():__varRecorder__$z.pt(0,0);if(animate){var _target$animate2;var extent=this.resize?bounds.extent():target.extent;var duration=animate.duration,easing=animate.easing;target.animate((_target$animate2={},_defineProperty(_target$animate2,this.alignedProperty||this.align,bounds[this.align]().addPt(offset)),_defineProperty(_target$animate2,"extent",extent),_defineProperty(_target$animate2,"duration",duration),_defineProperty(_target$animate2,"easing",easing),_target$animate2));}else{if(this.resize)target.extent=bounds.extent();target[this.alignedProperty||this.align]=bounds[this.align]().addPt(offset);}this.layout.forceLayoutsInNextLevel();}}},{key:"cells",get:function get(){return this.state.cells;}},{key:"layout",get:function get(){return this.state.layout;}},{key:"bounds",value:function CellGroup_bounds_(){if(this.cells.length>0){return this.cells.map(function(cell){return cell.bounds();}).reduce(function(a,b){return a.union(b);});}else{return __varRecorder__$z.rect(0,0,0,0);}}},{key:"includes",value:function CellGroup_includes_(cell){return this.cells.find(function(c){return c==cell;});}},{key:"connect",value:function CellGroup_connect_(cell){if(this.morph==undefined){this.morph=cell.group.morph;}if(cell.group){cell.group.disconnect(cell,this);}else{cell.group=this;}this.cells.push(cell);}},{key:"disconnect",value:function CellGroup_disconnect_(cell){var newGroup=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;cell.group=newGroup||new __varRecorder__$z.CellGroup({morph:null,layout:this.layout,cell:cell});__varRecorder__$z.arr.remove(this.cells,cell);if(this.cells.length<1&&this.layout)this.layout.removeGroup(this);}},{key:"merge",value:function CellGroup_merge_(otherGroup){var _this124=this;otherGroup.cells.forEach(function(c){_this124.connect(c);});}},{key:"topLeft",get:function get(){var _this125=this;return this.cells.find(function(cell){return(cell.left==null||cell.left.group!=_this125)&&(cell.top==null||cell.top.group!=_this125);});}},{key:"bottomRight",get:function get(){var _this126=this;return this.cells.find(function(cell){return(cell.right==null||cell.right.group!=_this126)&&(cell.bottom==null||cell.bottom.group!=_this126);});}},{key:"position",get:function get(){return this.topLeft.position;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"CellGroup";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:31080,end:34312});}(undefined);__varRecorder__$z.CellGroup=CellGroup;__varRecorder__$z.CellGroup=CellGroup;__varRecorder__$z.CellGroup=CellGroup;var LayoutAxis=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("LayoutAxis")&&typeof __lively_classholder__.LayoutAxis==="function"?__lively_classholder__.LayoutAxis:__lively_classholder__.LayoutAxis=function LayoutAxis(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function LayoutAxis_initialize_(cell){this.origin=cell;}},{key:"otherAxis",get:function get(){return[].concat(_toConsumableArray2(this.axisBefore),_toConsumableArray2(this.axisAfter));}},{key:"axisBefore",get:function get(){var curr=this;var res=[];while(curr=curr.before){res=[curr].concat(_toConsumableArray2(res));}return res;}},{key:"axisAfter",get:function get(){var curr=this;var res=[];while(curr=curr.after){res=[].concat(_toConsumableArray2(res),[curr]);}return res;}},{key:"before",get:function get(){throw Error("before() not implemented!");}},{key:"after",get:function get(){throw Error("after() not implemented!");}},{key:"containerLength",get:function get(){return this.container[this.dimension];}},{key:"containerLength",set:function set(length){this.container[this.dimension]=length;}},{key:"getRoot",value:function LayoutAxis_getRoot_(){return(this.axisBefore[0]||this).items[0];}},{key:"container",get:function get(){return this.origin.container;}},{key:"layout",get:function get(){return this.origin.layout;}},{key:"frozen",get:function get(){return this.origin.frozen[this.dimension];}},{key:"frozen",set:function set(active){this.origin.frozen[this.dimension]=active;}},{key:"align",set:function set(align){this.items.forEach(function(c){return c.group.state.align=align;});}},{key:"fixed",get:function get(){return this.origin.fixed[this.dimension];}},{key:"fixed",set:function set(active){var _this127=this;var newLength,containerLength;if(__varRecorder__$z.obj.isNumber(active)){newLength=active;active=true;}this.items.forEach(function(c){c.fixed[_this127.dimension]=active;});containerLength=this.containerLength;if(newLength!=undefined)this[this.dimension]=newLength;this.adjustOtherProportions(active);this.containerLength=containerLength;}},{key:"length",get:function get(){return this.origin[this.dimension];}},{key:"length",set:function set(x){var _this128=this;this.items.forEach(function(cell){cell[_this128.dimension]=__varRecorder__$z.num.roundTo(x,1);});}},{key:"proportion",get:function get(){return this.origin.proportion[this.dimension];}},{key:"proportion",set:function set(prop){var _this129=this;this.items.forEach(function(cell){cell.proportion[_this129.dimension]=prop;});}},{key:"min",get:function get(){return this.origin.min[this.dimension];}},{key:"min",set:function set(x){this.adjustMin(x-this.min);}},{key:"adjustMin",value:function LayoutAxis_adjustMin_(delta){var _this130=this;this.items.forEach(function(c){if(c.min[_this130.dimension]+delta<0){c.min[_this130.dimension]=0;}else if(c.min[_this130.dimension]+delta>c[_this130.dimension]){c.min[_this130.dimension]+=delta;}else{c.min[_this130.dimension]+=delta;}});this.layout.apply();}},{key:"adjustProportion",value:function LayoutAxis_adjustProportion_(){if(!this.fixed)this.proportion=this.dynamicLength>0?this.length/this.dynamicLength:0;}},{key:"adjustOtherProportions",value:function LayoutAxis_adjustOtherProportions_(remove){var _this131=this;var before=this.axisBefore;var after=this.axisAfter;var dynamicProportions=__varRecorder__$z.arr.sum([].concat(_toConsumableArray2(before),_toConsumableArray2(after)).filter(function(a){return!a.fixed;}).map(function(a){return a.proportion;}));var removeOwnProportion=function removeOwnProportion(c){return c.proportion=c.proportion/dynamicProportions;};var insertOwnProportion=function insertOwnProportion(c){return c.proportion=c.proportion*_this131.origin.removedDynamicProportions;};if(remove)this.origin.removedDynamicProportions=dynamicProportions;before.forEach(remove?removeOwnProportion:insertOwnProportion);after.forEach(remove?removeOwnProportion:insertOwnProportion);}},{key:"prepareForResize",value:function LayoutAxis_prepareForResize_(newContainerLength){var newLength=this.proportion*Math.max(0,newContainerLength-this.staticLength);if(this.frozen&&newLength>=this.min){this.frozen=false;this.fixed=false;this.length=newLength;}else if(!this.frozen&&this.min>newLength){this.frozen=true;this.fixed=true;this.length=this.min;}return this;}},{key:"adjustLength",value:function LayoutAxis_adjustLength_(delta){var nextDynamicAxis;if(this.length+delta<0){delta=-this.length;}if(nextDynamicAxis=this.axisAfter.find(function(axis){return!axis.fixed;})){delta=Math.min(delta,nextDynamicAxis.length);this.length+=delta;nextDynamicAxis.length-=delta;this.adjustProportion();nextDynamicAxis.adjustProportion();}else{nextDynamicAxis=this.axisBefore.reverse().find(function(axis){return!axis.fixed;});if(nextDynamicAxis){nextDynamicAxis.length-=delta;this.length+=delta;this.adjustProportion();nextDynamicAxis.adjustProportion();}else{this.length+=delta;this.adjustProportion();this.otherAxis.forEach(function(a){return a.adjustProportion();});this.containerLength+=delta;}}}},{key:"equalizeDynamicAxis",value:function LayoutAxis_equalizeDynamicAxis_(){var dynamicAxis=[].concat(_toConsumableArray2(this.otherAxis.filter(function(a){return!a.fixed;})),_toConsumableArray2(this.fixed?[]:[this]));var l=(this.containerLength-this.staticLength)/dynamicAxis.length;dynamicAxis.map(function(a){if(!a.fixed)a.length=l;return a;}).forEach(function(a){return a.adjustProportion();});}},{key:"addBefore",value:function LayoutAxis_addBefore_(){var newAxis=this.emptyAxis();this.before&&this.before.attachTo(newAxis);newAxis.attachTo(this);this.equalizeDynamicAxis();this.layout.grid=this.getRoot();}},{key:"addAfter",value:function LayoutAxis_addAfter_(){var newAxis=this.emptyAxis();this.after&&newAxis.attachTo(this.after);this.attachTo(newAxis);this.equalizeDynamicAxis();this.layout.grid=this.getRoot();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"LayoutAxis";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:34952,end:40669});}(undefined);var LayoutColumn=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("LayoutColumn")&&typeof __lively_classholder__.LayoutColumn==="function"?__lively_classholder__.LayoutColumn:__lively_classholder__.LayoutColumn=function LayoutColumn(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function LayoutColumn_initialize_(cell){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,cell);this.items=[].concat(_toConsumableArray2(cell.above),[cell],_toConsumableArray2(cell.below));}},{key:"dimension",get:function get(){return"width";}},{key:"before",get:function get(){return this._before||(this._before=this.origin.left&&new __varRecorder__$z.LayoutColumn(this.origin.left));}},{key:"after",get:function get(){return this._after||(this._after=this.origin.right&&new __varRecorder__$z.LayoutColumn(this.origin.right));}},{key:"row",value:function LayoutColumn_row_(idx){return this.items[idx];}},{key:"dynamicLength",get:function get(){return this.origin.dynamicWidth;}},{key:"staticLength",get:function get(){return this.origin.totalStaticWidth;}},{key:"width",get:function get(){return this.length;}},{key:"width",set:function set(w){var delta=w-this.width;if(this.fixed){this.length+=delta;this.container.width+=delta;}else{this.adjustLength(delta);}!this.layout.manualUpdate&&this.layout.apply();}},{key:"paddingLeft",set:function set(left){this.items.forEach(function(c){c.padding.x=left;});this.layout.apply();}},{key:"paddingLeft",get:function get(){return this.items[0].padding.x;}},{key:"paddingRight",set:function set(right){this.items.forEach(function(c){c.padding.width=right;});this.layout.apply();}},{key:"paddingRight",get:function get(){return this.items[0].padding.width;}},{key:"emptyAxis",value:function LayoutColumn_emptyAxis_(){var col=new __varRecorder__$z.LayoutColumn(new __varRecorder__$z.LayoutCell({column:__varRecorder__$z.arr.withN(this.items.length,null),layout:this.layout}));__varRecorder__$z.arr.zip(col.items,this.items).forEach(function(_ref73){var _ref74=_slicedToArray2(_ref73,2),n=_ref74[0],o=_ref74[1];n.height=o.height;n.fixed.height=o.fixed.height;n.frozen.height=o.frozen.height;n.proportion.height=o.proportion.height;n.min.height=o.min.height;});return col;}},{key:"attachTo",value:function LayoutColumn_attachTo_(col){this.after&&(this.after._before=null);this._after=null;__varRecorder__$z.arr.zip(this.items,col.items).forEach(function(_ref75){var _ref76=_slicedToArray2(_ref75,2),a=_ref76[0],b=_ref76[1];a.right=b;b.left=a;});this.equalizeDynamicAxis();return col;}},{key:"remove",value:function LayoutColumn_remove_(){var _this132=this;var a=this.before||this.after;this.items.forEach(function(c){if(c.left)c.left.right=c.right;if(c.right)c.right.left=c.left;c.group.disconnect(c);_this132.layout.removeGroup(c.group);});this.before&&(this.before._after=null);this.after&&(this.after._before=null);if(!this.before){this.layout.grid=this.after.getRoot();}a.equalizeDynamicAxis();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"LayoutColumn";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:40678,end:43052});}(__varRecorder__$z.LayoutAxis);__varRecorder__$z.LayoutColumn=LayoutColumn;__varRecorder__$z.LayoutColumn=LayoutColumn;__varRecorder__$z.LayoutColumn=LayoutColumn;var LayoutRow=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("LayoutRow")&&typeof __lively_classholder__.LayoutRow==="function"?__lively_classholder__.LayoutRow:__lively_classholder__.LayoutRow=function LayoutRow(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function LayoutRow_initialize_(cell){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,cell);this.items=[].concat(_toConsumableArray2(cell.before),[cell],_toConsumableArray2(cell.after));}},{key:"dimension",get:function get(){return"height";}},{key:"emptyAxis",value:function LayoutRow_emptyAxis_(){var row=new __varRecorder__$z.LayoutRow(new __varRecorder__$z.LayoutCell({row:__varRecorder__$z.arr.withN(this.items.length,null),layout:this.layout}));__varRecorder__$z.arr.zip(row.items,this.items).forEach(function(_ref77){var _ref78=_slicedToArray2(_ref77,2),n=_ref78[0],o=_ref78[1];n.width=o.width;n.fixed.width=o.fixed.width;n.frozen.width=o.frozen.width;n.proportion.width=o.proportion.width;n.min.width=o.min.width;});return row;}},{key:"paddingTop",set:function set(top){this.items.forEach(function(c){c.padding.y=top;});this.layout.apply();}},{key:"paddingTop",get:function get(){return this.items[0].padding.y;}},{key:"paddingBottom",set:function set(bottom){this.items.forEach(function(c){c.padding.height=bottom;});this.layout.apply();}},{key:"paddingBottom",get:function get(){return this.items[0].padding.height;}},{key:"before",get:function get(){return this._before||(this._before=this.origin.top&&new __varRecorder__$z.LayoutRow(this.origin.top));}},{key:"after",get:function get(){return this._after||(this._after=this.origin.bottom&&new __varRecorder__$z.LayoutRow(this.origin.bottom));}},{key:"dynamicLength",get:function get(){return this.origin.dynamicHeight;}},{key:"staticLength",get:function get(){return this.origin.totalStaticHeight;}},{key:"attachTo",value:function LayoutRow_attachTo_(row){this.after&&(this.after._before=null);this._after=null;__varRecorder__$z.arr.zip(this.items,row.items).forEach(function(_ref79){var _ref80=_slicedToArray2(_ref79,2),a=_ref80[0],b=_ref80[1];a.bottom=b;b.top=a;});this.equalizeDynamicAxis();return row;}},{key:"col",value:function LayoutRow_col_(idx){return this.items[idx];}},{key:"height",get:function get(){return this.length;}},{key:"height",set:function set(h){var delta=h-this.height;if(this.fixed){this.length+=delta;this.container.height+=delta;}else{this.adjustLength(delta);this.proportion=this.origin.dynamicHeight>0?this.height/this.origin.dynamicHeight:0;}!this.layout.manualUpdate&&this.layout.apply();}},{key:"remove",value:function LayoutRow_remove_(){var _this133=this;var a=this.before||this.after;this.items.forEach(function(c){if(c.top)c.top.bottom=c.bottom;if(c.bottom)c.bottom.top=c.top;c.group.disconnect(c);_this133.layout.removeGroup(c.group);});this.before&&(this.before._after=null);this.after&&(this.after._before=null);if(!this.before){this.layout.grid=this.after.getRoot();}a.equalizeDynamicAxis();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"LayoutRow";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:43061,end:45522});}(__varRecorder__$z.LayoutAxis);__varRecorder__$z.LayoutRow=LayoutRow;__varRecorder__$z.LayoutRow=LayoutRow;__varRecorder__$z.LayoutRow=LayoutRow;var LayoutCell=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("LayoutCell")&&typeof __lively_classholder__.LayoutCell==="function"?__lively_classholder__.LayoutCell:__lively_classholder__.LayoutCell=function LayoutCell(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function LayoutCell_initialize_(_ref81){var _this134=this;var row=_ref81.row,column=_ref81.column,top=_ref81.top,left=_ref81.left,right=_ref81.right,bottom=_ref81.bottom,layout=_ref81.layout;return function(row,column){var group;var _ref82=row||[],_ref83=_toArray2(_ref82),rv=_ref83[0],row=_ref83.slice(1);var _ref84=column||[],_ref85=_toArray2(_ref84),cv=_ref85[0],column=_ref85.slice(1);_this134.layout=layout;_this134.fixed={width:false,height:false};_this134.frozen={width:false,height:false};_this134.min={width:0,height:0};_this134.top=top;_this134.left=left;_this134.bottom=bottom;_this134.right=right;_this134.padding=__varRecorder__$z.rect(0,0,0,0);if(row.length>0){_this134.right=new __varRecorder__$z.LayoutCell({row:row,left:_this134,layout:layout});}else if(column.length>0){_this134.bottom=new __varRecorder__$z.LayoutCell({column:column,top:_this134,layout:layout});}_this134.proportion={width:1/(1+_this134.before.length+_this134.after.length),height:1/(1+_this134.above.length+_this134.below.length)};_this134.height=_this134.container.height*_this134.proportion.height;_this134.width=_this134.container.width*_this134.proportion.width;if(group=layout&&layout.getCellGroupFor(rv||cv)){group.connect(_this134);}else{_this134.group=new __varRecorder__$z.CellGroup({cell:_this134,morph:rv||cv,layout:layout});}}(row,column);}},{key:"container",get:function get(){return this.layout.container;}},{key:"above",get:function get(){return this.collect({neighbor:"top",prepend:true});}},{key:"below",get:function get(){return this.collect({neighbor:"bottom",append:true});}},{key:"before",get:function get(){return this.collect({neighbor:"left",prepend:true});}},{key:"after",get:function get(){return this.collect({neighbor:"right",append:true});}},{key:"collect",value:function LayoutCell_collect_(_ref86){var neighbor=_ref86.neighbor,prepend=_ref86.prepend,append=_ref86.append;var items=[];var curr=this;while(curr=curr[neighbor]){if(prepend)items=[curr].concat(_toConsumableArray2(items));if(append)items=[].concat(_toConsumableArray2(items),[curr]);}return items;}},{key:"col",value:function LayoutCell_col_(idx){var cell=this;var i=idx;while(i>0&&cell){cell=cell.right;i--;}if(!cell)throw Error("".concat(idx," out of bounds! Last column was ").concat(idx-i-1));return new __varRecorder__$z.LayoutColumn(cell);}},{key:"row",value:function LayoutCell_row_(idx){var cell=this;var i=idx;while(i>0&&cell){cell=cell.bottom;i--;}if(!cell)throw Error("".concat(idx," out of bounds! Last row was ").concat(idx-i-1));return new __varRecorder__$z.LayoutRow(cell);}},{key:"extent",get:function get(){return __varRecorder__$z.pt(this.width,this.height);}},{key:"staticWidth",get:function get(){return this.fixed.width||this.min.width==this.width;}},{key:"staticHeight",get:function get(){return this.fixed.height||this.min.height==this.height;}},{key:"totalStaticWidth",get:function get(){return __varRecorder__$z.arr.sum([this].concat(_toConsumableArray2(this.before),_toConsumableArray2(this.after)).filter(function(c){return c.staticWidth;}).map(function(c){return c.width;}));}},{key:"totalStaticHeight",get:function get(){return __varRecorder__$z.arr.sum([this].concat(_toConsumableArray2(this.above),_toConsumableArray2(this.below)).filter(function(c){return c.staticHeight;}).map(function(c){return c.height;}));}},{key:"dynamicWidth",get:function get(){return __varRecorder__$z.arr.sum([this].concat(_toConsumableArray2(this.before),_toConsumableArray2(this.after)).filter(function(c){return!c.staticWidth;}).map(function(c){return c.width;}));}},{key:"dynamicHeight",get:function get(){return __varRecorder__$z.arr.sum([this].concat(_toConsumableArray2(this.above),_toConsumableArray2(this.below)).filter(function(c){return!c.staticHeight;}).map(function(c){return c.height;}));}},{key:"height",get:function get(){return Math.max(this.min.height,this._height||0);}},{key:"height",set:function set(h){this._height=h;}},{key:"width",get:function get(){return Math.max(this.min.width,this._width||0);}},{key:"width",set:function set(w){this._width=w;}},{key:"position",get:function get(){return __varRecorder__$z.pt(__varRecorder__$z.arr.sum(this.before.map(function(c){return c.width;})),__varRecorder__$z.arr.sum(this.above.map(function(c){return c.height;})));}},{key:"bounds",value:function LayoutCell_bounds_(){return this.position.addPt(this.padding.topLeft()).extent(this.extent.subPt(this.padding.extent()).subPt(this.padding.topLeft()));}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"LayoutCell";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:45531,end:49183});}(undefined);__varRecorder__$z.LayoutCell=LayoutCell;__varRecorder__$z.LayoutCell=LayoutCell;__varRecorder__$z.LayoutCell=LayoutCell;var GridLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("GridLayout")&&typeof __lively_classholder__.GridLayout==="function"?__lively_classholder__.GridLayout:__lively_classholder__.GridLayout=function GridLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function GridLayout_initialize_(config){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,config);config=Object.assign({autoAssign:true,fitToCell:true},config);this.cellGroups=[];this.config=config;}},{key:"name",value:function GridLayout_name_(){return"Grid";}},{key:"description",value:function GridLayout_description_(){return"Aligns the submorphs alongside a configurable grid. Columns and rows and be configured to have different proportional, minimal or fixed sizes. Cells can further be grouped such that submorphs fill up multiple slots of the grid.";}},{key:"copy",value:function GridLayout_copy_(){return new this.constructor(this.getSpec());}},{key:"getSpec",value:function GridLayout_getSpec_(){var grid=[];var rows=[];var columns=[];var groups={};var _iterator64=_createForOfIteratorHelper(__varRecorder__$z.arr.range(0,this.rowCount-1)),_step64;try{for(_iterator64.s();!(_step64=_iterator64.n()).done;){var _r3=_step64.value;grid.push(this.grid.row(_r3).items.map(function(item){return item.group.state.morph?item.group.state.morph.name||item.group.state.morph:null;}));}}catch(err){_iterator64.e(err);}finally{_iterator64.f();}var _iterator65=_createForOfIteratorHelper(__varRecorder__$z.arr.range(0,this.rowCount-1)),_step65;try{for(_iterator65.s();!(_step65=_iterator65.n()).done;){var _r4=_step65.value;var row=this.grid.row(_r4);rows.push(_r4,Object.assign({},row.fixed?{fixed:row.length}:{height:row.height},{paddingTop:row.paddingTop,paddingBottom:row.paddingBottom}));}}catch(err){_iterator65.e(err);}finally{_iterator65.f();}var _iterator66=_createForOfIteratorHelper(__varRecorder__$z.arr.range(0,this.columnCount-1)),_step66;try{for(_iterator66.s();!(_step66=_iterator66.n()).done;){var _c7=_step66.value;var col=this.grid.col(_c7);columns.push(_c7,Object.assign({},col.fixed?{fixed:col.length}:{},{paddingLeft:col.paddingLeft,paddingRight:col.paddingRight}));}}catch(err){_iterator66.e(err);}finally{_iterator66.f();}var _iterator67=_createForOfIteratorHelper(this.cellGroups),_step67;try{for(_iterator67.s();!(_step67=_iterator67.n()).done;){var cell=_step67.value;if(cell.state.morph){groups[typeof cell.state.morph==="string"?cell.state.morph:cell.morph.name]=__varRecorder__$z.obj.select(cell,["align","resize"]);}}}catch(err){_iterator67.e(err);}finally{_iterator67.f();}return{autoAssign:false,grid:grid,rows:rows,columns:columns,groups:groups};}},{key:"__serialize__",value:function GridLayout___serialize___(){return{__expr__:"new GridLayout(".concat(__varRecorder__$z.obj.inspect(this.getSpec(),{escapeKeys:true}),")"),bindings:{"lively.morphic":["GridLayout"]}};}},{key:"initGrid",value:function GridLayout_initGrid_(){var _this135=this;var grid=this.ensureGrid(this.config);var rows=grid.map(function(row){return new __varRecorder__$z.LayoutRow(new __varRecorder__$z.LayoutCell({row:row,layout:_this135}));});rows.reduce(function(a,b){return a.attachTo(b);});this.config.autoAssign&&this.autoAssign(this.notInLayout);this.grid=rows[0].col(0);this.col(0).equalizeDynamicAxis();this.row(0).equalizeDynamicAxis();this.initRowsAndColumns();this.initGroups();}},{key:"initGroups",value:function GridLayout_initGroups_(){var groups=this.config.groups;if(groups){for(var _g in groups){var group=this.getCellGroupFor(this.container.getSubmorphNamed(_g));var _groups$_g=groups[_g],resize=_groups$_g.resize,_groups$_g$align=_groups$_g.align,align=_groups$_g$align===void 0?"topLeft":_groups$_g$align,_groups$_g$alignedPro=_groups$_g.alignedProperty,alignedProperty=_groups$_g$alignedPro===void 0?"topLeft":_groups$_g$alignedPro;if(!group)continue;if(resize!=undefined)group.resize=resize;group.align=align;group.alignedProperty=alignedProperty;}}}},{key:"initRowsAndColumns",value:function GridLayout_initRowsAndColumns_(){var _this$config2=this.config,_this$config2$rows=_this$config2.rows,rows=_this$config2$rows===void 0?[]:_this$config2$rows,_this$config2$columns=_this$config2.columns,columns=_this$config2$columns===void 0?[]:_this$config2$columns;var _iterator68=_createForOfIteratorHelper(__varRecorder__$z.arr.toTuples(rows,2)),_step68;try{for(_iterator68.s();!(_step68=_iterator68.n()).done;){var _step68$value=_slicedToArray2(_step68.value,2),idx=_step68$value[0],props=_step68$value[1];Object.assign(this.row(idx),props);}}catch(err){_iterator68.e(err);}finally{_iterator68.f();}var _iterator69=_createForOfIteratorHelper(__varRecorder__$z.arr.toTuples(columns,2)),_step69;try{for(_iterator69.s();!(_step69=_iterator69.n()).done;){var _step69$value=_slicedToArray2(_step69.value,2),idx=_step69$value[0],props=_step69$value[1];Object.assign(this.col(idx),props);}}catch(err){_iterator69.e(err);}finally{_iterator69.f();}}},{key:"compensateOrigin",get:function get(){return this.config.compensateOrigin;}},{key:"compensateOrigin",set:function set(compensate){this.config.compensateOrigin=compensate;this.apply();}},{key:"fitToCell",get:function get(){return this.config.fitToCell;}},{key:"fitToCell",set:function set(fit){this.config.fitToCell=fit;this.cellGroups.forEach(function(g){return g.resize=fit;});this.apply();}},{key:"notInLayout",get:function get(){return __varRecorder__$z.arr.withoutAll(this.layoutableSubmorphs,this.cellGroups.map(function(g){return g.morph;}));}},{key:"col",value:function GridLayout_col_(idx){return this.grid.col(idx);}},{key:"row",value:function GridLayout_row_(idx){return this.grid.row(idx);}},{key:"rowCount",get:function get(){return this.grid.col(0).items.length;}},{key:"columnCount",get:function get(){return this.grid.row(0).items.length;}},{key:"addGroup",value:function GridLayout_addGroup_(group){this.cellGroups.push(group);}},{key:"removeGroup",value:function GridLayout_removeGroup_(group){__varRecorder__$z.arr.remove(this.cellGroups,group);}},{key:"fitAxis",value:function GridLayout_fitAxis_(){var _this136=this;var totalStaticHeight;var totalStaticWidth;var dynamicHeight=this.grid.dynamicHeight;var dynamicWidth=this.grid.dynamicWidth;[this.grid.row(0)].concat(_toConsumableArray2(this.grid.row(0).axisAfter)).map(function(r){r.prepareForResize(_this136.container.height);totalStaticHeight=_this136.grid.totalStaticHeight;return r;}).forEach(function(r){if(!r.fixed)r.length=r.proportion*Math.max(0,_this136.container.height-totalStaticHeight);});[this.grid.col(0)].concat(_toConsumableArray2(this.grid.col(0).axisAfter)).map(function(c){c.prepareForResize(_this136.container.width);totalStaticWidth=_this136.grid.totalStaticWidth;return c;}).forEach(function(c){if(!c.fixed)c.length=c.proportion*Math.max(0,_this136.container.width-totalStaticWidth);});}},{key:"apply",value:function GridLayout_apply_(){var animate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.active)return;this.active=true;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"apply",this).call(this,animate);if(!this.grid)this.initGrid();this.fitAxis();this.container.extent=__varRecorder__$z.pt(Math.max(this.grid.totalStaticWidth,this.container.width),Math.max(this.grid.totalStaticHeight,this.container.height));this.fitAxis();this.cellGroups.forEach(function(g){g&&g.apply(animate);});this.lastBoundsExtent=this.container.bounds().extent();this.active=false;}},{key:"submorphBoundsChanged",get:function get(){var _iterator70=_createForOfIteratorHelper(this.cellGroups),_step70;try{for(_iterator70.s();!(_step70=_iterator70.n()).done;){var _g2=_step70.value;if(_g2.morph&&!_g2.bounds().equals(_g2.morph.bounds())){return true;}}}catch(err){_iterator70.e(err);}finally{_iterator70.f();}return false;}},{key:"getCellGroupFor",value:function GridLayout_getCellGroupFor_(morph){return morph&&this.cellGroups.find(function(g){return g.morph==morph;});}},{key:"onSubmorphRemoved",value:function GridLayout_onSubmorphRemoved_(removedMorph){var cellGroup=this.getCellGroupFor(removedMorph);if(cellGroup)cellGroup.morph=null;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onSubmorphRemoved",this).call(this,removedMorph);}},{key:"inspect",value:function GridLayout_inspect_(pointerId){}},{key:"ensureGrid",value:function GridLayout_ensureGrid_(_ref87){var _this137=this;var grid=_ref87.grid,rowCount=_ref87.rowCount,columnCount=_ref87.columnCount;grid=grid||[[]];rowCount=rowCount||grid.length;columnCount=columnCount||__varRecorder__$z.arr.max(grid.map(function(row){return row.length;}));if(grid.length<rowCount){grid=grid.concat(__varRecorder__$z.arr.withN(rowCount-grid.length,[]));}grid=grid.map(function(row){if(row.length<columnCount){row=row.concat(__varRecorder__$z.arr.withN(columnCount-row.length,null));}return row.map(function(v){if(v&&v.isMorph){if(v.owner!=_this137.container)_this137.container.addMorph(v);return v;}if(v)return _this137.container.getSubmorphNamed(v)||v;return v;});});return grid;}},{key:"autoAssign",value:function GridLayout_autoAssign_(morphs){var _this138=this;morphs.forEach(function(m){var cellGroup;var closestDist=Infinity;_this138.cellGroups.forEach(function(g){if(!g.morph){g.cells.forEach(function(c){var distToCell=c.position.dist(m.position);if(distToCell<closestDist){cellGroup=g;closestDist=distToCell;}});}});if(cellGroup)cellGroup.morph=m;});}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"GridLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:49192,end:56229});}(__varRecorder__$z.Layout);__varRecorder__$z.GridLayout=GridLayout;__varRecorder__$z.GridLayout=GridLayout;__varRecorder__$z.GridLayout=GridLayout;var __captured8__=/*#__PURE__*/Object.freeze({__proto__:null,CustomLayout:CustomLayout,SnapLayout:SnapLayout,VerticalLayout:VerticalLayout,HorizontalLayout:HorizontalLayout,ProportionalLayout:ProportionalLayout,CenteredTilingLayout:CenteredTilingLayout,TilingLayout:TilingLayout,CellGroup:CellGroup,LayoutColumn:LayoutColumn,LayoutRow:LayoutRow,LayoutCell:LayoutCell,GridLayout:GridLayout});var __varRecorder__$A=lively.FreezerRuntime.recorderFor("lively.morphic/partsbin.js");function getAllPartResources(options){return[];}__varRecorder__$A.getAllPartResources=getAllPartResources;function loadPart(_x132){return _loadPart.apply(this,arguments);}function _loadPart(){_loadPart=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee219(nameOrCommit){var options,morphicDB,part,target,commit,_args220=arguments;return regeneratorRuntime.wrap(function _callee219$(_context219){while(1){switch(_context219.prev=_context219.next){case 0:options=_args220.length>1&&_args220[1]!==undefined?_args220[1]:{};morphicDB=options.morphicDB||__varRecorder__$A.MorphicDB["default"];_context219.next=4;return morphicDB.load("part",typeof nameOrCommit==="string"?nameOrCommit:nameOrCommit.name,options,typeof nameOrCommit==="string"?undefined:nameOrCommit);case 4:part=_context219.sent;if(!(part.isWindow&&part.targetMorph)){_context219.next=11;break;}target=part.targetMorph;_context219.next=9;return __varRecorder__$A.ensureCommitInfo(part.metadata&&part.metadata.commit);case 9:commit=_context219.sent;if(commit){target.changeMetaData("commit",commit,true,false);}case 11:return _context219.abrupt("return",part);case 12:case"end":return _context219.stop();}}},_callee219);}));return _loadPart.apply(this,arguments);}__varRecorder__$A.loadPart=loadPart;function savePart(_x133,_x134,_x135,_x136,_x137,_x138){return _savePart.apply(this,arguments);}function _savePart(){_savePart=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee220(part,name,options,commitSpec,ref,expectedParentCommit){var morphsToPrepare,_i195,_morphsToPrepare,_m19,msg,snapshotOptions,morphicDB,commit;return regeneratorRuntime.wrap(function _callee220$(_context220){while(1){switch(_context220.prev=_context220.next){case 0:_context220.prev=0;if(!part.isMorph){_context220.next=14;break;}morphsToPrepare=[];part.withAllSubmorphsDo(function(ea){if(typeof ea.beforePublish==="function"){morphsToPrepare.push(ea);}});_i195=0,_morphsToPrepare=morphsToPrepare;case 5:if(!(_i195<_morphsToPrepare.length)){_context220.next=12;break;}_m19=_morphsToPrepare[_i195];_context220.next=9;return _m19.beforePublish();case 9:_i195++;_context220.next=5;break;case 12:_context220.next=17;break;case 14:if(!(typeof part.beforePublish==="function")){_context220.next=17;break;}_context220.next=17;return part.beforePublish(name,part);case 17:_context220.next=23;break;case 19:_context220.prev=19;_context220.t0=_context220["catch"](0);msg="Error in beforePublish of ".concat(part,"\n").concat(_context220.t0.stack);if(typeof part.world==="function"&&part.world())part.world().logError(new Error(msg));else console.error(msg);case 23:snapshotOptions=Object.assign({previewWidth:100,previewHeight:100,previewType:"png"},options);morphicDB=options.morphicDB||__varRecorder__$A.MorphicDB["default"];_context220.next=27;return morphicDB.snapshotAndCommit("part",name,part,snapshotOptions,commitSpec,ref,expectedParentCommit);case 27:commit=_context220.sent;__varRecorder__$A.emit("lively.partsbin/partpublished",commit);return _context220.abrupt("return",commit);case 30:case"end":return _context220.stop();}}},_callee220,null,[[0,19]]);}));return _savePart.apply(this,arguments);}__varRecorder__$A.savePart=savePart;function interactivelySavePart(_x139){return _interactivelySavePart2.apply(this,arguments);}function _interactivelySavePart2(){_interactivelySavePart2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee221(part){var options,_options$showPublishD,showPublishDialog,_options$notification,notifications,_options$loadingIndic,loadingIndicator,_options$preferWindow,preferWindow,switchedToWindow,windowMetadata,actualPart,world,name,tags,description,oldCommit,morphicDB,_yield$world$openProm,db,commit,_oldCommit,i,ref,oldName,expectedParentCommit,_yield$morphicDB$exis,_exists4,existingCommitId,overwrite,win,commitSpec,_commit2,_ref155,_ref156,_9,typeAndName1,expectedVersion1,actualVersion1,_yield$morphicDB$log,_yield$morphicDB$log2,newerCommit,authorName,timestamp,overwriteQ,_overwrite,commitMetaData,_ref157,_ref158,__,typeAndName2,expectedVersion2,_overwriteQ,_overwrite2,_args222=arguments;return regeneratorRuntime.wrap(function _callee221$(_context221){while(1){switch(_context221.prev=_context221.next){case 0:options=_args222.length>1&&_args222[1]!==undefined?_args222[1]:{};_options$showPublishD=options.showPublishDialog,showPublishDialog=_options$showPublishD===void 0?true:_options$showPublishD,_options$notification=options.notifications,notifications=_options$notification===void 0?true:_options$notification,_options$loadingIndic=options.loadingIndicator,loadingIndicator=_options$loadingIndic===void 0?true:_options$loadingIndic,_options$preferWindow=options.preferWindow,preferWindow=_options$preferWindow===void 0?true:_options$preferWindow;actualPart=part;world=part.world()||part.env.world;name=part.name;tags=[];description="";_context221.next=9;return __varRecorder__$A.ensureCommitInfo(__varRecorder__$A.Path("metadata.commit").get(part)||__varRecorder__$A.Path("metadata.commit").get(actualPart));case 9:oldCommit=_context221.sent;morphicDB=options.morphicDB||__varRecorder__$A.MorphicDB["default"];if(!oldCommit){oldCommit={type:"part",name:part.name,author:world.getCurrentUser(),tags:[],description:"no description"};}if(!showPublishDialog){_context221.next=31;break;}_context221.t0=world;_context221.next=16;return __varRecorder__$A.loadPart("publish part dialog");case 16:_context221.t1=_context221.sent;_context221.t2={part:part};_context221.next=20;return _context221.t0.openPrompt.call(_context221.t0,_context221.t1,_context221.t2);case 20:_yield$world$openProm=_context221.sent;db=_yield$world$openProm.db;commit=_yield$world$openProm.commit;if(commit){_context221.next=25;break;}return _context221.abrupt("return",null);case 25:if(db)options.morphicDB=morphicDB=db;name=commit.name;tags=commit.tags;description=commit.description;_context221.next=32;break;case 31:if(oldCommit){_oldCommit=oldCommit;name=_oldCommit.name;tags=_oldCommit.tags;description=_oldCommit.description;}case 32:if(!loadingIndicator){_context221.next=36;break;}i=$world.execCommand("open loading indicator","saving ".concat(name,"..."));_context221.next=36;return __varRecorder__$A.promise.delay(80);case 36:_context221.prev=36;ref="HEAD";oldName=oldCommit?oldCommit.name:part.name;if(!(oldName!==name)){_context221.next=55;break;}_context221.next=42;return morphicDB.exists("part",name);case 42:_yield$morphicDB$exis=_context221.sent;_exists4=_yield$morphicDB$exis.exists;existingCommitId=_yield$morphicDB$exis.commitId;if(!_exists4){_context221.next=52;break;}_context221.next=48;return world.confirm("A part \"".concat(name,"\" already exists, overwrite?"));case 48:overwrite=_context221.sent;if(overwrite){_context221.next=51;break;}return _context221.abrupt("return",null);case 51:expectedParentCommit=existingCommitId;case 52:actualPart.name=name;_context221.next=56;break;case 55:expectedParentCommit=oldCommit?oldCommit._id:undefined;case 56:if(preferWindow&&!part.isWindow){win=part.getWindow();if(win&&win.targetMorph===part){part=win;windowMetadata=win.metadata;switchedToWindow=true;}}commitSpec={author:part.world().getCurrentUser(),message:"published",tags:tags,description:description};_context221.next=60;return __varRecorder__$A.savePart(part,name,options,commitSpec,ref,expectedParentCommit);case 60:_commit2=_context221.sent;if(!switchedToWindow){_context221.next=73;break;}if(!actualPart.metadata){_context221.next=68;break;}_context221.next=65;return __varRecorder__$A.ensureCommitInfo(win.metadata.commit);case 65:actualPart.metadata.commit=_context221.sent;_context221.next=72;break;case 68:_context221.next=70;return __varRecorder__$A.ensureCommitInfo(win.metadata.commit);case 70:_context221.t3=_context221.sent;actualPart.metadata={commit:_context221.t3};case 72:win.metadata=windowMetadata;case 73:notifications&&part.setStatusMessage("saved part ".concat(name));return _context221.abrupt("return",_commit2);case 77:_context221.prev=77;_context221.t4=_context221["catch"](36);_ref155=_context221.t4.message.match(/Trying to store "([^\"]+)" on top of expected version ([^\s]+) but ref HEAD is of version ([^\s\!]+)/)||[],_ref156=_slicedToArray2(_ref155,4),_9=_ref156[0],typeAndName1=_ref156[1],expectedVersion1=_ref156[2],actualVersion1=_ref156[3];if(!(expectedVersion1&&actualVersion1)){_context221.next=96;break;}_context221.next=83;return morphicDB.log(actualVersion1,1,true);case 83:_yield$morphicDB$log=_context221.sent;_yield$morphicDB$log2=_slicedToArray2(_yield$morphicDB$log,1);newerCommit=_yield$morphicDB$log2[0];authorName=newerCommit.author.name,timestamp=newerCommit.timestamp;overwriteQ="The current version of part \"".concat(name,"\" is not the most recent!\n")+"A newer version by ".concat(authorName," was saved on ")+"".concat(__varRecorder__$A.date.format(new Date(timestamp),"yyyy-mm-dd HH:MM"),". Overwrite?");_context221.next=90;return world.confirm(["Version Mismatch\n",{},overwriteQ,{fontWeight:"normal",fontSize:16}]);case 90:_overwrite=_context221.sent;if(_overwrite){_context221.next=93;break;}return _context221.abrupt("return",null);case 93:commitMetaData=__varRecorder__$A.obj.dissoc(newerCommit,["preview"]);actualPart.changeMetaData("commit",commitMetaData,true,false);return _context221.abrupt("return",interactivelySavePart(actualPart,Object.assign({},options,{morphicDB:morphicDB,showPublishDialog:false})));case 96:_ref157=_context221.t4.message.match(/Trying to store "([^\"]+)" on top of expected version ([^\s]+) but no version entry exists/)||[],_ref158=_slicedToArray2(_ref157,3),__=_ref158[0],typeAndName2=_ref158[1],expectedVersion2=_ref158[2];if(!expectedVersion2){_context221.next=106;break;}_overwriteQ="Part ".concat(name," no longer exist in the object database.\n")+"Do you still want to publish it?";_context221.next=101;return world.confirm(_overwriteQ);case 101:_overwrite2=_context221.sent;if(_overwrite2){_context221.next=104;break;}return _context221.abrupt("return",null);case 104:actualPart.changeMetaData("commit",null,true,false);return _context221.abrupt("return",interactivelySavePart(actualPart,Object.assign({},options,{morphicDB:morphicDB,showPublishDialog:false})));case 106:console.error(_context221.t4);notifications&&world.logError("Error saving part: "+_context221.t4);throw _context221.t4;case 109:_context221.prev=109;i&&i.remove();return _context221.finish(109);case 112:case"end":return _context221.stop();}}},_callee221,null,[[36,77,109,112]]);}));return _interactivelySavePart2.apply(this,arguments);}__varRecorder__$A.interactivelySavePart=interactivelySavePart;function interactivelyLoadObjectFromPartsBinFolder(){return _interactivelyLoadObjectFromPartsBinFolder.apply(this,arguments);}function _interactivelyLoadObjectFromPartsBinFolder(){_interactivelyLoadObjectFromPartsBinFolder=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee222(){var options,morphicDB,partSpecs,items,_yield$$world$filtera3,_yield$$world$filtera4,choice,_args223=arguments;return regeneratorRuntime.wrap(function _callee222$(_context222){while(1){switch(_context222.prev=_context222.next){case 0:options=_args223.length>0&&_args223[0]!==undefined?_args223[0]:{};morphicDB=options.morphicDB||__varRecorder__$A.MorphicDB["default"];_context222.next=4;return morphicDB.latestCommits("part");case 4:partSpecs=_context222.sent;items=partSpecs.map(function(ea){return{isListItem:true,string:ea.name,value:ea};});_context222.next=8;return $world.filterableListPrompt("Select part to load",items,{fuzzy:true});case 8:_yield$$world$filtera3=_context222.sent;_yield$$world$filtera4=_slicedToArray2(_yield$$world$filtera3.selected,1);choice=_yield$$world$filtera4[0];return _context222.abrupt("return",choice?__varRecorder__$A.loadPart(choice):null);case 12:case"end":return _context222.stop();}}},_callee222);}));return _interactivelyLoadObjectFromPartsBinFolder.apply(this,arguments);}__varRecorder__$A.interactivelyLoadObjectFromPartsBinFolder=interactivelyLoadObjectFromPartsBinFolder;function interactivelySaveObjectToPartsBinFolder(_x140){return _interactivelySaveObjectToPartsBinFolder.apply(this,arguments);}function _interactivelySaveObjectToPartsBinFolder(){_interactivelySaveObjectToPartsBinFolder=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee223(obj){var partName;return regeneratorRuntime.wrap(function _callee223$(_context223){while(1){switch(_context223.prev=_context223.next){case 0:_context223.next=2;return $world.prompt("Enter part name to publish object under",{input:obj.name||"part-name",historyId:"lively.partsbin-partname-publish-to-folder-input-hist"});case 2:partName=_context223.sent;if(partName){_context223.next=5;break;}throw"canceled";case 5:return _context223.abrupt("return",__varRecorder__$A.saveObjectToPartsbinFolder(obj,partName,{previewWidth:obj.width,previewHeight:obj.height}));case 6:case"end":return _context223.stop();}}},_callee223);}));return _interactivelySaveObjectToPartsBinFolder.apply(this,arguments);}__varRecorder__$A.interactivelySaveObjectToPartsBinFolder=interactivelySaveObjectToPartsBinFolder;function saveObjectToPartsbinFolder(_x141,_x142){return _saveObjectToPartsbinFolder.apply(this,arguments);}function _saveObjectToPartsbinFolder(){_saveObjectToPartsbinFolder=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee224(obj,partName){var options,win,morphsToPrepare,_i196,_morphsToPrepare2,_m20,msg,partResource,snapshot,_args225=arguments;return regeneratorRuntime.wrap(function _callee224$(_context224){while(1){switch(_context224.prev=_context224.next){case 0:options=_args225.length>2&&_args225[2]!==undefined?_args225[2]:{};options=Object.assign({preferWindow:true},options);if(options.preferWindow){win=obj.getWindow();obj=win&&win.targetMorph===obj?win:obj;}_context224.prev=3;if(!obj.isMorph){_context224.next=17;break;}morphsToPrepare=[];obj.withAllSubmorphsDo(function(ea){if(typeof ea.beforePublish==="function"){morphsToPrepare.push(ea);}});_i196=0,_morphsToPrepare2=morphsToPrepare;case 8:if(!(_i196<_morphsToPrepare2.length)){_context224.next=15;break;}_m20=_morphsToPrepare2[_i196];_context224.next=12;return _m20.beforePublish();case 12:_i196++;_context224.next=8;break;case 15:_context224.next=20;break;case 17:if(!(typeof obj.beforePublish==="function")){_context224.next=20;break;}_context224.next=20;return obj.beforePublish(partName,obj);case 20:_context224.next=26;break;case 22:_context224.prev=22;_context224.t0=_context224["catch"](3);msg="Error in beforePublish of ".concat(obj,"\n").concat(_context224.t0.stack);if(typeof obj.world==="function"&&obj.world())obj.world().logError(new Error(msg));else console.error(msg);case 26:_context224.next=28;return __varRecorder__$A.resource(options.partsbinFolder).ensureExistance();case 28:partResource=__varRecorder__$A.resource(options.partsbinFolder).join(partName+".json");_context224.next=31;return __varRecorder__$A.createMorphSnapshot(obj,options);case 31:snapshot=_context224.sent;_context224.next=34;return partResource.write(JSON.stringify(snapshot,null,2));case 34:return _context224.abrupt("return",{partName:partName,url:partResource.url});case 35:case"end":return _context224.stop();}}},_callee224,null,[[3,22]]);}));return _saveObjectToPartsbinFolder.apply(this,arguments);}__varRecorder__$A.saveObjectToPartsbinFolder=saveObjectToPartsbinFolder;function loadObjectFromPartsbinFolder(_x143){return _loadObjectFromPartsbinFolder.apply(this,arguments);}function _loadObjectFromPartsbinFolder(){_loadObjectFromPartsbinFolder=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee225(partName){var options,_args226=arguments;return regeneratorRuntime.wrap(function _callee225$(_context225){while(1){switch(_context225.prev=_context225.next){case 0:options=_args226.length>1&&_args226[1]!==undefined?_args226[1]:{};return _context225.abrupt("return",__varRecorder__$A.loadPart(partName,options));case 2:case"end":return _context225.stop();}}},_callee225);}));return _loadObjectFromPartsbinFolder.apply(this,arguments);}__varRecorder__$A.loadObjectFromPartsbinFolder=loadObjectFromPartsbinFolder;function buildCommitEditor(props){var inputStyle={type:"input",extent:__varRecorder__$A.pt(420,24),fixedWidth:true,fixedHeight:true,padding:__varRecorder__$A.Rectangle.inset(4,4),border:{color:__varRecorder__$A.Color.gray,width:1}};return Object.assign(__varRecorder__$A.morph({extent:__varRecorder__$A.pt(420,24),layout:new __varRecorder__$A.VerticalLayout({resizeSubmorphs:true,spacing:3}),submorphs:[Object.assign({},inputStyle,{name:"name input",placeholder:"name"}),Object.assign({},inputStyle,{name:"type input",placeholder:"type"}),Object.assign({},inputStyle,{name:"timestamp input",placeholder:"timestamp"}),{layout:new __varRecorder__$A.VerticalLayout({resizeSubmorphs:true,spacing:3}),submorphs:[Object.assign({},inputStyle,{name:"author.name input",placeholder:"author name"}),Object.assign({},inputStyle,{name:"author.email input",placeholder:"author email"}),Object.assign({},inputStyle,{name:"author.realm input",placeholder:"author realm"})]},Object.assign({},inputStyle,{name:"tags input",placeholder:"tags"}),Object.assign({},inputStyle,{height:70,name:"description input",type:"text"}),Object.assign({},inputStyle,{height:70,name:"message input",type:"text"}),Object.assign({},inputStyle,{height:70,name:"metadata input",type:"text"}),{layout:new __varRecorder__$A.HorizontalLayout({spacing:3,direction:"centered"}),submorphs:[{type:"button",name:"ok button",label:"OK"},{type:"button",name:"cancel button",label:"Cancel"}]}],name:"commit editor",get ui(){return{metadataInput:this.get("metadata input"),messageInput:this.get("message input"),descriptionInput:this.get("description input"),tagsInput:this.get("tags input"),authorRealmInput:this.get("author.realm input"),authorEmailInput:this.get("author.email input"),authorNameInput:this.get("author.name input"),timestampInput:this.get("timestamp input"),typeInput:this.get("type input"),nameInput:this.get("name input"),cancelButton:this.get("cancel button"),okButton:this.get("ok button")};},set commit(commit){this._commit=commit;var name=commit.name,type=commit.type,timestamp=commit.timestamp,author=commit.author,tags=commit.tags,description=commit.description,metadata=commit.metadata;var _this$ui=this.ui,nameInput=_this$ui.nameInput,typeInput=_this$ui.typeInput,timestampInput=_this$ui.timestampInput,authorNameInput=_this$ui.authorNameInput,authorEmailInput=_this$ui.authorEmailInput,authorRealmInput=_this$ui.authorRealmInput,tagsInput=_this$ui.tagsInput,descriptionInput=_this$ui.descriptionInput,messageInput=_this$ui.messageInput,metadataInput=_this$ui.metadataInput;nameInput.input=name;typeInput.input=type;timestampInput.input=String(new Date(timestamp));authorNameInput.input=author.name;authorEmailInput.input=author.email;authorRealmInput.input=author.realm;tagsInput.input=tags.join(" ");descriptionInput.textString=description;messageInput.textString="";metadataInput.textString=metadata?JSON.stringify(metadata,null,2):"";},get commit(){var commit=this._commit;if(!commit)throw new Error("commit editor does not have a _commit object");var _this$ui2=this.ui,nameInput=_this$ui2.nameInput,typeInput=_this$ui2.typeInput,timestampInput=_this$ui2.timestampInput,authorNameInput=_this$ui2.authorNameInput,authorEmailInput=_this$ui2.authorEmailInput,authorRealmInput=_this$ui2.authorRealmInput,tagsInput=_this$ui2.tagsInput,descriptionInput=_this$ui2.descriptionInput,messageInput=_this$ui2.messageInput,metadataInput=_this$ui2.metadataInput;var name=nameInput.input;var type=typeInput.input;if(commit.name!==name)throw new Error("name does not match _commit.name: ".concat(name," vs ").concat(commit.name));if(commit.type!==type)throw new Error("type does not match _commit.type: ".concat(type," vs ").concat(commit.type));commit.author.name=authorNameInput.input;commit.author.email=authorEmailInput.input;commit.author.realm=authorRealmInput.input;commit.tags=tagsInput.input.split(" ").map(function(ea){return ea.trim();}).filter(Boolean);commit.description=descriptionInput.textString;commit.message=messageInput.textString;commit.metadata=metadataInput.textString?JSON.parse(metadataInput.textString):null;return commit;},onLoad:function onLoad(){__varRecorder__$A.connect(this.ui.okButton,"fire",this,"accept");__varRecorder__$A.connect(this.ui.cancelButton,"fire",this,"cancel");},accept:function accept(){},cancel:function cancel(){}}),props);}__varRecorder__$A.buildCommitEditor=buildCommitEditor;__varRecorder__$A.resource=resource;__varRecorder__$A.Resource=Resource;__varRecorder__$A.registerExtension=registerExtension;__varRecorder__$A.Path=Path;__varRecorder__$A.obj=obj;__varRecorder__$A.date=date;__varRecorder__$A.promise=promise;__varRecorder__$A.HorizontalLayout=HorizontalLayout;__varRecorder__$A.VerticalLayout=VerticalLayout;__varRecorder__$A.morph=morph;__varRecorder__$A.pt=pt;__varRecorder__$A.Color=Color$1;__varRecorder__$A.Rectangle=Rectangle;__varRecorder__$A.connect=connect;__varRecorder__$A.emit=emit$1;__varRecorder__$A.SnapshotPackageHelper=SnapshotPackageHelper;__varRecorder__$A.ensureCommitInfo=ensureCommitInfo;__varRecorder__$A.MorphicDB=MorphicDB$1;__varRecorder__$A.createMorphSnapshot=createMorphSnapshot;__varRecorder__$A.getClassName=getClassName;__varRecorder__$A.getAllPartResources=getAllPartResources;__varRecorder__$A.getAllPartResources=getAllPartResources;__varRecorder__$A.loadPart=loadPart;__varRecorder__$A.loadPart=loadPart;__varRecorder__$A.savePart=savePart;__varRecorder__$A.savePart=savePart;__varRecorder__$A.interactivelySavePart=interactivelySavePart;__varRecorder__$A.interactivelySavePart=interactivelySavePart;__varRecorder__$A.interactivelyLoadObjectFromPartsBinFolder=interactivelyLoadObjectFromPartsBinFolder;__varRecorder__$A.interactivelyLoadObjectFromPartsBinFolder=interactivelyLoadObjectFromPartsBinFolder;__varRecorder__$A.interactivelySaveObjectToPartsBinFolder=interactivelySaveObjectToPartsBinFolder;__varRecorder__$A.interactivelySaveObjectToPartsBinFolder=interactivelySaveObjectToPartsBinFolder;__varRecorder__$A.saveObjectToPartsbinFolder=saveObjectToPartsbinFolder;__varRecorder__$A.saveObjectToPartsbinFolder=saveObjectToPartsbinFolder;__varRecorder__$A.loadObjectFromPartsbinFolder=loadObjectFromPartsbinFolder;__varRecorder__$A.loadObjectFromPartsbinFolder=loadObjectFromPartsbinFolder;var SnapshotEditor=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/partsbin.js");var __lively_class__=__lively_classholder__.hasOwnProperty("SnapshotEditor")&&typeof __lively_classholder__.SnapshotEditor==="function"?__lively_classholder__.SnapshotEditor:__lively_classholder__.SnapshotEditor=function SnapshotEditor(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function SnapshotEditor_initialize_(commit,snapshot,db){this.commit=commit;this.snapshot=snapshot;this._db=db;}},{key:"db",get:function get(){return this._db||__varRecorder__$A.MorphicDB["default"];}},{key:"saveModifiedSnapshot",value:function(){var _SnapshotEditor_saveModifiedSnapshot_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee102(newCommit,newSnapshot){var _newCommit,_id,name,type;return regeneratorRuntime.wrap(function _callee102$(_context102){while(1){switch(_context102.prev=_context102.next){case 0:_newCommit=newCommit,_id=_newCommit._id,name=_newCommit.name,type=_newCommit.type;if(_id){_context102.next=3;break;}throw new Error("No id of commit, cannot save!");case 3:_context102.next=5;return this.db.commit(type,name,newSnapshot,newCommit,undefined,_id);case 5:newCommit=_context102.sent;this.commit=newCommit;this.snapshot=newSnapshot;return _context102.abrupt("return",newCommit);case 9:case"end":return _context102.stop();}}},_callee102,this);}));function SnapshotEditor_saveModifiedSnapshot_(_x144,_x145){return _SnapshotEditor_saveModifiedSnapshot_.apply(this,arguments);}return SnapshotEditor_saveModifiedSnapshot_;}()},{key:"interactivelySaveModifiedSnapshot",value:function(){var _SnapshotEditor_interactivelySaveModifiedSnapshot_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee104(newCommit,newSnapshot){var _varRecorder__$A$pro,prom,resolve,reject,editor;return regeneratorRuntime.wrap(function _callee104$(_context104){while(1){switch(_context104.prev=_context104.next){case 0:_varRecorder__$A$pro=__varRecorder__$A.promise.deferred(),prom=_varRecorder__$A$pro.promise,resolve=_varRecorder__$A$pro.resolve,reject=_varRecorder__$A$pro.reject;editor=this;Object.assign(__varRecorder__$A.buildCommitEditor(),{commit:Object.assign({},this.commit,{},newCommit),cancel:function cancel(){(this.getWindow()||this).remove();reject("canceled");},accept:function accept(){var _this139=this;return _asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee103(){var _newCommit2;return regeneratorRuntime.wrap(function _callee103$(_context103){while(1){switch(_context103.prev=_context103.next){case 0:_context103.prev=0;_context103.next=3;return editor.saveModifiedSnapshot(_this139.commit,newSnapshot);case 3:_newCommit2=_context103.sent;(_this139.getWindow()||_this139).remove();resolve(_this139.commit=_newCommit2);_context103.next=12;break;case 8:_context103.prev=8;_context103.t0=_context103["catch"](0);_this139.showError(_context103.t0);reject(_context103.t0);case 12:case"end":return _context103.stop();}}},_callee103,null,[[0,8]]);}))();}}).openInWindow({title:"commit"});return _context104.abrupt("return",prom);case 4:case"end":return _context104.stop();}}},_callee104,this);}));function SnapshotEditor_interactivelySaveModifiedSnapshot_(_x146,_x147){return _SnapshotEditor_interactivelySaveModifiedSnapshot_.apply(this,arguments);}return SnapshotEditor_interactivelySaveModifiedSnapshot_;}()},{key:"interactivelyEditMetadata",value:function(){var _SnapshotEditor_interactivelyEditMetadata_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee105(onSave){var newCommit;return regeneratorRuntime.wrap(function _callee105$(_context105){while(1){switch(_context105.prev=_context105.next){case 0:_context105.next=2;return this.interactivelySaveModifiedSnapshot(this.commit,this.snapshot);case 2:newCommit=_context105.sent;typeof onSave==="function"&&onSave({commit:newCommit,snapshot:this.snapshot});return _context105.abrupt("return",newCommit);case 5:case"end":return _context105.stop();}}},_callee105,this);}));function SnapshotEditor_interactivelyEditMetadata_(_x148){return _SnapshotEditor_interactivelyEditMetadata_.apply(this,arguments);}return SnapshotEditor_interactivelyEditMetadata_;}()},{key:"interactivelyEditSnapshotJSON",value:function(){var _SnapshotEditor_interactivelyEditSnapshotJSON_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee108(onSave){var _this140=this;var commit,snapshot,_commit,_id,name,type,author,origContent,_yield$System$import3,TextEditor;return regeneratorRuntime.wrap(function _callee108$(_context108){while(1){switch(_context108.prev=_context108.next){case 0:commit=this.commit,snapshot=this.snapshot;_commit=commit,_id=_commit._id,name=_commit.name,type=_commit.type,author=_commit.author;_context108.next=4;return System["import"]("lively.ide/text-editor.js");case 4:_yield$System$import3=_context108.sent;TextEditor=_yield$System$import3["default"];TextEditor.openURL("<".concat(type,"/").concat(name,">"),{historyId:"object-serialization-debugger-editor",customSaveAction:function(){var _customSaveAction=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee106(ed){var snap,oldContent,really,newSnapshot,result;return regeneratorRuntime.wrap(function _callee106$(_context106){while(1){switch(_context106.prev=_context106.next){case 0:_context106.t0=snapshot;if(_context106.t0){_context106.next=5;break;}_context106.next=4;return _this140.db.fetchSnapshot(undefined,undefined,_id);case 4:_context106.t0=_context106.sent;case 5:snap=_context106.t0;oldContent=JSON.stringify(snap,null,2);if(!(oldContent!==origContent)){_context106.next=13;break;}_context106.next=10;return $world.confirm(["The content you are editing was changed in the mean time.\nDo you want to save anyway and overwrite those changes?",{fontWeight:"normal"}]);case 10:really=_context106.sent;if(really){_context106.next=13;break;}return _context106.abrupt("return",{saved:false,message:"canceled"});case 13:newSnapshot=JSON.parse(ed.ui.contentText.textString);_context106.next=16;return _this140.interactivelySaveModifiedSnapshot(_this140.commit,newSnapshot);case 16:commit=_context106.sent;snapshot=newSnapshot;origContent=ed.ui.contentText.textString;result={saved:true,snapshot:newSnapshot,commit:commit};if(typeof onSave==="function")onSave(result);return _context106.abrupt("return",result);case 22:case"end":return _context106.stop();}}},_callee106);}));function customSaveAction(_x150){return _customSaveAction.apply(this,arguments);}return customSaveAction;}(),customLoadContentAction:function(){var _customLoadContentAction=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee107(ed,url){var snap;return regeneratorRuntime.wrap(function _callee107$(_context107){while(1){switch(_context107.prev=_context107.next){case 0:_context107.t0=snapshot;if(_context107.t0){_context107.next=5;break;}_context107.next=4;return _this140.db.fetchSnapshot(undefined,undefined,_id);case 4:_context107.t0=_context107.sent;case 5:snap=_context107.t0;return _context107.abrupt("return",{content:origContent=JSON.stringify(snap,null,2),url:"".concat(type,"/").concat(name,".json")});case 7:case"end":return _context107.stop();}}},_callee107);}));function customLoadContentAction(_x151,_x152){return _customLoadContentAction.apply(this,arguments);}return customLoadContentAction;}()});case 7:case"end":return _context108.stop();}}},_callee108,this);}));function SnapshotEditor_interactivelyEditSnapshotJSON_(_x149){return _SnapshotEditor_interactivelyEditSnapshotJSON_.apply(this,arguments);}return SnapshotEditor_interactivelyEditSnapshotJSON_;}()},{key:"interactivelyEditPackageCode",value:function(){var _SnapshotEditor_interactivelyEditPackageCode_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee109(onSaveFn){var commit,snapshot,_id,author,name,type,snap,files,items,_yield$$world$filtera,_yield$$world$filtera2,file;return regeneratorRuntime.wrap(function _callee109$(_context109){while(1){switch(_context109.prev=_context109.next){case 0:commit=this.commit,snapshot=this.snapshot;_id=commit._id,author=commit.author,name=commit.name,type=commit.type;_context109.t0=snapshot;if(_context109.t0){_context109.next=7;break;}_context109.next=6;return this.db.fetchSnapshot(undefined,undefined,_id);case 6:_context109.t0=_context109.sent;case 7:snap=_context109.t0;files=new __varRecorder__$A.SnapshotPackageHelper(snap).filesInPackages();items=files.map(function(ea){return{isListItem:true,string:ea.url,value:ea};});_context109.next=12;return $world.filterableListPrompt("Select file to edit",items,{historyId:"object-serialization-debugger-hist"});case 12:_yield$$world$filtera=_context109.sent;_yield$$world$filtera2=_slicedToArray2(_yield$$world$filtera.selected,1);file=_yield$$world$filtera2[0];if(file){_context109.next=17;break;}return _context109.abrupt("return");case 17:return _context109.abrupt("return",this.interactivelyEditFileInSnapshotPackage(file,onSaveFn));case 18:case"end":return _context109.stop();}}},_callee109,this);}));function SnapshotEditor_interactivelyEditPackageCode_(_x153){return _SnapshotEditor_interactivelyEditPackageCode_.apply(this,arguments);}return SnapshotEditor_interactivelyEditPackageCode_;}()},{key:"interactivelyEditFileInSnapshotPackage",value:function(){var _SnapshotEditor_interactivelyEditFileInSnapshotPackage_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee111(file,onSaveFn,textPos){var _this141=this;var snapshot,_this$commit,_id,author,name,type,snap,origContent,_yield$System$import4,TextEditor,ed;return regeneratorRuntime.wrap(function _callee111$(_context111){while(1){switch(_context111.prev=_context111.next){case 0:snapshot=this.snapshot,_this$commit=this.commit,_id=_this$commit._id,author=_this$commit.author,name=_this$commit.name,type=_this$commit.type;_context111.t0=snapshot;if(_context111.t0){_context111.next=6;break;}_context111.next=5;return this.db.fetchSnapshot(undefined,undefined,_id);case 5:_context111.t0=_context111.sent;case 6:snap=_context111.t0;origContent=file.get(snap);_context111.next=10;return System["import"]("lively.ide/text-editor.js");case 10:_yield$System$import4=_context111.sent;TextEditor=_yield$System$import4["default"];ed=TextEditor.openURL("<".concat(type,"/").concat(name," - ").concat(file.path.slice(1).join("/"),">"),{historyId:"interactivelyEditFileInSnapshotPackage-hist",customSaveAction:function(){var _customSaveAction2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee110(ed){var oldContent,really,result;return regeneratorRuntime.wrap(function _callee110$(_context110){while(1){switch(_context110.prev=_context110.next){case 0:oldContent=file.get(snap);if(!(oldContent!==origContent)){_context110.next=7;break;}_context110.next=4;return $world.confirm(["The content you are editing was changed in the mean time.\nDo you want to save anyway and overwrite those changes?",{fontWeight:"normal"}]);case 4:really=_context110.sent;if(really){_context110.next=7;break;}return _context110.abrupt("return",{saved:false,message:"canceled"});case 7:file.set(snap,ed.ui.contentText.textString);_context110.next=10;return _this141.interactivelySaveModifiedSnapshot(_this141.commit,snap);case 10:_this141.commit=_context110.sent;result={commit:_this141.commit,snapshot:snap,saved:true};typeof onSaveFn==="function"&&onSaveFn(result);return _context110.abrupt("return",result);case 14:case"end":return _context110.stop();}}},_callee110);}));function customSaveAction(_x157){return _customSaveAction2.apply(this,arguments);}return customSaveAction;}(),customLoadContentAction:function customLoadContentAction(ed,url){return{content:file.get(snap),url:file.url};}});if(textPos)ed.whenRendered().then(function(){return ed.lineNumber=textPos.row;});return _context111.abrupt("return",ed);case 15:case"end":return _context111.stop();}}},_callee111,this);}));function SnapshotEditor_interactivelyEditFileInSnapshotPackage_(_x154,_x155,_x156){return _SnapshotEditor_interactivelyEditFileInSnapshotPackage_.apply(this,arguments);}return SnapshotEditor_interactivelyEditFileInSnapshotPackage_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"SnapshotEditor";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"partsbin.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:9578,end:14797});}(undefined);__varRecorder__$A.SnapshotEditor=SnapshotEditor;__varRecorder__$A.SnapshotEditor=SnapshotEditor;__varRecorder__$A.SnapshotEditor=SnapshotEditor;__varRecorder__$A.partURLRe=/^part:\/\/([^\/]+)\/(.*)$/;var PartResource=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/partsbin.js");var __lively_class__=__lively_classholder__.hasOwnProperty("PartResource")&&typeof __lively_classholder__.PartResource==="function"?__lively_classholder__.PartResource:__lively_classholder__.PartResource=function PartResource(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"canDealWithJSON",get:function get(){return false;}},{key:"dirList",value:function(){var _PartResource_dirList_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee112(depth,opts){return regeneratorRuntime.wrap(function _callee112$(_context112){while(1){switch(_context112.prev=_context112.next){case 0:_context112.next=2;return __varRecorder__$A.resource(this.url.replace("part://","styleguide://")).dirList(depth,opts);case 2:return _context112.abrupt("return",_context112.sent);case 3:case"end":return _context112.stop();}}},_callee112,this);}));function PartResource_dirList_(_x158,_x159){return _PartResource_dirList_.apply(this,arguments);}return PartResource_dirList_;}()},{key:"write",value:function(){var _PartResource_write_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee113(source){return regeneratorRuntime.wrap(function _callee113$(_context113){while(1){switch(_context113.prev=_context113.next){case 0:throw Error("Part urls are ready only! Please go to the world they are defined in and change the exported component directly.");case 1:case"end":return _context113.stop();}}},_callee113);}));function PartResource_write_(_x160){return _PartResource_write_.apply(this,arguments);}return PartResource_write_;}()},{key:"read",value:function(){var _PartResource_read_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee114(){var masterComponent,part,superMaster,_iterator71,_step71,subMaster;return regeneratorRuntime.wrap(function _callee114$(_context114){while(1){switch(_context114.prev=_context114.next){case 0:_context114.next=2;return __varRecorder__$A.resource(this.url.replace("part://","styleguide://")).read();case 2:masterComponent=_context114.sent;if(!masterComponent.master){_context114.next=6;break;}_context114.next=6;return masterComponent.master.whenReady();case 6:part=masterComponent.copy();part.isComponent=false;part.name="a"+__varRecorder__$A.getClassName(part);part.withAllSubmorphsDoExcluding(function(m){if(m==part||!m.master){delete m._parametrizedProps;}},function(m){return m.master&&m!=part;});superMaster=part.master;part.master=masterComponent;if(!part._pool.mastersInSubHierarchy){_context114.next=33;break;}_iterator71=_createForOfIteratorHelper(part._pool.mastersInSubHierarchy);_context114.prev=14;_iterator71.s();case 16:if((_step71=_iterator71.n()).done){_context114.next=25;break;}subMaster=_step71.value;if(!(superMaster==subMaster)){_context114.next=20;break;}return _context114.abrupt("continue",23);case 20:_context114.next=22;return subMaster.applyIfNeeded(true);case 22:if(!subMaster.derivedMorph.ownerChain().includes(part)){subMaster.derivedMorph.requestMasterStyling();}case 23:_context114.next=16;break;case 25:_context114.next=30;break;case 27:_context114.prev=27;_context114.t0=_context114["catch"](14);_iterator71.e(_context114.t0);case 30:_context114.prev=30;_iterator71.f();return _context114.finish(30);case 33:part.master.applyIfNeeded(true);delete part._pool;part.withAllSubmorphsDo(function(m){if(typeof m.onLoad==="function")m.onLoad();});return _context114.abrupt("return",part);case 37:case"end":return _context114.stop();}}},_callee114,this,[[14,27,30,33]]);}));function PartResource_read_(){return _PartResource_read_.apply(this,arguments);}return PartResource_read_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"PartResource";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"partsbin.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:14847,end:16621});}(__varRecorder__$A.Resource);var resourceExtension$4={name:"part",matches:function matches(url){return url.match(__varRecorder__$A.partURLRe);},resourceClass:__varRecorder__$A.PartResource};__varRecorder__$A.resourceExtension=resourceExtension$4;__varRecorder__$A.resourceExtension=resourceExtension$4;__varRecorder__$A.resourceExtension=resourceExtension$4;__varRecorder__$A.registerExtension(__varRecorder__$A.resourceExtension);__varRecorder__$A.buildCommitEditor=buildCommitEditor;__varRecorder__$A.buildCommitEditor=buildCommitEditor;var __varRecorder__$B=lively.FreezerRuntime.recorderFor("lively.morphic/world-loading.js");function loadWorldFromURL(_x161,_x162,_x163){return _loadWorldFromURL.apply(this,arguments);}function _loadWorldFromURL(){_loadWorldFromURL=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee226(url,oldWorld,options){var worldResource,name;return regeneratorRuntime.wrap(function _callee226$(_context226){while(1){switch(_context226.prev=_context226.next){case 0:worldResource=url.isResource?url:__varRecorder__$B.resource(System.decanonicalize(url));name=worldResource.nameWithoutExt();return _context226.abrupt("return",__varRecorder__$B.loadWorldFromDB(name,undefined,oldWorld,options));case 3:case"end":return _context226.stop();}}},_callee226);}));return _loadWorldFromURL.apply(this,arguments);}__varRecorder__$B.loadWorldFromURL=loadWorldFromURL;function loadWorldFromCommit(_x164,_x165,_x166){return _loadWorldFromCommit.apply(this,arguments);}function _loadWorldFromCommit(){_loadWorldFromCommit=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee227(commitOrId,oldWorld,options){var db,newWorld,queryString;return regeneratorRuntime.wrap(function _callee227$(_context227){while(1){switch(_context227.prev=_context227.next){case 0:db=__varRecorder__$B.MorphicDB["default"];_context227.next=3;return db.load("world",undefined,options,commitOrId);case 3:newWorld=_context227.sent;queryString=typeof document!=="undefined"?document.location.search:"";options=Object.assign({pathForBrowserHistory:__varRecorder__$B.pathForBrowserHistory(newWorld.name,queryString)},options);return _context227.abrupt("return",__varRecorder__$B.loadWorld(newWorld,oldWorld,options));case 7:case"end":return _context227.stop();}}},_callee227);}));return _loadWorldFromCommit.apply(this,arguments);}__varRecorder__$B.loadWorldFromCommit=loadWorldFromCommit;function loadWorldFromDB(_x167,_x168,_x169,_x170){return _loadWorldFromDB.apply(this,arguments);}function _loadWorldFromDB(){_loadWorldFromDB=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee228(name,ref,oldWorld,options){var db,newWorld,queryString;return regeneratorRuntime.wrap(function _callee228$(_context228){while(1){switch(_context228.prev=_context228.next){case 0:db=__varRecorder__$B.MorphicDB["default"];_context228.next=3;return db.load("world",name,options,undefined,ref||undefined);case 3:newWorld=_context228.sent;queryString=typeof document!=="undefined"?document.location.search:"";options=Object.assign({pathForBrowserHistory:__varRecorder__$B.pathForBrowserHistory(name,queryString)},options);return _context228.abrupt("return",__varRecorder__$B.loadWorld(newWorld,oldWorld,options));case 7:case"end":return _context228.stop();}}},_callee228);}));return _loadWorldFromDB.apply(this,arguments);}__varRecorder__$B.loadWorldFromDB=loadWorldFromDB;function loadWorld(_x171,_x172){return _loadWorld.apply(this,arguments);}function _loadWorld(){_loadWorld=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee229(newWorld,oldWorld){var options,env,root,_options$verbose,verbose,_options$localconfig,localconfig,_options$l2l,l2l,_options$shell,shell,_options$worldLoadDia,worldLoadDialog,_options$initializeGl,initializeGlobalStyleSheets,_options$showUserFlap,showUserFlap,doc,nativeLoadingIndicator,l2lClient,_args230=arguments;return regeneratorRuntime.wrap(function _callee229$(_context229){while(1){switch(_context229.prev=_context229.next){case 0:options=_args230.length>2&&_args230[2]!==undefined?_args230[2]:{};env=options.env,root=options.root,_options$verbose=options.verbose,verbose=_options$verbose===void 0?true:_options$verbose,_options$localconfig=options.localconfig,localconfig=_options$localconfig===void 0?true:_options$localconfig,_options$l2l=options.l2l,l2l=_options$l2l===void 0?true:_options$l2l,_options$shell=options.shell,shell=_options$shell===void 0?true:_options$shell,_options$worldLoadDia=options.worldLoadDialog,worldLoadDialog=_options$worldLoadDia===void 0?false:_options$worldLoadDia,_options$initializeGl=options.initializeGlobalStyleSheets,initializeGlobalStyleSheets=_options$initializeGl===void 0?true:_options$initializeGl,_options$showUserFlap=options.showUserFlap,showUserFlap=_options$showUserFlap===void 0?typeof newWorld.showsUserFlap==="undefined"?true:newWorld.showsUserFlap:_options$showUserFlap;env=env||(oldWorld?oldWorld.env:__varRecorder__$B.MorphicEnv["default"]());doc=env.domEnv.document||document;nativeLoadingIndicator=doc.getElementById("dom-loading-indicator");_context229.prev=5;_context229.t0=l2l;if(!_context229.t0){_context229.next=11;break;}_context229.next=10;return __varRecorder__$B.setupLively2Lively(newWorld);case 10:_context229.t0=_context229.sent;case 11:l2lClient=_context229.t0;if(!(l2lClient&&shell)){_context229.next=15;break;}_context229.next=15;return __varRecorder__$B.setupLivelyShell({l2lClient:l2lClient});case 15:if(verbose&&nativeLoadingIndicator)nativeLoadingIndicator.style.display="";_context229.t1=localconfig;if(!_context229.t1){_context229.next=20;break;}_context229.next=20;return __varRecorder__$B.loadLocalConfig();case 20:_context229.next=22;return env.setWorld(newWorld);case 22:worldLoadDialog&&newWorld.execCommand("load world");if(options.pathForBrowserHistory){window.history.pushState({},"lively.next",options.pathForBrowserHistory);}newWorld.showsUserFlap=showUserFlap;if(oldWorld){oldWorld.onUnload();}__varRecorder__$B.emit("world/loaded",newWorld);return _context229.abrupt("return",newWorld);case 30:_context229.prev=30;_context229.t2=_context229["catch"](5);console.error("Error loading world: ",_context229.t2);if(!oldWorld){_context229.next=37;break;}_context229.next=36;return env.setWorld(oldWorld);case 36:oldWorld.showError(_context229.t2);case 37:throw _context229.t2;case 38:_context229.prev=38;if(nativeLoadingIndicator)nativeLoadingIndicator.style.display="none";return _context229.finish(38);case 41:case"end":return _context229.stop();}}},_callee229,null,[[5,30,38,41]]);}));return _loadWorld.apply(this,arguments);}__varRecorder__$B.loadWorld=loadWorld;function loadLocalConfig(){return _loadLocalConfig.apply(this,arguments);}function _loadLocalConfig(){_loadLocalConfig=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee230(){var localconfig;return regeneratorRuntime.wrap(function _callee230$(_context230){while(1){switch(_context230.prev=_context230.next){case 0:localconfig=lively.modules.module("localconfig.js");_context230.prev=1;_context230.next=4;return __varRecorder__$B.resource(localconfig.id).exists();case 4:if(!_context230.sent){_context230.next=7;break;}_context230.next=7;return localconfig.reload({resetEnv:false,reloadDeps:false});case 7:_context230.next=13;break;case 9:_context230.prev=9;_context230.t0=_context230["catch"](1);console.error("Error loading localconfig:",_context230.t0);if(typeof $world!=="undefined"){$world.showError("Error loading localconfig.js: ".concat(_context230.t0));}case 13:case"end":return _context230.stop();}}},_callee230,null,[[1,9]]);}));return _loadLocalConfig.apply(this,arguments);}__varRecorder__$B.loadLocalConfig=loadLocalConfig;function setupLivelyShell(_x173){return _setupLivelyShell.apply(this,arguments);}function _setupLivelyShell(){_setupLivelyShell=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee231(opts){var _yield$System$import17,ClientCommand,_yield$System$import18,resourceExtension,l2lClient;return regeneratorRuntime.wrap(function _callee231$(_context231){while(1){switch(_context231.prev=_context231.next){case 0:_context231.next=2;return lively.modules.importPackage("lively.shell");case 2:_context231.next=4;return System["import"]("lively.shell/client-command.js");case 4:_yield$System$import17=_context231.sent;ClientCommand=_yield$System$import17["default"];_context231.next=8;return System["import"]("lively.shell/client-resource.js");case 8:_yield$System$import18=_context231.sent;resourceExtension=_yield$System$import18.resourceExtension;l2lClient=opts.l2lClient;ClientCommand.installLively2LivelyServices(l2lClient);resourceExtension.resourceClass.defaultL2lClient=l2lClient;__varRecorder__$B.registerResourceExension(resourceExtension);console.log("[lively] lively.shell setup");case 15:case"end":return _context231.stop();}}},_callee231);}));return _setupLivelyShell.apply(this,arguments);}__varRecorder__$B.setupLivelyShell=setupLivelyShell;function setupLively2Lively(_x174){return _setupLively2Lively.apply(this,arguments);}function _setupLively2Lively(){_setupLively2Lively=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee232(world){var user,info,_yield$System$import19,L2LClient,client;return regeneratorRuntime.wrap(function _callee232$(_context232){while(1){switch(_context232.prev=_context232.next){case 0:user=world.getCurrentUser();info={world:world.name};if(user){info.userToken=user.token;info.userRealm=user.realm;}_context232.next=5;return lively.modules.importPackage("lively.2lively");case 5:_context232.next=7;return System["import"]("lively.2lively/client.js");case 7:_yield$System$import19=_context232.sent;L2LClient=_yield$System$import19["default"];_context232.next=11;return L2LClient.forLivelyInBrowser(info);case 11:client=_context232.sent;console.log("[lively] lively2lively client created ".concat(client));if(!client._onUserChange){client._onUserChange=function(evt){if(client.isOnline()&&evt.user){var _evt$user=evt.user,userToken=_evt$user.token,userRealm=_evt$user.realm;client.info=Object.assign({},client.info,{userToken:userToken,userRealm:userRealm});client.unregister().then(function(){return client.register();}).then(function(){return console.log("re-registered after user change");});}};__varRecorder__$B.subscribe("lively.user/userchanged",client._onUserChange,System);client.once("registered",function(){__varRecorder__$B.reportWorldLoad(world,user);});client.on("registered",function(){var flap=world.get("user flap");flap&&flap.updateNetworkIndicator(client);});client.on("connected",function(){var flap=world.get("user flap");flap&&flap.updateNetworkIndicator(client);});client.on("reconnecting",function(){var flap=world.get("user flap");flap&&flap.updateNetworkIndicator(client);});client.on("disconnected",function(){var flap=world.get("user flap");flap&&flap.updateNetworkIndicator(client);});}else __varRecorder__$B.reportWorldLoad(world,user);return _context232.abrupt("return",client);case 15:case"end":return _context232.stop();}}},_callee232);}));return _setupLively2Lively.apply(this,arguments);}__varRecorder__$B.setupLively2Lively=setupLively2Lively;function interactivelySaveWorld(_x175,_x176){return _interactivelySaveWorld.apply(this,arguments);}function _interactivelySaveWorld(){_interactivelySaveWorld=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee233(world,options){var name,tags,description,oldCommit,db,jsonStoragePath,mode,dialog,_yield$world$openProm2,commit,dialogDB,storageMode,filePath,_ref159,i,resourceHandle,proceed,snap,snapshotOptions,ref,oldName,expectedParentCommit,_yield$db$exists,_exists5,existingCommitId,overwrite,commitSpec,_commit3,_path2,_ref160,_ref161,_10,typeAndName,expectedVersion,actualVersion,_yield$db$log,_yield$db$log2,newerCommit,_overwrite3,authorName,timestamp,overwriteQ;return regeneratorRuntime.wrap(function _callee233$(_context233){while(1){switch(_context233.prev=_context233.next){case 0:options=Object.assign({showSaveDialog:true,useExpectedCommit:true,errorOnMissingExpectedCommit:false,confirmOverwrite:true},options);name=world.name;tags=[];description="";_context233.next=6;return __varRecorder__$B.ensureCommitInfo(__varRecorder__$B.Path("metadata.commit").get(world));case 6:oldCommit=_context233.sent;db=options.morphicdb||__varRecorder__$B.MorphicDB["default"];jsonStoragePath="";mode="db";if(!options.showSaveDialog){_context233.next=32;break;}_context233.next=13;return __varRecorder__$B.resource("part://SystemDialogs/save world dialog").read();case 13:dialog=_context233.sent;_context233.next=16;return world.openPrompt(dialog,{targetWorld:world});case 16:_yield$world$openProm2=_context233.sent;commit=_yield$world$openProm2.commit;dialogDB=_yield$world$openProm2.db;storageMode=_yield$world$openProm2.mode;filePath=_yield$world$openProm2.filePath;if(dialogDB)db=dialogDB;mode=storageMode;jsonStoragePath=filePath;_ref159=commit||{};name=_ref159.name;tags=_ref159.tags;description=_ref159.description;if(name){_context233.next=30;break;}return _context233.abrupt("return",null);case 30:_context233.next=33;break;case 32:if(oldCommit){name=oldCommit.name;tags=oldCommit.tags;description=oldCommit.description;}case 33:i=$world.execCommand("open loading indicator","saving ".concat(name,"..."));_context233.next=36;return __varRecorder__$B.promise.delay(80);case 36:if(!(mode=="json")){_context233.next=72;break;}resourceHandle=__varRecorder__$B.resource(System.baseURL).join(jsonStoragePath).withRelativePartsResolved();_context233.next=40;return resourceHandle.exists();case 40:if(!_context233.sent){_context233.next=51;break;}i.visible=false;_context233.next=44;return $world.confirm(["File Conflict\n",{},"The file you want to save the world to\n",{fontSize:15,fontWeight:"normal"},resourceHandle.url,{textStyle:"italic",fontSize:15,fontWeight:"normal"},"\n already exists. Overwrite?",{fontSize:15,fontWeight:"normal"}],{lineWrapping:false});case 44:proceed=_context233.sent;if(proceed){_context233.next=48;break;}i.remove();return _context233.abrupt("return");case 48:i.visible=true;_context233.next=53;break;case 51:_context233.next=53;return resourceHandle.ensureExistance();case 53:world.changeMetaData("file",jsonStoragePath,false,false);_context233.next=56;return __varRecorder__$B.createMorphSnapshot(world);case 56:snap=_context233.sent;_context233.next=59;return resourceHandle.writeJson(snap);case 59:_context233.t0=__varRecorder__$B;_context233.next=62;return __varRecorder__$B.defaultDirectory(__varRecorder__$B.ShellClientResource.defaultL2lClient);case 62:_context233.t1=_context233.sent;_context233.t2=_context233.t1+"/..";_context233.t3=jsonStoragePath.replace(".json",".br.json");_context233.t4=JSON.stringify(snap);_context233.next=68;return _context233.t0.resource.call(_context233.t0,_context233.t2).join(_context233.t3).withRelativePartsResolved().brotli(_context233.t4);case 68:__varRecorder__$B.resource(System.baseURL).join("/subserver/ComponentsBrowser/refresh").join(name).read();i.remove();world.setStatusMessage("saved world ".concat(name," to file: ").concat(resourceHandle.url));return _context233.abrupt("return");case 72:_context233.prev=72;snapshotOptions={previewWidth:200,previewHeight:200,previewType:"png",ignoreMorphs:[i]};ref="HEAD";oldName=oldCommit?oldCommit.name:world.name;if(!options.useExpectedCommit){_context233.next=94;break;}if(!(oldName!==name&&options.confirmOverwrite)){_context233.next=93;break;}_context233.next=80;return db.exists("world",name);case 80:_yield$db$exists=_context233.sent;_exists5=_yield$db$exists.exists;existingCommitId=_yield$db$exists.commitId;if(!_exists5){_context233.next=90;break;}_context233.next=86;return world.confirm("A world \"".concat(name,"\" already exists, overwrite?"),{styleClasses:["Halo"],fill:__varRecorder__$B.Color.rgba(0,0,0,0.8)});case 86:overwrite=_context233.sent;if(overwrite){_context233.next=89;break;}return _context233.abrupt("return",null);case 89:expectedParentCommit=existingCommitId;case 90:world.name=name;_context233.next=94;break;case 93:expectedParentCommit=oldCommit?oldCommit._id:undefined;case 94:commitSpec={author:world.getCurrentUser(),message:"world save",tags:tags,description:description};_context233.next=97;return db.snapshotAndCommit("world",name,world,snapshotOptions,commitSpec,ref,expectedParentCommit);case 97:_commit3=_context233.sent;if(window.history){_path2=__varRecorder__$B.pathForBrowserHistory(name);window.history.pushState({},"lively.next",_path2);}__varRecorder__$B.resource(System.baseURL).join("/subserver/ComponentsBrowser/refresh").join(name).read();world.setStatusMessage("saved world ".concat(name));world.get("world-list")&&world.get("world-list").onWorldSaved(name);return _context233.abrupt("return",_commit3);case 105:_context233.prev=105;_context233.t5=_context233["catch"](72);if(!(_context233.t5.message.includes("but no version entry exists")&&!options.errorOnMissingExpectedCommit)){_context233.next=109;break;}return _context233.abrupt("return",interactivelySaveWorld(world,Object.assign({},options,{morphicdb:db,useExpectedCommit:false,showSaveDialog:false})));case 109:_ref160=_context233.t5.message.match(/Trying to store "([^\"]+)" on top of expected version ([^\s]+) but ref HEAD is of version ([^\s\!]+)/)||[],_ref161=_slicedToArray2(_ref160,4),_10=_ref161[0],typeAndName=_ref161[1],expectedVersion=_ref161[2],actualVersion=_ref161[3];if(!(expectedVersion&&actualVersion)){_context233.next=127;break;}_context233.next=113;return db.log(actualVersion,1,true);case 113:_yield$db$log=_context233.sent;_yield$db$log2=_slicedToArray2(_yield$db$log,1);newerCommit=_yield$db$log2[0];_overwrite3=true;if(!options.confirmOverwrite){_context233.next=123;break;}authorName=newerCommit.author.name,timestamp=newerCommit.timestamp;overwriteQ="The current version of world ".concat(name," is not the most recent!\n")+"A newer version by ".concat(authorName," was saved on ")+"".concat(__varRecorder__$B.date.format(new Date(timestamp),"yyyy-mm-dd HH:MM"),". Overwrite?");_context233.next=122;return world.confirm(["Version Conflict\n",null,overwriteQ,{fontSize:16,fontWeight:"normal"}],{width:600});case 122:_overwrite3=_context233.sent;case 123:if(_overwrite3){_context233.next=125;break;}return _context233.abrupt("return",null);case 125:world.changeMetaData("commit",__varRecorder__$B.obj.dissoc(newerCommit,["preview"]),true,false);return _context233.abrupt("return",interactivelySaveWorld(world,Object.assign({},options,{morphicdb:db,showSaveDialog:false})));case 127:console.error(_context233.t5);world.logError("Error saving world: "+_context233.t5);case 129:_context233.prev=129;i.remove();return _context233.finish(129);case 132:case"end":return _context233.stop();}}},_callee233,null,[[72,105,129,132]]);}));return _interactivelySaveWorld.apply(this,arguments);}__varRecorder__$B.interactivelySaveWorld=interactivelySaveWorld;function reportWorldLoad(world,user){var userId=user?"".concat(user.name," (").concat((user.token||"").slice(0,5),")"):"---";fetch("/report-world-load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"".concat(userId," logged in at ").concat(world.name," [").concat(window._livelyLoadId,"]")})})["catch"](function(err){return console.warn("report-world-load failed: ".concat(err));});}__varRecorder__$B.reportWorldLoad=reportWorldLoad;__varRecorder__$B.resource=resource;__varRecorder__$B.registerResourceExension=registerExtension;__varRecorder__$B.Color=Color$1;__varRecorder__$B.Path=Path;__varRecorder__$B.obj=obj;__varRecorder__$B.date=date;__varRecorder__$B.promise=promise;__varRecorder__$B.MorphicEnv=MorphicEnv;__varRecorder__$B.createMorphSnapshot=createMorphSnapshot;__varRecorder__$B.MorphicDB=MorphicDB$1;__varRecorder__$B.ensureCommitInfo=ensureCommitInfo;__varRecorder__$B.pathForBrowserHistory=pathForBrowserHistory;__varRecorder__$B.subscribe=subscribe;__varRecorder__$B.emit=emit$1;__varRecorder__$B.defaultDirectory=_missingExportShim;__varRecorder__$B.ShellClientResource=ShellClientResource;__varRecorder__$B.loadWorldFromURL=loadWorldFromURL;__varRecorder__$B.loadWorldFromURL=loadWorldFromURL;__varRecorder__$B.loadWorldFromCommit=loadWorldFromCommit;__varRecorder__$B.loadWorldFromCommit=loadWorldFromCommit;__varRecorder__$B.loadWorldFromDB=loadWorldFromDB;__varRecorder__$B.loadWorldFromDB=loadWorldFromDB;__varRecorder__$B.loadWorld=loadWorld;__varRecorder__$B.loadWorld=loadWorld;__varRecorder__$B.interactivelySaveWorld=interactivelySaveWorld;__varRecorder__$B.interactivelySaveWorld=interactivelySaveWorld;var __varRecorder__$C=lively.FreezerRuntime.recorderFor("lively.user/client/user.js");function jwtTokenDecode(token){var _token$split=token.split("."),_token$split2=_slicedToArray2(_token$split,3),a=_token$split2[0],b=_token$split2[1],c=_token$split2[2];return JSON.parse(atob(b));}__varRecorder__$C.jwtTokenDecode=jwtTokenDecode;function guid(){var s4=function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);};return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4();}__varRecorder__$C.guid=guid;function makeRequest$1(url){var method=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"GET";var body=arguments.length>2?arguments[2]:undefined;var headers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var fetchOpts={method:method};fetchOpts.mode="cors";if(body)fetchOpts.body=body;fetchOpts.redirect="follow";fetchOpts.headers=Object.assign({},headers);return fetch(url,fetchOpts);}__varRecorder__$C.makeRequest=makeRequest$1;function POST(_x177,_x178){return _POST.apply(this,arguments);}function _POST(){_POST=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee234(url,body){var res,text,json;return regeneratorRuntime.wrap(function _callee234$(_context234){while(1){switch(_context234.prev=_context234.next){case 0:if(typeof body!=="string")body=JSON.stringify(body);_context234.next=3;return __varRecorder__$C.makeRequest(url,"POST",body,{});case 3:res=_context234.sent;_context234.prev=4;_context234.next=7;return res.text();case 7:text=_context234.sent;_context234.next=12;break;case 10:_context234.prev=10;_context234.t0=_context234["catch"](4);case 12:if(text&&res.headers.get("content-type")==="application/json"){try{json=JSON.parse(text);}catch(err){}}if(json){_context234.next=15;break;}throw new Error("Unexpected response: "+text);case 15:return _context234.abrupt("return",json);case 16:case"end":return _context234.stop();}}},_callee234,null,[[4,10]]);}));return _POST.apply(this,arguments);}__varRecorder__$C.POST=POST;var User=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.user/client/user.js");var __lively_class__=__lively_classholder__.hasOwnProperty("User")&&typeof __lively_classholder__.User==="function"?__lively_classholder__.User:__lively_classholder__.User=function User(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function User_initialize_(name,url){this.realm=url;this.name=name;this.roles={};this.createdAt=0;this.email=null;this.token=null;}},{key:"isLoggedIn",value:function User_isLoggedIn_(){return!!this.token;}},{key:"loginOrRegister",value:function(){var _User_loginOrRegister_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee115(action,password,authServerURL){var email,createdAt,roles,name,payload,answer,token,_varRecorder__$C$jwt;return regeneratorRuntime.wrap(function _callee115$(_context115){while(1){switch(_context115.prev=_context115.next){case 0:email=this.email;createdAt=this.createdAt;roles=this.roles;name=this.name;payload=action==="register"?{password:password,email:email,createdAt:createdAt,roles:roles,name:name}:{password:password,name:name};_context115.next=7;return __varRecorder__$C.POST(authServerURL+"/"+action,payload);case 7:answer=_context115.sent;if(!answer.error){_context115.next=10;break;}return _context115.abrupt("return",answer);case 10:token=answer.token,_varRecorder__$C$jwt=__varRecorder__$C.jwtTokenDecode(token),roles=_varRecorder__$C$jwt.roles,createdAt=_varRecorder__$C$jwt.createdAt,email=_varRecorder__$C$jwt.email;Object.assign(this,{roles:roles,createdAt:createdAt,email:email,token:token});return _context115.abrupt("return",{status:answer.status});case 13:case"end":return _context115.stop();}}},_callee115,this);}));function User_loginOrRegister_(_x179,_x180,_x181){return _User_loginOrRegister_.apply(this,arguments);}return User_loginOrRegister_;}()},{key:"verify",value:function(){var _User_verify_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee116(){var _yield$__varRecorder_,error,status;return regeneratorRuntime.wrap(function _callee116$(_context116){while(1){switch(_context116.prev=_context116.next){case 0:_context116.next=2;return __varRecorder__$C.POST(this.realm+"/verify",{token:this.token});case 2:_yield$__varRecorder_=_context116.sent;error=_yield$__varRecorder_.error;status=_yield$__varRecorder_.status;return _context116.abrupt("return",error?false:true);case 6:case"end":return _context116.stop();}}},_callee116,this);}));function User_verify_(){return _User_verify_.apply(this,arguments);}return User_verify_;}()},{key:"login",value:function User_login_(password){return this.loginOrRegister("login",password,this.realm);}},{key:"register",value:function User_register_(password){return this.loginOrRegister("register",password,this.realm);}},{key:"checkPassword",value:function(){var _User_checkPassword_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee117(password){var _yield$__varRecorder_2,error,status;return regeneratorRuntime.wrap(function _callee117$(_context117){while(1){switch(_context117.prev=_context117.next){case 0:if(this.isLoggedIn){_context117.next=2;break;}throw new Error("To check password, user needs to login.");case 2:_context117.next=4;return __varRecorder__$C.POST(this.realm+"/check-password",{token:this.token,password:password});case 4:_yield$__varRecorder_2=_context117.sent;error=_yield$__varRecorder_2.error;status=_yield$__varRecorder_2.status;if(!error){_context117.next=9;break;}throw new Error(error);case 9:return _context117.abrupt("return",status);case 10:case"end":return _context117.stop();}}},_callee117,this);}));function User_checkPassword_(_x182){return _User_checkPassword_.apply(this,arguments);}return User_checkPassword_;}()},{key:"modify",value:function(){var _User_modify_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee118(changes){var _yield$__varRecorder_3,error,status,token,_varRecorder__$C$jwt2,name,roles,createdAt,email;return regeneratorRuntime.wrap(function _callee118$(_context118){while(1){switch(_context118.prev=_context118.next){case 0:_context118.next=2;return __varRecorder__$C.POST(this.realm+"/modify",{token:this.token,changes:changes});case 2:_yield$__varRecorder_3=_context118.sent;error=_yield$__varRecorder_3.error;status=_yield$__varRecorder_3.status;token=_yield$__varRecorder_3.token;if(!error){_context118.next=8;break;}return _context118.abrupt("return",{error:error});case 8:if(token){_varRecorder__$C$jwt2=__varRecorder__$C.jwtTokenDecode(token),name=_varRecorder__$C$jwt2.name,roles=_varRecorder__$C$jwt2.roles,createdAt=_varRecorder__$C$jwt2.createdAt,email=_varRecorder__$C$jwt2.email;Object.assign(this,{roles:roles,createdAt:createdAt,email:email,token:token});}return _context118.abrupt("return",{status:status});case 10:case"end":return _context118.stop();}}},_callee118,this);}));function User_modify_(_x183){return _User_modify_.apply(this,arguments);}return User_modify_;}()},{key:"toString",value:function User_toString_(){return"<".concat(this.constructor.name," ").concat(this.name," ").concat(this.isLoggedIn()?"":"not ","logged in>");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"User";}},{key:"guest",get:function get(){return __varRecorder__$C.guestUser;}},{key:"named",value:function User_named_(name,url){var key=name+"-"+url,user=__varRecorder__$C.userMap.get(key);if(!user){user=new this(name,url);__varRecorder__$C.userMap.set(key,user);}return user;}},{key:"fromToken",value:function User_fromToken_(token,url){var _varRecorder__$C$jwt3=__varRecorder__$C.jwtTokenDecode(token),name=_varRecorder__$C$jwt3.name,roles=_varRecorder__$C$jwt3.roles,createdAt=_varRecorder__$C$jwt3.createdAt,email=_varRecorder__$C$jwt3.email;return Object.assign(this.named(name,url),{roles:roles,createdAt:createdAt,email:email,token:token});}},{key:"clearCache",value:function User_clearCache_(){__varRecorder__$C.userMap=new Map();}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"client/user.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.user",version:"0.2.0"};}},{start:1032,end:3466});}(undefined);__varRecorder__$C.User=User;__varRecorder__$C.User=User;__varRecorder__$C.User=User;var GuestUser=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.user/client/user.js");var __lively_class__=__lively_classholder__.hasOwnProperty("GuestUser")&&typeof __lively_classholder__.GuestUser==="function"?__lively_classholder__.GuestUser:__lively_classholder__.GuestUser=function GuestUser(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"isGuestUser",get:function get(){return true;}},{key:"isLoggedIn",value:function GuestUser_isLoggedIn_(){return false;}},{key:"loginOrRegister",value:function(){var _GuestUser_loginOrRegister_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee119(action,password,authServerURL){return regeneratorRuntime.wrap(function _callee119$(_context119){while(1){switch(_context119.prev=_context119.next){case 0:throw new Error("Guest user cannot "+action+"!");case 1:case"end":return _context119.stop();}}},_callee119);}));function GuestUser_loginOrRegister_(_x184,_x185,_x186){return _GuestUser_loginOrRegister_.apply(this,arguments);}return GuestUser_loginOrRegister_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"GuestUser";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"client/user.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.user",version:"0.2.0"};}},{start:3476,end:3702});}(__varRecorder__$C.User);__varRecorder__$C.GuestUser=GuestUser;__varRecorder__$C.GuestUser=GuestUser;__varRecorder__$C.GuestUser=GuestUser;__varRecorder__$C.userMap=__varRecorder__$C.userMap||new Map();__varRecorder__$C.guestUser=__varRecorder__$C.guestUser||__varRecorder__$C.GuestUser.named("guest-"+__varRecorder__$C.guid(),null);var __varRecorder__$D=lively.FreezerRuntime.recorderFor("lively.user/client/user-registry.js");__varRecorder__$D.User=User;__varRecorder__$D.GuestUser=GuestUser;__varRecorder__$D.emit=emit$1;var UserRegistry=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.user/client/user-registry.js");var __lively_class__=__lively_classholder__.hasOwnProperty("UserRegistry")&&typeof __lively_classholder__.UserRegistry==="function"?__lively_classholder__.UserRegistry:__lively_classholder__.UserRegistry=function UserRegistry(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"isTrackingGuestUsers",get:function get(){return false;}},{key:"hasUserStored",value:function UserRegistry_hasUserStored_(){try{return!!localStorage["lively.user"]||!!sessionStorage["lively.user"];}catch(err){return false;}}},{key:"login",value:function(){var _UserRegistry_login_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee120(user,password){var _yield$user$login,error;return regeneratorRuntime.wrap(function _callee120$(_context120){while(1){switch(_context120.prev=_context120.next){case 0:if(user.isGuestUser){_context120.next=7;break;}_context120.next=3;return user.login(password);case 3:_yield$user$login=_context120.sent;error=_yield$user$login.error;if(!error){_context120.next=7;break;}throw Error(error);case 7:this.saveUserToLocalStorage(user);return _context120.abrupt("return",user);case 9:case"end":return _context120.stop();}}},_callee120,this);}));function UserRegistry_login_(_x187,_x188){return _UserRegistry_login_.apply(this,arguments);}return UserRegistry_login_;}()},{key:"logout",value:function(){var _UserRegistry_logout_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee121(user){return regeneratorRuntime.wrap(function _callee121$(_context121){while(1){switch(_context121.prev=_context121.next){case 0:try{if(!this.isTrackingGuestUsers){delete localStorage["lively.user"];delete sessionStorage["lively.user"];}}catch(err){}user=user&&user.isGuestUser?user:__varRecorder__$D.User.guest;__varRecorder__$D.emit("lively.user/userchanged",{user:user},Date.now(),System);return _context121.abrupt("return",user);case 4:case"end":return _context121.stop();}}},_callee121,this);}));function UserRegistry_logout_(_x189){return _UserRegistry_logout_.apply(this,arguments);}return UserRegistry_logout_;}()},{key:"register",value:function(){var _UserRegistry_register_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee122(user,password){var _yield$user$register,error;return regeneratorRuntime.wrap(function _callee122$(_context122){while(1){switch(_context122.prev=_context122.next){case 0:if(!(!user||user.isGuestUser)){_context122.next=2;break;}throw new Error("guest users cannot register");case 2:_context122.next=4;return user.register(password);case 4:_yield$user$register=_context122.sent;error=_yield$user$register.error;if(!error){_context122.next=8;break;}throw Error(error);case 8:this.saveUserToLocalStorage(user);return _context122.abrupt("return",user);case 10:case"end":return _context122.stop();}}},_callee122,this);}));function UserRegistry_register_(_x190,_x191){return _UserRegistry_register_.apply(this,arguments);}return UserRegistry_register_;}()},{key:"loadUserFromLocalStorage",value:function UserRegistry_loadUserFromLocalStorage_(authServerURL){try{var stored=localStorage["lively.user"]||sessionStorage["lively.user"];if(stored){stored=JSON.parse(stored);return stored.isGuest?__varRecorder__$D.GuestUser.named(stored.name,null):__varRecorder__$D.User.fromToken(stored.token,authServerURL);}}catch(err){console.warn("Could not read user from localStorage: ".concat(err));}return this.isTrackingGuestUsers?false:__varRecorder__$D.GuestUser.guest;}},{key:"saveUserToLocalStorage",value:function UserRegistry_saveUserToLocalStorage_(user){if(!user||!user.isGuestUser&&!user.token)return false;__varRecorder__$D.emit("lively.user/userchanged",{user:user},Date.now(),System);try{if(user.isGuestUser&&!this.isTrackingGuestUsers){sessionStorage["lively.user"]=JSON.stringify({isGuest:true,name:user.name});delete localStorage["lively.user"];}else if(user.isGuestUser&&this.isTrackingGuestUsers){localStorage["lively.user"]=JSON.stringify({isGuest:true,name:user.name});}else{localStorage["lively.user"]=JSON.stringify({token:user.token});}return true;}catch(err){console.warn("Could not save user into local/sessionStorage: ".concat(err));return false;}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"UserRegistry";}},{key:"current",get:function get(){return this._current||(this._current=new this());}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"client/user-registry.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.user",version:"0.2.0"};}},{start:135,end:2531});}(undefined);UserRegistry=__varRecorder__$D.UserRegistry;var UserRegistry$1=UserRegistry;__varRecorder__$D["default"]=UserRegistry;var __varRecorder__$E=lively.FreezerRuntime.recorderFor("lively.user/index.js");__varRecorder__$E.User=User;__varRecorder__$E.ClientUser=User;__varRecorder__$E.GuestUser=GuestUser;__varRecorder__$E.GuestUser=GuestUser;__varRecorder__$E["default"]=UserRegistry$1;__varRecorder__$E.UserRegistry=UserRegistry$1;var __varRecorder__$F=lively.FreezerRuntime.recorderFor("lively.morphic/world.js");__varRecorder__$F.bowser=exports$1$1;__varRecorder__$F.Rectangle=Rectangle;__varRecorder__$F.Color=Color$1;__varRecorder__$F.pt=pt;__varRecorder__$F.arr=arr;__varRecorder__$F.promise=promise;__varRecorder__$F.Path=Path;__varRecorder__$F.obj=obj;__varRecorder__$F.signal=signal;__varRecorder__$F.config=config;__varRecorder__$F.MorphicEnv=MorphicEnv;__varRecorder__$F.Morph=Morph;__varRecorder__$F.TooltipViewer=TooltipViewer;__varRecorder__$F.Tooltip=Tooltip;__varRecorder__$F.loadWorldFromURL=loadWorldFromURL;__varRecorder__$F.loadWorldFromDB=loadWorldFromDB;__varRecorder__$F.loadWorldFromCommit=loadWorldFromCommit;__varRecorder__$F.loadWorld=loadWorld;__varRecorder__$F.touchInputDevice=touchInputDevice;__varRecorder__$F.UserRegistry=UserRegistry$1;__varRecorder__$F.emit=emit$1;__varRecorder__$F.resource=resource;__varRecorder__$F.loadMorphFromSnapshot=loadMorphFromSnapshot;var World=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/world.js");var __lively_class__=__lively_classholder__.hasOwnProperty("World")&&typeof __lively_classholder__.World==="function"?__lively_classholder__.World:__lively_classholder__.World=function World(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function World_initialize_(props){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);this._renderer=null;this._tooltipViewer=new __varRecorder__$F.TooltipViewer(this);}},{key:"__deserialize__",value:function World___deserialize___(snapshot,objRef,serializedMap,pool){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__deserialize__",this).call(this,snapshot,objRef,serializedMap,pool);this._renderer=null;this._tooltipViewer=new __varRecorder__$F.TooltipViewer(this);}},{key:"__additionally_serialize__",value:function World___additionally_serialize___(snapshot,objRef,pool,addFn){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__additionally_serialize__",this).call(this,snapshot,objRef,pool,addFn);if(snapshot.props.submorphs){var submorphs=snapshot.props.submorphs.value;for(var _i111=submorphs.length;_i111--;){var id=submorphs[_i111].id;if(pool.refForId(id).realObj.isHand){__varRecorder__$F.arr.removeAt(submorphs,_i111);}}}}},{key:"commands",get:function get(){return[].concat(_toConsumableArray2(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"commands",this)),[{name:"resize to fit window",exec:function(){var _exec=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee124(world){var resize,needsMoreResize,attempts;return regeneratorRuntime.wrap(function _callee124$(_context124){while(1){switch(_context124.prev=_context124.next){case 0:resize=function resize(){world.extent=lively.FreezerRuntime?world.windowBounds().extent():world.windowBounds().union(world.submorphBounds(function(m){return!m.isEpiMorph&&!m.hasFixedPosition;})).extent();};needsMoreResize=/*#__PURE__*/function(){var _ref88=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee123(){return regeneratorRuntime.wrap(function _callee123$(_context123){while(1){switch(_context123.prev=_context123.next){case 0:_context123.next=2;return world.whenRendered();case 2:delete world._cachedWindowBounds;return _context123.abrupt("return",!world.windowBounds().extent().equals(world.extent));case 4:case"end":return _context123.stop();}}},_callee123);}));return function needsMoreResize(){return _ref88.apply(this,arguments);};}();attempts=0;case 3:_context124.t0=attempts<5;if(!_context124.t0){_context124.next=8;break;}_context124.next=7;return needsMoreResize();case 7:_context124.t0=_context124.sent;case 8:if(!_context124.t0){_context124.next=13;break;}attempts++;resize();_context124.next=3;break;case 13:world.relayout();return _context124.abrupt("return",true);case 15:case"end":return _context124.stop();}}},_callee124);}));function exec(_x192){return _exec.apply(this,arguments);}return exec;}()}]);}},{key:"isWorld",get:function get(){return true;}},{key:"whenReady",value:function(){var _World_whenReady_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee125(){return regeneratorRuntime.wrap(function _callee125$(_context125){while(1){switch(_context125.prev=_context125.next){case 0:return _context125.abrupt("return",true);case 1:case"end":return _context125.stop();}}},_callee125);}));function World_whenReady_(){return _World_whenReady_.apply(this,arguments);}return World_whenReady_;}()},{key:"render",value:function World_render_(renderer){return renderer.renderWorld(this);}},{key:"grabbable",get:function get(){return false;}},{key:"grabbable",set:function set(_){}},{key:"existingHandForPointerId",value:function World_existingHandForPointerId_(pointerId){return this.submorphs.find(function(m){return m instanceof __varRecorder__$F.Hand&&m.pointerId===pointerId;});}},{key:"layoutHaloForPointerId",value:function World_layoutHaloForPointerId_(pointerId){}},{key:"haloForPointerId",value:function World_haloForPointerId_(pointerId){}},{key:"handForPointerId",value:function World_handForPointerId_(pointerId){var isPrimary=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var currentHand=this.existingHandForPointerId(pointerId);if(currentHand)return currentHand;if(!currentHand&&this.firstHand&&isPrimary){this.firstHand.pointerId=pointerId;return this.firstHand;}return this.addMorph(new __varRecorder__$F.Hand(pointerId),this.submorphs[0]);}},{key:"removeHandForPointerId",value:function World_removeHandForPointerId_(pointerId){var hand=this.existingHandForPointerId(pointerId);if(hand&&this.hands.length>1)hand.remove();}},{key:"world",value:function World_world_(){return this;}},{key:"makeDirty",value:function World_makeDirty_(){if(this._dirty)return;this._dirty=true;var r=this.env.renderer;r&&r.renderLater();}},{key:"hands",get:function get(){return __varRecorder__$F.arr.sortBy(this.submorphs.filter(function(ea){return ea.isHand;}),function(ea){return ea.pointerId;});}},{key:"firstHand",get:function get(){return this.hands[0];}},{key:"getCurrentUser",value:function World_getCurrentUser_(){var reg=__varRecorder__$F.UserRegistry.current;return reg.loadUserFromLocalStorage(__varRecorder__$F.config.users.authServerURL);}},{key:"focusedMorph",get:function get(){var dispatcher=this.env.eventDispatcher;var focused=dispatcher&&dispatcher.eventState.focusedMorph;return focused&&focused.world()===this?focused:this;}},{key:"onMouseMove",value:function World_onMouseMove_(evt){evt.hand&&evt.hand.update(evt);this._tooltipViewer.mouseMove(evt);}},{key:"onMouseDown",value:function World_onMouseDown_(evt){if(evt.state.menu)evt.state.menu.remove();this.onWindowScroll();this._tooltipViewer.mouseDown(evt);}},{key:"onMouseUp",value:function World_onMouseUp_(evt){if(evt.isCommandKey())evt.stop();if(evt.isAltDown()&&__varRecorder__$F.config.altClickDefinesThat){var target=this.morphsContainingPoint(evt.position)[0];setTimeout(function(){return System.global.that=target;},100);target.show();evt.stop();console.log("Set global \"that\" to ".concat(target));}}},{key:"onMouseWheel",value:function World_onMouseWheel_(evt){if(evt.isShiftDown()){window.scrollBy(-evt.domEvt.wheelDeltaX,-evt.domEvt.wheelDeltaY);evt.stop();}}},{key:"onBeforeUnload",value:function World_onBeforeUnload_(evt){return this.onUnload(evt);}},{key:"onUnload",value:function World_onUnload_(evt){this.submorphs.forEach(function(ea){if(typeof ea.onWorldUnload==="function"){ea.onWorldUnload(evt);}});}},{key:"updateVisibleWindowMorphs",value:function World_updateVisibleWindowMorphs_(){this.withAllSubmorphsDo(function(aMorph){if(!aMorph.respondsToVisibleWindow)return;if(typeof aMorph.relayout!=="function"){return aMorph.showError(new Error("".concat(aMorph," listed as responding to visible window")+" change, but has no relayout instruction"));}aMorph.relayout();});}},{key:"onWindowScroll",value:function World_onWindowScroll_(){var _this$env$eventDispat=this.env.eventDispatcher.keyInputHelper.inputState,positionChangedTime=_this$env$eventDispat.positionChangedTime,scrollLeftWhenChanged=_this$env$eventDispat.scrollLeftWhenChanged,scrollTopWhenChanged=_this$env$eventDispat.scrollTopWhenChanged;var docEl=document.documentElement;if(Date.now()-positionChangedTime<500&&!__varRecorder__$F.bowser.firefox){docEl.scrollLeft=scrollLeftWhenChanged;docEl.scrollTop=scrollTopWhenChanged;return;}this.setProperty("scroll",__varRecorder__$F.pt(docEl.scrollLeft,docEl.scrollTop));this._cachedWindowBounds=null;this.updateVisibleWindowMorphs();}},{key:"onWindowResize",value:function(){var _World_onWindowResize_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee126(evt){var _iterator72,_step72,_morph13;return regeneratorRuntime.wrap(function _callee126$(_context126){while(1){switch(_context126.prev=_context126.next){case 0:_context126.next=2;return this.whenRendered();case 2:this._cachedWindowBounds=null;if(!(this.resizePolicy==="elastic")){_context126.next=6;break;}_context126.next=6;return this.execCommand("resize to fit window");case 6:this.updateVisibleWindowMorphs();_iterator72=_createForOfIteratorHelper(this.submorphs);try{for(_iterator72.s();!(_step72=_iterator72.n()).done;){_morph13=_step72.value;if(typeof _morph13.onWorldResize==="function"){_morph13.onWorldResize(evt);}}}catch(err){_iterator72.e(err);}finally{_iterator72.f();}case 9:case"end":return _context126.stop();}}},_callee126,this);}));function World_onWindowResize_(_x193){return _World_onWindowResize_.apply(this,arguments);}return World_onWindowResize_;}()},{key:"relayCommandExecutionToFocusedMorph",value:function World_relayCommandExecutionToFocusedMorph_(evt){if(!evt)return null;var focused=this.focusedMorph;var _ref89=__varRecorder__$F.arr.findAndGet(__varRecorder__$F.arr.without([focused].concat(_toConsumableArray2(focused.ownerChain())),this),function(morph){return __varRecorder__$F.arr.findAndGet(morph.keyhandlers,function(kh){var command=kh.eventCommandLookup(morph,evt);return command?{command:command,morph:morph}:null;});})||{},command=_ref89.command,morph=_ref89.morph;return command?morph.execCommand(command):null;}},{key:"visibleBounds",value:function World_visibleBounds_(){if(!this.env.renderer)return this.innerBounds();return this.windowBounds().intersection(this.innerBounds());}},{key:"windowBounds",value:function World_windowBounds_(optWorldDOMNode){if(this._cachedWindowBounds)return this._cachedWindowBounds;var window=this.env.domEnv.window;var scale=1/this.scale;var x=window.scrollX*scale;var y=window.scrollY*scale;var width=(window.innerWidth||this.width)*scale;var height=(window.innerHeight||this.height)*scale;return this._cachedWindowBounds=new __varRecorder__$F.Rectangle(x,y,width,height);}},{key:"logError",value:function World_logError_(msg){console.log(msg);}},{key:"relayout",value:function World_relayout_(){}},{key:"defaultMenuItems",value:function World_defaultMenuItems_(morph){return[];}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"World";}},{key:"properties",get:function get(){return{resizePolicy:{doc:"how the world behaves on window size changes 'elastic': resizes to window extent, 'static': leaves its extent unchanged",defaultValue:"elastic",after:["clipMode"],type:"Enum",values:["static","elastic"],set:function set(val){this.setProperty("resizePolicy",val);this.clipMode=val==="static"?"visible":"hidden";if(val=="elastic")this.execCommand("resize to fit window");}},colorScheme:{derived:true,get:function get(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";}},showsUserFlap:{defaultValue:true,set:function set(bool){var _this142=this;var _varRecorder__$F$res=__varRecorder__$F.resource(document.location.href).query(),showsUserFlap=_varRecorder__$F$res.showsUserFlap;if(typeof showsUserFlap!=="undefined")bool=showsUserFlap;this.setProperty("showsUserFlap",bool);this.whenReady().then(function(){return System["import"]("lively.user/morphic/user-ui.js");}).then(function(userUI){return userUI.UserUI[bool?"showUserFlap":"hideUserFlap"](_this142);});}}};}},{key:"defaultWorld",value:function World_defaultWorld_(){return __varRecorder__$F.MorphicEnv["default"]().world;}},{key:"loadWorldFromURL",value:function World_loadWorldFromURL_(url){var oldWorld=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.defaultWorld();var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return __varRecorder__$F.loadWorldFromURL(url,oldWorld,options);}},{key:"loadWorld",value:function World_loadWorld_(newWorld){var oldWorld=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.defaultWorld();var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return __varRecorder__$F.loadWorld(newWorld,oldWorld,options);}},{key:"loadFromCommit",value:function World_loadFromCommit_(commitOrId){var oldWorld=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.defaultWorld();var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return __varRecorder__$F.loadWorldFromCommit(commitOrId,oldWorld,options);}},{key:"loadFromDB",value:function World_loadFromDB_(name,ref){var oldWorld=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.defaultWorld();var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return __varRecorder__$F.loadWorldFromDB(name,ref,oldWorld,options);}},{key:"loadFromResource",value:function(){var _World_loadFromResource_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee127(res){var oldWorld,options,_args128=arguments;return regeneratorRuntime.wrap(function _callee127$(_context127){while(1){switch(_context127.prev=_context127.next){case 0:oldWorld=_args128.length>1&&_args128[1]!==undefined?_args128[1]:this.defaultWorld();options=_args128.length>2&&_args128[2]!==undefined?_args128[2]:{};_context127.t0=__varRecorder__$F;_context127.t1=__varRecorder__$F;_context127.next=6;return res.readJson();case 6:_context127.t2=_context127.sent;_context127.next=9;return _context127.t1.loadMorphFromSnapshot.call(_context127.t1,_context127.t2);case 9:_context127.t3=_context127.sent;_context127.t4=oldWorld;_context127.t5=options;_context127.next=14;return _context127.t0.loadWorld.call(_context127.t0,_context127.t3,_context127.t4,_context127.t5);case 14:return _context127.abrupt("return",_context127.sent);case 15:case"end":return _context127.stop();}}},_callee127,this);}));function World_loadFromResource_(_x194){return _World_loadFromResource_.apply(this,arguments);}return World_loadFromResource_;}()}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"world.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:774,end:11291});}(__varRecorder__$F.Morph);__varRecorder__$F.World=World;__varRecorder__$F.World=World;__varRecorder__$F.World=World;var Hand=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/world.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Hand")&&typeof __lively_classholder__.Hand==="function"?__lively_classholder__.Hand:__lively_classholder__.Hand=function Hand(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Hand_initialize_(pointerId){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,{pointerId:pointerId});}},{key:"__deserialize__",value:function Hand___deserialize___(snapshot,objRef,serializedMap,pool){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__deserialize__",this).call(this,snapshot,objRef,serializedMap,pool);this.reset();}},{key:"reset",value:function Hand_reset_(){this._grabbedMorphProperties=new WeakMap();}},{key:"isHand",get:function get(){return true;}},{key:"pointerId",get:function get(){return this.getProperty("pointerId");}},{key:"pointerId",set:function set(id){this.setProperty("pointerId",id);}},{key:"draggable",get:function get(){return false;}},{key:"draggable",set:function set(_){}},{key:"grabbable",get:function get(){return false;}},{key:"grabbable",set:function set(_){}},{key:"grabbedMorphs",get:function get(){return this.submorphs;}},{key:"carriesMorphs",value:function Hand_carriesMorphs_(){return!!this.grabbedMorphs.length;}},{key:"morphsContainingPoint",value:function Hand_morphsContainingPoint_(point,list){return list;}},{key:"update",value:function Hand_update_(evt){this.position=evt.position.subXY(window.scrollX,window.scrollY);}},{key:"cancelGrab",value:function(){var _Hand_cancelGrab_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee128(){var animate,causingEvent,anims,_iterator73,_step73,_m11,_ref90,prevOwner,prevIndex,prevPosition,pointerAndShadow,_args129=arguments;return regeneratorRuntime.wrap(function _callee128$(_context128){while(1){switch(_context128.prev=_context128.next){case 0:animate=_args129.length>0&&_args129[0]!==undefined?_args129[0]:true;causingEvent=_args129.length>1?_args129[1]:undefined;if(this.grabbedMorphs.length){_context128.next=4;break;}return _context128.abrupt("return");case 4:this.env.eventDispatcher.cancelGrab(this,causingEvent);anims=[];_iterator73=_createForOfIteratorHelper(this.grabbedMorphs);_context128.prev=7;_iterator73.s();case 9:if((_step73=_iterator73.n()).done){_context128.next=20;break;}_m11=_step73.value;_ref90=this._grabbedMorphProperties.get(_m11)||{},prevOwner=_ref90.prevOwner,prevIndex=_ref90.prevIndex,prevPosition=_ref90.prevPosition,pointerAndShadow=_ref90.pointerAndShadow;Object.assign(_m11,pointerAndShadow);if(prevOwner){_context128.next=16;break;}_m11.remove();return _context128.abrupt("continue",18);case 16:prevOwner.addMorphAt(_m11,prevIndex);if(animate)anims.push(_m11.animate({position:prevPosition}));else _m11.position=prevPosition;case 18:_context128.next=9;break;case 20:_context128.next=25;break;case 22:_context128.prev=22;_context128.t0=_context128["catch"](7);_iterator73.e(_context128.t0);case 25:_context128.prev=25;_iterator73.f();return _context128.finish(25);case 28:return _context128.abrupt("return",anims.length?Promise.all(anims):null);case 29:case"end":return _context128.stop();}}},_callee128,this,[[7,22,25,28]]);}));function Hand_cancelGrab_(){return _Hand_cancelGrab_.apply(this,arguments);}return Hand_cancelGrab_;}()},{key:"grab",value:function Hand_grab_(morph){var _this143=this;if(__varRecorder__$F.obj.isArray(morph))return morph.forEach(function(m){return _this143.grab(m);});this.withMetaDo({metaInteraction:true},function(){_this143._grabbedMorphProperties.set(morph,{prevOwner:morph.owner,prevPosition:morph.position,prevIndex:morph.owner?morph.owner.submorphs.indexOf(morph):-1,pointerAndShadow:__varRecorder__$F.obj.select(morph,["dropShadow","reactsToPointer"])});morph.reactsToPointer=false;morph.dropShadow=true;_this143.addMorph(morph);});__varRecorder__$F.signal(this,"grab",morph);}},{key:"dropMorphsOn",value:function Hand_dropMorphsOn_(dropTarget){var _this144=this;this.withMetaDo({metaInteraction:true},function(){_this144.grabbedMorphs.forEach(function(morph){try{var _ref91=_this144._grabbedMorphProperties.get(morph)||{},pointerAndShadow=_ref91.pointerAndShadow;Object.assign(morph,pointerAndShadow);__varRecorder__$F.signal(_this144,"drop",morph);morph.onBeingDroppedOn(_this144,dropTarget);}catch(err){console.error(err);_this144.world().showError("Error dropping ".concat(morph," onto ").concat(dropTarget,":\n").concat(err.stack));if(morph.owner!==dropTarget){_this144.world().addMorph(dropTarget);}}});});}},{key:"findDropTarget",value:function Hand_findDropTarget_(){var _this145=this;var position=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.globalPosition;var grabbedMorphs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.grabbedMorphs;var optFilterFn=arguments.length>2?arguments[2]:undefined;var morphs=this.world().morphsContainingPoint(position);var sortedTargets=__varRecorder__$F.arr.sortBy(morphs,function(m){return[m].concat(_toConsumableArray2(m.ownerChain())).find(function(m){return __varRecorder__$F.Path("owner.isWorld").get(m)&&m.hasFixedPosition;})?0:1;});var filterFn=typeof optFilterFn==="function"?function(m,i){return!_this145.isAncestorOf(m)&&m.acceptsDrops&&!grabbedMorphs.includes(m)&&grabbedMorphs.every(function(ea){return ea.wantsToBeDroppedOn(m);})&&optFilterFn(m,i);}:function(m){return!_this145.isAncestorOf(m)&&m.acceptsDrops&&grabbedMorphs.every(function(ea){return ea.wantsToBeDroppedOn(m);});};return sortedTargets.find(filterFn);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Hand";}},{key:"properties",get:function get(){return{hasFixedPosition:{defaultValue:true},fill:{defaultValue:__varRecorder__$F.touchInputDevice?__varRecorder__$F.Color.transparent:__varRecorder__$F.Color.orange},extent:{defaultValue:__varRecorder__$F.pt(1,1)},reactsToPointer:{defaultValue:false},_grabbedMorphProperties:{serialize:false,initialize:function initialize(){this._grabbedMorphProperties=new WeakMap();}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"world.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:11300,end:15294});}(__varRecorder__$F.Morph);__varRecorder__$F.Hand=Hand;__varRecorder__$F.Hand=Hand;__varRecorder__$F.Hand=Hand;var __captured2__$1=/*#__PURE__*/Object.freeze({__proto__:null,World:World,Hand:Hand});var __varRecorder__$G=lively.FreezerRuntime.recorderFor("lively.morphic/text/position.js");function comparePosition(pos1,pos2){var row=pos1.row,column=pos1.column;var row2=pos2.row,column2=pos2.column;if(row<row2)return-2;if(row===row2){if(column<column2)return-1;if(column===column2)return 0;return 1;}return 2;}__varRecorder__$G.comparePosition=comparePosition;function lessPosition(p1,p2){return __varRecorder__$G.comparePosition(p1,p2)<0;}__varRecorder__$G.lessPosition=lessPosition;function lessEqPosition(p1,p2){return __varRecorder__$G.comparePosition(p1,p2)<=0;}__varRecorder__$G.lessEqPosition=lessEqPosition;function eqPosition(p1,p2){return __varRecorder__$G.comparePosition(p1,p2)===0;}__varRecorder__$G.eqPosition=eqPosition;function minPosition(p1,p2){return __varRecorder__$G.lessPosition(p1,p2)?p1:p2;}__varRecorder__$G.minPosition=minPosition;function maxPosition(p1,p2){return __varRecorder__$G.lessPosition(p1,p2)?p2:p1;}__varRecorder__$G.maxPosition=maxPosition;__varRecorder__$G.comparePosition=comparePosition;__varRecorder__$G.comparePosition=comparePosition;__varRecorder__$G.lessPosition=lessPosition;__varRecorder__$G.lessPosition=lessPosition;__varRecorder__$G.lessEqPosition=lessEqPosition;__varRecorder__$G.lessEqPosition=lessEqPosition;__varRecorder__$G.eqPosition=eqPosition;__varRecorder__$G.eqPosition=eqPosition;__varRecorder__$G.minPosition=minPosition;__varRecorder__$G.minPosition=minPosition;__varRecorder__$G.maxPosition=maxPosition;__varRecorder__$G.maxPosition=maxPosition;var __varRecorder__$H=lively.FreezerRuntime.recorderFor("lively.morphic/text/range.js");__varRecorder__$H.lessPosition=lessPosition;__varRecorder__$H.lessEqPosition=lessEqPosition;__varRecorder__$H.eqPosition=eqPosition;__varRecorder__$H.minPosition=minPosition;__varRecorder__$H.maxPosition=maxPosition;var Range=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/range.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Range")&&typeof __lively_classholder__.Range==="function"?__lively_classholder__.Range:__lively_classholder__.Range=function Range(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Range_initialize_(){var range=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{start:{row:0,column:0},end:{row:0,column:0}};var _range$start=range.start,startRow=_range$start.row,startColumn=_range$start.column,_range$end=range.end,endRow=_range$end.row,endColumn=_range$end.column;if(endRow<startRow||endRow===startRow&&endColumn<startColumn){var _ref92=[startRow,startColumn,endRow,endColumn];endRow=_ref92[0];endColumn=_ref92[1];startRow=_ref92[2];startColumn=_ref92[3];}this.start={row:startRow,column:startColumn};this.end={row:endRow,column:endColumn};}},{key:"isRange",get:function get(){return true;}},{key:"isEmpty",value:function Range_isEmpty_(){return this.start.row===this.end.row&&this.start.column===this.end.column;}},{key:"equals",value:function Range_equals_(other){if(!other||!other.start||!other.end)return false;return __varRecorder__$H.eqPosition(this.start,other.start)&&__varRecorder__$H.eqPosition(this.end,other.end);}},{key:"copy",value:function Range_copy_(){return new __varRecorder__$H.Range(this);}},{key:"toLiteral",value:function Range_toLiteral_(){return{start:this.start,end:this.end};}},{key:"merge",value:function Range_merge_(otherRange){if(!otherRange.isRange)otherRange=new __varRecorder__$H.Range(otherRange);if(__varRecorder__$H.lessPosition(this.end,otherRange.start)||__varRecorder__$H.lessPosition(otherRange.end,this.start)){return this;}return __varRecorder__$H.Range.fromPositions(__varRecorder__$H.minPosition(this.start,otherRange.start),__varRecorder__$H.maxPosition(this.end,otherRange.end));}},{key:"without",value:function Range_without_(otherRange){if(!otherRange.isRange)otherRange=new __varRecorder__$H.Range(otherRange);var compared=__varRecorder__$H.Range.compare(this,otherRange);if(compared===0){return __varRecorder__$H.Range.fromPositions(this.start,this.start);}if(Math.abs(compared)>=5){return this;}if(compared<0){return __varRecorder__$H.Range.fromPositions(this.start,otherRange.start);}return __varRecorder__$H.Range.fromPositions(otherRange.end,this.end);}},{key:"intersect",value:function Range_intersect_(that){if(!that.isRange)that=new __varRecorder__$H.Range(that);var comparison=__varRecorder__$H.Range.compare(this,that);var a=comparison<0?this:that;var b=comparison<0?that:this;switch(Math.abs(comparison)){case 0:case 1:return new __varRecorder__$H.Range(a);case 2:case 3:return new __varRecorder__$H.Range(b);case 4:return __varRecorder__$H.Range.fromPositions(b.start,a.end);case 5:return __varRecorder__$H.Range.at(b.start);case 6:return __varRecorder__$H.Range.at(a.end);}}},{key:"subtract",value:function Range_subtract_(that){if(!that.isRange)that=new __varRecorder__$H.Range(that);var comparison=__varRecorder__$H.Range.compare(this,that);switch(comparison){case-6:case-5:case 5:case 6:return[new __varRecorder__$H.Range(this)];case-1:case 0:case 2:case 3:return[__varRecorder__$H.Range.at(this.start)];case 1:case 4:return[__varRecorder__$H.Range.fromPositions(that.end,this.end)];case-4:case-3:return[__varRecorder__$H.Range.fromPositions(this.start,that.start)];case-2:return[__varRecorder__$H.Range.fromPositions(this.start,that.start),__varRecorder__$H.Range.fromPositions(that.end,this.end)];}}},{key:"containsPosition",value:function Range_containsPosition_(pos){return __varRecorder__$H.lessEqPosition(this.start,pos)&&__varRecorder__$H.lessEqPosition(pos,this.end);}},{key:"toString",value:function Range_toString_(){var _this$start=this.start,row=_this$start.row,column=_this$start.column,_this$end=this.end,endRow=_this$end.row,endColumn=_this$end.column;return"Range(".concat(row,"/").concat(column," -> ").concat(endRow,"/").concat(endColumn,")");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Range";}},{key:"sort",value:function Range_sort_(ranges){return ranges.sort(__varRecorder__$H.Range.compare);}},{key:"compare",value:function Range_compare_(a,b){var startA=a.start,endA=a.end;var startB=b.start,endB=b.end;if(__varRecorder__$H.lessPosition(startA,startB)){if(__varRecorder__$H.lessPosition(endA,startB)){return-6;}if(__varRecorder__$H.eqPosition(endA,startB)){return-5;}if(__varRecorder__$H.lessPosition(endA,endB)){return-4;}if(__varRecorder__$H.eqPosition(endA,endB)){return-3;}return-2;}if(__varRecorder__$H.eqPosition(startA,startB)){if(__varRecorder__$H.eqPosition(endA,endB)){return 0;}return __varRecorder__$H.lessPosition(endA,endB)?-1:1;}return-1*__varRecorder__$H.Range.compare(b,a);}},{key:"at",value:function Range_at_(position){return new this({start:position,end:position});}},{key:"fromPositions",value:function Range_fromPositions_(start,end){return new this({start:start,end:end});}},{key:"create",value:function Range_create_(startRow,startCol,endRow,endCol){return new this({start:{row:startRow,column:startCol},end:{row:endRow,column:endCol}});}},{key:"isValidLiteral",value:function Range_isValidLiteral_(rangeSpec){if(!rangeSpec)return false;if(rangeSpec.isRange)return true;return rangeSpec.start&&rangeSpec.end&&typeof rangeSpec.start.row==="number"&&typeof rangeSpec.start.column==="number"&&typeof rangeSpec.end.row==="number"&&typeof rangeSpec.end.column==="number";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/range.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:108,end:5369});}(undefined);__varRecorder__$H.Range=Range;__varRecorder__$H.Range=Range;__varRecorder__$H.Range=Range;var defaultRange=new __varRecorder__$H.Range();__varRecorder__$H.defaultRange=defaultRange;__varRecorder__$H.defaultRange=defaultRange;__varRecorder__$H.defaultRange=defaultRange;var __varRecorder__$I=lively.FreezerRuntime.recorderFor("lively.morphic/text/selection.js");__varRecorder__$I.lessPosition=lessPosition;__varRecorder__$I.Range=Range;__varRecorder__$I.defaultRange=defaultRange;__varRecorder__$I.config=config;__varRecorder__$I.string=string;__varRecorder__$I.arr=arr;__varRecorder__$I.signal=signal;var Selection=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/selection.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Selection")&&typeof __lively_classholder__.Selection==="function"?__lively_classholder__.Selection:__lively_classholder__.Selection=function Selection(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Selection_initialize_(textMorph,range){this.textMorph=textMorph;this.initialize(range);}},{key:"isSelection",get:function get(){return true;}},{key:"initialize",value:function Selection_initialize_(range){this._goalColumn=undefined;this._goalX=undefined;this._isReverse=false;var id=__varRecorder__$I.string.newUUID();this.startAnchor=this.textMorph.addAnchor("selection-start-"+id);this.endAnchor=this.textMorph.addAnchor("selection-end-"+id);this.range=__varRecorder__$I.Range.isValidLiteral(range)?range:__varRecorder__$I.defaultRange;this._cursorVisible=true;this.cursorBlinkProcess=null;}},{key:"isSelection",get:function get(){return true;}},{key:"uninstall",value:function Selection_uninstall_(){this.cursorBlinkStop();this.textMorph.removeAnchor(this.startAnchor);this.textMorph.removeAnchor(this.endAnchor);}},{key:"compareRangesForMerge",value:function Selection_compareRangesForMerge_(a,b){var _a$start=a.start,startRowA=_a$start.row,startColA=_a$start.column,_a$end=a.end,endRowA=_a$end.row,endColA=_a$end.column;var _b$start=b.start,startRowB=_b$start.row,startColB=_b$start.column,_b$end=b.end,endRowB=_b$end.row,endColB=_b$end.column;if(startRowA<startRowB||startRowA===startRowB&&startColA<startColB){if(endRowA<startRowB||endRowA===startRowB&&endColA<startColB){return"separate";}if(endRowA===startRowB&&endColA===startColB){return startRowB===endRowB&&startColB===endColB?"overlapping":"bordering";}return"overlapping";}if(startRowA===startRowB&&startColA===startColB){if(endRowA===endRowB&&endColA===endColB){return"equal";}return"overlapping";}return this.compareRangesForMerge(b,a);}},{key:"mergeWith",value:function Selection_mergeWith_(otherSel){if(!otherSel||!otherSel.isSelection)return false;var compared=this.compareRangesForMerge(this.range,otherSel.range);if(compared==="separate"||compared==="bordering"){return false;}this.range=this.range.merge(otherSel.range);if(otherSel.isReverse()!=this.isReverse()){this.reverse();}return true;}},{key:"range",get:function get(){return this._range;}},{key:"range",set:function set(range){if(!range)return;var _range=range,start=_range.start,end=_range.end;if(start===undefined||end===undefined)return;var d=this.textMorph.document;if(typeof start==="number")range.start=start=d.indexToPosition(start);if(typeof end==="number")range.end=end=d.indexToPosition(end);if(!__varRecorder__$I.Range.isValidLiteral(range))return;start=d.clipPositionToLines(start);end=d.clipPositionToLines(end);var isReverse=this._isReverse=__varRecorder__$I.lessPosition(end,start);if(isReverse){var _ref93=[end,start];start=_ref93[0];end=_ref93[1];}range.start=start;range.end=end;if(!range.isRange)range=new __varRecorder__$I.Range(range);if(range.equals(this._range))return;this._range=range;this._goalColumn=this.textMorph.lineWrapping?this.textMorph.columnInWrappedLine(this.lead):this.lead.column;this._goalX=this.textMorph.charBoundsFromTextPosition(this.lead).x;this.startAnchor.position=range.start;this.endAnchor.position=range.end;this.textMorph.makeDirty();__varRecorder__$I.signal(this.textMorph,"selectionChange",this);}},{key:"directedRange",get:function get(){return{end:this.lead,start:this.anchor};}},{key:"updateFromAnchors",value:function Selection_updateFromAnchors_(){this.range={start:this.startAnchor.position,end:this.endAnchor.position};}},{key:"start",get:function get(){return this.range.start;}},{key:"start",set:function set(val){this.range=__varRecorder__$I.Range.fromPositions(val,this.end);}},{key:"end",get:function get(){return this.range.end;}},{key:"end",set:function set(val){this.range=__varRecorder__$I.Range.fromPositions(this.start,val);}},{key:"selectionColor",get:function get(){return this.textMorph.selectionColor||"#bed8f7";}},{key:"anchor",get:function get(){return this.isReverse()?this.range.end:this.range.start;}},{key:"anchor",set:function set(pos){this.range={start:pos,end:this.lead};}},{key:"lead",get:function get(){return this.isReverse()?this.range.start:this.range.end;}},{key:"lead",set:function set(pos){this.range={start:this.anchor,end:pos};}},{key:"text",get:function get(){return this.textMorph.document.textInRange(this.range);}},{key:"text",set:function set(val){this.replace(val);}},{key:"replace",value:function Selection_replace_(text,extendTextAttributes,invalidateTextLayout,undoGroup){var range=this.range,textMorph=this.textMorph;var reversed=this.isReverse();this.range=textMorph.replace(range,text,extendTextAttributes,invalidateTextLayout,undoGroup);if(reversed)this.reverse();return this.range;}},{key:"selectedRows",get:function get(){return{first:this.start.row,last:this.end.row};}},{key:"reverse",value:function Selection_reverse_(){this._isReverse=!this.isEmpty()&&!this._isReverse;return this;}},{key:"isReverse",value:function Selection_isReverse_(){return this._isReverse&&!this.isEmpty();}},{key:"isEmpty",value:function Selection_isEmpty_(){return this.range.isEmpty();}},{key:"collapse",value:function Selection_collapse_(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.start;this.range={start:pos,end:pos};return this;}},{key:"collapseToEnd",value:function Selection_collapseToEnd_(){this.collapse(this.end);return this;}},{key:"growLeft",value:function Selection_growLeft_(n){var d=this.textMorph.document;var endIndex=d.positionToIndex(this.end);var startIndex=Math.min(endIndex,d.positionToIndex(this.start)-n);var r=this.isReverse();this.start=d.indexToPosition(startIndex);this._isReverse=r;return this;}},{key:"growRight",value:function Selection_growRight_(n){var d=this.textMorph.document;var startIndex=d.positionToIndex(this.start);var endIndex=Math.max(startIndex,d.positionToIndex(this.end)+n);var r=this.isReverse();this.end=d.indexToPosition(endIndex);this._isReverse=r;return this;}},{key:"selectAll",value:function Selection_selectAll_(){this.range={start:{row:0,column:0},end:this.textMorph.document.endPosition};return this;}},{key:"selectLine",value:function Selection_selectLine_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.lead.row;var includingLineEnd=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.includingLineEnd=includingLineEnd;this.range={start:{row:row,column:0},end:{row:row,column:this.textMorph.getLine(row).length}};return this;}},{key:"gotoLineEnd",value:function Selection_gotoLineEnd_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.lead.row;var pos={row:row,column:this.textMorph.getLine(row).length};this.range={start:pos,end:pos};}},{key:"selectLeft",value:function Selection_selectLeft_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;if(this.isEmpty()){this.growLeft(n);this.reverse();}else this.isReverse()?this.growLeft(n):this.growRight(-n);return this;}},{key:"selectRight",value:function Selection_selectRight_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this.isReverse()?this.growLeft(-n):this.growRight(n);return this;}},{key:"selectUp",value:function Selection_selectUp_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var useScreenPosition=arguments.length>1?arguments[1]:undefined;return this.goUp(n,useScreenPosition,true);}},{key:"selectDown",value:function Selection_selectDown_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var useScreenPosition=arguments.length>1?arguments[1]:undefined;return this.selectUp(-n,useScreenPosition);}},{key:"goUp",value:function Selection_goUp_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var useScreenPosition=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var select=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(n===0)return this;var goalColumn=this._goalColumn;var goalX=this._goalX;this.lead=this.textMorph.getPositionAboveOrBelow(n,this.lead,useScreenPosition,goalColumn,goalX);if(!select)this.anchor=this.lead;this._goalColumn=goalColumn;this._goalX=goalX;return this;}},{key:"goDown",value:function Selection_goDown_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var useScreenPosition=arguments.length>1?arguments[1]:undefined;return this.goUp(-n,useScreenPosition);}},{key:"goLeft",value:function Selection_goLeft_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this.isEmpty()&&this.growLeft(n);this.collapse();return this;}},{key:"goRight",value:function Selection_goRight_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this.isEmpty()&&this.growRight(n);this.collapseToEnd();return this;}},{key:"cursorVisible",get:function get(){return this._cursorVisible&&this.textMorph.isFocused()&&!this.textMorph.rejectsInput();}},{key:"cursorBlinkStart",value:function Selection_cursorBlinkStart_(){var _this146=this;this.cursorBlinkStop();var timeout=__varRecorder__$I.config.text.cursorBlinkPeriod;if(timeout){var _m12=this.textMorph;var node=_m12.env.renderer.getNodeForMorph(_m12);this.cursorBlinkProcess=setInterval(function(){if(!node)node=_m12.env.renderer.getNodeForMorph(_m12);if(!node)return;_this146._cursorVisible=!_this146._cursorVisible;var classNames=node.className.split(" ");var hiddenCursorIndex=classNames.indexOf("hidden-cursor");if(_this146._cursorVisible&&hiddenCursorIndex>-1){classNames.splice(hiddenCursorIndex,1);node.className=classNames.join(" ");}if(!_this146._cursorVisible&&hiddenCursorIndex===-1){node.className=[].concat(_toConsumableArray2(classNames),["hidden-cursor"]).join(" ");}},timeout*1000);}}},{key:"cursorBlinkStop",value:function Selection_cursorBlinkStop_(){if(this.cursorBlinkProcess){clearInterval(this.cursorBlinkProcess);}this.cursorBlinkProcess=null;this._cursorVisible=true;var m=this.textMorph;var node=m.env.renderer.getNodeForMorph(m);if(node){var classNames=node.className.split(" ");var hiddenCursorIndex=classNames.indexOf("hidden-cursor");if(hiddenCursorIndex>-1){classNames.splice(hiddenCursorIndex,1);node.className=classNames.join(" ");}}}},{key:"toString",value:function Selection_toString_(){var _this$anchor=this.anchor,row=_this$anchor.row,column=_this$anchor.column;var _this$lead=this.lead,endRow=_this$lead.row,endColumn=_this$lead.column;return"Selection(".concat(row,"/").concat(column," -> ").concat(endRow,"/").concat(endColumn,")");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Selection";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/selection.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:224,end:9243});}(undefined);__varRecorder__$I.Selection=Selection;__varRecorder__$I.Selection=Selection;__varRecorder__$I.Selection=Selection;var MultiSelection=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/selection.js");var __lively_class__=__lively_classholder__.hasOwnProperty("MultiSelection")&&typeof __lively_classholder__.MultiSelection==="function"?__lively_classholder__.MultiSelection:__lively_classholder__.MultiSelection=function MultiSelection(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"initialize",value:function MultiSelection_initialize_(range){this._selections=[new __varRecorder__$I.Selection(this.textMorph,range)];}},{key:"__deserialize__",value:function MultiSelection___deserialize___(snapshot,objRef){this._selections=[];}},{key:"selections",get:function get(){return this._selections;}},{key:"selections",set:function set(sels){var removed=this._selections?this._selections.filter(function(ea){return!sels.includes(ea);}):[];this._selections=sels;removed.forEach(function(ea){return ea.uninstall();});}},{key:"isMultiSelection",get:function get(){return true;}},{key:"uninstall",value:function MultiSelection_uninstall_(){this.selections.forEach(function(ea){return ea.uninstall();});}},{key:"defaultSelection",get:function get(){return __varRecorder__$I.arr.last(this.selections);}},{key:"removeSelections",value:function MultiSelection_removeSelections_(){var startingAt=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var toRemove=this.selections.slice(startingAt);toRemove.forEach(function(ea){return ea.uninstall();});this.selections=__varRecorder__$I.arr.withoutAll(this.selections,toRemove);}},{key:"disableMultiSelect",value:function MultiSelection_disableMultiSelect_(){__varRecorder__$I.arr.without(this.selections,this.defaultSelection).forEach(function(ea){return ea.uninstall();});this.selections=[this.defaultSelection];}},{key:"range",get:function get(){return this.defaultSelection.range;}},{key:"range",set:function set(range){this.disableMultiSelect();this.defaultSelection.range=range;}},{key:"updateFromAnchors",value:function MultiSelection_updateFromAnchors_(){this.selections.forEach(function(ea){return ea.updateFromAnchors();});}},{key:"start",get:function get(){return this.defaultSelection.start;}},{key:"start",set:function set(val){this.defaultSelection.start=val;}},{key:"end",get:function get(){return this.defaultSelection.end;}},{key:"end",set:function set(val){this.defaultSelection.end=val;}},{key:"anchor",get:function get(){return this.defaultSelection.anchor;}},{key:"anchor",set:function set(pos){this.defaultSelection.anchor=pos;}},{key:"lead",get:function get(){return this.defaultSelection.lead;}},{key:"lead",set:function set(pos){this.defaultSelection.lead=pos;}},{key:"text",get:function get(){return this.selections.map(function(sel){return sel.text;}).join("\n");}},{key:"text",set:function set(val){this.selections.forEach(function(sel){return sel.text=val;});}},{key:"selectedRows",get:function get(){return this.defaultSelection.selectedRows;}},{key:"reverse",value:function MultiSelection_reverse_(){this.defaultSelection.reverse();}},{key:"isReverse",value:function MultiSelection_isReverse_(){return this.defaultSelection.isReverse();}},{key:"isEmpty",value:function MultiSelection_isEmpty_(){return this.defaultSelection.isEmpty();}},{key:"collapse",value:function MultiSelection_collapse_(pos){this.defaultSelection.collapse(pos);return this;}},{key:"collapseToEnd",value:function MultiSelection_collapseToEnd_(){this.defaultSelection.collapseToEnd();return this;}},{key:"growLeft",value:function MultiSelection_growLeft_(n){this.defaultSelection.growLeft(n);return this;}},{key:"growRight",value:function MultiSelection_growRight_(n){this.defaultSelection.growRight(n);return this;}},{key:"selectAll",value:function MultiSelection_selectAll_(){this.disableMultiSelect();this.defaultSelection.selectAll();return this;}},{key:"selectLine",value:function MultiSelection_selectLine_(row,includingLineEnd){this.includingLineEnd=includingLineEnd;this.defaultSelection.selectLine(row,includingLineEnd);return this;}},{key:"gotoLineEnd",value:function MultiSelection_gotoLineEnd_(row){this.defaultSelection.gotoLineEnd(row);}},{key:"selectLeft",value:function MultiSelection_selectLeft_(n){this.defaultSelection.selectLeft(n);return this;}},{key:"selectRight",value:function MultiSelection_selectRight_(n){this.defaultSelection.selectRight(n);return this;}},{key:"selectUp",value:function MultiSelection_selectUp_(n,useScreenPosition){this.defaultSelection.selectUp(n,useScreenPosition);return this;}},{key:"selectDown",value:function MultiSelection_selectDown_(n,useScreenPosition){this.defaultSelection.selectDown(n,useScreenPosition);return this;}},{key:"goUp",value:function MultiSelection_goUp_(n,useScreenPosition){return this.defaultSelection.goUp(n,useScreenPosition);}},{key:"goDown",value:function MultiSelection_goDown_(n,useScreenPosition){return this.defaultSelection.goDown(n,useScreenPosition);}},{key:"goLeft",value:function MultiSelection_goLeft_(n){return this.defaultSelection.goLeft(n);}},{key:"goRight",value:function MultiSelection_goRight_(n){return this.defaultSelection.goRight(n);}},{key:"cursorVisible",get:function get(){return this.defaultSelection.cursorVisible;}},{key:"style",set:function set(style){this.defaultSelection.style=style;}},{key:"getTextAttributes",value:function MultiSelection_getTextAttributes_(){return this.defaultSelection.getTextAttributes();}},{key:"toString",value:function MultiSelection_toString_(){return"MultiSelection(".concat(this.selections.join(", "),")");}},{key:"mergeSelections",value:function MultiSelection_mergeSelections_(){var sels=this.selections.slice();for(var _i112=sels.length-1;_i112>=0;_i112--){for(var _j13=sels.length-1;_j13>=0;_j13--){if(_i112===_j13)continue;if(sels[_j13].mergeWith(sels[_i112])){sels.splice(_i112,1);break;}}}this.selections=sels;}},{key:"ranges",get:function get(){return this.selections.map(function(ea){return ea.range;});}},{key:"ranges",set:function set(ranges){for(var i=0;i<ranges.length;i++){var sel=this.selections[i];if(sel)sel.range=ranges[i];else this.addRange(ranges[i],false);}this.removeSelections(i);this.mergeSelections();}},{key:"addRange",value:function MultiSelection_addRange_(range){var mergeSelections=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.selections.push(new __varRecorder__$I.Selection(this.textMorph,range));if(mergeSelections){this.mergeSelections();}return __varRecorder__$I.arr.last(this.selections).range;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"MultiSelection";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/selection.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:9252,end:13920});}(__varRecorder__$I.Selection);__varRecorder__$I.MultiSelection=MultiSelection;__varRecorder__$I.MultiSelection=MultiSelection;__varRecorder__$I.MultiSelection=MultiSelection;var __varRecorder__$J=lively.FreezerRuntime.recorderFor("lively.morphic/text/attributes.js");function shallowEquals(obj1,obj2){if(!obj1||!obj2)return obj1==obj2;var areEqual=true;var seen={};for(var key1 in obj1){seen[key1]=true;if(!obj2.hasOwnProperty(key1)||obj1[key1]!==obj2[key1]){areEqual=false;break;}}if(areEqual){for(var key2 in obj2){if(seen[key2])continue;if(!obj1.hasOwnProperty(key2)||obj1[key2]!==obj2[key2]){areEqual=false;break;}}}return areEqual;}__varRecorder__$J.shallowEquals=shallowEquals;function concatAttributePair(text1,attr1,text2,attr2){var seperator=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";var isObj1=typeof text1!=="string";var isObj2=typeof text2!=="string";if(isObj1||isObj2){var result=[];if(isObj1){result.push(text1,attr1);}else result.push(text1+seperator,attr1);if(isObj2){result.push(text2,attr2);}else result.push(text2+seperator,attr2);return result;}if(!attr1&&!attr2)return[text1+seperator+text2,attr1];if(attr1==attr2)return[text1+seperator+text2,attr1];if(!attr1||!attr2)return[text1+seperator,attr1,text2,attr2];return __varRecorder__$J.shallowEquals(attr1,attr2)?[text1+seperator+text2,attr1]:[text1+seperator,attr1,text2,attr2];}__varRecorder__$J.concatAttributePair=concatAttributePair;function joinTextAttributes(textAttributes){var seperator=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";if(textAttributes.length<=2)return textAttributes;var result=[];var _textAttributes=_slicedToArray2(textAttributes,2),text=_textAttributes[0],attr=_textAttributes[1];for(var _i113=2;_i113<textAttributes.length;_i113=_i113+2){var nextText=textAttributes[_i113];var nextAttr=textAttributes[_i113+1];var merged=__varRecorder__$J.concatAttributePair(text,attr,nextText,nextAttr,seperator);if(merged.length<=2){text=merged[0];attr=merged[1];}else{result.push.apply(result,_toConsumableArray2(merged.slice(0,-2)));var _merged$slice=merged.slice(-2);var _merged$slice2=_slicedToArray2(_merged$slice,2);text=_merged$slice2[0];attr=_merged$slice2[1];}}result.push(text,attr);return result;}__varRecorder__$J.joinTextAttributes=joinTextAttributes;function splitTextAndAttributesAt(textAndAttributes,column){var textPos=0;for(var _i114=0;_i114<textAndAttributes.length;_i114=_i114+2){var text=textAndAttributes[_i114];var textEndPos=textPos+(typeof text==="string"?text.length:1);if(textEndPos<column){textPos=textEndPos;continue;}if(textPos===column){return[textAndAttributes.slice(0,_i114),textAndAttributes.slice(_i114)];}if(textEndPos===column){return[textAndAttributes.slice(0,_i114+2),textAndAttributes.slice(_i114+2)];}if(typeof text!=="string"){throw new Error("Assuming text is a string for splitting it, got ".concat(text," instead!"));}var attr=textAndAttributes[_i114+1];var sliceI=column-textPos;var before=[].concat(_toConsumableArray2(textAndAttributes.slice(0,_i114)),[text.slice(0,sliceI),attr]);var after=text.length===sliceI?textAndAttributes.slice(_i114+2):[text.slice(column-textPos),attr].concat(_toConsumableArray2(textAndAttributes.slice(_i114+2)));return[before,after];}return[textAndAttributes,[]];}__varRecorder__$J.splitTextAndAttributesAt=splitTextAndAttributesAt;function splitTextAndAttributesAtColumns(textAndAttributes,columns){var current=textAndAttributes;var offset=0;var result=[];for(var _i115=0;_i115<columns.length;_i115++){var _varRecorder__$J$spl=__varRecorder__$J.splitTextAndAttributesAt(current,columns[_i115]-offset),_varRecorder__$J$spl2=_slicedToArray2(_varRecorder__$J$spl,2),left=_varRecorder__$J$spl2[0],right=_varRecorder__$J$spl2[1];result.push(left);for(var _j14=0;_j14<left.length;_j14=_j14+2){offset=offset+(typeof left[_j14]==="string"?left[_j14].length:1);}current=right;}result.push(current);return result;}__varRecorder__$J.splitTextAndAttributesAtColumns=splitTextAndAttributesAtColumns;function concatTextAndAttributes(a,b){var mutate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!a.length||a.length===2&&a[0]==""){return mutate?b:b.slice();}if(!b.length||b.length===2&&b[0]==""){return mutate?a:a.slice();}var result=mutate?a:a.slice();for(var _i116=0;_i116<b.length;_i116=_i116+2){var text=b[_i116];var attr=b[_i116+1];result.push(text,attr);}return result;}__varRecorder__$J.concatTextAndAttributes=concatTextAndAttributes;function modifyAttributesInRange(doc,range,modifyFn){var start=range.start,end=range.end;if(__varRecorder__$J.eqPosition(start,end))return null;if(__varRecorder__$J.lessPosition(end,start)){var _ref94=[end,start];start=_ref94[0];end=_ref94[1];}var _start=start,startRow=_start.row,startColumn=_start.column;var _end=end,endRow=_end.row,endColumn=_end.column;var line=doc.getLine(startRow);{var textAndAttributes=line.textAndAttributes;var offset=0;var _varRecorder__$J$spl3=__varRecorder__$J.splitTextAndAttributesAt(textAndAttributes,startColumn),_varRecorder__$J$spl4=_slicedToArray2(_varRecorder__$J$spl3,2),before=_varRecorder__$J$spl4[0],attrs1=_varRecorder__$J$spl4[1];var after;textAndAttributes.length=0;__varRecorder__$J.textAndAttributesDo(before,function(text,attr){offset=offset+(typeof text==="string"?text.length:1);textAndAttributes.push(text,attr);});if(startRow===endRow){var _varRecorder__$J$spl5=__varRecorder__$J.splitTextAndAttributesAt(attrs1,endColumn-offset);var _varRecorder__$J$spl6=_slicedToArray2(_varRecorder__$J$spl5,2);attrs1=_varRecorder__$J$spl6[0];after=_varRecorder__$J$spl6[1];}__varRecorder__$J.textAndAttributesDo(attrs1,function(text,attr){return textAndAttributes.push(text,modifyFn(line,attr));});if(startRow===endRow){__varRecorder__$J.textAndAttributesDo(after,function(text,attr){return textAndAttributes.push(text,attr);});}line._textAttributes=null;line.textAndAttributes=__varRecorder__$J.joinTextAttributes(textAndAttributes);if(startRow===endRow)return;}var _loop9=function _loop9(_i117){line=line.nextLine();var textAndAttributes=line.textAndAttributes;var textAndAttributesToModify=textAndAttributes.slice();textAndAttributes.length=0;__varRecorder__$J.textAndAttributesDo(textAndAttributesToModify,function(text,attr){return textAndAttributes.push(text,modifyFn(line,attr));});line._textAttributes=null;line.textAndAttributes=__varRecorder__$J.joinTextAttributes(textAndAttributes);};for(var _i117=startRow+1;_i117<endRow;_i117++){_loop9(_i117);}{line=line.nextLine();var _textAndAttributes=line.textAndAttributes;var _varRecorder__$J$spl7=__varRecorder__$J.splitTextAndAttributesAt(_textAndAttributes,endColumn),_varRecorder__$J$spl8=_slicedToArray2(_varRecorder__$J$spl7,2),attrsLast=_varRecorder__$J$spl8[0],_after=_varRecorder__$J$spl8[1];_textAndAttributes.length=0;__varRecorder__$J.textAndAttributesDo(attrsLast,function(text,attr){return _textAndAttributes.push(text,modifyFn(line,attr));});__varRecorder__$J.textAndAttributesDo(_after,function(text,attr){return _textAndAttributes.push(text,attr);});line._textAttributes=null;line.textAndAttributes=__varRecorder__$J.joinTextAttributes(_textAndAttributes);}}__varRecorder__$J.modifyAttributesInRange=modifyAttributesInRange;function textAndAttributesWithSubRanges(start,textAndAttributes){var column=start.column,row=start.row;var ranges=[];var textAndAttributesIntoLines=[];var _iterator74=_createForOfIteratorHelper(__varRecorder__$J.splitTextAndAttributesIntoLines(textAndAttributes)),_step74;try{for(_iterator74.s();!(_step74=_iterator74.n()).done;){var lineTextAndAttributes=_step74.value;for(var _i118=0;_i118<lineTextAndAttributes.length;_i118=_i118+2){var part=lineTextAndAttributes[_i118];var endColumn=column+(typeof part==="string"?part.length:1);ranges.push({start:{row:row,column:column},end:{row:row,column:endColumn}});textAndAttributesIntoLines.push(lineTextAndAttributes[_i118],lineTextAndAttributes[_i118+1]);column=endColumn;}column=0;row++;}}catch(err){_iterator74.e(err);}finally{_iterator74.f();}return{ranges:ranges,textAndAttributes:textAndAttributesIntoLines};}__varRecorder__$J.textAndAttributesWithSubRanges=textAndAttributesWithSubRanges;function textAndAttributesDo(textAndAttributes,doFn){for(var _i119=0;_i119<textAndAttributes.length;_i119=_i119+2){doFn(textAndAttributes[_i119],textAndAttributes[_i119+1]);}}__varRecorder__$J.textAndAttributesDo=textAndAttributesDo;function splitTextAndAttributesIntoLines(textAndAttributes){var nl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"\n";if(!textAndAttributes.length)return[];var lines=[];var attrsSoFar=[];for(var _i120=0;_i120<textAndAttributes.length;_i120=_i120+2){var text=textAndAttributes[_i120];var attr=textAndAttributes[_i120+1];if(typeof text!=="string"){attrsSoFar.push(text,attr);continue;}while(text.length){var lineSplit=text.indexOf(nl);if(lineSplit===-1){attrsSoFar.push(text,attr);break;}if(lineSplit>0){attrsSoFar.push(text.slice(0,lineSplit),attr);}lines.push(attrsSoFar);text=text.slice(lineSplit+1);attrsSoFar=[];}}if(attrsSoFar.length){lines.push(attrsSoFar);}else{var _textAndAttributes$sl=textAndAttributes.slice(-2),_textAndAttributes$sl2=_slicedToArray2(_textAndAttributes$sl,2),lastText=_textAndAttributes$sl2[0],lastAttr=_textAndAttributes$sl2[1];if(typeof lastText==="string"&&lastText.endsWith(nl)){lines.push(["",lastAttr]);}}return lines;}__varRecorder__$J.splitTextAndAttributesIntoLines=splitTextAndAttributesIntoLines;__varRecorder__$J.eqPosition=eqPosition;__varRecorder__$J.lessPosition=lessPosition;__varRecorder__$J.shallowEquals=shallowEquals;__varRecorder__$J.shallowEquals=shallowEquals;__varRecorder__$J.concatAttributePair=concatAttributePair;__varRecorder__$J.concatAttributePair=concatAttributePair;__varRecorder__$J.joinTextAttributes=joinTextAttributes;__varRecorder__$J.joinTextAttributes=joinTextAttributes;__varRecorder__$J.splitTextAndAttributesAt=splitTextAndAttributesAt;__varRecorder__$J.splitTextAndAttributesAt=splitTextAndAttributesAt;__varRecorder__$J.splitTextAndAttributesAtColumns=splitTextAndAttributesAtColumns;__varRecorder__$J.splitTextAndAttributesAtColumns=splitTextAndAttributesAtColumns;__varRecorder__$J.concatTextAndAttributes=concatTextAndAttributes;__varRecorder__$J.concatTextAndAttributes=concatTextAndAttributes;__varRecorder__$J.modifyAttributesInRange=modifyAttributesInRange;__varRecorder__$J.modifyAttributesInRange=modifyAttributesInRange;__varRecorder__$J.textAndAttributesWithSubRanges=textAndAttributesWithSubRanges;__varRecorder__$J.textAndAttributesWithSubRanges=textAndAttributesWithSubRanges;__varRecorder__$J.splitTextAndAttributesIntoLines=splitTextAndAttributesIntoLines;__varRecorder__$J.splitTextAndAttributesIntoLines=splitTextAndAttributesIntoLines;var __varRecorder__$K=lively.FreezerRuntime.recorderFor("lively.morphic/text/document.js");__varRecorder__$K.arr=arr;__varRecorder__$K.num=num;__varRecorder__$K.string=string;__varRecorder__$K.lessEqPosition=lessEqPosition;__varRecorder__$K.minPosition=minPosition;__varRecorder__$K.maxPosition=maxPosition;__varRecorder__$K.lessPosition=lessPosition;__varRecorder__$K.eqPosition=eqPosition;__varRecorder__$K.concatTextAndAttributes=concatTextAndAttributes;__varRecorder__$K.splitTextAndAttributesAtColumns=splitTextAndAttributesAtColumns;__varRecorder__$K.splitTextAndAttributesIntoLines=splitTextAndAttributesIntoLines;__varRecorder__$K.joinTextAttributes=joinTextAttributes;__varRecorder__$K.modifyAttributesInRange=modifyAttributesInRange;__varRecorder__$K.concatAttributePair=concatAttributePair;__varRecorder__$K.splitTextAndAttributesAt=splitTextAndAttributesAt;var objectReplacementChar="\uFFFD";__varRecorder__$K.objectReplacementChar=objectReplacementChar;__varRecorder__$K.objectReplacementChar=objectReplacementChar;__varRecorder__$K.objectReplacementChar=objectReplacementChar;__varRecorder__$K.defaultOptions={maxLeafSize:3,minLeafSize:2,leafSplit:0.5,maxNodeSize:10,minNodeSize:5,nodeSplit:0.5};var TreeNode=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/document.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TreeNode")&&typeof __lively_classholder__.TreeNode==="function"?__lively_classholder__.TreeNode:__lively_classholder__.TreeNode=function TreeNode(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function TreeNode_initialize_(parent){this.parent=parent;}},{key:"root",get:function get(){return this.parent?this.parent.root:this;}},{key:"isRoot",get:function get(){return!this.parent;}},{key:"withParents",value:function TreeNode_withParents_(){var node=this;var result=[];while(node){result.push(node);node=node.parent;}return result;}},{key:"traverse",value:function TreeNode_traverse_(doFn){var result=[doFn.call(null,this)];if(this.isLeaf)return result;for(var _i121=0;_i121<this.children.length;_i121++){result.push.apply(result,_toConsumableArray2(this.children[_i121].traverse(doFn)));}return result;}},{key:"consistencyCheck",value:function TreeNode_consistencyCheck_(){var report=[];var isRoot=this.isRoot,isLeaf=this.isLeaf,children=this.children,size=this.size,stringSize=this.stringSize,height=this.height,width=this.width,_this$options=this.options,maxLeafSize=_this$options.maxLeafSize,maxNodeSize=_this$options.maxNodeSize,minLeafSize=_this$options.minLeafSize,minNodeSize=_this$options.minNodeSize;if(!isRoot&&size===0){report.push({error:"size of ".concat(this," expected to be > 0!")});}if(!Array.isArray(children)){report.push({error:"".concat(this,".children is not an array but ").concat(children)});return report;}var sumChildSizes=__varRecorder__$K.arr.sum(__varRecorder__$K.arr.pluck(children,"size"));if(sumChildSizes!=size){report.push({error:"Sum of child sizes is not size of ".concat(this,": ").concat(sumChildSizes," != ").concat(size)});}var sumChildrenStringSize=__varRecorder__$K.arr.sum(__varRecorder__$K.arr.pluck(children,"stringSize"));if(sumChildrenStringSize!=stringSize){report.push({error:"Sum of child stringSize is not stringSIze of ".concat(this,": ").concat(sumChildrenStringSize," != ").concat(stringSize)});}var sumChildrenHeight=__varRecorder__$K.arr.sum(__varRecorder__$K.arr.pluck(children,"height"));if(Number.parseInt(sumChildrenHeight)!=Number.parseInt(height)){report.push({error:"Sum of child Height is not Height of ".concat(this,": ").concat(sumChildrenHeight," != ").concat(height)});}var maxWidth=children.length?Math.max.apply(null,__varRecorder__$K.arr.pluck(children,"width")):0;var hasEstimatedLine=children.find(function(child){return child.isLine&&child.hasEstimatedExtent;});if(hasEstimatedLine?Number.parseInt(maxWidth)>Number.parseInt(width):Number.parseInt(maxWidth)!=Number.parseInt(width)){report.push({error:"max width of children of ".concat(this," is not node width: ").concat(maxWidth," != ").concat(width)});}var max=isLeaf?maxLeafSize:maxNodeSize;var min=isLeaf?minLeafSize:minNodeSize;if(!isRoot&&children.length>max){report.push({error:"children count of ".concat(this," expected to be between ").concat(min," and ").concat(max," but is ").concat(children.length)});}for(var _i122=0;_i122<children.length;_i122++){var child=children[_i122];if(!child){report.push({error:"child ".concat(_i122," of ").concat(this," is nullish!")});continue;}if(isLeaf&&!child.isLine){report.push({error:"child ".concat(_i122," of leaf ").concat(this," is not a line!")});}else if(!isLeaf&&child.isLine){report.push({error:"child of non-leaf ".concat(this," is a line!")});}if(this!==child.parent){report.push({error:"child.parent is ".concat(child.parent," but should be ").concat(this)});}}report.push.apply(report,_toConsumableArray2(__varRecorder__$K.arr.flatmap(children,function(ea){return ea.consistencyCheck();})));return report;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TreeNode";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/document.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1422,end:4636});}(undefined);var InnerTreeNode=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/document.js");var __lively_class__=__lively_classholder__.hasOwnProperty("InnerTreeNode")&&typeof __lively_classholder__.InnerTreeNode==="function"?__lively_classholder__.InnerTreeNode:__lively_classholder__.InnerTreeNode=function InnerTreeNode(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function InnerTreeNode_initialize_(spec){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,spec.parent);this.options=spec.options;this.children=spec.children;this.size=spec.size;this.stringSize=spec.stringSize;this.height=spec.height;this.width=spec.width;this.isLeaf=true;}},{key:"isNode",get:function get(){return true;}},{key:"resize",value:function InnerTreeNode_resize_(n,height,stringSize){this.size=this.size+n;this.height=this.height+height;this.stringSize=this.stringSize+stringSize;var maxWidth=0;for(var _i123=0;_i123<this.children.length;_i123++){var _w5=this.children[_i123].width;if(_w5>maxWidth)maxWidth=_w5;}this.width=maxWidth;this.parent&&this.parent.resize(n,height,stringSize);}},{key:"lines",value:function InnerTreeNode_lines_(){var result=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(this.isLeaf){result.push.apply(result,_toConsumableArray2(this.children));return result;}for(var _i124=0;_i124<this.children.length;_i124++){this.children[_i124].lines(result);}return result;}},{key:"findRow",value:function InnerTreeNode_findRow_(row){if(row<0||row>=this.size)return null;if(this.isLeaf)return this.children[row];for(var _i125=0;_i125<this.children.length;_i125++){var child=this.children[_i125];var childSize=child.size;if(row<childSize)return child.findRow(row);row=row-childSize;}return null;}},{key:"findLineByVerticalOffset",value:function InnerTreeNode_findLineByVerticalOffset_(y){var lineY=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var row=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(y<0||y>this.height)return null;for(var _i126=0;_i126<this.children.length;_i126++){var child=this.children[_i126];var childHeight=child.height;if(y<=childHeight){return this.isLeaf?{line:child,offset:y,y:lineY,row:row}:child.findLineByVerticalOffset(y,lineY,row);}y=y-childHeight;lineY=lineY+childHeight;row=row+child.size;}return null;}},{key:"computeVerticalOffsetOf",value:function InnerTreeNode_computeVerticalOffsetOf_(row){var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(row<0||row>=this.size){console.warn("strange row in computeVerticalOffsetOf: ".concat(row));return y;}if(this.isLeaf){for(var _i127=0;_i127<Math.min(row,this.children.length);_i127++){y=y+this.children[_i127].height;}return y;}for(var _i128=0;_i128<this.children.length;_i128++){var child=this.children[_i128];var childSize=child.size;if(row<childSize)return child.computeVerticalOffsetOf(row,y);row=row-childSize;y=y+child.height;}return y;}},{key:"ensureLine",value:function InnerTreeNode_ensureLine_(lineSpec){if(!lineSpec)lineSpec="";var isString=typeof lineSpec==="string";if(!isString&&lineSpec.isLine){lineSpec.parent=this;return lineSpec;}var textAndAttributes=isString?[lineSpec,null]:lineSpec.textAndAttributes||[lineSpec.text||"",null];var width=isString?0:lineSpec.width||0;var height=isString?0:lineSpec.height||0;return new __varRecorder__$K.Line({parent:this,width:width,height:height,textAndAttributes:textAndAttributes});}},{key:"insert",value:function InnerTreeNode_insert_(lineSpecs){var atIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.size;var children=this.children,options=this.options,isLeaf=this.isLeaf;if(isLeaf){var _lines2=[];var height=0;var stringSize=0;for(var i=0;i<lineSpecs.length;i++){var line=this.ensureLine(lineSpecs[i]);_lines2.push(line);height=height+line.height;stringSize=stringSize+line.stringSize;children.splice(atIndex++,0,line);}this.resize(_lines2.length,height,stringSize);this.balanceAfterGrowth();return _lines2;}if(children.length===0){children.push(new __varRecorder__$K.InnerTreeNode({parent:this,children:[],size:0,stringSize:0,width:0,height:0,options:options}));}var i=0;for(;i<children.length;i++){var child=children[i];var childSize=child.size;if(atIndex<=childSize){return child.insert(lineSpecs,atIndex);}atIndex=atIndex-childSize;}var last=children[i-1];return last.insert(lineSpecs,last.size);}},{key:"withParentChainsUpToCommonParentDo",value:function InnerTreeNode_withParentChainsUpToCommonParentDo_(otherNode,otherNodeAndParentsDoFunc,thisNodeAndParentsDoFunc){var myParents=this.withParents();var currentOtherNode=otherNode;var commonParent;var otherI=0;while(currentOtherNode){if(myParents.includes(currentOtherNode)){commonParent=currentOtherNode;break;}otherNodeAndParentsDoFunc(currentOtherNode,otherI++);currentOtherNode=currentOtherNode.parent;}var commonParentIndex=myParents.indexOf(commonParent);if(commonParentIndex<0)commonParentIndex=myParents.length;var thisNodeAndParents=myParents.slice(0,commonParentIndex);for(var _i129=0;_i129<thisNodeAndParents.length;_i129++){thisNodeAndParentsDoFunc(thisNodeAndParents[_i129],_i129);}}},{key:"findLineWithTextIndex",value:function InnerTreeNode_findLineWithTextIndex_(textIndex){var row=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(this.isLeaf){for(var _i130=0;_i130<this.children.length;_i130++){var _line=this.children[_i130];var _stringSize=_line.stringSize;if(textIndex<_stringSize){return{line:_line,column:textIndex,row:row};}textIndex=textIndex-_stringSize;row++;}var line=__varRecorder__$K.arr.last(this.children);var stringSize=line.stringSize;return{line:line,row:row-1,column:stringSize-1};}var localIndex=0;for(var _i131=0;_i131<this.children.length;_i131++){var node=this.children[_i131];var _stringSize2=node.stringSize;if(textIndex<localIndex+_stringSize2){return node.findLineWithTextIndex(textIndex-localIndex,row);}row=row+node.size;localIndex=localIndex+_stringSize2;}return __varRecorder__$K.arr.last(this.children).findLineWithTextIndex(textIndex-localIndex);}},{key:"findLeafs",value:function InnerTreeNode_findLeafs_(fromRow,toRow){var baseIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(fromRow>baseIndex+this.size||toRow<baseIndex)return[];if(this.isLeaf){var firstLine=Math.max(0,fromRow-baseIndex);var _max2=this.children.length-1;var lastLine=Math.min(_max2,toRow-baseIndex);var full=false;if(firstLine===0&&lastLine===_max2){full=true;lastLine=_max2;}return[{node:this,firstLine:firstLine,lastLine:lastLine,full:full}];}var result=[];for(var _i132=0;_i132<this.children.length;_i132++){var _c8=this.children[_i132];result.push.apply(result,_toConsumableArray2(_c8.findLeafs(fromRow,toRow,baseIndex)));baseIndex=baseIndex+_c8.size;}return result;}},{key:"removeFromToInRoot",value:function InnerTreeNode_removeFromToInRoot_(fromIndex,toIndex,debug){var _this147=this;if(!this.isRoot){throw new Error("removeFromTo() should be called on the root node");}if(fromIndex>toIndex){var _ref95=[toIndex,fromIndex];fromIndex=_ref95[0];toIndex=_ref95[1];}var size=this.size,_this$options2=this.options,maxLeafSize=_this$options2.maxLeafSize,minLeafSize=_this$options2.minLeafSize;var leafs=this.findLeafs(fromIndex,toIndex);var first=leafs.shift();var last=leafs.pop();var toRemove=leafs;var rebalance=[];var firstLeftSibling;var lastRightSibling;var firstNeedsMerge=false;var lastNeedsMerge=false;if(fromIndex>=size)return;if(last&&first.node===last.node)last=null;if(first.full){debug&&debug.log("Removing complete first line ".concat(first));toRemove.push(first);}else{var lastLine=first.lastLine,firstLine=first.firstLine,children=first.node.children;var _n6=lastLine-firstLine+1;firstNeedsMerge=children.length-_n6<minLeafSize;}if(last){if(last.full){debug&&debug.log("Removing complete last line ".concat(last));toRemove.push(last);}else{var _last=last,_lastLine=_last.lastLine,_firstLine=_last.firstLine,_children=_last.node.children;var _n7=_lastLine-_firstLine+1;lastNeedsMerge=_children.length-_n7<minLeafSize;}}if(firstNeedsMerge||lastNeedsMerge){var prevLine=first.node.children[0].prevLine();firstLeftSibling=prevLine?prevLine.parent:null;var nextLine=__varRecorder__$K.arr.last(last?last.node.children:first.node.children).nextLine();lastRightSibling=nextLine?nextLine.parent:null;}for(var _i133=0;_i133<toRemove.length;_i133++){var node=toRemove[_i133].node;var _n8=node.children.length;var height=0;var stringSize=0;for(var _j15=0;_j15<_n8;_j15++){var ea=node.children[_j15];height=height+ea.height;stringSize=stringSize+ea.stringSize;ea.parent=null;}node.children.length=0;node.resize(-_n8,-height,-stringSize);var _p14=node.parent;if(_p14){node.parent=null;_p14.children.splice(_p14.children.indexOf(node),1);if(!rebalance.includes(_p14))rebalance.push(_p14);}}if(!first.full){var _lastLine2=first.lastLine,_firstLine2=first.firstLine,_node=first.node;var _children2=_node.children,options=_node.options;var _n9=_lastLine2-_firstLine2+1;var removedLines=_children2.splice(_firstLine2,_n9);var _height2=0;var _stringSize3=0;for(var _j16=0;_j16<removedLines.length;_j16++){var _ea=removedLines[_j16];_height2=_height2+_ea.height;_stringSize3=_stringSize3+_ea.stringSize;_ea.parent=null;}_node.resize(-_n9,-_height2,-_stringSize3);}if(last&&!last.full){var _last2=last,_lastLine3=_last2.lastLine,_firstLine3=_last2.firstLine,_node2=_last2.node;var _children3=_node2.children;var _n10=_lastLine3-_firstLine3+1;var _removedLines=_children3.splice(_firstLine3,_n10);var _height3=0;var _stringSize4=0;for(var _j17=0;_j17<_removedLines.length;_j17++){var _ea2=_removedLines[_j17];_height3+=_ea2.height;_stringSize4+=_ea2.stringSize;_ea2.parent=null;}_node2.resize(-_n10,-_height3,-_stringSize4);}debug&&debug.dump("".concat(this.print(false)));if(firstNeedsMerge){first.node.balanceByMergeOrTheft(firstLeftSibling,!last||last.full?lastRightSibling:last.node,debug);}if(last&&lastNeedsMerge&&last.node.root===this){var okToMergeLast=true;var leftNode=first.full||!first.node.parent?firstLeftSibling:first.node;if(firstNeedsMerge){if(last.node.root!==this)okToMergeLast=false;if(leftNode&&leftNode.root!==this)leftNode=null;if(lastRightSibling&&lastRightSibling.root!==this)lastRightSibling=null;}if(okToMergeLast){last.node.balanceByMergeOrTheft(leftNode,lastRightSibling,debug);}}rebalance.forEach(function(ea){return ea.root===_this147&&ea.balanceAfterShrink(debug);});}},{key:"balanceByMergeOrTheft",value:function InnerTreeNode_balanceByMergeOrTheft_(leftSibling,rightSibling,debug){var _this148=this;var children=this.children,options=this.options,isLeaf=this.isLeaf;var maxChildren=isLeaf?options.maxLeafSize:options.maxNodeSize;var minChildren=isLeaf?options.minLeafSize:options.minNodeSize;var needsChange=children.length<minChildren;var mergeLeft=leftSibling&&leftSibling.children.length+children.length<=maxChildren;var mergeRight=!mergeLeft&&rightSibling&&rightSibling.children.length+children.length<=maxChildren;var mergeTarget=mergeLeft?leftSibling:mergeRight?rightSibling:null;if(mergeTarget){var _mergeTarget$children,_mergeTarget$children2;debug&&debug.log("[balanceByMergeOrTheft] merging ".concat(this," ").concat(mergeLeft?"left":"right"," into ").concat(mergeTarget));var mySize=this.size,myWidth=this.width,myHeight=this.height,myStringSize=this.stringSize;children.forEach(function(ea){return ea.parent=mergeTarget;});if(mergeLeft)(_mergeTarget$children=mergeTarget.children).push.apply(_mergeTarget$children,_toConsumableArray2(children));else(_mergeTarget$children2=mergeTarget.children).unshift.apply(_mergeTarget$children2,_toConsumableArray2(children));children.length=0;this.width=0;this.withParentChainsUpToCommonParentDo(mergeTarget,function(mergeNodeOrParent){if(myWidth>mergeNodeOrParent.width)mergeNodeOrParent.width=myWidth;mergeNodeOrParent.height=mergeNodeOrParent.height+myHeight;mergeNodeOrParent.size=mergeNodeOrParent.size+mySize;mergeNodeOrParent.stringSize=mergeNodeOrParent.stringSize+myStringSize;},function(thisOrParent){if(myWidth===thisOrParent.width){for(var _i134=0;_i134<thisOrParent.children.length;_i134++){var child=thisOrParent.children[_i134];if(child.width>thisOrParent.width){thisOrParent.width=child.width;}}}thisOrParent.height=thisOrParent.height-myHeight;thisOrParent.size=thisOrParent.size-mySize;thisOrParent.stringSize=thisOrParent.stringSize-myStringSize;});}else{var stealLeftN=leftSibling?Math.ceil((leftSibling.children.length-minChildren)/2):0;var stealRightN=rightSibling?Math.ceil((rightSibling.children.length-minChildren)/2):0;var stealLeft=stealLeftN>0&&stealLeftN>=stealRightN;var stealRight=!stealLeft&&stealRightN>0;if(stealLeft||stealRight){var _this$children,_this$children2;var newChildren=stealLeft?leftSibling.children.splice(leftSibling.children.length-stealLeftN,stealLeftN):rightSibling.children.splice(0,stealRightN);var stealTarget=stealLeft?leftSibling:rightSibling;var stealN=stealLeft?stealLeftN:stealRightN;var stealHeight=0;var stealStringSize=0;var stealMaxWidth=0;var remainingMaxWidth=0;debug&&debug.log("[balanceByMergeOrTheft] ".concat(this," steals from ").concat(stealLeft?"left":"right"," node ").concat(stealTarget," ").concat(stealN," nodes"));for(var _i135=0;_i135<newChildren.length;_i135++){stealHeight=stealHeight+newChildren[_i135].height;stealStringSize=stealStringSize+newChildren[_i135].stringSize;stealMaxWidth=Math.max(stealMaxWidth,newChildren[_i135].width);}for(var _i136=0;_i136<stealTarget.children.length;_i136++){remainingMaxWidth=Math.max(remainingMaxWidth,stealTarget.children[_i136].width);}this.withParentChainsUpToCommonParentDo(stealTarget,function(mergeNodeOrParent){if(remainingMaxWidth<stealMaxWidth&&remainingMaxWidth<mergeNodeOrParent.width){if(mergeNodeOrParent===stealTarget)mergeNodeOrParent.width=remainingMaxWidth;else{var hasWiderChild=false;for(var _i137=0;_i137<mergeNodeOrParent.children.length;_i137++){var child=mergeNodeOrParent.children[_i137];if(child.width>remainingMaxWidth){hasWiderChild=true;break;}}if(!hasWiderChild)mergeNodeOrParent.width=remainingMaxWidth;}mergeNodeOrParent.width=stealMaxWidth;}mergeNodeOrParent.height=mergeNodeOrParent.height-stealHeight;mergeNodeOrParent.size=mergeNodeOrParent.size-stealN;mergeNodeOrParent.stringSize=mergeNodeOrParent.stringSize-stealStringSize;},function(thisOrParent){if(thisOrParent.width<stealMaxWidth)thisOrParent.width=stealMaxWidth;thisOrParent.height=thisOrParent.height+stealHeight;thisOrParent.size=thisOrParent.size+stealN;thisOrParent.stringSize=thisOrParent.stringSize+stealStringSize;});newChildren.forEach(function(ea){return ea.parent=_this148;});if(stealLeft)(_this$children=this.children).unshift.apply(_this$children,_toConsumableArray2(newChildren));else(_this$children2=this.children).push.apply(_this$children2,_toConsumableArray2(newChildren));}}var p=this.parent;if(children.length===0){this.parent=null;p&&p.children.splice(p.children.indexOf(this),1);}p&&p.balanceAfterShrink(debug);}},{key:"balanceAfterGrowth",value:function InnerTreeNode_balanceAfterGrowth_(){var isLeaf=this.isLeaf,size=this.size,stringSize=this.stringSize,parent=this.parent,children=this.children,width=this.width,height=this.height,options=this.options;var maxChildren=isLeaf?options.maxLeafSize:options.maxNodeSize;var split=children.length>maxChildren;if(!split)return;if(!parent){parent=this.parent=new __varRecorder__$K.InnerTreeNode({parent:null,children:[this],size:size,width:width,height:height,stringSize:stringSize,options:options});parent.isLeaf=false;}var splitIndex=Math.floor(children.length/2);var i=0;var mySize=0;var otherSize=0;var myWidth=0;var otherWidth=0;var myHeight=0;var otherHeight=0;var myStringSize=0;var otherStringSize=0;for(;i<splitIndex;i++){mySize=mySize+children[i].size;myWidth=Math.max(myWidth,children[i].width);myHeight=myHeight+children[i].height;myStringSize=myStringSize+children[i].stringSize;}for(;i<children.length;i++){otherSize=otherSize+children[i].size;otherWidth=Math.max(otherWidth,children[i].width);otherHeight=otherHeight+children[i].height;otherStringSize=otherStringSize+children[i].stringSize;}this.children=children.slice(0,splitIndex);this.size=mySize;this.width=myWidth;this.height=myHeight;this.stringSize=myStringSize;var indexInParent=parent.children.indexOf(this);var otherChildren=children.slice(splitIndex);var otherNode=new __varRecorder__$K.InnerTreeNode({parent:parent,children:otherChildren,size:otherSize,height:otherHeight,width:otherWidth,stringSize:otherStringSize,options:options});otherNode.isLeaf=isLeaf;otherChildren.forEach(function(ea){return ea.parent=otherNode;});parent.children.splice(indexInParent+1,0,otherNode);if(otherNode.children.length>maxChildren){otherNode.balanceAfterGrowth();}if(this.children.length>maxChildren){this.balanceAfterGrowth();}this.parent.balanceAfterGrowth();}},{key:"balanceAfterShrink",value:function InnerTreeNode_balanceAfterShrink_(debug){var _this149=this;var isLeaf=this.isLeaf,parent=this.parent,children=this.children,options=this.options;var maxLeafSize=options.maxLeafSize,maxNodeSize=options.maxNodeSize,minLeafSize=options.minLeafSize,minNodeSize=options.minNodeSize;var maxChildren=isLeaf?maxLeafSize:maxNodeSize;var minChildren=isLeaf?minLeafSize:minNodeSize;var removedBecauseEmpty=false;for(var _i138=children.length;_i138--;){if(children[_i138].size===0){children.splice(_i138,1);removedBecauseEmpty=true;debug&&debug.log("[balanceAfterShrink] ".concat(this," removes node ").concat(_i138," b/c it is empty, remaining children: ").concat(children.length," (min: ").concat(minChildren,", max: ").concat(maxChildren,")"));}}if(removedBecauseEmpty){debug&&debug.dump("".concat(this.root.print(false)));}if(children.length>=minChildren){parent&&parent.balanceAfterShrink(debug);return;}if(children.length===0){if(parent){parent.balanceAfterShrink(debug);}return;}if(isLeaf){if(parent){if(parent.children.length===1){var _parent$children;debug&&debug.log("[balanceAfterShrink] ".concat(this," is the only child - will remove it's parent and take its position"));debug&&debug.dump("".concat(this.root.print(false)));this.parent=null;parent.children.length=0;(_parent$children=parent.children).push.apply(_parent$children,_toConsumableArray2(children));children.forEach(function(ea){return ea.parent=parent;});parent.isLeaf=true;}else{var prevLine=children[0].prevLine();var left=prevLine&&prevLine.parent;var nextLine=__varRecorder__$K.arr.last(children).nextLine();var right=nextLine&&nextLine.parent;this.balanceByMergeOrTheft(left,right,debug);}}this.parent&&this.parent.balanceAfterShrink(debug);return;}var grandChildren=[];var hasLeafAsChild=false;var hasNonLeafAsChild=false;var hasMixedChildNodes=false;for(var _i139=0;_i139<children.length;_i139++){var child=children[_i139];if(!hasLeafAsChild&&child.isLeaf)hasLeafAsChild=true;if(!hasNonLeafAsChild&&!child.isLeaf)hasNonLeafAsChild=true;if(hasLeafAsChild&&hasNonLeafAsChild){hasMixedChildNodes=true;break;}grandChildren.push.apply(grandChildren,_toConsumableArray2(child.children));}var leaf=hasLeafAsChild;if(!hasMixedChildNodes&&grandChildren.length<=(leaf?maxLeafSize:maxNodeSize)){debug&&debug.log("[balanceAfterShrink] ".concat(this," grandChildren.length is ").concat(grandChildren.length," and <= max size so it is removing all its children and adopting their children"));children.forEach(function(ea){return ea.parent=null;});grandChildren.forEach(function(ea){return ea.parent=_this149;});children.length=0;children.push.apply(children,grandChildren);this.isLeaf=leaf;debug&&debug.log("[balanceAfterShrink] ".concat(children.join("\n")));debug&&debug.dump("".concat(this.root.print(false)));}parent&&parent.balanceAfterShrink(debug);}},{key:"print",value:function InnerTreeNode_print_(){var _short=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var optName=arguments.length>3?arguments[3]:undefined;var isLeaf=this.isLeaf,size=this.size,stringSize=this.stringSize,width=this.width,height=this.height,children=this.children;var name=optName||(isLeaf?"leaf":"node");var indent=" ".repeat(depth);var printed="".concat(indent).concat(name," (size: ").concat(size," width: ").concat(Math.round(width)," height: ").concat(Math.round(height)," text length: ").concat(stringSize,")");if(children.length){var childrenPrinted="";var childIndex=index+size;for(var _i140=children.length;_i140--;){var child=children[_i140];childIndex=childIndex-child.size;childrenPrinted="\n"+child.print(_short,childIndex,depth+1)+childrenPrinted;}printed+=childrenPrinted;}return printed;}},{key:"toString",value:function InnerTreeNode_toString_(){var isLeaf=this.isLeaf,size=this.size,width=this.width,height=this.height,children=this.children;return"node (".concat(isLeaf?"leaf, ":"")+"".concat(isLeaf&&children.length?"rows: ".concat(children[0].row,"-").concat(__varRecorder__$K.arr.last(children).row," "):"")+"size: ".concat(size," ").concat(width,"x").concat(height,")");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"InnerTreeNode";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/document.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:4638,end:29081});}(__varRecorder__$K.TreeNode);var Line$1=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/document.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Line")&&typeof __lively_classholder__.Line==="function"?__lively_classholder__.Line:__lively_classholder__.Line=function Line(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Line_initialize_(spec){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,spec.parent);this.textAndAttributes=__varRecorder__$K.joinTextAttributes(spec.textAndAttributes||[]);this._text="";this._textAttributes=null;this.width=spec.width;this.height=spec.height;this.hasEstimatedExtent=false;this.modeState=null;this.textAlign="left";this.lineHeight=null;this.marginTop=0;this.marginBottom=0;}},{key:"isLine",get:function get(){return true;}},{key:"size",get:function get(){return 1;}},{key:"stringSize",get:function get(){return this.text.length+1;}},{key:"text",get:function get(){if(this._text)return this._text;var text="";var attrs=this.textAndAttributes;for(var _i141=0;_i141<attrs.length;_i141=_i141+2){text=text+(typeof attrs[_i141]==="string"?attrs[_i141]:__varRecorder__$K.objectReplacementChar);}return this._text=text;}},{key:"textAttributes",get:function get(){if(this._textAttributes)return this._textAttributes;var textAttributes=[];var attrs=this.textAndAttributes;for(var _i142=0;_i142<attrs.length;_i142=_i142+2){var attr=attrs[_i142+1];if(attr&&!textAttributes.includes(attr)){textAttributes.push(attr);}}return this._textAttributes=textAttributes;}},{key:"row",get:function get(){var p=this.parent;if(!p)return 0;var parents=this.withParents();if(parents.length===1){return parents.children.indexOf(this);}var index=0;for(var _i143=parents.length-1;_i143>=1;_i143--){var parent=parents[_i143];var itsParent=parents[_i143-1];var nodeIndex=parent.children.indexOf(itsParent);for(var _j18=0;_j18<nodeIndex;_j18++){index=index+parent.children[_j18].size;}}return index;}},{key:"nextLine",value:function Line_nextLine_(){var parent=this.parent;if(!parent)return null;var next=parent.children[parent.children.indexOf(this)+1];if(next)return next;var root=this.root,row=this.row;return root.findRow(row+1);}},{key:"prevLine",value:function Line_prevLine_(){var parent=this.parent;if(!parent)return null;var prev=parent.children[parent.children.indexOf(this)-1];if(prev)return prev;var root=this.root,row=this.row;return root.findRow(row-1);}},{key:"changeExtent",value:function Line_changeExtent_(newWidth,newHeight){var isEstimated=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var height=this.height,width=this.width,parent=this.parent;this.width=newWidth;this.height=newHeight;this.hasEstimatedExtent=isEstimated;if(width!==newWidth||height!==newHeight){var heightDelta=newHeight-height;while(parent){parent.height=parent.height+heightDelta;if(newWidth>=parent.width){parent.width=newWidth;}else if(width===parent.width){var parentWidth=0;for(var _i144=0;_i144<parent.children.length;_i144++){var _w6=parent.children[_i144].width;if(_w6>parentWidth)parentWidth=_w6;}parent.width=parentWidth;}parent=parent.parent;}}return this;}},{key:"changeText",value:function Line_changeText_(newText){var textAndAttributes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var parent=this.parent,text=this.text,height=this.height;var deltaLength=newText.length+1-(text.length+1);var deltaHeight=0;if(this.modeState&&this.modeState._string!==newText){this.modeState=null;}if(this.height||this.width){this.hasEstimatedExtent=true;}else{this.height=0;this.width=0;this.hasEstimatedExtent=false;deltaHeight=-height;}this._text=newText;this._textAttributes=null;this.textAndAttributes=textAndAttributes||(textAndAttributes=[newText,null]);if(textAndAttributes.length%2!==0){throw new Error("textAndAttributes list is strange, expected flat pairs of text/attr");}for(var _i145=0;_i145<textAndAttributes.length;_i145=_i145+2){var _text2=textAndAttributes[_i145];var attr=textAndAttributes[_i145+1];if(!attr)continue;if(Array.isArray(attr)){throw new Error("invalid attr part of text/attr pair, its an array: "+attr);}}while(parent){parent.stringSize=parent.stringSize+deltaLength;parent.height=parent.height+deltaHeight;var parentWidth=0;for(var _i146=0;_i146<parent.children.length;_i146++){var _w7=parent.children[_i146].width;if(_w7>parentWidth)parentWidth=_w7;}parent.width=parentWidth;parent=parent.parent;}return this;}},{key:"changeTextAndAttributes",value:function Line_changeTextAndAttributes_(textAndAttributes){textAndAttributes=__varRecorder__$K.joinTextAttributes(textAndAttributes);var text="";for(var _i147=0;_i147<textAndAttributes.length;_i147=_i147+2){text=text+(typeof textAndAttributes[_i147]==="string"?textAndAttributes[_i147]:__varRecorder__$K.objectReplacementChar);}return this.changeText(text,textAndAttributes);}},{key:"print",value:function Line_print_(){var _short2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var indent=" ".repeat(depth);var width=this.width,height=this.height,stringSize=this.stringSize,textAndAttributes=this.textAndAttributes;var printed="".concat(indent,"line ").concat(index," (size: 1 width: ").concat(Math.round(width)," height: ").concat(Math.round(height)," text length: ").concat(stringSize);var printedContent=__varRecorder__$K.arr.toTuples(textAndAttributes,2).map(printTextAttrTuple).join(",");return printed+(_short2?")":" content: [".concat(printedContent,"])"));function printTextAttrTuple(_ref96){var _ref97=_slicedToArray2(_ref96,2),content=_ref97[0],attrs=_ref97[1];return(typeof content==="string"?"\"".concat(content,"\""):String(content))+",".concat(JSON.stringify(attrs));}}},{key:"toString",value:function Line_toString_(){var width=this.width,height=this.height,_text=this._text;return"line (\"".concat(__varRecorder__$K.string.truncate(_text,30),"\", ").concat(width,"x").concat(height,")");}},{key:"consistencyCheck",value:function Line_consistencyCheck_(){var report=[];if(!this.parent){report.push("line ".concat(this," has no parent!"));return report;}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Line";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/document.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:29090,end:35532});}(__varRecorder__$K.TreeNode);__varRecorder__$K.Line=Line$1;__varRecorder__$K.Line=Line$1;__varRecorder__$K.Line=Line$1;__varRecorder__$K.documentFuzzier={makeString:function makeString(){var min=arguments.length>0&&arguments[0]!==undefined?arguments[0]:5;var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:50;var chars=__varRecorder__$K.arr.range(65,90).map(function(ea){return String.fromCharCode(ea);}).join("");chars+=chars.toLowerCase()+" \n";var n=__varRecorder__$K.num.random(min,max);return __varRecorder__$K.arr.shuffle(Array.from(chars.repeat(Math.ceil(n/chars.length)))).slice(0,n).join("");},randomDocPosition:function randomDocPosition(doc){var row=doc.rowCount===0?0:__varRecorder__$K.num.random(0,doc.rowCount-1);var column=__varRecorder__$K.num.random(0,doc.getLineString(row).length-1);return{row:row,column:column};},insertRandom:function insertRandom(doc,actions,minLength,maxLength){var content=[this.makeString(minLength,maxLength),null];var pos=this.randomDocPosition(doc);actions.push(["insertTextAndAttributes",content,pos]);doc.insertTextAndAttributes(content,pos);},deleteRandom:function deleteRandom(doc,actions,minLength,maxLength){var range={start:this.randomDocPosition(doc),end:this.randomDocPosition(doc)};actions.push(["remove",range]);doc.remove(range);},maybe:function maybe(){return Math.random()<0.5;},replay:function replay(textMorph,actions){var debug=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var halt=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(debug){textMorph.debug=debug;debug=textMorph.debugHelper();debug.reset();}var doc=new __varRecorder__$K.Document([""]);actions.forEach(function(_ref98,i){var _ref99=_toArray2(_ref98),type=_ref99[0],args=_ref99.slice(1);if(halt&&i==actions.length-1)debugger;doc[type].apply(doc,_toConsumableArray2(args).concat([debug]));});textMorph.changeDocument(doc);},run:function run(){var opts={maxLeafSize:3,minLeafSize:2,leafSplit:0.5,maxNodeSize:10,minNodeSize:5,nodeSplit:0.5};var t=Date.now();var counter=0;var doc=new __varRecorder__$K.Document([],opts);var actions=[];var error;try{while(doc.stringSize<10000&&counter++<10000){if(this.maybe())this.deleteRandom(doc,actions);else this.insertRandom(doc,actions);doc.consistencyCheck();}}catch(err){error=err;}var time=Date.now()-t;return{error:error,doc:doc,actions:actions,time:time};}};__varRecorder__$K.newline="\n";__varRecorder__$K.newlineLength=1;var Document=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/document.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Document")&&typeof __lively_classholder__.Document==="function"?__lively_classholder__.Document:__lively_classholder__.Document=function Document(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Document_initialize_(lines,options){this.options=Object.assign({},__varRecorder__$K.defaultOptions,{},options);this.lines=lines;}},{key:"balance",value:function Document_balance_(){this.root.balanceAfterGrowth();this.fixRoot();}},{key:"fixRoot",value:function Document_fixRoot_(){var newRoot=this.root.root;if(this.root!==newRoot)this.root=newRoot;}},{key:"height",get:function get(){return this.root.height;}},{key:"width",get:function get(){return this.root.width;}},{key:"rowCount",get:function get(){return this.root.size;}},{key:"stringSize",get:function get(){return this.rowCount===0?0:this.root.stringSize-1;}},{key:"lineStrings",get:function get(){return this.lines.map(function(ea){return ea.text;});}},{key:"lines",get:function get(){return this.root.lines();}},{key:"lines",set:function set(){var lines=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this.root=new __varRecorder__$K.InnerTreeNode({parent:null,children:[],size:0,width:0,height:0,stringSize:0,options:this.options});this.insertLines(lines);}},{key:"clipRow",value:function Document_clipRow_(row){return Math.max(0,Math.min(row,this.rowCount-1));}},{key:"clipPositionToLines",value:function Document_clipPositionToLines_(_ref100){var row=_ref100.row,column=_ref100.column;var nLines=this.rowCount;if(nLines===0)return{row:0,column:0};if(row<0)row=0;else if(row>=nLines){row=nLines-1;column=Infinity;}if(column<0)column=0;else{var lineLength=this.getLineString(row).length;if(column>lineLength)column=lineLength;}return{row:row,column:column};}},{key:"findLineByVerticalOffset",value:function Document_findLineByVerticalOffset_(height){return this.root.findLineByVerticalOffset(height);}},{key:"computeVerticalOffsetOf",value:function Document_computeVerticalOffsetOf_(row){return this.root.computeVerticalOffsetOf(row);}},{key:"getLine",value:function Document_getLine_(row){return this.root.findRow(this.clipRow(row));}},{key:"getLineString",value:function Document_getLineString_(row){var line=this.getLine(row);return line?line.text:"";}},{key:"insertLine",value:function Document_insertLine_(text){var atRow=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.root.rowCount;return this.insertLines([text],atRow)[0];}},{key:"removeLine",value:function Document_removeLine_(row){this.root.removeFromToInRoot(row,row);}},{key:"removeLines",value:function Document_removeLines_(fromRow,toRow,debug){this.root.removeFromToInRoot(fromRow,toRow,debug);}},{key:"insertLines",value:function Document_insertLines_(lineSpecs,atRow){var lines=this.root.insert(lineSpecs,atRow);this.fixRoot();return lines;}},{key:"textString",get:function get(){var string="";var lines=this.lines;if(!lines.length)return string;for(var i=0;i<lines.length-1;i++){string=string+lines[i].text+__varRecorder__$K.newline;}string=string+lines[i].text;return string;}},{key:"textString",set:function set(string){this.lines=string.split(__varRecorder__$K.newline);}},{key:"endPosition",get:function get(){var rowCount=this.rowCount;if(rowCount===0)return{row:0,column:0};var row=rowCount-1;var line=this.getLine(row);return{row:row,column:line.stringSize-1};}},{key:"textAndAttributes",get:function get(){var lines=this.lines;if(!lines.length)return[];var nl=__varRecorder__$K.newline;var lastRow=lines.length-1;var result=lines[0].textAndAttributes.slice();for(var row=1;row<=lastRow;row++){var line=lines[row];var lastAttr=result.pop()||null;var lastText=result.pop()||"";var textAndAttributes=line.textAndAttributes;var firstText=textAndAttributes[0]||"";var firstAttr=textAndAttributes[1]||null;result.push.apply(result,_toConsumableArray2(__varRecorder__$K.concatAttributePair(lastText,lastAttr,firstText,firstAttr,nl)));for(var _i148=2;_i148<textAndAttributes.length;_i148=_i148+2){result.push(textAndAttributes[_i148],textAndAttributes[_i148+1]);}}return result;}},{key:"textAndAttributes",set:function set(attrs){this.lines=__varRecorder__$K.splitTextAndAttributesIntoLines(attrs,__varRecorder__$K.newline).map(function(ea){return new __varRecorder__$K.Line({parent:null,width:0,height:0,textAndAttributes:ea});});}},{key:"getTextAndAttributesOfLine",value:function Document_getTextAndAttributesOfLine_(row){return this.getLine(row).textAndAttributes;}},{key:"setTextAndAttributesOfLine",value:function Document_setTextAndAttributesOfLine_(row,attrs){var line=this.getLine(row);line.changeTextAndAttributes(attrs);return attrs;}},{key:"mixinTextAttribute",value:function Document_mixinTextAttribute_(mixinAttr,range){__varRecorder__$K.modifyAttributesInRange(this,range,function(line,attr){line._textAttributes=null;return Object.assign({},attr,mixinAttr);});}},{key:"setTextAttribute",value:function Document_setTextAttribute_(newAttr,range){__varRecorder__$K.modifyAttributesInRange(this,range,function(line,attr){line._textAttributes=null;return newAttr;});}},{key:"mixoutTextAttribute",value:function Document_mixoutTextAttribute_(mixout){var range=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{start:{row:0,column:0},end:this.endPosition};if(!mixout)return;var keys=Object.keys(mixout);__varRecorder__$K.modifyAttributesInRange(this,range,function(line,attr){if(!attr)return attr;line._textAttributes=null;var remaining=0;var mixedout={};for(var key in attr){if(!keys.includes(key)){mixedout[key]=attr[key];remaining++;}}return remaining===0?null:mixedout;});}},{key:"setTextAttributesWithSortedRanges",value:function Document_setTextAttributesWithSortedRanges_(textAttributesAndRanges){if(textAttributesAndRanges.length<2)return;var firstLineStart=textAttributesAndRanges[0].start;var lastLineEnd=textAttributesAndRanges.slice(-2)[0].end;var line=this.getLine(firstLineStart.row);if(firstLineStart.row===lastLineEnd.row){if(firstLineStart.column>=lastLineEnd.column)return;var _textAndAttributesFro=textAndAttributesFromRangedAttributesForRow(firstLineStart.row,line.text,textAttributesAndRanges,0),attrsForRow=_textAndAttributesFro.attributes;var _varRecorder__$K$spl=__varRecorder__$K.splitTextAndAttributesAtColumns(line.textAndAttributes,[firstLineStart.column,lastLineEnd.column]),_varRecorder__$K$spl2=_slicedToArray2(_varRecorder__$K$spl,3),before=_varRecorder__$K$spl2[0],_5=_varRecorder__$K$spl2[1],after=_varRecorder__$K$spl2[2];var _varRecorder__$K$spl3=__varRecorder__$K.splitTextAndAttributesAtColumns(attrsForRow,[firstLineStart.column,lastLineEnd.column]),_varRecorder__$K$spl4=_slicedToArray2(_varRecorder__$K$spl3,3),_6=_varRecorder__$K$spl4[0],inner=_varRecorder__$K$spl4[1],_3=_varRecorder__$K$spl4[2];line.changeTextAndAttributes([].concat(_toConsumableArray2(before),_toConsumableArray2(inner),_toConsumableArray2(after)));return;}var row=firstLineStart.row,firstLineColumn=firstLineStart.column;var index=0;var _textAndAttributesFro2=textAndAttributesFromRangedAttributesForRow(row,line.text,textAttributesAndRanges,index),attrsForFirstRow=_textAndAttributesFro2.attributes,firstLineOffset=_textAndAttributesFro2.index;var _varRecorder__$K$spl5=__varRecorder__$K.splitTextAndAttributesAt(line.textAndAttributes,firstLineColumn),_varRecorder__$K$spl6=_slicedToArray2(_varRecorder__$K$spl5,2),firstLineBefore=_varRecorder__$K$spl6[0],_=_varRecorder__$K$spl6[1];var _varRecorder__$K$spl7=__varRecorder__$K.splitTextAndAttributesAt(attrsForFirstRow,firstLineColumn),_varRecorder__$K$spl8=_slicedToArray2(_varRecorder__$K$spl7,2),_2=_varRecorder__$K$spl8[0],firstLineNewAttrs=_varRecorder__$K$spl8[1];line.changeTextAndAttributes([].concat(_toConsumableArray2(firstLineBefore),_toConsumableArray2(firstLineNewAttrs)));index=firstLineOffset;while(line=line.nextLine()){row++;if(row===lastLineEnd.row)break;var _textAndAttributesFro3=textAndAttributesFromRangedAttributesForRow(row,line.text,textAttributesAndRanges,index),_attrsForRow=_textAndAttributesFro3.attributes,nextIndex=_textAndAttributesFro3.index;index=nextIndex;line.changeTextAndAttributes(_attrsForRow);}if(line){var lastLineColumn=lastLineEnd.column;var _textAndAttributesFro4=textAndAttributesFromRangedAttributesForRow(row,line.text,textAttributesAndRanges,index),attrsForLastRow=_textAndAttributesFro4.attributes;var _varRecorder__$K$spl9=__varRecorder__$K.splitTextAndAttributesAt(line.textAndAttributes,lastLineColumn),_varRecorder__$K$spl10=_slicedToArray2(_varRecorder__$K$spl9,2),_7=_varRecorder__$K$spl10[0],lastLineAfter=_varRecorder__$K$spl10[1];var _varRecorder__$K$spl11=__varRecorder__$K.splitTextAndAttributesAt(attrsForLastRow,lastLineColumn),_varRecorder__$K$spl12=_slicedToArray2(_varRecorder__$K$spl11,1),lastLineNewAttrs=_varRecorder__$K$spl12[0];line.changeTextAndAttributes([].concat(_toConsumableArray2(lastLineNewAttrs),_toConsumableArray2(lastLineAfter)));}function textAndAttributesFromRangedAttributesForRow(row,text,textAttributesAndRanges){var startIndex=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var col=0;var maxCol=text.length;if(textAttributesAndRanges.length-startIndex<=0){return{attributes:[text,null],index:startIndex};}var result=[];var i=startIndex;for(;i<textAttributesAndRanges.length;i=i+2){if(col>=maxCol)break;var _textAttributesAndRan=textAttributesAndRanges[i],start=_textAttributesAndRan.start,end=_textAttributesAndRan.end;var attr=textAttributesAndRanges[i+1];if(end.row<row){col=0;continue;}if(start.row===row&&col<start.column){result.push(text.slice(col,start.column),null);col=start.column;}if(end.row>row){result.push(attr.embeddedMorph||text.slice(col,maxCol),attr);col=maxCol;break;}col<end.column&&result.push(attr.embeddedMorph||text.slice(col,end.column),attr);col=end.column;}if(col<maxCol)result.push(text.slice(col,maxCol),null);return{attributes:result,index:i};}}},{key:"resetTextAttributes",value:function Document_resetTextAttributes_(){var lines=this.lines;lines.forEach(function(line){return line.changeText(line.text);});}},{key:"textAttributeAt",value:function Document_textAttributeAt_(_ref101){var row=_ref101.row,column=_ref101.column;column=Math.max(0,column);var line=this.getLine(row);if(!line)return null;var index=0;var attrs=line.textAndAttributes;for(var _i149=0;_i149<attrs.length;_i149=_i149+2){var text=attrs[_i149];var attr=attrs[_i149+1];index=index+(typeof text==="string"?text.length:1);if(column<index)return attr;}return attrs[attrs.length-1];}},{key:"textAndAttributesInRange",value:function Document_textAndAttributesInRange_(_ref102){var start=_ref102.start,end=_ref102.end;if(__varRecorder__$K.eqPosition(start,end)){return["",null];}if(__varRecorder__$K.lessPosition(end,start)){var _ref103=[end,start];start=_ref103[0];end=_ref103[1];}start=__varRecorder__$K.maxPosition(start,{column:0,row:0});end=__varRecorder__$K.minPosition(end,this.endPosition);var line=this.getLine(start.row);var firstLine=line;if(end.row===start.row){var _from3=start.column;var to=end.column;if(_from3===to)to++;var _varRecorder__$K$spl13=__varRecorder__$K.splitTextAndAttributesAtColumns(firstLine.textAndAttributes,[_from3,to]),_varRecorder__$K$spl14=_slicedToArray2(_varRecorder__$K$spl13,2),_8=_varRecorder__$K$spl14[0],attrs=_varRecorder__$K$spl14[1];return attrs;}var lines=[line];for(var _i150=0;_i150<end.row-start.row;_i150++){lines.push(line=line.nextLine());}var lastLine=lines[lines.length-1];var _varRecorder__$K$spl15=__varRecorder__$K.splitTextAndAttributesAt(firstLine.textAndAttributes,start.column),_varRecorder__$K$spl16=_slicedToArray2(_varRecorder__$K$spl15,2),_=_varRecorder__$K$spl16[0],first=_varRecorder__$K$spl16[1];var _varRecorder__$K$spl17=__varRecorder__$K.splitTextAndAttributesAt(lastLine.textAndAttributes,end.column),_varRecorder__$K$spl18=_slicedToArray2(_varRecorder__$K$spl17,1),last=_varRecorder__$K$spl18[0];if(first.length===0)first=["",null];if(lines.length===1){return __varRecorder__$K.concatTextAndAttributes(first,last,true);}var result=first;for(var _i151=1;_i151<lines.length-1;_i151++){if(typeof result[result.length-2]==="string"){result[result.length-2]=result[result.length-2]+__varRecorder__$K.newline;}__varRecorder__$K.concatTextAndAttributes(result,lines[_i151].textAndAttributes,true);}if(typeof result[result.length-2]==="string"){result[result.length-2]=result[result.length-2]+__varRecorder__$K.newline;}__varRecorder__$K.concatTextAndAttributes(result,last,true);return __varRecorder__$K.joinTextAttributes(result,"");}},{key:"textInRange",value:function Document_textInRange_(_ref104){var start=_ref104.start,end=_ref104.end;start=this.clipPositionToLines(start);end=this.clipPositionToLines(end);if(__varRecorder__$K.lessPosition(end,start)){var _ref105=[end,start];start=_ref105[0];end=_ref105[1];}var _start2=start,row=_start2.row,column=_start2.column;var _end2=end,endRow=_end2.row,endColumn=_end2.column;if(row===endRow){return column===endColumn?"":this.getLineString(row).slice(column,endColumn);}var line=this.getLine(row);var result=line.text.slice(column);while((line=line.nextLine())&&++row<endRow){result+=__varRecorder__$K.newline+line.text;}return result+__varRecorder__$K.newline+this.getLineString(endRow).slice(0,endColumn);}},{key:"setTextInRange",value:function Document_setTextInRange_(string,range){this.remove(range);return this.insertText(string,range.start,false);}},{key:"indexToPosition",value:function Document_indexToPosition_(index){if(index<0)index=0;var _this$root$findLineWi=this.root.findLineWithTextIndex(index,0),row=_this$root$findLineWi.row,column=_this$root$findLineWi.column;return{row:row,column:column};}},{key:"positionToIndex",value:function Document_positionToIndex_(_ref106){var row=_ref106.row,column=_ref106.column;var line=this.getLine(row);column=Math.max(0,Math.min(column,line.stringSize-1));var index=column;var parent=line.parent;var node=line;while(parent){var nodeIndex=parent.children.indexOf(node);var leftSiblings=parent.children.slice(0,nodeIndex);for(var _i152=0;_i152<leftSiblings.length;_i152++){index=index+leftSiblings[_i152].stringSize;}node=parent;parent=parent.parent;}return index;}},{key:"insertTextAndAttributes",value:function Document_insertTextAndAttributes_(textAndAttributes,pos){var debug=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!textAndAttributes||!textAndAttributes.length||textAndAttributes.length===2&&!textAndAttributes[0])return{start:pos,end:pos};if(debug&&!debug.debugDocumentUpdate)debug=false;if(debug&&!debug.log)debug=console;var row=pos.row,column=pos.column;if(row<0)row=0;if(column<0)column=0;var line=this.getLine(row);var attrsForLines=__varRecorder__$K.splitTextAndAttributesIntoLines(textAndAttributes,__varRecorder__$K.newline);if(debug){if(!debug.log){debug={log:console.log.bind(console),dump:console.log.bind(console)};}}if(!line){var _lines3=this.insertLines(attrsForLines.map(function(ea){return new __varRecorder__$K.Line({parent:null,width:0,height:0,textAndAttributes:ea});}));debug&&debug.log("insert ".concat(_lines3.length," lines into empty text"));return{start:{row:0,column:0},end:{row:_lines3.length,column:__varRecorder__$K.arr.last(_lines3).text.length}};}if(row>=this.rowCount){var docEndPos=this.endPosition;debug&&debug.log("insertion after doc end, ".concat(row,"/").concat(column,", inserting ").concat(row-docEndPos.row," rows"));for(var _i153=0;_i153<row-docEndPos.row;_i153++){attrsForLines.unshift(["",null]);}row=docEndPos.row;column=docEndPos.column;}if(attrsForLines.length===1&&attrsForLines[0][0]===""){debug&&debug.log("insert just newline at ".concat(row,"/").concat(column));var splitted=this.splitLineAt({row:row,column:column});debug&&debug.dump("".concat(this.root.print(false)));return splitted;}var firstInsertionLine=attrsForLines.shift();var nInsertionLines=attrsForLines.length;var endPos={row:row,column:column};var lineLength=line.stringSize-1;if(column>lineLength){debug&&debug.log("filling up insertion column at ".concat(row,"/").concat(column,": ").concat(column-lineLength));var fill=" ".repeat(column-lineLength);if(firstInsertionLine.length){if(typeof firstInsertionLine[0]==="string"){firstInsertionLine[0]=fill+firstInsertionLine[0];}else{firstInsertionLine.unshift(fill,null);}}else{firstInsertionLine.push(fill,null);}}var _varRecorder__$K$spl19=__varRecorder__$K.splitTextAndAttributesAt(line.textAndAttributes,column),_varRecorder__$K$spl20=_slicedToArray2(_varRecorder__$K$spl19,2),before=_varRecorder__$K$spl20[0],after=_varRecorder__$K$spl20[1];if(before[0]==="")before=[];var lineTextAndAttributes=__varRecorder__$K.concatTextAndAttributes(before,firstInsertionLine,true);if(nInsertionLines===0){var firstInsertionLineLength=0;for(var _i154=0;_i154<firstInsertionLine.length;_i154=_i154+2){var text=firstInsertionLine[_i154];firstInsertionLineLength+=typeof text==="string"?text.length:1;}endPos.column=column+firstInsertionLineLength;__varRecorder__$K.concatTextAndAttributes(lineTextAndAttributes,after,true);}line.changeTextAndAttributes(lineTextAndAttributes);if(nInsertionLines===0){if(debug){debug.log("single line inserted at ".concat(row,"/").concat(column));debug&&debug.dump("".concat(this.root.print(false)));}return{start:{row:row,column:column},end:endPos};}var lastInsertionLine=attrsForLines[nInsertionLines-1];var lastInsertionLineLength=0;for(var _i155=0;_i155<lastInsertionLine.length;_i155=_i155+2){var _text3=lastInsertionLine[_i155];lastInsertionLineLength+=typeof _text3==="string"?_text3.length:1;}endPos.row+=nInsertionLines;endPos.column=lastInsertionLineLength;var lines=this.insertLines(attrsForLines.map(function(ea){return new __varRecorder__$K.Line({parent:null,width:0,height:0,textAndAttributes:ea});}),row+1);var lastLine=__varRecorder__$K.arr.last(lines);lastLine.changeTextAndAttributes(__varRecorder__$K.concatTextAndAttributes(lastLine.textAndAttributes,after,true));if(debug){debug.log("".concat(lines.length," inserted at ").concat(row,"/").concat(column));debug&&debug.dump("".concat(this.root.print(false)));}return{start:{row:row,column:column},end:endPos};}},{key:"insertText",value:function Document_insertText_(text,pos){var extendAttrs=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!text)return{start:pos,end:pos};var row=pos.row,column=pos.column;if(row<0)row=0;if(column<0)column=0;var line=this.getLine(row);if(!line){var _lines4=this.insertLines(text.split(__varRecorder__$K.newline));return{start:{row:0,column:0},end:{row:_lines4.length,column:__varRecorder__$K.arr.last(_lines4).text.length}};}if(row>=this.rowCount){var docEndPos=this.endPosition;text="\n".repeat(row-docEndPos.row)+text;row=docEndPos.row;column=docEndPos.column;}var insertionLines=text.split(__varRecorder__$K.newline);var firstInsertionLine=insertionLines.shift();var nInsertionLines=insertionLines.length;var endPos={row:row,column:column};var lineLength=line.stringSize-1;if(column>lineLength){firstInsertionLine=" ".repeat(column-lineLength)+firstInsertionLine;}var _varRecorder__$K$spl21=__varRecorder__$K.splitTextAndAttributesAt(line.textAndAttributes,column),_varRecorder__$K$spl22=_slicedToArray2(_varRecorder__$K$spl21,2),before=_varRecorder__$K$spl22[0],after=_varRecorder__$K$spl22[1];if(before[0]==="")before=[];var attr=extendAttrs&&before.length?before[before.length-1]:null;var lineTextAndAttributes=__varRecorder__$K.concatTextAndAttributes(before,[firstInsertionLine,attr],true);if(nInsertionLines===0){endPos.column=column+firstInsertionLine.length;__varRecorder__$K.concatTextAndAttributes(lineTextAndAttributes,after,true);}line.changeTextAndAttributes(lineTextAndAttributes);if(nInsertionLines===0)return{start:{row:row,column:column},end:endPos};endPos.row+=nInsertionLines;endPos.column=insertionLines[nInsertionLines-1].length;var lines=this.insertLines(insertionLines,row+1);var lastLine=__varRecorder__$K.arr.last(lines);lastLine.changeTextAndAttributes(__varRecorder__$K.concatTextAndAttributes(lastLine.textAndAttributes,after,true));return{start:{row:row,column:column},end:endPos};}},{key:"remove",value:function Document_remove_(range){var debug=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.rowCount===0)return;var start=range.start,end=range.end;if(start.row===end.row&&start.column===end.column)return;if(__varRecorder__$K.lessPosition(end,start)){var _ref107=[end,start];start=_ref107[0];end=_ref107[1];}var docEndPos=this.endPosition;if(__varRecorder__$K.lessEqPosition(docEndPos,start))return;var _varRecorder__$K$max=__varRecorder__$K.maxPosition(start,{column:0,row:0}),fromRow=_varRecorder__$K$max.row,fromCol=_varRecorder__$K$max.column;var _varRecorder__$K$min=__varRecorder__$K.minPosition(end,docEndPos),toRow=_varRecorder__$K$min.row,toCol=_varRecorder__$K$min.column;if(fromCol<0)fromCol=0;if(toCol<0)toCol=0;if(debug&&!debug.debugDocumentUpdate)debug=false;if(debug){if(!debug.log){debug={log:console.log.bind(console),dump:console.log.bind(console),group:console.group.bind(console),groupEnd:console.groupEnd.bind(console)};}debug.group("document.remove "+JSON.stringify(range));debug.log("[text doc] removing ".concat(fromRow,"/").concat(fromCol," => ").concat(toRow,"/").concat(toCol));}var line=this.getLine(fromRow);var firstLine=line;var lines=[line];for(var _i156=0;_i156<toRow-fromRow;_i156++){lines.push(line=line.nextLine());}var lastLine=lines[lines.length-1];var _varRecorder__$K$spl23=__varRecorder__$K.splitTextAndAttributesAt(firstLine.textAndAttributes,fromCol),_varRecorder__$K$spl24=_slicedToArray2(_varRecorder__$K$spl23,1),before=_varRecorder__$K$spl24[0];var _varRecorder__$K$spl25=__varRecorder__$K.splitTextAndAttributesAt(lastLine.textAndAttributes,toCol),_varRecorder__$K$spl26=_slicedToArray2(_varRecorder__$K$spl25,2),_=_varRecorder__$K$spl26[0],after=_varRecorder__$K$spl26[1];firstLine.changeTextAndAttributes(__varRecorder__$K.concatTextAndAttributes(before,after,true));if(debug){debug.log("[text doc removal] what remains of start/end line: \"".concat(firstLine.textAndAttributes,"\""));}if(lines.length>1)this.removeLines(fromRow+1,toRow,debug);if(debug){debug.groupEnd("[text doc removal]");}}},{key:"splitLineAt",value:function Document_splitLineAt_(_ref108){var row=_ref108.row,column=_ref108.column;var line=this.getLine(row);var _varRecorder__$K$spl27=__varRecorder__$K.splitTextAndAttributesAt(line.textAndAttributes,column),_varRecorder__$K$spl28=_slicedToArray2(_varRecorder__$K$spl27,2),before=_varRecorder__$K$spl28[0],after=_varRecorder__$K$spl28[1];line.changeTextAndAttributes(before);var newLine=new __varRecorder__$K.Line({parent:null,width:0,height:0,textAndAttributes:after});this.insertLines([newLine],row+1);return{start:{row:row,column:column},end:{row:row+1,column:0}};}},{key:"replace",value:function Document_replace_(_ref109,replacement,debug){var start=_ref109.start,end=_ref109.end;if(!replacement.length){this.remove({start:start,end:end},debug);return{removed:{start:start,end:end},inserted:{start:start,end:start}};}var startClipped=this.clipPositionToLines(start);var endClipped=this.clipPositionToLines(end);if(startClipped.row===endClipped.row){this.remove({start:startClipped,end:endClipped},debug);}if(startClipped.row===endClipped.row||__varRecorder__$K.lessEqPosition(this.endPosition,start)){var inserted;if(typeof replacement==="string"){if(replacement.length){inserted=replacement.length&&this.insertText(replacement,start);}}else{if(replacement.length&&(replacement.length!==2||replacement[0])){inserted=this.insertTextAndAttributes(replacement,start,debug);}}if(!inserted)inserted={start:startClipped,end:startClipped};return{removed:{start:start,end:end},inserted:inserted};}start=startClipped;end=endClipped;var _start3=start,startRow=_start3.row,startColumn=_start3.column;var _end3=end,endRow=_end3.row,endColumn=_end3.column;var textAndAttributesByLine;if(typeof replacement==="string"){textAndAttributesByLine=[];var _lines5=replacement.split(__varRecorder__$K.newline);for(var _i157=0;_i157<_lines5.length;_i157++){textAndAttributesByLine.push([_lines5[_i157],null]);}}else textAndAttributesByLine=__varRecorder__$K.splitTextAndAttributesIntoLines(replacement,__varRecorder__$K.newline);var nothingToInsert=!textAndAttributesByLine.length||textAndAttributesByLine.length===1&&(!textAndAttributesByLine[0].length||!textAndAttributesByLine[0][0].length);if(nothingToInsert)textAndAttributesByLine=[];var line=this.getLine(startRow);var firstLine=line;var lastLine=this.getLine(endRow);var _varRecorder__$K$spl29=__varRecorder__$K.splitTextAndAttributesAt(firstLine.textAndAttributes,startColumn),_varRecorder__$K$spl30=_slicedToArray2(_varRecorder__$K$spl29,2),before=_varRecorder__$K$spl30[0],_=_varRecorder__$K$spl30[1];firstLine.changeTextAndAttributes(nothingToInsert?before:__varRecorder__$K.concatTextAndAttributes(before,textAndAttributesByLine.shift(),true));var row=startRow;while(true){if(!textAndAttributesByLine.length)break;line=line.nextLine();row++;if(line===lastLine)break;line.changeTextAndAttributes(textAndAttributesByLine.shift());}if(!textAndAttributesByLine.length){var column=line.stringSize-1;this.remove({start:{row:row,column:line.stringSize},end:end});return{removed:{start:start,end:end},inserted:{start:start,end:{row:row,column:column}}};}console.assert(row==endRow,"not end row");console.assert(line.row==row,"row != last line.row");this.remove({start:{row:row,column:0},end:end});var textAndAttributesForInsert=[];var length=textAndAttributesByLine.length;for(var _i158=0;_i158<length-1;_i158++){var lineTextAndAttributes=textAndAttributesByLine[_i158];if(!lineTextAndAttributes.length)lineTextAndAttributes=["",null];if(typeof lineTextAndAttributes[lineTextAndAttributes.length-2]==="string"){lineTextAndAttributes[lineTextAndAttributes.length-2]=lineTextAndAttributes[lineTextAndAttributes.length-2]+__varRecorder__$K.newline;}else{lineTextAndAttributes.push(__varRecorder__$K.newline,null);}textAndAttributesForInsert.push.apply(textAndAttributesForInsert,_toConsumableArray2(lineTextAndAttributes));}textAndAttributesForInsert.push.apply(textAndAttributesForInsert,_toConsumableArray2(textAndAttributesByLine[length-1]));var _this$insertTextAndAt=this.insertTextAndAttributes(textAndAttributesForInsert,{row:row,column:0}),insertionEnd=_this$insertTextAndAt.end;return{removed:{start:start,end:end},inserted:{start:start,end:insertionEnd}};}},{key:"wordsOfLine",value:function Document_wordsOfLine_(row){var line=this.getLineString(row);var words=[];var word;var isWordDelimiter=function isWordDelimiter(_char3){return /[^a-z0-9_]/i.test(_char3);};for(var i=0;i<line.length;i++){if(isWordDelimiter(line[i])){if(word){word.range.end.column=i;words.push(word);word=null;}}else{word=word||{index:words.length,string:"",range:{start:{row:row,column:i},end:{row:row,column:i}}};word.string+=line[i];}}if(word){word.range.end.column=i;words.push(word);}return words;}},{key:"wordAt",value:function Document_wordAt_(_ref110){var row=_ref110.row,column=_ref110.column;var words=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.wordsOfLine(row);return words.find(function(ea){var _ea$range=ea.range,startCol=_ea$range.start.column,endCol=_ea$range.end.column;return startCol<=column&&column<=endCol;})||{range:{start:{column:column,row:row},end:{column:column,row:row}},string:""};}},{key:"wordLeft",value:function Document_wordLeft_(pos){var row=pos.row,column=pos.column;var words=this.wordsOfLine(row);if(!words.length||__varRecorder__$K.lessEqPosition(pos,words[0].range.start)){while(--row>=0){words=this.wordsOfLine(row);if(words.length)return __varRecorder__$K.arr.last(words);}return{range:{start:pos,end:pos},string:""};}var word=this.wordAt(pos);if(word.string){return __varRecorder__$K.eqPosition(word.range.start,pos)?words[word.index-1]:word;}return words.slice().reverse().find(function(word){return word.range.end.column<=column;})||{range:{start:pos,end:pos},string:""};}},{key:"wordRight",value:function Document_wordRight_(pos){var column=pos.column,row=pos.row;var words=this.wordsOfLine(pos.row);if(!words.length||__varRecorder__$K.lessEqPosition(__varRecorder__$K.arr.last(words).range.end,pos)){while(++row<this.lines.length){words=this.wordsOfLine(row);if(words.length)return words[0];}return{range:{start:pos,end:pos},string:""};}var word=this.wordAt(pos);if(word.string){return __varRecorder__$K.eqPosition(word.range.end,pos)?words[word.index+1]:word;}return words.find(function(word){return word.range.start.column>=column;})||{range:{start:pos,end:pos},string:""};}},{key:"scanForward",value:function Document_scanForward_(startPos,matchFn){var row=startPos.row,startColumn=startPos.column;var line=this.getLine(row);var text=line.text;for(var column=startColumn;column<line.stringSize-1;column++){var result=matchFn(text[column],{row:row,column:column});if(result)return result;}while(line=line.nextLine()){row++;text=line.text;for(var _column=0;_column<line.stringSize-1;_column++){var _result=matchFn(text[_column],{row:row,column:_column});if(_result)return _result;}}return null;}},{key:"scanBackward",value:function Document_scanBackward_(startPos,matchFn){var row=startPos.row,startColumn=startPos.column;var line=this.getLine(row);var text=line.text;for(var column=startColumn-1;column>=0;column--){var result=matchFn(text[column],{row:row,column:column});if(result)return result;}while(line=line.prevLine()){row--;text=line.text;for(var _column2=line.stringSize-2;_column2>=0;_column2--){var _result2=matchFn(text[_column2],{row:row,column:_column2});if(_result2)return _result2;}}return null;}},{key:"copy",value:function Document_copy_(){return new this.constructor(this.lines.slice(),this.options);}},{key:"toString",value:function Document_toString_(){return"Document(".concat(this.rowCount," lines)");}},{key:"consistencyCheck",value:function Document_consistencyCheck_(){var report=[];var rowCount=this.rowCount,stringSize=this.stringSize,lines=this.lines,textString=this.textString,root=this.root;if(rowCount!==lines.length){report.push({error:"document ".concat(this," row count: ").concat(rowCount," !== ").concat(lines.length)});}if(textString.length!==stringSize){report.push({error:"document ".concat(this," textString.length vs stringSize: ").concat(textString.length," !== ").concat(stringSize)});}report.push.apply(report,_toConsumableArray2(root.consistencyCheck()));var i=0;var line=lines[0];while(line){if(line!=lines[i]){report.push({error:"line iteration at ".concat(i," is broken: nextLine() of ").concat(lines[i-1]," is not ").concat(lines[i],"!")});}i++;line=line.nextLine();}if(lines[i]){report.push({error:"nextLine() of\n  ".concat(lines[i-1],"\nis nullish but \n  ").concat(lines[i],"\nexists in tree!")});}if(report.length){throw new Error("Consistency check of document revealed ".concat(report.length," error").concat(report.length>1?"s":"",":\n")+"".concat(report.map(function(ea){return ea.error;}).filter(Boolean).join("\n")));}}},{key:"print",value:function Document_print_(){return this.root.print(false,0,0,"root");}},{key:"print2",value:function Document_print2_(){var url=System.decanonicalize("lively.lang/text-graphics.js");var _ref111=System.get(url)||{},printTree=_ref111.printTree;if(!printTree){lively.module.module(url).load().then(function(){return console.log("lively.lang/text-graphics.js loaded");})["catch"](function(err){return console.error(err);});return"Loading lively.lang/text-graphics.js lib, please try again later :P";}return printTree(this.root,function(node){return node.toString();},function(node){return node.children;},{padding:[2,1,2,1]});}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Document";}},{key:"fuzzyTest",value:function Document_fuzzyTest_(){return __varRecorder__$K.documentFuzzier.run();}},{key:"newline",get:function get(){return __varRecorder__$K.newline;}},{key:"fromString",value:function Document_fromString_(string,options){return new this(string.split(__varRecorder__$K.newline),options);}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/document.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:37798,end:71716});}(undefined);Document=__varRecorder__$K.Document;var Document$1=Document;__varRecorder__$K["default"]=Document;var __varRecorder__$L=lively.FreezerRuntime.recorderFor("lively.morphic/text/anchors.js");__varRecorder__$L.lessPosition=lessPosition;__varRecorder__$L.lessEqPosition=lessEqPosition;__varRecorder__$L.eqPosition=eqPosition;var Anchor=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/anchors.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Anchor")&&typeof __lively_classholder__.Anchor==="function"?__lively_classholder__.Anchor:__lively_classholder__.Anchor=function Anchor(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Anchor_initialize_(id){var pos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{column:0,row:0};var insertBehavior=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"move";this.id=id||""+(this.constructor._id=(this.constructor._id||0)+1);this.position=pos;this.insertBehavior=insertBehavior;}},{key:"isAnchor",get:function get(){return true;}},{key:"onDelete",value:function Anchor_onDelete_(range){if(__varRecorder__$L.lessEqPosition(this.position,range.start))return false;if(__varRecorder__$L.lessEqPosition(range.start,this.position)&&__varRecorder__$L.lessEqPosition(this.position,range.end)){this.position=range.start;return true;}var _this$position=this.position,row=_this$position.row,column=_this$position.column;var _range$start2=range.start,startRow=_range$start2.row,startColumn=_range$start2.column,_range$end2=range.end,endRow=_range$end2.row,endColumn=_range$end2.column;var newRow=row-(endRow-startRow);var newColumn=endRow!==this.position.row?column:startColumn===endColumn?column-(endColumn-startColumn):startColumn+(column-endColumn);this.position={column:newColumn,row:newRow};return true;}},{key:"onInsert",value:function Anchor_onInsert_(range){if(__varRecorder__$L.lessPosition(this.position,range.start))return false;if(__varRecorder__$L.eqPosition(this.position,range.start)&&this.insertBehavior==="stay")return false;var _this$position2=this.position,row=_this$position2.row,column=_this$position2.column;var _range$start3=range.start,startRow=_range$start3.row,startColumn=_range$start3.column,_range$end3=range.end,endRow=_range$end3.row,endColumn=_range$end3.column;var deltaRows=endRow-startRow;var deltaColumns=startRow!==this.position.row?0:endColumn-startColumn;this.position={column:column+deltaColumns,row:row+deltaRows};return true;}},{key:"equalsPosition",value:function Anchor_equalsPosition_(posOrAnchor){if(!posOrAnchor)return false;if(posOrAnchor.isAnchor)return __varRecorder__$L.eqPosition(this.position,posOrAnchor.position);return __varRecorder__$L.eqPosition(this.position,posOrAnchor);}},{key:"toString",value:function Anchor_toString_(){var id=this.id,_this$position3=this.position,row=_this$position3.row,column=_this$position3.column;return"Anchor(".concat(id," ").concat(row,"/").concat(column,")");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Anchor";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/anchors.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:82,end:3025});}(undefined);__varRecorder__$L.Anchor=Anchor;__varRecorder__$L.Anchor=Anchor;__varRecorder__$L.Anchor=Anchor;var __captured5__=/*#__PURE__*/Object.freeze({__proto__:null,Anchor:Anchor});var __varRecorder__$M=lively.FreezerRuntime.recorderFor("lively.morphic/text/search.js");__varRecorder__$M.pt=pt;__varRecorder__$M.Color=Color$1;__varRecorder__$M.connect=connect;__varRecorder__$M.once=once$1;__varRecorder__$M.disconnect=disconnect;__varRecorder__$M.Path=Path;__varRecorder__$M.morph=morph;__varRecorder__$M.GridLayout=GridLayout;__varRecorder__$M.config=config;__varRecorder__$M.Morph=Morph;__varRecorder__$M.lessPosition=lessPosition;__varRecorder__$M.minPosition=minPosition;__varRecorder__$M.maxPosition=maxPosition;__varRecorder__$M.Icon=Icon;var TextSearcher=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/search.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TextSearcher")&&typeof __lively_classholder__.TextSearcher==="function"?__lively_classholder__.TextSearcher:__lively_classholder__.TextSearcher=function TextSearcher(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function TextSearcher_initialize_(morph){this.morph=morph;this.STOP={};}},{key:"doc",get:function get(){return this.morph.document;}},{key:"processFind",value:function TextSearcher_processFind_(start,match){var i=this.doc.positionToIndex(start);var end=this.doc.indexToPosition(i+match.length);return{range:{start:start,end:end},match:match};}},{key:"stringSearch",value:function TextSearcher_stringSearch_(lines,needle,caseSensitive,nLines,inRange,_char4,pos){if(inRange){if(__varRecorder__$M.lessPosition(pos,inRange.start)||__varRecorder__$M.lessPosition(inRange.end,pos)){return this.STOP;}}if(!caseSensitive)_char4=_char4.toLowerCase();if(_char4!==needle[0])return null;var row=pos.row,column=pos.column;var lineString=lines[row];var followingText=nLines<=1?"":"\n"+lines.slice(row+1,row+1+(nLines-1)).join("\n");var chunk=lineString.slice(column)+followingText;var chunkToTest=caseSensitive?chunk:chunk.toLowerCase();return chunkToTest.indexOf(needle)!==0?null:this.processFind({row:row,column:column},chunk.slice(0,needle.length));}},{key:"reSearch",value:function TextSearcher_reSearch_(lines,needle,multiline,inRange,_char5,pos){if(inRange){if(__varRecorder__$M.lessPosition(pos,inRange.start)||__varRecorder__$M.lessPosition(inRange.end,pos)){return this.STOP;}}var row=pos.row,column=pos.column;var chunk=lines[row].slice(column)+(multiline?"\n"+lines.slice(row+1).join("\n"):"");var reMatch=chunk.match(needle);return reMatch?this.processFind({row:row,column:column},reMatch[0]):null;}},{key:"search",value:function TextSearcher_search_(options){var _Object$assign7=Object.assign({start:this.morph.cursorPosition,needle:"",backwards:false,caseSensitive:false,inRange:null},options),start=_Object$assign7.start,needle=_Object$assign7.needle,backwards=_Object$assign7.backwards,caseSensitive=_Object$assign7.caseSensitive,inRange=_Object$assign7.inRange;if(!needle)return null;if(inRange){start=backwards?__varRecorder__$M.minPosition(inRange.end,start):__varRecorder__$M.maxPosition(inRange.start,start);}var search;if(needle instanceof RegExp){var flags=(needle.flags||"").split("");var multiline=!!needle.multiline;flags.splice(flags.indexOf("m"),1);if(!caseSensitive&&!flags.includes("i"))flags.push("i");needle=new RegExp("^"+needle.source.replace(/^\^+/,""),flags.join(""));search=this.reSearch.bind(this,this.doc.lineStrings,needle,multiline,inRange);}else{needle=String(needle);if(!caseSensitive)needle=needle.toLowerCase();var nLines=needle.split(this.doc.constructor.newline).length;search=this.stringSearch.bind(this,this.doc.lineStrings,needle,caseSensitive,nLines,inRange);}var result=this.doc[backwards?"scanBackward":"scanForward"](start,search);return result===this.STOP?null:result;}},{key:"searchForAll",value:function TextSearcher_searchForAll_(options){var results=[];var i=0;while(true){if(i++>10000)throw new Error("endless loop");var found=this.search(options);if(!found)return results;results.push(found);options=Object.assign({},options,{start:options.backwards?found.range.start:found.range.end});}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TextSearcher";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/search.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:538,end:3748});}(undefined);__varRecorder__$M.TextSearcher=TextSearcher;__varRecorder__$M.TextSearcher=TextSearcher;__varRecorder__$M.TextSearcher=TextSearcher;var SearchWidget=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/search.js");var __lively_class__=__lively_classholder__.hasOwnProperty("SearchWidget")&&typeof __lively_classholder__.SearchWidget==="function"?__lively_classholder__.SearchWidget:__lively_classholder__.SearchWidget=function SearchWidget(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function SearchWidget_initialize_(){var _this150=this;var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(props.targetText)props.target=props.targetText;if(!props.target)throw new Error("SearchWidget needs a target text morph!");initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);var replaceButton=this.getSubmorphNamed("replaceButton");var replaceAllButton=this.getSubmorphNamed("replaceAllButton");var replaceInput=this.getSubmorphNamed("replaceInput");var searchInput=this.getSubmorphNamed("searchInput");var prevButton=this.getSubmorphNamed("prevButton");var nextButton=this.getSubmorphNamed("nextButton");var cancelButton=this.getSubmorphNamed("cancelButton");var acceptButton=this.getSubmorphNamed("acceptButton");__varRecorder__$M.connect(acceptButton,"fire",this,"execCommand",{converter:function converter(){return"accept search";}});__varRecorder__$M.connect(cancelButton,"fire",this,"execCommand",{converter:function converter(){return"cancel search";}});__varRecorder__$M.connect(nextButton,"fire",this,"execCommand",{converter:function converter(){return"search next";}});__varRecorder__$M.connect(prevButton,"fire",this,"execCommand",{converter:function converter(){return"search prev";}});__varRecorder__$M.connect(searchInput,"inputChanged",this,"search");__varRecorder__$M.connect(replaceButton,"fire",this,"execCommand",{converter:function converter(){return"replace and go to next";}});__varRecorder__$M.connect(replaceAllButton,"fire",this,"execCommand",{converter:function converter(){return"replace all";}});this.state={backwards:false,before:null,position:null,inProgress:null,last:null};searchInput.addCommands([{name:"realign top-bottom-center",exec:function(){var _exec2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee129(){return regeneratorRuntime.wrap(function _callee129$(_context129){while(1){switch(_context129.prev=_context129.next){case 0:_this150.target.execCommand("realign top-bottom-center");_this150.addSearchMarkersForPreview(_this150.state.inProgress&&_this150.state.inProgress.found,false);return _context129.abrupt("return",true);case 3:case"end":return _context129.stop();}}},_callee129);}));function exec(){return _exec2.apply(this,arguments);}return exec;}()}]);}},{key:"focus",value:function SearchWidget_focus_(){var _this151=this;this.get("searchInput").focus();this.whenRendered().then(function(){return _this151.get("searchInput").invalidateTextLayout(true,true);});}},{key:"onBlur",value:function SearchWidget_onBlur_(evt){var _this152=this;var world=this.world();if(!world)return;setTimeout(function(){var focusedMorph=world.focusedMorph;if(!_this152.withAllSubmorphsDetect(function(m){return m.isFocused();})){_this152.cancelSearch();return;}if(_this152.get("searchInput")!=focusedMorph&&_this152.get("replaceInput")!=focusedMorph){_this152.get("searchInput").focus();}});}},{key:"cleanup",value:function SearchWidget_cleanup_(){this.removeSearchMarkers();this.state.inProgress=null;this.textMap&&this.textMap.update();}},{key:"cancelSearch",value:function SearchWidget_cancelSearch_(){if(this.state.inProgress){this.state.last=this.state.inProgress;}this.cleanup();this.removeTextMap();if(this.state.before){var _this$state$before=this.state.before,scroll=_this$state$before.scroll,selectionRange=_this$state$before.selectionRange;this.target.selection=selectionRange;this.target.scroll=scroll;this.state.before=null;}this.remove();this.target.focus();}},{key:"acceptSearch",value:function SearchWidget_acceptSearch_(){if(this.state.inProgress){this.state.last=this.state.inProgress;}if(this.applySearchResult(this.state.inProgress)){this.state.before&&this.target.saveMark(this.state.before.position);}this.get("searchInput").acceptInput();this.cleanup();this.removeTextMap();this.state.before=null;this.remove();this.target.focus();}},{key:"applySearchResult",value:function SearchWidget_applySearchResult_(searchResult){if(!searchResult||!searchResult.found)return null;var text=this.target;var sel=text.selection;var select=!!text.activeMark||!sel.isEmpty();var backwards=searchResult.backwards,_searchResult$found$r=searchResult.found.range,start=_searchResult$found$r.start,end=_searchResult$found$r.end;var pos=backwards?start:end;select?sel.lead=pos:text.cursorPosition=pos;if(!text.isLineFullyVisible(pos.row))text.centerRow();return searchResult;}},{key:"removeSearchMarkers",value:function SearchWidget_removeSearchMarkers_(){var _this153=this;(this.target.markers||[]).forEach(function(_ref112){var id=_ref112.id;return id.startsWith("search-highlight")&&_this153.target.removeMarker(id);});}},{key:"addSearchMarkers",value:function SearchWidget_addSearchMarkers_(found){var backwards=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var caseSensitive=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this.removeSearchMarkers();var text=this.target,textMap=this.textMap;var _text$whatsVisible=text.whatsVisible,startRow=_text$whatsVisible.startRow,endRow=_text$whatsVisible.endRow;var lines=text.document.lineStrings;var i=0;var _varRecorder__$M$con=__varRecorder__$M.config.codeEditor.search,maxCharsPerLine=_varRecorder__$M$con.maxCharsPerLine,fastHighlightLineCount=_varRecorder__$M$con.fastHighlightLineCount;if(textMap&&found.match.length>=3&&lines.length<fastHighlightLineCount){startRow=0,endRow=lines.length-1;}var stop=false;var ts=window.performance.now();for(var row=startRow;row<=endRow;row++){if(stop)break;var line=lines[row]||"";for(var col=0;col<Math.min(line.length,maxCharsPerLine);col++){if(window.performance.now()-ts>300){stop=true;break;}var matched=caseSensitive?line.slice(col).indexOf(found.match)===0:line.slice(col).toLowerCase().indexOf(found.match.toLowerCase())===0;if(matched){text.addMarker({id:"search-highlight-"+i++,range:{start:{row:row,column:col},end:{row:row,column:col+found.match.length}},style:{"border-radius":"4px","background-color":"rgba(255, 200, 0, 0.3)","box-shadow":"0 0 4px rgba(255, 200, 0, 0.3)","pointer-events":"none"}});col+=found.match.length;}}}var positionRange;if(this.state.backwards){var _found$range$start=found.range.start,_row=_found$range$start.row,column=_found$range$start.column;positionRange={start:{row:_row,column:column},end:{row:_row,column:column+1}};}else{var _found$range$end=found.range.end,_row2=_found$range$end.row,_column3=_found$range$end.column;positionRange={start:{row:_row2,column:_column3-1},end:{row:_row2,column:_column3}};}text.addMarker({id:"search-highlight-cursor",range:positionRange,style:_defineProperty({"pointer-events":"none","box-sizing":"border-box"},this.state.backwards?"border-left":"border-right","3px red solid")});textMap&&textMap.update();}},{key:"addSearchMarkersForPreview",value:function SearchWidget_addSearchMarkersForPreview_(found){var noCursor=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!found)return;this.addSearchMarkers(found);noCursor&&this.target.removeMarker("search-highlight-cursor");}},{key:"prepareForNewSearch",value:function SearchWidget_prepareForNewSearch_(){var text=this.target,state=this.state;var world=text.world();if(!world)return;this.openInWorld(world.visibleBounds().center(),world);this.topRight=text.globalBounds().insetBy(5).topRight();if(text.getWindow())__varRecorder__$M.once(text.getWindow(),"remove",this,"remove");var inputMorph=this.get("searchInput");var scroll=text.scroll,sel=text.selection;state.position=sel.lead;state.before={scroll:scroll,position:sel.lead,selectionRange:sel.range,selectionReverse:sel.isReverse()};if(state.last&&state.last.found){__varRecorder__$M.disconnect(inputMorph,"inputChanged",this,"search");this.input=state.last.needle;__varRecorder__$M.connect(inputMorph,"inputChanged",this,"search");this.addSearchMarkersForPreview(state.last.found);}this.focus();inputMorph.selectAll();}},{key:"advance",value:function SearchWidget_advance_(backwards){var inProgress=this.state.inProgress;if(inProgress&&inProgress.found){var dirChange=backwards!==this.state.backwards;var _inProgress$found$ran=inProgress.found.range,start=_inProgress$found$ran.start,end=_inProgress$found$ran.end;this.state.position=dirChange?backwards?end:start:backwards?start:end;}this.state.backwards=backwards;return this.search();}},{key:"searchNext",value:function SearchWidget_searchNext_(){return this.advance(false);}},{key:"searchPrev",value:function SearchWidget_searchPrev_(){return this.advance(true);}},{key:"search",value:function SearchWidget_search_(){if(!this.input){this.cleanup();return null;}var state=this.state;var backwards=state.backwards,inProgress=state.inProgress,position=state.position;var opts={backwards:backwards,start:position};var found=this.target.search(this.input,opts);var result=this.state.inProgress=Object.assign({},opts,{needle:this.input,found:found});this.applySearchResult(result);if(found){this.addSearchMarkers(found,backwards);}else{this.cleanup();}return result;}},{key:"showTextMap",value:function(){var _SearchWidget_showTextMap_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee130(){var textMap;return regeneratorRuntime.wrap(function _callee130$(_context130){while(1){switch(_context130.prev=_context130.next){case 0:_context130.next=2;return System["import"]("lively.morphic/text/map.js");case 2:textMap=this.textMap=__varRecorder__$M.morph({type:"textmap"});textMap.attachTo(this.target);textMap.isLayoutable=false;this.addMorph(textMap);textMap.topRight=this.innerBounds().bottomRight().addXY(0,5);textMap.height=this.target.height-this.height-15;textMap.update();this.renderOnGPU=true;return _context130.abrupt("return",textMap);case 11:case"end":return _context130.stop();}}},_callee130,this);}));function SearchWidget_showTextMap_(){return _SearchWidget_showTextMap_.apply(this,arguments);}return SearchWidget_showTextMap_;}()},{key:"removeTextMap",value:function SearchWidget_removeTextMap_(){if(this.textMap){this.textMap.remove();this.textMap.detachFromCurrentTextMorph();this.textMap=null;}}},{key:"keybindings",get:function get(){return[{keys:"Enter",command:"accept search or replace and go to next"},{keys:"Tab",command:"change focus"},{keys:"Ctrl-O",command:"occur with search term"},{keys:"Ctrl-W",command:"yank next word from text"},{keys:"Escape|Ctrl-G",command:"cancel search"},{keys:{win:"Ctrl-F|Ctrl-S|Ctrl-G",mac:"Meta-F|Ctrl-S|Meta-G"},command:"search next"},{keys:{win:"Ctrl-Shift-F|Ctrl-R|Ctrl-Shift-G",mac:"Meta-Shift-F|Ctrl-R|Meta-Shift-G"},command:"search prev"}];}},{key:"commands",get:function get(){var _this154=this;return[{name:"occur with search term",exec:function(){var _exec3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee131(){var _yield$System$import5,occurStartCommand;return regeneratorRuntime.wrap(function _callee131$(_context131){while(1){switch(_context131.prev=_context131.next){case 0:_context131.next=2;return System["import"]("lively.morphic/text/occur.js");case 2:_yield$System$import5=_context131.sent;occurStartCommand=_yield$System$import5.occurStartCommand;_this154.target.addCommands([occurStartCommand]);_this154.execCommand("accept search");return _context131.abrupt("return",_this154.target.execCommand("occur",{needle:_this154.input}));case 7:case"end":return _context131.stop();}}},_callee131);}));function exec(){return _exec3.apply(this,arguments);}return exec;}()},{name:"accept search",exec:function exec(){_this154.acceptSearch();return true;}},{name:"cancel search",exec:function exec(){_this154.cancelSearch();return true;}},{name:"search next",exec:function exec(){_this154.searchNext();return true;}},{name:"search prev",exec:function exec(){_this154.searchPrev();return true;}},{name:"accept search or replace and go to next",exec:function exec(_,args,count){return _this154.execCommand(_this154.get("replaceInput").isFocused()?"replace and go to next":"accept search",args,count);}},{name:"replace current search location with replace input",exec:function exec(){var search=__varRecorder__$M.Path("state.inProgress").get(_this154);if(search.found){var replacement=_this154.get("replaceInput").textString;_this154.get("replaceInput").get("replaceInput").acceptInput();if(search.needle instanceof RegExp){replacement=search.found.match.replace(search.needle,replacement);}_this154.target.replace(search.found.range,replacement);}return true;}},{name:"replace and go to next",exec:function exec(){_this154.execCommand("replace current search location with replace input");_this154.execCommand(_this154.state.backwards?"search prev":"search next");return true;}},{name:"replace all",exec:function exec(){var search=__varRecorder__$M.Path("state.inProgress").get(_this154);if(search.found){search=Object.assign({},search,{start:{row:0,column:0}});var replacement=_this154.get("replaceInput").textString;_this154.get("replaceInput").get("replaceInput").acceptInput();var allMatches=new __varRecorder__$M.TextSearcher(_this154.target).searchForAll(search);_this154.target.undoManager.group();allMatches.forEach(function(found){var range=found.range,match=found.match;if(search.needle instanceof RegExp){replacement=match.replace(search.needle,replacement);}_this154.target.replace(range,replacement,true,true,false);});_this154.target.undoManager.group();_this154.acceptSearch();}return true;}},{name:"change focus",exec:function exec(){if(_this154.get("searchInput").isFocused()){_this154.get("replaceInput").focus();}else{_this154.get("searchInput").focus();}return true;}},{name:"yank next word from text",exec:function exec(){var text=_this154.target;var word=text.wordRight();var input=_this154.get("searchInput");if(!input.selection.isEmpty())input.selection.text="";var string=text.textInRange({start:text.cursorPosition,end:word.range.end});input.textString+=string;return true;}}];}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"SearchWidget";}},{key:"properties",get:function get(){return{name:{defaultValue:"search widget"},borderWidth:{defaultValue:1},borderColor:{defaultValue:__varRecorder__$M.Color.gray},borderRadius:{defaultValue:3},fill:{defaultValue:__varRecorder__$M.Color.black.withA(0.6)},epiMorph:{defaultValue:true},target:{},state:{},master:{initialize:function initialize(){this.master={auto:"styleguide://SystemWidgets/search widget"};}},input:{after:["submorphs"],get:function get(){var text=this.get("searchInput").textString;var reMatch=text.match(/^\/(.*)\/([a-z]*)$/);return reMatch?new RegExp(reMatch[1],reMatch[2]):text;},set:function set(v){this.get("searchInput").textString=String(v);}},fontSize:{after:["submorphs"],get:function get(){return this.get("searchInput").fontSize;},set:function set(v){this.get("replaceInput").fontSize=v;}},fontFamily:{after:["submorphs"],get:function get(){return this.get("searchInput").fontFamily;},set:function set(v){this.get("searchInput").fontFamily=v;this.get("replaceInput").fontFamily=v;}},layout:{initialize:function initialize(){this.layout=new __varRecorder__$M.GridLayout({groups:{nextButton:{resize:false},prevButton:{resize:false},acceptButton:{resize:false},cancelButton:{resize:false}},rows:[0,{fixed:28,paddingTop:5,paddingBottom:2.5},1,{fixed:28,paddingTop:2.5,paddingBottom:5}],columns:[0,{paddingLeft:5,paddingRight:5},1,{fixed:25},2,{fixed:25},3,{fixed:5},4,{fixed:25},5,{fixed:25},6,{fixed:10}],grid:[["searchInput","nextButton","prevButton",null,"acceptButton","cancelButton",null],["replaceInput","replaceButton","replaceButton",null,"replaceAllButton","replaceAllButton",null]]});}},submorphs:{after:["extent"],initialize:function initialize(){this.submorphs=[__varRecorder__$M.morph({type:"button",name:"acceptButton",label:__varRecorder__$M.Icon.textAttribute("check-circle")}).fit(),__varRecorder__$M.morph({type:"button",name:"cancelButton",label:__varRecorder__$M.Icon.textAttribute("times-circle")}).fit(),__varRecorder__$M.morph({type:"button",name:"nextButton",label:__varRecorder__$M.Icon.textAttribute("arrow-alt-circle-down",{textStyleClasses:["far"]})}).fit(),__varRecorder__$M.morph({type:"button",name:"prevButton",label:__varRecorder__$M.Icon.textAttribute("arrow-alt-circle-up",{textStyleClasses:["far"]})}).fit(),__varRecorder__$M.morph({type:"input",name:"searchInput",placeholder:"search input",historyId:"lively.morphic-text search"}),__varRecorder__$M.morph({type:"input",name:"replaceInput",placeholder:"replace input",historyId:"lively.morphic-text replace"}),__varRecorder__$M.morph({type:"button",styleClasses:["replace"],name:"replaceButton",label:"replace"}),__varRecorder__$M.morph({type:"button",styleClasses:["replace"],name:"replaceAllButton",label:"replace all"})];__varRecorder__$M.connect(this.get("searchInput"),"onBlur",this,"onBlur");__varRecorder__$M.connect(this.get("replaceInput"),"onBlur",this,"onBlur");}},textMap:{after:["submorphs"]}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/search.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:3867,end:21256});}(__varRecorder__$M.Morph);__varRecorder__$M.SearchWidget=SearchWidget;__varRecorder__$M.SearchWidget=SearchWidget;__varRecorder__$M.SearchWidget=SearchWidget;var searchCommands=[{name:"search in text",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{backwards:false};var search=morph._searchWidget||(morph._searchWidget=new __varRecorder__$M.SearchWidget({target:morph,extent:__varRecorder__$M.pt(300,20)}));search.state.backwards=opts.backwards;search.prepareForNewSearch();if(__varRecorder__$M.config.codeEditor.search.showTextMap){search.showTextMap();}return true;}}];__varRecorder__$M.searchCommands=searchCommands;__varRecorder__$M.searchCommands=searchCommands;__varRecorder__$M.searchCommands=searchCommands;var __varRecorder__$N=lively.FreezerRuntime.recorderFor("lively.morphic/text/layout.js");function todo(name){throw new Error("not yet implemented "+name);}__varRecorder__$N.todo=todo;__varRecorder__$N.Rectangle=Rectangle;__varRecorder__$N.rect=rect;__varRecorder__$N.pt=pt;__varRecorder__$N.arr=arr;__varRecorder__$N.Range=Range;var TextLayout=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/layout.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TextLayout")&&typeof __lively_classholder__.TextLayout==="function"?__lively_classholder__.TextLayout:__lively_classholder__.TextLayout=function TextLayout(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function TextLayout_initialize_(){this.reset();}},{key:"reset",value:function TextLayout_reset_(){this.resetLineCharBoundsCache();}},{key:"restore",value:function TextLayout_restore_(serializedLineBounds,morph){var decompress=function decompress(compressedBounds){var x=0;var y=0;return __varRecorder__$N.arr.flatten(__varRecorder__$N.arr.histogram(compressedBounds,compressedBounds.length/3).map(function(_ref113){var _ref114=_slicedToArray2(_ref113,3),count=_ref114[0],width=_ref114[1],height=_ref114[2];var batch=[];for(var _i159=0;_i159<count;_i159++){batch.push(__varRecorder__$N.rect(x,y,width,height));x+=width;}return batch;}));};var _iterator75=_createForOfIteratorHelper(serializedLineBounds),_step75;try{for(_iterator75.s();!(_step75=_iterator75.n()).done;){var _step75$value=_slicedToArray2(_step75.value,2),row=_step75$value[0],compressedBounds=_step75$value[1];var _v4=decompress(compressedBounds);this.lineCharBoundsCache.set(morph.document.getLine(row),_v4);}}catch(err){_iterator75.e(err);}finally{_iterator75.f();}}},{key:"resetLineCharBoundsCache",value:function TextLayout_resetLineCharBoundsCache_(morph){this.lineCharBoundsCache=new WeakMap();if(morph&&!morph._isDeserializing){this.estimateLineHeights(morph);morph.makeDirty();}}},{key:"resetLineCharBoundsCacheOfLine",value:function TextLayout_resetLineCharBoundsCacheOfLine_(line){if(!line)return;this.lineCharBoundsCache.set(line,null);}},{key:"resetLineCharBoundsCacheOfRow",value:function TextLayout_resetLineCharBoundsCacheOfRow_(morph,row){var doc=morph.document;if(morph._isDeserializing&&morph._initializedByCachedBounds)return;doc&&this.resetLineCharBoundsCacheOfLine(doc.getLine(row));}},{key:"resetLineCharBoundsCacheOfRange",value:function TextLayout_resetLineCharBoundsCacheOfRange_(morph,range){for(var row=range.start.row;row<=range.end.row;row++){this.resetLineCharBoundsCacheOfRow(morph,row);}}},{key:"estimateLineHeightsInRange",value:function TextLayout_estimateLineHeightsInRange_(morph,range){var doc=morph.document;var transform=morph.getGlobalTransform();for(var row=range.start.row;row<=range.end.row;row++){this.resetLineCharBoundsCacheOfRow(morph,doc.getLine(row),transform);}}},{key:"estimateExtentOfLine",value:function TextLayout_estimateExtentOfLine_(morph,line){var transform=arguments.length>2&&arguments[2]!==undefined?arguments[2]:morph.getGlobalTransform();var fontMetric=morph.fontMetric,lineWrapping=morph.lineWrapping,padding=morph.padding,textRenderer=morph.textRenderer,debug=morph.debug,defaultTextStyle=morph.defaultTextStyle;var _morph$getProperty=morph.getProperty("extent"),morphWidth=_morph$getProperty.x,morphHeight=_morph$getProperty.y;var paddingLeft=padding.left();var paddingRight=padding.right();var paddingTop=padding.top();var paddingBottom=padding.bottom();var directRenderTextLayerFn=textRenderer.directRenderTextLayerFn(morph);var textAttributes=line.textAndAttributes;var styles=[];var inlineMorph;morphWidth=morphWidth-paddingLeft-paddingRight;if(!textAttributes||!textAttributes.length)styles.push(defaultTextStyle);else{for(var _j19=0,column=0;_j19<textAttributes.length;_j19+=2){inlineMorph=textAttributes[_j19];if(inlineMorph&&inlineMorph.isMorph){inlineMorph.position=this.pixelPositionFor(morph,{row:line.row,column:column}).subPt(morph.origin);column++;}else if(inlineMorph){column+=inlineMorph.length;}styles.push(Object.assign({},defaultTextStyle,{},textAttributes[_j19+1]));}}var measureCount=styles.length;var charWidthSum=0;var charHeight=0;for(var _h6=0;_h6<measureCount;_h6++){var _fontMetric$defaultCh=fontMetric.defaultCharExtent(morph,{defaultTextStyle:styles[_h6],width:1000,transform:transform,paddingBottom:paddingBottom,paddingTop:paddingTop,paddingRight:paddingRight,paddingLeft:paddingLeft},directRenderTextLayerFn),width=_fontMetric$defaultCh.width,height=_fontMetric$defaultCh.height;charHeight=Math.max(height,charHeight);charWidthSum=charWidthSum+width;}var estimatedHeight=charHeight;var charCount=line.text.length||1;var charWidth=Math.round(charWidthSum/measureCount);var unwrappedWidth=charCount*charWidth;var estimatedWidth=!lineWrapping?unwrappedWidth:Math.min(unwrappedWidth,morphWidth);if(lineWrapping){var charsPerline=Math.max(3,morphWidth/charWidth);var wrappedLineCount=Math.ceil(charCount/charsPerline)||1;var estimatedHeight=Math.round(wrappedLineCount*charHeight);}debug&&console.log("".concat(line.row,": ").concat(line.height," => ").concat(estimatedHeight));line.changeExtent(estimatedWidth,estimatedHeight,true);}},{key:"estimateLineHeights",value:function TextLayout_estimateLineHeights_(morph,force){var fontMetric=morph.fontMetric,textRenderer=morph.textRenderer,document=morph.document,defaultTextStyle=morph.defaultTextStyle,clipMode=morph.clipMode,textAlign=morph.textAlign,padding=morph.padding,lineWrapping=morph.lineWrapping,debug=morph.debug;var _morph$getProperty2=morph.getProperty("extent"),morphWidth=_morph$getProperty2.x,morphHeight=_morph$getProperty2.y;var transform=morph.getGlobalTransform();var paddingLeft=padding.left();var paddingRight=padding.right();var paddingTop=padding.top();var paddingBottom=padding.bottom();var lines=document.lines,stringSize=document.stringSize;var directRenderTextLayerFn=textRenderer.directRenderTextLayerFn(morph);if(debug){debug=morph.debugHelper(debug);if(!debug.debugTextLayout)debug=false;}if(!debug&&morph.lineCount()<10&&morph.document.stringSize<3000&&!__varRecorder__$N.arr.any(morph.textAndAttributes,function(attr){return attr&&attr.fontFamily!=undefined;})){var directRenderLineFn=textRenderer.directRenderLineFn(morph);var linesBounds=fontMetric.manuallyComputeBoundsOfLines(morph,lines,0,0,{defaultTextStyle:defaultTextStyle,width:morphWidth,height:morphHeight,clipMode:clipMode,lineWrapping:lineWrapping,textAlign:textAlign,transform:transform,paddingLeft:paddingLeft,paddingRight:paddingRight,paddingTop:paddingTop,paddingBottom:paddingBottom},directRenderTextLayerFn,directRenderLineFn);for(var i=0;i<lines.length;i++){var _linesBounds$i=linesBounds[i],width=_linesBounds$i.width,height=_linesBounds$i.height;lines[i].changeExtent(width,height,!fontMetric.isFontSupported(morph.fontFamily,morph.fontWeight));}return;}var nMeasured=0;for(var i=0;i<lines.length;i++){var line=lines[i];if(!force&&line.height>0)continue;nMeasured++;this.estimateExtentOfLine(morph,line,transform);}morph.viewState._textLayoutStale=false;debug&&debug.log("estimateLineHeights, ".concat(nMeasured,"/").concat(lines.length," updated, force: ").concat(force));}},{key:"defaultCharExtent",value:function TextLayout_defaultCharExtent_(morph){var textRenderer=morph.textRenderer,fontMetric=morph.fontMetric,defaultTextStyle=morph.defaultTextStyle;var transform=morph.getGlobalTransform();var directRenderTextLayerFn=textRenderer.directRenderTextLayerFn(morph);return fontMetric.defaultCharExtent(morph,{transform:transform,defaultTextStyle:defaultTextStyle,width:1000},directRenderTextLayerFn);}},{key:"textBounds",value:function TextLayout_textBounds_(morph){var doc=morph.document,padding=morph.padding,borderWidthLeft=morph.borderWidthLeft,borderWidthRight=morph.borderWidthRight,borderWidthTop=morph.borderWidthTop,borderWidthBottom=morph.borderWidthBottom;return new __varRecorder__$N.Rectangle(padding.left(),padding.top(),Math.round(doc.width+borderWidthLeft+borderWidthRight),Math.round(doc.height+borderWidthTop+borderWidthBottom));}},{key:"isFirstLineVisible",value:function TextLayout_isFirstLineVisible_(morph){return morph.viewState.firstVisibleRow<=0;}},{key:"isLastLineVisible",value:function TextLayout_isLastLineVisible_(morph){return morph.viewState.lastVisibleRow>=morph.lineCount()-1;}},{key:"isLineVisible",value:function TextLayout_isLineVisible_(morph,row){return row>=morph.viewState.firstVisibleRow&&row<=morph.viewState.lastVisibleRow;}},{key:"isLineFullyVisible",value:function TextLayout_isLineFullyVisible_(morph,row){return row>=morph.viewState.firstFullyVisibleRow&&row<=morph.viewState.lastFullyVisibleRow;}},{key:"whatsVisible",value:function TextLayout_whatsVisible_(morph){var startRow=morph.viewState.firstVisibleRow;var endRow=morph.viewState.lastVisibleRow;var lines=morph.document.lines.slice(startRow,endRow);return{lines:lines,startRow:startRow,endRow:endRow};}},{key:"firstFullVisibleLine",value:function TextLayout_firstFullVisibleLine_(morph){return morph.viewState.firstFullyVisibleRow;}},{key:"lastFullVisibleLine",value:function TextLayout_lastFullVisibleLine_(morph){return morph.viewState.lastFullyVisibleRow;}},{key:"screenLineRange",value:function TextLayout_screenLineRange_(morph,textPos,ignoreLeadingWhitespace){var row=textPos.row,column=textPos.column;column=Math.max(0,column);row=Math.min(morph.lineCount()-1,Math.max(0,row));var charBounds=this.charBoundsOfRow(morph,row);if(column>charBounds.length-1)column=charBounds.length-1;var bounds=charBounds[column];var firstIndex=column;var lastIndex=column;for(var i=column+1;i<charBounds.length;i++){if(charBounds[i].y>bounds.y+bounds.height)break;lastIndex=i;}if(lastIndex===charBounds.length-1)lastIndex++;for(var i=column-1;i>=0;i--){if(charBounds[i].y<bounds.y+bounds.height)break;firstIndex=i;}if(ignoreLeadingWhitespace){var rangeString=morph.getLine(row).slice(firstIndex,lastIndex);var skip=rangeString.match(/^\s*/)[0].length;firstIndex=firstIndex+skip;}return new __varRecorder__$N.Range({start:{row:row,column:firstIndex},end:{row:row,column:lastIndex}});}},{key:"rangesOfWrappedLine",value:function TextLayout_rangesOfWrappedLine_(morph,row){var lineLength=morph.getLine(row).length;var column=0;var ranges=[];while(true){var _range2=this.screenLineRange(morph,{row:row,column:column},false);ranges.push(_range2);if(_range2.end.column>=lineLength)break;var nextColumn=_range2.end.column+1;if(nextColumn>=lineLength)break;if(nextColumn<=column){if(!morph.env.renderer.getNodeForMorph(morph)){column=nextColumn;break;}throw new Error("should not happen ".concat(_range2.end.column," vs ").concat(column));}column=nextColumn;}return ranges;}},{key:"chunkAtPos",value:function TextLayout_chunkAtPos_(morph,pos){__varRecorder__$N.todo("chunkAtPos");}},{key:"charBoundsOfRow",value:function TextLayout_charBoundsOfRow_(morph,row){var doc=morph.document;var line=doc.getLine(row);if(morph._initializedByCachedBounds&&!this._restored){this.restore(morph._initializedByCachedBounds,morph);this._restored=true;}var cached=this.lineCharBoundsCache.get(line);if(cached)return cached;var _morph$getProperty3=morph.getProperty("extent"),width=_morph$getProperty3.x,height=_morph$getProperty3.y;var fontMetric=morph.fontMetric,textRenderer=morph.textRenderer,defaultTextStyle=morph.defaultTextStyle,clipMode=morph.clipMode,textAlign=morph.textAlign,padding=morph.padding,lineWrapping=morph.lineWrapping;var transform=morph.getGlobalTransform();var paddingLeft=padding.left();var paddingRight=padding.right();var paddingTop=padding.top();var paddingBottom=padding.bottom();var directRenderLineFn=textRenderer.directRenderLineFn(morph);var directRenderTextLayerFn=textRenderer.directRenderTextLayerFn(morph);var charBounds=fontMetric.manuallyComputeCharBoundsOfLine(morph,line,0,0,{defaultTextStyle:defaultTextStyle,width:width,height:height,clipMode:clipMode,lineWrapping:lineWrapping,textAlign:textAlign,paddingLeft:paddingLeft,paddingRight:paddingRight,paddingTop:paddingTop,paddingBottom:paddingBottom,transform:transform},directRenderTextLayerFn,directRenderLineFn);if(charBounds.find(function(r){return r.width==undefined&&r.height==undefined;})){return charBounds;}this.lineCharBoundsCache.set(line,charBounds);return charBounds;}},{key:"computeMaxBoundsForLineSelection",value:function TextLayout_computeMaxBoundsForLineSelection_(morph,selection){var start=selection.start,end=selection.end;var textLayout=morph.textLayout;var intersectingRect=textLayout.rangesOfWrappedLine(morph,start.row).find(function(r){return r.containsPosition(start);});var end=morph.lineWrapping&&intersectingRect?intersectingRect.intersect(selection).end:end;var end=end.row==start.row?end:{row:end.row,column:-1};var charBoundsInSelection=textLayout.charBoundsOfRow(morph,start.row);var charBoundsInSelection=end.column<0?charBoundsInSelection.slice(start.column):charBoundsInSelection.slice(start.column,end.column+1);var maxCol=start.column+(charBoundsInSelection?charBoundsInSelection.indexOf(__varRecorder__$N.arr.max(charBoundsInSelection,function(b){return b.height;})):0);return textLayout.boundsFor(morph,{row:start.row,column:maxCol});}},{key:"boundsFor",value:function TextLayout_boundsFor_(morph,docPos){var row=docPos.row,column=docPos.column;column=Math.max(0,column);row=Math.min(morph.lineCount()-1,Math.max(0,row));var charBounds=this.charBoundsOfRow(morph,row);var bounds;if(charBounds.length>0){if(column>=charBounds.length){var _charBounds=charBounds[charBounds.length-1],_x195=_charBounds.x,_y11=_charBounds.y,width=_charBounds.width,height=_charBounds.height;bounds=new __varRecorder__$N.Rectangle(_x195+width,_y11,0,height);}else bounds=__varRecorder__$N.Rectangle.fromLiteral(charBounds[column]);}if(!bounds){console.warn("Cannot compute bounds for line ".concat(row,"/").concat(column));bounds=new __varRecorder__$N.Rectangle(0,0,0,0);}var doc=morph.document,padding=morph.padding;bounds.x=bounds.x+padding.left();bounds.y=bounds.y+doc.computeVerticalOffsetOf(row)+padding.top();return bounds;}},{key:"pixelPositionFor",value:function TextLayout_pixelPositionFor_(morph,docPos){return this.boundsFor(morph,docPos).topLeft();}},{key:"textPositionFromPoint",value:function TextLayout_textPositionFromPoint_(morph,point){var _point$addPt=point.addPt(morph.origin),x=_point$addPt.x,y=_point$addPt.y;var doc=morph.document,padding=morph.padding,origin=morph.origin;var padL=padding.left();var padT=padding.top();if(y>doc.height+padT)return doc.endPosition;else if(y<padT)return{row:0,column:0};var found=doc.findLineByVerticalOffset(y-padT);if(!found){return{row:0,column:0};}var row=found.line.row;var charBounds=this.charBoundsOfRow(morph,row);var nChars=charBounds.length;var first=charBounds[0];var last=charBounds[nChars-1];var result={row:row,column:0};x=x-padL;y=y-(padT+doc.computeVerticalOffsetOf(row));if(nChars===0||x<=first.x+Math.round(first.width/2)&&y>=first.y&&y<=first.y+first.height)return result;if(x>last.x+Math.round(last.width/2)&&y>=last.y&&y<=last.y+last.height){result.column=nChars;return result;}var wrappedCharBoundsWithMatchingVerticalPos=[];for(var i=nChars-1;i>=0;i--){var cb=charBounds[i];var cbX=cb.x,cbWidth=cb.width,cbY=cb.y,cbHeight=cb.height;if(y<cbY||y>cbY+cbHeight)continue;wrappedCharBoundsWithMatchingVerticalPos.push(cb);if(x>=cbX+Math.round(cbWidth/2)){var clickedAtEndOfWrappedLine=wrappedCharBoundsWithMatchingVerticalPos.length===1;result.column=clickedAtEndOfWrappedLine?i:i+1;return result;}}if(wrappedCharBoundsWithMatchingVerticalPos.length){result.column=charBounds.indexOf(__varRecorder__$N.arr.last(wrappedCharBoundsWithMatchingVerticalPos));return result;}var minDist=Infinity;var minIndex=-1;for(var i=0;i<charBounds.length;i++){var _cb=charBounds[i];var _cbX=_cb.x,_cbWidth=_cb.width,_cbY=_cb.y,_cbHeight=_cb.height;var dist=point.distSquared(__varRecorder__$N.pt(_cbX+_cbWidth/2,_cbY+_cbHeight/2));if(dist>=minDist)continue;minDist=dist;minIndex=i;}result.column=minIndex;return result;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TextLayout";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/layout.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:244,end:17181});}(undefined);TextLayout=__varRecorder__$N.TextLayout;var TextLayout$1=TextLayout;__varRecorder__$N["default"]=TextLayout;var __varRecorder__$O=lively.FreezerRuntime.recorderFor("lively.morphic/text/renderer.js");function printViewState(textMorph){var _textMorph$viewState=textMorph.viewState,scrollTop=_textMorph$viewState.scrollTop,scrollHeight=_textMorph$viewState.scrollHeight,heightBefore=_textMorph$viewState.heightBefore,textHeight=_textMorph$viewState.textHeight,firstVisibleRow=_textMorph$viewState.firstVisibleRow,lastVisibleRow=_textMorph$viewState.lastVisibleRow,firstFullyVisibleRow=_textMorph$viewState.firstFullyVisibleRow,lastFullyVisibleRow=_textMorph$viewState.lastFullyVisibleRow,visibleLines=_textMorph$viewState.visibleLines,lines=textMorph.document.lines;console.log("".concat(textMorph," #").concat(textMorph.id.slice(0,12),"\nscroll: ").concat(scrollTop," + ").concat(scrollHeight,"\nlines: ").concat(firstVisibleRow," - ").concat(lastVisibleRow,"\nvisible lines: ").concat(lastVisibleRow-firstVisibleRow,"\nheight: ").concat(textHeight,", ").concat(lines.length," lines"));}__varRecorder__$O.printViewState=printViewState;function installCSS(domEnv){__varRecorder__$O.cssInstalled=true;__varRecorder__$O.addOrChangeCSSDeclaration("new-text-css","\n\n    /* markers */\n\n    .newtext-marker-layer {\n      position: absolute;\n    }\n\n    /* selection / cursor */\n\n    .newtext-cursor {\n      z-index: 5;\n      pointer-events: none;\n      position: absolute;\n      background-color: black;\n    }\n\n    .hidden-cursor .newtext-cursor {\n      background-color: transparent !important;\n    }\n\n    .newtext-cursor.diminished {\n      background-color: gray;\n    }\n\n    .newtext-selection-layer {\n      position: absolute;\n    }\n\n    /*-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/\n    /* text layer / content */\n\n    .newtext-text-layer {\n      box-sizing: border-box;\n      position: absolute;\n      white-space: pre;\n      z-index: 0;\n      min-width: 100%;\n      pointer-events: none;\n    }\n\n    .newtext-before-filler {}\n\n    .newtext-text-layer.wrap-by-words {\n      white-space: pre-wrap;\n      overflow-wrap: break-word;\n      max-width: 100%;\n    }\n\n    .newtext-text-layer.only-wrap-by-words {\n      white-space: pre-wrap;\n      overflow-wrap: break-all;\n      max-width: 100%;\n    }\n\n    .newtext-text-layer.wrap-by-chars {\n      white-space: pre-wrap;\n      word-break: break-all;\n      max-width: 100%;\n    }\n\n    .newtext-text-layer.no-wrapping {\n    }\n\n    .newtext-text-layer a {\n       pointer-events: auto;\n    }\n\n    .newtext-text-layer.auto-width .line {\n      width: fit-content;\n    }\n\n    .newtext-text-layer .line {\n      -moz-border-radius: 0;\n      -webkit-border-radius: 0;\n      border-radius: 0;\n      border-width: 0;\n      background: transparent;\n      font-family: inherit;\n      font-size: inherit;\n      margin: 0;\n      word-wrap: normal;\n      line-height: inherit;\n      color: inherit;\n      position: relative;\n      overflow: visible;\n      -webkit-tap-highlight-color: transparent;\n      -webkit-font-variant-ligatures: contextual;\n      font-variant-ligatures: contextual;\n    }\n\n    .line > .Morph {\n      display: inline-block !important;\n      vertical-align: top !important;\n    }\n\n    blockquote {\n      margin: 0;\n      -webkit-margin-start: 0;\n      -webkit-margin-end: 0;\n    }\n\n    .newtext-text-layer blockquote {\n      margin-left: 2em;\n      margin-right: 2em;\n      border-left: 2px lightgray solid;\n      padding-left: 2%;\n    }\n\n    /* -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*/\n    /* debug styling */\n\n    .debug-info {\n      position: absolute;\n      outline: 1px solid green;\n      pointer-events: none;\n      z-index: 4;\n      text-align: center;\n      font-family: monospace;\n      color: green;\n      background-color: white;\n      font-size: small;\n      vertical-align: baseline;\n    }\n\n    .debug-line {\n      position: absolute;\n      outline: 1px solid red;\n      pointer-events: none;\n      z-index: 4,\n      text-align: right;\n      font-family: monospace;\n      font-size: small;\n      vertical-align: baseline;\n      color: red;\n    }\n\n    .debug-char {\n      position: absolute;\n      outline: 1px solid orange;\n      pointer-events: none;\n      z-index: 3\n    }\n\n  ",domEnv.document);}__varRecorder__$O.installCSS=installCSS;function extractHTMLFromTextMorph(textMorph){var textAndAttributes=arguments.length>1&&arguments[1]!==undefined?arguments[1]:textMorph.textAndAttributesInRange(textMorph.selection.range);var text=new textMorph.constructor(Object.assign({},textMorph.defaultTextStyle,{width:textMorph.width,textAndAttributes:textAndAttributes}));var render=text.textRenderer.directRenderTextLayerFn(text);var renderLine=text.textRenderer.directRenderLineFn(text);var textLayerNode=render();var style=System.global&&System.global.getComputedStyle?System.global.getComputedStyle(textLayerNode):null;if(style){textLayerNode.ownerDocument.body.appendChild(textLayerNode);textLayerNode.style.whiteSpace=style.whiteSpace;textLayerNode.style.overflowWrap=style.overflowWrap;textLayerNode.style.wordBreak=style.wordBreak;textLayerNode.style.minWidth=style.minWidth;textLayerNode.parentNode.removeChild(textLayerNode);}var _iterator76=_createForOfIteratorHelper(text.document.lines),_step76;try{for(_iterator76.s();!(_step76=_iterator76.n()).done;){var line=_step76.value;textLayerNode.appendChild(renderLine(line));}}catch(err){_iterator76.e(err);}finally{_iterator76.f();}return textLayerNode.outerHTML;}__varRecorder__$O.extractHTMLFromTextMorph=extractHTMLFromTextMorph;__varRecorder__$O.obj=obj;__varRecorder__$O.arr=arr;__varRecorder__$O.num=num;__varRecorder__$O.pt=pt;__varRecorder__$O.Rectangle=Rectangle;__varRecorder__$O.vdom=exports$1$h;__varRecorder__$O.defaultAttributes=defaultAttributes;__varRecorder__$O.defaultStyle=defaultStyle;__varRecorder__$O.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;__varRecorder__$O.hyperscriptFnForDocument=hyperscriptFnForDocument;__varRecorder__$O.objectReplacementChar=objectReplacementChar;__varRecorder__$O.config=config;__varRecorder__$O.getSvgVertices=getSvgVertices;var destructured_1$3=__varRecorder__$O.vdom;__varRecorder__$O.h=destructured_1$3.h;__varRecorder__$O.create=destructured_1$3.create;__varRecorder__$O.patch=destructured_1$3.patch;__varRecorder__$O.diff=destructured_1$3.diff;__varRecorder__$O.cssInstalled=false;__varRecorder__$O.debug=!!__varRecorder__$O.config.onloadURLQuery["debug-text"];__varRecorder__$O.nextTick=function(window,prefixes,i,p,fnc,to){while(!fnc&&i<prefixes.length){fnc=window[prefixes[i++]+"equestAnimationFrame"];}return fnc&&fnc.bind(window)||window.setImmediate||function(fnc){window.setTimeout(fnc,0);};}(typeof window!=="undefined"?window:global,"r webkitR mozR msR oR".split(" "),0);var AfterTextRenderHook=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/renderer.js");var __lively_class__=__lively_classholder__.hasOwnProperty("AfterTextRenderHook")&&typeof __lively_classholder__.AfterTextRenderHook==="function"?__lively_classholder__.AfterTextRenderHook:__lively_classholder__.AfterTextRenderHook=function AfterTextRenderHook(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"reset",value:function AfterTextRenderHook_reset_(morph){this.morph=morph;this.called=false;this.needsRerender=false;}},{key:"updateLineHeightOfNode",value:function AfterTextRenderHook_updateLineHeightOfNode_(morph,docLine,lineNode){if(docLine.height===0||docLine.hasEstimatedExtent){var tfm=morph.getGlobalTransform().inverse();tfm.e=tfm.f=0;var needsTransformAdjustment=tfm.getScale()!=1||tfm.getRotation()!=0;if(needsTransformAdjustment)lineNode.style.transform=tfm.toString();var _lineNode$getBounding2=lineNode.getBoundingClientRect(),nodeHeight=_lineNode$getBounding2.height,nodeWidth=_lineNode$getBounding2.width;if(needsTransformAdjustment)lineNode.style.transform="";if(nodeHeight&&nodeWidth&&(docLine.height!==nodeHeight||docLine.width!==nodeWidth)&&morph.fontMetric.isFontSupported(morph.fontFamily,morph.fontWeight)){docLine.changeExtent(nodeWidth,nodeHeight,false);morph.textLayout.resetLineCharBoundsCacheOfLine(docLine);this.needsRerender=true;morph.viewState._needsFit=true;}if(docLine.textAndAttributes&&docLine.textAndAttributes.length){var inlineMorph;for(var _j20=0,column=0;_j20<docLine.textAndAttributes.length;_j20+=2){inlineMorph=docLine.textAndAttributes[_j20];if(inlineMorph&&inlineMorph.isMorph){morph._positioningSubmorph=inlineMorph;inlineMorph.position=morph.textLayout.pixelPositionFor(morph,{row:docLine.row,column:column}).subPt(morph.origin);inlineMorph._dirty=false;morph._positioningSubmorph=null;column++;}else if(inlineMorph){column+=inlineMorph.length;}}}return nodeHeight;}return docLine.height;}},{key:"updateExtentsOfLines",value:function AfterTextRenderHook_updateExtentsOfLines_(textlayerNode){var morph=this.morph;var textLayout=morph.textLayout,viewState=morph.viewState,fontMetric=morph.fontMetric;viewState.dom_nodes=[];viewState.dom_nodeFirstRow=0;viewState.textWidth=textlayerNode.scrollWidth;var lineNodes=textlayerNode.children;var i=0;var firstLineNode;while(i<lineNodes.length&&lineNodes[i].className!="line"){i++;}if(i<lineNodes.length){firstLineNode=lineNodes[i];}else{return;}var ds=firstLineNode.dataset;var row=Number(ds?ds.row:firstLineNode.getAttribute("data-row"));if(typeof row!=="number"||isNaN(row))return;viewState.dom_nodeFirstRow=row;var actualTextHeight=0;var line=morph.document.getLine(row);var foundEstimatedLine;for(;i<lineNodes.length;i++){var node=lineNodes[i];viewState.dom_nodes.push(node);if(line){if(!foundEstimatedLine){foundEstimatedLine=line.hasEstimatedExtent;}line.hasEstimatedExtent=foundEstimatedLine;actualTextHeight=actualTextHeight+this.updateLineHeightOfNode(morph,line,node);line.hasEstimatedExtent=!fontMetric.isFontSupported(morph.fontFamily,morph.fontWeight);line=line.nextLine();}}if(this.needsRerender){morph.fitIfNeeded();morph.makeDirty();}else morph._dirty=!!morph.submorphs.find(function(m){return m.needsRerender();});}},{key:"hook",value:function AfterTextRenderHook_hook_(node,propName,prevValue){if(!node||!node.parentNode)return;var vs=this.morph.viewState;vs.text_layer_node=node;vs.fontmetric_text_layer_node=null;this.called=true;this.updateExtentsOfLines(node);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"AfterTextRenderHook";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/renderer.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:4957,end:9032});}(undefined);var TextRenderer=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/renderer.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TextRenderer")&&typeof __lively_classholder__.TextRenderer==="function"?__lively_classholder__.TextRenderer:__lively_classholder__.TextRenderer=function TextRenderer(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function TextRenderer_initialize_(domEnv){if(!domEnv){console.warn("Text renderer initialized without domEnv. Depending on what you want to do you might have bad luck...!");}else if(!__varRecorder__$O.cssInstalled)__varRecorder__$O.installCSS(domEnv);this.domEnv=domEnv;}},{key:"directRenderLineFn",value:function TextRenderer_directRenderLineFn_(morph){var _this155=this;var fn=morph.viewState._renderLineFn;if(!fn){var _h7=__varRecorder__$O.hyperscriptFnForDocument(this.domEnv.document);fn=morph.viewState._renderLineFn=function(line){return _this155.renderLine(_h7,null,morph,line);};}return fn;}},{key:"directRenderTextLayerFn",value:function TextRenderer_directRenderTextLayerFn_(morph){var _this156=this;var fn=morph.viewState._renderTextLayerFn;if(!fn){var _h8=__varRecorder__$O.hyperscriptFnForDocument(this.domEnv.document);fn=morph.viewState._renderTextLayerFn=function(additionalStyle){return _this156.renderJustTextLayerNode(_h8,morph,additionalStyle,[]);};}return fn;}},{key:"renderMorph",value:function TextRenderer_renderMorph_(morph,renderer){var cursorWidth=morph.cursorWidth||1;var selectionLayer=[];var sel=morph.selection;if(morph.inMultiSelectMode()){var _selectionLayer2;var sels=sel.selections;var _i160=0;for(;_i160<sels.length-1;_i160++){var _selectionLayer;(_selectionLayer=selectionLayer).push.apply(_selectionLayer,_toConsumableArray2(this.renderSelectionLayer(morph,sels[_i160],true,2)));}(_selectionLayer2=selectionLayer).push.apply(_selectionLayer2,_toConsumableArray2(this.renderSelectionLayer(morph,sels[_i160],false,4)));}else{selectionLayer=this.renderSelectionLayer(morph,sel,false,cursorWidth);}var textLayer=this.renderTextLayer(morph,renderer);var textLayerForFontMeasure=this.renderJustTextLayerNode(__varRecorder__$O.h,morph,null,[]);var markerLayer=this.renderMarkerLayer(morph,renderer);var horizontalScrollBarVisible=morph.document.width>morph.width;var scrollBarOffset=horizontalScrollBarVisible?morph.scrollbarOffset:__varRecorder__$O.pt(0,0);var scrollLayer=__varRecorder__$O.h("div",{className:"scrollLayer",style:Object.assign({position:"absolute",top:0+"px"},morph.viewState.fastScroll?{overflow:morph.scrollActive?morph.clipMode:"hidden"}:{},{width:morph.width+"px",height:morph.height+"px"})},[__varRecorder__$O.h("div",{style:{width:Math.max(morph.document.width,morph.width)+"px",height:Math.max(morph.document.height,morph.height)-scrollBarOffset.y+"px"}})]);textLayer.properties.className+=" actual";textLayer.properties.style.overflow=morph.clipMode==="visible"?"visible":"hidden";textLayerForFontMeasure.properties.className+=" font-measure";var embeddedMorphMap=morph.embeddedMorphMap;var submorphsNotInText=embeddedMorphMap?morph.submorphs.filter(function(ea){return!embeddedMorphMap.has(ea);}):morph.submorphs;var subNodes=[].concat(_toConsumableArray2(selectionLayer),[markerLayer,textLayerForFontMeasure,textLayer,renderer.renderSelectedSubmorphs(morph,submorphsNotInText)]);return __varRecorder__$O.h("div",Object.assign({},__varRecorder__$O.defaultAttributes(morph,renderer),{style:Object.assign({},__varRecorder__$O.defaultStyle(morph),{},morph.viewState.fastScroll?{overflow:morph.clipMode=="visible"?"visible":"hidden"}:{},{"-moz-user-select":"none",cursor:morph.nativeCursor==="auto"?morph.readOnly?"default":"text":morph.nativeCursor})}),[scrollLayer].concat(_toConsumableArray2(morph.viewState.fastScroll?[__varRecorder__$O.h("div",{className:"scrollWrapper",style:{"pointer-events":"none",position:"absolute",width:"100%",height:"100%",transform:"translate(-".concat(morph.scroll.x,"px, -").concat(morph.scroll.y,"px)")}},subNodes)]:subNodes)));}},{key:"renderTextLayer",value:function TextRenderer_renderTextLayer_(morph,renderer){var _this157=this;var children=morph.debug?[].concat(_toConsumableArray2(this.renderDebugLayer(morph)),_toConsumableArray2(this.renderLines(__varRecorder__$O.h,renderer,morph))):this.renderLines(__varRecorder__$O.h,renderer,morph);var node=this.renderJustTextLayerNode(__varRecorder__$O.h,morph,null,children);node.properties.style.position="absolute";var hook=morph.viewState.afterTextRenderHook||(morph.viewState.afterTextRenderHook=new __varRecorder__$O.AfterTextRenderHook());hook.reset(morph);node.properties["after-text-render-hook"]=hook;__varRecorder__$O.nextTick(function(){_this157.manuallyTriggerTextRenderHook(morph,renderer);});return node;}},{key:"manuallyTriggerTextRenderHook",value:function TextRenderer_manuallyTriggerTextRenderHook_(morph,renderer){var hook=morph.viewState.afterTextRenderHook;if(!hook||hook.called)return;var node=renderer.getNodeForMorph(morph);var textlayerNode=node&&node.querySelector(".actual.newtext-text-layer");if(textlayerNode)hook.hook(textlayerNode);if(morph.ownerChain().every(function(m){return m.visible;})){morph.fit();}}},{key:"renderJustTextLayerNode",value:function TextRenderer_renderJustTextLayerNode_(h,morph,additionalStyle,children){var height=morph.height,_morph$padding=morph.padding,padLeft=_morph$padding.x,padTop=_morph$padding.y,padWidth=_morph$padding.width,padHeight=_morph$padding.height,lineWrapping=morph.lineWrapping,fixedWidth=morph.fixedWidth,fixedHeight=morph.fixedHeight,backgroundColor=morph.backgroundColor,fontColor=morph.fontColor,textAlign=morph.textAlign,fontSize=morph.fontSize,textDecoration=morph.textDecoration,fontStyle=morph.fontStyle,fontWeight=morph.fontWeight,fontFamily=morph.fontFamily,lineHeight=morph.lineHeight,wordSpacing=morph.wordSpacing,letterSpacing=morph.letterSpacing,doc=morph.document,tabWidth=morph.tabWidth;var padRight=padLeft+padWidth;var padBottom=padTop+padHeight;var textHeight=Math.max(morph.document.height,morph.height);var textLayerClasses="newtext-text-layer";switch(lineWrapping){case true:case"by-words":textLayerClasses=textLayerClasses+" wrap-by-words";break;case"only-by-words":textLayerClasses=textLayerClasses+" only-wrap-by-words";break;case"by-chars":textLayerClasses=textLayerClasses+" wrap-by-chars";break;case false:textLayerClasses=textLayerClasses+" no-wrapping";break;}if(!fixedWidth)textLayerClasses=textLayerClasses+" auto-width";if(!fixedHeight)textLayerClasses=textLayerClasses+" auto-height";var style={height:textHeight+"px"};if(padLeft>0)style.paddingLeft=padLeft+"px";if(padRight>0)style.paddingRight=padRight+"px";if(padTop>0)style.paddingTop=padTop+"px";if(padBottom>0)style.paddingBottom=padBottom+"px";if(letterSpacing)style.letterSpacing=letterSpacing;if(wordSpacing)style.wordSpacing=wordSpacing;if(lineHeight)style.lineHeight=lineHeight;if(fontFamily)style.fontFamily=fontFamily;if(fontWeight)style.fontWeight=fontWeight;if(fontStyle)style.fontStyle=fontStyle;if(textDecoration)style.textDecoration=textDecoration;if(fontSize)style.fontSize=fontSize+"px";if(textAlign)style.textAlign=textAlign;if(fontColor)style.color=String(fontColor);if(backgroundColor)style.backgroundColor=backgroundColor;if(tabWidth!==8)style.tabSize=tabWidth;var textAttrs={className:textLayerClasses,style:style};style.overflow="hidden";if(additionalStyle){var clipMode=additionalStyle.clipMode,_height4=additionalStyle.height,width=additionalStyle.width;if(typeof width==="number"){style.width=width+"px";}if(typeof _height4==="number"){style.height=_height4+"px";}if(clipMode){style.overflow=clipMode;}}return h("div",textAttrs,children);}},{key:"renderLines",value:function TextRenderer_renderLines_(h,renderer,morph){var height=morph.height,scroll=morph.scroll,_morph$padding2=morph.padding,padLeft=_morph$padding2.x,padTop=_morph$padding2.y,padWidth=_morph$padding2.width,padHeight=_morph$padding2.height,doc=morph.document,clipMode=morph.clipMode;var node=renderer.getNodeForMorph(morph);var scrollTop=scroll.y;var scrollHeight=height;var lastLineNo=doc.rowCount-1;var textHeight=doc.height;var clips=clipMode!=="visible";var _ref115=doc.findLineByVerticalOffset(clips?Math.max(0,clips?scrollTop-padTop:0):0)||{row:0,y:0,offset:0,line:doc.getLine(0)},startLine=_ref115.line,startOffset=_ref115.offset,heightBefore=_ref115.y,startRow=_ref115.row;var _ref116=doc.findLineByVerticalOffset(clips?Math.min(textHeight,scrollTop-padTop+scrollHeight):textHeight)||{row:lastLineNo,offset:0,y:0,line:doc.getLine(lastLineNo)},endLine=_ref116.line,endLineOffset=_ref116.offset,endRow=_ref116.row;var firstVisibleRow=clips?startRow:0;var firstFullyVisibleRow=startOffset===0?startRow:startRow+1;var lastVisibleRow=clips?endRow+1:lastLineNo;var lastFullyVisibleRow=!endLine||endLineOffset===endLine.height?endRow:endRow-1;this.maxVisibleLines=Math.max(this.maxVisibleLines||1,lastVisibleRow-firstVisibleRow+1);var visibleLines=[];var renderedLines=[];renderedLines.push(h("div.newtext-before-filler",{key:"filler",style:{height:heightBefore+"px"}}));var line=startLine;var i=0;while(i<this.maxVisibleLines){visibleLines.push(line);var newLine=this.renderLine(h,renderer,morph,line);renderedLines.push(newLine);newLine.key=line.row%this.maxVisibleLines;i++;line=line.nextLine();if(!line)break;}Object.assign(morph.viewState,{scrollTop:scrollTop,scrollHeight:scrollHeight,scrollBottom:scrollTop+scrollHeight,heightBefore:heightBefore,textHeight:textHeight,firstVisibleRow:firstVisibleRow,lastVisibleRow:lastVisibleRow,firstFullyVisibleRow:firstFullyVisibleRow,lastFullyVisibleRow:lastFullyVisibleRow,visibleLines:visibleLines});morph.debug&&__varRecorder__$O.printViewState(morph);return renderedLines;}},{key:"renderLine",value:function TextRenderer_renderLine_(h,renderer,morph,line){var textAndAttributes=line.textAndAttributes;var renderedChunks=[];var size=textAndAttributes.length;var content;var attr;var fontSize;var fontFamily;var fontWeight;var fontStyle;var textDecoration;var fontColor;var backgroundColor;var nativeCursor;var textStyleClasses;var link;var tagname;var nodeStyle;var nodeAttrs;var paddingRight;var paddingLeft;var paddingTop;var paddingBottom;var lineHeight;var textAlign;var verticalAlign;var wordSpacing;var letterSpacing;var quote;var textStroke;var minFontSize=morph.fontSize;if(size>0){for(var _i161=0;_i161<size;_i161=_i161+2){content=textAndAttributes[_i161]||"\xA0";attr=textAndAttributes[_i161+1];if(typeof content!=="string"){renderedChunks.push(content.isMorph?this.renderEmbeddedSubmorph(h,renderer,content,attr):__varRecorder__$O.objectReplacementChar);continue;}if(!attr){renderedChunks.push(content);continue;}fontSize=attr.fontSize&&(__varRecorder__$O.obj.isString(attr.fontSize)?attr.fontSize:attr.fontSize+"px");fontFamily=attr.fontFamily;fontWeight=attr.fontWeight;fontStyle=attr.fontStyle;textDecoration=attr.textDecoration;fontColor=attr.fontColor;backgroundColor=attr.backgroundColor;nativeCursor=attr.nativeCursor;textStyleClasses=attr.textStyleClasses;link=attr.link;lineHeight=attr.lineHeight||lineHeight;textAlign=attr.textAlign||textAlign;wordSpacing=attr.wordSpacing||wordSpacing;letterSpacing=attr.letterSpacing||letterSpacing;paddingRight=attr.paddingRight;paddingLeft=attr.paddingLeft;paddingTop=attr.paddingTop;paddingBottom=attr.paddingBottom;verticalAlign=attr.verticalAlign;textStroke=attr.textStroke;quote=attr.quote||quote;tagname="span";nodeStyle={};nodeAttrs={style:nodeStyle};if(fontSize&&attr.fontSize<minFontSize)minFontSize=attr.fontSize;if(link){tagname="a";nodeAttrs.href=link;if(link&&link.startsWith("http"))nodeAttrs.target="_blank";}if(link||nativeCursor)nodeStyle.pointerEvents="auto";if(fontSize)nodeStyle.fontSize=fontSize;if(fontFamily)nodeStyle.fontFamily=fontFamily;if(fontWeight)nodeStyle.fontWeight=fontWeight;if(fontStyle)nodeStyle.fontStyle=fontStyle;if(textDecoration)nodeStyle.textDecoration=textDecoration;if(fontColor)nodeStyle.color=String(fontColor);if(backgroundColor)nodeStyle.backgroundColor=String(backgroundColor);if(nativeCursor)nodeStyle.cursor=nativeCursor;if(paddingRight)nodeStyle.paddingRight=paddingRight;if(paddingLeft)nodeStyle.paddingLeft=paddingLeft;if(paddingTop)nodeStyle.paddingTop=paddingTop;if(paddingBottom)nodeStyle.paddingBottom=paddingBottom;if(verticalAlign)nodeStyle.verticalAlign=verticalAlign;if(textStroke)nodeStyle["-webkit-text-stroke"]=textStroke;if(attr.doit){nodeStyle.pointerEvents="auto";nodeStyle.cursor="pointer";}if(textStyleClasses&&textStyleClasses.length){nodeAttrs.className=textStyleClasses.join(" ");}renderedChunks.push(h(tagname,nodeAttrs,content));}}else renderedChunks.push(h("br"));var lineStyle={};var lineTag="div";if(morph.fontSize>minFontSize)lineStyle.fontSize=minFontSize+"px";if(lineHeight)lineStyle.lineHeight=lineHeight;if(textAlign)lineStyle.textAlign=textAlign;if(letterSpacing)lineStyle.letterSpacing=letterSpacing;if(wordSpacing)lineStyle.wordSpacing=wordSpacing;var node=h(lineTag,{className:"line",style:lineStyle,dataset:{row:line.row}},renderedChunks);if(quote){if(typeof quote!=="number")quote=1;for(var _i162=quote;_i162--;){node=h("blockquote",{},node);}}return node;}},{key:"renderEmbeddedSubmorph",value:function TextRenderer_renderEmbeddedSubmorph_(h,renderer,morph,attr){var rendered;attr=attr||{};if(renderer){rendered=renderer.render(morph);rendered.properties.style.position="relative";rendered.properties.style.transform="";rendered.properties.style.textAlign="initial";if(attr.paddingTop)rendered.properties.style.marginTop=attr.paddingTop;if(attr.paddingLeft)rendered.properties.style.marginLeft=attr.paddingLeft;if(attr.paddingRight)rendered.properties.style.marginRight=attr.paddingRight;if(attr.paddingBottom)rendered.properties.style.marginBottom=attr.paddingBottom;return rendered;}var extent=morph.extent,styleClasses=morph.styleClasses;var width=extent.x+"px";var height=extent.y+"px";return h("div",{className:styleClasses.join(" "),style:{width:width,height:height}},[]);}},{key:"renderSelectionLayer",value:function TextRenderer_renderSelectionLayer_(morph,selection){var diminished=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var cursorWidth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:2;if(!selection)return[];var textLayout=morph.textLayout;var start=selection.start,end=selection.end,cursorVisible=selection.cursorVisible,selectionColor=selection.selectionColor;var document=morph.document,cursorColor=morph.cursorColor;var isReverse=selection.isReverse();var startBounds=textLayout.boundsFor(morph,start);var maxBounds=textLayout.computeMaxBoundsForLineSelection(morph,selection);var endBounds=textLayout.boundsFor(morph,end);var startPos=__varRecorder__$O.pt(startBounds.x,maxBounds.y);var endPos=__varRecorder__$O.pt(endBounds.x,endBounds.y);var leadLineHeight=startBounds.height;var endLineHeight=endBounds.height;var cursorPos=isReverse?__varRecorder__$O.pt(startBounds.x,startBounds.y):endPos;var cursorHeight=isReverse?leadLineHeight:endLineHeight;var renderedCursor=this.cursor(cursorPos,cursorHeight,cursorVisible,diminished,cursorWidth,cursorColor);if(selection.isEmpty())return[renderedCursor];var slices=[];var row=selection.start.row;var yOffset=document.computeVerticalOffsetOf(row)+morph.padding.top();var paddingLeft=morph.padding.left();var bufferOffset=50;var charBounds,selectionTopLeft,selectionBottomRight,isFirstLine,cb,line,isWrapped;while(row<=selection.end.row){line=document.getLine(row);if(row<morph.viewState.firstVisibleRow-bufferOffset){yOffset+=line.height;row++;continue;}if(row>morph.viewState.lastVisibleRow+bufferOffset)break;charBounds=textLayout.charBoundsOfRow(morph,row).map(__varRecorder__$O.Rectangle.fromLiteral);isFirstLine=row==selection.start.row;isWrapped=charBounds[0].bottom()<__varRecorder__$O.arr.last(charBounds).top();if(isWrapped){var rangesToRender=textLayout.rangesOfWrappedLine(morph,row).map(function(r){return r.intersect(selection);});var isFirstSubLine=isFirstLine;var subLineMinY=0;var subCharBounds=void 0;var subLineMaxBottom=void 0;var _iterator77=_createForOfIteratorHelper(rangesToRender),_step77;try{for(_iterator77.s();!(_step77=_iterator77.n()).done;){var _r5=_step77.value;if(_r5.isEmpty())continue;subCharBounds=charBounds.slice(_r5.start.column,_r5.end.column);subLineMinY=isFirstSubLine?__varRecorder__$O.arr.min(subCharBounds.map(function(cb){return cb.top();})):subLineMinY;subLineMaxBottom=__varRecorder__$O.arr.max(subCharBounds.map(function(cb){return cb.bottom();}));cb=subCharBounds[0];selectionTopLeft=__varRecorder__$O.pt(paddingLeft+cb.left(),yOffset+subLineMinY);cb=__varRecorder__$O.arr.last(subCharBounds);selectionBottomRight=__varRecorder__$O.pt(paddingLeft+cb.right(),yOffset+subLineMaxBottom);subLineMinY=subLineMaxBottom;isFirstSubLine=false;slices.push(__varRecorder__$O.Rectangle.fromAny(selectionTopLeft,selectionBottomRight));}}catch(err){_iterator77.e(err);}finally{_iterator77.f();}}if(!isWrapped){var isLastLine=row==selection.end.row;var startIdx=isFirstLine?selection.start.column:0;var endIdx=isLastLine?selection.end.column:charBounds.length-1;var lineMinY=isFirstLine&&__varRecorder__$O.arr.min(charBounds.slice(startIdx,endIdx+1).map(function(cb){return cb.top();}))||0;var emptyBuffer=startIdx>=endIdx?5:0;cb=charBounds[startIdx];selectionTopLeft=__varRecorder__$O.pt(paddingLeft+(cb?cb.left():__varRecorder__$O.arr.last(charBounds).right()),yOffset+lineMinY);cb=charBounds[endIdx];if(selection.includingLineEnd){selectionBottomRight=__varRecorder__$O.pt(morph.width-morph.padding.right(),yOffset+lineMinY+line.height);}else{var excludeCharWidth=isLastLine&&selection.end.column<=charBounds.length-1;selectionBottomRight=__varRecorder__$O.pt(paddingLeft+(cb?excludeCharWidth?cb.left():cb.right():__varRecorder__$O.arr.last(charBounds).right())+emptyBuffer,yOffset+lineMinY+line.height);}slices.push(__varRecorder__$O.Rectangle.fromAny(selectionTopLeft,selectionBottomRight));}yOffset+=line.height;row++;}var renderedSelection=this.selectionLayerRounded(slices,selectionColor,morph);renderedSelection.push(renderedCursor);return renderedSelection;}},{key:"selectionLayerRounded",value:function TextRenderer_selectionLayerRounded_(slices,selectionColor,morph){var currentBatch;var batches=[currentBatch={left:[],right:[]}];var lastSlice;var _iterator78=_createForOfIteratorHelper(slices),_step78;try{for(_iterator78.s();!(_step78=_iterator78.n()).done;){var slice=_step78.value;if(lastSlice&&(lastSlice.left()>slice.right()||lastSlice.right()<slice.left())){batches.push(currentBatch={left:[],right:[]});}currentBatch.left.push(slice.topLeft(),slice.bottomLeft());currentBatch.right.push(slice.topRight(),slice.bottomRight());lastSlice=slice;}}catch(err){_iterator78.e(err);}finally{_iterator78.f();}var svgs=[];var _loop10=function _loop10(){var batch=_batches[_i163];if(!batch.left.length)return"continue";var pos=batch.left.reduce(function(p1,p2){return p1.minPt(p2);});var vs=batch.left.concat(batch.right.reverse());var updatedVs=[];for(var vi=0;vi<vs.length;vi++){var prevV=vs[vi-1]||__varRecorder__$O.arr.last(vs);var currentV=vs[vi];var nextV=vs[vi+1]||__varRecorder__$O.arr.first(vs);var offset=6;var offsetV1=prevV.subPt(currentV).normalized().scaleBy(offset);var p1=currentV.addPt(offsetV1);p1._next=offsetV1.scaleBy(-1);var offsetV2=nextV.subPt(currentV).normalized().scaleBy(offset);var p2=currentV.addPt(offsetV2);p2._prev=offsetV2.scaleBy(-1);updatedVs.push(p1,p2);}updatedVs=updatedVs.map(function(p){return{position:p.subPt(pos),isSmooth:true,controlPoints:{next:p._next||__varRecorder__$O.pt(0),previous:p._prev||__varRecorder__$O.pt(0)}};});var d=__varRecorder__$O.getSvgVertices(updatedVs);var _updatedVs$map$reduce=updatedVs.map(function(p){return p.position;}).reduce(function(p1,p2){return p1.minPt(p2);}),minY=_updatedVs$map$reduce.y,minX=_updatedVs$map$reduce.x;var _updatedVs$map$reduce2=updatedVs.map(function(p){return p.position;}).reduce(function(p1,p2){return p1.maxPt(p2);}),maxY=_updatedVs$map$reduce2.y,maxX=_updatedVs$map$reduce2.x;var height=maxY-minY;var width=maxX-minX;svgs.push(__varRecorder__$O.h("svg",{namespace:"http://www.w3.org/2000/svg",version:"1.1",style:{position:"absolute",left:pos.x+"px",top:pos.y+"px",width:width,height:height}},__varRecorder__$O.h("path",{namespace:"http://www.w3.org/2000/svg",attributes:{d:d,fill:selectionColor.toString()}})));};for(var _i163=0,_batches=batches;_i163<_batches.length;_i163++){var _ret6=_loop10();if(_ret6==="continue")continue;}return svgs;}},{key:"cursor",value:function TextRenderer_cursor_(pos,height,visible,diminished,width,color){return __varRecorder__$O.h("div",{className:"newtext-cursor"+(diminished?" diminished":""),style:{left:pos.x-Math.ceil(width/2)+"px",top:pos.y+"px",width:width+"px",height:height+"px",display:visible?"":"none",background:color||"black"}});}},{key:"renderMarkerLayer",value:function TextRenderer_renderMarkerLayer_(morph){var markers=morph.markers,textLayout=morph.textLayout,_morph$viewState2=morph.viewState,firstVisibleRow=_morph$viewState2.firstVisibleRow,lastVisibleRow=_morph$viewState2.lastVisibleRow;var parts=[];if(!markers)return parts;var _iterator79=_createForOfIteratorHelper(markers),_step79;try{for(_iterator79.s();!(_step79=_iterator79.n()).done;){var _m13=_step79.value;var style=_m13.style,_m13$range=_m13.range,start=_m13$range.start,end=_m13$range.end;if(end.row<firstVisibleRow||start.row>lastVisibleRow)continue;if(start.row===end.row){parts.push(this.renderMarkerPart(textLayout,morph,start,end,style));continue;}parts.push(this.renderMarkerPart(textLayout,morph,start,morph.lineRange(start.row).end,style));for(var row=start.row+1;row<=end.row-1;row++){var _morph$lineRange=morph.lineRange(row),lineStart=_morph$lineRange.start,lineEnd=_morph$lineRange.end;parts.push(this.renderMarkerPart(textLayout,morph,lineStart,lineEnd,style,true));}parts.push(this.renderMarkerPart(textLayout,morph,{row:end.row,column:0},end,style));}}catch(err){_iterator79.e(err);}finally{_iterator79.f();}return parts;}},{key:"renderMarkerPart",value:function TextRenderer_renderMarkerPart_(textLayouter,morph,start,end,style){var entireLine=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var startX=0;var endX=0;var y=0;var height=0;var doc=morph.document;var line=doc.getLine(start.row);if(entireLine){var padding=morph.padding;startX=padding.left();y=padding.top()+doc.computeVerticalOffsetOf(start.row);endX=startX+line.width;height=line.height;}else{var _textLayouter$boundsF=textLayouter.boundsFor(morph,start);startX=_textLayouter$boundsF.x;y=_textLayouter$boundsF.y;var _textLayouter$boundsF2=textLayouter.boundsFor(morph,end);endX=_textLayouter$boundsF2.x;height=_textLayouter$boundsF2.height;}height=Math.ceil(height);return __varRecorder__$O.h("div.newtext-marker-layer",{style:Object.assign({},style,{left:startX+"px",top:y+"px",height:height+"px",width:endX-startX+"px"})});}},{key:"renderDebugLayer",value:function TextRenderer_renderDebugLayer_(morph){var vs=morph.viewState;var debugHighlights=[];var rowY=vs.heightBefore,firstVisibleRow=vs.firstVisibleRow,lastVisibleRow=vs.lastVisibleRow,visibleLines=vs.visibleLines;var padding=morph.padding,_morph$scroll2=morph.scroll,visibleLeft=_morph$scroll2.x,visibleTop=_morph$scroll2.y;var leftP=padding.left();var rightP=padding.right();var topP=padding.top();var bottomP=padding.bottom();debugHighlights.push(__varRecorder__$O.h("div.debug-info",{style:{left:visibleLeft+leftP+"px",top:visibleTop+"px",width:morph.width-rightP+"px"}},__varRecorder__$O.h("span","visible rows: ".concat(firstVisibleRow," - ").concat(lastVisibleRow))));for(var _i164=0,row=firstVisibleRow;row<lastVisibleRow;_i164++,row++){var line=visibleLines[_i164];var charBounds=morph.textLayout.lineCharBoundsCache.get(line);var height=line.height;debugHighlights.push(__varRecorder__$O.h("div.debug-line",{style:{left:visibleLeft+leftP+"px",top:topP+rowY+"px",width:morph.width-rightP+"px",height:height+"px"}},__varRecorder__$O.h("span",String(row))));if(!charBounds){rowY=rowY+height;continue;}for(var col=0;col<charBounds.length;col++){var _charBounds$col=charBounds[col],_x196=_charBounds$col.x,_y12=_charBounds$col.y,width=_charBounds$col.width,_height5=_charBounds$col.height;debugHighlights.push(__varRecorder__$O.h("div.debug-char",{style:{left:leftP+_x196+"px",top:topP+rowY+_y12+"px",width:width+"px",height:_height5+"px"}}));}rowY=rowY+height;}return debugHighlights;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TextRenderer";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/renderer.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:9049,end:36001});}(undefined);TextRenderer=__varRecorder__$O.TextRenderer;var Renderer$1=TextRenderer;__varRecorder__$O.extractHTMLFromTextMorph=extractHTMLFromTextMorph;__varRecorder__$O.extractHTMLFromTextMorph=extractHTMLFromTextMorph;__varRecorder__$O["default"]=TextRenderer;var __varRecorder__$P=lively.FreezerRuntime.recorderFor("lively.morphic/text/iy-goto-char.js");__varRecorder__$P.arr=arr;__varRecorder__$P.eqPosition=eqPosition;__varRecorder__$P.KeyHandler=KeyHandler$1;__varRecorder__$P.commands={activate:{name:"[IyGotoChar] activate",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{backwards:false};__varRecorder__$P.IyGotoCharKeyHandler.installInto(morph,opts.backwards);return true;}},moveTo:{name:"[IyGotoChar] move to",exec:function exec(morph,options){morph.saveMark();var sel=morph.selection;var _sel$lead=sel.lead,row=_sel$lead.row,column=_sel$lead.column;var select=!!morph.activeMark||!sel.isEmpty();var start={row:row,column:column-1};var pos=morph.document[options.backwards?"scanBackward":"scanForward"](start,function(_char6,pos){return _char6===options.needle&&!__varRecorder__$P.eqPosition(start,pos)?pos:null;});if(!pos)return true;pos.column++;sel.lead=pos;if(!select)sel.anchor=pos;return true;},multiSelectAction:"forEach",readOnly:true}};var activate=__varRecorder__$P.commands.activate;__varRecorder__$P.activate=activate;__varRecorder__$P.activate=activate;__varRecorder__$P.activate=activate;var IyGotoCharKeyHandler=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/iy-goto-char.js");var __lively_class__=__lively_classholder__.hasOwnProperty("IyGotoCharKeyHandler")&&typeof __lively_classholder__.IyGotoCharKeyHandler==="function"?__lively_classholder__.IyGotoCharKeyHandler:__lively_classholder__.IyGotoCharKeyHandler=function IyGotoCharKeyHandler(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function IyGotoCharKeyHandler_initialize_(){var backwards=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this);this.charToFind=undefined;this.backwards=backwards;}},{key:"isIyGoToChar",get:function get(){return true;}},{key:"uninstallFrom",value:function IyGotoCharKeyHandler_uninstallFrom_(textMorph){textMorph._cachedKeyhandlers=null;__varRecorder__$P.arr.remove(textMorph._keyhandlers||[],this);}},{key:"eventCommandLookup",value:function IyGotoCharKeyHandler_eventCommandLookup_(morph,evt){var keyCombo=evt.keyCombo;var isInputKey=keyCombo.startsWith("input-");if(evt.onlyModifiers||keyCombo.startsWith("Shift-")||evt.isFunctionKey&&!keyCombo==="Escape"&&!keyCombo==="Backspace"||!isInputKey&&!evt.isModified&&!evt.isFunctionKey){return{command:"null",passEvent:true};}var key=isInputKey&&keyCombo.slice("input-".length);if(!this.charToFind){if(isInputKey){this.charToFind=key;}else{this.uninstallFrom(morph);return null;}}if(key!==this.charToFind){this.uninstallFrom(morph);return null;}return{command:__varRecorder__$P.commands.moveTo,args:{backwards:this.backwards,needle:key}};}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"IyGotoCharKeyHandler";}},{key:"installInto",value:function IyGotoCharKeyHandler_installInto_(textMorph){var backwards=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;textMorph.keyhandlers.filter(function(h){return h.isIyGoToChar;}).forEach(function(ea){return ea.uninstallFrom(textMorph);});textMorph._cachedKeyhandlers=null;textMorph._keyhandlers=(textMorph._keyhandlers||[]).concat(new this(backwards));}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/iy-goto-char.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1063,end:3067});}(__varRecorder__$P.KeyHandler);var __varRecorder__$Q=lively.FreezerRuntime.recorderFor("lively.morphic/text/commands.js");__varRecorder__$Q.chain=chain$1;__varRecorder__$Q.arr=arr;__varRecorder__$Q.string=string;__varRecorder__$Q.date=date;__varRecorder__$Q.pt=pt;__varRecorder__$Q.Range=Range;__varRecorder__$Q.eqPosition=eqPosition;__varRecorder__$Q.commands=[{name:"clipboard copy",doc:"placeholder for native copy",scrollCursorIntoView:false,exec:function exec(morph){if(morph.selection.isEmpty()){morph.selectLine(morph.cursorPosition.row);}return true;}},{name:"manual clipboard copy",doc:"attempts to copy selection via browser interface",scrollCursorIntoView:false,multiSelectAction:"single",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{collapseSelection:true,"delete":false,dontTryNativeClipboard:false};var sel=morph.selection;var fullText=sel.text;var collapseSelection=opts.hasOwnProperty("collapseSelection")?opts.collapseSelection:true;morph.saveMark(sel.anchor);morph.activeMark=null;var sels=sel.isMultiSelection?sel.selections.slice():[sel];sels.forEach(function(sel){var range=sel.isEmpty()?morph.lineRange():sel.range;var text=morph.textInRange(range);morph.env.eventDispatcher.killRing.add(text);if(opts["delete"]){morph.deleteText(range);}else if(!sel.isEmpty()&&collapseSelection){sel.collapse(sel.lead);}});if(!opts.dontTryNativeClipboard){morph.env.eventDispatcher.doCopy(fullText);}return true;}},{name:"clipboard cut",doc:"placeholder for native cut",exec:function exec(morph){if(morph.selection.isEmpty()){morph.selectLine(morph.cursorPosition.row,true);}return true;}},{name:"clipboard paste",doc:"placeholder for native paste",exec:function exec(){return true;}},{name:"manual clipboard paste",doc:"attempts to paste from the clipboard to lively \u2013 currently requires browser extension!",multiSelectAction:"single",exec:function(){var _exec4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee132(morph){var opts,pasted,kr,_args133=arguments;return regeneratorRuntime.wrap(function _callee132$(_context132){while(1){switch(_context132.prev=_context132.next){case 0:opts=_args133.length>1&&_args133[1]!==undefined?_args133[1]:{killRingCycleBack:false};kr=morph.env.eventDispatcher.killRing;if(opts.killRingCycleBack&&(__varRecorder__$Q.arr.last(__varRecorder__$Q.arr.pluck(morph.commandHandler.history,"name"))||"").includes("clipboard paste"))pasted=kr.back();if(!pasted&&kr.isCycling()){pasted=kr.yank();}if(!pasted)pasted=kr.yank();if(morph.selection.isMultiSelection){morph.undoManager.group();morph.selection.selections.slice(0,-1).reverse().map(function(sel,i){var idx=kr.pointer-1-i;if(idx<0)idx=kr.buffer.length-1;return{selection:sel,pasted:kr.buffer[idx]||""};}).concat({selection:morph.selection.defaultSelection,pasted:pasted}).forEach(function(_ref117){var selection=_ref117.selection,pasted=_ref117.pasted;return selection.text=pasted;});morph.undoManager.group();}else{if(pasted){morph.undoManager.group();morph.selection.text=pasted;morph.undoManager.group();}}return _context132.abrupt("return",true);case 7:case"end":return _context132.stop();}}},_callee132);}));function exec(_x197){return _exec4.apply(this,arguments);}return exec;}()},{name:"browse clipboard",exec:function(){var _exec5=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee133(morph){var _morph$env$eventDispa,pointer,buffer,items,_yield$morph$world$fi,selected;return regeneratorRuntime.wrap(function _callee133$(_context133){while(1){switch(_context133.prev=_context133.next){case 0:_morph$env$eventDispa=morph.env.eventDispatcher.killRing,pointer=_morph$env$eventDispa.pointer,buffer=_morph$env$eventDispa.buffer;items=buffer.map(function(value){return{isListItem:true,string:__varRecorder__$Q.string.truncate(value,80).replace(/\n/g,""),value:value};});_context133.next=4;return morph.world().filterableListPrompt("select items to paste",items,{preselect:pointer,multiSelect:true});case 4:_yield$morph$world$fi=_context133.sent;selected=_yield$morph$world$fi.selected;if(selected.length){morph.undoManager.group();morph.insertTextAndSelect(selected.join("\n"));morph.undoManager.group();}return _context133.abrupt("return",true);case 8:case"end":return _context133.stop();}}},_callee133);}));function exec(_x198){return _exec5.apply(this,arguments);}return exec;}()},{name:"text undo",doc:"undo text changes",multiSelectAction:"single",exec:function exec(morph){morph.textUndo();return true;}},{name:"text redo",doc:"redo text changes",multiSelectAction:"single",exec:function exec(morph){morph.textRedo();return true;}},{name:"select all",doc:"Selects entire text contents.",scrollCursorIntoView:false,multiSelectAction:"single",exec:function exec(morph){morph.saveMark();morph.selectAll();return true;}},{name:"delete backwards",doc:"Delete the character in front of the cursor or the selection.",exec:function exec(morph){if(morph.rejectsInput())return false;if(morph.editorPlugin&&typeof morph.editorPlugin.cmd_newline==="function"&&morph.editorPlugin.cmd_delete_backwards())return true;var sel=morph.selection;if(sel.isEmpty())sel.growLeft(1);sel.text="";sel.collapse();if(morph.activeMark)morph.activeMark=null;return true;}},{name:"delete",doc:"Delete the character following the cursor or the selection.",exec:function exec(morph){var sel=morph.selection;if(morph.rejectsInput())return false;if(sel.isEmpty())sel.growRight(1);sel.text="";sel.collapse();if(morph.activeMark)morph.activeMark=null;return true;}},{name:"indent",scrollCursorIntoView:false,exec:function exec(morph){morph.undoManager.group();morph.withSelectedLinesDo(function(line,range){return morph.insertText(morph.tab,range.start);});morph.undoManager.group();return true;}},{name:"outdent",scrollCursorIntoView:false,exec:function exec(morph){morph.undoManager.group();morph.withSelectedLinesDo(function(line,range){return line.startsWith(morph.tab)&&morph.deleteText({start:range.start,end:{row:range.start.row,column:morph.tab.length}});});morph.undoManager.group();return true;}},{name:"indent according to mode",exec:function(){var _exec6=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee134(morph){var args,mode,firstRow,lastRow,undo,_morph$selection$sele,_yield$System$import6,indentLines,_args135=arguments;return regeneratorRuntime.wrap(function _callee134$(_context134){while(1){switch(_context134.prev=_context134.next){case 0:args=_args135.length>1&&_args135[1]!==undefined?_args135[1]:{};mode=morph.editorPlugin&&morph.editorPlugin.mode;if(mode){_context134.next=4;break;}return _context134.abrupt("return",true);case 4:undo=args.hasOwnProperty("undo")?args.undo:true;if(args.hasOwnProperty("firstRow")&&args.hasOwnProperty("lastRow")){firstRow=args.firstRow;lastRow=args.lastRow;}else if(morph.selection.isEmpty()){firstRow=lastRow=morph.cursorPosition.row;}else{_morph$selection$sele=morph.selection.selectedRows;firstRow=_morph$selection$sele.first;lastRow=_morph$selection$sele.last;}_context134.next=8;return System["import"]("lively.ide/editor-modes.js");case 8:_yield$System$import6=_context134.sent;indentLines=_yield$System$import6.indentLines;undo&&morph.undoManager.group();indentLines(morph,mode,firstRow,lastRow,"smart",true,args);undo&&morph.undoManager.group();return _context134.abrupt("return",true);case 14:case"end":return _context134.stop();}}},_callee134);}));function exec(_x199){return _exec6.apply(this,arguments);}return exec;}()},{name:"tab - snippet expand or indent",scrollCursorIntoView:true,exec:function exec(morph){var snippet=morph.snippets.find(function(snippet){return snippet.canExpand(morph);});if(snippet){snippet.expandAtCursor(morph);return true;}return morph.selection.isEmpty()?morph.execCommand("insertstring",{string:morph.tab}):morph.execCommand("indent according to mode");}},{name:"browse snippets",scrollCursorIntoView:true,exec:function(){var _exec7=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee135(morph){var items,_yield$morph$world$fi2,_yield$morph$world$fi3,snippet;return regeneratorRuntime.wrap(function _callee135$(_context135){while(1){switch(_context135.prev=_context135.next){case 0:items=morph.snippets.map(function(ea){return{isListItem:true,string:"".concat(ea.trigger," - ").concat(ea.expansion),value:ea};});_context135.next=3;return morph.world().filterableListPrompt("select snippet",items,{requester:morph});case 3:_yield$morph$world$fi2=_context135.sent;_yield$morph$world$fi3=_slicedToArray2(_yield$morph$world$fi2.selected,1);snippet=_yield$morph$world$fi3[0];if(snippet)snippet.expandAtCursor(morph);return _context135.abrupt("return",true);case 8:case"end":return _context135.stop();}}},_callee135);}));function exec(_x200){return _exec7.apply(this,arguments);}return exec;}()},{name:"transpose chars",exec:function exec(morph){if(morph.selection.isEmpty()){var _morph$cursorPosition=morph.cursorPosition,row=_morph$cursorPosition.row,column=_morph$cursorPosition.column;var _range3=__varRecorder__$Q.Range.create(row,column-1,row,column+1);var line=morph.getLine(row);var left=line[column-1];var right=line[column];if(left&&right)morph.replace(_range3,right+left,true);}return true;}},{name:"cycle selection contents",documentation:"If there are multiple selections, will take the text of the first one and replace the second one with it, the text of the second will replace the third, the last selection contents will replace the contents of the first.",multiSelectAction:"single",exec:function exec(ed){var sels=ed.selection.selections;ed.undoManager.group();sels.reduce(function(newContent,sel){var oldContent=sel.text;sel.text=newContent;return oldContent;},__varRecorder__$Q.arr.last(sels).text);ed.undoManager.group();return true;}},{name:"go left",doc:"Move the cursor 1 character left. At the beginning of a line move the cursor up. If a selection is active, collapse the selection left.",exec:function exec(morph){morph.activeMark?morph.selection.selectLeft(1):morph.selection.goLeft(1);return true;}},{name:"go right",doc:"Move the cursor 1 character right. At the end of a line move the cursor down. If a selection is active, collapse the selection right.",exec:function exec(morph){morph.activeMark?morph.selection.selectRight(1):morph.selection.goRight(1);return true;}},{name:"go up",doc:"Move the cursor 1 line. At the end of a line move the cursor down. If a selection is active, collapse the selection right.",scrollCursorIntoView:true,exec:function exec(morph){morph.activeMark?morph.selection.selectUp(1):morph.selection.goUp(1,true);return true;}},{name:"go down",exec:function exec(morph){morph.activeMark?morph.selection.selectDown(1):morph.selection.goDown(1,true);return true;}},{name:"select left",exec:function exec(morph){morph.selection.selectLeft(1);return true;}},{name:"select right",exec:function exec(morph){morph.selection.selectRight(1);return true;}},{name:"select up",exec:function exec(morph){morph.selection.selectUp(1,true);return true;}},{name:"select down",exec:function exec(morph){morph.selection.selectDown(1,true);return true;}},{name:"select line",exec:function exec(morph){var sel=morph.selection;var row=sel.lead.row;var fullLine=morph.lineRange(row,false);sel.range=sel.range.equals(fullLine)?morph.lineRange(row,true):fullLine;return true;}},{name:"goto line start",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:false};var select=opts.select||!!morph.activeMark;var sel=morph.selection;var cursor=sel.lead;var line=morph.screenLineRange(cursor,true);sel.lead=__varRecorder__$Q.eqPosition(cursor,line.start)?{column:0,row:cursor.row}:line.start;!select&&(sel.anchor=sel.lead);return true;}},{name:"goto line end",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:false};var select=opts.select||!!morph.activeMark;var sel=morph.selection;var cursor=sel.lead;var line=morph.screenLineRange(cursor,true);sel.lead=line.end;!select&&(sel.anchor=sel.lead);return true;}},{name:"goto page up",exec:function exec(morph){morph.pageUpOrDown({direction:"up",select:!!morph.activeMark});return true;}},{name:"goto page down",exec:function exec(morph){morph.pageUpOrDown({direction:"down",select:!!morph.activeMark});return true;}},{name:"goto page up and select",exec:function exec(morph){morph.pageUpOrDown({direction:"up",select:true});return true;}},{name:"goto page down and select",exec:function exec(morph){morph.pageUpOrDown({direction:"down",select:true});return true;}},{name:"goto start",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:!!morph.activeMark};morph.gotoDocumentStart(Object.assign({},opts));return true;}},{name:"goto end",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:!!morph.activeMark};morph.gotoDocumentEnd(Object.assign({},opts));return true;}},{name:"goto paragraph above",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:!!morph.activeMark};var pRange=morph.paragraphRangeAbove(morph.cursorPosition.row);pRange.start.row--;morph.selection.lead=pRange.start;if(!opts.select)morph.collapseSelection();return true;}},{name:"goto paragraph below",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:!!morph.activeMark};var pRange=morph.paragraphRangeBelow(morph.cursorPosition.row);pRange.end.row++;morph.selection.lead=pRange.end;if(!opts.select)morph.collapseSelection();return true;}},{name:"move cursor to screen bottom in 1/3 steps",readOnly:true,exec:function exec(morph){var select=!!morph.activeMark;var currentPos=morph.cursorPosition;var firstRow=morph.textLayout.firstFullVisibleLine(morph);var lastRow=morph.textLayout.lastFullVisibleLine(morph);var middleRow=firstRow+Math.floor((lastRow-firstRow)/2);var newPos=currentPos;if(currentPos.row<firstRow)newPos.row=firstRow;else if(currentPos.row<middleRow)newPos.row=middleRow;else if(currentPos.row<lastRow)newPos.row=lastRow;else return true;morph.selection.lead=newPos;if(!select)morph.selection.anchor=morph.selection.lead;return true;}},{name:"move cursor to screen top in 1/3 steps",readOnly:true,exec:function exec(morph){var select=!!morph.activeMark;var currentPos=morph.cursorPosition;var firstRow=morph.textLayout.firstFullVisibleLine(morph);var lastRow=morph.textLayout.lastFullVisibleLine(morph);var middleRow=firstRow+Math.floor((lastRow-firstRow)/2);var newPos=currentPos;if(currentPos.row<=firstRow)return true;if(currentPos.row<=middleRow)newPos.row=firstRow;else if(currentPos.row<=lastRow)newPos.row=middleRow;else newPos.row=lastRow;morph.selection.lead=newPos;if(!select)morph.selection.anchor=morph.selection.lead;return true;}},{name:"goto line",exec:function(){var _exec8=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee136(morph){var select,row;return regeneratorRuntime.wrap(function _callee136$(_context136){while(1){switch(_context136.prev=_context136.next){case 0:select=!!morph.activeMark;_context136.t0=Number;_context136.next=4;return morph.world().prompt("Enter line number");case 4:_context136.t1=_context136.sent;row=(0,_context136.t0)(_context136.t1);if(!isNaN(row)){if(select)morph.selection.lead={row:row,column:0};else morph.cursorPosition={row:row,column:0};morph.scrollCursorIntoView();morph.focus();}return _context136.abrupt("return",true);case 8:case"end":return _context136.stop();}}},_callee136);}));function exec(_x201){return _exec8.apply(this,arguments);}return exec;}()},{name:"join line",exec:function exec(morph){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{withLine:"before"};var _morph$selection=morph.selection,start=_morph$selection.start,end=_morph$selection.end,lead=_morph$selection.lead;if(!morph.selection.isEmpty()){if(start.row===end.row)return true;var undo=morph.undoManager.ensureNewGroup(morph,"join line");var joinPositions=__varRecorder__$Q.arr.range(0,end.row-1-start.row).map(function(_){return morph.joinLine(start.row);});morph.undoManager.group(undo);if(morph.selection.isMultiSelection){morph.cursorPosition=joinPositions[0];joinPositions.slice(1).forEach(function(pos){return morph.selection.addRange({start:pos,end:pos});});}return true;}var row=lead.row;if(args.withLine==="before"&&row<=0)return true;if(args.withLine==="after"&&row>=morph.document.endPosition.row)return true;morph.undoManager.group();var firstRow=args.withLine==="before"?row-1:row;morph.cursorPosition=morph.joinLine(firstRow);morph.undoManager.group();return true;}},{name:"split line",exec:function exec(morph){var pos=morph.cursorPosition;var indent=morph.getLine(pos.row).match(/^\s*/)[0].length;morph.insertText("\n"+" ".repeat(indent),pos);morph.cursorPosition=pos;return true;}},{name:"insert line",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{where:"above"};var row=morph.cursorPosition.row;var indent=morph.getLine(row).match(/^\s*/)[0].length;if(opts.where==="below")row++;morph.insertText(" ".repeat(indent)+"\n",{column:0,row:row});morph.cursorPosition={column:indent,row:row};return true;}},{name:"duplicate line or selection",exec:function exec(morph){morph.undoManager.group();var pos=morph.selection.end;if(morph.selection.isEmpty()){morph.insertText(morph.getLine(pos.row)+"\n",{column:0,row:pos.row+1});}else{var _range4=morph.selection.range;morph.insertText(morph.selection.text,pos);morph.selection=_range4;}morph.undoManager.group();return true;}},{name:"delete emtpy line or until end of line",exec:function exec(morph){var pos=morph.cursorPosition;var line=morph.getLine(pos.row);if(__varRecorder__$Q.eqPosition(morph.document.endPosition,pos))return true;var range=line.trim()?{start:pos,end:{row:pos.row,column:line.length}}:{start:{row:pos.row,column:0},end:{row:pos.row+1,column:0}};morph.env.eventDispatcher.doCopy(morph.textInRange(range));morph.undoManager.group();morph.deleteText(range);morph.undoManager.group();return true;}},{name:"delete left until beginning of line",exec:function exec(morph){if(morph.activeMark)morph.activeMark=null;if(!morph.selection.isEmpty()){morph.selection.text="";return true;}var lineRange=morph.lineRange();var end=morph.cursorPosition;if(__varRecorder__$Q.eqPosition({row:end.row,column:0},end))return true;var start=__varRecorder__$Q.eqPosition(lineRange.start,end)?{row:end.row,column:0}:lineRange.start;var range={start:start,end:end};morph.deleteText(range);return true;}},{name:"move lines up",multiSelectAction:"single",exec:function exec(morph){var sel=morph.selection;if(morph.inMultiSelectMode()){var ranges=sel.selections.map(function(ea){return ea.range;});ranges.slice().sort(__varRecorder__$Q.Range.compare).forEach(function(range){morph.selection=range;morph.execCommand("move lines up");});ranges.forEach(function(range){range.start.row--;range.end.row--;});morph.selection.ranges=ranges;return true;}if(!sel.isEmpty()&&sel.end.column===0)sel.growRight(-1);var start=sel.start,end=sel.end;var lineBefore=morph.getLine(start.row-1);var undo=morph.undoManager.ensureNewGroup(morph);morph.insertText(lineBefore+"\n",{row:end.row+1,column:0});morph.deleteText({start:{row:start.row-1,column:0},end:{row:start.row,column:0}});morph.undoManager.group(undo);return true;}},{name:"move lines down",multiSelectAction:"single",exec:function exec(morph){var sel=morph.selection;if(morph.inMultiSelectMode()){var ranges=sel.selections.map(function(ea){return ea.range;});ranges.slice().sort(__varRecorder__$Q.Range.compare).reverse().forEach(function(range){morph.selection=range;morph.execCommand("move lines down");});ranges.forEach(function(range){range.start.row++;range.end.row++;});morph.selection.ranges=ranges;return true;}if(!sel.isEmpty()&&sel.end.column===0)sel.growRight(-1);var range=sel.range;var _range5=range,start=_range5.start,end=_range5.end;if(sel.isEmpty())range={start:{row:start.row,column:0},end:{row:start.row+1,column:0}};else if(end.column!==0)range={start:start,end:{row:end.row+1,column:0}};var undo=morph.undoManager.ensureNewGroup(morph);var linesToMove=morph.deleteText(range);morph.insertText(linesToMove,{row:start.row+1,column:0});morph.undoManager.group(undo);morph.selection={start:Object.assign({},start,{row:start.row+1}),end:Object.assign({},end,{row:end.row+1})};return true;}},{name:"old select word",exec:function exec(morph){var sel=morph.selection;sel.range=morph.wordAt(sel.lead).range;return true;}},{name:"select word",exec:function exec(morph){var sel=morph.selection;var indexPair=morph.selectMatchingBrackets(morph.textString,morph.positionToIndex(sel.lead));if(indexPair)sel.range={start:indexPair[0],end:indexPair[1]+1};return true;}},{name:"select word right",exec:function exec(morph){var sel=morph.selection;sel.anchor=morph.wordRight(sel.end).range.end;return true;}},{name:"goto word left",exec:function exec(morph){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:false};var select=args.select||!!morph.activeMark;var _morph$wordLeft=morph.wordLeft(),range=_morph$wordLeft.range;morph.selection.lead=range.start;if(!select)morph.selection.anchor=range.start;return true;}},{name:"goto word right",exec:function exec(morph){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:false};var select=args.select||!!morph.activeMark;var _morph$wordRight=morph.wordRight(),range=_morph$wordRight.range;morph.selection.lead=range.end;if(!select)morph.selection.anchor=range.end;return true;}},{name:"delete word right",exec:function exec(morph){morph.undoManager.group();var _morph$wordRight2=morph.wordRight(),end=_morph$wordRight2.range.end;var range={start:morph.cursorPosition,end:end};morph.env.eventDispatcher.doCopy(morph.textInRange(range));morph.deleteText(range);morph.undoManager.group();return true;}},{name:"delete word left",exec:function exec(morph){morph.undoManager.group();var _morph$wordLeft2=morph.wordLeft(),start=_morph$wordLeft2.range.start;var range={start:start,end:morph.cursorPosition};morph.deleteText(range);morph.undoManager.group();return true;}},{name:"goto matching right",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:!!morph.activeMark};var pairs=opts.pairs||{"{":"}","[":"]","(":")","<":">"};var found=morph.findMatchingForward(morph.cursorPosition,"right",pairs)||morph.findMatchingForward(morph.cursorPosition,"left",pairs);if(found){morph.selection.lead=found;if(!opts.select)morph.selection.anchor=morph.selection.lead;}return true;}},{name:"goto matching left",exec:function exec(morph){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{select:!!morph.activeMark};var pairs=opts.pairs||{"}":"{","]":"[",")":"(",">":"<"};var found=morph.findMatchingBackward(morph.cursorPosition,"left",pairs)||morph.findMatchingBackward(morph.cursorPosition,"right",pairs);if(found){morph.selection.lead=found;if(!opts.select)morph.selection.anchor=morph.selection.lead;}return true;}},{name:"realign top-bottom-center",doc:"Cycles through centering the cursor position, aligning it at the top, aligning it at the bottom.",scrollCursorIntoView:false,multiSelectAction:"single",exec:function exec(morph){var charBounds=morph.charBoundsFromTextPosition(morph.cursorPosition);var pos=charBounds.topLeft();var h=morph.height-charBounds.height;var _morph$scroll3=morph.scroll,scrollX=_morph$scroll3.x,scrollY=_morph$scroll3.y;if(Math.abs(pos.y-scrollY)<2){scrollY=pos.y-h;}else if(Math.abs(pos.y-scrollY-h*0.5)<2){scrollY=pos.y;}else{scrollY=pos.y-h*0.5;}morph.scroll=__varRecorder__$Q.pt(scrollX,scrollY);return true;}},{name:"reverse selection",doc:"switches the selection lead and anchor",exec:function exec(morph){var sel=morph.selection;if(sel.isEmpty()){var _m14=morph.popSavedMark();if(_m14){morph.saveMark(morph.cursorPosition);sel.lead=_m14.position;}}else sel.reverse();return true;}},{name:"toggle active mark",doc:"....",handlesCount:true,multiSelectAction:"single",exec:function exec(morph,args,count){var m=morph.activeMark;var sel=morph.selection;var selected=!sel.isEmpty();if(count===4){var lastMark=morph.popSavedMark();if(lastMark){sel.lead=lastMark.position;if(!selected)sel.anchor=sel.lead;}return true;}if(!m&&!selected){morph.activeMark=sel.lead;return true;}morph.saveMark(m||sel.anchor);morph.activeMark=null;if(selected){var sels=morph.inMultiSelectMode()?sel.selections:[sel];sels.forEach(function(sel){return sel.anchor=sel.lead;});}return true;}},{name:"fit text to column",handlesCount:true,multiSelectAction:"forEach",exec:function exec(morph,opts,count){if(count===4)return morph.execCommand("join line");if(morph.selection.isEmpty())morph.selectLine();var sel=morph.selection;var col=count||80;var rows=sel.selectedRows;var range=sel.range;var splitRe=/[ ]+/g;var whitespacePrefixRe=/^[\s\t]+/;var paragraphs=__varRecorder__$Q.string.paragraphs(__varRecorder__$Q.arr.range(rows.first,rows.last).map(function(row){return morph.getLine(row);}).join("\n"),{keepEmptyLines:true});var newString=__varRecorder__$Q.chain(paragraphs.map(fitParagraph)).flatten().value().join("\n");morph.undoManager.group();morph.replace(range,newString);morph.undoManager.group();return true;function splitLineIntoChunks(line,whitespacePrefix,n){if(line.length<=col)return[whitespacePrefix+line.trim()];var firstChunk=line.slice(0,col);var splitMatch=__varRecorder__$Q.arr.last(__varRecorder__$Q.string.reMatches(firstChunk,splitRe));var lastWordSplit=splitMatch&&splitMatch.start>0?splitMatch.start:col;var first=firstChunk.slice(0,lastWordSplit);var rest=whitespacePrefix+(firstChunk.slice(lastWordSplit)+line.slice(col)).trimLeft();return[first].concat(splitLineIntoChunks(rest,whitespacePrefix));}function fitRow(row){if(row.trim()==="")return[""];var whitespacePrefixMatch=row.match(whitespacePrefixRe);var whitespacePrefix=whitespacePrefixMatch?whitespacePrefixMatch[0]:"";return splitLineIntoChunks(whitespacePrefix+row.trim(),whitespacePrefix);}function fitParagraph(para){return /^\s*$/.test(para)?para:fitRow(para.split("\n").join(" ")).join("\n")+"\n";}}},{name:"lowercase",exec:function exec(morph){morph.undoManager.group();if(morph.selection.isEmpty())morph.selection=morph.wordAt().range;morph.selection.text=morph.selection.text.toLowerCase();morph.undoManager.group();return true;}},{name:"remove trailing whitespace",exec:function exec(morph){morph.undoManager.group();var i=0;morph.withLinesDo(0,morph.documentEndPosition.row,function(line,range){return line.match(/\s+$/)&&++i&&morph.replace(range,line.trimRight());});morph.world().setStatusMessage("".concat(i," lines cleaned up"));morph.undoManager.group();return true;}},{name:"uppercase",exec:function exec(morph){morph.undoManager.group();if(morph.selection.isEmpty())morph.selection=morph.wordAt().range;morph.selection.text=morph.selection.text.toUpperCase();morph.undoManager.group();return true;}},{name:"newline",exec:function exec(morph){var pos=morph.cursorPosition;var currentLine=morph.getLine(pos.row);var indent=currentLine.match(/^\s*/)[0].length;morph.undoManager.group();if(!currentLine.trim()&&indent){morph.deleteText({start:{row:pos.row,column:0},end:{row:pos.row,column:indent}});pos.column=0;}if(morph.editorPlugin&&typeof morph.editorPlugin.cmd_newline==="function"&&morph.editorPlugin.cmd_newline(pos,currentLine,indent))return true;morph.selection.text="\n"+" ".repeat(indent);morph.selection.collapseToEnd();morph.undoManager.group();return true;}},{name:"insertstring",exec:function exec(morph){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{string:null,undoGroup:false};var string=args.string,undoGroup=args.undoGroup;var isValid=typeof string==="string"&&string.length;if(!isValid){console.warn("command insertstring called with not string value");}if(morph.rejectsInput()||!isValid){return false;}morph.saveActiveMarkAndDeactivate();if(morph.editorPlugin&&typeof morph.editorPlugin.cmd_insertstring==="function"&&morph.editorPlugin.cmd_insertstring(string)){return true;}var sel=morph.selection;var isDelete=!sel.isEmpty();if(isDelete){morph.undoManager.group();}var pos=sel.lead;var quickInsert=string.length===1&&string!=="\n"&&pos.column>0;var consistencyCheck=!quickInsert;sel.replace(string,true,true,true,consistencyCheck);sel.collapseToEnd();if(isDelete){morph.undoManager.group();}if(undoGroup){if(!/^[\s\.,\?\+=]+$/.test(string)&&typeof undoGroup==="number"){morph.undoManager.groupLater(undoGroup);}else{morph.undoManager.group();}}return true;}},{name:"toggle line wrapping",scrollCursorIntoView:false,multiSelectAction:"single",exec:function exec(morph){morph.keepPosAtSameScrollOffsetWhile(function(){return morph.lineWrapping=morph.lineWrapping?false:morph.fontMetric.isProportional(morph.fontFamily)?true:"by-chars";});return true;}},{name:"cancel input",scrollCursorIntoView:false,multiSelectAction:"single",exec:function exec(morph,args,count,evt){morph.env.eventDispatcher.resetKeyInputState();morph.selection.disableMultiSelect&&morph.selection.disableMultiSelect();if(!morph.selection.isEmpty()){morph.selection.anchor=morph.selection.lead;}if(morph.activeMark){morph.activeMark=null;}return true;}}];__varRecorder__$Q.usefulEditorCommands=[{name:"insert date",handlesCount:true,exec:function exec(ed,opts,count){var dateString=__varRecorder__$Q.date.format(new Date(),count?"mediumDate":"isoDate");ed.undoManager.group();ed.insertText(dateString);ed.undoManager.group();return true;}},{name:"[todo] toggle todo marker",exec:function exec(ed){var sel=ed.selection;if(sel.isEmpty())ed.selectLine();var undoneRe=/\[\s*\]/g;var doneRe=/\[X\]/g;var replacement=sel.text;if(undoneRe.test(replacement)){replacement=replacement.replace(undoneRe,"[X]");}else if(doneRe.test(replacement)){replacement=replacement.replace(doneRe,"[ ]");}else{replacement="[ ] "+replacement.trimLeft();}sel.text=replacement;return true;}},{name:"selected lines: sort",exec:function exec(text){var _text$selection=text.selection,startRow=_text$selection.start.row,endRow=_text$selection.end.row;var lines=[];text.withLinesDo(startRow,endRow,function(line){var idx=lines.findIndex(function(ea){return ea>line;});idx>-1?lines.splice(idx,0,line):lines.push(line);});text.undoManager.group();text.replace({start:{row:startRow,column:0},end:{row:endRow+1,column:0}},lines.join("\n")+"\n");text.undoManager.group();return true;}},{name:"selected lines: reverse",exec:function exec(text){var _text$selection2=text.selection,startRow=_text$selection2.start.row,endRow=_text$selection2.end.row;var lines=[];text.withLinesDo(startRow,endRow,function(line){return lines.push(line);});text.undoManager.group();text.replace({start:{row:startRow,column:0},end:{row:endRow+1,column:0}},lines.reverse().join("\n")+"\n");text.undoManager.group();return true;}},{name:"selected lines: remove duplicates (uniq)",exec:function exec(text){var _text$selection3=text.selection,startRow=_text$selection3.start.row,endRow=_text$selection3.end.row;var lines=[];text.withLinesDo(startRow,endRow,function(line){return __varRecorder__$Q.arr.pushIfNotIncluded(lines,line);});text.undoManager.group();text.replace({start:{row:startRow,column:0},end:{row:endRow+1,column:0}},lines.join("\n")+"\n");text.undoManager.group();return true;}},{name:"change string inflection",handlesCount:true,multiSelectAction:"single",exec:function(){var _exec9=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee137(textMorph,opts,count){var ranges,string,type,offers,_yield$textMorph$worl,_yield$textMorph$worl2,choice,convertCamelCased,detectCamelCaseType;return regeneratorRuntime.wrap(function _callee137$(_context137){while(1){switch(_context137.prev=_context137.next){case 0:detectCamelCaseType=function _detectCamelCaseType(string){if(string.match(/[A-Z]/))return"uppercased";if(string.match(/-/))return"dashed";if(string.match(/\s/))return"spaced";return"unknown";};convertCamelCased=function _convertCamelCased(string,intoType){var match;var replace;var fromType=detectCamelCaseType(string).trim();if(fromType==="uppercased")match=/\s*[A-Z0-9]+/g;else if(fromType==="dashed")match=/-\w/g;else if(fromType==="spaced")match=/\s+.?/g;if(intoType==="uppercased")replace=function replace(m){return m.trim().replace(/^-/,"").toUpperCase();};else if(intoType==="dashed")replace=function replace(m){return"-"+m.trim().replace(/^-/,"").toLowerCase();};else if(intoType==="spaced")replace=function replace(m){return" "+m.trim().replace(/^-/,"").toLowerCase();};return string.replace(match,replace);};if(textMorph.selection.isEmpty()){textMorph.selection=textMorph.wordAt().range;}ranges=textMorph.selection.ranges;string=textMorph.textInRange(ranges[0]);if(string){_context137.next=8;break;}textMorph.setStatusMessage("Please select some text");return _context137.abrupt("return",true);case 8:type=detectCamelCaseType(string);offers=__varRecorder__$Q.arr.without(["uppercased","dashed","spaced"],type);_context137.next=12;return textMorph.world().listPrompt("Convert "+type+" into?",offers,{});case 12:_yield$textMorph$worl=_context137.sent;_yield$textMorph$worl2=_slicedToArray2(_yield$textMorph$worl.selected,1);choice=_yield$textMorph$worl2[0];if(choice){_context137.next=17;break;}return _context137.abrupt("return",true);case 17:textMorph.undoManager.group();ranges.forEach(function(range,i){var string=textMorph.textInRange(range);var replacement=convertCamelCased(string,choice);textMorph.replace(range,replacement);});textMorph.undoManager.group();textMorph.focus();return _context137.abrupt("return",true);case 22:case"end":return _context137.stop();}}},_callee137);}));function exec(_x202,_x203,_x204){return _exec9.apply(this,arguments);}return exec;}()},{name:"spell check word",exec:function(){var _exec10=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee138(text,opts){var word,_yield$System$import7,spellCheckWord,suggestions,_yield$text$world$fil,_yield$text$world$fil2,choice;return regeneratorRuntime.wrap(function _callee138$(_context138){while(1){switch(_context138.prev=_context138.next){case 0:word=text.wordAt();if(word.string){_context138.next=4;break;}text.setStatusMessage("no word for spellcheck!");return _context138.abrupt("return",true);case 4:_context138.next=6;return System["import"]("lively.ide/shell/spell-checker.js");case 6:_yield$System$import7=_context138.sent;spellCheckWord=_yield$System$import7.spellCheckWord;_context138.next=10;return spellCheckWord(word.string);case 10:suggestions=_context138.sent;if(suggestions.length){_context138.next=14;break;}text.setStatusMessage("no suggestions for word "+word.string);return _context138.abrupt("return",true);case 14:_context138.next=16;return text.world().filterableListPrompt("Choose replacement for "+word.string,suggestions);case 16:_yield$text$world$fil=_context138.sent;_yield$text$world$fil2=_slicedToArray2(_yield$text$world$fil.selected,1);choice=_yield$text$world$fil2[0];if(choice){text.undoManager.group();text.replace(word.range,choice);text.undoManager.group();}return _context138.abrupt("return",true);case 21:case"end":return _context138.stop();}}},_callee138);}));function exec(_x205,_x206){return _exec10.apply(this,arguments);}return exec;}()},{name:"[shell] run shell command on region",multiSelectAction:"single",exec:function(){var _exec11=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee139(ed,opts){var input,options,cmdString,_yield$System$import8,runCommand,cmd,result;return regeneratorRuntime.wrap(function _callee139$(_context139){while(1){switch(_context139.prev=_context139.next){case 0:input=ed.textInRange(ed.selection);options=!input||input.length===0?{}:{stdin:input};_context139.next=4;return ed.world().prompt("Enter shell command to run on region.",{historyId:"lively.ide.execShellCommand"});case 4:cmdString=_context139.sent;_context139.next=7;return System["import"]("lively.ide/shell/shell-interface.js");case 7:_yield$System$import8=_context139.sent;runCommand=_yield$System$import8.runCommand;if(cmdString){_context139.next=11;break;}return _context139.abrupt("return",ed.setStatusMessage("No command entered, aborting...!"));case 11:cmd=runCommand(cmdString,options);_context139.prev=12;_context139.next=15;return cmd.whenDone();case 15:result=cmd.output.trim();ed.undoManager.group();ed.selection.selections.forEach(function(sel){return sel.text=result;});ed.undoManager.group();_context139.next=24;break;case 21:_context139.prev=21;_context139.t0=_context139["catch"](12);ed.showError(_context139.t0);case 24:return _context139.abrupt("return",true);case 25:case"end":return _context139.stop();}}},_callee139,null,[[12,21]]);}));function exec(_x207,_x208){return _exec11.apply(this,arguments);}return exec;}()},{name:"open file at cursor",exec:function(){var _exec12=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee140(ed,opts){var line,startRow,start,end,text,parts,url,_yield$System$import9,TextEditor,textEd;return regeneratorRuntime.wrap(function _callee140$(_context140){while(1){switch(_context140.prev=_context140.next){case 0:line=ed.getLine();startRow=ed.cursorPosition.row;start=ed.document.scanBackward(ed.cursorPosition,function(c,pos){return(pos.column<=0||c.match(/\s/))&&pos;})||{row:0,column:0};end=ed.document.scanForward(ed.cursorPosition,function(c,pos){return(pos.row!=startRow||c.match(/\s/))&&pos;})||ed.documentEndPosition;text=ed.textInRange({start:start,end:end}).replace(/\s/g,"");parts=text.split(":");url=parts[0].match(/^file|http/)?"".concat(parts.shift(),":").concat(parts.shift()):parts.shift();if(parts[0].match(/^[0-9]+$/))url+=":"+parts.shift();_context140.next=10;return System["import"]("lively.ide/text-editor.js");case 10:_yield$System$import9=_context140.sent;TextEditor=_yield$System$import9["default"];textEd=TextEditor.openInWindow();textEd.location=url;return _context140.abrupt("return",textEd);case 15:case"end":return _context140.stop();}}},_callee140);}));function exec(_x209,_x210){return _exec12.apply(this,arguments);}return exec;}()},{name:"run code on text morph",doc:"...",exec:function(){var _exec13=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee141(morph,opts){var env,code,result,err,_result3;return regeneratorRuntime.wrap(function _callee141$(_context141){while(1){switch(_context141.prev=_context141.next){case 0:env={targetModule:"lively://code-on-text-morph",context:morph};_context141.next=3;return morph.world().editPrompt("Run code on selection. Use this.selection.text to access it",{requester:morph,mode:"js",evalEnvironment:env,historyId:"run-code-on-text-morph-hist"});case 3:code=_context141.sent;_context141.prev=4;morph.undoManager.group();_context141.next=8;return lively.vm.runEval(code,env);case 8:_result3=_context141.sent;morph.undoManager.group();err=_result3.isError?_result3.value:null;_context141.next=16;break;case 13:_context141.prev=13;_context141.t0=_context141["catch"](4);err=_context141.t0;case 16:if(err)morph.showError(err);return _context141.abrupt("return",result);case 18:case"end":return _context141.stop();}}},_callee141,null,[[4,13]]);}));function exec(_x211,_x212){return _exec13.apply(this,arguments);}return exec;}()},{name:"change editor mode",exec:function(){var _exec14=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee142(ed){var filter,results,_ref118,current,currentIndex,items,_yield$ed$world$filte,_yield$ed$world$filte2,choice;return regeneratorRuntime.wrap(function _callee142$(_context142){while(1){switch(_context142.prev=_context142.next){case 0:filter=function filter(url){return!url.endsWith("ide/editor-plugin.js")&&url.endsWith("editor-plugin.js");};_context142.next=3;return lively.modules.getPackage("lively.ide").resources(filter);case 3:results=_context142.sent;_ref118=ed.editorPlugin||{},current=_ref118.shortName;currentIndex=0;items=["<no mode>"].concat(results.map(function(ea,i){var name=ea.url.match(/([^\/]+)\/editor-plugin.js/)[1];if(name===current)currentIndex=i;return{isListItem:true,string:name,value:ea};}));_context142.next=9;return ed.world().filterableListPrompt("choose mode",items,{requester:ed,preselect:currentIndex,historyId:"lively.morphic/text-change-editor-mode-hist",fuzzy:true});case 9:_yield$ed$world$filte=_context142.sent;_yield$ed$world$filte2=_slicedToArray2(_yield$ed$world$filte.selected,1);choice=_yield$ed$world$filte2[0];if(choice){_context142.next=14;break;}return _context142.abrupt("return");case 14:if(!(choice==="<no mode>")){_context142.next=19;break;}_context142.next=17;return ed.changeEditorMode(null);case 17:ed.resetTextAttributes();return _context142.abrupt("return");case 19:if(choice.isLoaded){_context142.next=22;break;}_context142.next=22;return lively.modules.module(choice.url).load();case 22:_context142.next=24;return ed.changeEditorMode(choice.url);case 24:case"end":return _context142.stop();}}},_callee142);}));function exec(_x213){return _exec14.apply(this,arguments);}return exec;}()},{name:"report token at cursor",exec:function(){var _exec15=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee143(morph){var _ref119,token,start,end;return regeneratorRuntime.wrap(function _callee143$(_context143){while(1){switch(_context143.prev=_context143.next){case 0:_ref119=morph.tokenAt(morph.cursorPosition)||{},token=_ref119.token,start=_ref119.start,end=_ref119.end;morph.setStatusMessage(token?"".concat(token," ").concat(start.column," => ").concat(end.column):"no token");return _context143.abrupt("return",true);case 3:case"end":return _context143.stop();}}},_callee143);}));function exec(_x214){return _exec15.apply(this,arguments);}return exec;}()}];(_varRecorder__$Q$com=__varRecorder__$Q.commands).push.apply(_varRecorder__$Q$com,_toConsumableArray2(__varRecorder__$Q.usefulEditorCommands));__varRecorder__$Q.iyGotoCharActivate=activate;__varRecorder__$Q.commands.push(__varRecorder__$Q.iyGotoCharActivate);__varRecorder__$Q.searchCommands=searchCommands;(_varRecorder__$Q$com2=__varRecorder__$Q.commands).push.apply(_varRecorder__$Q$com2,_toConsumableArray2(__varRecorder__$Q.searchCommands));var commands=__varRecorder__$Q.commands;__varRecorder__$Q["default"]=commands;var __varRecorder__$R=lively.FreezerRuntime.recorderFor("lively.morphic/text/morph.js");__varRecorder__$R.Rectangle=Rectangle;__varRecorder__$R.Point=Point;__varRecorder__$R.rect=rect;__varRecorder__$R.Color=Color$1;__varRecorder__$R.pt=pt;__varRecorder__$R.string=string;__varRecorder__$R.num=num;__varRecorder__$R.obj=obj;__varRecorder__$R.fun=fun;__varRecorder__$R.promise=promise;__varRecorder__$R.arr=arr;__varRecorder__$R.signal=signal;__varRecorder__$R.noUpdate=noUpdate;__varRecorder__$R.connect=connect;__varRecorder__$R.disconnect=disconnect;__varRecorder__$R.bowser=exports$1$1;__varRecorder__$R.morph=morph;__varRecorder__$R.touchInputDevice=touchInputDevice;__varRecorder__$R.config=config;__varRecorder__$R.Morph=Morph;__varRecorder__$R.Selection=Selection;__varRecorder__$R.MultiSelection=MultiSelection;__varRecorder__$R.Document=Document$1;__varRecorder__$R.objectReplacementChar=objectReplacementChar;__varRecorder__$R.Anchor=Anchor;__varRecorder__$R.Range=Range;__varRecorder__$R.eqPosition=eqPosition;__varRecorder__$R.lessPosition=lessPosition;__varRecorder__$R.KeyHandler=KeyHandler$1;__varRecorder__$R.UndoManager=UndoManager;__varRecorder__$R.TextSearcher=TextSearcher;__varRecorder__$R.TextLayout=TextLayout$1;__varRecorder__$R.Renderer=Renderer$1;__varRecorder__$R.extractHTMLFromTextMorph=extractHTMLFromTextMorph;__varRecorder__$R.commands=commands;__varRecorder__$R.textAndAttributesWithSubRanges=textAndAttributesWithSubRanges;__varRecorder__$R.serializeMorph=serializeMorph;__varRecorder__$R.deserializeMorph=deserializeMorph;__varRecorder__$R.getSvgVertices=getSvgVertices;__varRecorder__$R.renderSubTree=renderSubTree;__varRecorder__$R.ShadowObject=ShadowObject;__varRecorder__$R.getClassName=getClassName;var Text=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Text")&&typeof __lively_classholder__.Text==="function"?__lively_classholder__.Text:__lively_classholder__.Text=function Text(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Text_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var position=props.position,rightCenter=props.rightCenter,leftCenter=props.leftCenter,topCenter=props.topCenter,bottom=props.bottom,top=props.top,right=props.right,left=props.left,bottomCenter=props.bottomCenter,bottomLeft=props.bottomLeft,bottomRight=props.bottomRight,topRight=props.topRight,topLeft=props.topLeft,center=props.center;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);this.undoManager.reset();this.fit();if(position!==undefined)this.position=position;if(rightCenter!==undefined)this.rightCenter=rightCenter;if(leftCenter!==undefined)this.leftCenter=leftCenter;if(topCenter!==undefined)this.topCenter=topCenter;if(bottom!==undefined)this.bottom=bottom;if(top!==undefined)this.top=top;if(right!==undefined)this.right=right;if(left!==undefined)this.left=left;if(bottomCenter!==undefined)this.bottomCenter=bottomCenter;if(bottomLeft!==undefined)this.bottomLeft=bottomLeft;if(bottomRight!==undefined)this.bottomRight=bottomRight;if(topRight!==undefined)this.topRight=topRight;if(topLeft!==undefined)this.topLeft=topLeft;if(center!==undefined)this.center=center;}},{key:"__deserialize__",value:function Text___deserialize___(snapshot,objRef,serializedMap,pool){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__deserialize__",this).call(this,snapshot,objRef,serializedMap,pool);this.viewState=this.defaultViewState;this.markers=[];this.textRenderer=new __varRecorder__$R.Renderer(this.env.domEnv);this.textLayout=new __varRecorder__$R.TextLayout(this);this.changeDocument(__varRecorder__$R.Document.fromString(""));this.ensureUndoManager();if(snapshot.cachedLineBounds){this._initializedByCachedBounds=snapshot.cachedLineBounds;}this._isDeserializing=true;}},{key:"__after_deserialize__",value:function Text___after_deserialize___(snapshot,objRef,pool){var _this158=this;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__after_deserialize__",this).call(this,snapshot,objRef,pool);this._isDeserializing=false;this.whenRendered().then(function(){_this158.embeddedMorphs.forEach(function(m){return m.top=0;});});}},{key:"__only_serialize__",get:function get(){return __varRecorder__$R.arr.withoutAll(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__only_serialize__",this),["document","textRenderer","viewState","undoManager","markers","textLayout","embeddedMorphMap",this.displacingMorphMap.size?"":"displacingMorphMap"]);}},{key:"__additionally_serialize__",value:function Text___additionally_serialize___(snapshot,objRef,pool,addFn){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__additionally_serialize__",this).call(this,snapshot,objRef,pool,addFn);snapshot.props.selections={key:"selections",verbatim:true,value:(this.selection.isMultiSelection?this.selection.ranges:[this.selection.range]).map(function(ea){return __varRecorder__$R.obj.select(ea,["start","end"]);})};if(snapshot.props.anchors&&this.selection.isEmpty()){snapshot.props.anchors.value=snapshot.props.anchors.value.filter(function(ref){return!ref.id.includes("selection-");});}snapshot.props.textAndAttributes={key:"textAndAttributes",value:this.textAndAttributes.map(function(m){if(!m)return m;if(m.isMorph)return pool.ref(m).asRefForSerializedObjMap();if(__varRecorder__$R.obj.isObject(m)){var bindings={};var stringified=JSON.stringify(m,function(k,v){if(v&&v.__serialize__){v=v.__serialize__();Object.assign(bindings,v.bindings);return"->"+"[".concat(v.__expr__,"]");}return v;});stringified=stringified.replace(/\"->\[.*\]\"/g,function(m){return m.slice(4,-2);});return pool.expressionSerializer.exprStringEncode({__expr__:"(".concat(stringified,")"),bindings:bindings});}return m;})};var cachedLineBounds=[];var _iterator80=_createForOfIteratorHelper(this.document.lines),_step80;try{for(_iterator80.s();!(_step80=_iterator80.n()).done;){var line=_step80.value;var lineBounds=this.textLayout.lineCharBoundsCache.get(line);if(!lineBounds)continue;var compactBounds=[];var prevRect=void 0;var sameRectCount=0;if(lineBounds){var _iterator81=_createForOfIteratorHelper(lineBounds),_step81;try{for(_iterator81.s();!(_step81=_iterator81.n()).done;){var charBounds=_step81.value;if(prevRect){if(__varRecorder__$R.num.roundTo(prevRect.width,0.001)==__varRecorder__$R.num.roundTo(charBounds.width||0,0.001)&&charBounds.height==prevRect.height){sameRectCount++;continue;}compactBounds.push([sameRectCount,__varRecorder__$R.num.roundTo(prevRect.width||0,0.001),prevRect.height||0]);}sameRectCount=1;prevRect=charBounds;}}catch(err){_iterator81.e(err);}finally{_iterator81.f();}}if(prevRect)compactBounds.push([sameRectCount,__varRecorder__$R.num.roundTo(prevRect.width||0,0.001),prevRect.height||0]);cachedLineBounds.push([line.row,__varRecorder__$R.arr.flatten(compactBounds)]);}}catch(err){_iterator80.e(err);}finally{_iterator80.f();}snapshot.cachedLineBounds=cachedLineBounds;}},{key:"spec",value:function Text_spec_(){var spec=initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"spec",this).call(this);spec.textString=this.textString;return __varRecorder__$R.obj.dissoc(spec,["anchors","embeddedMorphMap","plugins","savedMarks","textLayout","textRenderer","viewState","undoManager","metadata","document","displacingMorphMap"]);}},{key:"isText",get:function get(){return true;}},{key:"makeDirty",value:function Text_makeDirty_(){if(this._positioningSubmorph)return;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"makeDirty",this).call(this);}},{key:"onChange",value:function Text_onChange_(change){var _this159=this;var prop=change.prop,selector=change.selector,meta=change.meta;var wraps=this.lineWrapping;var textChange=false;var viewChange=false;var softLayoutChange=false;var hardLayoutChange=false;var scrollChange=false;var enforceFit=false;if(selector){textChange=selector==="replace";hardLayoutChange=selector==="addTextAttribute";this._displacementChange=!this._displacing&&textChange;}else{switch(prop){case"scroll":viewChange=true;scrollChange=true;break;case"extent":viewChange=true;var delta=change.prevValue.subPt(change.value);softLayoutChange=this.fixedWidth&&!!this.lineWrapping&&!!delta.x;enforceFit=softLayoutChange&&(!this.fixedWidth||!this.fixedHeight);break;case"wordSpacing":case"letterSpacing":case"tabWidth":if(wraps)hardLayoutChange=true;break;case"fontFamily":case"fontSize":case"lineHeight":case"textAlign":case"fontWeight":case"fontStyle":case"textStyleClasses":case"fixedWidth":hardLayoutChange=change.prevValue!=change.value;break;case"lineWrapping":hardLayoutChange=true;break;case"borderWidth":case"fixedHeight":softLayoutChange=change.prevValue!=change.value;break;case"padding":softLayoutChange=true;break;}}initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onChange",this).call(this,change);var updateTextEngine=function updateTextEngine(){_this159._textChange=true;if(scrollChange)_this159.viewState.wasScrolled=true;if(hardLayoutChange||enforceFit||softLayoutChange&&!meta.styleSheetChange){_this159.invalidateTextLayout(hardLayoutChange,hardLayoutChange);}if(softLayoutChange||hardLayoutChange){if(_this159.document&&_this159.world())_this159.document.lines.forEach(function(l){return l.hasEstimatedExtent=true;});}if(_this159._displacementChange){_this159._displacementChange=false;}if(textChange)__varRecorder__$R.signal(_this159,"textChange",change);if(viewChange)__varRecorder__$R.signal(_this159,"viewChange",change);_this159._textChange=false;};if(meta.animation){__varRecorder__$R.promise.delay(meta.animation.duration).then(updateTextEngine);}else{updateTextEngine();}}},{key:"onSubmorphChange",value:function(){var _Text_onSubmorphChange_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee144(change,submorph){var _this160=this;var prop,isGeometricTransform,_ref120,submorphAnchor,currentBounds,lastBounds,row,line;return regeneratorRuntime.wrap(function _callee144$(_context144){while(1){switch(_context144.prev=_context144.next){case 0:if(!(change.meta&&change.meta.styleSheetChange)){_context144.next=2;break;}return _context144.abrupt("return");case 2:initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onSubmorphChange",this).call(this,change,submorph);if(!change.meta.animation){_context144.next=6;break;}_context144.next=6;return change.meta.animation.asPromise();case 6:if(!(this._textChange||this._positioningSubmorph===submorph)){_context144.next=8;break;}return _context144.abrupt("return");case 8:prop=change.prop;isGeometricTransform=prop=="position"||prop=="extent"||prop=="scale"||prop=="rotation";if(this.displacingMorphMap.get(submorph)&&isGeometricTransform){_toConsumableArray2(this.displacingMorphMap.keys()).filter(function(m){return m.top>=submorph.top;}).forEach(function(m){_this160._intersectionShapeCache&&_this160._intersectionShapeCache["delete"](m);_this160.updateTextDisplacementFor(m);});}_ref120=this.embeddedMorphMap.get(submorph)||{},submorphAnchor=_ref120.anchor;if(!(submorphAnchor&&isGeometricTransform)){_context144.next=23;break;}if(!(prop=="position")){_context144.next=18;break;}this._positioningSubmorph=submorph;submorph.position=change.prevValue;this._positioningSubmorph=null;return _context144.abrupt("return");case 18:currentBounds=submorph.bounds();lastBounds=submorph._lastBounds;row=submorphAnchor.position.row;line=this.document.getLine(row);if(!lastBounds||lastBounds.height!=currentBounds.height||lastBounds.bottom()!=currentBounds.bottom()){line.hasEstimatedExtent=true;submorph._lastBounds=currentBounds;}case 23:case"end":return _context144.stop();}}},_callee144,this);}));function Text_onSubmorphChange_(_x215,_x216){return _Text_onSubmorphChange_.apply(this,arguments);}return Text_onSubmorphChange_;}()},{key:"removeMorph",value:function Text_removeMorph_(morph){var invalidateTextLayout=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var embeddedMorphMap=this.embeddedMorphMap,displacingMorphMap=this.displacingMorphMap;if(displacingMorphMap&&displacingMorphMap.has(morph)){this.toggleTextWrappingAround(morph,false);}if(embeddedMorphMap&&embeddedMorphMap.has(morph)){var _embeddedMorphMap$get=embeddedMorphMap.get(morph),anchor=_embeddedMorphMap$get.anchor;if(anchor){var _anchor$position=anchor.position,row=_anchor$position.row,column=_anchor$position.column;this.replace({start:{row:row,column:column},end:{row:row,column:column+1}},[],true,invalidateTextLayout);this.replace;}embeddedMorphMap["delete"](morph);}return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"removeMorph",this).call(this,morph);}},{key:"toggleTextWrappingAround",value:function Text_toggleTextWrappingAround_(submorph,wrapActive){var _this161=this;if(wrapActive){if(this.displacingMorphMap.has(submorph))return;if(this.embeddedMorphMap.has(submorph)){this.addMorph(submorph.remove());}this.displacingMorphMap.set(submorph,[]);this.updateTextDisplacementFor(submorph);}else{var displacementMorphs=this.displacingMorphMap.get(submorph);if(displacementMorphs){this._displacing=true;displacementMorphs.forEach(function(dm){return _this161.removeMorph(dm);});this._displacing=false;this.displacingMorphMap["delete"](submorph);}}}},{key:"updateTextDisplacementFor",value:function Text_updateTextDisplacementFor_(submorph){var _this162=this;if(this._displacing)return;this._displacing=true;var morphs=this.displacingMorphMap.get(submorph);var rects=this.computeDisplacementRectsFor(submorph).values();var curr=[];morphs.forEach(function(m){return _this162.removeMorph(m,false);});this.textLayout.resetLineCharBoundsCacheOfRange(this,submorph._displacementRange);var prevTop;var _iterator82=_createForOfIteratorHelper(rects),_step82;try{for(_iterator82.s();!(_step82=_iterator82.n()).done;){var bounds=_step82.value;var _m15=morphs.shift()||__varRecorder__$R.morph({visible:true,reactsToPointer:false,isDisplacementMorph:true});var pos=this.textLayout.textPositionFromPoint(this,bounds.leftCenter());_m15.setBounds(bounds);this.insertText([_m15,{}],pos);this.viewState._needsFit=false;if(prevTop==_m15.top){_m15.remove();continue;}prevTop=_m15.top;curr.push(_m15);}}catch(err){_iterator82.e(err);}finally{_iterator82.f();}morphs.forEach(function(m){return _this162.removeMorph(m,false);});this.displacingMorphMap.set(submorph,curr);this._displacing=false;}},{key:"computeDisplacementRectsFor",value:function Text_computeDisplacementRectsFor_(submorph){var tl=this.textLayout;var startPos=tl.textPositionFromPoint(this,submorph.topLeft);var endPos=tl.textPositionFromPoint(this,submorph.bottomLeft);var lineRanges=[];var bufferDist=15;var computeIntersectionShape=function computeIntersectionShape(submorph){if(submorph.isPath){return __varRecorder__$R.Shapes.path(__varRecorder__$R.getSvgVertices(submorph.vertices));}else if(__varRecorder__$R.getClassName(submorph)=="Ellipse"){return __varRecorder__$R.Shapes.ellipse(submorph.center.x,submorph.center.y,submorph.width/2,submorph.height/2);}else{return __varRecorder__$R.Shapes.rectangle(submorph.left,submorph.top,submorph.width,submorph.height);}};submorph._displacementRange=__varRecorder__$R.Range.fromPositions(startPos,endPos);for(var row=startPos.row;row<endPos.row+1;row++){lineRanges.push.apply(lineRanges,_toConsumableArray2(tl.rangesOfWrappedLine(this,row)));}if(!this._intersectionShapeCache)this._intersectionShapeCache=new Map();var hit=this._intersectionShapeCache.get(submorph);var intersectionShape=hit||computeIntersectionShape(submorph);this._intersectionShapeCache.set(submorph,intersectionShape);var width=this.width;var extrusionMap=new Map();for(var _i165=0,_lineRanges2=lineRanges;_i165<_lineRanges2.length;_i165++){var _r6=_lineRanges2[_i165];var _tl$computeMaxBoundsF=tl.computeMaxBoundsForLineSelection(this,_r6),height=_tl$computeMaxBoundsF.height,_y13=_tl$computeMaxBoundsF.y;var lineRect=__varRecorder__$R.Shapes.rectangle(width,height,0,_y13);var is=__varRecorder__$R.Intersection.intersect(lineRect,intersectionShape);if(is.points.length<1)continue;var displacementRect=__varRecorder__$R.Rectangle.unionPts(is.points.map(__varRecorder__$R.Point.fromLiteral));displacementRect.y=_y13;displacementRect.height=height;displacementRect.x-=bufferDist;displacementRect.width+=2*bufferDist;extrusionMap.set(_r6,displacementRect);}return extrusionMap;}},{key:"rejectsInput",value:function Text_rejectsInput_(){return this.readOnly;}},{key:"addAnchor",value:function Text_addAnchor_(anchor){if(!anchor)return;if(typeof anchor==="string"){anchor={id:anchor,row:0,column:0};}if(!anchor.isAnchor){var _anchor=anchor,id=_anchor.id,column=_anchor.column,row=_anchor.row,insertBehavior=_anchor.insertBehavior;anchor=new __varRecorder__$R.Anchor(id,typeof row==="number"&&typeof column==="number"?{row:row,column:column}:undefined,insertBehavior||"move");}var existing=anchor.id&&this.anchors.find(function(ea){return ea.id===anchor.id;});if(existing)return Object.assign(existing,anchor);this.anchors.push(anchor);return anchor;}},{key:"removeAnchor",value:function Text_removeAnchor_(anchor){var anchors=this.anchors;var removed;for(var _i166=anchors.length;_i166--;){var _a5=anchors[_i166];if(_a5.id==anchor||_a5===anchor){removed=_a5;anchors.splice(_i166,1);}}return removed;}},{key:"addMarker",value:function Text_addMarker_(marker){this.removeMarker(marker.id);this.markers.push(marker);this.makeDirty();return marker;}},{key:"removeMarker",value:function Text_removeMarker_(marker){var id=typeof marker==="string"?marker:marker.id;this.markers=this.markers.filter(function(ea){return ea.id!==id;});this.makeDirty();}},{key:"saveMark",value:function Text_saveMark_(){var p=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition;var activate=arguments.length>1?arguments[1]:undefined;var prevMark=this.activeMark;if(prevMark&&prevMark!==p&&!prevMark.equalsPosition(p)){this.savedMarks=this.savedMarks.concat(prevMark);}if(activate)this.activeMark=p;else this.savedMarks=this.savedMarks.concat(p);}},{key:"saveActiveMarkAndDeactivate",value:function Text_saveActiveMarkAndDeactivate_(){var m=this.activeMark;if(m){this.saveMark(m);this.activeMark=null;}}},{key:"popSavedMark",value:function Text_popSavedMark_(){var mark=this.activeMark;if(mark){this.activeMark=null;return mark;}var last=__varRecorder__$R.arr.last(this.savedMarks);this.savedMarks=this.savedMarks.slice(0,-1);return last;}},{key:"lastSavedMark",get:function get(){return this.activeMark||__varRecorder__$R.arr.last(this.savedMarks);}},{key:"savedMarkForSelection",value:function Text_savedMarkForSelection_(replacement){var sel=this.selection,savedMarks=this.savedMarks;var multiRangeLength=this.multiSelect?this.multiSelect.getAllRanges().length:1;var selIndex=sel.index||0;var markIndex=savedMarks.length-(multiRangeLength-selIndex);var lastMark=savedMarks[markIndex]||sel.anchor;if(replacement&&"row"in replacement&&"column"in replacement){this.savedMarks=savedMarks.slice(0,markIndex).concat(replacement).concat(savedMarks.slice(markIndex+1));}return lastMark;}},{key:"addPlugin",value:function Text_addPlugin_(plugin){if(!this.plugins.includes(plugin)){this.plugins.push(plugin);this._cachedKeyhandlers=null;typeof plugin.attach==="function"&&plugin.attach(this);}return plugin;}},{key:"removePlugin",value:function Text_removePlugin_(plugin){if(!this.plugins.includes(plugin))return false;this._cachedKeyhandlers=null;__varRecorder__$R.arr.remove(this.plugins,plugin);typeof plugin.detach==="function"&&plugin.detach(this);return true;}},{key:"pluginCollect",value:function Text_pluginCollect_(method){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];this.plugins.forEach(function(p){return typeof p[method]==="function"&&(result=p[method](result));});return result;}},{key:"pluginInvokeFirst",value:function Text_pluginInvokeFirst_(method){var plugin=this.pluginFind(function(p){return typeof p[method]==="function";});for(var _len5=arguments.length,args=new Array(_len5>1?_len5-1:0),_key14=1;_key14<_len5;_key14++){args[_key14-1]=arguments[_key14];}return plugin?plugin[method].apply(plugin,args):undefined;}},{key:"pluginFind",value:function Text_pluginFind_(iterator){return this.plugins.slice().reverse().find(iterator);}},{key:"editorPlugin",get:function get(){return this.pluginFind(function(ea){return ea.isEditorPlugin;});}},{key:"lookupEditorPluginNamed",value:function(){var _Text_lookupEditorPluginNamed_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee145(modeName){var isAbsURL,url,_yield$lively$modules,Mode;return regeneratorRuntime.wrap(function _callee145$(_context145){while(1){switch(_context145.prev=_context145.next){case 0:modeName=__varRecorder__$R.config.ide.modes.aliases[modeName]||modeName;isAbsURL=/^[^:\\]+:\/\//.test(modeName);url=isAbsURL?modeName:"lively.ide/".concat(modeName,"/editor-plugin.js");_context145.next=5;return lively.modules.doesModuleExist(url);case 5:if(_context145.sent){_context145.next=7;break;}return _context145.abrupt("return",null);case 7:_context145.next=9;return lively.modules.module(url).load();case 9:_yield$lively$modules=_context145.sent;Mode=_yield$lively$modules["default"];return _context145.abrupt("return",Mode);case 12:case"end":return _context145.stop();}}},_callee145);}));function Text_lookupEditorPluginNamed_(_x217){return _Text_lookupEditorPluginNamed_.apply(this,arguments);}return Text_lookupEditorPluginNamed_;}()},{key:"changeEditorMode",value:function(){var _Text_changeEditorMode_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee146(nameOrMode){var pluginsWithoutModes,Mode;return regeneratorRuntime.wrap(function _callee146$(_context146){while(1){switch(_context146.prev=_context146.next){case 0:pluginsWithoutModes=this.plugins.filter(function(ea){return!ea.isEditorPlugin;});if(nameOrMode){_context146.next=4;break;}this.plugins=pluginsWithoutModes;return _context146.abrupt("return",null);case 4:if(!(typeof nameOrMode==="string")){_context146.next=12;break;}_context146.next=7;return this.lookupEditorPluginNamed(nameOrMode);case 7:Mode=_context146.sent;if(Mode){_context146.next=10;break;}throw new Error("Cannot find editor mode ".concat(nameOrMode));case 10:nameOrMode=new Mode(__varRecorder__$R.config.codeEditor.defaultTheme);if(this.evalEnvironment)nameOrMode.evalEnvironment=this.evalEnvironment;case 12:this.plugins=pluginsWithoutModes.concat(nameOrMode);return _context146.abrupt("return",nameOrMode);case 14:case"end":return _context146.stop();}}},_callee146,this);}));function Text_changeEditorMode_(_x218){return _Text_changeEditorMode_.apply(this,arguments);}return Text_changeEditorMode_;}()},{key:"invalidateTextLayout",value:function Text_invalidateTextLayout_(){var resetCharBoundsCache=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var resetLineHeights=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._isDeserializing)return;var vs=this.viewState;if(!vs)return;if(!this.fixedWidth||!this.fixedHeight)vs._needsFit=true;var tl=this.textLayout;if(tl){if(resetCharBoundsCache)tl.resetLineCharBoundsCache(this);tl.estimateLineHeights(this,resetLineHeights);}}},{key:"textBounds",value:function Text_textBounds_(){return this.textLayout.textBounds(this);}},{key:"defaultCharExtent",value:function Text_defaultCharExtent_(){return this.textLayout.defaultCharExtent(this);}},{key:"scrollExtent",get:function get(){return this.textBounds().extent().addPt(this.padding.topLeft()).addPt(this.padding.bottomRight()).addPt(this.scrollbarOffset).maxPt(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"scrollExtent",this));}},{key:"commands",get:function get(){return this.pluginCollect("getCommands",(this._commands||[]).concat(__varRecorder__$R.commands));}},{key:"execCommand",value:function Text_execCommand_(commandOrName,args,count,evt){var _this163=this;var _ref121=this.lookupCommand(commandOrName)||{},name=_ref121.name,command=_ref121.command;if(!command)return undefined;var multiSelect=this.inMultiSelectMode();var multiSelectAction=command.hasOwnProperty("multiSelectAction")?command.multiSelectAction:"forEach";if(multiSelect&&multiSelectAction==="forEach"){var origSelection=this.selection;var selections=this.selection.selections.slice().reverse();this.selection=selections[0];this._multiSelection=origSelection;try{var result=this.execCommand(commandOrName,args,count,evt);}catch(err){this.selection=origSelection;this._multiSelection=null;this.selection.mergeSelections();throw err;}if(!result)return result;var results=[result];if(typeof result.then==="function"&&typeof result["catch"]==="function"){return __varRecorder__$R.promise["finally"](__varRecorder__$R.promise.chain([function(){return result;}].concat(selections.slice(1).map(function(sel){return function(){_this163.selection=sel;return Promise.resolve(_this163.execCommand(commandOrName,args,count,evt)).then(function(result){return results.push(result);});};}))).then(function(){return results;}),function(){_this163.selection=origSelection;_this163._multiSelection=null;_this163.selection.mergeSelections();});}else{try{var _iterator83=_createForOfIteratorHelper(selections.slice(1)),_step83;try{for(_iterator83.s();!(_step83=_iterator83.n()).done;){var sel=_step83.value;this.selection=sel;results.push(this.execCommand(commandOrName,args,count,evt));}}catch(err){_iterator83.e(err);}finally{_iterator83.f();}}finally{this.selection=origSelection;this._multiSelection=null;this.selection.mergeSelections();}return results;}}var result=this.commandHandler.exec(commandOrName,this,args,count,evt);if(result){if(typeof result.then==="function"&&typeof result["catch"]==="function"){result.then(function(){return cleanupScroll(_this163);});}else cleanupScroll(this);}return result;function cleanupScroll(morph){var scrollCursorIntoView=command.hasOwnProperty("scrollCursorIntoView")?command.scrollCursorIntoView:true;if(scrollCursorIntoView){__varRecorder__$R.fun.debounceNamed("execCommand-scrollCursorIntoView-"+morph.id,100,function(){return morph.scrollCursorIntoView();})();}}}},{key:"changeDocument",value:function Text_changeDocument_(doc){var resetStyle=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.document)var defaultTextStyle=this.defaultTextStyle;else resetStyle=false;this.document=doc;this.textLayout.reset();if(resetStyle)this.defaultTextStyle=defaultTextStyle;this.makeDirty();this.consistencyCheck();}},{key:"textInRange",value:function Text_textInRange_(range){return this.document.textInRange(range);}},{key:"charRight",value:function Text_charRight_(){var _ref122=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition,row=_ref122.row,column=_ref122.column;return this.getLine(row).slice(column,column+1);}},{key:"charLeft",value:function Text_charLeft_(){var _ref123=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition,row=_ref123.row,column=_ref123.column;return this.getLine(row).slice(column-1,column);}},{key:"indexToPosition",value:function Text_indexToPosition_(index){return this.document.indexToPosition(index);}},{key:"positionToIndex",value:function Text_positionToIndex_(position){return this.document.positionToIndex(position);}},{key:"getVisibleLine",value:function Text_getVisibleLine_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;return this.textLayout.wrappedLines(this)[row].text;}},{key:"isLineVisible",value:function Text_isLineVisible_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;return this.textLayout.isLineVisible(this,row);}},{key:"isLineFullyVisible",value:function Text_isLineFullyVisible_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;return this.textLayout.isLineFullyVisible(this,row);}},{key:"getLine",value:function Text_getLine_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;return this.document.getLineString(row);}},{key:"lineCount",value:function Text_lineCount_(){return this.document.rowCount;}},{key:"isLineEmpty",value:function Text_isLineEmpty_(row){return!this.getLine(row).trim();}},{key:"isAtLineEnd",value:function Text_isAtLineEnd_(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition;var line=this.getLine(pos.row);return pos.column===line.length;}},{key:"wordsOfLine",value:function Text_wordsOfLine_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;return this.document.wordsOfLine(row);}},{key:"wordAt",value:function Text_wordAt_(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition;return this.document.wordAt(pos);}},{key:"wordLeft",value:function Text_wordLeft_(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition;return this.document.wordLeft(pos);}},{key:"wordRight",value:function Text_wordRight_(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition;return this.document.wordRight(pos);}},{key:"lineRange",value:function Text_lineRange_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;var ignoreLeadingWhitespace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(typeof row!=="number")this.cursorPosition.row;var line=this.getLine(row);var range={start:{column:0,row:row},end:{column:line.length,row:row}};var leadingSpace=line.match(/^\s*/);if(leadingSpace[0].length&&ignoreLeadingWhitespace){range.start.column+=leadingSpace[0].length;}return new __varRecorder__$R.Range(range);}},{key:"screenLineRange",value:function Text_screenLineRange_(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition;var ignoreLeadingWhitespace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return this.textLayout.screenLineRange(this,pos,ignoreLeadingWhitespace);}},{key:"insertTextAndSelect",value:function Text_insertTextAndSelect_(text){var pos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;text=String(text);if(pos)this.selection.range=this.insertText(text,pos);else this.selection.text=text;}},{key:"append",value:function Text_append_(text){var _this164=this;return this.saveExcursion(function(){return _this164.insertText(text,_this164.documentEndPosition);});}},{key:"insertText",value:function Text_insertText_(textOrtextAndAttributes){var pos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.cursorPosition;var extendTextAttributes=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var invalidateTextLayout=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;return this.replace({start:pos,end:pos},textOrtextAndAttributes,extendTextAttributes,invalidateTextLayout);}},{key:"deleteText",value:function Text_deleteText_(range){var invalidateTextLayout=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var removedTextAndAttributes=this.textAndAttributesInRange(range);this.replace(range,[],false,invalidateTextLayout);return removedTextAndAttributes;}},{key:"replace",value:function Text_replace_(range,textOrtextAndAttributes){var _this165=this;var extendTextAttributes=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var invalidateTextLayout=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var undoGroup=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var consistencyCheck=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;range=range.isRange?range:new __varRecorder__$R.Range(range);var textAndAttributes=typeof textOrtextAndAttributes==="string"?[textOrtextAndAttributes,null]:Array.isArray(textOrtextAndAttributes)?textOrtextAndAttributes:[String(textOrtextAndAttributes||""),null];var nothingToInsert=!textAndAttributes.length||textAndAttributes.length==2&&!textAndAttributes[0];var nothingToDelete=range.isEmpty();if(nothingToInsert&&nothingToDelete)return range;var attrToExtend;if(extendTextAttributes){attrToExtend=this.textAttributeAt({row:range.start.row,column:range.start.column-(range.start.column>0?1:0)});}var morphsInAddedText=[];for(var _i167=0;_i167<textAndAttributes.length;_i167=_i167+2){var content=textAndAttributes[_i167];var attrs=textAndAttributes[_i167+1];if(content.isMorph)morphsInAddedText.push(content);if(attrToExtend)textAndAttributes[_i167+1]=Object.assign({},attrToExtend,{},attrs);}undoGroup&&this.undoManager.undoStart(this,"replace");var removedTextAndAttributes=this.textAndAttributesInRange(range);var _this$document$replac=this.document.replace(range,textAndAttributes,this.debug&&this.debugHelper(this.debug)),insertedRange=_this$document$replac.inserted;this.addMethodCallChangeDoing({target:this,selector:"replace",args:[range,textAndAttributes],undo:{target:this,selector:"replace",args:[insertedRange,removedTextAndAttributes,false]}},function(){if(invalidateTextLayout){_this165.invalidateTextLayout(false,false);_this165.textLayout.resetLineCharBoundsCacheOfRange(_this165,insertedRange);}if(!__varRecorder__$R.eqPosition(range.end,insertedRange.end)){if(__varRecorder__$R.lessPosition(insertedRange.end,range.end)){var _varRecorder__$R$Ran=new __varRecorder__$R.Range(range).subtract(insertedRange),_varRecorder__$R$Ran2=_slicedToArray2(_varRecorder__$R$Ran,1),removedRange=_varRecorder__$R$Ran2[0];_this165.anchors.forEach(function(ea){return ea.onDelete(removedRange);});}else{var _varRecorder__$R$Ran3=new __varRecorder__$R.Range(insertedRange).subtract(range),_varRecorder__$R$Ran4=_slicedToArray2(_varRecorder__$R$Ran3,1),addedRange=_varRecorder__$R$Ran4[0];_this165.anchors.forEach(function(ea){return ea.onInsert(addedRange);});}if(_this165._multiSelection)_this165._multiSelection.updateFromAnchors();else _this165.selection.updateFromAnchors();}_this165._updateEmbeddedMorphsDuringReplace(morphsInAddedText,insertedRange,textAndAttributes,removedTextAndAttributes);if(!_this165._isDeserializing||!_this165._initializedByCachedBounds){_this165.textLayout.estimateLineHeights(_this165,false);}if(consistencyCheck){_this165.consistencyCheck();}});undoGroup&&this.undoManager.undoStop();return insertedRange;}},{key:"_updateEmbeddedMorphsDuringReplace",value:function Text__updateEmbeddedMorphsDuringReplace_(morphsInAddedText,insertedRange,newTextAndAttributes,removedTextAndAttributes){var embeddedMorphMap=this.embeddedMorphMap;for(var _i168=0;_i168<removedTextAndAttributes.length;_i168=_i168+2){var content=removedTextAndAttributes[_i168];if(content.isMorph&&!morphsInAddedText.includes(content)){if(embeddedMorphMap){var existing=embeddedMorphMap.get(content);if(existing&&existing.anchor){this.removeAnchor(existing.anchor);__varRecorder__$R.disconnect(existing.anchor,"position",content,"position");}embeddedMorphMap.set(content,Object.assign({},existing,{anchor:null}));}content.remove();}}if(morphsInAddedText.length){var _varRecorder__$R$tex=__varRecorder__$R.textAndAttributesWithSubRanges(insertedRange.start,newTextAndAttributes),ranges=_varRecorder__$R$tex.ranges,textAndAttributes=_varRecorder__$R$tex.textAndAttributes;for(var _i169=0;_i169<ranges.length;_i169++){var _morph14=textAndAttributes[_i169*2];if(!_morph14.isMorph)continue;console.assert(morphsInAddedText.includes(_morph14),"????");var start=ranges[_i169].start;if(_morph14.owner!==this)this.addMorph(_morph14);if(embeddedMorphMap){if(embeddedMorphMap.has(_morph14)){embeddedMorphMap.get(_morph14).anchor.position=start;continue;}var anchor=this.addAnchor(Object.assign({id:"embedded-"+_morph14.id},start));__varRecorder__$R.connect(anchor,"position",_morph14,"position",{updater:function updater($upd,textPos){var tm=this.targetObj.owner;var embeddedMorph=this.targetObj;var pos=tm&&tm.isText?tm.charBoundsFromTextPosition(textPos).topLeft().subPt(tm.origin):embeddedMorph.position;if(tm)tm._positioningSubmorph=embeddedMorph;$upd(pos);if(tm)tm._positioningSubmorph=false;}}).update(anchor.position);embeddedMorphMap.set(_morph14,{anchor:anchor});}}}}},{key:"applyJsDiffPatch",value:function Text_applyJsDiffPatch_(patch){var self=this;var changes=[];var pos=0;var offset=0;var _iterator84=_createForOfIteratorHelper(patch),_step84;try{for(_iterator84.s();!(_step84=_iterator84.n()).done;){var change=_step84.value;if(change.removed){offset=remove(pos,pos+change.count,offset,changes);}else if(change.added){offset=insert(pos,change.value,offset,changes);}pos+=change.count;}}catch(err){_iterator84.e(err);}finally{_iterator84.f();}return changes;function remove(startI,endI,offset,changes){var start=self.indexToPosition(startI+offset);var end=self.indexToPosition(endI+offset);changes.push(self.deleteText({start:start,end:end}));return offset-(endI-startI);}function insert(atI,text,offset,changes){changes.push(self.insertText(text,self.indexToPosition(atI+offset)));return offset;}}},{key:"applyTextChanges",value:function Text_applyTextChanges_(changes){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var extendTextAttributes=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var invalidateTextLayout=arguments.length>3?arguments[3]:undefined;var changed=[];var _iterator85=_createForOfIteratorHelper(changes),_step85;try{for(_iterator85.s();!(_step85=_iterator85.n()).done;){var _step85$value=_slicedToArray2(_step85.value,3),type=_step85$value[0],start=_step85$value[1],endOrText=_step85$value[2];if(offset){var startIndex=typeof start==="number"?start:this.positionToIndex(start);start=startIndex+offset;if(endOrText&&typeof endOrText!=="string"&&!Array.isArray(endOrText)){var endIndex=typeof endOrText==="number"?endOrText:this.positionToIndex(endOrText);endOrText=endIndex+offset;}start=startIndex+offset;}var startPos=typeof start==="number"?this.indexToPosition(start):start;switch(type){case"delete":case"remove":var endPos=typeof endOrText==="number"?this.indexToPosition(endOrText):endOrText;changed.push(this.deleteText({start:startPos,end:endPos},invalidateTextLayout));break;case"insert":changed.push(this.insertText(endOrText,startPos,extendTextAttributes,invalidateTextLayout));break;default:console.warn("[applyTextChanges] unknown type: ".concat(type));}}}catch(err){_iterator85.e(err);}finally{_iterator85.f();}return changed;}},{key:"modifyLines",value:function Text_modifyLines_(startRow,endRow,modifyFn){var _this166=this;var lines=__varRecorder__$R.arr.range(startRow,endRow).map(function(row){return _this166.getLine(row);});var modifiedText=lines.map(modifyFn).join("\n")+"\n";this.deleteText({start:{row:startRow,column:0},end:{row:endRow+1,column:0}},false);this.insertText(modifiedText,{row:startRow,column:0});}},{key:"modifySelectedLines",value:function Text_modifySelectedLines_(modifyFn){var range=this.selection.isEmpty()?this.lineRange(undefined,false):this.selection.range;return this.modifyLines(range.start.row,range.end.row,modifyFn);}},{key:"withLinesDo",value:function Text_withLinesDo_(startRow,endRow,doFunc){var _this167=this;return __varRecorder__$R.arr.range(startRow,endRow).map(function(row){var line=_this167.getLine(row);var range=__varRecorder__$R.Range.create(row,0,row,line.length);return doFunc(line,range);});}},{key:"withSelectedLinesDo",value:function Text_withSelectedLinesDo_(doFunc){var range=this.selection.isEmpty()?this.lineRange(undefined,false):this.selection.range;var startRow=range.start.row,_range$end4=range.end,endRow=_range$end4.row,endColumn=_range$end4.column;return this.withLinesDo(startRow,endColumn===0&&endRow>startRow?endRow-1:endRow,doFunc);}},{key:"joinLine",value:function Text_joinLine_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;var firstLine=this.getLine(row);var otherLine=this.getLine(row+1);var joined=firstLine+otherLine.replace(/^\s+/,"")+this.document.constructor.newline;this.replace({start:{column:0,row:row},end:{column:0,row:row+2}},joined,true);return{row:row,column:firstLine.length};}},{key:"whatsVisible",get:function get(){return this.textLayout.whatsVisible(this);}},{key:"flash",value:function Text_flash_(){var _this168=this;var range=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.selection.range;var options=arguments.length>1?arguments[1]:undefined;options=Object.assign({time:1000,fill:__varRecorder__$R.Color.orange},options);var id=options.id||"flash"+__varRecorder__$R.string.newUUID();this.addMarker({id:id,range:range,style:{"background-color":options.fill.toCSSString(),"pointer-events":"none"}});__varRecorder__$R.fun.debounceNamed("flash-"+id,options.time,function(){return _this168.removeMarker(id);})();}},{key:"addTextAttribute",value:function Text_addTextAttribute_(attr){var _this169=this;var range=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.selection;var plainRange={start:range.start,end:range.end};this.undoManager.undoStart(this,"addTextAttribute");this.addMethodCallChangeDoing({target:this,selector:"addTextAttribute",args:[attr,plainRange],undo:{target:this,selector:"removeTextAttribute",args:[attr,plainRange]}},function(){_this169.document.mixinTextAttribute(attr,plainRange);_this169.onAttributesChanged(plainRange);_this169.consistencyCheck();});this.undoManager.undoStop();return attr;}},{key:"removeTextAttribute",value:function Text_removeTextAttribute_(attr){var _this170=this;var range=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.selection;var plainRange={start:range.start,end:range.end};this.undoManager.undoStart(this,"removeTextAttribute");this.addMethodCallChangeDoing({target:this,selector:"removeTextAttribute",args:[attr,plainRange],undo:{target:this,selector:"addTextAttribute",args:[attr,plainRange]}},function(){_this170.document.mixoutTextAttribute(attr,plainRange);_this170.onAttributesChanged(plainRange);_this170.consistencyCheck();});this.undoManager.undoStop();}},{key:"setTextAttributesWithSortedRanges",value:function Text_setTextAttributesWithSortedRanges_(textAttributesAndRanges){this.document.setTextAttributesWithSortedRanges(textAttributesAndRanges);this.consistencyCheck();var i=0;while(i<textAttributesAndRanges.length){this.onAttributesChanged(textAttributesAndRanges[i]);i+=2;}}},{key:"textAttributeAt",value:function Text_textAttributeAt_(textPos){var d=this.document,tl=this.textLayout;return d.textAttributeAt(textPos);}},{key:"textAttributeAtPoint",value:function Text_textAttributeAtPoint_(point){return this.textAttributeAt(this.textLayout.textPositionFromPoint(this,point));}},{key:"textAndAttributesInRange",value:function Text_textAndAttributesInRange_(){var range=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.selection.range;return this.document.textAndAttributesInRange(range);}},{key:"resetTextAttributes",value:function Text_resetTextAttributes_(){this.document.resetTextAttributes();this.onAttributesChanged(this.documentRange);this.consistencyCheck();}},{key:"onAttributesChanged",value:function Text_onAttributesChanged_(range){this.invalidateTextLayout(false,false);var tl=this.textLayout;if(tl){tl.resetLineCharBoundsCacheOfRange(this,range);}this.makeDirty();}},{key:"styleAt",value:function Text_styleAt_(point){var chunk=this.textLayout.chunkAtPos(this,point);return chunk?chunk.style:Object.assign({},this.defaultTextStyle);}},{key:"getStyleInRange",value:function Text_getStyleInRange_(){var range=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.selection;var attrs=this.textAndAttributesInRange(range).filter(function(ea,i){return i%2!=0;});return attrs.reduce(function(all,ea){for(var key in ea){var val=ea[key];if(all.hasOwnProperty(key)&&(val===undefined||val===null))continue;all[key]=val;}return all;},{});}},{key:"setStyleInRange",value:function Text_setStyleInRange_(attr){var _this171=this;var range=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.selection;var textAndAttributes=this.textAndAttributesInRange(range);var currentRange={start:Object.assign({},range.start),end:Object.assign({},range.start)};var rangesAndAttributes=[];for(var _i170=0;_i170<textAndAttributes.length;_i170=_i170+2){var text=textAndAttributes[_i170];var _attr=textAndAttributes[_i170+1];var newlineIndex=-1;if(typeof text!=="string")text=__varRecorder__$R.objectReplacementChar;while((newlineIndex=text.indexOf("\n"))>-1){if(newlineIndex>0){currentRange.end.column=currentRange.end.column+newlineIndex;rangesAndAttributes.push(currentRange,_attr);}var pos={row:currentRange.end.row+1,column:0};currentRange={start:pos,end:Object.assign({},pos)};text=text.slice(newlineIndex+1);}currentRange.end.column+=text.length;rangesAndAttributes.push(currentRange,_attr);currentRange={start:Object.assign({},currentRange.end),end:Object.assign({},currentRange.end)};}this.undoManager.undoStart(this,"setStyleInRange");this.addMethodCallChangeDoing({target:this,selector:"setStyleInRange",args:[attr,range],undo:{target:this,selector:"setTextAttributesWithSortedRanges",args:[rangesAndAttributes]}},function(){_this171.document.setTextAttribute(attr,range);_this171.consistencyCheck();_this171.onAttributesChanged(range);});this.undoManager.undoStop();}},{key:"resetStyleInRange",value:function Text_resetStyleInRange_(){var range=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.selection;var textAndAttrs=this.document.textAndAttributesInRange(range);var mixout={};for(var _i171=0;_i171<textAndAttrs.length;_i171=_i171+2){Object.assign(mixout,textAndAttrs[_i171+1]);}this.removeTextAttribute(mixout,range);}},{key:"changeStyleProperty",value:function Text_changeStyleProperty_(propName,newValueFn){var _this172=this;var range=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.selection;var oldValue=this.getStyleInRange(range)[propName];var newValue=newValueFn(oldValue);this.selections.forEach(function(sel){return _this172.addTextAttribute(_defineProperty({},propName,newValue),sel);});}},{key:"inMultiSelectMode",value:function Text_inMultiSelectMode_(){return this.selection.selections&&this.selection.selections.length>1;}},{key:"selectionBounds",value:function Text_selectionBounds_(){var _this173=this;return this.selections.map(function(sel){var start=_this173.charBoundsFromTextPosition(sel.start);var end=_this173.charBoundsFromTextPosition(sel.end);return sel.start.row===sel.end.row?start.union(end):__varRecorder__$R.rect(__varRecorder__$R.pt(_this173.padding.left(),start.top()),__varRecorder__$R.pt(_this173.width-_this173.padding.left(),end.bottom()));}).reduce(function(all,ea){return ea.union(all);});}},{key:"documentEndPosition",get:function get(){return this.document?this.document.endPosition:{row:0,column:0};}},{key:"isAtDocumentEnd",value:function Text_isAtDocumentEnd_(){return __varRecorder__$R.eqPosition(this.cursorPosition,this.documentEndPosition);}},{key:"documentRange",get:function get(){return{start:{row:0,column:0},end:this.documentEndPosition};}},{key:"cursorUp",value:function Text_cursorUp_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return this.selection.goUp(n);}},{key:"cursorDown",value:function Text_cursorDown_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return this.selection.goDown(n);}},{key:"cursorLeft",value:function Text_cursorLeft_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return this.selection.goLeft(n);}},{key:"cursorRight",value:function Text_cursorRight_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return this.selection.goRight(n);}},{key:"getPositionAboveOrBelow",value:function Text_getPositionAboveOrBelow_(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var pos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.cursorPosition;var useScreenPosition=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var goalColumn=arguments.length>3?arguments[3]:undefined;var goalX=arguments.length>4?arguments[4]:undefined;if(n===0)return pos;if(typeof goalX==="number")goalX-=this.padding.left();var nextRow=pos.row;var nextCol=pos.column;if(!useScreenPosition||!this.lineWrapping){nextRow=Math.min(Math.max(0,pos.row-n),this.lineCount()-1);if(typeof goalX==="number"){var charBounds=this.textLayout.charBoundsOfRow(this,nextRow);nextCol=columnInCharBoundsClosestToX(charBounds,goalX);}}else{var ranges=this.textLayout.rangesOfWrappedLine(this,pos.row);if(!ranges.length)return pos;var currentRangeIndex=ranges.length-1-ranges.slice().reverse().findIndex(function(_ref124){var start=_ref124.start,end=_ref124.end;return start.column<=pos.column;});var currentRange=ranges[currentRangeIndex];var nextRange;var nextRangeIsAtLineEnd=false;if(n>=1){var isFirst=currentRangeIndex===0;nextRange=isFirst?pos.row<=0?null:__varRecorder__$R.arr.last(this.textLayout.rangesOfWrappedLine(this,pos.row-1)):ranges[currentRangeIndex-1];if(!nextRange)return pos;nextRangeIsAtLineEnd=isFirst;}else if(n<=-1){var isLast=ranges.length-1===currentRangeIndex;var nextRanges=isLast?pos.row>=this.lineCount()-1?[]:this.textLayout.rangesOfWrappedLine(this,pos.row+1):ranges.slice(currentRangeIndex+1);nextRange=nextRanges[0];if(!nextRange)return pos;nextRangeIsAtLineEnd=nextRanges.length===1;}nextRow=nextRange.start.row;var _charBounds2=this.textLayout.charBoundsOfRow(this,nextRow).slice(nextRange.start.column,nextRange.end.column+1);nextCol=nextRange.start.column+columnInCharBoundsClosestToX(_charBounds2,goalX);}var newPos={row:nextRow,column:nextCol};return Math.abs(n)>1?this.getPositionAboveOrBelow(n+(n>1?-1:1),newPos,useScreenPosition,goalColumn,goalX):newPos;function columnInCharBoundsClosestToX(charBounds,goalX){charBounds=charBounds.slice();charBounds.push({x:__varRecorder__$R.arr.last(charBounds).x+__varRecorder__$R.arr.last(charBounds).width});var closestColumn=0;var distToGoalX=Infinity;for(var _i172=0;_i172<charBounds.length;_i172++){var _x219=charBounds[_i172].x;var dist=Math.abs(_x219-goalX);if(dist<distToGoalX){distToGoalX=dist;closestColumn=_i172;}}return closestColumn;}}},{key:"collapseSelection",value:function Text_collapseSelection_(){this.selection.collapse(this.selection.lead);return this.selection;}},{key:"selectAll",value:function Text_selectAll_(){this.selection.selectAll();return this.selection;}},{key:"selectLine",value:function Text_selectLine_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;var includingLineEnd=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.selection.selectLine(row,includingLineEnd);return this.selection;}},{key:"selectionOrLineString",value:function Text_selectionOrLineString_(){var _this$selection=this.selection,text=_this$selection.text,start=_this$selection.start;return text||this.getLine(start.row);}},{key:"scrollCursorIntoView",value:function Text_scrollCursorIntoView_(){this.scrollPositionIntoView(this.cursorPosition);}},{key:"centerRange",value:function Text_centerRange_(){var range=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.selection.range;var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:__varRecorder__$R.pt(0,0);var alignAtTopIfLarger=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var t=this.charBoundsFromTextPosition(range.start).top();var b=this.charBoundsFromTextPosition(range.end).bottom();var height=b-t;if(height<this.height||alignAtTopIfLarger===false){var centerY=t+height/2;this.scroll=this.scroll.withY(centerY-this.height/2).addPt(offset);}else{this.scroll=this.scroll.withY(t).addPt(offset);}}},{key:"centerRow",value:function Text_centerRow_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:__varRecorder__$R.pt(0,0);return this.alignRowAtTop(row,offset.addXY(0,-this.height/2));}},{key:"alignRowAtTop",value:function Text_alignRowAtTop_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:__varRecorder__$R.pt(0,0);var charBounds=this.charBoundsFromTextPosition({row:row,column:0});var pos=charBounds.topLeft().addXY(-this.padding.left(),0);this.scroll=pos.addPt(offset);}},{key:"alignRowAtBottom",value:function Text_alignRowAtBottom_(){var row=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.cursorPosition.row;var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:__varRecorder__$R.pt(0,0);var charHeight=this.charBoundsFromTextPosition({row:row,column:0}).height;this.alignRowAtTop(row,offset.addXY(0,-this.textPageHeight()+charHeight));}},{key:"scrollPositionIntoView",value:function Text_scrollPositionIntoView_(pos){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:__varRecorder__$R.pt(0,0);if(!this.isClip())return;var scroll=this.scroll,padding=this.padding;var viewBounds=this.innerBounds().translatedBy(scroll).insetByRect(this.padding).insetBy(this.borderWidth);var charBounds=this.charBoundsFromTextPosition(pos);if(!this.lineWrapping)charBounds=charBounds.insetByPt(__varRecorder__$R.pt(-20,0));var corner=viewBounds.bottom()-charBounds.bottom()>20?"bottomLeft":"topLeft";var delta=charBounds[corner]().subPt(viewBounds.translateForInclusion(charBounds)[corner]()).addPt(offset);if(delta.x!=0||delta.y!=0){this.scroll=this.scroll.addPt(delta).addPt(offset);if(this.isFocused())this.ensureKeyInputHelperAtCursor();}}},{key:"keepPosAtSameScrollOffsetWhile",value:function Text_keepPosAtSameScrollOffsetWhile_(doFn){var _this174=this;var pos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.cursorPosition;return function(pos){var scroll=_this174.scroll,pos=_this174.selection.lead;var offset=_this174.charBoundsFromTextPosition(pos).y-scroll.y;var isPromise=false;var cleanup=function cleanup(){return _this174.scroll=_this174.scroll.withY(_this174.charBoundsFromTextPosition(pos).y-offset);};try{var result=doFn();isPromise=result&&result instanceof Promise;}finally{!isPromise&&cleanup();}if(isPromise)__varRecorder__$R.promise["finally"](result,cleanup);return result;}(pos);}},{key:"saveExcursion",value:function Text_saveExcursion_(doFn,opts){var _this175=this;opts=Object.assign({useAnchors:false},opts);var sels=this.selection.isMultiSelection?this.selection.selections.map(function(ea){return ea.directedRange;}):[this.selection];var anchors=opts.useAnchors?sels.map(function(_ref125){var start=_ref125.start,end=_ref125.end;return[_this175.addAnchor(Object.assign({},start,{id:"save-excursion-"+__varRecorder__$R.string.newUUID()})),_this175.addAnchor(Object.assign({},end,{id:"save-excursion-"+__varRecorder__$R.string.newUUID()}))];}):null;var isPromise=false;var cleanup=opts.useAnchors?function(){var sels=anchors.map(function(_ref126){var _ref127=_slicedToArray2(_ref126,2),start=_ref127[0].position,end=_ref127[1].position;return{start:start,end:end};});_this175.selections=sels;anchors.forEach(function(_ref128){var _ref129=_slicedToArray2(_ref128,2),a=_ref129[0],b=_ref129[1];_this175.removeAnchor(a);_this175.removeAnchor(b);});}:function(){return _this175.selections=sels;};try{var result=this.keepPosAtSameScrollOffsetWhile(doFn);isPromise=result&&result instanceof Promise;}finally{!isPromise&&cleanup();}if(isPromise)__varRecorder__$R.promise["finally"](result,cleanup);return result;}},{key:"alignRow",value:function Text_alignRow_(row){var how=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"center";if(!this.isClip())return;var scroll=this.scroll,padding=this.padding;var paddedBounds=this.innerBounds().insetByRect(padding).translatedBy(scroll);var charBounds=this.charBoundsFromTextPosition({row:row,column:0});var deltaY=how==="top"||how==="bottom"?paddedBounds[how]()-charBounds[how]():how==="center"?paddedBounds[how]().y-charBounds[how]().y:0;if(deltaY)this.scroll=this.scroll.addXY(0,-deltaY);}},{key:"fit",value:function Text_fit_(){var _this176=this;var viewState=this.viewState,fixedWidth=this.fixedWidth,fixedHeight=this.fixedHeight;viewState._needsFit=false;if(fixedHeight&&fixedWidth||!this.textLayout||this.master&&!this.master._appliedMaster)return this;var textBounds=this.textBounds().outsetByRect(this.padding);var resize=function resize(){if(!fixedHeight&&_this176.height!=textBounds.height)_this176.height=textBounds.height;if(!fixedWidth&&_this176.width!=textBounds.width)_this176.width=textBounds.width;_this176.embeddedMorphs.forEach(function(submorph){var a=_this176.embeddedMorphMap.get(submorph).anchor;a.position=a.position;});};viewState._needsFit=false;if(this.document.lines.find(function(l){return l.hasEstimatedExtent;})){this.whenRendered().then(resize);}else{resize();}return this;}},{key:"fitIfNeeded",value:function Text_fitIfNeeded_(){if(this.viewState._needsFit)this.fit();}},{key:"defaultLineHeight",get:function get(){var p=this.padding;return p.top()+p.bottom()+this.fontMetric.defaultLineHeight({fontSize:this.fontSize,fontFamily:this.fontFamily});}},{key:"columnInWrappedLine",value:function Text_columnInWrappedLine_(textPos){if(!this.lineWrapping)return textPos.column;var _this$screenLineRange=this.screenLineRange(textPos,true),fromColumn=_this$screenLineRange.start.column;return textPos.column-fromColumn;}},{key:"textPositionFromPoint",value:function Text_textPositionFromPoint_(point){return this.textLayout.textPositionFromPoint(this,point);}},{key:"charBoundsFromTextPosition",value:function Text_charBoundsFromTextPosition_(pos){return this.textLayout.boundsFor(this,pos);}},{key:"forceRerender",value:function Text_forceRerender_(){this.textLayout.reset();this.makeDirty();}},{key:"aboutToRender",value:function Text_aboutToRender_(renderer){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"aboutToRender",this).call(this,renderer);}},{key:"applyLayoutIfNeeded",value:function Text_applyLayoutIfNeeded_(){if(this._requestMasterStyling){this.master&&this.master.applyIfNeeded(true);this._requestMasterStyling=false;}this.fitIfNeeded();initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"applyLayoutIfNeeded",this).call(this);}},{key:"render",value:function Text_render_(renderer){return this.textRenderer.renderMorph(this,renderer);}},{key:"directRender",value:function Text_directRender_(){var renderer=this.env.renderer;var textRenderer=this.textRenderer;if(renderer&&textRenderer){if(renderer._stopped)return;__varRecorder__$R.renderSubTree(this,renderer);textRenderer.manuallyTriggerTextRenderHook(this,renderer);}}},{key:"onMouseDown",value:function Text_onMouseDown_(evt){if(evt.rightMouseButtonPressed())return;this.activeMark&&(this.activeMark=null);var position=evt.position,_evt$state3=evt.state,clickedOnMorph=_evt$state3.clickedOnMorph,clickedOnPosition=_evt$state3.clickedOnPosition,clickCount=_evt$state3.clickCount;if(clickedOnMorph!==this)return;var maxClicks=3;var normedClickCount=(clickCount-1)%maxClicks+1;var clickPos=this.localize(position);var clickTextPos=this.textPositionFromPoint(clickPos);if(evt.leftMouseButtonPressed()&&!evt.isShiftDown()&&!evt.isAltDown()&&this.callTextAttributeDoitFromMouseEvent(evt,clickPos));if(!this.selectable)return;if(evt.isShiftDown()){this.selection.lead=clickTextPos;}else if(evt.isAltDown()){this.selection.addRange(__varRecorder__$R.Range.at(clickTextPos));}else{this.selection.disableMultiSelect();if(normedClickCount===1){if(!evt.isShiftDown()){this.selection={start:clickTextPos,end:clickTextPos};}else this.selection.lead=clickTextPos;}else if(normedClickCount===2)this.execCommand("select word",null,1,evt);else if(normedClickCount===3)this.execCommand("select line",null,1,evt);}if(this.isFocused())this.ensureKeyInputHelperAtCursor();}},{key:"evalEnvForDoit",value:function Text_evalEnvForDoit_(doit){var moduleId="lively://text-doit/".concat(this.id);lively.modules.module(moduleId);return{context:doit.context||this,format:"esm",targetModule:moduleId};}},{key:"callTextAttributeDoitFromMouseEvent",value:function Text_callTextAttributeDoitFromMouseEvent_(evt,clickPos){var _this177=this;var attribute=this.textAttributeAtPoint(clickPos)||[];var doit=attribute&&attribute.doit;if(!doit||!doit.code)return false;var env=this.evalEnvForDoit(doit);var mod=lively.modules.module(env.targetModule);mod.recorder.evt=evt;lively.vm.runEval(doit.code,env)["catch"](function(err){return _this177.world().logError(new Error("Error in text doit: ".concat(err.stack)));}).then(function(){return mod.recorder.evt=null;});return true;}},{key:"onMouseMove",value:function Text_onMouseMove_(evt){if(!evt.leftMouseButtonPressed()||!this.selectable||evt.state.clickedOnMorph!==this){return;}this.selection.lead=this.textPositionFromPoint(this.localize(evt.position));}},{key:"selectMatchingBrackets",value:function Text_selectMatchingBrackets_(str,i1){var rightBrackets="*)}]>'\"`";var leftBrackets="*({[<'\"`";function isWhiteSpace(c){return c==="\t"||c===" ";}function isAlpha(s){var regEx=/^[a-zA-Z0-9\-]+$/;return(s||"").match(regEx);}function periodWithDigit(c,prev){if(c!=".")return false;return"0123456789".indexOf(prev)>=0;}function matchBrackets(str,chin,chout,start,dir){var i=start;var depth=1;while(dir<0?i-1>=0:i+1<str.length){i+=dir;if(str[i]==chin&&chin!=chout)depth++;if(str[i]==chout)depth--;if(depth==0)return i;}return i;}function findLine(str,start,dir,endChar){var i=start;while(dir<0?i-1>=0:i+1<str.length){i+=dir;if(str[i]==endChar)return dir>0?[start,i]:[i+1,start];}return dir>0?[start+1,str.length-1]:[0,start];}if(!str)return i1;if(i1==0||i1==str.length){return[0,str.length-1];}var i2=i1-1;if(i1>0){if(str[i1-1]=="\n"||str[i1-1]=="\r")return findLine(str,i1,1,str[i1-1]);var i=leftBrackets.indexOf(str[i1-1]);if(str[i1-1]=="*"&&(i1-2<0||str[i1-2]!="/"))i=-1;if(i>=0){var i2=matchBrackets(str,leftBrackets[i],rightBrackets[i],i1-1,1);return[i1,i2-1];}}if(i1<str.length){if(str[i1]=="\n"||str[i1]=="\r")return findLine(str,i1,-1,str[i1]);var i=rightBrackets.indexOf(str[i1]);if(str[i1]=="*"&&(i1+1>=str.length||str[i1+1]!="/"))i=-1;if(i>=0){i1=matchBrackets(str,rightBrackets[i],leftBrackets[i],i1,-1);return[i1+1,i2];}}if(str[i1-1]==="/"&&str[i1-2]==="/"){while(i2+1<str.length&&str[i2+1]!=="\n"&&str[i2+1]!=="\r"){i2++;}return[i1,i2];}var myI1=i1;var myI2=i2;while(myI1-1>=0&&isWhiteSpace(str[myI1-1])){myI1--;}while(myI2<str.length&&isWhiteSpace(str[myI2+1])){myI2++;}if(myI2-myI1>=1)return[myI1,myI2];var prev=i1<str.length?str[i1]:"";while(i1-1>=0&&(isAlpha(str[i1-1])||periodWithDigit(str[i1-1],prev))){prev=str[i1-1];i1--;}while(i2+1<str.length&&(isAlpha(str[i2+1])||periodWithDigit(str[i2+1],prev))){prev=str[i2+1];i2++;}return[i1,i2];}},{key:"onContextMenu",value:function Text_onContextMenu_(evt){var _this178=this;if(evt.targetMorph!==this)return;evt.stop();var posClicked=this.textPositionFromPoint(this.localize(evt.position));var sels=this.selection.selections||[this.selection];if(this.selection.isEmpty()||sels.every(function(sel){return!sel.range.containsPosition(posClicked);})){this.cursorPosition=posClicked;}Promise.resolve(this.menuItemsForContextMenu()).then(function(items){return _this178.openMenu(items,evt);})["catch"](function(err){return $world.logError(err);});}},{key:"onDrop",value:function Text_onDrop_(evt){var morphs=evt.hand.grabbedMorphs.filter(function(ea){return ea.isLayoutable;});initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onDrop",this).call(this,evt);if(morphs[0]){var textPos=this.textPositionFromPoint(this.localize(evt.hand.globalPosition));this.insertText([morphs[0],null],textPos);morphs[0].opacity=evt.state.originalOpacity||1;}}},{key:"buildDropHoverGrid",value:function Text_buildDropHoverGrid_(dropConfig){var _this179=this;if(dropConfig.simpleDrop)return null;var _this$whatsVisible=this.whatsVisible,startRow=_this$whatsVisible.startRow,endRow=_this$whatsVisible.endRow;var realEndRow=Math.min(this.documentEndPosition.row,endRow);var doc=this.document;var padLeft=this.padding.left();var padTop=this.padding.top();var grid=__varRecorder__$R.arr.range(startRow,realEndRow).reduce(function(bounds,row){var charBounds=_this179.textLayout.charBoundsOfRow(_this179,row).slice();if(charBounds.length>=1&&__varRecorder__$R.arr.last(charBounds).width==0){__varRecorder__$R.arr.last(charBounds).width=12;}if(charBounds.length>1){var _last3=__varRecorder__$R.arr.last(charBounds);charBounds.push({x:_last3.x+_last3.width,y:_last3.y,height:_last3.height,width:_last3.width||12});}var rowBounds=charBounds.map(function(ea,column){var bounds=__varRecorder__$R.Rectangle.fromLiteral(ea).translatedBy(__varRecorder__$R.pt(padLeft,padTop+doc.computeVerticalOffsetOf(row)));var globalBounds=_this179.getGlobalTransform().transformRectToRect(bounds);return{textPos:{row:row,column:column},bounds:bounds,globalBounds:globalBounds,morph:dropConfig.showDropGrid?__varRecorder__$R.morph({reactsToPointer:false,acceptsDrops:false,bounds:bounds,border:{width:1,color:__varRecorder__$R.Color.green},fill:null}):null};});return bounds.concat(rowBounds);},[]);grid.forEach(function(ea){return ea.morph&&_this179.addMorph(ea.morph);});return grid;}},{key:"onDropHoverIn",value:function Text_onDropHoverIn_(evt){var dropConfig={simpleDrop:window.hasOwnProperty("simpleDrop")?window.simpleDrop:true,showDropGrid:window.hasOwnProperty("showDropGrid")?window.showDropGrid:false,useTextFlowPlaceholder:window.hasOwnProperty("useTextFlowPlaceholder")?window.useTextFlowPlaceholder:false};var grabbed=evt.hand.grabbedMorphs[0];if(grabbed){evt.state.originalOpacity=grabbed.opacity;grabbed.opacity=0.3;}var dropGrid=this.buildDropHoverGrid(dropConfig);var dropHoverCache=evt.state.dropHover||(evt.state.dropHover=new WeakMap());var dropHoverState=dropHoverCache.get(this);if(!dropHoverState){dropHoverState={};dropHoverCache.set(this,dropHoverState);}dropHoverState.config=dropConfig;dropHoverState.dropGrid=dropGrid;}},{key:"onDropHoverUpdate",value:function Text_onDropHoverUpdate_(evt){var grabbed=evt.hand.grabbedMorphs[0];if(!grabbed)return;var dropHoverCache=evt.state.dropHover;if(!dropHoverCache)return;var dropHoverState=dropHoverCache.get(this);if(!dropHoverState)return;if(!dropHoverState.dropGrid){var textPos=this.textPositionFromPoint(evt.positionIn(this));this.focus();this.cursorPosition=textPos;return;}var config=dropHoverState.config;var pos=evt.positionIn(this);var dropAt;var minSpec;var minDist=Infinity;var _iterator86=_createForOfIteratorHelper(dropHoverState.dropGrid),_step86;try{for(_iterator86.s();!(_step86=_iterator86.n()).done;){var dropSpec=_step86.value;if(dropSpec.bounds.containsPoint(pos)){dropAt=dropSpec;break;}var dist=dropSpec.bounds.closestPointToPt(pos).dist(pos);if(dist<minDist){minDist=dist;minSpec=dropSpec;}}}catch(err){_iterator86.e(err);}finally{_iterator86.f();}if(!dropAt)dropAt=minSpec;if(!dropAt)return;var placeholder=dropHoverState.placeholder;if(!placeholder){dropHoverState.placeholder=placeholder=__varRecorder__$R.morph({fill:grabbed.fill,extent:grabbed.extent,reactsToPointer:false,acceptsDrops:false});}if(__varRecorder__$R.obj.equals(placeholder._textPos||{},dropAt.textPos))return;if(this!==placeholder.owner){this.addMorph(placeholder);}placeholder.position=dropAt.bounds.topLeft();if(config&&config.useTextFlowPlaceholder){placeholder.remove();placeholder._textPos=dropAt.textPos;this.insertText([placeholder,null],dropAt.textPos);}}},{key:"onDropHoverOut",value:function Text_onDropHoverOut_(evt){var grabbed=evt.hand.grabbedMorphs[0];if(grabbed){grabbed.opacity=evt.state.originalOpacity||1;}var dropHoverCache=evt.state.dropHover;if(!dropHoverCache)return;var dropHoverState=dropHoverCache.get(this);if(!dropHoverState)return;dropHoverCache["delete"](this);if(dropHoverState.dropGrid){dropHoverState.dropGrid.forEach(function(ea){return ea.morph&&ea.morph.remove();});dropHoverState.dropGrid=null;}if(dropHoverState.placeholder){dropHoverState.placeholder.remove();dropHoverState.placeholder=null;}}},{key:"menuItems",value:function(){var _Text_menuItems_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee147(){var _yield$Promise$all,_yield$Promise$all2,items1,items2;return regeneratorRuntime.wrap(function _callee147$(_context147){while(1){switch(_context147.prev=_context147.next){case 0:_context147.next=2;return Promise.all([initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"menuItems",this).call(this),this.menuItemsForContextMenu()]);case 2:_yield$Promise$all=_context147.sent;_yield$Promise$all2=_slicedToArray2(_yield$Promise$all,2);items1=_yield$Promise$all2[0];items2=_yield$Promise$all2[1];return _context147.abrupt("return",items1.concat({isDivider:true}).concat(items2));case 7:case"end":return _context147.stop();}}},_callee147,this);}));function Text_menuItems_(){return _Text_menuItems_.apply(this,arguments);}return Text_menuItems_;}()},{key:"menuItemsForContextMenu",value:function(){var _Text_menuItemsForContextMenu_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee148(){var _this180=this;var items,_iterator87,_step87,plugin;return regeneratorRuntime.wrap(function _callee148$(_context148){while(1){switch(_context148.prev=_context148.next){case 0:items=[{command:"text undo",alias:"undo",target:this,showKeyShortcuts:true},{command:"text redo",alias:"redo",target:this,showKeyShortcuts:true},{command:"manual clipboard copy",alias:"copy",target:this,showKeyShortcuts:this.keysForCommand("clipboard copy"),args:{collapseSelection:false,"delete":false}},{command:"manual clipboard paste",alias:"paste",target:this,showKeyShortcuts:this.keysForCommand("clipboard paste")},{command:"open text attribute controls",alias:"edit text attributes",target:this},{isDivider:true},{command:"toggle line wrapping",alias:(this.lineWrapping?"disable":"enable")+" line wrapping",target:this,showKeyShortcuts:true},["run command",function(){_this180.focus();_this180.world().execCommand("run command");}]];_iterator87=_createForOfIteratorHelper(this.plugins);_context148.prev=2;_iterator87.s();case 4:if((_step87=_iterator87.n()).done){_context148.next=12;break;}plugin=_step87.value;if(!(typeof plugin.getMenuItems==="function")){_context148.next=10;break;}_context148.next=9;return plugin.getMenuItems(items);case 9:items=_context148.sent;case 10:_context148.next=4;break;case 12:_context148.next=17;break;case 14:_context148.prev=14;_context148.t0=_context148["catch"](2);_iterator87.e(_context148.t0);case 17:_context148.prev=17;_iterator87.f();return _context148.finish(17);case 20:return _context148.abrupt("return",items);case 21:case"end":return _context148.stop();}}},_callee148,this,[[2,14,17,20]]);}));function Text_menuItemsForContextMenu_(){return _Text_menuItemsForContextMenu_.apply(this,arguments);}return Text_menuItemsForContextMenu_;}()},{key:"keybindings",get:function get(){var world=this.world();var userKeybindings=world&&world.getCurrentUser()&&world.getCurrentUser().config&&world.getCurrentUser().config.textKeyBindings||[];var keybindings=initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"keybindings",this).concat(userKeybindings).concat(__varRecorder__$R.config.text.defaultKeyBindings);return this.pluginCollect("getKeyBindings",keybindings);}},{key:"keybindings",set:function set(x){initializeClass._set(Object.getPrototypeOf(__lively_class__.prototype),"keybindings",x,this);}},{key:"keyhandlers",get:function get(){if(this._cachedKeyhandlers)return this._cachedKeyhandlers;var handlers=initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"keyhandlers",this).concat(this._keyhandlers||[]);handlers=this.pluginCollect("getKeyHandlers",handlers);return this._cachedKeyhandlers=handlers;}},{key:"snippets",get:function get(){return this.pluginCollect("getSnippets",[]);}},{key:"onHoverIn",value:function Text_onHoverIn_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onHoverIn",this).call(this,evt);this.scrollActive=true;this.makeDirty();}},{key:"onHoverOut",value:function Text_onHoverOut_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onHoverOut",this).call(this,evt);if(__varRecorder__$R.touchInputDevice)return;this.scrollActive=false;this.makeDirty();}},{key:"onKeyDown",value:function Text_onKeyDown_(evt){if(this.compositionRange||evt.targetMorph!=this)return;this.selection.cursorBlinkStart();__varRecorder__$R.KeyHandler.invokeKeyHandlers(this,evt,true);}},{key:"onTextInput",value:function Text_onTextInput_(evt){__varRecorder__$R.KeyHandler.invokeKeyHandlers(this,evt,false);}},{key:"onCompositionStart",value:function Text_onCompositionStart_(evt){this.insertTextAndSelect(evt.data);this.compositionRange=this.selection.range;}},{key:"onCompositionUpdate",value:function Text_onCompositionUpdate_(evt){this.selection.range=this.compositionRange;this.selection.text=[evt.data,{textDecoration:"underline"}];this.compositionRange=this.selection.range;}},{key:"onCompositionEnd",value:function Text_onCompositionEnd_(evt){this.selection.range=this.compositionRange;this.selection.text=evt.data;this.cursorPosition=this.compositionRange.end;this.compositionRange=null;}},{key:"onCut",value:function Text_onCut_(evt){if(this.rejectsInput()||!this.isFocused())return;if(__varRecorder__$R.config.emacs)return;this.onCopy(evt,!this.rejectsInput());}},{key:"onCopy",value:function Text_onCopy_(evt){var deleteCopiedText=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!this.isFocused())return;evt.stop();var sel=this.selection;{try{var textAndAttributes=this.textAndAttributesInRange(this.selection.range);var defaultTextStyle=this.defaultTextStyle;var copyMap={};for(var _i173=0;_i173<textAndAttributes.length;_i173=_i173+2){var content=textAndAttributes[_i173];if(!content.isMorph)continue;if(content.isDisplacementMorph){textAndAttributes[_i173]="";continue;}var snap=copyMap[_i173]=__varRecorder__$R.serializeMorph(textAndAttributes[_i173]);textAndAttributes[_i173]=__varRecorder__$R.deserializeMorph(snap,{reinitializeIds:true});}var html=__varRecorder__$R.extractHTMLFromTextMorph(this,textAndAttributes);evt.domEvt.clipboardData.setData("text/html",html);for(var _i174 in copyMap){textAndAttributes[_i174]=copyMap[_i174];}var data=JSON.stringify({textAndAttributes:textAndAttributes,defaultTextStyle:defaultTextStyle});evt.domEvt.clipboardData.setData("application/x-lively-text",data);}catch(err){$world.logError(err);}}evt.domEvt.clipboardData.setData("text/plain",sel.text);this.execCommand("manual clipboard copy",{collapseSelection:__varRecorder__$R.config.codeEditor.collapseSelection||false,"delete":deleteCopiedText,dontTryNativeClipboard:true});}},{key:"onPaste",value:function Text_onPaste_(evt){var _this181=this;if(this.rejectsInput())return;evt.stop();var lvData;var textData="";try{textData=evt.domEvt.clipboardData.getData("text");}catch(err){console.warn(err);}if(!this.editorPlugin){try{var raw=evt.domEvt.clipboardData.getData("application/x-lively-text");lvData=raw&&JSON.parse(raw);var attrs=lvData.textAndAttributes;for(var _i175=0;_i175<attrs.length;_i175=_i175+2){if(typeof attrs[_i175]==="string")continue;attrs[_i175]=__varRecorder__$R.deserializeMorph(attrs[_i175],{reinitializeIds:true});}}catch(err){console.warn(err);}}var sel=this.selection;var sels=sel.isMultiSelection?sel.selections:[sel];lvData&&this.undoManager.group();sels.forEach(function(sel){if(lvData)_this181.replace(sel.range,lvData.textAndAttributes,false,true,true);else sel.text=textData;_this181.saveMark(sel.start);sel.collapseToEnd();});lvData&&this.undoManager.group();}},{key:"onFocus",value:function Text_onFocus_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onFocus",this).call(this,evt);this.makeDirty();this.selection.cursorBlinkStart();if(this._originalShadow)return;var haloShadow=this.haloShadow||this.propertiesAndPropertySettings().properties.haloShadow.defaultValue;if(haloShadow&&!haloShadow.equals)haloShadow=new __varRecorder__$R.ShadowObject(haloShadow);if(haloShadow&&!haloShadow.equals(this.dropShadow))this._originalShadow=this.dropShadow;this.highlightWhenFocused&&this.animate({dropShadow:haloShadow,duration:200});}},{key:"onBlur",value:function Text_onBlur_(evt){this.makeDirty();this.selection.cursorBlinkStop();this.highlightWhenFocused&&this.animate({dropShadow:this._originalShadow||null,duration:200});this._originalShadow=null;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onBlur",this).call(this,evt);}},{key:"onScroll",value:function Text_onScroll_(evt){if(this.isFocused())this.ensureKeyInputHelperAtCursor();{var node=this.env.renderer.getNodeForMorph(this);if(node){var scrollTop=node.scrollTop,scrollLeft=node.scrollLeft;__varRecorder__$R.signal(this,"viewChanged",{prop:"scroll",value:__varRecorder__$R.pt(scrollLeft,scrollTop)});}}}},{key:"ensureKeyInputHelperAtCursor",value:function Text_ensureKeyInputHelperAtCursor_(){if(this.env.eventDispatcher.keyInputHelper){this.env.eventDispatcher.keyInputHelper.ensureBeingAtCursorOfText(this);}}},{key:"textPageHeight",value:function Text_textPageHeight_(){var height=this.height,padding=this.padding,borderWidthBottom=this.borderWidthBottom,borderWidthTop=this.borderWidthTop;return height-padding.top()-padding.bottom()-borderWidthBottom-borderWidthTop;}},{key:"scrollPageDown",value:function Text_scrollPageDown_(){this.scrollDown(this.textPageHeight());}},{key:"scrollPageUp",value:function Text_scrollPageUp_(){this.scrollUp(this.textPageHeight());}},{key:"pageUpOrDown",value:function Text_pageUpOrDown_(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{direction:"up",select:false};var direction=opts.direction,select=opts.select;var row=this.textLayout[direction==="down"?"lastFullVisibleLine":"firstFullVisibleLine"](this);var column=this.cursorPosition.column,padding=this.padding;if(!select)this.cursorPosition={row:row,column:column};else this.selection.lead={row:row,column:column};if(direction==="down"){this.alignRowAtTop(row,__varRecorder__$R.pt(0,-padding.top()-padding.bottom()));}else{this.alignRowAtBottom(row,__varRecorder__$R.pt(0,0));this.alignRowAtBottom(row,__varRecorder__$R.pt(0,padding.top()+padding.bottom()));}}},{key:"gotoDocumentStart",value:function Text_gotoDocumentStart_(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{select:false};this.selection.lead={row:0,column:0};if(!opts||!opts.select)this.selection.anchor=this.selection.lead;}},{key:"gotoDocumentEnd",value:function Text_gotoDocumentEnd_(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{select:false};this.selection.lead=this.documentEndPosition;if(!opts||!opts.select)this.selection.anchor=this.selection.lead;}},{key:"paragraphRangeAbove",value:function Text_paragraphRangeAbove_(row){var startLineIsEmpty=this.isLineEmpty(row);var rowInParagraph;if(startLineIsEmpty){for(var _i176=row-1;_i176>=0;_i176--){if(!this.isLineEmpty(_i176)){rowInParagraph=_i176;break;}}if(rowInParagraph===undefined)return{start:{row:row,column:0},end:{row:row,column:0}};}else rowInParagraph=row;return this.paragraphRange(rowInParagraph);}},{key:"paragraphRangeBelow",value:function Text_paragraphRangeBelow_(row){var startLineIsEmpty=this.isLineEmpty(row);var rowInParagraph;var endPos=this.documentEndPosition;if(startLineIsEmpty){for(var _i177=row+1;_i177<=endPos.row;_i177++){if(!this.isLineEmpty(_i177)){rowInParagraph=_i177;break;}}if(rowInParagraph===undefined)return{start:{row:row,column:0},end:{row:row,column:0}};}else rowInParagraph=row;return this.paragraphRange(rowInParagraph);}},{key:"paragraphRange",value:function Text_paragraphRange_(row){if(this.isLineEmpty(row))return{start:{row:row,column:0},end:{row:row,column:0}};var endPos=this.documentEndPosition;var pragraphEnd;for(var i=row+1;i<=endPos.row;i++){if(this.isLineEmpty(i)){pragraphEnd={row:i-1,column:this.getLine(i-1).length};break;}}if(!pragraphEnd)pragraphEnd=endPos;var start;for(var i=pragraphEnd.row-1;i>=0;i--){if(this.isLineEmpty(i)){start={row:i+1,column:0};break;}}if(!start)start={row:0,column:0};return{start:start,end:pragraphEnd};}},{key:"astNodeRange",value:function Text_astNodeRange_(node){return{start:this.document.indexToPosition(node.start),end:this.document.indexToPosition(node.end)};}},{key:"parseIntoLines",value:function Text_parseIntoLines_(text){return text.split("\n");}},{key:"computeTextRangeForChanges",value:function Text_computeTextRangeForChanges_(changes){var defaultRange=__varRecorder__$R.Range.at(this.cursorPosition);if(!changes.length)return defaultRange;var morph=this;var change=changes[0];var range=change.selector==="replace"?insertRange(change.args[1],change.args[0].start):defaultRange;for(var _i178=1;_i178<changes.length;_i178++){var _change=changes[_i178];range=_change.selector==="replace"?range.merge(insertRange(_change.args[1],_change.args[0].start)):range;}return range;function insertRange(textAndAttributes,pos){var text="";for(var _i179=0;_i179<textAndAttributes.length;_i179=_i179+2){text+=typeof textAndAttributes[_i179]==="string"?textAndAttributes[_i179]:__varRecorder__$R.objectReplacementChar;}var lines=morph.parseIntoLines(text);if(lines.length===1){return __varRecorder__$R.Range.fromPositions(pos,{row:pos.row,column:pos.column+lines[0].length});}if(lines.length>1){return __varRecorder__$R.Range.fromPositions(pos,{row:pos.row+lines.length-1,column:__varRecorder__$R.arr.last(lines).length});}return __varRecorder__$R.Range.at(pos);}}},{key:"ensureUndoManager",value:function Text_ensureUndoManager_(){if(this.undoManager)return this.undoManager;var selectors=["addTextAttribute","removeTextAttribute","setStyleInRange","replace"];return this.undoManager=new __varRecorder__$R.UndoManager(function(change){return selectors.includes(change.selector);});}},{key:"textUndo",value:function Text_textUndo_(){var undo=this.undoManager.undo();if(!undo)return;var changes=undo.changes.slice().reverse().map(function(ea){return ea.undo;});this.selection=this.computeTextRangeForChanges(changes);}},{key:"textRedo",value:function Text_textRedo_(){var redo=this.undoManager.redo();if(!redo)return;var changes=redo.changes.slice();this.selection=this.computeTextRangeForChanges(changes);}},{key:"findMatchingForward",value:function Text_findMatchingForward_(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"right";var pairs=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var openChar=this[side==="right"?"charRight":"charLeft"](pos);var closeChar=pairs[openChar];if(!closeChar)return null;var counter=side==="right"?-1:0;return this.document.scanForward(pos,function(_char7,pos){if(_char7===closeChar){if(counter===0){return side==="right"?{row:pos.row,column:pos.column+1}:pos;}else counter--;}else if(_char7===openChar)counter++;return null;});}},{key:"findMatchingBackward",value:function Text_findMatchingBackward_(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"right";var pairs=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var openChar=this[side==="right"?"charRight":"charLeft"](pos);var closeChar=pairs[openChar];if(!closeChar)return null;var counter=side==="left"?-1:0;return this.document.scanBackward(pos,function(_char8,pos){if(_char8===closeChar){if(counter===0){return side==="right"?{row:pos.row,column:pos.column+1}:pos;}else counter--;}else if(_char8===openChar)counter++;return null;});}},{key:"search",value:function Text_search_(needle){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{start:this.cursorPosition,backwards:false,caseSensitive:false};return new __varRecorder__$R.TextSearcher(this).search(Object.assign({needle:needle},options));}},{key:"searchForAll",value:function Text_searchForAll_(needle){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{caseSensitive:false};return new __varRecorder__$R.TextSearcher(this).searchForAll(Object.assign({needle:needle},options));}},{key:"tokenAt",value:function Text_tokenAt_(pos){return this.pluginInvokeFirst("tokenAt",pos);}},{key:"astAt",value:function Text_astAt_(pos){return this.pluginInvokeFirst("astAt",pos);}},{key:"evalEnvironment",get:function get(){var p=this.editorPlugin;return p&&p.evalEnvironment;}},{key:"evalEnvironment",set:function set(env){var p=this.editorPlugin;p&&(p.evalEnvironment=env);}},{key:"doitContext",get:function get(){var _ref130=this.evalEnvironment||{},context=_ref130.context;return context;}},{key:"doitContext",set:function set(c){(this.evalEnvironment||{}).context=c;}},{key:"logDoit",value:function Text_logDoit_(source){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _opts$time=opts.time,time=_opts$time===void 0?Date.now():_opts$time;var maxLogLength=50;var maxCodeLength=120000;var log;if(source.length>maxCodeLength)return;try{log=JSON.parse(localStorage["lively.next-js-ide-doitlog"]);}catch(err){}if(!log)log=[];if(log.some(function(ea){return typeof ea==="string"?ea===source:ea.source===source;}))return;log.push({source:source,time:time});if(log.length>maxLogLength)log=log.slice(-maxLogLength);try{localStorage["lively.next-js-ide-doitlog"]=JSON.stringify(log);}catch(err){}}},{key:"doEval",value:function Text_doEval_(){var range=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.selection.isEmpty()?this.lineRange():this.selection.range;var additionalOpts=arguments.length>1?arguments[1]:undefined;var code=arguments.length>2&&arguments[2]!==undefined?arguments[2]:this.textInRange(range);var plugin=this.pluginFind(function(p){return p.isEditorPlugin&&typeof p.runEval==="function";});if(!plugin){throw new Error("doit not possible: cannot find js editor plugin of !".concat(this));}if(additionalOpts&&additionalOpts.logDoit){this.logDoit(code,additionalOpts);}return plugin.runEval(code,additionalOpts);}},{key:"maybeSelectCommentOrLine",value:function Text_maybeSelectCommentOrLine_(){var sel=this.selection;var _sel$lead2=sel.lead,row=_sel$lead2.row,column=_sel$lead2.column;var text=this.selectionOrLineString();if(!sel.isEmpty())return;var idx=text.indexOf("//");if(idx===-1||column<idx||idx>0&&(":\""+"'").indexOf(text[idx-1])>=0){this.selectLine(row);return;}sel.range={start:{row:row,column:idx+2},end:{row:row,column:text.length}};}},{key:"debugHelper",value:function Text_debugHelper_(opts){opts=Object.assign({debugDocumentUpdate:true,debugTextLayout:true},opts);if(this._debugHelper)return Object.assign(this._debugHelper,opts);return this._debugHelper=Object.assign({},opts,{logged:[],groups:[],reset:function reset(){this.groups=[[]];this.logged=this.groups[0];},log:function log(){var _console2;for(var _len6=arguments.length,args=new Array(_len6),_key15=0;_key15<_len6;_key15++){args[_key15]=arguments[_key15];}(_console2=console).log.apply(_console2,args);this.logged.push({args:args});},dump:function dump(_dump){console.log(_dump.split("\n").map(function(ea){return ea.slice(0,100);}).join("\n"));this.logged.push({dump:_dump});},group:function group(title){this.groups.push([]);this.logged=__varRecorder__$R.arr.last(this.groups);console.group(title);},groupEnd:function groupEnd(title){console.groupEnd(title);},steps:function steps(logged){var steps=[];while(logged.length){var actions=__varRecorder__$R.arr.takeWhile(logged,function(ea){return!ea.dump;});logged=logged.slice(actions.length);var _ref131=logged.shift()||{},dump=_ref131.dump;steps.push({actions:actions,dump:dump});}return steps;},printToConsole:function printToConsole(){var _this182=this;console.clear();this.groups.forEach(function(group){var steps=_this182.steps(group);console.group(steps.length);_this182.steps(group).forEach(function(_ref132,i){var actions=_ref132.actions;console.group("step ".concat(i+1));actions.forEach(function(_ref133){var _console3;var args=_ref133.args;return(_console3=console).log.apply(_console3,_toConsumableArray2(args));});console.groupEnd("step ".concat(i+1));});console.groupEnd(steps.length);});},report:function report(){var _this183=this;return _asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee149(){var jsDiff,_yield$System$import10,DiffEditorPlugin,indent,report,reportStyles,row;return regeneratorRuntime.wrap(function _callee149$(_context149){while(1){switch(_context149.prev=_context149.next){case 0:_context149.next=2;return System["import"]("jsdiff",System.decanonicalize("lively.morphic"));case 2:jsDiff=_context149.sent;_context149.next=5;return System["import"]("lively.ide/diff/editor-plugin.js");case 5:_yield$System$import10=_context149.sent;DiffEditorPlugin=_yield$System$import10["default"];indent=0;report="";reportStyles=[];row=0;_this183.groups.forEach(function(group,groupN){report+=">>> group ".concat(groupN+1,"\n");row++;indent++;var steps=_this183.steps(group);steps.forEach(function(_ref134,i){var actions=_ref134.actions,dump=_ref134.dump;report+=__varRecorder__$R.string.indent(">>> step ".concat(i+1)," ",indent)+"\n";row++;indent++;actions.forEach(function(_ref135){var args=_ref135.args;var content=__varRecorder__$R.string.indent(__varRecorder__$R.string.formatFromArray(args.slice()).trim()," ",indent);row+=content.split("\n").length;report+=content+"\n";});if(i>=1&&dump&&steps[i-1].dump){var _p15=new DiffEditorPlugin();var _patch3=jsDiff.createPatch(String(i),steps[i-1].dump,dump);_p15.tokenize(_patch3);reportStyles.push.apply(reportStyles,_toConsumableArray2(_p15.styledRanges(row,indent)));report+=_patch3;row+=_patch3.split("\n").length-1;}report+=__varRecorder__$R.string.indent("<< step ".concat(i+1)," ",indent)+"\n";row++;indent--;});report+="<<< group ".concat(groupN+1,"\n");row++;indent--;});return _context149.abrupt("return",{report:report,reportStyles:reportStyles});case 13:case"end":return _context149.stop();}}},_callee149);}))();},openReport:function openReport(){var _this184=this;return _asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee150(){var _yield$_this184$repor,reportStyles,report;return regeneratorRuntime.wrap(function _callee150$(_context150){while(1){switch(_context150.prev=_context150.next){case 0:_context150.next=2;return _this184.report();case 2:_yield$_this184$repor=_context150.sent;reportStyles=_yield$_this184$repor.reportStyles;report=_yield$_this184$repor.report;return _context150.abrupt("return",$world.execCommand("open text window",{title:"text debug",fontFamily:"monospace",content:report,rangesAndStyles:reportStyles}));case 6:case"end":return _context150.stop();}}},_callee150);}))();}});}},{key:"consistencyCheck",value:function Text_consistencyCheck_(){if(this.debug)return this.document.consistencyCheck();try{return this.document.consistencyCheck();}catch(err){var brokenDocument=this.document;if(!this.brokenDocument)this.brokenDocument=brokenDocument;var world=this.world()||$world;try{var fixedDoc=new __varRecorder__$R.Document([]);fixedDoc.textAndAttributes=brokenDocument.textAndAttributes;this.changeDocument(fixedDoc);}catch(err){var msg="Broken document could not be fixed";world?world.logError(msg):console.error(msg);}world?world.logError(err):console.error(err);}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Text";}},{key:"makeLabel",value:function Text_makeLabel_(value,props){return new __varRecorder__$R.morph(Object.assign({type:"label",value:value,fontFamily:"IBM Plex, Helvetica Neue, Arial, sans-serif",fontColor:__varRecorder__$R.Color.almostBlack,fontSize:11},props));}},{key:"makeInputLine",value:function Text_makeInputLine_(props){var InputLine=System.get(System.decanonicalize("lively.morphic")).InputLine;return new InputLine(props);}},{key:"defaultTextStyle",get:function get(){if(this._defaultTextStyle)return this._defaultTextStyle;var _this$prototype$prope=this.prototype.propertiesAndPropertySettings(),properties=_this$prototype$prope.properties;var propNames=this.defaultTextStyleProps;var style={};for(var _i180=0;_i180<propNames.length;_i180++){var name=propNames[_i180];style[name]=properties[name].defaultValue;}return this._defaultTextStyle=style;}},{key:"defaultTextStyleProps",get:function get(){if(this._defaultTextStyleProps)return this._defaultTextStyleProps;var _this$prototype$prope2=this.prototype.propertiesAndPropertySettings(),properties=_this$prototype$prope2.properties;var styleProps=[];for(var prop in properties){if(properties[prop].isDefaultTextStyleProp)styleProps.push(prop);}return this._defaultTextStyleProps=styleProps;}},{key:"properties",get:function get(){return{clipMode:{isStyleProp:true,defaultValue:"visible",set:function set(value){this.setProperty("clipMode",value);this.fixedWidth=this.fixedHeight=this.isClip();}},fontMetric:{group:"_rendering",serialize:false,get:function get(){return this.getProperty("fontMetric")||this.env.fontMetric;}},undoManager:{group:"core",before:["document"],initialize:function initialize(){this.ensureUndoManager();}},textRenderer:{group:"_rendering",after:["viewState"],initialize:function initialize(){this.textRenderer=new __varRecorder__$R.Renderer(this.env.domEnv);}},debug:{group:"_debugging",isStyleProp:true,after:["textRenderer","textLayout"],defaultValue:false,doc:"For visualizing and debugging text layout and rendering"},defaultViewState:{group:"_rendering",derived:true,readOnly:true,get:function get(){return{_needsFit:true,text_layer_node:null,fontmetric_text_layer_node:null,dom_nodes:[],dom_nodeFirstRow:[],scrollTop:0,scrollHeight:0,scrollBottom:0,textHeight:0,textWidth:0,firstVisibleRow:0,lastVisibleRow:0,heightBefore:0,wasScrolled:false,afterTextRenderHook:null,fastScroll:true};}},viewState:{group:"_rendering",initialize:function initialize(){this.viewState=this.defaultViewState;}},displacingMorphMap:{group:"_rendering",initialize:function initialize(){this.displacingMorphMap=new Map();}},embeddedMorphMap:{group:"_rendering",initialize:function initialize(){this.embeddedMorphMap=new Map();}},embeddedMorphs:{group:"text",derived:true,readOnly:true,after:["embeddedMorphMap"],get:function get(){return this.embeddedMorphMap?Array.from(this.embeddedMorphMap.keys()):[];}},textLayout:{group:"_rendering",after:["textRenderer"],initialize:function initialize(){this.textLayout=new __varRecorder__$R.TextLayout(this);}},document:{group:"text",initialize:function initialize(){this.document=__varRecorder__$R.Document.fromString("",{maxLeafSize:50,minLeafSize:25,maxNodeSize:35,minNodeSize:7});this.consistencyCheck();}},draggable:{defaultValue:false},useSoftTabs:{group:"text",isStyleProp:true,defaultValue:__varRecorder__$R.config.text.useSoftTabs!==undefined?__varRecorder__$R.config.text.useSoftTabs:true},tabWidth:{group:"text",isStyleProp:true,defaultValue:__varRecorder__$R.config.text.tabWidth||2},tab:{group:"text",after:["useSoftTabs","tabWidth"],readOnly:true,derived:true,get:function get(){return this.useSoftTabs?" ".repeat(this.tabWidth):"\t";}},autoInsertPairs:{group:"text",defaultValue:true},extent:{get:function get(){var _this185=this;var initialExtent=this.getProperty("extent");if(!this._textChange&&this.viewState&&this.viewState._needsFit&&!this._rendering&&!this._measuringTextBox&&!!initialExtent&&this.owner){this._measuringTextBox=true;__varRecorder__$R.noUpdate(function(){_this185.directRender();});this._measuringTextBox=false;}return this.getProperty("extent");}},fixedWidth:{group:"text",isStyleProp:true,after:["clipMode","viewState"],defaultValue:false},fixedHeight:{group:"text",isStyleProp:true,after:["clipMode","viewState"],defaultValue:false},readOnly:{group:"text",isStyleProp:true,defaultValue:false,set:function set(value){this.nativeCursor=value?"default":"auto";this.setProperty("readOnly",value);}},selectable:{group:"selection",isStyleProp:true,after:["selection"],defaultValue:true,set:function set(value){this.setProperty("selectable",value);if(!value)this.selection.collapse();}},padding:{group:"styling",type:"Rectangle",isStyleProp:true,after:["textLayout","viewState"],defaultValue:__varRecorder__$R.Rectangle.inset(0),set:function set(value){this.setProperty("padding",typeof value==="number"?__varRecorder__$R.Rectangle.inset(value):value);}},haloShadow:{group:"styling",type:"Shadow",isStyleProp:true,defaultValue:null},highlightWhenFocused:{group:"styling",defaultValue:false,after:["haloShadow"],set:function set(val){this.setProperty("highlightWhenFocused",val);if(val&&!this.haloShadow){this.haloShadow={blur:6,color:__varRecorder__$R.Color.rgb(52,152,219),distance:0,rotation:45};}}},cursorPosition:{group:"selection",derived:true,after:["selection"],get:function get(){return this.selection.lead;},set:function set(p){this.selection.range={start:p,end:p};}},selection:{group:"selection",derived:true,after:["document","anchors"],get:function get(){var sel=this.getProperty("selection");if(sel)return sel;sel=new(__varRecorder__$R.config.text.useMultiSelect?__varRecorder__$R.MultiSelection:__varRecorder__$R.Selection)(this);this.setProperty("selection",sel);return sel;},set:function set(selOrRange){if(this._isDeserializing&&this._initializedByCachedBounds){this.textLayout.restore(this._initializedByCachedBounds,this);}if(!selOrRange){if(this.selection.isMultiSelection){this.selection.disableMultiSelect();}this.selection.collapse();}else if(selOrRange.isSelection)this.setProperty("selection",selOrRange);else this.selection.range=selOrRange;}},selections:{group:"selection",derived:true,after:["selection"],get:function get(){return this.selection.isMultiSelection?this.selection.selections:[this.selection];},set:function set(sels){var _this186=this;this.selection=sels[0];if(!this.selection.isMultiSelection)return;sels.slice(1).forEach(function(ea){return _this186.selection.addRange(ea);});}},textString:{group:"text",after:["document"],derived:true,get:function get(){return this.document?this.document.textString:"";},set:function set(value){value=value!=null?String(value):"";if(this._isDeserializing&&this._initializedByCachedBounds){this.textLayout.restore(this._initializedByCachedBounds,this);}this.deleteText({start:{column:0,row:0},end:this.document.endPosition});this.insertText(value,{column:0,row:0});}},value:{group:"text",after:["document","embeddedMorphMap"],derived:true,get:function get(){var textAndAttributes=this.textAndAttributes;if(textAndAttributes.length===1){var _textAndAttributes$=_slicedToArray2(textAndAttributes[0],2),text=_textAndAttributes$[0],style=_textAndAttributes$[1];if(!Object.keys(style||{}).length)return text;}return textAndAttributes;},set:function set(value){typeof value==="string"?this.textString=value:this.textAndAttributes=value;}},textAndAttributes:{group:"text",derived:true,after:["document"],get:function get(){return this.document.textAndAttributes;},set:function set(textAndAttributes){if(this._isDeserializing&&this._initializedByCachedBounds){this.textLayout.restore(this._initializedByCachedBounds,this);}this.replace({start:{row:0,column:0},end:this.documentEndPosition},textAndAttributes);}},defaultTextStyleProps:{group:"_internal",readOnly:true,derived:true,get:function get(){return this.constructor.defaultTextStyleProps;}},defaultTextStyle:{group:"styling",after:["viewState"],derived:true,get:function get(){return __varRecorder__$R.obj.select(this,this.defaultTextStyleProps);},set:function set(style){Object.assign(this,style);}},customizedTextStyle:{group:"styling",readOnly:true,derived:true,get:function get(){var style={};var props=this.defaultTextStyleProps;var defaultStyle=this.constructor.defaultTextStyle;for(var _i181=0;_i181<props.length;_i181++){var name=props[_i181];var val=this[name];if(val!==defaultStyle[name])style[name]=val;}return style;}},nativeCursor:{defaultValue:"",isDefaultTextStyleProp:true},fontFamily:{group:"text styling",type:"Enum",values:__varRecorder__$R.config.text.basicFontItems,defaultValue:"IBM Plex Sans, Sans-Serif",isStyleProp:true,isDefaultTextStyleProp:true,after:["defaultTextStyle"]},fontSize:{group:"text styling",type:"Number",min:1,unit:"pt",defaultValue:12,isStyleProp:true,isDefaultTextStyleProp:true,after:["defaultTextStyle"]},selectionColor:{group:"text styling",type:"Color",defaultValue:__varRecorder__$R.Color.rgba(212,230,241,0.8),isStyleProp:true,after:["defaultTextStyle"]},cursorColor:{group:"text styling",type:"Color",isStyleProp:true,after:["defaultTextStyle"],defaultValue:__varRecorder__$R.Color.black},fontColor:{group:"text styling",type:"Color",defaultValue:__varRecorder__$R.Color.black,isStyleProp:true,isDefaultTextStyleProp:true,after:["defaultTextStyle"]},fontWeight:{group:"text styling",type:"Enum",values:["bold","bolder","light","lighter","normal"],defaultValue:"normal",isStyleProp:true,isDefaultTextStyleProp:true,after:["defaultTextStyle"]},fontStyle:{group:"text styling",type:"Enum",values:["normal","italic","oblique"],defaultValue:"normal",isStyleProp:true,isDefaultTextStyleProp:true,after:["defaultTextStyle"]},textDecoration:{group:"text styling",type:"Enum",values:["none","underline"],defaultValue:"none",isStyleProp:true,isDefaultTextStyleProp:true,after:["defaultTextStyle"]},textStyleClasses:{group:"text styling",isStyleProp:true,isDefaultTextStyleProp:true,after:["defaultTextStyle"]},backgroundColor:{group:"text styling",type:"Color",isStyleProp:true,isDefaultTextStyleProp:true,after:["defaultTextStyle"]},textAlign:{group:"text styling",type:"Enum",values:["center","justify","left","right"],isStyleProp:true,isDefaultTextStyleProp:true,after:["document","defaultTextStyle","viewState"]},lineHeight:{group:"text styling",type:"Number",min:1,isFloat:true,isStyleProp:true,isDefaultTextStyleProp:true,defaultValue:1.4,after:["document","defaultTextStyle","viewState"]},letterSpacing:{group:"text styling",isStyleProp:true,isDefaultTextStyleProp:true,after:["document","defaultTextStyle","viewState"]},wordSpacing:{group:"text styling",isStyleProp:true,isDefaultTextStyleProp:true,after:["document","defaultTextStyle","viewState"]},lineWrapping:{group:"text",type:"Enum",values:[false,true,"by-words","anywhere","only-by-words","wider","by-chars"],isStyleProp:true,defaultValue:false,after:["document","viewState"]},anchors:{group:"core",defaultValue:[],set:function set(anchors){var _this187=this;var newAnchors=__varRecorder__$R.arr.withoutAll(anchors,this.anchors);var toRemove=__varRecorder__$R.arr.withoutAll(this.anchors,anchors);toRemove.forEach(function(ea){return _this187.removeAnchor(ea);});newAnchors.forEach(function(ea){return _this187.addAnchor(ea);});}},markers:{group:"core",defaultValue:[]},savedMarks:{group:"core",defaultValue:[],after:["anchors"],set:function set(val){var _this188=this;var savedMarks=this.savedMarks;val=val.map(function(ea){return ea.isAnchor?ea:_this188.addAnchor(Object.assign({},ea,{id:"saved-mark-"+__varRecorder__$R.string.newUUID()}));});var toRemove=this.savedMarks.filter(function(ea){return!val.includes(ea);});if(val>__varRecorder__$R.config.text.markStackSize){toRemove.push.apply(toRemove,_toConsumableArray2(val.splice(0,val.length-__varRecorder__$R.config.text.markStackSize)));}toRemove.map(function(ea){return _this188.removeAnchor(ea);});return this.setProperty("savedMarks",val);}},activeMarkPosition:{group:"_internal",after:["activeMark"],derived:true,get:function get(){var m=this.activeMark;return m?m.position:null;}},activeMark:{group:"core",after:["anchors"],set:function set(val){if(val){val=this.addAnchor(val.isAnchor?val:Object.assign({},val,{id:"saved-mark-"+__varRecorder__$R.string.newUUID()}));}else{var _m16=this.activeMark;if(!this.savedMarks.includes(_m16))this.removeAnchor(_m16);}this.setProperty("activeMark",val);}},plugins:{group:"plugins",defaultValue:[],after:["value"],set:function set(plugins){var _this189=this;var prevPlugins=this.getProperty("plugins");var removed=__varRecorder__$R.arr.withoutAll(prevPlugins,plugins);removed.forEach(function(p){return p&&_this189.removePlugin(p);});plugins.forEach(function(p){return p&&_this189.addPlugin(p);});}},editorModeName:{group:"plugins",derived:true,after:["plugins"],get:function get(){var p=this.editorPlugin;return p?p.shortName:null;},set:function set(nameOrMode){this.changeEditorMode(nameOrMode);}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:1305,end:113370});}(__varRecorder__$R.Morph);__varRecorder__$R.Text=Text;__varRecorder__$R.Text=Text;__varRecorder__$R.Text=Text;var __captured3__=/*#__PURE__*/Object.freeze({__proto__:null,Text:Text});var __varRecorder__$S=lively.FreezerRuntime.recorderFor("lively.morphic/text/label.js");__varRecorder__$S.obj=obj;__varRecorder__$S.promise=promise;__varRecorder__$S.arr=arr;__varRecorder__$S.string=string;__varRecorder__$S.properties=properties;__varRecorder__$S.Rectangle=Rectangle;__varRecorder__$S.Color=Color$1;__varRecorder__$S.signal=signal;__varRecorder__$S.vdom=exports$1$h;__varRecorder__$S.Morph=Morph;__varRecorder__$S.config=config;__varRecorder__$S.defaultStyle=defaultStyle;__varRecorder__$S.defaultAttributes=defaultAttributes;__varRecorder__$S.Icon=Icon;__varRecorder__$S.Icons=Icons;__varRecorder__$S.splitTextAndAttributesIntoLines=splitTextAndAttributesIntoLines;var destructured_1$4=__varRecorder__$S.vdom;__varRecorder__$S.h=destructured_1$4.h;var Label=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/label.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Label")&&typeof __lively_classholder__.Label==="function"?__lively_classholder__.Label:__lively_classholder__.Label=function Label(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Label_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var fontMetric=props.fontMetric,position=props.position,rightCenter=props.rightCenter,leftCenter=props.leftCenter,topCenter=props.topCenter,bottom=props.bottom,top=props.top,right=props.right,left=props.left,bottomCenter=props.bottomCenter,bottomLeft=props.bottomLeft,bottomRight=props.bottomRight,topRight=props.topRight,topLeft=props.topLeft,center=props.center,extent=props.extent;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,__varRecorder__$S.obj.dissoc(props,["fontMetric"]));if(fontMetric){this._fontMetric=fontMetric;}this._cachedTextBounds=null;this.fit();if(extent!==undefined)this.extent=extent;if(position!==undefined)this.position=position;if(rightCenter!==undefined)this.rightCenter=rightCenter;if(leftCenter!==undefined)this.leftCenter=leftCenter;if(topCenter!==undefined)this.topCenter=topCenter;if(bottom!==undefined)this.bottom=bottom;if(top!==undefined)this.top=top;if(right!==undefined)this.right=right;if(left!==undefined)this.left=left;if(bottomCenter!==undefined)this.bottomCenter=bottomCenter;if(bottomLeft!==undefined)this.bottomLeft=bottomLeft;if(bottomRight!==undefined)this.bottomRight=bottomRight;if(topRight!==undefined)this.topRight=topRight;if(topLeft!==undefined)this.topLeft=topLeft;if(center!==undefined)this.center=center;}},{key:"__additionally_serialize__",value:function Label___additionally_serialize___(snapshot,objRef,pool,addFn){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__additionally_serialize__",this).call(this,snapshot,objRef,pool,addFn);this.fit();snapshot._cachedTextBounds=this._cachedTextBounds&&this._cachedTextBounds.toTuple();}},{key:"__after_deserialize__",value:function Label___after_deserialize___(snapshot,objRef,pool){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__after_deserialize__",this).call(this,snapshot,objRef,pool);if(snapshot._cachedTextBounds){this.changeMetaData("deserializeInfo",{recoveredTextBounds:true});this._cachedTextBounds=__varRecorder__$S.Rectangle.fromTuple(snapshot._cachedTextBounds);}}},{key:"isLabel",get:function get(){return true;}},{key:"textStyle",get:function get(){return __varRecorder__$S.obj.select(this,["textStyleClasses","textDecoration","fontStyle","fontWeight","textShadow","fontColor","fontSize","fontFamily"]);}},{key:"fit",value:function Label_fit_(){this.extent=this.textBounds().extent();if(!this.visible){this._cachedTextBounds=null;}else this._needsFit=false;return this;}},{key:"fitIfNeeded",value:function Label_fitIfNeeded_(){if(this._needsFit&&this.allFontsLoaded()){this.fit();}}},{key:"textAndAttributesOfLines",get:function get(){return __varRecorder__$S.splitTextAndAttributesIntoLines(this.textAndAttributes,"\n");}},{key:"allFontsLoaded",value:function Label_allFontsLoaded_(){var _this190=this;var fontMetric=this.env.fontMetric;return[this].concat(_toConsumableArray2(this.textAndAttributes.map(function(attr,i){if(i%2){return{fontFamily:attr&&attr.fontFamily||_this190.fontFamily,fontWeight:attr&&attr.fontWeight||_this190.fontWeight};}}).filter(Boolean))).every(function(attr){return fontMetric.isFontSupported(attr.fontFamily,attr.fontWeight);});}},{key:"whenFontLoaded",value:function(){var _Label_whenFontLoaded_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee151(){var _this191=this;return regeneratorRuntime.wrap(function _callee151$(_context151){while(1){switch(_context151.prev=_context151.next){case 0:return _context151.abrupt("return",__varRecorder__$S.promise.waitFor(5000,function(){return _this191.allFontsLoaded();}));case 1:case"end":return _context151.stop();}}},_callee151);}));function Label_whenFontLoaded_(){return _Label_whenFontLoaded_.apply(this,arguments);}return Label_whenFontLoaded_;}()},{key:"textBoundsSingleChunk",value:function Label_textBoundsSingleChunk_(){var fm=this._fontMetric||this.env.fontMetric;var _this$textAndAttribut=_slicedToArray2(this.textAndAttributes,2),text=_this$textAndAttribut[0],chunkStyle=_this$textAndAttribut[1];var style=Object.assign({},this.textStyle,{},chunkStyle);var padding=this.padding;var width;var height;if(!fm.isProportional(style.fontFamily)){var _fm$sizeFor=fm.sizeFor(style,"x"),charWidth=_fm$sizeFor.width,charHeight=_fm$sizeFor.height;width=text.length*charWidth;height=charHeight;}else{var _fm$sizeFor2=fm.sizeFor(style,text);width=_fm$sizeFor2.width;height=_fm$sizeFor2.height;}return new __varRecorder__$S.Rectangle(0,0,Math.ceil(padding.left()+padding.right()+width),Math.ceil(padding.top()+padding.bottom()+height));}},{key:"textBoundsAllChunks",value:function Label_textBoundsAllChunks_(){var fm=this._fontMetric||this.env.fontMetric;var padding=this.padding;var defaultStyle=this.textStyle;var lines=this.textAndAttributesOfLines;var defaultIsMonospaced=!fm.isProportional(defaultStyle.fontFamily);var _fm$sizeFor3=fm.sizeFor(defaultStyle,"x"),defaultHeight=_fm$sizeFor3.height;var height=0;var width=0;for(var _i182=0;_i182<lines.length;_i182++){var textAndAttributes=lines[_i182];if(!textAndAttributes.length){height+=defaultHeight;continue;}var lineHeight=0;var lineWidth=0;for(var _j21=0;_j21<textAndAttributes.length;_j21=_j21+2){var text=textAndAttributes[_j21];var style=textAndAttributes[_j21+1]||{};var mergedStyle=Object.assign({},defaultStyle,{},style);var isMonospaced=defaultIsMonospaced&&!style.fontFamily||!fm.isProportional(mergedStyle.fontFamily);if(isMonospaced){var fontId=mergedStyle.fontFamily+"-"+mergedStyle.fontSize;var _fm$sizeFor4=fm.sizeFor(mergedStyle,"x"),charWidth=_fm$sizeFor4.width,charHeight=_fm$sizeFor4.height;lineWidth+=text.length*charWidth;lineHeight=Math.max(lineHeight,charHeight);}else{var _fm$sizeFor5=fm.sizeFor(mergedStyle,text),textWidth=_fm$sizeFor5.width,textHeight=_fm$sizeFor5.height;lineWidth+=textWidth;if(mergedStyle.paddingRight)lineWidth+=Number.parseInt(mergedStyle.paddingRight);if(mergedStyle.paddingLeft)lineWidth+=Number.parseInt(mergedStyle.paddingLeft);lineHeight=Math.max(lineHeight,textHeight);}}height+=lineHeight;width=Math.max(width,lineWidth);}return new __varRecorder__$S.Rectangle(0,0,Math.ceil(padding.left()+padding.right()+width),Math.ceil(padding.top()+padding.bottom()+height));}},{key:"invalidateTextLayout",value:function Label_invalidateTextLayout_(){this._cachedTextBounds=null;if(this.autofit)this._needsFit=true;this.makeDirty();}},{key:"textBounds",value:function Label_textBounds_(){var textAndAttributes=this.textAndAttributes,_cachedTextBounds=this._cachedTextBounds;return _cachedTextBounds||(this._cachedTextBounds=textAndAttributes.length<=2?this.textBoundsSingleChunk():this.textBoundsAllChunks());}},{key:"forceRerender",value:function Label_forceRerender_(){this._cachedTextBounds=null;this.makeDirty();}},{key:"applyLayoutIfNeeded",value:function Label_applyLayoutIfNeeded_(){this.fitIfNeeded();initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"applyLayoutIfNeeded",this).call(this);}},{key:"render",value:function Label_render_(renderer){if(this._requestMasterStyling){this.master&&this.master.applyIfNeeded(true);this._requestMasterStyling=false;}var renderedText=[];var nLines=this.textAndAttributesOfLines.length;for(var _i183=0;_i183<nLines;_i183++){var line=this.textAndAttributesOfLines[_i183];for(var _j22=0;_j22<line.length;_j22=_j22+2){var text=line[_j22];var style=line[_j22+1];renderedText.push(this.renderChunk(text,style));}if(_i183<nLines-1)renderedText.push(__varRecorder__$S.h("br"));}var _this$textStyle=this.textStyle,fontColor=_this$textStyle.fontColor,fontFamily=_this$textStyle.fontFamily,fontSize=_this$textStyle.fontSize,fontStyle=_this$textStyle.fontStyle,fontWeight=_this$textStyle.fontWeight,textShadow=_this$textStyle.textShadow,textDecoration=_this$textStyle.textDecoration,textStyleClasses=_this$textStyle.textStyleClasses;var padding=this.padding;var style={fontFamily:fontFamily,fontSize:typeof fontSize==="number"?fontSize+"px":fontSize,color:fontColor?String(fontColor):"transparent",position:"absolute",cursor:this.nativeCursor};var attrs=__varRecorder__$S.defaultAttributes(this,renderer);if(textShadow)style.textShadow=textShadow;if(fontWeight!=="normal")style.fontWeight=fontWeight;if(fontStyle!=="normal")style.fontStyle=fontStyle;if(textDecoration!=="none")style.textDecoration=textDecoration;if(textStyleClasses&&textStyleClasses.length){attrs.className=(attrs.className||"")+" "+textStyleClasses.join(" ");}attrs.style=Object.assign({},__varRecorder__$S.defaultStyle(this),{},style);return __varRecorder__$S.h("div",attrs,[__varRecorder__$S.h("div",{style:{pointerEvents:"none",position:"absolute",paddingLeft:padding.left()+"px",paddingRight:padding.right()+"px",paddingTop:padding.top()+"px",paddingBottom:padding.bottom()+"px",width:"calc(100% - ".concat(padding.left(),"px - ").concat(padding.right(),"px)")}},renderedText),renderer.renderSubmorphs(this)]);}},{key:"renderChunk",value:function Label_renderChunk_(text,chunkStyle){chunkStyle=chunkStyle||{};var _chunkStyle=chunkStyle,backgroundColor=_chunkStyle.backgroundColor,fontColor=_chunkStyle.fontColor,fontFamily=_chunkStyle.fontFamily,fontStyle=_chunkStyle.fontStyle,fontWeight=_chunkStyle.fontWeight,textShadow=_chunkStyle.textShadow,textDecoration=_chunkStyle.textDecoration,textStyleClasses=_chunkStyle.textStyleClasses,textAlign=_chunkStyle.textAlign,_float=_chunkStyle["float"],display=_chunkStyle.display,lineHeight=_chunkStyle.lineHeight,opacity=_chunkStyle.opacity;var style={};var attrs={style:style};if(_float)style["float"]=_float;if(display)style.display=display;if(backgroundColor)style.backgroundColor=String(backgroundColor);if(fontFamily)style.fontFamily=fontFamily;if(fontColor)style.color=String(fontColor);if(textShadow)style.textShadow=textShadow;if(fontWeight!=="normal")style.fontWeight=fontWeight;if(fontStyle!=="normal")style.fontStyle=fontStyle;if(textDecoration!=="none")style.textDecoration=textDecoration;if(textAlign)style.textAlign=textAlign;if(lineHeight)style.lineHeight=lineHeight;if(opacity)style.opacity=opacity;if(textStyleClasses&&textStyleClasses.length){attrs.className=textStyleClasses.join(" ");}var lengthAttrs=["fontSize","width","height","maxWidth","maxHeight","top","left","padding","paddingLeft","paddingRight","paddingBottom","paddingTop","marginTop","marginRight","marginLeft","marginBottom"];for(var _i184=0;_i184<lengthAttrs.length;_i184++){var name=lengthAttrs[_i184];if(!chunkStyle.hasOwnProperty(name))continue;var value=chunkStyle[name];style[name]=typeof value==="number"?value+"px":value;}return __varRecorder__$S.h("span",attrs,text);}},{key:"interactivelyChangeLabel",value:function(){var _Label_interactivelyChangeLabel_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee152(){var newLabel;return regeneratorRuntime.wrap(function _callee152$(_context152){while(1){switch(_context152.prev=_context152.next){case 0:_context152.next=2;return this.world().prompt("edit label",{input:this.textString,historyId:"lively.morphic-label-edit-hist"});case 2:newLabel=_context152.sent;if(typeof newLabel==="string"){this.textString=newLabel;}case 4:case"end":return _context152.stop();}}},_callee152,this);}));function Label_interactivelyChangeLabel_(){return _Label_interactivelyChangeLabel_.apply(this,arguments);}return Label_interactivelyChangeLabel_;}()},{key:"interactivelySetIcon",value:function(){var _Label_interactivelySetIcon_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee153(){var res,_res$selected,iconName;return regeneratorRuntime.wrap(function _callee153$(_context153){while(1){switch(_context153.prev=_context153.next){case 0:_context153.next=2;return this.world().filterableListPrompt("Select Icon",Object.keys(__varRecorder__$S.Icons).map(function(iconName){return{isListItem:true,label:[].concat(_toConsumableArray2(__varRecorder__$S.Icon.textAttribute(iconName,{paddingRight:"10px"})),[iconName,{}]),value:iconName};}));case 2:res=_context153.sent;_res$selected=_slicedToArray2(res.selected,1),iconName=_res$selected[0];if(iconName){this.value=__varRecorder__$S.Icon.textAttribute(iconName);}case 5:case"end":return _context153.stop();}}},_callee153,this);}));function Label_interactivelySetIcon_(){return _Label_interactivelySetIcon_.apply(this,arguments);}return Label_interactivelySetIcon_;}()},{key:"menuItems",value:function Label_menuItems_(){var _this192=this;var items=initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"menuItems",this).call(this);items.unshift({isDivider:true});items.unshift(["change label",function(){return _this192.interactivelyChangeLabel();}]);items.unshift(["set Icon",function(){return _this192.interactivelySetIcon();}]);return items;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Label";}},{key:"properties",get:function get(){return{fill:{defaultValue:__varRecorder__$S.Color.transparent},draggable:{defaultValue:false},nativeCursor:{defaultValue:"default"},isIcon:{derived:true,get:function get(){return __varRecorder__$S.properties.values(__varRecorder__$S.Icons).map(function(_ref136){var code=_ref136.code;return code;}).includes(this.textString);}},value:{derived:true,after:["textAndAttributes","textString"],get:function get(){var textAndAttributes=this.textAndAttributes;if(textAndAttributes.length<=2){var _textAndAttributes2=_slicedToArray2(textAndAttributes,2),text=_textAndAttributes2[0],style=_textAndAttributes2[1];if(!Object.keys(style||{}).length)return text||"";}return textAndAttributes;},set:function set(value){typeof value==="string"?this.textString=value:this.textAndAttributes=value;}},textString:{derived:true,after:["textAndAttributes"],get:function get(){return this.textAndAttributes.map(function(text,i){return i%2==0?text:"";}).join("");},set:function set(value){this.textAndAttributes=[value,null];}},textAndAttributes:{get:function get(){var val=this.getProperty("textAndAttributes");if(!val||val.length<1)val=["",null];return val;},set:function set(value){if(!Array.isArray(value))value=[String(value),{}];if(value.length===0)value=["",{}];var prevValue=this.textAndAttributes;this.setProperty("textAndAttributes",value);if(this.autofit)this.invalidateTextLayout();__varRecorder__$S.signal(this,"value",value);}},valueAndAnnotation:{derived:true,after:["textAndAttributes"],get:function get(){var value=this.textAndAttributes;var annotation=null;if(value.length>2){var _value$slice=value.slice(-2),_value$slice2=_slicedToArray2(_value$slice,2),_string=_value$slice2[0],props=_value$slice2[1];if(props&&props.textStyleClasses&&props.textStyleClasses.includes("annotation")){value=value.slice(0,-2);annotation=[_string,props];}}return{value:value,annotation:annotation};},set:function set(valueAndAnnotation){var value=valueAndAnnotation.value,annotation=valueAndAnnotation.annotation;if(!value)value="";if(typeof value==="string")value=[value,null];if(!Array.isArray(value))value=[String(value),null];var textAndAttributes=value.slice();if(annotation){if(typeof annotation==="string")annotation=[annotation,null];var annAttr=annotation[1];if(!annAttr)annAttr=annotation[1]={};textAndAttributes.push.apply(textAndAttributes,_toConsumableArray2(annotation));annAttr.textStyleClasses=(annAttr.textStyleClasses||[]).concat("annotation");if(!annAttr.textStyleClasses.includes("annotation")){annAttr.textStyleClasses.push("annotation");}}this.textAndAttributes=textAndAttributes;}},autofit:{defaultValue:true,set:function set(value){this.setProperty("autofit",value);if(value)this._needsFit=true;}},padding:{type:"Rectangle",isStyleProp:true,defaultValue:__varRecorder__$S.Rectangle.inset(0),initialize:function initialize(value){this.padding=value;},set:function set(value){if(!value)value=__varRecorder__$S.Rectangle.inset(0);var previousPadding=this.padding;this.setProperty("padding",typeof value==="number"?__varRecorder__$S.Rectangle.inset(value):value);if(this.autofit&&!previousPadding.equals(value))this.invalidateTextLayout();}},fontFamily:{isStyleProp:true,type:"Enum",values:__varRecorder__$S.config.text.basicFontItems,defaultValue:"IBM Plex Sans, Sans-Serif",set:function set(fontFamily){var previousFontFamily=this.fontFamily;this.setProperty("fontFamily",fontFamily);if(this.autofit&&previousFontFamily!=fontFamily)this.invalidateTextLayout();}},fontSize:{type:"Number",min:1,isStyleProp:true,defaultValue:12,set:function set(fontSize){var previousFontSize=this.fontSize;this.setProperty("fontSize",fontSize);if(this.autofit&&fontSize!=previousFontSize)this.invalidateTextLayout();}},fontColor:{type:"Color",isStyleProp:true,defaultValue:__varRecorder__$S.Color.black},fontWeight:{type:"Enum",values:["bold","bolder","light","lighter"],isStyleProp:true,defaultValue:"normal",set:function set(fontWeight){var previousFontWeight=this.fontWeight;this.setProperty("fontWeight",fontWeight);if(this.autofit&&previousFontWeight!=fontWeight)this.invalidateTextLayout();}},fontStyle:{type:"Enum",values:["normal","italic","oblique"],isStyleProp:true,defaultValue:"normal",set:function set(fontStyle){var previousFontStyle=this.fontStyle;this.setProperty("fontStyle",fontStyle);if(this.autofit&&previousFontStyle!=fontStyle)this.invalidateTextLayout();}},textShadow:{type:"String",isStyleProp:true,defaultValue:""},textDecoration:{defaultValue:"none"},textStyleClasses:{defaultValue:undefined,set:function set(textStyleClasses){this.setProperty("textStyleClasses",textStyleClasses);if(this.autofit)this.invalidateTextLayout();}}};}},{key:"icon",value:function Label_icon_(iconName){var props=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{prefix:"",suffix:""};return __varRecorder__$S.Icon.makeLabel(iconName,props);}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/label.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:490,end:18057});}(__varRecorder__$S.Morph);__varRecorder__$S.Label=Label;__varRecorder__$S.Label=Label;__varRecorder__$S.Label=Label;var __captured4__=/*#__PURE__*/Object.freeze({__proto__:null,Label:Label});var _global$8=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$10={};// http://www.w3.org/TR/CSS21/grammar.html
// https://github.com/visionmedia/css-parse/pull/49#issuecomment-30088027
var commentre=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;exports$10=function exports$10(css,options){options=options||{};/**
         * Positional.
         */var lineno=1;var column=1;/**
         * Update lineno and column based on `str`.
         */function updatePosition(str){var lines=str.match(/\n/g);if(lines)lineno+=lines.length;var i=str.lastIndexOf("\n");column=~i?str.length-i:column+str.length;}/**
         * Mark position and patch `node.position`.
         */function position(){var start={line:lineno,column:column};return function(node){node.position=new Position(start);whitespace();return node;};}/**
         * Store position information for a node
         */function Position(start){(this||_global$8).start=start;(this||_global$8).end={line:lineno,column:column};(this||_global$8).source=options.source;}/**
         * Non-enumerable source string
         */Position.prototype.content=css;/**
         * Error `msg`.
         */var errorsList=[];function error(msg){var err=new Error(options.source+":"+lineno+":"+column+": "+msg);err.reason=msg;err.filename=options.source;err.line=lineno;err.column=column;err.source=css;if(options.silent){errorsList.push(err);}else{throw err;}}/**
         * Parse stylesheet.
         */function stylesheet(){var rulesList=rules();return{type:"stylesheet",stylesheet:{source:options.source,rules:rulesList,parsingErrors:errorsList}};}/**
         * Opening brace.
         */function open(){return match(/^{\s*/);}/**
         * Closing brace.
         */function close(){return match(/^}/);}/**
         * Parse ruleset.
         */function rules(){var node;var rules=[];whitespace();comments(rules);while(css.length&&css.charAt(0)!="}"&&(node=atrule()||rule())){if(node!==false){rules.push(node);comments(rules);}}return rules;}/**
         * Match `re` and return captures.
         */function match(re){var m=re.exec(css);if(!m)return;var str=m[0];updatePosition(str);css=css.slice(str.length);return m;}/**
         * Parse whitespace.
         */function whitespace(){match(/^\s*/);}/**
         * Parse comments;
         */function comments(rules){var c;rules=rules||[];while(c=comment()){if(c!==false){rules.push(c);}}return rules;}/**
         * Parse comment.
         */function comment(){var pos=position();if("/"!=css.charAt(0)||"*"!=css.charAt(1))return;var i=2;while(""!=css.charAt(i)&&("*"!=css.charAt(i)||"/"!=css.charAt(i+1))){++i;}i+=2;if(""===css.charAt(i-1)){return error("End of comment missing");}var str=css.slice(2,i-2);column+=2;updatePosition(str);css=css.slice(i);column+=2;return pos({type:"comment",comment:str});}/**
         * Parse selector.
         */function selector(){var m=match(/^([^{]+)/);if(!m)return;/* @fix Remove all comments from selectors
           * http://ostermiller.org/findcomment.html */return trim$1(m[0]).replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,function(m){return m.replace(/,/g,"\u200C");}).split(/\s*(?![^(]*\)),\s*/).map(function(s){return s.replace(/\u200C/g,",");});}/**
         * Parse declaration.
         */function declaration(){var pos=position();// prop
var prop=match(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!prop)return;prop=trim$1(prop[0]);// :
if(!match(/^:\s*/))return error("property missing ':'");// val
var val=match(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/);var ret=pos({type:"declaration",property:prop.replace(commentre,""),value:val?trim$1(val[0]).replace(commentre,""):""});// ;
match(/^[;\s]*/);return ret;}/**
         * Parse declarations.
         */function declarations(){var decls=[];if(!open())return error("missing '{'");comments(decls);// declarations
var decl;while(decl=declaration()){if(decl!==false){decls.push(decl);comments(decls);}}if(!close())return error("missing '}'");return decls;}/**
         * Parse keyframe.
         */function keyframe(){var m;var vals=[];var pos=position();while(m=match(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/)){vals.push(m[1]);match(/^,\s*/);}if(!vals.length)return;return pos({type:"keyframe",values:vals,declarations:declarations()});}/**
         * Parse keyframes.
         */function atkeyframes(){var pos=position();var m=match(/^@([-\w]+)?keyframes\s*/);if(!m)return;var vendor=m[1];// identifier
var m=match(/^([-\w]+)\s*/);if(!m)return error("@keyframes missing name");var name=m[1];if(!open())return error("@keyframes missing '{'");var frame;var frames=comments();while(frame=keyframe()){frames.push(frame);frames=frames.concat(comments());}if(!close())return error("@keyframes missing '}'");return pos({type:"keyframes",name:name,vendor:vendor,keyframes:frames});}/**
         * Parse supports.
         */function atsupports(){var pos=position();var m=match(/^@supports *([^{]+)/);if(!m)return;var supports=trim$1(m[1]);if(!open())return error("@supports missing '{'");var style=comments().concat(rules());if(!close())return error("@supports missing '}'");return pos({type:"supports",supports:supports,rules:style});}/**
         * Parse host.
         */function athost(){var pos=position();var m=match(/^@host\s*/);if(!m)return;if(!open())return error("@host missing '{'");var style=comments().concat(rules());if(!close())return error("@host missing '}'");return pos({type:"host",rules:style});}/**
         * Parse media.
         */function atmedia(){var pos=position();var m=match(/^@media *([^{]+)/);if(!m)return;var media=trim$1(m[1]);if(!open())return error("@media missing '{'");var style=comments().concat(rules());if(!close())return error("@media missing '}'");return pos({type:"media",media:media,rules:style});}/**
         * Parse custom-media.
         */function atcustommedia(){var pos=position();var m=match(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(!m)return;return pos({type:"custom-media",name:trim$1(m[1]),media:trim$1(m[2])});}/**
         * Parse paged media.
         */function atpage(){var pos=position();var m=match(/^@page */);if(!m)return;var sel=selector()||[];if(!open())return error("@page missing '{'");var decls=comments();// declarations
var decl;while(decl=declaration()){decls.push(decl);decls=decls.concat(comments());}if(!close())return error("@page missing '}'");return pos({type:"page",selectors:sel,declarations:decls});}/**
         * Parse document.
         */function atdocument(){var pos=position();var m=match(/^@([-\w]+)?document *([^{]+)/);if(!m)return;var vendor=trim$1(m[1]);var doc=trim$1(m[2]);if(!open())return error("@document missing '{'");var style=comments().concat(rules());if(!close())return error("@document missing '}'");return pos({type:"document",document:doc,vendor:vendor,rules:style});}/**
         * Parse font-face.
         */function atfontface(){var pos=position();var m=match(/^@font-face\s*/);if(!m)return;if(!open())return error("@font-face missing '{'");var decls=comments();// declarations
var decl;while(decl=declaration()){decls.push(decl);decls=decls.concat(comments());}if(!close())return error("@font-face missing '}'");return pos({type:"font-face",declarations:decls});}/**
         * Parse import
         */var atimport=_compileAtrule("import");/**
         * Parse charset
         */var atcharset=_compileAtrule("charset");/**
         * Parse namespace
         */var atnamespace=_compileAtrule("namespace");/**
         * Parse non-block at-rules
         */function _compileAtrule(name){var re=new RegExp("^@"+name+"\\s*([^;]+);");return function(){var pos=position();var m=match(re);if(!m)return;var ret={type:name};ret[name]=m[1].trim();return pos(ret);};}/**
         * Parse at rule.
         */function atrule(){if(css[0]!="@")return;return atkeyframes()||atmedia()||atcustommedia()||atsupports()||atimport()||atcharset()||atnamespace()||atdocument()||atpage()||athost()||atfontface();}/**
         * Parse rule.
         */function rule(){var pos=position();var sel=selector();if(!sel)return error("selector missing");comments();return pos({type:"rule",selectors:sel,declarations:declarations()});}return addParent(stylesheet());};/**
       * Trim `str`.
       */function trim$1(str){return str?str.replace(/^\s+|\s+$/g,""):"";}/**
       * Adds non-enumerable parent node reference to each node.
       */function addParent(obj,parent){var isNode=obj&&typeof obj.type==="string";var childParent=isNode?obj:parent;for(var k in obj){var value=obj[k];if(Array.isArray(value)){value.forEach(function(v){addParent(v,childParent);});}else if(value&&_typeof2(value)==="object"){addParent(value,childParent);}}if(isNode){Object.defineProperty(obj,"parent",{configurable:true,writable:true,enumerable:false,value:parent||null});}return obj;}var _parse=exports$10;var exports$11={};if(typeof Object.create==="function"){// implementation from standard node.js 'util' module
exports$11=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}});}};}else{// old school shim for old browsers
exports$11=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;var TempCtor=function TempCtor(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor();ctor.prototype.constructor=ctor;}};}var exports$1$k=exports$11;var _global$9=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$12={};/**
       * Expose `Compiler`.
       */exports$12=Compiler;/**
       * Initialize a compiler.
       *
       * @param {Type} name
       * @return {Type}
       * @api public
       */function Compiler(opts){(this||_global$9).options=opts||{};}/**
       * Emit `str`
       */Compiler.prototype.emit=function(str){return str;};/**
       * Visit `node`.
       */Compiler.prototype.visit=function(node){return this[node.type](node);};/**
       * Map visit over array of `nodes`, optionally using a `delim`
       */Compiler.prototype.mapVisit=function(nodes,delim){var buf="";delim=delim||"";for(var i=0,length=nodes.length;i<length;i++){buf+=this.visit(nodes[i]);if(delim&&i<length-1)buf+=this.emit(delim);}return buf;};var _compiler=exports$12;var _global$1$1=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$1$l={};/**
       * Module dependencies.
       */var Base=_compiler;var inherits=exports$1$k;/**
       * Expose compiler.
       */exports$1$l=Compiler$1;/**
       * Initialize a new `Compiler`.
       */function Compiler$1(options){options=options||{};Base.call(this||_global$1$1,options);(this||_global$1$1).indentation=options.indent;}/**
       * Inherit from `Base.prototype`.
       */inherits(Compiler$1,Base);/**
       * Compile `node`.
       */Compiler$1.prototype.compile=function(node){return this.stylesheet(node);};/**
       * Visit stylesheet node.
       */Compiler$1.prototype.stylesheet=function(node){return this.mapVisit(node.stylesheet.rules,"\n\n");};/**
       * Visit comment node.
       */Compiler$1.prototype.comment=function(node){return this.emit(this.indent()+"/*"+node.comment+"*/",node.position);};/**
       * Visit import node.
       */Compiler$1.prototype["import"]=function(node){return this.emit("@import "+node["import"]+";",node.position);};/**
       * Visit media node.
       */Compiler$1.prototype.media=function(node){return this.emit("@media "+node.media,node.position)+this.emit(" {\n"+this.indent(1))+this.mapVisit(node.rules,"\n\n")+this.emit(this.indent(-1)+"\n}");};/**
       * Visit document node.
       */Compiler$1.prototype.document=function(node){var doc="@"+(node.vendor||"")+"document "+node.document;return this.emit(doc,node.position)+this.emit(" "+" {\n"+this.indent(1))+this.mapVisit(node.rules,"\n\n")+this.emit(this.indent(-1)+"\n}");};/**
       * Visit charset node.
       */Compiler$1.prototype.charset=function(node){return this.emit("@charset "+node.charset+";",node.position);};/**
       * Visit namespace node.
       */Compiler$1.prototype.namespace=function(node){return this.emit("@namespace "+node.namespace+";",node.position);};/**
       * Visit supports node.
       */Compiler$1.prototype.supports=function(node){return this.emit("@supports "+node.supports,node.position)+this.emit(" {\n"+this.indent(1))+this.mapVisit(node.rules,"\n\n")+this.emit(this.indent(-1)+"\n}");};/**
       * Visit keyframes node.
       */Compiler$1.prototype.keyframes=function(node){return this.emit("@"+(node.vendor||"")+"keyframes "+node.name,node.position)+this.emit(" {\n"+this.indent(1))+this.mapVisit(node.keyframes,"\n")+this.emit(this.indent(-1)+"}");};/**
       * Visit keyframe node.
       */Compiler$1.prototype.keyframe=function(node){var decls=node.declarations;return this.emit(this.indent())+this.emit(node.values.join(", "),node.position)+this.emit(" {\n"+this.indent(1))+this.mapVisit(decls,"\n")+this.emit(this.indent(-1)+"\n"+this.indent()+"}\n");};/**
       * Visit page node.
       */Compiler$1.prototype.page=function(node){var sel=node.selectors.length?node.selectors.join(", ")+" ":"";return this.emit("@page "+sel,node.position)+this.emit("{\n")+this.emit(this.indent(1))+this.mapVisit(node.declarations,"\n")+this.emit(this.indent(-1))+this.emit("\n}");};/**
       * Visit font-face node.
       */Compiler$1.prototype["font-face"]=function(node){return this.emit("@font-face ",node.position)+this.emit("{\n")+this.emit(this.indent(1))+this.mapVisit(node.declarations,"\n")+this.emit(this.indent(-1))+this.emit("\n}");};/**
       * Visit host node.
       */Compiler$1.prototype.host=function(node){return this.emit("@host",node.position)+this.emit(" {\n"+this.indent(1))+this.mapVisit(node.rules,"\n\n")+this.emit(this.indent(-1)+"\n}");};/**
       * Visit custom-media node.
       */Compiler$1.prototype["custom-media"]=function(node){return this.emit("@custom-media "+node.name+" "+node.media+";",node.position);};/**
       * Visit rule node.
       */Compiler$1.prototype.rule=function(node){var indent=this.indent();var decls=node.declarations;if(!decls.length)return"";return this.emit(node.selectors.map(function(s){return indent+s;}).join(",\n"),node.position)+this.emit(" {\n")+this.emit(this.indent(1))+this.mapVisit(decls,"\n")+this.emit(this.indent(-1))+this.emit("\n"+this.indent()+"}");};/**
       * Visit declaration node.
       */Compiler$1.prototype.declaration=function(node){return this.emit(this.indent())+this.emit(node.property+": "+node.value,node.position)+this.emit(";");};/**
       * Increase, decrease or return current indentation.
       */Compiler$1.prototype.indent=function(level){(this||_global$1$1).level=(this||_global$1$1).level||1;if(null!=level){(this||_global$1$1).level+=level;return"";}return Array((this||_global$1$1).level).join((this||_global$1$1).indentation||"  ");};var _identity=exports$1$l;var exports$13={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       */ /**
       * This is a helper function for getting values from parameter/options
       * objects.
       *
       * @param args The object we are extracting values from
       * @param name The name of the property we are getting.
       * @param defaultValue An optional value to return if the property is missing
       * from the object. If this is not specified and the property is missing, an
       * error will be thrown.
       */function getArg(aArgs,aName,aDefaultValue){if(aName in aArgs){return aArgs[aName];}else if(arguments.length===3){return aDefaultValue;}else{throw new Error("\""+aName+"\" is a required argument.");}}exports$13.getArg=getArg;var urlRegexp=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/;var dataUrlRegexp=/^data:.+\,.+$/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);if(!match){return null;}return{scheme:match[1],auth:match[2],host:match[3],port:match[4],path:match[5]};}exports$13.urlParse=urlParse;function urlGenerate(aParsedUrl){var url="";if(aParsedUrl.scheme){url+=aParsedUrl.scheme+":";}url+="//";if(aParsedUrl.auth){url+=aParsedUrl.auth+"@";}if(aParsedUrl.host){url+=aParsedUrl.host;}if(aParsedUrl.port){url+=":"+aParsedUrl.port;}if(aParsedUrl.path){url+=aParsedUrl.path;}return url;}exports$13.urlGenerate=urlGenerate;/**
       * Normalizes a path, or the path portion of a URL:
       *
       * - Replaces consecutive slashes with one slash.
       * - Removes unnecessary '.' parts.
       * - Removes unnecessary '<dir>/..' parts.
       *
       * Based on code in the Node.js 'path' core module.
       *
       * @param aPath The path or url to normalize.
       */function normalize(aPath){var path=aPath;var url=urlParse(aPath);if(url){if(!url.path){return aPath;}path=url.path;}var isAbsolute=exports$13.isAbsolute(path);var parts=path.split(/\/+/);for(var part,up=0,i=parts.length-1;i>=0;i--){part=parts[i];if(part==="."){parts.splice(i,1);}else if(part===".."){up++;}else if(up>0){if(part===""){// The first part is blank if the path is absolute. Trying to go
// above the root is a no-op. Therefore we can remove all '..' parts
// directly after the root.
parts.splice(i+1,up);up=0;}else{parts.splice(i,2);up--;}}}path=parts.join("/");if(path===""){path=isAbsolute?"/":".";}if(url){url.path=path;return urlGenerate(url);}return path;}exports$13.normalize=normalize;/**
       * Joins two paths/URLs.
       *
       * @param aRoot The root path or URL.
       * @param aPath The path or URL to be joined with the root.
       *
       * - If aPath is a URL or a data URI, aPath is returned, unless aPath is a
       *   scheme-relative URL: Then the scheme of aRoot, if any, is prepended
       *   first.
       * - Otherwise aPath is a path. If aRoot is a URL, then its path portion
       *   is updated with the result and aRoot is returned. Otherwise the result
       *   is returned.
       *   - If aPath is absolute, the result is aPath.
       *   - Otherwise the two paths are joined with a slash.
       * - Joining for example 'http://' and 'www.example.com' is also supported.
       */function join(aRoot,aPath){if(aRoot===""){aRoot=".";}if(aPath===""){aPath=".";}var aPathUrl=urlParse(aPath);var aRootUrl=urlParse(aRoot);if(aRootUrl){aRoot=aRootUrl.path||"/";}// `join(foo, '//www.example.org')`
if(aPathUrl&&!aPathUrl.scheme){if(aRootUrl){aPathUrl.scheme=aRootUrl.scheme;}return urlGenerate(aPathUrl);}if(aPathUrl||aPath.match(dataUrlRegexp)){return aPath;}// `join('http://', 'www.example.com')`
if(aRootUrl&&!aRootUrl.host&&!aRootUrl.path){aRootUrl.host=aPath;return urlGenerate(aRootUrl);}var joined=aPath.charAt(0)==="/"?aPath:normalize(aRoot.replace(/\/+$/,"")+"/"+aPath);if(aRootUrl){aRootUrl.path=joined;return urlGenerate(aRootUrl);}return joined;}exports$13.join=join;exports$13.isAbsolute=function(aPath){return aPath.charAt(0)==="/"||urlRegexp.test(aPath);};/**
       * Make a path relative to a URL or another path.
       *
       * @param aRoot The root path or URL.
       * @param aPath The path or URL to be made relative to aRoot.
       */function relative(aRoot,aPath){if(aRoot===""){aRoot=".";}aRoot=aRoot.replace(/\/$/,"");// It is possible for the path to be above the root. In this case, simply
// checking whether the root is a prefix of the path won't work. Instead, we
// need to remove components from the root one by one, until either we find
// a prefix that fits, or we run out of components to remove.
var level=0;while(aPath.indexOf(aRoot+"/")!==0){var index=aRoot.lastIndexOf("/");if(index<0){return aPath;}// If the only part of the root that is left is the scheme (i.e. http://,
// file:///, etc.), one or more slashes (/), or simply nothing at all, we
// have exhausted all components, so the path is not relative to the root.
aRoot=aRoot.slice(0,index);if(aRoot.match(/^([^\/]+:\/)?\/*$/)){return aPath;}++level;}// Make sure we add a "../" for each component we removed from the root.
return Array(level+1).join("../")+aPath.substr(aRoot.length+1);}exports$13.relative=relative;var supportsNullProto=function(){var obj=Object.create(null);return!("__proto__"in obj);}();function identity(s){return s;}/**
       * Because behavior goes wacky when you set `__proto__` on objects, we
       * have to prefix all the strings in our set with an arbitrary character.
       *
       * See https://github.com/mozilla/source-map/pull/31 and
       * https://github.com/mozilla/source-map/issues/30
       *
       * @param String aStr
       */function toSetString(aStr){if(isProtoString(aStr)){return"$"+aStr;}return aStr;}exports$13.toSetString=supportsNullProto?identity:toSetString;function fromSetString(aStr){if(isProtoString(aStr)){return aStr.slice(1);}return aStr;}exports$13.fromSetString=supportsNullProto?identity:fromSetString;function isProtoString(s){if(!s){return false;}var length=s.length;if(length<9/* "__proto__".length */){return false;}if(s.charCodeAt(length-1)!==95/* '_' */||s.charCodeAt(length-2)!==95/* '_' */||s.charCodeAt(length-3)!==111/* 'o' */||s.charCodeAt(length-4)!==116/* 't' */||s.charCodeAt(length-5)!==111/* 'o' */||s.charCodeAt(length-6)!==114/* 'r' */||s.charCodeAt(length-7)!==112/* 'p' */||s.charCodeAt(length-8)!==95/* '_' */||s.charCodeAt(length-9)!==95/* '_' */){return false;}for(var i=length-10;i>=0;i--){if(s.charCodeAt(i)!==36/* '$' */){return false;}}return true;}/**
       * Comparator between two mappings where the original positions are compared.
       *
       * Optionally pass in `true` as `onlyCompareGenerated` to consider two
       * mappings with the same original source/line/column, but different generated
       * line and column the same. Useful when searching for a mapping with a
       * stubbed out mapping.
       */function compareByOriginalPositions(mappingA,mappingB,onlyCompareOriginal){var cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp;}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp;}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0||onlyCompareOriginal){return cmp;}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp;}cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp;}return strcmp(mappingA.name,mappingB.name);}exports$13.compareByOriginalPositions=compareByOriginalPositions;/**
       * Comparator between two mappings with deflated source and name indices where
       * the generated positions are compared.
       *
       * Optionally pass in `true` as `onlyCompareGenerated` to consider two
       * mappings with the same generated line and column, but different
       * source/name/original line and column the same. Useful when searching for a
       * mapping with a stubbed out mapping.
       */function compareByGeneratedPositionsDeflated(mappingA,mappingB,onlyCompareGenerated){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp;}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0||onlyCompareGenerated){return cmp;}cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp;}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp;}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp;}return strcmp(mappingA.name,mappingB.name);}exports$13.compareByGeneratedPositionsDeflated=compareByGeneratedPositionsDeflated;function strcmp(aStr1,aStr2){if(aStr1===aStr2){return 0;}if(aStr1===null){return 1;// aStr2 !== null
}if(aStr2===null){return-1;// aStr1 !== null
}if(aStr1>aStr2){return 1;}return-1;}/**
       * Comparator between two mappings with inflated source and name strings where
       * the generated positions are compared.
       */function compareByGeneratedPositionsInflated(mappingA,mappingB){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp;}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp;}cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp;}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp;}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp;}return strcmp(mappingA.name,mappingB.name);}exports$13.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated;/**
       * Strip any JSON XSSI avoidance prefix from the string (as documented
       * in the source maps specification), and then parse the string as
       * JSON.
       */function parseSourceMapInput(str){return JSON.parse(str.replace(/^\)]}'[^\n]*\n/,""));}exports$13.parseSourceMapInput=parseSourceMapInput;/**
       * Compute the URL of a source given the the source root, the source's
       * URL, and the source map's URL.
       */function computeSourceURL(sourceRoot,sourceURL,sourceMapURL){sourceURL=sourceURL||"";if(sourceRoot){// This follows what Chrome does.
if(sourceRoot[sourceRoot.length-1]!=="/"&&sourceURL[0]!=="/"){sourceRoot+="/";}// The spec says:
//   Line 4: An optional source root, useful for relocating source
//   files on a server or removing repeated values in the
//   sources entry.  This value is prepended to the individual
//   entries in the source field.
sourceURL=sourceRoot+sourceURL;}// Historically, SourceMapConsumer did not take the sourceMapURL as
// a parameter.  This mode is still somewhat supported, which is why
// this code block is conditional.  However, it's preferable to pass
// the source map URL to SourceMapConsumer, so that this function
// can implement the source URL resolution algorithm as outlined in
// the spec.  This block is basically the equivalent of:
//    new URL(sourceURL, sourceMapURL).toString()
// ... except it avoids using URL, which wasn't available in the
// older releases of node still supported by this library.
//
// The spec says:
//   If the sources are not absolute URLs after prepending of the
//   sourceRoot, the sources are resolved relative to the
//   SourceMap (like resolving script src in a html document).
if(sourceMapURL){var parsed=urlParse(sourceMapURL);if(!parsed){throw new Error("sourceMapURL could not be parsed");}if(parsed.path){// Strip the last path component, but keep the "/".
var index=parsed.path.lastIndexOf("/");if(index>=0){parsed.path=parsed.path.substring(0,index+1);}}sourceURL=join(urlGenerate(parsed),sourceURL);}return normalize(sourceURL);}exports$13.computeSourceURL=computeSourceURL;var exports$14={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       */var intToCharMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");/**
       * Encode an integer in the range of 0 to 63 to a single base 64 digit.
       */exports$14.encode=function(number){if(0<=number&&number<intToCharMap.length){return intToCharMap[number];}throw new TypeError("Must be between 0 and 63: "+number);};/**
       * Decode a single base 64 character code digit to an integer. Returns -1 on
       * failure.
       */exports$14.decode=function(charCode){var bigA=65;// 'A'
var bigZ=90;// 'Z'
var littleA=97;// 'a'
var littleZ=122;// 'z'
var zero=48;// '0'
var nine=57;// '9'
var plus=43;// '+'
var slash=47;// '/'
var littleOffset=26;var numberOffset=52;// 0 - 25: ABCDEFGHIJKLMNOPQRSTUVWXYZ
if(bigA<=charCode&&charCode<=bigZ){return charCode-bigA;}// 26 - 51: abcdefghijklmnopqrstuvwxyz
if(littleA<=charCode&&charCode<=littleZ){return charCode-littleA+littleOffset;}// 52 - 61: 0123456789
if(zero<=charCode&&charCode<=nine){return charCode-zero+numberOffset;}// 62: +
if(charCode==plus){return 62;}// 63: /
if(charCode==slash){return 63;}// Invalid base64 digit.
return-1;};var exports$1$m={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       *
       * Based on the Base 64 VLQ implementation in Closure Compiler:
       * https://code.google.com/p/closure-compiler/source/browse/trunk/src/com/google/debugging/sourcemap/Base64VLQ.java
       *
       * Copyright 2011 The Closure Compiler Authors. All rights reserved.
       * Redistribution and use in source and binary forms, with or without
       * modification, are permitted provided that the following conditions are
       * met:
       *
       *  * Redistributions of source code must retain the above copyright
       *    notice, this list of conditions and the following disclaimer.
       *  * Redistributions in binary form must reproduce the above
       *    copyright notice, this list of conditions and the following
       *    disclaimer in the documentation and/or other materials provided
       *    with the distribution.
       *  * Neither the name of Google Inc. nor the names of its
       *    contributors may be used to endorse or promote products derived
       *    from this software without specific prior written permission.
       *
       * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
       * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
       * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
       * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
       * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
       * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
       * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
       * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
       * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
       * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
       * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
       */var base64=exports$14;// A single base 64 digit can contain 6 bits of data. For the base 64 variable
// length quantities we use in the source map spec, the first bit is the sign,
// the next four bits are the actual value, and the 6th bit is the
// continuation bit. The continuation bit tells us whether there are more
// digits in this value following this digit.
//
//   Continuation
//   |    Sign
//   |    |
//   V    V
//   101011
var VLQ_BASE_SHIFT=5;// binary: 100000
var VLQ_BASE=1<<VLQ_BASE_SHIFT;// binary: 011111
var VLQ_BASE_MASK=VLQ_BASE-1;// binary: 100000
var VLQ_CONTINUATION_BIT=VLQ_BASE;/**
       * Converts from a two-complement value to a value where the sign bit is
       * placed in the least significant bit.  For example, as decimals:
       *   1 becomes 2 (10 binary), -1 becomes 3 (11 binary)
       *   2 becomes 4 (100 binary), -2 becomes 5 (101 binary)
       */function toVLQSigned(aValue){return aValue<0?(-aValue<<1)+1:(aValue<<1)+0;}/**
       * Converts to a two-complement value from a value where the sign bit is
       * placed in the least significant bit.  For example, as decimals:
       *   2 (10 binary) becomes 1, 3 (11 binary) becomes -1
       *   4 (100 binary) becomes 2, 5 (101 binary) becomes -2
       */function fromVLQSigned(aValue){var isNegative=(aValue&1)===1;var shifted=aValue>>1;return isNegative?-shifted:shifted;}/**
       * Returns the base 64 VLQ encoded value.
       */exports$1$m.encode=function base64VLQ_encode(aValue){var encoded="";var digit;var vlq=toVLQSigned(aValue);do{digit=vlq&VLQ_BASE_MASK;vlq>>>=VLQ_BASE_SHIFT;if(vlq>0){// There are still more digits in this value, so we must make sure the
// continuation bit is marked.
digit|=VLQ_CONTINUATION_BIT;}encoded+=base64.encode(digit);}while(vlq>0);return encoded;};/**
       * Decodes the next base 64 VLQ value from the given string and returns the
       * value and the rest of the string via the out parameter.
       */exports$1$m.decode=function base64VLQ_decode(aStr,aIndex,aOutParam){var strLen=aStr.length;var result=0;var shift=0;var continuation,digit;do{if(aIndex>=strLen){throw new Error("Expected more digits in base 64 VLQ value.");}digit=base64.decode(aStr.charCodeAt(aIndex++));if(digit===-1){throw new Error("Invalid base64 digit: "+aStr.charAt(aIndex-1));}continuation=!!(digit&VLQ_CONTINUATION_BIT);digit&=VLQ_BASE_MASK;result=result+(digit<<shift);shift+=VLQ_BASE_SHIFT;}while(continuation);aOutParam.value=fromVLQSigned(result);aOutParam.rest=aIndex;};var _global$a=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$2$7={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       */var util=exports$13;var has$1=Object.prototype.hasOwnProperty;var hasNativeMap=typeof Map!=="undefined";/**
       * A data structure which is a combination of an array and a set. Adding a new
       * member is O(1), testing for membership is O(1), and finding the index of an
       * element is O(1). Removing elements from the set is not supported. Only
       * strings are supported for membership.
       */function ArraySet(){(this||_global$a)._array=[];(this||_global$a)._set=hasNativeMap?new Map():Object.create(null);}/**
       * Static method for creating ArraySet instances from an existing array.
       */ArraySet.fromArray=function ArraySet_fromArray(aArray,aAllowDuplicates){var set=new ArraySet();for(var i=0,len=aArray.length;i<len;i++){set.add(aArray[i],aAllowDuplicates);}return set;};/**
       * Return how many unique items are in this ArraySet. If duplicates have been
       * added, than those do not count towards the size.
       *
       * @returns Number
       */ArraySet.prototype.size=function ArraySet_size(){return hasNativeMap?(this||_global$a)._set.size:Object.getOwnPropertyNames((this||_global$a)._set).length;};/**
       * Add the given string to this set.
       *
       * @param String aStr
       */ArraySet.prototype.add=function ArraySet_add(aStr,aAllowDuplicates){var sStr=hasNativeMap?aStr:util.toSetString(aStr);var isDuplicate=hasNativeMap?this.has(aStr):has$1.call((this||_global$a)._set,sStr);var idx=(this||_global$a)._array.length;if(!isDuplicate||aAllowDuplicates){(this||_global$a)._array.push(aStr);}if(!isDuplicate){if(hasNativeMap){(this||_global$a)._set.set(aStr,idx);}else{(this||_global$a)._set[sStr]=idx;}}};/**
       * Is the given string a member of this set?
       *
       * @param String aStr
       */ArraySet.prototype.has=function ArraySet_has(aStr){if(hasNativeMap){return(this||_global$a)._set.has(aStr);}else{var sStr=util.toSetString(aStr);return has$1.call((this||_global$a)._set,sStr);}};/**
       * What is the index of the given string in the array?
       *
       * @param String aStr
       */ArraySet.prototype.indexOf=function ArraySet_indexOf(aStr){if(hasNativeMap){var idx=(this||_global$a)._set.get(aStr);if(idx>=0){return idx;}}else{var sStr=util.toSetString(aStr);if(has$1.call((this||_global$a)._set,sStr)){return(this||_global$a)._set[sStr];}}throw new Error("\""+aStr+"\" is not in the set.");};/**
       * What is the element at the given index?
       *
       * @param Number aIdx
       */ArraySet.prototype.at=function ArraySet_at(aIdx){if(aIdx>=0&&aIdx<(this||_global$a)._array.length){return(this||_global$a)._array[aIdx];}throw new Error("No element indexed by "+aIdx);};/**
       * Returns the array representation of this set (which has the proper indices
       * indicated by indexOf). Note that this is a copy of the internal array used
       * for storing the members so that no one can mess with internal state.
       */ArraySet.prototype.toArray=function ArraySet_toArray(){return(this||_global$a)._array.slice();};exports$2$7.ArraySet=ArraySet;var _global$b=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$15={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2014 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       */var util$1=exports$13;/**
       * Determine whether mappingB is after mappingA with respect to generated
       * position.
       */function generatedPositionAfter(mappingA,mappingB){// Optimized for most common case
var lineA=mappingA.generatedLine;var lineB=mappingB.generatedLine;var columnA=mappingA.generatedColumn;var columnB=mappingB.generatedColumn;return lineB>lineA||lineB==lineA&&columnB>=columnA||util$1.compareByGeneratedPositionsInflated(mappingA,mappingB)<=0;}/**
       * A data structure to provide a sorted view of accumulated mappings in a
       * performance conscious manner. It trades a neglibable overhead in general
       * case for a large speedup in case of mappings being added in order.
       */function MappingList(){(this||_global$b)._array=[];(this||_global$b)._sorted=true;// Serves as infimum
(this||_global$b)._last={generatedLine:-1,generatedColumn:0};}/**
       * Iterate through internal items. This method takes the same arguments that
       * `Array.prototype.forEach` takes.
       *
       * NOTE: The order of the mappings is NOT guaranteed.
       */MappingList.prototype.unsortedForEach=function MappingList_forEach(aCallback,aThisArg){(this||_global$b)._array.forEach(aCallback,aThisArg);};/**
       * Add the given source mapping.
       *
       * @param Object aMapping
       */MappingList.prototype.add=function MappingList_add(aMapping){if(generatedPositionAfter((this||_global$b)._last,aMapping)){(this||_global$b)._last=aMapping;(this||_global$b)._array.push(aMapping);}else{(this||_global$b)._sorted=false;(this||_global$b)._array.push(aMapping);}};/**
       * Returns the flat, sorted array of mappings. The mappings are sorted by
       * generated position.
       *
       * WARNING: This method returns internal data without copying, for
       * performance. The return value must NOT be mutated, and should be treated as
       * an immutable borrow. If you want to take ownership, you must make your own
       * copy.
       */MappingList.prototype.toArray=function MappingList_toArray(){if(!(this||_global$b)._sorted){(this||_global$b)._array.sort(util$1.compareByGeneratedPositionsInflated);(this||_global$b)._sorted=true;}return(this||_global$b)._array;};exports$15.MappingList=MappingList;var _global$1$2=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$1$n={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       */var base64VLQ=exports$1$m;var util$1$1=exports$13;var ArraySet$1=exports$2$7.ArraySet;var MappingList$1=exports$15.MappingList;/**
       * An instance of the SourceMapGenerator represents a source map which is
       * being built incrementally. You may pass an object with the following
       * properties:
       *
       *   - file: The filename of the generated source.
       *   - sourceRoot: A root for all relative URLs in this source map.
       */function SourceMapGenerator(aArgs){if(!aArgs){aArgs={};}(this||_global$1$2)._file=util$1$1.getArg(aArgs,"file",null);(this||_global$1$2)._sourceRoot=util$1$1.getArg(aArgs,"sourceRoot",null);(this||_global$1$2)._skipValidation=util$1$1.getArg(aArgs,"skipValidation",false);(this||_global$1$2)._sources=new ArraySet$1();(this||_global$1$2)._names=new ArraySet$1();(this||_global$1$2)._mappings=new MappingList$1();(this||_global$1$2)._sourcesContents=null;}SourceMapGenerator.prototype._version=3;/**
       * Creates a new SourceMapGenerator based on a SourceMapConsumer
       *
       * @param aSourceMapConsumer The SourceMap.
       */SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot;var generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};if(mapping.source!=null){newMapping.source=mapping.source;if(sourceRoot!=null){newMapping.source=util$1$1.relative(sourceRoot,newMapping.source);}newMapping.original={line:mapping.originalLine,column:mapping.originalColumn};if(mapping.name!=null){newMapping.name=mapping.name;}}generator.addMapping(newMapping);});aSourceMapConsumer.sources.forEach(function(sourceFile){var sourceRelative=sourceFile;if(sourceRoot!==null){sourceRelative=util$1$1.relative(sourceRoot,sourceFile);}if(!generator._sources.has(sourceRelative)){generator._sources.add(sourceRelative);}var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){generator.setSourceContent(sourceFile,content);}});return generator;};/**
       * Add a single mapping from original source line and column to the generated
       * source's line and column for this source map being created. The mapping
       * object should have the following properties:
       *
       *   - generated: An object with the generated line and column positions.
       *   - original: An object with the original line and column positions.
       *   - source: The original source file (relative to the sourceRoot).
       *   - name: An optional original token name for this mapping.
       */SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(aArgs){var generated=util$1$1.getArg(aArgs,"generated");var original=util$1$1.getArg(aArgs,"original",null);var source=util$1$1.getArg(aArgs,"source",null);var name=util$1$1.getArg(aArgs,"name",null);if(!(this||_global$1$2)._skipValidation){this._validateMapping(generated,original,source,name);}if(source!=null){source=String(source);if(!(this||_global$1$2)._sources.has(source)){(this||_global$1$2)._sources.add(source);}}if(name!=null){name=String(name);if(!(this||_global$1$2)._names.has(name)){(this||_global$1$2)._names.add(name);}}(this||_global$1$2)._mappings.add({generatedLine:generated.line,generatedColumn:generated.column,originalLine:original!=null&&original.line,originalColumn:original!=null&&original.column,source:source,name:name});};/**
       * Set the source content for a source file.
       */SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(aSourceFile,aSourceContent){var source=aSourceFile;if((this||_global$1$2)._sourceRoot!=null){source=util$1$1.relative((this||_global$1$2)._sourceRoot,source);}if(aSourceContent!=null){// Add the source content to the _sourcesContents map.
// Create a new _sourcesContents map if the property is null.
if(!(this||_global$1$2)._sourcesContents){(this||_global$1$2)._sourcesContents=Object.create(null);}(this||_global$1$2)._sourcesContents[util$1$1.toSetString(source)]=aSourceContent;}else if((this||_global$1$2)._sourcesContents){// Remove the source file from the _sourcesContents map.
// If the _sourcesContents map is empty, set the property to null.
delete(this||_global$1$2)._sourcesContents[util$1$1.toSetString(source)];if(Object.keys((this||_global$1$2)._sourcesContents).length===0){(this||_global$1$2)._sourcesContents=null;}}};/**
       * Applies the mappings of a sub-source-map for a specific source file to the
       * source map being generated. Each mapping to the supplied source file is
       * rewritten using the supplied source map. Note: The resolution for the
       * resulting mappings is the minimium of this map and the supplied map.
       *
       * @param aSourceMapConsumer The source map to be applied.
       * @param aSourceFile Optional. The filename of the source file.
       *        If omitted, SourceMapConsumer's file property will be used.
       * @param aSourceMapPath Optional. The dirname of the path to the source map
       *        to be applied. If relative, it is relative to the SourceMapConsumer.
       *        This parameter is needed when the two source maps aren't in the same
       *        directory, and the source map to be applied contains relative source
       *        paths. If so, those relative source paths need to be rewritten
       *        relative to the SourceMapGenerator.
       */SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(aSourceMapConsumer,aSourceFile,aSourceMapPath){var sourceFile=aSourceFile;// If aSourceFile is omitted, we will use the file property of the SourceMap
if(aSourceFile==null){if(aSourceMapConsumer.file==null){throw new Error("SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, "+"or the source map's \"file\" property. Both were omitted.");}sourceFile=aSourceMapConsumer.file;}var sourceRoot=(this||_global$1$2)._sourceRoot;// Make "sourceFile" relative if an absolute Url is passed.
if(sourceRoot!=null){sourceFile=util$1$1.relative(sourceRoot,sourceFile);}// Applying the SourceMap can add and remove items from the sources and
// the names array.
var newSources=new ArraySet$1();var newNames=new ArraySet$1();// Find mappings for the "sourceFile"
(this||_global$1$2)._mappings.unsortedForEach(function(mapping){if(mapping.source===sourceFile&&mapping.originalLine!=null){// Check if it can be mapped by the source map, then update the mapping.
var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});if(original.source!=null){// Copy mapping
mapping.source=original.source;if(aSourceMapPath!=null){mapping.source=util$1$1.join(aSourceMapPath,mapping.source);}if(sourceRoot!=null){mapping.source=util$1$1.relative(sourceRoot,mapping.source);}mapping.originalLine=original.line;mapping.originalColumn=original.column;if(original.name!=null){mapping.name=original.name;}}}var source=mapping.source;if(source!=null&&!newSources.has(source)){newSources.add(source);}var name=mapping.name;if(name!=null&&!newNames.has(name)){newNames.add(name);}},this||_global$1$2);(this||_global$1$2)._sources=newSources;(this||_global$1$2)._names=newNames;// Copy sourcesContents of applied map.
aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aSourceMapPath!=null){sourceFile=util$1$1.join(aSourceMapPath,sourceFile);}if(sourceRoot!=null){sourceFile=util$1$1.relative(sourceRoot,sourceFile);}this.setSourceContent(sourceFile,content);}},this||_global$1$2);};/**
       * A mapping can have one of the three levels of data:
       *
       *   1. Just the generated position.
       *   2. The Generated position, original position, and original source.
       *   3. Generated and original position, original source, as well as a name
       *      token.
       *
       * To maintain consistency, we validate that any new mapping being added falls
       * in to one of these categories.
       */SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(aGenerated,aOriginal,aSource,aName){// When aOriginal is truthy but has empty values for .line and .column,
// it is most likely a programmer error. In this case we throw a very
// specific error message to try to guide them the right way.
// For example: https://github.com/Polymer/polymer-bundler/pull/519
if(aOriginal&&typeof aOriginal.line!=="number"&&typeof aOriginal.column!=="number"){throw new Error("original.line and original.column are not numbers -- you probably meant to omit "+"the original mapping entirely and only map the generated position. If so, pass "+"null for the original mapping instead of an object with empty or null values.");}if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aGenerated.line>0&&aGenerated.column>=0&&!aOriginal&&!aSource&&!aName){// Case 1.
return;}else if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aOriginal&&"line"in aOriginal&&"column"in aOriginal&&aGenerated.line>0&&aGenerated.column>=0&&aOriginal.line>0&&aOriginal.column>=0&&aSource){// Cases 2 and 3.
return;}else{throw new Error("Invalid mapping: "+JSON.stringify({generated:aGenerated,source:aSource,original:aOriginal,name:aName}));}};/**
       * Serialize the accumulated mappings in to the stream of base 64 VLQs
       * specified by the source map format.
       */SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){var previousGeneratedColumn=0;var previousGeneratedLine=1;var previousOriginalColumn=0;var previousOriginalLine=0;var previousName=0;var previousSource=0;var result="";var next;var mapping;var nameIdx;var sourceIdx;var mappings=(this||_global$1$2)._mappings.toArray();for(var i=0,len=mappings.length;i<len;i++){mapping=mappings[i];next="";if(mapping.generatedLine!==previousGeneratedLine){previousGeneratedColumn=0;while(mapping.generatedLine!==previousGeneratedLine){next+=";";previousGeneratedLine++;}}else{if(i>0){if(!util$1$1.compareByGeneratedPositionsInflated(mapping,mappings[i-1])){continue;}next+=",";}}next+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn);previousGeneratedColumn=mapping.generatedColumn;if(mapping.source!=null){sourceIdx=(this||_global$1$2)._sources.indexOf(mapping.source);next+=base64VLQ.encode(sourceIdx-previousSource);previousSource=sourceIdx;// lines are stored 0-based in SourceMap spec version 3
next+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine);previousOriginalLine=mapping.originalLine-1;next+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn);previousOriginalColumn=mapping.originalColumn;if(mapping.name!=null){nameIdx=(this||_global$1$2)._names.indexOf(mapping.name);next+=base64VLQ.encode(nameIdx-previousName);previousName=nameIdx;}}result+=next;}return result;};SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(aSources,aSourceRoot){return aSources.map(function(source){if(!(this||_global$1$2)._sourcesContents){return null;}if(aSourceRoot!=null){source=util$1$1.relative(aSourceRoot,source);}var key=util$1$1.toSetString(source);return Object.prototype.hasOwnProperty.call((this||_global$1$2)._sourcesContents,key)?(this||_global$1$2)._sourcesContents[key]:null;},this||_global$1$2);};/**
       * Externalize the source map.
       */SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var map={version:(this||_global$1$2)._version,sources:(this||_global$1$2)._sources.toArray(),names:(this||_global$1$2)._names.toArray(),mappings:this._serializeMappings()};if((this||_global$1$2)._file!=null){map.file=(this||_global$1$2)._file;}if((this||_global$1$2)._sourceRoot!=null){map.sourceRoot=(this||_global$1$2)._sourceRoot;}if((this||_global$1$2)._sourcesContents){map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot);}return map;};/**
       * Render the source map being generated to a string.
       */SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this.toJSON());};exports$1$n.SourceMapGenerator=SourceMapGenerator;var exports$16={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       */exports$16.GREATEST_LOWER_BOUND=1;exports$16.LEAST_UPPER_BOUND=2;/**
       * Recursive implementation of binary search.
       *
       * @param aLow Indices here and lower do not contain the needle.
       * @param aHigh Indices here and higher do not contain the needle.
       * @param aNeedle The element being searched for.
       * @param aHaystack The non-empty array being searched.
       * @param aCompare Function which takes two elements and returns -1, 0, or 1.
       * @param aBias Either 'binarySearch.GREATEST_LOWER_BOUND' or
       *     'binarySearch.LEAST_UPPER_BOUND'. Specifies whether to return the
       *     closest element that is smaller than or greater than the one we are
       *     searching for, respectively, if the exact element cannot be found.
       */function recursiveSearch(aLow,aHigh,aNeedle,aHaystack,aCompare,aBias){// This function terminates when one of the following is true:
//
//   1. We find the exact element we are looking for.
//
//   2. We did not find the exact element, but we can return the index of
//      the next-closest element.
//
//   3. We did not find the exact element, and there is no next-closest
//      element than the one we are searching for, so we return -1.
var mid=Math.floor((aHigh-aLow)/2)+aLow;var cmp=aCompare(aNeedle,aHaystack[mid],true);if(cmp===0){// Found the element we are looking for.
return mid;}else if(cmp>0){// Our needle is greater than aHaystack[mid].
if(aHigh-mid>1){// The element is in the upper half.
return recursiveSearch(mid,aHigh,aNeedle,aHaystack,aCompare,aBias);}// The exact needle element was not found in this haystack. Determine if
// we are in termination case (3) or (2) and return the appropriate thing.
if(aBias==exports$16.LEAST_UPPER_BOUND){return aHigh<aHaystack.length?aHigh:-1;}else{return mid;}}else{// Our needle is less than aHaystack[mid].
if(mid-aLow>1){// The element is in the lower half.
return recursiveSearch(aLow,mid,aNeedle,aHaystack,aCompare,aBias);}// we are in termination case (3) or (2) and return the appropriate thing.
if(aBias==exports$16.LEAST_UPPER_BOUND){return mid;}else{return aLow<0?-1:aLow;}}}/**
       * This is an implementation of binary search which will always try and return
       * the index of the closest element if there is no exact hit. This is because
       * mappings between original and generated line/col pairs are single points,
       * and there is an implicit region between each of them, so a miss just means
       * that you aren't on the very start of a region.
       *
       * @param aNeedle The element you are looking for.
       * @param aHaystack The array that is being searched.
       * @param aCompare A function which takes the needle and an element in the
       *     array and returns -1, 0, or 1 depending on whether the needle is less
       *     than, equal to, or greater than the element, respectively.
       * @param aBias Either 'binarySearch.GREATEST_LOWER_BOUND' or
       *     'binarySearch.LEAST_UPPER_BOUND'. Specifies whether to return the
       *     closest element that is smaller than or greater than the one we are
       *     searching for, respectively, if the exact element cannot be found.
       *     Defaults to 'binarySearch.GREATEST_LOWER_BOUND'.
       */exports$16.search=function search(aNeedle,aHaystack,aCompare,aBias){if(aHaystack.length===0){return-1;}var index=recursiveSearch(-1,aHaystack.length,aNeedle,aHaystack,aCompare,aBias||exports$16.GREATEST_LOWER_BOUND);if(index<0){return-1;}// We have found either the exact element, or the next-closest element than
// the one we are searching for. However, there may be more than one such
// element. Make sure we always return the smallest of these.
while(index-1>=0){if(aCompare(aHaystack[index],aHaystack[index-1],true)!==0){break;}--index;}return index;};var exports$1$o={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       */ // It turns out that some (most?) JavaScript engines don't self-host
// `Array.prototype.sort`. This makes sense because C++ will likely remain
// faster than JS when doing raw CPU-intensive sorting. However, when using a
// custom comparator function, calling back and forth between the VM's C++ and
// JIT'd JS is rather slow *and* loses JIT type information, resulting in
// worse generated code for the comparator function than would be optimal. In
// fact, when sorting with a comparator, these costs outweigh the benefits of
// sorting in C++. By using our own JS-implemented Quick Sort (below), we get
// a ~3500ms mean speed-up in `bench/bench.html`.
/**
       * Swap the elements indexed by `x` and `y` in the array `ary`.
       *
       * @param {Array} ary
       *        The array.
       * @param {Number} x
       *        The index of the first item.
       * @param {Number} y
       *        The index of the second item.
       */function swap$1(ary,x,y){var temp=ary[x];ary[x]=ary[y];ary[y]=temp;}/**
       * Returns a random integer within the range `low .. high` inclusive.
       *
       * @param {Number} low
       *        The lower bound on the range.
       * @param {Number} high
       *        The upper bound on the range.
       */function randomIntInRange(low,high){return Math.round(low+Math.random()*(high-low));}/**
       * The Quick Sort algorithm.
       *
       * @param {Array} ary
       *        An array to sort.
       * @param {function} comparator
       *        Function to use to compare two items.
       * @param {Number} p
       *        Start index of the array
       * @param {Number} r
       *        End index of the array
       */function doQuickSort(ary,comparator,p,r){// If our lower bound is less than our upper bound, we (1) partition the
// array into two pieces and (2) recurse on each half. If it is not, this is
// the empty array and our base case.
if(p<r){// (1) Partitioning.
//
// The partitioning chooses a pivot between `p` and `r` and moves all
// elements that are less than or equal to the pivot to the before it, and
// all the elements that are greater than it after it. The effect is that
// once partition is done, the pivot is in the exact place it will be when
// the array is put in sorted order, and it will not need to be moved
// again. This runs in O(n) time.
// Always choose a random pivot so that an input array which is reverse
// sorted does not cause O(n^2) running time.
var pivotIndex=randomIntInRange(p,r);var i=p-1;swap$1(ary,pivotIndex,r);var pivot=ary[r];// Immediately after `j` is incremented in this loop, the following hold
// true:
//
//   * Every element in `ary[p .. i]` is less than or equal to the pivot.
//
//   * Every element in `ary[i+1 .. j-1]` is greater than the pivot.
for(var j=p;j<r;j++){if(comparator(ary[j],pivot)<=0){i+=1;swap$1(ary,i,j);}}swap$1(ary,i+1,j);var q=i+1;// (2) Recurse on each half.
doQuickSort(ary,comparator,p,q-1);doQuickSort(ary,comparator,q+1,r);}}/**
       * Sort the given array in-place with the given comparator function.
       *
       * @param {Array} ary
       *        An array to sort.
       * @param {function} comparator
       *        Function to use to compare two items.
       */exports$1$o.quickSort=function(ary,comparator){doQuickSort(ary,comparator,0,ary.length-1);};var _global$c=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$2$8={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       */var util$2=exports$13;var binarySearch=exports$16;var ArraySet$2=exports$2$7.ArraySet;var base64VLQ$1=exports$1$m;var quickSort=exports$1$o.quickSort;function SourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=util$2.parseSourceMapInput(aSourceMap);}return sourceMap.sections!=null?new IndexedSourceMapConsumer(sourceMap,aSourceMapURL):new BasicSourceMapConsumer(sourceMap,aSourceMapURL);}SourceMapConsumer.fromSourceMap=function(aSourceMap,aSourceMapURL){return BasicSourceMapConsumer.fromSourceMap(aSourceMap,aSourceMapURL);};/**
       * The version of the source mapping spec that we are consuming.
       */SourceMapConsumer.prototype._version=3;// `__generatedMappings` and `__originalMappings` are arrays that hold the
// parsed mapping coordinates from the source map's "mappings" attribute. They
// are lazily instantiated, accessed via the `_generatedMappings` and
// `_originalMappings` getters respectively, and we only parse the mappings
// and create these arrays once queried for a source location. We jump through
// these hoops because there can be many thousands of mappings, and parsing
// them is expensive, so we only want to do it if we must.
//
// Each object in the arrays is of the form:
//
//     {
//       generatedLine: The line number in the generated code,
//       generatedColumn: The column number in the generated code,
//       source: The path to the original source file that generated this
//               chunk of code,
//       originalLine: The line number in the original source that
//                     corresponds to this chunk of generated code,
//       originalColumn: The column number in the original source that
//                       corresponds to this chunk of generated code,
//       name: The name of the original symbol which generated this chunk of
//             code.
//     }
//
// All properties except for `generatedLine` and `generatedColumn` can be
// `null`.
//
// `_generatedMappings` is ordered by the generated positions.
//
// `_originalMappings` is ordered by the original positions.
SourceMapConsumer.prototype.__generatedMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{configurable:true,enumerable:true,get:function get(){if(!(this||_global$c).__generatedMappings){this._parseMappings((this||_global$c)._mappings,(this||_global$c).sourceRoot);}return(this||_global$c).__generatedMappings;}});SourceMapConsumer.prototype.__originalMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{configurable:true,enumerable:true,get:function get(){if(!(this||_global$c).__originalMappings){this._parseMappings((this||_global$c)._mappings,(this||_global$c).sourceRoot);}return(this||_global$c).__originalMappings;}});SourceMapConsumer.prototype._charIsMappingSeparator=function SourceMapConsumer_charIsMappingSeparator(aStr,index){var c=aStr.charAt(index);return c===";"||c===",";};/**
       * Parse the mappings in a string in to a data structure which we can easily
       * query (the ordered arrays in the `this.__generatedMappings` and
       * `this.__originalMappings` properties).
       */SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){throw new Error("Subclasses must implement _parseMappings");};SourceMapConsumer.GENERATED_ORDER=1;SourceMapConsumer.ORIGINAL_ORDER=2;SourceMapConsumer.GREATEST_LOWER_BOUND=1;SourceMapConsumer.LEAST_UPPER_BOUND=2;/**
       * Iterate over each mapping between an original source/line/column and a
       * generated line/column in this source map.
       *
       * @param Function aCallback
       *        The function that is called with each mapping.
       * @param Object aContext
       *        Optional. If specified, this object will be the value of `this` every
       *        time that `aCallback` is called.
       * @param aOrder
       *        Either `SourceMapConsumer.GENERATED_ORDER` or
       *        `SourceMapConsumer.ORIGINAL_ORDER`. Specifies whether you want to
       *        iterate over the mappings sorted by the generated file's line/column
       *        order or the original's source/line/column order, respectively. Defaults to
       *        `SourceMapConsumer.GENERATED_ORDER`.
       */SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(aCallback,aContext,aOrder){var context=aContext||null;var order=aOrder||SourceMapConsumer.GENERATED_ORDER;var mappings;switch(order){case SourceMapConsumer.GENERATED_ORDER:mappings=(this||_global$c)._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=(this||_global$c)._originalMappings;break;default:throw new Error("Unknown order of iteration.");}var sourceRoot=(this||_global$c).sourceRoot;mappings.map(function(mapping){var source=mapping.source===null?null:(this||_global$c)._sources.at(mapping.source);source=util$2.computeSourceURL(sourceRoot,source,(this||_global$c)._sourceMapURL);return{source:source,generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name===null?null:(this||_global$c)._names.at(mapping.name)};},this||_global$c).forEach(aCallback,context);};/**
       * Returns all generated line and column information for the original source,
       * line, and column provided. If no column is provided, returns all mappings
       * corresponding to a either the line we are searching for or the next
       * closest line that has any mappings. Otherwise, returns all mappings
       * corresponding to the given line and either the column we are searching for
       * or the next closest column that has any offsets.
       *
       * The only argument is an object with the following properties:
       *
       *   - source: The filename of the original source.
       *   - line: The line number in the original source.  The line number is 1-based.
       *   - column: Optional. the column number in the original source.
       *    The column number is 0-based.
       *
       * and an array of objects is returned, each with the following properties:
       *
       *   - line: The line number in the generated source, or null.  The
       *    line number is 1-based.
       *   - column: The column number in the generated source, or null.
       *    The column number is 0-based.
       */SourceMapConsumer.prototype.allGeneratedPositionsFor=function SourceMapConsumer_allGeneratedPositionsFor(aArgs){var line=util$2.getArg(aArgs,"line");// When there is no exact match, BasicSourceMapConsumer.prototype._findMapping
// returns the index of the closest mapping less than the needle. By
// setting needle.originalColumn to 0, we thus find the last mapping for
// the given line, provided such a mapping exists.
var needle={source:util$2.getArg(aArgs,"source"),originalLine:line,originalColumn:util$2.getArg(aArgs,"column",0)};needle.source=this._findSourceIndex(needle.source);if(needle.source<0){return[];}var mappings=[];var index=this._findMapping(needle,(this||_global$c)._originalMappings,"originalLine","originalColumn",util$2.compareByOriginalPositions,binarySearch.LEAST_UPPER_BOUND);if(index>=0){var mapping=(this||_global$c)._originalMappings[index];if(aArgs.column===undefined){var originalLine=mapping.originalLine;// Iterate until either we run out of mappings, or we run into
// a mapping for a different line than the one we found. Since
// mappings are sorted, this is guaranteed to find all mappings for
// the line we found.
while(mapping&&mapping.originalLine===originalLine){mappings.push({line:util$2.getArg(mapping,"generatedLine",null),column:util$2.getArg(mapping,"generatedColumn",null),lastColumn:util$2.getArg(mapping,"lastGeneratedColumn",null)});mapping=(this||_global$c)._originalMappings[++index];}}else{var originalColumn=mapping.originalColumn;// Iterate until either we run out of mappings, or we run into
// a mapping for a different line than the one we were searching for.
// Since mappings are sorted, this is guaranteed to find all mappings for
// the line we are searching for.
while(mapping&&mapping.originalLine===line&&mapping.originalColumn==originalColumn){mappings.push({line:util$2.getArg(mapping,"generatedLine",null),column:util$2.getArg(mapping,"generatedColumn",null),lastColumn:util$2.getArg(mapping,"lastGeneratedColumn",null)});mapping=(this||_global$c)._originalMappings[++index];}}}return mappings;};exports$2$8.SourceMapConsumer=SourceMapConsumer;/**
       * A BasicSourceMapConsumer instance represents a parsed source map which we can
       * query for information about the original file positions by giving it a file
       * position in the generated source.
       *
       * The first parameter is the raw source map (either as a JSON string, or
       * already parsed to an object). According to the spec, source maps have the
       * following attributes:
       *
       *   - version: Which version of the source map spec this map is following.
       *   - sources: An array of URLs to the original source files.
       *   - names: An array of identifiers which can be referrenced by individual mappings.
       *   - sourceRoot: Optional. The URL root from which all sources are relative.
       *   - sourcesContent: Optional. An array of contents of the original source files.
       *   - mappings: A string of base64 VLQs which contain the actual mappings.
       *   - file: Optional. The generated file this source map is associated with.
       *
       * Here is an example source map, taken from the source map spec[0]:
       *
       *     {
       *       version : 3,
       *       file: "out.js",
       *       sourceRoot : "",
       *       sources: ["foo.js", "bar.js"],
       *       names: ["src", "maps", "are", "fun"],
       *       mappings: "AA,AB;;ABCDE;"
       *     }
       *
       * The second parameter, if given, is a string whose value is the URL
       * at which the source map was found.  This URL is used to compute the
       * sources array.
       *
       * [0]: https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit?pli=1#
       */function BasicSourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=util$2.parseSourceMapInput(aSourceMap);}var version=util$2.getArg(sourceMap,"version");var sources=util$2.getArg(sourceMap,"sources");// Sass 3.3 leaves out the 'names' array, so we deviate from the spec (which
// requires the array) to play nice here.
var names=util$2.getArg(sourceMap,"names",[]);var sourceRoot=util$2.getArg(sourceMap,"sourceRoot",null);var sourcesContent=util$2.getArg(sourceMap,"sourcesContent",null);var mappings=util$2.getArg(sourceMap,"mappings");var file=util$2.getArg(sourceMap,"file",null);// Once again, Sass deviates from the spec and supplies the version as a
// string rather than a number, so we use loose equality checking here.
if(version!=(this||_global$c)._version){throw new Error("Unsupported version: "+version);}if(sourceRoot){sourceRoot=util$2.normalize(sourceRoot);}sources=sources.map(String)// Some source maps produce relative source paths like "./foo.js" instead of
// "foo.js".  Normalize these first so that future comparisons will succeed.
// See bugzil.la/1090768.
.map(util$2.normalize)// Always ensure that absolute sources are internally stored relative to
// the source root, if the source root is absolute. Not doing this would
// be particularly problematic when the source root is a prefix of the
// source (valid, but why??). See github issue #199 and bugzil.la/1188982.
.map(function(source){return sourceRoot&&util$2.isAbsolute(sourceRoot)&&util$2.isAbsolute(source)?util$2.relative(sourceRoot,source):source;});// Pass `true` below to allow duplicate names and sources. While source maps
// are intended to be compressed and deduplicated, the TypeScript compiler
// sometimes generates source maps with duplicates in them. See Github issue
// #72 and bugzil.la/889492.
(this||_global$c)._names=ArraySet$2.fromArray(names.map(String),true);(this||_global$c)._sources=ArraySet$2.fromArray(sources,true);(this||_global$c)._absoluteSources=(this||_global$c)._sources.toArray().map(function(s){return util$2.computeSourceURL(sourceRoot,s,aSourceMapURL);});(this||_global$c).sourceRoot=sourceRoot;(this||_global$c).sourcesContent=sourcesContent;(this||_global$c)._mappings=mappings;(this||_global$c)._sourceMapURL=aSourceMapURL;(this||_global$c).file=file;}BasicSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer;/**
       * Utility function to find the index of a source.  Returns -1 if not
       * found.
       */BasicSourceMapConsumer.prototype._findSourceIndex=function(aSource){var relativeSource=aSource;if((this||_global$c).sourceRoot!=null){relativeSource=util$2.relative((this||_global$c).sourceRoot,relativeSource);}if((this||_global$c)._sources.has(relativeSource)){return(this||_global$c)._sources.indexOf(relativeSource);}// Maybe aSource is an absolute URL as returned by |sources|.  In
// this case we can't simply undo the transform.
var i;for(i=0;i<(this||_global$c)._absoluteSources.length;++i){if((this||_global$c)._absoluteSources[i]==aSource){return i;}}return-1;};/**
       * Create a BasicSourceMapConsumer from a SourceMapGenerator.
       *
       * @param SourceMapGenerator aSourceMap
       *        The source map that will be consumed.
       * @param String aSourceMapURL
       *        The URL at which the source map can be found (optional)
       * @returns BasicSourceMapConsumer
       */BasicSourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(aSourceMap,aSourceMapURL){var smc=Object.create(BasicSourceMapConsumer.prototype);var names=smc._names=ArraySet$2.fromArray(aSourceMap._names.toArray(),true);var sources=smc._sources=ArraySet$2.fromArray(aSourceMap._sources.toArray(),true);smc.sourceRoot=aSourceMap._sourceRoot;smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot);smc.file=aSourceMap._file;smc._sourceMapURL=aSourceMapURL;smc._absoluteSources=smc._sources.toArray().map(function(s){return util$2.computeSourceURL(smc.sourceRoot,s,aSourceMapURL);});// Because we are modifying the entries (by converting string sources and
// names to indices into the sources and names ArraySets), we have to make
// a copy of the entry or else bad things happen. Shared mutable state
// strikes again! See github issue #191.
var generatedMappings=aSourceMap._mappings.toArray().slice();var destGeneratedMappings=smc.__generatedMappings=[];var destOriginalMappings=smc.__originalMappings=[];for(var i=0,length=generatedMappings.length;i<length;i++){var srcMapping=generatedMappings[i];var destMapping=new Mapping();destMapping.generatedLine=srcMapping.generatedLine;destMapping.generatedColumn=srcMapping.generatedColumn;if(srcMapping.source){destMapping.source=sources.indexOf(srcMapping.source);destMapping.originalLine=srcMapping.originalLine;destMapping.originalColumn=srcMapping.originalColumn;if(srcMapping.name){destMapping.name=names.indexOf(srcMapping.name);}destOriginalMappings.push(destMapping);}destGeneratedMappings.push(destMapping);}quickSort(smc.__originalMappings,util$2.compareByOriginalPositions);return smc;};/**
       * The version of the source mapping spec that we are consuming.
       */BasicSourceMapConsumer.prototype._version=3;/**
       * The list of original sources.
       */Object.defineProperty(BasicSourceMapConsumer.prototype,"sources",{get:function get(){return(this||_global$c)._absoluteSources.slice();}});/**
       * Provide the JIT with a nice shape / hidden class.
       */function Mapping(){(this||_global$c).generatedLine=0;(this||_global$c).generatedColumn=0;(this||_global$c).source=null;(this||_global$c).originalLine=null;(this||_global$c).originalColumn=null;(this||_global$c).name=null;}/**
       * Parse the mappings in a string in to a data structure which we can easily
       * query (the ordered arrays in the `this.__generatedMappings` and
       * `this.__originalMappings` properties).
       */BasicSourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){var generatedLine=1;var previousGeneratedColumn=0;var previousOriginalLine=0;var previousOriginalColumn=0;var previousSource=0;var previousName=0;var length=aStr.length;var index=0;var cachedSegments={};var temp={};var originalMappings=[];var generatedMappings=[];var mapping,str,segment,end,value;while(index<length){if(aStr.charAt(index)===";"){generatedLine++;index++;previousGeneratedColumn=0;}else if(aStr.charAt(index)===","){index++;}else{mapping=new Mapping();mapping.generatedLine=generatedLine;// Because each offset is encoded relative to the previous one,
// many segments often have the same encoding. We can exploit this
// fact by caching the parsed variable length fields of each segment,
// allowing us to avoid a second parse if we encounter the same
// segment again.
for(end=index;end<length;end++){if(this._charIsMappingSeparator(aStr,end)){break;}}str=aStr.slice(index,end);segment=cachedSegments[str];if(segment){index+=str.length;}else{segment=[];while(index<end){base64VLQ$1.decode(aStr,index,temp);value=temp.value;index=temp.rest;segment.push(value);}if(segment.length===2){throw new Error("Found a source, but no line and column");}if(segment.length===3){throw new Error("Found a source and line, but no column");}cachedSegments[str]=segment;}// Generated column.
mapping.generatedColumn=previousGeneratedColumn+segment[0];previousGeneratedColumn=mapping.generatedColumn;if(segment.length>1){// Original source.
mapping.source=previousSource+segment[1];previousSource+=segment[1];// Original line.
mapping.originalLine=previousOriginalLine+segment[2];previousOriginalLine=mapping.originalLine;// Lines are stored 0-based
mapping.originalLine+=1;// Original column.
mapping.originalColumn=previousOriginalColumn+segment[3];previousOriginalColumn=mapping.originalColumn;if(segment.length>4){// Original name.
mapping.name=previousName+segment[4];previousName+=segment[4];}}generatedMappings.push(mapping);if(typeof mapping.originalLine==="number"){originalMappings.push(mapping);}}}quickSort(generatedMappings,util$2.compareByGeneratedPositionsDeflated);(this||_global$c).__generatedMappings=generatedMappings;quickSort(originalMappings,util$2.compareByOriginalPositions);(this||_global$c).__originalMappings=originalMappings;};/**
       * Find the mapping that best matches the hypothetical "needle" mapping that
       * we are searching for in the given "haystack" of mappings.
       */BasicSourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(aNeedle,aMappings,aLineName,aColumnName,aComparator,aBias){// To return the position we are searching for, we must first find the
// mapping for the given position and then return the opposite position it
// points to. Because the mappings are sorted, we can use binary search to
// find the best mapping.
if(aNeedle[aLineName]<=0){throw new TypeError("Line must be greater than or equal to 1, got "+aNeedle[aLineName]);}if(aNeedle[aColumnName]<0){throw new TypeError("Column must be greater than or equal to 0, got "+aNeedle[aColumnName]);}return binarySearch.search(aNeedle,aMappings,aComparator,aBias);};/**
       * Compute the last column for each generated mapping. The last column is
       * inclusive.
       */BasicSourceMapConsumer.prototype.computeColumnSpans=function SourceMapConsumer_computeColumnSpans(){for(var index=0;index<(this||_global$c)._generatedMappings.length;++index){var mapping=(this||_global$c)._generatedMappings[index];// Mappings do not contain a field for the last generated columnt. We
// can come up with an optimistic estimate, however, by assuming that
// mappings are contiguous (i.e. given two consecutive mappings, the
// first mapping ends where the second one starts).
if(index+1<(this||_global$c)._generatedMappings.length){var nextMapping=(this||_global$c)._generatedMappings[index+1];if(mapping.generatedLine===nextMapping.generatedLine){mapping.lastGeneratedColumn=nextMapping.generatedColumn-1;continue;}}// The last mapping for each line spans the entire line.
mapping.lastGeneratedColumn=Infinity;}};/**
       * Returns the original source, line, and column information for the generated
       * source's line and column positions provided. The only argument is an object
       * with the following properties:
       *
       *   - line: The line number in the generated source.  The line number
       *     is 1-based.
       *   - column: The column number in the generated source.  The column
       *     number is 0-based.
       *   - bias: Either 'SourceMapConsumer.GREATEST_LOWER_BOUND' or
       *     'SourceMapConsumer.LEAST_UPPER_BOUND'. Specifies whether to return the
       *     closest element that is smaller than or greater than the one we are
       *     searching for, respectively, if the exact element cannot be found.
       *     Defaults to 'SourceMapConsumer.GREATEST_LOWER_BOUND'.
       *
       * and an object is returned with the following properties:
       *
       *   - source: The original source file, or null.
       *   - line: The line number in the original source, or null.  The
       *     line number is 1-based.
       *   - column: The column number in the original source, or null.  The
       *     column number is 0-based.
       *   - name: The original identifier, or null.
       */BasicSourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util$2.getArg(aArgs,"line"),generatedColumn:util$2.getArg(aArgs,"column")};var index=this._findMapping(needle,(this||_global$c)._generatedMappings,"generatedLine","generatedColumn",util$2.compareByGeneratedPositionsDeflated,util$2.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=(this||_global$c)._generatedMappings[index];if(mapping.generatedLine===needle.generatedLine){var source=util$2.getArg(mapping,"source",null);if(source!==null){source=(this||_global$c)._sources.at(source);source=util$2.computeSourceURL((this||_global$c).sourceRoot,source,(this||_global$c)._sourceMapURL);}var name=util$2.getArg(mapping,"name",null);if(name!==null){name=(this||_global$c)._names.at(name);}return{source:source,line:util$2.getArg(mapping,"originalLine",null),column:util$2.getArg(mapping,"originalColumn",null),name:name};}}return{source:null,line:null,column:null,name:null};};/**
       * Return true if we have the source content for every source in the source
       * map, false otherwise.
       */BasicSourceMapConsumer.prototype.hasContentsOfAllSources=function BasicSourceMapConsumer_hasContentsOfAllSources(){if(!(this||_global$c).sourcesContent){return false;}return(this||_global$c).sourcesContent.length>=(this||_global$c)._sources.size()&&!(this||_global$c).sourcesContent.some(function(sc){return sc==null;});};/**
       * Returns the original source content. The only argument is the url of the
       * original source file. Returns null if no original source content is
       * available.
       */BasicSourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(aSource,nullOnMissing){if(!(this||_global$c).sourcesContent){return null;}var index=this._findSourceIndex(aSource);if(index>=0){return(this||_global$c).sourcesContent[index];}var relativeSource=aSource;if((this||_global$c).sourceRoot!=null){relativeSource=util$2.relative((this||_global$c).sourceRoot,relativeSource);}var url;if((this||_global$c).sourceRoot!=null&&(url=util$2.urlParse((this||_global$c).sourceRoot))){// XXX: file:// URIs and absolute paths lead to unexpected behavior for
// many users. We can help them out when they expect file:// URIs to
// behave like it would if they were running a local HTTP server. See
// https://bugzilla.mozilla.org/show_bug.cgi?id=885597.
var fileUriAbsPath=relativeSource.replace(/^file:\/\//,"");if(url.scheme=="file"&&(this||_global$c)._sources.has(fileUriAbsPath)){return(this||_global$c).sourcesContent[(this||_global$c)._sources.indexOf(fileUriAbsPath)];}if((!url.path||url.path=="/")&&(this||_global$c)._sources.has("/"+relativeSource)){return(this||_global$c).sourcesContent[(this||_global$c)._sources.indexOf("/"+relativeSource)];}}// This function is used recursively from
// IndexedSourceMapConsumer.prototype.sourceContentFor. In that case, we
// don't want to throw if we can't find the source - we just want to
// return null, so we provide a flag to exit gracefully.
if(nullOnMissing){return null;}else{throw new Error("\""+relativeSource+"\" is not in the SourceMap.");}};/**
       * Returns the generated line and column information for the original source,
       * line, and column positions provided. The only argument is an object with
       * the following properties:
       *
       *   - source: The filename of the original source.
       *   - line: The line number in the original source.  The line number
       *     is 1-based.
       *   - column: The column number in the original source.  The column
       *     number is 0-based.
       *   - bias: Either 'SourceMapConsumer.GREATEST_LOWER_BOUND' or
       *     'SourceMapConsumer.LEAST_UPPER_BOUND'. Specifies whether to return the
       *     closest element that is smaller than or greater than the one we are
       *     searching for, respectively, if the exact element cannot be found.
       *     Defaults to 'SourceMapConsumer.GREATEST_LOWER_BOUND'.
       *
       * and an object is returned with the following properties:
       *
       *   - line: The line number in the generated source, or null.  The
       *     line number is 1-based.
       *   - column: The column number in the generated source, or null.
       *     The column number is 0-based.
       */BasicSourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(aArgs){var source=util$2.getArg(aArgs,"source");source=this._findSourceIndex(source);if(source<0){return{line:null,column:null,lastColumn:null};}var needle={source:source,originalLine:util$2.getArg(aArgs,"line"),originalColumn:util$2.getArg(aArgs,"column")};var index=this._findMapping(needle,(this||_global$c)._originalMappings,"originalLine","originalColumn",util$2.compareByOriginalPositions,util$2.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=(this||_global$c)._originalMappings[index];if(mapping.source===needle.source){return{line:util$2.getArg(mapping,"generatedLine",null),column:util$2.getArg(mapping,"generatedColumn",null),lastColumn:util$2.getArg(mapping,"lastGeneratedColumn",null)};}}return{line:null,column:null,lastColumn:null};};exports$2$8.BasicSourceMapConsumer=BasicSourceMapConsumer;/**
       * An IndexedSourceMapConsumer instance represents a parsed source map which
       * we can query for information. It differs from BasicSourceMapConsumer in
       * that it takes "indexed" source maps (i.e. ones with a "sections" field) as
       * input.
       *
       * The first parameter is a raw source map (either as a JSON string, or already
       * parsed to an object). According to the spec for indexed source maps, they
       * have the following attributes:
       *
       *   - version: Which version of the source map spec this map is following.
       *   - file: Optional. The generated file this source map is associated with.
       *   - sections: A list of section definitions.
       *
       * Each value under the "sections" field has two fields:
       *   - offset: The offset into the original specified at which this section
       *       begins to apply, defined as an object with a "line" and "column"
       *       field.
       *   - map: A source map definition. This source map could also be indexed,
       *       but doesn't have to be.
       *
       * Instead of the "map" field, it's also possible to have a "url" field
       * specifying a URL to retrieve a source map from, but that's currently
       * unsupported.
       *
       * Here's an example source map, taken from the source map spec[0], but
       * modified to omit a section which uses the "url" field.
       *
       *  {
       *    version : 3,
       *    file: "app.js",
       *    sections: [{
       *      offset: {line:100, column:10},
       *      map: {
       *        version : 3,
       *        file: "section.js",
       *        sources: ["foo.js", "bar.js"],
       *        names: ["src", "maps", "are", "fun"],
       *        mappings: "AAAA,E;;ABCDE;"
       *      }
       *    }],
       *  }
       *
       * The second parameter, if given, is a string whose value is the URL
       * at which the source map was found.  This URL is used to compute the
       * sources array.
       *
       * [0]: https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit#heading=h.535es3xeprgt
       */function IndexedSourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=util$2.parseSourceMapInput(aSourceMap);}var version=util$2.getArg(sourceMap,"version");var sections=util$2.getArg(sourceMap,"sections");if(version!=(this||_global$c)._version){throw new Error("Unsupported version: "+version);}(this||_global$c)._sources=new ArraySet$2();(this||_global$c)._names=new ArraySet$2();var lastOffset={line:-1,column:0};(this||_global$c)._sections=sections.map(function(s){if(s.url){// The url field will require support for asynchronicity.
// See https://github.com/mozilla/source-map/issues/16
throw new Error("Support for url field in sections not implemented.");}var offset=util$2.getArg(s,"offset");var offsetLine=util$2.getArg(offset,"line");var offsetColumn=util$2.getArg(offset,"column");if(offsetLine<lastOffset.line||offsetLine===lastOffset.line&&offsetColumn<lastOffset.column){throw new Error("Section offsets must be ordered and non-overlapping.");}lastOffset=offset;return{generatedOffset:{// The offset fields are 0-based, but we use 1-based indices when
// encoding/decoding from VLQ.
generatedLine:offsetLine+1,generatedColumn:offsetColumn+1},consumer:new SourceMapConsumer(util$2.getArg(s,"map"),aSourceMapURL)};});}IndexedSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);IndexedSourceMapConsumer.prototype.constructor=SourceMapConsumer;/**
       * The version of the source mapping spec that we are consuming.
       */IndexedSourceMapConsumer.prototype._version=3;/**
       * The list of original sources.
       */Object.defineProperty(IndexedSourceMapConsumer.prototype,"sources",{get:function get(){var sources=[];for(var i=0;i<(this||_global$c)._sections.length;i++){for(var j=0;j<(this||_global$c)._sections[i].consumer.sources.length;j++){sources.push((this||_global$c)._sections[i].consumer.sources[j]);}}return sources;}});/**
       * Returns the original source, line, and column information for the generated
       * source's line and column positions provided. The only argument is an object
       * with the following properties:
       *
       *   - line: The line number in the generated source.  The line number
       *     is 1-based.
       *   - column: The column number in the generated source.  The column
       *     number is 0-based.
       *
       * and an object is returned with the following properties:
       *
       *   - source: The original source file, or null.
       *   - line: The line number in the original source, or null.  The
       *     line number is 1-based.
       *   - column: The column number in the original source, or null.  The
       *     column number is 0-based.
       *   - name: The original identifier, or null.
       */IndexedSourceMapConsumer.prototype.originalPositionFor=function IndexedSourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util$2.getArg(aArgs,"line"),generatedColumn:util$2.getArg(aArgs,"column")};// Find the section containing the generated position we're trying to map
// to an original position.
var sectionIndex=binarySearch.search(needle,(this||_global$c)._sections,function(needle,section){var cmp=needle.generatedLine-section.generatedOffset.generatedLine;if(cmp){return cmp;}return needle.generatedColumn-section.generatedOffset.generatedColumn;});var section=(this||_global$c)._sections[sectionIndex];if(!section){return{source:null,line:null,column:null,name:null};}return section.consumer.originalPositionFor({line:needle.generatedLine-(section.generatedOffset.generatedLine-1),column:needle.generatedColumn-(section.generatedOffset.generatedLine===needle.generatedLine?section.generatedOffset.generatedColumn-1:0),bias:aArgs.bias});};/**
       * Return true if we have the source content for every source in the source
       * map, false otherwise.
       */IndexedSourceMapConsumer.prototype.hasContentsOfAllSources=function IndexedSourceMapConsumer_hasContentsOfAllSources(){return(this||_global$c)._sections.every(function(s){return s.consumer.hasContentsOfAllSources();});};/**
       * Returns the original source content. The only argument is the url of the
       * original source file. Returns null if no original source content is
       * available.
       */IndexedSourceMapConsumer.prototype.sourceContentFor=function IndexedSourceMapConsumer_sourceContentFor(aSource,nullOnMissing){for(var i=0;i<(this||_global$c)._sections.length;i++){var section=(this||_global$c)._sections[i];var content=section.consumer.sourceContentFor(aSource,true);if(content){return content;}}if(nullOnMissing){return null;}else{throw new Error("\""+aSource+"\" is not in the SourceMap.");}};/**
       * Returns the generated line and column information for the original source,
       * line, and column positions provided. The only argument is an object with
       * the following properties:
       *
       *   - source: The filename of the original source.
       *   - line: The line number in the original source.  The line number
       *     is 1-based.
       *   - column: The column number in the original source.  The column
       *     number is 0-based.
       *
       * and an object is returned with the following properties:
       *
       *   - line: The line number in the generated source, or null.  The
       *     line number is 1-based. 
       *   - column: The column number in the generated source, or null.
       *     The column number is 0-based.
       */IndexedSourceMapConsumer.prototype.generatedPositionFor=function IndexedSourceMapConsumer_generatedPositionFor(aArgs){for(var i=0;i<(this||_global$c)._sections.length;i++){var section=(this||_global$c)._sections[i];// Only consider this section if the requested source is in the list of
// sources of the consumer.
if(section.consumer._findSourceIndex(util$2.getArg(aArgs,"source"))===-1){continue;}var generatedPosition=section.consumer.generatedPositionFor(aArgs);if(generatedPosition){var ret={line:generatedPosition.line+(section.generatedOffset.generatedLine-1),column:generatedPosition.column+(section.generatedOffset.generatedLine===generatedPosition.line?section.generatedOffset.generatedColumn-1:0)};return ret;}}return{line:null,column:null};};/**
       * Parse the mappings in a string in to a data structure which we can easily
       * query (the ordered arrays in the `this.__generatedMappings` and
       * `this.__originalMappings` properties).
       */IndexedSourceMapConsumer.prototype._parseMappings=function IndexedSourceMapConsumer_parseMappings(aStr,aSourceRoot){(this||_global$c).__generatedMappings=[];(this||_global$c).__originalMappings=[];for(var i=0;i<(this||_global$c)._sections.length;i++){var section=(this||_global$c)._sections[i];var sectionMappings=section.consumer._generatedMappings;for(var j=0;j<sectionMappings.length;j++){var mapping=sectionMappings[j];var source=section.consumer._sources.at(mapping.source);source=util$2.computeSourceURL(section.consumer.sourceRoot,source,(this||_global$c)._sourceMapURL);(this||_global$c)._sources.add(source);source=(this||_global$c)._sources.indexOf(source);var name=null;if(mapping.name){name=section.consumer._names.at(mapping.name);(this||_global$c)._names.add(name);name=(this||_global$c)._names.indexOf(name);}// The mappings coming from the consumer for the section have
// generated positions relative to the start of the section, so we
// need to offset them to be relative to the start of the concatenated
// generated file.
var adjustedMapping={source:source,generatedLine:mapping.generatedLine+(section.generatedOffset.generatedLine-1),generatedColumn:mapping.generatedColumn+(section.generatedOffset.generatedLine===mapping.generatedLine?section.generatedOffset.generatedColumn-1:0),originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:name};(this||_global$c).__generatedMappings.push(adjustedMapping);if(typeof adjustedMapping.originalLine==="number"){(this||_global$c).__originalMappings.push(adjustedMapping);}}}quickSort((this||_global$c).__generatedMappings,util$2.compareByGeneratedPositionsDeflated);quickSort((this||_global$c).__originalMappings,util$2.compareByOriginalPositions);};exports$2$8.IndexedSourceMapConsumer=IndexedSourceMapConsumer;var _global$d=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$17={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
       * Copyright 2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE or:
       * http://opensource.org/licenses/BSD-3-Clause
       */var SourceMapGenerator$1=exports$1$n.SourceMapGenerator;var util$3=exports$13;// Matches a Windows-style `\r\n` newline or a `\n` newline used by all other
// operating systems these days (capturing the result).
var REGEX_NEWLINE=/(\r?\n)/;// Newline character code for charCodeAt() comparisons
var NEWLINE_CODE=10;// Private symbol for identifying `SourceNode`s when multiple versions of
// the source-map library are loaded. This MUST NOT CHANGE across
// versions!
var isSourceNode="$$$isSourceNode$$$";/**
       * SourceNodes provide a way to abstract over interpolating/concatenating
       * snippets of generated JavaScript source code while maintaining the line and
       * column information associated with the original source code.
       *
       * @param aLine The original line number.
       * @param aColumn The original column number.
       * @param aSource The original source's filename.
       * @param aChunks Optional. An array of strings which are snippets of
       *        generated JS, or other SourceNodes.
       * @param aName The original identifier.
       */function SourceNode(aLine,aColumn,aSource,aChunks,aName){(this||_global$d).children=[];(this||_global$d).sourceContents={};(this||_global$d).line=aLine==null?null:aLine;(this||_global$d).column=aColumn==null?null:aColumn;(this||_global$d).source=aSource==null?null:aSource;(this||_global$d).name=aName==null?null:aName;(this||_global$d)[isSourceNode]=true;if(aChunks!=null)this.add(aChunks);}/**
       * Creates a SourceNode from generated code and a SourceMapConsumer.
       *
       * @param aGeneratedCode The generated code
       * @param aSourceMapConsumer The SourceMap for the generated code
       * @param aRelativePath Optional. The path that relative sources in the
       *        SourceMapConsumer should be relative to.
       */SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(aGeneratedCode,aSourceMapConsumer,aRelativePath){// The SourceNode we want to fill with the generated code
// and the SourceMap
var node=new SourceNode();// All even indices of this array are one line of the generated code,
// while all odd indices are the newlines between two adjacent lines
// (since `REGEX_NEWLINE` captures its match).
// Processed fragments are accessed by calling `shiftNextLine`.
var remainingLines=aGeneratedCode.split(REGEX_NEWLINE);var remainingLinesIndex=0;var shiftNextLine=function shiftNextLine(){var lineContents=getNextLine();// The last line of a file might not have a newline.
var newLine=getNextLine()||"";return lineContents+newLine;function getNextLine(){return remainingLinesIndex<remainingLines.length?remainingLines[remainingLinesIndex++]:undefined;}};// We need to remember the position of "remainingLines"
var lastGeneratedLine=1,lastGeneratedColumn=0;// The generate SourceNodes we need a code range.
// To extract it current and last mapping is used.
// Here we store the last mapping.
var lastMapping=null;aSourceMapConsumer.eachMapping(function(mapping){if(lastMapping!==null){// We add the code from "lastMapping" to "mapping":
// First check if there is a new line in between.
if(lastGeneratedLine<mapping.generatedLine){// Associate first line with "lastMapping"
addMappingWithCode(lastMapping,shiftNextLine());lastGeneratedLine++;lastGeneratedColumn=0;// The remaining code is added without mapping
}else{// There is no new line in between.
// Associate the code between "lastGeneratedColumn" and
// "mapping.generatedColumn" with "lastMapping"
var nextLine=remainingLines[remainingLinesIndex]||"";var code=nextLine.substr(0,mapping.generatedColumn-lastGeneratedColumn);remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn);lastGeneratedColumn=mapping.generatedColumn;addMappingWithCode(lastMapping,code);// No more remaining code, continue
lastMapping=mapping;return;}}// We add the generated code until the first mapping
// to the SourceNode without any mapping.
// Each line is added as separate string.
while(lastGeneratedLine<mapping.generatedLine){node.add(shiftNextLine());lastGeneratedLine++;}if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[remainingLinesIndex]||"";node.add(nextLine.substr(0,mapping.generatedColumn));remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn;}lastMapping=mapping;},this||_global$d);// We have processed all mappings.
if(remainingLinesIndex<remainingLines.length){if(lastMapping){// Associate the remaining code in the current line with "lastMapping"
addMappingWithCode(lastMapping,shiftNextLine());}// and add the remaining lines without any mapping
node.add(remainingLines.splice(remainingLinesIndex).join(""));}// Copy sourcesContent into SourceNode
aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aRelativePath!=null){sourceFile=util$3.join(aRelativePath,sourceFile);}node.setSourceContent(sourceFile,content);}});return node;function addMappingWithCode(mapping,code){if(mapping===null||mapping.source===undefined){node.add(code);}else{var source=aRelativePath?util$3.join(aRelativePath,mapping.source):mapping.source;node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,source,code,mapping.name));}}};/**
       * Add a chunk of generated JS to this source node.
       *
       * @param aChunk A string snippet of generated JS code, another instance of
       *        SourceNode, or an array where each member is one of those things.
       */SourceNode.prototype.add=function SourceNode_add(aChunk){if(Array.isArray(aChunk)){aChunk.forEach(function(chunk){this.add(chunk);},this||_global$d);}else if(aChunk[isSourceNode]||typeof aChunk==="string"){if(aChunk){(this||_global$d).children.push(aChunk);}}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk);}return this||_global$d;};/**
       * Add a chunk of generated JS to the beginning of this source node.
       *
       * @param aChunk A string snippet of generated JS code, another instance of
       *        SourceNode, or an array where each member is one of those things.
       */SourceNode.prototype.prepend=function SourceNode_prepend(aChunk){if(Array.isArray(aChunk)){for(var i=aChunk.length-1;i>=0;i--){this.prepend(aChunk[i]);}}else if(aChunk[isSourceNode]||typeof aChunk==="string"){(this||_global$d).children.unshift(aChunk);}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk);}return this||_global$d;};/**
       * Walk over the tree of JS snippets in this node and its children. The
       * walking function is called once for each snippet of JS and is passed that
       * snippet and the its original associated source's line/column location.
       *
       * @param aFn The traversal function.
       */SourceNode.prototype.walk=function SourceNode_walk(aFn){var chunk;for(var i=0,len=(this||_global$d).children.length;i<len;i++){chunk=(this||_global$d).children[i];if(chunk[isSourceNode]){chunk.walk(aFn);}else{if(chunk!==""){aFn(chunk,{source:(this||_global$d).source,line:(this||_global$d).line,column:(this||_global$d).column,name:(this||_global$d).name});}}}};/**
       * Like `String.prototype.join` except for SourceNodes. Inserts `aStr` between
       * each of `this.children`.
       *
       * @param aSep The separator.
       */SourceNode.prototype.join=function SourceNode_join(aSep){var newChildren;var i;var len=(this||_global$d).children.length;if(len>0){newChildren=[];for(i=0;i<len-1;i++){newChildren.push((this||_global$d).children[i]);newChildren.push(aSep);}newChildren.push((this||_global$d).children[i]);(this||_global$d).children=newChildren;}return this||_global$d;};/**
       * Call String.prototype.replace on the very right-most source snippet. Useful
       * for trimming whitespace from the end of a source node, etc.
       *
       * @param aPattern The pattern to replace.
       * @param aReplacement The thing to replace the pattern with.
       */SourceNode.prototype.replaceRight=function SourceNode_replaceRight(aPattern,aReplacement){var lastChild=(this||_global$d).children[(this||_global$d).children.length-1];if(lastChild[isSourceNode]){lastChild.replaceRight(aPattern,aReplacement);}else if(typeof lastChild==="string"){(this||_global$d).children[(this||_global$d).children.length-1]=lastChild.replace(aPattern,aReplacement);}else{(this||_global$d).children.push("".replace(aPattern,aReplacement));}return this||_global$d;};/**
       * Set the source content for a source file. This will be added to the SourceMapGenerator
       * in the sourcesContent field.
       *
       * @param aSourceFile The filename of the source file
       * @param aSourceContent The content of the source file
       */SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(aSourceFile,aSourceContent){(this||_global$d).sourceContents[util$3.toSetString(aSourceFile)]=aSourceContent;};/**
       * Walk over the tree of SourceNodes. The walking function is called for each
       * source file content and is passed the filename and source content.
       *
       * @param aFn The traversal function.
       */SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(aFn){for(var i=0,len=(this||_global$d).children.length;i<len;i++){if((this||_global$d).children[i][isSourceNode]){(this||_global$d).children[i].walkSourceContents(aFn);}}var sources=Object.keys((this||_global$d).sourceContents);for(var i=0,len=sources.length;i<len;i++){aFn(util$3.fromSetString(sources[i]),(this||_global$d).sourceContents[sources[i]]);}};/**
       * Return the string representation of this source node. Walks over the tree
       * and concatenates all the various snippets together to one string.
       */SourceNode.prototype.toString=function SourceNode_toString(){var str="";this.walk(function(chunk){str+=chunk;});return str;};/**
       * Returns the string representation of this source node along with a source
       * map.
       */SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(aArgs){var generated={code:"",line:1,column:0};var map=new SourceMapGenerator$1(aArgs);var sourceMappingActive=false;var lastOriginalSource=null;var lastOriginalLine=null;var lastOriginalColumn=null;var lastOriginalName=null;this.walk(function(chunk,original){generated.code+=chunk;if(original.source!==null&&original.line!==null&&original.column!==null){if(lastOriginalSource!==original.source||lastOriginalLine!==original.line||lastOriginalColumn!==original.column||lastOriginalName!==original.name){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name});}lastOriginalSource=original.source;lastOriginalLine=original.line;lastOriginalColumn=original.column;lastOriginalName=original.name;sourceMappingActive=true;}else if(sourceMappingActive){map.addMapping({generated:{line:generated.line,column:generated.column}});lastOriginalSource=null;sourceMappingActive=false;}for(var idx=0,length=chunk.length;idx<length;idx++){if(chunk.charCodeAt(idx)===NEWLINE_CODE){generated.line++;generated.column=0;// Mappings end at eol
if(idx+1===length){lastOriginalSource=null;sourceMappingActive=false;}else if(sourceMappingActive){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name});}}else{generated.column++;}}});this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent);});return{code:generated.code,map:map};};exports$17.SourceNode=SourceNode;var exports$1$p={};/*
       * Copyright 2009-2011 Mozilla Foundation and contributors
       * Licensed under the New BSD license. See LICENSE.txt or:
       * http://opensource.org/licenses/BSD-3-Clause
       */exports$1$p.SourceMapGenerator=exports$1$n.SourceMapGenerator;exports$1$p.SourceMapConsumer=exports$2$8.SourceMapConsumer;exports$1$p.SourceNode=exports$17.SourceNode;for(var r$1={byteLength:function byteLength(r){var t=u$1(r),e=t[0],n=t[1];return 3*(e+n)/4-n;},toByteArray:function toByteArray(r){var t,o,a=u$1(r),h=a[0],c=a[1],d=new n$1(function(r,t,e){return 3*(t+e)/4-e;}(0,h,c)),f=0,A=c>0?h-4:h;for(o=0;o<A;o+=4){t=e$1[r.charCodeAt(o)]<<18|e$1[r.charCodeAt(o+1)]<<12|e$1[r.charCodeAt(o+2)]<<6|e$1[r.charCodeAt(o+3)],d[f++]=t>>16&255,d[f++]=t>>8&255,d[f++]=255&t;}2===c&&(t=e$1[r.charCodeAt(o)]<<2|e$1[r.charCodeAt(o+1)]>>4,d[f++]=255&t);1===c&&(t=e$1[r.charCodeAt(o)]<<10|e$1[r.charCodeAt(o+1)]<<4|e$1[r.charCodeAt(o+2)]>>2,d[f++]=t>>8&255,d[f++]=255&t);return d;},fromByteArray:function fromByteArray(r){for(var e,n=r.length,o=n%3,a=[],h=0,u=n-o;h<u;h+=16383){a.push(c$1(r,h,h+16383>u?u:h+16383));}1===o?(e=r[n-1],a.push(t$1[e>>2]+t$1[e<<4&63]+"==")):2===o&&(e=(r[n-2]<<8)+r[n-1],a.push(t$1[e>>10]+t$1[e>>4&63]+t$1[e<<2&63]+"="));return a.join("");}},t$1=[],e$1=[],n$1="undefined"!=typeof Uint8Array?Uint8Array:Array,o$1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a$1=0,h$4=o$1.length;a$1<h$4;++a$1){t$1[a$1]=o$1[a$1],e$1[o$1.charCodeAt(a$1)]=a$1;}function u$1(r){var t=r.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=r.indexOf("=");return-1===e&&(e=t),[e,e===t?0:4-e%4];}function c$1(r,e,n){for(var o,a,h=[],u=e;u<n;u+=3){o=(r[u]<<16&16711680)+(r[u+1]<<8&65280)+(255&r[u+2]),h.push(t$1[(a=o)>>18&63]+t$1[a>>12&63]+t$1[a>>6&63]+t$1[63&a]);}return h.join("");}e$1["-".charCodeAt(0)]=62,e$1["_".charCodeAt(0)]=63;var a$1$1={read:function read(a,t,o,r,h){var M,f,p=8*h-r-1,w=(1<<p)-1,e=w>>1,i=-7,N=o?h-1:0,n=o?-1:1,u=a[t+N];for(N+=n,M=u&(1<<-i)-1,u>>=-i,i+=p;i>0;M=256*M+a[t+N],N+=n,i-=8){;}for(f=M&(1<<-i)-1,M>>=-i,i+=r;i>0;f=256*f+a[t+N],N+=n,i-=8){;}if(0===M)M=1-e;else{if(M===w)return f?NaN:1/0*(u?-1:1);f+=Math.pow(2,r),M-=e;}return(u?-1:1)*f*Math.pow(2,M-r);},write:function write(a,t,o,r,h,M){var f,p,w,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,u=r?0:M-1,l=r?1:-1,s=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(p=isNaN(t)?1:0,f=i):(f=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-f))<1&&(f--,w*=2),(t+=f+N>=1?n/w:n*Math.pow(2,1-N))*w>=2&&(f++,w/=2),f+N>=i?(p=0,f=i):f+N>=1?(p=(t*w-1)*Math.pow(2,h),f+=N):(p=t*Math.pow(2,N-1)*Math.pow(2,h),f=0));h>=8;a[o+u]=255&p,u+=l,p/=256,h-=8){;}for(f=f<<h|p,e+=h;e>0;a[o+u]=255&f,u+=l,f/=256,e-=8){;}a[o+u-l]|=128*s;}};var e$1$1={},n$1$1=r$1,i$1=a$1$1,o$1$1="function"==typeof Symbol&&"function"==typeof Symbol["for"]?Symbol["for"]("nodejs.util.inspect.custom"):null;e$1$1.Buffer=u$1$1,e$1$1.SlowBuffer=function(t){+t!=t&&(t=0);return u$1$1.alloc(+t);},e$1$1.INSPECT_MAX_BYTES=50;function f$1(t){if(t>2147483647)throw new RangeError('The value "'+t+'" is invalid for option "size"');var r=new Uint8Array(t);return Object.setPrototypeOf(r,u$1$1.prototype),r;}function u$1$1(t,r,e){if("number"==typeof t){if("string"==typeof r)throw new TypeError('The "string" argument must be of type string. Received type number');return a$2(t);}return s$1(t,r,e);}function s$1(t,r,e){if("string"==typeof t)return function(t,r){"string"==typeof r&&""!==r||(r="utf8");if(!u$1$1.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var e=0|y(t,r),n=f$1(e),i=n.write(t,r);i!==e&&(n=n.slice(0,i));return n;}(t,r);if(ArrayBuffer.isView(t))return p$1(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+_typeof2(t));if(F(t,ArrayBuffer)||t&&F(t.buffer,ArrayBuffer))return c$1$1(t,r,e);if("undefined"!=typeof SharedArrayBuffer&&(F(t,SharedArrayBuffer)||t&&F(t.buffer,SharedArrayBuffer)))return c$1$1(t,r,e);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return u$1$1.from(n,r,e);var i=function(t){if(u$1$1.isBuffer(t)){var r=0|l$1(t.length),e=f$1(r);return 0===e.length||t.copy(e,0,0,r),e;}if(void 0!==t.length)return"number"!=typeof t.length||N(t.length)?f$1(0):p$1(t);if("Buffer"===t.type&&Array.isArray(t.data))return p$1(t.data);}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return u$1$1.from(t[Symbol.toPrimitive]("string"),r,e);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+_typeof2(t));}function h$1$1(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"');}function a$2(t){return h$1$1(t),f$1(t<0?0:0|l$1(t));}function p$1(t){for(var r=t.length<0?0:0|l$1(t.length),e=f$1(r),n=0;n<r;n+=1){e[n]=255&t[n];}return e;}function c$1$1(t,r,e){if(r<0||t.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<r+(e||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===r&&void 0===e?new Uint8Array(t):void 0===e?new Uint8Array(t,r):new Uint8Array(t,r,e),Object.setPrototypeOf(n,u$1$1.prototype),n;}function l$1(t){if(t>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|t;}function y(t,r){if(u$1$1.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||F(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+_typeof2(t));var e=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===e)return 0;for(var i=!1;;){switch(r){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":return _(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return z(t).length;default:if(i)return n?-1:_(t).length;r=(""+r).toLowerCase(),i=!0;}}}function g(t,r,e){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length)return"";if((void 0===e||e>this.length)&&(e=this.length),e<=0)return"";if((e>>>=0)<=(r>>>=0))return"";for(t||(t="utf8");;){switch(t){case"hex":return O(this,r,e);case"utf8":case"utf-8":return I(this,r,e);case"ascii":return S(this,r,e);case"latin1":case"binary":return R(this,r,e);case"base64":return T$1(this,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,r,e);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0;}}}function w(t,r,e){var n=t[r];t[r]=t[e],t[e]=n;}function d$1(t,r,e,n,i){if(0===t.length)return-1;if("string"==typeof e?(n=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),N(e=+e)&&(e=i?0:t.length-1),e<0&&(e=t.length+e),e>=t.length){if(i)return-1;e=t.length-1;}else if(e<0){if(!i)return-1;e=0;}if("string"==typeof r&&(r=u$1$1.from(r,n)),u$1$1.isBuffer(r))return 0===r.length?-1:v(t,r,e,n,i);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,r,e):Uint8Array.prototype.lastIndexOf.call(t,r,e):v(t,[r],e,n,i);throw new TypeError("val must be string, number or Buffer");}function v(t,r,e,n,i){var o,f=1,u=t.length,s=r.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||r.length<2)return-1;f=2,u/=2,s/=2,e/=2;}function h(t,r){return 1===f?t[r]:t.readUInt16BE(r*f);}if(i){var a=-1;for(o=e;o<u;o++){if(h(t,o)===h(r,-1===a?0:o-a)){if(-1===a&&(a=o),o-a+1===s)return a*f;}else-1!==a&&(o-=o-a),a=-1;}}else for(e+s>u&&(e=u-s),o=e;o>=0;o--){for(var p=!0,c=0;c<s;c++){if(h(t,o+c)!==h(r,c)){p=!1;break;}}if(p)return o;}return-1;}function b(t,r,e,n){e=Number(e)||0;var i=t.length-e;n?(n=Number(n))>i&&(n=i):n=i;var o=r.length;n>o/2&&(n=o/2);for(var f=0;f<n;++f){var u=parseInt(r.substr(2*f,2),16);if(N(u))return f;t[e+f]=u;}return f;}function m$1(t,r,e,n){return D(_(r,t.length-e),t,e,n);}function E(t,r,e,n){return D(function(t){for(var r=[],e=0;e<t.length;++e){r.push(255&t.charCodeAt(e));}return r;}(r),t,e,n);}function B$1(t,r,e,n){return E(t,r,e,n);}function A$1(t,r,e,n){return D(z(r),t,e,n);}function U(t,r,e,n){return D(function(t,r){for(var e,n,i,o=[],f=0;f<t.length&&!((r-=2)<0);++f){e=t.charCodeAt(f),n=e>>8,i=e%256,o.push(i),o.push(n);}return o;}(r,t.length-e),t,e,n);}function T$1(t,r,e){return 0===r&&e===t.length?n$1$1.fromByteArray(t):n$1$1.fromByteArray(t.slice(r,e));}function I(t,r,e){e=Math.min(t.length,e);for(var n=[],i=r;i<e;){var o,f,u,s,h=t[i],a=null,p=h>239?4:h>223?3:h>191?2:1;if(i+p<=e)switch(p){case 1:h<128&&(a=h);break;case 2:128==(192&(o=t[i+1]))&&(s=(31&h)<<6|63&o)>127&&(a=s);break;case 3:o=t[i+1],f=t[i+2],128==(192&o)&&128==(192&f)&&(s=(15&h)<<12|(63&o)<<6|63&f)>2047&&(s<55296||s>57343)&&(a=s);break;case 4:o=t[i+1],f=t[i+2],u=t[i+3],128==(192&o)&&128==(192&f)&&128==(192&u)&&(s=(15&h)<<18|(63&o)<<12|(63&f)<<6|63&u)>65535&&s<1114112&&(a=s);}null===a?(a=65533,p=1):a>65535&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=p;}return function(t){var r=t.length;if(r<=4096)return String.fromCharCode.apply(String,t);var e="",n=0;for(;n<r;){e+=String.fromCharCode.apply(String,t.slice(n,n+=4096));}return e;}(n);}e$1$1.kMaxLength=2147483647,u$1$1.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),r={foo:function foo(){return 42;}};return Object.setPrototypeOf(r,Uint8Array.prototype),Object.setPrototypeOf(t,r),42===t.foo();}catch(t){return!1;}}(),u$1$1.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u$1$1.prototype,"parent",{enumerable:!0,get:function get(){if(u$1$1.isBuffer(this))return this.buffer;}}),Object.defineProperty(u$1$1.prototype,"offset",{enumerable:!0,get:function get(){if(u$1$1.isBuffer(this))return this.byteOffset;}}),u$1$1.poolSize=8192,u$1$1.from=function(t,r,e){return s$1(t,r,e);},Object.setPrototypeOf(u$1$1.prototype,Uint8Array.prototype),Object.setPrototypeOf(u$1$1,Uint8Array),u$1$1.alloc=function(t,r,e){return function(t,r,e){return h$1$1(t),t<=0?f$1(t):void 0!==r?"string"==typeof e?f$1(t).fill(r,e):f$1(t).fill(r):f$1(t);}(t,r,e);},u$1$1.allocUnsafe=function(t){return a$2(t);},u$1$1.allocUnsafeSlow=function(t){return a$2(t);},u$1$1.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==u$1$1.prototype;},u$1$1.compare=function(t,r){if(F(t,Uint8Array)&&(t=u$1$1.from(t,t.offset,t.byteLength)),F(r,Uint8Array)&&(r=u$1$1.from(r,r.offset,r.byteLength)),!u$1$1.isBuffer(t)||!u$1$1.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;for(var e=t.length,n=r.length,i=0,o=Math.min(e,n);i<o;++i){if(t[i]!==r[i]){e=t[i],n=r[i];break;}}return e<n?-1:n<e?1:0;},u$1$1.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1;}},u$1$1.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u$1$1.alloc(0);var e;if(void 0===r)for(r=0,e=0;e<t.length;++e){r+=t[e].length;}var n=u$1$1.allocUnsafe(r),i=0;for(e=0;e<t.length;++e){var o=t[e];if(F(o,Uint8Array)&&(o=u$1$1.from(o)),!u$1$1.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length;}return n;},u$1$1.byteLength=y,u$1$1.prototype._isBuffer=!0,u$1$1.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2){w(this,r,r+1);}return this;},u$1$1.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4){w(this,r,r+3),w(this,r+1,r+2);}return this;},u$1$1.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8){w(this,r,r+7),w(this,r+1,r+6),w(this,r+2,r+5),w(this,r+3,r+4);}return this;},u$1$1.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?I(this,0,t):g.apply(this,arguments);},u$1$1.prototype.toLocaleString=u$1$1.prototype.toString,u$1$1.prototype.equals=function(t){if(!u$1$1.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u$1$1.compare(this,t);},u$1$1.prototype.inspect=function(){var t="",r=e$1$1.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">";},o$1$1&&(u$1$1.prototype[o$1$1]=u$1$1.prototype.inspect),u$1$1.prototype.compare=function(t,r,e,n,i){if(F(t,Uint8Array)&&(t=u$1$1.from(t,t.offset,t.byteLength)),!u$1$1.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+_typeof2(t));if(void 0===r&&(r=0),void 0===e&&(e=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),r<0||e>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&r>=e)return 0;if(n>=i)return-1;if(r>=e)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),f=(e>>>=0)-(r>>>=0),s=Math.min(o,f),h=this.slice(n,i),a=t.slice(r,e),p=0;p<s;++p){if(h[p]!==a[p]){o=h[p],f=a[p];break;}}return o<f?-1:f<o?1:0;},u$1$1.prototype.includes=function(t,r,e){return-1!==this.indexOf(t,r,e);},u$1$1.prototype.indexOf=function(t,r,e){return d$1(this,t,r,e,!0);},u$1$1.prototype.lastIndexOf=function(t,r,e){return d$1(this,t,r,e,!1);},u$1$1.prototype.write=function(t,r,e,n){if(void 0===r)n="utf8",e=this.length,r=0;else if(void 0===e&&"string"==typeof r)n=r,e=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r>>>=0,isFinite(e)?(e>>>=0,void 0===n&&(n="utf8")):(n=e,e=void 0);}var i=this.length-r;if((void 0===e||e>i)&&(e=i),t.length>0&&(e<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;){switch(n){case"hex":return b(this,t,r,e);case"utf8":case"utf-8":return m$1(this,t,r,e);case"ascii":return E(this,t,r,e);case"latin1":case"binary":return B$1(this,t,r,e);case"base64":return A$1(this,t,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,t,r,e);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0;}}},u$1$1.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)};};function S(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i){n+=String.fromCharCode(127&t[i]);}return n;}function R(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i){n+=String.fromCharCode(t[i]);}return n;}function O(t,r,e){var n=t.length;(!r||r<0)&&(r=0),(!e||e<0||e>n)&&(e=n);for(var i="",o=r;o<e;++o){i+=Y[t[o]];}return i;}function L(t,r,e){for(var n=t.slice(r,e),i="",o=0;o<n.length;o+=2){i+=String.fromCharCode(n[o]+256*n[o+1]);}return i;}function x(t,r,e){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+r>e)throw new RangeError("Trying to access beyond buffer length");}function C$1(t,r,e,n,i,o){if(!u$1$1.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>i||r<o)throw new RangeError('"value" argument is out of bounds');if(e+n>t.length)throw new RangeError("Index out of range");}function P(t,r,e,n,i,o){if(e+n>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range");}function k(t,r,e,n,o){return r=+r,e>>>=0,o||P(t,0,e,4),i$1.write(t,r,e,n,23,4),e+4;}function M(t,r,e,n,o){return r=+r,e>>>=0,o||P(t,0,e,8),i$1.write(t,r,e,n,52,8),e+8;}u$1$1.prototype.slice=function(t,r){var e=this.length;(t=~~t)<0?(t+=e)<0&&(t=0):t>e&&(t=e),(r=void 0===r?e:~~r)<0?(r+=e)<0&&(r=0):r>e&&(r=e),r<t&&(r=t);var n=this.subarray(t,r);return Object.setPrototypeOf(n,u$1$1.prototype),n;},u$1$1.prototype.readUIntLE=function(t,r,e){t>>>=0,r>>>=0,e||x(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);){n+=this[t+o]*i;}return n;},u$1$1.prototype.readUIntBE=function(t,r,e){t>>>=0,r>>>=0,e||x(t,r,this.length);for(var n=this[t+--r],i=1;r>0&&(i*=256);){n+=this[t+--r]*i;}return n;},u$1$1.prototype.readUInt8=function(t,r){return t>>>=0,r||x(t,1,this.length),this[t];},u$1$1.prototype.readUInt16LE=function(t,r){return t>>>=0,r||x(t,2,this.length),this[t]|this[t+1]<<8;},u$1$1.prototype.readUInt16BE=function(t,r){return t>>>=0,r||x(t,2,this.length),this[t]<<8|this[t+1];},u$1$1.prototype.readUInt32LE=function(t,r){return t>>>=0,r||x(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3];},u$1$1.prototype.readUInt32BE=function(t,r){return t>>>=0,r||x(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3]);},u$1$1.prototype.readIntLE=function(t,r,e){t>>>=0,r>>>=0,e||x(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);){n+=this[t+o]*i;}return n>=(i*=128)&&(n-=Math.pow(2,8*r)),n;},u$1$1.prototype.readIntBE=function(t,r,e){t>>>=0,r>>>=0,e||x(t,r,this.length);for(var n=r,i=1,o=this[t+--n];n>0&&(i*=256);){o+=this[t+--n]*i;}return o>=(i*=128)&&(o-=Math.pow(2,8*r)),o;},u$1$1.prototype.readInt8=function(t,r){return t>>>=0,r||x(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t];},u$1$1.prototype.readInt16LE=function(t,r){t>>>=0,r||x(t,2,this.length);var e=this[t]|this[t+1]<<8;return 32768&e?4294901760|e:e;},u$1$1.prototype.readInt16BE=function(t,r){t>>>=0,r||x(t,2,this.length);var e=this[t+1]|this[t]<<8;return 32768&e?4294901760|e:e;},u$1$1.prototype.readInt32LE=function(t,r){return t>>>=0,r||x(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24;},u$1$1.prototype.readInt32BE=function(t,r){return t>>>=0,r||x(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3];},u$1$1.prototype.readFloatLE=function(t,r){return t>>>=0,r||x(t,4,this.length),i$1.read(this,t,!0,23,4);},u$1$1.prototype.readFloatBE=function(t,r){return t>>>=0,r||x(t,4,this.length),i$1.read(this,t,!1,23,4);},u$1$1.prototype.readDoubleLE=function(t,r){return t>>>=0,r||x(t,8,this.length),i$1.read(this,t,!0,52,8);},u$1$1.prototype.readDoubleBE=function(t,r){return t>>>=0,r||x(t,8,this.length),i$1.read(this,t,!1,52,8);},u$1$1.prototype.writeUIntLE=function(t,r,e,n){(t=+t,r>>>=0,e>>>=0,n)||C$1(this,t,r,e,Math.pow(2,8*e)-1,0);var i=1,o=0;for(this[r]=255&t;++o<e&&(i*=256);){this[r+o]=t/i&255;}return r+e;},u$1$1.prototype.writeUIntBE=function(t,r,e,n){(t=+t,r>>>=0,e>>>=0,n)||C$1(this,t,r,e,Math.pow(2,8*e)-1,0);var i=e-1,o=1;for(this[r+i]=255&t;--i>=0&&(o*=256);){this[r+i]=t/o&255;}return r+e;},u$1$1.prototype.writeUInt8=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,1,255,0),this[r]=255&t,r+1;},u$1$1.prototype.writeUInt16LE=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,2,65535,0),this[r]=255&t,this[r+1]=t>>>8,r+2;},u$1$1.prototype.writeUInt16BE=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,2,65535,0),this[r]=t>>>8,this[r+1]=255&t,r+2;},u$1$1.prototype.writeUInt32LE=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,4,4294967295,0),this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t,r+4;},u$1$1.prototype.writeUInt32BE=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,4,4294967295,0),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t,r+4;},u$1$1.prototype.writeIntLE=function(t,r,e,n){if(t=+t,r>>>=0,!n){var i=Math.pow(2,8*e-1);C$1(this,t,r,e,i-1,-i);}var o=0,f=1,u=0;for(this[r]=255&t;++o<e&&(f*=256);){t<0&&0===u&&0!==this[r+o-1]&&(u=1),this[r+o]=(t/f>>0)-u&255;}return r+e;},u$1$1.prototype.writeIntBE=function(t,r,e,n){if(t=+t,r>>>=0,!n){var i=Math.pow(2,8*e-1);C$1(this,t,r,e,i-1,-i);}var o=e-1,f=1,u=0;for(this[r+o]=255&t;--o>=0&&(f*=256);){t<0&&0===u&&0!==this[r+o+1]&&(u=1),this[r+o]=(t/f>>0)-u&255;}return r+e;},u$1$1.prototype.writeInt8=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,1,127,-128),t<0&&(t=255+t+1),this[r]=255&t,r+1;},u$1$1.prototype.writeInt16LE=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,2,32767,-32768),this[r]=255&t,this[r+1]=t>>>8,r+2;},u$1$1.prototype.writeInt16BE=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,2,32767,-32768),this[r]=t>>>8,this[r+1]=255&t,r+2;},u$1$1.prototype.writeInt32LE=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,4,2147483647,-2147483648),this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24,r+4;},u$1$1.prototype.writeInt32BE=function(t,r,e){return t=+t,r>>>=0,e||C$1(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t,r+4;},u$1$1.prototype.writeFloatLE=function(t,r,e){return k(this,t,r,!0,e);},u$1$1.prototype.writeFloatBE=function(t,r,e){return k(this,t,r,!1,e);},u$1$1.prototype.writeDoubleLE=function(t,r,e){return M(this,t,r,!0,e);},u$1$1.prototype.writeDoubleBE=function(t,r,e){return M(this,t,r,!1,e);},u$1$1.prototype.copy=function(t,r,e,n){if(!u$1$1.isBuffer(t))throw new TypeError("argument should be a Buffer");if(e||(e=0),n||0===n||(n=this.length),r>=t.length&&(r=t.length),r||(r=0),n>0&&n<e&&(n=e),n===e)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(e<0||e>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-r<n-e&&(n=t.length-r+e);var i=n-e;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,e,n);else if(this===t&&e<r&&r<n)for(var o=i-1;o>=0;--o){t[o+r]=this[o+e];}else Uint8Array.prototype.set.call(t,this.subarray(e,n),r);return i;},u$1$1.prototype.fill=function(t,r,e,n){if("string"==typeof t){if("string"==typeof r?(n=r,r=0,e=this.length):"string"==typeof e&&(n=e,e=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u$1$1.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){var i=t.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(t=i);}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(r<0||this.length<r||this.length<e)throw new RangeError("Out of range index");if(e<=r)return this;var o;if(r>>>=0,e=void 0===e?this.length:e>>>0,t||(t=0),"number"==typeof t)for(o=r;o<e;++o){this[o]=t;}else{var f=u$1$1.isBuffer(t)?t:u$1$1.from(t,n),s=f.length;if(0===s)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<e-r;++o){this[o+r]=f[o%s];}}return this;};var j=/[^+/0-9A-Za-z-_]/g;function _(t,r){var e;r=r||1/0;for(var n=t.length,i=null,o=[],f=0;f<n;++f){if((e=t.charCodeAt(f))>55295&&e<57344){if(!i){if(e>56319){(r-=3)>-1&&o.push(239,191,189);continue;}if(f+1===n){(r-=3)>-1&&o.push(239,191,189);continue;}i=e;continue;}if(e<56320){(r-=3)>-1&&o.push(239,191,189),i=e;continue;}e=65536+(i-55296<<10|e-56320);}else i&&(r-=3)>-1&&o.push(239,191,189);if(i=null,e<128){if((r-=1)<0)break;o.push(e);}else if(e<2048){if((r-=2)<0)break;o.push(e>>6|192,63&e|128);}else if(e<65536){if((r-=3)<0)break;o.push(e>>12|224,e>>6&63|128,63&e|128);}else{if(!(e<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128);}}return o;}function z(t){return n$1$1.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(j,"")).length<2)return"";for(;t.length%4!=0;){t+="=";}return t;}(t));}function D(t,r,e,n){for(var i=0;i<n&&!(i+e>=r.length||i>=t.length);++i){r[i+e]=t[i];}return i;}function F(t,r){return t instanceof r||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===r.name;}function N(t){return t!=t;}var Y=function(){for(var t=new Array(256),r=0;r<16;++r){for(var e=16*r,n=0;n<16;++n){t[e+n]="0123456789abcdef"[r]+"0123456789abcdef"[n];}}return t;}();var exports$18={};var module$1={exports:exports$18};var Buffer=e$1$1.Buffer;(function(w){function findBest(atobNative){// normal window
if("function"===typeof atobNative){return atobNative;}// browserify (web worker)
if("function"===typeof Buffer){return function atobBrowserify(a){//!! Deliberately using an API that's deprecated in node.js because
//!! this file is for browsers and we expect them to cope with it.
//!! Discussion: github.com/node-browser-compat/atob/pull/9
return new Buffer(a,"base64").toString("binary");};}// ios web worker with base64js
if("object"===_typeof2(w.base64js)){// bufferToBinaryString
// https://git.coolaj86.com/coolaj86/unibabel.js/blob/master/index.js#L50
return function atobWebWorker_iOS(a){var buf=w.base64js.b64ToByteArray(a);return Array.prototype.map.call(buf,function(ch){return String.fromCharCode(ch);}).join("");};}return function(){// ios web worker without base64js
throw new Error("You're probably in an old browser or an iOS webworker."+" It might help to include beatgammit's base64-js.");};}var atobBest=findBest(w.atob);w.atob=atobBest;if(module$1.exports){module$1.exports=atobBest;}})(window);var browserAtob=module$1.exports;var t$2=2147483647,o$2=/^xn--/,n$2=/[^\0-\x7E]/,e$2=/[\x2E\u3002\uFF0E\uFF61]/g,r$2={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},c$2=Math.floor,s$2=String.fromCharCode;function i$2(t){throw new RangeError(r$2[t]);}function f$2(t,o){var n=t.split("@");var r="";n.length>1&&(r=n[0]+"@",t=n[1]);var c=function(t,o){var n=[];var e=t.length;for(;e--;){n[e]=o(t[e]);}return n;}((t=t.replace(e$2,".")).split("."),o).join(".");return r+c;}function l$2(t){var o=[];var n=0;var e=t.length;for(;n<e;){var _r7=t.charCodeAt(n++);if(_r7>=55296&&_r7<=56319&&n<e){var _e2=t.charCodeAt(n++);56320==(64512&_e2)?o.push(((1023&_r7)<<10)+(1023&_e2)+65536):(o.push(_r7),n--);}else o.push(_r7);}return o;}var u$2=function u$2(t,o){return t+22+75*(t<26)-((0!=o)<<5);},a$3=function a$3(t,o,n){var e=0;for(t=n?c$2(t/700):t>>1,t+=c$2(t/o);t>455;e+=36){t=c$2(t/35);}return c$2(e+36*t/(t+38));},d$2=function d$2(o){var n=[],e=o.length;var r=0,s=128,f=72,l=o.lastIndexOf("-");l<0&&(l=0);for(var _t2=0;_t2<l;++_t2){o.charCodeAt(_t2)>=128&&i$2("not-basic"),n.push(o.charCodeAt(_t2));}for(var _d4=l>0?l+1:0;_d4<e;){var _l2=r;for(var _n11=1,_s3=36;;_s3+=36){_d4>=e&&i$2("invalid-input");var _l3=(u=o.charCodeAt(_d4++))-48<10?u-22:u-65<26?u-65:u-97<26?u-97:36;(_l3>=36||_l3>c$2((t$2-r)/_n11))&&i$2("overflow"),r+=_l3*_n11;var _a6=_s3<=f?1:_s3>=f+26?26:_s3-f;if(_l3<_a6)break;var _h10=36-_a6;_n11>c$2(t$2/_h10)&&i$2("overflow"),_n11*=_h10;}var _h9=n.length+1;f=a$3(r-_l2,_h9,0==_l2),c$2(r/_h9)>t$2-s&&i$2("overflow"),s+=c$2(r/_h9),r%=_h9,n.splice(r++,0,s);}var u;return String.fromCodePoint.apply(String,n);},h$5=function h$5(o){var n=[];var e=(o=l$2(o)).length,r=128,f=0,d=72;var _iterator88=_createForOfIteratorHelper(o),_step88;try{for(_iterator88.s();!(_step88=_iterator88.n()).done;){var _t5=_step88.value;_t5<128&&n.push(s$2(_t5));}}catch(err){_iterator88.e(err);}finally{_iterator88.f();}var h=n.length,p=h;for(h&&n.push("-");p<e;){var _e3=t$2;var _iterator89=_createForOfIteratorHelper(o),_step89;try{for(_iterator89.s();!(_step89=_iterator89.n()).done;){var _t3=_step89.value;_t3>=r&&_t3<_e3&&(_e3=_t3);}}catch(err){_iterator89.e(err);}finally{_iterator89.f();}var _l4=p+1;_e3-r>c$2((t$2-f)/_l4)&&i$2("overflow"),f+=(_e3-r)*_l4,r=_e3;var _iterator90=_createForOfIteratorHelper(o),_step90;try{for(_iterator90.s();!(_step90=_iterator90.n()).done;){var _e4=_step90.value;if(_e4<r&&++f>t$2&&i$2("overflow"),_e4==r){var _t4=f;for(var _o2=36;;_o2+=36){var _e5=_o2<=d?1:_o2>=d+26?26:_o2-d;if(_t4<_e5)break;var _r8=_t4-_e5,_i185=36-_e5;n.push(s$2(u$2(_e5+_r8%_i185,0))),_t4=c$2(_r8/_i185);}n.push(s$2(u$2(_t4,0))),d=a$3(f,_l4,p==h),f=0,++p;}}}catch(err){_iterator90.e(err);}finally{_iterator90.f();}++f,++r;}return n.join("");};var p$2={version:"2.1.0",ucs2:{decode:l$2,encode:function encode(t){return String.fromCodePoint.apply(String,_toConsumableArray2(t));}},decode:d$2,encode:h$5,toASCII:function toASCII(t){return f$2(t,function(t){return n$2.test(t)?"xn--"+h$5(t):t;});},toUnicode:function toUnicode(t){return f$2(t,function(t){return o$2.test(t)?d$2(t.slice(4).toLowerCase()):t;});}};function e$3(e,n){return Object.prototype.hasOwnProperty.call(e,n);}var n$3=function n$3(n,r,t,o){r=r||"&",t=t||"=";var a={};if("string"!=typeof n||0===n.length)return a;var u=/\+/g;n=n.split(r);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var i=n.length;c>0&&i>c&&(i=c);for(var s=0;s<i;++s){var p,f,d,y,m=n[s].replace(u,"%20"),l=m.indexOf(t);l>=0?(p=m.substr(0,l),f=m.substr(l+1)):(p=m,f=""),d=decodeURIComponent(p),y=decodeURIComponent(f),e$3(a,d)?Array.isArray(a[d])?a[d].push(y):a[d]=[a[d],y]:a[d]=y;}return a;},r$3=function r$3(e){switch(_typeof2(e)){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return"";}},t$3=function t$3(e,n,t,o){return n=n||"&",t=t||"=",null===e&&(e=void 0),"object"==_typeof2(e)?Object.keys(e).map(function(o){var a=encodeURIComponent(r$3(o))+t;return Array.isArray(e[o])?e[o].map(function(e){return a+encodeURIComponent(r$3(e));}).join(n):a+encodeURIComponent(r$3(e[o]));}).join(n):o?encodeURIComponent(r$3(o))+t+encodeURIComponent(r$3(e)):"";},o$3={};o$3.decode=o$3.parse=n$3,o$3.encode=o$3.stringify=t$3;var h$6={},e$4=p$2,a$4={isString:function isString(t){return"string"==typeof t;},isObject:function isObject(t){return"object"==_typeof2(t)&&null!==t;},isNull:function isNull(t){return null===t;},isNullOrUndefined:function isNullOrUndefined(t){return null==t;}};function r$4(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null;}h$6.parse=O$1,h$6.resolve=function(t,s){return O$1(t,!1,!0).resolve(s);},h$6.resolveObject=function(t,s){return t?O$1(t,!1,!0).resolveObject(s):s;},h$6.format=function(t){a$4.isString(t)&&(t=O$1(t));return t instanceof r$4?t.format():r$4.prototype.format.call(t);},h$6.Url=r$4;var o$4=/^([a-z0-9.+-]+:)/i,n$4=/:[0-9]*$/,i$3=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l$3=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),p$3=["'"].concat(l$3),c$3=["%","/","?",";","#"].concat(p$3),u$3=["/","?","#"],f$3=/^[+a-z0-9A-Z_-]{0,63}$/,m$2=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v$1={javascript:!0,"javascript:":!0},g$1={javascript:!0,"javascript:":!0},y$1={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b$1=o$3;function O$1(t,s,h){if(t&&a$4.isObject(t)&&t instanceof r$4)return t;var e=new r$4();return e.parse(t,s,h),e;}r$4.prototype.parse=function(t,s,h){if(!a$4.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+_typeof2(t));var r=t.indexOf("?"),n=-1!==r&&r<t.indexOf("#")?"?":"#",l=t.split(n);l[0]=l[0].replace(/\\/g,"/");var O=t=l.join(n);if(O=O.trim(),!h&&1===t.split("#").length){var d=i$3.exec(O);if(d)return this.path=O,this.href=O,this.pathname=d[1],d[2]?(this.search=d[2],this.query=s?b$1.parse(this.search.substr(1)):this.search.substr(1)):s&&(this.search="",this.query={}),this;}var j=o$4.exec(O);if(j){var q=(j=j[0]).toLowerCase();this.protocol=q,O=O.substr(j.length);}if(h||j||O.match(/^\/\/[^@\/]+@[^@\/]+/)){var x="//"===O.substr(0,2);!x||j&&g$1[j]||(O=O.substr(2),this.slashes=!0);}if(!g$1[j]&&(x||j&&!y$1[j])){for(var A,C,I=-1,w=0;w<u$3.length;w++){-1!==(N=O.indexOf(u$3[w]))&&(-1===I||N<I)&&(I=N);}-1!==(C=-1===I?O.lastIndexOf("@"):O.lastIndexOf("@",I))&&(A=O.slice(0,C),O=O.slice(C+1),this.auth=decodeURIComponent(A)),I=-1;for(w=0;w<c$3.length;w++){var N;-1!==(N=O.indexOf(c$3[w]))&&(-1===I||N<I)&&(I=N);}-1===I&&(I=O.length),this.host=O.slice(0,I),O=O.slice(I),this.parseHost(),this.hostname=this.hostname||"";var U="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!U)for(var k=this.hostname.split(/\./),S=(w=0,k.length);w<S;w++){var R=k[w];if(R&&!R.match(f$3)){for(var $="",z=0,H=R.length;z<H;z++){R.charCodeAt(z)>127?$+="x":$+=R[z];}if(!$.match(f$3)){var L=k.slice(0,w),Z=k.slice(w+1),_=R.match(m$2);_&&(L.push(_[1]),Z.unshift(_[2])),Z.length&&(O="/"+Z.join(".")+O),this.hostname=L.join(".");break;}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),U||(this.hostname=e$4.toASCII(this.hostname));var E=this.port?":"+this.port:"",P=this.hostname||"";this.host=P+E,this.href+=this.host,U&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==O[0]&&(O="/"+O));}if(!v$1[q])for(w=0,S=p$3.length;w<S;w++){var T=p$3[w];if(-1!==O.indexOf(T)){var B=encodeURIComponent(T);B===T&&(B=escape(T)),O=O.split(T).join(B);}}var D=O.indexOf("#");-1!==D&&(this.hash=O.substr(D),O=O.slice(0,D));var F=O.indexOf("?");if(-1!==F?(this.search=O.substr(F),this.query=O.substr(F+1),s&&(this.query=b$1.parse(this.query)),O=O.slice(0,F)):s&&(this.search="",this.query={}),O&&(this.pathname=O),y$1[q]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){E=this.pathname||"";var G=this.search||"";this.path=E+G;}return this.href=this.format(),this;},r$4.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var s=this.protocol||"",h=this.pathname||"",e=this.hash||"",r=!1,o="";this.host?r=t+this.host:this.hostname&&(r=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&a$4.isObject(this.query)&&Object.keys(this.query).length&&(o=b$1.stringify(this.query));var n=this.search||o&&"?"+o||"";return s&&":"!==s.substr(-1)&&(s+=":"),this.slashes||(!s||y$1[s])&&!1!==r?(r="//"+(r||""),h&&"/"!==h.charAt(0)&&(h="/"+h)):r||(r=""),e&&"#"!==e.charAt(0)&&(e="#"+e),n&&"?"!==n.charAt(0)&&(n="?"+n),s+r+(h=h.replace(/[?#]/g,function(t){return encodeURIComponent(t);}))+(n=n.replace("#","%23"))+e;},r$4.prototype.resolve=function(t){return this.resolveObject(O$1(t,!1,!0)).format();},r$4.prototype.resolveObject=function(t){if(a$4.isString(t)){var s=new r$4();s.parse(t,!1,!0),t=s;}for(var h=new r$4(),e=Object.keys(this),o=0;o<e.length;o++){var n=e[o];h[n]=this[n];}if(h.hash=t.hash,""===t.href)return h.href=h.format(),h;if(t.slashes&&!t.protocol){for(var i=Object.keys(t),l=0;l<i.length;l++){var p=i[l];"protocol"!==p&&(h[p]=t[p]);}return y$1[h.protocol]&&h.hostname&&!h.pathname&&(h.path=h.pathname="/"),h.href=h.format(),h;}if(t.protocol&&t.protocol!==h.protocol){if(!y$1[t.protocol]){for(var c=Object.keys(t),u=0;u<c.length;u++){var f=c[u];h[f]=t[f];}return h.href=h.format(),h;}if(h.protocol=t.protocol,t.host||g$1[t.protocol])h.pathname=t.pathname;else{for(var m=(t.pathname||"").split("/");m.length&&!(t.host=m.shift());){;}t.host||(t.host=""),t.hostname||(t.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),h.pathname=m.join("/");}if(h.search=t.search,h.query=t.query,h.host=t.host||"",h.auth=t.auth,h.hostname=t.hostname||t.host,h.port=t.port,h.pathname||h.search){var v=h.pathname||"",b=h.search||"";h.path=v+b;}return h.slashes=h.slashes||t.slashes,h.href=h.format(),h;}var O=h.pathname&&"/"===h.pathname.charAt(0),d=t.host||t.pathname&&"/"===t.pathname.charAt(0),j=d||O||h.host&&t.pathname,q=j,x=h.pathname&&h.pathname.split("/")||[],A=(m=t.pathname&&t.pathname.split("/")||[],h.protocol&&!y$1[h.protocol]);if(A&&(h.hostname="",h.port=null,h.host&&(""===x[0]?x[0]=h.host:x.unshift(h.host)),h.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===m[0]?m[0]=t.host:m.unshift(t.host)),t.host=null),j=j&&(""===m[0]||""===x[0])),d)h.host=t.host||""===t.host?t.host:h.host,h.hostname=t.hostname||""===t.hostname?t.hostname:h.hostname,h.search=t.search,h.query=t.query,x=m;else if(m.length)x||(x=[]),x.pop(),x=x.concat(m),h.search=t.search,h.query=t.query;else if(!a$4.isNullOrUndefined(t.search)){if(A)h.hostname=h.host=x.shift(),(U=!!(h.host&&h.host.indexOf("@")>0)&&h.host.split("@"))&&(h.auth=U.shift(),h.host=h.hostname=U.shift());return h.search=t.search,h.query=t.query,a$4.isNull(h.pathname)&&a$4.isNull(h.search)||(h.path=(h.pathname?h.pathname:"")+(h.search?h.search:"")),h.href=h.format(),h;}if(!x.length)return h.pathname=null,h.search?h.path="/"+h.search:h.path=null,h.href=h.format(),h;for(var C=x.slice(-1)[0],I=(h.host||t.host||x.length>1)&&("."===C||".."===C)||""===C,w=0,N=x.length;N>=0;N--){"."===(C=x[N])?x.splice(N,1):".."===C?(x.splice(N,1),w++):w&&(x.splice(N,1),w--);}if(!j&&!q)for(;w--;w){x.unshift("..");}!j||""===x[0]||x[0]&&"/"===x[0].charAt(0)||x.unshift(""),I&&"/"!==x.join("/").substr(-1)&&x.push("");var U,k=""===x[0]||x[0]&&"/"===x[0].charAt(0);A&&(h.hostname=h.host=k?"":x.length?x.shift():"",(U=!!(h.host&&h.host.indexOf("@")>0)&&h.host.split("@"))&&(h.auth=U.shift(),h.host=h.hostname=U.shift()));return(j=j||h.host&&x.length)&&!k&&x.unshift(""),x.length?h.pathname=x.join("/"):(h.pathname=null,h.path=null),a$4.isNull(h.pathname)&&a$4.isNull(h.search)||(h.path=(h.pathname?h.pathname:"")+(h.search?h.search:"")),h.auth=t.auth||h.auth,h.slashes=h.slashes||t.slashes,h.href=h.format(),h;},r$4.prototype.parseHost=function(){var t=this.host,s=n$4.exec(t);s&&(":"!==(s=s[0])&&(this.port=s.substr(1)),t=t.substr(0,t.length-s.length)),t&&(this.hostname=t);};var r$5=T;function t$4(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e));}function n$5(e,r){for(var t,n="",i=0,l=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)t=e.charCodeAt(a);else{if(47===t)break;t=47;}if(47===t){if(l===a-1||1===o);else if(l!==a-1&&2===o){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var h=n.lastIndexOf("/");if(h!==n.length-1){-1===h?(n="",i=0):i=(n=n.slice(0,h)).length-1-n.lastIndexOf("/"),l=a,o=0;continue;}}else if(2===n.length||1===n.length){n="",i=0,l=a,o=0;continue;}r&&(n.length>0?n+="/..":n="..",i=2);}else n.length>0?n+="/"+e.slice(l+1,a):n=e.slice(l+1,a),i=a-l-1;l=a,o=0;}else 46===t&&-1!==o?++o:o=-1;}return n;}var i$4={resolve:function resolve(){for(var e,i="",l=!1,o=arguments.length-1;o>=-1&&!l;o--){var a;o>=0?a=arguments[o]:(void 0===e&&(e=r$5.cwd()),a=e),t$4(a),0!==a.length&&(i=a+"/"+i,l=47===a.charCodeAt(0));}return i=n$5(i,!l),l?i.length>0?"/"+i:"/":i.length>0?i:".";},normalize:function normalize(e){if(t$4(e),0===e.length)return".";var r=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=n$5(e,!r)).length||r||(e="."),e.length>0&&i&&(e+="/"),r?"/"+e:e;},isAbsolute:function isAbsolute(e){return t$4(e),e.length>0&&47===e.charCodeAt(0);},join:function join(){if(0===arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var n=arguments[r];t$4(n),n.length>0&&(void 0===e?e=n:e+="/"+n);}return void 0===e?".":i$4.normalize(e);},relative:function relative(e,r){if(t$4(e),t$4(r),e===r)return"";if((e=i$4.resolve(e))===(r=i$4.resolve(r)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n){;}for(var l=e.length,o=l-n,a=1;a<r.length&&47===r.charCodeAt(a);++a){;}for(var h=r.length-a,f=o<h?o:h,c=-1,s=0;s<=f;++s){if(s===f){if(h>f){if(47===r.charCodeAt(a+s))return r.slice(a+s+1);if(0===s)return r.slice(a+s);}else o>f&&(47===e.charCodeAt(n+s)?c=s:0===s&&(c=0));break;}var g=e.charCodeAt(n+s);if(g!==r.charCodeAt(a+s))break;47===g&&(c=s);}var u="";for(s=n+c+1;s<=l;++s){s!==l&&47!==e.charCodeAt(s)||(0===u.length?u+="..":u+="/..");}return u.length>0?u+r.slice(a+c):(a+=c,47===r.charCodeAt(a)&&++a,r.slice(a));},_makeLong:function _makeLong(e){return e;},dirname:function dirname(e){if(t$4(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,i=-1,l=!0,o=e.length-1;o>=1;--o){if(47===(r=e.charCodeAt(o))){if(!l){i=o;break;}}else l=!1;}return-1===i?n?"/":".":n&&1===i?"//":e.slice(0,i);},basename:function basename(e,r){if(void 0!==r&&"string"!=typeof r)throw new TypeError('"ext" argument must be a string');t$4(e);var n,i=0,l=-1,o=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var a=r.length-1,h=-1;for(n=e.length-1;n>=0;--n){var f=e.charCodeAt(n);if(47===f){if(!o){i=n+1;break;}}else-1===h&&(o=!1,h=n+1),a>=0&&(f===r.charCodeAt(a)?-1==--a&&(l=n):(a=-1,l=h));}return i===l?l=h:-1===l&&(l=e.length),e.slice(i,l);}for(n=e.length-1;n>=0;--n){if(47===e.charCodeAt(n)){if(!o){i=n+1;break;}}else-1===l&&(o=!1,l=n+1);}return-1===l?"":e.slice(i,l);},extname:function extname(e){t$4(e);for(var r=-1,n=0,i=-1,l=!0,o=0,a=e.length-1;a>=0;--a){var h=e.charCodeAt(a);if(47!==h)-1===i&&(l=!1,i=a+1),46===h?-1===r?r=a:1!==o&&(o=1):-1!==r&&(o=-1);else if(!l){n=a+1;break;}}return-1===r||-1===i||0===o||1===o&&r===i-1&&r===n+1?"":e.slice(r,i);},format:function format(e){if(null===e||"object"!=_typeof2(e))throw new TypeError('The "pathObject" argument must be of type Object. Received type '+_typeof2(e));return function(e,r){var t=r.dir||r.root,n=r.base||(r.name||"")+(r.ext||"");return t?t===r.root?t+n:t+e+n:n;}("/",e);},parse:function parse(e){t$4(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;var n,i=e.charCodeAt(0),l=47===i;l?(r.root="/",n=1):n=0;for(var o=-1,a=0,h=-1,f=!0,c=e.length-1,s=0;c>=n;--c){if(47!==(i=e.charCodeAt(c)))-1===h&&(f=!1,h=c+1),46===i?-1===o?o=c:1!==s&&(s=1):-1!==o&&(s=-1);else if(!f){a=c+1;break;}}return-1===o||-1===h||0===s||1===s&&o===h-1&&o===a+1?-1!==h&&(r.base=r.name=0===a&&l?e.slice(1,h):e.slice(a,h)):(0===a&&l?(r.name=e.slice(1,o),r.base=e.slice(1,h)):(r.name=e.slice(a,o),r.base=e.slice(a,h)),r.ext=e.slice(o,h)),a>0?r.dir=e.slice(0,a-1):l&&(r.dir="/"),r;},sep:"/",delimiter:":",win32:null,posix:null};i$4.posix=i$4;var l$4=i$4;var exports$19={};var token="%[a-f0-9]{2}";var singleMatcher=new RegExp(token,"gi");var multiMatcher=new RegExp("("+token+")+","gi");function decodeComponents(components,split){try{// Try to decode the entire string first
return decodeURIComponent(components.join(""));}catch(err){// Do nothing
}if(components.length===1){return components;}split=split||1;// Split the array in 2 parts
var left=components.slice(0,split);var right=components.slice(split);return Array.prototype.concat.call([],decodeComponents(left),decodeComponents(right));}function decode(input){try{return decodeURIComponent(input);}catch(err){var tokens=input.match(singleMatcher);for(var i=1;i<tokens.length;i++){input=decodeComponents(tokens,i).join("");tokens=input.match(singleMatcher);}return input;}}function customDecodeURIComponent(input){// Keep track of all the replacements and prefill the map with the `BOM`
var replaceMap={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"};var match=multiMatcher.exec(input);while(match){try{// Decode as big chunks as possible
replaceMap[match[0]]=decodeURIComponent(match[0]);}catch(err){var result=decode(match[0]);if(result!==match[0]){replaceMap[match[0]]=result;}}match=multiMatcher.exec(input);}// Add `%C2` at the end of the map to make sure it does not replace the combinator before everything else
replaceMap["%C2"]="\uFFFD";var entries=Object.keys(replaceMap);for(var i=0;i<entries.length;i++){// Replace all decoded components
var key=entries[i];input=input.replace(new RegExp(key,"g"),replaceMap[key]);}return input;}exports$19=function exports$19(encodedURI){if(typeof encodedURI!=="string"){throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+_typeof2(encodedURI)+"`");}try{encodedURI=encodedURI.replace(/\+/g," ");// Try the built in decoder first
return decodeURIComponent(encodedURI);}catch(err){// Fallback to a more advanced decoder
return customDecodeURIComponent(encodedURI);}};var exports$1$q=exports$19;var exports$1a={};var process$1=T;var atob$1=browserAtob;var urlLib=h$6;var pathLib=l$4;var decodeUriComponentLib=exports$1$q;function resolveUrl()/* ...urls */{return Array.prototype.reduce.call(arguments,function(resolved,nextUrl){return urlLib.resolve(resolved,nextUrl);});}function convertWindowsPath(aPath){return pathLib.sep==="\\"?aPath.replace(/\\/g,"/").replace(/^[a-z]:\/?/i,"/"):aPath;}function customDecodeUriComponent(string){// `decodeUriComponentLib` turns `+` into ` `, but that's not wanted.
return decodeUriComponentLib(string.replace(/\+/g,"%2B"));}function callbackAsync(callback,error,result){process$1.nextTick(function(){callback(error,result);});}function parseMapToJSON(string,data){try{return JSON.parse(string.replace(/^\)\]\}'/,""));}catch(error){error.sourceMapData=data;throw error;}}function readSync(read,url,data){var readUrl=customDecodeUriComponent(url);try{return String(read(readUrl));}catch(error){error.sourceMapData=data;throw error;}}var innerRegex=/[#@] sourceMappingURL=([^\s'"]*)/;var sourceMappingURLRegex=RegExp("(?:"+"/\\*"+"(?:\\s*\r?\n(?://)?)?"+"(?:"+innerRegex.source+")"+"\\s*"+"\\*/"+"|"+"//(?:"+innerRegex.source+")"+")"+"\\s*");function getSourceMappingUrl(code){var match=code.match(sourceMappingURLRegex);return match?match[1]||match[2]||"":null;}function resolveSourceMap(code,codeUrl,read,callback){var mapData;try{mapData=resolveSourceMapHelper(code,codeUrl);}catch(error){return callbackAsync(callback,error);}if(!mapData||mapData.map){return callbackAsync(callback,null,mapData);}var readUrl=customDecodeUriComponent(mapData.url);read(readUrl,function(error,result){if(error){error.sourceMapData=mapData;return callback(error);}mapData.map=String(result);try{mapData.map=parseMapToJSON(mapData.map,mapData);}catch(error){return callback(error);}callback(null,mapData);});}function resolveSourceMapSync(code,codeUrl,read){var mapData=resolveSourceMapHelper(code,codeUrl);if(!mapData||mapData.map){return mapData;}mapData.map=readSync(read,mapData.url,mapData);mapData.map=parseMapToJSON(mapData.map,mapData);return mapData;}var dataUriRegex=/^data:([^,;]*)(;[^,;]*)*(?:,(.*))?$/;/**
       * The media type for JSON text is application/json.
       *
       * {@link https://tools.ietf.org/html/rfc8259#section-11 | IANA Considerations }
       *
       * `text/json` is non-standard media type
       */var jsonMimeTypeRegex=/^(?:application|text)\/json$/;/**
       * JSON text exchanged between systems that are not part of a closed ecosystem
       * MUST be encoded using UTF-8.
       *
       * {@link https://tools.ietf.org/html/rfc8259#section-8.1 | Character Encoding}
       */var jsonCharacterEncoding="utf-8";function base64ToBuf(b64){var binStr=atob$1(b64);var len=binStr.length;var arr=new Uint8Array(len);for(var i=0;i<len;i++){arr[i]=binStr.charCodeAt(i);}return arr;}function decodeBase64String(b64){if(typeof TextDecoder==="undefined"||typeof Uint8Array==="undefined"){return atob$1(b64);}var buf=base64ToBuf(b64);// Note: `decoder.decode` method will throw a `DOMException` with the
// `"EncodingError"` value when an coding error is found.
var decoder=new TextDecoder(jsonCharacterEncoding,{fatal:true});return decoder.decode(buf);}function resolveSourceMapHelper(code,codeUrl){codeUrl=convertWindowsPath(codeUrl);var url=getSourceMappingUrl(code);if(!url){return null;}var dataUri=url.match(dataUriRegex);if(dataUri){var mimeType=dataUri[1]||"text/plain";var lastParameter=dataUri[2]||"";var encoded=dataUri[3]||"";var data={sourceMappingURL:url,url:null,sourcesRelativeTo:codeUrl,map:encoded};if(!jsonMimeTypeRegex.test(mimeType)){var error=new Error("Unuseful data uri mime type: "+mimeType);error.sourceMapData=data;throw error;}try{data.map=parseMapToJSON(lastParameter===";base64"?decodeBase64String(encoded):decodeURIComponent(encoded),data);}catch(error){error.sourceMapData=data;throw error;}return data;}var mapUrl=resolveUrl(codeUrl,url);return{sourceMappingURL:url,url:mapUrl,sourcesRelativeTo:mapUrl,map:null};}function resolveSources(map,mapUrl,read,options,callback){if(typeof options==="function"){callback=options;options={};}var pending=map.sources?map.sources.length:0;var result={sourcesResolved:[],sourcesContent:[]};if(pending===0){callbackAsync(callback,null,result);return;}var done=function done(){pending--;if(pending===0){callback(null,result);}};resolveSourcesHelper(map,mapUrl,options,function(fullUrl,sourceContent,index){result.sourcesResolved[index]=fullUrl;if(typeof sourceContent==="string"){result.sourcesContent[index]=sourceContent;callbackAsync(done,null);}else{var readUrl=customDecodeUriComponent(fullUrl);read(readUrl,function(error,source){result.sourcesContent[index]=error?error:String(source);done();});}});}function resolveSourcesSync(map,mapUrl,read,options){var result={sourcesResolved:[],sourcesContent:[]};if(!map.sources||map.sources.length===0){return result;}resolveSourcesHelper(map,mapUrl,options,function(fullUrl,sourceContent,index){result.sourcesResolved[index]=fullUrl;if(read!==null){if(typeof sourceContent==="string"){result.sourcesContent[index]=sourceContent;}else{var readUrl=customDecodeUriComponent(fullUrl);try{result.sourcesContent[index]=String(read(readUrl));}catch(error){result.sourcesContent[index]=error;}}}});return result;}var endingSlash=/\/?$/;function resolveSourcesHelper(map,mapUrl,options,fn){options=options||{};mapUrl=convertWindowsPath(mapUrl);var fullUrl;var sourceContent;var sourceRoot;for(var index=0,len=map.sources.length;index<len;index++){sourceRoot=null;if(typeof options.sourceRoot==="string"){sourceRoot=options.sourceRoot;}else if(typeof map.sourceRoot==="string"&&options.sourceRoot!==false){sourceRoot=map.sourceRoot;}// If the sourceRoot is the empty string, it is equivalent to not setting
// the property at all.
if(sourceRoot===null||sourceRoot===""){fullUrl=resolveUrl(mapUrl,map.sources[index]);}else{// Make sure that the sourceRoot ends with a slash, so that `/scripts/subdir` becomes
// `/scripts/subdir/<source>`, not `/scripts/<source>`. Pointing to a file as source root
// does not make sense.
fullUrl=resolveUrl(mapUrl,sourceRoot.replace(endingSlash,"/"),map.sources[index]);}sourceContent=(map.sourcesContent||[])[index];fn(fullUrl,sourceContent,index);}}function resolve(code,codeUrl,read,options,callback){if(typeof options==="function"){callback=options;options={};}if(code===null){var mapUrl=codeUrl;var data={sourceMappingURL:null,url:mapUrl,sourcesRelativeTo:mapUrl,map:null};var readUrl=customDecodeUriComponent(mapUrl);read(readUrl,function(error,result){if(error){error.sourceMapData=data;return callback(error);}data.map=String(result);try{data.map=parseMapToJSON(data.map,data);}catch(error){return callback(error);}_resolveSources(data);});}else{resolveSourceMap(code,codeUrl,read,function(error,mapData){if(error){return callback(error);}if(!mapData){return callback(null,null);}_resolveSources(mapData);});}function _resolveSources(mapData){resolveSources(mapData.map,mapData.sourcesRelativeTo,read,options,function(error,result){if(error){return callback(error);}mapData.sourcesResolved=result.sourcesResolved;mapData.sourcesContent=result.sourcesContent;callback(null,mapData);});}}function resolveSync(code,codeUrl,read,options){var mapData;if(code===null){var mapUrl=codeUrl;mapData={sourceMappingURL:null,url:mapUrl,sourcesRelativeTo:mapUrl,map:null};mapData.map=readSync(read,mapUrl,mapData);mapData.map=parseMapToJSON(mapData.map,mapData);}else{mapData=resolveSourceMapSync(code,codeUrl,read);if(!mapData){return null;}}var result=resolveSourcesSync(mapData.map,mapData.sourcesRelativeTo,read,options);mapData.sourcesResolved=result.sourcesResolved;mapData.sourcesContent=result.sourcesContent;return mapData;}exports$1a={resolveSourceMap:resolveSourceMap,resolveSourceMapSync:resolveSourceMapSync,resolveSources:resolveSources,resolveSourcesSync:resolveSourcesSync,resolve:resolve,resolveSync:resolveSync,parseMapToJSON:parseMapToJSON};var exports$1$r=exports$1a;var _resolveSourceMap=exports$1a.resolveSourceMap,_resolveSourceMapSync=exports$1a.resolveSourceMapSync,_resolveSources2=exports$1a.resolveSources,_resolveSourcesSync=exports$1a.resolveSourcesSync,_resolve=exports$1a.resolve,_resolveSync=exports$1a.resolveSync,_parseMapToJSON=exports$1a.parseMapToJSON;function unimplemented(){throw new Error("Node.js fs module is not supported by jspm core"+("undefined"!=typeof Deno?". Deno support here is tracking in https://github.com/jspm/jspm-core/issues/4, +1's are appreciated!":" in the browser"));}var promises={access:unimplemented,copyFile:unimplemented,open:unimplemented,opendir:unimplemented,rename:unimplemented,truncate:unimplemented,rmdir:unimplemented,mkdir:unimplemented,readdir:unimplemented,readlink:unimplemented,symlink:unimplemented,lstat:unimplemented,stat:unimplemented,link:unimplemented,unlink:unimplemented,chmod:unimplemented,lchmod:unimplemented,lchown:unimplemented,chown:unimplemented,utimes:unimplemented,realpath:unimplemented,mkdtemp:unimplemented,writeFile:unimplemented,appendFile:unimplemented,readFile:unimplemented};var fs={appendFile:unimplemented,appendFileSync:unimplemented,access:unimplemented,accessSync:unimplemented,chown:unimplemented,chownSync:unimplemented,chmod:unimplemented,chmodSync:unimplemented,close:unimplemented,closeSync:unimplemented,copyFile:unimplemented,copyFileSync:unimplemented,createReadStream:unimplemented,createWriteStream:unimplemented,exists:unimplemented,existsSync:unimplemented,fchown:unimplemented,fchownSync:unimplemented,fchmod:unimplemented,fchmodSync:unimplemented,fdatasync:unimplemented,fdatasyncSync:unimplemented,fstat:unimplemented,fstatSync:unimplemented,fsync:unimplemented,fsyncSync:unimplemented,ftruncate:unimplemented,ftruncateSync:unimplemented,futimes:unimplemented,futimesSync:unimplemented,lchown:unimplemented,lchownSync:unimplemented,lchmod:unimplemented,lchmodSync:unimplemented,link:unimplemented,linkSync:unimplemented,lstat:unimplemented,lstatSync:unimplemented,mkdir:unimplemented,mkdirSync:unimplemented,mkdtemp:unimplemented,mkdtempSync:unimplemented,open:unimplemented,openSync:unimplemented,opendir:unimplemented,opendirSync:unimplemented,readdir:unimplemented,readdirSync:unimplemented,read:unimplemented,readSync:unimplemented,readFile:unimplemented,readFileSync:unimplemented,readlink:unimplemented,readlinkSync:unimplemented,realpath:unimplemented,realpathSync:unimplemented,rename:unimplemented,renameSync:unimplemented,rmdir:unimplemented,rmdirSync:unimplemented,stat:unimplemented,statSync:unimplemented,symlink:unimplemented,symlinkSync:unimplemented,truncate:unimplemented,truncateSync:unimplemented,unwatchFile:unimplemented,unlink:unimplemented,unlinkSync:unimplemented,utimes:unimplemented,utimesSync:unimplemented,watch:unimplemented,watchFile:unimplemented,writeFile:unimplemented,writeFileSync:unimplemented,write:unimplemented,writeSync:unimplemented,writev:unimplemented,writevSync:unimplemented,Dir:unimplemented,Dirent:unimplemented,Stats:unimplemented,ReadStream:unimplemented,WriteStream:unimplemented,FileReadStream:unimplemented,FileWriteStream:unimplemented,_toUnixTimestamp:unimplemented,F_OK:null,R_OK:null,W_OK:null,X_OK:null,constants:null,promises:promises};var _global$e=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$1b={};/**
       * Module dependencies.
       */var Base$1=_compiler;var inherits$1=exports$1$k;/**
       * Expose compiler.
       */exports$1b=Compiler$2;/**
       * Initialize a new `Compiler`.
       */function Compiler$2(options){Base$1.call(this||_global$e,options);}/**
       * Inherit from `Base.prototype`.
       */inherits$1(Compiler$2,Base$1);/**
       * Compile `node`.
       */Compiler$2.prototype.compile=function(node){return node.stylesheet.rules.map((this||_global$e).visit,this||_global$e).join("");};/**
       * Visit comment node.
       */Compiler$2.prototype.comment=function(node){return this.emit("",node.position);};/**
       * Visit import node.
       */Compiler$2.prototype["import"]=function(node){return this.emit("@import "+node["import"]+";",node.position);};/**
       * Visit media node.
       */Compiler$2.prototype.media=function(node){return this.emit("@media "+node.media,node.position)+this.emit("{")+this.mapVisit(node.rules)+this.emit("}");};/**
       * Visit document node.
       */Compiler$2.prototype.document=function(node){var doc="@"+(node.vendor||"")+"document "+node.document;return this.emit(doc,node.position)+this.emit("{")+this.mapVisit(node.rules)+this.emit("}");};/**
       * Visit charset node.
       */Compiler$2.prototype.charset=function(node){return this.emit("@charset "+node.charset+";",node.position);};/**
       * Visit namespace node.
       */Compiler$2.prototype.namespace=function(node){return this.emit("@namespace "+node.namespace+";",node.position);};/**
       * Visit supports node.
       */Compiler$2.prototype.supports=function(node){return this.emit("@supports "+node.supports,node.position)+this.emit("{")+this.mapVisit(node.rules)+this.emit("}");};/**
       * Visit keyframes node.
       */Compiler$2.prototype.keyframes=function(node){return this.emit("@"+(node.vendor||"")+"keyframes "+node.name,node.position)+this.emit("{")+this.mapVisit(node.keyframes)+this.emit("}");};/**
       * Visit keyframe node.
       */Compiler$2.prototype.keyframe=function(node){var decls=node.declarations;return this.emit(node.values.join(","),node.position)+this.emit("{")+this.mapVisit(decls)+this.emit("}");};/**
       * Visit page node.
       */Compiler$2.prototype.page=function(node){var sel=node.selectors.length?node.selectors.join(", "):"";return this.emit("@page "+sel,node.position)+this.emit("{")+this.mapVisit(node.declarations)+this.emit("}");};/**
       * Visit font-face node.
       */Compiler$2.prototype["font-face"]=function(node){return this.emit("@font-face",node.position)+this.emit("{")+this.mapVisit(node.declarations)+this.emit("}");};/**
       * Visit host node.
       */Compiler$2.prototype.host=function(node){return this.emit("@host",node.position)+this.emit("{")+this.mapVisit(node.rules)+this.emit("}");};/**
       * Visit custom-media node.
       */Compiler$2.prototype["custom-media"]=function(node){return this.emit("@custom-media "+node.name+" "+node.media+";",node.position);};/**
       * Visit rule node.
       */Compiler$2.prototype.rule=function(node){var decls=node.declarations;if(!decls.length)return"";return this.emit(node.selectors.join(","),node.position)+this.emit("{")+this.mapVisit(decls)+this.emit("}");};/**
       * Visit declaration node.
       */Compiler$2.prototype.declaration=function(node){return this.emit(node.property+":"+node.value,node.position)+this.emit(";");};var _compress=exports$1b;var _global$1$3=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$1$s={};/**
       * Module dependencies.
       */var SourceMap=exports$1$p.SourceMapGenerator;var SourceMapConsumer$1=exports$1$p.SourceMapConsumer;var sourceMapResolve=exports$1$r;var fs$1=fs;var path=l$4;/**
       * Expose `mixin()`.
       */exports$1$s=mixin;/**
       * Ensure Windows-style paths are formatted properly
       */var makeFriendlyPath=function makeFriendlyPath(aPath){return path.sep==="\\"?aPath.replace(/\\/g,"/").replace(/^[a-z]:\/?/i,"/"):aPath;};/**
       * Mixin source map support into `compiler`.
       *
       * @param {Compiler} compiler
       * @api public
       */function mixin(compiler){compiler._comment=compiler.comment;compiler.map=new SourceMap();compiler.position={line:1,column:1};compiler.files={};for(var k in exports$1$s){compiler[k]=exports$1$s[k];}}/**
       * Update position.
       *
       * @param {String} str
       * @api private
       */exports$1$s.updatePosition=function(str){var lines=str.match(/\n/g);if(lines)(this||_global$1$3).position.line+=lines.length;var i=str.lastIndexOf("\n");(this||_global$1$3).position.column=~i?str.length-i:(this||_global$1$3).position.column+str.length;};/**
       * Emit `str`.
       *
       * @param {String} str
       * @param {Object} [pos]
       * @return {String}
       * @api private
       */exports$1$s.emit=function(str,pos){if(pos){var sourceFile=makeFriendlyPath(pos.source||"source.css");(this||_global$1$3).map.addMapping({source:sourceFile,generated:{line:(this||_global$1$3).position.line,column:Math.max((this||_global$1$3).position.column-1,0)},original:{line:pos.start.line,column:pos.start.column-1}});this.addFile(sourceFile,pos);}this.updatePosition(str);return str;};/**
       * Adds a file to the source map output if it has not already been added
       * @param {String} file
       * @param {Object} pos
       */exports$1$s.addFile=function(file,pos){if(typeof pos.content!=="string")return;if(Object.prototype.hasOwnProperty.call((this||_global$1$3).files,file))return;(this||_global$1$3).files[file]=pos.content;};/**
       * Applies any original source maps to the output and embeds the source file
       * contents in the source map.
       */exports$1$s.applySourceMaps=function(){Object.keys((this||_global$1$3).files).forEach(function(file){var content=(this||_global$1$3).files[file];(this||_global$1$3).map.setSourceContent(file,content);if((this||_global$1$3).options.inputSourcemaps!==false){var originalMap=sourceMapResolve.resolveSync(content,file,fs$1.readFileSync);if(originalMap){var map=new SourceMapConsumer$1(originalMap.map);var relativeTo=originalMap.sourcesRelativeTo;(this||_global$1$3).map.applySourceMap(map,file,makeFriendlyPath(path.dirname(relativeTo)));}}},this||_global$1$3);};/**
       * Process comments, drops sourceMap comments.
       * @param {Object} node
       */exports$1$s.comment=function(node){if(/^# sourceMappingURL=/.test(node.comment))return this.emit("",node.position);else return this._comment(node);};var _sourceMapSupport=exports$1$s;var exports$2$9={};/**
       * Module dependencies.
       */var Compressed=_compress;var Identity=_identity;/**
       * Stringfy the given AST `node`.
       *
       * Options:
       *
       *  - `compress` space-optimized output
       *  - `sourcemap` return an object with `.code` and `.map`
       *
       * @param {Object} node
       * @param {Object} [options]
       * @return {String}
       * @api public
       */exports$2$9=function exports$2$9(node,options){options=options||{};var compiler=options.compress?new Compressed(options):new Identity(options);// source maps
if(options.sourcemap){var sourcemaps=_sourceMapSupport;sourcemaps(compiler);var code=compiler.compile(node);compiler.applySourceMaps();var map=options.sourcemap==="generator"?compiler.map:compiler.map.toJSON();return{code:code,map:map};}var code=compiler.compile(node);return code;};var _stringify=exports$2$9;var exports$3$4={};exports$3$4.parse=_parse;exports$3$4.stringify=_stringify;var __varRecorder__$T=lively.FreezerRuntime.recorderFor("lively.morphic/html-morph.js");__varRecorder__$T.obj=obj;__varRecorder__$T.promise=promise;__varRecorder__$T.string=string;__varRecorder__$T.pt=pt;__varRecorder__$T.Morph=Morph;__varRecorder__$T.vdom=exports$1$h;__varRecorder__$T.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;__varRecorder__$T.css=exports$3$4;var destructured_1$5=__varRecorder__$T.vdom;__varRecorder__$T.diff=destructured_1$5.diff;__varRecorder__$T.patch=destructured_1$5.patch;__varRecorder__$T.h=destructured_1$5.h;__varRecorder__$T.createElement=destructured_1$5.create;var CustomVNode=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/html-morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("CustomVNode")&&typeof __lively_classholder__.CustomVNode==="function"?__lively_classholder__.CustomVNode:__lively_classholder__.CustomVNode=function CustomVNode(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function CustomVNode_initialize_(morph,renderer){this.morph=morph;this.renderer=renderer;this.morphVtree=null;this.key="custom-".concat(morph.id);}},{key:"type",get:function get(){return"Widget";}},{key:"renderMorph",value:function CustomVNode_renderMorph_(){var morph=this.morph,renderer=this.renderer;var vtree=this.morphVtree=renderer.renderMorph(morph);var key="customNode-key-"+morph.id;if(!vtree.children[0]||vtree.children[0].key!==key){vtree.children.unshift(__varRecorder__$T.h(morph.domNodeTagName||"div",{key:key},[]));}if(morph._updateCSSDeclaration){morph.ensureCSSDeclaration();morph._updateCSSDeclaration=false;}return vtree;}},{key:"init",value:function CustomVNode_init_(){var domNode=__varRecorder__$T.createElement(this.renderMorph(),this.renderer.domEnvironment);domNode.childNodes[0].appendChild(this.morph.domNode);if(this.morph.cssDeclaration){this.morph.ensureCSSDeclaration();}return domNode;}},{key:"update",value:function CustomVNode_update_(previous,domNode){var oldTree=previous.morphVtree||this.renderMorph();var newTree=this.renderMorph();var patches=__varRecorder__$T.diff(oldTree,newTree);__varRecorder__$T.patch(domNode,patches);return null;}},{key:"destroy",value:function CustomVNode_destroy_(domNode){var doc=this.renderer.domEnvironment.document;var style=doc.getElementById("css-for-"+this.morph.id);if(style)style.remove();console.log("[HTMLMorph] node of ".concat(this.morph.name," gets removed from DOM"));}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"CustomVNode";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"html-morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:426,end:2427});}(undefined);var HTMLMorph=exports('H',function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/html-morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("HTMLMorph")&&typeof __lively_classholder__.HTMLMorph==="function"?__lively_classholder__.HTMLMorph:__lively_classholder__.HTMLMorph=function HTMLMorph(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"isHTMLMorph",get:function get(){return true;}},{key:"ensureCSSDeclaration",value:function HTMLMorph_ensureCSSDeclaration_(){var _this193=this;try{var parsed=__varRecorder__$T.css.parse(this.cssDeclaration);this.whenRendered().then(function(){parsed.stylesheet.rules.forEach(function(r){if(r.selectors)r.selectors=r.selectors.map(function(ea){return"#".concat(_this193.id," ").concat(ea);});});__varRecorder__$T.addOrChangeCSSDeclaration("css-for-"+_this193.id,__varRecorder__$T.css.stringify(parsed));});}catch(err){console.error("Error setting cssDeclaration of ".concat(this,": ").concat(err));}}},{key:"defaultHTML",get:function get(){return"\n<div style=\"display: flex;\n            align-items: center;\n            justify-content: center;\n            height: 100%;\n            background: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(0%, rgba(242,243,244,1)),color-stop(100%, rgba(229,231,233,1)))\">\n  <p style=\"font: bold 40pt Inconsolata, monospace; color: lightgray;\">&lt;HTML&#x2F;&gt;</p>\n</div>";}},{key:"render",value:function HTMLMorph_render_(renderer){if(this._requestMasterStyling){this.master&&this.master.applyIfNeeded(true);this._requestMasterStyling=false;}return new __varRecorder__$T.CustomVNode(this,renderer);}},{key:"menuItems",value:function HTMLMorph_menuItems_(){var _this194=this;var items=initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"menuItems",this).call(this);items.unshift(["edit CSS...",function(){return _this194.world().execCommand("open workspace",{language:"css",content:_this194.cssDeclaration,target:_this194});}],["edit html...",function(){return _this194.world().execCommand("open workspace",{language:"html",content:_this194.html,target:_this194});}],{isDivider:true});return items;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"HTMLMorph";}},{key:"properties",get:function get(){return{extent:{defaultValue:__varRecorder__$T.pt(420,330)},html:{after:["cssDeclaration"],isStyleProp:true,initialize:function initialize(){this.html=this.defaultHTML;},get:function get(){return this.domNode.innerHTML;},set:function set(value){this.domNode.innerHTML=value;if(this.master){this.master.onMorphChange(this,{prop:"html",value:value});}if(value.includes("<script")){var scripts=this.domNode.querySelectorAll("script");var _iterator91=_createForOfIteratorHelper(scripts),_step91;try{for(_iterator91.s();!(_step91=_iterator91.n()).done;){var script=_step91.value;var parent=script.parentNode;script.remove();var copdiedScript=document.createElement("script");var _iterator92=_createForOfIteratorHelper(script.attributes),_step92;try{for(_iterator92.s();!(_step92=_iterator92.n()).done;){var _step92$value=_step92.value,name=_step92$value.name,_value3=_step92$value.value;copdiedScript.setAttribute(name,_value3);}}catch(err){_iterator92.e(err);}finally{_iterator92.f();}var _iterator93=_createForOfIteratorHelper(script.childNodes),_step93;try{for(_iterator93.s();!(_step93=_iterator93.n()).done;){var _n12=_step93.value;copdiedScript.appendChild(_n12);}}catch(err){_iterator93.e(err);}finally{_iterator93.f();}parent.appendChild(copdiedScript);}}catch(err){_iterator91.e(err);}finally{_iterator91.f();}}}},domNodeTagName:{readOnly:true,get:function get(){return"div";}},domNodeStyle:{readOnly:true,get:function get(){return"position: absolute; width: 100%; height: 100%;";}},domNode:{derived:true,get:function get(){if(!this._domNode){this._domNode=this.document.createElement(this.domNodeTagName);this._domNode.setAttribute("style",this.domNodeStyle);}return this._domNode;},set:function set(node){if(this.domNode.parentNode){this.domNode.parentNode.replaceChild(node,this.domNode);}return this._domNode=node;}},document:{readOnly:true,get:function get(){return this.env.domEnv.document;}},scrollExtent:{readOnly:true,get:function get(){return __varRecorder__$T.pt(this.domNode.scrollWidth,this.domNode.scrollHeight);}},cssDeclaration:{isStyleProp:true,set:function set(val){this.setProperty("cssDeclaration",val);if(!val){var doc=this.env.domEnv.document;var style=doc.getElementById("css-for-"+this.id);if(style)style.remove();}else{this.makeDirty();this._updateCSSDeclaration=true;}}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"html-morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:2752,end:7055});}(__varRecorder__$T.Morph));__varRecorder__$T.HTMLMorph=HTMLMorph;__varRecorder__$T.HTMLMorph=HTMLMorph;__varRecorder__$T.HTMLMorph=HTMLMorph;var IFrameMorph=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/html-morph.js");var __lively_class__=__lively_classholder__.hasOwnProperty("IFrameMorph")&&typeof __lively_classholder__.IFrameMorph==="function"?__lively_classholder__.IFrameMorph:__lively_classholder__.IFrameMorph=function IFrameMorph(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"isIFrameMorph",get:function get(){return true;}},{key:"reload",value:function IFrameMorph_reload_(){return this.src?this.loadURL(this.src):this.srcDoc?this.displayHTML(this.srcDoc):null;}},{key:"whenLoaded",value:function IFrameMorph_whenLoaded_(){return this._whenLoaded||Promise.resolve();}},{key:"displayHTML",value:function(){var _IFrameMorph_displayHTML_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee154(html){var opts,_opts$keepScroll,keepScroll,scroll,_args155=arguments;return regeneratorRuntime.wrap(function _callee154$(_context154){while(1){switch(_context154.prev=_context154.next){case 0:opts=_args155.length>1&&_args155[1]!==undefined?_args155[1]:{};_opts$keepScroll=opts.keepScroll,keepScroll=_opts$keepScroll===void 0?true:_opts$keepScroll;if(keepScroll)scroll=this.iframeScroll;this.srcDoc=html;_context154.next=6;return this.whenLoaded();case 6:if(keepScroll&&scroll)this.iframeScroll=scroll;return _context154.abrupt("return",this);case 8:case"end":return _context154.stop();}}},_callee154,this);}));function IFrameMorph_displayHTML_(_x220){return _IFrameMorph_displayHTML_.apply(this,arguments);}return IFrameMorph_displayHTML_;}()},{key:"loadURL",value:function(){var _IFrameMorph_loadURL_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee155(url){var opts,_opts$keepScroll2,keepScroll,scroll,_args156=arguments;return regeneratorRuntime.wrap(function _callee155$(_context155){while(1){switch(_context155.prev=_context155.next){case 0:opts=_args156.length>1&&_args156[1]!==undefined?_args156[1]:{};_opts$keepScroll2=opts.keepScroll,keepScroll=_opts$keepScroll2===void 0?true:_opts$keepScroll2;if(keepScroll)scroll=this.iframeScroll;this.src=url;_context155.next=6;return this.whenLoaded();case 6:if(keepScroll&&scroll)this.iframeScroll=scroll;return _context155.abrupt("return",this);case 8:case"end":return _context155.stop();}}},_callee155,this);}));function IFrameMorph_loadURL_(_x221){return _IFrameMorph_loadURL_.apply(this,arguments);}return IFrameMorph_loadURL_;}()},{key:"defaultSrcDoc",get:function get(){return"\n    <div style=\"display: flex;\n                align-items: center;\n                justify-content: center;\n                height: 100%;\n                background: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(0%, rgba(242,243,244,1)),color-stop(100%, rgba(229,231,233,1)))\">\n      <p style=\"font: bold 40pt Inconsolata, monospace; color: lightgray;\">&lt;iFrame&#x2F;&gt;</p>\n    </div>";}},{key:"defaultHTML",get:function get(){return"<iframe width=\"100%\" height=\"100%\" frameBorder=\"false\" srcdoc=\"\"></iframe>";}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"IFrameMorph";}},{key:"example",value:function(){var _IFrameMorph_example_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee156(){var iframeMorph;return regeneratorRuntime.wrap(function _callee156$(_context156){while(1){switch(_context156.prev=_context156.next){case 0:iframeMorph=new __varRecorder__$T.IFrameMorph().openInWindow({title:"iframe"}).targetMorph;iframeMorph.srcDoc="";iframeMorph.src="http://localhost:9011/worlds/html%20export";_context156.next=5;return iframeMorph.loadURL("https://google.com");case 5:iframeMorph.iframe.src;iframeMorph.iframe.srcDoc;iframeMorph.src="";iframeMorph.srcDoc="fooo";_context156.next=11;return iframeMorph.reload();case 11:case"end":return _context156.stop();}}},_callee156);}));function IFrameMorph_example_(){return _IFrameMorph_example_.apply(this,arguments);}return IFrameMorph_example_;}()},{key:"properties",get:function get(){return{html:{initialize:function initialize(){this.html=this.defaultHTML;this.srcDoc=this.defaultSrcDoc;}},iframe:{derived:true,readOnly:true,after:["domNode"],get:function get(){return this.domNode.querySelector("iframe");}},src:{derived:true,after:["iframe"],get:function get(){return this.iframe.src;},set:function set(val){this.iframe.removeAttribute("srcDoc");this.iframe.src=val;var _varRecorder__$T$pro=__varRecorder__$T.promise.deferred(),p=_varRecorder__$T$pro.promise,resolve=_varRecorder__$T$pro.resolve,reject=_varRecorder__$T$pro.reject;this._whenLoaded=__varRecorder__$T.promise;this.iframe.onload=function(arg){return resolve(arg);};}},srcDoc:{derived:true,after:["iframe"],get:function get(){return this.iframe.srcdoc;},set:function set(val){this.iframe.removeAttribute("src");this.iframe.srcdoc=val;this._whenLoaded=this.whenRendered().then(function(){return __varRecorder__$T.promise.delay(20);});}},iframeScroll:{derived:true,after:["iframe"],get:function get(){try{var _this$iframe$contentW=this.iframe.contentWindow,_x222=_this$iframe$contentW.scrollX,_y14=_this$iframe$contentW.scrollY;return __varRecorder__$T.pt(_x222,_y14);}catch(err){return __varRecorder__$T.pt(0,0);}},set:function set(val){try{this.iframe.contentWindow.scrollTo(val.x,val.y);}catch(err){}}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"html-morph.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:7064,end:10361});}(__varRecorder__$T.HTMLMorph);__varRecorder__$T.IFrameMorph=IFrameMorph;__varRecorder__$T.IFrameMorph=IFrameMorph;__varRecorder__$T.IFrameMorph=IFrameMorph;var __captured6__=/*#__PURE__*/Object.freeze({__proto__:null,HTMLMorph:HTMLMorph,IFrameMorph:IFrameMorph});var __varRecorder__$U=lively.FreezerRuntime.recorderFor("lively.morphic/style-sheets.js");__varRecorder__$U.arr=arr;__varRecorder__$U.obj=obj;__varRecorder__$U.rect=rect;__varRecorder__$U.ShadowObject=ShadowObject;__varRecorder__$U.morph=morph;var StyleSheet=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/style-sheets.js");var __lively_class__=__lively_classholder__.hasOwnProperty("StyleSheet")&&typeof __lively_classholder__.StyleSheet==="function"?__lively_classholder__.StyleSheet:__lively_classholder__.StyleSheet=function StyleSheet(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function StyleSheet_initialize_(name,rules){if(__varRecorder__$U.obj.isObject(name)&&!rules){rules=name;name=null;}this.rules=rules;for(var rule in rules){rules[rule]=this.unwrapFoldedProps(rules[rule]);}this.name=name;}},{key:"copy",value:function StyleSheet_copy_(){var copiedRules={};for(var rule in this.rules){copiedRules[rule]=Object.assign({},this.rules[rule]);}return new __varRecorder__$U.StyleSheet(this.name,copiedRules);}},{key:"__only_serialize__",get:function get(){return["rules","context"];}},{key:"context",set:function set(morph){this._context=morph;}},{key:"context",get:function get(){return this._context;}},{key:"unwrapFoldedProps",value:function StyleSheet_unwrapFoldedProps_(props){["borderRadius","borderWidth","borderColor","borderStyle"].forEach(function(p){if(p in props){var _v5=props[p];if(!_v5)_v5=0;props[p]=__varRecorder__$U.arr.intersect(__varRecorder__$U.obj.keys(_v5),["top","left","bottom","right"]).length==4?_v5:{top:_v5,bottom:_v5,right:_v5,left:_v5,valueOf:function valueOf(){return _v5;}};}});return props;}},{key:"removeRule",value:function StyleSheet_removeRule_(rule){delete this.rules[rule];this.context.requestStyling();}},{key:"setRule",value:function StyleSheet_setRule_(rule,props){this.rules[rule]=this.unwrapFoldedProps(props);this.context.requestStyling();}},{key:"toggleRule",value:function StyleSheet_toggleRule_(rule,active){this.rules[rule]._deactivated=!active;this.context.requestStyling();}},{key:"applicableRules",value:function StyleSheet_applicableRules_(){var ar={};for(var rule in this.rules){ar[rule]={styleSheet:this,rule:rule};}return ar;}},{key:"toJSExpr",value:function StyleSheet_toJSExpr_(){var customPrinter=function customPrinter(v,ignore,continueInspectFn){if(v&&v.isColor){return v.toJSExpr();}if(v&&v.isGradient){return v.toJSExpr();}if(v&&v.isPoint){return v.toString();}if(v){var top=v.top,left=v.left,right=v.right,bottom=v.bottom;if(__varRecorder__$U.arr.all([top,left,right,bottom],function(a){return a&&__varRecorder__$U.obj.equals(a,v.top);})){return continueInspectFn(v.top);}}if(v&&__varRecorder__$U.obj.keys(v).includes("_rev")){return continueInspectFn(__varRecorder__$U.obj.dissoc(v,["_rev","_deactivated"]));}return ignore;};return"new StyleSheet(".concat(__varRecorder__$U.obj.inspect(this.rules,{customPrinter:customPrinter,escapeKeys:true}),")");}},{key:"applyRule",value:function StyleSheet_applyRule_(rule,morph,anim){var props=this.rules[rule];if(props._deactivated)return{};props=__varRecorder__$U.obj.dissoc(props,["_deactivated"]);return morph.withMetaDo({styleSheetChange:true},function(){if("layout"in props){var layout=props.layout.copy();layout.container=morph;props.layout=layout;}if("dropShadow"in props){props.dropShadow=new __varRecorder__$U.ShadowObject(props.dropShadow);props.dropShadow.morph=morph;}if("padding"in props){props.padding=props.padding.isRect?props.padding:__varRecorder__$U.rect(props.padding,props.padding);}var changedProps=__varRecorder__$U.obj.keys(props).filter(function(key){return!__varRecorder__$U.obj.equals(morph[key],props[key]);});var newProps=__varRecorder__$U.obj.select(props,changedProps);var _morph$propertiesAndP=morph.propertiesAndPropertySettings(),properties=_morph$propertiesAndP.properties;var prevValues={};for(var key in props){prevValues[key]=properties[key]&&properties[key].defaultValue||morph[key];}if(anim){morph.animate(Object.assign({},newProps,{duration:anim.duration,easing:anim.easing}));}else{Object.assign(morph,newProps);}return prevValues;});}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"StyleSheet";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"style-sheets.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:203,end:3712});}(undefined);__varRecorder__$U.StyleSheet=StyleSheet;__varRecorder__$U.StyleSheet=StyleSheet;__varRecorder__$U.StyleSheet=StyleSheet;var __varRecorder__$V=lively.FreezerRuntime.recorderFor("lively.morphic/text/input-line.js");__varRecorder__$V.obj=obj;__varRecorder__$V.arr=arr;__varRecorder__$V.num=num;__varRecorder__$V.Rectangle=Rectangle;__varRecorder__$V.rect=rect;__varRecorder__$V.Color=Color$1;__varRecorder__$V.pt=pt;__varRecorder__$V.connect=connect;__varRecorder__$V.noUpdate=noUpdate;__varRecorder__$V.signal=signal;__varRecorder__$V.disconnect=disconnect;__varRecorder__$V.Text=Text;__varRecorder__$V.Range=Range;__varRecorder__$V.HTMLMorph=HTMLMorph;__varRecorder__$V.Icon=Icon;__varRecorder__$V.morph=morph;var InputLine=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/input-line.js");var __lively_class__=__lively_classholder__.hasOwnProperty("InputLine")&&typeof __lively_classholder__.InputLine==="function"?__lively_classholder__.InputLine:__lively_classholder__.InputLine=function InputLine(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function InputLine_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);__varRecorder__$V.connect(this,"textChange",this,"onInputChanged");__varRecorder__$V.connect(this,"selectionChange",this,"fixCursor");}},{key:"menuItems",value:function(){var _InputLine_menuItems_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee157(){return regeneratorRuntime.wrap(function _callee157$(_context157){while(1){switch(_context157.prev=_context157.next){case 0:_context157.t0=[{command:"change placeholder",target:this},{isDivider:true}];_context157.t1=_toConsumableArray2;_context157.next=4;return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"menuItems",this).call(this);case 4:_context157.t2=_context157.sent;_context157.t3=(0,_context157.t1)(_context157.t2);return _context157.abrupt("return",_context157.t0.concat.call(_context157.t0,_context157.t3));case 7:case"end":return _context157.stop();}}},_callee157,this);}));function InputLine_menuItems_(){return _InputLine_menuItems_.apply(this,arguments);}return InputLine_menuItems_;}()},{key:"onChange",value:function InputLine_onChange_(change){if(["extent","fontSize","padding","fontFamily","position","selection"].includes(change.prop)){this.updatePlaceholder();}return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onChange",this).call(this,change);}},{key:"isInputLine",get:function get(){return true;}},{key:"allowDuplicatesInHistory",get:function get(){return false;}},{key:"resetHistory",value:function InputLine_resetHistory_(){this.inputHistory={items:[],max:50,index:0};}},{key:"inputHistory",get:function get(){if(this._inputHistory)return this._inputHistory;return this._inputHistory=this.historyId?this.constructor.getHistory(this.historyId):{items:[],max:30,index:0};}},{key:"inputHistory",set:function set(hist){this._inputHistory=hist;this.historyId&&this.constructor.setHistory(this.historyId,this._inputHistory);}},{key:"clear",value:function InputLine_clear_(){this.input="";}},{key:"focus",value:function InputLine_focus_(){this.fixCursor();initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"focus",this).call(this);}},{key:"onBlur",value:function InputLine_onBlur_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onBlur",this).call(this,evt);this.updatePlaceholder();}},{key:"fitToLineHeight",value:function InputLine_fitToLineHeight_(){this.height=this.defaultLineHeight+this.padding.top()+this.padding.bottom();}},{key:"indicateError",value:function(){var _InputLine_indicateError_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee158(message){return regeneratorRuntime.wrap(function _callee158$(_context158){while(1){switch(_context158.prev=_context158.next){case 0:this.borderWidth=3;this.borderColor=__varRecorder__$V.Color.red;this._errorIcon=this.addMorph(this._errorIcon||__varRecorder__$V.morph({type:"label",value:[" "+message,{fontSize:18}," ",{}].concat(_toConsumableArray2(__varRecorder__$V.Icon.textAttribute("exclamation-circle",{paddingTop:"2px"}))),fontSize:20,fontColor:__varRecorder__$V.Color.red,opacity:0,reactsToPointer:false,fill:__varRecorder__$V.Color.white.withA(0.9)}));_context158.next=5;return this.whenRendered();case 5:this._errorIcon.opacity=1;this._errorIcon.rightCenter=this.innerBounds().insetBy(10).rightCenter();case 7:case"end":return _context158.stop();}}},_callee158,this);}));function InputLine_indicateError_(_x223){return _InputLine_indicateError_.apply(this,arguments);}return InputLine_indicateError_;}()},{key:"clearError",value:function InputLine_clearError_(){if(!this._errorIcon)return;this._errorIcon&&this._errorIcon.remove();this._errorIcon=null;this.borderColor=__varRecorder__$V.Color.transparent;}},{key:"updatePlaceholder",value:function InputLine_updatePlaceholder_(){var placeholder=this.getSubmorphNamed("placeholder");if(!placeholder)return;if(this.input.length){placeholder.visible=false;return;}var textB=this.innerBounds();placeholder.fontSize=this.fontSize;placeholder.visible=true;placeholder.height=this.height;placeholder.padding=this.padding;placeholder.defaultTextStyle=this.defaultTextStyle;placeholder.lineHeight=this.height+"px";placeholder.fit();placeholder.leftCenter=this.label.length?textB.rightCenter().addXY(0,this.borderWidth):textB.leftCenter().withX(0);}},{key:"fixCursor",value:function InputLine_fixCursor_(){if(!this.label)return;var leadIndex=this.positionToIndex(this.selection.lead);if(leadIndex<this.label.length){this.selection.lead=this.indexToPosition(this.label.length);}var anchorIndex=this.positionToIndex(this.selection.anchor);if(anchorIndex<this.label.length){this.selection.anchor=this.indexToPosition(this.label.length);}}},{key:"acceptInput",value:function InputLine_acceptInput_(){var i=this.input;this.onInput(i);return i;}},{key:"onInput",value:function InputLine_onInput_(input){if(this.input.length>0)this.addInputToHistory(this.input);this.clearOnInput&&this.clear();__varRecorder__$V.signal(this,"inputAccepted",input);}},{key:"onInputChanged",value:function InputLine_onInputChanged_(change){__varRecorder__$V.signal(this,"inputChanged",change);this.clearError();this.updatePlaceholder();}},{key:"onMouseDown",value:function InputLine_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);this._errorIcon&&this._errorIcon.remove();}},{key:"deleteText",value:function InputLine_deleteText_(range){range=range.isRange?range:new __varRecorder__$V.Range(range);if(range.isEmpty())return;range=range.subtract({start:{row:0,column:0},end:{row:0,column:this.label.length}})[0];return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"deleteText",this).call(this,range);}},{key:"addInputToHistory",value:function InputLine_addInputToHistory_(input){var hist=this.inputHistory;var items=hist.items;if(__varRecorder__$V.arr.last(items)===input)return;items.push(input);if(items.length>hist.max){hist.items=items=items.slice(-hist.max);}hist.index=items.length-1;if(!this.allowDuplicatesInHistory){for(var _i186=hist.items.length-1;_i186--;){if(hist.items[_i186]===input){hist.items.splice(_i186,1);hist.index--;}}}this.historyId&&this.constructor.addHistoryToLocalStorage(this.historyId,hist);}},{key:"browseHistory",value:function(){var _InputLine_browseHistory_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee159(){var items,_yield$this$world$fil,_yield$this$world$fil2,item;return regeneratorRuntime.wrap(function _callee159$(_context159){while(1){switch(_context159.prev=_context159.next){case 0:items=this.inputHistory.items.map(function(item,i){return{isListItem:true,string:item,value:i};}).reverse();_context159.next=3;return this.world().filterableListPrompt("Choose item:",items,{commands:[this.histEditCommandForHistBrowse()]});case 3:_yield$this$world$fil=_context159.sent;_yield$this$world$fil2=_slicedToArray2(_yield$this$world$fil.selected,1);item=_yield$this$world$fil2[0];typeof item==="number"&&this.setAndShowHistItem(item);this.focus();case 8:case"end":return _context159.stop();}}},_callee159,this);}));function InputLine_browseHistory_(){return _InputLine_browseHistory_.apply(this,arguments);}return InputLine_browseHistory_;}()},{key:"histEditCommandForHistBrowse",value:function InputLine_histEditCommandForHistBrowse_(){var _this195=this;return{name:"edit history "+this.historyId,exec:function(){var _exec16=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee160(prompt){var items,_yield$prompt$world$e,status,values;return regeneratorRuntime.wrap(function _callee160$(_context160){while(1){switch(_context160.prev=_context160.next){case 0:items=_this195.inputHistory.items.slice().reverse();_context160.next=3;return prompt.world().editListPrompt("edit history "+_this195.historyId,items);case 3:_yield$prompt$world$e=_context160.sent;status=_yield$prompt$world$e.status;values=_yield$prompt$world$e.list;if(!(status==="canceled")){_context160.next=8;break;}return _context160.abrupt("return",true);case 8:items=items.filter(function(ea){return ea.isListItem?values.includes(ea.value):values.includes(ea);});_this195.inputHistory=Object.assign({},_this195.inputHistory,{items:items});prompt.get("list").items=items.map(function(item,i){return{isListItem:true,string:item,value:i};}).reverse();return _context160.abrupt("return",true);case 12:case"end":return _context160.stop();}}},_callee160);}));function exec(_x224){return _exec16.apply(this,arguments);}return exec;}()};}},{key:"setAndShowHistItem",value:function InputLine_setAndShowHistItem_(idx){var hist=this.inputHistory;var items=hist.items;var len=items.length-1;var i=idx;if(!__varRecorder__$V.num.between(i,0,len+1))hist.index=i=len;else hist.index=i;if(this.input!==items[i]&&typeof items[i]!=="undefined")this.input=items[i];}},{key:"showHistItem",value:function InputLine_showHistItem_(dir){dir=dir||"next";var hist=this.inputHistory;var items=hist.items;var len=items.length-1;var i=hist.index;if(!__varRecorder__$V.num.between(i,0,len+1))hist.index=i=len;if(this.input!==items[i]&&typeof items[i]!=="undefined"){this.input=items[i];return;}if(dir==="next"){if(i>len)return;i=++hist.index;}else{if(i<=0)return;i=--hist.index;}this.input=items[i]||"";}},{key:"commands",get:function get(){var _this196=this;return[{name:"change placeholder",exec:function(){var _exec17=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee161(){var newPlaceholder;return regeneratorRuntime.wrap(function _callee161$(_context161){while(1){switch(_context161.prev=_context161.next){case 0:_context161.next=2;return _this196.world().prompt("Enter Placeholder:",{input:_this196.placeholder});case 2:newPlaceholder=_context161.sent;if(newPlaceholder)_this196.placeholder=newPlaceholder;case 4:case"end":return _context161.stop();}}},_callee161);}));function exec(){return _exec17.apply(this,arguments);}return exec;}()},{name:"accept input",exec:function exec(){_this196.acceptInput();return true;}},{name:"show previous input from history",exec:function exec(){_this196.showHistItem("prev");return true;}},{name:"show next input from history",exec:function exec(){_this196.showHistItem("next");return true;}},{name:"browse history",exec:function exec(){_this196.browseHistory();return true;}},{name:"remove items from history",exec:function(){var _exec18=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee162(inputLine){var hist,items,_yield$inputLine$worl,selected;return regeneratorRuntime.wrap(function _callee162$(_context162){while(1){switch(_context162.prev=_context162.next){case 0:hist=inputLine.inputHistory;items=hist.items.map(function(item,i){return{isListItem:true,string:item,value:i};}).reverse();_context162.next=4;return inputLine.world().filterableListPrompt("Choose items to delete:",items,{multiSelect:true});case 4:_yield$inputLine$worl=_context162.sent;selected=_yield$inputLine$worl.selected;__varRecorder__$V.arr.sort(selected).reverse().forEach(function(index){if(index<hist.index)hist.index--;hist.items.splice(index,1);});inputLine.inputHistory=hist;return _context162.abrupt("return",true);case 9:case"end":return _context162.stop();}}},_callee162);}));function exec(_x225){return _exec18.apply(this,arguments);}return exec;}()}].concat(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"commands",this));}},{key:"keybindings",get:function get(){return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"keybindings",this).concat([{keys:"Enter",command:"accept input"},{keys:{mac:"Meta-S",win:"Ctrl-S"},command:"accept input"},{keys:"Up|Ctrl-Up|Alt-P",command:"show previous input from history"},{keys:"Down|Ctrl-Down|Alt-N",command:"show next input from history"},{keys:"Alt-H",command:"browse history"},{keys:"Alt-Shift-H",command:"remove items from history"}]);}},{key:"htmlExport_transformNode",value:function InputLine_htmlExport_transformNode_(node){var doc=node.ownerDocument;var input=doc.createElement("input");var textCSSProps=["padding","font-family","font-weight","font-style","text-decoration","font-size","color"];var textLayer=node.querySelector(".newtext-text-layer.actual");input.id=node.id;input.className=node.className;input.style=node.style.cssText;Object.assign(input.style,__varRecorder__$V.obj.select(textLayer.style,textCSSProps));input.placeholder=this.placeholder;input.type="text";input.autocomplete=input.name=this.name.replace(/[\s"]/g,"-");return input;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"InputLine";}},{key:"getHistoryFromLocalSorage",value:function InputLine_getHistoryFromLocalSorage_(id){if(typeof localStorage==="undefined")return null;try{var hist=localStorage.getItem("lively.morphic-inputline-"+id);return hist?JSON.parse(hist):null;}catch(e){return null;}}},{key:"addHistoryToLocalStorage",value:function InputLine_addHistoryToLocalStorage_(id,hist){if(typeof localStorage==="undefined")return;try{localStorage.setItem("lively.morphic-inputline-"+id,JSON.stringify(hist));}catch(e){console.error(e);}}},{key:"histories",get:function get(){if(!this._histories)this._histories=new Map();return this._histories;}},{key:"getHistory",value:function InputLine_getHistory_(id){var hist=this.histories.get(id);if(hist)return hist;hist=this.getHistoryFromLocalSorage(id)||{items:[],max:50,index:0};this.histories.set(id,hist);return hist;}},{key:"setHistory",value:function InputLine_setHistory_(id){var hist=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{items:[],max:50,index:0};this.histories.set(id,hist);this.addHistoryToLocalStorage(id,hist);return hist;}},{key:"properties",get:function get(){return{fixedWidth:{defaultValue:true},fixedHeight:{defaultValue:true},extent:{defaultValue:__varRecorder__$V.pt(100,20)},padding:{defaultValue:__varRecorder__$V.Rectangle.inset(2,4)},clipMode:{defaultValue:"hidden"},lineWrapping:{defaultValue:false},historyId:{defaultValue:null},clearOnInput:{defaultValue:false},label:{after:["textAndAttributes","extent","padding","submorphs"],defaultValue:"",set:function set(value){var _this197=this;this.setProperty("label",value);if(this.textString.startsWith(value))return;__varRecorder__$V.noUpdate(function(){_this197.textString=value+_this197.input;});}},input:{after:["label"],derived:true,get:function get(){return this.textString.slice(this.label.length);},set:function set(val){this.textString=this.label+(val?String(val):"");this.updatePlaceholder();}},placeholder:{after:["submorphs","label","defaultTextStyle"],dervied:true,get:function get(){var placeholder=this.getSubmorphNamed("placeholder");return placeholder?placeholder.value:null;},set:function set(val){var placeholder=this.getSubmorphNamed("placeholder");if(!val){if(placeholder){placeholder.remove();placeholder=null;}}else{if(!placeholder){placeholder=this.addMorph(__varRecorder__$V.Text.makeLabel(val,Object.assign({},this.defaultTextStyle,{name:"placeholder",reactsToPointer:false,fontColor:__varRecorder__$V.Color.gray})));}else{placeholder.defaultTextStyle=Object.assign({},this.defaultTextStyle,{fontColor:__varRecorder__$V.Color.gray});placeholder.value=val;}}this.updatePlaceholder();}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/input-line.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:466,end:14853});}(__varRecorder__$V.Text);InputLine=__varRecorder__$V.InputLine;var InputLine$1=InputLine;var PasswordInputLine=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.morphic/text/input-line.js");var __lively_class__=__lively_classholder__.hasOwnProperty("PasswordInputLine")&&typeof __lively_classholder__.PasswordInputLine==="function"?__lively_classholder__.PasswordInputLine:__lively_classholder__.PasswordInputLine=function PasswordInputLine(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onChange",value:function PasswordInputLine_onChange_(change){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onChange",this).call(this,change);if(change.prop=="borderRadius"){this.updateHtml(this.input);}}},{key:Symbol["for"]("lively-instance-initialize"),value:function PasswordInputLine_initialize_(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,opts);this.onLoad();}},{key:"onChange",value:function PasswordInputLine_onChange_(change){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onChange",this).call(this,change);if(["fill","borderRadius"].includes(change.prop)){this.updateHtml(this.input);}}},{key:"onLoad",value:function(){var _PasswordInputLine_onLoad_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee163(){var _this198=this;return regeneratorRuntime.wrap(function _callee163$(_context163){while(1){switch(_context163.prev=_context163.next){case 0:_context163.next=2;return this.whenRendered();case 2:this.ensureInputNode().then(function(node){_this198.updateHtml(_this198.input);node.onkeydown=function(evt){return _this198.env.eventDispatcher.dispatchDOMEvent(evt,_this198,"onKeyDown");};node.onkeyup=function(evt){return _this198.env.eventDispatcher.dispatchDOMEvent(evt,_this198,"onKeyUp");};});case 3:case"end":return _context163.stop();}}},_callee163,this);}));function PasswordInputLine_onLoad_(){return _PasswordInputLine_onLoad_.apply(this,arguments);}return PasswordInputLine_onLoad_;}()},{key:"onMouseDown",value:function PasswordInputLine_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);this._errorIcon&&this._errorIcon.remove();}},{key:"onAfterRender",value:function PasswordInputLine_onAfterRender_(node){this.ensureInputNode();}},{key:"ensureInputNode",value:function PasswordInputLine_ensureInputNode_(){var _this199=this;return this.whenRendered().then(function(){var n=_this199.domNode;if(n.parentNode&&n.parentNode.tagName=="INPUT"){n.parentNode.remove();var morphNode=_this199.env.renderer.getNodeForMorph(_this199);morphNode.insertBefore(_this199.domNode,morphNode.firstChild);}return _this199.domNode;});}},{key:"onKeyDown",value:function PasswordInputLine_onKeyDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onKeyDown",this).call(this,evt);if(this.input!=this.lastInput){this.onInputChanged(this.input);}this.lastInput=this.input;}},{key:"focus",value:function PasswordInputLine_focus_(){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"focus",this).call(this);this.domNode&&this.domNode.focus();}},{key:"onFocus",value:function PasswordInputLine_onFocus_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onFocus",this).call(this,evt);if(this._originalShadow)return;this._originalShadow=this.dropShadow;this.highlightWhenFocused&&this.animate({dropShadow:this.haloShadow,duration:200});}},{key:"onBlur",value:function PasswordInputLine_onBlur_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onBlur",this).call(this,evt);this.highlightWhenFocused&&this.animate({dropShadow:this._originalShadow||null,duration:200});this._originalShadow=null;}},{key:"indicateError",value:function(){var _PasswordInputLine_indicateError_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee164(message){return regeneratorRuntime.wrap(function _callee164$(_context164){while(1){switch(_context164.prev=_context164.next){case 0:this.borderWidth=3;this.borderColor=__varRecorder__$V.Color.red;this._errorIcon=this.addMorph(this._errorIcon||__varRecorder__$V.morph({type:"label",value:[" "+message,{fontSize:18}," ",{}].concat(_toConsumableArray2(__varRecorder__$V.Icon.textAttribute("exclamation-circle",{paddingTop:"2px"}))),fontSize:20,fontColor:__varRecorder__$V.Color.red,opacity:0,reactsToPointer:false,fill:__varRecorder__$V.Color.white.withA(0.9)}));_context164.next=5;return this.whenRendered();case 5:this._errorIcon.opacity=1;this._errorIcon.rightCenter=this.innerBounds().insetBy(10).rightCenter();case 7:case"end":return _context164.stop();}}},_callee164,this);}));function PasswordInputLine_indicateError_(_x226){return _PasswordInputLine_indicateError_.apply(this,arguments);}return PasswordInputLine_indicateError_;}()},{key:"clearError",value:function PasswordInputLine_clearError_(){if(!this._errorIcon)return;this._errorIcon&&this._errorIcon.remove();this._errorIcon=null;this.borderColor=__varRecorder__$V.Color.transparent;}},{key:"acceptInput",value:function PasswordInputLine_acceptInput_(){var i=this.input;__varRecorder__$V.signal(this,"inputAccepted",i);return i;}},{key:"onInputChanged",value:function PasswordInputLine_onInputChanged_(change){this.clearError();__varRecorder__$V.signal(this,"inputChanged",change);}},{key:"updateHtml",value:function(){var _PasswordInputLine_updateHtml_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee165(input){var fontSize,fontFamily,padding,placeholder,_this$fill,fill,borderRadius,padt,padr,padb,padl,n;return regeneratorRuntime.wrap(function _callee165$(_context165){while(1){switch(_context165.prev=_context165.next){case 0:fontSize=this.fontSize,fontFamily=this.fontFamily,padding=this.padding,placeholder=this.placeholder,_this$fill=this.fill,fill=_this$fill===void 0?Color$1.white:_this$fill,borderRadius=this.borderRadius;padt=padding.top();padr=padding.right();padb=padding.bottom();padl=padding.left();_context165.next=7;return this.ensureInputNode();case 7:n=_context165.sent;n.setAttribute("type","password");n.setAttribute("placeholder",placeholder);n.setAttribute("value",input);Object.assign(n.style,{position:"absolute",width:"calc(100% - ".concat(padl,"px - ").concat(padr,"px)"),"border-width":0,outline:"none","border-radius":"".concat(borderRadius.valueOf(),"px"),background:fill.toString(),padding:"".concat(padt,"px ").concat(padr,"px ").concat(padb,"px ").concat(padl,"px"),"font-size":"".concat(fontSize,"px"),"font-family":"".concat(fontFamily)});case 12:case"end":return _context165.stop();}}},_callee165,this);}));function PasswordInputLine_updateHtml_(_x227){return _PasswordInputLine_updateHtml_.apply(this,arguments);}return PasswordInputLine_updateHtml_;}()},{key:"commands",get:function get(){var _this200=this;return[{name:"accept input",exec:function exec(){_this200.acceptInput();return true;}}].concat(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"commands",this));}},{key:"keybindings",get:function get(){return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"keybindings",this).concat([{keys:"Enter",command:"accept input"},{keys:{mac:"Meta-S",win:"Ctrl-S"},command:"accept input"}]);}},{key:"htmlExport_transformNode",value:function PasswordInputLine_htmlExport_transformNode_(node){var doc=node.ownerDocument;var wrapper=doc.createElement("div");var oldInput=node.querySelector("input");var input=doc.createElement("input");var textCSSProps=["padding","font-family","font-weight","font-style","text-decoration","font-size","border-radius","color"];if(oldInput.childNodes[0]&&oldInput.childNodes[0].tagName==="INPUT"){oldInput=oldInput.childNodes[0];}input.id=node.id;input.className=node.className;wrapper.style=node.style.cssText;Object.assign(input.style,__varRecorder__$V.obj.select(oldInput.style,textCSSProps));input.style.position="absolute";input.style.width=node.style.width;input.style.height=node.style.height;input.style["border-width"]=node.style["border-width"];input.placeholder=this.placeholder;input.type="password";input.autocomplete=input.name=this.name.replace(/[\s"]/g,"-");wrapper.appendChild(input);wrapper.appendChild(node.childNodes[1]);return wrapper;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"PasswordInputLine";}},{key:"properties",get:function get(){return{extent:{defaultValue:__varRecorder__$V.pt(100,20)},html:{derived:true,initialize:function initialize(){},get:function get(){return"";},set:function set(x){}},highlightWhenFocused:{defaultValue:true},haloShadow:{type:"Shadow"},domNodeTagName:{readOnly:true,get:function get(){return"input";}},domNodeStyle:{readOnly:true,get:function get(){return"background: grey";}},input:{derived:true,after:["domNode"],get:function get(){return this.domNode&&this.domNode.value||"";},set:function set(val){this.domNode.value=val;this.updateHtml(this.input);}},placeholder:{after:["domNode"],set:function set(val){this.setProperty("placeholder",val);this.updateHtml(this.input);}},fontSize:{defaultValue:12,after:["input"],set:function set(value){this.setProperty("fontSize",value);this.updateHtml(this.input);}},fontFamily:{defaultValue:"sans-serif",after:["input"],set:function set(value){this.setProperty("fontFamily",value);this.updateHtml(this.input);}},padding:{defaultValue:__varRecorder__$V.Rectangle.inset(2),after:["input"],set:function set(value){this.setProperty("padding",value);this.updateHtml(this.input);}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"text/input-line.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.morphic",version:"0.1.2"};}},{start:14929,end:21857});}(__varRecorder__$V.HTMLMorph);__varRecorder__$V.PasswordInputLine=PasswordInputLine;__varRecorder__$V.PasswordInputLine=PasswordInputLine;__varRecorder__$V.PasswordInputLine=PasswordInputLine;__varRecorder__$V["default"]=InputLine;var __varRecorder__$W=lively.FreezerRuntime.recorderFor("lively.morphic/index.js");__varRecorder__$W["default"]=config;__varRecorder__$W.config=config;Object.assign(__varRecorder__$W,__captured1__$1);Object.assign(__varRecorder__$W,__captured2__$1);Object.assign(__varRecorder__$W,__captured3__);Object.assign(__varRecorder__$W,__captured4__);Object.assign(__varRecorder__$W,__captured5__);Object.assign(__varRecorder__$W,__captured6__);Object.assign(__varRecorder__$W,__captured7__);Object.assign(__varRecorder__$W,__captured8__);__varRecorder__$W.StyleSheet=StyleSheet;__varRecorder__$W.StyleSheet=StyleSheet;__varRecorder__$W.ShadowObject=ShadowObject;__varRecorder__$W.ShadowObject=ShadowObject;__varRecorder__$W.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;__varRecorder__$W.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;__varRecorder__$W.addOrChangeLinkedCSS=addOrChangeLinkedCSS;__varRecorder__$W.addOrChangeLinkedCSS=addOrChangeLinkedCSS;__varRecorder__$W.easings=easings;__varRecorder__$W.easings=easings;__varRecorder__$W.stringToEasing=stringToEasing;__varRecorder__$W.stringToEasing=stringToEasing;Object.assign(__varRecorder__$W,__captured9__);__varRecorder__$W.Icon=Icon;__varRecorder__$W.Icon=Icon;__varRecorder__$W.loadMorphFromSnapshot=loadMorphFromSnapshot;__varRecorder__$W.loadMorphFromSnapshot=loadMorphFromSnapshot;Object.assign(__varRecorder__$W,__captured10__);__varRecorder__$W.World=World;__varRecorder__$W.Hand=Hand;__varRecorder__$W.Morph=Morph;__varRecorder__$W.Image=Image;__varRecorder__$W.Ellipse=Ellipse;__varRecorder__$W.Triangle=Triangle;__varRecorder__$W.Path=Path$1;__varRecorder__$W.Polygon=Polygon;__varRecorder__$W.LineMorph=LineMorph;__varRecorder__$W.Text=Text;__varRecorder__$W.Label=Label;__varRecorder__$W.HTMLMorph=HTMLMorph;__varRecorder__$W.InputLine=InputLine$1;__varRecorder__$W.PasswordInputLine=PasswordInputLine;__varRecorder__$W.InputLine=InputLine$1;__varRecorder__$W.InputLine=InputLine$1;__varRecorder__$W.PasswordInputLine=PasswordInputLine;__varRecorder__$W.PasswordInputLine=PasswordInputLine;__varRecorder__$W.locateClass=locateClass;__varRecorder__$W.morph=morph;__varRecorder__$W.addClassMappings=addClassMappings;__varRecorder__$W.inspect=inspect$1;__varRecorder__$W.touchInputDevice=touchInputDevice;__varRecorder__$W.addClassMappings({"default":__varRecorder__$W.Morph,world:__varRecorder__$W.World,hand:__varRecorder__$W.Hand,image:__varRecorder__$W.Image,ellipse:__varRecorder__$W.Ellipse,triangle:__varRecorder__$W.Triangle,path:__varRecorder__$W.Path,text:__varRecorder__$W.Text,input:__varRecorder__$W.InputLine,label:__varRecorder__$W.Label,polygon:__varRecorder__$W.Polygon,line:__varRecorder__$W.LineMorph,html:__varRecorder__$W.HTMLMorph});__varRecorder__$W.morph=morph;__varRecorder__$W.morph=morph;__varRecorder__$W.inspect=inspect$1;__varRecorder__$W.inspect=inspect$1;__varRecorder__$W.touchInputDevice=touchInputDevice;__varRecorder__$W.touchInputDevice=touchInputDevice;var __varRecorder__$X=lively.FreezerRuntime.recorderFor("lively.components/buttons.js");__varRecorder__$X.Morph=Morph;__varRecorder__$X.morph=morph;__varRecorder__$X.Icon=Icon;__varRecorder__$X.touchInputDevice=touchInputDevice;__varRecorder__$X.Rectangle=Rectangle;__varRecorder__$X.LinearGradient=LinearGradient;__varRecorder__$X.Color=Color$1;__varRecorder__$X.pt=pt;__varRecorder__$X.signal=signal;__varRecorder__$X.connect=connect;__varRecorder__$X.arr=arr;__varRecorder__$X.obj=obj;__varRecorder__$X.Closure=Closure;var Button=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/buttons.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Button")&&typeof __lively_classholder__.Button==="function"?__lively_classholder__.Button:__lively_classholder__.Button=function Button(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function Button_initialize_(props){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);if(props){return;}}},{key:"__additionally_serialize__",value:function Button___additionally_serialize___(snapshot,objRef,pool,addFn){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__additionally_serialize__",this).call(this,snapshot,objRef,pool,addFn);addFn("fontSize",this.fontSize);if(this.label!=this.labelMorph.value){addFn("label",this.labelMorph.value);}}},{key:"isButton",get:function get(){return true;}},{key:"enable",value:function Button_enable_(){this.deactivated=false;}},{key:"disable",value:function Button_disable_(){this.deactivated=true;}},{key:"onChange",value:function Button_onChange_(change){var prop=change.prop;if(this.label){switch(prop){case"extent":case"fontSize":case"fontFamily":this.relayout();break;case"padding":this.fit();}}return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onChange",this).call(this,change);}},{key:"onSubmorphChange",value:function Button_onSubmorphChange_(change,submorph){if(submorph===this.labelMorph&&change.prop==="extent")this.relayout();return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onSubmorphChange",this).call(this,change,submorph);}},{key:"fitLabelMorph",value:function Button_fitLabelMorph_(){var _this201=this;this.labelMorph.whenFontLoaded().then(function(){_this201.labelMorph.invalidateTextLayout();_this201.labelMorph.fit();});}},{key:"relayout",value:function Button_relayout_(){var label=this.labelMorph;if(!label||this._relayouting)return;this._relayouting=true;try{var padding=this.padding;var padT=padding.top();var padB=padding.bottom();var padL=padding.left();var padR=padding.right();var minHeight=label.height+padT+padB;var minWidth=label.width+padL+padR;if(minHeight>this.height)this.height=minHeight;if(minWidth>this.width)this.width=minWidth;var innerPadding=this.innerBounds().insetByRect(padding);label.center=innerPadding.center().subPt(this.origin);}finally{this._relayouting=false;}}},{key:"fit",value:function Button_fit_(){var padding=this.padding;var label=this.labelMorph;label.fit();this.extent=padding.bottomLeft().addPt(padding.bottomRight()).addPt(label.extent);this.relayout();return this;}},{key:"trigger",value:function Button_trigger_(){try{__varRecorder__$X.signal(this,"fire");typeof this.action==="function"&&this.action();}catch(err){var _w8=this.world();if(_w8)_w8.logError(err);else console.error(err);}}},{key:"considerPress",value:function Button_considerPress_(evt){if(__varRecorder__$X.touchInputDevice)return true;else return this.innerBoundsContainsPoint(evt.positionIn(this));}},{key:"onMouseDown",value:function Button_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);if(!evt.isAltDown()&&!this.deactivated&&this.considerPress(evt)){this.pressed={originalFill:this.fill};}}},{key:"onMouseUp",value:function Button_onMouseUp_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseUp",this).call(this,evt);if(evt.isClickTarget(this)&&this.pressed){this.trigger();this.pressed=null;}}},{key:"onDragStart",value:function Button_onDragStart_(evt){if(__varRecorder__$X.touchInputDevice){this.draggable=true;this.pressed=null;}else{initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onDragStart",this).call(this,evt);}}},{key:"onDrag",value:function Button_onDrag_(evt){}},{key:"onHoverOut",value:function Button_onHoverOut_(evt){if(__varRecorder__$X.touchInputDevice)return;if(this.pressed&&evt.isClickTarget(this))this.pressed=null;}},{key:"onHoverIn",value:function Button_onHoverIn_(evt){if(__varRecorder__$X.touchInputDevice)return;if(!this.deactivated&&evt.isClickTarget(this)){this.pressed={originalFill:this.fill};}}},{key:"interactivelyChangeLabel",value:function(){var _Button_interactivelyChangeLabel_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee166(){var newLabel;return regeneratorRuntime.wrap(function _callee166$(_context166){while(1){switch(_context166.prev=_context166.next){case 0:_context166.next=2;return this.world().prompt("edit button label",{input:this.labelMorph.textString,historyId:"lively.morphic-button-edit-label-hist"});case 2:newLabel=_context166.sent;if(typeof newLabel==="string"){this.label=newLabel;}case 4:case"end":return _context166.stop();}}},_callee166,this);}));function Button_interactivelyChangeLabel_(){return _Button_interactivelyChangeLabel_.apply(this,arguments);}return Button_interactivelyChangeLabel_;}()},{key:"menuItems",value:function Button_menuItems_(){var _this202=this;var items=initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"menuItems",this).call(this);items.unshift({isDivider:true});items.unshift(["change label",function(){return _this202.interactivelyChangeLabel();}]);return items;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Button";}},{key:"properties",get:function get(){return{padding:{isStyleProp:true,defaultValue:__varRecorder__$X.Rectangle.inset(5,2)},draggable:{defaultValue:false},extent:{defaultValue:__varRecorder__$X.pt(100,20)},borderColor:{defaultValue:__varRecorder__$X.Color.gray},borderWidth:{defaultValue:1},borderRadius:{defaultValue:5},nativeCursor:{defaultValue:"pointer"},fill:{defaultValue:new __varRecorder__$X.LinearGradient({stops:[{offset:0,color:__varRecorder__$X.Color.white},{offset:1,color:__varRecorder__$X.Color.rgb(236,240,241)}],vector:0})},deactivated:{group:"button",defaultValue:false,after:["labelMorph"],set:function set(val){this.setProperty("deactivated",val);this.nativeCursor=val?"not-allowed":"pointer";this.labelMorph.opacity=val?0.3:1;}},pressed:{group:"_internal",defaultValue:null,set:function set(val){var oldVal=this.getProperty("pressed");this.setProperty("pressed",val);var realFill=!val&&oldVal&&oldVal.originalFill||this.fill;}},fontSize:{group:"button styling",derived:true,type:"Number",min:4,isStyleProp:true,after:["label"],set:function set(s){this.labelMorph.fontSize=s;},get:function get(){return this.labelMorph.fontSize;}},fontColor:{group:"button styling",derived:true,isStyleProp:true,after:["labelMorph"],set:function set(c){this.labelMorph.fontColor=c;},get:function get(){return this.labelMorph.fontColor;}},labelMorph:{group:"_internal",after:["submorphs"],serialize:false,initialize:function initialize(){this.labelMorph=this.getSubmorphNamed("label")||this.addMorph({type:"label",name:"label",value:"no label yet"});},get:function get(){return this.getSubmorphNamed("label");},set:function set(labelMorph){var existing=this.labelMorph;if(existing)existing.remove();labelMorph.name="label";labelMorph.reactsToPointer=false;this.addMorphAt(labelMorph,0);}},labelWithTextAttributes:{group:"_internal",after:["labelMorph"],derived:true,get:function get(){return this.labelMorph.textAndAttributes;},set:function set(val){this.labelMorph.textAndAttributes=val;}},label:{group:"button",after:["labelMorph"],isStyleProp:true,type:"RichText",set:function set(stringOrAttributesOrMorph){if(stringOrAttributesOrMorph.isMorph){this.setProperty("label",stringOrAttributesOrMorph.value);this.labelMorph=stringOrAttributesOrMorph;}else{this.setProperty("label",stringOrAttributesOrMorph);this.labelMorph.value=stringOrAttributesOrMorph;if(this.labelMorph._parametrizedProps){this.labelMorph._parametrizedProps.value=stringOrAttributesOrMorph;}}this.fitLabelMorph();}},fire:{group:"button",derived:true,readOnly:true,isSignal:true},action:{serialize:false}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"buttons.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:251,end:8857});}(__varRecorder__$X.Morph);__varRecorder__$X.Button=Button;__varRecorder__$X.Button=Button;__varRecorder__$X.Button=Button;var RadioButton=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/buttons.js");var __lively_class__=__lively_classholder__.hasOwnProperty("RadioButton")&&typeof __lively_classholder__.RadioButton==="function"?__lively_classholder__.RadioButton:__lively_classholder__.RadioButton=function RadioButton(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"getMaster",value:function RadioButton_getMaster_(selected){return selected?"styleguide://SystemPrompts/prompts/buttons/selection/selected":"styleguide://SystemPrompts/prompts/buttons/selection/unselected";}},{key:"reset",value:function RadioButton_reset_(){var indicator=this.indicator;indicator.borderWidth=1;indicator.borderColor=__varRecorder__$X.Color.gray;this.selected=false;__varRecorder__$X.connect(indicator,"onMouseUp",this,"select");}},{key:"morph",get:function get(){var indicator=this.indicator;return this.submorphs.find(function(m){return m!==indicator;});}},{key:"morph",set:function set(morph){var indicator=this.indicator;this.submorphs.forEach(function(m){if(m===indicator)return;m.remove();});morph.position=__varRecorder__$X.pt(50,0);this.addMorph(morph);}},{key:"value",get:function get(){if(!this.valueFn){var fnCode;try{fnCode=JSON.parse(this.valueFunctionString);}catch(e){fnCode=this.valueFunctionString;}this.valueFn=__varRecorder__$X.Closure.fromSource(fnCode).recreateFunc();}return this.morph?this.valueFn(this.morph):undefined;}},{key:"onMouseDown",value:function RadioButton_onMouseDown_(evt){this.select();}},{key:"select",value:function RadioButton_select_(){this.selected=true;this.owner.setSelection(this);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"RadioButton";}},{key:"properties",get:function get(){return{indicator:{get:function get(){return this.getSubmorphNamed("indicator");}},master:{after:["selected"],initialize:function initialize(){this.master={auto:this.getMaster(this.selected)};}},selectionColor:{},selectionStyle:{},selected:{after:["indicator"],defaultValue:false,set:function set(bool){var _this203=this;this.whenRendered().then(function(_){_this203.master={auto:_this203.getMaster(bool)};});this.setProperty("selected",!!bool);}},valueFunctionString:{defaultValue:"\"function (morph) { return morph.value; }\"",set:function set(funcOrString){this.setProperty("valueFunctionString",funcOrString.toString());this.valueFn=undefined;}},submorphs:{initialize:function initialize(){this.submorphs=[{type:"ellipse",name:"indicator"}];}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"buttons.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:8867,end:11244});}(__varRecorder__$X.Morph);__varRecorder__$X.RadioButton=RadioButton;__varRecorder__$X.RadioButton=RadioButton;__varRecorder__$X.RadioButton=RadioButton;var RadioButtonGroup=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/buttons.js");var __lively_class__=__lively_classholder__.hasOwnProperty("RadioButtonGroup")&&typeof __lively_classholder__.RadioButtonGroup==="function"?__lively_classholder__.RadioButtonGroup:__lively_classholder__.RadioButtonGroup=function RadioButtonGroup(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"reset",value:function RadioButtonGroup_reset_(){this.submorphs.forEach(function(m){return m.reset();});this.layout.layoutableSubmorphs[0].selected=true;}},{key:"removeAllButtons",value:function RadioButtonGroup_removeAllButtons_(){this.removeAllMorphs();this.height=10;}},{key:"addButton",value:function RadioButtonGroup_addButton_(morph,optValue){var button=new __varRecorder__$X.RadioButton();button.reset();button.morph=morph;if(optValue!=undefined){button.internalValue=optValue;button.valueFunctionString="function (morph) { return morph.owner.internalValue; }";}this.addMorph(button);return button;}},{key:"setSelection",value:function RadioButtonGroup_setSelection_(activeButton){this.submorphs.forEach(function(m){if(m!==activeButton){m.selected=false;}});activeButton.selected=true;}},{key:"selectedButton",get:function get(){return this.submorphs.find(function(m){return m.selected;});}},{key:"value",get:function get(){var selection=this.selectedButton;return selection?selection.value:null;}},{key:"value",set:function set(value){var buttonToSelect=this.submorphs.find(function(m){try{return m.value===value;}catch(e){return false;}});if(buttonToSelect){buttonToSelect.select();}else{this.setSelection(null);}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"RadioButtonGroup";}},{key:"properties",get:function get(){return{choices:{derived:true,defaultValue:[],get:function get(){return this.submorphs.map(function(m){return m.value;});},set:function set(labels){var _this204=this;this.removeAllButtons();if(__varRecorder__$X.obj.isArray(labels)){if(labels.length==0)return;labels.forEach(function(value){_this204.addButton(__varRecorder__$X.morph({name:"label",type:"label",value:value,reactsToPointer:false}));});}else{labels=_toConsumableArray2(labels.entries());if(labels.length==0)return;labels.forEach(function(_ref137){var _ref138=_slicedToArray2(_ref137,2),label=_ref138[0],value=_ref138[1];_this204.addButton(__varRecorder__$X.morph({name:"label",type:"label",value:label,reactsToPointer:false}),value);});}this.submorphs[0].master.whenApplied().then(function(){return _this204.setSelection(_this204.submorphs[0]);});},value:{derived:true,after:["submorphs"],get:function get(){var selection=this.selectedButton;return selection?selection.value:null;},set:function set(value){var buttonToSelect=this.submorphs.find(function(m){try{return m.value===value;}catch(e){return false;}});if(buttonToSelect){buttonToSelect.select();}else{this.setSelection(null);}}}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"buttons.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:11253,end:14167});}(__varRecorder__$X.Morph);__varRecorder__$X.RadioButtonGroup=RadioButtonGroup;__varRecorder__$X.RadioButtonGroup=RadioButtonGroup;__varRecorder__$X.RadioButtonGroup=RadioButtonGroup;var __varRecorder__$Y=lively.FreezerRuntime.recorderFor("lively.components/list.js");function asItem(obj){if(obj&&obj.isListItem&&typeof obj.string==="string")return obj;if(!obj||!obj.isListItem)return{isListItem:true,string:String(obj),value:obj};var label=obj.string||obj.label||"no item.string";obj.string=!label||typeof label==="string"?String(label):Array.isArray(label)?label.map(function(text,i){return i%2==0?String(text):"";}).join(""):String(label);return obj;}__varRecorder__$Y.asItem=asItem;__varRecorder__$Y.Morph=Morph;__varRecorder__$Y.Text=Text;__varRecorder__$Y.StyleSheet=StyleSheet;__varRecorder__$Y.Label=Label;__varRecorder__$Y.Icon=Icon;__varRecorder__$Y.morph=morph;__varRecorder__$Y.touchInputDevice=touchInputDevice;__varRecorder__$Y.pt=pt;__varRecorder__$Y.LinearGradient=LinearGradient;__varRecorder__$Y.Color=Color$1;__varRecorder__$Y.Rectangle=Rectangle;__varRecorder__$Y.rect=rect;__varRecorder__$Y.arr=arr;__varRecorder__$Y.Path=Path;__varRecorder__$Y.string=string;__varRecorder__$Y.signal=signal;__varRecorder__$Y.once=once$1;__varRecorder__$Y.Button=Button;__varRecorder__$Y.bowser=exports$1$1;__varRecorder__$Y.asItem=asItem;__varRecorder__$Y.asItem=asItem;var ListItemMorph=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/list.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ListItemMorph")&&typeof __lively_classholder__.ListItemMorph==="function"?__lively_classholder__.ListItemMorph:__lively_classholder__.ListItemMorph=function ListItemMorph(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"displayItem",value:function ListItemMorph_displayItem_(item,itemIndex,goalWidth,itemHeight,pos){var isSelected=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var style=arguments.length>6?arguments[6]:undefined;var itemMorph=item.morph,label=itemMorph?"":item.label||item.string||"no item.string";if(item.annotation)this.valueAndAnnotation={value:label,annotation:item.annotation};else if(typeof label==="string")this.textString=label;else this.value=label;this.tooltip=item.tooltip||this.tooltip||this.textString;this.itemIndex=itemIndex;this.position=pos;if(style){var fontFamily=style.fontFamily,selectionColor=style.selectionColor,selectionFontColor=style.selectionFontColor,nonSelectionFontColor=style.nonSelectionFontColor,borderRadius=style.borderRadius,fontSize=style.fontSize,padding=style.padding;if(selectionFontColor&&this.selectionFontColor!==selectionFontColor)this.selectionFontColor=selectionFontColor;if(nonSelectionFontColor&&this.nonSelectionFontColor!==nonSelectionFontColor)this.nonSelectionFontColor=nonSelectionFontColor;if(selectionColor&&this.selectionColor!==selectionColor)this.selectionColor=selectionColor;if(borderRadius&&borderRadius!=this.borderRadius)this.borderRadius=borderRadius;if(fontSize&&this.fontSize!==fontSize)this.fontSize=fontSize;if(fontFamily&&this.fontFamily!==fontFamily)this.fontFamily=fontFamily;if(padding&&!this.padding.equals(padding))this.padding=padding;}{if(item.autoFit)itemMorph.width=goalWidth;var width=itemMorph?Math.max(itemMorph.width,goalWidth):goalWidth,height=itemHeight;this.extent=__varRecorder__$Y.pt(width,height);}if(itemMorph){var tfm=itemMorph.getTransform().copy();this.submorphs=[itemMorph];itemMorph.setTransform(tfm);itemMorph.position=__varRecorder__$Y.pt(0,0);}else if(this.submorphs.length)this.submorphs=[];this.isSelected=isSelected;}},{key:"onDragStart",value:function ListItemMorph_onDragStart_(evt){var list=this.owner.owner;this._dragState={sourceIsSelected:this.isSelected,source:this,itemsTouched:[]};if(!list.multiSelect||!list.multiSelectViaDrag)list.onItemMorphDragged(evt,this);}},{key:"onMouseDown",value:function ListItemMorph_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);this.owner.owner.clickOnItem(evt);}},{key:"onDrag",value:function ListItemMorph_onDrag_(evt){var list=this.owner.owner;if(list.multiSelect&&list.multiSelectViaDrag){var below=evt.hand.morphBeneath(evt.position),selectedIndexes=list.selectedIndexes,itemMorphs=list.itemMorphs;if(below===this||!itemMorphs.includes(below))return;if(this._dragState.sourceIsSelected&&!below.isSelected){__varRecorder__$Y.arr.pushIfNotIncluded(selectedIndexes,below.itemIndex);list.selectedIndexes=selectedIndexes;}else if(!this._dragState.sourceIsSelected&&below.isSelected){__varRecorder__$Y.arr.remove(selectedIndexes,below.itemIndex);list.selectedIndexes=selectedIndexes;}}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ListItemMorph";}},{key:"properties",get:function get(){return{clipMode:{defaultValue:"hidden"},autofit:{defaultValue:false},isSelected:{defaultValue:false},draggable:{defaultValue:!__varRecorder__$Y.touchInputDevice},fill:{derived:true,get:function get(){if(__varRecorder__$Y.touchInputDevice&&this.pressed)return __varRecorder__$Y.Color.gray.withA(0.5);return this.isSelected?this.selectionColor:__varRecorder__$Y.Color.transparent;}},itemIndex:{defaultValue:undefined},selectionFontColor:{isStyleProp:true,defaultValue:__varRecorder__$Y.Color.white},selectionColor:{type:"ColorGradient",isStyleProp:true,defaultValue:__varRecorder__$Y.Color.blue},nonSelectionFontColor:{isStyleProp:true,defaultValue:__varRecorder__$Y.Color.rgbHex("333")},fontColor:{derived:true,get:function get(){return this.isSelected?this.selectionFontColor:this.nonSelectionFontColor;}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"list.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:900,end:5155});}(__varRecorder__$Y.Label);__varRecorder__$Y.ListItemMorph=ListItemMorph;__varRecorder__$Y.ListItemMorph=ListItemMorph;__varRecorder__$Y.ListItemMorph=ListItemMorph;var ListScroller=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/list.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ListScroller")&&typeof __lively_classholder__.ListScroller==="function"?__lively_classholder__.ListScroller:__lively_classholder__.ListScroller=function ListScroller(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onScroll",value:function ListScroller_onScroll_(evt){return this.owner.update();}},{key:"onMouseDown",value:function ListScroller_onMouseDown_(evt){var _this205=this;var scrollY=this.scroll.y;if(__varRecorder__$Y.touchInputDevice){var item=this.owner.itemForClick(evt);if(!item)return;item.pressed=true;item.makeDirty();setTimeout(function(){item.pressed=false;if(scrollY-_this205.scroll.y!=0)return;return _this205.owner.clickOnItem(evt);},300);return;}return this.owner.clickOnItem(evt);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ListScroller";}},{key:"properties",get:function get(){return{name:{defaultValue:"scroller"},fill:{defaultValue:__varRecorder__$Y.Color.transparent},clipMode:{defaultValue:"auto"},scrollbar:{derived:true,readOnly:true,after:["submorphs"],get:function get(){return this.submorphs[0];}},submorphs:{initialize:function initialize(){this.submorphs=[{name:"scrollbar"}];}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"list.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:5157,end:6096});}(__varRecorder__$Y.Morph);__varRecorder__$Y.listCommands=[{name:"page up",exec:function exec(list){var index=list.selectedIndex,newIndex=Math.max(0,index-Math.round(list.height/list.itemHeight));list.gotoIndex(newIndex);return true;}},{name:"page down",exec:function exec(list){var index=list.selectedIndex,newIndex=Math.min(list.items.length-1,index+Math.round(list.height/list.itemHeight));list.gotoIndex(newIndex);return true;}},{name:"goto first item",exec:function exec(list){list.gotoIndex(0);return true;}},{name:"goto last item",exec:function exec(list){list.gotoIndex(list.items.length-1);return true;}},{name:"arrow up",exec:function exec(list){list.gotoIndex(list.indexUp());return true;}},{name:"arrow down",exec:function exec(list){list.gotoIndex(list.indexDown());return true;}},{name:"select up",exec:function exec(list){var selected=list.selectedIndexes;if(!list.multiSelect||!selected.length)return list.execCommand("arrow up");var current=selected[0];if(typeof current!=="number")list.selectedIndexes=[current];else{var up=list.indexUp(current);if(selected.includes(current)&&selected.includes(up)){list.selectedIndexes=selected.filter(function(ea){return ea!==current;});}else{list.selectedIndexes=[up].concat(selected.filter(function(ea){return ea!==up;}));}}return true;}},{name:"select down",exec:function exec(list){var selected=list.selectedIndexes;if(!list.multiSelect||!selected.length)return list.execCommand("arrow down");var current=selected[0],down=list.indexDown(current);if(selected.includes(current)&&selected.includes(down)){list.selectedIndexes=selected.filter(function(ea){return ea!==current;});}else{list.selectedIndexes=[down].concat(selected.filter(function(ea){return ea!==down;}));}return true;}},{name:"select all",exec:function exec(list){list.selectedIndexes=__varRecorder__$Y.arr.range(list.items.length-1,0);list.scrollIndexIntoView(list.selectedIndexes[0]);return true;}},{name:"select via filter",exec:function(){var _exec19=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee167(list){var preselect,_yield$list$world$fil,selected;return regeneratorRuntime.wrap(function _callee167$(_context167){while(1){switch(_context167.prev=_context167.next){case 0:preselect=list.selectedIndex||0;_context167.next=3;return list.world().filterableListPrompt("Select item",list.items,{preselect:preselect,requester:list.getWindow()||list,itemPadding:__varRecorder__$Y.Rectangle.inset(0,2),multiSelect:true});case 3:_yield$list$world$fil=_context167.sent;selected=_yield$list$world$fil.selected;if(selected.length){if(list.multiSelect)list.selections=selected;else list.selection=selected[0];list.scrollSelectionIntoView();list.update();}return _context167.abrupt("return",true);case 7:case"end":return _context167.stop();}}},_callee167);}));function exec(_x228){return _exec19.apply(this,arguments);}return exec;}()},{name:"realign top-bottom-center",exec:function exec(list){if(!list.selection)return;var padding=list.padding,idx=list.selectedIndex,itemHeight=list.itemHeight,_list$scroll=list.scroll,scrollX=_list$scroll.x,scrollY=_list$scroll.y,pos=__varRecorder__$Y.pt(0,idx*itemHeight),h=list.height-itemHeight-padding.top()-padding.bottom();if(Math.abs(pos.y-scrollY)<2){scrollY=pos.y-h;}else if(Math.abs(pos.y-scrollY-h*0.5)<2){scrollY=pos.y;}else{scrollY=pos.y-h*0.5;}list.scroll=__varRecorder__$Y.pt(scrollX,scrollY);return true;}},{name:"print contents in text window",exec:function exec(list){var title="items of "+list.name,content=list.items.map(function(item){if(typeof item==="string")return item;var string=item.string,label=item.label,annotation=item.annotation,result="";if(label){if(typeof label==="string")result+=label;else result+=label.map(function(text,i){return i%2==0?text:"";}).join("");}else if(string)result+=string;if(annotation){result+=" ";if(typeof annotation==="string")result+=annotation;else result+=annotation[0];}return result;}).join("\n");return list.world().execCommand("open text window",{title:title,content:content,name:title,fontFamily:"Monaco, monospace"});}}];var List=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/list.js");var __lively_class__=__lively_classholder__.hasOwnProperty("List")&&typeof __lively_classholder__.List==="function"?__lively_classholder__.List:__lively_classholder__.List=function List(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function List_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!props.bounds&&!props.extent)props.extent=__varRecorder__$Y.pt(400,360);initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);this.update();}},{key:"__additionally_serialize__",value:function List___additionally_serialize___(snapshot,ref,pool,addFn){var _this206=this;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__additionally_serialize__",this).call(this,snapshot,ref,pool,addFn);this.whenRendered().then(function(){return _this206.update();});}},{key:"onLoad",value:function List_onLoad_(){this.scroller.visible=__varRecorder__$Y.touchInputDevice;}},{key:"initializeSubmorphs",value:function List_initializeSubmorphs_(submorphs){var container,scroller;submorphs=submorphs||this.submorphs||[];this.submorphs=submorphs;for(var _i187=0;_i187<submorphs.length;_i187++){switch(submorphs[_i187].name){case"listItemContainer":container=submorphs[_i187];continue;case"scroller":scroller=submorphs[_i187];continue;}}if(!scroller){scroller=this.addMorph(new __varRecorder__$Y.ListScroller({draggable:false,grabbable:false,acceptsDrops:false,halosEnabled:false,name:"scroller"}));}if(!container){this.addMorph({name:"listItemContainer",fill:__varRecorder__$Y.Color.transparent,halosEnabled:false,reactsToPointer:false,acceptsDrops:false,draggable:false});}if(container||scroller)this.update();}},{key:"isList",get:function get(){return true;}},{key:"onChange",value:function List_onChange_(change){var prop=change.prop;var styleProps=["fontFamily","fontColor","fontSize","padding","selectionFontColor","selectionColor","nonSelectionFontColor","itemPadding","items"];if(styleProps.includes(prop))this.update();return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onChange",this).call(this,change);}},{key:"itemForClick",value:function List_itemForClick_(evt){var clickedPos=evt.positionIn(this.world()).subPt(this.scroll);var items=this.listItemContainer.morphsContainingPoint(clickedPos);return items.find(function(m){return m.isListItem;})||items[0];}},{key:"clickOnItem",value:function List_clickOnItem_(evt){var item=this.itemForClick(evt);var clickCount=evt.state.clickCount;var method=clickCount===2?"onItemMorphDoubleClicked":"onItemMorphClicked";this[method](evt,item);}},{key:"connections",get:function get(){return{selection:{signalOnAssignment:false}};}},{key:"invalidateCache",value:function List_invalidateCache_(){if(!this.manualItemHeight){this.setProperty("itemHeight",null);}}},{key:"find",value:function List_find_(itemOrValue){return this.items.find(function(item){return item===itemOrValue||item.value===itemOrValue;});}},{key:"findIndex",value:function List_findIndex_(itemOrValue){return this.items.findIndex(function(item){return item===itemOrValue||item.value===itemOrValue;});}},{key:"addItem",value:function List_addItem_(item){return this.addItemAt(item);}},{key:"addItemAt",value:function List_addItemAt_(item){var _this207=this;var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.items.length;var items=this.items;index=Math.min(items.length,Math.max(0,index));items.splice(index,0,__varRecorder__$Y.asItem(item));this.addMethodCallChangeDoing({target:this,selector:"addItemAt",args:[item,index],undo:{target:this,selector:"removeItem",args:[item]}},function(){return _this207.update();});}},{key:"removeItem",value:function List_removeItem_(itemOrValue){var _this208=this;var item=this.find(itemOrValue);var items=this.items;var index=items.indexOf(item);if(index===-1)return;items.splice(index,1);this.addMethodCallChangeDoing({target:this,selector:"removeItem",args:[item],undo:{target:this,selector:"addItemAt",args:[item,index]}},function(){return _this208.update();});}},{key:"selectItemMorph",value:function List_selectItemMorph_(itemMorph){this.selectedIndexes=[itemMorph.itemIndex];}},{key:"gotoIndex",value:function List_gotoIndex_(i){this.scrollIndexIntoView(this.selectedIndex=i);}},{key:"indexUp",value:function List_indexUp_(from){from=typeof from==="number"?from:this.selectedIndex;return(from||this.items.length)-1;}},{key:"indexDown",value:function List_indexDown_(){var index=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.selectedIndex;index=typeof index==="number"?index:-1;return(index+1)%this.items.length;}},{key:"update",value:function List_update_(){var _this209=this;var items=this.items;if(!items||!this.scroller)return;this.dontRecordChangesWhile(function(){var itemHeight=_this209.itemHeight,itemMorphs=_this209.itemMorphs,listItemContainer=_this209.listItemContainer,selectedIndexes=_this209.selectedIndexes,_this209$extent=_this209.extent,width=_this209$extent.x,height=_this209$extent.y,fontSize=_this209.fontSize,fontFamily=_this209.fontFamily,fontColor=_this209.fontColor,padding=_this209.padding,itemPadding=_this209.itemPadding,selectionColor=_this209.selectionColor,selectionFontColor=_this209.selectionFontColor,nonSelectionFontColor=_this209.nonSelectionFontColor,itemBorderRadius=_this209.itemBorderRadius,scrollBar=_this209.scrollBar,scroller=_this209.scroller,scrollable=_this209.scrollable;var _scroller$scroll=scroller.scroll,left=_scroller$scroll.x,top=_scroller$scroll.y;var padding=padding||__varRecorder__$Y.Rectangle.inset(0);var padTop=padding.top();var padLeft=padding.left();var padBottom=padding.bottom();var padRight=padding.right();var firstItemIndex=Math.max(0,Math.floor(top/itemHeight));var lastItemIndex=Math.min(items.length,firstItemIndex+height/itemHeight+2);var maxWidth=0;var goalWidth=_this209.width-(padLeft+padRight);var rest,upper,lower;itemMorphs=__varRecorder__$Y.arr.sortBy(itemMorphs,function(m){return m.itemIndex;});var _varRecorder__$Y$arr=__varRecorder__$Y.arr.partition(itemMorphs,function(m){return m.itemIndex<firstItemIndex;});var _varRecorder__$Y$arr2=_slicedToArray2(_varRecorder__$Y$arr,2);upper=_varRecorder__$Y$arr2[0];rest=_varRecorder__$Y$arr2[1];var _varRecorder__$Y$arr3=__varRecorder__$Y.arr.partition(rest,function(m){return m.itemIndex>lastItemIndex-1;});var _varRecorder__$Y$arr4=_slicedToArray2(_varRecorder__$Y$arr3,2);lower=_varRecorder__$Y$arr4[0];rest=_varRecorder__$Y$arr4[1];itemMorphs=[].concat(_toConsumableArray2(lower),_toConsumableArray2(rest),_toConsumableArray2(upper));for(var _i188=0;_i188<lastItemIndex-firstItemIndex;_i188++){var itemIndex=firstItemIndex+_i188;var item=items[itemIndex];if(!item){itemMorphs.slice(_i188).forEach(function(itemMorph){itemMorph.remove();});break;}var style={fontSize:fontSize,fontFamily:fontFamily,fontColor:nonSelectionFontColor||fontColor,padding:itemPadding,borderRadius:itemBorderRadius||0,selectionFontColor:selectionFontColor,nonSelectionFontColor:nonSelectionFontColor,selectionColor:selectionColor};var itemMorph=itemMorphs[_i188];if(!itemMorph){itemMorph=itemMorphs[_i188]=listItemContainer.addMorph(new __varRecorder__$Y.ListItemMorph(style));}itemMorph.reactsToPointer=!scrollable;itemMorph.displayItem(item,itemIndex,goalWidth,itemHeight,__varRecorder__$Y.pt(0,itemHeight*itemIndex),selectedIndexes.includes(itemIndex),style);maxWidth=Math.max(maxWidth,itemMorph.width);}itemMorphs.slice(lastItemIndex-firstItemIndex).forEach(function(ea){return ea.remove();});var totalItemHeight=Math.max(padTop+padBottom+itemHeight*items.length,_this209.height);listItemContainer.setBounds(__varRecorder__$Y.pt(padLeft,padTop).subXY(0,top).extent(__varRecorder__$Y.pt(_this209.width,totalItemHeight)));scroller.extent=_this209.extent;scrollBar.left=maxWidth-1;scroller.position=__varRecorder__$Y.pt(0,0);scrollBar.extent=__varRecorder__$Y.pt(1,totalItemHeight);});}},{key:"scrollSelectionIntoView",value:function List_scrollSelectionIntoView_(){if(this.selection)this.scrollIndexIntoView(this.selectedIndex);}},{key:"scrollIndexIntoView",value:function List_scrollIndexIntoView_(idx){var itemHeight=this.itemHeight,width=this.width,itemScroll=this.itemScroll,scrollbarOffset=this.scrollbarOffset;var itemBounds=new __varRecorder__$Y.Rectangle(0,idx*itemHeight,width,itemHeight);var visibleBounds=this.innerBounds().insetByRect(this.padding).translatedBy(itemScroll);var offsetX=0;var offsetY=0;if(itemBounds.bottom()>visibleBounds.bottom()){offsetY=itemBounds.bottom()-visibleBounds.bottom();}if(itemBounds.top()<visibleBounds.top()){offsetY=itemBounds.top()-visibleBounds.top();}this.itemScroll=itemScroll.addXY(offsetX,offsetY);this.update();}},{key:"onItemMorphDoubleClicked",value:function List_onItemMorphDoubleClicked_(evt,itemMorph){}},{key:"onItemMorphClicked",value:function List_onItemMorphClicked_(evt,itemMorph){var itemI=itemMorph.itemIndex;var selectedIndexes=this.selectedIndexes;var isClickOnSelected=selectedIndexes.includes(itemI);var indexes=[];if(this.multiSelect){if(evt.isShiftDown()){if(isClickOnSelected){indexes=selectedIndexes.filter(function(ea){return ea!=itemI;});}else{var _from4=selectedIndexes[0];var added=typeof _from4==="number"?__varRecorder__$Y.arr.range(itemI,_from4):[itemI];indexes=added.concat(selectedIndexes.filter(function(ea){return!added.includes(ea);}));}}else if(this.multiSelectWithSimpleClick||evt.isCommandKey()){if(isClickOnSelected){indexes=selectedIndexes.filter(function(ea){return ea!=itemI;});}else{indexes=[itemI].concat(selectedIndexes.filter(function(ea){return ea!=itemI;}));}}else indexes=[itemI];}else indexes=[itemI];this.selectedIndexes=indexes;}},{key:"onItemMorphDragged",value:function List_onItemMorphDragged_(evt,itemMorph){}},{key:"onHoverIn",value:function List_onHoverIn_(evt){if(this.scrollable){this.scroller.visible=true;}}},{key:"onHoverOut",value:function List_onHoverOut_(evt){if(__varRecorder__$Y.touchInputDevice)return;this.scroller.visible=false;}},{key:"onDragStart",value:function List_onDragStart_(evt){if(!this.multiSelect||!this.multiSelectViaDrag)return;}},{key:"onDrag",value:function List_onDrag_(evt){}},{key:"keybindings",get:function get(){return[{keys:"Up|Ctrl-P",command:"arrow up"},{keys:"Down|Ctrl-N",command:"arrow down"},{keys:"Shift-Up",command:"select up"},{keys:"Shift-Down",command:"select down"},{keys:{win:"Ctrl-A",mac:"Meta-A"},command:"select all"},{keys:"Alt-V|PageUp",command:"page up"},{keys:"Ctrl-V|PageDown",command:"page down"},{keys:"Alt-Shift-,",command:"goto first item"},{keys:"Alt-Shift-.",command:"goto last item"},{keys:"Alt-Space",command:"select via filter"},{keys:"Ctrl-L",command:"realign top-bottom-center"}].concat(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"keybindings",this));}},{key:"commands",get:function get(){return __varRecorder__$Y.listCommands;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"List";}},{key:"properties",get:function get(){return{fill:{defaultValue:__varRecorder__$Y.Color.white},clipMode:{defaultValue:"hidden"},selectionFontColor:{isStyleProp:true,defaultValue:__varRecorder__$Y.Color.white},selectionColor:{type:"ColorGradient",isStyleProp:true,defaultValue:__varRecorder__$Y.Color.rgb(21,101,192)},nonSelectionFontColor:{isStyleProp:true,defaultValue:__varRecorder__$Y.Color.rgbHex("333")},fontColor:{isStyleProp:true,defaultValue:__varRecorder__$Y.Color.rgbHex("333")},styleClasses:{defaultValue:["default"]},itemScroll:{derived:true,after:["submorphs"],get:function get(){return this.scroller?this.scroller.scroll:__varRecorder__$Y.pt(0,0);},set:function set(s){if(this.scroller)this.scroller.scroll=s;}},master:{initialize:function initialize(){this.master={auto:"styleguide://SystemWidgets/list/light"};}},extent:{set:function set(value){if(value.eqPt(this.extent))return;this.setProperty("extent",value);this.update();}},fontFamily:{isStyleProp:true,defaultValue:"Helvetica Neue, Arial, sans-serif",set:function set(value){this.setProperty("fontFamily",value);this.invalidateCache();}},fontSize:{isStyleProp:true,defaultValue:12,set:function set(value){this.setProperty("fontSize",value);this.invalidateCache();}},padding:{isStyleProp:true,defaultValue:__varRecorder__$Y.Rectangle.inset(3)},itemBorderRadius:{isStyleProp:true,defaultValue:0,set:function set(value){this.setProperty("itemBorderRadius",value);this.invalidateCache();}},itemPadding:{isStyleProp:true,defaultValue:__varRecorder__$Y.Rectangle.inset(1),set:function set(value){this.setProperty("itemPadding",value);this.invalidateCache();}},items:{group:"list",defaultValue:[],after:["submorphs"],set:function set(items){this.setProperty("items",items.map(__varRecorder__$Y.asItem));this.itemScroll=__varRecorder__$Y.pt(0,0);this.update();if(this.attributeConnections){__varRecorder__$Y.signal(this,"values",this.values);}}},multiSelect:{defaultValue:false},multiSelectWithSimpleClick:{description:"Does a simple click toggle selections without deselecting?",defaultValue:false},multiSelectViaDrag:{description:"Does dragging extend selection?",defaultValue:true},values:{group:"list",after:["items"],readOnly:true,get:function get(){return this.items.map(function(ea){return ea.value;});}},selectedIndex:{group:"list",defaultValue:[],after:["selectedIndexes"],get:function get(){return this.selectedIndexes[0];},set:function set(i){return this.selectedIndexes=typeof i==="number"?[i]:[];}},selectedIndexes:{get:function get(){return this.getProperty("selectedIndexes")||[];},set:function set(indexes){var maxLength=this.items.length;this.setProperty("selectedIndexes",(indexes||[]).filter(function(i){return i>=0&&i<maxLength;}));this.update();__varRecorder__$Y.signal(this,"selection",this.selection);}},selection:{group:"list",after:["selections"],get:function get(){return this.selections[0];},set:function set(itemOrValue){this.selections=[itemOrValue];}},selections:{group:"list",after:["selectedIndexes"],get:function get(){var _this210=this;return this.selectedIndexes.map(function(i){return _this210.items[i]&&_this210.items[i].value;});},set:function set(sels){var _this211=this;this.selectedIndexes=sels.map(function(ea){return _this211.findIndex(ea);});}},selectedItems:{after:["selectedIndexes"],readOnly:true,get:function get(){var _this212=this;return this.selectedIndexes.map(function(i){return _this212.items[i];});}},submorphs:{initialize:function initialize(submorphs){this.initializeSubmorphs(submorphs);}},listItemContainer:{after:["submorphs"],readOnly:true,get:function get(){return this.getSubmorphNamed("listItemContainer");}},itemMorphs:{after:["submorphs"],readOnly:true,get:function get(){return this.listItemContainer.submorphs;}},scrollBar:{after:["submorphs"],readOnly:true,get:function get(){return this.getSubmorphNamed("scrollbar");}},scroller:{after:["submorphs"],readOnly:true,get:function get(){return this.getSubmorphNamed("scroller");}},scrollable:{derived:true,get:function get(){return this.padding.top()+this.items.length*this.itemHeight>this.height;}},manualItemHeight:{type:"Boolean"},itemHeight:{after:["fontFamily","fontSize","itemPadding"],defaultValue:10,set:function set(val){this.setProperty("itemHeight",val);this.manualItemHeight=typeof val==="number";},get:function get(){var height=this.getProperty("itemHeight");if(height)return height;var h=this.env.fontMetric.defaultLineHeight({fontFamily:this.fontFamily,fontSize:this.fontSize});var padding=this.itemPadding;if(padding)h+=padding.top()+padding.bottom();this.setProperty("itemHeight",h);return h;}},theme:{after:["styleClasses"],defaultValue:"default",set:function set(val){this.removeStyleClass(this.theme);this.addStyleClass(val);this.setProperty("theme",val);}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"list.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:10493,end:27029});}(__varRecorder__$Y.Morph);__varRecorder__$Y.List=List;__varRecorder__$Y.List=List;__varRecorder__$Y.List=List;__varRecorder__$Y.connect=connect;var FilterableList=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/list.js");var __lively_class__=__lively_classholder__.hasOwnProperty("FilterableList")&&typeof __lively_classholder__.FilterableList==="function"?__lively_classholder__.FilterableList:__lively_classholder__.FilterableList=function FilterableList(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:Symbol["for"]("lively-instance-initialize"),value:function FilterableList_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!props.bounds&&!props.extent)props.extent=__varRecorder__$Y.pt(400,360);initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);__varRecorder__$Y.connect(this.inputMorph,"inputChanged",this,"updateFilter");__varRecorder__$Y.connect(this.listMorph,"selection",this,"selectionChanged");__varRecorder__$Y.connect(this.listMorph,"onItemMorphDoubleClicked",this,"acceptInput");this.updateFilter();__varRecorder__$Y.connect(this,"extent",this,"relayout");}},{key:"resetConnections",value:function FilterableList_resetConnections_(){var _this213=this;var cs=this.attributeConnections;if(!cs)return;var props=["accepted","canceled","remove"];cs.filter(function(c){return props.includes(c.sourceAttrName)&&c.targetObj!==_this213;}).forEach(function(c){return c.disconnect();});}},{key:"isList",get:function get(){return true;}},{key:"relayout",value:function FilterableList_relayout_(){var listMorph=this.listMorph,inputMorph=this.inputMorph,paddingMorph=this.paddingMorph,offset=this.borderWidth;inputMorph.topLeft=__varRecorder__$Y.pt(offset,offset);inputMorph.width=listMorph.width=this.width-2*offset;if(paddingMorph){paddingMorph.topLeft=inputMorph.bottomLeft;}listMorph.position=paddingMorph?paddingMorph.bottomLeft:inputMorph.bottomLeft;listMorph.height=this.height-listMorph.top-offset;}},{key:"focus",value:function FilterableList_focus_(){this.get("input").focus();}},{key:"selectionChanged",value:function FilterableList_selectionChanged_(sel){__varRecorder__$Y.signal(this,"selection",sel);}},{key:"scrollSelectionIntoView",value:function FilterableList_scrollSelectionIntoView_(){return this.listMorph.scrollSelectionIntoView();}},{key:"parseInput",value:function FilterableList_parseInput_(){var filterText=this.get("input").textString,parsed=Array.from(filterText).reduce(function(state,_char9){if(_char9==="\\"&&!state.escaped){state.escaped=true;return state;}if(_char9===" "&&!state.escaped){if(!state.spaceSeen&&state.current){state.tokens.push(state.current);state.current="";}state.spaceSeen=true;}else{state.spaceSeen=false;state.current+=_char9;}state.escaped=false;return state;},{tokens:[],current:"",escaped:false,spaceSeen:false});parsed.current&&parsed.tokens.push(parsed.current);var lowercasedTokens=parsed.tokens.map(function(ea){return ea.toLowerCase();});return{tokens:parsed.tokens,lowercasedTokens:lowercasedTokens,input:filterText};}},{key:"updateFilter",value:function FilterableList_updateFilter_(){var _this214=this;var parsedInput=this.parseInput(),filterFunction=this.filterFunction,sortFunction=this.sortFunction,filteredItems=this.items.filter(function(item){return filterFunction.call(_this214,parsedInput,item);});if(sortFunction)filteredItems=__varRecorder__$Y.arr.sortBy(filteredItems,function(ea){return sortFunction.call(_this214,parsedInput,ea);});var list=this.listMorph,newSelectedIndexes=this.updateSelectionsAfterFilter?list.selectedIndexes.map(function(i){return filteredItems.indexOf(list.items[i]);}).filter(function(i){return i!==-1;}):list.selectedIndexes;list.items=filteredItems;list.selectedIndexes=newSelectedIndexes.length?newSelectedIndexes:filteredItems.length?[0]:[];this.scrollSelectionIntoView();__varRecorder__$Y.signal(this,"filterChanged",{parsedInput:parsedInput,items:list.items});}},{key:"acceptInput",value:function FilterableList_acceptInput_(){var list=this.listMorph;this.get("input").acceptInput();var result={filtered:this.items,selected:list.selections,action:this.selectedAction,status:"accepted"};__varRecorder__$Y.signal(this,"accepted",result);return result;}},{key:"keybindings",get:function get(){return[{keys:"Up|Ctrl-P",command:"arrow up"},{keys:"Down|Ctrl-N",command:"arrow down"},{keys:"Shift-Up",command:"select up"},{keys:"Shift-Down",command:"select down"},{keys:"Alt-V|PageUp",command:"page up"},{keys:"Ctrl-V|PageDown",command:"page down"},{keys:"Alt-Shift-,",command:"goto first item"},{keys:"Alt-Shift-.",command:"goto last item"},{keys:"Enter",command:"accept input"},{keys:"Escape|Ctrl-G",command:"cancel"},{keys:"Tab",command:"choose action"}].concat(_toConsumableArray2(__varRecorder__$Y.arr.range(0,8).map(function(n){return{keys:"Alt-"+(n+1),command:{command:"choose action and accept input",args:{actionNo:n}}};}))).concat(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"keybindings",this));}},{key:"commands",get:function get(){var _this215=this;return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"commands",this).concat([{name:"accept input",exec:function exec(morph){_this215.acceptInput();return true;}},{name:"cancel",exec:function exec(morph){__varRecorder__$Y.signal(morph,"canceled");return true;}},{name:"choose action and accept input",exec:function exec(flist){var args=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _args$actionNo=args.actionNo,actionNo=_args$actionNo===void 0?0:_args$actionNo;flist.selectedAction=(flist.actions||[])[actionNo];return flist.execCommand("accept input");}},{name:"choose action",exec:function(){var _exec20=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee168(morph){var similarStyle,chooser,preselect;return regeneratorRuntime.wrap(function _callee168$(_context168){while(1){switch(_context168.prev=_context168.next){case 0:if(morph.actions){_context168.next=2;break;}return _context168.abrupt("return",true);case 2:similarStyle=Object.assign({},morph.style,{extent:morph.extent});chooser=new __varRecorder__$Y.FilterableList(similarStyle);chooser.openInWorld(morph.globalPosition);chooser.items=morph.actions;preselect=morph.actions.indexOf(morph.selectedAction);if(preselect===-1)preselect=0;chooser.selectedIndex=preselect;__varRecorder__$Y.connect(chooser,"accepted",morph,"selectedAction",{converter:function converter(result){this.targetObj.focus();this.disconnect();this.sourceObj.remove();return result.selected[0];}});__varRecorder__$Y.connect(chooser,"canceled",morph,"selectedAction",{converter:function converter(result){this.targetObj.focus();this.disconnect();this.sourceObj.remove();return this.targetObj.selectedAction;}});chooser.focus();return _context168.abrupt("return",true);case 13:case"end":return _context168.stop();}}},_callee168);}));function exec(_x229){return _exec20.apply(this,arguments);}return exec;}()}].concat(_toConsumableArray2(__varRecorder__$Y.listCommands.map(function(cmd){return Object.assign({},cmd,{exec:function exec(morph,opts,count){return cmd.exec(_this215.listMorph,opts,count);}});}))));}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"FilterableList";}},{key:"properties",get:function get(){return{fill:{defaultValue:__varRecorder__$Y.Color.transparent},borderWidth:{defaultValue:1},updateSelectionsAfterFilter:{defaultValue:false},theme:{after:["styleClasses","listMorph"],defaultValue:"default",set:function set(val){this.removeStyleClass(this.theme);this.listMorph.removeStyleClass(this.theme);this.addStyleClass(val);this.listMorph.addStyleClass(val);this.setProperty("theme",val);}},submorphs:{initialize:function initialize(){var _this216=this;var input=__varRecorder__$Y.Text.makeInputLine({name:"input",highlightWhenFocused:false,fixedHeight:false,autofit:false});this.submorphs=[input,new __varRecorder__$Y.morph({name:"padding",fill:__varRecorder__$Y.Color.transparent}),new __varRecorder__$Y.List({name:"list",items:[],clipMode:"auto"})];this.get("list").whenRendered().then(function(){return _this216.get("list").update();});}},paddingMorph:{derived:true,readOnly:true,after:["submorphs"],get:function get(){return this.getSubmorphNamed("padding");}},listMorph:{derived:true,readOnly:true,after:["submorphs"],get:function get(){return this.getSubmorphNamed("list");}},inputMorph:{derived:true,readOnly:true,after:["submorphs"],get:function get(){return this.getSubmorphNamed("input");}},fontFamily:{isStyleProp:true,derived:true,after:["submorphs"],get:function get(){return this.listMorph.fontFamily;},set:function set(val){this.listMorph.fontFamily=val;this.inputMorph.fontFamily=val;}},padding:{isStyleProp:true,derived:true,after:["submorphs"],get:function get(){return this.listMorph.padding;},set:function set(val){this.listMorph.padding=val;this.inputMorph.padding=val;}},fontSize:{isStyleProp:true,group:"styling",derived:true,after:["submorphs"],get:function get(){return this.listMorph.fontSize;},set:function set(val){this.listMorph.fontSize=val;}},itemPadding:{isStyleProp:true,derived:true,after:["submorphs"],get:function get(){return this.listMorph.itemPadding;},set:function set(val){this.listMorph.itemPadding=val;}},inputPadding:{isStyleProp:true,derived:true,after:["submorphs","padding"],get:function get(){return this.inputMorph.padding;},set:function set(val){this.inputMorph.padding=val;}},input:{derived:true,after:["submorphs"],defaultValue:"",get:function get(){return this.inputMorph.input;},set:function set(val){this.inputMorph.input=val;}},historyId:{derived:true,after:["submorphs"],defaultValue:null,get:function get(){return this.inputMorph.historyId;},set:function set(val){this.inputMorph.historyId=val;}},multiSelect:{derived:true,after:["submorphs"],get:function get(){return this.listMorph.multiSelect;},set:function set(multiSelect){this.listMorph.multiSelect=multiSelect;}},items:{after:["submorphs","fuzzy","fuzzySortFunction","fuzzyFilterFunction"],defaultValue:[],set:function set(items){this.setProperty("items",items.map(__varRecorder__$Y.asItem));this.updateFilter();}},visibleItems:{derived:true,after:["submorphs"],get:function get(){return this.listMorph.items;}},selection:{derived:true,after:["submorphs"],get:function get(){return this.listMorph.selection;},set:function set(x){this.listMorph.selection=x;}},selectedIndex:{derived:true,after:["submorphs"],get:function get(){return this.listMorph.selectedIndex;},set:function set(x){this.listMorph.selectedIndex=x;}},selectedIndexes:{derived:true,after:["submorphs"],get:function get(){return this.listMorph.selectedIndexes;},set:function set(x){this.listMorph.selectedIndexes=x;}},selectedItems:{derived:true,after:["submorphs"],get:function get(){return this.listMorph.selectedItems;},set:function set(x){this.listMorph.selectedItems=x;}},selections:{derived:true,after:["submorphs"],get:function get(){return this.listMorph.selections;},set:function set(x){this.listMorph.selections=x;}},fuzzy:{derived:true,after:["filterFunction","sortFunction"],set:function set(fuzzy){this.setProperty("fuzzy",fuzzy);if(!fuzzy){if(this.sortFunction===this.fuzzySortFunction)this.sortFunction=null;if(this.filterFunction===this.fuzzyFilterFunction)this.filterFunction=this.defaultFilterFunction;}else{if(!this.sortFunction)this.sortFunction=this.fuzzySortFunction;if(this.filterFunction==this.defaultFilterFunction)this.filterFunction=this.fuzzyFilterFunction;}}},filterFunction:{get:function get(){var filterFunction=this.getProperty("filterFunction");if(!filterFunction)return this.defaultFilterFunction;if(typeof filterFunction==="string")filterFunction=eval("(".concat(filterFunction,")"));return filterFunction;}},sortFunction:{},defaultFilterFunction:{readOnly:true,get:function get(){return this._defaultFilterFunction||(this._defaultFilterFunction=function(parsedInput,item){return parsedInput.lowercasedTokens.every(function(token){return item.string.toLowerCase().includes(token);});});}},fuzzySortFunction:{get:function get(){var _this217=this;return this._fuzzySortFunction||(this._fuzzySortFunction=function(parsedInput,item){var prop=typeof _this217.fuzzy==="string"?_this217.fuzzy:"string";var fuzzyValue=String(__varRecorder__$Y.Path(prop).get(item)).toLowerCase();var base=0;parsedInput.lowercasedTokens.forEach(function(t){if(fuzzyValue.startsWith(t))base-=10;else if(fuzzyValue.includes(t))base-=5;});return __varRecorder__$Y.arr.sum(parsedInput.lowercasedTokens.map(function(token){return __varRecorder__$Y.string.levenshtein(fuzzyValue.toLowerCase(),token);}))+base;});}},fuzzyFilterFunction:{get:function get(){var _this218=this;return this._fuzzyFilterFunction||(this._fuzzyFilterFunction=function(parsedInput,item){var prop=typeof _this218.fuzzy==="string"?_this218.fuzzy:"string";var tokens=parsedInput.lowercasedTokens;if(tokens.every(function(token){return item.string.toLowerCase().includes(token);}))return true;var fuzzyValue=String(__varRecorder__$Y.Path(prop).get(item)).toLowerCase();return __varRecorder__$Y.arr.sum(parsedInput.lowercasedTokens.map(function(token){return __varRecorder__$Y.string.levenshtein(fuzzyValue,token);}))<=3;});}},selectedAction:{get:function get(){return this.getProperty("selectedAction")||"default";}},actions:{}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"list.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:27143,end:41482});}(__varRecorder__$Y.Morph);__varRecorder__$Y.FilterableList=FilterableList;__varRecorder__$Y.FilterableList=FilterableList;__varRecorder__$Y.FilterableList=FilterableList;var DropDownList=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/list.js");var __lively_class__=__lively_classholder__.hasOwnProperty("DropDownList")&&typeof __lively_classholder__.DropDownList==="function"?__lively_classholder__.DropDownList:__lively_classholder__.DropDownList=function DropDownList(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"fitLabelMorph",value:function DropDownList_fitLabelMorph_(){}},{key:Symbol["for"]("lively-instance-initialize"),value:function DropDownList_initialize_(props){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);__varRecorder__$Y.connect(this,"fire",this,"toggleList");}},{key:"onLoad",value:function DropDownList_onLoad_(){if(!this.listMorph.selection)this.listMorph.selection=this.labelMorph.value[0];}},{key:"isListVisible",value:function DropDownList_isListVisible_(){return!!this.listMorph.world();}},{key:"removeWhenFocusLost",value:function DropDownList_removeWhenFocusLost_(evt){var _this219=this;setTimeout(function(){var list=_this219.listMorph,focused=_this219.world()&&_this219.world().focusedMorph;if(list!==focused&&focused!==_this219&&list.world()&&!list.withAllSubmorphsDetect(function(m){return m==focused;})){list.fadeOut(200);}else __varRecorder__$Y.once(__varRecorder__$Y.touchInputDevice?list.scroller:list,"onBlur",_this219,"removeWhenFocusLost");},100);}},{key:"toggleList",value:function(){var _DropDownList_toggleList_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee169(){var list,bounds,totalItemHeight;return regeneratorRuntime.wrap(function _callee169$(_context169){while(1){switch(_context169.prev=_context169.next){case 0:list=this.listMorph;if(!this.isListVisible()){_context169.next=8;break;}__varRecorder__$Y.signal(this,"deactivated");this.selection=list.selection;list.epiMorph=false;list.remove();_context169.next=21;break;case 8:__varRecorder__$Y.signal(this,"activated");if(this.openListInWorld){list.openInWorld();list.epiMorph=true;list.hasFixedPosition=true;list.setTransform(this.getGlobalTransform());bounds=this.globalBounds();}else{bounds=this.innerBounds();this.addMorph(list);}totalItemHeight=list.items.length*list.itemHeight+list.padding.top()+list.padding.bottom();list.extent=__varRecorder__$Y.pt(this.width,Math.min(this.listHeight,totalItemHeight));if(this.listAlign==="top"){list.bottomLeft=bounds.topLeft();}else{list.topLeft=bounds.bottomLeft();}__varRecorder__$Y.once(list,"onItemMorphClicked",this,"toggleList");__varRecorder__$Y.once(__varRecorder__$Y.touchInputDevice?list.scroller:list,"onBlur",this,"removeWhenFocusLost");_context169.next=17;return list.whenRendered();case 17:_context169.next=19;return list.whenRendered();case 19:__varRecorder__$Y.touchInputDevice?list.scroller.focus():list.focus();list.scrollSelectionIntoView();case 21:case"end":return _context169.stop();}}},_callee169,this);}));function DropDownList_toggleList_(){return _DropDownList_toggleList_.apply(this,arguments);}return DropDownList_toggleList_;}()},{key:"commands",get:function get(){var _this220=this;return[{name:"accept",exec:function exec(){if(_this220.isListVisible())_this220.toggleList();return true;}},{name:"cancel",exec:function exec(){if(_this220.isListVisible())_this220.listMorph.remove();return true;}}].concat(initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"commands",this));}},{key:"keybindings",get:function get(){return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"keybindings",this).concat([{keys:"Enter",command:"accept"},{keys:"Escape|Ctrl-G",command:"cancel"}]);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"DropDownList";}},{key:"properties",get:function get(){return{padding:{defaultValue:__varRecorder__$Y.Rectangle.inset(3,2)},listHeight:{defaultValue:100},listAlign:{type:"Enum",values:["bottom","top"],defaultValue:"bottom"},openListInWorld:{defaultValue:false},listMorph:{after:["labelMorph"],get:function get(){var list=this.getProperty("listMorph");if(list)return list;list=new __varRecorder__$Y.List({name:"dropDownList"});this.setProperty("listMorph",list);return list;}},items:{derived:true,after:["listMorph"],get:function get(){return this.listMorph.items;},set:function set(value){this.listMorph.items=value;}},selection:{after:["listMorph","items"],derived:true,get:function get(){return this.listMorph.selection;},set:function set(value){var listAlign=this.listAlign,listMorph=this.listMorph;if(!value){listMorph.selection=null;this.label="";}else{var items=listMorph.items,item=listMorph.find(value);if(!item&&typeof value==="string"){item=items.find(function(ea){return ea.string===value;});}if(!item)return;var label=item.label||[item.string,null];label=[].concat(_toConsumableArray2(label),[" ",null],_toConsumableArray2(__varRecorder__$Y.Icon.textAttribute("caret-"+(listAlign==="bottom"?"down":"up"))));if(label[5]){label[5].paddingRight="0px";label[5].textStyleClasses=["fa","annotation"];}this.label=label;this.relayout();listMorph.selectedIndex=items.indexOf(item);}__varRecorder__$Y.signal(this,"selection",listMorph.selection);}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"list.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:41492,end:46088});}(__varRecorder__$Y.Button);__varRecorder__$Y.DropDownList=DropDownList;__varRecorder__$Y.DropDownList=DropDownList;__varRecorder__$Y.DropDownList=DropDownList;var InteractiveItem=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/list.js");var __lively_class__=__lively_classholder__.hasOwnProperty("InteractiveItem")&&typeof __lively_classholder__.InteractiveItem==="function"?__lively_classholder__.InteractiveItem:__lively_classholder__.InteractiveItem=function InteractiveItem(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"fit",value:function InteractiveItem_fit_(){}},{key:"onHaloGrabover",value:function InteractiveItem_onHaloGrabover_(active){this.list.showDropPreviewFor(this,active);}},{key:"onDrop",value:function(){var _InteractiveItem_onDrop_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee170(evt){var wrappedMorph;return regeneratorRuntime.wrap(function _callee170$(_context170){while(1){switch(_context170.prev=_context170.next){case 0:if(!this.item.isPreview){_context170.next=7;break;}wrappedMorph=evt.hand.grabbedMorphs[0];initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onDrop",this).call(this,evt);_context170.next=5;return this.list.whenRendered();case 5:this.list.addItemAt({morph:wrappedMorph,isListItem:true},this.itemIndex);this.list.clearPreviews();case 7:case"end":return _context170.stop();}}},_callee170,this);}));function InteractiveItem_onDrop_(_x230){return _InteractiveItem_onDrop_.apply(this,arguments);}return InteractiveItem_onDrop_;}()},{key:"select",value:function InteractiveItem_select_(){this.list.selectedIndex=this.itemIndex;this.item.morph.focus();}},{key:"onMouseDown",value:function InteractiveItem_onMouseDown_(evt){if(!__varRecorder__$Y.touchInputDevice)this.select();else this._touchDown=Date.now();}},{key:"onMouseUp",value:function InteractiveItem_onMouseUp_(evt){if(__varRecorder__$Y.touchInputDevice&&Date.now()-this._touchDown<500){this.select();}}},{key:"displayItem",value:function InteractiveItem_displayItem_(item,itemIndex,goalWidth,itemHeight,pos){var isSelected=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var style=arguments.length>6?arguments[6]:undefined;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"displayItem",this).call(this,item,itemIndex,goalWidth,itemHeight,pos,isSelected,style);if(item.morph)item.morph.selected=isSelected;}},{key:"onGrab",value:function InteractiveItem_onGrab_(evt){var list=this.list;var hasHaloAttached=evt.halo&&evt.halo.target===this;if(hasHaloAttached)evt.halo.detachFromTarget();var copy=this.submorphs.length?this.submorphs[0]:__varRecorder__$Y.morph({type:"label",value:this.value});evt.hand.grab(copy);copy.position=evt.hand.localize(this.globalPosition);if(hasHaloAttached)evt.halo.refocus(copy);list.removeItem(this.list.items[this.itemIndex]);list.itemMorphs.forEach(function(m){return m.remove();});list.update();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"InteractiveItem";}},{key:"properties",get:function get(){return{draggable:{defaultValue:__varRecorder__$Y.touchInputDevice?false:true},item:{derived:true,get:function get(){return this.list.items[this.itemIndex];}},list:{drived:true,get:function get(){return this.owner.owner;}},isListItem:{get:function get(){return true;}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"list.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:46097,end:48371});}(__varRecorder__$Y.ListItemMorph);__varRecorder__$Y.InteractiveItem=InteractiveItem;__varRecorder__$Y.InteractiveItem=InteractiveItem;__varRecorder__$Y.InteractiveItem=InteractiveItem;var MorphList=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/list.js");var __lively_class__=__lively_classholder__.hasOwnProperty("MorphList")&&typeof __lively_classholder__.MorphList==="function"?__lively_classholder__.MorphList:__lively_classholder__.MorphList=function MorphList(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onLoad",value:function MorphList_onLoad_(){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onLoad",this).call(this);this.clipMode=this.touchInput?"auto":"hidden";}},{key:"showDropPreviewFor",value:function MorphList_showDropPreviewFor_(itemMorph,active){var idx=itemMorph.itemIndex;var hoveredItem=this.items[idx];if(hoveredItem.isPreview&&active)return;this.clearPreviews();if(!active)return;this.addItemAt({isListItem:true,isPreview:true,morph:__varRecorder__$Y.morph({reactsToPointer:false,acceptsDrops:false,width:this.width-5,height:this.itemHeight,fill:__varRecorder__$Y.Color.orange.withA(0.5)})},idx);}},{key:"clearPreviews",value:function MorphList_clearPreviews_(){var _this221=this;this.items.filter(function(m){return m.morph&&m.morph.owner&&!__varRecorder__$Y.Path("morph.owner.isListItem").get(m);}).map(/*#__PURE__*/function(){var _ref139=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee171(m){return regeneratorRuntime.wrap(function _callee171$(_context171){while(1){switch(_context171.prev=_context171.next){case 0:return _context171.abrupt("return",_this221.removeItem(m));case 1:case"end":return _context171.stop();}}},_callee171);}));return function(_x231){return _ref139.apply(this,arguments);};}());this.items.filter(function(m){return m.isPreview;}).map(function(p){return _this221.removeItem(p);});}},{key:"update",value:function MorphList_update_(){var _this222=this;var items=this.items;if(!items)return;if(!this.listItemContainer)return;if(this.scroller)this.scroller.visible=false;this.dontRecordChangesWhile(function(){var itemHeight=_this222.itemHeight,itemMorphs=_this222.itemMorphs,listItemContainer=_this222.listItemContainer,selectedIndexes=_this222.selectedIndexes,_this222$extent=_this222.extent,width=_this222$extent.x,height=_this222$extent.y,fontSize=_this222.fontSize,fontFamily=_this222.fontFamily,fontColor=_this222.fontColor,padding=_this222.padding,itemPadding=_this222.itemPadding,selectionColor=_this222.selectionColor,selectionFontColor=_this222.selectionFontColor,nonSelectionFontColor=_this222.nonSelectionFontColor,itemBorderRadius=_this222.itemBorderRadius,scrollBar=_this222.scrollBar,_this222$scroll=_this222.scroll,left=_this222$scroll.x,top=_this222$scroll.y,padding=padding||__varRecorder__$Y.Rectangle.inset(0),padTop=padding.top(),padLeft=padding.left(),padBottom=padding.bottom(),padRight=padding.right(),firstItemIndex=Math.max(0,Math.floor(top/itemHeight)),lastItemIndex=Math.min(items.length,Math.ceil((top+height)/itemHeight)),maxWidth=0,goalWidth=_this222.width-(padLeft+padRight);var rest,upper,lower;itemMorphs=__varRecorder__$Y.arr.sortBy(itemMorphs,function(m){return m.itemIndex;});var _varRecorder__$Y$arr5=__varRecorder__$Y.arr.partition(itemMorphs,function(m){return m.itemIndex<firstItemIndex;});var _varRecorder__$Y$arr6=_slicedToArray2(_varRecorder__$Y$arr5,2);upper=_varRecorder__$Y$arr6[0];rest=_varRecorder__$Y$arr6[1];var _varRecorder__$Y$arr7=__varRecorder__$Y.arr.partition(rest,function(m){return m.itemIndex>lastItemIndex;});var _varRecorder__$Y$arr8=_slicedToArray2(_varRecorder__$Y$arr7,2);lower=_varRecorder__$Y$arr8[0];rest=_varRecorder__$Y$arr8[1];itemMorphs=[].concat(_toConsumableArray2(lower),_toConsumableArray2(rest),_toConsumableArray2(upper));var style={fontSize:fontSize,fontFamily:fontFamily,fontColor:nonSelectionFontColor||fontColor,padding:itemPadding,borderRadius:itemBorderRadius||0,selectionFontColor:selectionFontColor,nonSelectionFontColor:nonSelectionFontColor,selectionColor:selectionColor};if(itemMorphs.length&&lastItemIndex-firstItemIndex>itemMorphs.length){if(firstItemIndex!=itemMorphs[0].itemIndex)__varRecorder__$Y.arr.pushAt(itemMorphs,listItemContainer.addMorph(new __varRecorder__$Y.InteractiveItem(style)),0);else if(lastItemIndex!=__varRecorder__$Y.arr.last(itemMorphs).itemIndex)itemMorphs.push(listItemContainer.addMorph(new __varRecorder__$Y.InteractiveItem(style)));}for(var i=0;i<lastItemIndex-firstItemIndex;i++){var itemIndex=firstItemIndex+i,item=items[itemIndex];if(!item){itemMorphs.slice(i).forEach(function(itemMorph){return itemMorph.remove();});break;}var itemMorph=itemMorphs[i];if(!itemMorph){itemMorph=itemMorphs[i]=listItemContainer.addMorph(new __varRecorder__$Y.InteractiveItem(style));itemMorph.clipMode="visible";}itemMorph.displayItem(item,itemIndex,goalWidth,itemHeight,__varRecorder__$Y.pt(0,itemHeight*itemIndex),selectedIndexes.includes(itemIndex),style);maxWidth=Math.max(maxWidth,itemMorph.width);}var containerExtent,scrollHeight=Math.max(padTop+padBottom+itemHeight*items.length,_this222.height);containerExtent=__varRecorder__$Y.pt(_this222.width,scrollHeight).subPt(__varRecorder__$Y.pt(padLeft+padRight,0));listItemContainer.setBounds(__varRecorder__$Y.pt(padLeft,padTop).extent(containerExtent));scrollBar.left=maxWidth-10;scrollBar.fill=null;scrollBar.top=0;scrollBar.extent=__varRecorder__$Y.pt(1,scrollHeight);});}},{key:"onHoverIn",value:function MorphList_onHoverIn_(evt){this.clipMode="auto";}},{key:"onHoverOut",value:function MorphList_onHoverOut_(evt){if(this.touchInput)return;this.clipMode="hidden";}},{key:"onScroll",value:function MorphList_onScroll_(evt){this.update();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"MorphList";}},{key:"properties",get:function get(){return{touchInput:{get:function get(){return __varRecorder__$Y.touchInputDevice;}},items:{group:"list",defaultValue:[],after:["submorphs"],set:function set(items){this.setProperty("items",items.map(__varRecorder__$Y.asItem));this.itemMorphs.forEach(function(m){return m.remove();});this.update();if(this.attributeConnections)__varRecorder__$Y.signal(this,"values",this.values);}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"list.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:48380,end:53607});}(__varRecorder__$Y.List);__varRecorder__$Y.MorphList=MorphList;__varRecorder__$Y.MorphList=MorphList;__varRecorder__$Y.MorphList=MorphList;var __varRecorder__$Z=lively.FreezerRuntime.recorderFor("typeshift.components/interactive.js");__varRecorder__$Z.Morph=Morph;__varRecorder__$Z.HTMLMorph=HTMLMorph;__varRecorder__$Z.touchInputDevice=touchInputDevice;__varRecorder__$Z.morph=morph;__varRecorder__$Z.Path=Path;__varRecorder__$Z.promise=promise;__varRecorder__$Z.string=string;__varRecorder__$Z.arr=arr;__varRecorder__$Z.List=List;__varRecorder__$Z.asItem=asItem;__varRecorder__$Z.ListItemMorph=ListItemMorph;__varRecorder__$Z.Rectangle=Rectangle;__varRecorder__$Z.Color=Color$1;__varRecorder__$Z.pt=pt;__varRecorder__$Z.signal=signal;__varRecorder__$Z.once=once$1;__varRecorder__$Z.ObjectRef=ObjectRef;__varRecorder__$Z.getClassName=getClassName;var MorphSerializationStopper=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("typeshift.components/interactive.js");var __lively_class__=__lively_classholder__.hasOwnProperty("MorphSerializationStopper")&&typeof __lively_classholder__.MorphSerializationStopper==="function"?__lively_classholder__.MorphSerializationStopper:__lively_classholder__.MorphSerializationStopper=function MorphSerializationStopper(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"__deserialize__",value:function MorphSerializationStopper___deserialize___(snapshot,ref,serializedObjMap,pool,path){var wrappedMorph=snapshot.props.wrappedMorph;this._wrappedMorph=wrappedMorph;delete snapshot.props.wrappedMorph;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__deserialize__",this).call(this,snapshot,ref,serializedObjMap,pool,path);this._serializer={delayedWrappedMorph:wrappedMorph,serializedObjMap:serializedObjMap,pool:pool,path:path};}},{key:"__after_deserialize__",value:function MorphSerializationStopper___after_deserialize___(snapshot,ref){var _this223=this;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__after_deserialize__",this).call(this,snapshot,ref);var _this$_serializer=this._serializer,delayedWrappedMorph=_this$_serializer.delayedWrappedMorph,serializedObjMap=_this$_serializer.serializedObjMap,pool=_this$_serializer.pool,path=_this$_serializer.path;this._getWrappedMorph=function(){var id=delayedWrappedMorph.value.id;delete _this223._getWrappedMorph;return _this223.wrappedMorph=__varRecorder__$Z.ObjectRef.fromSnapshot(id,serializedObjMap,pool,path).realObj;};snapshot.props.wrappedMorph=this._wrappedMorph;delete this._wrappedMorph;delete this._serializer;}},{key:"__serialize__",value:function MorphSerializationStopper___serialize___(){if(this._getWrappedMorph){this._getWrappedMorph();}return null;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"MorphSerializationStopper";}},{key:"properties",get:function get(){return{wrappedMorphName:{},wrappedMorph:{set:function set(m){this.setProperty("wrappedMorph",m);if(m&&m.isMorph){this.setBounds(m.bounds());this.wrappedMorphName=m.name;}},get:function get(){var wrapped=this.getProperty("wrappedMorph");if(wrapped)return wrapped;return this._getWrappedMorph();}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"interactive.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"typeshift.components",version:"0.1.0"};}},{start:381,end:2369});}(__varRecorder__$Z.Morph);__varRecorder__$Z.MorphSerializationStopper=MorphSerializationStopper;__varRecorder__$Z.MorphSerializationStopper=MorphSerializationStopper;__varRecorder__$Z.MorphSerializationStopper=MorphSerializationStopper;var InteractiveItem$1=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("typeshift.components/interactive.js");var __lively_class__=__lively_classholder__.hasOwnProperty("InteractiveItem")&&typeof __lively_classholder__.InteractiveItem==="function"?__lively_classholder__.InteractiveItem:__lively_classholder__.InteractiveItem=function InteractiveItem(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"fit",value:function InteractiveItem_fit_(){}},{key:"onHaloGrabover",value:function InteractiveItem_onHaloGrabover_(active){this.list.showDropPreviewFor(this,active);}},{key:"onDrop",value:function(){var _InteractiveItem_onDrop_2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee172(evt){var wrappedMorph;return regeneratorRuntime.wrap(function _callee172$(_context172){while(1){switch(_context172.prev=_context172.next){case 0:if(!this.item.isPreview){_context172.next=7;break;}wrappedMorph=evt.hand.grabbedMorphs[0];initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onDrop",this).call(this,evt);_context172.next=5;return this.list.whenRendered();case 5:this.list.addItemAt({morph:wrappedMorph,isListItem:true},this.itemIndex);this.list.clearPreviews();case 7:case"end":return _context172.stop();}}},_callee172,this);}));function InteractiveItem_onDrop_(_x232){return _InteractiveItem_onDrop_2.apply(this,arguments);}return InteractiveItem_onDrop_;}()},{key:"select",value:function InteractiveItem_select_(){this.list.selectedIndex=this.itemIndex;this.item.morph.focus();}},{key:"onMouseDown",value:function InteractiveItem_onMouseDown_(evt){if(!__varRecorder__$Z.touchInputDevice)this.select();else this._touchDown=Date.now();}},{key:"onMouseUp",value:function InteractiveItem_onMouseUp_(evt){if(__varRecorder__$Z.touchInputDevice&&Date.now()-this._touchDown<500){this.select();}}},{key:"displayItem",value:function InteractiveItem_displayItem_(item,itemIndex,goalWidth,itemHeight,pos){var isSelected=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var style=arguments.length>6?arguments[6]:undefined;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"displayItem",this).call(this,item,itemIndex,goalWidth,itemHeight,pos,isSelected,style);if(item.morph)item.morph.selected=isSelected;}},{key:"onGrab",value:function InteractiveItem_onGrab_(evt){var list=this.list;var hasHaloAttached=evt.halo&&evt.halo.target===this;if(hasHaloAttached)evt.halo.detachFromTarget();var copy=this.submorphs.length?this.submorphs[0]:__varRecorder__$Z.morph({type:"label",value:this.value});evt.hand.grab(copy);copy.position=evt.hand.localize(this.globalPosition);if(hasHaloAttached)evt.halo.refocus(copy);list.removeItem(this.list.items[this.itemIndex]);list.itemMorphs.forEach(function(m){return m.remove();});list.update();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"InteractiveItem";}},{key:"properties",get:function get(){return{draggable:{defaultValue:__varRecorder__$Z.touchInputDevice?false:true},item:{derived:true,get:function get(){return this.list.items[this.itemIndex];}},list:{drived:true,get:function get(){return this.owner.owner;}},isListItem:{get:function get(){return true;}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"interactive.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"typeshift.components",version:"0.1.0"};}},{start:2378,end:4652});}(__varRecorder__$Z.ListItemMorph);__varRecorder__$Z.InteractiveItem=InteractiveItem$1;__varRecorder__$Z.InteractiveItem=InteractiveItem$1;__varRecorder__$Z.InteractiveItem=InteractiveItem$1;var MorphList$1=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("typeshift.components/interactive.js");var __lively_class__=__lively_classholder__.hasOwnProperty("MorphList")&&typeof __lively_classholder__.MorphList==="function"?__lively_classholder__.MorphList:__lively_classholder__.MorphList=function MorphList(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onLoad",value:function MorphList_onLoad_(){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onLoad",this).call(this);this.clipMode=this.touchInput?"auto":"hidden";}},{key:"showDropPreviewFor",value:function MorphList_showDropPreviewFor_(itemMorph,active){var idx=itemMorph.itemIndex;var hoveredItem=this.items[idx];if(hoveredItem.isPreview&&active)return;this.clearPreviews();if(!active)return;this.addItemAt({isListItem:true,isPreview:true,morph:__varRecorder__$Z.morph({reactsToPointer:false,acceptsDrops:false,width:this.width-5,height:this.itemHeight,fill:__varRecorder__$Z.Color.orange.withA(0.5)})},idx);}},{key:"clearPreviews",value:function MorphList_clearPreviews_(){var _this224=this;this.items.filter(function(m){return m.morph&&m.morph.owner&&!__varRecorder__$Z.Path("morph.owner.isListItem").get(m);}).map(/*#__PURE__*/function(){var _ref140=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee173(m){return regeneratorRuntime.wrap(function _callee173$(_context173){while(1){switch(_context173.prev=_context173.next){case 0:return _context173.abrupt("return",_this224.removeItem(m));case 1:case"end":return _context173.stop();}}},_callee173);}));return function(_x233){return _ref140.apply(this,arguments);};}());this.items.filter(function(m){return m.isPreview;}).map(function(p){return _this224.removeItem(p);});}},{key:"update",value:function MorphList_update_(){var _this225=this;var items=this.items;if(!items)return;if(!this.listItemContainer)return;if(this.scroller)this.scroller.visible=false;this.dontRecordChangesWhile(function(){var itemHeight=_this225.itemHeight,itemMorphs=_this225.itemMorphs,listItemContainer=_this225.listItemContainer,selectedIndexes=_this225.selectedIndexes,_this225$extent=_this225.extent,width=_this225$extent.x,height=_this225$extent.y,fontSize=_this225.fontSize,fontFamily=_this225.fontFamily,fontColor=_this225.fontColor,padding=_this225.padding,itemPadding=_this225.itemPadding,selectionColor=_this225.selectionColor,selectionFontColor=_this225.selectionFontColor,nonSelectionFontColor=_this225.nonSelectionFontColor,itemBorderRadius=_this225.itemBorderRadius,scrollBar=_this225.scrollBar,_this225$scroll=_this225.scroll,left=_this225$scroll.x,top=_this225$scroll.y,padding=padding||__varRecorder__$Z.Rectangle.inset(0),padTop=padding.top(),padLeft=padding.left(),padBottom=padding.bottom(),padRight=padding.right(),firstItemIndex=Math.max(0,Math.floor(top/itemHeight)),lastItemIndex=Math.min(items.length,Math.ceil((top+height)/itemHeight)),maxWidth=0,goalWidth=_this225.width-(padLeft+padRight);var rest,upper,lower;itemMorphs=__varRecorder__$Z.arr.sortBy(itemMorphs,function(m){return m.itemIndex;});var _varRecorder__$Z$arr=__varRecorder__$Z.arr.partition(itemMorphs,function(m){return m.itemIndex<firstItemIndex;});var _varRecorder__$Z$arr2=_slicedToArray2(_varRecorder__$Z$arr,2);upper=_varRecorder__$Z$arr2[0];rest=_varRecorder__$Z$arr2[1];var _varRecorder__$Z$arr3=__varRecorder__$Z.arr.partition(rest,function(m){return m.itemIndex>lastItemIndex;});var _varRecorder__$Z$arr4=_slicedToArray2(_varRecorder__$Z$arr3,2);lower=_varRecorder__$Z$arr4[0];rest=_varRecorder__$Z$arr4[1];itemMorphs=[].concat(_toConsumableArray2(lower),_toConsumableArray2(rest),_toConsumableArray2(upper));var style={fontSize:fontSize,fontFamily:fontFamily,fontColor:nonSelectionFontColor||fontColor,padding:itemPadding,borderRadius:itemBorderRadius||0,selectionFontColor:selectionFontColor,nonSelectionFontColor:nonSelectionFontColor,selectionColor:selectionColor};if(itemMorphs.length&&lastItemIndex-firstItemIndex>itemMorphs.length){if(firstItemIndex!=itemMorphs[0].itemIndex)__varRecorder__$Z.arr.pushAt(itemMorphs,listItemContainer.addMorph(new __varRecorder__$Z.InteractiveItem(style)),0);else if(lastItemIndex!=__varRecorder__$Z.arr.last(itemMorphs).itemIndex)itemMorphs.push(listItemContainer.addMorph(new __varRecorder__$Z.InteractiveItem(style)));}for(var i=0;i<lastItemIndex-firstItemIndex;i++){var itemIndex=firstItemIndex+i,item=items[itemIndex];if(!item){itemMorphs.slice(i).forEach(function(itemMorph){return itemMorph.remove();});break;}var itemMorph=itemMorphs[i];if(!itemMorph){itemMorph=itemMorphs[i]=listItemContainer.addMorph(new __varRecorder__$Z.InteractiveItem(style));itemMorph.clipMode="visible";}itemMorph.displayItem(item,itemIndex,goalWidth,itemHeight,__varRecorder__$Z.pt(0,itemHeight*itemIndex),selectedIndexes.includes(itemIndex),style);maxWidth=Math.max(maxWidth,itemMorph.width);}var containerExtent,scrollHeight=Math.max(padTop+padBottom+itemHeight*items.length,_this225.height);containerExtent=__varRecorder__$Z.pt(_this225.width,scrollHeight).subPt(__varRecorder__$Z.pt(padLeft+padRight,0));listItemContainer.setBounds(__varRecorder__$Z.pt(padLeft,padTop).extent(containerExtent));scrollBar.left=maxWidth-10;scrollBar.fill=null;scrollBar.top=0;scrollBar.extent=__varRecorder__$Z.pt(1,scrollHeight);});}},{key:"onHoverIn",value:function MorphList_onHoverIn_(evt){this.clipMode="auto";}},{key:"onHoverOut",value:function MorphList_onHoverOut_(evt){if(this.touchInput)return;this.clipMode="hidden";}},{key:"onScroll",value:function MorphList_onScroll_(evt){this.update();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"MorphList";}},{key:"properties",get:function get(){return{touchInput:{get:function get(){return __varRecorder__$Z.touchInputDevice;}},items:{group:"list",defaultValue:[],after:["submorphs"],set:function set(items){this.setProperty("items",items.map(__varRecorder__$Z.asItem));this.itemMorphs.forEach(function(m){return m.remove();});this.update();if(this.attributeConnections)__varRecorder__$Z.signal(this,"values",this.values);}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"interactive.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"typeshift.components",version:"0.1.0"};}},{start:4661,end:9888});}(__varRecorder__$Z.List);__varRecorder__$Z.MorphList=MorphList$1;__varRecorder__$Z.MorphList=MorphList$1;__varRecorder__$Z.MorphList=MorphList$1;var InteractiveMorph=exports('I',function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("typeshift.components/interactive.js");var __lively_class__=__lively_classholder__.hasOwnProperty("InteractiveMorph")&&typeof __lively_classholder__.InteractiveMorph==="function"?__lively_classholder__.InteractiveMorph:__lively_classholder__.InteractiveMorph=function InteractiveMorph(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"commands",get:function get(){var _this226=this;return[{name:"resize on client",exec:function exec(){_this226.extent=__varRecorder__$Z.pt(window.innerWidth,window.innerHeight);_this226.position=__varRecorder__$Z.pt(0,0);}}];}},{key:"onSubmorphChange",value:function InteractiveMorph_onSubmorphChange_(change,submorph){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onSubmorphChange",this).call(this,change,submorph);if(["removeMorph","addMorphAt"].includes(change.selector)){delete this._ui;}}},{key:"menuItems",value:function(){var _InteractiveMorph_menuItems_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee174(){var _this227=this;var items;return regeneratorRuntime.wrap(function _callee174$(_context174){while(1){switch(_context174.prev=_context174.next){case 0:_context174.next=2;return initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"menuItems",this).call(this);case 2:items=_context174.sent;items[__varRecorder__$Z.arr.findIndex(items,function(item){return item[0]=="Open in...";})]=["Open in...",[["Window",function(){_this227.openInWindow();}],["Prototype Box",function(){_this227.world().execCommand("open in prototype box",{target:_this227});}]]];return _context174.abrupt("return",items);case 5:case"end":return _context174.stop();}}},_callee174,this);}));function InteractiveMorph_menuItems_(){return _InteractiveMorph_menuItems_.apply(this,arguments);}return InteractiveMorph_menuItems_;}()},{key:"cleanAnchors",value:function InteractiveMorph_cleanAnchors_(){this.ui.texts.map(function(m){return m.anchors.filter(function(a){return!a.id;}).forEach(function(a){return m.removeAnchor(a);});});}},{key:"resizeToMobile",value:function InteractiveMorph_resizeToMobile_(){this.extent=__varRecorder__$Z.pt(375,667);}},{key:"resizeToDesktop",value:function InteractiveMorph_resizeToDesktop_(){this.extent=__varRecorder__$Z.pt(1024,720);}},{key:"onWindowClose",value:function(){var _InteractiveMorph_onWindowClose_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee175(){return regeneratorRuntime.wrap(function _callee175$(_context175){while(1){switch(_context175.prev=_context175.next){case 0:if(!this.isComponent){_context175.next=4;break;}_context175.next=3;return this.world().confirm("Do you really want to get rid of me??");case 3:return _context175.abrupt("return",_context175.sent);case 4:case"end":return _context175.stop();}}},_callee175,this);}));function InteractiveMorph_onWindowClose_(){return _InteractiveMorph_onWindowClose_.apply(this,arguments);}return InteractiveMorph_onWindowClose_;}()},{key:"alignMorphAt",value:function InteractiveMorph_alignMorphAt_(m1,prop1,m2,prop2){var converter=arguments.length>4&&arguments[4]!==undefined?arguments[4]:function(x){return x;};var tfm=m1.owner.transformToMorph(m2.owner).inverse();m1[prop1]=tfm.transformPoint(converter(m2[prop2]));}},{key:"scaleFitMorph",value:function InteractiveMorph_scaleFitMorph_(m,side){var inset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var getExtent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:function(m){return m.extent;};var _getExtent=getExtent(m),x=_getExtent.x,y=_getExtent.y;m.scale=Math.max(this.width/x,this.height/y);m[side]=this.innerBounds().insetBy(inset)[side]();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"InteractiveMorph";}},{key:"properties",get:function get(){return{loadingScreen:{},crawlerScreen:{},title:{initialize:function initialize(){this.title=this.name;}},checkDelay:{readOnly:true,get:function get(){return 300;}},__crawler_html__:{derived:true,get:function get(){return this.crawlerScreen&&this.crawlerScreen.html;}},__loading_html__:{derived:true,get:function get(){if(!this.loadingScreen)return null;var _this$loadingScreen=this.loadingScreen,html=_this$loadingScreen.html,id=_this$loadingScreen.id,document=_this$loadingScreen.document;var cssNode=document.getElementById("css-for-"+id);return"\n            ".concat(cssNode?cssNode.outerHTML:"","\n            <div id=\"").concat(id,"\" style=\"position: absolute; z-index: 1; height: 100%; width: 100%;\">\n            ").concat(html,"\n            </div>\n          ");}},ui:{derived:true,serialize:false,get:function get(){var nameMorphMap={};var klassCollectionMap={};if(lively.FreezerRuntime&&this._ui)return this._ui;this.withAllSubmorphsDoExcluding(function(m){nameMorphMap[__varRecorder__$Z.string.camelize(m.name.split(" ").join("-"))]=m;var name=__varRecorder__$Z.getClassName(m);var categoryName=name.charAt(0).toLowerCase()+name.slice(1)+"s";var category=klassCollectionMap[categoryName]||[];category.push(m);klassCollectionMap[categoryName]=category;},function(m){return m.ignoreScope;});return this._ui=Object.assign({},nameMorphMap,{},klassCollectionMap);}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"interactive.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"typeshift.components",version:"0.1.0"};}},{start:9897,end:13631});}(__varRecorder__$Z.Morph));__varRecorder__$Z.InteractiveMorph=InteractiveMorph;__varRecorder__$Z.InteractiveMorph=InteractiveMorph;__varRecorder__$Z.InteractiveMorph=InteractiveMorph;var __varRecorder__$_=lively.FreezerRuntime.recorderFor("TypeshiftWebsite/index.js");__varRecorder__$_.InteractiveMorph=InteractiveMorph;__varRecorder__$_.MorphSerializationStopper=MorphSerializationStopper;__varRecorder__$_.connect=connect;__varRecorder__$_.num=num;__varRecorder__$_.arr=arr;__varRecorder__$_.Path=Path;__varRecorder__$_.promise=promise;__varRecorder__$_.pt=pt;__varRecorder__$_.Color=Color$1;__varRecorder__$_.easings=easings;__varRecorder__$_.config=config;__varRecorder__$_.morph=morph;__varRecorder__$_.touchInputDevice=touchInputDevice;__varRecorder__$_.timeToRun=timeToRun;__varRecorder__$_.ObjectRef=ObjectRef;__varRecorder__$_.resource=resource;var Projects=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftWebsite/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Projects")&&typeof __lively_classholder__.Projects==="function"?__lively_classholder__.Projects:__lively_classholder__.Projects=function Projects(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayout",value:function(){var _Projects_relayout_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee176(){var _this$ui3,headlineFloater,loadMore,isMobile,projectsContainer;return regeneratorRuntime.wrap(function _callee176$(_context176){while(1){switch(_context176.prev=_context176.next){case 0:if(!this.isComponent){_context176.next=2;break;}return _context176.abrupt("return");case 2:_this$ui3=this.ui,headlineFloater=_this$ui3.headlineFloater,loadMore=_this$ui3.loadMore;isMobile=this.width<700;if(!isMobile){_context176.next=20;break;}_context176.t0=this._mobileLayout;if(_context176.t0){_context176.next=17;break;}_context176.next=9;return module["import"]('./mobile-665c08fb.js');case 9:_context176.t1=_context176.sent;if(!_context176.t1){_context176.next=14;break;}_context176.next=13;return __varRecorder__$_.resource("part://$world/typeshift/projects/mobile");case 13:_context176.t1=_context176.sent;case 14:_context176.next=16;return _context176.t1.read();case 16:_context176.t0=_context176.sent;case 17:this._mobileLayout=_context176.t0;_context176.next=33;break;case 20:_context176.t2=this._desktopLayout;if(_context176.t2){_context176.next=32;break;}_context176.next=24;return module["import"]('./desktop-1a35b40d.js');case 24:_context176.t3=_context176.sent;if(!_context176.t3){_context176.next=29;break;}_context176.next=28;return __varRecorder__$_.resource("part://$world/typeshift/projects/desktop");case 28:_context176.t3=_context176.sent;case 29:_context176.next=31;return _context176.t3.read();case 31:_context176.t2=_context176.sent;case 32:this._desktopLayout=_context176.t2;case 33:projectsContainer=isMobile?this._mobileLayout:this._desktopLayout;this.submorphs=[headlineFloater,projectsContainer,loadMore];case 35:case"end":return _context176.stop();}}},_callee176,this);}));function Projects_relayout_(){return _Projects_relayout_.apply(this,arguments);}return Projects_relayout_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Projects";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftWebsite",version:"0.1.1-342"};}},{start:525,end:1304});}(__varRecorder__$_.InteractiveMorph);__varRecorder__$_.Projects=Projects;__varRecorder__$_.Projects=Projects;__varRecorder__$_.Projects=Projects;var Services=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftWebsite/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Services")&&typeof __lively_classholder__.Services==="function"?__lively_classholder__.Services:__lively_classholder__.Services=function Services(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayout",value:function(){var _Services_relayout_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee177(){var headlineFloater,isMobile,projectsContainer;return regeneratorRuntime.wrap(function _callee177$(_context177){while(1){switch(_context177.prev=_context177.next){case 0:if(!this.isComponent){_context177.next=2;break;}return _context177.abrupt("return");case 2:headlineFloater=this.ui.headlineFloater;isMobile=this.width<750;if(!isMobile){_context177.next=20;break;}_context177.t0=this._mobileLayout;if(_context177.t0){_context177.next=17;break;}_context177.next=9;return module["import"]('./mobile-384e06d1.js');case 9:_context177.t1=_context177.sent;if(!_context177.t1){_context177.next=14;break;}_context177.next=13;return __varRecorder__$_.resource("part://$world/typeshift/services/mobile");case 13:_context177.t1=_context177.sent;case 14:_context177.next=16;return _context177.t1.read();case 16:_context177.t0=_context177.sent;case 17:this._mobileLayout=_context177.t0;_context177.next=33;break;case 20:_context177.t2=this._desktopLayout;if(_context177.t2){_context177.next=32;break;}_context177.next=24;return module["import"]('./desktop-fece4314.js');case 24:_context177.t3=_context177.sent;if(!_context177.t3){_context177.next=29;break;}_context177.next=28;return __varRecorder__$_.resource("part://$world/typeshift/services/desktop");case 28:_context177.t3=_context177.sent;case 29:_context177.next=31;return _context177.t3.read();case 31:_context177.t2=_context177.sent;case 32:this._desktopLayout=_context177.t2;case 33:projectsContainer=isMobile?this._mobileLayout:this._desktopLayout;this.submorphs=[headlineFloater,projectsContainer];case 35:case"end":return _context177.stop();}}},_callee177,this);}));function Services_relayout_(){return _Services_relayout_.apply(this,arguments);}return Services_relayout_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Services";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftWebsite",version:"0.1.1-342"};}},{start:1313,end:2072});}(__varRecorder__$_.InteractiveMorph);__varRecorder__$_.Services=Services;__varRecorder__$_.Services=Services;__varRecorder__$_.Services=Services;var References=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftWebsite/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("References")&&typeof __lively_classholder__.References==="function"?__lively_classholder__.References:__lively_classholder__.References=function References(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayout",value:function References_relayout_(){var _this$ui4=this.ui,partners=_this$ui4.partners,customersAndPartners=_this$ui4.customersAndPartners,chapterHeadline=_this$ui4.chapterHeadline;var isMobile=this.width<700;partners.width=isMobile?300:650;customersAndPartners.topCenter=this.innerBounds().insetBy(80).topCenter();customersAndPartners.left=Math.max(0,customersAndPartners.left);customersAndPartners.scale=Math.min(1,this.width/(partners.width+100));chapterHeadline.scale=Math.min(1,this.width/(partners.width+50));}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"References";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftWebsite",version:"0.1.1-342"};}},{start:2081,end:2614});}(__varRecorder__$_.InteractiveMorph);__varRecorder__$_.References=References;__varRecorder__$_.References=References;__varRecorder__$_.References=References;var Agency=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftWebsite/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Agency")&&typeof __lively_classholder__.Agency==="function"?__lively_classholder__.Agency:__lively_classholder__.Agency=function Agency(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayout",value:function(){var _Agency_relayout_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee178(){var isMobile,headlineFloater,projectsContainer;return regeneratorRuntime.wrap(function _callee178$(_context178){while(1){switch(_context178.prev=_context178.next){case 0:if(!this.isComponent){_context178.next=2;break;}return _context178.abrupt("return");case 2:isMobile=this.width<525;headlineFloater=this.ui.headlineFloater;if(!isMobile){_context178.next=20;break;}_context178.t0=this._mobileLayout;if(_context178.t0){_context178.next=17;break;}_context178.next=9;return module["import"]('./mobile-165b034a.js');case 9:_context178.t1=_context178.sent;if(!_context178.t1){_context178.next=14;break;}_context178.next=13;return __varRecorder__$_.resource("part://$world/typeshift/agency/mobile");case 13:_context178.t1=_context178.sent;case 14:_context178.next=16;return _context178.t1.read();case 16:_context178.t0=_context178.sent;case 17:this._mobileLayout=_context178.t0;_context178.next=33;break;case 20:_context178.t2=this._desktopLayout;if(_context178.t2){_context178.next=32;break;}_context178.next=24;return module["import"]('./desktop-aaf636c8.js');case 24:_context178.t3=_context178.sent;if(!_context178.t3){_context178.next=29;break;}_context178.next=28;return __varRecorder__$_.resource("part://$world/typeshift/agency/desktop");case 28:_context178.t3=_context178.sent;case 29:_context178.next=31;return _context178.t3.read();case 31:_context178.t2=_context178.sent;case 32:this._desktopLayout=_context178.t2;case 33:projectsContainer=isMobile?this._mobileLayout:this._desktopLayout;projectsContainer.isLayoutable=false;this.submorphs=[projectsContainer,headlineFloater];projectsContainer.topCenter=this.innerBounds().insetBy(!isMobile?-180:80).topCenter().addXY(40,0);projectsContainer.left=Math.max(projectsContainer.left,-30);this.height=this.submorphBounds().bottom();case 39:case"end":return _context178.stop();}}},_callee178,this);}));function Agency_relayout_(){return _Agency_relayout_.apply(this,arguments);}return Agency_relayout_;}()},{key:"updateOnScroll",value:function Agency_updateOnScroll_(p){var scrollAnimation=this.getSubmorphNamed("scrollytelling agency");if(scrollAnimation)scrollAnimation.progress=p;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Agency";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftWebsite",version:"0.1.1-342"};}},{start:2623,end:3803});}(__varRecorder__$_.InteractiveMorph);__varRecorder__$_.Agency=Agency;__varRecorder__$_.Agency=Agency;__varRecorder__$_.Agency=Agency;var About=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftWebsite/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("About")&&typeof __lively_classholder__.About==="function"?__lively_classholder__.About:__lively_classholder__.About=function About(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayout",value:function About_relayout_(){var aboutSection=this.ui.aboutSection;aboutSection.relayout();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"About";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftWebsite",version:"0.1.1-342"};}},{start:3812,end:3939});}(__varRecorder__$_.InteractiveMorph);__varRecorder__$_.About=About;__varRecorder__$_.About=About;__varRecorder__$_.About=About;var Contact=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftWebsite/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Contact")&&typeof __lively_classholder__.Contact==="function"?__lively_classholder__.Contact:__lively_classholder__.Contact=function Contact(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayout",value:function Contact_relayout_(){var content=this.ui.content;content.relayout();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Contact";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftWebsite",version:"0.1.1-342"};}},{start:3948,end:4067});}(__varRecorder__$_.InteractiveMorph);__varRecorder__$_.Contact=Contact;__varRecorder__$_.Contact=Contact;__varRecorder__$_.Contact=Contact;var Intro=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftWebsite/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Intro")&&typeof __lively_classholder__.Intro==="function"?__lively_classholder__.Intro:__lively_classholder__.Intro=function Intro(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"reset",value:function Intro_reset_(){var _this$ui5=this.ui,snakeGame=_this$ui5.snakeGame,mouseTrajectory=_this$ui5.mouseTrajectory,typeshiftHeadline=_this$ui5.typeshiftHeadline;snakeGame.reactsToPointer=false;mouseTrajectory.vertices=[];snakeGame.opacity=0;typeshiftHeadline.opacity=0;}},{key:"animateIn",value:function(){var _Intro_animateIn_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee179(){var _this$ui6,typeshiftHeadline,snakeGame;return regeneratorRuntime.wrap(function _callee179$(_context179){while(1){switch(_context179.prev=_context179.next){case 0:_this$ui6=this.ui,typeshiftHeadline=_this$ui6.typeshiftHeadline,snakeGame=_this$ui6.snakeGame;typeshiftHeadline.opacity=1;_context179.next=4;return typeshiftHeadline.typeOut();case 4:snakeGame.animate({opacity:1});snakeGame.reactsToPointer=!__varRecorder__$_.touchInputDevice;case 6:case"end":return _context179.stop();}}},_callee179,this);}));function Intro_animateIn_(){return _Intro_animateIn_.apply(this,arguments);}return Intro_animateIn_;}()},{key:"relayout",value:function(){var _Intro_relayout_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee180(){var _this$ui7,introBackground,snakeGame,typeshiftHeadline,freeTalkFlap,naturalDotExtent,isMobile,s;return regeneratorRuntime.wrap(function _callee180$(_context180){while(1){switch(_context180.prev=_context180.next){case 0:_this$ui7=this.ui,introBackground=_this$ui7.introBackground,snakeGame=_this$ui7.snakeGame,typeshiftHeadline=_this$ui7.typeshiftHeadline,freeTalkFlap=_this$ui7.freeTalkFlap;naturalDotExtent=__varRecorder__$_.pt(1850,1062);isMobile=this.width<700;s=Math.max(this.height/naturalDotExtent.y,this.width/naturalDotExtent.x);introBackground.setBounds(__varRecorder__$_.pt(0,0).extent(naturalDotExtent.scaleBy(s)));snakeGame.extent=introBackground.extent;typeshiftHeadline.scale=Math.min(1,this.width/(typeshiftHeadline.width+200));typeshiftHeadline.rightCenter=this.innerBounds().insetBy(50).rightCenter();if(isMobile){freeTalkFlap.scale=1;freeTalkFlap.bottomCenter=typeshiftHeadline.topCenter;}else{freeTalkFlap.scale=1.5;freeTalkFlap.bottomLeft=this.innerBounds().insetBy(100).leftCenter();}if(freeTalkFlap.top<60)freeTalkFlap.top=60;case 10:case"end":return _context180.stop();}}},_callee180,this);}));function Intro_relayout_(){return _Intro_relayout_.apply(this,arguments);}return Intro_relayout_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Intro";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftWebsite",version:"0.1.1-342"};}},{start:4077,end:5512});}(__varRecorder__$_.InteractiveMorph);__varRecorder__$_.Intro=Intro;__varRecorder__$_.Intro=Intro;__varRecorder__$_.Intro=Intro;var TypeshiftWebsite=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftWebsite/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TypeshiftWebsite")&&typeof __lively_classholder__.TypeshiftWebsite==="function"?__lively_classholder__.TypeshiftWebsite:__lively_classholder__.TypeshiftWebsite=function TypeshiftWebsite(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"reset",value:function TypeshiftWebsite_reset_(){this.ui.snakeGame.reactsToPointer=false;this.ui.mouseTrajectory.vertices=[];this.ui.snakeGame.opacity=0;this.ui.typeshiftHeadline.opacity=0;this.ui.scrollContainer.scroll=__varRecorder__$_.pt(0,0);this._loadedSections={};this.ui.content.submorphs=[];}},{key:"startPreloadingSections",value:function TypeshiftWebsite_startPreloadingSections_(){this._loadedSections={};var _iterator94=_createForOfIteratorHelper(this.sectionToUrl),_step94;try{for(_iterator94.s();!(_step94=_iterator94.n()).done;){var _step94$value=_slicedToArray2(_step94.value,2),sectionName=_step94$value[0],loadFn=_step94$value[1];this._loadedSections[sectionName]=loadFn();}}catch(err){_iterator94.e(err);}finally{_iterator94.f();}}},{key:"onLoad",value:function(){var _TypeshiftWebsite_onLoad_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee181(){return regeneratorRuntime.wrap(function _callee181$(_context181){while(1){switch(_context181.prev=_context181.next){case 0:if(lively.FreezerRuntime)__varRecorder__$_.config.css.ibmPlex="";this.startPreloadingSections();_context181.next=4;return this.filterSectionsToShow();case 4:_context181.next=6;return this.whenRendered();case 6:this.ui.scrollContainer._skipScrollUpdate=true;this.ui.projectDetailTile._skipScrollUpdate=true;this.ui.intro.animateIn();case 9:case"end":return _context181.stop();}}},_callee181,this);}));function TypeshiftWebsite_onLoad_(){return _TypeshiftWebsite_onLoad_.apply(this,arguments);}return TypeshiftWebsite_onLoad_;}()},{key:"filterSectionsToShow",value:function(){var _TypeshiftWebsite_filterSectionsToShow_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee182(){var _this228=this;var scrollContainer,sectionToUrl,_scrollContainer$subm,content,accBottom,renderedSections,_iterator95,_step95,_step95$value,sectionName,loadFn,section;return regeneratorRuntime.wrap(function _callee182$(_context182){while(1){switch(_context182.prev=_context182.next){case 0:scrollContainer=this.ui.scrollContainer;sectionToUrl=this.sectionToUrl;if(!this._loadedSections)this._loadedSections={};_scrollContainer$subm=_slicedToArray2(scrollContainer.submorphs,1),content=_scrollContainer$subm[0];accBottom=0;renderedSections=[];_iterator95=_createForOfIteratorHelper(sectionToUrl);_context182.prev=7;_iterator95.s();case 9:if((_step95=_iterator95.n()).done){_context182.next=20;break;}_step95$value=_slicedToArray2(_step95.value,2),sectionName=_step95$value[0],loadFn=_step95$value[1];if(!(accBottom<scrollContainer.scroll.y+this.height+50)){_context182.next=18;break;}_context182.next=14;return this._loadedSections[sectionName]||(this._loadedSections[sectionName]=loadFn());case 14:section=_context182.sent;section.name=sectionName;accBottom+=section.bounds().height;renderedSections.push(section);case 18:_context182.next=9;break;case 20:_context182.next=25;break;case 22:_context182.prev=22;_context182.t0=_context182["catch"](7);_iterator95.e(_context182.t0);case 25:_context182.prev=25;_iterator95.f();return _context182.finish(25);case 28:content.height=accBottom;if(__varRecorder__$_.arr.last(renderedSections).name!="footer"){renderedSections.push(this.bufferMorph);}if(!__varRecorder__$_.arr.equals(content.submorphs,renderedSections)){_context182.next=32;break;}return _context182.abrupt("return");case 32:renderedSections.forEach(function(section){return section.width=_this228.width;});content.submorphs=renderedSections;this._ui=null;this.relayout();case 36:case"end":return _context182.stop();}}},_callee182,this,[[7,22,25,28]]);}));function TypeshiftWebsite_filterSectionsToShow_(){return _TypeshiftWebsite_filterSectionsToShow_.apply(this,arguments);}return TypeshiftWebsite_filterSectionsToShow_;}()},{key:"updateOnScroll",value:function(){var _TypeshiftWebsite_updateOnScroll_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee183(){var _this229=this;var _this$ui8,scrollContainer,agencySection,agencyMobileSection,servicesMobileSection,servicesSubSections,snowfalls,contactSection,global,titleBar,lottieMorphs,demoBlock,servicesSection,servicesWrapper,sections,_p17,_p18,_p19,_p20;return regeneratorRuntime.wrap(function _callee183$(_context183){while(1){switch(_context183.prev=_context183.next){case 0:_this$ui8=this.ui,scrollContainer=_this$ui8.scrollContainer,agencySection=_this$ui8.agencySection,agencyMobileSection=_this$ui8.agencyMobileSection,servicesMobileSection=_this$ui8.servicesMobileSection,servicesSubSections=_this$ui8.servicesSubSections,snowfalls=_this$ui8.snowfalls,contactSection=_this$ui8.contactSection,global=_this$ui8.global,titleBar=_this$ui8.titleBar,lottieMorphs=_this$ui8.lottieMorphs,demoBlock=_this$ui8.demoBlock,servicesSection=_this$ui8.servicesSection,servicesWrapper=_this$ui8.servicesWrapper;this.filterSectionsToShow();if(demoBlock){if(this.localizePointFrom(__varRecorder__$_.pt(0,0),demoBlock).y<this.height*0.8){demoBlock.illustrateDrag();}}_context183.next=5;return Promise.all(Object.values(this._loadedSections));case 5:sections=_context183.sent;sections.forEach(function(section){if(section.updateOnScroll){var _p16=__varRecorder__$_.num.clamp((scrollContainer.scroll.y-section.top+_this229.height/1.5)/section.bounds().height,0,1);section.updateOnScroll(_p16);}});lottieMorphs&&lottieMorphs.map(function(m){return m.initIfNeeded();});snowfalls&&snowfalls.forEach(function(m){if(!m.numberOfSnowflakes)m.startSnowing();});if(agencySection&&agencySection.visible){_p17=__varRecorder__$_.num.clamp((scrollContainer.scroll.y-agencySection.top+this.height/1.5)/agencySection.bounds().height,0,1);agencySection.progress=_p17;}if(agencyMobileSection&&agencyMobileSection.visible){_p18=__varRecorder__$_.num.clamp((scrollContainer.scroll.y-agencyMobileSection.top+this.height/2)/(agencyMobileSection.bounds().height-150),0,1);agencyMobileSection.progress=_p18;}if(servicesSection&&servicesSection.visible){_p19=__varRecorder__$_.num.clamp((scrollContainer.scroll.y-servicesSection.top+this.height/2)/(servicesSection.bounds().height-150),0,1);servicesSection.onOwnerScrolled(_p19>0&&_p19<1);}if(servicesMobileSection&&servicesMobileSection.visible){_p20=__varRecorder__$_.num.clamp((scrollContainer.scroll.y-servicesMobileSection.top+this.height/2)/(servicesMobileSection.bounds().height-150),0,1);servicesWrapper.submorphs.forEach(function(section){return section.onScrollUpdate(_p20>0&&_p20<1);});}if(global){global.progress=__varRecorder__$_.num.clamp((scrollContainer.scroll.y-contactSection.top+this.height/1.5)/contactSection.height,0,1);}if(titleBar.top<0&&scrollContainer.scroll.y>0){titleBar.animate({top:0,duration:1000,easing:__varRecorder__$_.easings.inOutExpo});}case 15:case"end":return _context183.stop();}}},_callee183,this);}));function TypeshiftWebsite_updateOnScroll_(){return _TypeshiftWebsite_updateOnScroll_.apply(this,arguments);}return TypeshiftWebsite_updateOnScroll_;}()},{key:"goToSection",value:function TypeshiftWebsite_goToSection_(sectionName){var _this$ui9=this.ui,scrollContainer=_this$ui9.scrollContainer,content=_this$ui9.content;var isMobile=this.width<700;var sectionsToDisplay=content.submorphs;this.ui.projectDetailTile.close();var idx=__varRecorder__$_.arr.findIndex(sectionsToDisplay,function(wrapper){return wrapper.name==sectionName;});var targetTop=__varRecorder__$_.arr.sum(sectionsToDisplay.slice(0,idx).map(function(wrapper){return wrapper.height;}));this.ui.scrollContainer.animate({scroll:__varRecorder__$_.pt(0,targetTop-50),duration:300});}},{key:"relayout",value:function(){var _TypeshiftWebsite_relayout_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee184(){var isMobile,_this$ui10,servicesSection,servicesMobileSection,servicesSubSections,projectsSection,projectsMobileSection,dottedTexture,introSection,scrollContainer,typeshiftHeadline,agencySection,agencyMobileSection,partners,referencesHeadline,titleBar,snakeGame,introBackground,tiltingTiles,aboutSection,freeFirstTalkWrapper,freeTalkFlap,intro;return regeneratorRuntime.wrap(function _callee184$(_context184){while(1){switch(_context184.prev=_context184.next){case 0:isMobile=this.width<700;_this$ui10=this.ui,servicesSection=_this$ui10.servicesSection,servicesMobileSection=_this$ui10.servicesMobileSection,servicesSubSections=_this$ui10.servicesSubSections,projectsSection=_this$ui10.projectsSection,projectsMobileSection=_this$ui10.projectsMobileSection,dottedTexture=_this$ui10.dottedTexture,introSection=_this$ui10.introSection,scrollContainer=_this$ui10.scrollContainer,typeshiftHeadline=_this$ui10.typeshiftHeadline,agencySection=_this$ui10.agencySection,agencyMobileSection=_this$ui10.agencyMobileSection,partners=_this$ui10.partners,referencesHeadline=_this$ui10.referencesHeadline,titleBar=_this$ui10.titleBar,snakeGame=_this$ui10.snakeGame,introBackground=_this$ui10.introBackground,tiltingTiles=_this$ui10.tiltingTiles,aboutSection=_this$ui10.aboutSection,freeFirstTalkWrapper=_this$ui10.freeFirstTalkWrapper,freeTalkFlap=_this$ui10.freeTalkFlap,intro=_this$ui10.intro;this.layout.forceLayout();freeFirstTalkWrapper.width=Math.min(850,this.width-50);freeFirstTalkWrapper.height=this.height;freeFirstTalkWrapper.bottomCenter=this.innerBounds().bottomCenter();if(isMobile&&tiltingTiles){tiltingTiles.forEach(function(m){return m.relayout();});}if(intro)intro.height=scrollContainer.height;titleBar.enableMobile(isMobile);this.ui.deviceSwitchers&&this.ui.deviceSwitchers.forEach(function(m){m.selectDesktop();});case 10:case"end":return _context184.stop();}}},_callee184,this);}));function TypeshiftWebsite_relayout_(){return _TypeshiftWebsite_relayout_.apply(this,arguments);}return TypeshiftWebsite_relayout_;}()},{key:"onMouseDown",value:function TypeshiftWebsite_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);switch(evt.targetMorph.name){case"tablet":evt.targetMorph.get("device switcher").selectTablet();break;case"desktop":evt.targetMorph.get("device switcher").selectDesktop();break;case"mobile":evt.targetMorph.get("device switcher").selectMobile();break;case"close free talk form button":this.toggleFirstTalkForm(false);break;case"open consulting form":case"free talk flap":this.toggleFirstTalkForm(true);break;case"linkedin":document.location="https://www.linkedin.com/company/typeshift";break;case"instagram":document.location="https://www.instagram.com/typeshift_agentur";break;case"facebook":document.location="https://www.facebook.com/Typeshift-Agentur-f%C3%BCr-Interactive-Content-110571604124159";break;}}},{key:"toggleFirstTalkForm",value:function(){var _TypeshiftWebsite_toggleFirstTalkForm_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee185(active){return regeneratorRuntime.wrap(function _callee185$(_context185){while(1){switch(_context185.prev=_context185.next){case 0:this.ui.freeFirstTalkWrapper.visible=active;_context185.next=3;return this.whenRendered();case 3:this.ui.freeFirstTalkForm.resizeTextAreas();case 4:case"end":return _context185.stop();}}},_callee185,this);}));function TypeshiftWebsite_toggleFirstTalkForm_(_x234){return _TypeshiftWebsite_toggleFirstTalkForm_.apply(this,arguments);}return TypeshiftWebsite_toggleFirstTalkForm_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TypeshiftWebsite";}},{key:"properties",get:function get(){return{sectionOrder:{},bufferMorph:{},title:{get:function get(){return"Typeshift: Agentur fr Interactive Content";}},sectionToUrl:{readOnly:true,get:function get(){return[["intro",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee186(){return regeneratorRuntime.wrap(function _callee186$(_context186){while(1){switch(_context186.prev=_context186.next){case 0:_context186.next=2;return module["import"]('./intro-fa1347e2.js');case 2:_context186.t0=_context186.sent;if(!_context186.t0){_context186.next=7;break;}_context186.next=6;return __varRecorder__$_.resource("part://$world/typeshift/intro");case 6:_context186.t0=_context186.sent;case 7:_context186.next=9;return _context186.t0.read();case 9:return _context186.abrupt("return",_context186.sent);case 10:case"end":return _context186.stop();}}},_callee186);}))],["about",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee187(){return regeneratorRuntime.wrap(function _callee187$(_context187){while(1){switch(_context187.prev=_context187.next){case 0:_context187.next=2;return module["import"]('./about-b3734ecf.js');case 2:_context187.t0=_context187.sent;if(!_context187.t0){_context187.next=7;break;}_context187.next=6;return __varRecorder__$_.resource("part://$world/typeshift/about");case 6:_context187.t0=_context187.sent;case 7:_context187.next=9;return _context187.t0.read();case 9:return _context187.abrupt("return",_context187.sent);case 10:case"end":return _context187.stop();}}},_callee187);}))],["projects",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee188(){return regeneratorRuntime.wrap(function _callee188$(_context188){while(1){switch(_context188.prev=_context188.next){case 0:_context188.next=2;return module["import"]('./projects-16c7e60a.js');case 2:_context188.t0=_context188.sent;if(!_context188.t0){_context188.next=7;break;}_context188.next=6;return __varRecorder__$_.resource("part://$world/typeshift/projects");case 6:_context188.t0=_context188.sent;case 7:_context188.next=9;return _context188.t0.read();case 9:return _context188.abrupt("return",_context188.sent);case 10:case"end":return _context188.stop();}}},_callee188);}))],["services",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee189(){return regeneratorRuntime.wrap(function _callee189$(_context189){while(1){switch(_context189.prev=_context189.next){case 0:_context189.next=2;return module["import"]('./services-472d436a.js');case 2:_context189.t0=_context189.sent;if(!_context189.t0){_context189.next=7;break;}_context189.next=6;return __varRecorder__$_.resource("part://$world/typeshift/services");case 6:_context189.t0=_context189.sent;case 7:_context189.next=9;return _context189.t0.read();case 9:return _context189.abrupt("return",_context189.sent);case 10:case"end":return _context189.stop();}}},_callee189);}))],["agency",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee190(){return regeneratorRuntime.wrap(function _callee190$(_context190){while(1){switch(_context190.prev=_context190.next){case 0:_context190.next=2;return module["import"]('./agency-7f59a25d.js');case 2:_context190.t0=_context190.sent;if(!_context190.t0){_context190.next=7;break;}_context190.next=6;return __varRecorder__$_.resource("part://$world/typeshift/agency");case 6:_context190.t0=_context190.sent;case 7:_context190.next=9;return _context190.t0.read();case 9:return _context190.abrupt("return",_context190.sent);case 10:case"end":return _context190.stop();}}},_callee190);}))],["references",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee191(){return regeneratorRuntime.wrap(function _callee191$(_context191){while(1){switch(_context191.prev=_context191.next){case 0:_context191.next=2;return module["import"]('./references-3132a301.js');case 2:_context191.t0=_context191.sent;if(!_context191.t0){_context191.next=7;break;}_context191.next=6;return __varRecorder__$_.resource("part://$world/typeshift/references");case 6:_context191.t0=_context191.sent;case 7:_context191.next=9;return _context191.t0.read();case 9:return _context191.abrupt("return",_context191.sent);case 10:case"end":return _context191.stop();}}},_callee191);}))],["contact",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee192(){return regeneratorRuntime.wrap(function _callee192$(_context192){while(1){switch(_context192.prev=_context192.next){case 0:_context192.next=2;return module["import"]('./contact-031a3b35.js');case 2:_context192.t0=_context192.sent;if(!_context192.t0){_context192.next=7;break;}_context192.next=6;return __varRecorder__$_.resource("part://$world/typeshift/contact");case 6:_context192.t0=_context192.sent;case 7:_context192.next=9;return _context192.t0.read();case 9:return _context192.abrupt("return",_context192.sent);case 10:case"end":return _context192.stop();}}},_callee192);}))],["footer",/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee193(){return regeneratorRuntime.wrap(function _callee193$(_context193){while(1){switch(_context193.prev=_context193.next){case 0:_context193.next=2;return module["import"]('./footer-62ad4f8b.js');case 2:_context193.t0=_context193.sent;if(!_context193.t0){_context193.next=7;break;}_context193.next=6;return __varRecorder__$_.resource("part://$world/typeshift/footer");case 6:_context193.t0=_context193.sent;case 7:_context193.next=9;return _context193.t0.read();case 9:return _context193.abrupt("return",_context193.sent);case 10:case"end":return _context193.stop();}}},_callee193);}))]];}},__crawler_html__:{get:function get(){return"\n      <div itemscope itemtype=\"http://schema.org/Organization\">\n      <h1 itemprop=\"slogan\">\n      Wir kommunizieren Komplexes, Stories und Unternehmensinhalte mit ma\xDFgeschneiderten interaktiven Websites und Webapps. Wir setzen auf innovative digitale Formate, die neugierig machen, ohne oberfl\xE4chlich zu sein.\n      </h1>\n      <h2 itemprop=\"description\">\n      Typeshift ist ein junge Digitalagentur aus Potsdam. Unsere Superpower ist Interactive Content. Und wenn wir \u201Cinteraktiv\u201D sagen, dann meinen wir es auch so. F\xFCr uns bedeutet dieses Wort mehr als Likes, Kommentare oder Quizfragen. Wir machen Produkte greifbar und Stories zum Erlebnis. Nat\xFCrlich alles ma\xDFgeschneidert, Einheitsgr\xF6\xDFen passen doch eh nie richtig.\nTalk nerdy to us! Im Herzen sind wir Nerds und wenn\u2019s kompliziert wird, fangen wir an zu schnurren. Mit interaktiven dynamischen Formaten machen wir komplexe Themen zug\xE4nglich und leichter verst\xE4ndlich, ohne oberfl\xE4chlich zu sein. Oder in den Worten einer alten fern\xF6stlichen Weisheit: Eine Interaction sagt mehr als tausend Worte. \nAls Team aus Vollblutkreativen und Techies (Full Stack Software Development, Baby!) sind wir in Projekten wie unser Interactive Content: beweglich und einfach liebenswert.\n      </h2>\n      <div itemscope itemprop=\"founder\" itemtype=\"http://schema.org/Person\">\n      <h3 itemprop=\"name\">Doreen Stahr</h3>\n      <p itemprop=\"jobTitle\">Creative Text + Konzept</p>\n      <p itemprop=\"description\">\n      Doreen Stahr hat Literaturwissenschaft, Philosophie und Design Thinking in Berlin und Potsdam studiert. Nach ihrem Abschluss arbeitete sie als Texterin f\xFCr Werbeagenturen im In- und Ausland. Sie mag B\xFCcher und wei\xDFen Tee.\n      </p>\n      </div>\n      <div itemscope itemprop=\"founder\" itemtype=\"http://schema.org/Person\">\n      <h3 itemprop=\"name\">Robin Schreiber</h3>\n      <p itemprop=\"jobTitle\">Creative Code + Konzept</p>\n      <p itemprop=\"description\">\n      Robin Schreiber hat IT Systems Engineering in Potsdam und Santa Cruz studiert. Anschlie\xDFend befasste er sich als Researcher mit der Kommunikation zwischen Computer und Mensch. Seine Lieblingssprachen sind Python, Javascript, C, Smalltalk und Japanisch.\n      </p>\n      </div>\n      ";}},__head_html__:{readOnly:true,derived:true,get:function get(){return"\n            <meta name=\"description\" content=\"Agentur f\xFCr Interactive Storytelling\">\n      <!-- Global site tag (gtag.js) - Google Analytics -->\n      <script async src=\"https://www.googletagmanager.com/gtag/js?id=UA-133855617-3\"></script>\n      <script>\n        window.dataLayer = window.dataLayer || [];\n        function gtag(){dataLayer.push(arguments);}\n        gtag('js', new Date());\n      \n        gtag('config', 'UA-133855617-3');\n      </script>\n      <meta name=\"google-site-verification\" content=\"lJcUm7uPZ2LCDKbfdeVFkQpL9hcNRo9G05nNVb0rgTM\" />\n      <link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"/resources/typeshift.ico/apple-touch-icon.png\">\n      <link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"/resources/typeshift.ico/favicon-32x32.png\">\n      <link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"/resources/typeshift.ico/favicon-16x16.png\">\n      <link rel=\"manifest\" href=\"/resources/typeshift.ico/site.webmanifest\">\n      <link rel=\"mask-icon\" href=\"/resources/typeshift.ico/safari-pinned-tab.svg\" color=\"#5bbad5\">\n      <link rel=\"preload\" href=\"https://cdn.typeshift.io/assets/font-awesome/css/font-awesome.min.css\" as=\"style\">\n      <link rel=\"preload\" href=\"https://cdn.typeshift.io/assets/inconsolata/inconsolata.css\" as=\"style\">\n      <meta name=\"msapplication-TileColor\" content=\"#da532c\">\n      <meta name=\"theme-color\" content=\"#ffffff\">\n<style type=\"text/css\" id=\"Morph_238227ED_6569_415C_B080_750B267D06A4-Roboto\">@import url(\"https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap\");</style>\n<style type=\"text/css\" id=\"Morph_238227ED_6569_415C_B080_750B267D06A4-Nunito\">@import url(\"https://fonts.googleapis.com/css2?family=Nunito:wght@200;400;700&family=Roboto:wght@500;700&display=swap\");</style>\n          ";}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftWebsite",version:"0.1.1-342"};}},{start:5529,end:18613});}(__varRecorder__$_.InteractiveMorph);TypeshiftWebsite=__varRecorder__$_.TypeshiftWebsite;__varRecorder__$_["default"]=TypeshiftWebsite;var __varRecorder__$$=lively.FreezerRuntime.recorderFor("ProjectDetails/index.js");__varRecorder__$$.Morph=Morph;__varRecorder__$$.easings=easings;__varRecorder__$$.Color=Color$1;__varRecorder__$$.pt=pt;__varRecorder__$$.InteractiveMorph=InteractiveMorph;__varRecorder__$$.promise=promise;var ProjectDetails=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("ProjectDetails/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ProjectDetails")&&typeof __lively_classholder__.ProjectDetails==="function"?__lively_classholder__.ProjectDetails:__lively_classholder__.ProjectDetails=function ProjectDetails(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"openLinkedExample",value:function ProjectDetails_openLinkedExample_(){if(lively.FreezerRuntime)document.location=this._expandedTile.projectInfo.link;}},{key:"display",value:function(){var _ProjectDetails_display_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee194(active,linkTile){var _this$ui11,screenTile1,screenTile2,screenTile3,projectDescription,projectTitle,projectCabinet,horizontalFlow,animationTile,clientName,clientLabel,projectCategory,categoryLabel,projectDate,dateLabel,_i189,_arr4,tile,_linkTile$projectInfo,_title,description,screenshots,client,category,_date,_i190,_i191,_arr5,_tile,img;return regeneratorRuntime.wrap(function _callee194$(_context194){while(1){switch(_context194.prev=_context194.next){case 0:_this$ui11=this.ui,screenTile1=_this$ui11.screenTile1,screenTile2=_this$ui11.screenTile2,screenTile3=_this$ui11.screenTile3,projectDescription=_this$ui11.projectDescription,projectTitle=_this$ui11.projectTitle,projectCabinet=_this$ui11.projectCabinet,horizontalFlow=_this$ui11.horizontalFlow,animationTile=_this$ui11.animationTile,clientName=_this$ui11.clientName,clientLabel=_this$ui11.clientLabel,projectCategory=_this$ui11.projectCategory,categoryLabel=_this$ui11.categoryLabel,projectDate=_this$ui11.projectDate,dateLabel=_this$ui11.dateLabel;this._expandedTile=linkTile;if(active){projectCabinet.scroll=__varRecorder__$$.pt(0,0);this.visible=true;this.setColor(linkTile.getColor());this.position=this.owner.localizePointFrom(__varRecorder__$$.pt(0,0),linkTile).subPt(__varRecorder__$$.pt(5,5));}if(active){projectCabinet.opacity=1;horizontalFlow.opacity=1;this.scale=1;this.fill=__varRecorder__$$.Color.white;this.position=__varRecorder__$$.pt(0,0);this.extent=this.owner.extent;this.get("project selection").opacity=0;this.get("load more").opacity=0;}else{projectCabinet.opacity=0;horizontalFlow.opacity=0;this.scale=0.6364612496337942;this.fill=__varRecorder__$$.Color.transparent;this.position=this.owner.localizePointFrom(__varRecorder__$$.pt(0,0),linkTile).subPt(__varRecorder__$$.pt(5,5));this.get("project selection").opacity=1;this.get("load more").opacity=1;for(_i189=0,_arr4=[screenTile1,screenTile2,screenTile3];_i189<_arr4.length;_i189++){tile=_arr4[_i189];tile.opacity=0;}}if(!active){_context194.next=28;break;}_linkTile$projectInfo=linkTile.projectInfo,_title=_linkTile$projectInfo.title,description=_linkTile$projectInfo.description,screenshots=_linkTile$projectInfo.screenshots,client=_linkTile$projectInfo.client,category=_linkTile$projectInfo.category,_date=_linkTile$projectInfo.date;projectTitle.textString=_title;projectDescription.textString=description;clientLabel.visible=clientLabel.isLayoutable=!!client;clientName.visible=clientName.isLayoutable=!!client;if(client)clientName.textString=client;_i190=0;_i191=0,_arr5=[screenTile1,screenTile2,screenTile3];case 13:if(!(_i191<_arr5.length)){_context194.next=26;break;}_tile=_arr5[_i191];img=screenshots[_i190];_tile.submorphs=[img];img.scale=1;img.center=_tile.innerBounds().center();_i190++;_tile.animate({opacity:1,duration:300,easing:__varRecorder__$$.easings.inOutExpo});_context194.next=23;return __varRecorder__$$.promise.delay(100);case 23:_i191++;_context194.next=13;break;case 26:projectCategory.value=category;projectDate.value=_date;case 28:if(!active)this.visible=false;case 29:case"end":return _context194.stop();}}},_callee194,this);}));function ProjectDetails_display_(_x235,_x236){return _ProjectDetails_display_.apply(this,arguments);}return ProjectDetails_display_;}()},{key:"onMouseDown",value:function ProjectDetails_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);if(evt.targetMorph.name=="back button"){this.close();this._expandedTile.visible=true;}}},{key:"close",value:function ProjectDetails_close_(){if(this._expandedTile)this.display(false,this._expandedTile);}},{key:"setColor",value:function ProjectDetails_setColor_(c){this.ui.screenTile1.fill=c;this.ui.screenTile2.fill=c;this.ui.screenTile3.fill=c;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ProjectDetails";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"ProjectDetails",version:"0.1.1-69"};}},{start:239,end:3198});}(__varRecorder__$$.InteractiveMorph);ProjectDetails=__varRecorder__$$.ProjectDetails;__varRecorder__$$["default"]=ProjectDetails;var __varRecorder__$10=lively.FreezerRuntime.recorderFor("VideoTile/index.js");__varRecorder__$10.Morph=Morph;var VideoTile=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("VideoTile/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("VideoTile")&&typeof __lively_classholder__.VideoTile==="function"?__lively_classholder__.VideoTile:__lively_classholder__.VideoTile=function VideoTile(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayout",value:function VideoTile_relayout_(){var _this$submorphs3=_slicedToArray2(this.submorphs,1),video=_this$submorphs3[0];video.scale=Math.max(this.width/video.width,this.height/video.height);video.center=this.innerBounds().center();}},{key:"onOwnerChanged",value:function VideoTile_onOwnerChanged_(newOwner){var _this230=this;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onOwnerChanged",this).call(this,newOwner);newOwner&&this.whenRendered().then(function(){var _this230$getSubmorphN=_this230.getSubmorphNamed("video").domNode.getElementsByTagName("video"),_this230$getSubmorphN2=_slicedToArray2(_this230$getSubmorphN,1),video=_this230$getSubmorphN2[0];if(video)video.play();});}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"VideoTile";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"VideoTile",version:"0.1.1-13"};}},{start:65,end:536});}(__varRecorder__$10.Morph);VideoTile=__varRecorder__$10.VideoTile;__varRecorder__$10["default"]=VideoTile;var __varRecorder__$11=lively.FreezerRuntime.recorderFor("VanillaContactForm/index.js");__varRecorder__$11.HTMLMorph=HTMLMorph;__varRecorder__$11.easings=easings;__varRecorder__$11.pt=pt;__varRecorder__$11.resource=resource;var VanillaContactForm=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("VanillaContactForm/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("VanillaContactForm")&&typeof __lively_classholder__.VanillaContactForm==="function"?__lively_classholder__.VanillaContactForm:__lively_classholder__.VanillaContactForm=function VanillaContactForm(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onLoad",value:function(){var _VanillaContactForm_onLoad_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee195(){var _this231=this;var _this$ui12,infoInputs,messageField,_i192,_arr6,_f3;return regeneratorRuntime.wrap(function _callee195$(_context195){while(1){switch(_context195.prev=_context195.next){case 0:_this$ui12=this.ui,infoInputs=_this$ui12.infoInputs,messageField=_this$ui12.messageField;for(_i192=0,_arr6=[messageField].concat(_toConsumableArray2(infoInputs));_i192<_arr6.length;_i192++){_f3=_arr6[_i192];_f3.onkeyup=function(){return _this231.resizeTextAreas();};}_context195.next=4;return this.whenRendered(Infinity);case 4:this.resizeTextAreas();case 5:case"end":return _context195.stop();}}},_callee195,this);}));function VanillaContactForm_onLoad_(){return _VanillaContactForm_onLoad_.apply(this,arguments);}return VanillaContactForm_onLoad_;}()},{key:"cantMeasureDOM",get:function get(){return this.ownerChain().some(function(m){return!m.visible;});}},{key:"resizeTextAreas",value:function VanillaContactForm_resizeTextAreas_(){if(this.cantMeasureDOM);var _this$ui13=this.ui,infoInputs=_this$ui13.infoInputs,messageField=_this$ui13.messageField,fontMeasure=_this$ui13.fontMeasure,form=_this$ui13.form;infoInputs.map(function(area){return[area,area.value||area.placeholder];}).map(function(_ref149){var _ref150=_slicedToArray2(_ref149,2),area=_ref150[0],value=_ref150[1];area.classList.remove("error");fontMeasure.innerText=value.length>area.placeholder.length?value:area.placeholder;area.style.width="".concat(fontMeasure.getBoundingClientRect().width+5,"px");});fontMeasure.innerText=messageField.value+"lol";messageField.style.height="".concat(Math.max(fontMeasure.getBoundingClientRect().height,60)+40,"px");this.height=form.getBoundingClientRect().height/this.scale+100;this.relayout();}},{key:"relayout",value:function VanillaContactForm_relayout_(animation){var thanksOverlay=this.getSubmorphNamed("thank you message");var l=Math.max(this.height,this.width);thanksOverlay.width=this.width;thanksOverlay.left=0;}},{key:"toggleError",value:function VanillaContactForm_toggleError_(field){field.classList.add("error");}},{key:"checkEmail",value:function VanillaContactForm_checkEmail_(mail){return mail&&mail.match(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/);}},{key:"checkPhone",value:function VanillaContactForm_checkPhone_(phone){return!phone||phone.match(/^(?:\+\d{1,3}|0\d{1,3}|00\d{1,2})?(?:\s?\(\d+\))?(?:[-\/\s.]|\d)+$/);}},{key:"submit",value:function VanillaContactForm_submit_(){var infoInputs=this.ui.infoInputs;var formData={subject:this.subject};var error=false;var _iterator96=_createForOfIteratorHelper(infoInputs),_step96;try{for(_iterator96.s();!(_step96=_iterator96.n()).done;){var field=_step96.value;switch(field.getAttribute("data-type")){case"mail":if(!this.checkEmail(field.value)){error=true;this.toggleError(field);}formData.mail=field.value;break;case"phone":if(!this.checkPhone(field.value)){error=true;this.toggleError(field);}formData.phone=field.value;break;case"surname":formData.lastName=field.value;if(!field.value){error=true;this.toggleError(field);}break;case"name":if(!field.value){error=true;this.toggleError(field);}formData.firstName=field.value;break;case"company":formData.company=field.value;break;}}}catch(err){_iterator96.e(err);}finally{_iterator96.f();}if(error){return;}formData.message=this.ui.messageField.value;__varRecorder__$11.resource(self.origin+"/subserver/MailService").post(JSON.stringify(formData));this.toggleThanks(true);}},{key:"toggleThanks",value:function(){var _VanillaContactForm_toggleThanks_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee196(visible){var thankYou,submit,greeter,duration,easing;return regeneratorRuntime.wrap(function _callee196$(_context196){while(1){switch(_context196.prev=_context196.next){case 0:thankYou=this.getSubmorphNamed("thank you message");submit=this.getSubmorphNamed("submit button");greeter=this.getSubmorphNamed("thanks");if(visible){_context196.next=10;break;}greeter.opacity=0;submit.opacity=1;thankYou.visible=false;thankYou.opacity=0;this.resizeTextAreas();return _context196.abrupt("return");case 10:duration=300;easing=__varRecorder__$11.easings.inOutQint;_context196.next=14;return submit.animate({opacity:0,duration:duration,easing:easing});case 14:thankYou.visible=true;thankYou.animate({opacity:1,duration:duration,easing:easing});this.animate({height:320,duration:duration,easing:easing});this.relayout({duration:duration,easing:easing});this.get("letter").html=this.get("letter").html;greeter.animate({opacity:1});case 20:case"end":return _context196.stop();}}},_callee196,this);}));function VanillaContactForm_toggleThanks_(_x237){return _VanillaContactForm_toggleThanks_.apply(this,arguments);}return VanillaContactForm_toggleThanks_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"VanillaContactForm";}},{key:"properties",get:function get(){return{subject:{},fontColor:{after:["submorphs"],set:function set(c){var _this$ui14=this.ui,closeButton=_this$ui14.closeButton,thankYou=_this$ui14.thankYou;this.setProperty("fontColor",c);thankYou.fontColor=c;if(closeButton)closeButton.fontColor=c.withA(0.7);var paths=Array.from(this.get("letter").domNode.getElementsByTagName("path"));paths.forEach(function(path){return path.style.stroke=c.toCSSString();});}},ui:{readOnly:true,get:function get(){var infoInputs=Array.from(this.domNode.getElementsByClassName("info"));var messageField=this.domNode.getElementsByClassName("message")[0];var fontMeasure=this.domNode.getElementsByClassName("measurement")[0];var form=this.domNode.getElementsByClassName("form")[0];return{closeButton:this.getSubmorphNamed("angebot close"),thankYou:this.getSubmorphNamed("thanks"),infoInputs:infoInputs,messageField:messageField,fontMeasure:fontMeasure,form:form};}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"VanillaContactForm",version:"0.1.1-157"};}},{start:188,end:5747});}(__varRecorder__$11.HTMLMorph);VanillaContactForm=__varRecorder__$11.VanillaContactForm;__varRecorder__$11["default"]=VanillaContactForm;/*
       * Copyright 2016 Small Batch, Inc.
       *
       * Licensed under the Apache License, Version 2.0 (the "License"); you may not
       * use this file except in compliance with the License. You may obtain a copy of
       * the License at
       *
       * http://www.apache.org/licenses/LICENSE-2.0
       *
       * Unless required by applicable law or agreed to in writing, software
       * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
       * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
       * License for the specific language governing permissions and limitations under
       * the License.
       */ /* Web Font Loader v1.6.26 - (c) Adobe Systems, Google. License: Apache 2.0 */(function(){function aa(a,b,c){return a.call.apply(a.bind,arguments);}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c);};}return function(){return a.apply(b,arguments);};}function p(a,b,c){p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return p.apply(null,arguments);}var q=Date.now||function(){return+new Date();};function ca(a,b){this.a=a;this.m=b||a;this.c=this.m.document;}var da=!!window.FontFace;function t(a,b,c,d){b=a.c.createElement(b);if(c)for(var e in c){c.hasOwnProperty(e)&&("style"==e?b.style.cssText=c[e]:b.setAttribute(e,c[e]));}d&&b.appendChild(a.c.createTextNode(d));return b;}function u(a,b,c){a=a.c.getElementsByTagName(b)[0];a||(a=document.documentElement);a.insertBefore(c,a.lastChild);}function v(a){a.parentNode&&a.parentNode.removeChild(a);}function w(a,b,c){b=b||[];c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1){if(b[e]===d[g]){f=!0;break;}}f||d.push(b[e]);}b=[];for(e=0;e<d.length;e+=1){f=!1;for(g=0;g<c.length;g+=1){if(d[e]===c[g]){f=!0;break;}}f||b.push(d[e]);}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"");}function y(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++){if(c[d]==b)return!0;}return!1;}function z(a){if("string"===typeof a.f)return a.f;var b=a.m.location.protocol;"about:"==b&&(b=a.a.location.protocol);return"https:"==b?"https:":"http:";}function ea(a){return a.m.location.hostname||a.a.location.hostname;}function A(a,b,c){function d(){k&&e&&f&&(k(g),k=null);}b=t(a,"link",{rel:"stylesheet",href:b,media:"all"});var e=!1,f=!0,g=null,k=c||null;da?(b.onload=function(){e=!0;d();},b.onerror=function(){e=!0;g=Error("Stylesheet failed to load");d();}):setTimeout(function(){e=!0;d();},0);u(a,"head",b);}function B(a,b,c,d){var e=a.c.getElementsByTagName("head")[0];if(e){var f=t(a,"script",{src:b}),g=!1;f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,c&&c(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f));};e.appendChild(f);setTimeout(function(){g||(g=!0,c&&c(Error("Script load timeout")));},d||5E3);return f;}return null;}function C(){this.a=0;this.c=null;}function D(a){a.a++;return function(){a.a--;E(a);};}function F(a,b){a.c=b;E(a);}function E(a){0==a.a&&a.c&&(a.c(),a.c=null);}function G(a){this.a=a||"-";}G.prototype.c=function(a){for(var b=[],c=0;c<arguments.length;c++){b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());}return b.join(this.a);};function H(a,b){this.c=a;this.f=4;this.a="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.a=c[1],this.f=parseInt(c[2],10));}function fa(a){return I(a)+" "+(a.f+"00")+" 300px "+J(a.c);}function J(a){var b=[];a=a.split(/,\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['"]/g,"");-1!=d.indexOf(" ")||/^\d/.test(d)?b.push("'"+d+"'"):b.push(d);}return b.join(",");}function K(a){return a.a+a.f;}function I(a){var b="normal";"o"===a.a?b="oblique":"i"===a.a&&(b="italic");return b;}function ga(a){var b=4,c="n",d=null;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b;}function ha(a,b){this.c=a;this.f=a.m.document.documentElement;this.h=b;this.a=new G("-");this.j=!1!==b.events;this.g=!1!==b.classes;}function ia(a){a.g&&w(a.f,[a.a.c("wf","loading")]);L(a,"loading");}function M(a){if(a.g){var b=y(a.f,a.a.c("wf","active")),c=[],d=[a.a.c("wf","loading")];b||c.push(a.a.c("wf","inactive"));w(a.f,c,d);}L(a,"inactive");}function L(a,b,c){if(a.j&&a.h[b])if(c)a.h[b](c.c,K(c));else a.h[b]();}function ja(){this.c={};}function ka(a,b,c){var d=[],e;for(e in b){if(b.hasOwnProperty(e)){var f=a.c[e];f&&d.push(f(b[e],c));}}return d;}function N(a,b){this.c=a;this.f=b;this.a=t(this.c,"span",{"aria-hidden":"true"},this.f);}function O(a){u(a.c,"body",a.a);}function P(a){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+J(a.c)+";"+("font-style:"+I(a)+";font-weight:"+(a.f+"00")+";");}function Q(a,b,c,d,e,f){this.g=a;this.j=b;this.a=d;this.c=c;this.f=e||3E3;this.h=f||void 0;}Q.prototype.start=function(){var a=this.c.m.document,b=this,c=q(),d=new Promise(function(d,e){function k(){q()-c>=b.f?e():a.fonts.load(fa(b.a),b.h).then(function(a){1<=a.length?d():setTimeout(k,25);},function(){e();});}k();}),e=new Promise(function(a,d){setTimeout(d,b.f);});Promise.race([e,d]).then(function(){b.g(b.a);},function(){b.j(b.a);});};function R(a,b,c,d,e,f,g){this.v=a;this.B=b;this.c=c;this.a=d;this.s=g||"BESbswy";this.f={};this.w=e||3E3;this.u=f||null;this.o=this.j=this.h=this.g=null;this.g=new N(this.c,this.s);this.h=new N(this.c,this.s);this.j=new N(this.c,this.s);this.o=new N(this.c,this.s);a=new H(this.a.c+",serif",K(this.a));a=P(a);this.g.a.style.cssText=a;a=new H(this.a.c+",sans-serif",K(this.a));a=P(a);this.h.a.style.cssText=a;a=new H("serif",K(this.a));a=P(a);this.j.a.style.cssText=a;a=new H("sans-serif",K(this.a));a=P(a);this.o.a.style.cssText=a;O(this.g);O(this.h);O(this.j);O(this.o);}var S={D:"serif",C:"sans-serif"},T=null;function U(){if(null===T){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);T=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10));}return T;}R.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=q();la(this);};function ma(a,b,c){for(var d in S){if(S.hasOwnProperty(d)&&b===a.f[S[d]]&&c===a.f[S[d]])return!0;}return!1;}function la(a){var b=a.g.a.offsetWidth,c=a.h.a.offsetWidth,d;(d=b===a.f.serif&&c===a.f["sans-serif"])||(d=U()&&ma(a,b,c));d?q()-a.A>=a.w?U()&&ma(a,b,c)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?V(a,a.v):V(a,a.B):na(a):V(a,a.v);}function na(a){setTimeout(p(function(){la(this);},a),50);}function V(a,b){setTimeout(p(function(){v(this.g.a);v(this.h.a);v(this.j.a);v(this.o.a);b(this.a);},a),0);}function W(a,b,c){this.c=a;this.a=b;this.f=0;this.o=this.j=!1;this.s=c;}var X=null;W.prototype.g=function(a){var b=this.a;b.g&&w(b.f,[b.a.c("wf",a.c,K(a).toString(),"active")],[b.a.c("wf",a.c,K(a).toString(),"loading"),b.a.c("wf",a.c,K(a).toString(),"inactive")]);L(b,"fontactive",a);this.o=!0;oa(this);};W.prototype.h=function(a){var b=this.a;if(b.g){var c=y(b.f,b.a.c("wf",a.c,K(a).toString(),"active")),d=[],e=[b.a.c("wf",a.c,K(a).toString(),"loading")];c||d.push(b.a.c("wf",a.c,K(a).toString(),"inactive"));w(b.f,d,e);}L(b,"fontinactive",a);oa(this);};function oa(a){0==--a.f&&a.j&&(a.o?(a=a.a,a.g&&w(a.f,[a.a.c("wf","active")],[a.a.c("wf","loading"),a.a.c("wf","inactive")]),L(a,"active")):M(a.a));}function pa(a){this.j=a;this.a=new ja();this.h=0;this.f=this.g=!0;}pa.prototype.load=function(a){this.c=new ca(this.j,a.context||this.j);this.g=!1!==a.events;this.f=!1!==a.classes;qa(this,new ha(this.c,a),a);};function ra(a,b,c,d,e){var f=0==--a.h;(a.f||a.g)&&setTimeout(function(){var a=e||null,k=d||null||{};if(0===c.length&&f)M(b.a);else{b.f+=c.length;f&&(b.j=f);var h,m=[];for(h=0;h<c.length;h++){var l=c[h],n=k[l.c],r=b.a,x=l;r.g&&w(r.f,[r.a.c("wf",x.c,K(x).toString(),"loading")]);L(r,"fontloading",x);r=null;null===X&&(X=window.FontFace?(x=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(x[1],10):!0:!1);X?r=new Q(p(b.g,b),p(b.h,b),b.c,l,b.s,n):r=new R(p(b.g,b),p(b.h,b),b.c,l,b.s,a,n);m.push(r);}for(h=0;h<m.length;h++){m[h].start();}}},0);}function qa(a,b,c){var d=[],e=c.timeout;ia(b);var d=ka(a.a,c,a.c),f=new W(a.c,b,e);a.h=d.length;b=0;for(c=d.length;b<c;b++){d[b].load(function(b,d,c){ra(a,f,b,d,c);});}}function sa(a,b){this.c=a;this.a=b;}function ta(a,b,c){var d=z(a.c);a=(a.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return d+"//"+a+"/"+b+".js"+(c?"?v="+c:"");}sa.prototype.load=function(a){function b(){if(f["__mti_fntLst"+d]){var c=f["__mti_fntLst"+d](),e=[],h;if(c)for(var m=0;m<c.length;m++){var l=c[m].fontfamily;void 0!=c[m].fontStyle&&void 0!=c[m].fontWeight?(h=c[m].fontStyle+c[m].fontWeight,e.push(new H(l,h))):e.push(new H(l));}a(e);}else setTimeout(function(){b();},50);}var c=this,d=c.a.projectId,e=c.a.version;if(d){var f=c.c.m;B(this.c,ta(c,d,e),function(e){e?a([]):(f["__MonotypeConfiguration__"+d]=function(){return c.a;},b());}).id="__MonotypeAPIScript__"+d;}else a([]);};function ua(a,b){this.c=a;this.a=b;}ua.prototype.load=function(a){var b,c,d=this.a.urls||[],e=this.a.families||[],f=this.a.testStrings||{},g=new C();b=0;for(c=d.length;b<c;b++){A(this.c,d[b],D(g));}var k=[];b=0;for(c=e.length;b<c;b++){if(d=e[b].split(":"),d[1])for(var h=d[1].split(","),m=0;m<h.length;m+=1){k.push(new H(d[0],h[m]));}else k.push(new H(d[0]));}F(g,function(){a(k,f);});};function va(a,b,c){a?this.c=a:this.c=b+wa;this.a=[];this.f=[];this.g=c||"";}var wa="//fonts.googleapis.com/css";function xa(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d].split(":");3==e.length&&a.f.push(e.pop());var f="";2==e.length&&""!=e[1]&&(f=":");a.a.push(e.join(f));}}function ya(a){if(0==a.a.length)throw Error("No fonts to load!");if(-1!=a.c.indexOf("kit="))return a.c;for(var b=a.a.length,c=[],d=0;d<b;d++){c.push(a.a[d].replace(/ /g,"+"));}b=a.c+"?family="+c.join("%7C");0<a.f.length&&(b+="&subset="+a.f.join(","));0<a.g.length&&(b+="&text="+encodeURIComponent(a.g));return b;}function za(a){this.f=a;this.a=[];this.c={};}var Aa={latin:"BESbswy","latin-ext":"\xE7\xF6\xFC\u011F\u015F",cyrillic:"\u0439\u044F\u0416",greek:"\u03B1\u03B2\u03A3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},Ba={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ca={i:"i",italic:"i",n:"n",normal:"n"},Da=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function Ea(a){for(var b=a.f.length,c=0;c<b;c++){var d=a.f[c].split(":"),e=d[0].replace(/\+/g," "),f=["n4"];if(2<=d.length){var g;var k=d[1];g=[];if(k)for(var k=k.split(","),h=k.length,m=0;m<h;m++){var l;l=k[m];if(l.match(/^[\w-]+$/)){var n=Da.exec(l.toLowerCase());if(null==n)l="";else{l=n[2];l=null==l||""==l?"n":Ca[l];n=n[1];if(null==n||""==n)n="4";else var r=Ba[n],n=r?r:isNaN(n)?"4":n.substr(0,1);l=[l,n].join("");}}else l="";l&&g.push(l);}0<g.length&&(f=g);3==d.length&&(d=d[2],g=[],d=d?d.split(","):g,0<d.length&&(d=Aa[d[0]])&&(a.c[e]=d));}a.c[e]||(d=Aa[e])&&(a.c[e]=d);for(d=0;d<f.length;d+=1){a.a.push(new H(e,f[d]));}}}function Fa(a,b){this.c=a;this.a=b;}var Ga={Arimo:!0,Cousine:!0,Tinos:!0};Fa.prototype.load=function(a){var b=new C(),c=this.c,d=new va(this.a.api,z(c),this.a.text),e=this.a.families;xa(d,e);var f=new za(e);Ea(f);A(c,ya(d),D(b));F(b,function(){a(f.a,f.c,Ga);});};function Ha(a,b){this.c=a;this.a=b;}Ha.prototype.load=function(a){var b=this.a.id,c=this.c.m;b?B(this.c,(this.a.api||"https://use.typekit.net")+"/"+b+".js",function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var e=[],f=0;f<b.length;f+=2){for(var g=b[f],k=b[f+1],h=0;h<k.length;h++){e.push(new H(g,k[h]));}}try{c.Typekit.load({events:!1,classes:!1,async:!0});}catch(m){}a(e);}},2E3):a([]);};function Ia(a,b){this.c=a;this.f=b;this.a=[];}Ia.prototype.load=function(a){var b=this.f.id,c=this.c.m,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var g=0,k=c.fonts.length;g<k;++g){var h=c.fonts[g];d.a.push(new H(h.name,ga("font-weight:"+h.weight+";font-style:"+h.style)));}a(d.a);},B(this.c,z(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+ea(this.c)+"/"+b+".js",function(b){b&&a([]);})):a([]);};var Y=new pa(window);Y.a.c.custom=function(a,b){return new ua(b,a);};Y.a.c.fontdeck=function(a,b){return new Ia(b,a);};Y.a.c.monotype=function(a,b){return new sa(b,a);};Y.a.c.typekit=function(a,b){return new Ha(b,a);};Y.a.c.google=function(a,b){return new Fa(b,a);};var Z={load:p(Y.load,Y)};"function"===typeof define&&define.amd?define(function(){return Z;}):"undefined"!==typeof module&&module.exports?module.exports=Z:(window.WebFont=Z,window.WebFontConfig&&Y.load(window.WebFontConfig));})();var __varRecorder__$12=lively.FreezerRuntime.recorderFor("TypeshiftDesktop/index.js");__varRecorder__$12.Morph=Morph;__varRecorder__$12.morph=morph;__varRecorder__$12.Text=Text;__varRecorder__$12.addOrChangeCSSDeclaration=addOrChangeCSSDeclaration;__varRecorder__$12.easings=easings;__varRecorder__$12.connect=connect;__varRecorder__$12.once=once$1;__varRecorder__$12.arr=arr;__varRecorder__$12.obj=obj;__varRecorder__$12.promise=promise;__varRecorder__$12.num=num;__varRecorder__$12.pt=pt;__varRecorder__$12.Color=Color$1;__varRecorder__$12.addOrChangeLinkedCSS=addOrChangeLinkedCSS;__varRecorder__$12.WebFont=_missingExportShim;__varRecorder__$12.ObjectRef=ObjectRef;var WebsiteTextField=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftDesktop/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("WebsiteTextField")&&typeof __lively_classholder__.WebsiteTextField==="function"?__lively_classholder__.WebsiteTextField:__lively_classholder__.WebsiteTextField=function WebsiteTextField(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"toggleEditable",value:function WebsiteTextField_toggleEditable_(editable){this.readOnly=!editable;this.reactsToPointer=true;this.selectable=editable;this.invalidateTextLayout(true,true);}},{key:"onHoverIn",value:function WebsiteTextField_onHoverIn_(evt){if(this.readOnly)return;this.toggleBorderHalo(true);}},{key:"onHoverOut",value:function WebsiteTextField_onHoverOut_(evt){if(this.readOnly)return;if(this.isFocused())return;this.toggleBorderHalo(false);}},{key:"toggleBorderHalo",value:function WebsiteTextField_toggleBorderHalo_(active){this.borderHalo&&this.borderHalo.remove();if(active){this.borderHalo=__varRecorder__$12.morph({borderColor:__varRecorder__$12.Color.orange,borderWidth:3,styleClasses:["halo"],reactsToPointer:false,bounds:this.globalBounds(),fill:null}).openInWorld();this.borderHalo.position=this.globalBounds().topLeft();}else{this.borderHalo=null;}}},{key:"onFocus",value:function WebsiteTextField_onFocus_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onFocus",this).call(this);if(this.readOnly)return;var fillBehind=this.morphBeneath(this.globalBounds().center()).fill||__varRecorder__$12.Color.white;this.cursorColor=fillBehind.isGradient?fillBehind.stops[0].color.invert():fillBehind.invert();this.toggleBorderHalo(false);}},{key:"onBlur",value:function WebsiteTextField_onBlur_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onBlur",this).call(this,evt);if(this.readOnly&&lively.FreezerRuntime){this.collapseSelection();return;}this.toggleBorderHalo(false);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"WebsiteTextField";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftDesktop",version:"0.1.1-114"};}},{start:513,end:1878});}(__varRecorder__$12.Text);__varRecorder__$12.WebsiteTextField=WebsiteTextField;__varRecorder__$12.WebsiteTextField=WebsiteTextField;__varRecorder__$12.WebsiteTextField=WebsiteTextField;var TypeshiftDesktop=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftDesktop/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TypeshiftDesktop")&&typeof __lively_classholder__.TypeshiftDesktop==="function"?__lively_classholder__.TypeshiftDesktop:__lively_classholder__.TypeshiftDesktop=function TypeshiftDesktop(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"__head_html__",get:function get(){return"\n      <link rel=\"apple-touch-icon\" sizes=\"57x57\" href=\"/resources/typeshift.ico/apple-icon-57x57.png\">\n      <link rel=\"apple-touch-icon\" sizes=\"60x60\" href=\"/resources/typeshift.ico/apple-icon-60x60.png\">\n      <link rel=\"apple-touch-icon\" sizes=\"72x72\" href=\"/resources/typeshift.ico/apple-icon-72x72.png\">\n      <link rel=\"apple-touch-icon\" sizes=\"76x76\" href=\"/resources/typeshift.ico/apple-icon-76x76.png\">\n      <link rel=\"apple-touch-icon\" sizes=\"114x114\" href=\"/resources/typeshift.ico/apple-icon-114x114.png\">\n      <link rel=\"apple-touch-icon\" sizes=\"120x120\" href=\"/resources/typeshift.ico/apple-icon-120x120.png\">\n      <link rel=\"apple-touch-icon\" sizes=\"144x144\" href=\"/resources/typeshift.ico/apple-icon-144x144.png\">\n      <link rel=\"apple-touch-icon\" sizes=\"152x152\" href=\"/resources/typeshift.ico/apple-icon-152x152.png\">\n      <link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"/resources/typeshift.ico/apple-icon-180x180.png\">\n      <link rel=\"icon\" type=\"image/png\" sizes=\"192x192\"  href=\"/resources/typeshift.ico/android-icon-192x192.png\">\n      <link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"/resources/typeshift.ico/favicon-32x32.png\">\n      <link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"/resources/typeshift.ico/favicon-96x96.png\">\n      <link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"/resources/typeshift.ico/favicon-16x16.png\">\n      <link rel=\"manifest\" href=\"/resources/typeshift.ico/manifest.json\">\n      <meta name=\"msapplication-TileColor\" content=\"#ffffff\">\n      <meta name=\"msapplication-TileImage\" content=\"/resources/typeshift.ico/ms-icon-144x144.png\">\n      <meta name=\"theme-color\" content=\"#ffffff\">    \n    ";}},{key:"toggleEditable",value:function TypeshiftDesktop_toggleEditable_(editable){this.withAllSubmorphsSelect(function(m){return m.constructor.name==="WebsiteTextField";}).forEach(function(t){return t.toggleEditable(editable);});}},{key:"adjustMenuBar",value:function(){var _TypeshiftDesktop_adjustMenuBar_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee197(){var currentSection,_this$ui15,mb,content,scrollY;return regeneratorRuntime.wrap(function _callee197$(_context197){while(1){switch(_context197.prev=_context197.next){case 0:currentSection=this.getSectionInView(),_this$ui15=this.ui,mb=_this$ui15.menuBar,content=_this$ui15.content;if(currentSection){mb.selectLink(currentSection.name+" link");}if(this.embedded){scrollY=document.body.scrollTop;}else{scrollY=content.scroll.y;}if(scrollY<100){if(mb.shrunken)mb.expand();}else{if(!mb.shrunken)mb.shrink();}case 4:case"end":return _context197.stop();}}},_callee197,this);}));function TypeshiftDesktop_adjustMenuBar_(){return _TypeshiftDesktop_adjustMenuBar_.apply(this,arguments);}return TypeshiftDesktop_adjustMenuBar_;}()},{key:"__deserialize__",value:function TypeshiftDesktop___deserialize___(snapshot,ref,serializedObjMap,pool,path){var orig=_toConsumableArray2(snapshot.props.submorphs.value),remainingMorphs=snapshot.props.submorphs.value.splice(2);initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__deserialize__",this).call(this,snapshot,ref,serializedObjMap,pool,path);this._originalSubmorphs=orig;this._serializer={remainingMorphs:remainingMorphs,serializedObjMap:serializedObjMap,pool:pool,path:path};}},{key:"__after_deserialize__",value:function TypeshiftDesktop___after_deserialize___(snapshot,ref){var _this232=this;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"__after_deserialize__",this).call(this,snapshot,ref);var _this$_serializer2=this._serializer,remainingMorphs=_this$_serializer2.remainingMorphs,serializedObjMap=_this$_serializer2.serializedObjMap,pool=_this$_serializer2.pool,path=_this$_serializer2.path;this._renderRemaining=function(){var _iterator97=_createForOfIteratorHelper(remainingMorphs),_step97;try{for(_iterator97.s();!(_step97=_iterator97.n()).done;){var id=_step97.value.id;var _m17=_this232.addMorph(__varRecorder__$12.ObjectRef.fromSnapshot(id,serializedObjMap,pool,path).realObj);}}catch(err){_iterator97.e(err);}finally{_iterator97.f();}_this232._renderRemaining=null;_this232.onDeserializeSubPart();};snapshot.props.submorphs.value=this._originalSubmorphs;delete this._originalSubmorphs;delete this._serializer;}},{key:"onDeserializeSubPart",value:function TypeshiftDesktop_onDeserializeSubPart_(){var _this233=this;this._ui=null;this.whenRendered().then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee198(){return regeneratorRuntime.wrap(function _callee198$(_context198){while(1){switch(_context198.prev=_context198.next){case 0:_this233.withAllSubmorphsDo(function(m){return m.fit&&m.fit();});if(lively.FreezerRuntime)$world.height=_this233.submorphBounds().height;case 2:case"end":return _context198.stop();}}},_callee198);})));}},{key:"onWorldResize",value:function TypeshiftDesktop_onWorldResize_(){if(!lively.FreezerRuntime)return;this.position=__varRecorder__$12.pt(0,0);this.height=document.documentElement.clientHeight;this.width=document.documentElement.clientWidth;}},{key:"__serialize__",value:function TypeshiftDesktop___serialize___(){if(this._renderRemaining){this._renderRemaining();}return null;}},{key:"beforePublish",value:function TypeshiftDesktop_beforePublish_(){if(this._renderRemaining){this._renderRemaining();}for(var _i193=0;_i193<3;_i193++){this.withAllSubmorphsSelect(function(m){return m.anchors||m.savedMarks;}).forEach(function(m){m.anchors.filter(function(m){return!m.id||m.id.includes("selection");}).forEach(function(a){m.removeAnchor(a);});m.savedMarks=[];});}this.get("formula backdrop").bringToFront();this.animatedBack.remove();}},{key:"embedInDocument",value:function TypeshiftDesktop_embedInDocument_(){var content=this.get("content"),mb=this.get("menu bar");document.body.style.removeProperty("overflow");document.body.style.setProperty("overflow-x","hidden");content.clipMode="visible";this.clipMode="visible";mb.openInWorld();mb.hasFixedPosition=true;$world.clipMode="hidden";$world.resizePolicy="static";$world.width=this.width;$world.height=this.submorphBounds().height;__varRecorder__$12.connect($world,"onWindowScroll",content,"onWindowScroll");mb.whenRendered().then(function(){return mb.bringToFront();});this.relayout();this.embedded=true;}},{key:"onLoad",value:function TypeshiftDesktop_onLoad_(){var _this234=this;if(!lively.FreezerRuntime){__varRecorder__$12.WebFont.load({google:{families:["Nunito:600,600i,900"]}});}if(lively.FreezerRuntime){this.onWorldResize();this.get("intro").addMorphBack(this.animatedBack);__varRecorder__$12.once($world,"handForPointerId",function(){_this234.whenRendered().then(function(){return $world.firstHand.fill=null;});});this.whenRendered().then(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee199(){return regeneratorRuntime.wrap(function _callee199$(_context199){while(1){switch(_context199.prev=_context199.next){case 0:_this234.embedInDocument();_this234.position=__varRecorder__$12.pt(0,0);_context199.next=4;return __varRecorder__$12.addOrChangeLinkedCSS("lively-font-awesome-github","/lively.morphic/assets/font-awesome/css/font-awesome.min.css",_this234.env.domEnv.document);case 4:_this234.relayout();case 5:case"end":return _context199.stop();}}},_callee199);})));this.left=this.top=0;}}},{key:"turnStaticTextReadOnly",value:function TypeshiftDesktop_turnStaticTextReadOnly_(readOnly){[].concat(_toConsumableArray2(this.getSubmorphsByStyleClassName("Label")),_toConsumableArray2(this.getSubmorphsByStyleClassName("staticText"))).forEach(function(m){m.readOnly=true;m.draggabel=m.grabbable=m.selectable=m.focusable=!readOnly;});}},{key:"toggleImpressum",value:function(){var _TypeshiftDesktop_toggleImpressum_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee200(visible){return regeneratorRuntime.wrap(function _callee200$(_context200){while(1){switch(_context200.prev=_context200.next){case 0:this.toggleBackdrop(visible);this.ui.impressum.visible=visible;case 2:case"end":return _context200.stop();}}},_callee200,this);}));function TypeshiftDesktop_toggleImpressum_(_x238){return _TypeshiftDesktop_toggleImpressum_.apply(this,arguments);}return TypeshiftDesktop_toggleImpressum_;}()},{key:"toggleAngebot",value:function(){var _TypeshiftDesktop_toggleAngebot_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee201(visible){return regeneratorRuntime.wrap(function _callee201$(_context201){while(1){switch(_context201.prev=_context201.next){case 0:this.toggleBackdrop(visible);this.ui.angebotPrompt.visible=visible;case 2:case"end":return _context201.stop();}}},_callee201,this);}));function TypeshiftDesktop_toggleAngebot_(_x239){return _TypeshiftDesktop_toggleAngebot_.apply(this,arguments);}return TypeshiftDesktop_toggleAngebot_;}()},{key:"toggleBackdrop",value:function(){var _TypeshiftDesktop_toggleBackdrop_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee202(visible){var bd;return regeneratorRuntime.wrap(function _callee202$(_context202){while(1){switch(_context202.prev=_context202.next){case 0:if(this._renderRemaining){this._renderRemaining();this.relayout();}bd=this.get("formula backdrop");if(visible){bd.visible=visible;bd.bringToFront();if(this.embedded){bd.openInWorld();bd.hasFixedPosition=true;bd.top=0;}}_context202.next=5;return bd.animate({opacity:visible?1:0,duration:200});case 5:if(!visible){bd.visible=visible;bd.owner.addMorphBack(bd);}case 6:case"end":return _context202.stop();}}},_callee202,this);}));function TypeshiftDesktop_toggleBackdrop_(_x240){return _TypeshiftDesktop_toggleBackdrop_.apply(this,arguments);}return TypeshiftDesktop_toggleBackdrop_;}()},{key:"toggleGuides",value:function TypeshiftDesktop_toggleGuides_(active){this.getSubmorphsByStyleClassName("guide").forEach(function(g){g.borderWidth=active?1:0;g.width=g.owner.width-100;g.topCenter=g.owner.innerBounds().topCenter();});}},{key:"jumpToSection",value:function TypeshiftDesktop_jumpToSection_(sectionName){var ct=this.ui.content,section=ct.getSubmorphNamed(sectionName);if(sectionName==="angebot button"){this.toggleAngebot(true);return;}if(!section&&ct._renderRemaining){ct._renderRemaining();section=ct.getSubmorphNamed(sectionName);}if(section){if(this.embedded){window.scroll({top:section.top-50,behavior:"smooth"});return;}ct.animate({scroll:__varRecorder__$12.pt(0,section.top-50),easing:__varRecorder__$12.easings.inOutQuint,duration:300});}}},{key:"getSectionInView",value:function TypeshiftDesktop_getSectionInView_(){var ct=this.ui.content,scrollY=this.embedded?document.body.scrollTop:ct.scroll.y;var selected=this.getSubmorphNamed("was ist interactive content");var _iterator98=_createForOfIteratorHelper(ct.submorphs.sort(function(a,b){return a.top-b.top;})),_step98;try{for(_iterator98.s();!(_step98=_iterator98.n()).done;){var _m18=_step98.value;if(_m18.top+_m18.height>scrollY+100){selected=_m18;break;}}}catch(err){_iterator98.e(err);}finally{_iterator98.f();}return selected;}},{key:"relayout",value:function TypeshiftDesktop_relayout_(){var _this$ui16=this.ui,mb=_this$ui16.menuBar,ct=_this$ui16.content,imp=_this$ui16.impressum,contact=_this$ui16.contact,intro=_this$ui16.intro,promptBackdrop=_this$ui16.promptBackdrop,angebotPrompt=_this$ui16.angebotPrompt;mb.width=this.width;mb.left=mb.top=0;if(ct)ct.extent=this.extent;if(promptBackdrop)promptBackdrop.extent=this.extent;if(angebotPrompt&&imp){imp.height=Math.min(this.height-100,imp.height);imp.center=angebotPrompt.center=this.extent.scaleBy(0.5);}var mbs=mb.get("menu bar shadow"),_mbs$submorphs=_slicedToArray2(mbs.submorphs,1),hatching=_mbs$submorphs[0];hatching.extent=hatching.extent.scaleBy(this.width/hatching.width);mbs.width=this.width;this.animatedBack.extent=this.extent;intro.height=this.height;if(contact)contact.height=this.height;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TypeshiftDesktop";}},{key:"properties",get:function get(){return{animatedBack:{},ui:{readOnly:true,get:function get(){return this._ui||(this._ui={menuBar:this.get("menu bar"),content:this.get("content"),impressum:this.get("impressum"),contact:this.get("contact"),intro:this.get("intro"),promptBackdrop:this.get("formula backdrop"),angebotPrompt:this.get("angebot prompt")});}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftDesktop",version:"0.1.1-114"};}},{start:1896,end:11370});}(__varRecorder__$12.Morph);TypeshiftDesktop=__varRecorder__$12.TypeshiftDesktop;__varRecorder__$12["default"]=TypeshiftDesktop;var __varRecorder__$13=lively.FreezerRuntime.recorderFor("TypeshiftMenuBar/index.js");__varRecorder__$13.Morph=Morph;__varRecorder__$13.easings=easings;__varRecorder__$13.InteractiveMorph=InteractiveMorph;__varRecorder__$13.once=once$1;var TypeshiftMenuBar=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TypeshiftMenuBar/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TypeshiftMenuBar")&&typeof __lively_classholder__.TypeshiftMenuBar==="function"?__lively_classholder__.TypeshiftMenuBar:__lively_classholder__.TypeshiftMenuBar=function TypeshiftMenuBar(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onMouseDown",value:function TypeshiftMenuBar_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);switch(evt.targetMorph.name){case"mobile menu button":this.openMobileMenu();break;case"projects tag":this.goToSection("projects");break;case"services tag":this.goToSection("services");break;case"agency tag":this.goToSection("agency");break;case"contact tag":this.goToSection("contact");break;case"references tag":this.goToSection("references");break;}}},{key:"goToSection",value:function TypeshiftMenuBar_goToSection_(sectionName){this.owner.goToSection(sectionName);}},{key:"openMobileMenu",value:function TypeshiftMenuBar_openMobileMenu_(){var _this235=this;this.ui.mobileNavMenu.visible=true;__varRecorder__$13.once(this.ui.mobileNavMenu,"onBlur",function(){_this235.closeMobileMenu();});this.ui.mobileNavMenu.focus();}},{key:"closeMobileMenu",value:function TypeshiftMenuBar_closeMobileMenu_(){var _this236=this;if(!this.world().focusedMorph.ownerChain().includes(this)){this.ui.mobileNavMenu.animate({visible:false,easing:__varRecorder__$13.easings.inOutExpo,duration:300});}else{__varRecorder__$13.once(this.ui.mobileNavMenu,"onBlur",function(){_this236.closeMobileMenu();});}}},{key:"enableMobile",value:function TypeshiftMenuBar_enableMobile_(active){var _this$ui17=this.ui,mobileMenuButton=_this$ui17.mobileMenuButton,desktopMenu=_this$ui17.desktopMenu;desktopMenu.visible=desktopMenu.isLayoutable=!active;mobileMenuButton.visible=active;}},{key:"relayout",value:function TypeshiftMenuBar_relayout_(){this.ui.mobileMenuButton.rightCenter=this.innerBounds().insetBy(30).rightCenter();this.ui.mobileNavMenu.right=this.width-20;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TypeshiftMenuBar";}},{key:"properties",get:function get(){return{isMobile:{derived:true,get:function get(){return this.ui.mobileMenuButton.visible;}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TypeshiftMenuBar",version:"0.1.1-7"};}},{start:186,end:1974});}(__varRecorder__$13.InteractiveMorph);TypeshiftMenuBar=__varRecorder__$13.TypeshiftMenuBar;__varRecorder__$13["default"]=TypeshiftMenuBar;config.users.authServerURL="https://auth.typeshift.io";config.css.fontAwesome="/lively.morphic/assets/fontawesome-free-5.12.1/css/all.css";config.css.inconsolata="/lively.morphic/assets/inconsolata/inconsolata.css";var snapshot=JSON.parse("{\"id\":\"TypeshiftWebsite_D8139C60_1C96_449C_AE0A_9FD71EDFEEB9\",\"snapshot\":{\"TypeshiftWebsite_D8139C60_1C96_449C_AE0A_9FD71EDFEEB9\":{\"rev\":387619,\"props\":{\"attributeConnections\":{\"value\":[{\"__ref__\":true,\"id\":\"F74F8061-4F38-4975-A65B-902258506E75\",\"rev\":0}]},\"name\":{\"value\":\"typeshift website\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(119.44921875,93.27734375)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(820.42578125,761.5)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_5B344EF8_757E_40C4_9C45_C417870D81D7\",\"rev\":385951},{\"__ref__\":true,\"id\":\"ProjectDetails_9DF68582_7A5C_4AD9_8FB7_A89E4ACB7BF6\",\"rev\":1227},{\"__ref__\":true,\"id\":\"Morph_FCB90F1D_DF5B_43D2_9BCD_7E237D0D9A84\",\"rev\":348419},{\"__ref__\":true,\"id\":\"TypeshiftMenuBar_230D01BA_83C5_4D33_8F97_893E15F5CD70\",\"rev\":1655}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"TypeshiftWebsite\",\"InteractiveMorph\",\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{ProportionalLayout}:lively.morphic:new ProportionalLayout({\\n  lastExtent: {\\n    x: 820.42578125,\\n    y: 761.5\\n  },\\n  reactToSubmorphAnimations: false,\\n  submorphSettings: [[\\\"title bar\\\", {\\n        x: \\\"resize\\\",\\n        y: \\\"fixed\\\"\\n      }], [\\\"scroll container\\\", {\\n        x: \\\"resize\\\",\\n        y: \\\"resize\\\"\\n      }], [\\\"content\\\", {\\n        x: \\\"resize\\\",\\n        y: \\\"resize\\\"\\n      }]]\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[1,1,1,0],\"right\":[1,1,1,0],\"bottom\":[1,1,1,0],\"left\":[1,1,1,0]}},\"installedFonts\":{\"value\":{\"__ref__\":true,\"id\":\"0841B570-1092-46F8-8353-9C5D6D9FCCD8\",\"rev\":0}},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"64053F47-F79D-4C94-8A2A-BA7A4755F525\",\"rev\":0}},\"title\":{\"value\":\"Typeshift: Agentur fr Interactive Content\"},\"sectionOrder\":{\"value\":[\"typeshift website styleguide\",\"intro section\",\"about section\",\"projects section\",\"projects mobile section\",\"services section\",\"services mobile section\",\"agency section\",\"agency mobile section\",\"references section\",\"contact section\",\"buffer\",\"footer\"]},\"bufferMorph\":{\"value\":{\"__ref__\":true,\"id\":\"Morph_0D3D0A89_0CD9_42CE_91B5_E8A5CC78646F\",\"rev\":348413}}},\"lively.serializer-class-info\":{\"className\":\"TypeshiftWebsite\",\"module\":{\"package\":{\"name\":\"TypeshiftWebsite\",\"version\":\"0.1.1-341\"},\"pathInPackage\":\"index.js\"}}},\"F74F8061-4F38-4975-A65B-902258506E75\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"doNotSerialize\":{\"value\":[\"isActive\",\"converter\",\"updater\",\"varMapping\"]},\"sourceObj\":{\"value\":{\"__ref__\":true,\"id\":\"TypeshiftWebsite_D8139C60_1C96_449C_AE0A_9FD71EDFEEB9\",\"rev\":387619}},\"sourceAttrName\":{\"value\":\"extent\"},\"targetObj\":{\"value\":{\"__ref__\":true,\"id\":\"TypeshiftWebsite_D8139C60_1C96_449C_AE0A_9FD71EDFEEB9\",\"rev\":387619}},\"targetMethodName\":{\"value\":\"relayout\"},\"garbageCollect\":{\"value\":false},\"signalOnAssignment\":{\"value\":true}},\"lively.serializer-class-info\":{\"className\":\"AttributeConnection\",\"module\":{\"package\":{\"name\":\"lively.bindings\",\"version\":\"0.1.2\"},\"pathInPackage\":\"index.js\"}}},\"Morph_5B344EF8_757E_40C4_9C45_C417870D81D7\":{\"rev\":385951,\"props\":{\"attributeConnections\":{\"value\":[{\"__ref__\":true,\"id\":\"B15220FB-FDDD-46FB-9CA3-4F6FD0E13575\",\"rev\":0}]},\"name\":{\"value\":\"scroll container\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(819.8028850501616,760.3828125)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"HTMLMorph_166F8806_B8DE_4E47_8DAC_CD09F15E6E8A\",\"rev\":385954}]},\"clipMode\":{\"value\":\"auto\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{VerticalLayout}:lively.morphic:new VerticalLayout({\\n  align: \\\"left\\\",\\n  autoResize: false,\\n  direction: \\\"topToBottom\\\",\\n  orderByIndex: false,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: true,\\n  spacing: 0\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.09019607843137255,0.6274509803921569,0.984313725490196,1],\"right\":[0.09019607843137255,0.6274509803921569,0.984313725490196,1],\"bottom\":[0.09019607843137255,0.6274509803921569,0.984313725490196,1],\"left\":[0.09019607843137255,0.6274509803921569,0.984313725490196,1]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"B15220FB-FDDD-46FB-9CA3-4F6FD0E13575\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"doNotSerialize\":{\"value\":[\"isActive\",\"converter\",\"updater\",\"varMapping\"]},\"sourceObj\":{\"value\":{\"__ref__\":true,\"id\":\"Morph_5B344EF8_757E_40C4_9C45_C417870D81D7\",\"rev\":385951}},\"sourceAttrName\":{\"value\":\"onScroll\"},\"targetObj\":{\"value\":{\"__ref__\":true,\"id\":\"TypeshiftWebsite_D8139C60_1C96_449C_AE0A_9FD71EDFEEB9\",\"rev\":387619}},\"targetMethodName\":{\"value\":\"updateOnScroll\"},\"garbageCollect\":{\"value\":false},\"signalOnAssignment\":{\"value\":true}},\"lively.serializer-class-info\":{\"className\":\"AttributeConnection\",\"module\":{\"package\":{\"name\":\"lively.bindings\",\"version\":\"0.1.2\"},\"pathInPackage\":\"index.js\"}}},\"HTMLMorph_166F8806_B8DE_4E47_8DAC_CD09F15E6E8A\":{\"rev\":385954,\"props\":{\"name\":{\"value\":\"content\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(819.8028850501616,1408.61328125)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"HTMLMorph\",\"Morph\",\"HTMLSelfWritingText\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{VerticalLayout}:lively.morphic:new VerticalLayout({\\n  align: \\\"left\\\",\\n  autoResize: false,\\n  direction: \\\"topToBottom\\\",\\n  orderByIndex: true,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: true,\\n  spacing: 0\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.09019607843137255,0.6274509803921569,0.984313725490196,1],\"right\":[0.09019607843137255,0.6274509803921569,0.984313725490196,1],\"bottom\":[0.09019607843137255,0.6274509803921569,0.984313725490196,1],\"left\":[0.09019607843137255,0.6274509803921569,0.984313725490196,1]}},\"html\":{\"value\":\"\"},\"cssDeclaration\":{\"value\":\".frame {\\n  font-family: Nunito;\\n  padding: 20px;\\n}\\n\\n.lottie {\\n  transition: height 300ms, padding 300ms;\\n  height: 250px;\\n}\\n\\n.viewport {\\n  background-repeat: no-repeat;\\n  background-size: cover;\\n  background-position: center;\\n  position: absolute;\\n  height: 250px;\\n  width: calc(100% - 50px);\\n}\\n\\n.desktop .lottie {\\n  padding: 0 20%;\\n  height: 230px;\\n}\\n\\n.desktop .viewport {\\n  background-image: url(https://fra1.digitaloceanspaces.com/typeshift/website/MacBook_black-transp.svg);\\n  height: 250px;\\n}\\n\\n.desktop .fa-desktop {\\n  opacity: 1;\\n}\\n\\n.interactive {\\n  height: 280px;\\n  width: 100%;\\n}\\n\\n.mobile .lottie {\\n  padding: 0 42%;\\n}\\n\\n.mobile .viewport {\\n  background-image: url(https://fra1.digitaloceanspaces.com/typeshift/website/iPhone_black-transp.svg);\\n  height: 250px;\\n  background-size: auto auto;\\n}\\n\\n.mobile .fa-mobile-alt {\\n  opacity: 1;\\n}\\n\\n.tablet .lottie {\\n  padding: 0 40%;\\n}\\n\\n.tablet .viewport {\\n  background-image: url(https://fra1.digitaloceanspaces.com/typeshift/website/iPad_black-transp.svg);\\n  height: 250px;\\n}\\n\\n.tablet .fa-tablet-alt {\\n  opacity: 1;\\n}\\n\\n.info {\\n  padding-bottom: 20px;\\n}\\n\\n.h3 {\\n  font-weight: bold;\\n  font-size: 20px;\\n}\\n\\n.spacer {\\n  height: 20px\\n}\\n\\n.h4 {\\n  hont-weight: normal;\\n}\\n\\n.buttons {\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  font-size: 30px;\\n}\\n\\ni {\\n  opacity: .5;\\n  padding: 15px;\\n  cursor: pointer;\\n}\\n\\n.default-span {\\n  font-size: 50px;\\n  font-family: Roboto;\\n  font-weight: bold;\\n  line-height: 1.4;\\n}\\n\\n.overlay {\\n  position: absolute;\\n  top: 0px;\\n  left: 0px;\\n  height: 100%;\\n  width: calc(100% - 20px);\\n  background: rgb(98,179,209);\\n  font-family: Roboto;\\n  font-size: 40px;\\n  font-weight: 900;\\n  text-align: right;\\n  line-height: 1.4;\\n  padding: 10px;\\n  color: white;\\n  transition: opacity 300ms;\\n  opacity: 0;\\n}\\n\\nvideo {\\n  position: absolute; \\n    right: 0; \\n    bottom: 0;\\n    min-width: 100%; \\n    min-height: 100%;\\n    width: auto; \\n    height: auto; \\n    z-index: -100;\\n    background-size: cover;\\n    overflow: hidden;\\n}\\n\\n.overlay:hover {\\n  opacity: 1\\n}\\n\\n.light {\\n  color: white;\\n  -webkit-text-stroke: 1px black;\\n}\\n\\n.indent {\\n  padding-left: 50px;\\n}\\n\\n.h1 {\\n  font-family: Nunito;\\n  font-weight: 200;\\n  font-size: 23px;\\n}\\n\\n.h2 {\\n  font-family: Nunito;\\n  font-size: 16px;\\n  font-weight: 400;\\n}\\n\"}},\"lively.serializer-class-info\":{\"className\":\"HTMLMorph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"html-morph.js\"}}},\"ProjectDetails_9DF68582_7A5C_4AD9_8FB7_A89E4ACB7BF6\":{\"rev\":1227,\"props\":{\"name\":{\"value\":\"project detail tile\"},\"renderOnGPU\":{\"value\":true},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(260.2022237750808,292.4455574159922)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(1104.3046875,711.37890625)\"},\"scale\":{\"value\":0.6364612496337942},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"visible\":{\"value\":false},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_154054A6_92F1_4134_B1AB_E434930C340E\",\"rev\":1224},{\"__ref__\":true,\"id\":\"Morph_7B21D1AE_7A36_42AD_96A7_0141E454C5CE\",\"rev\":1226}]},\"clipMode\":{\"value\":\"auto\"},\"scroll\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,38)\"},\"styleClasses\":{\"value\":[\"ProjectDetails\",\"InteractiveMorph\",\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{VerticalLayout}:lively.morphic:new VerticalLayout({\\n  align: \\\"left\\\",\\n  autoResize: false,\\n  direction: \\\"topToBottom\\\",\\n  orderByIndex: true,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: true,\\n  spacing: 0\\n})\"},\"isLayoutable\":{\"value\":false},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"ProjectDetails\",\"module\":{\"package\":{\"name\":\"ProjectDetails\",\"version\":\"0.1.1-69\"},\"pathInPackage\":\"index.js\"}}},\"Morph_154054A6_92F1_4134_B1AB_E434930C340E\":{\"rev\":1224,\"props\":{\"name\":{\"value\":\"project cabinet\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(1104.3046875,414.16015625)\"},\"opacity\":{\"value\":0},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_C83BFF71_10AC_41F7_8AF2_D975673458A1\",\"rev\":924},{\"__ref__\":true,\"id\":\"Morph_D9F672CC_3047_4FD0_B69F_514BCAB55035\",\"rev\":925},{\"__ref__\":true,\"id\":\"Morph_FBE7EE44_1902_4517_A6A8_5590F8F10A3F\",\"rev\":926}]},\"clipMode\":{\"value\":\"auto\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{HorizontalLayout}:lively.morphic:new HorizontalLayout({\\n  align: \\\"bottom\\\",\\n  autoResize: false,\\n  direction: \\\"centered\\\",\\n  orderByIndex: false,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: false,\\n  spacing: 4\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Morph_C83BFF71_10AC_41F7_8AF2_D975673458A1\":{\"rev\":924,\"props\":{\"name\":{\"value\":\"screen tile 1\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(122.70684025950305,122.03515625)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(289.8636632309939,288.125)\"},\"opacity\":{\"value\":0},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(56,227,144)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"VideoTile_CEAE0489_EE86_4B0C_AF85_47E0A8992B55\",\"rev\":728}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"VideoTile_CEAE0489_EE86_4B0C_AF85_47E0A8992B55\":{\"rev\":728,\"props\":{\"attributeConnections\":{\"value\":[{\"__ref__\":true,\"id\":\"2B7DE23D-01A5-4E62-BFFC-5A4059CF95FF\",\"rev\":0}]},\"name\":{\"value\":\"tesla video 1\"},\"focusable\":{\"value\":false},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-8.748928398196085,-11.516216045571866)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(307.36152002738606,311.15743209114373)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(23,32,42)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_8021BC94_7042_4F39_B9B9_40C4162C5D74\",\"rev\":727}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"VideoTile\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"5C39663D-1BA6-42C7-8A42-FE8A707E4288\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"VideoTile\",\"module\":{\"package\":{\"name\":\"VideoTile\",\"version\":\"0.1.1-13\"},\"pathInPackage\":\"index.js\"}}},\"2B7DE23D-01A5-4E62-BFFC-5A4059CF95FF\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"doNotSerialize\":{\"value\":[\"isActive\",\"converter\",\"updater\",\"varMapping\"]},\"sourceObj\":{\"value\":{\"__ref__\":true,\"id\":\"VideoTile_CEAE0489_EE86_4B0C_AF85_47E0A8992B55\",\"rev\":728}},\"sourceAttrName\":{\"value\":\"extent\"},\"targetObj\":{\"value\":{\"__ref__\":true,\"id\":\"VideoTile_CEAE0489_EE86_4B0C_AF85_47E0A8992B55\",\"rev\":728}},\"targetMethodName\":{\"value\":\"relayout\"},\"garbageCollect\":{\"value\":false},\"signalOnAssignment\":{\"value\":true}},\"lively.serializer-class-info\":{\"className\":\"AttributeConnection\",\"module\":{\"package\":{\"name\":\"lively.bindings\",\"version\":\"0.1.2\"},\"pathInPackage\":\"index.js\"}}},\"Morph_8021BC94_7042_4F39_B9B9_40C4162C5D74\":{\"rev\":727,\"props\":{\"name\":{\"value\":\"video-crop\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-2.1926346535942116,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(505.4917468921218,504.53611484484)\"},\"scale\":{\"value\":0.6167198401383694},\"fill\":{\"value\":null},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"HTMLMorph_EE271C94_20B5_4F1D_8B42_2743867FFEBC\",\"rev\":726}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"B46C61F7-754E-45CB-90E2-2DD9174F21B0\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"HTMLMorph_EE271C94_20B5_4F1D_8B42_2743867FFEBC\":{\"rev\":726,\"props\":{\"name\":{\"value\":\"video\"},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-197.91844748374388,-2.071255317823784)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(1252.7930908202998,726.5504486315887)\"},\"scale\":{\"value\":0.7191229379826831},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(23,32,42)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_7E690B4C_F159_4396_8137_442DCE473D28\",\"rev\":708},{\"__ref__\":true,\"id\":\"Morph_A4BBC542_E79B_4DB0_AE30_1F3906E0292E\",\"rev\":724}]},\"styleClasses\":{\"value\":[\"HTMLMorph\",\"Morph\",\"morph\"]},\"borderWidth\":{\"key\":\"borderWidth\",\"verbatim\":true,\"value\":{\"top\":2,\"right\":2,\"bottom\":2,\"left\":2}},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.4,0.4,0.4,1],\"right\":[0.4,0.4,0.4,1],\"bottom\":[0.4,0.4,0.4,1],\"left\":[0.4,0.4,0.4,1]}},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"BD4D811C-B43F-49FA-9BFA-02A7CA5D2F07\",\"rev\":0}},\"html\":{\"value\":\"<video style=\\\"display: inline-block; width: 1248.79px; height: 704.283px;\\\" preload=\\\"auto\\\" loop=\\\"loop\\\" muted=\\\"muted\\\" autoplay=\\\"autoplay\\\" width=\\\"1248\\\" height=\\\"704\\\">\\n            <source src=\\\"https://fra1.digitaloceanspaces.com/typeshift/website/autopilot/tesla1.mp4\\\" type=\\\"video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;\\\">\\n          </video>\"}},\"lively.serializer-class-info\":{\"className\":\"HTMLMorph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"html-morph.js\"}}},\"Morph_7E690B4C_F159_4396_8137_442DCE473D28\":{\"rev\":708,\"props\":{\"name\":{\"value\":\"right fade\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(1106.85201416015,1.0041634143963165)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(146.3,710.171875)\"},\"fill\":{\"value\":\"__lv_expr__:{pt,rect}:lively.graphics/geometry-2d.js:{Color,RadialGradient,LinearGradient}:lively.graphics/color.js:new LinearGradient({stops: [{offset: 0.30034466911764707, color: Color.rgba(27,38,49,0)}, {offset: 0.9036534926470589, color: Color.rgb(23,32,42)}], vector: rect(0.00000935674558361077,0.5030588654816691,0.9999812865088328,-0.006117730963338232)})\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"CA946D9A-739E-4CD1-9AF2-3A9B81F54870\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"CA946D9A-739E-4CD1-9AF2-3A9B81F54870\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"Morph_A4BBC542_E79B_4DB0_AE30_1F3906E0292E\":{\"rev\":724,\"props\":{\"name\":{\"value\":\"right fade1\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(144.824444580075,708.2515032819565)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(146.3,723.296875)\"},\"rotation\":{\"value\":-3.141592653589793},\"fill\":{\"value\":\"__lv_expr__:{pt,rect}:lively.graphics/geometry-2d.js:{Color,RadialGradient,LinearGradient}:lively.graphics/color.js:new LinearGradient({stops: [{offset: 0.30034466911764707, color: Color.rgba(27,38,49,0)}, {offset: 0.9036534926470589, color: Color.rgb(23,32,42)}], vector: rect(0.00000935674558361077,0.5030588654816691,0.9999812865088328,-0.006117730963338232)})\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"1C43F671-0096-4C29-95DB-0C7772A51F56\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"1C43F671-0096-4C29-95DB-0C7772A51F56\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"BD4D811C-B43F-49FA-9BFA-02A7CA5D2F07\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"B46C61F7-754E-45CB-90E2-2DD9174F21B0\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"5C39663D-1BA6-42C7-8A42-FE8A707E4288\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"Morph_D9F672CC_3047_4FD0_B69F_514BCAB55035\":{\"rev\":925,\"props\":{\"name\":{\"value\":\"screen tile 2\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(416.57050349049695,122.03515625)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(276.66796875,288.125)\"},\"opacity\":{\"value\":0},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(56,227,144)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"VideoTile_E12C27E4_5D7B_4869_8898_988FD186FA71\",\"rev\":823}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"VideoTile_E12C27E4_5D7B_4869_8898_988FD186FA71\":{\"rev\":823,\"props\":{\"attributeConnections\":{\"value\":[{\"__ref__\":true,\"id\":\"3D22C71B-F58D-44E2-AA83-979D304BD071\",\"rev\":0}]},\"name\":{\"value\":\"tesla video 2\"},\"focusable\":{\"value\":false},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-6.297947513693032,-8.279887920571866)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(289.26386377738606,304.68477584114373)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(23,32,42)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_E9C127BD_9E58_48FE_B45E_42B439E00399\",\"rev\":822}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"VideoTile\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"C875C145-88DD-4670-AB57-35EE79AD4FB7\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"VideoTile\",\"module\":{\"package\":{\"name\":\"VideoTile\",\"version\":\"0.1.1-13\"},\"pathInPackage\":\"index.js\"}}},\"3D22C71B-F58D-44E2-AA83-979D304BD071\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"doNotSerialize\":{\"value\":[\"isActive\",\"converter\",\"updater\",\"varMapping\"]},\"sourceObj\":{\"value\":{\"__ref__\":true,\"id\":\"VideoTile_E12C27E4_5D7B_4869_8898_988FD186FA71\",\"rev\":823}},\"sourceAttrName\":{\"value\":\"extent\"},\"targetObj\":{\"value\":{\"__ref__\":true,\"id\":\"VideoTile_E12C27E4_5D7B_4869_8898_988FD186FA71\",\"rev\":823}},\"targetMethodName\":{\"value\":\"relayout\"},\"garbageCollect\":{\"value\":false},\"signalOnAssignment\":{\"value\":true}},\"lively.serializer-class-info\":{\"className\":\"AttributeConnection\",\"module\":{\"package\":{\"name\":\"lively.bindings\",\"version\":\"0.1.2\"},\"pathInPackage\":\"index.js\"}}},\"Morph_E9C127BD_9E58_48FE_B45E_42B439E00399\":{\"rev\":822,\"props\":{\"name\":{\"value\":\"video-crop\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-7.999004787404715,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(505.4917468921218,504.53611484484)\"},\"scale\":{\"value\":0.6038909145975476},\"fill\":{\"value\":null},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"HTMLMorph_0FB0A45D_B3CC_426F_9500_2782852E5B21\",\"rev\":821}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"F2DA5965-997C-4087-9D73-E70F6C9F785D\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"HTMLMorph_0FB0A45D_B3CC_426F_9500_2782852E5B21\":{\"rev\":821,\"props\":{\"name\":{\"value\":\"video\"},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-197.91844748374388,-2.071255317823784)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(1252.7930908202998,726.5504486315887)\"},\"scale\":{\"value\":0.7191229379826831},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(23,32,42)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_005B04F6_5123_4A4A_8EAA_46638B699D05\",\"rev\":803},{\"__ref__\":true,\"id\":\"Morph_A17F35C0_5323_4901_9DC2_04764DAC4474\",\"rev\":819}]},\"styleClasses\":{\"value\":[\"HTMLMorph\",\"Morph\",\"morph\"]},\"borderWidth\":{\"key\":\"borderWidth\",\"verbatim\":true,\"value\":{\"top\":2,\"right\":2,\"bottom\":2,\"left\":2}},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.4,0.4,0.4,1],\"right\":[0.4,0.4,0.4,1],\"bottom\":[0.4,0.4,0.4,1],\"left\":[0.4,0.4,0.4,1]}},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"AF02E5D1-2DD6-4780-AF5E-6D8BCDCA3D1A\",\"rev\":0}},\"html\":{\"value\":\"<video style=\\\"display: inline-block; width: 1248.79px; height: 704.283px;\\\" preload=\\\"auto\\\" loop=\\\"loop\\\" muted=\\\"muted\\\" autoplay=\\\"autoplay\\\" width=\\\"1248\\\" height=\\\"704\\\">\\n            <source src=\\\"https://fra1.digitaloceanspaces.com/typeshift/website/autopilot/tesla2.mp4\\\" type=\\\"video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;\\\">\\n          </video>\"}},\"lively.serializer-class-info\":{\"className\":\"HTMLMorph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"html-morph.js\"}}},\"Morph_005B04F6_5123_4A4A_8EAA_46638B699D05\":{\"rev\":803,\"props\":{\"name\":{\"value\":\"right fade\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(1106.85201416015,1.0041634143963165)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(146.3,710.171875)\"},\"fill\":{\"value\":\"__lv_expr__:{pt,rect}:lively.graphics/geometry-2d.js:{Color,RadialGradient,LinearGradient}:lively.graphics/color.js:new LinearGradient({stops: [{offset: 0.30034466911764707, color: Color.rgba(27,38,49,0)}, {offset: 0.9036534926470589, color: Color.rgb(23,32,42)}], vector: rect(0.00000935674558361077,0.5030588654816691,0.9999812865088328,-0.006117730963338232)})\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"2BF3E1E0-C621-47AF-B5F8-522476577A09\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"2BF3E1E0-C621-47AF-B5F8-522476577A09\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"Morph_A17F35C0_5323_4901_9DC2_04764DAC4474\":{\"rev\":819,\"props\":{\"name\":{\"value\":\"right fade1\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(144.824444580075,708.2515032819565)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(146.3,723.296875)\"},\"rotation\":{\"value\":-3.141592653589793},\"fill\":{\"value\":\"__lv_expr__:{pt,rect}:lively.graphics/geometry-2d.js:{Color,RadialGradient,LinearGradient}:lively.graphics/color.js:new LinearGradient({stops: [{offset: 0.30034466911764707, color: Color.rgba(27,38,49,0)}, {offset: 0.9036534926470589, color: Color.rgb(23,32,42)}], vector: rect(0.00000935674558361077,0.5030588654816691,0.9999812865088328,-0.006117730963338232)})\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"DA12E4AC-DF4D-4A13-A014-AC937683FA16\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"DA12E4AC-DF4D-4A13-A014-AC937683FA16\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"AF02E5D1-2DD6-4780-AF5E-6D8BCDCA3D1A\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"F2DA5965-997C-4087-9D73-E70F6C9F785D\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"C875C145-88DD-4670-AB57-35EE79AD4FB7\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"Morph_FBE7EE44_1902_4517_A6A8_5590F8F10A3F\":{\"rev\":926,\"props\":{\"name\":{\"value\":\"screen tile 3\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(697.238472240497,122.03515625)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(284.359375,288.125)\"},\"opacity\":{\"value\":0},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(56,227,144)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"VideoTile_90637AFC_0E2B_4CCA_898E_44080B60FD77\",\"rev\":918}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"VideoTile_90637AFC_0E2B_4CCA_898E_44080B60FD77\":{\"rev\":918,\"props\":{\"attributeConnections\":{\"value\":[{\"__ref__\":true,\"id\":\"9A239F21-2F7F-474B-BEDE-35C8D7CF3CCA\",\"rev\":0}]},\"name\":{\"value\":\"tesla video 3\"},\"focusable\":{\"value\":false},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-6.400726783468826,-5.763286358071866)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(297.1608285669377,299.65157271614373)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(23,32,42)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_2961C1C2_925E_4C1C_A856_BAAC0835232D\",\"rev\":917}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"VideoTile\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"CDFF815B-D56A-4649-8CB5-4DEF5F7A41AC\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"VideoTile\",\"module\":{\"package\":{\"name\":\"VideoTile\",\"version\":\"0.1.1-13\"},\"pathInPackage\":\"index.js\"}}},\"9A239F21-2F7F-474B-BEDE-35C8D7CF3CCA\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"doNotSerialize\":{\"value\":[\"isActive\",\"converter\",\"updater\",\"varMapping\"]},\"sourceObj\":{\"value\":{\"__ref__\":true,\"id\":\"VideoTile_90637AFC_0E2B_4CCA_898E_44080B60FD77\",\"rev\":918}},\"sourceAttrName\":{\"value\":\"extent\"},\"targetObj\":{\"value\":{\"__ref__\":true,\"id\":\"VideoTile_90637AFC_0E2B_4CCA_898E_44080B60FD77\",\"rev\":918}},\"targetMethodName\":{\"value\":\"relayout\"},\"garbageCollect\":{\"value\":false},\"signalOnAssignment\":{\"value\":true}},\"lively.serializer-class-info\":{\"className\":\"AttributeConnection\",\"module\":{\"package\":{\"name\":\"lively.bindings\",\"version\":\"0.1.2\"},\"pathInPackage\":\"index.js\"}}},\"Morph_2961C1C2_925E_4C1C_A856_BAAC0835232D\":{\"rev\":917,\"props\":{\"name\":{\"value\":\"video-crop\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-1.529154184030432,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(505.4917468921218,504.53611484484)\"},\"scale\":{\"value\":0.5939150120270292},\"fill\":{\"value\":null},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"HTMLMorph_75A2E674_3130_474C_985A_CA96AF6526BB\",\"rev\":916}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"904F9FF2-1516-4217-A639-54121C5A81FF\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"HTMLMorph_75A2E674_3130_474C_985A_CA96AF6526BB\":{\"rev\":916,\"props\":{\"name\":{\"value\":\"video\"},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-197.91844748374388,-2.071255317823784)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(1252.7930908202998,726.5504486315887)\"},\"scale\":{\"value\":0.7191229379826831},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(23,32,42)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_077CFD40_B82A_450F_A616_C344DA2C3407\",\"rev\":898},{\"__ref__\":true,\"id\":\"Morph_2F84F8A8_2DD4_45E2_B39A_7D244FCC3125\",\"rev\":914}]},\"styleClasses\":{\"value\":[\"HTMLMorph\",\"Morph\",\"morph\"]},\"borderWidth\":{\"key\":\"borderWidth\",\"verbatim\":true,\"value\":{\"top\":2,\"right\":2,\"bottom\":2,\"left\":2}},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.4,0.4,0.4,1],\"right\":[0.4,0.4,0.4,1],\"bottom\":[0.4,0.4,0.4,1],\"left\":[0.4,0.4,0.4,1]}},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"384554FF-E66F-4A21-AEA9-A5ABDFE274B7\",\"rev\":0}},\"html\":{\"value\":\"<video style=\\\"display: inline-block; width: 1248.79px; height: 704.283px;\\\" preload=\\\"auto\\\" loop=\\\"loop\\\" muted=\\\"muted\\\" autoplay=\\\"autoplay\\\" width=\\\"1248\\\" height=\\\"704\\\">\\n            <source src=\\\"https://fra1.digitaloceanspaces.com/typeshift/website/autopilot/tesla3.mp4\\\" type=\\\"video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;\\\">\\n          </video>\"}},\"lively.serializer-class-info\":{\"className\":\"HTMLMorph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"html-morph.js\"}}},\"Morph_077CFD40_B82A_450F_A616_C344DA2C3407\":{\"rev\":898,\"props\":{\"name\":{\"value\":\"right fade\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(1106.85201416015,1.0041634143963165)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(146.3,710.171875)\"},\"fill\":{\"value\":\"__lv_expr__:{pt,rect}:lively.graphics/geometry-2d.js:{Color,RadialGradient,LinearGradient}:lively.graphics/color.js:new LinearGradient({stops: [{offset: 0.30034466911764707, color: Color.rgba(27,38,49,0)}, {offset: 0.9036534926470589, color: Color.rgb(23,32,42)}], vector: rect(0.00000935674558361077,0.5030588654816691,0.9999812865088328,-0.006117730963338232)})\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"142DD434-7A6D-4FF1-A7D1-21D2F39C1F96\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"142DD434-7A6D-4FF1-A7D1-21D2F39C1F96\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"Morph_2F84F8A8_2DD4_45E2_B39A_7D244FCC3125\":{\"rev\":914,\"props\":{\"name\":{\"value\":\"right fade1\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(144.824444580075,708.2515032819565)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(146.3,723.296875)\"},\"rotation\":{\"value\":-3.141592653589793},\"fill\":{\"value\":\"__lv_expr__:{pt,rect}:lively.graphics/geometry-2d.js:{Color,RadialGradient,LinearGradient}:lively.graphics/color.js:new LinearGradient({stops: [{offset: 0.30034466911764707, color: Color.rgba(27,38,49,0)}, {offset: 0.9036534926470589, color: Color.rgb(23,32,42)}], vector: rect(0.00000935674558361077,0.5030588654816691,0.9999812865088328,-0.006117730963338232)})\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"C160C929-ACAD-4B34-B2B6-B9951359DEB3\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"C160C929-ACAD-4B34-B2B6-B9951359DEB3\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"384554FF-E66F-4A21-AEA9-A5ABDFE274B7\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"904F9FF2-1516-4217-A639-54121C5A81FF\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"CDFF815B-D56A-4649-8CB5-4DEF5F7A41AC\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"Morph_7B21D1AE_7A36_42AD_96A7_0141E454C5CE\":{\"rev\":1226,\"props\":{\"name\":{\"value\":\"horizontal flow\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,414.16015625)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(1104.3046875,429.3515625)\"},\"opacity\":{\"value\":0},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Label_503A833B_F0D6_492A_BAAD_7581AF8A4F48\",\"rev\":351890},{\"__ref__\":true,\"id\":\"Morph_FB124A93_9BF4_4AC4_9AD0_9BFFA4BBC2B3\",\"rev\":1218},{\"__ref__\":true,\"id\":\"Morph_FAF6E066_1CF8_46CD_9808_EDB992A7E911\",\"rev\":1219}]},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{TilingLayout}:lively.morphic:new TilingLayout({\\n  align: \\\"center\\\",\\n  axis: \\\"row\\\",\\n  orderByIndex: false,\\n  reactToSubmorphAnimations: false,\\n  spacing: 30\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Label_503A833B_F0D6_492A_BAAD_7581AF8A4F48\":{\"rev\":351890,\"props\":{\"name\":{\"value\":\"back button\"},\"nativeCursor\":{\"value\":\"pointer\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(262.603515625,30)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(87,42)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Label_8E481D6B_D0B1_4C7B_B561_2644909567FA\",\"rev\":351889}]},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"7973B7C7-F04D-4CC4-9FE3-6924F7FD6130\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"\",{\"__ref__\":true,\"id\":\"A2F9E922-8BF2-4924-9E79-23ABA4F1F3AC\",\"rev\":0}]},\"padding\":{\"value\":\"__lv_expr__:{rect}:lively.graphics/geometry-2d.js:rect(0,0,50,0)\"},\"fontSize\":{\"value\":42}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,87,42]},\"Label_8E481D6B_D0B1_4C7B_B561_2644909567FA\":{\"rev\":351889,\"props\":{\"name\":{\"value\":\"aLabel\"},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(49.42578125,17.35546875)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(39,11)\"},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"98079461-B222-445F-98B7-588F09261ED1\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"ZURCK\",null]},\"fontFamily\":{\"value\":\"Roboto\"},\"fontSize\":{\"value\":10}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,39,11]},\"98079461-B222-445F-98B7-588F09261ED1\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"F26A5A6A-A118-48D4-9166-A27E8CC29DEE\",\"rev\":0}}}},\"F26A5A6A-A118-48D4-9166-A27E8CC29DEE\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"7973B7C7-F04D-4CC4-9FE3-6924F7FD6130\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"C924049B-C9BA-4115-9F0E-558D48ED79A7\",\"rev\":0}}}},\"C924049B-C9BA-4115-9F0E-558D48ED79A7\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"A2F9E922-8BF2-4924-9E79-23ABA4F1F3AC\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"fontFamily\":{\"value\":\"\\\"Font Awesome 5 Free\\\", \\\"Font Awesome 5 Brands\\\"\"},\"fontWeight\":{\"value\":\"900\"},\"textStyleClasses\":{\"value\":[\"fas\"]},\"name\":{\"value\":\"long-arrow-alt-left\"}}},\"Morph_FB124A93_9BF4_4AC4_9AD0_9BFFA4BBC2B3\":{\"rev\":1218,\"props\":{\"name\":{\"value\":\"project info\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(381.029296875,30)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(301.421875,171.1484375)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Text_005A5401_3289_4E0C_90AF_516CB5100081\",\"rev\":16718},{\"__ref__\":true,\"id\":\"Text_B8924793_2418_477C_AAD4_E99459C6B3DF\",\"rev\":16719}]},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{VerticalLayout}:lively.morphic:new VerticalLayout({\\n  align: \\\"left\\\",\\n  autoResize: false,\\n  direction: \\\"topToBottom\\\",\\n  orderByIndex: false,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: true,\\n  spacing: 0\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Text_005A5401_3289_4E0C_90AF_516CB5100081\":{\"rev\":16718,\"props\":{\"name\":{\"value\":\"project title\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/h2\\\"})\"},\"nativeCursor\":{\"value\":\"default\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(301.421875,0)\"},\"readOnly\":{\"value\":true},\"anchors\":{\"value\":[]},\"savedMarks\":{\"value\":[{\"__ref__\":true,\"id\":\"96DD79D3-8B15-4A14-A1B3-D5FFF50259A4\",\"rev\":0},{\"__ref__\":true,\"id\":\"03E10542-ED7E-488A-BCDB-75D664D54F82\",\"rev\":0},{\"__ref__\":true,\"id\":\"7BC7685D-2B1A-4175-BCE7-3693AFBF8B43\",\"rev\":0},{\"__ref__\":true,\"id\":\"FC0CC310-E9C3-4722-BA97-65D3813B20B1\",\"rev\":0},{\"__ref__\":true,\"id\":\"DEF006E3-0A4B-4AAB-9E80-DC53D560A7F4\",\"rev\":0},{\"__ref__\":true,\"id\":\"1C98D0B4-9919-4869-91D0-6C9C46A1777F\",\"rev\":0},{\"__ref__\":true,\"id\":\"8915B68B-9581-43A3-896A-D3B857EDFDC5\",\"rev\":0},{\"__ref__\":true,\"id\":\"1660D52C-7114-487B-B39D-D1D9A257D644\",\"rev\":0}]},\"selections\":{\"key\":\"selections\",\"verbatim\":true,\"value\":[{\"start\":{\"row\":0,\"column\":23},\"end\":{\"row\":0,\"column\":23}}]},\"textAndAttributes\":{\"key\":\"textAndAttributes\",\"value\":[\"Wenn das Auto bernimmt\",null]}},\"lively.serializer-class-info\":{\"className\":\"Text\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/morph.js\"}},\"cachedLineBounds\":[]},\"96DD79D3-8B15-4A14-A1B3-D5FFF50259A4\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"5D87EFAA-707E-44C9-8839-DB9ECC7AD63D\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"5D87EFAA-707E-44C9-8839-DB9ECC7AD63D\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":97},\"row\":{\"value\":7}}},\"03E10542-ED7E-488A-BCDB-75D664D54F82\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"9971E52E-AA30-4794-B53F-AF092ADF87B1\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"9971E52E-AA30-4794-B53F-AF092ADF87B1\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":88},\"row\":{\"value\":7}}},\"7BC7685D-2B1A-4175-BCE7-3693AFBF8B43\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"C00C387D-2BDB-4BEE-BCC0-3446B4515319\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"C00C387D-2BDB-4BEE-BCC0-3446B4515319\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":93},\"row\":{\"value\":7}}},\"FC0CC310-E9C3-4722-BA97-65D3813B20B1\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"1E5EC361-C56C-4CFC-AB21-0C5622E30700\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"1E5EC361-C56C-4CFC-AB21-0C5622E30700\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":91},\"row\":{\"value\":7}}},\"DEF006E3-0A4B-4AAB-9E80-DC53D560A7F4\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"D1060113-D213-43AE-B02D-74DF44BD4A56\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"D1060113-D213-43AE-B02D-74DF44BD4A56\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":82},\"row\":{\"value\":7}}},\"1C98D0B4-9919-4869-91D0-6C9C46A1777F\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"4BB73A32-7BFA-4FE1-B8D7-3C1B1F3A8EA5\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"4BB73A32-7BFA-4FE1-B8D7-3C1B1F3A8EA5\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":30},\"row\":{\"value\":7}}},\"8915B68B-9581-43A3-896A-D3B857EDFDC5\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"9540B0C7-F983-4E46-9DF3-849699DB0855\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"9540B0C7-F983-4E46-9DF3-849699DB0855\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":21},\"row\":{\"value\":7}}},\"1660D52C-7114-487B-B39D-D1D9A257D644\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"1F6457A0-A1E0-403B-9426-F82C7F7FFC60\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"1F6457A0-A1E0-403B-9426-F82C7F7FFC60\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":21},\"row\":{\"value\":7}}},\"Text_B8924793_2418_477C_AAD4_E99459C6B3DF\":{\"rev\":16719,\"props\":{\"name\":{\"value\":\"project description\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/h3\\\"})\"},\"nativeCursor\":{\"value\":\"default\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(301.421875,40)\"},\"readOnly\":{\"value\":true},\"padding\":{\"value\":\"__lv_expr__:{rect}:lively.graphics/geometry-2d.js:rect(0,20,0,0)\"},\"anchors\":{\"value\":[]},\"savedMarks\":{\"value\":[{\"__ref__\":true,\"id\":\"7453C93B-3502-4F2F-8EDE-C88CB3B42076\",\"rev\":0},{\"__ref__\":true,\"id\":\"5CA727E3-E8C9-4779-96BD-CED018048FE4\",\"rev\":0},{\"__ref__\":true,\"id\":\"646B1778-5802-426F-82FB-FB431356BA17\",\"rev\":0},{\"__ref__\":true,\"id\":\"E458146B-1BE9-4E29-9314-2EFFAE300D04\",\"rev\":0},{\"__ref__\":true,\"id\":\"DE11481C-A2DF-4B3D-811E-9A1CA100EE9E\",\"rev\":0},{\"__ref__\":true,\"id\":\"91A5B7AD-8205-40A7-9637-2CCE5F9CBD4B\",\"rev\":0}]},\"selections\":{\"key\":\"selections\",\"verbatim\":true,\"value\":[{\"start\":{\"row\":2,\"column\":171},\"end\":{\"row\":2,\"column\":171}}]},\"textAndAttributes\":{\"key\":\"textAndAttributes\",\"value\":[\"Autonomes Fahren wird durch technologische Neuerungen immer interessanter fr Autohersteller und natrlich auch ihre Kunden. Dabei geht es stets auch um die Frage, wie der Autopilot in verschiedenen Situationen reagiert.\\n\\nIn dieser kleinen Demo simulieren wir, wie sich ein autonom gesteuertes Auto verhlt, wenn es auf langsamere oder schnellere Fahrzeuge trifft, wann es berholt und bremst.\",null]}},\"lively.serializer-class-info\":{\"className\":\"Text\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/morph.js\"}},\"cachedLineBounds\":[]},\"7453C93B-3502-4F2F-8EDE-C88CB3B42076\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"7F1EAAC2-D7BC-4BFD-978C-955574096EEC\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"7F1EAAC2-D7BC-4BFD-978C-955574096EEC\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":177},\"row\":{\"value\":7}}},\"5CA727E3-E8C9-4779-96BD-CED018048FE4\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"9A3D7A89-0B21-4BFA-A9E4-183C4EF6C734\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"9A3D7A89-0B21-4BFA-A9E4-183C4EF6C734\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":168},\"row\":{\"value\":7}}},\"646B1778-5802-426F-82FB-FB431356BA17\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"90710828-875B-4D76-BAA0-A18611186A3D\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"90710828-875B-4D76-BAA0-A18611186A3D\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":173},\"row\":{\"value\":7}}},\"E458146B-1BE9-4E29-9314-2EFFAE300D04\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"13960348-F98B-4ACC-8597-54D496580E72\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"13960348-F98B-4ACC-8597-54D496580E72\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":171},\"row\":{\"value\":7}}},\"DE11481C-A2DF-4B3D-811E-9A1CA100EE9E\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"E5EAC63F-F0CE-4F17-823A-1CABD61D6D8B\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"E5EAC63F-F0CE-4F17-823A-1CABD61D6D8B\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":162},\"row\":{\"value\":7}}},\"91A5B7AD-8205-40A7-9637-2CCE5F9CBD4B\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"id\":{\"value\":null},\"position\":{\"value\":{\"__ref__\":true,\"id\":\"011CFAE6-40FC-4E78-8E98-BBAF1B3CDBB8\",\"rev\":0}},\"insertBehavior\":{\"value\":\"move\"}},\"lively.serializer-class-info\":{\"className\":\"Anchor\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/anchors.js\"}}},\"011CFAE6-40FC-4E78-8E98-BBAF1B3CDBB8\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"column\":{\"value\":40},\"row\":{\"value\":7}}},\"Morph_FAF6E066_1CF8_46CD_9808_EDB992A7E911\":{\"rev\":1219,\"props\":{\"name\":{\"value\":\"project overview\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(712.451171875,30)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(129.25,131.63671875)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Label_A5F05BEF_B41C_4005_ACFE_AEE422BE6293\",\"rev\":351891},{\"__ref__\":true,\"id\":\"Label_DDA27824_123E_4DC5_87BC_36D9D7D6265B\",\"rev\":351892},{\"__ref__\":true,\"id\":\"Label_261E2AAB_09D9_4125_B9BA_CC74CE5F1519\",\"rev\":351893},{\"__ref__\":true,\"id\":\"Label_7C8F43AC_4C12_4470_991E_6EFC69E5C673\",\"rev\":351894},{\"__ref__\":true,\"id\":\"Label_EFBA7611_462C_407F_B750_2DBDFC17A763\",\"rev\":351895},{\"__ref__\":true,\"id\":\"Label_E8DCED4B_B3CB_4101_BFF2_A63760ECC873\",\"rev\":351896},{\"__ref__\":true,\"id\":\"Morph_46B305F9_6151_437D_90EF_6A067014699E\",\"rev\":1211},{\"__ref__\":true,\"id\":\"Morph_ABEE011F_E785_4858_A5F7_EB4A55BB5D3E\",\"rev\":1212}]},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{VerticalLayout}:lively.morphic:new VerticalLayout({\\n  align: \\\"left\\\",\\n  autoResize: false,\\n  direction: \\\"topToBottom\\\",\\n  orderByIndex: false,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: false,\\n  spacing: 0\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Label_A5F05BEF_B41C_4005_ACFE_AEE422BE6293\":{\"rev\":351891,\"props\":{\"name\":{\"value\":\"client label\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(34,11)\"},\"visible\":{\"value\":false},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"isLayoutable\":{\"value\":false},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"ECBDB53C-8DED-4A08-B5FC-EBA9492CC549\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"CLIENT\",null]},\"fontFamily\":{\"value\":\"Roboto\"},\"fontSize\":{\"value\":10},\"fontWeight\":{\"value\":\"bold\"}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":null},\"ECBDB53C-8DED-4A08-B5FC-EBA9492CC549\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"7C6861C0-3A34-4A05-A1EC-D09907F68E94\",\"rev\":0}}}},\"7C6861C0-3A34-4A05-A1EC-D09907F68E94\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_DDA27824_123E_4DC5_87BC_36D9D7D6265B\":{\"rev\":351892,\"props\":{\"name\":{\"value\":\"client name\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,11)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(19,34)\"},\"visible\":{\"value\":false},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"isLayoutable\":{\"value\":false},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"822E72DE-A3EF-4FA7-BFD9-AFD522F3F067\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"XYZ\",null]},\"padding\":{\"value\":\"__lv_expr__:{rect}:lively.graphics/geometry-2d.js:rect(0,0,0,20)\"},\"fontFamily\":{\"value\":\"Nunito\"},\"fontSize\":{\"value\":10},\"fontWeight\":{\"value\":400}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":null},\"822E72DE-A3EF-4FA7-BFD9-AFD522F3F067\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"E5E8528B-8CF7-443C-A881-83DEC233832A\",\"rev\":0}}}},\"E5E8528B-8CF7-443C-A881-83DEC233832A\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_261E2AAB_09D9_4125_B9BA_CC74CE5F1519\":{\"rev\":351893,\"props\":{\"name\":{\"value\":\"category label\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(51,11)\"},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"97BB9DE9-88B9-4A75-8557-5868D19A7FFB\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"CATEGORY\",null]},\"fontFamily\":{\"value\":\"Roboto\"},\"fontSize\":{\"value\":10},\"fontWeight\":{\"value\":\"bold\"}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,51,11]},\"97BB9DE9-88B9-4A75-8557-5868D19A7FFB\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"3DBCC0F3-D9EA-4735-BC83-60C3D7F2A471\",\"rev\":0}}}},\"3DBCC0F3-D9EA-4735-BC83-60C3D7F2A471\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_7C8F43AC_4C12_4470_991E_6EFC69E5C673\":{\"rev\":351894,\"props\":{\"name\":{\"value\":\"project category\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,11)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(65,34)\"},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"395F7CCA-3157-4951-8917-3BCE05C4696A\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Gamingansatz\",null]},\"padding\":{\"value\":\"__lv_expr__:{rect}:lively.graphics/geometry-2d.js:rect(0,0,0,20)\"},\"fontFamily\":{\"value\":\"Nunito\"},\"fontSize\":{\"value\":10},\"fontWeight\":{\"value\":400}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,65,34]},\"395F7CCA-3157-4951-8917-3BCE05C4696A\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"1CEA43B1-496C-4976-9AC0-4AE0B0170046\",\"rev\":0}}}},\"1CEA43B1-496C-4976-9AC0-4AE0B0170046\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_EFBA7611_462C_407F_B750_2DBDFC17A763\":{\"rev\":351895,\"props\":{\"name\":{\"value\":\"date label\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,45)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(25,11)\"},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"C3B1CD28-A406-42B8-B04B-C176242E43B6\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"DATE\",null]},\"fontFamily\":{\"value\":\"Roboto\"},\"fontSize\":{\"value\":10},\"fontWeight\":{\"value\":\"bold\"}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,25,11]},\"C3B1CD28-A406-42B8-B04B-C176242E43B6\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"77A207E2-89CD-4E24-B103-976D471DEAF3\",\"rev\":0}}}},\"77A207E2-89CD-4E24-B103-976D471DEAF3\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_E8DCED4B_B3CB_4101_BFF2_A63760ECC873\":{\"rev\":351896,\"props\":{\"name\":{\"value\":\"project date\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,56)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(33,34)\"},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"170A3FE7-B3FB-4124-8A6F-A6E15FD794ED\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"8.2020\",null]},\"padding\":{\"value\":\"__lv_expr__:{rect}:lively.graphics/geometry-2d.js:rect(0,0,0,20)\"},\"fontFamily\":{\"value\":\"Nunito\"},\"fontSize\":{\"value\":10},\"fontWeight\":{\"value\":400}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,33,34]},\"170A3FE7-B3FB-4124-8A6F-A6E15FD794ED\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"77A8FE58-6B11-416D-8464-ACF4475D6328\",\"rev\":0}}}},\"77A8FE58-6B11-416D-8464-ACF4475D6328\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Morph_46B305F9_6151_437D_90EF_6A067014699E\":{\"rev\":1211,\"props\":{\"attributeConnections\":{\"value\":[{\"__ref__\":true,\"id\":\"FC34E6B3-BC5C-427C-B251-3B50B1880096\",\"rev\":0}]},\"name\":{\"value\":\"test interactive button\"},\"dropShadow\":{\"value\":false},\"focusable\":{\"value\":false},\"nativeCursor\":{\"value\":\"pointer\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,90)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(123.225,33.70390625)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(241,101,119)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Label_18532006_2442_4E2C_BCB0_F8F664CBF389\",\"rev\":351897}]},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{HorizontalLayout}:lively.morphic:new HorizontalLayout({\\n  align: \\\"center\\\",\\n  autoResize: false,\\n  direction: \\\"centered\\\",\\n  orderByIndex: false,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: false,\\n  spacing: 0\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.10588235294117647,0.30980392156862746,0.4470588235294118,1],\"right\":[0.10588235294117647,0.30980392156862746,0.4470588235294118,1],\"bottom\":[0.10588235294117647,0.30980392156862746,0.4470588235294118,1],\"left\":[0.10588235294117647,0.30980392156862746,0.4470588235294118,1]}},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"20935988-D1A4-460B-B3C9-443776EC6E71\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"FC34E6B3-BC5C-427C-B251-3B50B1880096\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"doNotSerialize\":{\"value\":[\"isActive\",\"converter\",\"updater\",\"varMapping\"]},\"sourceObj\":{\"value\":{\"__ref__\":true,\"id\":\"Morph_46B305F9_6151_437D_90EF_6A067014699E\",\"rev\":1211}},\"sourceAttrName\":{\"value\":\"onMouseUp\"},\"targetObj\":{\"value\":{\"__ref__\":true,\"id\":\"ProjectDetails_9DF68582_7A5C_4AD9_8FB7_A89E4ACB7BF6\",\"rev\":1227}},\"targetMethodName\":{\"value\":\"openLinkedExample\"},\"garbageCollect\":{\"value\":false},\"signalOnAssignment\":{\"value\":true}},\"lively.serializer-class-info\":{\"className\":\"AttributeConnection\",\"module\":{\"package\":{\"name\":\"lively.bindings\",\"version\":\"0.1.2\"},\"pathInPackage\":\"index.js\"}}},\"Label_18532006_2442_4E2C_BCB0_F8F664CBF389\":{\"rev\":351897,\"props\":{\"name\":{\"value\":\"aLabel\"},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(16.112499999999997,7.351953125000001)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(91,19)\"},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"BFCE123B-05D8-4F7B-A43E-8C73EFEC7034\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Ausprobieren\",null]},\"fontSize\":{\"value\":15},\"fontColor\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(253,254,254)\"}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,91,19]},\"BFCE123B-05D8-4F7B-A43E-8C73EFEC7034\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"0A91F315-D72E-4904-8AFC-45F836D9B424\",\"rev\":0}}}},\"0A91F315-D72E-4904-8AFC-45F836D9B424\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"20935988-D1A4-460B-B3C9-443776EC6E71\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"Morph_ABEE011F_E785_4858_A5F7_EB4A55BB5D3E\":{\"rev\":1212,\"props\":{\"name\":{\"value\":\"buffer\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,123.70390625)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(115.2578125,38.82421875)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Morph_FCB90F1D_DF5B_43D2_9BCD_7E237D0D9A84\":{\"rev\":348419,\"props\":{\"name\":{\"value\":\"free first talk wrapper\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(25.000000000000014,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(770.42578125,761.5)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"visible\":{\"value\":false},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"VanillaContactForm_9F595879_BF2D_4C5C_9353_5DA8431227D8\",\"rev\":16299}]},\"clipMode\":{\"value\":\"auto\"},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{VerticalLayout}:lively.morphic:new VerticalLayout({\\n  align: \\\"left\\\",\\n  autoResize: false,\\n  direction: \\\"centered\\\",\\n  orderByIndex: false,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: true,\\n  spacing: 0\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"VanillaContactForm_9F595879_BF2D_4C5C_9353_5DA8431227D8\":{\"rev\":16299,\"props\":{\"attributeConnections\":{\"value\":[{\"__ref__\":true,\"id\":\"93DAC889-6AE6-4018-89DE-F71660C0A000\",\"rev\":0}]},\"name\":{\"value\":\"free first talk form\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,330.75)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(770.42578125,100)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_8C1222A4_E9F1_44EF_ADC1_A05CF8933D34\",\"rev\":1305},{\"__ref__\":true,\"id\":\"Morph_49A95F62_1DEA_4519_8B26_6C78EF2148B5\",\"rev\":16301},{\"__ref__\":true,\"id\":\"Label_B30F1430_5721_41E2_9588_5CB9C73D67EF\",\"rev\":351898}]},\"clipMode\":{\"value\":\"hidden\"},\"styleClasses\":{\"value\":[\"VanillaContactForm\",\"HTMLMorph\",\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{ProportionalLayout}:lively.morphic:new ProportionalLayout({\\n  lastExtent: {\\n    x: 770.42578125,\\n    y: 100\\n  },\\n  reactToSubmorphAnimations: false,\\n  submorphSettings: [[\\\"angebot close1\\\", {\\n        _rev: 0,\\n        x: \\\"move\\\",\\n        y: \\\"fixed\\\"\\n      }], [\\\"absenden button1\\\", {\\n        _rev: 0,\\n        x: \\\"move\\\",\\n        y: \\\"move\\\"\\n      }], [\\\"angebot close\\\", {\\n        _rev: 0,\\n        x: \\\"move\\\",\\n        y: \\\"fixed\\\"\\n      }], [\\\"absenden button\\\", {\\n        _rev: 0,\\n        x: \\\"move\\\",\\n        y: \\\"move\\\"\\n      }], [\\\"thank you message\\\", {\\n        _rev: 0,\\n        x: \\\"resize\\\",\\n        y: \\\"resize\\\"\\n      }], [\\\"submit button\\\", {\\n        _rev: 0,\\n        x: \\\"fixed\\\",\\n        y: \\\"move\\\"\\n      }], [\\\"close button\\\", {\\n        x: \\\"move\\\",\\n        y: \\\"fixed\\\"\\n      }], [\\\"close contact form button\\\", {\\n        x: \\\"move\\\",\\n        y: \\\"fixed\\\"\\n      }], [\\\"close free talk form button\\\", {\\n        x: \\\"move\\\",\\n        y: \\\"fixed\\\"\\n      }]]\\n})\"},\"borderWidth\":{\"key\":\"borderWidth\",\"verbatim\":true,\"value\":{\"top\":13,\"right\":13,\"bottom\":13,\"left\":13}},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.9450980392156862,0.396078431372549,0.4666666666666667,1],\"right\":[0.9450980392156862,0.396078431372549,0.4666666666666667,1],\"bottom\":[0.9450980392156862,0.396078431372549,0.4666666666666667,1],\"left\":[0.9450980392156862,0.396078431372549,0.4666666666666667,1]}},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"A7284FC9-B175-4BA0-B0DB-89BC9340E040\",\"rev\":0}},\"html\":{\"value\":\"<style>\\n  :root {\\n    --main-color: black;\\n    --main-color-transparent: rgba(0,0,0, .3); \\n  }\\n</style>\\n<div class=\\\"form red\\\">\\n<div class=\\\"measurement\\\" style=\\\"position: absolute; opacity: 0; font-weight: bold; line-height: 31px;\\\">lol</div>\\n<span style=\\\"line-height: 60px; font-weight: 900; font-family: Roboto; font-size: 60px;\\\">KOSTENLOSE </span><p style=\\\"display: inline-block; margin: 0px;\\\"><span style=\\\"line-height: 60px; font-weight: bold; font-family: Roboto; font-size: 60px; -webkit-text-stroke: 1px black; color: white; display: inline-block;\\\">BERATUNG</span>\\n</p>\\n<br>\\nSie fragen sich, ob Interactive Content fr Ihr Unternehmen geeignet ist? Gerne vereinbaren wir ein kostenloses Erstgesprch, in dem wir Ihnen vorstellen, wie wir Ihr Thema erfolgreich interaktiv darstellen.\\n<br>\\n<br>\\n<textarea class=\\\"message\\\" tabindex=\\\"7\\\" placeholder=\\\"Nachricht\\\" rows=\\\"4\\\" cols=\\\"25\\\" style=\\\"height: 100px;\\\"></textarea>\\n<input data-type=\\\"mail\\\" wrap=\\\"off\\\" class=\\\"info\\\" tabindex=\\\"8\\\" placeholder=\\\" Mail\\\" rows=\\\"1\\\" style=\\\"width: 5px;\\\" data-com.agilebits.onepassword.user-edited=\\\"yes\\\" type=\\\"email\\\">  \\n<textarea data-type=\\\"phone\\\" class=\\\"info\\\" tabindex=\\\"9\\\" placeholder=\\\"Telefon\\\" rows=\\\"1\\\" style=\\\"width: 5px;\\\" wrap=\\\"off\\\"></textarea>\\n<textarea data-type=\\\"surname\\\" class=\\\"info mandatory\\\" tabindex=\\\"10\\\" placeholder=\\\" Vorname\\\" rows=\\\"1\\\" style=\\\"width: 5px;\\\" wrap=\\\"off\\\"></textarea>\\n<textarea data-type=\\\"name\\\" class=\\\"info mandatory\\\" tabindex=\\\"11\\\" placeholder=\\\" Nachname\\\" rows=\\\"1\\\" style=\\\"width: 5px;\\\" wrap=\\\"off\\\"></textarea>\\n<textarea data-type=\\\"company\\\" class=\\\"info\\\" tabindex=\\\"12\\\" placeholder=\\\"Unternehmen\\\" rows=\\\"1\\\" style=\\\"width: 5px;\\\" wrap=\\\"off\\\"></textarea>\\n</div>\\n\\n\"},\"cssDeclaration\":{\"value\":\".red > .error {\\n    color: red;\\n    border-color: red;\\n  }\\n  .red > .error.info::-webkit-input-placeholder {\\n    color: red;\\n  }\\n  .red.form {\\n    font-family: Nunito;\\n    font-weight: 100;\\n    color: var(--main-color);\\n    padding: 20px;\\n    font-size: 25px;\\n    line-height: 1.4em;\\n  }\\n  .red > textarea, .red > .measurement, .red > input {\\n    color: var(--main-color);\\n    font-size: 19px;\\n    font-family: Nunito;\\n    border-color: var(--main-color);\\n    background: transparent;\\n    padding: 0px;\\n    border-radius: 0px;\\n    padding-left: 0;\\n  }\\n  input:-webkit-autofill {\\n    background-color: none;\\n    color: inherit;\\n  }\\n  input {\\n    margin-right: 10px;\\n  }\\n  textarea {\\n    margin-right: 10px;\\n  }\\n  .red > .message {\\n    border-width: 0px; \\n    resize: none;\\n    outline: none;\\n    width: calc(100% - 10px);\\n    overflow: hidden;\\n    line-height: 31px;\\n    background-image:\\n        linear-gradient(to right, transparent 10px, transparent 10px),\\n        linear-gradient(to left, transparent 10px, transparent 10px),\\n        repeating-linear-gradient(transparent, transparent 30px, var(--main-color) 30px, var(--main-color) 31px, transparent 31px);\\n  }\\n  .red > .info {\\n    vertical-align: bottom;\\n    display: inline-block;\\n    border-width: 0px 0px 2px;\\n    resize: none;\\n    outline: none;\\n    overflow: hidden;\\n    border-bottom-style: solid;\\n  }\\n  .red > .message::-webkit-input-placeholder {\\n    color: var(--main-color-transparent);\\n  }\\n  .red > .info::-webkit-input-placeholder {\\n    border-bottom-color: var(--main-color);\\n    color: var(--main-color-transparent);\\n  }\\n   @-moz-document url-prefix() {\\n    .red > textarea::placeholder {\\n\\n    }\\n    .red > input::placeholder {\\n      border-bottom-color: var(--main-color);\\n      color: var(--main-color);\\n    }\\n    .red > .info::placeholder  {\\n      border-bottom-color: var(--main-color);\\n      color: var(--main-color);\\n    }\\n    .red > .mandatory {\\n      padding-bottom: 3px;\\n    }\\n  }\"},\"subject\":{\"value\":\"Kontaktanfrage\"},\"fontColor\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(81,90,90)\"}},\"lively.serializer-class-info\":{\"className\":\"VanillaContactForm\",\"module\":{\"package\":{\"name\":\"VanillaContactForm\",\"version\":\"0.1.1-157\"},\"pathInPackage\":\"index.js\"}}},\"93DAC889-6AE6-4018-89DE-F71660C0A000\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"doNotSerialize\":{\"value\":[\"isActive\",\"converter\",\"updater\",\"varMapping\"]},\"sourceObj\":{\"value\":{\"__ref__\":true,\"id\":\"VanillaContactForm_9F595879_BF2D_4C5C_9353_5DA8431227D8\",\"rev\":16299}},\"sourceAttrName\":{\"value\":\"extent\"},\"targetObj\":{\"value\":{\"__ref__\":true,\"id\":\"VanillaContactForm_9F595879_BF2D_4C5C_9353_5DA8431227D8\",\"rev\":16299}},\"targetMethodName\":{\"value\":\"resizeTextAreas\"},\"garbageCollect\":{\"value\":true},\"signalOnAssignment\":{\"value\":true},\"updaterString\":{\"value\":\"function ($upd, newExt, oldExt) {\\n  if (newExt.x != oldExt.x)\\n    source.whenRendered().then($upd);\\n}\"},\"updater\":{}},\"lively.serializer-class-info\":{\"className\":\"AttributeConnection\",\"module\":{\"package\":{\"name\":\"lively.bindings\",\"version\":\"0.1.2\"},\"pathInPackage\":\"index.js\"}}},\"Morph_8C1222A4_E9F1_44EF_ADC1_A05CF8933D34\":{\"rev\":1305,\"props\":{\"attributeConnections\":{\"value\":[{\"__ref__\":true,\"id\":\"7E3727D0-005B-40F2-801B-9A8A8D188E83\",\"rev\":0}]},\"name\":{\"value\":\"submit button\"},\"dropShadow\":{\"value\":false},\"focusable\":{\"value\":false},\"nativeCursor\":{\"value\":\"pointer\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(33.36093750000009,21.334765625000045)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(133.1,45.153125)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(241,101,119)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"WebsiteTextField_83D363D6_5D44_4D76_B7C9_611F19CA641C\",\"rev\":1304}]},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.10588235294117647,0.30980392156862746,0.4470588235294118,1],\"right\":[0.10588235294117647,0.30980392156862746,0.4470588235294118,1],\"bottom\":[0.10588235294117647,0.30980392156862746,0.4470588235294118,1],\"left\":[0.10588235294117647,0.30980392156862746,0.4470588235294118,1]}},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"F5230E4C-270A-4B3F-8B71-3BEF72C123FF\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"7E3727D0-005B-40F2-801B-9A8A8D188E83\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"doNotSerialize\":{\"value\":[\"isActive\",\"converter\",\"updater\",\"varMapping\"]},\"sourceObj\":{\"value\":{\"__ref__\":true,\"id\":\"Morph_8C1222A4_E9F1_44EF_ADC1_A05CF8933D34\",\"rev\":1305}},\"sourceAttrName\":{\"value\":\"onMouseDown\"},\"targetObj\":{\"value\":{\"__ref__\":true,\"id\":\"VanillaContactForm_9F595879_BF2D_4C5C_9353_5DA8431227D8\",\"rev\":16299}},\"targetMethodName\":{\"value\":\"submit\"},\"garbageCollect\":{\"value\":true},\"signalOnAssignment\":{\"value\":true}},\"lively.serializer-class-info\":{\"className\":\"AttributeConnection\",\"module\":{\"package\":{\"name\":\"lively.bindings\",\"version\":\"0.1.2\"},\"pathInPackage\":\"index.js\"}}},\"WebsiteTextField_83D363D6_5D44_4D76_B7C9_611F19CA641C\":{\"rev\":1304,\"props\":{\"name\":{\"value\":\"text\"},\"focusable\":{\"value\":false},\"nativeCursor\":{\"value\":\"default\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(24.33671875,3.8851562500000014)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(9,6)\"},\"fill\":{\"value\":null},\"styleClasses\":{\"value\":[\"WebsiteTextField\",\"Text\",\"Morph\",\"morph\",\"staticText\"]},\"borderRadius\":{\"key\":\"borderRadius\",\"verbatim\":true,\"value\":{\"top\":3,\"right\":3,\"bottom\":3,\"left\":3}},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.8,0.8,0.8,1],\"right\":[0.8,0.8,0.8,1],\"bottom\":[0.8,0.8,0.8,1],\"left\":[0.8,0.8,0.8,1]}},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"710D8646-426F-42B2-8B7C-D43462C9CE14\",\"rev\":0}},\"readOnly\":{\"value\":true},\"selectable\":{\"value\":false},\"padding\":{\"value\":\"__lv_expr__:{rect}:lively.graphics/geometry-2d.js:rect(4,3,1,0)\"},\"fontSize\":{\"value\":22},\"fontColor\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(253,254,254)\"},\"anchors\":{\"value\":[]},\"selections\":{\"key\":\"selections\",\"verbatim\":true,\"value\":[{\"start\":{\"row\":0,\"column\":6},\"end\":{\"row\":0,\"column\":6}}]},\"textAndAttributes\":{\"key\":\"textAndAttributes\",\"value\":[\"Senden\",null]}},\"lively.serializer-class-info\":{\"className\":\"WebsiteTextField\",\"module\":{\"package\":{\"name\":\"TypeshiftDesktop\",\"version\":\"0.1.1-114\"},\"pathInPackage\":\"index.js\"}},\"cachedLineBounds\":[]},\"710D8646-426F-42B2-8B7C-D43462C9CE14\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"ECF8D35F-B2AE-4A6E-9718-C1FD806ADEF7\",\"rev\":0}}}},\"ECF8D35F-B2AE-4A6E-9718-C1FD806ADEF7\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true},\"recoveredLineCharBounds\":{\"value\":true}}},\"F5230E4C-270A-4B3F-8B71-3BEF72C123FF\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"Morph_49A95F62_1DEA_4519_8B26_6C78EF2148B5\":{\"rev\":16301,\"props\":{\"name\":{\"value\":\"thank you message\"},\"draggable\":{\"value\":true},\"grabbable\":{\"value\":true},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,17.047227647569457)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(770.42578125,306.56668783817395)\"},\"opacity\":{\"value\":0},\"visible\":{\"value\":false},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Text_6E34C601_3C81_4485_8078_E1BCD3086BAC\",\"rev\":1395},{\"__ref__\":true,\"id\":\"HTMLMorph_9374BD9C_111B_4537_B990_3350631BEE8E\",\"rev\":1370}]},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{ProportionalLayout}:lively.morphic:new ProportionalLayout({\\n  lastExtent: {\\n    x: 770.42578125,\\n    y: 306.56668783817395\\n  },\\n  reactToSubmorphAnimations: false,\\n  submorphSettings: [[\\\"letter\\\", {\\n        _rev: 0,\\n        x: \\\"scale\\\",\\n        y: \\\"fixed\\\"\\n      }], [\\\"thanks\\\", {\\n        _rev: 0,\\n        x: \\\"scale\\\",\\n        y: \\\"fixed\\\"\\n      }]]\\n})\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"EA6B5BF2-9858-44A5-8D6B-D40AB13E288F\",\"rev\":0}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Text_6E34C601_3C81_4485_8078_E1BCD3086BAC\":{\"rev\":1395,\"props\":{\"name\":{\"value\":\"thanks\"},\"focusable\":{\"value\":false},\"nativeCursor\":{\"value\":\"default\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,239.20937500000002)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,6)\"},\"opacity\":{\"value\":0},\"fill\":{\"value\":null},\"styleClasses\":{\"value\":[\"Text\",\"Morph\",\"morph\",\"staticText\"]},\"borderRadius\":{\"key\":\"borderRadius\",\"verbatim\":true,\"value\":{\"top\":3,\"right\":3,\"bottom\":3,\"left\":3}},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0.8,0.8,0.8,1],\"right\":[0.8,0.8,0.8,1],\"bottom\":[0.8,0.8,0.8,1],\"left\":[0.8,0.8,0.8,1]}},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"239FAE4F-FF8E-484A-81CE-F9BEBE8B0189\",\"rev\":0}},\"fixedWidth\":{\"value\":true},\"readOnly\":{\"value\":true},\"selectable\":{\"value\":false},\"padding\":{\"value\":\"__lv_expr__:{rect}:lively.graphics/geometry-2d.js:rect(4,3,1,0)\"},\"fontFamily\":{\"value\":\"Nunito\"},\"fontSize\":{\"value\":20},\"fontColor\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(81,90,90)\"},\"textAlign\":{\"value\":\"center\"},\"lineWrapping\":{\"value\":true},\"anchors\":{\"value\":[]},\"selections\":{\"key\":\"selections\",\"verbatim\":true,\"value\":[{\"start\":{\"row\":0,\"column\":0},\"end\":{\"row\":0,\"column\":0}}]},\"textAndAttributes\":{\"key\":\"textAndAttributes\",\"value\":[\"Vielen Dank fr Ihre Nachricht!\",null]}},\"lively.serializer-class-info\":{\"className\":\"Text\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/morph.js\"}},\"cachedLineBounds\":[]},\"239FAE4F-FF8E-484A-81CE-F9BEBE8B0189\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"FA13CDCA-BE90-477E-A1EB-FD8E9C258EF1\",\"rev\":0}}}},\"FA13CDCA-BE90-477E-A1EB-FD8E9C258EF1\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true},\"recoveredLineCharBounds\":{\"value\":true}}},\"HTMLMorph_9374BD9C_111B_4537_B990_3350631BEE8E\":{\"rev\":1370,\"props\":{\"name\":{\"value\":\"letter\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,32.31372974537038)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,176.65680803571428)\"},\"fill\":{\"value\":null},\"styleClasses\":{\"value\":[\"HTMLMorph\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"74AF24D1-8003-4631-9985-2EEA98B71831\",\"rev\":0}},\"html\":{\"value\":\"<style scoped=\\\"\\\">\\n @keyframes heartDraw {\\n   to { stroke-dashoffset: 400;}\\n }\\n @keyframes heartDrawBack {\\n   to { stroke-dashoffset: 0;}\\n }\\n</style>\\n<svg width=\\\"100%\\\" height=\\\"100%\\\" viewBox=\\\"0 0 592 448\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xml:space=\\\"preserve\\\" xmlns:serif=\\\"http://www.serif.com/\\\" style=\\\"fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;\\\">\\n  <path d=\\\"M5,14.49c0.263,109.572 6.833,225.602 6.833,334.8c0,23.779 -6.591,71.588 -2.733,90.875\\\" style=\\\"fill-opacity: 0; fill-rule: nonzero; stroke: rgb(81, 90, 90); stroke-width: 10px;\\\"></path><path d=\\\"M5,14.49c123.111,-13.871 248.512,-10.298 372.38,-3.416c67.628,3.757 136.462,-3.417 203.613,-3.417\\\" style=\\\"fill-opacity: 0; fill-rule: nonzero; stroke: rgb(81, 90, 90); stroke-width: 10px;\\\"></path>\\n  <path d=\\\"M580.993,7.657c2.869,82.073 -9.94,179.853 -4.782,262.375c3.475,55.607 10.248,109.454 10.248,165.35\\\" style=\\\"fill-opacity: 0; fill-rule: nonzero; stroke: rgb(81, 90, 90); stroke-width: 10px;\\\"></path>\\n  <path d=\\\"M9.1,440.165c127.374,10.034 270.129,-11.602 397.66,-4.1c39.284,2.311 140.201,4.764 178.333,-0.683\\\" style=\\\"fill-opacity: 0; fill-rule: nonzero; stroke: rgb(81, 90, 90); stroke-width: 10px;\\\"></path>\\n  <path d=\\\"M301.538,222.203c87.729,-73.4 186.633,-148.244 279.455,-214.546\\\" style=\\\"fill-opacity: 0; fill-rule: nonzero; stroke: rgb(81, 90, 90); stroke-width: 10px;\\\"></path><path d=\\\"M7.05,20.639c79.659,38.323 148.523,113.496 222.745,159.885c15.512,9.695 59.543,30.554 68.326,43.729\\\" style=\\\"fill-opacity: 0; fill-rule: nonzero; stroke: rgb(81, 90, 90); stroke-width: 10px;\\\"></path>\\n  <path d=\\\"M294.31,95.447c2.435,-5.275 4.699,-11.809 9.672,-15.361c18.888,-13.492 49.943,1.191 44.946,26.171c-3.007,15.039 -39.304,38.589 -50.807,47.791\\\" style=\\\"fill-opacity: 0; fill-rule: nonzero; stroke: rgb(81, 90, 90); stroke-width: 10px; stroke-dasharray: 200; stroke-dashoffset: 200; animation: heartDraw 1s cubic-bezier(0.55, 0.06, 0.68, 0.19) 0s 1 normal forwards running;\\\"></path>\\n  <path d=\\\"M294.31,95.447c-4.804,-4.937 -19.662,-13.212 -26.74,-14.223c-8.721,-1.246 -20.403,1.058 -26.741,7.396c-23.799,23.799 27.159,44.026 40.395,53.48c4.921,3.515 11.688,8.693 16.897,11.948\\\" style=\\\"fill-opacity: 0; fill-rule: nonzero; stroke: rgb(81, 90, 90); stroke-width: 10px; stroke-dasharray: 200; stroke-dashoffset: 200; animation: heartDrawBack 1s cubic-bezier(0.22, 0.61, 0.36, 1) 1s 1 normal forwards running;\\\"></path>\\n</svg>\"}},\"lively.serializer-class-info\":{\"className\":\"HTMLMorph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"html-morph.js\"}}},\"74AF24D1-8003-4631-9985-2EEA98B71831\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"EA6B5BF2-9858-44A5-8D6B-D40AB13E288F\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"Label_B30F1430_5721_41E2_9588_5CB9C73D67EF\":{\"rev\":351898,\"props\":{\"name\":{\"value\":\"close free talk form button\"},\"nativeCursor\":{\"value\":\"pointer\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(708.4460968048852,21.989639282226562)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(49,64)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(253,254,254)\"},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"6EDD4171-8415-40B0-A98D-220EEC9E6451\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"\",{\"__ref__\":true,\"id\":\"AF4D5D0E-C13D-4742-8E98-1FADE3B91193\",\"rev\":0}]},\"padding\":{\"value\":\"__lv_expr__:{rect}:lively.graphics/geometry-2d.js:rect(7,7,0,0)\"},\"fontSize\":{\"value\":50}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,49,64]},\"6EDD4171-8415-40B0-A98D-220EEC9E6451\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"3A0F48F3-CB2E-426B-BC35-2AB91ED47B22\",\"rev\":0}}}},\"3A0F48F3-CB2E-426B-BC35-2AB91ED47B22\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"AF4D5D0E-C13D-4742-8E98-1FADE3B91193\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"fontFamily\":{\"value\":\"\\\"Font Awesome 5 Free\\\", \\\"Font Awesome 5 Brands\\\"\"},\"fontWeight\":{\"value\":\"900\"},\"textStyleClasses\":{\"value\":[\"fas\"]},\"name\":{\"value\":\"times\"}}},\"A7284FC9-B175-4BA0-B0DB-89BC9340E040\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"commit\":{}}},\"TypeshiftMenuBar_230D01BA_83C5_4D33_8F97_893E15F5CD70\":{\"rev\":1655,\"props\":{\"attributeConnections\":{\"value\":[{\"__ref__\":true,\"id\":\"2D01772D-0DF6-4132-87BF-C84A35596B46\",\"rev\":0}]},\"name\":{\"value\":\"title bar\"},\"dropShadow\":{\"value\":\"__lv_expr__:{ShadowObject}:lively.morphic:{Color}:lively.graphics/color.js:new ShadowObject({distance:2,rotation:45,color:Color.rgba(0,0,0,0.38),inset:false,blur:6,spread:0,fast:true})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-0.38671875,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(820.34765625,57.4375)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Image_11FF4677_C1EB_4F8D_AA07_736B377858BB\",\"rev\":16133},{\"__ref__\":true,\"id\":\"Morph_239EB12E_960A_46F0_A1A7_F1498F0214BE\",\"rev\":1530},{\"__ref__\":true,\"id\":\"Morph_71D87DCB_A950_42D2_9A98_140ECEC38E46\",\"rev\":348429},{\"__ref__\":true,\"id\":\"Label_1738D9EE_2ACC_4018_AB8A_728E2B243598\",\"rev\":351910}]},\"styleClasses\":{\"value\":[\"TypeshiftMenuBar\",\"InteractiveMorph\",\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{HorizontalLayout}:lively.morphic:new HorizontalLayout({\\n  align: \\\"center\\\",\\n  autoResize: false,\\n  direction: \\\"leftToRight\\\",\\n  orderByIndex: false,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: false,\\n  spacing: 0\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"TypeshiftMenuBar\",\"module\":{\"package\":{\"name\":\"TypeshiftMenuBar\",\"version\":\"0.1.1-7\"},\"pathInPackage\":\"index.js\"}}},\"2D01772D-0DF6-4132-87BF-C84A35596B46\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"doNotSerialize\":{\"value\":[\"isActive\",\"converter\",\"updater\",\"varMapping\"]},\"sourceObj\":{\"value\":{\"__ref__\":true,\"id\":\"TypeshiftMenuBar_230D01BA_83C5_4D33_8F97_893E15F5CD70\",\"rev\":1655}},\"sourceAttrName\":{\"value\":\"extent\"},\"targetObj\":{\"value\":{\"__ref__\":true,\"id\":\"TypeshiftMenuBar_230D01BA_83C5_4D33_8F97_893E15F5CD70\",\"rev\":1655}},\"targetMethodName\":{\"value\":\"relayout\"},\"garbageCollect\":{\"value\":false},\"signalOnAssignment\":{\"value\":true}},\"lively.serializer-class-info\":{\"className\":\"AttributeConnection\",\"module\":{\"package\":{\"name\":\"lively.bindings\",\"version\":\"0.1.2\"},\"pathInPackage\":\"index.js\"}}},\"Image_11FF4677_C1EB_4F8D_AA07_736B377858BB\":{\"rev\":16133,\"props\":{\"name\":{\"value\":\"typeshift logo\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,12.659925322995136)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(186.90674149856613,32.11764935400972)\"},\"fill\":{\"value\":null},\"styleClasses\":{\"value\":[\"Image\",\"Morph\",\"morph\"]},\"imageUrl\":{\"value\":\"assets/typeshift_logo.svg\"},\"naturalExtent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(300,124)\"}},\"lively.serializer-class-info\":{\"className\":\"Image\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Morph_239EB12E_960A_46F0_A1A7_F1498F0214BE\":{\"rev\":1530,\"props\":{\"name\":{\"value\":\"mobile nav menu\"},\"draggable\":{\"value\":true},\"dropShadow\":{\"value\":\"__lv_expr__:{ShadowObject}:lively.morphic:{Color}:lively.graphics/color.js:new ShadowObject({distance:2,rotation:45,color:Color.darkGray,inset:false,blur:6,spread:0,fast:true})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(631.9565397514339,67.69921875)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(167.265625,273.234375)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(253,254,254)\"},\"visible\":{\"value\":false},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Morph_208248CA_BE62_41A0_BC6E_9D3AD33FE83D\",\"rev\":1524}]},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"isLayoutable\":{\"value\":false},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Morph_208248CA_BE62_41A0_BC6E_9D3AD33FE83D\":{\"rev\":1524,\"props\":{\"name\":{\"value\":\"desktop menu1\"},\"draggable\":{\"value\":true},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0.2700227485661344,0.38671875)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(168.12109375,271.375)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Label_C68277E7_07A0_4293_B26C_EFFC041890BA\",\"rev\":351899},{\"__ref__\":true,\"id\":\"Label_6B7856FD_81D7_4670_8144_08D082BA7158\",\"rev\":351900},{\"__ref__\":true,\"id\":\"Label_F2E48ABA_6CAB_4A85_A4B6_E31AF07CB912\",\"rev\":351901},{\"__ref__\":true,\"id\":\"Label_527D2474_DAE8_43F5_81A4_3BEE614A1256\",\"rev\":351902},{\"__ref__\":true,\"id\":\"Label_8995B9EB_44CA_45BD_B8BF_4C526D4735AD\",\"rev\":351903}]},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{VerticalLayout}:lively.morphic:new VerticalLayout({\\n  align: \\\"left\\\",\\n  autoResize: false,\\n  direction: \\\"topToBottom\\\",\\n  orderByIndex: false,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: false,\\n  spacing: 25\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Label_C68277E7_07A0_4293_B26C_EFFC041890BA\":{\"rev\":351899,\"props\":{\"name\":{\"value\":\"projects tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(25,25)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(96,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"F1BBFC22-EF1F-440E-B922-CBA0F99F8FFA\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Projekte\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,96,24]},\"F1BBFC22-EF1F-440E-B922-CBA0F99F8FFA\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"B9B6AA38-5190-426F-B3F1-E52795350954\",\"rev\":0}}}},\"B9B6AA38-5190-426F-B3F1-E52795350954\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_6B7856FD_81D7_4670_8144_08D082BA7158\":{\"rev\":351900,\"props\":{\"name\":{\"value\":\"services tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(25,74)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(115,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"70DA6CB8-2B97-402E-A450-F86835633DF5\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Leistungen\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,115,24]},\"70DA6CB8-2B97-402E-A450-F86835633DF5\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"00DA3C74-6151-48C6-8E86-206DE12B582A\",\"rev\":0}}}},\"00DA3C74-6151-48C6-8E86-206DE12B582A\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_F2E48ABA_6CAB_4A85_A4B6_E31AF07CB912\":{\"rev\":351901,\"props\":{\"name\":{\"value\":\"agency tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(25,123)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(94,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"39B69B2F-EC12-4ACC-AA2E-28BB095B4C5A\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Agentur\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,94,24]},\"39B69B2F-EC12-4ACC-AA2E-28BB095B4C5A\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"5D0CB7CF-6C66-4432-A02C-B53F6B159CA4\",\"rev\":0}}}},\"5D0CB7CF-6C66-4432-A02C-B53F6B159CA4\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_527D2474_DAE8_43F5_81A4_3BEE614A1256\":{\"rev\":351902,\"props\":{\"name\":{\"value\":\"contact tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(25,221)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(93,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"1B3490C4-08A4-4579-9528-495782B6BADB\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Kontakt\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,93,24]},\"1B3490C4-08A4-4579-9528-495782B6BADB\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"095B0B2F-68E8-4BBB-B751-2E5EC4D4C9F8\",\"rev\":0}}}},\"095B0B2F-68E8-4BBB-B751-2E5EC4D4C9F8\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_8995B9EB_44CA_45BD_B8BF_4C526D4735AD\":{\"rev\":351903,\"props\":{\"name\":{\"value\":\"references tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(25,172)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(116,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"0489CA8B-7883-4199-9E65-45D5C9BCC8F5\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Referenzen\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,116,24]},\"0489CA8B-7883-4199-9E65-45D5C9BCC8F5\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"F70DDCE7-BA61-4F65-A2AA-A146D54AEF21\",\"rev\":0}}}},\"F70DDCE7-BA61-4F65-A2AA-A146D54AEF21\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Morph_71D87DCB_A950_42D2_9A98_140ECEC38E46\":{\"rev\":348429,\"props\":{\"name\":{\"value\":\"desktop menu\"},\"draggable\":{\"value\":true},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(186.90674149856613,16.718749999999996)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(514,24)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgba(0,0,0,0)\"},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Label_91D6E1E6_81D7_4653_98FF_EE06CEF5EBDD\",\"rev\":351904},{\"__ref__\":true,\"id\":\"Label_46634E03_3E7A_4728_9E06_87B05688DDA0\",\"rev\":351905},{\"__ref__\":true,\"id\":\"Label_4EDA7C88_853B_4AE2_A3D3_4FBEABC230DF\",\"rev\":351906},{\"__ref__\":true,\"id\":\"Label_45D7D3CF_E102_4592_AF49_7C07E31A21D0\",\"rev\":351907},{\"__ref__\":true,\"id\":\"Label_E8C7D5EC_A106_4C8B_967F_754A06353CC5\",\"rev\":351908}]},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]},\"layout\":{\"value\":\"__lv_expr__:{HorizontalLayout}:lively.morphic:new HorizontalLayout({\\n  align: \\\"top\\\",\\n  autoResize: true,\\n  direction: \\\"leftToRight\\\",\\n  orderByIndex: false,\\n  padding: null,\\n  reactToSubmorphAnimations: false,\\n  resizeSubmorphs: false,\\n  spacing: 0\\n})\"},\"borderColor\":{\"key\":\"borderColor\",\"verbatim\":true,\"value\":{\"top\":[0,0,0,0],\"right\":[0,0,0,0],\"bottom\":[0,0,0,0],\"left\":[0,0,0,0]}}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}},\"Label_91D6E1E6_81D7_4653_98FF_EE06CEF5EBDD\":{\"rev\":351904,\"props\":{\"name\":{\"value\":\"services tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(96,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(115,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"1814D249-8083-4214-AD1B-1ACA64938DEC\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Leistungen\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,115,24]},\"1814D249-8083-4214-AD1B-1ACA64938DEC\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"C3AA2E01-8EEF-4A2A-8685-D143054F9CE0\",\"rev\":0}}}},\"C3AA2E01-8EEF-4A2A-8685-D143054F9CE0\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_46634E03_3E7A_4728_9E06_87B05688DDA0\":{\"rev\":351905,\"props\":{\"name\":{\"value\":\"agency tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(211,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(94,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"03E96DB4-7A74-4ECC-B67B-04BDBABCF3FC\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Agentur\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,94,24]},\"03E96DB4-7A74-4ECC-B67B-04BDBABCF3FC\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"A463DF45-29EE-4F24-BAA9-F7C80F5A78B0\",\"rev\":0}}}},\"A463DF45-29EE-4F24-BAA9-F7C80F5A78B0\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_4EDA7C88_853B_4AE2_A3D3_4FBEABC230DF\":{\"rev\":351906,\"props\":{\"name\":{\"value\":\"contact tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(421,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(93,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"1BE5502D-D9AA-4A85-B8D1-36FE6E29AC14\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Kontakt\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,93,24]},\"1BE5502D-D9AA-4A85-B8D1-36FE6E29AC14\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"21B74DFE-6220-4B16-8C82-D659AAC41FC7\",\"rev\":0}}}},\"21B74DFE-6220-4B16-8C82-D659AAC41FC7\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_45D7D3CF_E102_4592_AF49_7C07E31A21D0\":{\"rev\":351907,\"props\":{\"name\":{\"value\":\"references tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(305,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(116,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"AEE97B59-49EE-48E5-A8F7-424C7A0A34F7\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Referenzen\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,116,24]},\"AEE97B59-49EE-48E5-A8F7-424C7A0A34F7\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"D07FF93E-12F7-4E80-910B-5218B3037864\",\"rev\":0}}}},\"D07FF93E-12F7-4E80-910B-5218B3037864\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_E8C7D5EC_A106_4C8B_967F_754A06353CC5\":{\"rev\":351908,\"props\":{\"name\":{\"value\":\"projects tag\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,0)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(96,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"F868BC29-875D-4C57-A948-B2370924F25E\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Projekte\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,96,24]},\"F868BC29-875D-4C57-A948-B2370924F25E\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"1F16CCB1-886E-4F31-B30A-CC7E05C072A7\",\"rev\":0}}}},\"1F16CCB1-886E-4F31-B30A-CC7E05C072A7\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"Label_1738D9EE_2ACC_4018_AB8A_728E2B243598\":{\"rev\":351910,\"props\":{\"name\":{\"value\":\"mobile menu button\"},\"nativeCursor\":{\"value\":\"pointer\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(769.34765625,17.21875)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(21,23)\"},\"visible\":{\"value\":false},\"submorphs\":{\"value\":[{\"__ref__\":true,\"id\":\"Label_D288B93B_1731_46B9_892A_39BBFE09E5AC\",\"rev\":351909}]},\"styleClasses\":{\"value\":[\"Label\",\"Morph\",\"morph\"]},\"isLayoutable\":{\"value\":false},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"CA2BA096-61BC-49C6-84FC-40783C58AAD4\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"\",{\"__ref__\":true,\"id\":\"43EE9A39-1B1E-4336-AF83-0E6C5B2FB536\",\"rev\":0}]},\"fontSize\":{\"value\":23.064}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":null},\"Label_D288B93B_1731_46B9_892A_39BBFE09E5AC\":{\"rev\":351909,\"props\":{\"name\":{\"value\":\"menu item\"},\"master\":{\"value\":\"__lv_expr__:({\\\"auto\\\":\\\"styleguide://typeshift website NEU/tag proto\\\"})\"},\"reactsToPointer\":{\"value\":false},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(-67.5,-0.5)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(78,24)\"},\"metadata\":{\"value\":{\"__ref__\":true,\"id\":\"853AB82C-2305-4A99-9F3C-D4841BEDA059\",\"rev\":0}},\"textAndAttributes\":{\"value\":[\"Menu\",null]}},\"lively.serializer-class-info\":{\"className\":\"Label\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"text/label.js\"}},\"_cachedTextBounds\":[0,0,78,24]},\"853AB82C-2305-4A99-9F3C-D4841BEDA059\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"8EA7C625-BB8B-45D2-81AB-BA74052680FD\",\"rev\":0}}}},\"8EA7C625-BB8B-45D2-81AB-BA74052680FD\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"CA2BA096-61BC-49C6-84FC-40783C58AAD4\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"deserializeInfo\":{\"value\":{\"__ref__\":true,\"id\":\"D11338DE-D05B-4391-9F39-B36D94B71F69\",\"rev\":0}}}},\"D11338DE-D05B-4391-9F39-B36D94B71F69\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"recoveredTextBounds\":{\"value\":true}}},\"43EE9A39-1B1E-4336-AF83-0E6C5B2FB536\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"fontFamily\":{\"value\":\"\\\"Font Awesome 5 Free\\\", \\\"Font Awesome 5 Brands\\\"\"},\"fontWeight\":{\"value\":\"900\"},\"textStyleClasses\":{\"value\":[\"fas\"]},\"name\":{\"value\":\"bars\"}}},\"0841B570-1092-46F8-8353-9C5D6D9FCCD8\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"Nunito\":{\"value\":\"https://fonts.googleapis.com/css2?family=Nunito:wght@200;400;700&family=Roboto:wght@500;700&display=swap\"},\"Roboto\":{\"value\":\"https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap\"}}},\"64053F47-F79D-4C94-8A2A-BA7A4755F525\":{\"rev\":0,\"props\":{\"_rev\":{\"value\":0},\"excludedPackages\":{\"value\":[\"lively.ast\",\"lively.vm\",\"lively.ide\",\"lively.modules\",\"babel-plugin-transform-jsx\",\"lively-system-interface\",\"lively.storage\"]},\"publishedLocation\":{\"value\":\"/resources/typeshift-fast\"}}},\"Morph_0D3D0A89_0CD9_42CE_91B5_E8A5CC78646F\":{\"rev\":348413,\"props\":{\"name\":{\"value\":\"aMorph\"},\"position\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(0,1420.50390625)\"},\"extent\":{\"value\":\"__lv_expr__:{pt}:lively.graphics/geometry-2d.js:pt(819.8028850501616,1000)\"},\"fill\":{\"value\":\"__lv_expr__:{Color}:lively.graphics/color.js:Color.rgb(204,0,0)\"},\"visible\":{\"value\":false},\"styleClasses\":{\"value\":[\"Morph\",\"morph\"]}},\"lively.serializer-class-info\":{\"className\":\"Morph\",\"module\":{\"package\":{\"name\":\"lively.morphic\",\"version\":\"0.1.2\"},\"pathInPackage\":\"morph.js\"}}}},\"requiredVersion\":\">=0.1\",\"packagesToRegister\":[],\"packageDepMap\":{\"local://lively-object-modules/TypeshiftWebsite\":[],\"local://lively-object-modules/ProjectDetails\":[],\"local://lively-object-modules/VideoTile\":[],\"local://lively-object-modules/VanillaContactForm\":[],\"local://lively-object-modules/TypeshiftDesktop\":[],\"local://lively-object-modules/TypeshiftMenuBar\":[]}}");lively.resources={resource:resource,loadViaScript:loadViaScript};lively.morphic={loadMorphFromSnapshot:loadMorphFromSnapshot};function renderFrozenPart(){return _renderFrozenPart.apply(this,arguments);}function _renderFrozenPart(){_renderFrozenPart=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee235(){var node,world,_args236=arguments;return regeneratorRuntime.wrap(function _callee235$(_context235){while(1){switch(_context235.prev=_context235.next){case 0:node=_args236.length>0&&_args236[0]!==undefined?_args236[0]:document.body;if(!MorphicEnv["default"]().world){world=window.$world=window.$$world=new World({name:snapshot.name,extent:pt(window.innerWidth,window.innerHeight)});MorphicEnv["default"]().setWorldRenderedOn(world,node,window.prerenderNode);}window.$world.dontRecordChangesWhile(function(){var obj=deserialize(snapshot,{reinitializeIds:function reinitializeIds(id){return id;}});if(obj.isWorld){obj.position=pt(0,0);MorphicEnv["default"]().setWorldRenderedOn(obj,node,window.prerenderNode);obj.resizePolicy==='elastic'&&obj.execCommand("resize to fit window");}else{try{if(node!=document.body){var observer=new window.ResizeObserver(function(entries){return obj.execCommand('resize on client',entries[0]);});observer.observe(node);}else{window.onresize=lively.FreezerRuntime.resizeHandler=function(){return obj.execCommand('resize on client');};}obj.openInWorld(pt(0,0));obj.execCommand('resize on client',node);}catch(err){obj.position=pt(0,0);}}});case 3:case"end":return _context235.stop();}}},_callee235);}));return _renderFrozenPart.apply(this,arguments);}}};});System.register("2",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./index-602cf476.js'],function(){'use strict';return{setters:[function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){}};});System.register("3",['./__root_module__-5782ff42.js'],function(){'use strict';var Morph,touchInputDevice,num,once,pt,initializeClass,HTMLMorph,string,Color;return{setters:[function(module){Morph=module.M;touchInputDevice=module.t;num=module.n;once=module.o;pt=module.p;initializeClass=module.i;HTMLMorph=module.H;string=module.s;Color=module.C;}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("TiltingTile/index.js");__varRecorder__.Morph=Morph;__varRecorder__.touchInputDevice=touchInputDevice;__varRecorder__.num=num;__varRecorder__.once=once;__varRecorder__.pt=pt;var TiltingTile=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TiltingTile/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TiltingTile")&&typeof __lively_classholder__.TiltingTile==="function"?__lively_classholder__.TiltingTile:__lively_classholder__.TiltingTile=function TiltingTile(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayout",value:function TiltingTile_relayout_(){var perspectiveTile=this.submorphs[0];perspectiveTile.center=this.innerBounds().center();if(this.isMobile){perspectiveTile.extent=this.extent;perspectiveTile.submorphs.forEach(function(m){m.extent=perspectiveTile.extent;m.center=__varRecorder__.pt(0,0);});}}},{key:"getTiltAndFlip",value:function TiltingTile_getTiltAndFlip_(evt){var relPos=evt.positionIn(this);return{center:this.innerBounds().center(),tilted:__varRecorder__.num.interpolate(relPos.y/this.height,0.05,-0.05),flipped:__varRecorder__.num.interpolate(relPos.x/this.width,-0.05,0.05)};}},{key:"onMouseMove",value:function TiltingTile_onMouseMove_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseMove",this).call(this,evt);if(this.tiltOnHover)Object.assign(this.submorphs[0],this.getTiltAndFlip(evt));}},{key:"onMouseDown",value:function TiltingTile_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);if(__varRecorder__.touchInputDevice)return;if(this.projectInfo)this.get("project detail tile").display(true,this);}},{key:"onMouseUp",value:function TiltingTile_onMouseUp_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseUp",this).call(this,evt);if(__varRecorder__.touchInputDevice&&this.projectInfo){this.get("project detail tile").display(true,this);}}},{key:"onHoverIn",value:function TiltingTile_onHoverIn_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onHoverIn",this).call(this,evt);this.tiltOnHover&&this.submorphs[0].animate(Object.assign({},this.getTiltAndFlip(evt),{duration:300}));var title=this.getSubmorphNamed("tile title");var video=this.getSubmorphNamed("tile video");title&&title.animate({opacity:1,duration:300});video&&video.animate({opacity:0,duration:300});}},{key:"onHoverOut",value:function TiltingTile_onHoverOut_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onHoverOut",this).call(this,evt);this.tiltOnHover&&this.submorphs[0].animate({tilted:0,flipped:0,duration:300});var title=this.getSubmorphNamed("tile title");var video=this.getSubmorphNamed("tile video");title&&title.animate({opacity:0,duration:300});video&&video.animate({opacity:1,duration:300});}},{key:"getColor",value:function TiltingTile_getColor_(){return this.getSubmorphNamed("perspective tile").fill;}},{key:"setColor",value:function TiltingTile_setColor_(c){return this.getSubmorphNamed("perspective tile").fill=c;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TiltingTile";}},{key:"properties",get:function get(){return{projectInfo:{},tiltOnHover:{},isMobile:{}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TiltingTile",version:"0.1.1-79"};}},{start:214,end:3513});}(__varRecorder__.Morph);TiltingTile=__varRecorder__.TiltingTile;__varRecorder__["default"]=TiltingTile;var __varRecorder__$1=lively.FreezerRuntime.recorderFor("HTMLTile/index.js");__varRecorder__$1.HTMLMorph=HTMLMorph;__varRecorder__$1.touchInputDevice=touchInputDevice;__varRecorder__$1.string=string;__varRecorder__$1.Color=Color;var HTMLTile=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("HTMLTile/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("HTMLTile")&&typeof __lively_classholder__.HTMLTile==="function"?__lively_classholder__.HTMLTile:__lively_classholder__.HTMLTile=function HTMLTile(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"getColor",value:function HTMLTile_getColor_(){return this.fill;}},{key:"onMouseDown",value:function HTMLTile_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);if(__varRecorder__$1.touchInputDevice)return;if(this.projectInfo)this.get("project detail tile").display(true,this);}},{key:"onMouseUp",value:function HTMLTile_onMouseUp_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseUp",this).call(this,evt);if(__varRecorder__$1.touchInputDevice&&this.projectInfo){this.get("project detail tile").display(true,this);}}},{key:"onMouseMove",value:function HTMLTile_onMouseMove_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseMove",this).call(this,evt);}},{key:"update",value:function HTMLTile_update_(){var s=this.videoScale||1;this.html="<div style=\"width: 100%; height: 100%;\">\n      <video\n        style=\"width: ".concat(s*100,"%; height: ").concat(this.isMobile?"auto":s*100+"%","; ").concat(this.isMobile?"transform: translate(".concat((s-1)*28,"%,").concat(s*20,"%);"):"transform: translate(".concat(s*13,"%,").concat(s*11,"%);"),"\"\n        preload=\"auto\" loop=\"loop\" muted=\"muted\" width=\"1248\" height=\"704\" ").concat(this.playing?"autoplay":"",">\n        <source src=\"").concat(this.videoUrl,"\" type=\"video/mp4; codecs=&quot;avc1.42E01E, mp4a.40.2&quot;\">\n      </video>\n      <div class=\"overlay\" style=\"background: ").concat(this.overlayColor.toString(),"; ").concat(this.isMobile?"opacity: 1; text-align: center; padding: 10px;":"","\">\n        <span>").concat(this.title.toUpperCase(),"</span>\n      <div>\n    </div>");}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"HTMLTile";}},{key:"properties",get:function get(){return{title:{},videoUrl:{},isMobile:{},overlayColor:{derived:true,get:function get(){return this.isMobile?__varRecorder__$1.Color.black.withA(0.5):this.fill;}},videoScale:{after:["playing"],set:function set(s){this.setProperty("videoScale",s);this.update();}},projectInfo:{},playing:{after:["fill"],type:"Boolean",set:function set(active){this.setProperty("playing",active);this.update();}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"HTMLTile",version:"0.1.1-88"};}},{start:175,end:2273});}(__varRecorder__$1.HTMLMorph);HTMLTile=__varRecorder__$1.HTMLTile;__varRecorder__$1["default"]=HTMLTile;}};});System.register("4",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./index-602cf476.js'],function(){'use strict';return{setters:[function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){}};});System.register("5",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./services-bc1b0444.js','./index-d275e3ad.js'],function(){'use strict';return{setters:[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){}};});System.register("6",['./__root_module__-5782ff42.js'],function(){'use strict';var HTMLMorph,resource,initializeClass;return{setters:[function(module){HTMLMorph=module.H;resource=module.r;initializeClass=module.i;}],execute:function execute(){var _global=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$1={};typeof navigator!=="undefined"&&function(root,factory){if(exports$1){exports$1=factory(root);}else{root.lottie=factory(root);root.bodymovin=root.lottie;}}(window||{},function(window){var svgNS="http://www.w3.org/2000/svg";var locationHref="";var initialDefaultFrame=-999999;var subframeEnabled=true;var expressionsPlugin;var isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);var bm_pow=Math.pow;var bm_sqrt=Math.sqrt;var bm_floor=Math.floor;var bm_max=Math.max;var bm_min=Math.min;var BMMath={};(function(){var propertyNames=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"];var i,len=propertyNames.length;for(i=0;i<len;i+=1){BMMath[propertyNames[i]]=Math[propertyNames[i]];}})();function ProjectInterface(){return{};}BMMath.random=Math.random;BMMath.abs=function(val){var tOfVal=_typeof2(val);if(tOfVal==="object"&&val.length){var absArr=createSizedArray(val.length);var i,len=val.length;for(i=0;i<len;i+=1){absArr[i]=Math.abs(val[i]);}return absArr;}return Math.abs(val);};var defaultCurveSegments=150;var degToRads=Math.PI/180;var roundCorner=0.5519;function styleDiv(element){element.style.position="absolute";element.style.top=0;element.style.left=0;element.style.display="block";element.style.transformOrigin=element.style.webkitTransformOrigin="0 0";element.style.backfaceVisibility=element.style.webkitBackfaceVisibility="visible";element.style.transformStyle=element.style.webkitTransformStyle=element.style.mozTransformStyle="preserve-3d";}function BMEnterFrameEvent(type,currentTime,totalTime,frameMultiplier){(this||_global).type=type;(this||_global).currentTime=currentTime;(this||_global).totalTime=totalTime;(this||_global).direction=frameMultiplier<0?-1:1;}function BMCompleteEvent(type,frameMultiplier){(this||_global).type=type;(this||_global).direction=frameMultiplier<0?-1:1;}function BMCompleteLoopEvent(type,totalLoops,currentLoop,frameMultiplier){(this||_global).type=type;(this||_global).currentLoop=currentLoop;(this||_global).totalLoops=totalLoops;(this||_global).direction=frameMultiplier<0?-1:1;}function BMSegmentStartEvent(type,firstFrame,totalFrames){(this||_global).type=type;(this||_global).firstFrame=firstFrame;(this||_global).totalFrames=totalFrames;}function BMDestroyEvent(type,target){(this||_global).type=type;(this||_global).target=target;}function BMRenderFrameErrorEvent(nativeError,currentTime){(this||_global).type="renderFrameError";(this||_global).nativeError=nativeError;(this||_global).currentTime=currentTime;}function BMConfigErrorEvent(nativeError){(this||_global).type="configError";(this||_global).nativeError=nativeError;}var createElementID=function(){var _count=0;return function createID(){return"__lottie_element_"+ ++_count;};}();function HSVtoRGB(h,s,v){var r,g,b,i,f,p,q,t;i=Math.floor(h*6);f=h*6-i;p=v*(1-s);q=v*(1-f*s);t=v*(1-(1-f)*s);switch(i%6){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;case 5:r=v;g=p;b=q;break;}return[r,g,b];}function RGBtoHSV(r,g,b){var max=Math.max(r,g,b),min=Math.min(r,g,b),d=max-min,h,s=max===0?0:d/max,v=max/255;switch(max){case min:h=0;break;case r:h=g-b+d*(g<b?6:0);h/=6*d;break;case g:h=b-r+d*2;h/=6*d;break;case b:h=r-g+d*4;h/=6*d;break;}return[h,s,v];}function addSaturationToRGB(color,offset){var hsv=RGBtoHSV(color[0]*255,color[1]*255,color[2]*255);hsv[1]+=offset;if(hsv[1]>1){hsv[1]=1;}else if(hsv[1]<=0){hsv[1]=0;}return HSVtoRGB(hsv[0],hsv[1],hsv[2]);}function addBrightnessToRGB(color,offset){var hsv=RGBtoHSV(color[0]*255,color[1]*255,color[2]*255);hsv[2]+=offset;if(hsv[2]>1){hsv[2]=1;}else if(hsv[2]<0){hsv[2]=0;}return HSVtoRGB(hsv[0],hsv[1],hsv[2]);}function addHueToRGB(color,offset){var hsv=RGBtoHSV(color[0]*255,color[1]*255,color[2]*255);hsv[0]+=offset/360;if(hsv[0]>1){hsv[0]-=1;}else if(hsv[0]<0){hsv[0]+=1;}return HSVtoRGB(hsv[0],hsv[1],hsv[2]);}var rgbToHex=function(){var colorMap=[];var i;var hex;for(i=0;i<256;i+=1){hex=i.toString(16);colorMap[i]=hex.length==1?"0"+hex:hex;}return function(r,g,b){if(r<0){r=0;}if(g<0){g=0;}if(b<0){b=0;}return"#"+colorMap[r]+colorMap[g]+colorMap[b];};}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function triggerEvent(eventName,args){if((this||_global)._cbs[eventName]){var len=(this||_global)._cbs[eventName].length;for(var i=0;i<len;i++){(this||_global)._cbs[eventName][i](args);}}},addEventListener:function addEventListener(eventName,callback){if(!(this||_global)._cbs[eventName]){(this||_global)._cbs[eventName]=[];}(this||_global)._cbs[eventName].push(callback);return function(){this.removeEventListener(eventName,callback);}.bind(this||_global);},removeEventListener:function removeEventListener(eventName,callback){if(!callback){(this||_global)._cbs[eventName]=null;}else if((this||_global)._cbs[eventName]){var i=0,len=(this||_global)._cbs[eventName].length;while(i<len){if((this||_global)._cbs[eventName][i]===callback){(this||_global)._cbs[eventName].splice(i,1);i-=1;len-=1;}i+=1;}if(!(this||_global)._cbs[eventName].length){(this||_global)._cbs[eventName]=null;}}}};var createTypedArray=function(){function createRegularArray(type,len){var i=0,arr=[],value;switch(type){case"int16":case"uint8c":value=1;break;default:value=1.1;break;}for(i=0;i<len;i+=1){arr.push(value);}return arr;}function createTypedArray(type,len){if(type==="float32"){return new Float32Array(len);}else if(type==="int16"){return new Int16Array(len);}else if(type==="uint8c"){return new Uint8ClampedArray(len);}}if(typeof Uint8ClampedArray==="function"&&typeof Float32Array==="function"){return createTypedArray;}else{return createRegularArray;}}();function createSizedArray(len){return Array.apply(null,{length:len});}function createNS(type){//return {appendChild:function(){},setAttribute:function(){},style:{}}
return document.createElementNS(svgNS,type);}function createTag(type){//return {appendChild:function(){},setAttribute:function(){},style:{}}
return document.createElement(type);}function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function addDynamicProperty(prop){if((this||_global).dynamicProperties.indexOf(prop)===-1){(this||_global).dynamicProperties.push(prop);(this||_global).container.addDynamicProperty(this||_global);(this||_global)._isAnimated=true;}},iterateDynamicProperties:function iterateDynamicProperties(){(this||_global)._mdf=false;var i,len=(this||_global).dynamicProperties.length;for(i=0;i<len;i+=1){(this||_global).dynamicProperties[i].getValue();if((this||_global).dynamicProperties[i]._mdf){(this||_global)._mdf=true;}}},initDynamicPropertyContainer:function initDynamicPropertyContainer(container){(this||_global).container=container;(this||_global).dynamicProperties=[];(this||_global)._mdf=false;(this||_global)._isAnimated=false;}};var getBlendMode=function(){var blendModeEnums={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(mode){return blendModeEnums[mode]||"";};}();/*!
         Transformation Matrix v2.0
         (c) Epistemex 2014-2015
         www.epistemex.com
         By Ken Fyrstenberg
         Contributions by leeoniya.
         License: MIT, header required.
         */ /**
         * 2D transformation matrix object initialized with identity matrix.
         *
         * The matrix can synchronize a canvas context by supplying the context
         * as an argument, or later apply current absolute transform to an
         * existing context.
         *
         * All values are handled as floating point values.
         *
         * @param {CanvasRenderingContext2D} [context] - Optional context to sync with Matrix
         * @prop {number} a - scale x
         * @prop {number} b - shear y
         * @prop {number} c - shear x
         * @prop {number} d - scale y
         * @prop {number} e - translate x
         * @prop {number} f - translate y
         * @prop {CanvasRenderingContext2D|null} [context=null] - set or get current canvas context
         * @constructor
         */var Matrix=function(){var _cos=Math.cos;var _sin=Math.sin;var _tan=Math.tan;var _rnd=Math.round;function reset(){(this||_global).props[0]=1;(this||_global).props[1]=0;(this||_global).props[2]=0;(this||_global).props[3]=0;(this||_global).props[4]=0;(this||_global).props[5]=1;(this||_global).props[6]=0;(this||_global).props[7]=0;(this||_global).props[8]=0;(this||_global).props[9]=0;(this||_global).props[10]=1;(this||_global).props[11]=0;(this||_global).props[12]=0;(this||_global).props[13]=0;(this||_global).props[14]=0;(this||_global).props[15]=1;return this||_global;}function rotate(angle){if(angle===0){return this||_global;}var mCos=_cos(angle);var mSin=_sin(angle);return this._t(mCos,-mSin,0,0,mSin,mCos,0,0,0,0,1,0,0,0,0,1);}function rotateX(angle){if(angle===0){return this||_global;}var mCos=_cos(angle);var mSin=_sin(angle);return this._t(1,0,0,0,0,mCos,-mSin,0,0,mSin,mCos,0,0,0,0,1);}function rotateY(angle){if(angle===0){return this||_global;}var mCos=_cos(angle);var mSin=_sin(angle);return this._t(mCos,0,mSin,0,0,1,0,0,-mSin,0,mCos,0,0,0,0,1);}function rotateZ(angle){if(angle===0){return this||_global;}var mCos=_cos(angle);var mSin=_sin(angle);return this._t(mCos,-mSin,0,0,mSin,mCos,0,0,0,0,1,0,0,0,0,1);}function shear(sx,sy){return this._t(1,sy,sx,1,0,0);}function skew(ax,ay){return this.shear(_tan(ax),_tan(ay));}function skewFromAxis(ax,angle){var mCos=_cos(angle);var mSin=_sin(angle);return this._t(mCos,mSin,0,0,-mSin,mCos,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,_tan(ax),1,0,0,0,0,1,0,0,0,0,1)._t(mCos,-mSin,0,0,mSin,mCos,0,0,0,0,1,0,0,0,0,1);//return this._t(mCos, mSin, -mSin, mCos, 0, 0)._t(1, 0, _tan(ax), 1, 0, 0)._t(mCos, -mSin, mSin, mCos, 0, 0);
}function scale(sx,sy,sz){if(!sz&&sz!==0){sz=1;}if(sx===1&&sy===1&&sz===1){return this||_global;}return this._t(sx,0,0,0,0,sy,0,0,0,0,sz,0,0,0,0,1);}function setTransform(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){(this||_global).props[0]=a;(this||_global).props[1]=b;(this||_global).props[2]=c;(this||_global).props[3]=d;(this||_global).props[4]=e;(this||_global).props[5]=f;(this||_global).props[6]=g;(this||_global).props[7]=h;(this||_global).props[8]=i;(this||_global).props[9]=j;(this||_global).props[10]=k;(this||_global).props[11]=l;(this||_global).props[12]=m;(this||_global).props[13]=n;(this||_global).props[14]=o;(this||_global).props[15]=p;return this||_global;}function translate(tx,ty,tz){tz=tz||0;if(tx!==0||ty!==0||tz!==0){return this._t(1,0,0,0,0,1,0,0,0,0,1,0,tx,ty,tz,1);}return this||_global;}function transform(a2,b2,c2,d2,e2,f2,g2,h2,i2,j2,k2,l2,m2,n2,o2,p2){var _p=(this||_global).props;if(a2===1&&b2===0&&c2===0&&d2===0&&e2===0&&f2===1&&g2===0&&h2===0&&i2===0&&j2===0&&k2===1&&l2===0){//NOTE: commenting this condition because TurboFan deoptimizes code when present
//if(m2 !== 0 || n2 !== 0 || o2 !== 0){
_p[12]=_p[12]*a2+_p[15]*m2;_p[13]=_p[13]*f2+_p[15]*n2;_p[14]=_p[14]*k2+_p[15]*o2;_p[15]=_p[15]*p2;//}
(this||_global)._identityCalculated=false;return this||_global;}var a1=_p[0];var b1=_p[1];var c1=_p[2];var d1=_p[3];var e1=_p[4];var f1=_p[5];var g1=_p[6];var h1=_p[7];var i1=_p[8];var j1=_p[9];var k1=_p[10];var l1=_p[11];var m1=_p[12];var n1=_p[13];var o1=_p[14];var p1=_p[15];/* matrix order (canvas compatible):
             * ace
             * bdf
             * 001
             */_p[0]=a1*a2+b1*e2+c1*i2+d1*m2;_p[1]=a1*b2+b1*f2+c1*j2+d1*n2;_p[2]=a1*c2+b1*g2+c1*k2+d1*o2;_p[3]=a1*d2+b1*h2+c1*l2+d1*p2;_p[4]=e1*a2+f1*e2+g1*i2+h1*m2;_p[5]=e1*b2+f1*f2+g1*j2+h1*n2;_p[6]=e1*c2+f1*g2+g1*k2+h1*o2;_p[7]=e1*d2+f1*h2+g1*l2+h1*p2;_p[8]=i1*a2+j1*e2+k1*i2+l1*m2;_p[9]=i1*b2+j1*f2+k1*j2+l1*n2;_p[10]=i1*c2+j1*g2+k1*k2+l1*o2;_p[11]=i1*d2+j1*h2+k1*l2+l1*p2;_p[12]=m1*a2+n1*e2+o1*i2+p1*m2;_p[13]=m1*b2+n1*f2+o1*j2+p1*n2;_p[14]=m1*c2+n1*g2+o1*k2+p1*o2;_p[15]=m1*d2+n1*h2+o1*l2+p1*p2;(this||_global)._identityCalculated=false;return this||_global;}function isIdentity(){if(!(this||_global)._identityCalculated){(this||_global)._identity=!((this||_global).props[0]!==1||(this||_global).props[1]!==0||(this||_global).props[2]!==0||(this||_global).props[3]!==0||(this||_global).props[4]!==0||(this||_global).props[5]!==1||(this||_global).props[6]!==0||(this||_global).props[7]!==0||(this||_global).props[8]!==0||(this||_global).props[9]!==0||(this||_global).props[10]!==1||(this||_global).props[11]!==0||(this||_global).props[12]!==0||(this||_global).props[13]!==0||(this||_global).props[14]!==0||(this||_global).props[15]!==1);(this||_global)._identityCalculated=true;}return(this||_global)._identity;}function equals(matr){var i=0;while(i<16){if(matr.props[i]!==(this||_global).props[i]){return false;}i+=1;}return true;}function clone(matr){var i;for(i=0;i<16;i+=1){matr.props[i]=(this||_global).props[i];}return matr;}function cloneFromProps(props){var i;for(i=0;i<16;i+=1){(this||_global).props[i]=props[i];}}function applyToPoint(x,y,z){return{x:x*(this||_global).props[0]+y*(this||_global).props[4]+z*(this||_global).props[8]+(this||_global).props[12],y:x*(this||_global).props[1]+y*(this||_global).props[5]+z*(this||_global).props[9]+(this||_global).props[13],z:x*(this||_global).props[2]+y*(this||_global).props[6]+z*(this||_global).props[10]+(this||_global).props[14]};/*return {
             x: x * me.a + y * me.c + me.e,
             y: x * me.b + y * me.d + me.f
             };*/}function applyToX(x,y,z){return x*(this||_global).props[0]+y*(this||_global).props[4]+z*(this||_global).props[8]+(this||_global).props[12];}function applyToY(x,y,z){return x*(this||_global).props[1]+y*(this||_global).props[5]+z*(this||_global).props[9]+(this||_global).props[13];}function applyToZ(x,y,z){return x*(this||_global).props[2]+y*(this||_global).props[6]+z*(this||_global).props[10]+(this||_global).props[14];}function getInverseMatrix(){var determinant=(this||_global).props[0]*(this||_global).props[5]-(this||_global).props[1]*(this||_global).props[4];var a=(this||_global).props[5]/determinant;var b=-(this||_global).props[1]/determinant;var c=-(this||_global).props[4]/determinant;var d=(this||_global).props[0]/determinant;var e=((this||_global).props[4]*(this||_global).props[13]-(this||_global).props[5]*(this||_global).props[12])/determinant;var f=-((this||_global).props[0]*(this||_global).props[13]-(this||_global).props[1]*(this||_global).props[12])/determinant;var inverseMatrix=new Matrix();inverseMatrix.props[0]=a;inverseMatrix.props[1]=b;inverseMatrix.props[4]=c;inverseMatrix.props[5]=d;inverseMatrix.props[12]=e;inverseMatrix.props[13]=f;return inverseMatrix;}function inversePoint(pt){var inverseMatrix=this.getInverseMatrix();return inverseMatrix.applyToPointArray(pt[0],pt[1],pt[2]||0);}function inversePoints(pts){var i,len=pts.length,retPts=[];for(i=0;i<len;i+=1){retPts[i]=inversePoint(pts[i]);}return retPts;}function applyToTriplePoints(pt1,pt2,pt3){var arr=createTypedArray("float32",6);if(this.isIdentity()){arr[0]=pt1[0];arr[1]=pt1[1];arr[2]=pt2[0];arr[3]=pt2[1];arr[4]=pt3[0];arr[5]=pt3[1];}else{var p0=(this||_global).props[0],p1=(this||_global).props[1],p4=(this||_global).props[4],p5=(this||_global).props[5],p12=(this||_global).props[12],p13=(this||_global).props[13];arr[0]=pt1[0]*p0+pt1[1]*p4+p12;arr[1]=pt1[0]*p1+pt1[1]*p5+p13;arr[2]=pt2[0]*p0+pt2[1]*p4+p12;arr[3]=pt2[0]*p1+pt2[1]*p5+p13;arr[4]=pt3[0]*p0+pt3[1]*p4+p12;arr[5]=pt3[0]*p1+pt3[1]*p5+p13;}return arr;}function applyToPointArray(x,y,z){var arr;if(this.isIdentity()){arr=[x,y,z];}else{arr=[x*(this||_global).props[0]+y*(this||_global).props[4]+z*(this||_global).props[8]+(this||_global).props[12],x*(this||_global).props[1]+y*(this||_global).props[5]+z*(this||_global).props[9]+(this||_global).props[13],x*(this||_global).props[2]+y*(this||_global).props[6]+z*(this||_global).props[10]+(this||_global).props[14]];}return arr;}function applyToPointStringified(x,y){if(this.isIdentity()){return x+","+y;}var _p=(this||_global).props;return Math.round((x*_p[0]+y*_p[4]+_p[12])*100)/100+","+Math.round((x*_p[1]+y*_p[5]+_p[13])*100)/100;}function toCSS(){//Doesn't make much sense to add this optimization. If it is an identity matrix, it's very likely this will get called only once since it won't be keyframed.
/*if(this.isIdentity()) {
                return '';
            }*/var i=0;var props=(this||_global).props;var cssValue="matrix3d(";var v=10000;while(i<16){cssValue+=_rnd(props[i]*v)/v;cssValue+=i===15?")":",";i+=1;}return cssValue;}function roundMatrixProperty(val){var v=10000;if(val<0.000001&&val>0||val>-0.000001&&val<0){return _rnd(val*v)/v;}return val;}function to2dCSS(){//Doesn't make much sense to add this optimization. If it is an identity matrix, it's very likely this will get called only once since it won't be keyframed.
/*if(this.isIdentity()) {
                return '';
            }*/var props=(this||_global).props;var _a=roundMatrixProperty(props[0]);var _b=roundMatrixProperty(props[1]);var _c=roundMatrixProperty(props[4]);var _d=roundMatrixProperty(props[5]);var _e=roundMatrixProperty(props[12]);var _f=roundMatrixProperty(props[13]);return"matrix("+_a+","+_b+","+_c+","+_d+","+_e+","+_f+")";}return function(){(this||_global).reset=reset;(this||_global).rotate=rotate;(this||_global).rotateX=rotateX;(this||_global).rotateY=rotateY;(this||_global).rotateZ=rotateZ;(this||_global).skew=skew;(this||_global).skewFromAxis=skewFromAxis;(this||_global).shear=shear;(this||_global).scale=scale;(this||_global).setTransform=setTransform;(this||_global).translate=translate;(this||_global).transform=transform;(this||_global).applyToPoint=applyToPoint;(this||_global).applyToX=applyToX;(this||_global).applyToY=applyToY;(this||_global).applyToZ=applyToZ;(this||_global).applyToPointArray=applyToPointArray;(this||_global).applyToTriplePoints=applyToTriplePoints;(this||_global).applyToPointStringified=applyToPointStringified;(this||_global).toCSS=toCSS;(this||_global).to2dCSS=to2dCSS;(this||_global).clone=clone;(this||_global).cloneFromProps=cloneFromProps;(this||_global).equals=equals;(this||_global).inversePoints=inversePoints;(this||_global).inversePoint=inversePoint;(this||_global).getInverseMatrix=getInverseMatrix;(this||_global)._t=(this||_global).transform;(this||_global).isIdentity=isIdentity;(this||_global)._identity=true;(this||_global)._identityCalculated=false;(this||_global).props=createTypedArray("float32",16);this.reset();};}();/*
         Copyright 2014 David Bau.
        
         Permission is hereby granted, free of charge, to any person obtaining
         a copy of this software and associated documentation files (the
         "Software"), to deal in the Software without restriction, including
         without limitation the rights to use, copy, modify, merge, publish,
         distribute, sublicense, and/or sell copies of the Software, and to
         permit persons to whom the Software is furnished to do so, subject to
         the following conditions:
        
         The above copyright notice and this permission notice shall be
         included in all copies or substantial portions of the Software.
        
         THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
         EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
         MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
         IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
         CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
         TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
         SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
        
         */(function(pool,math){//
// The following constants are related to IEEE 754 limits.
//
var global=this||_global,width=256,// each RC4 output is 0 <= x < 256
chunks=6,// at least six RC4 outputs for each double
digits=52,// there are 52 significant digits in a double
rngname="random",// rngname: name for Math.random and Math.seedrandom
startdenom=math.pow(width,chunks),significance=math.pow(2,digits),overflow=significance*2,mask=width-1,nodecrypto;// node.js crypto module, initialized at the bottom.
//
// seedrandom()
// This is the seedrandom function described above.
//
function seedrandom(seed,options,callback){var key=[];options=options===true?{entropy:true}:options||{};// Flatten the seed string or build one from local entropy if needed.
var shortseed=mixkey(flatten(options.entropy?[seed,tostring(pool)]:seed===null?autoseed():seed,3),key);// Use the seed to initialize an ARC4 generator.
var arc4=new ARC4(key);// This function returns a random double in [0, 1) that contains
// randomness in every bit of the mantissa of the IEEE 754 value.
var prng=function prng(){var n=arc4.g(chunks),// Start with a numerator n < 2 ^ 48
d=startdenom,//   and denominator d = 2 ^ 48.
x=0;//   and no 'extra last byte'.
while(n<significance){// Fill up all significant digits by
n=(n+x)*width;//   shifting numerator and
d*=width;//   denominator and generating a
x=arc4.g(1);//   new least-significant-byte.
}while(n>=overflow){// To avoid rounding up, before adding
n/=2;//   last byte, shift everything
d/=2;//   right using integer math until
x>>>=1;//   we have exactly the desired bits.
}return(n+x)/d;// Form the number within [0, 1).
};prng.int32=function(){return arc4.g(4)|0;};prng.quick=function(){return arc4.g(4)/4294967296;};prng["double"]=prng;// Mix the randomness into accumulated entropy.
mixkey(tostring(arc4.S),pool);// Calling convention: what to return as a function of prng, seed, is_math.
return(options.pass||callback||function(prng,seed,is_math_call,state){if(state){// Load the arc4 state from the given state if it has an S array.
if(state.S){copy(state,arc4);}// Only provide the .state method if requested via options.state.
prng.state=function(){return copy(arc4,{});};}// If called as a method of Math (Math.seedrandom()), mutate
// Math.random because that is how seedrandom.js has worked since v1.0.
if(is_math_call){math[rngname]=prng;return seed;}// Otherwise, it is a newer calling convention, so return the
// prng directly.
else return prng;})(prng,shortseed,"global"in options?options.global:(this||_global)==math,options.state);}math["seed"+rngname]=seedrandom;//
// ARC4
//
// An ARC4 implementation.  The constructor takes a key in the form of
// an array of at most (width) integers that should be 0 <= x < (width).
//
// The g(count) method returns a pseudorandom integer that concatenates
// the next (count) outputs from ARC4.  Its return value is a number x
// that is in the range 0 <= x < (width ^ count).
//
function ARC4(key){var t,keylen=key.length,me=this||_global,i=0,j=me.i=me.j=0,s=me.S=[];// The empty key [] is treated as [0].
if(!keylen){key=[keylen++];}// Set up S using the standard key scheduling algorithm.
while(i<width){s[i]=i++;}for(i=0;i<width;i++){s[i]=s[j=mask&j+key[i%keylen]+(t=s[i])];s[j]=t;}// The "g" method returns the next (count) outputs as one number.
me.g=function(count){// Using instance members instead of closure state nearly doubles speed.
var t,r=0,i=me.i,j=me.j,s=me.S;while(count--){t=s[i=mask&i+1];r=r*width+s[mask&(s[i]=s[j=mask&j+t])+(s[j]=t)];}me.i=i;me.j=j;return r;// For robust unpredictability, the function call below automatically
// discards an initial batch of values.  This is called RC4-drop[256].
// See http://google.com/search?q=rsa+fluhrer+response&btnI
};}//
// copy()
// Copies internal state of ARC4 to or from a plain object.
//
function copy(f,t){t.i=f.i;t.j=f.j;t.S=f.S.slice();return t;}//
// flatten()
// Converts an object tree to nested arrays of strings.
//
function flatten(obj,depth){var result=[],typ=_typeof2(obj),prop;if(depth&&typ=="object"){for(prop in obj){try{result.push(flatten(obj[prop],depth-1));}catch(e){}}}return result.length?result:typ=="string"?obj:obj+"\0";}//
// mixkey()
// Mixes a string seed into a key that is an array of integers, and
// returns a shortened string seed that is equivalent to the result key.
//
function mixkey(seed,key){var stringseed=seed+"",smear,j=0;while(j<stringseed.length){key[mask&j]=mask&(smear^=key[mask&j]*19)+stringseed.charCodeAt(j++);}return tostring(key);}//
// autoseed()
// Returns an object for autoseeding, using window.crypto and Node crypto
// module if available.
//
function autoseed(){try{if(nodecrypto);var out=new Uint8Array(width);(global.crypto||global.msCrypto).getRandomValues(out);return tostring(out);}catch(e){var browser=global.navigator,plugins=browser&&browser.plugins;return[+new Date(),global,plugins,global.screen,tostring(pool)];}}//
// tostring()
// Converts an array of charcodes to a string
//
function tostring(a){return String.fromCharCode.apply(0,a);}//
// When seedrandom.js is loaded, we immediately mix a few bits
// from the built-in RNG into the entropy pool.  Because we do
// not want to interfere with deterministic PRNG state later,
// seedrandom will not call math.random on its own again after
// initialization.
//
mixkey(math.random(),pool);//
// Nodejs and AMD support: export the implementation as a module using
// either convention.
//
// End anonymous scope, and pass initial values.
})([],// pool: entropy pool starts empty
BMMath// math: package containing random, pow, and seedrandom
);var BezierFactory=function(){/**
           * BezierEasing - use bezier curve for transition easing function
           * by Gatan Renaudeau 2014 - 2015  MIT License
           *
           * Credits: is based on Firefox's nsSMILKeySpline.cpp
           * Usage:
           * var spline = BezierEasing([ 0.25, 0.1, 0.25, 1.0 ])
           * spline.get(x) => returns the easing value | x must be in [0, 1] range
           *
           */var ob={};ob.getBezierEasing=getBezierEasing;var beziers={};function getBezierEasing(a,b,c,d,nm){var str=nm||("bez_"+a+"_"+b+"_"+c+"_"+d).replace(/\./g,"p");if(beziers[str]){return beziers[str];}var bezEasing=new BezierEasing([a,b,c,d]);beziers[str]=bezEasing;return bezEasing;}// These values are established by empiricism with tests (tradeoff: performance VS precision)
var NEWTON_ITERATIONS=4;var NEWTON_MIN_SLOPE=0.001;var SUBDIVISION_PRECISION=1e-7;var SUBDIVISION_MAX_ITERATIONS=10;var kSplineTableSize=11;var kSampleStepSize=1/(kSplineTableSize-1);var float32ArraySupported=typeof Float32Array==="function";function A(aA1,aA2){return 1-3*aA2+3*aA1;}function B(aA1,aA2){return 3*aA2-6*aA1;}function C(aA1){return 3*aA1;}// Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.
function calcBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT;}// Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.
function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1);}function binarySubdivide(aX,aA,aB,mX1,mX2){var currentX,currentT,i=0;do{currentT=aA+(aB-aA)/2;currentX=calcBezier(currentT,mX1,mX2)-aX;if(currentX>0){aB=currentT;}else{aA=currentT;}}while(Math.abs(currentX)>SUBDIVISION_PRECISION&&++i<SUBDIVISION_MAX_ITERATIONS);return currentT;}function newtonRaphsonIterate(aX,aGuessT,mX1,mX2){for(var i=0;i<NEWTON_ITERATIONS;++i){var currentSlope=getSlope(aGuessT,mX1,mX2);if(currentSlope===0)return aGuessT;var currentX=calcBezier(aGuessT,mX1,mX2)-aX;aGuessT-=currentX/currentSlope;}return aGuessT;}/**
           * points is an array of [ mX1, mY1, mX2, mY2 ]
           */function BezierEasing(points){(this||_global)._p=points;(this||_global)._mSampleValues=float32ArraySupported?new Float32Array(kSplineTableSize):new Array(kSplineTableSize);(this||_global)._precomputed=false;(this||_global).get=(this||_global).get.bind(this||_global);}BezierEasing.prototype={get:function get(x){var mX1=(this||_global)._p[0],mY1=(this||_global)._p[1],mX2=(this||_global)._p[2],mY2=(this||_global)._p[3];if(!(this||_global)._precomputed)this._precompute();if(mX1===mY1&&mX2===mY2)return x;// linear
// Because JavaScript number are imprecise, we should guarantee the extremes are right.
if(x===0)return 0;if(x===1)return 1;return calcBezier(this._getTForX(x),mY1,mY2);},// Private part
_precompute:function _precompute(){var mX1=(this||_global)._p[0],mY1=(this||_global)._p[1],mX2=(this||_global)._p[2],mY2=(this||_global)._p[3];(this||_global)._precomputed=true;if(mX1!==mY1||mX2!==mY2)this._calcSampleValues();},_calcSampleValues:function _calcSampleValues(){var mX1=(this||_global)._p[0],mX2=(this||_global)._p[2];for(var i=0;i<kSplineTableSize;++i){(this||_global)._mSampleValues[i]=calcBezier(i*kSampleStepSize,mX1,mX2);}},/**
             * getTForX chose the fastest heuristic to determine the percentage value precisely from a given X projection.
             */_getTForX:function _getTForX(aX){var mX1=(this||_global)._p[0],mX2=(this||_global)._p[2],mSampleValues=(this||_global)._mSampleValues;var intervalStart=0;var currentSample=1;var lastSample=kSplineTableSize-1;for(;currentSample!==lastSample&&mSampleValues[currentSample]<=aX;++currentSample){intervalStart+=kSampleStepSize;}--currentSample;// Interpolate to provide an initial guess for t
var dist=(aX-mSampleValues[currentSample])/(mSampleValues[currentSample+1]-mSampleValues[currentSample]);var guessForT=intervalStart+dist*kSampleStepSize;var initialSlope=getSlope(guessForT,mX1,mX2);if(initialSlope>=NEWTON_MIN_SLOPE){return newtonRaphsonIterate(aX,guessForT,mX1,mX2);}else if(initialSlope===0){return guessForT;}else{return binarySubdivide(aX,intervalStart,intervalStart+kSampleStepSize,mX1,mX2);}}};return ob;}();(function(){var lastTime=0;var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(id){clearTimeout(id);};})();function extendPrototype(sources,destination){var i,len=sources.length,sourcePrototype;for(i=0;i<len;i+=1){sourcePrototype=sources[i].prototype;for(var attr in sourcePrototype){if(sourcePrototype.hasOwnProperty(attr))destination.prototype[attr]=sourcePrototype[attr];}}}function getDescriptor(object,prop){return Object.getOwnPropertyDescriptor(object,prop);}function createProxyFunction(prototype){function ProxyFunction(){}ProxyFunction.prototype=prototype;return ProxyFunction;}function bezFunction(){function pointOnLine2D(x1,y1,x2,y2,x3,y3){var det1=x1*y2+y1*x3+x2*y3-x3*y2-y3*x1-x2*y1;return det1>-0.001&&det1<0.001;}function pointOnLine3D(x1,y1,z1,x2,y2,z2,x3,y3,z3){if(z1===0&&z2===0&&z3===0){return pointOnLine2D(x1,y1,x2,y2,x3,y3);}var dist1=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)+Math.pow(z2-z1,2));var dist2=Math.sqrt(Math.pow(x3-x1,2)+Math.pow(y3-y1,2)+Math.pow(z3-z1,2));var dist3=Math.sqrt(Math.pow(x3-x2,2)+Math.pow(y3-y2,2)+Math.pow(z3-z2,2));var diffDist;if(dist1>dist2){if(dist1>dist3){diffDist=dist1-dist2-dist3;}else{diffDist=dist3-dist2-dist1;}}else if(dist3>dist2){diffDist=dist3-dist2-dist1;}else{diffDist=dist2-dist1-dist3;}return diffDist>-0.0001&&diffDist<0.0001;}var getBezierLength=function(){return function(pt1,pt2,pt3,pt4){var curveSegments=defaultCurveSegments;var k;var i,len;var ptCoord,perc,addedLength=0;var ptDistance;var point=[],lastPoint=[];var lengthData=bezier_length_pool.newElement();len=pt3.length;for(k=0;k<curveSegments;k+=1){perc=k/(curveSegments-1);ptDistance=0;for(i=0;i<len;i+=1){ptCoord=bm_pow(1-perc,3)*pt1[i]+3*bm_pow(1-perc,2)*perc*pt3[i]+3*(1-perc)*bm_pow(perc,2)*pt4[i]+bm_pow(perc,3)*pt2[i];point[i]=ptCoord;if(lastPoint[i]!==null){ptDistance+=bm_pow(point[i]-lastPoint[i],2);}lastPoint[i]=point[i];}if(ptDistance){ptDistance=bm_sqrt(ptDistance);addedLength+=ptDistance;}lengthData.percents[k]=perc;lengthData.lengths[k]=addedLength;}lengthData.addedLength=addedLength;return lengthData;};}();function getSegmentsLength(shapeData){var segmentsLength=segments_length_pool.newElement();var closed=shapeData.c;var pathV=shapeData.v;var pathO=shapeData.o;var pathI=shapeData.i;var i,len=shapeData._length;var lengths=segmentsLength.lengths;var totalLength=0;for(i=0;i<len-1;i+=1){lengths[i]=getBezierLength(pathV[i],pathV[i+1],pathO[i],pathI[i+1]);totalLength+=lengths[i].addedLength;}if(closed&&len){lengths[i]=getBezierLength(pathV[i],pathV[0],pathO[i],pathI[0]);totalLength+=lengths[i].addedLength;}segmentsLength.totalLength=totalLength;return segmentsLength;}function BezierData(length){(this||_global).segmentLength=0;(this||_global).points=new Array(length);}function PointData(partial,point){(this||_global).partialLength=partial;(this||_global).point=point;}var buildBezierData=function(){var storedData={};return function(pt1,pt2,pt3,pt4){var bezierName=(pt1[0]+"_"+pt1[1]+"_"+pt2[0]+"_"+pt2[1]+"_"+pt3[0]+"_"+pt3[1]+"_"+pt4[0]+"_"+pt4[1]).replace(/\./g,"p");if(!storedData[bezierName]){var curveSegments=defaultCurveSegments;var k,i,len;var ptCoord,perc,addedLength=0;var ptDistance;var point,lastPoint=null;if(pt1.length===2&&(pt1[0]!=pt2[0]||pt1[1]!=pt2[1])&&pointOnLine2D(pt1[0],pt1[1],pt2[0],pt2[1],pt1[0]+pt3[0],pt1[1]+pt3[1])&&pointOnLine2D(pt1[0],pt1[1],pt2[0],pt2[1],pt2[0]+pt4[0],pt2[1]+pt4[1])){curveSegments=2;}var bezierData=new BezierData(curveSegments);len=pt3.length;for(k=0;k<curveSegments;k+=1){point=createSizedArray(len);perc=k/(curveSegments-1);ptDistance=0;for(i=0;i<len;i+=1){ptCoord=bm_pow(1-perc,3)*pt1[i]+3*bm_pow(1-perc,2)*perc*(pt1[i]+pt3[i])+3*(1-perc)*bm_pow(perc,2)*(pt2[i]+pt4[i])+bm_pow(perc,3)*pt2[i];point[i]=ptCoord;if(lastPoint!==null){ptDistance+=bm_pow(point[i]-lastPoint[i],2);}}ptDistance=bm_sqrt(ptDistance);addedLength+=ptDistance;bezierData.points[k]=new PointData(ptDistance,point);lastPoint=point;}bezierData.segmentLength=addedLength;storedData[bezierName]=bezierData;}return storedData[bezierName];};}();function getDistancePerc(perc,bezierData){var percents=bezierData.percents;var lengths=bezierData.lengths;var len=percents.length;var initPos=bm_floor((len-1)*perc);var lengthPos=perc*bezierData.addedLength;var lPerc=0;if(initPos===len-1||initPos===0||lengthPos===lengths[initPos]){return percents[initPos];}else{var dir=lengths[initPos]>lengthPos?-1:1;var flag=true;while(flag){if(lengths[initPos]<=lengthPos&&lengths[initPos+1]>lengthPos){lPerc=(lengthPos-lengths[initPos])/(lengths[initPos+1]-lengths[initPos]);flag=false;}else{initPos+=dir;}if(initPos<0||initPos>=len-1){//FIX for TypedArrays that don't store floating point values with enough accuracy
if(initPos===len-1){return percents[initPos];}flag=false;}}return percents[initPos]+(percents[initPos+1]-percents[initPos])*lPerc;}}function getPointInSegment(pt1,pt2,pt3,pt4,percent,bezierData){var t1=getDistancePerc(percent,bezierData);var u1=1-t1;var ptX=Math.round((u1*u1*u1*pt1[0]+(t1*u1*u1+u1*t1*u1+u1*u1*t1)*pt3[0]+(t1*t1*u1+u1*t1*t1+t1*u1*t1)*pt4[0]+t1*t1*t1*pt2[0])*1000)/1000;var ptY=Math.round((u1*u1*u1*pt1[1]+(t1*u1*u1+u1*t1*u1+u1*u1*t1)*pt3[1]+(t1*t1*u1+u1*t1*t1+t1*u1*t1)*pt4[1]+t1*t1*t1*pt2[1])*1000)/1000;return[ptX,ptY];}var bezier_segment_points=createTypedArray("float32",8);function getNewSegment(pt1,pt2,pt3,pt4,startPerc,endPerc,bezierData){startPerc=startPerc<0?0:startPerc>1?1:startPerc;var t0=getDistancePerc(startPerc,bezierData);endPerc=endPerc>1?1:endPerc;var t1=getDistancePerc(endPerc,bezierData);var i,len=pt1.length;var u0=1-t0;var u1=1-t1;var u0u0u0=u0*u0*u0;var t0u0u0_3=t0*u0*u0*3;var t0t0u0_3=t0*t0*u0*3;var t0t0t0=t0*t0*t0;//
var u0u0u1=u0*u0*u1;var t0u0u1_3=t0*u0*u1+u0*t0*u1+u0*u0*t1;var t0t0u1_3=t0*t0*u1+u0*t0*t1+t0*u0*t1;var t0t0t1=t0*t0*t1;//
var u0u1u1=u0*u1*u1;var t0u1u1_3=t0*u1*u1+u0*t1*u1+u0*u1*t1;var t0t1u1_3=t0*t1*u1+u0*t1*t1+t0*u1*t1;var t0t1t1=t0*t1*t1;//
var u1u1u1=u1*u1*u1;var t1u1u1_3=t1*u1*u1+u1*t1*u1+u1*u1*t1;var t1t1u1_3=t1*t1*u1+u1*t1*t1+t1*u1*t1;var t1t1t1=t1*t1*t1;for(i=0;i<len;i+=1){bezier_segment_points[i*4]=Math.round((u0u0u0*pt1[i]+t0u0u0_3*pt3[i]+t0t0u0_3*pt4[i]+t0t0t0*pt2[i])*1000)/1000;bezier_segment_points[i*4+1]=Math.round((u0u0u1*pt1[i]+t0u0u1_3*pt3[i]+t0t0u1_3*pt4[i]+t0t0t1*pt2[i])*1000)/1000;bezier_segment_points[i*4+2]=Math.round((u0u1u1*pt1[i]+t0u1u1_3*pt3[i]+t0t1u1_3*pt4[i]+t0t1t1*pt2[i])*1000)/1000;bezier_segment_points[i*4+3]=Math.round((u1u1u1*pt1[i]+t1u1u1_3*pt3[i]+t1t1u1_3*pt4[i]+t1t1t1*pt2[i])*1000)/1000;}return bezier_segment_points;}return{getSegmentsLength:getSegmentsLength,getNewSegment:getNewSegment,getPointInSegment:getPointInSegment,buildBezierData:buildBezierData,pointOnLine2D:pointOnLine2D,pointOnLine3D:pointOnLine3D};}var bez=bezFunction();function dataFunctionManager(){//var tCanvasHelper = createTag('canvas').getContext('2d');
function completeLayers(layers,comps,fontManager){var layerData;var i,len=layers.length;var j,jLen,k,kLen;for(i=0;i<len;i+=1){layerData=layers[i];if(!("ks"in layerData)||layerData.completed){continue;}layerData.completed=true;if(layerData.tt){layers[i-1].td=layerData.tt;}if(layerData.hasMask){var maskProps=layerData.masksProperties;jLen=maskProps.length;for(j=0;j<jLen;j+=1){if(maskProps[j].pt.k.i){convertPathsToAbsoluteValues(maskProps[j].pt.k);}else{kLen=maskProps[j].pt.k.length;for(k=0;k<kLen;k+=1){if(maskProps[j].pt.k[k].s){convertPathsToAbsoluteValues(maskProps[j].pt.k[k].s[0]);}if(maskProps[j].pt.k[k].e){convertPathsToAbsoluteValues(maskProps[j].pt.k[k].e[0]);}}}}}if(layerData.ty===0){layerData.layers=findCompLayers(layerData.refId,comps);completeLayers(layerData.layers,comps);}else if(layerData.ty===4){completeShapes(layerData.shapes);}else if(layerData.ty==5){completeText(layerData);}}}function findCompLayers(id,comps){var i=0,len=comps.length;while(i<len){if(comps[i].id===id){if(!comps[i].layers.__used){comps[i].layers.__used=true;return comps[i].layers;}return JSON.parse(JSON.stringify(comps[i].layers));}i+=1;}}function completeShapes(arr){var i,len=arr.length;var j,jLen;for(i=len-1;i>=0;i-=1){if(arr[i].ty=="sh"){if(arr[i].ks.k.i){convertPathsToAbsoluteValues(arr[i].ks.k);}else{jLen=arr[i].ks.k.length;for(j=0;j<jLen;j+=1){if(arr[i].ks.k[j].s){convertPathsToAbsoluteValues(arr[i].ks.k[j].s[0]);}if(arr[i].ks.k[j].e){convertPathsToAbsoluteValues(arr[i].ks.k[j].e[0]);}}}}else if(arr[i].ty=="gr"){completeShapes(arr[i].it);}}/*if(hasPaths){
                //mx: distance
                //ss: sensitivity
                //dc: decay
                arr.splice(arr.length-1,0,{
                    "ty": "ms",
                    "mx":20,
                    "ss":10,
                     "dc":0.001,
                    "maxDist":200
                });
            }*/}function convertPathsToAbsoluteValues(path){var i,len=path.i.length;for(i=0;i<len;i+=1){path.i[i][0]+=path.v[i][0];path.i[i][1]+=path.v[i][1];path.o[i][0]+=path.v[i][0];path.o[i][1]+=path.v[i][1];}}function checkVersion(minimum,animVersionString){var animVersion=animVersionString?animVersionString.split("."):[100,100,100];if(minimum[0]>animVersion[0]){return true;}else if(animVersion[0]>minimum[0]){return false;}if(minimum[1]>animVersion[1]){return true;}else if(animVersion[1]>minimum[1]){return false;}if(minimum[2]>animVersion[2]){return true;}else if(animVersion[2]>minimum[2]){return false;}}var checkText=function(){var minimumVersion=[4,4,14];function updateTextLayer(textLayer){var documentData=textLayer.t.d;textLayer.t.d={k:[{s:documentData,t:0}]};}function iterateLayers(layers){var i,len=layers.length;for(i=0;i<len;i+=1){if(layers[i].ty===5){updateTextLayer(layers[i]);}}}return function(animationData){if(checkVersion(minimumVersion,animationData.v)){iterateLayers(animationData.layers);if(animationData.assets){var i,len=animationData.assets.length;for(i=0;i<len;i+=1){if(animationData.assets[i].layers){iterateLayers(animationData.assets[i].layers);}}}}};}();var checkChars=function(){var minimumVersion=[4,7,99];return function(animationData){if(animationData.chars&&!checkVersion(minimumVersion,animationData.v)){var i,len=animationData.chars.length,j,jLen;var pathData,paths;for(i=0;i<len;i+=1){if(animationData.chars[i].data&&animationData.chars[i].data.shapes){paths=animationData.chars[i].data.shapes[0].it;jLen=paths.length;for(j=0;j<jLen;j+=1){pathData=paths[j].ks.k;if(!pathData.__converted){convertPathsToAbsoluteValues(paths[j].ks.k);pathData.__converted=true;}}}}}};}();var checkColors=function(){var minimumVersion=[4,1,9];function iterateShapes(shapes){var i,len=shapes.length;var j,jLen;for(i=0;i<len;i+=1){if(shapes[i].ty==="gr"){iterateShapes(shapes[i].it);}else if(shapes[i].ty==="fl"||shapes[i].ty==="st"){if(shapes[i].c.k&&shapes[i].c.k[0].i){jLen=shapes[i].c.k.length;for(j=0;j<jLen;j+=1){if(shapes[i].c.k[j].s){shapes[i].c.k[j].s[0]/=255;shapes[i].c.k[j].s[1]/=255;shapes[i].c.k[j].s[2]/=255;shapes[i].c.k[j].s[3]/=255;}if(shapes[i].c.k[j].e){shapes[i].c.k[j].e[0]/=255;shapes[i].c.k[j].e[1]/=255;shapes[i].c.k[j].e[2]/=255;shapes[i].c.k[j].e[3]/=255;}}}else{shapes[i].c.k[0]/=255;shapes[i].c.k[1]/=255;shapes[i].c.k[2]/=255;shapes[i].c.k[3]/=255;}}}}function iterateLayers(layers){var i,len=layers.length;for(i=0;i<len;i+=1){if(layers[i].ty===4){iterateShapes(layers[i].shapes);}}}return function(animationData){if(checkVersion(minimumVersion,animationData.v)){iterateLayers(animationData.layers);if(animationData.assets){var i,len=animationData.assets.length;for(i=0;i<len;i+=1){if(animationData.assets[i].layers){iterateLayers(animationData.assets[i].layers);}}}}};}();var checkShapes=function(){var minimumVersion=[4,4,18];function completeShapes(arr){var i,len=arr.length;var j,jLen;for(i=len-1;i>=0;i-=1){if(arr[i].ty=="sh"){if(arr[i].ks.k.i){arr[i].ks.k.c=arr[i].closed;}else{jLen=arr[i].ks.k.length;for(j=0;j<jLen;j+=1){if(arr[i].ks.k[j].s){arr[i].ks.k[j].s[0].c=arr[i].closed;}if(arr[i].ks.k[j].e){arr[i].ks.k[j].e[0].c=arr[i].closed;}}}}else if(arr[i].ty=="gr"){completeShapes(arr[i].it);}}}function iterateLayers(layers){var layerData;var i,len=layers.length;var j,jLen,k,kLen;for(i=0;i<len;i+=1){layerData=layers[i];if(layerData.hasMask){var maskProps=layerData.masksProperties;jLen=maskProps.length;for(j=0;j<jLen;j+=1){if(maskProps[j].pt.k.i){maskProps[j].pt.k.c=maskProps[j].cl;}else{kLen=maskProps[j].pt.k.length;for(k=0;k<kLen;k+=1){if(maskProps[j].pt.k[k].s){maskProps[j].pt.k[k].s[0].c=maskProps[j].cl;}if(maskProps[j].pt.k[k].e){maskProps[j].pt.k[k].e[0].c=maskProps[j].cl;}}}}}if(layerData.ty===4){completeShapes(layerData.shapes);}}}return function(animationData){if(checkVersion(minimumVersion,animationData.v)){iterateLayers(animationData.layers);if(animationData.assets){var i,len=animationData.assets.length;for(i=0;i<len;i+=1){if(animationData.assets[i].layers){iterateLayers(animationData.assets[i].layers);}}}}};}();function completeData(animationData,fontManager){if(animationData.__complete){return;}checkColors(animationData);checkText(animationData);checkChars(animationData);checkShapes(animationData);completeLayers(animationData.layers,animationData.assets);animationData.__complete=true;//blitAnimation(animationData, animationData.assets, fontManager);
}function completeText(data,fontManager){if(data.t.a.length===0&&!("m"in data.t.p)){data.singleShape=true;}}var moduleOb={};moduleOb.completeData=completeData;moduleOb.checkColors=checkColors;moduleOb.checkChars=checkChars;moduleOb.checkShapes=checkShapes;moduleOb.completeLayers=completeLayers;return moduleOb;}var dataManager=dataFunctionManager();var FontManager=function(){var maxWaitingTime=5000;var emptyChar={w:0,size:0,shapes:[]};var combinedCharacters=[];//Hindi characters
combinedCharacters=combinedCharacters.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);function trimFontOptions(font){var familyArray=font.split(",");var i,len=familyArray.length;var enabledFamilies=[];for(i=0;i<len;i+=1){if(familyArray[i]!=="sans-serif"&&familyArray[i]!=="monospace"){enabledFamilies.push(familyArray[i]);}}return enabledFamilies.join(",");}function setUpNode(font,family){var parentNode=createTag("span");parentNode.style.fontFamily=family;var node=createTag("span");// Characters that vary significantly among different fonts
node.innerText="giItT1WQy@!-/#";// Visible - so we can measure it - but not on the screen
parentNode.style.position="absolute";parentNode.style.left="-10000px";parentNode.style.top="-10000px";// Large font size makes even subtle changes obvious
parentNode.style.fontSize="300px";// Reset any font properties
parentNode.style.fontVariant="normal";parentNode.style.fontStyle="normal";parentNode.style.fontWeight="normal";parentNode.style.letterSpacing="0";parentNode.appendChild(node);document.body.appendChild(parentNode);// Remember width with no applied web font
var width=node.offsetWidth;node.style.fontFamily=trimFontOptions(font)+", "+family;return{node:node,w:width,parent:parentNode};}function checkLoadedFonts(){var i,len=(this||_global).fonts.length;var node,w;var loadedCount=len;for(i=0;i<len;i+=1){if((this||_global).fonts[i].loaded){loadedCount-=1;continue;}if((this||_global).fonts[i].fOrigin==="n"||(this||_global).fonts[i].origin===0){(this||_global).fonts[i].loaded=true;}else{node=(this||_global).fonts[i].monoCase.node;w=(this||_global).fonts[i].monoCase.w;if(node.offsetWidth!==w){loadedCount-=1;(this||_global).fonts[i].loaded=true;}else{node=(this||_global).fonts[i].sansCase.node;w=(this||_global).fonts[i].sansCase.w;if(node.offsetWidth!==w){loadedCount-=1;(this||_global).fonts[i].loaded=true;}}if((this||_global).fonts[i].loaded){(this||_global).fonts[i].sansCase.parent.parentNode.removeChild((this||_global).fonts[i].sansCase.parent);(this||_global).fonts[i].monoCase.parent.parentNode.removeChild((this||_global).fonts[i].monoCase.parent);}}}if(loadedCount!==0&&Date.now()-(this||_global).initTime<maxWaitingTime){setTimeout((this||_global).checkLoadedFontsBinded,20);}else{setTimeout((this||_global).setIsLoadedBinded,10);}}function createHelper(def,fontData){var tHelper=createNS("text");tHelper.style.fontSize="100px";//tHelper.style.fontFamily = fontData.fFamily;
tHelper.setAttribute("font-family",fontData.fFamily);tHelper.setAttribute("font-style",fontData.fStyle);tHelper.setAttribute("font-weight",fontData.fWeight);tHelper.textContent="1";if(fontData.fClass){tHelper.style.fontFamily="inherit";tHelper.setAttribute("class",fontData.fClass);}else{tHelper.style.fontFamily=fontData.fFamily;}def.appendChild(tHelper);var tCanvasHelper=createTag("canvas").getContext("2d");tCanvasHelper.font=fontData.fWeight+" "+fontData.fStyle+" 100px "+fontData.fFamily;//tCanvasHelper.font = ' 100px '+ fontData.fFamily;
return tHelper;}function addFonts(fontData,defs){if(!fontData){(this||_global).isLoaded=true;return;}if((this||_global).chars){(this||_global).isLoaded=true;(this||_global).fonts=fontData.list;return;}var fontArr=fontData.list;var i,len=fontArr.length;var _pendingFonts=len;for(i=0;i<len;i+=1){var shouldLoadFont=true;var loadedSelector;var j;fontArr[i].loaded=false;fontArr[i].monoCase=setUpNode(fontArr[i].fFamily,"monospace");fontArr[i].sansCase=setUpNode(fontArr[i].fFamily,"sans-serif");if(!fontArr[i].fPath){fontArr[i].loaded=true;_pendingFonts-=1;}else if(fontArr[i].fOrigin==="p"||fontArr[i].origin===3){loadedSelector=document.querySelectorAll("style[f-forigin=\"p\"][f-family=\""+fontArr[i].fFamily+"\"], style[f-origin=\"3\"][f-family=\""+fontArr[i].fFamily+"\"]");if(loadedSelector.length>0){shouldLoadFont=false;}if(shouldLoadFont){var s=createTag("style");s.setAttribute("f-forigin",fontArr[i].fOrigin);s.setAttribute("f-origin",fontArr[i].origin);s.setAttribute("f-family",fontArr[i].fFamily);s.type="text/css";s.innerText="@font-face {"+"font-family: "+fontArr[i].fFamily+"; font-style: normal; src: url('"+fontArr[i].fPath+"');}";defs.appendChild(s);}}else if(fontArr[i].fOrigin==="g"||fontArr[i].origin===1){loadedSelector=document.querySelectorAll("link[f-forigin=\"g\"], link[f-origin=\"1\"]");for(j=0;j<loadedSelector.length;j++){if(loadedSelector[j].href.indexOf(fontArr[i].fPath)!==-1){// Font is already loaded
shouldLoadFont=false;}}if(shouldLoadFont){var l=createTag("link");l.setAttribute("f-forigin",fontArr[i].fOrigin);l.setAttribute("f-origin",fontArr[i].origin);l.type="text/css";l.rel="stylesheet";l.href=fontArr[i].fPath;document.body.appendChild(l);}}else if(fontArr[i].fOrigin==="t"||fontArr[i].origin===2){loadedSelector=document.querySelectorAll("script[f-forigin=\"t\"], script[f-origin=\"2\"]");for(j=0;j<loadedSelector.length;j++){if(fontArr[i].fPath===loadedSelector[j].src){// Font is already loaded
shouldLoadFont=false;}}if(shouldLoadFont){var sc=createTag("link");sc.setAttribute("f-forigin",fontArr[i].fOrigin);sc.setAttribute("f-origin",fontArr[i].origin);sc.setAttribute("rel","stylesheet");sc.setAttribute("href",fontArr[i].fPath);defs.appendChild(sc);}}fontArr[i].helper=createHelper(defs,fontArr[i]);fontArr[i].cache={};(this||_global).fonts.push(fontArr[i]);}if(_pendingFonts===0){(this||_global).isLoaded=true;}else{//On some cases even if the font is loaded, it won't load correctly when measuring text on canvas.
//Adding this timeout seems to fix it
setTimeout((this||_global).checkLoadedFonts.bind(this||_global),100);}}function addChars(chars){if(!chars){return;}if(!(this||_global).chars){(this||_global).chars=[];}var i,len=chars.length;var j,jLen=(this||_global).chars.length,found;for(i=0;i<len;i+=1){j=0;found=false;while(j<jLen){if((this||_global).chars[j].style===chars[i].style&&(this||_global).chars[j].fFamily===chars[i].fFamily&&(this||_global).chars[j].ch===chars[i].ch){found=true;}j+=1;}if(!found){(this||_global).chars.push(chars[i]);jLen+=1;}}}function getCharData(_char10,style,font){var i=0,len=(this||_global).chars.length;while(i<len){if((this||_global).chars[i].ch===_char10&&(this||_global).chars[i].style===style&&(this||_global).chars[i].fFamily===font){return(this||_global).chars[i];}i+=1;}if((typeof _char10==="string"&&_char10.charCodeAt(0)!==13||!_char10)&&console&&console.warn&&!(this||_global)._warned){(this||_global)._warned=true;console.warn("Missing character from exported characters list: ",_char10,style,font);}return emptyChar;}function measureText(_char11,fontName,size){var fontData=this.getFontByName(fontName);var index=_char11.charCodeAt(0);if(!fontData.cache[index+1]){var tHelper=fontData.helper;//Canvas version
//fontData.cache[index] = tHelper.measureText(char).width / 100;
//SVG version
//console.log(tHelper.getBBox().width)
if(_char11===" "){tHelper.textContent="|"+_char11+"|";var doubleSize=tHelper.getComputedTextLength();tHelper.textContent="||";var singleSize=tHelper.getComputedTextLength();fontData.cache[index+1]=(doubleSize-singleSize)/100;}else{tHelper.textContent=_char11;fontData.cache[index+1]=tHelper.getComputedTextLength()/100;}}return fontData.cache[index+1]*size;}function getFontByName(name){var i=0,len=(this||_global).fonts.length;while(i<len){if((this||_global).fonts[i].fName===name){return(this||_global).fonts[i];}i+=1;}return(this||_global).fonts[0];}function getCombinedCharacterCodes(){return combinedCharacters;}function setIsLoaded(){(this||_global).isLoaded=true;}var Font=function Font(){(this||_global).fonts=[];(this||_global).chars=null;(this||_global).typekitLoaded=0;(this||_global).isLoaded=false;(this||_global)._warned=false;(this||_global).initTime=Date.now();(this||_global).setIsLoadedBinded=(this||_global).setIsLoaded.bind(this||_global);(this||_global).checkLoadedFontsBinded=(this||_global).checkLoadedFonts.bind(this||_global);};//TODO: for now I'm adding these methods to the Class and not the prototype. Think of a better way to implement it. 
Font.getCombinedCharacterCodes=getCombinedCharacterCodes;var fontPrototype={addChars:addChars,addFonts:addFonts,getCharData:getCharData,getFontByName:getFontByName,measureText:measureText,checkLoadedFonts:checkLoadedFonts,setIsLoaded:setIsLoaded};Font.prototype=fontPrototype;return Font;}();var PropertyFactory=function(){var initFrame=initialDefaultFrame;var math_abs=Math.abs;function interpolateValue(frameNum,caching){var offsetTime=(this||_global).offsetTime;var newValue;if((this||_global).propType==="multidimensional"){newValue=createTypedArray("float32",(this||_global).pv.length);}var iterationIndex=caching.lastIndex;var i=iterationIndex;var len=(this||_global).keyframes.length-1,flag=true;var keyData,nextKeyData;while(flag){keyData=(this||_global).keyframes[i];nextKeyData=(this||_global).keyframes[i+1];if(i===len-1&&frameNum>=nextKeyData.t-offsetTime){if(keyData.h){keyData=nextKeyData;}iterationIndex=0;break;}if(nextKeyData.t-offsetTime>frameNum){iterationIndex=i;break;}if(i<len-1){i+=1;}else{iterationIndex=0;flag=false;}}var k,kLen,perc,jLen,j,fnc;var nextKeyTime=nextKeyData.t-offsetTime;var keyTime=keyData.t-offsetTime;var endValue;if(keyData.to){if(!keyData.bezierData){keyData.bezierData=bez.buildBezierData(keyData.s,nextKeyData.s||keyData.e,keyData.to,keyData.ti);}var bezierData=keyData.bezierData;if(frameNum>=nextKeyTime||frameNum<keyTime){var ind=frameNum>=nextKeyTime?bezierData.points.length-1:0;kLen=bezierData.points[ind].point.length;for(k=0;k<kLen;k+=1){newValue[k]=bezierData.points[ind].point[k];}// caching._lastKeyframeIndex = -1;
}else{if(keyData.__fnct){fnc=keyData.__fnct;}else{fnc=BezierFactory.getBezierEasing(keyData.o.x,keyData.o.y,keyData.i.x,keyData.i.y,keyData.n).get;keyData.__fnct=fnc;}perc=fnc((frameNum-keyTime)/(nextKeyTime-keyTime));var distanceInLine=bezierData.segmentLength*perc;var segmentPerc;var addedLength=caching.lastFrame<frameNum&&caching._lastKeyframeIndex===i?caching._lastAddedLength:0;j=caching.lastFrame<frameNum&&caching._lastKeyframeIndex===i?caching._lastPoint:0;flag=true;jLen=bezierData.points.length;while(flag){addedLength+=bezierData.points[j].partialLength;if(distanceInLine===0||perc===0||j===bezierData.points.length-1){kLen=bezierData.points[j].point.length;for(k=0;k<kLen;k+=1){newValue[k]=bezierData.points[j].point[k];}break;}else if(distanceInLine>=addedLength&&distanceInLine<addedLength+bezierData.points[j+1].partialLength){segmentPerc=(distanceInLine-addedLength)/bezierData.points[j+1].partialLength;kLen=bezierData.points[j].point.length;for(k=0;k<kLen;k+=1){newValue[k]=bezierData.points[j].point[k]+(bezierData.points[j+1].point[k]-bezierData.points[j].point[k])*segmentPerc;}break;}if(j<jLen-1){j+=1;}else{flag=false;}}caching._lastPoint=j;caching._lastAddedLength=addedLength-bezierData.points[j].partialLength;caching._lastKeyframeIndex=i;}}else{var outX,outY,inX,inY,keyValue;len=keyData.s.length;endValue=nextKeyData.s||keyData.e;if((this||_global).sh&&keyData.h!==1){if(frameNum>=nextKeyTime){newValue[0]=endValue[0];newValue[1]=endValue[1];newValue[2]=endValue[2];}else if(frameNum<=keyTime){newValue[0]=keyData.s[0];newValue[1]=keyData.s[1];newValue[2]=keyData.s[2];}else{var quatStart=createQuaternion(keyData.s);var quatEnd=createQuaternion(endValue);var time=(frameNum-keyTime)/(nextKeyTime-keyTime);quaternionToEuler(newValue,slerp(quatStart,quatEnd,time));}}else{for(i=0;i<len;i+=1){if(keyData.h!==1){if(frameNum>=nextKeyTime){perc=1;}else if(frameNum<keyTime){perc=0;}else{if(keyData.o.x.constructor===Array){if(!keyData.__fnct){keyData.__fnct=[];}if(!keyData.__fnct[i]){outX=typeof keyData.o.x[i]==="undefined"?keyData.o.x[0]:keyData.o.x[i];outY=typeof keyData.o.y[i]==="undefined"?keyData.o.y[0]:keyData.o.y[i];inX=typeof keyData.i.x[i]==="undefined"?keyData.i.x[0]:keyData.i.x[i];inY=typeof keyData.i.y[i]==="undefined"?keyData.i.y[0]:keyData.i.y[i];fnc=BezierFactory.getBezierEasing(outX,outY,inX,inY).get;keyData.__fnct[i]=fnc;}else{fnc=keyData.__fnct[i];}}else{if(!keyData.__fnct){outX=keyData.o.x;outY=keyData.o.y;inX=keyData.i.x;inY=keyData.i.y;fnc=BezierFactory.getBezierEasing(outX,outY,inX,inY).get;keyData.__fnct=fnc;}else{fnc=keyData.__fnct;}}perc=fnc((frameNum-keyTime)/(nextKeyTime-keyTime));}}endValue=nextKeyData.s||keyData.e;keyValue=keyData.h===1?keyData.s[i]:keyData.s[i]+(endValue[i]-keyData.s[i])*perc;if((this||_global).propType==="multidimensional"){newValue[i]=keyValue;}else{newValue=keyValue;}}}}caching.lastIndex=iterationIndex;return newValue;}//based on @Toji's https://github.com/toji/gl-matrix/
function slerp(a,b,t){var out=[];var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw;}if(1-cosom>0.000001){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom;}else{scale0=1-t;scale1=t;}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out;}function quaternionToEuler(out,quat){var qx=quat[0];var qy=quat[1];var qz=quat[2];var qw=quat[3];var heading=Math.atan2(2*qy*qw-2*qx*qz,1-2*qy*qy-2*qz*qz);var attitude=Math.asin(2*qx*qy+2*qz*qw);var bank=Math.atan2(2*qx*qw-2*qy*qz,1-2*qx*qx-2*qz*qz);out[0]=heading/degToRads;out[1]=attitude/degToRads;out[2]=bank/degToRads;}function createQuaternion(values){var heading=values[0]*degToRads;var attitude=values[1]*degToRads;var bank=values[2]*degToRads;var c1=Math.cos(heading/2);var c2=Math.cos(attitude/2);var c3=Math.cos(bank/2);var s1=Math.sin(heading/2);var s2=Math.sin(attitude/2);var s3=Math.sin(bank/2);var w=c1*c2*c3-s1*s2*s3;var x=s1*s2*c3+c1*c2*s3;var y=s1*c2*c3+c1*s2*s3;var z=c1*s2*c3-s1*c2*s3;return[x,y,z,w];}function getValueAtCurrentTime(){var frameNum=(this||_global).comp.renderedFrame-(this||_global).offsetTime;var initTime=(this||_global).keyframes[0].t-(this||_global).offsetTime;var endTime=(this||_global).keyframes[(this||_global).keyframes.length-1].t-(this||_global).offsetTime;if(!(frameNum===(this||_global)._caching.lastFrame||(this||_global)._caching.lastFrame!==initFrame&&((this||_global)._caching.lastFrame>=endTime&&frameNum>=endTime||(this||_global)._caching.lastFrame<initTime&&frameNum<initTime))){if((this||_global)._caching.lastFrame>=frameNum){(this||_global)._caching._lastKeyframeIndex=-1;(this||_global)._caching.lastIndex=0;}var renderResult=this.interpolateValue(frameNum,(this||_global)._caching);(this||_global).pv=renderResult;}(this||_global)._caching.lastFrame=frameNum;return(this||_global).pv;}function setVValue(val){var multipliedValue;if((this||_global).propType==="unidimensional"){multipliedValue=val*(this||_global).mult;if(math_abs((this||_global).v-multipliedValue)>0.00001){(this||_global).v=multipliedValue;(this||_global)._mdf=true;}}else{var i=0,len=(this||_global).v.length;while(i<len){multipliedValue=val[i]*(this||_global).mult;if(math_abs((this||_global).v[i]-multipliedValue)>0.00001){(this||_global).v[i]=multipliedValue;(this||_global)._mdf=true;}i+=1;}}}function processEffectsSequence(){if((this||_global).elem.globalData.frameId===(this||_global).frameId||!(this||_global).effectsSequence.length){return;}if((this||_global).lock){this.setVValue((this||_global).pv);return;}(this||_global).lock=true;(this||_global)._mdf=(this||_global)._isFirstFrame;var i,len=(this||_global).effectsSequence.length;var finalValue=(this||_global).kf?(this||_global).pv:(this||_global).data.k;for(i=0;i<len;i+=1){finalValue=(this||_global).effectsSequence[i](finalValue);}this.setVValue(finalValue);(this||_global)._isFirstFrame=false;(this||_global).lock=false;(this||_global).frameId=(this||_global).elem.globalData.frameId;}function addEffect(effectFunction){(this||_global).effectsSequence.push(effectFunction);(this||_global).container.addDynamicProperty(this||_global);}function ValueProperty(elem,data,mult,container){(this||_global).propType="unidimensional";(this||_global).mult=mult||1;(this||_global).data=data;(this||_global).v=mult?data.k*mult:data.k;(this||_global).pv=data.k;(this||_global)._mdf=false;(this||_global).elem=elem;(this||_global).container=container;(this||_global).comp=elem.comp;(this||_global).k=false;(this||_global).kf=false;(this||_global).vel=0;(this||_global).effectsSequence=[];(this||_global)._isFirstFrame=true;(this||_global).getValue=processEffectsSequence;(this||_global).setVValue=setVValue;(this||_global).addEffect=addEffect;}function MultiDimensionalProperty(elem,data,mult,container){(this||_global).propType="multidimensional";(this||_global).mult=mult||1;(this||_global).data=data;(this||_global)._mdf=false;(this||_global).elem=elem;(this||_global).container=container;(this||_global).comp=elem.comp;(this||_global).k=false;(this||_global).kf=false;(this||_global).frameId=-1;var i,len=data.k.length;(this||_global).v=createTypedArray("float32",len);(this||_global).pv=createTypedArray("float32",len);var arr=createTypedArray("float32",len);(this||_global).vel=createTypedArray("float32",len);for(i=0;i<len;i+=1){(this||_global).v[i]=data.k[i]*(this||_global).mult;(this||_global).pv[i]=data.k[i];}(this||_global)._isFirstFrame=true;(this||_global).effectsSequence=[];(this||_global).getValue=processEffectsSequence;(this||_global).setVValue=setVValue;(this||_global).addEffect=addEffect;}function KeyframedValueProperty(elem,data,mult,container){(this||_global).propType="unidimensional";(this||_global).keyframes=data.k;(this||_global).offsetTime=elem.data.st;(this||_global).frameId=-1;(this||_global)._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1};(this||_global).k=true;(this||_global).kf=true;(this||_global).data=data;(this||_global).mult=mult||1;(this||_global).elem=elem;(this||_global).container=container;(this||_global).comp=elem.comp;(this||_global).v=initFrame;(this||_global).pv=initFrame;(this||_global)._isFirstFrame=true;(this||_global).getValue=processEffectsSequence;(this||_global).setVValue=setVValue;(this||_global).interpolateValue=interpolateValue;(this||_global).effectsSequence=[getValueAtCurrentTime.bind(this||_global)];(this||_global).addEffect=addEffect;}function KeyframedMultidimensionalProperty(elem,data,mult,container){(this||_global).propType="multidimensional";var i,len=data.k.length;var s,e,to,ti;for(i=0;i<len-1;i+=1){if(data.k[i].to&&data.k[i].s&&data.k[i+1]&&data.k[i+1].s){s=data.k[i].s;e=data.k[i+1].s;to=data.k[i].to;ti=data.k[i].ti;if(s.length===2&&!(s[0]===e[0]&&s[1]===e[1])&&bez.pointOnLine2D(s[0],s[1],e[0],e[1],s[0]+to[0],s[1]+to[1])&&bez.pointOnLine2D(s[0],s[1],e[0],e[1],e[0]+ti[0],e[1]+ti[1])||s.length===3&&!(s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2])&&bez.pointOnLine3D(s[0],s[1],s[2],e[0],e[1],e[2],s[0]+to[0],s[1]+to[1],s[2]+to[2])&&bez.pointOnLine3D(s[0],s[1],s[2],e[0],e[1],e[2],e[0]+ti[0],e[1]+ti[1],e[2]+ti[2])){data.k[i].to=null;data.k[i].ti=null;}if(s[0]===e[0]&&s[1]===e[1]&&to[0]===0&&to[1]===0&&ti[0]===0&&ti[1]===0){if(s.length===2||s[2]===e[2]&&to[2]===0&&ti[2]===0){data.k[i].to=null;data.k[i].ti=null;}}}}(this||_global).effectsSequence=[getValueAtCurrentTime.bind(this||_global)];(this||_global).data=data;(this||_global).keyframes=data.k;(this||_global).offsetTime=elem.data.st;(this||_global).k=true;(this||_global).kf=true;(this||_global)._isFirstFrame=true;(this||_global).mult=mult||1;(this||_global).elem=elem;(this||_global).container=container;(this||_global).comp=elem.comp;(this||_global).getValue=processEffectsSequence;(this||_global).setVValue=setVValue;(this||_global).interpolateValue=interpolateValue;(this||_global).frameId=-1;var arrLen=data.k[0].s.length;(this||_global).v=createTypedArray("float32",arrLen);(this||_global).pv=createTypedArray("float32",arrLen);for(i=0;i<arrLen;i+=1){(this||_global).v[i]=initFrame;(this||_global).pv[i]=initFrame;}(this||_global)._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",arrLen)};(this||_global).addEffect=addEffect;}function getProp(elem,data,type,mult,container){var p;if(!data.k.length){p=new ValueProperty(elem,data,mult,container);}else if(typeof data.k[0]==="number"){p=new MultiDimensionalProperty(elem,data,mult,container);}else{switch(type){case 0:p=new KeyframedValueProperty(elem,data,mult,container);break;case 1:p=new KeyframedMultidimensionalProperty(elem,data,mult,container);break;}}if(p.effectsSequence.length){container.addDynamicProperty(p);}return p;}var ob={getProp:getProp};return ob;}();var TransformPropertyFactory=function(){var defaultVector=[0,0];function applyToMatrix(mat){var _mdf=(this||_global)._mdf;this.iterateDynamicProperties();(this||_global)._mdf=(this||_global)._mdf||_mdf;if((this||_global).a){mat.translate(-(this||_global).a.v[0],-(this||_global).a.v[1],(this||_global).a.v[2]);}if((this||_global).s){mat.scale((this||_global).s.v[0],(this||_global).s.v[1],(this||_global).s.v[2]);}if((this||_global).sk){mat.skewFromAxis(-(this||_global).sk.v,(this||_global).sa.v);}if((this||_global).r){mat.rotate(-(this||_global).r.v);}else{mat.rotateZ(-(this||_global).rz.v).rotateY((this||_global).ry.v).rotateX((this||_global).rx.v).rotateZ(-(this||_global).or.v[2]).rotateY((this||_global).or.v[1]).rotateX((this||_global).or.v[0]);}if((this||_global).data.p.s){if((this||_global).data.p.z){mat.translate((this||_global).px.v,(this||_global).py.v,-(this||_global).pz.v);}else{mat.translate((this||_global).px.v,(this||_global).py.v,0);}}else{mat.translate((this||_global).p.v[0],(this||_global).p.v[1],-(this||_global).p.v[2]);}}function processKeys(forceRender){if((this||_global).elem.globalData.frameId===(this||_global).frameId){return;}if((this||_global)._isDirty){this.precalculateMatrix();(this||_global)._isDirty=false;}this.iterateDynamicProperties();if((this||_global)._mdf||forceRender){(this||_global).v.cloneFromProps((this||_global).pre.props);if((this||_global).appliedTransformations<1){(this||_global).v.translate(-(this||_global).a.v[0],-(this||_global).a.v[1],(this||_global).a.v[2]);}if((this||_global).appliedTransformations<2){(this||_global).v.scale((this||_global).s.v[0],(this||_global).s.v[1],(this||_global).s.v[2]);}if((this||_global).sk&&(this||_global).appliedTransformations<3){(this||_global).v.skewFromAxis(-(this||_global).sk.v,(this||_global).sa.v);}if((this||_global).r&&(this||_global).appliedTransformations<4){(this||_global).v.rotate(-(this||_global).r.v);}else if(!(this||_global).r&&(this||_global).appliedTransformations<4){(this||_global).v.rotateZ(-(this||_global).rz.v).rotateY((this||_global).ry.v).rotateX((this||_global).rx.v).rotateZ(-(this||_global).or.v[2]).rotateY((this||_global).or.v[1]).rotateX((this||_global).or.v[0]);}if((this||_global).autoOriented){var v1,v2,frameRate=(this||_global).elem.globalData.frameRate;if((this||_global).p&&(this||_global).p.keyframes&&(this||_global).p.getValueAtTime){if((this||_global).p._caching.lastFrame+(this||_global).p.offsetTime<=(this||_global).p.keyframes[0].t){v1=(this||_global).p.getValueAtTime(((this||_global).p.keyframes[0].t+0.01)/frameRate,0);v2=(this||_global).p.getValueAtTime((this||_global).p.keyframes[0].t/frameRate,0);}else if((this||_global).p._caching.lastFrame+(this||_global).p.offsetTime>=(this||_global).p.keyframes[(this||_global).p.keyframes.length-1].t){v1=(this||_global).p.getValueAtTime((this||_global).p.keyframes[(this||_global).p.keyframes.length-1].t/frameRate,0);v2=(this||_global).p.getValueAtTime(((this||_global).p.keyframes[(this||_global).p.keyframes.length-1].t-0.05)/frameRate,0);}else{v1=(this||_global).p.pv;v2=(this||_global).p.getValueAtTime(((this||_global).p._caching.lastFrame+(this||_global).p.offsetTime-0.01)/frameRate,(this||_global).p.offsetTime);}}else if((this||_global).px&&(this||_global).px.keyframes&&(this||_global).py.keyframes&&(this||_global).px.getValueAtTime&&(this||_global).py.getValueAtTime){v1=[];v2=[];var px=(this||_global).px,py=(this||_global).py,frameRate;if(px._caching.lastFrame+px.offsetTime<=px.keyframes[0].t){v1[0]=px.getValueAtTime((px.keyframes[0].t+0.01)/frameRate,0);v1[1]=py.getValueAtTime((py.keyframes[0].t+0.01)/frameRate,0);v2[0]=px.getValueAtTime(px.keyframes[0].t/frameRate,0);v2[1]=py.getValueAtTime(py.keyframes[0].t/frameRate,0);}else if(px._caching.lastFrame+px.offsetTime>=px.keyframes[px.keyframes.length-1].t){v1[0]=px.getValueAtTime(px.keyframes[px.keyframes.length-1].t/frameRate,0);v1[1]=py.getValueAtTime(py.keyframes[py.keyframes.length-1].t/frameRate,0);v2[0]=px.getValueAtTime((px.keyframes[px.keyframes.length-1].t-0.01)/frameRate,0);v2[1]=py.getValueAtTime((py.keyframes[py.keyframes.length-1].t-0.01)/frameRate,0);}else{v1=[px.pv,py.pv];v2[0]=px.getValueAtTime((px._caching.lastFrame+px.offsetTime-0.01)/frameRate,px.offsetTime);v2[1]=py.getValueAtTime((py._caching.lastFrame+py.offsetTime-0.01)/frameRate,py.offsetTime);}}else{v1=v2=defaultVector;}(this||_global).v.rotate(-Math.atan2(v1[1]-v2[1],v1[0]-v2[0]));}if((this||_global).data.p&&(this||_global).data.p.s){if((this||_global).data.p.z){(this||_global).v.translate((this||_global).px.v,(this||_global).py.v,-(this||_global).pz.v);}else{(this||_global).v.translate((this||_global).px.v,(this||_global).py.v,0);}}else{(this||_global).v.translate((this||_global).p.v[0],(this||_global).p.v[1],-(this||_global).p.v[2]);}}(this||_global).frameId=(this||_global).elem.globalData.frameId;}function precalculateMatrix(){if(!(this||_global).a.k){(this||_global).pre.translate(-(this||_global).a.v[0],-(this||_global).a.v[1],(this||_global).a.v[2]);(this||_global).appliedTransformations=1;}else{return;}if(!(this||_global).s.effectsSequence.length){(this||_global).pre.scale((this||_global).s.v[0],(this||_global).s.v[1],(this||_global).s.v[2]);(this||_global).appliedTransformations=2;}else{return;}if((this||_global).sk){if(!(this||_global).sk.effectsSequence.length&&!(this||_global).sa.effectsSequence.length){(this||_global).pre.skewFromAxis(-(this||_global).sk.v,(this||_global).sa.v);(this||_global).appliedTransformations=3;}else{return;}}if((this||_global).r){if(!(this||_global).r.effectsSequence.length){(this||_global).pre.rotate(-(this||_global).r.v);(this||_global).appliedTransformations=4;}else{return;}}else if(!(this||_global).rz.effectsSequence.length&&!(this||_global).ry.effectsSequence.length&&!(this||_global).rx.effectsSequence.length&&!(this||_global).or.effectsSequence.length){(this||_global).pre.rotateZ(-(this||_global).rz.v).rotateY((this||_global).ry.v).rotateX((this||_global).rx.v).rotateZ(-(this||_global).or.v[2]).rotateY((this||_global).or.v[1]).rotateX((this||_global).or.v[0]);(this||_global).appliedTransformations=4;}}function autoOrient(){//
//var prevP = this.getValueAtTime();
}function addDynamicProperty(prop){this._addDynamicProperty(prop);(this||_global).elem.addDynamicProperty(prop);(this||_global)._isDirty=true;}function TransformProperty(elem,data,container){(this||_global).elem=elem;(this||_global).frameId=-1;(this||_global).propType="transform";(this||_global).data=data;(this||_global).v=new Matrix();//Precalculated matrix with non animated properties
(this||_global).pre=new Matrix();(this||_global).appliedTransformations=0;this.initDynamicPropertyContainer(container||elem);if(data.p&&data.p.s){(this||_global).px=PropertyFactory.getProp(elem,data.p.x,0,0,this||_global);(this||_global).py=PropertyFactory.getProp(elem,data.p.y,0,0,this||_global);if(data.p.z){(this||_global).pz=PropertyFactory.getProp(elem,data.p.z,0,0,this||_global);}}else{(this||_global).p=PropertyFactory.getProp(elem,data.p||{k:[0,0,0]},1,0,this||_global);}if(data.rx){(this||_global).rx=PropertyFactory.getProp(elem,data.rx,0,degToRads,this||_global);(this||_global).ry=PropertyFactory.getProp(elem,data.ry,0,degToRads,this||_global);(this||_global).rz=PropertyFactory.getProp(elem,data.rz,0,degToRads,this||_global);if(data.or.k[0].ti){var i,len=data.or.k.length;for(i=0;i<len;i+=1){data.or.k[i].to=data.or.k[i].ti=null;}}(this||_global).or=PropertyFactory.getProp(elem,data.or,1,degToRads,this||_global);//sh Indicates it needs to be capped between -180 and 180
(this||_global).or.sh=true;}else{(this||_global).r=PropertyFactory.getProp(elem,data.r||{k:0},0,degToRads,this||_global);}if(data.sk){(this||_global).sk=PropertyFactory.getProp(elem,data.sk,0,degToRads,this||_global);(this||_global).sa=PropertyFactory.getProp(elem,data.sa,0,degToRads,this||_global);}(this||_global).a=PropertyFactory.getProp(elem,data.a||{k:[0,0,0]},1,0,this||_global);(this||_global).s=PropertyFactory.getProp(elem,data.s||{k:[100,100,100]},1,0.01,this||_global);// Opacity is not part of the transform properties, that's why it won't use this.dynamicProperties. That way transforms won't get updated if opacity changes.
if(data.o){(this||_global).o=PropertyFactory.getProp(elem,data.o,0,0.01,elem);}else{(this||_global).o={_mdf:false,v:1};}(this||_global)._isDirty=true;if(!(this||_global).dynamicProperties.length){this.getValue(true);}}TransformProperty.prototype={applyToMatrix:applyToMatrix,getValue:processKeys,precalculateMatrix:precalculateMatrix,autoOrient:autoOrient};extendPrototype([DynamicPropertyContainer],TransformProperty);TransformProperty.prototype.addDynamicProperty=addDynamicProperty;TransformProperty.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function getTransformProperty(elem,data,container){return new TransformProperty(elem,data,container);}return{getTransformProperty:getTransformProperty};}();function ShapePath(){(this||_global).c=false;(this||_global)._length=0;(this||_global)._maxLength=8;(this||_global).v=createSizedArray((this||_global)._maxLength);(this||_global).o=createSizedArray((this||_global)._maxLength);(this||_global).i=createSizedArray((this||_global)._maxLength);}ShapePath.prototype.setPathData=function(closed,len){(this||_global).c=closed;this.setLength(len);var i=0;while(i<len){(this||_global).v[i]=point_pool.newElement();(this||_global).o[i]=point_pool.newElement();(this||_global).i[i]=point_pool.newElement();i+=1;}};ShapePath.prototype.setLength=function(len){while((this||_global)._maxLength<len){this.doubleArrayLength();}(this||_global)._length=len;};ShapePath.prototype.doubleArrayLength=function(){(this||_global).v=(this||_global).v.concat(createSizedArray((this||_global)._maxLength));(this||_global).i=(this||_global).i.concat(createSizedArray((this||_global)._maxLength));(this||_global).o=(this||_global).o.concat(createSizedArray((this||_global)._maxLength));(this||_global)._maxLength*=2;};ShapePath.prototype.setXYAt=function(x,y,type,pos,replace){var arr;(this||_global)._length=Math.max((this||_global)._length,pos+1);if((this||_global)._length>=(this||_global)._maxLength){this.doubleArrayLength();}switch(type){case"v":arr=(this||_global).v;break;case"i":arr=(this||_global).i;break;case"o":arr=(this||_global).o;break;}if(!arr[pos]||arr[pos]&&!replace){arr[pos]=point_pool.newElement();}arr[pos][0]=x;arr[pos][1]=y;};ShapePath.prototype.setTripleAt=function(vX,vY,oX,oY,iX,iY,pos,replace){this.setXYAt(vX,vY,"v",pos,replace);this.setXYAt(oX,oY,"o",pos,replace);this.setXYAt(iX,iY,"i",pos,replace);};ShapePath.prototype.reverse=function(){var newPath=new ShapePath();newPath.setPathData((this||_global).c,(this||_global)._length);var vertices=(this||_global).v,outPoints=(this||_global).o,inPoints=(this||_global).i;var init=0;if((this||_global).c){newPath.setTripleAt(vertices[0][0],vertices[0][1],inPoints[0][0],inPoints[0][1],outPoints[0][0],outPoints[0][1],0,false);init=1;}var cnt=(this||_global)._length-1;var len=(this||_global)._length;var i;for(i=init;i<len;i+=1){newPath.setTripleAt(vertices[cnt][0],vertices[cnt][1],inPoints[cnt][0],inPoints[cnt][1],outPoints[cnt][0],outPoints[cnt][1],i,false);cnt-=1;}return newPath;};var ShapePropertyFactory=function(){var initFrame=-999999;function interpolateShape(frameNum,previousValue,caching){var iterationIndex=caching.lastIndex;var keyPropS,keyPropE,isHold,j,k,jLen,kLen,perc,vertexValue;var kf=(this||_global).keyframes;if(frameNum<kf[0].t-(this||_global).offsetTime){keyPropS=kf[0].s[0];isHold=true;iterationIndex=0;}else if(frameNum>=kf[kf.length-1].t-(this||_global).offsetTime){keyPropS=kf[kf.length-1].s?kf[kf.length-1].s[0]:kf[kf.length-2].e[0];/*if(kf[kf.length - 1].s){
                  keyPropS = kf[kf.length - 1].s[0];
              }else{
                  keyPropS = kf[kf.length - 2].e[0];
              }*/isHold=true;}else{var i=iterationIndex;var len=kf.length-1,flag=true,keyData,nextKeyData;while(flag){keyData=kf[i];nextKeyData=kf[i+1];if(nextKeyData.t-(this||_global).offsetTime>frameNum){break;}if(i<len-1){i+=1;}else{flag=false;}}isHold=keyData.h===1;iterationIndex=i;if(!isHold){if(frameNum>=nextKeyData.t-(this||_global).offsetTime){perc=1;}else if(frameNum<keyData.t-(this||_global).offsetTime){perc=0;}else{var fnc;if(keyData.__fnct){fnc=keyData.__fnct;}else{fnc=BezierFactory.getBezierEasing(keyData.o.x,keyData.o.y,keyData.i.x,keyData.i.y).get;keyData.__fnct=fnc;}perc=fnc((frameNum-(keyData.t-(this||_global).offsetTime))/(nextKeyData.t-(this||_global).offsetTime-(keyData.t-(this||_global).offsetTime)));}keyPropE=nextKeyData.s?nextKeyData.s[0]:keyData.e[0];}keyPropS=keyData.s[0];}jLen=previousValue._length;kLen=keyPropS.i[0].length;caching.lastIndex=iterationIndex;for(j=0;j<jLen;j+=1){for(k=0;k<kLen;k+=1){vertexValue=isHold?keyPropS.i[j][k]:keyPropS.i[j][k]+(keyPropE.i[j][k]-keyPropS.i[j][k])*perc;previousValue.i[j][k]=vertexValue;vertexValue=isHold?keyPropS.o[j][k]:keyPropS.o[j][k]+(keyPropE.o[j][k]-keyPropS.o[j][k])*perc;previousValue.o[j][k]=vertexValue;vertexValue=isHold?keyPropS.v[j][k]:keyPropS.v[j][k]+(keyPropE.v[j][k]-keyPropS.v[j][k])*perc;previousValue.v[j][k]=vertexValue;}}}function interpolateShapeCurrentTime(){var frameNum=(this||_global).comp.renderedFrame-(this||_global).offsetTime;var initTime=(this||_global).keyframes[0].t-(this||_global).offsetTime;var endTime=(this||_global).keyframes[(this||_global).keyframes.length-1].t-(this||_global).offsetTime;var lastFrame=(this||_global)._caching.lastFrame;if(!(lastFrame!==initFrame&&(lastFrame<initTime&&frameNum<initTime||lastFrame>endTime&&frameNum>endTime))){////
(this||_global)._caching.lastIndex=lastFrame<frameNum?(this||_global)._caching.lastIndex:0;this.interpolateShape(frameNum,(this||_global).pv,(this||_global)._caching);////
}(this||_global)._caching.lastFrame=frameNum;return(this||_global).pv;}function resetShape(){(this||_global).paths=(this||_global).localShapeCollection;}function shapesEqual(shape1,shape2){if(shape1._length!==shape2._length||shape1.c!==shape2.c){return false;}var i,len=shape1._length;for(i=0;i<len;i+=1){if(shape1.v[i][0]!==shape2.v[i][0]||shape1.v[i][1]!==shape2.v[i][1]||shape1.o[i][0]!==shape2.o[i][0]||shape1.o[i][1]!==shape2.o[i][1]||shape1.i[i][0]!==shape2.i[i][0]||shape1.i[i][1]!==shape2.i[i][1]){return false;}}return true;}function setVValue(newPath){if(!shapesEqual((this||_global).v,newPath)){(this||_global).v=shape_pool.clone(newPath);(this||_global).localShapeCollection.releaseShapes();(this||_global).localShapeCollection.addShape((this||_global).v);(this||_global)._mdf=true;(this||_global).paths=(this||_global).localShapeCollection;}}function processEffectsSequence(){if((this||_global).elem.globalData.frameId===(this||_global).frameId){return;}else if(!(this||_global).effectsSequence.length){(this||_global)._mdf=false;return;}if((this||_global).lock){this.setVValue((this||_global).pv);return;}(this||_global).lock=true;(this||_global)._mdf=false;var finalValue=(this||_global).kf?(this||_global).pv:(this||_global).data.ks?(this||_global).data.ks.k:(this||_global).data.pt.k;var i,len=(this||_global).effectsSequence.length;for(i=0;i<len;i+=1){finalValue=(this||_global).effectsSequence[i](finalValue);}this.setVValue(finalValue);(this||_global).lock=false;(this||_global).frameId=(this||_global).elem.globalData.frameId;}function ShapeProperty(elem,data,type){(this||_global).propType="shape";(this||_global).comp=elem.comp;(this||_global).container=elem;(this||_global).elem=elem;(this||_global).data=data;(this||_global).k=false;(this||_global).kf=false;(this||_global)._mdf=false;var pathData=type===3?data.pt.k:data.ks.k;(this||_global).v=shape_pool.clone(pathData);(this||_global).pv=shape_pool.clone((this||_global).v);(this||_global).localShapeCollection=shapeCollection_pool.newShapeCollection();(this||_global).paths=(this||_global).localShapeCollection;(this||_global).paths.addShape((this||_global).v);(this||_global).reset=resetShape;(this||_global).effectsSequence=[];}function addEffect(effectFunction){(this||_global).effectsSequence.push(effectFunction);(this||_global).container.addDynamicProperty(this||_global);}ShapeProperty.prototype.interpolateShape=interpolateShape;ShapeProperty.prototype.getValue=processEffectsSequence;ShapeProperty.prototype.setVValue=setVValue;ShapeProperty.prototype.addEffect=addEffect;function KeyframedShapeProperty(elem,data,type){(this||_global).propType="shape";(this||_global).comp=elem.comp;(this||_global).elem=elem;(this||_global).container=elem;(this||_global).offsetTime=elem.data.st;(this||_global).keyframes=type===3?data.pt.k:data.ks.k;(this||_global).k=true;(this||_global).kf=true;var len=(this||_global).keyframes[0].s[0].i.length;var jLen=(this||_global).keyframes[0].s[0].i[0].length;(this||_global).v=shape_pool.newElement();(this||_global).v.setPathData((this||_global).keyframes[0].s[0].c,len);(this||_global).pv=shape_pool.clone((this||_global).v);(this||_global).localShapeCollection=shapeCollection_pool.newShapeCollection();(this||_global).paths=(this||_global).localShapeCollection;(this||_global).paths.addShape((this||_global).v);(this||_global).lastFrame=initFrame;(this||_global).reset=resetShape;(this||_global)._caching={lastFrame:initFrame,lastIndex:0};(this||_global).effectsSequence=[interpolateShapeCurrentTime.bind(this||_global)];}KeyframedShapeProperty.prototype.getValue=processEffectsSequence;KeyframedShapeProperty.prototype.interpolateShape=interpolateShape;KeyframedShapeProperty.prototype.setVValue=setVValue;KeyframedShapeProperty.prototype.addEffect=addEffect;var EllShapeProperty=function(){var cPoint=roundCorner;function EllShapeProperty(elem,data){/*this.v = {
                  v: createSizedArray(4),
                  i: createSizedArray(4),
                  o: createSizedArray(4),
                  c: true
              };*/(this||_global).v=shape_pool.newElement();(this||_global).v.setPathData(true,4);(this||_global).localShapeCollection=shapeCollection_pool.newShapeCollection();(this||_global).paths=(this||_global).localShapeCollection;(this||_global).localShapeCollection.addShape((this||_global).v);(this||_global).d=data.d;(this||_global).elem=elem;(this||_global).comp=elem.comp;(this||_global).frameId=-1;this.initDynamicPropertyContainer(elem);(this||_global).p=PropertyFactory.getProp(elem,data.p,1,0,this||_global);(this||_global).s=PropertyFactory.getProp(elem,data.s,1,0,this||_global);if((this||_global).dynamicProperties.length){(this||_global).k=true;}else{(this||_global).k=false;this.convertEllToPath();}}EllShapeProperty.prototype={reset:resetShape,getValue:function getValue(){if((this||_global).elem.globalData.frameId===(this||_global).frameId){return;}(this||_global).frameId=(this||_global).elem.globalData.frameId;this.iterateDynamicProperties();if((this||_global)._mdf){this.convertEllToPath();}},convertEllToPath:function convertEllToPath(){var p0=(this||_global).p.v[0],p1=(this||_global).p.v[1],s0=(this||_global).s.v[0]/2,s1=(this||_global).s.v[1]/2;var _cw=(this||_global).d!==3;var _v=(this||_global).v;_v.v[0][0]=p0;_v.v[0][1]=p1-s1;_v.v[1][0]=_cw?p0+s0:p0-s0;_v.v[1][1]=p1;_v.v[2][0]=p0;_v.v[2][1]=p1+s1;_v.v[3][0]=_cw?p0-s0:p0+s0;_v.v[3][1]=p1;_v.i[0][0]=_cw?p0-s0*cPoint:p0+s0*cPoint;_v.i[0][1]=p1-s1;_v.i[1][0]=_cw?p0+s0:p0-s0;_v.i[1][1]=p1-s1*cPoint;_v.i[2][0]=_cw?p0+s0*cPoint:p0-s0*cPoint;_v.i[2][1]=p1+s1;_v.i[3][0]=_cw?p0-s0:p0+s0;_v.i[3][1]=p1+s1*cPoint;_v.o[0][0]=_cw?p0+s0*cPoint:p0-s0*cPoint;_v.o[0][1]=p1-s1;_v.o[1][0]=_cw?p0+s0:p0-s0;_v.o[1][1]=p1+s1*cPoint;_v.o[2][0]=_cw?p0-s0*cPoint:p0+s0*cPoint;_v.o[2][1]=p1+s1;_v.o[3][0]=_cw?p0-s0:p0+s0;_v.o[3][1]=p1-s1*cPoint;}};extendPrototype([DynamicPropertyContainer],EllShapeProperty);return EllShapeProperty;}();var StarShapeProperty=function(){function StarShapeProperty(elem,data){(this||_global).v=shape_pool.newElement();(this||_global).v.setPathData(true,0);(this||_global).elem=elem;(this||_global).comp=elem.comp;(this||_global).data=data;(this||_global).frameId=-1;(this||_global).d=data.d;this.initDynamicPropertyContainer(elem);if(data.sy===1){(this||_global).ir=PropertyFactory.getProp(elem,data.ir,0,0,this||_global);(this||_global).is=PropertyFactory.getProp(elem,data.is,0,0.01,this||_global);(this||_global).convertToPath=(this||_global).convertStarToPath;}else{(this||_global).convertToPath=(this||_global).convertPolygonToPath;}(this||_global).pt=PropertyFactory.getProp(elem,data.pt,0,0,this||_global);(this||_global).p=PropertyFactory.getProp(elem,data.p,1,0,this||_global);(this||_global).r=PropertyFactory.getProp(elem,data.r,0,degToRads,this||_global);(this||_global).or=PropertyFactory.getProp(elem,data.or,0,0,this||_global);(this||_global).os=PropertyFactory.getProp(elem,data.os,0,0.01,this||_global);(this||_global).localShapeCollection=shapeCollection_pool.newShapeCollection();(this||_global).localShapeCollection.addShape((this||_global).v);(this||_global).paths=(this||_global).localShapeCollection;if((this||_global).dynamicProperties.length){(this||_global).k=true;}else{(this||_global).k=false;this.convertToPath();}}StarShapeProperty.prototype={reset:resetShape,getValue:function getValue(){if((this||_global).elem.globalData.frameId===(this||_global).frameId){return;}(this||_global).frameId=(this||_global).elem.globalData.frameId;this.iterateDynamicProperties();if((this||_global)._mdf){this.convertToPath();}},convertStarToPath:function convertStarToPath(){var numPts=Math.floor((this||_global).pt.v)*2;var angle=Math.PI*2/numPts;/*this.v.v.length = numPts;
                this.v.i.length = numPts;
                this.v.o.length = numPts;*/var longFlag=true;var longRad=(this||_global).or.v;var shortRad=(this||_global).ir.v;var longRound=(this||_global).os.v;var shortRound=(this||_global).is.v;var longPerimSegment=2*Math.PI*longRad/(numPts*2);var shortPerimSegment=2*Math.PI*shortRad/(numPts*2);var i,rad,roundness,perimSegment,currentAng=-Math.PI/2;currentAng+=(this||_global).r.v;var dir=(this||_global).data.d===3?-1:1;(this||_global).v._length=0;for(i=0;i<numPts;i+=1){rad=longFlag?longRad:shortRad;roundness=longFlag?longRound:shortRound;perimSegment=longFlag?longPerimSegment:shortPerimSegment;var x=rad*Math.cos(currentAng);var y=rad*Math.sin(currentAng);var ox=x===0&&y===0?0:y/Math.sqrt(x*x+y*y);var oy=x===0&&y===0?0:-x/Math.sqrt(x*x+y*y);x+=+(this||_global).p.v[0];y+=+(this||_global).p.v[1];(this||_global).v.setTripleAt(x,y,x-ox*perimSegment*roundness*dir,y-oy*perimSegment*roundness*dir,x+ox*perimSegment*roundness*dir,y+oy*perimSegment*roundness*dir,i,true);/*this.v.v[i] = [x,y];
                  this.v.i[i] = [x+ox*perimSegment*roundness*dir,y+oy*perimSegment*roundness*dir];
                  this.v.o[i] = [x-ox*perimSegment*roundness*dir,y-oy*perimSegment*roundness*dir];
                  this.v._length = numPts;*/longFlag=!longFlag;currentAng+=angle*dir;}},convertPolygonToPath:function convertPolygonToPath(){var numPts=Math.floor((this||_global).pt.v);var angle=Math.PI*2/numPts;var rad=(this||_global).or.v;var roundness=(this||_global).os.v;var perimSegment=2*Math.PI*rad/(numPts*4);var i,currentAng=-Math.PI/2;var dir=(this||_global).data.d===3?-1:1;currentAng+=(this||_global).r.v;(this||_global).v._length=0;for(i=0;i<numPts;i+=1){var x=rad*Math.cos(currentAng);var y=rad*Math.sin(currentAng);var ox=x===0&&y===0?0:y/Math.sqrt(x*x+y*y);var oy=x===0&&y===0?0:-x/Math.sqrt(x*x+y*y);x+=+(this||_global).p.v[0];y+=+(this||_global).p.v[1];(this||_global).v.setTripleAt(x,y,x-ox*perimSegment*roundness*dir,y-oy*perimSegment*roundness*dir,x+ox*perimSegment*roundness*dir,y+oy*perimSegment*roundness*dir,i,true);currentAng+=angle*dir;}(this||_global).paths.length=0;(this||_global).paths[0]=(this||_global).v;}};extendPrototype([DynamicPropertyContainer],StarShapeProperty);return StarShapeProperty;}();var RectShapeProperty=function(){function RectShapeProperty(elem,data){(this||_global).v=shape_pool.newElement();(this||_global).v.c=true;(this||_global).localShapeCollection=shapeCollection_pool.newShapeCollection();(this||_global).localShapeCollection.addShape((this||_global).v);(this||_global).paths=(this||_global).localShapeCollection;(this||_global).elem=elem;(this||_global).comp=elem.comp;(this||_global).frameId=-1;(this||_global).d=data.d;this.initDynamicPropertyContainer(elem);(this||_global).p=PropertyFactory.getProp(elem,data.p,1,0,this||_global);(this||_global).s=PropertyFactory.getProp(elem,data.s,1,0,this||_global);(this||_global).r=PropertyFactory.getProp(elem,data.r,0,0,this||_global);if((this||_global).dynamicProperties.length){(this||_global).k=true;}else{(this||_global).k=false;this.convertRectToPath();}}RectShapeProperty.prototype={convertRectToPath:function convertRectToPath(){var p0=(this||_global).p.v[0],p1=(this||_global).p.v[1],v0=(this||_global).s.v[0]/2,v1=(this||_global).s.v[1]/2;var round=bm_min(v0,v1,(this||_global).r.v);var cPoint=round*(1-roundCorner);(this||_global).v._length=0;if((this||_global).d===2||(this||_global).d===1){(this||_global).v.setTripleAt(p0+v0,p1-v1+round,p0+v0,p1-v1+round,p0+v0,p1-v1+cPoint,0,true);(this||_global).v.setTripleAt(p0+v0,p1+v1-round,p0+v0,p1+v1-cPoint,p0+v0,p1+v1-round,1,true);if(round!==0){(this||_global).v.setTripleAt(p0+v0-round,p1+v1,p0+v0-round,p1+v1,p0+v0-cPoint,p1+v1,2,true);(this||_global).v.setTripleAt(p0-v0+round,p1+v1,p0-v0+cPoint,p1+v1,p0-v0+round,p1+v1,3,true);(this||_global).v.setTripleAt(p0-v0,p1+v1-round,p0-v0,p1+v1-round,p0-v0,p1+v1-cPoint,4,true);(this||_global).v.setTripleAt(p0-v0,p1-v1+round,p0-v0,p1-v1+cPoint,p0-v0,p1-v1+round,5,true);(this||_global).v.setTripleAt(p0-v0+round,p1-v1,p0-v0+round,p1-v1,p0-v0+cPoint,p1-v1,6,true);(this||_global).v.setTripleAt(p0+v0-round,p1-v1,p0+v0-cPoint,p1-v1,p0+v0-round,p1-v1,7,true);}else{(this||_global).v.setTripleAt(p0-v0,p1+v1,p0-v0+cPoint,p1+v1,p0-v0,p1+v1,2);(this||_global).v.setTripleAt(p0-v0,p1-v1,p0-v0,p1-v1+cPoint,p0-v0,p1-v1,3);}}else{(this||_global).v.setTripleAt(p0+v0,p1-v1+round,p0+v0,p1-v1+cPoint,p0+v0,p1-v1+round,0,true);if(round!==0){(this||_global).v.setTripleAt(p0+v0-round,p1-v1,p0+v0-round,p1-v1,p0+v0-cPoint,p1-v1,1,true);(this||_global).v.setTripleAt(p0-v0+round,p1-v1,p0-v0+cPoint,p1-v1,p0-v0+round,p1-v1,2,true);(this||_global).v.setTripleAt(p0-v0,p1-v1+round,p0-v0,p1-v1+round,p0-v0,p1-v1+cPoint,3,true);(this||_global).v.setTripleAt(p0-v0,p1+v1-round,p0-v0,p1+v1-cPoint,p0-v0,p1+v1-round,4,true);(this||_global).v.setTripleAt(p0-v0+round,p1+v1,p0-v0+round,p1+v1,p0-v0+cPoint,p1+v1,5,true);(this||_global).v.setTripleAt(p0+v0-round,p1+v1,p0+v0-cPoint,p1+v1,p0+v0-round,p1+v1,6,true);(this||_global).v.setTripleAt(p0+v0,p1+v1-round,p0+v0,p1+v1-round,p0+v0,p1+v1-cPoint,7,true);}else{(this||_global).v.setTripleAt(p0-v0,p1-v1,p0-v0+cPoint,p1-v1,p0-v0,p1-v1,1,true);(this||_global).v.setTripleAt(p0-v0,p1+v1,p0-v0,p1+v1-cPoint,p0-v0,p1+v1,2,true);(this||_global).v.setTripleAt(p0+v0,p1+v1,p0+v0-cPoint,p1+v1,p0+v0,p1+v1,3,true);}}},getValue:function getValue(frameNum){if((this||_global).elem.globalData.frameId===(this||_global).frameId){return;}(this||_global).frameId=(this||_global).elem.globalData.frameId;this.iterateDynamicProperties();if((this||_global)._mdf){this.convertRectToPath();}},reset:resetShape};extendPrototype([DynamicPropertyContainer],RectShapeProperty);return RectShapeProperty;}();function getShapeProp(elem,data,type){var prop;if(type===3||type===4){var dataProp=type===3?data.pt:data.ks;var keys=dataProp.k;if(keys.length){prop=new KeyframedShapeProperty(elem,data,type);}else{prop=new ShapeProperty(elem,data,type);}}else if(type===5){prop=new RectShapeProperty(elem,data);}else if(type===6){prop=new EllShapeProperty(elem,data);}else if(type===7){prop=new StarShapeProperty(elem,data);}if(prop.k){elem.addDynamicProperty(prop);}return prop;}function getConstructorFunction(){return ShapeProperty;}function getKeyframedConstructorFunction(){return KeyframedShapeProperty;}var ob={};ob.getShapeProp=getShapeProp;ob.getConstructorFunction=getConstructorFunction;ob.getKeyframedConstructorFunction=getKeyframedConstructorFunction;return ob;}();var ShapeModifiers=function(){var ob={};var modifiers={};ob.registerModifier=registerModifier;ob.getModifier=getModifier;function registerModifier(nm,factory){if(!modifiers[nm]){modifiers[nm]=factory;}}function getModifier(nm,elem,data){return new modifiers[nm](elem,data);}return ob;}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){};ShapeModifier.prototype.addShapeToModifier=function(){};ShapeModifier.prototype.addShape=function(data){if(!(this||_global).closed){// Adding shape to dynamic properties. It covers the case where a shape has no effects applied, to reset it's _mdf state on every tick.
data.sh.container.addDynamicProperty(data.sh);var shapeData={shape:data.sh,data:data,localShapeCollection:shapeCollection_pool.newShapeCollection()};(this||_global).shapes.push(shapeData);this.addShapeToModifier(shapeData);if((this||_global)._isAnimated){data.setAsAnimated();}}};ShapeModifier.prototype.init=function(elem,data){(this||_global).shapes=[];(this||_global).elem=elem;this.initDynamicPropertyContainer(elem);this.initModifierProperties(elem,data);(this||_global).frameId=initialDefaultFrame;(this||_global).closed=false;(this||_global).k=false;if((this||_global).dynamicProperties.length){(this||_global).k=true;}else{this.getValue(true);}};ShapeModifier.prototype.processKeys=function(){if((this||_global).elem.globalData.frameId===(this||_global).frameId){return;}(this||_global).frameId=(this||_global).elem.globalData.frameId;this.iterateDynamicProperties();};extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier);TrimModifier.prototype.initModifierProperties=function(elem,data){(this||_global).s=PropertyFactory.getProp(elem,data.s,0,0.01,this||_global);(this||_global).e=PropertyFactory.getProp(elem,data.e,0,0.01,this||_global);(this||_global).o=PropertyFactory.getProp(elem,data.o,0,0,this||_global);(this||_global).sValue=0;(this||_global).eValue=0;(this||_global).getValue=(this||_global).processKeys;(this||_global).m=data.m;(this||_global)._isAnimated=!!(this||_global).s.effectsSequence.length||!!(this||_global).e.effectsSequence.length||!!(this||_global).o.effectsSequence.length;};TrimModifier.prototype.addShapeToModifier=function(shapeData){shapeData.pathsData=[];};TrimModifier.prototype.calculateShapeEdges=function(s,e,shapeLength,addedLength,totalModifierLength){var segments=[];if(e<=1){segments.push({s:s,e:e});}else if(s>=1){segments.push({s:s-1,e:e-1});}else{segments.push({s:s,e:1});segments.push({s:0,e:e-1});}var shapeSegments=[];var i,len=segments.length,segmentOb;for(i=0;i<len;i+=1){segmentOb=segments[i];if(segmentOb.e*totalModifierLength<addedLength||segmentOb.s*totalModifierLength>addedLength+shapeLength);else{var shapeS,shapeE;if(segmentOb.s*totalModifierLength<=addedLength){shapeS=0;}else{shapeS=(segmentOb.s*totalModifierLength-addedLength)/shapeLength;}if(segmentOb.e*totalModifierLength>=addedLength+shapeLength){shapeE=1;}else{shapeE=(segmentOb.e*totalModifierLength-addedLength)/shapeLength;}shapeSegments.push([shapeS,shapeE]);}}if(!shapeSegments.length){shapeSegments.push([0,0]);}return shapeSegments;};TrimModifier.prototype.releasePathsData=function(pathsData){var i,len=pathsData.length;for(i=0;i<len;i+=1){segments_length_pool.release(pathsData[i]);}pathsData.length=0;return pathsData;};TrimModifier.prototype.processShapes=function(_isFirstFrame){var s,e;if((this||_global)._mdf||_isFirstFrame){var o=(this||_global).o.v%360/360;if(o<0){o+=1;}s=((this||_global).s.v>1?1:(this||_global).s.v<0?0:(this||_global).s.v)+o;e=((this||_global).e.v>1?1:(this||_global).e.v<0?0:(this||_global).e.v)+o;if(s>e){var _s=s;s=e;e=_s;}s=Math.round(s*10000)*0.0001;e=Math.round(e*10000)*0.0001;(this||_global).sValue=s;(this||_global).eValue=e;}else{s=(this||_global).sValue;e=(this||_global).eValue;}var shapePaths;var i,len=(this||_global).shapes.length,j,jLen;var pathsData,pathData,totalShapeLength,totalModifierLength=0;if(e===s){for(i=0;i<len;i+=1){(this||_global).shapes[i].localShapeCollection.releaseShapes();(this||_global).shapes[i].shape._mdf=true;(this||_global).shapes[i].shape.paths=(this||_global).shapes[i].localShapeCollection;if((this||_global)._mdf){(this||_global).shapes[i].pathsData.length=0;}}}else if(!(e===1&&s===0||e===0&&s===1)){var segments=[],shapeData,localShapeCollection;for(i=0;i<len;i+=1){shapeData=(this||_global).shapes[i];// if shape hasn't changed and trim properties haven't changed, cached previous path can be used
if(!shapeData.shape._mdf&&!(this||_global)._mdf&&!_isFirstFrame&&(this||_global).m!==2){shapeData.shape.paths=shapeData.localShapeCollection;}else{shapePaths=shapeData.shape.paths;jLen=shapePaths._length;totalShapeLength=0;if(!shapeData.shape._mdf&&shapeData.pathsData.length){totalShapeLength=shapeData.totalShapeLength;}else{pathsData=this.releasePathsData(shapeData.pathsData);for(j=0;j<jLen;j+=1){pathData=bez.getSegmentsLength(shapePaths.shapes[j]);pathsData.push(pathData);totalShapeLength+=pathData.totalLength;}shapeData.totalShapeLength=totalShapeLength;shapeData.pathsData=pathsData;}totalModifierLength+=totalShapeLength;shapeData.shape._mdf=true;}}var shapeS=s,shapeE=e,addedLength=0,edges;for(i=len-1;i>=0;i-=1){shapeData=(this||_global).shapes[i];if(shapeData.shape._mdf){localShapeCollection=shapeData.localShapeCollection;localShapeCollection.releaseShapes();//if m === 2 means paths are trimmed individually so edges need to be found for this specific shape relative to whoel group
if((this||_global).m===2&&len>1){edges=this.calculateShapeEdges(s,e,shapeData.totalShapeLength,addedLength,totalModifierLength);addedLength+=shapeData.totalShapeLength;}else{edges=[[shapeS,shapeE]];}jLen=edges.length;for(j=0;j<jLen;j+=1){shapeS=edges[j][0];shapeE=edges[j][1];segments.length=0;if(shapeE<=1){segments.push({s:shapeData.totalShapeLength*shapeS,e:shapeData.totalShapeLength*shapeE});}else if(shapeS>=1){segments.push({s:shapeData.totalShapeLength*(shapeS-1),e:shapeData.totalShapeLength*(shapeE-1)});}else{segments.push({s:shapeData.totalShapeLength*shapeS,e:shapeData.totalShapeLength});segments.push({s:0,e:shapeData.totalShapeLength*(shapeE-1)});}var newShapesData=this.addShapes(shapeData,segments[0]);if(segments[0].s!==segments[0].e){if(segments.length>1){var lastShapeInCollection=shapeData.shape.paths.shapes[shapeData.shape.paths._length-1];if(lastShapeInCollection.c){var lastShape=newShapesData.pop();this.addPaths(newShapesData,localShapeCollection);newShapesData=this.addShapes(shapeData,segments[1],lastShape);}else{this.addPaths(newShapesData,localShapeCollection);newShapesData=this.addShapes(shapeData,segments[1]);}}this.addPaths(newShapesData,localShapeCollection);}}shapeData.shape.paths=localShapeCollection;}}}else if((this||_global)._mdf){for(i=0;i<len;i+=1){//Releasign Trim Cached paths data when no trim applied in case shapes are modified inbetween.
//Don't remove this even if it's losing cached info.
(this||_global).shapes[i].pathsData.length=0;(this||_global).shapes[i].shape._mdf=true;}}};TrimModifier.prototype.addPaths=function(newPaths,localShapeCollection){var i,len=newPaths.length;for(i=0;i<len;i+=1){localShapeCollection.addShape(newPaths[i]);}};TrimModifier.prototype.addSegment=function(pt1,pt2,pt3,pt4,shapePath,pos,newShape){shapePath.setXYAt(pt2[0],pt2[1],"o",pos);shapePath.setXYAt(pt3[0],pt3[1],"i",pos+1);if(newShape){shapePath.setXYAt(pt1[0],pt1[1],"v",pos);}shapePath.setXYAt(pt4[0],pt4[1],"v",pos+1);};TrimModifier.prototype.addSegmentFromArray=function(points,shapePath,pos,newShape){shapePath.setXYAt(points[1],points[5],"o",pos);shapePath.setXYAt(points[2],points[6],"i",pos+1);if(newShape){shapePath.setXYAt(points[0],points[4],"v",pos);}shapePath.setXYAt(points[3],points[7],"v",pos+1);};TrimModifier.prototype.addShapes=function(shapeData,shapeSegment,shapePath){var pathsData=shapeData.pathsData;var shapePaths=shapeData.shape.paths.shapes;var i,len=shapeData.shape.paths._length,j,jLen;var addedLength=0;var currentLengthData,segmentCount;var lengths;var segment;var shapes=[];var initPos;var newShape=true;if(!shapePath){shapePath=shape_pool.newElement();segmentCount=0;initPos=0;}else{segmentCount=shapePath._length;initPos=shapePath._length;}shapes.push(shapePath);for(i=0;i<len;i+=1){lengths=pathsData[i].lengths;shapePath.c=shapePaths[i].c;jLen=shapePaths[i].c?lengths.length:lengths.length+1;for(j=1;j<jLen;j+=1){currentLengthData=lengths[j-1];if(addedLength+currentLengthData.addedLength<shapeSegment.s){addedLength+=currentLengthData.addedLength;shapePath.c=false;}else if(addedLength>shapeSegment.e){shapePath.c=false;break;}else{if(shapeSegment.s<=addedLength&&shapeSegment.e>=addedLength+currentLengthData.addedLength){this.addSegment(shapePaths[i].v[j-1],shapePaths[i].o[j-1],shapePaths[i].i[j],shapePaths[i].v[j],shapePath,segmentCount,newShape);newShape=false;}else{segment=bez.getNewSegment(shapePaths[i].v[j-1],shapePaths[i].v[j],shapePaths[i].o[j-1],shapePaths[i].i[j],(shapeSegment.s-addedLength)/currentLengthData.addedLength,(shapeSegment.e-addedLength)/currentLengthData.addedLength,lengths[j-1]);this.addSegmentFromArray(segment,shapePath,segmentCount,newShape);// this.addSegment(segment.pt1, segment.pt3, segment.pt4, segment.pt2, shapePath, segmentCount, newShape);
newShape=false;shapePath.c=false;}addedLength+=currentLengthData.addedLength;segmentCount+=1;}}if(shapePaths[i].c&&lengths.length){currentLengthData=lengths[j-1];if(addedLength<=shapeSegment.e){var segmentLength=lengths[j-1].addedLength;if(shapeSegment.s<=addedLength&&shapeSegment.e>=addedLength+segmentLength){this.addSegment(shapePaths[i].v[j-1],shapePaths[i].o[j-1],shapePaths[i].i[0],shapePaths[i].v[0],shapePath,segmentCount,newShape);newShape=false;}else{segment=bez.getNewSegment(shapePaths[i].v[j-1],shapePaths[i].v[0],shapePaths[i].o[j-1],shapePaths[i].i[0],(shapeSegment.s-addedLength)/segmentLength,(shapeSegment.e-addedLength)/segmentLength,lengths[j-1]);this.addSegmentFromArray(segment,shapePath,segmentCount,newShape);// this.addSegment(segment.pt1, segment.pt3, segment.pt4, segment.pt2, shapePath, segmentCount, newShape);
newShape=false;shapePath.c=false;}}else{shapePath.c=false;}addedLength+=currentLengthData.addedLength;segmentCount+=1;}if(shapePath._length){shapePath.setXYAt(shapePath.v[initPos][0],shapePath.v[initPos][1],"i",initPos);shapePath.setXYAt(shapePath.v[shapePath._length-1][0],shapePath.v[shapePath._length-1][1],"o",shapePath._length-1);}if(addedLength>shapeSegment.e){break;}if(i<len-1){shapePath=shape_pool.newElement();newShape=true;shapes.push(shapePath);segmentCount=0;}}return shapes;};ShapeModifiers.registerModifier("tm",TrimModifier);function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier);RoundCornersModifier.prototype.initModifierProperties=function(elem,data){(this||_global).getValue=(this||_global).processKeys;(this||_global).rd=PropertyFactory.getProp(elem,data.r,0,null,this||_global);(this||_global)._isAnimated=!!(this||_global).rd.effectsSequence.length;};RoundCornersModifier.prototype.processPath=function(path,round){var cloned_path=shape_pool.newElement();cloned_path.c=path.c;var i,len=path._length;var currentV,currentI,currentO,closerV,distance,newPosPerc,index=0;var vX,vY,oX,oY,iX,iY;for(i=0;i<len;i+=1){currentV=path.v[i];currentO=path.o[i];currentI=path.i[i];if(currentV[0]===currentO[0]&&currentV[1]===currentO[1]&&currentV[0]===currentI[0]&&currentV[1]===currentI[1]){if((i===0||i===len-1)&&!path.c){cloned_path.setTripleAt(currentV[0],currentV[1],currentO[0],currentO[1],currentI[0],currentI[1],index);/*cloned_path.v[index] = currentV;
                cloned_path.o[index] = currentO;
                cloned_path.i[index] = currentI;*/index+=1;}else{if(i===0){closerV=path.v[len-1];}else{closerV=path.v[i-1];}distance=Math.sqrt(Math.pow(currentV[0]-closerV[0],2)+Math.pow(currentV[1]-closerV[1],2));newPosPerc=distance?Math.min(distance/2,round)/distance:0;vX=iX=currentV[0]+(closerV[0]-currentV[0])*newPosPerc;vY=iY=currentV[1]-(currentV[1]-closerV[1])*newPosPerc;oX=vX-(vX-currentV[0])*roundCorner;oY=vY-(vY-currentV[1])*roundCorner;cloned_path.setTripleAt(vX,vY,oX,oY,iX,iY,index);index+=1;if(i===len-1){closerV=path.v[0];}else{closerV=path.v[i+1];}distance=Math.sqrt(Math.pow(currentV[0]-closerV[0],2)+Math.pow(currentV[1]-closerV[1],2));newPosPerc=distance?Math.min(distance/2,round)/distance:0;vX=oX=currentV[0]+(closerV[0]-currentV[0])*newPosPerc;vY=oY=currentV[1]+(closerV[1]-currentV[1])*newPosPerc;iX=vX-(vX-currentV[0])*roundCorner;iY=vY-(vY-currentV[1])*roundCorner;cloned_path.setTripleAt(vX,vY,oX,oY,iX,iY,index);index+=1;}}else{cloned_path.setTripleAt(path.v[i][0],path.v[i][1],path.o[i][0],path.o[i][1],path.i[i][0],path.i[i][1],index);index+=1;}}return cloned_path;};RoundCornersModifier.prototype.processShapes=function(_isFirstFrame){var shapePaths;var i,len=(this||_global).shapes.length;var j,jLen;var rd=(this||_global).rd.v;if(rd!==0){var shapeData,newPaths,localShapeCollection;for(i=0;i<len;i+=1){shapeData=(this||_global).shapes[i];newPaths=shapeData.shape.paths;localShapeCollection=shapeData.localShapeCollection;if(!(!shapeData.shape._mdf&&!(this||_global)._mdf&&!_isFirstFrame)){localShapeCollection.releaseShapes();shapeData.shape._mdf=true;shapePaths=shapeData.shape.paths.shapes;jLen=shapeData.shape.paths._length;for(j=0;j<jLen;j+=1){localShapeCollection.addShape(this.processPath(shapePaths[j],rd));}}shapeData.shape.paths=shapeData.localShapeCollection;}}if(!(this||_global).dynamicProperties.length){(this||_global)._mdf=false;}};ShapeModifiers.registerModifier("rd",RoundCornersModifier);function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier);PuckerAndBloatModifier.prototype.initModifierProperties=function(elem,data){(this||_global).getValue=(this||_global).processKeys;(this||_global).amount=PropertyFactory.getProp(elem,data.a,0,null,this||_global);(this||_global)._isAnimated=!!(this||_global).amount.effectsSequence.length;};PuckerAndBloatModifier.prototype.processPath=function(path,amount){var percent=amount/100;var centerPoint=[0,0];var pathLength=path._length,i=0;for(i=0;i<pathLength;i+=1){centerPoint[0]+=path.v[i][0];centerPoint[1]+=path.v[i][1];}centerPoint[0]/=pathLength;centerPoint[1]/=pathLength;var cloned_path=shape_pool.newElement();cloned_path.c=path.c;var vX,vY,oX,oY,iX,iY;for(i=0;i<pathLength;i+=1){vX=path.v[i][0]+(centerPoint[0]-path.v[i][0])*percent;vY=path.v[i][1]+(centerPoint[1]-path.v[i][1])*percent;oX=path.o[i][0]+(centerPoint[0]-path.o[i][0])*-percent;oY=path.o[i][1]+(centerPoint[1]-path.o[i][1])*-percent;iX=path.i[i][0]+(centerPoint[0]-path.i[i][0])*-percent;iY=path.i[i][1]+(centerPoint[1]-path.i[i][1])*-percent;cloned_path.setTripleAt(vX,vY,oX,oY,iX,iY,i);}return cloned_path;};PuckerAndBloatModifier.prototype.processShapes=function(_isFirstFrame){var shapePaths;var i,len=(this||_global).shapes.length;var j,jLen;var amount=(this||_global).amount.v;if(amount!==0){var shapeData,newPaths,localShapeCollection;for(i=0;i<len;i+=1){shapeData=(this||_global).shapes[i];newPaths=shapeData.shape.paths;localShapeCollection=shapeData.localShapeCollection;if(!(!shapeData.shape._mdf&&!(this||_global)._mdf&&!_isFirstFrame)){localShapeCollection.releaseShapes();shapeData.shape._mdf=true;shapePaths=shapeData.shape.paths.shapes;jLen=shapeData.shape.paths._length;for(j=0;j<jLen;j+=1){localShapeCollection.addShape(this.processPath(shapePaths[j],amount));}}shapeData.shape.paths=shapeData.localShapeCollection;}}if(!(this||_global).dynamicProperties.length){(this||_global)._mdf=false;}};ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier);function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier);RepeaterModifier.prototype.initModifierProperties=function(elem,data){(this||_global).getValue=(this||_global).processKeys;(this||_global).c=PropertyFactory.getProp(elem,data.c,0,null,this||_global);(this||_global).o=PropertyFactory.getProp(elem,data.o,0,null,this||_global);(this||_global).tr=TransformPropertyFactory.getTransformProperty(elem,data.tr,this||_global);(this||_global).so=PropertyFactory.getProp(elem,data.tr.so,0,0.01,this||_global);(this||_global).eo=PropertyFactory.getProp(elem,data.tr.eo,0,0.01,this||_global);(this||_global).data=data;if(!(this||_global).dynamicProperties.length){this.getValue(true);}(this||_global)._isAnimated=!!(this||_global).dynamicProperties.length;(this||_global).pMatrix=new Matrix();(this||_global).rMatrix=new Matrix();(this||_global).sMatrix=new Matrix();(this||_global).tMatrix=new Matrix();(this||_global).matrix=new Matrix();};RepeaterModifier.prototype.applyTransforms=function(pMatrix,rMatrix,sMatrix,transform,perc,inv){var dir=inv?-1:1;var scaleX=transform.s.v[0]+(1-transform.s.v[0])*(1-perc);var scaleY=transform.s.v[1]+(1-transform.s.v[1])*(1-perc);pMatrix.translate(transform.p.v[0]*dir*perc,transform.p.v[1]*dir*perc,transform.p.v[2]);rMatrix.translate(-transform.a.v[0],-transform.a.v[1],transform.a.v[2]);rMatrix.rotate(-transform.r.v*dir*perc);rMatrix.translate(transform.a.v[0],transform.a.v[1],transform.a.v[2]);sMatrix.translate(-transform.a.v[0],-transform.a.v[1],transform.a.v[2]);sMatrix.scale(inv?1/scaleX:scaleX,inv?1/scaleY:scaleY);sMatrix.translate(transform.a.v[0],transform.a.v[1],transform.a.v[2]);};RepeaterModifier.prototype.init=function(elem,arr,pos,elemsData){(this||_global).elem=elem;(this||_global).arr=arr;(this||_global).pos=pos;(this||_global).elemsData=elemsData;(this||_global)._currentCopies=0;(this||_global)._elements=[];(this||_global)._groups=[];(this||_global).frameId=-1;this.initDynamicPropertyContainer(elem);this.initModifierProperties(elem,arr[pos]);while(pos>0){pos-=1;//this._elements.unshift(arr.splice(pos,1)[0]);
(this||_global)._elements.unshift(arr[pos]);}if((this||_global).dynamicProperties.length){(this||_global).k=true;}else{this.getValue(true);}};RepeaterModifier.prototype.resetElements=function(elements){var i,len=elements.length;for(i=0;i<len;i+=1){elements[i]._processed=false;if(elements[i].ty==="gr"){this.resetElements(elements[i].it);}}};RepeaterModifier.prototype.cloneElements=function(elements){var len=elements.length;var newElements=JSON.parse(JSON.stringify(elements));this.resetElements(newElements);return newElements;};RepeaterModifier.prototype.changeGroupRender=function(elements,renderFlag){var i,len=elements.length;for(i=0;i<len;i+=1){elements[i]._render=renderFlag;if(elements[i].ty==="gr"){this.changeGroupRender(elements[i].it,renderFlag);}}};RepeaterModifier.prototype.processShapes=function(_isFirstFrame){var items,itemsTransform,i,dir,cont;if((this||_global)._mdf||_isFirstFrame){var copies=Math.ceil((this||_global).c.v);if((this||_global)._groups.length<copies){while((this||_global)._groups.length<copies){var group={it:this.cloneElements((this||_global)._elements),ty:"gr"};group.it.push({"a":{"a":0,"ix":1,"k":[0,0]},"nm":"Transform","o":{"a":0,"ix":7,"k":100},"p":{"a":0,"ix":2,"k":[0,0]},"r":{"a":1,"ix":6,"k":[{s:0,e:0,t:0},{s:0,e:0,t:1}]},"s":{"a":0,"ix":3,"k":[100,100]},"sa":{"a":0,"ix":5,"k":0},"sk":{"a":0,"ix":4,"k":0},"ty":"tr"});(this||_global).arr.splice(0,0,group);(this||_global)._groups.splice(0,0,group);(this||_global)._currentCopies+=1;}(this||_global).elem.reloadShapes();}cont=0;var renderFlag;for(i=0;i<=(this||_global)._groups.length-1;i+=1){renderFlag=cont<copies;(this||_global)._groups[i]._render=renderFlag;this.changeGroupRender((this||_global)._groups[i].it,renderFlag);cont+=1;}(this||_global)._currentCopies=copies;////
var offset=(this||_global).o.v;var offsetModulo=offset%1;var roundOffset=offset>0?Math.floor(offset):Math.ceil(offset);var tMat=(this||_global).tr.v.props;var pProps=(this||_global).pMatrix.props;var rProps=(this||_global).rMatrix.props;var sProps=(this||_global).sMatrix.props;(this||_global).pMatrix.reset();(this||_global).rMatrix.reset();(this||_global).sMatrix.reset();(this||_global).tMatrix.reset();(this||_global).matrix.reset();var iteration=0;if(offset>0){while(iteration<roundOffset){this.applyTransforms((this||_global).pMatrix,(this||_global).rMatrix,(this||_global).sMatrix,(this||_global).tr,1,false);iteration+=1;}if(offsetModulo){this.applyTransforms((this||_global).pMatrix,(this||_global).rMatrix,(this||_global).sMatrix,(this||_global).tr,offsetModulo,false);iteration+=offsetModulo;}}else if(offset<0){while(iteration>roundOffset){this.applyTransforms((this||_global).pMatrix,(this||_global).rMatrix,(this||_global).sMatrix,(this||_global).tr,1,true);iteration-=1;}if(offsetModulo){this.applyTransforms((this||_global).pMatrix,(this||_global).rMatrix,(this||_global).sMatrix,(this||_global).tr,-offsetModulo,true);iteration-=offsetModulo;}}i=(this||_global).data.m===1?0:(this||_global)._currentCopies-1;dir=(this||_global).data.m===1?1:-1;cont=(this||_global)._currentCopies;var j,jLen;while(cont){items=(this||_global).elemsData[i].it;itemsTransform=items[items.length-1].transform.mProps.v.props;jLen=itemsTransform.length;items[items.length-1].transform.mProps._mdf=true;items[items.length-1].transform.op._mdf=true;items[items.length-1].transform.op.v=(this||_global).so.v+((this||_global).eo.v-(this||_global).so.v)*(i/((this||_global)._currentCopies-1));if(iteration!==0){if(i!==0&&dir===1||i!==(this||_global)._currentCopies-1&&dir===-1){this.applyTransforms((this||_global).pMatrix,(this||_global).rMatrix,(this||_global).sMatrix,(this||_global).tr,1,false);}(this||_global).matrix.transform(rProps[0],rProps[1],rProps[2],rProps[3],rProps[4],rProps[5],rProps[6],rProps[7],rProps[8],rProps[9],rProps[10],rProps[11],rProps[12],rProps[13],rProps[14],rProps[15]);(this||_global).matrix.transform(sProps[0],sProps[1],sProps[2],sProps[3],sProps[4],sProps[5],sProps[6],sProps[7],sProps[8],sProps[9],sProps[10],sProps[11],sProps[12],sProps[13],sProps[14],sProps[15]);(this||_global).matrix.transform(pProps[0],pProps[1],pProps[2],pProps[3],pProps[4],pProps[5],pProps[6],pProps[7],pProps[8],pProps[9],pProps[10],pProps[11],pProps[12],pProps[13],pProps[14],pProps[15]);for(j=0;j<jLen;j+=1){itemsTransform[j]=(this||_global).matrix.props[j];}(this||_global).matrix.reset();}else{(this||_global).matrix.reset();for(j=0;j<jLen;j+=1){itemsTransform[j]=(this||_global).matrix.props[j];}}iteration+=1;cont-=1;i+=dir;}}else{cont=(this||_global)._currentCopies;i=0;dir=1;while(cont){items=(this||_global).elemsData[i].it;itemsTransform=items[items.length-1].transform.mProps.v.props;items[items.length-1].transform.mProps._mdf=false;items[items.length-1].transform.op._mdf=false;cont-=1;i+=dir;}}};RepeaterModifier.prototype.addShape=function(){};ShapeModifiers.registerModifier("rp",RepeaterModifier);function ShapeCollection(){(this||_global)._length=0;(this||_global)._maxLength=4;(this||_global).shapes=createSizedArray((this||_global)._maxLength);}ShapeCollection.prototype.addShape=function(shapeData){if((this||_global)._length===(this||_global)._maxLength){(this||_global).shapes=(this||_global).shapes.concat(createSizedArray((this||_global)._maxLength));(this||_global)._maxLength*=2;}(this||_global).shapes[(this||_global)._length]=shapeData;(this||_global)._length+=1;};ShapeCollection.prototype.releaseShapes=function(){var i;for(i=0;i<(this||_global)._length;i+=1){shape_pool.release((this||_global).shapes[i]);}(this||_global)._length=0;};function DashProperty(elem,data,renderer,container){(this||_global).elem=elem;(this||_global).frameId=-1;(this||_global).dataProps=createSizedArray(data.length);(this||_global).renderer=renderer;(this||_global).k=false;(this||_global).dashStr="";(this||_global).dashArray=createTypedArray("float32",data.length?data.length-1:0);(this||_global).dashoffset=createTypedArray("float32",1);this.initDynamicPropertyContainer(container);var i,len=data.length||0,prop;for(i=0;i<len;i+=1){prop=PropertyFactory.getProp(elem,data[i].v,0,0,this||_global);(this||_global).k=prop.k||(this||_global).k;(this||_global).dataProps[i]={n:data[i].n,p:prop};}if(!(this||_global).k){this.getValue(true);}(this||_global)._isAnimated=(this||_global).k;}DashProperty.prototype.getValue=function(forceRender){if((this||_global).elem.globalData.frameId===(this||_global).frameId&&!forceRender){return;}(this||_global).frameId=(this||_global).elem.globalData.frameId;this.iterateDynamicProperties();(this||_global)._mdf=(this||_global)._mdf||forceRender;if((this||_global)._mdf){var i=0,len=(this||_global).dataProps.length;if((this||_global).renderer==="svg"){(this||_global).dashStr="";}for(i=0;i<len;i+=1){if((this||_global).dataProps[i].n!="o"){if((this||_global).renderer==="svg"){(this||_global).dashStr+=" "+(this||_global).dataProps[i].p.v;}else{(this||_global).dashArray[i]=(this||_global).dataProps[i].p.v;}}else{(this||_global).dashoffset[0]=(this||_global).dataProps[i].p.v;}}}};extendPrototype([DynamicPropertyContainer],DashProperty);function GradientProperty(elem,data,container){(this||_global).data=data;(this||_global).c=createTypedArray("uint8c",data.p*4);var cLength=data.k.k[0].s?data.k.k[0].s.length-data.p*4:data.k.k.length-data.p*4;(this||_global).o=createTypedArray("float32",cLength);(this||_global)._cmdf=false;(this||_global)._omdf=false;(this||_global)._collapsable=this.checkCollapsable();(this||_global)._hasOpacity=cLength;this.initDynamicPropertyContainer(container);(this||_global).prop=PropertyFactory.getProp(elem,data.k,1,null,this||_global);(this||_global).k=(this||_global).prop.k;this.getValue(true);}GradientProperty.prototype.comparePoints=function(values,points){var i=0,len=(this||_global).o.length/2,diff;while(i<len){diff=Math.abs(values[i*4]-values[points*4+i*2]);if(diff>0.01){return false;}i+=1;}return true;};GradientProperty.prototype.checkCollapsable=function(){if((this||_global).o.length/2!==(this||_global).c.length/4){return false;}if((this||_global).data.k.k[0].s){var i=0,len=(this||_global).data.k.k.length;while(i<len){if(!this.comparePoints((this||_global).data.k.k[i].s,(this||_global).data.p)){return false;}i+=1;}}else if(!this.comparePoints((this||_global).data.k.k,(this||_global).data.p)){return false;}return true;};GradientProperty.prototype.getValue=function(forceRender){(this||_global).prop.getValue();(this||_global)._mdf=false;(this||_global)._cmdf=false;(this||_global)._omdf=false;if((this||_global).prop._mdf||forceRender){var i,len=(this||_global).data.p*4;var mult,val;for(i=0;i<len;i+=1){mult=i%4===0?100:255;val=Math.round((this||_global).prop.v[i]*mult);if((this||_global).c[i]!==val){(this||_global).c[i]=val;(this||_global)._cmdf=!forceRender;}}if((this||_global).o.length){len=(this||_global).prop.v.length;for(i=(this||_global).data.p*4;i<len;i+=1){mult=i%2===0?100:1;val=i%2===0?Math.round((this||_global).prop.v[i]*100):(this||_global).prop.v[i];if((this||_global).o[i-(this||_global).data.p*4]!==val){(this||_global).o[i-(this||_global).data.p*4]=val;(this||_global)._omdf=!forceRender;}}}(this||_global)._mdf=!forceRender;}};extendPrototype([DynamicPropertyContainer],GradientProperty);var buildShapeString=function buildShapeString(pathNodes,length,closed,mat){if(length===0){return"";}var _o=pathNodes.o;var _i=pathNodes.i;var _v=pathNodes.v;var i,shapeString=" M"+mat.applyToPointStringified(_v[0][0],_v[0][1]);for(i=1;i<length;i+=1){shapeString+=" C"+mat.applyToPointStringified(_o[i-1][0],_o[i-1][1])+" "+mat.applyToPointStringified(_i[i][0],_i[i][1])+" "+mat.applyToPointStringified(_v[i][0],_v[i][1]);}if(closed&&length){shapeString+=" C"+mat.applyToPointStringified(_o[i-1][0],_o[i-1][1])+" "+mat.applyToPointStringified(_i[0][0],_i[0][1])+" "+mat.applyToPointStringified(_v[0][0],_v[0][1]);shapeString+="z";}return shapeString;};var audioControllerFactory=function(){function AudioController(audioFactory){(this||_global).audios=[];(this||_global).audioFactory=audioFactory;(this||_global)._volume=1;(this||_global)._isMuted=false;}AudioController.prototype={addAudio:function addAudio(audio){(this||_global).audios.push(audio);},pause:function pause(){var i,len=(this||_global).audios.length;for(i=0;i<len;i+=1){(this||_global).audios[i].pause();}},resume:function resume(){var i,len=(this||_global).audios.length;for(i=0;i<len;i+=1){(this||_global).audios[i].resume();}},setRate:function setRate(rateValue){var i,len=(this||_global).audios.length;for(i=0;i<len;i+=1){(this||_global).audios[i].setRate(rateValue);}},createAudio:function createAudio(assetPath){if((this||_global).audioFactory){return this.audioFactory(assetPath);}else if(Howl){return new Howl({src:[assetPath]});}else{return{isPlaying:false,play:function play(){(this||_global).isPlaying=true;},seek:function seek(){(this||_global).isPlaying=false;},playing:function playing(){},rate:function rate(){},setVolume:function setVolume(){}};}},setAudioFactory:function setAudioFactory(audioFactory){(this||_global).audioFactory=audioFactory;},setVolume:function setVolume(value){(this||_global)._volume=value;this._updateVolume();},mute:function mute(){(this||_global)._isMuted=true;this._updateVolume();},unmute:function unmute(){(this||_global)._isMuted=false;this._updateVolume();},getVolume:function getVolume(value){return(this||_global)._volume;},_updateVolume:function _updateVolume(){var i,len=(this||_global).audios.length;for(i=0;i<len;i+=1){(this||_global).audios[i].volume((this||_global)._volume*((this||_global)._isMuted?0:1));}}};return function(){return new AudioController();};}();var ImagePreloader=function(){var proxyImage=function(){var canvas=createTag("canvas");canvas.width=1;canvas.height=1;var ctx=canvas.getContext("2d");ctx.fillStyle="rgba(0,0,0,0)";ctx.fillRect(0,0,1,1);return canvas;}();function imageLoaded(){(this||_global).loadedAssets+=1;if((this||_global).loadedAssets===(this||_global).totalImages){if((this||_global).imagesLoadedCb){this.imagesLoadedCb(null);}}}function getAssetsPath(assetData,assetsPath,original_path){var path="";if(assetData.e){path=assetData.p;}else if(assetsPath){var imagePath=assetData.p;if(imagePath.indexOf("images/")!==-1){imagePath=imagePath.split("/")[1];}path=assetsPath+imagePath;}else{path=original_path;path+=assetData.u?assetData.u:"";path+=assetData.p;}return path;}function testImageLoaded(img){var _count=0;var intervalId=setInterval(function(){var box=img.getBBox();if(box.width||_count>500){this._imageLoaded();clearInterval(intervalId);}_count+=1;}.bind(this||_global),50);}function createImageData(assetData){var path=getAssetsPath(assetData,(this||_global).assetsPath,(this||_global).path);var img=createNS("image");if(isSafari){this.testImageLoaded(img);}else{img.addEventListener("load",(this||_global)._imageLoaded,false);}img.addEventListener("error",function(){ob.img=proxyImage;this._imageLoaded();}.bind(this||_global),false);img.setAttributeNS("http://www.w3.org/1999/xlink","href",path);(this||_global)._elementHelper.append(img);var ob={img:img,assetData:assetData};return ob;}function createImgData(assetData){var path=getAssetsPath(assetData,(this||_global).assetsPath,(this||_global).path);var img=createTag("img");img.crossOrigin="anonymous";img.addEventListener("load",(this||_global)._imageLoaded,false);img.addEventListener("error",function(){ob.img=proxyImage;this._imageLoaded();}.bind(this||_global),false);img.src=path;var ob={img:img,assetData:assetData};return ob;}function loadAssets(assets,cb){(this||_global).imagesLoadedCb=cb;var i,len=assets.length;for(i=0;i<len;i+=1){if(!assets[i].layers){(this||_global).totalImages+=1;(this||_global).images.push(this._createImageData(assets[i]));}}}function setPath(path){(this||_global).path=path||"";}function setAssetsPath(path){(this||_global).assetsPath=path||"";}function getImage(assetData){var i=0,len=(this||_global).images.length;while(i<len){if((this||_global).images[i].assetData===assetData){return(this||_global).images[i].img;}i+=1;}}function destroy(){(this||_global).imagesLoadedCb=null;(this||_global).images.length=0;}function loaded(){return(this||_global).totalImages===(this||_global).loadedAssets;}function setCacheType(type,elementHelper){if(type==="svg"){(this||_global)._elementHelper=elementHelper;(this||_global)._createImageData=(this||_global).createImageData.bind(this||_global);}else{(this||_global)._createImageData=(this||_global).createImgData.bind(this||_global);}}function ImagePreloader(type){(this||_global)._imageLoaded=imageLoaded.bind(this||_global);(this||_global).testImageLoaded=testImageLoaded.bind(this||_global);(this||_global).assetsPath="";(this||_global).path="";(this||_global).totalImages=0;(this||_global).loadedAssets=0;(this||_global).imagesLoadedCb=null;(this||_global).images=[];}ImagePreloader.prototype={loadAssets:loadAssets,setAssetsPath:setAssetsPath,setPath:setPath,loaded:loaded,destroy:destroy,getImage:getImage,createImgData:createImgData,createImageData:createImageData,imageLoaded:imageLoaded,setCacheType:setCacheType};return ImagePreloader;}();var featureSupport=function(){var ob={maskType:true};if(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent)){ob.maskType=false;}return ob;}();var filtersFactory=function(){var ob={};ob.createFilter=createFilter;ob.createAlphaToLuminanceFilter=createAlphaToLuminanceFilter;function createFilter(filId){var fil=createNS("filter");fil.setAttribute("id",filId);fil.setAttribute("filterUnits","objectBoundingBox");fil.setAttribute("x","0%");fil.setAttribute("y","0%");fil.setAttribute("width","100%");fil.setAttribute("height","100%");return fil;}function createAlphaToLuminanceFilter(){var feColorMatrix=createNS("feColorMatrix");feColorMatrix.setAttribute("type","matrix");feColorMatrix.setAttribute("color-interpolation-filters","sRGB");feColorMatrix.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1");return feColorMatrix;}return ob;}();var assetLoader=function(){function formatResponse(xhr){if(xhr.response&&_typeof2(xhr.response)==="object"){return xhr.response;}else if(xhr.response&&typeof xhr.response==="string"){return JSON.parse(xhr.response);}else if(xhr.responseText){return JSON.parse(xhr.responseText);}}function loadAsset(path,callback,errorCallback){var response;var xhr=new XMLHttpRequest();xhr.open("GET",path,true);// set responseType after calling open or IE will break.
try{// This crashes on Android WebView prior to KitKat
xhr.responseType="json";}catch(err){}xhr.send();xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){response=formatResponse(xhr);callback(response);}else{try{response=formatResponse(xhr);callback(response);}catch(err){if(errorCallback){errorCallback(err);}}}}};}return{load:loadAsset};}();function TextAnimatorProperty(textData,renderType,elem){(this||_global)._isFirstFrame=true;(this||_global)._hasMaskedPath=false;(this||_global)._frameId=-1;(this||_global)._textData=textData;(this||_global)._renderType=renderType;(this||_global)._elem=elem;(this||_global)._animatorsData=createSizedArray((this||_global)._textData.a.length);(this||_global)._pathData={};(this||_global)._moreOptions={alignment:{}};(this||_global).renderedLetters=[];(this||_global).lettersChangedFlag=false;this.initDynamicPropertyContainer(elem);}TextAnimatorProperty.prototype.searchProperties=function(){var i,len=(this||_global)._textData.a.length,animatorProps;var getProp=PropertyFactory.getProp;for(i=0;i<len;i+=1){animatorProps=(this||_global)._textData.a[i];(this||_global)._animatorsData[i]=new TextAnimatorDataProperty((this||_global)._elem,animatorProps,this||_global);}if((this||_global)._textData.p&&"m"in(this||_global)._textData.p){(this||_global)._pathData={f:getProp((this||_global)._elem,(this||_global)._textData.p.f,0,0,this||_global),l:getProp((this||_global)._elem,(this||_global)._textData.p.l,0,0,this||_global),r:(this||_global)._textData.p.r,m:(this||_global)._elem.maskManager.getMaskProperty((this||_global)._textData.p.m)};(this||_global)._hasMaskedPath=true;}else{(this||_global)._hasMaskedPath=false;}(this||_global)._moreOptions.alignment=getProp((this||_global)._elem,(this||_global)._textData.m.a,1,0,this||_global);};TextAnimatorProperty.prototype.getMeasures=function(documentData,lettersChangedFlag){(this||_global).lettersChangedFlag=lettersChangedFlag;if(!(this||_global)._mdf&&!(this||_global)._isFirstFrame&&!lettersChangedFlag&&(!(this||_global)._hasMaskedPath||!(this||_global)._pathData.m._mdf)){return;}(this||_global)._isFirstFrame=false;var alignment=(this||_global)._moreOptions.alignment.v;var animators=(this||_global)._animatorsData;var textData=(this||_global)._textData;var matrixHelper=(this||_global).mHelper;var renderType=(this||_global)._renderType;var renderedLettersCount=(this||_global).renderedLetters.length;var data=(this||_global).data;var xPos,yPos;var i,len;var letters=documentData.l,pathInfo,currentLength,currentPoint,segmentLength,flag,pointInd,segmentInd,prevPoint,points,segments,partialLength,totalLength,perc,tanAngle,mask;if((this||_global)._hasMaskedPath){mask=(this||_global)._pathData.m;if(!(this||_global)._pathData.n||(this||_global)._pathData._mdf){var paths=mask.v;if((this||_global)._pathData.r){paths=paths.reverse();}// TODO: release bezier data cached from previous pathInfo: this._pathData.pi
pathInfo={tLength:0,segments:[]};len=paths._length-1;var bezierData;totalLength=0;for(i=0;i<len;i+=1){bezierData=bez.buildBezierData(paths.v[i],paths.v[i+1],[paths.o[i][0]-paths.v[i][0],paths.o[i][1]-paths.v[i][1]],[paths.i[i+1][0]-paths.v[i+1][0],paths.i[i+1][1]-paths.v[i+1][1]]);pathInfo.tLength+=bezierData.segmentLength;pathInfo.segments.push(bezierData);totalLength+=bezierData.segmentLength;}i=len;if(mask.v.c){bezierData=bez.buildBezierData(paths.v[i],paths.v[0],[paths.o[i][0]-paths.v[i][0],paths.o[i][1]-paths.v[i][1]],[paths.i[0][0]-paths.v[0][0],paths.i[0][1]-paths.v[0][1]]);pathInfo.tLength+=bezierData.segmentLength;pathInfo.segments.push(bezierData);totalLength+=bezierData.segmentLength;}(this||_global)._pathData.pi=pathInfo;}pathInfo=(this||_global)._pathData.pi;currentLength=(this||_global)._pathData.f.v;segmentInd=0;pointInd=1;segmentLength=0;flag=true;segments=pathInfo.segments;if(currentLength<0&&mask.v.c){if(pathInfo.tLength<Math.abs(currentLength)){currentLength=-Math.abs(currentLength)%pathInfo.tLength;}segmentInd=segments.length-1;points=segments[segmentInd].points;pointInd=points.length-1;while(currentLength<0){currentLength+=points[pointInd].partialLength;pointInd-=1;if(pointInd<0){segmentInd-=1;points=segments[segmentInd].points;pointInd=points.length-1;}}}points=segments[segmentInd].points;prevPoint=points[pointInd-1];currentPoint=points[pointInd];partialLength=currentPoint.partialLength;}len=letters.length;xPos=0;yPos=0;var yOff=documentData.finalSize*1.2*0.714;var firstLine=true;var animatorProps,animatorSelector;var j,jLen;var letterValue;jLen=animators.length;var mult,ind=-1,offf,xPathPos,yPathPos;var initPathPos=currentLength,initSegmentInd=segmentInd,initPointInd=pointInd,currentLine=-1;var elemOpacity;var sc,sw,fc,k;var lineLength=0;var letterSw,letterSc,letterFc,letterM="",letterP=(this||_global).defaultPropsArray,letterO;//
if(documentData.j===2||documentData.j===1){var animatorJustifyOffset=0;var animatorFirstCharOffset=0;var justifyOffsetMult=documentData.j===2?-0.5:-1;var lastIndex=0;var isNewLine=true;for(i=0;i<len;i+=1){if(letters[i].n){if(animatorJustifyOffset){animatorJustifyOffset+=animatorFirstCharOffset;}while(lastIndex<i){letters[lastIndex].animatorJustifyOffset=animatorJustifyOffset;lastIndex+=1;}animatorJustifyOffset=0;isNewLine=true;}else{for(j=0;j<jLen;j+=1){animatorProps=animators[j].a;if(animatorProps.t.propType){if(isNewLine&&documentData.j===2){animatorFirstCharOffset+=animatorProps.t.v*justifyOffsetMult;}animatorSelector=animators[j].s;mult=animatorSelector.getMult(letters[i].anIndexes[j],textData.a[j].s.totalChars);if(mult.length){animatorJustifyOffset+=animatorProps.t.v*mult[0]*justifyOffsetMult;}else{animatorJustifyOffset+=animatorProps.t.v*mult*justifyOffsetMult;}}}isNewLine=false;}}if(animatorJustifyOffset){animatorJustifyOffset+=animatorFirstCharOffset;}while(lastIndex<i){letters[lastIndex].animatorJustifyOffset=animatorJustifyOffset;lastIndex+=1;}}//
for(i=0;i<len;i+=1){matrixHelper.reset();elemOpacity=1;if(letters[i].n){xPos=0;yPos+=documentData.yOffset;yPos+=firstLine?1:0;currentLength=initPathPos;firstLine=false;lineLength=0;if((this||_global)._hasMaskedPath){segmentInd=initSegmentInd;pointInd=initPointInd;points=segments[segmentInd].points;prevPoint=points[pointInd-1];currentPoint=points[pointInd];partialLength=currentPoint.partialLength;segmentLength=0;}letterO=letterSw=letterFc=letterM="";letterP=(this||_global).defaultPropsArray;}else{if((this||_global)._hasMaskedPath){if(currentLine!==letters[i].line){switch(documentData.j){case 1:currentLength+=totalLength-documentData.lineWidths[letters[i].line];break;case 2:currentLength+=(totalLength-documentData.lineWidths[letters[i].line])/2;break;}currentLine=letters[i].line;}if(ind!==letters[i].ind){if(letters[ind]){currentLength+=letters[ind].extra;}currentLength+=letters[i].an/2;ind=letters[i].ind;}currentLength+=alignment[0]*letters[i].an/200;var animatorOffset=0;for(j=0;j<jLen;j+=1){animatorProps=animators[j].a;if(animatorProps.p.propType){animatorSelector=animators[j].s;mult=animatorSelector.getMult(letters[i].anIndexes[j],textData.a[j].s.totalChars);if(mult.length){animatorOffset+=animatorProps.p.v[0]*mult[0];}else{animatorOffset+=animatorProps.p.v[0]*mult;}}if(animatorProps.a.propType){animatorSelector=animators[j].s;mult=animatorSelector.getMult(letters[i].anIndexes[j],textData.a[j].s.totalChars);if(mult.length){animatorOffset+=animatorProps.a.v[0]*mult[0];}else{animatorOffset+=animatorProps.a.v[0]*mult;}}}flag=true;while(flag){if(segmentLength+partialLength>=currentLength+animatorOffset||!points){perc=(currentLength+animatorOffset-segmentLength)/currentPoint.partialLength;xPathPos=prevPoint.point[0]+(currentPoint.point[0]-prevPoint.point[0])*perc;yPathPos=prevPoint.point[1]+(currentPoint.point[1]-prevPoint.point[1])*perc;matrixHelper.translate(-alignment[0]*letters[i].an/200,-(alignment[1]*yOff/100));flag=false;}else if(points){segmentLength+=currentPoint.partialLength;pointInd+=1;if(pointInd>=points.length){pointInd=0;segmentInd+=1;if(!segments[segmentInd]){if(mask.v.c){pointInd=0;segmentInd=0;points=segments[segmentInd].points;}else{segmentLength-=currentPoint.partialLength;points=null;}}else{points=segments[segmentInd].points;}}if(points){prevPoint=currentPoint;currentPoint=points[pointInd];partialLength=currentPoint.partialLength;}}}offf=letters[i].an/2-letters[i].add;matrixHelper.translate(-offf,0,0);}else{offf=letters[i].an/2-letters[i].add;matrixHelper.translate(-offf,0,0);// Grouping alignment
matrixHelper.translate(-alignment[0]*letters[i].an/200,-alignment[1]*yOff/100,0);}lineLength+=letters[i].l/2;for(j=0;j<jLen;j+=1){animatorProps=animators[j].a;if(animatorProps.t.propType){animatorSelector=animators[j].s;mult=animatorSelector.getMult(letters[i].anIndexes[j],textData.a[j].s.totalChars);//This condition is to prevent applying tracking to first character in each line. Might be better to use a boolean "isNewLine"
if(xPos!==0||documentData.j!==0){if((this||_global)._hasMaskedPath){if(mult.length){currentLength+=animatorProps.t.v*mult[0];}else{currentLength+=animatorProps.t.v*mult;}}else{if(mult.length){xPos+=animatorProps.t.v*mult[0];}else{xPos+=animatorProps.t.v*mult;}}}}}lineLength+=letters[i].l/2;if(documentData.strokeWidthAnim){sw=documentData.sw||0;}if(documentData.strokeColorAnim){if(documentData.sc){sc=[documentData.sc[0],documentData.sc[1],documentData.sc[2]];}else{sc=[0,0,0];}}if(documentData.fillColorAnim&&documentData.fc){fc=[documentData.fc[0],documentData.fc[1],documentData.fc[2]];}for(j=0;j<jLen;j+=1){animatorProps=animators[j].a;if(animatorProps.a.propType){animatorSelector=animators[j].s;mult=animatorSelector.getMult(letters[i].anIndexes[j],textData.a[j].s.totalChars);if(mult.length){matrixHelper.translate(-animatorProps.a.v[0]*mult[0],-animatorProps.a.v[1]*mult[1],animatorProps.a.v[2]*mult[2]);}else{matrixHelper.translate(-animatorProps.a.v[0]*mult,-animatorProps.a.v[1]*mult,animatorProps.a.v[2]*mult);}}}for(j=0;j<jLen;j+=1){animatorProps=animators[j].a;if(animatorProps.s.propType){animatorSelector=animators[j].s;mult=animatorSelector.getMult(letters[i].anIndexes[j],textData.a[j].s.totalChars);if(mult.length){matrixHelper.scale(1+(animatorProps.s.v[0]-1)*mult[0],1+(animatorProps.s.v[1]-1)*mult[1],1);}else{matrixHelper.scale(1+(animatorProps.s.v[0]-1)*mult,1+(animatorProps.s.v[1]-1)*mult,1);}}}for(j=0;j<jLen;j+=1){animatorProps=animators[j].a;animatorSelector=animators[j].s;mult=animatorSelector.getMult(letters[i].anIndexes[j],textData.a[j].s.totalChars);if(animatorProps.sk.propType){if(mult.length){matrixHelper.skewFromAxis(-animatorProps.sk.v*mult[0],animatorProps.sa.v*mult[1]);}else{matrixHelper.skewFromAxis(-animatorProps.sk.v*mult,animatorProps.sa.v*mult);}}if(animatorProps.r.propType){if(mult.length){matrixHelper.rotateZ(-animatorProps.r.v*mult[2]);}else{matrixHelper.rotateZ(-animatorProps.r.v*mult);}}if(animatorProps.ry.propType){if(mult.length){matrixHelper.rotateY(animatorProps.ry.v*mult[1]);}else{matrixHelper.rotateY(animatorProps.ry.v*mult);}}if(animatorProps.rx.propType){if(mult.length){matrixHelper.rotateX(animatorProps.rx.v*mult[0]);}else{matrixHelper.rotateX(animatorProps.rx.v*mult);}}if(animatorProps.o.propType){if(mult.length){elemOpacity+=(animatorProps.o.v*mult[0]-elemOpacity)*mult[0];}else{elemOpacity+=(animatorProps.o.v*mult-elemOpacity)*mult;}}if(documentData.strokeWidthAnim&&animatorProps.sw.propType){if(mult.length){sw+=animatorProps.sw.v*mult[0];}else{sw+=animatorProps.sw.v*mult;}}if(documentData.strokeColorAnim&&animatorProps.sc.propType){for(k=0;k<3;k+=1){if(mult.length){sc[k]=sc[k]+(animatorProps.sc.v[k]-sc[k])*mult[0];}else{sc[k]=sc[k]+(animatorProps.sc.v[k]-sc[k])*mult;}}}if(documentData.fillColorAnim&&documentData.fc){if(animatorProps.fc.propType){for(k=0;k<3;k+=1){if(mult.length){fc[k]=fc[k]+(animatorProps.fc.v[k]-fc[k])*mult[0];}else{fc[k]=fc[k]+(animatorProps.fc.v[k]-fc[k])*mult;}}}if(animatorProps.fh.propType){if(mult.length){fc=addHueToRGB(fc,animatorProps.fh.v*mult[0]);}else{fc=addHueToRGB(fc,animatorProps.fh.v*mult);}}if(animatorProps.fs.propType){if(mult.length){fc=addSaturationToRGB(fc,animatorProps.fs.v*mult[0]);}else{fc=addSaturationToRGB(fc,animatorProps.fs.v*mult);}}if(animatorProps.fb.propType){if(mult.length){fc=addBrightnessToRGB(fc,animatorProps.fb.v*mult[0]);}else{fc=addBrightnessToRGB(fc,animatorProps.fb.v*mult);}}}}for(j=0;j<jLen;j+=1){animatorProps=animators[j].a;if(animatorProps.p.propType){animatorSelector=animators[j].s;mult=animatorSelector.getMult(letters[i].anIndexes[j],textData.a[j].s.totalChars);if((this||_global)._hasMaskedPath){if(mult.length){matrixHelper.translate(0,animatorProps.p.v[1]*mult[0],-animatorProps.p.v[2]*mult[1]);}else{matrixHelper.translate(0,animatorProps.p.v[1]*mult,-animatorProps.p.v[2]*mult);}}else{if(mult.length){matrixHelper.translate(animatorProps.p.v[0]*mult[0],animatorProps.p.v[1]*mult[1],-animatorProps.p.v[2]*mult[2]);}else{matrixHelper.translate(animatorProps.p.v[0]*mult,animatorProps.p.v[1]*mult,-animatorProps.p.v[2]*mult);}}}}if(documentData.strokeWidthAnim){letterSw=sw<0?0:sw;}if(documentData.strokeColorAnim){letterSc="rgb("+Math.round(sc[0]*255)+","+Math.round(sc[1]*255)+","+Math.round(sc[2]*255)+")";}if(documentData.fillColorAnim&&documentData.fc){letterFc="rgb("+Math.round(fc[0]*255)+","+Math.round(fc[1]*255)+","+Math.round(fc[2]*255)+")";}if((this||_global)._hasMaskedPath){matrixHelper.translate(0,-documentData.ls);matrixHelper.translate(0,alignment[1]*yOff/100+yPos,0);if(textData.p.p){tanAngle=(currentPoint.point[1]-prevPoint.point[1])/(currentPoint.point[0]-prevPoint.point[0]);var rot=Math.atan(tanAngle)*180/Math.PI;if(currentPoint.point[0]<prevPoint.point[0]){rot+=180;}matrixHelper.rotate(-rot*Math.PI/180);}matrixHelper.translate(xPathPos,yPathPos,0);currentLength-=alignment[0]*letters[i].an/200;if(letters[i+1]&&ind!==letters[i+1].ind){currentLength+=letters[i].an/2;currentLength+=documentData.tr/1000*documentData.finalSize;}}else{matrixHelper.translate(xPos,yPos,0);if(documentData.ps){//matrixHelper.translate(documentData.ps[0],documentData.ps[1],0);
matrixHelper.translate(documentData.ps[0],documentData.ps[1]+documentData.ascent,0);}switch(documentData.j){case 1:matrixHelper.translate(letters[i].animatorJustifyOffset+documentData.justifyOffset+(documentData.boxWidth-documentData.lineWidths[letters[i].line]),0,0);break;case 2:matrixHelper.translate(letters[i].animatorJustifyOffset+documentData.justifyOffset+(documentData.boxWidth-documentData.lineWidths[letters[i].line])/2,0,0);break;}matrixHelper.translate(0,-documentData.ls);matrixHelper.translate(offf,0,0);matrixHelper.translate(alignment[0]*letters[i].an/200,alignment[1]*yOff/100,0);xPos+=letters[i].l+documentData.tr/1000*documentData.finalSize;}if(renderType==="html"){letterM=matrixHelper.toCSS();}else if(renderType==="svg"){letterM=matrixHelper.to2dCSS();}else{letterP=[matrixHelper.props[0],matrixHelper.props[1],matrixHelper.props[2],matrixHelper.props[3],matrixHelper.props[4],matrixHelper.props[5],matrixHelper.props[6],matrixHelper.props[7],matrixHelper.props[8],matrixHelper.props[9],matrixHelper.props[10],matrixHelper.props[11],matrixHelper.props[12],matrixHelper.props[13],matrixHelper.props[14],matrixHelper.props[15]];}letterO=elemOpacity;}if(renderedLettersCount<=i){letterValue=new LetterProps(letterO,letterSw,letterSc,letterFc,letterM,letterP);(this||_global).renderedLetters.push(letterValue);renderedLettersCount+=1;(this||_global).lettersChangedFlag=true;}else{letterValue=(this||_global).renderedLetters[i];(this||_global).lettersChangedFlag=letterValue.update(letterO,letterSw,letterSc,letterFc,letterM,letterP)||(this||_global).lettersChangedFlag;}}};TextAnimatorProperty.prototype.getValue=function(){if((this||_global)._elem.globalData.frameId===(this||_global)._frameId){return;}(this||_global)._frameId=(this||_global)._elem.globalData.frameId;this.iterateDynamicProperties();};TextAnimatorProperty.prototype.mHelper=new Matrix();TextAnimatorProperty.prototype.defaultPropsArray=[];extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function TextAnimatorDataProperty(elem,animatorProps,container){var defaultData={propType:false};var getProp=PropertyFactory.getProp;var textAnimator_animatables=animatorProps.a;(this||_global).a={r:textAnimator_animatables.r?getProp(elem,textAnimator_animatables.r,0,degToRads,container):defaultData,rx:textAnimator_animatables.rx?getProp(elem,textAnimator_animatables.rx,0,degToRads,container):defaultData,ry:textAnimator_animatables.ry?getProp(elem,textAnimator_animatables.ry,0,degToRads,container):defaultData,sk:textAnimator_animatables.sk?getProp(elem,textAnimator_animatables.sk,0,degToRads,container):defaultData,sa:textAnimator_animatables.sa?getProp(elem,textAnimator_animatables.sa,0,degToRads,container):defaultData,s:textAnimator_animatables.s?getProp(elem,textAnimator_animatables.s,1,0.01,container):defaultData,a:textAnimator_animatables.a?getProp(elem,textAnimator_animatables.a,1,0,container):defaultData,o:textAnimator_animatables.o?getProp(elem,textAnimator_animatables.o,0,0.01,container):defaultData,p:textAnimator_animatables.p?getProp(elem,textAnimator_animatables.p,1,0,container):defaultData,sw:textAnimator_animatables.sw?getProp(elem,textAnimator_animatables.sw,0,0,container):defaultData,sc:textAnimator_animatables.sc?getProp(elem,textAnimator_animatables.sc,1,0,container):defaultData,fc:textAnimator_animatables.fc?getProp(elem,textAnimator_animatables.fc,1,0,container):defaultData,fh:textAnimator_animatables.fh?getProp(elem,textAnimator_animatables.fh,0,0,container):defaultData,fs:textAnimator_animatables.fs?getProp(elem,textAnimator_animatables.fs,0,0.01,container):defaultData,fb:textAnimator_animatables.fb?getProp(elem,textAnimator_animatables.fb,0,0.01,container):defaultData,t:textAnimator_animatables.t?getProp(elem,textAnimator_animatables.t,0,0,container):defaultData};(this||_global).s=TextSelectorProp.getTextSelectorProp(elem,animatorProps.s,container);(this||_global).s.t=animatorProps.s.t;}function LetterProps(o,sw,sc,fc,m,p){(this||_global).o=o;(this||_global).sw=sw;(this||_global).sc=sc;(this||_global).fc=fc;(this||_global).m=m;(this||_global).p=p;(this||_global)._mdf={o:true,sw:!!sw,sc:!!sc,fc:!!fc,m:true,p:true};}LetterProps.prototype.update=function(o,sw,sc,fc,m,p){(this||_global)._mdf.o=false;(this||_global)._mdf.sw=false;(this||_global)._mdf.sc=false;(this||_global)._mdf.fc=false;(this||_global)._mdf.m=false;(this||_global)._mdf.p=false;var updated=false;if((this||_global).o!==o){(this||_global).o=o;(this||_global)._mdf.o=true;updated=true;}if((this||_global).sw!==sw){(this||_global).sw=sw;(this||_global)._mdf.sw=true;updated=true;}if((this||_global).sc!==sc){(this||_global).sc=sc;(this||_global)._mdf.sc=true;updated=true;}if((this||_global).fc!==fc){(this||_global).fc=fc;(this||_global)._mdf.fc=true;updated=true;}if((this||_global).m!==m){(this||_global).m=m;(this||_global)._mdf.m=true;updated=true;}if(p.length&&((this||_global).p[0]!==p[0]||(this||_global).p[1]!==p[1]||(this||_global).p[4]!==p[4]||(this||_global).p[5]!==p[5]||(this||_global).p[12]!==p[12]||(this||_global).p[13]!==p[13])){(this||_global).p=p;(this||_global)._mdf.p=true;updated=true;}return updated;};function TextProperty(elem,data){(this||_global)._frameId=initialDefaultFrame;(this||_global).pv="";(this||_global).v="";(this||_global).kf=false;(this||_global)._isFirstFrame=true;(this||_global)._mdf=false;(this||_global).data=data;(this||_global).elem=elem;(this||_global).comp=(this||_global).elem.comp;(this||_global).keysIndex=0;(this||_global).canResize=false;(this||_global).minimumFontSize=1;(this||_global).effectsSequence=[];(this||_global).currentData={ascent:0,boxWidth:(this||_global).defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:false,strokeColorAnim:false,strokeWidthAnim:false,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:false};this.copyData((this||_global).currentData,(this||_global).data.d.k[0].s);if(!this.searchProperty()){this.completeTextData((this||_global).currentData);}}TextProperty.prototype.defaultBoxWidth=[0,0];TextProperty.prototype.copyData=function(obj,data){for(var s in data){if(data.hasOwnProperty(s)){obj[s]=data[s];}}return obj;};TextProperty.prototype.setCurrentData=function(data){if(!data.__complete){this.completeTextData(data);}(this||_global).currentData=data;(this||_global).currentData.boxWidth=(this||_global).currentData.boxWidth||(this||_global).defaultBoxWidth;(this||_global)._mdf=true;};TextProperty.prototype.searchProperty=function(){return this.searchKeyframes();};TextProperty.prototype.searchKeyframes=function(){(this||_global).kf=(this||_global).data.d.k.length>1;if((this||_global).kf){this.addEffect((this||_global).getKeyframeValue.bind(this||_global));}return(this||_global).kf;};TextProperty.prototype.addEffect=function(effectFunction){(this||_global).effectsSequence.push(effectFunction);(this||_global).elem.addDynamicProperty(this||_global);};TextProperty.prototype.getValue=function(_finalValue){if(((this||_global).elem.globalData.frameId===(this||_global).frameId||!(this||_global).effectsSequence.length)&&!_finalValue){return;}(this||_global).currentData.t=(this||_global).data.d.k[(this||_global).keysIndex].s.t;var currentValue=(this||_global).currentData;var currentIndex=(this||_global).keysIndex;if((this||_global).lock){this.setCurrentData((this||_global).currentData);return;}(this||_global).lock=true;(this||_global)._mdf=false;var i,len=(this||_global).effectsSequence.length;var finalValue=_finalValue||(this||_global).data.d.k[(this||_global).keysIndex].s;for(i=0;i<len;i+=1){//Checking if index changed to prevent creating a new object every time the expression updates.
if(currentIndex!==(this||_global).keysIndex){finalValue=(this||_global).effectsSequence[i](finalValue,finalValue.t);}else{finalValue=(this||_global).effectsSequence[i]((this||_global).currentData,finalValue.t);}}if(currentValue!==finalValue){this.setCurrentData(finalValue);}(this||_global).pv=(this||_global).v=(this||_global).currentData;(this||_global).lock=false;(this||_global).frameId=(this||_global).elem.globalData.frameId;};TextProperty.prototype.getKeyframeValue=function(){var textKeys=(this||_global).data.d.k,textDocumentData;var frameNum=(this||_global).elem.comp.renderedFrame;var i=0,len=textKeys.length;while(i<=len-1){textDocumentData=textKeys[i].s;if(i===len-1||textKeys[i+1].t>frameNum){break;}i+=1;}if((this||_global).keysIndex!==i){(this||_global).keysIndex=i;}return(this||_global).data.d.k[(this||_global).keysIndex].s;};TextProperty.prototype.buildFinalText=function(text){var combinedCharacters=FontManager.getCombinedCharacterCodes();var charactersArray=[];var i=0,len=text.length;var charCode;while(i<len){charCode=text.charCodeAt(i);if(combinedCharacters.indexOf(charCode)!==-1){charactersArray[charactersArray.length-1]+=text.charAt(i);}else{if(charCode>=55296&&charCode<=56319){charCode=text.charCodeAt(i+1);if(charCode>=56320&&charCode<=57343){charactersArray.push(text.substr(i,2));++i;}else{charactersArray.push(text.charAt(i));}}else{charactersArray.push(text.charAt(i));}}i+=1;}return charactersArray;};TextProperty.prototype.completeTextData=function(documentData){documentData.__complete=true;var fontManager=(this||_global).elem.globalData.fontManager;var data=(this||_global).data;var letters=[];var i,len;var newLineFlag,index=0,val;var anchorGrouping=data.m.g;var currentSize=0,currentPos=0,currentLine=0,lineWidths=[];var lineWidth=0;var maxLineWidth=0;var j,jLen;var fontData=fontManager.getFontByName(documentData.f);var charData,cLength=0;var styles=fontData.fStyle?fontData.fStyle.split(" "):[];var fWeight="normal",fStyle="normal";len=styles.length;var styleName;for(i=0;i<len;i+=1){styleName=styles[i].toLowerCase();switch(styleName){case"italic":fStyle="italic";break;case"bold":fWeight="700";break;case"black":fWeight="900";break;case"medium":fWeight="500";break;case"regular":case"normal":fWeight="400";break;case"light":case"thin":fWeight="200";break;}}documentData.fWeight=fontData.fWeight||fWeight;documentData.fStyle=fStyle;documentData.finalSize=documentData.s;documentData.finalText=this.buildFinalText(documentData.t);len=documentData.finalText.length;documentData.finalLineHeight=documentData.lh;var trackingOffset=documentData.tr/1000*documentData.finalSize;var charCode;if(documentData.sz){var flag=true;var boxWidth=documentData.sz[0];var boxHeight=documentData.sz[1];var currentHeight,finalText;while(flag){finalText=this.buildFinalText(documentData.t);currentHeight=0;lineWidth=0;len=finalText.length;trackingOffset=documentData.tr/1000*documentData.finalSize;var lastSpaceIndex=-1;for(i=0;i<len;i+=1){charCode=finalText[i].charCodeAt(0);newLineFlag=false;if(finalText[i]===" "){lastSpaceIndex=i;}else if(charCode===13||charCode===3){lineWidth=0;newLineFlag=true;currentHeight+=documentData.finalLineHeight||documentData.finalSize*1.2;}if(fontManager.chars){charData=fontManager.getCharData(finalText[i],fontData.fStyle,fontData.fFamily);cLength=newLineFlag?0:charData.w*documentData.finalSize/100;}else{//tCanvasHelper.font = documentData.s + 'px '+ fontData.fFamily;
cLength=fontManager.measureText(finalText[i],documentData.f,documentData.finalSize);}if(lineWidth+cLength>boxWidth&&finalText[i]!==" "){if(lastSpaceIndex===-1){len+=1;}else{i=lastSpaceIndex;}currentHeight+=documentData.finalLineHeight||documentData.finalSize*1.2;finalText.splice(i,lastSpaceIndex===i?1:0,"\r");//finalText = finalText.substr(0,i) + "\r" + finalText.substr(i === lastSpaceIndex ? i + 1 : i);
lastSpaceIndex=-1;lineWidth=0;}else{lineWidth+=cLength;lineWidth+=trackingOffset;}}currentHeight+=fontData.ascent*documentData.finalSize/100;if((this||_global).canResize&&documentData.finalSize>(this||_global).minimumFontSize&&boxHeight<currentHeight){documentData.finalSize-=1;documentData.finalLineHeight=documentData.finalSize*documentData.lh/documentData.s;}else{documentData.finalText=finalText;len=documentData.finalText.length;flag=false;}}}lineWidth=-trackingOffset;cLength=0;var uncollapsedSpaces=0;var currentChar;for(i=0;i<len;i+=1){newLineFlag=false;currentChar=documentData.finalText[i];charCode=currentChar.charCodeAt(0);if(charCode===13||charCode===3){uncollapsedSpaces=0;lineWidths.push(lineWidth);maxLineWidth=lineWidth>maxLineWidth?lineWidth:maxLineWidth;lineWidth=-2*trackingOffset;val="";newLineFlag=true;currentLine+=1;}else{val=currentChar;}if(fontManager.chars){charData=fontManager.getCharData(currentChar,fontData.fStyle,fontManager.getFontByName(documentData.f).fFamily);cLength=newLineFlag?0:charData.w*documentData.finalSize/100;}else{//var charWidth = fontManager.measureText(val, documentData.f, documentData.finalSize);
//tCanvasHelper.font = documentData.finalSize + 'px '+ fontManager.getFontByName(documentData.f).fFamily;
cLength=fontManager.measureText(val,documentData.f,documentData.finalSize);}//
if(currentChar===" "){uncollapsedSpaces+=cLength+trackingOffset;}else{lineWidth+=cLength+trackingOffset+uncollapsedSpaces;uncollapsedSpaces=0;}letters.push({l:cLength,an:cLength,add:currentSize,n:newLineFlag,anIndexes:[],val:val,line:currentLine,animatorJustifyOffset:0});if(anchorGrouping==2){currentSize+=cLength;if(val===""||val===" "||i===len-1){if(val===""||val===" "){currentSize-=cLength;}while(currentPos<=i){letters[currentPos].an=currentSize;letters[currentPos].ind=index;letters[currentPos].extra=cLength;currentPos+=1;}index+=1;currentSize=0;}}else if(anchorGrouping==3){currentSize+=cLength;if(val===""||i===len-1){if(val===""){currentSize-=cLength;}while(currentPos<=i){letters[currentPos].an=currentSize;letters[currentPos].ind=index;letters[currentPos].extra=cLength;currentPos+=1;}currentSize=0;index+=1;}}else{letters[index].ind=index;letters[index].extra=0;index+=1;}}documentData.l=letters;maxLineWidth=lineWidth>maxLineWidth?lineWidth:maxLineWidth;lineWidths.push(lineWidth);if(documentData.sz){documentData.boxWidth=documentData.sz[0];documentData.justifyOffset=0;}else{documentData.boxWidth=maxLineWidth;switch(documentData.j){case 1:documentData.justifyOffset=-documentData.boxWidth;break;case 2:documentData.justifyOffset=-documentData.boxWidth/2;break;default:documentData.justifyOffset=0;}}documentData.lineWidths=lineWidths;var animators=data.a,animatorData,letterData;jLen=animators.length;var based,ind,indexes=[];for(j=0;j<jLen;j+=1){animatorData=animators[j];if(animatorData.a.sc){documentData.strokeColorAnim=true;}if(animatorData.a.sw){documentData.strokeWidthAnim=true;}if(animatorData.a.fc||animatorData.a.fh||animatorData.a.fs||animatorData.a.fb){documentData.fillColorAnim=true;}ind=0;based=animatorData.s.b;for(i=0;i<len;i+=1){letterData=letters[i];letterData.anIndexes[j]=ind;if(based==1&&letterData.val!==""||based==2&&letterData.val!==""&&letterData.val!==" "||based==3&&(letterData.n||letterData.val==" "||i==len-1)||based==4&&(letterData.n||i==len-1)){if(animatorData.s.rn===1){indexes.push(ind);}ind+=1;}}data.a[j].s.totalChars=ind;var currentInd=-1,newInd;if(animatorData.s.rn===1){for(i=0;i<len;i+=1){letterData=letters[i];if(currentInd!=letterData.anIndexes[j]){currentInd=letterData.anIndexes[j];newInd=indexes.splice(Math.floor(Math.random()*indexes.length),1)[0];}letterData.anIndexes[j]=newInd;}}}documentData.yOffset=documentData.finalLineHeight||documentData.finalSize*1.2;documentData.ls=documentData.ls||0;documentData.ascent=fontData.ascent*documentData.finalSize/100;};TextProperty.prototype.updateDocumentData=function(newData,index){index=index===undefined?(this||_global).keysIndex:index;var dData=this.copyData({},(this||_global).data.d.k[index].s);dData=this.copyData(dData,newData);(this||_global).data.d.k[index].s=dData;this.recalculate(index);(this||_global).elem.addDynamicProperty(this||_global);};TextProperty.prototype.recalculate=function(index){var dData=(this||_global).data.d.k[index].s;dData.__complete=false;(this||_global).keysIndex=0;(this||_global)._isFirstFrame=true;this.getValue(dData);};TextProperty.prototype.canResizeFont=function(_canResize){(this||_global).canResize=_canResize;this.recalculate((this||_global).keysIndex);(this||_global).elem.addDynamicProperty(this||_global);};TextProperty.prototype.setMinimumFontSize=function(_fontValue){(this||_global).minimumFontSize=Math.floor(_fontValue)||1;this.recalculate((this||_global).keysIndex);(this||_global).elem.addDynamicProperty(this||_global);};var TextSelectorProp=function(){var max=Math.max;var min=Math.min;var floor=Math.floor;function TextSelectorProp(elem,data){(this||_global)._currentTextLength=-1;(this||_global).k=false;(this||_global).data=data;(this||_global).elem=elem;(this||_global).comp=elem.comp;(this||_global).finalS=0;(this||_global).finalE=0;this.initDynamicPropertyContainer(elem);(this||_global).s=PropertyFactory.getProp(elem,data.s||{k:0},0,0,this||_global);if("e"in data){(this||_global).e=PropertyFactory.getProp(elem,data.e,0,0,this||_global);}else{(this||_global).e={v:100};}(this||_global).o=PropertyFactory.getProp(elem,data.o||{k:0},0,0,this||_global);(this||_global).xe=PropertyFactory.getProp(elem,data.xe||{k:0},0,0,this||_global);(this||_global).ne=PropertyFactory.getProp(elem,data.ne||{k:0},0,0,this||_global);(this||_global).a=PropertyFactory.getProp(elem,data.a,0,0.01,this||_global);if(!(this||_global).dynamicProperties.length){this.getValue();}}TextSelectorProp.prototype={getMult:function getMult(ind){if((this||_global)._currentTextLength!==(this||_global).elem.textProperty.currentData.l.length){this.getValue();}//var easer = bez.getEasingCurve(this.ne.v/100,0,1-this.xe.v/100,1);
var x1=0;var y1=0;var x2=1;var y2=1;if((this||_global).ne.v>0){x1=(this||_global).ne.v/100;}else{y1=-(this||_global).ne.v/100;}if((this||_global).xe.v>0){x2=1-(this||_global).xe.v/100;}else{y2=1+(this||_global).xe.v/100;}var easer=BezierFactory.getBezierEasing(x1,y1,x2,y2).get;var mult=0;var s=(this||_global).finalS;var e=(this||_global).finalE;var type=(this||_global).data.sh;if(type===2){if(e===s){mult=ind>=e?1:0;}else{mult=max(0,min(0.5/(e-s)+(ind-s)/(e-s),1));}mult=easer(mult);}else if(type===3){if(e===s){mult=ind>=e?0:1;}else{mult=1-max(0,min(0.5/(e-s)+(ind-s)/(e-s),1));}mult=easer(mult);}else if(type===4){if(e===s){mult=0;}else{mult=max(0,min(0.5/(e-s)+(ind-s)/(e-s),1));if(mult<0.5){mult*=2;}else{mult=1-2*(mult-0.5);}}mult=easer(mult);}else if(type===5){if(e===s){mult=0;}else{var tot=e-s;/*ind += 0.5;
                  mult = -4/(tot*tot)*(ind*ind)+(4/tot)*ind;*/ind=min(max(0,ind+0.5-s),e-s);var x=-tot/2+ind;var a=tot/2;mult=Math.sqrt(1-x*x/(a*a));}mult=easer(mult);}else if(type===6){if(e===s){mult=0;}else{ind=min(max(0,ind+0.5-s),e-s);mult=(1+Math.cos(Math.PI+Math.PI*2*ind/(e-s)))/2;}mult=easer(mult);}else{if(ind>=floor(s)){if(ind-s<0){mult=max(0,min(min(e,1)-(s-ind),1));}else{mult=max(0,min(e-ind,1));}}mult=easer(mult);}return mult*(this||_global).a.v;},getValue:function getValue(newCharsFlag){this.iterateDynamicProperties();(this||_global)._mdf=newCharsFlag||(this||_global)._mdf;(this||_global)._currentTextLength=(this||_global).elem.textProperty.currentData.l.length||0;if(newCharsFlag&&(this||_global).data.r===2){(this||_global).e.v=(this||_global)._currentTextLength;}var divisor=(this||_global).data.r===2?1:100/(this||_global).data.totalChars;var o=(this||_global).o.v/divisor;var s=(this||_global).s.v/divisor+o;var e=(this||_global).e.v/divisor+o;if(s>e){var _s=s;s=e;e=_s;}(this||_global).finalS=s;(this||_global).finalE=e;}};extendPrototype([DynamicPropertyContainer],TextSelectorProp);function getTextSelectorProp(elem,data,arr){return new TextSelectorProp(elem,data,arr);}return{getTextSelectorProp:getTextSelectorProp};}();var pool_factory=function(){return function(initialLength,_create,_release,_clone){var _length=0;var _maxLength=initialLength;var pool=createSizedArray(_maxLength);var ob={newElement:newElement,release:release};function newElement(){var element;if(_length){_length-=1;element=pool[_length];}else{element=_create();}return element;}function release(element){if(_length===_maxLength){pool=pooling["double"](pool);_maxLength=_maxLength*2;}if(_release){_release(element);}pool[_length]=element;_length+=1;}return ob;};}();var pooling=function(){function _double3(arr){return arr.concat(createSizedArray(arr.length));}return{"double":_double3};}();var point_pool=function(){function create(){return createTypedArray("float32",2);}return pool_factory(8,create);}();var shape_pool=function(){function create(){return new ShapePath();}function release(shapePath){var len=shapePath._length,i;for(i=0;i<len;i+=1){point_pool.release(shapePath.v[i]);point_pool.release(shapePath.i[i]);point_pool.release(shapePath.o[i]);shapePath.v[i]=null;shapePath.i[i]=null;shapePath.o[i]=null;}shapePath._length=0;shapePath.c=false;}function clone(shape){var cloned=factory.newElement();var i,len=shape._length===undefined?shape.v.length:shape._length;cloned.setLength(len);cloned.c=shape.c;for(i=0;i<len;i+=1){cloned.setTripleAt(shape.v[i][0],shape.v[i][1],shape.o[i][0],shape.o[i][1],shape.i[i][0],shape.i[i][1],i);}return cloned;}var factory=pool_factory(4,create,release);factory.clone=clone;return factory;}();var shapeCollection_pool=function(){var ob={newShapeCollection:newShapeCollection,release:release};var _length=0;var _maxLength=4;var pool=createSizedArray(_maxLength);function newShapeCollection(){var shapeCollection;if(_length){_length-=1;shapeCollection=pool[_length];}else{shapeCollection=new ShapeCollection();}return shapeCollection;}function release(shapeCollection){var i,len=shapeCollection._length;for(i=0;i<len;i+=1){shape_pool.release(shapeCollection.shapes[i]);}shapeCollection._length=0;if(_length===_maxLength){pool=pooling["double"](pool);_maxLength=_maxLength*2;}pool[_length]=shapeCollection;_length+=1;}return ob;}();var segments_length_pool=function(){function create(){return{lengths:[],totalLength:0};}function release(element){var i,len=element.lengths.length;for(i=0;i<len;i+=1){bezier_length_pool.release(element.lengths[i]);}element.lengths.length=0;}return pool_factory(8,create,release);}();var bezier_length_pool=function(){function create(){return{addedLength:0,percents:createTypedArray("float32",defaultCurveSegments),lengths:createTypedArray("float32",defaultCurveSegments)};}return pool_factory(8,create);}();function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(num){var i,len=(this||_global).layers.length,data;(this||_global).completeLayers=true;for(i=len-1;i>=0;i--){if(!(this||_global).elements[i]){data=(this||_global).layers[i];if(data.ip-data.st<=num-(this||_global).layers[i].st&&data.op-data.st>num-(this||_global).layers[i].st){this.buildItem(i);}}(this||_global).completeLayers=(this||_global).elements[i]?(this||_global).completeLayers:false;}this.checkPendingElements();};BaseRenderer.prototype.createItem=function(layer){switch(layer.ty){case 2:return this.createImage(layer);case 0:return this.createComp(layer);case 1:return this.createSolid(layer);case 3:return this.createNull(layer);case 4:return this.createShape(layer);case 5:return this.createText(layer);case 6:return this.createAudio(layer);case 13:return this.createCamera(layer);}return this.createNull(layer);};BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.");};BaseRenderer.prototype.createAudio=function(data){return new AudioElement(data,(this||_global).globalData,this||_global);};BaseRenderer.prototype.buildAllItems=function(){var i,len=(this||_global).layers.length;for(i=0;i<len;i+=1){this.buildItem(i);}this.checkPendingElements();};BaseRenderer.prototype.includeLayers=function(newLayers){(this||_global).completeLayers=false;var i,len=newLayers.length;var j,jLen=(this||_global).layers.length;for(i=0;i<len;i+=1){j=0;while(j<jLen){if((this||_global).layers[j].id==newLayers[i].id){(this||_global).layers[j]=newLayers[i];break;}j+=1;}}};BaseRenderer.prototype.setProjectInterface=function(pInterface){(this||_global).globalData.projectInterface=pInterface;};BaseRenderer.prototype.initItems=function(){if(!(this||_global).globalData.progressiveLoad){this.buildAllItems();}};BaseRenderer.prototype.buildElementParenting=function(element,parentName,hierarchy){var elements=(this||_global).elements;var layers=(this||_global).layers;var i=0,len=layers.length;while(i<len){if(layers[i].ind==parentName){if(!elements[i]||elements[i]===true){this.buildItem(i);this.addPendingElement(element);}else{hierarchy.push(elements[i]);elements[i].setAsParent();if(layers[i].parent!==undefined){this.buildElementParenting(element,layers[i].parent,hierarchy);}else{element.setHierarchy(hierarchy);}}}i+=1;}};BaseRenderer.prototype.addPendingElement=function(element){(this||_global).pendingElements.push(element);};BaseRenderer.prototype.searchExtraCompositions=function(assets){var i,len=assets.length;for(i=0;i<len;i+=1){if(assets[i].xt){var comp=this.createComp(assets[i]);comp.initExpressions();(this||_global).globalData.projectInterface.registerComposition(comp);}}};BaseRenderer.prototype.setupGlobalData=function(animData,fontsContainer){(this||_global).globalData.fontManager=new FontManager();(this||_global).globalData.fontManager.addChars(animData.chars);(this||_global).globalData.fontManager.addFonts(animData.fonts,fontsContainer);(this||_global).globalData.getAssetData=(this||_global).animationItem.getAssetData.bind((this||_global).animationItem);(this||_global).globalData.getAssetsPath=(this||_global).animationItem.getAssetsPath.bind((this||_global).animationItem);(this||_global).globalData.imageLoader=(this||_global).animationItem.imagePreloader;(this||_global).globalData.audioController=(this||_global).animationItem.audioController;(this||_global).globalData.frameId=0;(this||_global).globalData.frameRate=animData.fr;(this||_global).globalData.nm=animData.nm;(this||_global).globalData.compSize={w:animData.w,h:animData.h};};function SVGRenderer(animationItem,config){(this||_global).animationItem=animationItem;(this||_global).layers=null;(this||_global).renderedFrame=-1;(this||_global).svgElement=createNS("svg");var ariaLabel="";if(config&&config.title){var titleElement=createNS("title");var titleId=createElementID();titleElement.setAttribute("id",titleId);titleElement.textContent=config.title;(this||_global).svgElement.appendChild(titleElement);ariaLabel+=titleId;}if(config&&config.description){var descElement=createNS("desc");var descId=createElementID();descElement.setAttribute("id",descId);descElement.textContent=config.description;(this||_global).svgElement.appendChild(descElement);ariaLabel+=" "+descId;}if(ariaLabel){(this||_global).svgElement.setAttribute("aria-labelledby",ariaLabel);}var defs=createNS("defs");(this||_global).svgElement.appendChild(defs);var maskElement=createNS("g");(this||_global).svgElement.appendChild(maskElement);(this||_global).layerElement=maskElement;(this||_global).renderConfig={preserveAspectRatio:config&&config.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:config&&config.imagePreserveAspectRatio||"xMidYMid slice",progressiveLoad:config&&config.progressiveLoad||false,hideOnTransparent:config&&config.hideOnTransparent===false?false:true,viewBoxOnly:config&&config.viewBoxOnly||false,viewBoxSize:config&&config.viewBoxSize||false,className:config&&config.className||"",id:config&&config.id||"",focusable:config&&config.focusable,filterSize:{width:config&&config.filterSize&&config.filterSize.width||"100%",height:config&&config.filterSize&&config.filterSize.height||"100%",x:config&&config.filterSize&&config.filterSize.x||"0%",y:config&&config.filterSize&&config.filterSize.y||"0%"}};(this||_global).globalData={_mdf:false,frameNum:-1,defs:defs,renderConfig:(this||_global).renderConfig};(this||_global).elements=[];(this||_global).pendingElements=[];(this||_global).destroyed=false;(this||_global).rendererType="svg";}extendPrototype([BaseRenderer],SVGRenderer);SVGRenderer.prototype.createNull=function(data){return new NullElement(data,(this||_global).globalData,this||_global);};SVGRenderer.prototype.createShape=function(data){return new SVGShapeElement(data,(this||_global).globalData,this||_global);};SVGRenderer.prototype.createText=function(data){return new SVGTextElement(data,(this||_global).globalData,this||_global);};SVGRenderer.prototype.createImage=function(data){return new IImageElement(data,(this||_global).globalData,this||_global);};SVGRenderer.prototype.createComp=function(data){return new SVGCompElement(data,(this||_global).globalData,this||_global);};SVGRenderer.prototype.createSolid=function(data){return new ISolidElement(data,(this||_global).globalData,this||_global);};SVGRenderer.prototype.configAnimation=function(animData){(this||_global).svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg");if((this||_global).renderConfig.viewBoxSize){(this||_global).svgElement.setAttribute("viewBox",(this||_global).renderConfig.viewBoxSize);}else{(this||_global).svgElement.setAttribute("viewBox","0 0 "+animData.w+" "+animData.h);}if(!(this||_global).renderConfig.viewBoxOnly){(this||_global).svgElement.setAttribute("width",animData.w);(this||_global).svgElement.setAttribute("height",animData.h);(this||_global).svgElement.style.width="100%";(this||_global).svgElement.style.height="100%";(this||_global).svgElement.style.transform="translate3d(0,0,0)";}if((this||_global).renderConfig.className){(this||_global).svgElement.setAttribute("class",(this||_global).renderConfig.className);}if((this||_global).renderConfig.id){(this||_global).svgElement.setAttribute("id",(this||_global).renderConfig.id);}if((this||_global).renderConfig.focusable!==undefined){(this||_global).svgElement.setAttribute("focusable",(this||_global).renderConfig.focusable);}(this||_global).svgElement.setAttribute("preserveAspectRatio",(this||_global).renderConfig.preserveAspectRatio);//this.layerElement.style.transform = 'translate3d(0,0,0)';
//this.layerElement.style.transformOrigin = this.layerElement.style.mozTransformOrigin = this.layerElement.style.webkitTransformOrigin = this.layerElement.style['-webkit-transform'] = "0px 0px 0px";
(this||_global).animationItem.wrapper.appendChild((this||_global).svgElement);//Mask animation
var defs=(this||_global).globalData.defs;this.setupGlobalData(animData,defs);(this||_global).globalData.progressiveLoad=(this||_global).renderConfig.progressiveLoad;(this||_global).data=animData;var maskElement=createNS("clipPath");var rect=createNS("rect");rect.setAttribute("width",animData.w);rect.setAttribute("height",animData.h);rect.setAttribute("x",0);rect.setAttribute("y",0);var maskId=createElementID();maskElement.setAttribute("id",maskId);maskElement.appendChild(rect);(this||_global).layerElement.setAttribute("clip-path","url("+locationHref+"#"+maskId+")");defs.appendChild(maskElement);(this||_global).layers=animData.layers;(this||_global).elements=createSizedArray(animData.layers.length);};SVGRenderer.prototype.destroy=function(){if((this||_global).animationItem.wrapper){(this||_global).animationItem.wrapper.innerText="";}(this||_global).layerElement=null;(this||_global).globalData.defs=null;var i,len=(this||_global).layers?(this||_global).layers.length:0;for(i=0;i<len;i++){if((this||_global).elements[i]){(this||_global).elements[i].destroy();}}(this||_global).elements.length=0;(this||_global).destroyed=true;(this||_global).animationItem=null;};SVGRenderer.prototype.updateContainerSize=function(){};SVGRenderer.prototype.buildItem=function(pos){var elements=(this||_global).elements;if(elements[pos]||(this||_global).layers[pos].ty==99){return;}elements[pos]=true;var element=this.createItem((this||_global).layers[pos]);elements[pos]=element;if(expressionsPlugin){if((this||_global).layers[pos].ty===0){(this||_global).globalData.projectInterface.registerComposition(element);}element.initExpressions();}this.appendElementInPos(element,pos);if((this||_global).layers[pos].tt){if(!(this||_global).elements[pos-1]||(this||_global).elements[pos-1]===true){this.buildItem(pos-1);this.addPendingElement(element);}else{element.setMatte(elements[pos-1].layerId);}}};SVGRenderer.prototype.checkPendingElements=function(){while((this||_global).pendingElements.length){var element=(this||_global).pendingElements.pop();element.checkParenting();if(element.data.tt){var i=0,len=(this||_global).elements.length;while(i<len){if((this||_global).elements[i]===element){element.setMatte((this||_global).elements[i-1].layerId);break;}i+=1;}}}};SVGRenderer.prototype.renderFrame=function(num){if((this||_global).renderedFrame===num||(this||_global).destroyed){return;}if(num===null){num=(this||_global).renderedFrame;}else{(this||_global).renderedFrame=num;}// console.log('-------');
// console.log('FRAME ',num);
(this||_global).globalData.frameNum=num;(this||_global).globalData.frameId+=1;(this||_global).globalData.projectInterface.currentFrame=num;(this||_global).globalData._mdf=false;var i,len=(this||_global).layers.length;if(!(this||_global).completeLayers){this.checkLayers(num);}for(i=len-1;i>=0;i--){if((this||_global).completeLayers||(this||_global).elements[i]){(this||_global).elements[i].prepareFrame(num-(this||_global).layers[i].st);}}if((this||_global).globalData._mdf){for(i=0;i<len;i+=1){if((this||_global).completeLayers||(this||_global).elements[i]){(this||_global).elements[i].renderFrame();}}}};SVGRenderer.prototype.appendElementInPos=function(element,pos){var newElement=element.getBaseElement();if(!newElement){return;}var i=0;var nextElement;while(i<pos){if((this||_global).elements[i]&&(this||_global).elements[i]!==true&&(this||_global).elements[i].getBaseElement()){nextElement=(this||_global).elements[i].getBaseElement();}i+=1;}if(nextElement){(this||_global).layerElement.insertBefore(newElement,nextElement);}else{(this||_global).layerElement.appendChild(newElement);}};SVGRenderer.prototype.hide=function(){(this||_global).layerElement.style.display="none";};SVGRenderer.prototype.show=function(){(this||_global).layerElement.style.display="block";};function CanvasRenderer(animationItem,config){(this||_global).animationItem=animationItem;(this||_global).renderConfig={clearCanvas:config&&config.clearCanvas!==undefined?config.clearCanvas:true,context:config&&config.context||null,progressiveLoad:config&&config.progressiveLoad||false,preserveAspectRatio:config&&config.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:config&&config.imagePreserveAspectRatio||"xMidYMid slice",className:config&&config.className||"",id:config&&config.id||""};(this||_global).renderConfig.dpr=config&&config.dpr||1;if((this||_global).animationItem.wrapper){(this||_global).renderConfig.dpr=config&&config.dpr||window.devicePixelRatio||1;}(this||_global).renderedFrame=-1;(this||_global).globalData={frameNum:-1,_mdf:false,renderConfig:(this||_global).renderConfig,currentGlobalAlpha:-1};(this||_global).contextData=new CVContextData();(this||_global).elements=[];(this||_global).pendingElements=[];(this||_global).transformMat=new Matrix();(this||_global).completeLayers=false;(this||_global).rendererType="canvas";}extendPrototype([BaseRenderer],CanvasRenderer);CanvasRenderer.prototype.createShape=function(data){return new CVShapeElement(data,(this||_global).globalData,this||_global);};CanvasRenderer.prototype.createText=function(data){return new CVTextElement(data,(this||_global).globalData,this||_global);};CanvasRenderer.prototype.createImage=function(data){return new CVImageElement(data,(this||_global).globalData,this||_global);};CanvasRenderer.prototype.createComp=function(data){return new CVCompElement(data,(this||_global).globalData,this||_global);};CanvasRenderer.prototype.createSolid=function(data){return new CVSolidElement(data,(this||_global).globalData,this||_global);};CanvasRenderer.prototype.createNull=SVGRenderer.prototype.createNull;CanvasRenderer.prototype.ctxTransform=function(props){if(props[0]===1&&props[1]===0&&props[4]===0&&props[5]===1&&props[12]===0&&props[13]===0){return;}if(!(this||_global).renderConfig.clearCanvas){(this||_global).canvasContext.transform(props[0],props[1],props[4],props[5],props[12],props[13]);return;}(this||_global).transformMat.cloneFromProps(props);var cProps=(this||_global).contextData.cTr.props;(this||_global).transformMat.transform(cProps[0],cProps[1],cProps[2],cProps[3],cProps[4],cProps[5],cProps[6],cProps[7],cProps[8],cProps[9],cProps[10],cProps[11],cProps[12],cProps[13],cProps[14],cProps[15]);//this.contextData.cTr.transform(props[0],props[1],props[2],props[3],props[4],props[5],props[6],props[7],props[8],props[9],props[10],props[11],props[12],props[13],props[14],props[15]);
(this||_global).contextData.cTr.cloneFromProps((this||_global).transformMat.props);var trProps=(this||_global).contextData.cTr.props;(this||_global).canvasContext.setTransform(trProps[0],trProps[1],trProps[4],trProps[5],trProps[12],trProps[13]);};CanvasRenderer.prototype.ctxOpacity=function(op){/*if(op === 1){
              return;
          }*/if(!(this||_global).renderConfig.clearCanvas){(this||_global).canvasContext.globalAlpha*=op<0?0:op;(this||_global).globalData.currentGlobalAlpha=(this||_global).contextData.cO;return;}(this||_global).contextData.cO*=op<0?0:op;if((this||_global).globalData.currentGlobalAlpha!==(this||_global).contextData.cO){(this||_global).canvasContext.globalAlpha=(this||_global).contextData.cO;(this||_global).globalData.currentGlobalAlpha=(this||_global).contextData.cO;}};CanvasRenderer.prototype.reset=function(){if(!(this||_global).renderConfig.clearCanvas){(this||_global).canvasContext.restore();return;}(this||_global).contextData.reset();};CanvasRenderer.prototype.save=function(actionFlag){if(!(this||_global).renderConfig.clearCanvas){(this||_global).canvasContext.save();return;}if(actionFlag){(this||_global).canvasContext.save();}var props=(this||_global).contextData.cTr.props;if((this||_global).contextData._length<=(this||_global).contextData.cArrPos){(this||_global).contextData.duplicate();}var i,arr=(this||_global).contextData.saved[(this||_global).contextData.cArrPos];for(i=0;i<16;i+=1){arr[i]=props[i];}(this||_global).contextData.savedOp[(this||_global).contextData.cArrPos]=(this||_global).contextData.cO;(this||_global).contextData.cArrPos+=1;};CanvasRenderer.prototype.restore=function(actionFlag){if(!(this||_global).renderConfig.clearCanvas){(this||_global).canvasContext.restore();return;}if(actionFlag){(this||_global).canvasContext.restore();(this||_global).globalData.blendMode="source-over";}(this||_global).contextData.cArrPos-=1;var popped=(this||_global).contextData.saved[(this||_global).contextData.cArrPos];var i,arr=(this||_global).contextData.cTr.props;for(i=0;i<16;i+=1){arr[i]=popped[i];}(this||_global).canvasContext.setTransform(popped[0],popped[1],popped[4],popped[5],popped[12],popped[13]);popped=(this||_global).contextData.savedOp[(this||_global).contextData.cArrPos];(this||_global).contextData.cO=popped;if((this||_global).globalData.currentGlobalAlpha!==popped){(this||_global).canvasContext.globalAlpha=popped;(this||_global).globalData.currentGlobalAlpha=popped;}};CanvasRenderer.prototype.configAnimation=function(animData){if((this||_global).animationItem.wrapper){(this||_global).animationItem.container=createTag("canvas");(this||_global).animationItem.container.style.width="100%";(this||_global).animationItem.container.style.height="100%";//this.animationItem.container.style.transform = 'translate3d(0,0,0)';
//this.animationItem.container.style.webkitTransform = 'translate3d(0,0,0)';
(this||_global).animationItem.container.style.transformOrigin=(this||_global).animationItem.container.style.mozTransformOrigin=(this||_global).animationItem.container.style.webkitTransformOrigin=(this||_global).animationItem.container.style["-webkit-transform"]="0px 0px 0px";(this||_global).animationItem.wrapper.appendChild((this||_global).animationItem.container);(this||_global).canvasContext=(this||_global).animationItem.container.getContext("2d");if((this||_global).renderConfig.className){(this||_global).animationItem.container.setAttribute("class",(this||_global).renderConfig.className);}if((this||_global).renderConfig.id){(this||_global).animationItem.container.setAttribute("id",(this||_global).renderConfig.id);}}else{(this||_global).canvasContext=(this||_global).renderConfig.context;}(this||_global).data=animData;(this||_global).layers=animData.layers;(this||_global).transformCanvas={w:animData.w,h:animData.h,sx:0,sy:0,tx:0,ty:0};this.setupGlobalData(animData,document.body);(this||_global).globalData.canvasContext=(this||_global).canvasContext;(this||_global).globalData.renderer=this||_global;(this||_global).globalData.isDashed=false;(this||_global).globalData.progressiveLoad=(this||_global).renderConfig.progressiveLoad;(this||_global).globalData.transformCanvas=(this||_global).transformCanvas;(this||_global).elements=createSizedArray(animData.layers.length);this.updateContainerSize();};CanvasRenderer.prototype.updateContainerSize=function(){this.reset();var elementWidth,elementHeight;if((this||_global).animationItem.wrapper&&(this||_global).animationItem.container){elementWidth=(this||_global).animationItem.wrapper.offsetWidth;elementHeight=(this||_global).animationItem.wrapper.offsetHeight;(this||_global).animationItem.container.setAttribute("width",elementWidth*(this||_global).renderConfig.dpr);(this||_global).animationItem.container.setAttribute("height",elementHeight*(this||_global).renderConfig.dpr);}else{elementWidth=(this||_global).canvasContext.canvas.width*(this||_global).renderConfig.dpr;elementHeight=(this||_global).canvasContext.canvas.height*(this||_global).renderConfig.dpr;}var elementRel,animationRel;if((this||_global).renderConfig.preserveAspectRatio.indexOf("meet")!==-1||(this||_global).renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var par=(this||_global).renderConfig.preserveAspectRatio.split(" ");var fillType=par[1]||"meet";var pos=par[0]||"xMidYMid";var xPos=pos.substr(0,4);var yPos=pos.substr(4);elementRel=elementWidth/elementHeight;animationRel=(this||_global).transformCanvas.w/(this||_global).transformCanvas.h;if(animationRel>elementRel&&fillType==="meet"||animationRel<elementRel&&fillType==="slice"){(this||_global).transformCanvas.sx=elementWidth/((this||_global).transformCanvas.w/(this||_global).renderConfig.dpr);(this||_global).transformCanvas.sy=elementWidth/((this||_global).transformCanvas.w/(this||_global).renderConfig.dpr);}else{(this||_global).transformCanvas.sx=elementHeight/((this||_global).transformCanvas.h/(this||_global).renderConfig.dpr);(this||_global).transformCanvas.sy=elementHeight/((this||_global).transformCanvas.h/(this||_global).renderConfig.dpr);}if(xPos==="xMid"&&(animationRel<elementRel&&fillType==="meet"||animationRel>elementRel&&fillType==="slice")){(this||_global).transformCanvas.tx=(elementWidth-(this||_global).transformCanvas.w*(elementHeight/(this||_global).transformCanvas.h))/2*(this||_global).renderConfig.dpr;}else if(xPos==="xMax"&&(animationRel<elementRel&&fillType==="meet"||animationRel>elementRel&&fillType==="slice")){(this||_global).transformCanvas.tx=(elementWidth-(this||_global).transformCanvas.w*(elementHeight/(this||_global).transformCanvas.h))*(this||_global).renderConfig.dpr;}else{(this||_global).transformCanvas.tx=0;}if(yPos==="YMid"&&(animationRel>elementRel&&fillType==="meet"||animationRel<elementRel&&fillType==="slice")){(this||_global).transformCanvas.ty=(elementHeight-(this||_global).transformCanvas.h*(elementWidth/(this||_global).transformCanvas.w))/2*(this||_global).renderConfig.dpr;}else if(yPos==="YMax"&&(animationRel>elementRel&&fillType==="meet"||animationRel<elementRel&&fillType==="slice")){(this||_global).transformCanvas.ty=(elementHeight-(this||_global).transformCanvas.h*(elementWidth/(this||_global).transformCanvas.w))*(this||_global).renderConfig.dpr;}else{(this||_global).transformCanvas.ty=0;}}else if((this||_global).renderConfig.preserveAspectRatio=="none"){(this||_global).transformCanvas.sx=elementWidth/((this||_global).transformCanvas.w/(this||_global).renderConfig.dpr);(this||_global).transformCanvas.sy=elementHeight/((this||_global).transformCanvas.h/(this||_global).renderConfig.dpr);(this||_global).transformCanvas.tx=0;(this||_global).transformCanvas.ty=0;}else{(this||_global).transformCanvas.sx=(this||_global).renderConfig.dpr;(this||_global).transformCanvas.sy=(this||_global).renderConfig.dpr;(this||_global).transformCanvas.tx=0;(this||_global).transformCanvas.ty=0;}(this||_global).transformCanvas.props=[(this||_global).transformCanvas.sx,0,0,0,0,(this||_global).transformCanvas.sy,0,0,0,0,1,0,(this||_global).transformCanvas.tx,(this||_global).transformCanvas.ty,0,1];/*var i, len = this.elements.length;
          for(i=0;i<len;i+=1){
              if(this.elements[i] && this.elements[i].data.ty === 0){
                  this.elements[i].resize(this.globalData.transformCanvas);
              }
          }*/this.ctxTransform((this||_global).transformCanvas.props);(this||_global).canvasContext.beginPath();(this||_global).canvasContext.rect(0,0,(this||_global).transformCanvas.w,(this||_global).transformCanvas.h);(this||_global).canvasContext.closePath();(this||_global).canvasContext.clip();this.renderFrame((this||_global).renderedFrame,true);};CanvasRenderer.prototype.destroy=function(){if((this||_global).renderConfig.clearCanvas&&(this||_global).animationItem.wrapper){(this||_global).animationItem.wrapper.innerText="";}var i,len=(this||_global).layers?(this||_global).layers.length:0;for(i=len-1;i>=0;i-=1){if((this||_global).elements[i]){(this||_global).elements[i].destroy();}}(this||_global).elements.length=0;(this||_global).globalData.canvasContext=null;(this||_global).animationItem.container=null;(this||_global).destroyed=true;};CanvasRenderer.prototype.renderFrame=function(num,forceRender){if((this||_global).renderedFrame===num&&(this||_global).renderConfig.clearCanvas===true&&!forceRender||(this||_global).destroyed||num===-1){return;}(this||_global).renderedFrame=num;(this||_global).globalData.frameNum=num-(this||_global).animationItem._isFirstFrame;(this||_global).globalData.frameId+=1;(this||_global).globalData._mdf=!(this||_global).renderConfig.clearCanvas||forceRender;(this||_global).globalData.projectInterface.currentFrame=num;// console.log('--------');
// console.log('NEW: ',num);
var i,len=(this||_global).layers.length;if(!(this||_global).completeLayers){this.checkLayers(num);}for(i=0;i<len;i++){if((this||_global).completeLayers||(this||_global).elements[i]){(this||_global).elements[i].prepareFrame(num-(this||_global).layers[i].st);}}if((this||_global).globalData._mdf){if((this||_global).renderConfig.clearCanvas===true){(this||_global).canvasContext.clearRect(0,0,(this||_global).transformCanvas.w,(this||_global).transformCanvas.h);}else{this.save();}for(i=len-1;i>=0;i-=1){if((this||_global).completeLayers||(this||_global).elements[i]){(this||_global).elements[i].renderFrame();}}if((this||_global).renderConfig.clearCanvas!==true){this.restore();}}};CanvasRenderer.prototype.buildItem=function(pos){var elements=(this||_global).elements;if(elements[pos]||(this||_global).layers[pos].ty==99){return;}var element=this.createItem((this||_global).layers[pos],this||_global,(this||_global).globalData);elements[pos]=element;element.initExpressions();/*if(this.layers[pos].ty === 0){
              element.resize(this.globalData.transformCanvas);
          }*/};CanvasRenderer.prototype.checkPendingElements=function(){while((this||_global).pendingElements.length){var element=(this||_global).pendingElements.pop();element.checkParenting();}};CanvasRenderer.prototype.hide=function(){(this||_global).animationItem.container.style.display="none";};CanvasRenderer.prototype.show=function(){(this||_global).animationItem.container.style.display="block";};function HybridRenderer(animationItem,config){(this||_global).animationItem=animationItem;(this||_global).layers=null;(this||_global).renderedFrame=-1;(this||_global).renderConfig={className:config&&config.className||"",imagePreserveAspectRatio:config&&config.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:config&&config.hideOnTransparent===false?false:true,filterSize:{width:config&&config.filterSize&&config.filterSize.width||"400%",height:config&&config.filterSize&&config.filterSize.height||"400%",x:config&&config.filterSize&&config.filterSize.x||"-100%",y:config&&config.filterSize&&config.filterSize.y||"-100%"}};(this||_global).globalData={_mdf:false,frameNum:-1,renderConfig:(this||_global).renderConfig};(this||_global).pendingElements=[];(this||_global).elements=[];(this||_global).threeDElements=[];(this||_global).destroyed=false;(this||_global).camera=null;(this||_global).supports3d=true;(this||_global).rendererType="html";}extendPrototype([BaseRenderer],HybridRenderer);HybridRenderer.prototype.buildItem=SVGRenderer.prototype.buildItem;HybridRenderer.prototype.checkPendingElements=function(){while((this||_global).pendingElements.length){var element=(this||_global).pendingElements.pop();element.checkParenting();}};HybridRenderer.prototype.appendElementInPos=function(element,pos){var newDOMElement=element.getBaseElement();if(!newDOMElement){return;}var layer=(this||_global).layers[pos];if(!layer.ddd||!(this||_global).supports3d){if((this||_global).threeDElements){this.addTo3dContainer(newDOMElement,pos);}else{var i=0;var nextDOMElement,nextLayer,tmpDOMElement;while(i<pos){if((this||_global).elements[i]&&(this||_global).elements[i]!==true&&(this||_global).elements[i].getBaseElement){nextLayer=(this||_global).elements[i];tmpDOMElement=(this||_global).layers[i].ddd?this.getThreeDContainerByPos(i):nextLayer.getBaseElement();nextDOMElement=tmpDOMElement||nextDOMElement;}i+=1;}if(nextDOMElement){if(!layer.ddd||!(this||_global).supports3d){(this||_global).layerElement.insertBefore(newDOMElement,nextDOMElement);}}else{if(!layer.ddd||!(this||_global).supports3d){(this||_global).layerElement.appendChild(newDOMElement);}}}}else{this.addTo3dContainer(newDOMElement,pos);}};HybridRenderer.prototype.createShape=function(data){if(!(this||_global).supports3d){return new SVGShapeElement(data,(this||_global).globalData,this||_global);}return new HShapeElement(data,(this||_global).globalData,this||_global);};HybridRenderer.prototype.createText=function(data){if(!(this||_global).supports3d){return new SVGTextElement(data,(this||_global).globalData,this||_global);}return new HTextElement(data,(this||_global).globalData,this||_global);};HybridRenderer.prototype.createCamera=function(data){(this||_global).camera=new HCameraElement(data,(this||_global).globalData,this||_global);return(this||_global).camera;};HybridRenderer.prototype.createImage=function(data){if(!(this||_global).supports3d){return new IImageElement(data,(this||_global).globalData,this||_global);}return new HImageElement(data,(this||_global).globalData,this||_global);};HybridRenderer.prototype.createComp=function(data){if(!(this||_global).supports3d){return new SVGCompElement(data,(this||_global).globalData,this||_global);}return new HCompElement(data,(this||_global).globalData,this||_global);};HybridRenderer.prototype.createSolid=function(data){if(!(this||_global).supports3d){return new ISolidElement(data,(this||_global).globalData,this||_global);}return new HSolidElement(data,(this||_global).globalData,this||_global);};HybridRenderer.prototype.createNull=SVGRenderer.prototype.createNull;HybridRenderer.prototype.getThreeDContainerByPos=function(pos){var i=0,len=(this||_global).threeDElements.length;while(i<len){if((this||_global).threeDElements[i].startPos<=pos&&(this||_global).threeDElements[i].endPos>=pos){return(this||_global).threeDElements[i].perspectiveElem;}i+=1;}};HybridRenderer.prototype.createThreeDContainer=function(pos,type){var perspectiveElem=createTag("div");styleDiv(perspectiveElem);var container=createTag("div");styleDiv(container);if(type==="3d"){perspectiveElem.style.width=(this||_global).globalData.compSize.w+"px";perspectiveElem.style.height=(this||_global).globalData.compSize.h+"px";perspectiveElem.style.transformOrigin=perspectiveElem.style.mozTransformOrigin=perspectiveElem.style.webkitTransformOrigin="50% 50%";container.style.transform=container.style.webkitTransform="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";}perspectiveElem.appendChild(container);//this.resizerElem.appendChild(perspectiveElem);
var threeDContainerData={container:container,perspectiveElem:perspectiveElem,startPos:pos,endPos:pos,type:type};(this||_global).threeDElements.push(threeDContainerData);return threeDContainerData;};HybridRenderer.prototype.build3dContainers=function(){var i,len=(this||_global).layers.length;var lastThreeDContainerData;var currentContainer="";for(i=0;i<len;i+=1){if((this||_global).layers[i].ddd&&(this||_global).layers[i].ty!==3){if(currentContainer!=="3d"){currentContainer="3d";lastThreeDContainerData=this.createThreeDContainer(i,"3d");}lastThreeDContainerData.endPos=Math.max(lastThreeDContainerData.endPos,i);}else{if(currentContainer!=="2d"){currentContainer="2d";lastThreeDContainerData=this.createThreeDContainer(i,"2d");}lastThreeDContainerData.endPos=Math.max(lastThreeDContainerData.endPos,i);}}len=(this||_global).threeDElements.length;for(i=len-1;i>=0;i--){(this||_global).resizerElem.appendChild((this||_global).threeDElements[i].perspectiveElem);}};HybridRenderer.prototype.addTo3dContainer=function(elem,pos){var i=0,len=(this||_global).threeDElements.length;while(i<len){if(pos<=(this||_global).threeDElements[i].endPos){var j=(this||_global).threeDElements[i].startPos;var nextElement;while(j<pos){if((this||_global).elements[j]&&(this||_global).elements[j].getBaseElement){nextElement=(this||_global).elements[j].getBaseElement();}j+=1;}if(nextElement){(this||_global).threeDElements[i].container.insertBefore(elem,nextElement);}else{(this||_global).threeDElements[i].container.appendChild(elem);}break;}i+=1;}};HybridRenderer.prototype.configAnimation=function(animData){var resizerElem=createTag("div");var wrapper=(this||_global).animationItem.wrapper;resizerElem.style.width=animData.w+"px";resizerElem.style.height=animData.h+"px";(this||_global).resizerElem=resizerElem;styleDiv(resizerElem);resizerElem.style.transformStyle=resizerElem.style.webkitTransformStyle=resizerElem.style.mozTransformStyle="flat";if((this||_global).renderConfig.className){resizerElem.setAttribute("class",(this||_global).renderConfig.className);}wrapper.appendChild(resizerElem);resizerElem.style.overflow="hidden";var svg=createNS("svg");svg.setAttribute("width","1");svg.setAttribute("height","1");styleDiv(svg);(this||_global).resizerElem.appendChild(svg);var defs=createNS("defs");svg.appendChild(defs);(this||_global).data=animData;//Mask animation
this.setupGlobalData(animData,svg);(this||_global).globalData.defs=defs;(this||_global).layers=animData.layers;(this||_global).layerElement=(this||_global).resizerElem;this.build3dContainers();this.updateContainerSize();};HybridRenderer.prototype.destroy=function(){if((this||_global).animationItem.wrapper){(this||_global).animationItem.wrapper.innerText="";}(this||_global).animationItem.container=null;(this||_global).globalData.defs=null;var i,len=(this||_global).layers?(this||_global).layers.length:0;for(i=0;i<len;i++){(this||_global).elements[i].destroy();}(this||_global).elements.length=0;(this||_global).destroyed=true;(this||_global).animationItem=null;};HybridRenderer.prototype.updateContainerSize=function(){var elementWidth=(this||_global).animationItem.wrapper.offsetWidth;var elementHeight=(this||_global).animationItem.wrapper.offsetHeight;var elementRel=elementWidth/elementHeight;var animationRel=(this||_global).globalData.compSize.w/(this||_global).globalData.compSize.h;var sx,sy,tx,ty;if(animationRel>elementRel){sx=elementWidth/(this||_global).globalData.compSize.w;sy=elementWidth/(this||_global).globalData.compSize.w;tx=0;ty=(elementHeight-(this||_global).globalData.compSize.h*(elementWidth/(this||_global).globalData.compSize.w))/2;}else{sx=elementHeight/(this||_global).globalData.compSize.h;sy=elementHeight/(this||_global).globalData.compSize.h;tx=(elementWidth-(this||_global).globalData.compSize.w*(elementHeight/(this||_global).globalData.compSize.h))/2;ty=0;}(this||_global).resizerElem.style.transform=(this||_global).resizerElem.style.webkitTransform="matrix3d("+sx+",0,0,0,0,"+sy+",0,0,0,0,1,0,"+tx+","+ty+",0,1)";};HybridRenderer.prototype.renderFrame=SVGRenderer.prototype.renderFrame;HybridRenderer.prototype.hide=function(){(this||_global).resizerElem.style.display="none";};HybridRenderer.prototype.show=function(){(this||_global).resizerElem.style.display="block";};HybridRenderer.prototype.initItems=function(){this.buildAllItems();if((this||_global).camera){(this||_global).camera.setup();}else{var cWidth=(this||_global).globalData.compSize.w;var cHeight=(this||_global).globalData.compSize.h;var i,len=(this||_global).threeDElements.length;for(i=0;i<len;i+=1){(this||_global).threeDElements[i].perspectiveElem.style.perspective=(this||_global).threeDElements[i].perspectiveElem.style.webkitPerspective=Math.sqrt(Math.pow(cWidth,2)+Math.pow(cHeight,2))+"px";}}};HybridRenderer.prototype.searchExtraCompositions=function(assets){var i,len=assets.length;var floatingContainer=createTag("div");for(i=0;i<len;i+=1){if(assets[i].xt){var comp=this.createComp(assets[i],floatingContainer,(this||_global).globalData.comp,null);comp.initExpressions();(this||_global).globalData.projectInterface.registerComposition(comp);}}};function MaskElement(data,element,globalData){(this||_global).data=data;(this||_global).element=element;(this||_global).globalData=globalData;(this||_global).storedData=[];(this||_global).masksProperties=(this||_global).data.masksProperties||[];(this||_global).maskElement=null;var defs=(this||_global).globalData.defs;var i,len=(this||_global).masksProperties?(this||_global).masksProperties.length:0;(this||_global).viewData=createSizedArray(len);(this||_global).solidPath="";var path,properties=(this||_global).masksProperties;var count=0;var currentMasks=[];var j,jLen;var layerId=createElementID();var rect,expansor,feMorph,x;var maskType="clipPath",maskRef="clip-path";for(i=0;i<len;i++){if(properties[i].mode!=="a"&&properties[i].mode!=="n"||properties[i].inv||properties[i].o.k!==100||properties[i].o.x){maskType="mask";maskRef="mask";}if((properties[i].mode=="s"||properties[i].mode=="i")&&count===0){rect=createNS("rect");rect.setAttribute("fill","#ffffff");rect.setAttribute("width",(this||_global).element.comp.data.w||0);rect.setAttribute("height",(this||_global).element.comp.data.h||0);currentMasks.push(rect);}else{rect=null;}path=createNS("path");if(properties[i].mode=="n"){// TODO move this to a factory or to a constructor
(this||_global).viewData[i]={op:PropertyFactory.getProp((this||_global).element,properties[i].o,0,0.01,(this||_global).element),prop:ShapePropertyFactory.getShapeProp((this||_global).element,properties[i],3),elem:path,lastPath:""};defs.appendChild(path);continue;}count+=1;path.setAttribute("fill",properties[i].mode==="s"?"#000000":"#ffffff");path.setAttribute("clip-rule","nonzero");var filterID;if(properties[i].x.k!==0){maskType="mask";maskRef="mask";x=PropertyFactory.getProp((this||_global).element,properties[i].x,0,null,(this||_global).element);filterID=createElementID();expansor=createNS("filter");expansor.setAttribute("id",filterID);feMorph=createNS("feMorphology");feMorph.setAttribute("operator","erode");feMorph.setAttribute("in","SourceGraphic");feMorph.setAttribute("radius","0");expansor.appendChild(feMorph);defs.appendChild(expansor);path.setAttribute("stroke",properties[i].mode==="s"?"#000000":"#ffffff");}else{feMorph=null;x=null;}// TODO move this to a factory or to a constructor
(this||_global).storedData[i]={elem:path,x:x,expan:feMorph,lastPath:"",lastOperator:"",filterId:filterID,lastRadius:0};if(properties[i].mode=="i"){jLen=currentMasks.length;var g=createNS("g");for(j=0;j<jLen;j+=1){g.appendChild(currentMasks[j]);}var mask=createNS("mask");mask.setAttribute("mask-type","alpha");mask.setAttribute("id",layerId+"_"+count);mask.appendChild(path);defs.appendChild(mask);g.setAttribute("mask","url("+locationHref+"#"+layerId+"_"+count+")");currentMasks.length=0;currentMasks.push(g);}else{currentMasks.push(path);}if(properties[i].inv&&!(this||_global).solidPath){(this||_global).solidPath=this.createLayerSolidPath();}// TODO move this to a factory or to a constructor
(this||_global).viewData[i]={elem:path,lastPath:"",op:PropertyFactory.getProp((this||_global).element,properties[i].o,0,0.01,(this||_global).element),prop:ShapePropertyFactory.getShapeProp((this||_global).element,properties[i],3),invRect:rect};if(!(this||_global).viewData[i].prop.k){this.drawPath(properties[i],(this||_global).viewData[i].prop.v,(this||_global).viewData[i]);}}(this||_global).maskElement=createNS(maskType);len=currentMasks.length;for(i=0;i<len;i+=1){(this||_global).maskElement.appendChild(currentMasks[i]);}if(count>0){(this||_global).maskElement.setAttribute("id",layerId);(this||_global).element.maskedElement.setAttribute(maskRef,"url("+locationHref+"#"+layerId+")");defs.appendChild((this||_global).maskElement);}if((this||_global).viewData.length){(this||_global).element.addRenderableComponent(this||_global);}}MaskElement.prototype.getMaskProperty=function(pos){return(this||_global).viewData[pos].prop;};MaskElement.prototype.renderFrame=function(isFirstFrame){var finalMat=(this||_global).element.finalTransform.mat;var i,len=(this||_global).masksProperties.length;for(i=0;i<len;i++){if((this||_global).viewData[i].prop._mdf||isFirstFrame){this.drawPath((this||_global).masksProperties[i],(this||_global).viewData[i].prop.v,(this||_global).viewData[i]);}if((this||_global).viewData[i].op._mdf||isFirstFrame){(this||_global).viewData[i].elem.setAttribute("fill-opacity",(this||_global).viewData[i].op.v);}if((this||_global).masksProperties[i].mode!=="n"){if((this||_global).viewData[i].invRect&&((this||_global).element.finalTransform.mProp._mdf||isFirstFrame)){(this||_global).viewData[i].invRect.setAttribute("transform",finalMat.getInverseMatrix().to2dCSS());}if((this||_global).storedData[i].x&&((this||_global).storedData[i].x._mdf||isFirstFrame)){var feMorph=(this||_global).storedData[i].expan;if((this||_global).storedData[i].x.v<0){if((this||_global).storedData[i].lastOperator!=="erode"){(this||_global).storedData[i].lastOperator="erode";(this||_global).storedData[i].elem.setAttribute("filter","url("+locationHref+"#"+(this||_global).storedData[i].filterId+")");}feMorph.setAttribute("radius",-(this||_global).storedData[i].x.v);}else{if((this||_global).storedData[i].lastOperator!=="dilate"){(this||_global).storedData[i].lastOperator="dilate";(this||_global).storedData[i].elem.setAttribute("filter",null);}(this||_global).storedData[i].elem.setAttribute("stroke-width",(this||_global).storedData[i].x.v*2);}}}}};MaskElement.prototype.getMaskelement=function(){return(this||_global).maskElement;};MaskElement.prototype.createLayerSolidPath=function(){var path="M0,0 ";path+=" h"+(this||_global).globalData.compSize.w;path+=" v"+(this||_global).globalData.compSize.h;path+=" h-"+(this||_global).globalData.compSize.w;path+=" v-"+(this||_global).globalData.compSize.h+" ";return path;};MaskElement.prototype.drawPath=function(pathData,pathNodes,viewData){var pathString=" M"+pathNodes.v[0][0]+","+pathNodes.v[0][1];var i,len;len=pathNodes._length;for(i=1;i<len;i+=1){//pathString += " C"+pathNodes.o[i-1][0]+','+pathNodes.o[i-1][1] + " "+pathNodes.i[i][0]+','+pathNodes.i[i][1] + " "+pathNodes.v[i][0]+','+pathNodes.v[i][1];
pathString+=" C"+pathNodes.o[i-1][0]+","+pathNodes.o[i-1][1]+" "+pathNodes.i[i][0]+","+pathNodes.i[i][1]+" "+pathNodes.v[i][0]+","+pathNodes.v[i][1];}//pathString += " C"+pathNodes.o[i-1][0]+','+pathNodes.o[i-1][1] + " "+pathNodes.i[0][0]+','+pathNodes.i[0][1] + " "+pathNodes.v[0][0]+','+pathNodes.v[0][1];
if(pathNodes.c&&len>1){pathString+=" C"+pathNodes.o[i-1][0]+","+pathNodes.o[i-1][1]+" "+pathNodes.i[0][0]+","+pathNodes.i[0][1]+" "+pathNodes.v[0][0]+","+pathNodes.v[0][1];}//pathNodes.__renderedString = pathString;
if(viewData.lastPath!==pathString){var pathShapeValue="";if(viewData.elem){if(pathNodes.c){pathShapeValue=pathData.inv?(this||_global).solidPath+pathString:pathString;}viewData.elem.setAttribute("d",pathShapeValue);}viewData.lastPath=pathString;}};MaskElement.prototype.destroy=function(){(this||_global).element=null;(this||_global).globalData=null;(this||_global).maskElement=null;(this||_global).data=null;(this||_global).masksProperties=null;};/**
         * @file 
         * Handles AE's layer parenting property.
         *
         */function HierarchyElement(){}HierarchyElement.prototype={/**
              * @function 
              * Initializes hierarchy properties
              *
              */initHierarchy:function initHierarchy(){//element's parent list
(this||_global).hierarchy=[];//if element is parent of another layer _isParent will be true
(this||_global)._isParent=false;this.checkParenting();},/**
              * @function 
              * Sets layer's hierarchy.
              * @param {array} hierarch
              * layer's parent list
              *
              */setHierarchy:function setHierarchy(hierarchy){(this||_global).hierarchy=hierarchy;},/**
              * @function 
              * Sets layer as parent.
              *
              */setAsParent:function setAsParent(){(this||_global)._isParent=true;},/**
              * @function 
              * Searches layer's parenting chain
              *
              */checkParenting:function checkParenting(){if((this||_global).data.parent!==undefined){(this||_global).comp.buildElementParenting(this||_global,(this||_global).data.parent,[]);}}};/**
         * @file 
         * Handles element's layer frame update.
         * Checks layer in point and out point
         *
         */function FrameElement(){}FrameElement.prototype={/**
           * @function 
           * Initializes frame related properties.
           *
           */initFrame:function initFrame(){//set to true when inpoint is rendered
(this||_global)._isFirstFrame=false;//list of animated properties
(this||_global).dynamicProperties=[];// If layer has been modified in current tick this will be true
(this||_global)._mdf=false;},/**
           * @function 
           * Calculates all dynamic values
           *
           * @param {number} num
           * current frame number in Layer's time
           * @param {boolean} isVisible
           * if layers is currently in range
           * 
           */prepareProperties:function prepareProperties(num,isVisible){var i,len=(this||_global).dynamicProperties.length;for(i=0;i<len;i+=1){if(isVisible||(this||_global)._isParent&&(this||_global).dynamicProperties[i].propType==="transform"){(this||_global).dynamicProperties[i].getValue();if((this||_global).dynamicProperties[i]._mdf){(this||_global).globalData._mdf=true;(this||_global)._mdf=true;}}}},addDynamicProperty:function addDynamicProperty(prop){if((this||_global).dynamicProperties.indexOf(prop)===-1){(this||_global).dynamicProperties.push(prop);}}};function TransformElement(){}TransformElement.prototype={initTransform:function initTransform(){(this||_global).finalTransform={mProp:(this||_global).data.ks?TransformPropertyFactory.getTransformProperty(this||_global,(this||_global).data.ks,this||_global):{o:0},_matMdf:false,_opMdf:false,mat:new Matrix()};if((this||_global).data.ao){(this||_global).finalTransform.mProp.autoOriented=true;}//TODO: check TYPE 11: Guided elements
if((this||_global).data.ty!==11);},renderTransform:function renderTransform(){(this||_global).finalTransform._opMdf=(this||_global).finalTransform.mProp.o._mdf||(this||_global)._isFirstFrame;(this||_global).finalTransform._matMdf=(this||_global).finalTransform.mProp._mdf||(this||_global)._isFirstFrame;if((this||_global).hierarchy){var mat;var finalMat=(this||_global).finalTransform.mat;var i=0,len=(this||_global).hierarchy.length;//Checking if any of the transformation matrices in the hierarchy chain has changed.
if(!(this||_global).finalTransform._matMdf){while(i<len){if((this||_global).hierarchy[i].finalTransform.mProp._mdf){(this||_global).finalTransform._matMdf=true;break;}i+=1;}}if((this||_global).finalTransform._matMdf){mat=(this||_global).finalTransform.mProp.v.props;finalMat.cloneFromProps(mat);for(i=0;i<len;i+=1){mat=(this||_global).hierarchy[i].finalTransform.mProp.v.props;finalMat.transform(mat[0],mat[1],mat[2],mat[3],mat[4],mat[5],mat[6],mat[7],mat[8],mat[9],mat[10],mat[11],mat[12],mat[13],mat[14],mat[15]);}}}},globalToLocal:function globalToLocal(pt){var transforms=[];transforms.push((this||_global).finalTransform);var flag=true;var comp=(this||_global).comp;while(flag){if(comp.finalTransform){if(comp.data.hasMask){transforms.splice(0,0,comp.finalTransform);}comp=comp.comp;}else{flag=false;}}var i,len=transforms.length,ptNew;for(i=0;i<len;i+=1){ptNew=transforms[i].mat.applyToPointArray(0,0,0);//ptNew = transforms[i].mat.applyToPointArray(pt[0],pt[1],pt[2]);
pt=[pt[0]-ptNew[0],pt[1]-ptNew[1],0];}return pt;},mHelper:new Matrix()};function RenderableElement(){}RenderableElement.prototype={initRenderable:function initRenderable(){//layer's visibility related to inpoint and outpoint. Rename isVisible to isInRange
(this||_global).isInRange=false;//layer's display state
(this||_global).hidden=false;// If layer's transparency equals 0, it can be hidden
(this||_global).isTransparent=false;//list of animated components
(this||_global).renderableComponents=[];},addRenderableComponent:function addRenderableComponent(component){if((this||_global).renderableComponents.indexOf(component)===-1){(this||_global).renderableComponents.push(component);}},removeRenderableComponent:function removeRenderableComponent(component){if((this||_global).renderableComponents.indexOf(component)!==-1){(this||_global).renderableComponents.splice((this||_global).renderableComponents.indexOf(component),1);}},prepareRenderableFrame:function prepareRenderableFrame(num){this.checkLayerLimits(num);},checkTransparency:function checkTransparency(){if((this||_global).finalTransform.mProp.o.v<=0){if(!(this||_global).isTransparent&&(this||_global).globalData.renderConfig.hideOnTransparent){(this||_global).isTransparent=true;this.hide();}}else if((this||_global).isTransparent){(this||_global).isTransparent=false;this.show();}},/**
           * @function 
           * Initializes frame related properties.
           *
           * @param {number} num
           * current frame number in Layer's time
           * 
           */checkLayerLimits:function checkLayerLimits(num){if((this||_global).data.ip-(this||_global).data.st<=num&&(this||_global).data.op-(this||_global).data.st>num){if((this||_global).isInRange!==true){(this||_global).globalData._mdf=true;(this||_global)._mdf=true;(this||_global).isInRange=true;this.show();}}else{if((this||_global).isInRange!==false){(this||_global).globalData._mdf=true;(this||_global).isInRange=false;this.hide();}}},renderRenderable:function renderRenderable(){var i,len=(this||_global).renderableComponents.length;for(i=0;i<len;i+=1){(this||_global).renderableComponents[i].renderFrame((this||_global)._isFirstFrame);}/*this.maskManager.renderFrame(this.finalTransform.mat);
            this.renderableEffectsManager.renderFrame(this._isFirstFrame);*/},sourceRectAtTime:function sourceRectAtTime(){return{top:0,left:0,width:100,height:100};},getLayerSize:function getLayerSize(){if((this||_global).data.ty===5){return{w:(this||_global).data.textData.width,h:(this||_global).data.textData.height};}else{return{w:(this||_global).data.width,h:(this||_global).data.height};}}};function RenderableDOMElement(){}(function(){var _prototype={initElement:function initElement(data,globalData,comp){this.initFrame();this.initBaseData(data,globalData,comp);this.initTransform(data,globalData,comp);this.initHierarchy();this.initRenderable();this.initRendererElement();this.createContainerElements();this.createRenderableComponents();this.createContent();this.hide();},hide:function hide(){if(!(this||_global).hidden&&(!(this||_global).isInRange||(this||_global).isTransparent)){var elem=(this||_global).baseElement||(this||_global).layerElement;elem.style.display="none";(this||_global).hidden=true;}},show:function show(){if((this||_global).isInRange&&!(this||_global).isTransparent){if(!(this||_global).data.hd){var elem=(this||_global).baseElement||(this||_global).layerElement;elem.style.display="block";}(this||_global).hidden=false;(this||_global)._isFirstFrame=true;}},renderFrame:function renderFrame(){//If it is exported as hidden (data.hd === true) no need to render
//If it is not visible no need to render
if((this||_global).data.hd||(this||_global).hidden){return;}this.renderTransform();this.renderRenderable();this.renderElement();this.renderInnerContent();if((this||_global)._isFirstFrame){(this||_global)._isFirstFrame=false;}},renderInnerContent:function renderInnerContent(){},prepareFrame:function prepareFrame(num){(this||_global)._mdf=false;this.prepareRenderableFrame(num);this.prepareProperties(num,(this||_global).isInRange);this.checkTransparency();},destroy:function destroy(){(this||_global).innerElem=null;this.destroyBaseElement();}};extendPrototype([RenderableElement,createProxyFunction(_prototype)],RenderableDOMElement);})();function ProcessedElement(element,position){(this||_global).elem=element;(this||_global).pos=position;}function SVGStyleData(data,level){(this||_global).data=data;(this||_global).type=data.ty;(this||_global).d="";(this||_global).lvl=level;(this||_global)._mdf=false;(this||_global).closed=data.hd===true;(this||_global).pElem=createNS("path");(this||_global).msElem=null;}SVGStyleData.prototype.reset=function(){(this||_global).d="";(this||_global)._mdf=false;};function SVGShapeData(transformers,level,shape){(this||_global).caches=[];(this||_global).styles=[];(this||_global).transformers=transformers;(this||_global).lStr="";(this||_global).sh=shape;(this||_global).lvl=level;//TODO find if there are some cases where _isAnimated can be false. 
// For now, since shapes add up with other shapes. They have to be calculated every time.
// One way of finding out is checking if all styles associated to this shape depend only of this shape
(this||_global)._isAnimated=!!shape.k;// TODO: commenting this for now since all shapes are animated
var i=0,len=transformers.length;while(i<len){if(transformers[i].mProps.dynamicProperties.length){(this||_global)._isAnimated=true;break;}i+=1;}}SVGShapeData.prototype.setAsAnimated=function(){(this||_global)._isAnimated=true;};function SVGTransformData(mProps,op,container){(this||_global).transform={mProps:mProps,op:op,container:container};(this||_global).elements=[];(this||_global)._isAnimated=(this||_global).transform.mProps.dynamicProperties.length||(this||_global).transform.op.effectsSequence.length;}function SVGStrokeStyleData(elem,data,styleOb){this.initDynamicPropertyContainer(elem);(this||_global).getValue=(this||_global).iterateDynamicProperties;(this||_global).o=PropertyFactory.getProp(elem,data.o,0,0.01,this||_global);(this||_global).w=PropertyFactory.getProp(elem,data.w,0,null,this||_global);(this||_global).d=new DashProperty(elem,data.d||{},"svg",this||_global);(this||_global).c=PropertyFactory.getProp(elem,data.c,1,255,this||_global);(this||_global).style=styleOb;(this||_global)._isAnimated=!!(this||_global)._isAnimated;}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(elem,data,styleOb){this.initDynamicPropertyContainer(elem);(this||_global).getValue=(this||_global).iterateDynamicProperties;(this||_global).o=PropertyFactory.getProp(elem,data.o,0,0.01,this||_global);(this||_global).c=PropertyFactory.getProp(elem,data.c,1,255,this||_global);(this||_global).style=styleOb;}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGGradientFillStyleData(elem,data,styleOb){this.initDynamicPropertyContainer(elem);(this||_global).getValue=(this||_global).iterateDynamicProperties;this.initGradientData(elem,data,styleOb);}SVGGradientFillStyleData.prototype.initGradientData=function(elem,data,styleOb){(this||_global).o=PropertyFactory.getProp(elem,data.o,0,0.01,this||_global);(this||_global).s=PropertyFactory.getProp(elem,data.s,1,null,this||_global);(this||_global).e=PropertyFactory.getProp(elem,data.e,1,null,this||_global);(this||_global).h=PropertyFactory.getProp(elem,data.h||{k:0},0,0.01,this||_global);(this||_global).a=PropertyFactory.getProp(elem,data.a||{k:0},0,degToRads,this||_global);(this||_global).g=new GradientProperty(elem,data.g,this||_global);(this||_global).style=styleOb;(this||_global).stops=[];this.setGradientData(styleOb.pElem,data);this.setGradientOpacity(data,styleOb);(this||_global)._isAnimated=!!(this||_global)._isAnimated;};SVGGradientFillStyleData.prototype.setGradientData=function(pathElement,data){var gradientId=createElementID();var gfill=createNS(data.t===1?"linearGradient":"radialGradient");gfill.setAttribute("id",gradientId);gfill.setAttribute("spreadMethod","pad");gfill.setAttribute("gradientUnits","userSpaceOnUse");var stops=[];var stop,j,jLen;jLen=data.g.p*4;for(j=0;j<jLen;j+=4){stop=createNS("stop");gfill.appendChild(stop);stops.push(stop);}pathElement.setAttribute(data.ty==="gf"?"fill":"stroke","url("+locationHref+"#"+gradientId+")");(this||_global).gf=gfill;(this||_global).cst=stops;};SVGGradientFillStyleData.prototype.setGradientOpacity=function(data,styleOb){if((this||_global).g._hasOpacity&&!(this||_global).g._collapsable){var stop,j,jLen;var mask=createNS("mask");var maskElement=createNS("path");mask.appendChild(maskElement);var opacityId=createElementID();var maskId=createElementID();mask.setAttribute("id",maskId);var opFill=createNS(data.t===1?"linearGradient":"radialGradient");opFill.setAttribute("id",opacityId);opFill.setAttribute("spreadMethod","pad");opFill.setAttribute("gradientUnits","userSpaceOnUse");jLen=data.g.k.k[0].s?data.g.k.k[0].s.length:data.g.k.k.length;var stops=(this||_global).stops;for(j=data.g.p*4;j<jLen;j+=2){stop=createNS("stop");stop.setAttribute("stop-color","rgb(255,255,255)");opFill.appendChild(stop);stops.push(stop);}maskElement.setAttribute(data.ty==="gf"?"fill":"stroke","url("+locationHref+"#"+opacityId+")");(this||_global).of=opFill;(this||_global).ms=mask;(this||_global).ost=stops;(this||_global).maskId=maskId;styleOb.msElem=maskElement;}};extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(elem,data,styleOb){this.initDynamicPropertyContainer(elem);(this||_global).getValue=(this||_global).iterateDynamicProperties;(this||_global).w=PropertyFactory.getProp(elem,data.w,0,null,this||_global);(this||_global).d=new DashProperty(elem,data.d||{},"svg",this||_global);this.initGradientData(elem,data,styleOb);(this||_global)._isAnimated=!!(this||_global)._isAnimated;}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){(this||_global).it=[];(this||_global).prevViewData=[];(this||_global).gr=createNS("g");}var SVGElementsRenderer=function(){var _identityMatrix=new Matrix();var _matrixHelper=new Matrix();var ob={createRenderFunction:createRenderFunction};function createRenderFunction(data){var ty=data.ty;switch(data.ty){case"fl":return renderFill;case"gf":return renderGradient;case"gs":return renderGradientStroke;case"st":return renderStroke;case"sh":case"el":case"rc":case"sr":return renderPath;case"tr":return renderContentTransform;}}function renderContentTransform(styleData,itemData,isFirstFrame){if(isFirstFrame||itemData.transform.op._mdf){itemData.transform.container.setAttribute("opacity",itemData.transform.op.v);}if(isFirstFrame||itemData.transform.mProps._mdf){itemData.transform.container.setAttribute("transform",itemData.transform.mProps.v.to2dCSS());}}function renderPath(styleData,itemData,isFirstFrame){var j,jLen,pathStringTransformed,redraw,pathNodes,l,lLen=itemData.styles.length;var lvl=itemData.lvl;var paths,mat,props,iterations,k;for(l=0;l<lLen;l+=1){redraw=itemData.sh._mdf||isFirstFrame;if(itemData.styles[l].lvl<lvl){mat=_matrixHelper.reset();iterations=lvl-itemData.styles[l].lvl;k=itemData.transformers.length-1;while(!redraw&&iterations>0){redraw=itemData.transformers[k].mProps._mdf||redraw;iterations--;k--;}if(redraw){iterations=lvl-itemData.styles[l].lvl;k=itemData.transformers.length-1;while(iterations>0){props=itemData.transformers[k].mProps.v.props;mat.transform(props[0],props[1],props[2],props[3],props[4],props[5],props[6],props[7],props[8],props[9],props[10],props[11],props[12],props[13],props[14],props[15]);iterations--;k--;}}}else{mat=_identityMatrix;}paths=itemData.sh.paths;jLen=paths._length;if(redraw){pathStringTransformed="";for(j=0;j<jLen;j+=1){pathNodes=paths.shapes[j];if(pathNodes&&pathNodes._length){pathStringTransformed+=buildShapeString(pathNodes,pathNodes._length,pathNodes.c,mat);}}itemData.caches[l]=pathStringTransformed;}else{pathStringTransformed=itemData.caches[l];}itemData.styles[l].d+=styleData.hd===true?"":pathStringTransformed;itemData.styles[l]._mdf=redraw||itemData.styles[l]._mdf;}}function renderFill(styleData,itemData,isFirstFrame){var styleElem=itemData.style;if(itemData.c._mdf||isFirstFrame){styleElem.pElem.setAttribute("fill","rgb("+bm_floor(itemData.c.v[0])+","+bm_floor(itemData.c.v[1])+","+bm_floor(itemData.c.v[2])+")");}if(itemData.o._mdf||isFirstFrame){styleElem.pElem.setAttribute("fill-opacity",itemData.o.v);}}function renderGradientStroke(styleData,itemData,isFirstFrame){renderGradient(styleData,itemData,isFirstFrame);renderStroke(styleData,itemData,isFirstFrame);}function renderGradient(styleData,itemData,isFirstFrame){var gfill=itemData.gf;var hasOpacity=itemData.g._hasOpacity;var pt1=itemData.s.v,pt2=itemData.e.v;if(itemData.o._mdf||isFirstFrame){var attr=styleData.ty==="gf"?"fill-opacity":"stroke-opacity";itemData.style.pElem.setAttribute(attr,itemData.o.v);}if(itemData.s._mdf||isFirstFrame){var attr1=styleData.t===1?"x1":"cx";var attr2=attr1==="x1"?"y1":"cy";gfill.setAttribute(attr1,pt1[0]);gfill.setAttribute(attr2,pt1[1]);if(hasOpacity&&!itemData.g._collapsable){itemData.of.setAttribute(attr1,pt1[0]);itemData.of.setAttribute(attr2,pt1[1]);}}var stops,i,len,stop;if(itemData.g._cmdf||isFirstFrame){stops=itemData.cst;var cValues=itemData.g.c;len=stops.length;for(i=0;i<len;i+=1){stop=stops[i];stop.setAttribute("offset",cValues[i*4]+"%");stop.setAttribute("stop-color","rgb("+cValues[i*4+1]+","+cValues[i*4+2]+","+cValues[i*4+3]+")");}}if(hasOpacity&&(itemData.g._omdf||isFirstFrame)){var oValues=itemData.g.o;if(itemData.g._collapsable){stops=itemData.cst;}else{stops=itemData.ost;}len=stops.length;for(i=0;i<len;i+=1){stop=stops[i];if(!itemData.g._collapsable){stop.setAttribute("offset",oValues[i*2]+"%");}stop.setAttribute("stop-opacity",oValues[i*2+1]);}}if(styleData.t===1){if(itemData.e._mdf||isFirstFrame){gfill.setAttribute("x2",pt2[0]);gfill.setAttribute("y2",pt2[1]);if(hasOpacity&&!itemData.g._collapsable){itemData.of.setAttribute("x2",pt2[0]);itemData.of.setAttribute("y2",pt2[1]);}}}else{var rad;if(itemData.s._mdf||itemData.e._mdf||isFirstFrame){rad=Math.sqrt(Math.pow(pt1[0]-pt2[0],2)+Math.pow(pt1[1]-pt2[1],2));gfill.setAttribute("r",rad);if(hasOpacity&&!itemData.g._collapsable){itemData.of.setAttribute("r",rad);}}if(itemData.e._mdf||itemData.h._mdf||itemData.a._mdf||isFirstFrame){if(!rad){rad=Math.sqrt(Math.pow(pt1[0]-pt2[0],2)+Math.pow(pt1[1]-pt2[1],2));}var ang=Math.atan2(pt2[1]-pt1[1],pt2[0]-pt1[0]);var percent=itemData.h.v>=1?0.99:itemData.h.v<=-1?-0.99:itemData.h.v;var dist=rad*percent;var x=Math.cos(ang+itemData.a.v)*dist+pt1[0];var y=Math.sin(ang+itemData.a.v)*dist+pt1[1];gfill.setAttribute("fx",x);gfill.setAttribute("fy",y);if(hasOpacity&&!itemData.g._collapsable){itemData.of.setAttribute("fx",x);itemData.of.setAttribute("fy",y);}}//gfill.setAttribute('fy','200');
}}function renderStroke(styleData,itemData,isFirstFrame){var styleElem=itemData.style;var d=itemData.d;if(d&&(d._mdf||isFirstFrame)&&d.dashStr){styleElem.pElem.setAttribute("stroke-dasharray",d.dashStr);styleElem.pElem.setAttribute("stroke-dashoffset",d.dashoffset[0]);}if(itemData.c&&(itemData.c._mdf||isFirstFrame)){styleElem.pElem.setAttribute("stroke","rgb("+bm_floor(itemData.c.v[0])+","+bm_floor(itemData.c.v[1])+","+bm_floor(itemData.c.v[2])+")");}if(itemData.o._mdf||isFirstFrame){styleElem.pElem.setAttribute("stroke-opacity",itemData.o.v);}if(itemData.w._mdf||isFirstFrame){styleElem.pElem.setAttribute("stroke-width",itemData.w.v);if(styleElem.msElem){styleElem.msElem.setAttribute("stroke-width",itemData.w.v);}}}return ob;}();function ShapeTransformManager(){(this||_global).sequences={};(this||_global).sequenceList=[];(this||_global).transform_key_count=0;}ShapeTransformManager.prototype={addTransformSequence:function addTransformSequence(transforms){var i,len=transforms.length;var key="_";for(i=0;i<len;i+=1){key+=transforms[i].transform.key+"_";}var sequence=(this||_global).sequences[key];if(!sequence){sequence={transforms:[].concat(transforms),finalTransform:new Matrix(),_mdf:false};(this||_global).sequences[key]=sequence;(this||_global).sequenceList.push(sequence);}return sequence;},processSequence:function processSequence(sequence,isFirstFrame){var i=0,len=sequence.transforms.length,_mdf=isFirstFrame;while(i<len&&!isFirstFrame){if(sequence.transforms[i].transform.mProps._mdf){_mdf=true;break;}i+=1;}if(_mdf){var props;sequence.finalTransform.reset();for(i=len-1;i>=0;i-=1){props=sequence.transforms[i].transform.mProps.v.props;sequence.finalTransform.transform(props[0],props[1],props[2],props[3],props[4],props[5],props[6],props[7],props[8],props[9],props[10],props[11],props[12],props[13],props[14],props[15]);}}sequence._mdf=_mdf;},processSequences:function processSequences(isFirstFrame){var i,len=(this||_global).sequenceList.length;for(i=0;i<len;i+=1){this.processSequence((this||_global).sequenceList[i],isFirstFrame);}},getNewKey:function getNewKey(){return"_"+(this||_global).transform_key_count++;}};function CVShapeData(element,data,styles,transformsManager){(this||_global).styledShapes=[];(this||_global).tr=[0,0,0,0,0,0];var ty=4;if(data.ty=="rc"){ty=5;}else if(data.ty=="el"){ty=6;}else if(data.ty=="sr"){ty=7;}(this||_global).sh=ShapePropertyFactory.getShapeProp(element,data,ty,element);var i,len=styles.length,styledShape;for(i=0;i<len;i+=1){if(!styles[i].closed){styledShape={transforms:transformsManager.addTransformSequence(styles[i].transforms),trNodes:[]};(this||_global).styledShapes.push(styledShape);styles[i].elements.push(styledShape);}}}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function BaseElement(){}BaseElement.prototype={checkMasks:function checkMasks(){if(!(this||_global).data.hasMask){return false;}var i=0,len=(this||_global).data.masksProperties.length;while(i<len){if((this||_global).data.masksProperties[i].mode!=="n"&&(this||_global).data.masksProperties[i].cl!==false){return true;}i+=1;}return false;},initExpressions:function initExpressions(){(this||_global).layerInterface=LayerExpressionInterface(this||_global);if((this||_global).data.hasMask&&(this||_global).maskManager){(this||_global).layerInterface.registerMaskInterface((this||_global).maskManager);}var effectsInterface=EffectsExpressionInterface.createEffectsInterface(this||_global,(this||_global).layerInterface);(this||_global).layerInterface.registerEffectsInterface(effectsInterface);if((this||_global).data.ty===0||(this||_global).data.xt){(this||_global).compInterface=CompExpressionInterface(this||_global);}else if((this||_global).data.ty===4){(this||_global).layerInterface.shapeInterface=ShapeExpressionInterface((this||_global).shapesData,(this||_global).itemsData,(this||_global).layerInterface);(this||_global).layerInterface.content=(this||_global).layerInterface.shapeInterface;}else if((this||_global).data.ty===5){(this||_global).layerInterface.textInterface=TextExpressionInterface(this||_global);(this||_global).layerInterface.text=(this||_global).layerInterface.textInterface;}},setBlendMode:function setBlendMode(){var blendModeValue=getBlendMode((this||_global).data.bm);var elem=(this||_global).baseElement||(this||_global).layerElement;elem.style["mix-blend-mode"]=blendModeValue;},initBaseData:function initBaseData(data,globalData,comp){(this||_global).globalData=globalData;(this||_global).comp=comp;(this||_global).data=data;(this||_global).layerId=createElementID();//Stretch factor for old animations missing this property.
if(!(this||_global).data.sr){(this||_global).data.sr=1;}// effects manager
(this||_global).effectsManager=new EffectsManager((this||_global).data,this||_global,(this||_global).dynamicProperties);},getType:function getType(){return(this||_global).type;},sourceRectAtTime:function sourceRectAtTime(){}};function NullElement(data,globalData,comp){this.initFrame();this.initBaseData(data,globalData,comp);this.initFrame();this.initTransform(data,globalData,comp);this.initHierarchy();}NullElement.prototype.prepareFrame=function(num){this.prepareProperties(num,true);};NullElement.prototype.renderFrame=function(){};NullElement.prototype.getBaseElement=function(){return null;};NullElement.prototype.destroy=function(){};NullElement.prototype.sourceRectAtTime=function(){};NullElement.prototype.hide=function(){};extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function initRendererElement(){(this||_global).layerElement=createNS("g");},createContainerElements:function createContainerElements(){(this||_global).matteElement=createNS("g");(this||_global).transformedElement=(this||_global).layerElement;(this||_global).maskedElement=(this||_global).layerElement;(this||_global)._sizeChanged=false;var layerElementParent=null;//If this layer acts as a mask for the following layer
var filId,fil,gg;if((this||_global).data.td){if((this||_global).data.td==3||(this||_global).data.td==1){var masker=createNS("mask");masker.setAttribute("id",(this||_global).layerId);masker.setAttribute("mask-type",(this||_global).data.td==3?"luminance":"alpha");masker.appendChild((this||_global).layerElement);layerElementParent=masker;(this||_global).globalData.defs.appendChild(masker);// This is only for IE and Edge when mask if of type alpha
if(!featureSupport.maskType&&(this||_global).data.td==1){masker.setAttribute("mask-type","luminance");filId=createElementID();fil=filtersFactory.createFilter(filId);(this||_global).globalData.defs.appendChild(fil);fil.appendChild(filtersFactory.createAlphaToLuminanceFilter());gg=createNS("g");gg.appendChild((this||_global).layerElement);layerElementParent=gg;masker.appendChild(gg);gg.setAttribute("filter","url("+locationHref+"#"+filId+")");}}else if((this||_global).data.td==2){var maskGroup=createNS("mask");maskGroup.setAttribute("id",(this||_global).layerId);maskGroup.setAttribute("mask-type","alpha");var maskGrouper=createNS("g");maskGroup.appendChild(maskGrouper);filId=createElementID();fil=filtersFactory.createFilter(filId);////
// This solution doesn't work on Android when meta tag with viewport attribute is set
/*var feColorMatrix = createNS('feColorMatrix');
                feColorMatrix.setAttribute('type', 'matrix');
                feColorMatrix.setAttribute('color-interpolation-filters', 'sRGB');
                feColorMatrix.setAttribute('values','1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 -1 1');
                fil.appendChild(feColorMatrix);*/ ////
var feCTr=createNS("feComponentTransfer");feCTr.setAttribute("in","SourceGraphic");fil.appendChild(feCTr);var feFunc=createNS("feFuncA");feFunc.setAttribute("type","table");feFunc.setAttribute("tableValues","1.0 0.0");feCTr.appendChild(feFunc);////
(this||_global).globalData.defs.appendChild(fil);var alphaRect=createNS("rect");alphaRect.setAttribute("width",(this||_global).comp.data.w);alphaRect.setAttribute("height",(this||_global).comp.data.h);alphaRect.setAttribute("x","0");alphaRect.setAttribute("y","0");alphaRect.setAttribute("fill","#ffffff");alphaRect.setAttribute("opacity","0");maskGrouper.setAttribute("filter","url("+locationHref+"#"+filId+")");maskGrouper.appendChild(alphaRect);maskGrouper.appendChild((this||_global).layerElement);layerElementParent=maskGrouper;if(!featureSupport.maskType){maskGroup.setAttribute("mask-type","luminance");fil.appendChild(filtersFactory.createAlphaToLuminanceFilter());gg=createNS("g");maskGrouper.appendChild(alphaRect);gg.appendChild((this||_global).layerElement);layerElementParent=gg;maskGrouper.appendChild(gg);}(this||_global).globalData.defs.appendChild(maskGroup);}}else if((this||_global).data.tt){(this||_global).matteElement.appendChild((this||_global).layerElement);layerElementParent=(this||_global).matteElement;(this||_global).baseElement=(this||_global).matteElement;}else{(this||_global).baseElement=(this||_global).layerElement;}if((this||_global).data.ln){(this||_global).layerElement.setAttribute("id",(this||_global).data.ln);}if((this||_global).data.cl){(this||_global).layerElement.setAttribute("class",(this||_global).data.cl);}//Clipping compositions to hide content that exceeds boundaries. If collapsed transformations is on, component should not be clipped
if((this||_global).data.ty===0&&!(this||_global).data.hd){var cp=createNS("clipPath");var pt=createNS("path");pt.setAttribute("d","M0,0 L"+(this||_global).data.w+",0"+" L"+(this||_global).data.w+","+(this||_global).data.h+" L0,"+(this||_global).data.h+"z");var clipId=createElementID();cp.setAttribute("id",clipId);cp.appendChild(pt);(this||_global).globalData.defs.appendChild(cp);if(this.checkMasks()){var cpGroup=createNS("g");cpGroup.setAttribute("clip-path","url("+locationHref+"#"+clipId+")");cpGroup.appendChild((this||_global).layerElement);(this||_global).transformedElement=cpGroup;if(layerElementParent){layerElementParent.appendChild((this||_global).transformedElement);}else{(this||_global).baseElement=(this||_global).transformedElement;}}else{(this||_global).layerElement.setAttribute("clip-path","url("+locationHref+"#"+clipId+")");}}if((this||_global).data.bm!==0){this.setBlendMode();}},renderElement:function renderElement(){if((this||_global).finalTransform._matMdf){(this||_global).transformedElement.setAttribute("transform",(this||_global).finalTransform.mat.to2dCSS());}if((this||_global).finalTransform._opMdf){(this||_global).transformedElement.setAttribute("opacity",(this||_global).finalTransform.mProp.o.v);}},destroyBaseElement:function destroyBaseElement(){(this||_global).layerElement=null;(this||_global).matteElement=null;(this||_global).maskManager.destroy();},getBaseElement:function getBaseElement(){if((this||_global).data.hd){return null;}return(this||_global).baseElement;},createRenderableComponents:function createRenderableComponents(){(this||_global).maskManager=new MaskElement((this||_global).data,this||_global,(this||_global).globalData);(this||_global).renderableEffectsManager=new SVGEffects(this||_global);},setMatte:function setMatte(id){if(!(this||_global).matteElement){return;}(this||_global).matteElement.setAttribute("mask","url("+locationHref+"#"+id+")");}};function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function addShapeToModifiers(data){var i,len=(this||_global).shapeModifiers.length;for(i=0;i<len;i+=1){(this||_global).shapeModifiers[i].addShape(data);}},isShapeInAnimatedModifiers:function isShapeInAnimatedModifiers(data){var i=0,len=(this||_global).shapeModifiers.length;while(i<len){if((this||_global).shapeModifiers[i].isAnimatedWithShape(data)){return true;}}return false;},renderModifiers:function renderModifiers(){if(!(this||_global).shapeModifiers.length){return;}var i,len=(this||_global).shapes.length;for(i=0;i<len;i+=1){(this||_global).shapes[i].sh.reset();}len=(this||_global).shapeModifiers.length;for(i=len-1;i>=0;i-=1){(this||_global).shapeModifiers[i].processShapes((this||_global)._isFirstFrame);}},lcEnum:{"1":"butt","2":"round","3":"square"},ljEnum:{"1":"miter","2":"round","3":"bevel"},searchProcessedElement:function searchProcessedElement(elem){var elements=(this||_global).processedElements;var i=0,len=elements.length;while(i<len){if(elements[i].elem===elem){return elements[i].pos;}i+=1;}return 0;},addProcessedElement:function addProcessedElement(elem,pos){var elements=(this||_global).processedElements;var i=elements.length;while(i){i-=1;if(elements[i].elem===elem){elements[i].pos=pos;return;}}elements.push(new ProcessedElement(elem,pos));},prepareFrame:function prepareFrame(num){this.prepareRenderableFrame(num);this.prepareProperties(num,(this||_global).isInRange);}};function ITextElement(){}ITextElement.prototype.initElement=function(data,globalData,comp){(this||_global).lettersChangedFlag=true;this.initFrame();this.initBaseData(data,globalData,comp);(this||_global).textProperty=new TextProperty(this||_global,data.t,(this||_global).dynamicProperties);(this||_global).textAnimator=new TextAnimatorProperty(data.t,(this||_global).renderType,this||_global);this.initTransform(data,globalData,comp);this.initHierarchy();this.initRenderable();this.initRendererElement();this.createContainerElements();this.createRenderableComponents();this.createContent();this.hide();(this||_global).textAnimator.searchProperties((this||_global).dynamicProperties);};ITextElement.prototype.prepareFrame=function(num){(this||_global)._mdf=false;this.prepareRenderableFrame(num);this.prepareProperties(num,(this||_global).isInRange);if((this||_global).textProperty._mdf||(this||_global).textProperty._isFirstFrame){this.buildNewText();(this||_global).textProperty._isFirstFrame=false;(this||_global).textProperty._mdf=false;}};ITextElement.prototype.createPathShape=function(matrixHelper,shapes){var j,jLen=shapes.length;var pathNodes;var shapeStr="";for(j=0;j<jLen;j+=1){pathNodes=shapes[j].ks.k;shapeStr+=buildShapeString(pathNodes,pathNodes.i.length,true,matrixHelper);}return shapeStr;};ITextElement.prototype.updateDocumentData=function(newData,index){(this||_global).textProperty.updateDocumentData(newData,index);};ITextElement.prototype.canResizeFont=function(_canResize){(this||_global).textProperty.canResizeFont(_canResize);};ITextElement.prototype.setMinimumFontSize=function(_fontSize){(this||_global).textProperty.setMinimumFontSize(_fontSize);};ITextElement.prototype.applyTextPropertiesToMatrix=function(documentData,matrixHelper,lineNumber,xPos,yPos){if(documentData.ps){matrixHelper.translate(documentData.ps[0],documentData.ps[1]+documentData.ascent,0);}matrixHelper.translate(0,-documentData.ls,0);switch(documentData.j){case 1:matrixHelper.translate(documentData.justifyOffset+(documentData.boxWidth-documentData.lineWidths[lineNumber]),0,0);break;case 2:matrixHelper.translate(documentData.justifyOffset+(documentData.boxWidth-documentData.lineWidths[lineNumber])/2,0,0);break;}matrixHelper.translate(xPos,yPos,0);};ITextElement.prototype.buildColor=function(colorData){return"rgb("+Math.round(colorData[0]*255)+","+Math.round(colorData[1]*255)+","+Math.round(colorData[2]*255)+")";};ITextElement.prototype.emptyProp=new LetterProps();ITextElement.prototype.destroy=function(){};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement);ICompElement.prototype.initElement=function(data,globalData,comp){this.initFrame();this.initBaseData(data,globalData,comp);this.initTransform(data,globalData,comp);this.initRenderable();this.initHierarchy();this.initRendererElement();this.createContainerElements();this.createRenderableComponents();if((this||_global).data.xt||!globalData.progressiveLoad){this.buildAllItems();}this.hide();};/*ICompElement.prototype.hide = function(){
            if(!this.hidden){
                this.hideElement();
                var i,len = this.elements.length;
                for( i = 0; i < len; i+=1 ){
                    if(this.elements[i]){
                        this.elements[i].hide();
                    }
                }
            }
        };*/ICompElement.prototype.prepareFrame=function(num){(this||_global)._mdf=false;this.prepareRenderableFrame(num);this.prepareProperties(num,(this||_global).isInRange);if(!(this||_global).isInRange&&!(this||_global).data.xt){return;}if(!(this||_global).tm._placeholder){var timeRemapped=(this||_global).tm.v;if(timeRemapped===(this||_global).data.op){timeRemapped=(this||_global).data.op-1;}(this||_global).renderedFrame=timeRemapped;}else{(this||_global).renderedFrame=num/(this||_global).data.sr;}var i,len=(this||_global).elements.length;if(!(this||_global).completeLayers){this.checkLayers((this||_global).renderedFrame);}//This iteration needs to be backwards because of how expressions connect between each other
for(i=len-1;i>=0;i-=1){if((this||_global).completeLayers||(this||_global).elements[i]){(this||_global).elements[i].prepareFrame((this||_global).renderedFrame-(this||_global).layers[i].st);if((this||_global).elements[i]._mdf){(this||_global)._mdf=true;}}}};ICompElement.prototype.renderInnerContent=function(){var i,len=(this||_global).layers.length;for(i=0;i<len;i+=1){if((this||_global).completeLayers||(this||_global).elements[i]){(this||_global).elements[i].renderFrame();}}};ICompElement.prototype.setElements=function(elems){(this||_global).elements=elems;};ICompElement.prototype.getElements=function(){return(this||_global).elements;};ICompElement.prototype.destroyElements=function(){var i,len=(this||_global).layers.length;for(i=0;i<len;i+=1){if((this||_global).elements[i]){(this||_global).elements[i].destroy();}}};ICompElement.prototype.destroy=function(){this.destroyElements();this.destroyBaseElement();};function IImageElement(data,globalData,comp){(this||_global).assetData=globalData.getAssetData(data.refId);this.initElement(data,globalData,comp);(this||_global).sourceRect={top:0,left:0,width:(this||_global).assetData.w,height:(this||_global).assetData.h};}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement);IImageElement.prototype.createContent=function(){var assetPath=(this||_global).globalData.getAssetsPath((this||_global).assetData);(this||_global).innerElem=createNS("image");(this||_global).innerElem.setAttribute("width",(this||_global).assetData.w+"px");(this||_global).innerElem.setAttribute("height",(this||_global).assetData.h+"px");(this||_global).innerElem.setAttribute("preserveAspectRatio",(this||_global).assetData.pr||(this||_global).globalData.renderConfig.imagePreserveAspectRatio);(this||_global).innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",assetPath);(this||_global).layerElement.appendChild((this||_global).innerElem);};IImageElement.prototype.sourceRectAtTime=function(){return(this||_global).sourceRect;};function ISolidElement(data,globalData,comp){this.initElement(data,globalData,comp);}extendPrototype([IImageElement],ISolidElement);ISolidElement.prototype.createContent=function(){var rect=createNS("rect");////rect.style.width = this.data.sw;
////rect.style.height = this.data.sh;
////rect.style.fill = this.data.sc;
rect.setAttribute("width",(this||_global).data.sw);rect.setAttribute("height",(this||_global).data.sh);rect.setAttribute("fill",(this||_global).data.sc);(this||_global).layerElement.appendChild(rect);};function AudioElement(data,globalData,comp){this.initFrame();this.initRenderable();(this||_global).assetData=globalData.getAssetData(data.refId);this.initBaseData(data,globalData,comp);(this||_global)._isPlaying=false;(this||_global)._canPlay=false;var assetPath=(this||_global).globalData.getAssetsPath((this||_global).assetData);(this||_global).audio=(this||_global).globalData.audioController.createAudio(assetPath);(this||_global)._currentTime=0;(this||_global).globalData.audioController.addAudio(this||_global);(this||_global).tm=data.tm?PropertyFactory.getProp(this||_global,data.tm,0,globalData.frameRate,this||_global):{_placeholder:true};}AudioElement.prototype.prepareFrame=function(num){this.prepareRenderableFrame(num,true);this.prepareProperties(num,true);if(!(this||_global).tm._placeholder){var timeRemapped=(this||_global).tm.v;(this||_global)._currentTime=timeRemapped;}else{(this||_global)._currentTime=num/(this||_global).data.sr;}};extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement);AudioElement.prototype.renderFrame=function(){if((this||_global).isInRange&&(this||_global)._canPlay){if(!(this||_global)._isPlaying){(this||_global).audio.play();(this||_global).audio.seek((this||_global)._currentTime/(this||_global).globalData.frameRate);(this||_global)._isPlaying=true;}else if(!(this||_global).audio.playing()||Math.abs((this||_global)._currentTime/(this||_global).globalData.frameRate-(this||_global).audio.seek())>0.1){(this||_global).audio.seek((this||_global)._currentTime/(this||_global).globalData.frameRate);}}};AudioElement.prototype.show=function(){// this.audio.play()
};AudioElement.prototype.hide=function(){(this||_global).audio.pause();(this||_global)._isPlaying=false;};AudioElement.prototype.pause=function(){(this||_global).audio.pause();(this||_global)._isPlaying=false;(this||_global)._canPlay=false;};AudioElement.prototype.resume=function(){(this||_global)._canPlay=true;};AudioElement.prototype.setRate=function(rateValue){(this||_global).audio.rate(rateValue);};AudioElement.prototype.volume=function(volumeValue){(this||_global).audio.volume(volumeValue);};AudioElement.prototype.getBaseElement=function(){return null;};AudioElement.prototype.destroy=function(){};AudioElement.prototype.sourceRectAtTime=function(){};AudioElement.prototype.initExpressions=function(){};function SVGCompElement(data,globalData,comp){(this||_global).layers=data.layers;(this||_global).supports3d=true;(this||_global).completeLayers=false;(this||_global).pendingElements=[];(this||_global).elements=(this||_global).layers?createSizedArray((this||_global).layers.length):[];//this.layerElement = createNS('g');
this.initElement(data,globalData,comp);(this||_global).tm=data.tm?PropertyFactory.getProp(this||_global,data.tm,0,globalData.frameRate,this||_global):{_placeholder:true};}extendPrototype([SVGRenderer,ICompElement,SVGBaseElement],SVGCompElement);function SVGTextElement(data,globalData,comp){(this||_global).textSpans=[];(this||_global).renderType="svg";this.initElement(data,globalData,comp);}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextElement);SVGTextElement.prototype.createContent=function(){if((this||_global).data.singleShape&&!(this||_global).globalData.fontManager.chars){(this||_global).textContainer=createNS("text");}};SVGTextElement.prototype.buildTextContents=function(textArray){var i=0,len=textArray.length;var textContents=[],currentTextContent="";while(i<len){if(textArray[i]===String.fromCharCode(13)||textArray[i]===String.fromCharCode(3)){textContents.push(currentTextContent);currentTextContent="";}else{currentTextContent+=textArray[i];}i+=1;}textContents.push(currentTextContent);return textContents;};SVGTextElement.prototype.buildNewText=function(){var i,len;var documentData=(this||_global).textProperty.currentData;(this||_global).renderedLetters=createSizedArray(documentData?documentData.l.length:0);if(documentData.fc){(this||_global).layerElement.setAttribute("fill",this.buildColor(documentData.fc));}else{(this||_global).layerElement.setAttribute("fill","rgba(0,0,0,0)");}if(documentData.sc){(this||_global).layerElement.setAttribute("stroke",this.buildColor(documentData.sc));(this||_global).layerElement.setAttribute("stroke-width",documentData.sw);}(this||_global).layerElement.setAttribute("font-size",documentData.finalSize);var fontData=(this||_global).globalData.fontManager.getFontByName(documentData.f);if(fontData.fClass){(this||_global).layerElement.setAttribute("class",fontData.fClass);}else{(this||_global).layerElement.setAttribute("font-family",fontData.fFamily);var fWeight=documentData.fWeight,fStyle=documentData.fStyle;(this||_global).layerElement.setAttribute("font-style",fStyle);(this||_global).layerElement.setAttribute("font-weight",fWeight);}(this||_global).layerElement.setAttribute("aria-label",documentData.t);var letters=documentData.l||[];var usesGlyphs=!!(this||_global).globalData.fontManager.chars;len=letters.length;var tSpan;var matrixHelper=(this||_global).mHelper;var shapes,shapeStr="",singleShape=(this||_global).data.singleShape;var xPos=0,yPos=0,firstLine=true;var trackingOffset=documentData.tr/1000*documentData.finalSize;if(singleShape&&!usesGlyphs&&!documentData.sz){var tElement=(this||_global).textContainer;var justify="start";switch(documentData.j){case 1:justify="end";break;case 2:justify="middle";break;}tElement.setAttribute("text-anchor",justify);tElement.setAttribute("letter-spacing",trackingOffset);var textContent=this.buildTextContents(documentData.finalText);len=textContent.length;yPos=documentData.ps?documentData.ps[1]+documentData.ascent:0;for(i=0;i<len;i+=1){tSpan=(this||_global).textSpans[i]||createNS("tspan");tSpan.textContent=textContent[i];tSpan.setAttribute("x",0);tSpan.setAttribute("y",yPos);tSpan.style.display="inherit";tElement.appendChild(tSpan);(this||_global).textSpans[i]=tSpan;yPos+=documentData.finalLineHeight;}(this||_global).layerElement.appendChild(tElement);}else{var cachedSpansLength=(this||_global).textSpans.length;var shapeData,charData;for(i=0;i<len;i+=1){if(!usesGlyphs||!singleShape||i===0){tSpan=cachedSpansLength>i?(this||_global).textSpans[i]:createNS(usesGlyphs?"path":"text");if(cachedSpansLength<=i){tSpan.setAttribute("stroke-linecap","butt");tSpan.setAttribute("stroke-linejoin","round");tSpan.setAttribute("stroke-miterlimit","4");(this||_global).textSpans[i]=tSpan;(this||_global).layerElement.appendChild(tSpan);}tSpan.style.display="inherit";}matrixHelper.reset();matrixHelper.scale(documentData.finalSize/100,documentData.finalSize/100);if(singleShape){if(letters[i].n){xPos=-trackingOffset;yPos+=documentData.yOffset;yPos+=firstLine?1:0;firstLine=false;}this.applyTextPropertiesToMatrix(documentData,matrixHelper,letters[i].line,xPos,yPos);xPos+=letters[i].l||0;//xPos += letters[i].val === ' ' ? 0 : trackingOffset;
xPos+=trackingOffset;}if(usesGlyphs){charData=(this||_global).globalData.fontManager.getCharData(documentData.finalText[i],fontData.fStyle,(this||_global).globalData.fontManager.getFontByName(documentData.f).fFamily);shapeData=charData&&charData.data||{};shapes=shapeData.shapes?shapeData.shapes[0].it:[];if(!singleShape){tSpan.setAttribute("d",this.createPathShape(matrixHelper,shapes));}else{shapeStr+=this.createPathShape(matrixHelper,shapes);}}else{if(singleShape){tSpan.setAttribute("transform","translate("+matrixHelper.props[12]+","+matrixHelper.props[13]+")");}tSpan.textContent=letters[i].val;tSpan.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve");}//
}if(singleShape&&tSpan){tSpan.setAttribute("d",shapeStr);}}while(i<(this||_global).textSpans.length){(this||_global).textSpans[i].style.display="none";i+=1;}(this||_global)._sizeChanged=true;};SVGTextElement.prototype.sourceRectAtTime=function(time){this.prepareFrame((this||_global).comp.renderedFrame-(this||_global).data.st);this.renderInnerContent();if((this||_global)._sizeChanged){(this||_global)._sizeChanged=false;var textBox=(this||_global).layerElement.getBBox();(this||_global).bbox={top:textBox.y,left:textBox.x,width:textBox.width,height:textBox.height};}return(this||_global).bbox;};SVGTextElement.prototype.renderInnerContent=function(){if(!(this||_global).data.singleShape){(this||_global).textAnimator.getMeasures((this||_global).textProperty.currentData,(this||_global).lettersChangedFlag);if((this||_global).lettersChangedFlag||(this||_global).textAnimator.lettersChangedFlag){(this||_global)._sizeChanged=true;var i,len;var renderedLetters=(this||_global).textAnimator.renderedLetters;var letters=(this||_global).textProperty.currentData.l;len=letters.length;var renderedLetter,textSpan;for(i=0;i<len;i+=1){if(letters[i].n){continue;}renderedLetter=renderedLetters[i];textSpan=(this||_global).textSpans[i];if(renderedLetter._mdf.m){textSpan.setAttribute("transform",renderedLetter.m);}if(renderedLetter._mdf.o){textSpan.setAttribute("opacity",renderedLetter.o);}if(renderedLetter._mdf.sw){textSpan.setAttribute("stroke-width",renderedLetter.sw);}if(renderedLetter._mdf.sc){textSpan.setAttribute("stroke",renderedLetter.sc);}if(renderedLetter._mdf.fc){textSpan.setAttribute("fill",renderedLetter.fc);}}}}};function SVGShapeElement(data,globalData,comp){//List of drawable elements
(this||_global).shapes=[];// Full shape data
(this||_global).shapesData=data.shapes;//List of styles that will be applied to shapes
(this||_global).stylesList=[];//List of modifiers that will be applied to shapes
(this||_global).shapeModifiers=[];//List of items in shape tree
(this||_global).itemsData=[];//List of items in previous shape tree
(this||_global).processedElements=[];// List of animated components
(this||_global).animatedContents=[];this.initElement(data,globalData,comp);//Moving any property that doesn't get too much access after initialization because of v8 way of handling more than 10 properties.
// List of elements that have been created
(this||_global).prevViewData=[];//Moving any property that doesn't get too much access after initialization because of v8 way of handling more than 10 properties.
}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement);SVGShapeElement.prototype.initSecondaryElement=function(){};SVGShapeElement.prototype.identityMatrix=new Matrix();SVGShapeElement.prototype.buildExpressionInterface=function(){};SVGShapeElement.prototype.createContent=function(){this.searchShapes((this||_global).shapesData,(this||_global).itemsData,(this||_global).prevViewData,(this||_global).layerElement,0,[],true);this.filterUniqueShapes();};/*
        This method searches for multiple shapes that affect a single element and one of them is animated
        */SVGShapeElement.prototype.filterUniqueShapes=function(){var i,len=(this||_global).shapes.length,shape;var j,jLen=(this||_global).stylesList.length;var style;var tempShapes=[];var areAnimated=false;for(j=0;j<jLen;j+=1){style=(this||_global).stylesList[j];areAnimated=false;tempShapes.length=0;for(i=0;i<len;i+=1){shape=(this||_global).shapes[i];if(shape.styles.indexOf(style)!==-1){tempShapes.push(shape);areAnimated=shape._isAnimated||areAnimated;}}if(tempShapes.length>1&&areAnimated){this.setShapesAsAnimated(tempShapes);}}};SVGShapeElement.prototype.setShapesAsAnimated=function(shapes){var i,len=shapes.length;for(i=0;i<len;i+=1){shapes[i].setAsAnimated();}};SVGShapeElement.prototype.createStyleElement=function(data,level){//TODO: prevent drawing of hidden styles
var elementData;var styleOb=new SVGStyleData(data,level);var pathElement=styleOb.pElem;if(data.ty==="st"){elementData=new SVGStrokeStyleData(this||_global,data,styleOb);}else if(data.ty==="fl"){elementData=new SVGFillStyleData(this||_global,data,styleOb);}else if(data.ty==="gf"||data.ty==="gs"){var gradientConstructor=data.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;elementData=new gradientConstructor(this||_global,data,styleOb);(this||_global).globalData.defs.appendChild(elementData.gf);if(elementData.maskId){(this||_global).globalData.defs.appendChild(elementData.ms);(this||_global).globalData.defs.appendChild(elementData.of);pathElement.setAttribute("mask","url("+locationHref+"#"+elementData.maskId+")");}}if(data.ty==="st"||data.ty==="gs"){pathElement.setAttribute("stroke-linecap",(this||_global).lcEnum[data.lc]||"round");pathElement.setAttribute("stroke-linejoin",(this||_global).ljEnum[data.lj]||"round");pathElement.setAttribute("fill-opacity","0");if(data.lj===1){pathElement.setAttribute("stroke-miterlimit",data.ml);}}if(data.r===2){pathElement.setAttribute("fill-rule","evenodd");}if(data.ln){pathElement.setAttribute("id",data.ln);}if(data.cl){pathElement.setAttribute("class",data.cl);}if(data.bm){pathElement.style["mix-blend-mode"]=getBlendMode(data.bm);}(this||_global).stylesList.push(styleOb);this.addToAnimatedContents(data,elementData);return elementData;};SVGShapeElement.prototype.createGroupElement=function(data){var elementData=new ShapeGroupData();if(data.ln){elementData.gr.setAttribute("id",data.ln);}if(data.cl){elementData.gr.setAttribute("class",data.cl);}if(data.bm){elementData.gr.style["mix-blend-mode"]=getBlendMode(data.bm);}return elementData;};SVGShapeElement.prototype.createTransformElement=function(data,container){var transformProperty=TransformPropertyFactory.getTransformProperty(this||_global,data,this||_global);var elementData=new SVGTransformData(transformProperty,transformProperty.o,container);this.addToAnimatedContents(data,elementData);return elementData;};SVGShapeElement.prototype.createShapeElement=function(data,ownTransformers,level){var ty=4;if(data.ty==="rc"){ty=5;}else if(data.ty==="el"){ty=6;}else if(data.ty==="sr"){ty=7;}var shapeProperty=ShapePropertyFactory.getShapeProp(this||_global,data,ty,this||_global);var elementData=new SVGShapeData(ownTransformers,level,shapeProperty);(this||_global).shapes.push(elementData);this.addShapeToModifiers(elementData);this.addToAnimatedContents(data,elementData);return elementData;};SVGShapeElement.prototype.addToAnimatedContents=function(data,element){var i=0,len=(this||_global).animatedContents.length;while(i<len){if((this||_global).animatedContents[i].element===element){return;}i+=1;}(this||_global).animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(data),element:element,data:data});};SVGShapeElement.prototype.setElementStyles=function(elementData){var arr=elementData.styles;var j,jLen=(this||_global).stylesList.length;for(j=0;j<jLen;j+=1){if(!(this||_global).stylesList[j].closed){arr.push((this||_global).stylesList[j]);}}};SVGShapeElement.prototype.reloadShapes=function(){(this||_global)._isFirstFrame=true;var i,len=(this||_global).itemsData.length;for(i=0;i<len;i+=1){(this||_global).prevViewData[i]=(this||_global).itemsData[i];}this.searchShapes((this||_global).shapesData,(this||_global).itemsData,(this||_global).prevViewData,(this||_global).layerElement,0,[],true);this.filterUniqueShapes();len=(this||_global).dynamicProperties.length;for(i=0;i<len;i+=1){(this||_global).dynamicProperties[i].getValue();}this.renderModifiers();};SVGShapeElement.prototype.searchShapes=function(arr,itemsData,prevViewData,container,level,transformers,render){var ownTransformers=[].concat(transformers);var i,len=arr.length-1;var j,jLen;var ownStyles=[],ownModifiers=[],currentTransform,modifier,processedPos;for(i=len;i>=0;i-=1){processedPos=this.searchProcessedElement(arr[i]);if(!processedPos){arr[i]._render=render;}else{itemsData[i]=prevViewData[processedPos-1];}if(arr[i].ty=="fl"||arr[i].ty=="st"||arr[i].ty=="gf"||arr[i].ty=="gs"){if(!processedPos){itemsData[i]=this.createStyleElement(arr[i],level);}else{itemsData[i].style.closed=false;}if(arr[i]._render){container.appendChild(itemsData[i].style.pElem);}ownStyles.push(itemsData[i].style);}else if(arr[i].ty=="gr"){if(!processedPos){itemsData[i]=this.createGroupElement(arr[i]);}else{jLen=itemsData[i].it.length;for(j=0;j<jLen;j+=1){itemsData[i].prevViewData[j]=itemsData[i].it[j];}}this.searchShapes(arr[i].it,itemsData[i].it,itemsData[i].prevViewData,itemsData[i].gr,level+1,ownTransformers,render);if(arr[i]._render){container.appendChild(itemsData[i].gr);}}else if(arr[i].ty=="tr"){if(!processedPos){itemsData[i]=this.createTransformElement(arr[i],container);}currentTransform=itemsData[i].transform;ownTransformers.push(currentTransform);}else if(arr[i].ty=="sh"||arr[i].ty=="rc"||arr[i].ty=="el"||arr[i].ty=="sr"){if(!processedPos){itemsData[i]=this.createShapeElement(arr[i],ownTransformers,level);}this.setElementStyles(itemsData[i]);}else if(arr[i].ty=="tm"||arr[i].ty=="rd"||arr[i].ty=="ms"||arr[i].ty=="pb"){if(!processedPos){modifier=ShapeModifiers.getModifier(arr[i].ty);modifier.init(this||_global,arr[i]);itemsData[i]=modifier;(this||_global).shapeModifiers.push(modifier);}else{modifier=itemsData[i];modifier.closed=false;}ownModifiers.push(modifier);}else if(arr[i].ty=="rp"){if(!processedPos){modifier=ShapeModifiers.getModifier(arr[i].ty);itemsData[i]=modifier;modifier.init(this||_global,arr,i,itemsData);(this||_global).shapeModifiers.push(modifier);render=false;}else{modifier=itemsData[i];modifier.closed=true;}ownModifiers.push(modifier);}this.addProcessedElement(arr[i],i+1);}len=ownStyles.length;for(i=0;i<len;i+=1){ownStyles[i].closed=true;}len=ownModifiers.length;for(i=0;i<len;i+=1){ownModifiers[i].closed=true;}};SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var i,len=(this||_global).stylesList.length;for(i=0;i<len;i+=1){(this||_global).stylesList[i].reset();}this.renderShape();for(i=0;i<len;i+=1){if((this||_global).stylesList[i]._mdf||(this||_global)._isFirstFrame){if((this||_global).stylesList[i].msElem){(this||_global).stylesList[i].msElem.setAttribute("d",(this||_global).stylesList[i].d);//Adding M0 0 fixes same mask bug on all browsers
(this||_global).stylesList[i].d="M0 0"+(this||_global).stylesList[i].d;}(this||_global).stylesList[i].pElem.setAttribute("d",(this||_global).stylesList[i].d||"M0 0");}}};SVGShapeElement.prototype.renderShape=function(){var i,len=(this||_global).animatedContents.length;var animatedContent;for(i=0;i<len;i+=1){animatedContent=(this||_global).animatedContents[i];if(((this||_global)._isFirstFrame||animatedContent.element._isAnimated)&&animatedContent.data!==true){animatedContent.fn(animatedContent.data,animatedContent.element,(this||_global)._isFirstFrame);}}};SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement();(this||_global).shapesData=null;(this||_global).itemsData=null;};function SVGTintFilter(filter,filterManager){(this||_global).filterManager=filterManager;var feColorMatrix=createNS("feColorMatrix");feColorMatrix.setAttribute("type","matrix");feColorMatrix.setAttribute("color-interpolation-filters","linearRGB");feColorMatrix.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0");feColorMatrix.setAttribute("result","f1");filter.appendChild(feColorMatrix);feColorMatrix=createNS("feColorMatrix");feColorMatrix.setAttribute("type","matrix");feColorMatrix.setAttribute("color-interpolation-filters","sRGB");feColorMatrix.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0");feColorMatrix.setAttribute("result","f2");filter.appendChild(feColorMatrix);(this||_global).matrixFilter=feColorMatrix;if(filterManager.effectElements[2].p.v!==100||filterManager.effectElements[2].p.k){var feMerge=createNS("feMerge");filter.appendChild(feMerge);var feMergeNode;feMergeNode=createNS("feMergeNode");feMergeNode.setAttribute("in","SourceGraphic");feMerge.appendChild(feMergeNode);feMergeNode=createNS("feMergeNode");feMergeNode.setAttribute("in","f2");feMerge.appendChild(feMergeNode);}}SVGTintFilter.prototype.renderFrame=function(forceRender){if(forceRender||(this||_global).filterManager._mdf){var colorBlack=(this||_global).filterManager.effectElements[0].p.v;var colorWhite=(this||_global).filterManager.effectElements[1].p.v;var opacity=(this||_global).filterManager.effectElements[2].p.v/100;(this||_global).matrixFilter.setAttribute("values",colorWhite[0]-colorBlack[0]+" 0 0 0 "+colorBlack[0]+" "+(colorWhite[1]-colorBlack[1])+" 0 0 0 "+colorBlack[1]+" "+(colorWhite[2]-colorBlack[2])+" 0 0 0 "+colorBlack[2]+" 0 0 0 "+opacity+" 0");}};function SVGFillFilter(filter,filterManager){(this||_global).filterManager=filterManager;var feColorMatrix=createNS("feColorMatrix");feColorMatrix.setAttribute("type","matrix");feColorMatrix.setAttribute("color-interpolation-filters","sRGB");feColorMatrix.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0");filter.appendChild(feColorMatrix);(this||_global).matrixFilter=feColorMatrix;}SVGFillFilter.prototype.renderFrame=function(forceRender){if(forceRender||(this||_global).filterManager._mdf){var color=(this||_global).filterManager.effectElements[2].p.v;var opacity=(this||_global).filterManager.effectElements[6].p.v;(this||_global).matrixFilter.setAttribute("values","0 0 0 0 "+color[0]+" 0 0 0 0 "+color[1]+" 0 0 0 0 "+color[2]+" 0 0 0 "+opacity+" 0");}};function SVGGaussianBlurEffect(filter,filterManager){// Outset the filter region by 100% on all sides to accommodate blur expansion.
filter.setAttribute("x","-100%");filter.setAttribute("y","-100%");filter.setAttribute("width","300%");filter.setAttribute("height","300%");(this||_global).filterManager=filterManager;var feGaussianBlur=createNS("feGaussianBlur");filter.appendChild(feGaussianBlur);(this||_global).feGaussianBlur=feGaussianBlur;}SVGGaussianBlurEffect.prototype.renderFrame=function(forceRender){if(forceRender||(this||_global).filterManager._mdf){// Empirical value, matching AE's blur appearance.
var kBlurrinessToSigma=0.3;var sigma=(this||_global).filterManager.effectElements[0].p.v*kBlurrinessToSigma;// Dimensions mapping:
//
//   1 -> horizontal & vertical
//   2 -> horizontal only
//   3 -> vertical only
//
var dimensions=(this||_global).filterManager.effectElements[1].p.v;var sigmaX=dimensions==3?0:sigma;var sigmaY=dimensions==2?0:sigma;(this||_global).feGaussianBlur.setAttribute("stdDeviation",sigmaX+" "+sigmaY);// Repeat edges mapping:
//
//   0 -> off -> duplicate
//   1 -> on  -> wrap
var edgeMode=(this||_global).filterManager.effectElements[2].p.v==1?"wrap":"duplicate";(this||_global).feGaussianBlur.setAttribute("edgeMode",edgeMode);}};function SVGStrokeEffect(elem,filterManager){(this||_global).initialized=false;(this||_global).filterManager=filterManager;(this||_global).elem=elem;(this||_global).paths=[];}SVGStrokeEffect.prototype.initialize=function(){var elemChildren=(this||_global).elem.layerElement.children||(this||_global).elem.layerElement.childNodes;var path,groupPath,i,len;if((this||_global).filterManager.effectElements[1].p.v===1){len=(this||_global).elem.maskManager.masksProperties.length;i=0;}else{i=(this||_global).filterManager.effectElements[0].p.v-1;len=i+1;}groupPath=createNS("g");groupPath.setAttribute("fill","none");groupPath.setAttribute("stroke-linecap","round");groupPath.setAttribute("stroke-dashoffset",1);for(i;i<len;i+=1){path=createNS("path");groupPath.appendChild(path);(this||_global).paths.push({p:path,m:i});}if((this||_global).filterManager.effectElements[10].p.v===3){var mask=createNS("mask");var id=createElementID();mask.setAttribute("id",id);mask.setAttribute("mask-type","alpha");mask.appendChild(groupPath);(this||_global).elem.globalData.defs.appendChild(mask);var g=createNS("g");g.setAttribute("mask","url("+locationHref+"#"+id+")");while(elemChildren[0]){g.appendChild(elemChildren[0]);}(this||_global).elem.layerElement.appendChild(g);(this||_global).masker=mask;groupPath.setAttribute("stroke","#fff");}else if((this||_global).filterManager.effectElements[10].p.v===1||(this||_global).filterManager.effectElements[10].p.v===2){if((this||_global).filterManager.effectElements[10].p.v===2){elemChildren=(this||_global).elem.layerElement.children||(this||_global).elem.layerElement.childNodes;while(elemChildren.length){(this||_global).elem.layerElement.removeChild(elemChildren[0]);}}(this||_global).elem.layerElement.appendChild(groupPath);(this||_global).elem.layerElement.removeAttribute("mask");groupPath.setAttribute("stroke","#fff");}(this||_global).initialized=true;(this||_global).pathMasker=groupPath;};SVGStrokeEffect.prototype.renderFrame=function(forceRender){if(!(this||_global).initialized){this.initialize();}var i,len=(this||_global).paths.length;var mask,path;for(i=0;i<len;i+=1){if((this||_global).paths[i].m===-1){continue;}mask=(this||_global).elem.maskManager.viewData[(this||_global).paths[i].m];path=(this||_global).paths[i].p;if(forceRender||(this||_global).filterManager._mdf||mask.prop._mdf){path.setAttribute("d",mask.lastPath);}if(forceRender||(this||_global).filterManager.effectElements[9].p._mdf||(this||_global).filterManager.effectElements[4].p._mdf||(this||_global).filterManager.effectElements[7].p._mdf||(this||_global).filterManager.effectElements[8].p._mdf||mask.prop._mdf){var dasharrayValue;if((this||_global).filterManager.effectElements[7].p.v!==0||(this||_global).filterManager.effectElements[8].p.v!==100){var s=Math.min((this||_global).filterManager.effectElements[7].p.v,(this||_global).filterManager.effectElements[8].p.v)/100;var e=Math.max((this||_global).filterManager.effectElements[7].p.v,(this||_global).filterManager.effectElements[8].p.v)/100;var l=path.getTotalLength();dasharrayValue="0 0 0 "+l*s+" ";var lineLength=l*(e-s);var segment=1+(this||_global).filterManager.effectElements[4].p.v*2*(this||_global).filterManager.effectElements[9].p.v/100;var units=Math.floor(lineLength/segment);var j;for(j=0;j<units;j+=1){dasharrayValue+="1 "+(this||_global).filterManager.effectElements[4].p.v*2*(this||_global).filterManager.effectElements[9].p.v/100+" ";}dasharrayValue+="0 "+l*10+" 0 0";}else{dasharrayValue="1 "+(this||_global).filterManager.effectElements[4].p.v*2*(this||_global).filterManager.effectElements[9].p.v/100;}path.setAttribute("stroke-dasharray",dasharrayValue);}}if(forceRender||(this||_global).filterManager.effectElements[4].p._mdf){(this||_global).pathMasker.setAttribute("stroke-width",(this||_global).filterManager.effectElements[4].p.v*2);}if(forceRender||(this||_global).filterManager.effectElements[6].p._mdf){(this||_global).pathMasker.setAttribute("opacity",(this||_global).filterManager.effectElements[6].p.v);}if((this||_global).filterManager.effectElements[10].p.v===1||(this||_global).filterManager.effectElements[10].p.v===2){if(forceRender||(this||_global).filterManager.effectElements[3].p._mdf){var color=(this||_global).filterManager.effectElements[3].p.v;(this||_global).pathMasker.setAttribute("stroke","rgb("+bm_floor(color[0]*255)+","+bm_floor(color[1]*255)+","+bm_floor(color[2]*255)+")");}}};function SVGTritoneFilter(filter,filterManager){(this||_global).filterManager=filterManager;var feColorMatrix=createNS("feColorMatrix");feColorMatrix.setAttribute("type","matrix");feColorMatrix.setAttribute("color-interpolation-filters","linearRGB");feColorMatrix.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0");feColorMatrix.setAttribute("result","f1");filter.appendChild(feColorMatrix);var feComponentTransfer=createNS("feComponentTransfer");feComponentTransfer.setAttribute("color-interpolation-filters","sRGB");filter.appendChild(feComponentTransfer);(this||_global).matrixFilter=feComponentTransfer;var feFuncR=createNS("feFuncR");feFuncR.setAttribute("type","table");feComponentTransfer.appendChild(feFuncR);(this||_global).feFuncR=feFuncR;var feFuncG=createNS("feFuncG");feFuncG.setAttribute("type","table");feComponentTransfer.appendChild(feFuncG);(this||_global).feFuncG=feFuncG;var feFuncB=createNS("feFuncB");feFuncB.setAttribute("type","table");feComponentTransfer.appendChild(feFuncB);(this||_global).feFuncB=feFuncB;}SVGTritoneFilter.prototype.renderFrame=function(forceRender){if(forceRender||(this||_global).filterManager._mdf){var color1=(this||_global).filterManager.effectElements[0].p.v;var color2=(this||_global).filterManager.effectElements[1].p.v;var color3=(this||_global).filterManager.effectElements[2].p.v;var tableR=color3[0]+" "+color2[0]+" "+color1[0];var tableG=color3[1]+" "+color2[1]+" "+color1[1];var tableB=color3[2]+" "+color2[2]+" "+color1[2];(this||_global).feFuncR.setAttribute("tableValues",tableR);(this||_global).feFuncG.setAttribute("tableValues",tableG);(this||_global).feFuncB.setAttribute("tableValues",tableB);//var opacity = this.filterManager.effectElements[2].p.v/100;
//this.matrixFilter.setAttribute('values',(colorWhite[0]- colorBlack[0])+' 0 0 0 '+ colorBlack[0] +' '+ (colorWhite[1]- colorBlack[1]) +' 0 0 0 '+ colorBlack[1] +' '+ (colorWhite[2]- colorBlack[2]) +' 0 0 0 '+ colorBlack[2] +' 0 0 0 ' + opacity + ' 0');
}};function SVGProLevelsFilter(filter,filterManager){(this||_global).filterManager=filterManager;var effectElements=(this||_global).filterManager.effectElements;var feComponentTransfer=createNS("feComponentTransfer");if(effectElements[10].p.k||effectElements[10].p.v!==0||effectElements[11].p.k||effectElements[11].p.v!==1||effectElements[12].p.k||effectElements[12].p.v!==1||effectElements[13].p.k||effectElements[13].p.v!==0||effectElements[14].p.k||effectElements[14].p.v!==1){(this||_global).feFuncR=this.createFeFunc("feFuncR",feComponentTransfer);}if(effectElements[17].p.k||effectElements[17].p.v!==0||effectElements[18].p.k||effectElements[18].p.v!==1||effectElements[19].p.k||effectElements[19].p.v!==1||effectElements[20].p.k||effectElements[20].p.v!==0||effectElements[21].p.k||effectElements[21].p.v!==1){(this||_global).feFuncG=this.createFeFunc("feFuncG",feComponentTransfer);}if(effectElements[24].p.k||effectElements[24].p.v!==0||effectElements[25].p.k||effectElements[25].p.v!==1||effectElements[26].p.k||effectElements[26].p.v!==1||effectElements[27].p.k||effectElements[27].p.v!==0||effectElements[28].p.k||effectElements[28].p.v!==1){(this||_global).feFuncB=this.createFeFunc("feFuncB",feComponentTransfer);}if(effectElements[31].p.k||effectElements[31].p.v!==0||effectElements[32].p.k||effectElements[32].p.v!==1||effectElements[33].p.k||effectElements[33].p.v!==1||effectElements[34].p.k||effectElements[34].p.v!==0||effectElements[35].p.k||effectElements[35].p.v!==1){(this||_global).feFuncA=this.createFeFunc("feFuncA",feComponentTransfer);}if((this||_global).feFuncR||(this||_global).feFuncG||(this||_global).feFuncB||(this||_global).feFuncA){feComponentTransfer.setAttribute("color-interpolation-filters","sRGB");filter.appendChild(feComponentTransfer);feComponentTransfer=createNS("feComponentTransfer");}if(effectElements[3].p.k||effectElements[3].p.v!==0||effectElements[4].p.k||effectElements[4].p.v!==1||effectElements[5].p.k||effectElements[5].p.v!==1||effectElements[6].p.k||effectElements[6].p.v!==0||effectElements[7].p.k||effectElements[7].p.v!==1){feComponentTransfer.setAttribute("color-interpolation-filters","sRGB");filter.appendChild(feComponentTransfer);(this||_global).feFuncRComposed=this.createFeFunc("feFuncR",feComponentTransfer);(this||_global).feFuncGComposed=this.createFeFunc("feFuncG",feComponentTransfer);(this||_global).feFuncBComposed=this.createFeFunc("feFuncB",feComponentTransfer);}}SVGProLevelsFilter.prototype.createFeFunc=function(type,feComponentTransfer){var feFunc=createNS(type);feFunc.setAttribute("type","table");feComponentTransfer.appendChild(feFunc);return feFunc;};SVGProLevelsFilter.prototype.getTableValue=function(inputBlack,inputWhite,gamma,outputBlack,outputWhite){var cnt=0;var segments=256;var perc;var min=Math.min(inputBlack,inputWhite);var max=Math.max(inputBlack,inputWhite);var table=Array.call(null,{length:segments});var colorValue;var pos=0;var outputDelta=outputWhite-outputBlack;var inputDelta=inputWhite-inputBlack;while(cnt<=256){perc=cnt/256;if(perc<=min){colorValue=inputDelta<0?outputWhite:outputBlack;}else if(perc>=max){colorValue=inputDelta<0?outputBlack:outputWhite;}else{colorValue=outputBlack+outputDelta*Math.pow((perc-inputBlack)/inputDelta,1/gamma);}table[pos++]=colorValue;cnt+=256/(segments-1);}return table.join(" ");};SVGProLevelsFilter.prototype.renderFrame=function(forceRender){if(forceRender||(this||_global).filterManager._mdf){var val;var effectElements=(this||_global).filterManager.effectElements;if((this||_global).feFuncRComposed&&(forceRender||effectElements[3].p._mdf||effectElements[4].p._mdf||effectElements[5].p._mdf||effectElements[6].p._mdf||effectElements[7].p._mdf)){val=this.getTableValue(effectElements[3].p.v,effectElements[4].p.v,effectElements[5].p.v,effectElements[6].p.v,effectElements[7].p.v);(this||_global).feFuncRComposed.setAttribute("tableValues",val);(this||_global).feFuncGComposed.setAttribute("tableValues",val);(this||_global).feFuncBComposed.setAttribute("tableValues",val);}if((this||_global).feFuncR&&(forceRender||effectElements[10].p._mdf||effectElements[11].p._mdf||effectElements[12].p._mdf||effectElements[13].p._mdf||effectElements[14].p._mdf)){val=this.getTableValue(effectElements[10].p.v,effectElements[11].p.v,effectElements[12].p.v,effectElements[13].p.v,effectElements[14].p.v);(this||_global).feFuncR.setAttribute("tableValues",val);}if((this||_global).feFuncG&&(forceRender||effectElements[17].p._mdf||effectElements[18].p._mdf||effectElements[19].p._mdf||effectElements[20].p._mdf||effectElements[21].p._mdf)){val=this.getTableValue(effectElements[17].p.v,effectElements[18].p.v,effectElements[19].p.v,effectElements[20].p.v,effectElements[21].p.v);(this||_global).feFuncG.setAttribute("tableValues",val);}if((this||_global).feFuncB&&(forceRender||effectElements[24].p._mdf||effectElements[25].p._mdf||effectElements[26].p._mdf||effectElements[27].p._mdf||effectElements[28].p._mdf)){val=this.getTableValue(effectElements[24].p.v,effectElements[25].p.v,effectElements[26].p.v,effectElements[27].p.v,effectElements[28].p.v);(this||_global).feFuncB.setAttribute("tableValues",val);}if((this||_global).feFuncA&&(forceRender||effectElements[31].p._mdf||effectElements[32].p._mdf||effectElements[33].p._mdf||effectElements[34].p._mdf||effectElements[35].p._mdf)){val=this.getTableValue(effectElements[31].p.v,effectElements[32].p.v,effectElements[33].p.v,effectElements[34].p.v,effectElements[35].p.v);(this||_global).feFuncA.setAttribute("tableValues",val);}}};function SVGDropShadowEffect(filter,filterManager){var filterSize=filterManager.container.globalData.renderConfig.filterSize;filter.setAttribute("x",filterSize.x);filter.setAttribute("y",filterSize.y);filter.setAttribute("width",filterSize.width);filter.setAttribute("height",filterSize.height);(this||_global).filterManager=filterManager;var feGaussianBlur=createNS("feGaussianBlur");feGaussianBlur.setAttribute("in","SourceAlpha");feGaussianBlur.setAttribute("result","drop_shadow_1");feGaussianBlur.setAttribute("stdDeviation","0");(this||_global).feGaussianBlur=feGaussianBlur;filter.appendChild(feGaussianBlur);var feOffset=createNS("feOffset");feOffset.setAttribute("dx","25");feOffset.setAttribute("dy","0");feOffset.setAttribute("in","drop_shadow_1");feOffset.setAttribute("result","drop_shadow_2");(this||_global).feOffset=feOffset;filter.appendChild(feOffset);var feFlood=createNS("feFlood");feFlood.setAttribute("flood-color","#00ff00");feFlood.setAttribute("flood-opacity","1");feFlood.setAttribute("result","drop_shadow_3");(this||_global).feFlood=feFlood;filter.appendChild(feFlood);var feComposite=createNS("feComposite");feComposite.setAttribute("in","drop_shadow_3");feComposite.setAttribute("in2","drop_shadow_2");feComposite.setAttribute("operator","in");feComposite.setAttribute("result","drop_shadow_4");filter.appendChild(feComposite);var feMerge=createNS("feMerge");filter.appendChild(feMerge);var feMergeNode;feMergeNode=createNS("feMergeNode");feMerge.appendChild(feMergeNode);feMergeNode=createNS("feMergeNode");feMergeNode.setAttribute("in","SourceGraphic");(this||_global).feMergeNode=feMergeNode;(this||_global).feMerge=feMerge;(this||_global).originalNodeAdded=false;feMerge.appendChild(feMergeNode);}SVGDropShadowEffect.prototype.renderFrame=function(forceRender){if(forceRender||(this||_global).filterManager._mdf){if(forceRender||(this||_global).filterManager.effectElements[4].p._mdf){(this||_global).feGaussianBlur.setAttribute("stdDeviation",(this||_global).filterManager.effectElements[4].p.v/4);}if(forceRender||(this||_global).filterManager.effectElements[0].p._mdf){var col=(this||_global).filterManager.effectElements[0].p.v;(this||_global).feFlood.setAttribute("flood-color",rgbToHex(Math.round(col[0]*255),Math.round(col[1]*255),Math.round(col[2]*255)));}if(forceRender||(this||_global).filterManager.effectElements[1].p._mdf){(this||_global).feFlood.setAttribute("flood-opacity",(this||_global).filterManager.effectElements[1].p.v/255);}if(forceRender||(this||_global).filterManager.effectElements[2].p._mdf||(this||_global).filterManager.effectElements[3].p._mdf){var distance=(this||_global).filterManager.effectElements[3].p.v;var angle=((this||_global).filterManager.effectElements[2].p.v-90)*degToRads;var x=distance*Math.cos(angle);var y=distance*Math.sin(angle);(this||_global).feOffset.setAttribute("dx",x);(this||_global).feOffset.setAttribute("dy",y);}/*if(forceRender || this.filterManager.effectElements[5].p._mdf){
                if(this.filterManager.effectElements[5].p.v === 1 && this.originalNodeAdded) {
                    this.feMerge.removeChild(this.feMergeNode);
                    this.originalNodeAdded = false;
                } else if(this.filterManager.effectElements[5].p.v === 0 && !this.originalNodeAdded) {
                    this.feMerge.appendChild(this.feMergeNode);
                    this.originalNodeAdded = true;
                }
            }*/}};var _svgMatteSymbols=[];function SVGMatte3Effect(filterElem,filterManager,elem){(this||_global).initialized=false;(this||_global).filterManager=filterManager;(this||_global).filterElem=filterElem;(this||_global).elem=elem;elem.matteElement=createNS("g");elem.matteElement.appendChild(elem.layerElement);elem.matteElement.appendChild(elem.transformedElement);elem.baseElement=elem.matteElement;}SVGMatte3Effect.prototype.findSymbol=function(mask){var i=0,len=_svgMatteSymbols.length;while(i<len){if(_svgMatteSymbols[i]===mask){return _svgMatteSymbols[i];}i+=1;}return null;};SVGMatte3Effect.prototype.replaceInParent=function(mask,symbolId){var parentNode=mask.layerElement.parentNode;if(!parentNode){return;}var children=parentNode.children;var i=0,len=children.length;while(i<len){if(children[i]===mask.layerElement){break;}i+=1;}var nextChild;if(i<=len-2){nextChild=children[i+1];}var useElem=createNS("use");useElem.setAttribute("href","#"+symbolId);if(nextChild){parentNode.insertBefore(useElem,nextChild);}else{parentNode.appendChild(useElem);}};SVGMatte3Effect.prototype.setElementAsMask=function(elem,mask){if(!this.findSymbol(mask)){var symbolId=createElementID();var masker=createNS("mask");masker.setAttribute("id",mask.layerId);masker.setAttribute("mask-type","alpha");_svgMatteSymbols.push(mask);var defs=elem.globalData.defs;defs.appendChild(masker);var symbol=createNS("symbol");symbol.setAttribute("id",symbolId);this.replaceInParent(mask,symbolId);symbol.appendChild(mask.layerElement);defs.appendChild(symbol);var useElem=createNS("use");useElem.setAttribute("href","#"+symbolId);masker.appendChild(useElem);mask.data.hd=false;mask.show();}elem.setMatte(mask.layerId);};SVGMatte3Effect.prototype.initialize=function(){var ind=(this||_global).filterManager.effectElements[0].p.v;var elements=(this||_global).elem.comp.elements;var i=0,len=elements.length;while(i<len){if(elements[i]&&elements[i].data.ind===ind){this.setElementAsMask((this||_global).elem,elements[i]);}i+=1;}(this||_global).initialized=true;};SVGMatte3Effect.prototype.renderFrame=function(){if(!(this||_global).initialized){this.initialize();}};function SVGEffects(elem){var i,len=elem.data.ef?elem.data.ef.length:0;var filId=createElementID();var fil=filtersFactory.createFilter(filId);var count=0;(this||_global).filters=[];var filterManager;for(i=0;i<len;i+=1){filterManager=null;if(elem.data.ef[i].ty===20){count+=1;filterManager=new SVGTintFilter(fil,elem.effectsManager.effectElements[i]);}else if(elem.data.ef[i].ty===21){count+=1;filterManager=new SVGFillFilter(fil,elem.effectsManager.effectElements[i]);}else if(elem.data.ef[i].ty===22){filterManager=new SVGStrokeEffect(elem,elem.effectsManager.effectElements[i]);}else if(elem.data.ef[i].ty===23){count+=1;filterManager=new SVGTritoneFilter(fil,elem.effectsManager.effectElements[i]);}else if(elem.data.ef[i].ty===24){count+=1;filterManager=new SVGProLevelsFilter(fil,elem.effectsManager.effectElements[i]);}else if(elem.data.ef[i].ty===25){count+=1;filterManager=new SVGDropShadowEffect(fil,elem.effectsManager.effectElements[i]);}else if(elem.data.ef[i].ty===28){//count += 1;
filterManager=new SVGMatte3Effect(fil,elem.effectsManager.effectElements[i],elem);}else if(elem.data.ef[i].ty===29){count+=1;filterManager=new SVGGaussianBlurEffect(fil,elem.effectsManager.effectElements[i]);}if(filterManager){(this||_global).filters.push(filterManager);}}if(count){elem.globalData.defs.appendChild(fil);elem.layerElement.setAttribute("filter","url("+locationHref+"#"+filId+")");}if((this||_global).filters.length){elem.addRenderableComponent(this||_global);}}SVGEffects.prototype.renderFrame=function(_isFirstFrame){var i,len=(this||_global).filters.length;for(i=0;i<len;i+=1){(this||_global).filters[i].renderFrame(_isFirstFrame);}};function CVContextData(){(this||_global).saved=[];(this||_global).cArrPos=0;(this||_global).cTr=new Matrix();(this||_global).cO=1;var i,len=15;(this||_global).savedOp=createTypedArray("float32",len);for(i=0;i<len;i+=1){(this||_global).saved[i]=createTypedArray("float32",16);}(this||_global)._length=len;}CVContextData.prototype.duplicate=function(){var newLength=(this||_global)._length*2;var currentSavedOp=(this||_global).savedOp;(this||_global).savedOp=createTypedArray("float32",newLength);(this||_global).savedOp.set(currentSavedOp);var i=0;for(i=(this||_global)._length;i<newLength;i+=1){(this||_global).saved[i]=createTypedArray("float32",16);}(this||_global)._length=newLength;};CVContextData.prototype.reset=function(){(this||_global).cArrPos=0;(this||_global).cTr.reset();(this||_global).cO=1;};function CVBaseElement(){}CVBaseElement.prototype={createElements:function createElements(){},initRendererElement:function initRendererElement(){},createContainerElements:function createContainerElements(){(this||_global).canvasContext=(this||_global).globalData.canvasContext;(this||_global).renderableEffectsManager=new CVEffects(this||_global);},createContent:function createContent(){},setBlendMode:function setBlendMode(){var globalData=(this||_global).globalData;if(globalData.blendMode!==(this||_global).data.bm){globalData.blendMode=(this||_global).data.bm;var blendModeValue=getBlendMode((this||_global).data.bm);globalData.canvasContext.globalCompositeOperation=blendModeValue;}},createRenderableComponents:function createRenderableComponents(){(this||_global).maskManager=new CVMaskElement((this||_global).data,this||_global);},hideElement:function hideElement(){if(!(this||_global).hidden&&(!(this||_global).isInRange||(this||_global).isTransparent)){(this||_global).hidden=true;}},showElement:function showElement(){if((this||_global).isInRange&&!(this||_global).isTransparent){(this||_global).hidden=false;(this||_global)._isFirstFrame=true;(this||_global).maskManager._isFirstFrame=true;}},renderFrame:function renderFrame(){if((this||_global).hidden||(this||_global).data.hd){return;}this.renderTransform();this.renderRenderable();this.setBlendMode();var forceRealStack=(this||_global).data.ty===0;(this||_global).globalData.renderer.save(forceRealStack);(this||_global).globalData.renderer.ctxTransform((this||_global).finalTransform.mat.props);(this||_global).globalData.renderer.ctxOpacity((this||_global).finalTransform.mProp.o.v);this.renderInnerContent();(this||_global).globalData.renderer.restore(forceRealStack);if((this||_global).maskManager.hasMasks){(this||_global).globalData.renderer.restore(true);}if((this||_global)._isFirstFrame){(this||_global)._isFirstFrame=false;}},destroy:function destroy(){(this||_global).canvasContext=null;(this||_global).data=null;(this||_global).globalData=null;(this||_global).maskManager.destroy();},mHelper:new Matrix()};CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement;CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVImageElement(data,globalData,comp){(this||_global).assetData=globalData.getAssetData(data.refId);(this||_global).img=globalData.imageLoader.getImage((this||_global).assetData);this.initElement(data,globalData,comp);}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement);CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement;CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame;CVImageElement.prototype.createContent=function(){if((this||_global).img.width&&((this||_global).assetData.w!==(this||_global).img.width||(this||_global).assetData.h!==(this||_global).img.height)){var canvas=createTag("canvas");canvas.width=(this||_global).assetData.w;canvas.height=(this||_global).assetData.h;var ctx=canvas.getContext("2d");var imgW=(this||_global).img.width;var imgH=(this||_global).img.height;var imgRel=imgW/imgH;var canvasRel=(this||_global).assetData.w/(this||_global).assetData.h;var widthCrop,heightCrop;var par=(this||_global).assetData.pr||(this||_global).globalData.renderConfig.imagePreserveAspectRatio;if(imgRel>canvasRel&&par==="xMidYMid slice"||imgRel<canvasRel&&par!=="xMidYMid slice"){heightCrop=imgH;widthCrop=heightCrop*canvasRel;}else{widthCrop=imgW;heightCrop=widthCrop/canvasRel;}ctx.drawImage((this||_global).img,(imgW-widthCrop)/2,(imgH-heightCrop)/2,widthCrop,heightCrop,0,0,(this||_global).assetData.w,(this||_global).assetData.h);(this||_global).img=canvas;}};CVImageElement.prototype.renderInnerContent=function(parentMatrix){(this||_global).canvasContext.drawImage((this||_global).img,0,0);};CVImageElement.prototype.destroy=function(){(this||_global).img=null;};function CVCompElement(data,globalData,comp){(this||_global).completeLayers=false;(this||_global).layers=data.layers;(this||_global).pendingElements=[];(this||_global).elements=createSizedArray((this||_global).layers.length);this.initElement(data,globalData,comp);(this||_global).tm=data.tm?PropertyFactory.getProp(this||_global,data.tm,0,globalData.frameRate,this||_global):{_placeholder:true};}extendPrototype([CanvasRenderer,ICompElement,CVBaseElement],CVCompElement);CVCompElement.prototype.renderInnerContent=function(){var ctx=(this||_global).canvasContext;ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo((this||_global).data.w,0);ctx.lineTo((this||_global).data.w,(this||_global).data.h);ctx.lineTo(0,(this||_global).data.h);ctx.lineTo(0,0);ctx.clip();var i,len=(this||_global).layers.length;for(i=len-1;i>=0;i-=1){if((this||_global).completeLayers||(this||_global).elements[i]){(this||_global).elements[i].renderFrame();}}};CVCompElement.prototype.destroy=function(){var i,len=(this||_global).layers.length;for(i=len-1;i>=0;i-=1){if((this||_global).elements[i]){(this||_global).elements[i].destroy();}}(this||_global).layers=null;(this||_global).elements=null;};function CVMaskElement(data,element){(this||_global).data=data;(this||_global).element=element;(this||_global).masksProperties=(this||_global).data.masksProperties||[];(this||_global).viewData=createSizedArray((this||_global).masksProperties.length);var i,len=(this||_global).masksProperties.length,hasMasks=false;for(i=0;i<len;i++){if((this||_global).masksProperties[i].mode!=="n"){hasMasks=true;}(this||_global).viewData[i]=ShapePropertyFactory.getShapeProp((this||_global).element,(this||_global).masksProperties[i],3);}(this||_global).hasMasks=hasMasks;if(hasMasks){(this||_global).element.addRenderableComponent(this||_global);}}CVMaskElement.prototype.renderFrame=function(){if(!(this||_global).hasMasks){return;}var transform=(this||_global).element.finalTransform.mat;var ctx=(this||_global).element.canvasContext;var i,len=(this||_global).masksProperties.length;var pt,pts,data;ctx.beginPath();for(i=0;i<len;i++){if((this||_global).masksProperties[i].mode!=="n"){if((this||_global).masksProperties[i].inv){ctx.moveTo(0,0);ctx.lineTo((this||_global).element.globalData.compSize.w,0);ctx.lineTo((this||_global).element.globalData.compSize.w,(this||_global).element.globalData.compSize.h);ctx.lineTo(0,(this||_global).element.globalData.compSize.h);ctx.lineTo(0,0);}data=(this||_global).viewData[i].v;pt=transform.applyToPointArray(data.v[0][0],data.v[0][1],0);ctx.moveTo(pt[0],pt[1]);var j,jLen=data._length;for(j=1;j<jLen;j++){pts=transform.applyToTriplePoints(data.o[j-1],data.i[j],data.v[j]);ctx.bezierCurveTo(pts[0],pts[1],pts[2],pts[3],pts[4],pts[5]);}pts=transform.applyToTriplePoints(data.o[j-1],data.i[0],data.v[0]);ctx.bezierCurveTo(pts[0],pts[1],pts[2],pts[3],pts[4],pts[5]);}}(this||_global).element.globalData.renderer.save(true);ctx.clip();};CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty;CVMaskElement.prototype.destroy=function(){(this||_global).element=null;};function CVShapeElement(data,globalData,comp){(this||_global).shapes=[];(this||_global).shapesData=data.shapes;(this||_global).stylesList=[];(this||_global).itemsData=[];(this||_global).prevViewData=[];(this||_global).shapeModifiers=[];(this||_global).processedElements=[];(this||_global).transformsManager=new ShapeTransformManager();this.initElement(data,globalData,comp);}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement);CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement;CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:false};CVShapeElement.prototype.dashResetter=[];CVShapeElement.prototype.createContent=function(){this.searchShapes((this||_global).shapesData,(this||_global).itemsData,(this||_global).prevViewData,true,[]);};CVShapeElement.prototype.createStyleElement=function(data,transforms){var styleElem={data:data,type:data.ty,preTransforms:(this||_global).transformsManager.addTransformSequence(transforms),transforms:[],elements:[],closed:data.hd===true};var elementData={};if(data.ty=="fl"||data.ty=="st"){elementData.c=PropertyFactory.getProp(this||_global,data.c,1,255,this||_global);if(!elementData.c.k){styleElem.co="rgb("+bm_floor(elementData.c.v[0])+","+bm_floor(elementData.c.v[1])+","+bm_floor(elementData.c.v[2])+")";}}else if(data.ty==="gf"||data.ty==="gs"){elementData.s=PropertyFactory.getProp(this||_global,data.s,1,null,this||_global);elementData.e=PropertyFactory.getProp(this||_global,data.e,1,null,this||_global);elementData.h=PropertyFactory.getProp(this||_global,data.h||{k:0},0,0.01,this||_global);elementData.a=PropertyFactory.getProp(this||_global,data.a||{k:0},0,degToRads,this||_global);elementData.g=new GradientProperty(this||_global,data.g,this||_global);}elementData.o=PropertyFactory.getProp(this||_global,data.o,0,0.01,this||_global);if(data.ty=="st"||data.ty=="gs"){styleElem.lc=(this||_global).lcEnum[data.lc]||"round";styleElem.lj=(this||_global).ljEnum[data.lj]||"round";if(data.lj==1){styleElem.ml=data.ml;}elementData.w=PropertyFactory.getProp(this||_global,data.w,0,null,this||_global);if(!elementData.w.k){styleElem.wi=elementData.w.v;}if(data.d){var d=new DashProperty(this||_global,data.d,"canvas",this||_global);elementData.d=d;if(!elementData.d.k){styleElem.da=elementData.d.dashArray;styleElem["do"]=elementData.d.dashoffset[0];}}}else{styleElem.r=data.r===2?"evenodd":"nonzero";}(this||_global).stylesList.push(styleElem);elementData.style=styleElem;return elementData;};CVShapeElement.prototype.createGroupElement=function(data){var elementData={it:[],prevViewData:[]};return elementData;};CVShapeElement.prototype.createTransformElement=function(data){var elementData={transform:{opacity:1,_opMdf:false,key:(this||_global).transformsManager.getNewKey(),op:PropertyFactory.getProp(this||_global,data.o,0,0.01,this||_global),mProps:TransformPropertyFactory.getTransformProperty(this||_global,data,this||_global)}};return elementData;};CVShapeElement.prototype.createShapeElement=function(data){var elementData=new CVShapeData(this||_global,data,(this||_global).stylesList,(this||_global).transformsManager);(this||_global).shapes.push(elementData);this.addShapeToModifiers(elementData);return elementData;};CVShapeElement.prototype.reloadShapes=function(){(this||_global)._isFirstFrame=true;var i,len=(this||_global).itemsData.length;for(i=0;i<len;i+=1){(this||_global).prevViewData[i]=(this||_global).itemsData[i];}this.searchShapes((this||_global).shapesData,(this||_global).itemsData,(this||_global).prevViewData,true,[]);len=(this||_global).dynamicProperties.length;for(i=0;i<len;i+=1){(this||_global).dynamicProperties[i].getValue();}this.renderModifiers();(this||_global).transformsManager.processSequences((this||_global)._isFirstFrame);};CVShapeElement.prototype.addTransformToStyleList=function(transform){var i,len=(this||_global).stylesList.length;for(i=0;i<len;i+=1){if(!(this||_global).stylesList[i].closed){(this||_global).stylesList[i].transforms.push(transform);}}};CVShapeElement.prototype.removeTransformFromStyleList=function(){var i,len=(this||_global).stylesList.length;for(i=0;i<len;i+=1){if(!(this||_global).stylesList[i].closed){(this||_global).stylesList[i].transforms.pop();}}};CVShapeElement.prototype.closeStyles=function(styles){var i,len=styles.length;for(i=0;i<len;i+=1){styles[i].closed=true;}};CVShapeElement.prototype.searchShapes=function(arr,itemsData,prevViewData,shouldRender,transforms){var i,len=arr.length-1;var j,jLen;var ownStyles=[],ownModifiers=[],processedPos,modifier,currentTransform;var ownTransforms=[].concat(transforms);for(i=len;i>=0;i-=1){processedPos=this.searchProcessedElement(arr[i]);if(!processedPos){arr[i]._shouldRender=shouldRender;}else{itemsData[i]=prevViewData[processedPos-1];}if(arr[i].ty=="fl"||arr[i].ty=="st"||arr[i].ty=="gf"||arr[i].ty=="gs"){if(!processedPos){itemsData[i]=this.createStyleElement(arr[i],ownTransforms);}else{itemsData[i].style.closed=false;}ownStyles.push(itemsData[i].style);}else if(arr[i].ty=="gr"){if(!processedPos){itemsData[i]=this.createGroupElement(arr[i]);}else{jLen=itemsData[i].it.length;for(j=0;j<jLen;j+=1){itemsData[i].prevViewData[j]=itemsData[i].it[j];}}this.searchShapes(arr[i].it,itemsData[i].it,itemsData[i].prevViewData,shouldRender,ownTransforms);}else if(arr[i].ty=="tr"){if(!processedPos){currentTransform=this.createTransformElement(arr[i]);itemsData[i]=currentTransform;}ownTransforms.push(itemsData[i]);this.addTransformToStyleList(itemsData[i]);}else if(arr[i].ty=="sh"||arr[i].ty=="rc"||arr[i].ty=="el"||arr[i].ty=="sr"){if(!processedPos){itemsData[i]=this.createShapeElement(arr[i]);}}else if(arr[i].ty=="tm"||arr[i].ty=="rd"||arr[i].ty=="pb"){if(!processedPos){modifier=ShapeModifiers.getModifier(arr[i].ty);modifier.init(this||_global,arr[i]);itemsData[i]=modifier;(this||_global).shapeModifiers.push(modifier);}else{modifier=itemsData[i];modifier.closed=false;}ownModifiers.push(modifier);}else if(arr[i].ty=="rp"){if(!processedPos){modifier=ShapeModifiers.getModifier(arr[i].ty);itemsData[i]=modifier;modifier.init(this||_global,arr,i,itemsData);(this||_global).shapeModifiers.push(modifier);shouldRender=false;}else{modifier=itemsData[i];modifier.closed=true;}ownModifiers.push(modifier);}this.addProcessedElement(arr[i],i+1);}this.removeTransformFromStyleList();this.closeStyles(ownStyles);len=ownModifiers.length;for(i=0;i<len;i+=1){ownModifiers[i].closed=true;}};CVShapeElement.prototype.renderInnerContent=function(){(this||_global).transformHelper.opacity=1;(this||_global).transformHelper._opMdf=false;this.renderModifiers();(this||_global).transformsManager.processSequences((this||_global)._isFirstFrame);this.renderShape((this||_global).transformHelper,(this||_global).shapesData,(this||_global).itemsData,true);};CVShapeElement.prototype.renderShapeTransform=function(parentTransform,groupTransform){if(parentTransform._opMdf||groupTransform.op._mdf||(this||_global)._isFirstFrame){groupTransform.opacity=parentTransform.opacity;groupTransform.opacity*=groupTransform.op.v;groupTransform._opMdf=true;}};CVShapeElement.prototype.drawLayer=function(){var i,len=(this||_global).stylesList.length;var j,jLen,k,kLen,elems,nodes,renderer=(this||_global).globalData.renderer,ctx=(this||_global).globalData.canvasContext,type,currentStyle;for(i=0;i<len;i+=1){currentStyle=(this||_global).stylesList[i];type=currentStyle.type;//Skipping style when
//Stroke width equals 0
//style should not be rendered (extra unused repeaters)
//current opacity equals 0
//global opacity equals 0
if((type==="st"||type==="gs")&&currentStyle.wi===0||!currentStyle.data._shouldRender||currentStyle.coOp===0||(this||_global).globalData.currentGlobalAlpha===0){continue;}renderer.save();elems=currentStyle.elements;if(type==="st"||type==="gs"){ctx.strokeStyle=type==="st"?currentStyle.co:currentStyle.grd;ctx.lineWidth=currentStyle.wi;ctx.lineCap=currentStyle.lc;ctx.lineJoin=currentStyle.lj;ctx.miterLimit=currentStyle.ml||0;}else{ctx.fillStyle=type==="fl"?currentStyle.co:currentStyle.grd;}renderer.ctxOpacity(currentStyle.coOp);if(type!=="st"&&type!=="gs"){ctx.beginPath();}renderer.ctxTransform(currentStyle.preTransforms.finalTransform.props);jLen=elems.length;for(j=0;j<jLen;j+=1){if(type==="st"||type==="gs"){ctx.beginPath();if(currentStyle.da){ctx.setLineDash(currentStyle.da);ctx.lineDashOffset=currentStyle["do"];}}nodes=elems[j].trNodes;kLen=nodes.length;for(k=0;k<kLen;k+=1){if(nodes[k].t=="m"){ctx.moveTo(nodes[k].p[0],nodes[k].p[1]);}else if(nodes[k].t=="c"){ctx.bezierCurveTo(nodes[k].pts[0],nodes[k].pts[1],nodes[k].pts[2],nodes[k].pts[3],nodes[k].pts[4],nodes[k].pts[5]);}else{ctx.closePath();}}if(type==="st"||type==="gs"){ctx.stroke();if(currentStyle.da){ctx.setLineDash((this||_global).dashResetter);}}}if(type!=="st"&&type!=="gs"){ctx.fill(currentStyle.r);}renderer.restore();}};CVShapeElement.prototype.renderShape=function(parentTransform,items,data,isMain){var i,len=items.length-1;var groupTransform;groupTransform=parentTransform;for(i=len;i>=0;i-=1){if(items[i].ty=="tr"){groupTransform=data[i].transform;this.renderShapeTransform(parentTransform,groupTransform);}else if(items[i].ty=="sh"||items[i].ty=="el"||items[i].ty=="rc"||items[i].ty=="sr"){this.renderPath(items[i],data[i]);}else if(items[i].ty=="fl"){this.renderFill(items[i],data[i],groupTransform);}else if(items[i].ty=="st"){this.renderStroke(items[i],data[i],groupTransform);}else if(items[i].ty=="gf"||items[i].ty=="gs"){this.renderGradientFill(items[i],data[i],groupTransform);}else if(items[i].ty=="gr"){this.renderShape(groupTransform,items[i].it,data[i].it);}else if(items[i].ty=="tm");}if(isMain){this.drawLayer();}};CVShapeElement.prototype.renderStyledShape=function(styledShape,shape){if((this||_global)._isFirstFrame||shape._mdf||styledShape.transforms._mdf){var shapeNodes=styledShape.trNodes;var paths=shape.paths;var i,len,j,jLen=paths._length;shapeNodes.length=0;var groupTransformMat=styledShape.transforms.finalTransform;for(j=0;j<jLen;j+=1){var pathNodes=paths.shapes[j];if(pathNodes&&pathNodes.v){len=pathNodes._length;for(i=1;i<len;i+=1){if(i===1){shapeNodes.push({t:"m",p:groupTransformMat.applyToPointArray(pathNodes.v[0][0],pathNodes.v[0][1],0)});}shapeNodes.push({t:"c",pts:groupTransformMat.applyToTriplePoints(pathNodes.o[i-1],pathNodes.i[i],pathNodes.v[i])});}if(len===1){shapeNodes.push({t:"m",p:groupTransformMat.applyToPointArray(pathNodes.v[0][0],pathNodes.v[0][1],0)});}if(pathNodes.c&&len){shapeNodes.push({t:"c",pts:groupTransformMat.applyToTriplePoints(pathNodes.o[i-1],pathNodes.i[0],pathNodes.v[0])});shapeNodes.push({t:"z"});}}}styledShape.trNodes=shapeNodes;}};CVShapeElement.prototype.renderPath=function(pathData,itemData){if(pathData.hd!==true&&pathData._shouldRender){var i,len=itemData.styledShapes.length;for(i=0;i<len;i+=1){this.renderStyledShape(itemData.styledShapes[i],itemData.sh);}}};CVShapeElement.prototype.renderFill=function(styleData,itemData,groupTransform){var styleElem=itemData.style;if(itemData.c._mdf||(this||_global)._isFirstFrame){styleElem.co="rgb("+bm_floor(itemData.c.v[0])+","+bm_floor(itemData.c.v[1])+","+bm_floor(itemData.c.v[2])+")";}if(itemData.o._mdf||groupTransform._opMdf||(this||_global)._isFirstFrame){styleElem.coOp=itemData.o.v*groupTransform.opacity;}};CVShapeElement.prototype.renderGradientFill=function(styleData,itemData,groupTransform){var styleElem=itemData.style;if(!styleElem.grd||itemData.g._mdf||itemData.s._mdf||itemData.e._mdf||styleData.t!==1&&(itemData.h._mdf||itemData.a._mdf)){var ctx=(this||_global).globalData.canvasContext;var grd;var pt1=itemData.s.v,pt2=itemData.e.v;if(styleData.t===1){grd=ctx.createLinearGradient(pt1[0],pt1[1],pt2[0],pt2[1]);}else{var rad=Math.sqrt(Math.pow(pt1[0]-pt2[0],2)+Math.pow(pt1[1]-pt2[1],2));var ang=Math.atan2(pt2[1]-pt1[1],pt2[0]-pt1[0]);var percent=itemData.h.v>=1?0.99:itemData.h.v<=-1?-0.99:itemData.h.v;var dist=rad*percent;var x=Math.cos(ang+itemData.a.v)*dist+pt1[0];var y=Math.sin(ang+itemData.a.v)*dist+pt1[1];var grd=ctx.createRadialGradient(x,y,0,pt1[0],pt1[1],rad);}var i,len=styleData.g.p;var cValues=itemData.g.c;var opacity=1;for(i=0;i<len;i+=1){if(itemData.g._hasOpacity&&itemData.g._collapsable){opacity=itemData.g.o[i*2+1];}grd.addColorStop(cValues[i*4]/100,"rgba("+cValues[i*4+1]+","+cValues[i*4+2]+","+cValues[i*4+3]+","+opacity+")");}styleElem.grd=grd;}styleElem.coOp=itemData.o.v*groupTransform.opacity;};CVShapeElement.prototype.renderStroke=function(styleData,itemData,groupTransform){var styleElem=itemData.style;var d=itemData.d;if(d&&(d._mdf||(this||_global)._isFirstFrame)){styleElem.da=d.dashArray;styleElem["do"]=d.dashoffset[0];}if(itemData.c._mdf||(this||_global)._isFirstFrame){styleElem.co="rgb("+bm_floor(itemData.c.v[0])+","+bm_floor(itemData.c.v[1])+","+bm_floor(itemData.c.v[2])+")";}if(itemData.o._mdf||groupTransform._opMdf||(this||_global)._isFirstFrame){styleElem.coOp=itemData.o.v*groupTransform.opacity;}if(itemData.w._mdf||(this||_global)._isFirstFrame){styleElem.wi=itemData.w.v;}};CVShapeElement.prototype.destroy=function(){(this||_global).shapesData=null;(this||_global).globalData=null;(this||_global).canvasContext=null;(this||_global).stylesList.length=0;(this||_global).itemsData.length=0;};function CVSolidElement(data,globalData,comp){this.initElement(data,globalData,comp);}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement);CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement;CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame;CVSolidElement.prototype.renderInnerContent=function(){var ctx=(this||_global).canvasContext;ctx.fillStyle=(this||_global).data.sc;ctx.fillRect(0,0,(this||_global).data.sw,(this||_global).data.sh);//
};function CVTextElement(data,globalData,comp){(this||_global).textSpans=[];(this||_global).yOffset=0;(this||_global).fillColorAnim=false;(this||_global).strokeColorAnim=false;(this||_global).strokeWidthAnim=false;(this||_global).stroke=false;(this||_global).fill=false;(this||_global).justifyOffset=0;(this||_global).currentRender=null;(this||_global).renderType="canvas";(this||_global).values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""};this.initElement(data,globalData,comp);}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement);CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d");CVTextElement.prototype.buildNewText=function(){var documentData=(this||_global).textProperty.currentData;(this||_global).renderedLetters=createSizedArray(documentData.l?documentData.l.length:0);var hasFill=false;if(documentData.fc){hasFill=true;(this||_global).values.fill=this.buildColor(documentData.fc);}else{(this||_global).values.fill="rgba(0,0,0,0)";}(this||_global).fill=hasFill;var hasStroke=false;if(documentData.sc){hasStroke=true;(this||_global).values.stroke=this.buildColor(documentData.sc);(this||_global).values.sWidth=documentData.sw;}var fontData=(this||_global).globalData.fontManager.getFontByName(documentData.f);var i,len;var letters=documentData.l;var matrixHelper=(this||_global).mHelper;(this||_global).stroke=hasStroke;(this||_global).values.fValue=documentData.finalSize+"px "+(this||_global).globalData.fontManager.getFontByName(documentData.f).fFamily;len=documentData.finalText.length;//this.tHelper.font = this.values.fValue;
var charData,shapeData,k,kLen,shapes,j,jLen,pathNodes,commands,pathArr,singleShape=(this||_global).data.singleShape;var trackingOffset=documentData.tr/1000*documentData.finalSize;var xPos=0,yPos=0,firstLine=true;var cnt=0;for(i=0;i<len;i+=1){charData=(this||_global).globalData.fontManager.getCharData(documentData.finalText[i],fontData.fStyle,(this||_global).globalData.fontManager.getFontByName(documentData.f).fFamily);shapeData=charData&&charData.data||{};matrixHelper.reset();if(singleShape&&letters[i].n){xPos=-trackingOffset;yPos+=documentData.yOffset;yPos+=firstLine?1:0;firstLine=false;}shapes=shapeData.shapes?shapeData.shapes[0].it:[];jLen=shapes.length;matrixHelper.scale(documentData.finalSize/100,documentData.finalSize/100);if(singleShape){this.applyTextPropertiesToMatrix(documentData,matrixHelper,letters[i].line,xPos,yPos);}commands=createSizedArray(jLen);for(j=0;j<jLen;j+=1){kLen=shapes[j].ks.k.i.length;pathNodes=shapes[j].ks.k;pathArr=[];for(k=1;k<kLen;k+=1){if(k==1){pathArr.push(matrixHelper.applyToX(pathNodes.v[0][0],pathNodes.v[0][1],0),matrixHelper.applyToY(pathNodes.v[0][0],pathNodes.v[0][1],0));}pathArr.push(matrixHelper.applyToX(pathNodes.o[k-1][0],pathNodes.o[k-1][1],0),matrixHelper.applyToY(pathNodes.o[k-1][0],pathNodes.o[k-1][1],0),matrixHelper.applyToX(pathNodes.i[k][0],pathNodes.i[k][1],0),matrixHelper.applyToY(pathNodes.i[k][0],pathNodes.i[k][1],0),matrixHelper.applyToX(pathNodes.v[k][0],pathNodes.v[k][1],0),matrixHelper.applyToY(pathNodes.v[k][0],pathNodes.v[k][1],0));}pathArr.push(matrixHelper.applyToX(pathNodes.o[k-1][0],pathNodes.o[k-1][1],0),matrixHelper.applyToY(pathNodes.o[k-1][0],pathNodes.o[k-1][1],0),matrixHelper.applyToX(pathNodes.i[0][0],pathNodes.i[0][1],0),matrixHelper.applyToY(pathNodes.i[0][0],pathNodes.i[0][1],0),matrixHelper.applyToX(pathNodes.v[0][0],pathNodes.v[0][1],0),matrixHelper.applyToY(pathNodes.v[0][0],pathNodes.v[0][1],0));commands[j]=pathArr;}if(singleShape){xPos+=letters[i].l;xPos+=trackingOffset;}if((this||_global).textSpans[cnt]){(this||_global).textSpans[cnt].elem=commands;}else{(this||_global).textSpans[cnt]={elem:commands};}cnt+=1;}};CVTextElement.prototype.renderInnerContent=function(){var ctx=(this||_global).canvasContext;var finalMat=(this||_global).finalTransform.mat.props;ctx.font=(this||_global).values.fValue;ctx.lineCap="butt";ctx.lineJoin="miter";ctx.miterLimit=4;if(!(this||_global).data.singleShape){(this||_global).textAnimator.getMeasures((this||_global).textProperty.currentData,(this||_global).lettersChangedFlag);}var i,len,j,jLen,k,kLen;var renderedLetters=(this||_global).textAnimator.renderedLetters;var letters=(this||_global).textProperty.currentData.l;len=letters.length;var renderedLetter;var lastFill=null,lastStroke=null,lastStrokeW=null,commands,pathArr;for(i=0;i<len;i+=1){if(letters[i].n){continue;}renderedLetter=renderedLetters[i];if(renderedLetter){(this||_global).globalData.renderer.save();(this||_global).globalData.renderer.ctxTransform(renderedLetter.p);(this||_global).globalData.renderer.ctxOpacity(renderedLetter.o);}if((this||_global).fill){if(renderedLetter&&renderedLetter.fc){if(lastFill!==renderedLetter.fc){lastFill=renderedLetter.fc;ctx.fillStyle=renderedLetter.fc;}}else if(lastFill!==(this||_global).values.fill){lastFill=(this||_global).values.fill;ctx.fillStyle=(this||_global).values.fill;}commands=(this||_global).textSpans[i].elem;jLen=commands.length;(this||_global).globalData.canvasContext.beginPath();for(j=0;j<jLen;j+=1){pathArr=commands[j];kLen=pathArr.length;(this||_global).globalData.canvasContext.moveTo(pathArr[0],pathArr[1]);for(k=2;k<kLen;k+=6){(this||_global).globalData.canvasContext.bezierCurveTo(pathArr[k],pathArr[k+1],pathArr[k+2],pathArr[k+3],pathArr[k+4],pathArr[k+5]);}}(this||_global).globalData.canvasContext.closePath();(this||_global).globalData.canvasContext.fill();///ctx.fillText(this.textSpans[i].val,0,0);
}if((this||_global).stroke){if(renderedLetter&&renderedLetter.sw){if(lastStrokeW!==renderedLetter.sw){lastStrokeW=renderedLetter.sw;ctx.lineWidth=renderedLetter.sw;}}else if(lastStrokeW!==(this||_global).values.sWidth){lastStrokeW=(this||_global).values.sWidth;ctx.lineWidth=(this||_global).values.sWidth;}if(renderedLetter&&renderedLetter.sc){if(lastStroke!==renderedLetter.sc){lastStroke=renderedLetter.sc;ctx.strokeStyle=renderedLetter.sc;}}else if(lastStroke!==(this||_global).values.stroke){lastStroke=(this||_global).values.stroke;ctx.strokeStyle=(this||_global).values.stroke;}commands=(this||_global).textSpans[i].elem;jLen=commands.length;(this||_global).globalData.canvasContext.beginPath();for(j=0;j<jLen;j+=1){pathArr=commands[j];kLen=pathArr.length;(this||_global).globalData.canvasContext.moveTo(pathArr[0],pathArr[1]);for(k=2;k<kLen;k+=6){(this||_global).globalData.canvasContext.bezierCurveTo(pathArr[k],pathArr[k+1],pathArr[k+2],pathArr[k+3],pathArr[k+4],pathArr[k+5]);}}(this||_global).globalData.canvasContext.closePath();(this||_global).globalData.canvasContext.stroke();///ctx.strokeText(letters[i].val,0,0);
}if(renderedLetter){(this||_global).globalData.renderer.restore();}}};function CVEffects(){}CVEffects.prototype.renderFrame=function(){};function HBaseElement(data,globalData,comp){}HBaseElement.prototype={checkBlendMode:function checkBlendMode(){},initRendererElement:function initRendererElement(){(this||_global).baseElement=createTag((this||_global).data.tg||"div");if((this||_global).data.hasMask){(this||_global).svgElement=createNS("svg");(this||_global).layerElement=createNS("g");(this||_global).maskedElement=(this||_global).layerElement;(this||_global).svgElement.appendChild((this||_global).layerElement);(this||_global).baseElement.appendChild((this||_global).svgElement);}else{(this||_global).layerElement=(this||_global).baseElement;}styleDiv((this||_global).baseElement);},createContainerElements:function createContainerElements(){(this||_global).renderableEffectsManager=new CVEffects(this||_global);(this||_global).transformedElement=(this||_global).baseElement;(this||_global).maskedElement=(this||_global).layerElement;if((this||_global).data.ln){(this||_global).layerElement.setAttribute("id",(this||_global).data.ln);}if((this||_global).data.cl){(this||_global).layerElement.setAttribute("class",(this||_global).data.cl);}if((this||_global).data.bm!==0){this.setBlendMode();}},renderElement:function renderElement(){if((this||_global).finalTransform._matMdf){(this||_global).transformedElement.style.transform=(this||_global).transformedElement.style.webkitTransform=(this||_global).finalTransform.mat.toCSS();}if((this||_global).finalTransform._opMdf){(this||_global).transformedElement.style.opacity=(this||_global).finalTransform.mProp.o.v;}},renderFrame:function renderFrame(){//If it is exported as hidden (data.hd === true) no need to render
//If it is not visible no need to render
if((this||_global).data.hd||(this||_global).hidden){return;}this.renderTransform();this.renderRenderable();this.renderElement();this.renderInnerContent();if((this||_global)._isFirstFrame){(this||_global)._isFirstFrame=false;}},destroy:function destroy(){(this||_global).layerElement=null;(this||_global).transformedElement=null;if((this||_global).matteElement){(this||_global).matteElement=null;}if((this||_global).maskManager){(this||_global).maskManager.destroy();(this||_global).maskManager=null;}},createRenderableComponents:function createRenderableComponents(){(this||_global).maskManager=new MaskElement((this||_global).data,this||_global,(this||_global).globalData);},addEffects:function addEffects(){},setMatte:function setMatte(){}};HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement;HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy;HBaseElement.prototype.buildElementParenting=HybridRenderer.prototype.buildElementParenting;function HSolidElement(data,globalData,comp){this.initElement(data,globalData,comp);}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement);HSolidElement.prototype.createContent=function(){var rect;if((this||_global).data.hasMask){rect=createNS("rect");rect.setAttribute("width",(this||_global).data.sw);rect.setAttribute("height",(this||_global).data.sh);rect.setAttribute("fill",(this||_global).data.sc);(this||_global).svgElement.setAttribute("width",(this||_global).data.sw);(this||_global).svgElement.setAttribute("height",(this||_global).data.sh);}else{rect=createTag("div");rect.style.width=(this||_global).data.sw+"px";rect.style.height=(this||_global).data.sh+"px";rect.style.backgroundColor=(this||_global).data.sc;}(this||_global).layerElement.appendChild(rect);};function HCompElement(data,globalData,comp){(this||_global).layers=data.layers;(this||_global).supports3d=!data.hasMask;(this||_global).completeLayers=false;(this||_global).pendingElements=[];(this||_global).elements=(this||_global).layers?createSizedArray((this||_global).layers.length):[];this.initElement(data,globalData,comp);(this||_global).tm=data.tm?PropertyFactory.getProp(this||_global,data.tm,0,globalData.frameRate,this||_global):{_placeholder:true};}extendPrototype([HybridRenderer,ICompElement,HBaseElement],HCompElement);HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements;HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements();//divElement.style.clip = 'rect(0px, '+this.data.w+'px, '+this.data.h+'px, 0px)';
if((this||_global).data.hasMask){(this||_global).svgElement.setAttribute("width",(this||_global).data.w);(this||_global).svgElement.setAttribute("height",(this||_global).data.h);(this||_global).transformedElement=(this||_global).baseElement;}else{(this||_global).transformedElement=(this||_global).layerElement;}};HCompElement.prototype.addTo3dContainer=function(elem,pos){var j=0;var nextElement;while(j<pos){if((this||_global).elements[j]&&(this||_global).elements[j].getBaseElement){nextElement=(this||_global).elements[j].getBaseElement();}j+=1;}if(nextElement){(this||_global).layerElement.insertBefore(elem,nextElement);}else{(this||_global).layerElement.appendChild(elem);}};function HShapeElement(data,globalData,comp){//List of drawable elements
(this||_global).shapes=[];// Full shape data
(this||_global).shapesData=data.shapes;//List of styles that will be applied to shapes
(this||_global).stylesList=[];//List of modifiers that will be applied to shapes
(this||_global).shapeModifiers=[];//List of items in shape tree
(this||_global).itemsData=[];//List of items in previous shape tree
(this||_global).processedElements=[];// List of animated components
(this||_global).animatedContents=[];(this||_global).shapesContainer=createNS("g");this.initElement(data,globalData,comp);//Moving any property that doesn't get too much access after initialization because of v8 way of handling more than 10 properties.
// List of elements that have been created
(this||_global).prevViewData=[];(this||_global).currentBBox={x:999999,y:-999999,h:0,w:0};}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement);HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent;HShapeElement.prototype.createContent=function(){var cont;(this||_global).baseElement.style.fontSize=0;if((this||_global).data.hasMask){(this||_global).layerElement.appendChild((this||_global).shapesContainer);cont=(this||_global).svgElement;}else{cont=createNS("svg");var size=(this||_global).comp.data?(this||_global).comp.data:(this||_global).globalData.compSize;cont.setAttribute("width",size.w);cont.setAttribute("height",size.h);cont.appendChild((this||_global).shapesContainer);(this||_global).layerElement.appendChild(cont);}this.searchShapes((this||_global).shapesData,(this||_global).itemsData,(this||_global).prevViewData,(this||_global).shapesContainer,0,[],true);this.filterUniqueShapes();(this||_global).shapeCont=cont;};HShapeElement.prototype.getTransformedPoint=function(transformers,point){var i,len=transformers.length;for(i=0;i<len;i+=1){point=transformers[i].mProps.v.applyToPointArray(point[0],point[1],0);}return point;};HShapeElement.prototype.calculateShapeBoundingBox=function(item,boundingBox){var shape=item.sh.v;var transformers=item.transformers;var i,len=shape._length,vPoint,oPoint,nextIPoint,nextVPoint;if(len<=1){return;}for(i=0;i<len-1;i+=1){vPoint=this.getTransformedPoint(transformers,shape.v[i]);oPoint=this.getTransformedPoint(transformers,shape.o[i]);nextIPoint=this.getTransformedPoint(transformers,shape.i[i+1]);nextVPoint=this.getTransformedPoint(transformers,shape.v[i+1]);this.checkBounds(vPoint,oPoint,nextIPoint,nextVPoint,boundingBox);}if(shape.c){vPoint=this.getTransformedPoint(transformers,shape.v[i]);oPoint=this.getTransformedPoint(transformers,shape.o[i]);nextIPoint=this.getTransformedPoint(transformers,shape.i[0]);nextVPoint=this.getTransformedPoint(transformers,shape.v[0]);this.checkBounds(vPoint,oPoint,nextIPoint,nextVPoint,boundingBox);}};HShapeElement.prototype.checkBounds=function(vPoint,oPoint,nextIPoint,nextVPoint,boundingBox){this.getBoundsOfCurve(vPoint,oPoint,nextIPoint,nextVPoint);var bounds=(this||_global).shapeBoundingBox;boundingBox.x=bm_min(bounds.left,boundingBox.x);boundingBox.xMax=bm_max(bounds.right,boundingBox.xMax);boundingBox.y=bm_min(bounds.top,boundingBox.y);boundingBox.yMax=bm_max(bounds.bottom,boundingBox.yMax);};HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0};HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0};HShapeElement.prototype.getBoundsOfCurve=function(p0,p1,p2,p3){var bounds=[[p0[0],p3[0]],[p0[1],p3[1]]];for(var a,b,c,t,b2ac,t1,t2,i=0;i<2;++i){b=6*p0[i]-12*p1[i]+6*p2[i];a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i];c=3*p1[i]-3*p0[i];b=b|0;a=a|0;c=c|0;if(a===0){if(b===0){continue;}t=-c/b;if(0<t&&t<1){bounds[i].push(this.calculateF(t,p0,p1,p2,p3,i));}continue;}b2ac=b*b-4*c*a;if(b2ac<0){continue;}t1=(-b+bm_sqrt(b2ac))/(2*a);if(0<t1&&t1<1)bounds[i].push(this.calculateF(t1,p0,p1,p2,p3,i));t2=(-b-bm_sqrt(b2ac))/(2*a);if(0<t2&&t2<1)bounds[i].push(this.calculateF(t2,p0,p1,p2,p3,i));}(this||_global).shapeBoundingBox.left=bm_min.apply(null,bounds[0]);(this||_global).shapeBoundingBox.top=bm_min.apply(null,bounds[1]);(this||_global).shapeBoundingBox.right=bm_max.apply(null,bounds[0]);(this||_global).shapeBoundingBox.bottom=bm_max.apply(null,bounds[1]);};HShapeElement.prototype.calculateF=function(t,p0,p1,p2,p3,i){return bm_pow(1-t,3)*p0[i]+3*bm_pow(1-t,2)*t*p1[i]+3*(1-t)*bm_pow(t,2)*p2[i]+bm_pow(t,3)*p3[i];};HShapeElement.prototype.calculateBoundingBox=function(itemsData,boundingBox){var i,len=itemsData.length;for(i=0;i<len;i+=1){if(itemsData[i]&&itemsData[i].sh){this.calculateShapeBoundingBox(itemsData[i],boundingBox);}else if(itemsData[i]&&itemsData[i].it){this.calculateBoundingBox(itemsData[i].it,boundingBox);}}};HShapeElement.prototype.currentBoxContains=function(box){return(this||_global).currentBBox.x<=box.x&&(this||_global).currentBBox.y<=box.y&&(this||_global).currentBBox.width+(this||_global).currentBBox.x>=box.x+box.width&&(this||_global).currentBBox.height+(this||_global).currentBBox.y>=box.y+box.height;};HShapeElement.prototype.renderInnerContent=function(){this._renderShapeFrame();if(!(this||_global).hidden&&((this||_global)._isFirstFrame||(this||_global)._mdf)){var tempBoundingBox=(this||_global).tempBoundingBox;var max=999999;tempBoundingBox.x=max;tempBoundingBox.xMax=-max;tempBoundingBox.y=max;tempBoundingBox.yMax=-max;this.calculateBoundingBox((this||_global).itemsData,tempBoundingBox);tempBoundingBox.width=tempBoundingBox.xMax<tempBoundingBox.x?0:tempBoundingBox.xMax-tempBoundingBox.x;tempBoundingBox.height=tempBoundingBox.yMax<tempBoundingBox.y?0:tempBoundingBox.yMax-tempBoundingBox.y;//var tempBoundingBox = this.shapeCont.getBBox();
if(this.currentBoxContains(tempBoundingBox)){return;}var changed=false;if((this||_global).currentBBox.w!==tempBoundingBox.width){(this||_global).currentBBox.w=tempBoundingBox.width;(this||_global).shapeCont.setAttribute("width",tempBoundingBox.width);changed=true;}if((this||_global).currentBBox.h!==tempBoundingBox.height){(this||_global).currentBBox.h=tempBoundingBox.height;(this||_global).shapeCont.setAttribute("height",tempBoundingBox.height);changed=true;}if(changed||(this||_global).currentBBox.x!==tempBoundingBox.x||(this||_global).currentBBox.y!==tempBoundingBox.y){(this||_global).currentBBox.w=tempBoundingBox.width;(this||_global).currentBBox.h=tempBoundingBox.height;(this||_global).currentBBox.x=tempBoundingBox.x;(this||_global).currentBBox.y=tempBoundingBox.y;(this||_global).shapeCont.setAttribute("viewBox",(this||_global).currentBBox.x+" "+(this||_global).currentBBox.y+" "+(this||_global).currentBBox.w+" "+(this||_global).currentBBox.h);(this||_global).shapeCont.style.transform=(this||_global).shapeCont.style.webkitTransform="translate("+(this||_global).currentBBox.x+"px,"+(this||_global).currentBBox.y+"px)";}}};function HTextElement(data,globalData,comp){(this||_global).textSpans=[];(this||_global).textPaths=[];(this||_global).currentBBox={x:999999,y:-999999,h:0,w:0};(this||_global).renderType="svg";(this||_global).isMasked=false;this.initElement(data,globalData,comp);}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement);HTextElement.prototype.createContent=function(){(this||_global).isMasked=this.checkMasks();if((this||_global).isMasked){(this||_global).renderType="svg";(this||_global).compW=(this||_global).comp.data.w;(this||_global).compH=(this||_global).comp.data.h;(this||_global).svgElement.setAttribute("width",(this||_global).compW);(this||_global).svgElement.setAttribute("height",(this||_global).compH);var g=createNS("g");(this||_global).maskedElement.appendChild(g);(this||_global).innerElem=g;}else{(this||_global).renderType="html";(this||_global).innerElem=(this||_global).layerElement;}this.checkParenting();};HTextElement.prototype.buildNewText=function(){var documentData=(this||_global).textProperty.currentData;(this||_global).renderedLetters=createSizedArray(documentData.l?documentData.l.length:0);var innerElemStyle=(this||_global).innerElem.style;innerElemStyle.color=innerElemStyle.fill=documentData.fc?this.buildColor(documentData.fc):"rgba(0,0,0,0)";if(documentData.sc){innerElemStyle.stroke=this.buildColor(documentData.sc);innerElemStyle.strokeWidth=documentData.sw+"px";}var fontData=(this||_global).globalData.fontManager.getFontByName(documentData.f);if(!(this||_global).globalData.fontManager.chars){innerElemStyle.fontSize=documentData.finalSize+"px";innerElemStyle.lineHeight=documentData.finalSize+"px";if(fontData.fClass){(this||_global).innerElem.className=fontData.fClass;}else{innerElemStyle.fontFamily=fontData.fFamily;var fWeight=documentData.fWeight,fStyle=documentData.fStyle;innerElemStyle.fontStyle=fStyle;innerElemStyle.fontWeight=fWeight;}}var i,len;var letters=documentData.l;len=letters.length;var tSpan,tParent,tCont;var matrixHelper=(this||_global).mHelper;var shapes,shapeStr="";var cnt=0;for(i=0;i<len;i+=1){if((this||_global).globalData.fontManager.chars){if(!(this||_global).textPaths[cnt]){tSpan=createNS("path");tSpan.setAttribute("stroke-linecap","butt");tSpan.setAttribute("stroke-linejoin","round");tSpan.setAttribute("stroke-miterlimit","4");}else{tSpan=(this||_global).textPaths[cnt];}if(!(this||_global).isMasked){if((this||_global).textSpans[cnt]){tParent=(this||_global).textSpans[cnt];tCont=tParent.children[0];}else{tParent=createTag("div");tParent.style.lineHeight=0;tCont=createNS("svg");tCont.appendChild(tSpan);styleDiv(tParent);}}}else{if(!(this||_global).isMasked){if((this||_global).textSpans[cnt]){tParent=(this||_global).textSpans[cnt];tSpan=(this||_global).textPaths[cnt];}else{tParent=createTag("span");styleDiv(tParent);tSpan=createTag("span");styleDiv(tSpan);tParent.appendChild(tSpan);}}else{tSpan=(this||_global).textPaths[cnt]?(this||_global).textPaths[cnt]:createNS("text");}}//tSpan.setAttribute('visibility', 'hidden');
if((this||_global).globalData.fontManager.chars){var charData=(this||_global).globalData.fontManager.getCharData(documentData.finalText[i],fontData.fStyle,(this||_global).globalData.fontManager.getFontByName(documentData.f).fFamily);var shapeData;if(charData){shapeData=charData.data;}else{shapeData=null;}matrixHelper.reset();if(shapeData&&shapeData.shapes){shapes=shapeData.shapes[0].it;matrixHelper.scale(documentData.finalSize/100,documentData.finalSize/100);shapeStr=this.createPathShape(matrixHelper,shapes);tSpan.setAttribute("d",shapeStr);}if(!(this||_global).isMasked){(this||_global).innerElem.appendChild(tParent);if(shapeData&&shapeData.shapes){//document.body.appendChild is needed to get exact measure of shape
document.body.appendChild(tCont);var boundingBox=tCont.getBBox();tCont.setAttribute("width",boundingBox.width+2);tCont.setAttribute("height",boundingBox.height+2);tCont.setAttribute("viewBox",boundingBox.x-1+" "+(boundingBox.y-1)+" "+(boundingBox.width+2)+" "+(boundingBox.height+2));tCont.style.transform=tCont.style.webkitTransform="translate("+(boundingBox.x-1)+"px,"+(boundingBox.y-1)+"px)";letters[i].yOffset=boundingBox.y-1;}else{tCont.setAttribute("width",1);tCont.setAttribute("height",1);}tParent.appendChild(tCont);}else{(this||_global).innerElem.appendChild(tSpan);}}else{tSpan.textContent=letters[i].val;tSpan.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve");if(!(this||_global).isMasked){(this||_global).innerElem.appendChild(tParent);//
tSpan.style.transform=tSpan.style.webkitTransform="translate3d(0,"+-documentData.finalSize/1.2+"px,0)";}else{(this||_global).innerElem.appendChild(tSpan);}}//
if(!(this||_global).isMasked){(this||_global).textSpans[cnt]=tParent;}else{(this||_global).textSpans[cnt]=tSpan;}(this||_global).textSpans[cnt].style.display="block";(this||_global).textPaths[cnt]=tSpan;cnt+=1;}while(cnt<(this||_global).textSpans.length){(this||_global).textSpans[cnt].style.display="none";cnt+=1;}};HTextElement.prototype.renderInnerContent=function(){if((this||_global).data.singleShape){if(!(this||_global)._isFirstFrame&&!(this||_global).lettersChangedFlag){return;}else{// Todo Benchmark if using this is better than getBBox
if((this||_global).isMasked&&(this||_global).finalTransform._matMdf){(this||_global).svgElement.setAttribute("viewBox",-(this||_global).finalTransform.mProp.p.v[0]+" "+-(this||_global).finalTransform.mProp.p.v[1]+" "+(this||_global).compW+" "+(this||_global).compH);(this||_global).svgElement.style.transform=(this||_global).svgElement.style.webkitTransform="translate("+-(this||_global).finalTransform.mProp.p.v[0]+"px,"+-(this||_global).finalTransform.mProp.p.v[1]+"px)";}}}(this||_global).textAnimator.getMeasures((this||_global).textProperty.currentData,(this||_global).lettersChangedFlag);if(!(this||_global).lettersChangedFlag&&!(this||_global).textAnimator.lettersChangedFlag){return;}var i,len,count=0;var renderedLetters=(this||_global).textAnimator.renderedLetters;var letters=(this||_global).textProperty.currentData.l;len=letters.length;var renderedLetter,textSpan,textPath;for(i=0;i<len;i+=1){if(letters[i].n){count+=1;continue;}textSpan=(this||_global).textSpans[i];textPath=(this||_global).textPaths[i];renderedLetter=renderedLetters[count];count+=1;if(renderedLetter._mdf.m){if(!(this||_global).isMasked){textSpan.style.transform=textSpan.style.webkitTransform=renderedLetter.m;}else{textSpan.setAttribute("transform",renderedLetter.m);}}////textSpan.setAttribute('opacity',renderedLetter.o);
textSpan.style.opacity=renderedLetter.o;if(renderedLetter.sw&&renderedLetter._mdf.sw){textPath.setAttribute("stroke-width",renderedLetter.sw);}if(renderedLetter.sc&&renderedLetter._mdf.sc){textPath.setAttribute("stroke",renderedLetter.sc);}if(renderedLetter.fc&&renderedLetter._mdf.fc){textPath.setAttribute("fill",renderedLetter.fc);textPath.style.color=renderedLetter.fc;}}if((this||_global).innerElem.getBBox&&!(this||_global).hidden&&((this||_global)._isFirstFrame||(this||_global)._mdf)){var boundingBox=(this||_global).innerElem.getBBox();if((this||_global).currentBBox.w!==boundingBox.width){(this||_global).currentBBox.w=boundingBox.width;(this||_global).svgElement.setAttribute("width",boundingBox.width);}if((this||_global).currentBBox.h!==boundingBox.height){(this||_global).currentBBox.h=boundingBox.height;(this||_global).svgElement.setAttribute("height",boundingBox.height);}var margin=1;if((this||_global).currentBBox.w!==boundingBox.width+margin*2||(this||_global).currentBBox.h!==boundingBox.height+margin*2||(this||_global).currentBBox.x!==boundingBox.x-margin||(this||_global).currentBBox.y!==boundingBox.y-margin){(this||_global).currentBBox.w=boundingBox.width+margin*2;(this||_global).currentBBox.h=boundingBox.height+margin*2;(this||_global).currentBBox.x=boundingBox.x-margin;(this||_global).currentBBox.y=boundingBox.y-margin;(this||_global).svgElement.setAttribute("viewBox",(this||_global).currentBBox.x+" "+(this||_global).currentBBox.y+" "+(this||_global).currentBBox.w+" "+(this||_global).currentBBox.h);(this||_global).svgElement.style.transform=(this||_global).svgElement.style.webkitTransform="translate("+(this||_global).currentBBox.x+"px,"+(this||_global).currentBBox.y+"px)";}}};function HImageElement(data,globalData,comp){(this||_global).assetData=globalData.getAssetData(data.refId);this.initElement(data,globalData,comp);}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement);HImageElement.prototype.createContent=function(){var assetPath=(this||_global).globalData.getAssetsPath((this||_global).assetData);var img=new Image();if((this||_global).data.hasMask){(this||_global).imageElem=createNS("image");(this||_global).imageElem.setAttribute("width",(this||_global).assetData.w+"px");(this||_global).imageElem.setAttribute("height",(this||_global).assetData.h+"px");(this||_global).imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",assetPath);(this||_global).layerElement.appendChild((this||_global).imageElem);(this||_global).baseElement.setAttribute("width",(this||_global).assetData.w);(this||_global).baseElement.setAttribute("height",(this||_global).assetData.h);}else{(this||_global).layerElement.appendChild(img);}img.crossOrigin="anonymous";img.src=assetPath;if((this||_global).data.ln){(this||_global).baseElement.setAttribute("id",(this||_global).data.ln);}};function HCameraElement(data,globalData,comp){this.initFrame();this.initBaseData(data,globalData,comp);this.initHierarchy();var getProp=PropertyFactory.getProp;(this||_global).pe=getProp(this||_global,data.pe,0,0,this||_global);if(data.ks.p.s){(this||_global).px=getProp(this||_global,data.ks.p.x,1,0,this||_global);(this||_global).py=getProp(this||_global,data.ks.p.y,1,0,this||_global);(this||_global).pz=getProp(this||_global,data.ks.p.z,1,0,this||_global);}else{(this||_global).p=getProp(this||_global,data.ks.p,1,0,this||_global);}if(data.ks.a){(this||_global).a=getProp(this||_global,data.ks.a,1,0,this||_global);}if(data.ks.or.k.length&&data.ks.or.k[0].to){var i,len=data.ks.or.k.length;for(i=0;i<len;i+=1){data.ks.or.k[i].to=null;data.ks.or.k[i].ti=null;}}(this||_global).or=getProp(this||_global,data.ks.or,1,degToRads,this||_global);(this||_global).or.sh=true;(this||_global).rx=getProp(this||_global,data.ks.rx,0,degToRads,this||_global);(this||_global).ry=getProp(this||_global,data.ks.ry,0,degToRads,this||_global);(this||_global).rz=getProp(this||_global,data.ks.rz,0,degToRads,this||_global);(this||_global).mat=new Matrix();(this||_global)._prevMat=new Matrix();(this||_global)._isFirstFrame=true;// TODO: find a better way to make the HCamera element to be compatible with the LayerInterface and TransformInterface.
(this||_global).finalTransform={mProp:this||_global};}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement);HCameraElement.prototype.setup=function(){var i,len=(this||_global).comp.threeDElements.length,comp;for(i=0;i<len;i+=1){//[perspectiveElem,container]
comp=(this||_global).comp.threeDElements[i];if(comp.type==="3d"){comp.perspectiveElem.style.perspective=comp.perspectiveElem.style.webkitPerspective=(this||_global).pe.v+"px";comp.container.style.transformOrigin=comp.container.style.mozTransformOrigin=comp.container.style.webkitTransformOrigin="0px 0px 0px";comp.perspectiveElem.style.transform=comp.perspectiveElem.style.webkitTransform="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";}}};HCameraElement.prototype.createElements=function(){};HCameraElement.prototype.hide=function(){};HCameraElement.prototype.renderFrame=function(){var _mdf=(this||_global)._isFirstFrame;var i,len;if((this||_global).hierarchy){len=(this||_global).hierarchy.length;for(i=0;i<len;i+=1){_mdf=(this||_global).hierarchy[i].finalTransform.mProp._mdf||_mdf;}}if(_mdf||(this||_global).pe._mdf||(this||_global).p&&(this||_global).p._mdf||(this||_global).px&&((this||_global).px._mdf||(this||_global).py._mdf||(this||_global).pz._mdf)||(this||_global).rx._mdf||(this||_global).ry._mdf||(this||_global).rz._mdf||(this||_global).or._mdf||(this||_global).a&&(this||_global).a._mdf){(this||_global).mat.reset();if((this||_global).hierarchy){len=(this||_global).hierarchy.length-1;for(i=len;i>=0;i-=1){var mTransf=(this||_global).hierarchy[i].finalTransform.mProp;(this||_global).mat.translate(-mTransf.p.v[0],-mTransf.p.v[1],mTransf.p.v[2]);(this||_global).mat.rotateX(-mTransf.or.v[0]).rotateY(-mTransf.or.v[1]).rotateZ(mTransf.or.v[2]);(this||_global).mat.rotateX(-mTransf.rx.v).rotateY(-mTransf.ry.v).rotateZ(mTransf.rz.v);(this||_global).mat.scale(1/mTransf.s.v[0],1/mTransf.s.v[1],1/mTransf.s.v[2]);(this||_global).mat.translate(mTransf.a.v[0],mTransf.a.v[1],mTransf.a.v[2]);}}if((this||_global).p){(this||_global).mat.translate(-(this||_global).p.v[0],-(this||_global).p.v[1],(this||_global).p.v[2]);}else{(this||_global).mat.translate(-(this||_global).px.v,-(this||_global).py.v,(this||_global).pz.v);}if((this||_global).a){var diffVector;if((this||_global).p){diffVector=[(this||_global).p.v[0]-(this||_global).a.v[0],(this||_global).p.v[1]-(this||_global).a.v[1],(this||_global).p.v[2]-(this||_global).a.v[2]];}else{diffVector=[(this||_global).px.v-(this||_global).a.v[0],(this||_global).py.v-(this||_global).a.v[1],(this||_global).pz.v-(this||_global).a.v[2]];}var mag=Math.sqrt(Math.pow(diffVector[0],2)+Math.pow(diffVector[1],2)+Math.pow(diffVector[2],2));//var lookDir = getNormalizedPoint(getDiffVector(this.a.v,this.p.v));
var lookDir=[diffVector[0]/mag,diffVector[1]/mag,diffVector[2]/mag];var lookLengthOnXZ=Math.sqrt(lookDir[2]*lookDir[2]+lookDir[0]*lookDir[0]);var m_rotationX=Math.atan2(lookDir[1],lookLengthOnXZ);var m_rotationY=Math.atan2(lookDir[0],-lookDir[2]);(this||_global).mat.rotateY(m_rotationY).rotateX(-m_rotationX);}(this||_global).mat.rotateX(-(this||_global).rx.v).rotateY(-(this||_global).ry.v).rotateZ((this||_global).rz.v);(this||_global).mat.rotateX(-(this||_global).or.v[0]).rotateY(-(this||_global).or.v[1]).rotateZ((this||_global).or.v[2]);(this||_global).mat.translate((this||_global).globalData.compSize.w/2,(this||_global).globalData.compSize.h/2,0);(this||_global).mat.translate(0,0,(this||_global).pe.v);var hasMatrixChanged=!(this||_global)._prevMat.equals((this||_global).mat);if((hasMatrixChanged||(this||_global).pe._mdf)&&(this||_global).comp.threeDElements){len=(this||_global).comp.threeDElements.length;var comp;for(i=0;i<len;i+=1){comp=(this||_global).comp.threeDElements[i];if(comp.type==="3d"){if(hasMatrixChanged){comp.container.style.transform=comp.container.style.webkitTransform=(this||_global).mat.toCSS();}if((this||_global).pe._mdf){comp.perspectiveElem.style.perspective=comp.perspectiveElem.style.webkitPerspective=(this||_global).pe.v+"px";}}}(this||_global).mat.clone((this||_global)._prevMat);}}(this||_global)._isFirstFrame=false;};HCameraElement.prototype.prepareFrame=function(num){this.prepareProperties(num,true);};HCameraElement.prototype.destroy=function(){};HCameraElement.prototype.getBaseElement=function(){return null;};var animationManager=function(){var moduleOb={};var registeredAnimations=[];var initTime=0;var len=0;var playingAnimationsNum=0;var _stopped=true;var _isFrozen=false;function removeElement(ev){var i=0;var animItem=ev.target;while(i<len){if(registeredAnimations[i].animation===animItem){registeredAnimations.splice(i,1);i-=1;len-=1;if(!animItem.isPaused){subtractPlayingCount();}}i+=1;}}function registerAnimation(element,animationData){if(!element){return null;}var i=0;while(i<len){if(registeredAnimations[i].elem==element&&registeredAnimations[i].elem!==null){return registeredAnimations[i].animation;}i+=1;}var animItem=new AnimationItem();setupAnimation(animItem,element);animItem.setData(element,animationData);return animItem;}function getRegisteredAnimations(){var i,len=registeredAnimations.length;var animations=[];for(i=0;i<len;i+=1){animations.push(registeredAnimations[i].animation);}return animations;}function addPlayingCount(){playingAnimationsNum+=1;activate();}function subtractPlayingCount(){playingAnimationsNum-=1;}function setupAnimation(animItem,element){animItem.addEventListener("destroy",removeElement);animItem.addEventListener("_active",addPlayingCount);animItem.addEventListener("_idle",subtractPlayingCount);registeredAnimations.push({elem:element,animation:animItem});len+=1;}function loadAnimation(params){var animItem=new AnimationItem();setupAnimation(animItem,null);animItem.setParams(params);return animItem;}function setSpeed(val,animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.setSpeed(val,animation);}}function setDirection(val,animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.setDirection(val,animation);}}function play(animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.play(animation);}}function resume(nowTime){var elapsedTime=nowTime-initTime;var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.advanceTime(elapsedTime);}initTime=nowTime;if(playingAnimationsNum&&!_isFrozen){window.requestAnimationFrame(resume);}else{_stopped=true;}}function first(nowTime){initTime=nowTime;window.requestAnimationFrame(resume);}function pause(animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.pause(animation);}}function goToAndStop(value,isFrame,animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.goToAndStop(value,isFrame,animation);}}function stop(animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.stop(animation);}}function togglePause(animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.togglePause(animation);}}function destroy(animation){var i;for(i=len-1;i>=0;i-=1){registeredAnimations[i].animation.destroy(animation);}}function searchAnimations(animationData,standalone,renderer){var animElements=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin")));var i,len=animElements.length;for(i=0;i<len;i+=1){if(renderer){animElements[i].setAttribute("data-bm-type",renderer);}registerAnimation(animElements[i],animationData);}if(standalone&&len===0){if(!renderer){renderer="svg";}var body=document.getElementsByTagName("body")[0];body.innerText="";var div=createTag("div");div.style.width="100%";div.style.height="100%";div.setAttribute("data-bm-type",renderer);body.appendChild(div);registerAnimation(div,animationData);}}function resize(){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.resize();}}function activate(){if(!_isFrozen&&playingAnimationsNum){if(_stopped){window.requestAnimationFrame(first);_stopped=false;}}}function freeze(){_isFrozen=true;}function unfreeze(){_isFrozen=false;activate();}function setVolume(val,animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.setVolume(val,animation);}}function mute(animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.mute(animation);}}function unmute(animation){var i;for(i=0;i<len;i+=1){registeredAnimations[i].animation.unmute(animation);}}moduleOb.registerAnimation=registerAnimation;moduleOb.loadAnimation=loadAnimation;moduleOb.setSpeed=setSpeed;moduleOb.setDirection=setDirection;moduleOb.play=play;moduleOb.pause=pause;moduleOb.stop=stop;moduleOb.togglePause=togglePause;moduleOb.searchAnimations=searchAnimations;moduleOb.resize=resize;//moduleOb.start = start;
moduleOb.goToAndStop=goToAndStop;moduleOb.destroy=destroy;moduleOb.freeze=freeze;moduleOb.unfreeze=unfreeze;moduleOb.setVolume=setVolume;moduleOb.mute=mute;moduleOb.unmute=unmute;moduleOb.getRegisteredAnimations=getRegisteredAnimations;return moduleOb;}();var AnimationItem=function AnimationItem(){(this||_global)._cbs=[];(this||_global).name="";(this||_global).path="";(this||_global).isLoaded=false;(this||_global).currentFrame=0;(this||_global).currentRawFrame=0;(this||_global).firstFrame=0;(this||_global).totalFrames=0;(this||_global).frameRate=0;(this||_global).frameMult=0;(this||_global).playSpeed=1;(this||_global).playDirection=1;(this||_global).playCount=0;(this||_global).animationData={};(this||_global).assets=[];(this||_global).isPaused=true;(this||_global).autoplay=false;(this||_global).loop=true;(this||_global).renderer=null;(this||_global).animationID=createElementID();(this||_global).assetsPath="";(this||_global).timeCompleted=0;(this||_global).segmentPos=0;(this||_global).isSubframeEnabled=subframeEnabled;(this||_global).segments=[];(this||_global)._idle=true;(this||_global)._completedLoop=false;(this||_global).projectInterface=ProjectInterface();(this||_global).imagePreloader=new ImagePreloader();(this||_global).audioController=audioControllerFactory();};extendPrototype([BaseEvent],AnimationItem);AnimationItem.prototype.setParams=function(params){if(params.wrapper||params.container){(this||_global).wrapper=params.wrapper||params.container;}var animType=params.animType?params.animType:params.renderer?params.renderer:"svg";switch(animType){case"canvas":(this||_global).renderer=new CanvasRenderer(this||_global,params.rendererSettings);break;case"svg":(this||_global).renderer=new SVGRenderer(this||_global,params.rendererSettings);break;default:(this||_global).renderer=new HybridRenderer(this||_global,params.rendererSettings);break;}(this||_global).imagePreloader.setCacheType(animType,(this||_global).renderer.globalData.defs);(this||_global).renderer.setProjectInterface((this||_global).projectInterface);(this||_global).animType=animType;if(params.loop===""||params.loop===null||params.loop===undefined||params.loop===true){(this||_global).loop=true;}else if(params.loop===false){(this||_global).loop=false;}else{(this||_global).loop=parseInt(params.loop);}(this||_global).autoplay="autoplay"in params?params.autoplay:true;(this||_global).name=params.name?params.name:"";(this||_global).autoloadSegments=params.hasOwnProperty("autoloadSegments")?params.autoloadSegments:true;(this||_global).assetsPath=params.assetsPath;(this||_global).initialSegment=params.initialSegment;if(params.audioFactory){(this||_global).audioController.setAudioFactory(params.audioFactory);}if(params.animationData){this.configAnimation(params.animationData);}else if(params.path){if(params.path.lastIndexOf("\\")!==-1){(this||_global).path=params.path.substr(0,params.path.lastIndexOf("\\")+1);}else{(this||_global).path=params.path.substr(0,params.path.lastIndexOf("/")+1);}(this||_global).fileName=params.path.substr(params.path.lastIndexOf("/")+1);(this||_global).fileName=(this||_global).fileName.substr(0,(this||_global).fileName.lastIndexOf(".json"));assetLoader.load(params.path,(this||_global).configAnimation.bind(this||_global),function(){this.trigger("data_failed");}.bind(this||_global));}};AnimationItem.prototype.setData=function(wrapper,animationData){var params={wrapper:wrapper,animationData:animationData?_typeof2(animationData)==="object"?animationData:JSON.parse(animationData):null};var wrapperAttributes=wrapper.attributes;params.path=wrapperAttributes.getNamedItem("data-animation-path")?wrapperAttributes.getNamedItem("data-animation-path").value:wrapperAttributes.getNamedItem("data-bm-path")?wrapperAttributes.getNamedItem("data-bm-path").value:wrapperAttributes.getNamedItem("bm-path")?wrapperAttributes.getNamedItem("bm-path").value:"";params.animType=wrapperAttributes.getNamedItem("data-anim-type")?wrapperAttributes.getNamedItem("data-anim-type").value:wrapperAttributes.getNamedItem("data-bm-type")?wrapperAttributes.getNamedItem("data-bm-type").value:wrapperAttributes.getNamedItem("bm-type")?wrapperAttributes.getNamedItem("bm-type").value:wrapperAttributes.getNamedItem("data-bm-renderer")?wrapperAttributes.getNamedItem("data-bm-renderer").value:wrapperAttributes.getNamedItem("bm-renderer")?wrapperAttributes.getNamedItem("bm-renderer").value:"canvas";var loop=wrapperAttributes.getNamedItem("data-anim-loop")?wrapperAttributes.getNamedItem("data-anim-loop").value:wrapperAttributes.getNamedItem("data-bm-loop")?wrapperAttributes.getNamedItem("data-bm-loop").value:wrapperAttributes.getNamedItem("bm-loop")?wrapperAttributes.getNamedItem("bm-loop").value:"";if(loop==="");else if(loop==="false"){params.loop=false;}else if(loop==="true"){params.loop=true;}else{params.loop=parseInt(loop);}var autoplay=wrapperAttributes.getNamedItem("data-anim-autoplay")?wrapperAttributes.getNamedItem("data-anim-autoplay").value:wrapperAttributes.getNamedItem("data-bm-autoplay")?wrapperAttributes.getNamedItem("data-bm-autoplay").value:wrapperAttributes.getNamedItem("bm-autoplay")?wrapperAttributes.getNamedItem("bm-autoplay").value:true;params.autoplay=autoplay!=="false";params.name=wrapperAttributes.getNamedItem("data-name")?wrapperAttributes.getNamedItem("data-name").value:wrapperAttributes.getNamedItem("data-bm-name")?wrapperAttributes.getNamedItem("data-bm-name").value:wrapperAttributes.getNamedItem("bm-name")?wrapperAttributes.getNamedItem("bm-name").value:"";var prerender=wrapperAttributes.getNamedItem("data-anim-prerender")?wrapperAttributes.getNamedItem("data-anim-prerender").value:wrapperAttributes.getNamedItem("data-bm-prerender")?wrapperAttributes.getNamedItem("data-bm-prerender").value:wrapperAttributes.getNamedItem("bm-prerender")?wrapperAttributes.getNamedItem("bm-prerender").value:"";if(prerender==="false"){params.prerender=false;}this.setParams(params);};AnimationItem.prototype.includeLayers=function(data){if(data.op>(this||_global).animationData.op){(this||_global).animationData.op=data.op;(this||_global).totalFrames=Math.floor(data.op-(this||_global).animationData.ip);}var layers=(this||_global).animationData.layers;var i,len=layers.length;var newLayers=data.layers;var j,jLen=newLayers.length;for(j=0;j<jLen;j+=1){i=0;while(i<len){if(layers[i].id==newLayers[j].id){layers[i]=newLayers[j];break;}i+=1;}}if(data.chars||data.fonts){(this||_global).renderer.globalData.fontManager.addChars(data.chars);(this||_global).renderer.globalData.fontManager.addFonts(data.fonts,(this||_global).renderer.globalData.defs);}if(data.assets){len=data.assets.length;for(i=0;i<len;i+=1){(this||_global).animationData.assets.push(data.assets[i]);}}(this||_global).animationData.__complete=false;dataManager.completeData((this||_global).animationData,(this||_global).renderer.globalData.fontManager);(this||_global).renderer.includeLayers(data.layers);if(expressionsPlugin){expressionsPlugin.initExpressions(this||_global);}this.loadNextSegment();};AnimationItem.prototype.loadNextSegment=function(){var segments=(this||_global).animationData.segments;if(!segments||segments.length===0||!(this||_global).autoloadSegments){this.trigger("data_ready");(this||_global).timeCompleted=(this||_global).totalFrames;return;}var segment=segments.shift();(this||_global).timeCompleted=segment.time*(this||_global).frameRate;var segmentPath=(this||_global).path+(this||_global).fileName+"_"+(this||_global).segmentPos+".json";(this||_global).segmentPos+=1;assetLoader.load(segmentPath,(this||_global).includeLayers.bind(this||_global),function(){this.trigger("data_failed");}.bind(this||_global));};AnimationItem.prototype.loadSegments=function(){var segments=(this||_global).animationData.segments;if(!segments){(this||_global).timeCompleted=(this||_global).totalFrames;}this.loadNextSegment();};AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images");this.checkLoaded();};AnimationItem.prototype.preloadImages=function(){(this||_global).imagePreloader.setAssetsPath((this||_global).assetsPath);(this||_global).imagePreloader.setPath((this||_global).path);(this||_global).imagePreloader.loadAssets((this||_global).animationData.assets,(this||_global).imagesLoaded.bind(this||_global));};AnimationItem.prototype.configAnimation=function(animData){if(!(this||_global).renderer){return;}try{(this||_global).animationData=animData;if((this||_global).initialSegment){(this||_global).totalFrames=Math.floor((this||_global).initialSegment[1]-(this||_global).initialSegment[0]);(this||_global).firstFrame=Math.round((this||_global).initialSegment[0]);}else{(this||_global).totalFrames=Math.floor((this||_global).animationData.op-(this||_global).animationData.ip);(this||_global).firstFrame=Math.round((this||_global).animationData.ip);}(this||_global).renderer.configAnimation(animData);if(!animData.assets){animData.assets=[];}(this||_global).assets=(this||_global).animationData.assets;(this||_global).frameRate=(this||_global).animationData.fr;(this||_global).frameMult=(this||_global).animationData.fr/1000;(this||_global).renderer.searchExtraCompositions(animData.assets);this.trigger("config_ready");this.preloadImages();this.loadSegments();this.updaFrameModifier();this.waitForFontsLoaded();if((this||_global).isPaused){(this||_global).audioController.pause();}}catch(error){this.triggerConfigError(error);}};AnimationItem.prototype.waitForFontsLoaded=function(){if(!(this||_global).renderer){return;}if((this||_global).renderer.globalData.fontManager.isLoaded){this.checkLoaded();}else{setTimeout((this||_global).waitForFontsLoaded.bind(this||_global),20);}};AnimationItem.prototype.checkLoaded=function(){if(!(this||_global).isLoaded&&(this||_global).renderer.globalData.fontManager.isLoaded&&((this||_global).imagePreloader.loaded()||(this||_global).renderer.rendererType!=="canvas")){(this||_global).isLoaded=true;dataManager.completeData((this||_global).animationData,(this||_global).renderer.globalData.fontManager);if(expressionsPlugin){expressionsPlugin.initExpressions(this||_global);}(this||_global).renderer.initItems();setTimeout(function(){this.trigger("DOMLoaded");}.bind(this||_global),0);this.gotoFrame();if((this||_global).autoplay){this.play();}}};AnimationItem.prototype.resize=function(){(this||_global).renderer.updateContainerSize();};AnimationItem.prototype.setSubframe=function(flag){(this||_global).isSubframeEnabled=!!flag;};AnimationItem.prototype.gotoFrame=function(){(this||_global).currentFrame=(this||_global).isSubframeEnabled?(this||_global).currentRawFrame:~~(this||_global).currentRawFrame;if((this||_global).timeCompleted!==(this||_global).totalFrames&&(this||_global).currentFrame>(this||_global).timeCompleted){(this||_global).currentFrame=(this||_global).timeCompleted;}this.trigger("enterFrame");this.renderFrame();};AnimationItem.prototype.renderFrame=function(){if((this||_global).isLoaded===false){return;}try{(this||_global).renderer.renderFrame((this||_global).currentFrame+(this||_global).firstFrame);}catch(error){this.triggerRenderFrameError(error);}};AnimationItem.prototype.play=function(name){if(name&&(this||_global).name!=name){return;}if((this||_global).isPaused===true){(this||_global).isPaused=false;(this||_global).audioController.resume();if((this||_global)._idle){(this||_global)._idle=false;this.trigger("_active");}}};AnimationItem.prototype.pause=function(name){if(name&&(this||_global).name!=name){return;}if((this||_global).isPaused===false){(this||_global).isPaused=true;(this||_global)._idle=true;this.trigger("_idle");(this||_global).audioController.pause();}};AnimationItem.prototype.togglePause=function(name){if(name&&(this||_global).name!=name){return;}if((this||_global).isPaused===true){this.play();}else{this.pause();}};AnimationItem.prototype.stop=function(name){if(name&&(this||_global).name!=name){return;}this.pause();(this||_global).playCount=0;(this||_global)._completedLoop=false;this.setCurrentRawFrameValue(0);};AnimationItem.prototype.goToAndStop=function(value,isFrame,name){if(name&&(this||_global).name!=name){return;}if(isFrame){this.setCurrentRawFrameValue(value);}else{this.setCurrentRawFrameValue(value*(this||_global).frameModifier);}this.pause();};AnimationItem.prototype.goToAndPlay=function(value,isFrame,name){this.goToAndStop(value,isFrame,name);this.play();};AnimationItem.prototype.advanceTime=function(value){if((this||_global).isPaused===true||(this||_global).isLoaded===false){return;}var nextValue=(this||_global).currentRawFrame+value*(this||_global).frameModifier;var _isComplete=false;// Checking if nextValue > totalFrames - 1 for addressing non looping and looping animations.
// If animation won't loop, it should stop at totalFrames - 1. If it will loop it should complete the last frame and then loop.
if(nextValue>=(this||_global).totalFrames-1&&(this||_global).frameModifier>0){if(!(this||_global).loop||(this||_global).playCount===(this||_global).loop){if(!this.checkSegments(nextValue>(this||_global).totalFrames?nextValue%(this||_global).totalFrames:0)){_isComplete=true;nextValue=(this||_global).totalFrames-1;}}else if(nextValue>=(this||_global).totalFrames){(this||_global).playCount+=1;if(!this.checkSegments(nextValue%(this||_global).totalFrames)){this.setCurrentRawFrameValue(nextValue%(this||_global).totalFrames);(this||_global)._completedLoop=true;this.trigger("loopComplete");}}else{this.setCurrentRawFrameValue(nextValue);}}else if(nextValue<0){if(!this.checkSegments(nextValue%(this||_global).totalFrames)){if((this||_global).loop&&!((this||_global).playCount--<=0&&(this||_global).loop!==true)){this.setCurrentRawFrameValue((this||_global).totalFrames+nextValue%(this||_global).totalFrames);if(!(this||_global)._completedLoop){(this||_global)._completedLoop=true;}else{this.trigger("loopComplete");}}else{_isComplete=true;nextValue=0;}}}else{this.setCurrentRawFrameValue(nextValue);}if(_isComplete){this.setCurrentRawFrameValue(nextValue);this.pause();this.trigger("complete");}};AnimationItem.prototype.adjustSegment=function(arr,offset){(this||_global).playCount=0;if(arr[1]<arr[0]){if((this||_global).frameModifier>0){if((this||_global).playSpeed<0){this.setSpeed(-(this||_global).playSpeed);}else{this.setDirection(-1);}}(this||_global).timeCompleted=(this||_global).totalFrames=arr[0]-arr[1];(this||_global).firstFrame=arr[1];this.setCurrentRawFrameValue((this||_global).totalFrames-0.001-offset);}else if(arr[1]>arr[0]){if((this||_global).frameModifier<0){if((this||_global).playSpeed<0){this.setSpeed(-(this||_global).playSpeed);}else{this.setDirection(1);}}(this||_global).timeCompleted=(this||_global).totalFrames=arr[1]-arr[0];(this||_global).firstFrame=arr[0];this.setCurrentRawFrameValue(0.001+offset);}this.trigger("segmentStart");};AnimationItem.prototype.setSegment=function(init,end){var pendingFrame=-1;if((this||_global).isPaused){if((this||_global).currentRawFrame+(this||_global).firstFrame<init){pendingFrame=init;}else if((this||_global).currentRawFrame+(this||_global).firstFrame>end){pendingFrame=end-init;}}(this||_global).firstFrame=init;(this||_global).timeCompleted=(this||_global).totalFrames=end-init;if(pendingFrame!==-1){this.goToAndStop(pendingFrame,true);}};AnimationItem.prototype.playSegments=function(arr,forceFlag){if(forceFlag){(this||_global).segments.length=0;}if(_typeof2(arr[0])==="object"){var i,len=arr.length;for(i=0;i<len;i+=1){(this||_global).segments.push(arr[i]);}}else{(this||_global).segments.push(arr);}if((this||_global).segments.length&&forceFlag){this.adjustSegment((this||_global).segments.shift(),0);}if((this||_global).isPaused){this.play();}};AnimationItem.prototype.resetSegments=function(forceFlag){(this||_global).segments.length=0;(this||_global).segments.push([(this||_global).animationData.ip,(this||_global).animationData.op]);//this.segments.push([this.animationData.ip*this.frameRate,Math.floor(this.animationData.op - this.animationData.ip+this.animationData.ip*this.frameRate)]);
if(forceFlag){this.checkSegments(0);}};AnimationItem.prototype.checkSegments=function(offset){if((this||_global).segments.length){this.adjustSegment((this||_global).segments.shift(),offset);return true;}return false;};AnimationItem.prototype.destroy=function(name){if(name&&(this||_global).name!=name||!(this||_global).renderer){return;}(this||_global).renderer.destroy();(this||_global).imagePreloader.destroy();this.trigger("destroy");(this||_global)._cbs=null;(this||_global).onEnterFrame=(this||_global).onLoopComplete=(this||_global).onComplete=(this||_global).onSegmentStart=(this||_global).onDestroy=null;(this||_global).renderer=null;};AnimationItem.prototype.setCurrentRawFrameValue=function(value){(this||_global).currentRawFrame=value;this.gotoFrame();};AnimationItem.prototype.setSpeed=function(val){(this||_global).playSpeed=val;this.updaFrameModifier();};AnimationItem.prototype.setDirection=function(val){(this||_global).playDirection=val<0?-1:1;this.updaFrameModifier();};AnimationItem.prototype.setVolume=function(val,name){if(name&&(this||_global).name!==name){return;}(this||_global).audioController.setVolume(val);};AnimationItem.prototype.getVolume=function(){return(this||_global).audioController.getVolume();};AnimationItem.prototype.mute=function(name){if(name&&(this||_global).name!==name){return;}(this||_global).audioController.mute();};AnimationItem.prototype.unmute=function(name){if(name&&(this||_global).name!==name){return;}(this||_global).audioController.unmute();};AnimationItem.prototype.updaFrameModifier=function(){(this||_global).frameModifier=(this||_global).frameMult*(this||_global).playSpeed*(this||_global).playDirection;(this||_global).audioController.setRate((this||_global).playSpeed*(this||_global).playDirection);};AnimationItem.prototype.getPath=function(){return(this||_global).path;};AnimationItem.prototype.getAssetsPath=function(assetData){var path="";if(assetData.e){path=assetData.p;}else if((this||_global).assetsPath){var imagePath=assetData.p;if(imagePath.indexOf("images/")!==-1){imagePath=imagePath.split("/")[1];}path=(this||_global).assetsPath+imagePath;}else{path=(this||_global).path;path+=assetData.u?assetData.u:"";path+=assetData.p;}return path;};AnimationItem.prototype.getAssetData=function(id){var i=0,len=(this||_global).assets.length;while(i<len){if(id==(this||_global).assets[i].id){return(this||_global).assets[i];}i+=1;}};AnimationItem.prototype.hide=function(){(this||_global).renderer.hide();};AnimationItem.prototype.show=function(){(this||_global).renderer.show();};AnimationItem.prototype.getDuration=function(isFrame){return isFrame?(this||_global).totalFrames:(this||_global).totalFrames/(this||_global).frameRate;};AnimationItem.prototype.trigger=function(name){if((this||_global)._cbs&&(this||_global)._cbs[name]){switch(name){case"enterFrame":this.triggerEvent(name,new BMEnterFrameEvent(name,(this||_global).currentFrame,(this||_global).totalFrames,(this||_global).frameModifier));break;case"loopComplete":this.triggerEvent(name,new BMCompleteLoopEvent(name,(this||_global).loop,(this||_global).playCount,(this||_global).frameMult));break;case"complete":this.triggerEvent(name,new BMCompleteEvent(name,(this||_global).frameMult));break;case"segmentStart":this.triggerEvent(name,new BMSegmentStartEvent(name,(this||_global).firstFrame,(this||_global).totalFrames));break;case"destroy":this.triggerEvent(name,new BMDestroyEvent(name,this||_global));break;default:this.triggerEvent(name);}}if(name==="enterFrame"&&(this||_global).onEnterFrame){(this||_global).onEnterFrame.call(this||_global,new BMEnterFrameEvent(name,(this||_global).currentFrame,(this||_global).totalFrames,(this||_global).frameMult));}if(name==="loopComplete"&&(this||_global).onLoopComplete){(this||_global).onLoopComplete.call(this||_global,new BMCompleteLoopEvent(name,(this||_global).loop,(this||_global).playCount,(this||_global).frameMult));}if(name==="complete"&&(this||_global).onComplete){(this||_global).onComplete.call(this||_global,new BMCompleteEvent(name,(this||_global).frameMult));}if(name==="segmentStart"&&(this||_global).onSegmentStart){(this||_global).onSegmentStart.call(this||_global,new BMSegmentStartEvent(name,(this||_global).firstFrame,(this||_global).totalFrames));}if(name==="destroy"&&(this||_global).onDestroy){(this||_global).onDestroy.call(this||_global,new BMDestroyEvent(name,this||_global));}};AnimationItem.prototype.triggerRenderFrameError=function(nativeError){var error=new BMRenderFrameErrorEvent(nativeError,(this||_global).currentFrame);this.triggerEvent("error",error);if((this||_global).onError){(this||_global).onError.call(this||_global,error);}};AnimationItem.prototype.triggerConfigError=function(nativeError){var error=new BMConfigErrorEvent(nativeError,(this||_global).currentFrame);this.triggerEvent("error",error);if((this||_global).onError){(this||_global).onError.call(this||_global,error);}};var Expressions=function(){var ob={};ob.initExpressions=initExpressions;function initExpressions(animation){var stackCount=0;var registers=[];function pushExpression(){stackCount+=1;}function popExpression(){stackCount-=1;if(stackCount===0){releaseInstances();}}function registerExpressionProperty(expression){if(registers.indexOf(expression)===-1){registers.push(expression);}}function releaseInstances(){var i,len=registers.length;for(i=0;i<len;i+=1){registers[i].release();}registers.length=0;}animation.renderer.compInterface=CompExpressionInterface(animation.renderer);animation.renderer.globalData.projectInterface.registerComposition(animation.renderer);animation.renderer.globalData.pushExpression=pushExpression;animation.renderer.globalData.popExpression=popExpression;animation.renderer.globalData.registerExpressionProperty=registerExpressionProperty;}return ob;}();expressionsPlugin=Expressions;var ExpressionManager=function(){var ob={};var Math=BMMath;function $bm_isInstanceOfArray(arr){return arr.constructor===Array||arr.constructor===Float32Array;}function isNumerable(tOfV,v){return tOfV==="number"||tOfV==="boolean"||tOfV==="string"||v instanceof Number;}var easeInBez=BezierFactory.getBezierEasing(0.333,0,0.833,0.833,"easeIn").get;var easeOutBez=BezierFactory.getBezierEasing(0.167,0.167,0.667,1,"easeOut").get;var easeInOutBez=BezierFactory.getBezierEasing(0.33,0,0.667,1,"easeInOut").get;function sum(a,b){var tOfA=_typeof2(a);var tOfB=_typeof2(b);if(tOfA==="string"||tOfB==="string"){return a+b;}if(isNumerable(tOfA,a)&&isNumerable(tOfB,b)){return a+b;}if($bm_isInstanceOfArray(a)&&isNumerable(tOfB,b)){a=a.slice(0);a[0]=a[0]+b;return a;}if(isNumerable(tOfA,a)&&$bm_isInstanceOfArray(b)){b=b.slice(0);b[0]=a+b[0];return b;}if($bm_isInstanceOfArray(a)&&$bm_isInstanceOfArray(b)){var i=0,lenA=a.length,lenB=b.length;var retArr=[];while(i<lenA||i<lenB){if((typeof a[i]==="number"||a[i]instanceof Number)&&(typeof b[i]==="number"||b[i]instanceof Number)){retArr[i]=a[i]+b[i];}else{retArr[i]=b[i]===undefined?a[i]:a[i]||b[i];}i+=1;}return retArr;}return 0;}function sub(a,b){var tOfA=_typeof2(a);var tOfB=_typeof2(b);if(isNumerable(tOfA,a)&&isNumerable(tOfB,b)){if(tOfA==="string"){a=parseInt(a);}if(tOfB==="string"){b=parseInt(b);}return a-b;}if($bm_isInstanceOfArray(a)&&isNumerable(tOfB,b)){a=a.slice(0);a[0]=a[0]-b;return a;}if(isNumerable(tOfA,a)&&$bm_isInstanceOfArray(b)){b=b.slice(0);b[0]=a-b[0];return b;}if($bm_isInstanceOfArray(a)&&$bm_isInstanceOfArray(b)){var i=0,lenA=a.length,lenB=b.length;var retArr=[];while(i<lenA||i<lenB){if((typeof a[i]==="number"||a[i]instanceof Number)&&(typeof b[i]==="number"||b[i]instanceof Number)){retArr[i]=a[i]-b[i];}else{retArr[i]=b[i]===undefined?a[i]:a[i]||b[i];}i+=1;}return retArr;}return 0;}function mul(a,b){var tOfA=_typeof2(a);var tOfB=_typeof2(b);var arr;if(isNumerable(tOfA,a)&&isNumerable(tOfB,b)){return a*b;}var i,len;if($bm_isInstanceOfArray(a)&&isNumerable(tOfB,b)){len=a.length;arr=createTypedArray("float32",len);for(i=0;i<len;i+=1){arr[i]=a[i]*b;}return arr;}if(isNumerable(tOfA,a)&&$bm_isInstanceOfArray(b)){len=b.length;arr=createTypedArray("float32",len);for(i=0;i<len;i+=1){arr[i]=a*b[i];}return arr;}return 0;}function div(a,b){var tOfA=_typeof2(a);var tOfB=_typeof2(b);var arr;if(isNumerable(tOfA,a)&&isNumerable(tOfB,b)){return a/b;}var i,len;if($bm_isInstanceOfArray(a)&&isNumerable(tOfB,b)){len=a.length;arr=createTypedArray("float32",len);for(i=0;i<len;i+=1){arr[i]=a[i]/b;}return arr;}if(isNumerable(tOfA,a)&&$bm_isInstanceOfArray(b)){len=b.length;arr=createTypedArray("float32",len);for(i=0;i<len;i+=1){arr[i]=a/b[i];}return arr;}return 0;}function mod(a,b){if(typeof a==="string"){a=parseInt(a);}if(typeof b==="string"){b=parseInt(b);}return a%b;}var $bm_sum=sum;var $bm_sub=sub;var $bm_mul=mul;var $bm_div=div;var $bm_mod=mod;function radiansToDegrees(val){return val/degToRads;}var helperLengthArray=[0,0,0,0,0,0];function length(arr1,arr2){if(typeof arr1==="number"||arr1 instanceof Number){arr2=arr2||0;return Math.abs(arr1-arr2);}if(!arr2){arr2=helperLengthArray;}var i,len=Math.min(arr1.length,arr2.length);var addedLength=0;for(i=0;i<len;i+=1){addedLength+=Math.pow(arr2[i]-arr1[i],2);}return Math.sqrt(addedLength);}function initiateExpression(elem,data,property){var val=data.x;var needsVelocity=/velocity(?![\w\d])/.test(val);var _needsRandom=val.indexOf("random")!==-1;var elemType=elem.data.ty;var transform,content,effect;var thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime;Object.defineProperty(thisProperty,"value",{get:function get(){return thisProperty.v;}});elem.comp.frameDuration=1/elem.comp.globalData.frameRate;elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate;var outPoint=elem.data.op/elem.comp.globalData.frameRate;var width=elem.data.sw?elem.data.sw:0;var height=elem.data.sh?elem.data.sh:0;var name=elem.data.nm;function __capture__(){for(var _len7=arguments.length,args=new Array(_len7),_key16=0;_key16<_len7;_key16++){args[_key16]=arguments[_key16];}if(args[100])console.log(args);}var loopIn,loopOut,smooth;__capture__($bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,radiansToDegrees,length);var toWorld,fromWorld,fromComp,toComp,anchorPoint,thisLayer,thisComp,mask,valueAtTime,velocityAtTime;var __expression_functions=[];if(data.xf){var i,len=data.xf.length;for(i=0;i<len;i+=1){__expression_functions[i]=eval("(function(){ return "+data.xf[i]+"}())");}}var scoped_bm_rt;var expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}"+"]")[0];var numKeys=property.kf?data.k.length:0;var active=!(this||_global).data||(this||_global).data.hd!==true;var wiggle=function wiggle(freq,amp){var i,j,len=(this||_global).pv.length?(this||_global).pv.length:1;var addedAmps=createTypedArray("float32",len);freq=5;var iterations=Math.floor(time*freq);i=0;j=0;while(i<iterations){//var rnd = BMMath.random();
for(j=0;j<len;j+=1){addedAmps[j]+=-amp+amp*2*BMMath.random();//addedAmps[j] += -amp + amp*2*rnd;
}i+=1;}//var rnd2 = BMMath.random();
var periods=time*freq;var perc=periods-Math.floor(periods);var arr=createTypedArray("float32",len);if(len>1){for(j=0;j<len;j+=1){arr[j]=(this||_global).pv[j]+addedAmps[j]+(-amp+amp*2*BMMath.random())*perc;//arr[j] = this.pv[j] + addedAmps[j] + (-amp + amp*2*rnd)*perc;
//arr[i] = this.pv[i] + addedAmp + amp1*perc + amp2*(1-perc);
}return arr;}else{return(this||_global).pv+addedAmps[0]+(-amp+amp*2*BMMath.random())*perc;}}.bind(this||_global);if(thisProperty.loopIn){loopIn=thisProperty.loopIn.bind(thisProperty);}if(thisProperty.loopOut){loopOut=thisProperty.loopOut.bind(thisProperty);}if(thisProperty.smooth){smooth=thisProperty.smooth.bind(thisProperty);}if((this||_global).getValueAtTime){valueAtTime=(this||_global).getValueAtTime.bind(this||_global);}if((this||_global).getVelocityAtTime){velocityAtTime=(this||_global).getVelocityAtTime.bind(this||_global);}var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function seedRandom(seed){BMMath.seedrandom(randSeed+seed);}var time,velocity,value,text,textIndex,textTotal,selectorValue;var index=elem.data.ind;var hasParent=!!(elem.hierarchy&&elem.hierarchy.length);var parent;var randSeed=Math.floor(Math.random()*1000000);var globalData=elem.globalData;function executeExpression(_value){// globalData.pushExpression();
value=_value;if(_needsRandom){seedRandom(randSeed);}if((this||_global).frameExpressionId===elem.globalData.frameId&&(this||_global).propType!=="textSelector"){return value;}if((this||_global).propType==="textSelector"){textIndex=(this||_global).textIndex;textTotal=(this||_global).textTotal;selectorValue=(this||_global).selectorValue;}if(!thisLayer){text=elem.layerInterface.text;thisLayer=elem.layerInterface;thisComp=elem.comp.compInterface;toWorld=thisLayer.toWorld.bind(thisLayer);fromWorld=thisLayer.fromWorld.bind(thisLayer);fromComp=thisLayer.fromComp.bind(thisLayer);toComp=thisLayer.toComp.bind(thisLayer);mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null;}if(!transform){transform=elem.layerInterface("ADBE Transform Group");if(transform){anchorPoint=transform.anchorPoint;/*position = transform.position;
                  rotation = transform.rotation;
                  scale = transform.scale;*/}}if(elemType===4&&!content){content=thisLayer("ADBE Root Vectors Group");}if(!effect){effect=thisLayer(4);}hasParent=!!(elem.hierarchy&&elem.hierarchy.length);if(hasParent&&!parent){parent=elem.hierarchy[0].layerInterface;}time=(this||_global).comp.renderedFrame/(this||_global).comp.globalData.frameRate;if(needsVelocity){velocity=velocityAtTime(time);}expression_function();(this||_global).frameExpressionId=elem.globalData.frameId;//TODO: Check if it's possible to return on ShapeInterface the .v value
if(scoped_bm_rt.propType==="shape");// globalData.popExpression();
return scoped_bm_rt;}return executeExpression;}ob.initiateExpression=initiateExpression;return ob;}();var expressionHelpers=function(){function searchExpressions(elem,data,prop){if(data.x){prop.k=true;prop.x=true;prop.initiateExpression=ExpressionManager.initiateExpression;prop.effectsSequence.push(prop.initiateExpression(elem,data,prop).bind(prop));}}function getValueAtTime(frameNum){frameNum*=(this||_global).elem.globalData.frameRate;frameNum-=(this||_global).offsetTime;if(frameNum!==(this||_global)._cachingAtTime.lastFrame){(this||_global)._cachingAtTime.lastIndex=(this||_global)._cachingAtTime.lastFrame<frameNum?(this||_global)._cachingAtTime.lastIndex:0;(this||_global)._cachingAtTime.value=this.interpolateValue(frameNum,(this||_global)._cachingAtTime);(this||_global)._cachingAtTime.lastFrame=frameNum;}return(this||_global)._cachingAtTime.value;}function getSpeedAtTime(frameNum){var delta=-0.01;var v1=this.getValueAtTime(frameNum);var v2=this.getValueAtTime(frameNum+delta);var speed=0;if(v1.length){var i;for(i=0;i<v1.length;i+=1){speed+=Math.pow(v2[i]-v1[i],2);}speed=Math.sqrt(speed)*100;}else{speed=0;}return speed;}function getVelocityAtTime(frameNum){if((this||_global).vel!==undefined){return(this||_global).vel;}var delta=-0.001;//frameNum += this.elem.data.st;
var v1=this.getValueAtTime(frameNum);var v2=this.getValueAtTime(frameNum+delta);var velocity;if(v1.length){velocity=createTypedArray("float32",v1.length);var i;for(i=0;i<v1.length;i+=1){//removing frameRate
//if needed, don't add it here
//velocity[i] = this.elem.globalData.frameRate*((v2[i] - v1[i])/delta);
velocity[i]=(v2[i]-v1[i])/delta;}}else{velocity=(v2-v1)/delta;}return velocity;}function getStaticValueAtTime(){return(this||_global).pv;}function setGroupProperty(propertyGroup){(this||_global).propertyGroup=propertyGroup;}return{searchExpressions:searchExpressions,getSpeedAtTime:getSpeedAtTime,getVelocityAtTime:getVelocityAtTime,getValueAtTime:getValueAtTime,getStaticValueAtTime:getStaticValueAtTime,setGroupProperty:setGroupProperty};}();(function addPropertyDecorator(){function loopOut(type,duration,durationFlag){if(!(this||_global).k||!(this||_global).keyframes){return(this||_global).pv;}type=type?type.toLowerCase():"";var currentFrame=(this||_global).comp.renderedFrame;var keyframes=(this||_global).keyframes;var lastKeyFrame=keyframes[keyframes.length-1].t;if(currentFrame<=lastKeyFrame){return(this||_global).pv;}else{var cycleDuration,firstKeyFrame;if(!durationFlag){if(!duration||duration>keyframes.length-1){duration=keyframes.length-1;}firstKeyFrame=keyframes[keyframes.length-1-duration].t;cycleDuration=lastKeyFrame-firstKeyFrame;}else{if(!duration){cycleDuration=Math.max(0,lastKeyFrame-(this||_global).elem.data.ip);}else{cycleDuration=Math.abs(lastKeyFrame-elem.comp.globalData.frameRate*duration);}firstKeyFrame=lastKeyFrame-cycleDuration;}var i,len,ret;if(type==="pingpong"){var iterations=Math.floor((currentFrame-firstKeyFrame)/cycleDuration);if(iterations%2!==0){return this.getValueAtTime((cycleDuration-(currentFrame-firstKeyFrame)%cycleDuration+firstKeyFrame)/(this||_global).comp.globalData.frameRate,0);}}else if(type==="offset"){var initV=this.getValueAtTime(firstKeyFrame/(this||_global).comp.globalData.frameRate,0);var endV=this.getValueAtTime(lastKeyFrame/(this||_global).comp.globalData.frameRate,0);var current=this.getValueAtTime(((currentFrame-firstKeyFrame)%cycleDuration+firstKeyFrame)/(this||_global).comp.globalData.frameRate,0);var repeats=Math.floor((currentFrame-firstKeyFrame)/cycleDuration);if((this||_global).pv.length){ret=new Array(initV.length);len=ret.length;for(i=0;i<len;i+=1){ret[i]=(endV[i]-initV[i])*repeats+current[i];}return ret;}return(endV-initV)*repeats+current;}else if(type==="continue"){var lastValue=this.getValueAtTime(lastKeyFrame/(this||_global).comp.globalData.frameRate,0);var nextLastValue=this.getValueAtTime((lastKeyFrame-0.001)/(this||_global).comp.globalData.frameRate,0);if((this||_global).pv.length){ret=new Array(lastValue.length);len=ret.length;for(i=0;i<len;i+=1){ret[i]=lastValue[i]+(lastValue[i]-nextLastValue[i])*((currentFrame-lastKeyFrame)/(this||_global).comp.globalData.frameRate)/0.0005;}return ret;}return lastValue+(lastValue-nextLastValue)*((currentFrame-lastKeyFrame)/0.001);}return this.getValueAtTime(((currentFrame-firstKeyFrame)%cycleDuration+firstKeyFrame)/(this||_global).comp.globalData.frameRate,0);}}function loopIn(type,duration,durationFlag){if(!(this||_global).k){return(this||_global).pv;}type=type?type.toLowerCase():"";var currentFrame=(this||_global).comp.renderedFrame;var keyframes=(this||_global).keyframes;var firstKeyFrame=keyframes[0].t;if(currentFrame>=firstKeyFrame){return(this||_global).pv;}else{var cycleDuration,lastKeyFrame;if(!durationFlag){if(!duration||duration>keyframes.length-1){duration=keyframes.length-1;}lastKeyFrame=keyframes[duration].t;cycleDuration=lastKeyFrame-firstKeyFrame;}else{if(!duration){cycleDuration=Math.max(0,(this||_global).elem.data.op-firstKeyFrame);}else{cycleDuration=Math.abs(elem.comp.globalData.frameRate*duration);}lastKeyFrame=firstKeyFrame+cycleDuration;}var i,len,ret;if(type==="pingpong"){var iterations=Math.floor((firstKeyFrame-currentFrame)/cycleDuration);if(iterations%2===0){return this.getValueAtTime(((firstKeyFrame-currentFrame)%cycleDuration+firstKeyFrame)/(this||_global).comp.globalData.frameRate,0);}}else if(type==="offset"){var initV=this.getValueAtTime(firstKeyFrame/(this||_global).comp.globalData.frameRate,0);var endV=this.getValueAtTime(lastKeyFrame/(this||_global).comp.globalData.frameRate,0);var current=this.getValueAtTime((cycleDuration-(firstKeyFrame-currentFrame)%cycleDuration+firstKeyFrame)/(this||_global).comp.globalData.frameRate,0);var repeats=Math.floor((firstKeyFrame-currentFrame)/cycleDuration)+1;if((this||_global).pv.length){ret=new Array(initV.length);len=ret.length;for(i=0;i<len;i+=1){ret[i]=current[i]-(endV[i]-initV[i])*repeats;}return ret;}return current-(endV-initV)*repeats;}else if(type==="continue"){var firstValue=this.getValueAtTime(firstKeyFrame/(this||_global).comp.globalData.frameRate,0);var nextFirstValue=this.getValueAtTime((firstKeyFrame+0.001)/(this||_global).comp.globalData.frameRate,0);if((this||_global).pv.length){ret=new Array(firstValue.length);len=ret.length;for(i=0;i<len;i+=1){ret[i]=firstValue[i]+(firstValue[i]-nextFirstValue[i])*(firstKeyFrame-currentFrame)/0.001;}return ret;}return firstValue+(firstValue-nextFirstValue)*(firstKeyFrame-currentFrame)/0.001;}return this.getValueAtTime((cycleDuration-(firstKeyFrame-currentFrame)%cycleDuration+firstKeyFrame)/(this||_global).comp.globalData.frameRate,0);}}function smooth(width,samples){if(!(this||_global).k){return(this||_global).pv;}width=(width||0.4)*0.5;samples=Math.floor(samples||5);if(samples<=1){return(this||_global).pv;}var currentTime=(this||_global).comp.renderedFrame/(this||_global).comp.globalData.frameRate;var initFrame=currentTime-width;var endFrame=currentTime+width;var sampleFrequency=samples>1?(endFrame-initFrame)/(samples-1):1;var i=0,j=0;var value;if((this||_global).pv.length){value=createTypedArray("float32",(this||_global).pv.length);}else{value=0;}var sampleValue;while(i<samples){sampleValue=this.getValueAtTime(initFrame+i*sampleFrequency);if((this||_global).pv.length){for(j=0;j<(this||_global).pv.length;j+=1){value[j]+=sampleValue[j];}}else{value+=sampleValue;}i+=1;}if((this||_global).pv.length){for(j=0;j<(this||_global).pv.length;j+=1){value[j]/=samples;}}else{value/=samples;}return value;}function getTransformValueAtTime(time){if(!(this||_global)._transformCachingAtTime){(this||_global)._transformCachingAtTime={v:new Matrix()};}////
var matrix=(this||_global)._transformCachingAtTime.v;matrix.cloneFromProps((this||_global).pre.props);if((this||_global).appliedTransformations<1){var anchor=(this||_global).a.getValueAtTime(time);matrix.translate(-anchor[0]*(this||_global).a.mult,-anchor[1]*(this||_global).a.mult,anchor[2]*(this||_global).a.mult);}if((this||_global).appliedTransformations<2){var scale=(this||_global).s.getValueAtTime(time);matrix.scale(scale[0]*(this||_global).s.mult,scale[1]*(this||_global).s.mult,scale[2]*(this||_global).s.mult);}if((this||_global).sk&&(this||_global).appliedTransformations<3){var skew=(this||_global).sk.getValueAtTime(time);var skewAxis=(this||_global).sa.getValueAtTime(time);matrix.skewFromAxis(-skew*(this||_global).sk.mult,skewAxis*(this||_global).sa.mult);}if((this||_global).r&&(this||_global).appliedTransformations<4){var rotation=(this||_global).r.getValueAtTime(time);matrix.rotate(-rotation*(this||_global).r.mult);}else if(!(this||_global).r&&(this||_global).appliedTransformations<4){var rotationZ=(this||_global).rz.getValueAtTime(time);var rotationY=(this||_global).ry.getValueAtTime(time);var rotationX=(this||_global).rx.getValueAtTime(time);var orientation=(this||_global).or.getValueAtTime(time);matrix.rotateZ(-rotationZ*(this||_global).rz.mult).rotateY(rotationY*(this||_global).ry.mult).rotateX(rotationX*(this||_global).rx.mult).rotateZ(-orientation[2]*(this||_global).or.mult).rotateY(orientation[1]*(this||_global).or.mult).rotateX(orientation[0]*(this||_global).or.mult);}if((this||_global).data.p&&(this||_global).data.p.s){var positionX=(this||_global).px.getValueAtTime(time);var positionY=(this||_global).py.getValueAtTime(time);if((this||_global).data.p.z){var positionZ=(this||_global).pz.getValueAtTime(time);matrix.translate(positionX*(this||_global).px.mult,positionY*(this||_global).py.mult,-positionZ*(this||_global).pz.mult);}else{matrix.translate(positionX*(this||_global).px.mult,positionY*(this||_global).py.mult,0);}}else{var position=(this||_global).p.getValueAtTime(time);matrix.translate(position[0]*(this||_global).p.mult,position[1]*(this||_global).p.mult,-position[2]*(this||_global).p.mult);}return matrix;////
}function getTransformStaticValueAtTime(time){return(this||_global).v.clone(new Matrix());}var getTransformProperty=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(elem,data,container){var prop=getTransformProperty(elem,data,container);if(prop.dynamicProperties.length){prop.getValueAtTime=getTransformValueAtTime.bind(prop);}else{prop.getValueAtTime=getTransformStaticValueAtTime.bind(prop);}prop.setGroupProperty=expressionHelpers.setGroupProperty;return prop;};var propertyGetProp=PropertyFactory.getProp;PropertyFactory.getProp=function(elem,data,type,mult,container){var prop=propertyGetProp(elem,data,type,mult,container);//prop.getVelocityAtTime = getVelocityAtTime;
//prop.loopOut = loopOut;
//prop.loopIn = loopIn;
if(prop.kf){prop.getValueAtTime=expressionHelpers.getValueAtTime.bind(prop);}else{prop.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(prop);}prop.setGroupProperty=expressionHelpers.setGroupProperty;prop.loopOut=loopOut;prop.loopIn=loopIn;prop.smooth=smooth;prop.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(prop);prop.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(prop);prop.numKeys=data.a===1?data.k.length:0;prop.propertyIndex=data.ix;var value=0;if(type!==0){value=createTypedArray("float32",data.a===1?data.k[0].s.length:data.k.length);}prop._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:value};expressionHelpers.searchExpressions(elem,data,prop);if(prop.k){container.addDynamicProperty(prop);}return prop;};function getShapeValueAtTime(frameNum){//For now this caching object is created only when needed instead of creating it when the shape is initialized.
if(!(this||_global)._cachingAtTime){(this||_global)._cachingAtTime={shapeValue:shape_pool.clone((this||_global).pv),lastIndex:0,lastTime:initialDefaultFrame};}frameNum*=(this||_global).elem.globalData.frameRate;frameNum-=(this||_global).offsetTime;if(frameNum!==(this||_global)._cachingAtTime.lastTime){(this||_global)._cachingAtTime.lastIndex=(this||_global)._cachingAtTime.lastTime<frameNum?(this||_global)._caching.lastIndex:0;(this||_global)._cachingAtTime.lastTime=frameNum;this.interpolateShape(frameNum,(this||_global)._cachingAtTime.shapeValue,(this||_global)._cachingAtTime);}return(this||_global)._cachingAtTime.shapeValue;}var ShapePropertyConstructorFunction=ShapePropertyFactory.getConstructorFunction();var KeyframedShapePropertyConstructorFunction=ShapePropertyFactory.getKeyframedConstructorFunction();function ShapeExpressions(){}ShapeExpressions.prototype={vertices:function vertices(prop,time){if((this||_global).k){this.getValue();}var shapePath=(this||_global).v;if(time!==undefined){shapePath=this.getValueAtTime(time,0);}var i,len=shapePath._length;var vertices=shapePath[prop];var points=shapePath.v;var arr=createSizedArray(len);for(i=0;i<len;i+=1){if(prop==="i"||prop==="o"){arr[i]=[vertices[i][0]-points[i][0],vertices[i][1]-points[i][1]];}else{arr[i]=[vertices[i][0],vertices[i][1]];}}return arr;},points:function points(time){return this.vertices("v",time);},inTangents:function inTangents(time){return this.vertices("i",time);},outTangents:function outTangents(time){return this.vertices("o",time);},isClosed:function isClosed(){return(this||_global).v.c;},pointOnPath:function pointOnPath(perc,time){var shapePath=(this||_global).v;if(time!==undefined){shapePath=this.getValueAtTime(time,0);}if(!(this||_global)._segmentsLength){(this||_global)._segmentsLength=bez.getSegmentsLength(shapePath);}var segmentsLength=(this||_global)._segmentsLength;var lengths=segmentsLength.lengths;var lengthPos=segmentsLength.totalLength*perc;var i=0,len=lengths.length;var accumulatedLength=0,pt;while(i<len){if(accumulatedLength+lengths[i].addedLength>lengthPos){var initIndex=i;var endIndex=shapePath.c&&i===len-1?0:i+1;var segmentPerc=(lengthPos-accumulatedLength)/lengths[i].addedLength;pt=bez.getPointInSegment(shapePath.v[initIndex],shapePath.v[endIndex],shapePath.o[initIndex],shapePath.i[endIndex],segmentPerc,lengths[i]);break;}else{accumulatedLength+=lengths[i].addedLength;}i+=1;}if(!pt){pt=shapePath.c?[shapePath.v[0][0],shapePath.v[0][1]]:[shapePath.v[shapePath._length-1][0],shapePath.v[shapePath._length-1][1]];}return pt;},vectorOnPath:function vectorOnPath(perc,time,vectorType){//perc doesn't use triple equality because it can be a Number object as well as a primitive.
perc=perc==1?(this||_global).v.c?0:0.999:perc;var pt1=this.pointOnPath(perc,time);var pt2=this.pointOnPath(perc+0.001,time);var xLength=pt2[0]-pt1[0];var yLength=pt2[1]-pt1[1];var magnitude=Math.sqrt(Math.pow(xLength,2)+Math.pow(yLength,2));if(magnitude===0){return[0,0];}var unitVector=vectorType==="tangent"?[xLength/magnitude,yLength/magnitude]:[-yLength/magnitude,xLength/magnitude];return unitVector;},tangentOnPath:function tangentOnPath(perc,time){return this.vectorOnPath(perc,time,"tangent");},normalOnPath:function normalOnPath(perc,time){return this.vectorOnPath(perc,time,"normal");},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime};extendPrototype([ShapeExpressions],ShapePropertyConstructorFunction);extendPrototype([ShapeExpressions],KeyframedShapePropertyConstructorFunction);KeyframedShapePropertyConstructorFunction.prototype.getValueAtTime=getShapeValueAtTime;KeyframedShapePropertyConstructorFunction.prototype.initiateExpression=ExpressionManager.initiateExpression;var propertyGetShapeProp=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(elem,data,type,arr,trims){var prop=propertyGetShapeProp(elem,data,type,arr,trims);prop.propertyIndex=data.ix;prop.lock=false;if(type===3){expressionHelpers.searchExpressions(elem,data.pt,prop);}else if(type===4){expressionHelpers.searchExpressions(elem,data.ks,prop);}if(prop.k){elem.addDynamicProperty(prop);}return prop;};})();(function addDecorator(){function searchExpressions(){if((this||_global).data.d.x){(this||_global).calculateExpression=ExpressionManager.initiateExpression.bind(this||_global)((this||_global).elem,(this||_global).data.d,this||_global);this.addEffect((this||_global).getExpressionValue.bind(this||_global));return true;}}TextProperty.prototype.getExpressionValue=function(currentValue,text){var newValue=this.calculateExpression(text);if(currentValue.t!==newValue){var newData={};this.copyData(newData,currentValue);newData.t=newValue.toString();newData.__complete=false;return newData;}return currentValue;};TextProperty.prototype.searchProperty=function(){var isKeyframed=this.searchKeyframes();var hasExpressions=this.searchExpressions();(this||_global).kf=isKeyframed||hasExpressions;return(this||_global).kf;};TextProperty.prototype.searchExpressions=searchExpressions;})();var ShapePathInterface=function(){return function pathInterfaceFactory(shape,view,propertyGroup){var prop=view.sh;function interfaceFunction(val){if(val==="Shape"||val==="shape"||val==="Path"||val==="path"||val==="ADBE Vector Shape"||val===2){return interfaceFunction.path;}}var _propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);prop.setGroupProperty(PropertyInterface("Path",_propertyGroup));Object.defineProperties(interfaceFunction,{"path":{get:function get(){if(prop.k){prop.getValue();}return prop;}},"shape":{get:function get(){if(prop.k){prop.getValue();}return prop;}},"_name":{value:shape.nm},"ix":{value:shape.ix},"propertyIndex":{value:shape.ix},"mn":{value:shape.mn},"propertyGroup":{value:propertyGroup}});return interfaceFunction;};}();var propertyGroupFactory=function(){return function(interfaceFunction,parentPropertyGroup){return function(val){val=val===undefined?1:val;if(val<=0){return interfaceFunction;}else{return parentPropertyGroup(val-1);}};};}();var PropertyInterface=function(){return function(propertyName,propertyGroup){var interfaceFunction={_name:propertyName};function _propertyGroup(val){val=val===undefined?1:val;if(val<=0){return interfaceFunction;}else{return propertyGroup(--val);}}return _propertyGroup;};}();var ShapeExpressionInterface=function(){function iterateElements(shapes,view,propertyGroup){var arr=[];var i,len=shapes?shapes.length:0;for(i=0;i<len;i+=1){if(shapes[i].ty=="gr"){arr.push(groupInterfaceFactory(shapes[i],view[i],propertyGroup));}else if(shapes[i].ty=="fl"){arr.push(fillInterfaceFactory(shapes[i],view[i],propertyGroup));}else if(shapes[i].ty=="st"){arr.push(strokeInterfaceFactory(shapes[i],view[i],propertyGroup));}else if(shapes[i].ty=="tm"){arr.push(trimInterfaceFactory(shapes[i],view[i],propertyGroup));}else if(shapes[i].ty=="tr");else if(shapes[i].ty=="el"){arr.push(ellipseInterfaceFactory(shapes[i],view[i],propertyGroup));}else if(shapes[i].ty=="sr"){arr.push(starInterfaceFactory(shapes[i],view[i],propertyGroup));}else if(shapes[i].ty=="sh"){arr.push(ShapePathInterface(shapes[i],view[i],propertyGroup));}else if(shapes[i].ty=="rc"){arr.push(rectInterfaceFactory(shapes[i],view[i],propertyGroup));}else if(shapes[i].ty=="rd"){arr.push(roundedInterfaceFactory(shapes[i],view[i],propertyGroup));}else if(shapes[i].ty=="rp"){arr.push(repeaterInterfaceFactory(shapes[i],view[i],propertyGroup));}}return arr;}function contentsInterfaceFactory(shape,view,propertyGroup){var interfaces;var interfaceFunction=function _interfaceFunction(value){var i=0,len=interfaces.length;while(i<len){if(interfaces[i]._name===value||interfaces[i].mn===value||interfaces[i].propertyIndex===value||interfaces[i].ix===value||interfaces[i].ind===value){return interfaces[i];}i+=1;}if(typeof value==="number"){return interfaces[value-1];}};interfaceFunction.propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);interfaces=iterateElements(shape.it,view.it,interfaceFunction.propertyGroup);interfaceFunction.numProperties=interfaces.length;var transformInterface=transformInterfaceFactory(shape.it[shape.it.length-1],view.it[view.it.length-1],interfaceFunction.propertyGroup);interfaceFunction.transform=transformInterface;interfaceFunction.propertyIndex=shape.cix;interfaceFunction._name=shape.nm;return interfaceFunction;}function groupInterfaceFactory(shape,view,propertyGroup){var interfaceFunction=function _interfaceFunction(value){switch(value){case"ADBE Vectors Group":case"Contents":case 2:return interfaceFunction.content;//Not necessary for now. Keeping them here in case a new case appears
//case 'ADBE Vector Transform Group':
//case 3:
default:return interfaceFunction.transform;}};interfaceFunction.propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);var content=contentsInterfaceFactory(shape,view,interfaceFunction.propertyGroup);var transformInterface=transformInterfaceFactory(shape.it[shape.it.length-1],view.it[view.it.length-1],interfaceFunction.propertyGroup);interfaceFunction.content=content;interfaceFunction.transform=transformInterface;Object.defineProperty(interfaceFunction,"_name",{get:function get(){return shape.nm;}});//interfaceFunction.content = interfaceFunction;
interfaceFunction.numProperties=shape.np;interfaceFunction.propertyIndex=shape.ix;interfaceFunction.nm=shape.nm;interfaceFunction.mn=shape.mn;return interfaceFunction;}function fillInterfaceFactory(shape,view,propertyGroup){function interfaceFunction(val){if(val==="Color"||val==="color"){return interfaceFunction.color;}else if(val==="Opacity"||val==="opacity"){return interfaceFunction.opacity;}}Object.defineProperties(interfaceFunction,{"color":{get:ExpressionPropertyInterface(view.c)},"opacity":{get:ExpressionPropertyInterface(view.o)},"_name":{value:shape.nm},"mn":{value:shape.mn}});view.c.setGroupProperty(PropertyInterface("Color",propertyGroup));view.o.setGroupProperty(PropertyInterface("Opacity",propertyGroup));return interfaceFunction;}function strokeInterfaceFactory(shape,view,propertyGroup){var _propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);var _dashPropertyGroup=propertyGroupFactory(dashOb,_propertyGroup);function addPropertyToDashOb(i){Object.defineProperty(dashOb,shape.d[i].nm,{get:ExpressionPropertyInterface(view.d.dataProps[i].p)});}var i,len=shape.d?shape.d.length:0;var dashOb={};for(i=0;i<len;i+=1){addPropertyToDashOb(i);view.d.dataProps[i].p.setGroupProperty(_dashPropertyGroup);}function interfaceFunction(val){if(val==="Color"||val==="color"){return interfaceFunction.color;}else if(val==="Opacity"||val==="opacity"){return interfaceFunction.opacity;}else if(val==="Stroke Width"||val==="stroke width"){return interfaceFunction.strokeWidth;}}Object.defineProperties(interfaceFunction,{"color":{get:ExpressionPropertyInterface(view.c)},"opacity":{get:ExpressionPropertyInterface(view.o)},"strokeWidth":{get:ExpressionPropertyInterface(view.w)},"dash":{get:function get(){return dashOb;}},"_name":{value:shape.nm},"mn":{value:shape.mn}});view.c.setGroupProperty(PropertyInterface("Color",_propertyGroup));view.o.setGroupProperty(PropertyInterface("Opacity",_propertyGroup));view.w.setGroupProperty(PropertyInterface("Stroke Width",_propertyGroup));return interfaceFunction;}function trimInterfaceFactory(shape,view,propertyGroup){function interfaceFunction(val){if(val===shape.e.ix||val==="End"||val==="end"){return interfaceFunction.end;}if(val===shape.s.ix){return interfaceFunction.start;}if(val===shape.o.ix){return interfaceFunction.offset;}}var _propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);interfaceFunction.propertyIndex=shape.ix;view.s.setGroupProperty(PropertyInterface("Start",_propertyGroup));view.e.setGroupProperty(PropertyInterface("End",_propertyGroup));view.o.setGroupProperty(PropertyInterface("Offset",_propertyGroup));interfaceFunction.propertyIndex=shape.ix;interfaceFunction.propertyGroup=propertyGroup;Object.defineProperties(interfaceFunction,{"start":{get:ExpressionPropertyInterface(view.s)},"end":{get:ExpressionPropertyInterface(view.e)},"offset":{get:ExpressionPropertyInterface(view.o)},"_name":{value:shape.nm}});interfaceFunction.mn=shape.mn;return interfaceFunction;}function transformInterfaceFactory(shape,view,propertyGroup){function interfaceFunction(value){if(shape.a.ix===value||value==="Anchor Point"){return interfaceFunction.anchorPoint;}if(shape.o.ix===value||value==="Opacity"){return interfaceFunction.opacity;}if(shape.p.ix===value||value==="Position"){return interfaceFunction.position;}if(shape.r.ix===value||value==="Rotation"||value==="ADBE Vector Rotation"){return interfaceFunction.rotation;}if(shape.s.ix===value||value==="Scale"){return interfaceFunction.scale;}if(shape.sk&&shape.sk.ix===value||value==="Skew"){return interfaceFunction.skew;}if(shape.sa&&shape.sa.ix===value||value==="Skew Axis"){return interfaceFunction.skewAxis;}}var _propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);view.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",_propertyGroup));view.transform.mProps.p.setGroupProperty(PropertyInterface("Position",_propertyGroup));view.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",_propertyGroup));view.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",_propertyGroup));view.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",_propertyGroup));if(view.transform.mProps.sk){view.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",_propertyGroup));view.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",_propertyGroup));}view.transform.op.setGroupProperty(PropertyInterface("Opacity",_propertyGroup));Object.defineProperties(interfaceFunction,{"opacity":{get:ExpressionPropertyInterface(view.transform.mProps.o)},"position":{get:ExpressionPropertyInterface(view.transform.mProps.p)},"anchorPoint":{get:ExpressionPropertyInterface(view.transform.mProps.a)},"scale":{get:ExpressionPropertyInterface(view.transform.mProps.s)},"rotation":{get:ExpressionPropertyInterface(view.transform.mProps.r)},"skew":{get:ExpressionPropertyInterface(view.transform.mProps.sk)},"skewAxis":{get:ExpressionPropertyInterface(view.transform.mProps.sa)},"_name":{value:shape.nm}});interfaceFunction.ty="tr";interfaceFunction.mn=shape.mn;interfaceFunction.propertyGroup=propertyGroup;return interfaceFunction;}function ellipseInterfaceFactory(shape,view,propertyGroup){function interfaceFunction(value){if(shape.p.ix===value){return interfaceFunction.position;}if(shape.s.ix===value){return interfaceFunction.size;}}var _propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);interfaceFunction.propertyIndex=shape.ix;var prop=view.sh.ty==="tm"?view.sh.prop:view.sh;prop.s.setGroupProperty(PropertyInterface("Size",_propertyGroup));prop.p.setGroupProperty(PropertyInterface("Position",_propertyGroup));Object.defineProperties(interfaceFunction,{"size":{get:ExpressionPropertyInterface(prop.s)},"position":{get:ExpressionPropertyInterface(prop.p)},"_name":{value:shape.nm}});interfaceFunction.mn=shape.mn;return interfaceFunction;}function starInterfaceFactory(shape,view,propertyGroup){function interfaceFunction(value){if(shape.p.ix===value){return interfaceFunction.position;}if(shape.r.ix===value){return interfaceFunction.rotation;}if(shape.pt.ix===value){return interfaceFunction.points;}if(shape.or.ix===value||"ADBE Vector Star Outer Radius"===value){return interfaceFunction.outerRadius;}if(shape.os.ix===value){return interfaceFunction.outerRoundness;}if(shape.ir&&(shape.ir.ix===value||"ADBE Vector Star Inner Radius"===value)){return interfaceFunction.innerRadius;}if(shape.is&&shape.is.ix===value){return interfaceFunction.innerRoundness;}}var _propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);var prop=view.sh.ty==="tm"?view.sh.prop:view.sh;interfaceFunction.propertyIndex=shape.ix;prop.or.setGroupProperty(PropertyInterface("Outer Radius",_propertyGroup));prop.os.setGroupProperty(PropertyInterface("Outer Roundness",_propertyGroup));prop.pt.setGroupProperty(PropertyInterface("Points",_propertyGroup));prop.p.setGroupProperty(PropertyInterface("Position",_propertyGroup));prop.r.setGroupProperty(PropertyInterface("Rotation",_propertyGroup));if(shape.ir){prop.ir.setGroupProperty(PropertyInterface("Inner Radius",_propertyGroup));prop.is.setGroupProperty(PropertyInterface("Inner Roundness",_propertyGroup));}Object.defineProperties(interfaceFunction,{"position":{get:ExpressionPropertyInterface(prop.p)},"rotation":{get:ExpressionPropertyInterface(prop.r)},"points":{get:ExpressionPropertyInterface(prop.pt)},"outerRadius":{get:ExpressionPropertyInterface(prop.or)},"outerRoundness":{get:ExpressionPropertyInterface(prop.os)},"innerRadius":{get:ExpressionPropertyInterface(prop.ir)},"innerRoundness":{get:ExpressionPropertyInterface(prop.is)},"_name":{value:shape.nm}});interfaceFunction.mn=shape.mn;return interfaceFunction;}function rectInterfaceFactory(shape,view,propertyGroup){function interfaceFunction(value){if(shape.p.ix===value){return interfaceFunction.position;}if(shape.r.ix===value){return interfaceFunction.roundness;}if(shape.s.ix===value||value==="Size"||value==="ADBE Vector Rect Size"){return interfaceFunction.size;}}var _propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);var prop=view.sh.ty==="tm"?view.sh.prop:view.sh;interfaceFunction.propertyIndex=shape.ix;prop.p.setGroupProperty(PropertyInterface("Position",_propertyGroup));prop.s.setGroupProperty(PropertyInterface("Size",_propertyGroup));prop.r.setGroupProperty(PropertyInterface("Rotation",_propertyGroup));Object.defineProperties(interfaceFunction,{"position":{get:ExpressionPropertyInterface(prop.p)},"roundness":{get:ExpressionPropertyInterface(prop.r)},"size":{get:ExpressionPropertyInterface(prop.s)},"_name":{value:shape.nm}});interfaceFunction.mn=shape.mn;return interfaceFunction;}function roundedInterfaceFactory(shape,view,propertyGroup){function interfaceFunction(value){if(shape.r.ix===value||"Round Corners 1"===value){return interfaceFunction.radius;}}var _propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);var prop=view;interfaceFunction.propertyIndex=shape.ix;prop.rd.setGroupProperty(PropertyInterface("Radius",_propertyGroup));Object.defineProperties(interfaceFunction,{"radius":{get:ExpressionPropertyInterface(prop.rd)},"_name":{value:shape.nm}});interfaceFunction.mn=shape.mn;return interfaceFunction;}function repeaterInterfaceFactory(shape,view,propertyGroup){function interfaceFunction(value){if(shape.c.ix===value||"Copies"===value){return interfaceFunction.copies;}else if(shape.o.ix===value||"Offset"===value){return interfaceFunction.offset;}}var _propertyGroup=propertyGroupFactory(interfaceFunction,propertyGroup);var prop=view;interfaceFunction.propertyIndex=shape.ix;prop.c.setGroupProperty(PropertyInterface("Copies",_propertyGroup));prop.o.setGroupProperty(PropertyInterface("Offset",_propertyGroup));Object.defineProperties(interfaceFunction,{"copies":{get:ExpressionPropertyInterface(prop.c)},"offset":{get:ExpressionPropertyInterface(prop.o)},"_name":{value:shape.nm}});interfaceFunction.mn=shape.mn;return interfaceFunction;}return function(shapes,view,propertyGroup){var interfaces;function _interfaceFunction(value){if(typeof value==="number"){value=value===undefined?1:value;if(value===0){return propertyGroup;}else{return interfaces[value-1];}}else{var i=0,len=interfaces.length;while(i<len){if(interfaces[i]._name===value){return interfaces[i];}i+=1;}}}function parentGroupWrapper(){return propertyGroup;}_interfaceFunction.propertyGroup=propertyGroupFactory(_interfaceFunction,parentGroupWrapper);interfaces=iterateElements(shapes,view,_interfaceFunction.propertyGroup);_interfaceFunction.numProperties=interfaces.length;_interfaceFunction._name="Contents";return _interfaceFunction;};}();var TextExpressionInterface=function(){return function(elem){var _prevValue,_sourceText;function _thisLayerFunction(name){switch(name){case"ADBE Text Document":return _thisLayerFunction.sourceText;}}Object.defineProperty(_thisLayerFunction,"sourceText",{get:function get(){elem.textProperty.getValue();var stringValue=elem.textProperty.currentData.t;if(stringValue!==_prevValue){elem.textProperty.currentData.t=_prevValue;_sourceText=new String(stringValue);//If stringValue is an empty string, eval returns undefined, so it has to be returned as a String primitive
_sourceText.value=stringValue?stringValue:new String(stringValue);}return _sourceText;}});return _thisLayerFunction;};}();var LayerExpressionInterface=function(){function getMatrix(time){var toWorldMat=new Matrix();if(time!==undefined){var propMatrix=(this||_global)._elem.finalTransform.mProp.getValueAtTime(time);propMatrix.clone(toWorldMat);}else{var transformMat=(this||_global)._elem.finalTransform.mProp;transformMat.applyToMatrix(toWorldMat);}return toWorldMat;}function toWorldVec(arr,time){var toWorldMat=this.getMatrix(time);toWorldMat.props[12]=toWorldMat.props[13]=toWorldMat.props[14]=0;return this.applyPoint(toWorldMat,arr);}function toWorld(arr,time){var toWorldMat=this.getMatrix(time);return this.applyPoint(toWorldMat,arr);}function fromWorldVec(arr,time){var toWorldMat=this.getMatrix(time);toWorldMat.props[12]=toWorldMat.props[13]=toWorldMat.props[14]=0;return this.invertPoint(toWorldMat,arr);}function fromWorld(arr,time){var toWorldMat=this.getMatrix(time);return this.invertPoint(toWorldMat,arr);}function applyPoint(matrix,arr){if((this||_global)._elem.hierarchy&&(this||_global)._elem.hierarchy.length){var i,len=(this||_global)._elem.hierarchy.length;for(i=0;i<len;i+=1){(this||_global)._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(matrix);}}return matrix.applyToPointArray(arr[0],arr[1],arr[2]||0);}function invertPoint(matrix,arr){if((this||_global)._elem.hierarchy&&(this||_global)._elem.hierarchy.length){var i,len=(this||_global)._elem.hierarchy.length;for(i=0;i<len;i+=1){(this||_global)._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(matrix);}}return matrix.inversePoint(arr);}function fromComp(arr){var toWorldMat=new Matrix();toWorldMat.reset();(this||_global)._elem.finalTransform.mProp.applyToMatrix(toWorldMat);if((this||_global)._elem.hierarchy&&(this||_global)._elem.hierarchy.length){var i,len=(this||_global)._elem.hierarchy.length;for(i=0;i<len;i+=1){(this||_global)._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(toWorldMat);}return toWorldMat.inversePoint(arr);}return toWorldMat.inversePoint(arr);}function sampleImage(){return[1,1,1,1];}return function(elem){var transformInterface;function _registerMaskInterface(maskManager){_thisLayerFunction.mask=new MaskManagerInterface(maskManager,elem);}function _registerEffectsInterface(effects){_thisLayerFunction.effect=effects;}function _thisLayerFunction(name){switch(name){case"ADBE Root Vectors Group":case"Contents":case 2:return _thisLayerFunction.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return transformInterface;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return _thisLayerFunction.effect;case"ADBE Text Properties":return _thisLayerFunction.textInterface;}}_thisLayerFunction.getMatrix=getMatrix;_thisLayerFunction.invertPoint=invertPoint;_thisLayerFunction.applyPoint=applyPoint;_thisLayerFunction.toWorld=toWorld;_thisLayerFunction.toWorldVec=toWorldVec;_thisLayerFunction.fromWorld=fromWorld;_thisLayerFunction.fromWorldVec=fromWorldVec;_thisLayerFunction.toComp=toWorld;_thisLayerFunction.fromComp=fromComp;_thisLayerFunction.sampleImage=sampleImage;_thisLayerFunction.sourceRectAtTime=elem.sourceRectAtTime.bind(elem);_thisLayerFunction._elem=elem;transformInterface=TransformExpressionInterface(elem.finalTransform.mProp);var anchorPointDescriptor=getDescriptor(transformInterface,"anchorPoint");Object.defineProperties(_thisLayerFunction,{hasParent:{get:function get(){return elem.hierarchy.length;}},parent:{get:function get(){return elem.hierarchy[0].layerInterface;}},rotation:getDescriptor(transformInterface,"rotation"),scale:getDescriptor(transformInterface,"scale"),position:getDescriptor(transformInterface,"position"),opacity:getDescriptor(transformInterface,"opacity"),anchorPoint:anchorPointDescriptor,anchor_point:anchorPointDescriptor,transform:{get:function get(){return transformInterface;}},active:{get:function get(){return elem.isInRange;}}});_thisLayerFunction.startTime=elem.data.st;_thisLayerFunction.index=elem.data.ind;_thisLayerFunction.source=elem.data.refId;_thisLayerFunction.height=elem.data.ty===0?elem.data.h:100;_thisLayerFunction.width=elem.data.ty===0?elem.data.w:100;_thisLayerFunction.inPoint=elem.data.ip/elem.comp.globalData.frameRate;_thisLayerFunction.outPoint=elem.data.op/elem.comp.globalData.frameRate;_thisLayerFunction._name=elem.data.nm;_thisLayerFunction.registerMaskInterface=_registerMaskInterface;_thisLayerFunction.registerEffectsInterface=_registerEffectsInterface;return _thisLayerFunction;};}();var CompExpressionInterface=function(){return function(comp){function _thisLayerFunction(name){var i=0,len=comp.layers.length;while(i<len){if(comp.layers[i].nm===name||comp.layers[i].ind===name){return comp.elements[i].layerInterface;}i+=1;}return null;//return {active:false};
}Object.defineProperty(_thisLayerFunction,"_name",{value:comp.data.nm});_thisLayerFunction.layer=_thisLayerFunction;_thisLayerFunction.pixelAspect=1;_thisLayerFunction.height=comp.data.h||comp.globalData.compSize.h;_thisLayerFunction.width=comp.data.w||comp.globalData.compSize.w;_thisLayerFunction.pixelAspect=1;_thisLayerFunction.frameDuration=1/comp.globalData.frameRate;_thisLayerFunction.displayStartTime=0;_thisLayerFunction.numLayers=comp.layers.length;return _thisLayerFunction;};}();var TransformExpressionInterface=function(){return function(transform){function _thisFunction(name){switch(name){case"scale":case"Scale":case"ADBE Scale":case 6:return _thisFunction.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return _thisFunction.rotation;case"ADBE Rotate X":return _thisFunction.xRotation;case"ADBE Rotate Y":return _thisFunction.yRotation;case"position":case"Position":case"ADBE Position":case 2:return _thisFunction.position;case"ADBE Position_0":return _thisFunction.xPosition;case"ADBE Position_1":return _thisFunction.yPosition;case"ADBE Position_2":return _thisFunction.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return _thisFunction.anchorPoint;case"opacity":case"Opacity":case 11:return _thisFunction.opacity;}}Object.defineProperty(_thisFunction,"rotation",{get:ExpressionPropertyInterface(transform.r||transform.rz)});Object.defineProperty(_thisFunction,"zRotation",{get:ExpressionPropertyInterface(transform.rz||transform.r)});Object.defineProperty(_thisFunction,"xRotation",{get:ExpressionPropertyInterface(transform.rx)});Object.defineProperty(_thisFunction,"yRotation",{get:ExpressionPropertyInterface(transform.ry)});Object.defineProperty(_thisFunction,"scale",{get:ExpressionPropertyInterface(transform.s)});if(transform.p){var _transformFactory=ExpressionPropertyInterface(transform.p);}else{var _px=ExpressionPropertyInterface(transform.px);var _py=ExpressionPropertyInterface(transform.py);var _pz;if(transform.pz){_pz=ExpressionPropertyInterface(transform.pz);}}Object.defineProperty(_thisFunction,"position",{get:function get(){if(transform.p){return _transformFactory();}else{return[_px(),_py(),_pz?_pz():0];}}});Object.defineProperty(_thisFunction,"xPosition",{get:ExpressionPropertyInterface(transform.px)});Object.defineProperty(_thisFunction,"yPosition",{get:ExpressionPropertyInterface(transform.py)});Object.defineProperty(_thisFunction,"zPosition",{get:ExpressionPropertyInterface(transform.pz)});Object.defineProperty(_thisFunction,"anchorPoint",{get:ExpressionPropertyInterface(transform.a)});Object.defineProperty(_thisFunction,"opacity",{get:ExpressionPropertyInterface(transform.o)});Object.defineProperty(_thisFunction,"skew",{get:ExpressionPropertyInterface(transform.sk)});Object.defineProperty(_thisFunction,"skewAxis",{get:ExpressionPropertyInterface(transform.sa)});Object.defineProperty(_thisFunction,"orientation",{get:ExpressionPropertyInterface(transform.or)});return _thisFunction;};}();ProjectInterface=function(){function registerComposition(comp){(this||_global).compositions.push(comp);}return function(){function _thisProjectFunction(name){var i=0,len=(this||_global).compositions.length;while(i<len){if((this||_global).compositions[i].data&&(this||_global).compositions[i].data.nm===name){if((this||_global).compositions[i].prepareFrame&&(this||_global).compositions[i].data.xt){(this||_global).compositions[i].prepareFrame((this||_global).currentFrame);}return(this||_global).compositions[i].compInterface;}i+=1;}}_thisProjectFunction.compositions=[];_thisProjectFunction.currentFrame=0;_thisProjectFunction.registerComposition=registerComposition;return _thisProjectFunction;};}();var EffectsExpressionInterface=function(){var ob={createEffectsInterface:createEffectsInterface};function createEffectsInterface(elem,propertyGroup){if(elem.effectsManager){var effectElements=[];var effectsData=elem.data.ef;var i,len=elem.effectsManager.effectElements.length;for(i=0;i<len;i+=1){effectElements.push(createGroupInterface(effectsData[i],elem.effectsManager.effectElements[i],propertyGroup,elem));}var effects=elem.data.ef||[];var groupInterface=function groupInterface(name){i=0,len=effects.length;while(i<len){if(name===effects[i].nm||name===effects[i].mn||name===effects[i].ix){return effectElements[i];}i+=1;}};Object.defineProperty(groupInterface,"numProperties",{get:function get(){return effects.length;}});return groupInterface;}}function createGroupInterface(data,elements,propertyGroup,elem){function groupInterface(name){var effects=data.ef,i=0,len=effects.length;while(i<len){if(name===effects[i].nm||name===effects[i].mn||name===effects[i].ix){if(effects[i].ty===5){return effectElements[i];}else{return effectElements[i]();}}i+=1;}throw new Error();}var _propertyGroup=propertyGroupFactory(groupInterface,propertyGroup);var effectElements=[];var i,len=data.ef.length;for(i=0;i<len;i+=1){if(data.ef[i].ty===5){effectElements.push(createGroupInterface(data.ef[i],elements.effectElements[i],elements.effectElements[i].propertyGroup,elem));}else{effectElements.push(createValueInterface(elements.effectElements[i],data.ef[i].ty,elem,_propertyGroup));}}if(data.mn==="ADBE Color Control"){Object.defineProperty(groupInterface,"color",{get:function get(){return effectElements[0]();}});}Object.defineProperties(groupInterface,{numProperties:{get:function get(){return data.np;}},_name:{value:data.nm},propertyGroup:{value:_propertyGroup}});groupInterface.active=groupInterface.enabled=data.en!==0;return groupInterface;}function createValueInterface(element,type,elem,propertyGroup){var expressionProperty=ExpressionPropertyInterface(element.p);function interfaceFunction(){if(type===10){return elem.comp.compInterface(element.p.v);}return expressionProperty();}if(element.p.setGroupProperty){element.p.setGroupProperty(PropertyInterface("",propertyGroup));}return interfaceFunction;}return ob;}();var MaskManagerInterface=function(){function MaskInterface(mask,data){(this||_global)._mask=mask;(this||_global)._data=data;}Object.defineProperty(MaskInterface.prototype,"maskPath",{get:function get(){if((this||_global)._mask.prop.k){(this||_global)._mask.prop.getValue();}return(this||_global)._mask.prop;}});Object.defineProperty(MaskInterface.prototype,"maskOpacity",{get:function get(){if((this||_global)._mask.op.k){(this||_global)._mask.op.getValue();}return(this||_global)._mask.op.v*100;}});var MaskManager=function MaskManager(maskManager,elem){var _masksInterfaces=createSizedArray(maskManager.viewData.length);var i,len=maskManager.viewData.length;for(i=0;i<len;i+=1){_masksInterfaces[i]=new MaskInterface(maskManager.viewData[i],maskManager.masksProperties[i]);}var maskFunction=function maskFunction(name){i=0;while(i<len){if(maskManager.masksProperties[i].nm===name){return _masksInterfaces[i];}i+=1;}};return maskFunction;};return MaskManager;}();var ExpressionPropertyInterface=function(){var defaultUnidimensionalValue={pv:0,v:0,mult:1};var defaultMultidimensionalValue={pv:[0,0,0],v:[0,0,0],mult:1};function completeProperty(expressionValue,property,type){Object.defineProperty(expressionValue,"velocity",{get:function get(){return property.getVelocityAtTime(property.comp.currentFrame);}});expressionValue.numKeys=property.keyframes?property.keyframes.length:0;expressionValue.key=function(pos){if(!expressionValue.numKeys){return 0;}else{var value="";if("s"in property.keyframes[pos-1]){value=property.keyframes[pos-1].s;}else if("e"in property.keyframes[pos-2]){value=property.keyframes[pos-2].e;}else{value=property.keyframes[pos-2].s;}var valueProp=type==="unidimensional"?new Number(value):Object.assign({},value);valueProp.time=property.keyframes[pos-1].t/property.elem.comp.globalData.frameRate;valueProp.value=type==="unidimensional"?value[0]:value;return valueProp;}};expressionValue.valueAtTime=property.getValueAtTime;expressionValue.speedAtTime=property.getSpeedAtTime;expressionValue.velocityAtTime=property.getVelocityAtTime;expressionValue.propertyGroup=property.propertyGroup;}function UnidimensionalPropertyInterface(property){if(!property||!("pv"in property)){property=defaultUnidimensionalValue;}var mult=1/property.mult;var val=property.pv*mult;var expressionValue=new Number(val);expressionValue.value=val;completeProperty(expressionValue,property,"unidimensional");return function(){if(property.k){property.getValue();}val=property.v*mult;if(expressionValue.value!==val){expressionValue=new Number(val);expressionValue.value=val;completeProperty(expressionValue,property,"unidimensional");}return expressionValue;};}function MultidimensionalPropertyInterface(property){if(!property||!("pv"in property)){property=defaultMultidimensionalValue;}var mult=1/property.mult;var len=property.data&&property.data.l||property.pv.length;var expressionValue=createTypedArray("float32",len);var arrValue=createTypedArray("float32",len);expressionValue.value=arrValue;completeProperty(expressionValue,property,"multidimensional");return function(){if(property.k){property.getValue();}for(var i=0;i<len;i+=1){expressionValue[i]=arrValue[i]=property.v[i]*mult;}return expressionValue;};}//TODO: try to avoid using this getter
function defaultGetter(){return defaultUnidimensionalValue;}return function(property){if(!property){return defaultGetter;}else if(property.propType==="unidimensional"){return UnidimensionalPropertyInterface(property);}else{return MultidimensionalPropertyInterface(property);}};}();(function(){var TextExpressionSelectorProp=function(){function getValueProxy(index,total){(this||_global).textIndex=index+1;(this||_global).textTotal=total;(this||_global).v=this.getValue()*(this||_global).mult;return(this||_global).v;}return function TextExpressionSelectorProp(elem,data){(this||_global).pv=1;(this||_global).comp=elem.comp;(this||_global).elem=elem;(this||_global).mult=0.01;(this||_global).propType="textSelector";(this||_global).textTotal=data.totalChars;(this||_global).selectorValue=100;(this||_global).lastValue=[1,1,1];(this||_global).k=true;(this||_global).x=true;(this||_global).getValue=ExpressionManager.initiateExpression.bind(this||_global)(elem,data,this||_global);(this||_global).getMult=getValueProxy;(this||_global).getVelocityAtTime=expressionHelpers.getVelocityAtTime;if((this||_global).kf){(this||_global).getValueAtTime=expressionHelpers.getValueAtTime.bind(this||_global);}else{(this||_global).getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(this||_global);}(this||_global).setGroupProperty=expressionHelpers.setGroupProperty;};}();var propertyGetTextProp=TextSelectorProp.getTextSelectorProp;TextSelectorProp.getTextSelectorProp=function(elem,data,arr){if(data.t===1){return new TextExpressionSelectorProp(elem,data,arr);}else{return propertyGetTextProp(elem,data,arr);}};})();function SliderEffect(data,elem,container){(this||_global).p=PropertyFactory.getProp(elem,data.v,0,0,container);}function AngleEffect(data,elem,container){(this||_global).p=PropertyFactory.getProp(elem,data.v,0,0,container);}function ColorEffect(data,elem,container){(this||_global).p=PropertyFactory.getProp(elem,data.v,1,0,container);}function PointEffect(data,elem,container){(this||_global).p=PropertyFactory.getProp(elem,data.v,1,0,container);}function LayerIndexEffect(data,elem,container){(this||_global).p=PropertyFactory.getProp(elem,data.v,0,0,container);}function MaskIndexEffect(data,elem,container){(this||_global).p=PropertyFactory.getProp(elem,data.v,0,0,container);}function CheckboxEffect(data,elem,container){(this||_global).p=PropertyFactory.getProp(elem,data.v,0,0,container);}function NoValueEffect(){(this||_global).p={};}function EffectsManager(data,element){var effects=data.ef||[];(this||_global).effectElements=[];var i,len=effects.length;var effectItem;for(i=0;i<len;i++){effectItem=new GroupEffect(effects[i],element);(this||_global).effectElements.push(effectItem);}}function GroupEffect(data,element){this.init(data,element);}extendPrototype([DynamicPropertyContainer],GroupEffect);GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties;GroupEffect.prototype.init=function(data,element){(this||_global).data=data;(this||_global).effectElements=[];this.initDynamicPropertyContainer(element);var i,len=(this||_global).data.ef.length;var eff,effects=(this||_global).data.ef;for(i=0;i<len;i+=1){eff=null;switch(effects[i].ty){case 0:eff=new SliderEffect(effects[i],element,this||_global);break;case 1:eff=new AngleEffect(effects[i],element,this||_global);break;case 2:eff=new ColorEffect(effects[i],element,this||_global);break;case 3:eff=new PointEffect(effects[i],element,this||_global);break;case 4:case 7:eff=new CheckboxEffect(effects[i],element,this||_global);break;case 10:eff=new LayerIndexEffect(effects[i],element,this||_global);break;case 11:eff=new MaskIndexEffect(effects[i],element,this||_global);break;case 5:eff=new EffectsManager(effects[i],element,this||_global);break;//case 6:
default:eff=new NoValueEffect(effects[i],element,this||_global);break;}if(eff){(this||_global).effectElements.push(eff);}}};var lottie={};function setLocationHref(href){locationHref=href;}function searchAnimations(){{animationManager.searchAnimations();}}function setSubframeRendering(flag){subframeEnabled=flag;}function loadAnimation(params){return animationManager.loadAnimation(params);}function setQuality(value){if(typeof value==="string"){switch(value){case"high":defaultCurveSegments=200;break;case"medium":defaultCurveSegments=50;break;case"low":defaultCurveSegments=10;break;}}else if(!isNaN(value)&&value>1){defaultCurveSegments=value;}}function inBrowser(){return typeof navigator!=="undefined";}function installPlugin(type,plugin){if(type==="expressions"){expressionsPlugin=plugin;}}function getFactory(name){switch(name){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;}}lottie.play=animationManager.play;lottie.pause=animationManager.pause;lottie.setLocationHref=setLocationHref;lottie.togglePause=animationManager.togglePause;lottie.setSpeed=animationManager.setSpeed;lottie.setDirection=animationManager.setDirection;lottie.stop=animationManager.stop;lottie.searchAnimations=searchAnimations;lottie.registerAnimation=animationManager.registerAnimation;lottie.loadAnimation=loadAnimation;lottie.setSubframeRendering=setSubframeRendering;lottie.resize=animationManager.resize;//lottie.start = start;
lottie.goToAndStop=animationManager.goToAndStop;lottie.destroy=animationManager.destroy;lottie.setQuality=setQuality;lottie.inBrowser=inBrowser;lottie.installPlugin=installPlugin;lottie.freeze=animationManager.freeze;lottie.unfreeze=animationManager.unfreeze;lottie.setVolume=animationManager.setVolume;lottie.mute=animationManager.mute;lottie.unmute=animationManager.unmute;lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations;lottie.__getFactory=getFactory;lottie.version="5.7.5";function checkReady(){if(document.readyState==="complete"){clearInterval(readyStateCheckInterval);searchAnimations();}}function getQueryVariable(variable){var vars=queryString.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(decodeURIComponent(pair[0])==variable){return decodeURIComponent(pair[1]);}}}var renderer="";{var scripts=document.getElementsByTagName("script");var index=scripts.length-1;var myScript=scripts[index]||{src:""};var queryString=myScript.src.replace(/^[^\?]+\??/,"");renderer=getQueryVariable("renderer");}var readyStateCheckInterval=setInterval(checkReady,100);return lottie;});var exports$1$1=exports$1;var __varRecorder__=lively.FreezerRuntime.recorderFor("LottieMorph/index.js");__varRecorder__.HTMLMorph=HTMLMorph;__varRecorder__.Lottie=exports$1$1;__varRecorder__.resource=resource;var LottieMorph=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("LottieMorph/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("LottieMorph")&&typeof __lively_classholder__.LottieMorph==="function"?__lively_classholder__.LottieMorph:__lively_classholder__.LottieMorph=function LottieMorph(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"initIfNeeded",value:function LottieMorph_initIfNeeded_(){if(this.lottieAnimation)return;this.lottieAnimation=true;this.init();}},{key:"getContainer",value:function LottieMorph_getContainer_(){return this.domNode;}},{key:"init",value:function(){var _LottieMorph_init_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee236(){var slider;return regeneratorRuntime.wrap(function _callee236$(_context236){while(1){switch(_context236.prev=_context236.next){case 0:_context236.next=2;return this.whenRendered();case 2:_context236.next=4;return __varRecorder__.resource(this.animationDataUrl).readJson();case 4:this.animationData=_context236.sent;__varRecorder__.Lottie.destroy("lottie-"+this.id);this.lottieAnimation=__varRecorder__.Lottie.loadAnimation({animationData:this.animationData,renderer:"svg",name:"lottie-"+this.id,loop:true,autoplay:false,container:this.getContainer()});slider=this.get("frame slider");if(slider)slider.max=this.lottieAnimation.totalFrames;case 9:case"end":return _context236.stop();}}},_callee236,this);}));function LottieMorph_init_(){return _LottieMorph_init_.apply(this,arguments);}return LottieMorph_init_;}()},{key:"renderFrame",value:function LottieMorph_renderFrame_(frame){if(this.lottieAnimation&&this.lottieAnimation.renderer)this.lottieAnimation.renderer.renderFrame(frame);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"LottieMorph";}},{key:"properties",get:function get(){return{animationDataUrl:{copyAssetOnFreeze:true,set:function set(url){var _this237=this;return _asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee237(){var baseUrl;return regeneratorRuntime.wrap(function _callee237$(_context237){while(1){switch(_context237.prev=_context237.next){case 0:if(!url.startsWith(document.location.origin)){if(url.startsWith("/"))baseUrl=document.location.origin;else baseUrl=document.location.href+"/..";url=__varRecorder__.resource(baseUrl).join(url).withRelativePartsResolved().url;}if(!(_this237.animationDataUrl==url)){_context237.next=3;break;}return _context237.abrupt("return");case 3:_this237.setProperty("animationDataUrl",url);if(!_this237.lazyInit){_context237.next=6;break;}return _context237.abrupt("return");case 6:_this237.init();case 7:case"end":return _context237.stop();}}},_callee237);}))();}},lazyInit:{defaultValue:false},progress:{set:function set(p){if(!this.lottieAnimation)return;if(p==this.progress)return;this.setProperty("progress",p);this.renderFrame(Number.parseInt(this.lottieAnimation.totalFrames*p));}},html:{get:function get(){return"";}},animationData:{serialize:false}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"LottieMorph",version:"0.1.1-91"};}},{start:178,end:2224});}(__varRecorder__.HTMLMorph);LottieMorph=__varRecorder__.LottieMorph;var LottieMorph$1=LottieMorph;__varRecorder__["default"]=LottieMorph;var __varRecorder__$1=lively.FreezerRuntime.recorderFor("LottieMorph/services.js");__varRecorder__$1.LottieMorph=LottieMorph$1;var ServiceSection=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("LottieMorph/services.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ServiceSection")&&typeof __lively_classholder__.ServiceSection==="function"?__lively_classholder__.ServiceSection:__lively_classholder__.ServiceSection=function ServiceSection(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onScrollUpdate",value:function ServiceSection_onScrollUpdate_(inView){if(inView){if(!this.lottieAnimation)this.reset();this.startStepping("updateAnimation");}else this.stopStepping();}},{key:"updateAnimation",value:function ServiceSection_updateAnimation_(){if(!this._ts)this._ts=Date.now();if(Date.now()-this._ts>5000)this._ts=Date.now();this.progress=(Date.now()-this._ts)/5000;}},{key:"reset",value:function ServiceSection_reset_(){this.lottieAnimation=true;this.html=this.html;this.init();}},{key:"relayout",value:function(){var _ServiceSection_relayout_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee238(){var frame,height;return regeneratorRuntime.wrap(function _callee238$(_context238){while(1){switch(_context238.prev=_context238.next){case 0:_context238.next=2;return this.whenRendered();case 2:frame=this.domNode.getElementsByClassName("frame")[0];height=frame.getBoundingClientRect().height;if(height!=this.height)this.height=height;case 5:case"end":return _context238.stop();}}},_callee238,this);}));function ServiceSection_relayout_(){return _ServiceSection_relayout_.apply(this,arguments);}return ServiceSection_relayout_;}()},{key:"getContainer",value:function ServiceSection_getContainer_(){return this.domNode.getElementsByClassName("lottie")[0];}},{key:"getHTML",value:function ServiceSection_getHTML_(){return"<div class=\"frame\">\n  <div class=\"interactive\">\n    <div class=\"viewport\"></div>\n    <div class=\"lottie\"></div>\n  </div>\n  <div class=\"info\">\n    <span class=\"h3\">\n      ".concat(this.title.toUpperCase(),"\n    </span>\n    <br>\n    <div class=\"spacer\"></div>\n    <span class=\"h4\">\n      ").concat(this.description,"\n    </span>  \n  </div>\n  <div class=buttons>\n    <i class=\"fas fa-desktop\"></i>\n    <i class=\"fas fa-tablet-alt\"></i>\n    <i class=\"fas fa-mobile-alt\"></i>\n  </div>\n</div>\n  ");}},{key:"update",value:function ServiceSection_update_(){var frame=this.domNode.getElementsByClassName("frame")[0];if(!frame)return;frame.classList.remove("desktop","mobile","tablet");frame.classList.add(this.selectedMode);}},{key:"onMouseDown",value:function ServiceSection_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);var _ref162=_toConsumableArray2(evt.domEvt.target.classList.values()),_=_ref162[0],klass=_ref162[1];var klassToMode={"fa-desktop":"desktop","fa-mobile-alt":"mobile","fa-tablet-alt":"tablet"};if(klass&&klassToMode[klass])this.selectedMode=klassToMode[klass];}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ServiceSection";}},{key:"properties",get:function get(){return{title:{},description:{},selectedMode:{type:"Enum",values:["mobile","desktop","tablet"],set:function set(mode){this.setProperty("selectedMode",mode);this.update();}},html:{get:function get(){return this.getHTML();}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"services.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"LottieMorph",version:"0.1.1-91"};}},{start:56,end:2342});}(__varRecorder__$1.LottieMorph);ServiceSection=__varRecorder__$1.ServiceSection;__varRecorder__$1["default"]=ServiceSection;}};});System.register("7",['./__root_module__-5782ff42.js'],function(){'use strict';var Morph,easings,InteractiveMorph,Color,promise,Path,initializeClass;return{setters:[function(module){Morph=module.M;easings=module.e;InteractiveMorph=module.I;Color=module.C;promise=module.a;Path=module.P;initializeClass=module.i;}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("ServicesSection/index.js");__varRecorder__.Morph=Morph;__varRecorder__.easings=easings;__varRecorder__.InteractiveMorph=InteractiveMorph;__varRecorder__.Color=Color;__varRecorder__.promise=promise;__varRecorder__.Path=Path;var ServicesSection=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("ServicesSection/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ServicesSection")&&typeof __lively_classholder__.ServicesSection==="function"?__lively_classholder__.ServicesSection:__lively_classholder__.ServicesSection=function ServicesSection(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onOwnerScrolled",value:function ServicesSection_onOwnerScrolled_(insideViewport){if(insideViewport)this.autoPlay();else this.stopStepping();}},{key:"autoPlay",value:function ServicesSection_autoPlay_(){if(this.tickingScripts.length>0)return;this.progress=0;this.startStepping(50,"play");}},{key:"play",value:function ServicesSection_play_(){this.progress+=0.4;if(this.progress>=100)this.progress=0;}},{key:"sectionConfig",get:function get(){return{scrollytelling:{animation:this.scrollytellingAnimation,color:__varRecorder__.Color.rgb(241,101,119),infoIconUrl:"https://admin.typeshift.io/users/robin.schreiber/uploads/website-assets/21.7.20/Info-Icon_red.svg",description:"Durch Scrollen navigieren Seitenbesucher durch bewegte Geschichten, die Videos, Bilder und interaktive Elemente enthalten."},gaming:{animation:this.gamingAnimation,color:__varRecorder__.Color.rgbHex("f1dc36"),infoIconUrl:"https://admin.typeshift.io/users/robin.schreiber/uploads/website-assets/21.7.20/Info-Icon_yellow.svg",description:"Sie punkten, wenn es darum geht, Zusammenh\xE4nge aufzuzeigen oder neugierig zu machen. Hier geht\u2019s nicht ums Gewinnen, sondern ums Verstehen."},presentation:{animation:this.presentationAnimation,color:__varRecorder__.Color.rgbHex("38e390"),infoIconUrl:"https://admin.typeshift.io/users/robin.schreiber/uploads/website-assets/21.7.20/Info-Icon_green.svg",description:"Eine Pr\xE4sentation mit ma\xDFgeschneiderten Animationen und Interaktionen?\nOnline und offline? Teil- und editierbar? Machen wir!\n"},simulations:{animation:this.simulationsAnimation,color:__varRecorder__.Color.rgbHex("ffc65b"),infoIconUrl:"https://admin.typeshift.io/users/robin.schreiber/uploads/website-assets/21.7.20/Info-Icon_orange.svg",description:"Menschen erhalten die Mglichkeit, Produkte oder Prozesse auszuprobieren, wann und wo sie mchten."},dataVis:{animation:this.dataVisAnimation,color:__varRecorder__.Color.rgbHex("62b3d1"),infoIconUrl:"https://admin.typeshift.io/users/robin.schreiber/uploads/website-assets/21.7.20/Info-Icon_blue.svg",description:"Daten sind Daten sind Daten? N! Interaktive Diagramme und Visualisierungen erlauben es, Verbindungen aufzuzeigen und machen Zahlen greifbar."}};}},{key:"onLoad",value:function(){var _ServicesSection_onLoad_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee239(){var _this238=this;return regeneratorRuntime.wrap(function _callee239$(_context239){while(1){switch(_context239.prev=_context239.next){case 0:_context239.next=2;return __varRecorder__.promise.waitFor(30*1000,function(){return __varRecorder__.Path("ui.serviceAnimation.lottieAnimation").get(_this238);});case 2:this.showSectionNamed("scrollytelling",1);case 3:case"end":return _context239.stop();}}},_callee239,this);}));function ServicesSection_onLoad_(){return _ServicesSection_onLoad_.apply(this,arguments);}return ServicesSection_onLoad_;}()},{key:"showSectionNamed",value:function(){var _ServicesSection_showSectionNamed_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee240(name,progress){return regeneratorRuntime.wrap(function _callee240$(_context240){while(1){switch(_context240.prev=_context240.next){case 0:this.showSection({color:this.sectionConfig[name].color,animationDataUrl:this.sectionConfig[name].animation,progressLine:this.ui[name+"Progress"],sectionLabel:this.ui[name+"Label"],currentStep:this.ui[name+"Step"],infoIconUrl:this.sectionConfig[name].infoIconUrl,description:this.sectionConfig[name].description,progress:progress});case 1:case"end":return _context240.stop();}}},_callee240,this);}));function ServicesSection_showSectionNamed_(_x242,_x243){return _ServicesSection_showSectionNamed_.apply(this,arguments);}return ServicesSection_showSectionNamed_;}()},{key:"showSection",value:function ServicesSection_showSection_(_ref163){var color=_ref163.color,animationDataUrl=_ref163.animationDataUrl,progressLine=_ref163.progressLine,sectionLabel=_ref163.sectionLabel,progress=_ref163.progress,currentStep=_ref163.currentStep,infoIconUrl=_ref163.infoIconUrl,description=_ref163.description;var _this$ui18=this.ui,serviceAnimation=_this$ui18.serviceAnimation,serviceFrame=_this$ui18.serviceFrame,serviceSectionNames=_this$ui18.serviceSectionNames,infoIcon=_this$ui18.infoIcon,serviceDescription=_this$ui18.serviceDescription,progressGuideLine=_this$ui18.progressGuideLine;if(!serviceFrame||!sectionLabel)return;var steps=serviceFrame.getAllNamed(/.*step/);var progresses=serviceFrame.getAllNamed(/.*progress/);progresses.forEach(function(m){return m.drawnProportion=-1;});progressLine.drawnProportion=progress-1;serviceFrame.fill=color;progressGuideLine.borderColor=color;serviceFrame.getSubmorphsByStyleClassName("Path").forEach(function(path){path.borderColor=color;});steps.forEach(function(step){step.borderColor=color;step.fill=__varRecorder__.Color.white;});currentStep.fill=color;serviceSectionNames.submorphs.forEach(function(m){m.fontColor=color;m.opacity=0.5;if(m!=sectionLabel&&m.scale!=1){m.animate({duration:300,scale:1});}});sectionLabel.opacity=1;if(sectionLabel.scale!=1.5){sectionLabel.animate({duration:300,scale:1.5});}serviceAnimation.animationDataUrl=animationDataUrl;serviceAnimation.progress=progress;if(infoIcon.imageUrl!=infoIconUrl){infoIcon.imageUrl=infoIconUrl;}if(serviceDescription.textString!=description){serviceDescription.textString=description;}}},{key:"onMouseDown",value:function ServicesSection_onMouseDown_(evt){var _this239=this;var sectionName=evt.targetMorph.name.replace(" label","");if(this.sectionNames.includes(sectionName)){this.stopStepping();this.animate({customTween:function customTween(p){_this239.showSectionNamed(sectionName,p);}});}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ServicesSection";}},{key:"properties",get:function get(){return{scrollytellingAnimation:{copyAssetOnFreeze:true},gamingAnimation:{copyAssetOnFreeze:true},presentationAnimation:{copyAssetOnFreeze:true},simulationsAnimation:{copyAssetOnFreeze:true},dataVisAnimation:{copyAssetOnFreeze:true},sectionNames:{derived:true,get:function get(){return["scrollytelling","gaming","presentation","simulations","dataVis"];}},progress:{min:0,max:100,set:function set(p){var _this240=this;return _asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee241(){var sectionName;return regeneratorRuntime.wrap(function _callee241$(_context241){while(1){switch(_context241.prev=_context241.next){case 0:_this240.setProperty("progress",p);sectionName=_this240.sectionNames.find(function(name,i){return p<=(i+1)*20;});if(sectionName){_context241.next=4;break;}return _context241.abrupt("return");case 4:_this240.showSectionNamed(sectionName,p%20/20);case 5:case"end":return _context241.stop();}}},_callee241);}))();}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"ServicesSection",version:"0.1.1-123"};}},{start:241,end:6267});}(__varRecorder__.InteractiveMorph);ServicesSection=__varRecorder__.ServicesSection;__varRecorder__["default"]=ServicesSection;}};});System.register("8",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./services-bc1b0444.js','./index-d275e3ad.js','./index-a3af1ede.js'],function(){'use strict';var InteractiveMorph,easings,initializeClass;return{setters:[function(module){InteractiveMorph=module.I;easings=module.e;initializeClass=module.i;},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("DeviceSwitcher/index.js");__varRecorder__.InteractiveMorph=InteractiveMorph;__varRecorder__.easings=easings;var DeviceSwitcher=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("DeviceSwitcher/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("DeviceSwitcher")&&typeof __lively_classholder__.DeviceSwitcher==="function"?__lively_classholder__.DeviceSwitcher:__lively_classholder__.DeviceSwitcher=function DeviceSwitcher(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"selectDesktop",value:function DeviceSwitcher_selectDesktop_(){var _this241=this;this.withAnimationDo(function(){_this241.display("desktopFrameContainer");_this241.ui.interactiveFrame.scale=1;_this241.ui.interactiveFrame.center=_this241.innerBounds().center();},{duration:300,easing:__varRecorder__.easings.inOutExpo});}},{key:"selectTablet",value:function DeviceSwitcher_selectTablet_(){var _this242=this;this.withAnimationDo(function(){_this242.display("tabletFrameContainer");_this242.ui.interactiveFrame.scale=_this242.ui.tabletWidth.width/_this242.ui.interactiveFrame.width;_this242.ui.interactiveFrame.center=_this242.innerBounds().center();},{duration:300,easing:__varRecorder__.easings.inOutExpo});}},{key:"selectMobile",value:function DeviceSwitcher_selectMobile_(){var _this243=this;this.withAnimationDo(function(){_this243.display("mobileFrameContainer");_this243.ui.interactiveFrame.scale=_this243.ui.mobileWidth.width/_this243.ui.interactiveFrame.width;_this243.ui.interactiveFrame.center=_this243.innerBounds().center();},{duration:300,easing:__varRecorder__.easings.inOutExpo});}},{key:"display",value:function DeviceSwitcher_display_(containerName){for(var _i197=0,_arr7=["desktopFrameContainer","mobileFrameContainer","tabletFrameContainer"];_i197<_arr7.length;_i197++){var name=_arr7[_i197];var active=name==containerName;this.ui[name].isLayoutable=active;this.ui[name].opacity=active?name=="desktopFrameContainer"&&this.width<420?0:1:0;this.get(name.replace("FrameContainer","")).opacity=active?1:0.2;}}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"DeviceSwitcher";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"DeviceSwitcher",version:"0.1.1-20"};}},{start:139,end:1681});}(__varRecorder__.InteractiveMorph);DeviceSwitcher=__varRecorder__.DeviceSwitcher;__varRecorder__["default"]=DeviceSwitcher;}};});System.register("9",['./__root_module__-5782ff42.js'],function(){'use strict';var Morph,pt,num,fun,signal,connect,initializeClass,exports$1;return{setters:[function(module){Morph=module.M;pt=module.p;num=module.n;fun=module.f;signal=module.b;connect=module.c;initializeClass=module.i;exports$1=module.d;}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("TimeSlider/index.js");__varRecorder__.Morph=Morph;__varRecorder__.pt=pt;__varRecorder__.num=num;__varRecorder__.fun=fun;__varRecorder__.signal=signal;__varRecorder__.connect=connect;var TimeSlider=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("TimeSlider/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("TimeSlider")&&typeof __lively_classholder__.TimeSlider==="function"?__lively_classholder__.TimeSlider:__lively_classholder__.TimeSlider=function TimeSlider(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onMouseDown",value:function TimeSlider_onMouseDown_(evt){if(evt.targetMorph!=this)return;var knob=this.getSubmorphNamed("knob");knob.hitPoint=knob.center;knob.onDrag(evt);}},{key:"relayout",value:function TimeSlider_relayout_(animated){var width=this.owner.width-200;if(animated){this.animate(Object.assign({},animated,{width:width}));}else{this.width=width;}this.adjustSliderParts(animated);}},{key:"reset",value:function TimeSlider_reset_(){this.value=0;}},{key:"onValueChange",value:function TimeSlider_onValueChange_(v,oldv){this.owner&&this.owner.renderFrame(v);}},{key:"clipValue",value:function TimeSlider_clipValue_(val){return Math.min(1,Math.max(0,0,__varRecorder__.num.roundTo(val,0.0001)));}},{key:"adjustSliderParts",value:function TimeSlider_adjustSliderParts_(animated){var knob=this.knob,mss=this.mss,isVertical=this.isVertical,scaledValue=this.scaledValue,sliderExtent=this.sliderExtent,sliderLine=this.getSubmorphNamed("slider line");if(!knob)return;var val=scaledValue,bnds=this.innerBounds(),ext=sliderExtent;if(isVertical){var elevPix=Math.max(ext*bnds.height,mss),topLeft=__varRecorder__.pt(0,Math.round((bnds.height-elevPix)*val)),sliderExt=__varRecorder__.pt(bnds.width,elevPix);}else{var elevPix=Math.max(ext*bnds.width,mss),topLeft=__varRecorder__.pt(Math.round((bnds.width-elevPix)*val),0),sliderExt=__varRecorder__.pt(elevPix,bnds.height);}if(animated){knob.animate(Object.assign({},animated,{left:bnds.topLeft().addPt(topLeft).x}));return;}knob.center=bnds.bottomLeft().addXY(topLeft.x);if(sliderLine)sliderLine.width=this.width;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"TimeSlider";}},{key:"properties",get:function get(){return{min:{defaultValue:null},max:{defaultValue:null},mss:{defaultValue:12},root:{},isVertical:{readOnly:true,derived:true,after:["extent"],get:function get(){return this.height>this.width;}},knob:{readOnly:true,derived:true,after:["submorphs"],get:function get(){return this.getSubmorphNamed("knob");}},extent:{set:function set(val){this.setProperty("extent",val);}},value:{after:["submorphs"],set:function set(val){var oldValue=this.value;this.setProperty("value",val);this.adjustSliderParts();this.onValueChange(val,oldValue);}},valueScale:{defaultValue:1,after:["submorphs"],set:function set(val){this.setProperty("valueScale",val);this.adjustSliderParts();}},scaledValue:{after:["value","valueScale"],derived:true,set:function set(value){var valueScale=this.valueScale,min=this.min,max=this.max;this.value=typeof min==="number"&&typeof max==="number"?(max-min)*value+min:value*valueScale;},get:function get(){var valueScale=this.valueScale,v=this.value,min=this.min,max=this.max;v=v||0;return typeof min==="number"&&typeof max==="number"?(v-min)/(max-min):v/valueScale;}},sliderExtent:{defaultValue:0.1,set:function set(val){this.setProperty("sliderExtent",val);this.adjustSliderParts();}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"TimeSlider",version:"0.1.1-62"};}},{start:213,end:3707});}(__varRecorder__.Morph);TimeSlider=__varRecorder__.TimeSlider;__varRecorder__["default"]=TimeSlider;var __varRecorder__$1=lively.FreezerRuntime.recorderFor("SliderKnob/index.js");__varRecorder__$1.Morph=Morph;__varRecorder__$1.bowser=exports$1;__varRecorder__$1.num=num;var SliderKnob=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("SliderKnob/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("SliderKnob")&&typeof __lively_classholder__.SliderKnob==="function"?__lively_classholder__.SliderKnob:__lively_classholder__.SliderKnob=function SliderKnob(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"isSliderKnob",get:function get(){return true;}},{key:"onMouseDown",value:function SliderKnob_onMouseDown_(evt){var _this244=this;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);this.animate({customTween:function customTween(p){_this244.scale=__varRecorder__$1.num.interpolate(p,1,1.5);},duration:100});}},{key:"onMouseUp",value:function SliderKnob_onMouseUp_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseUp",this).call(this,evt);this.animate({scale:1,duration:300});}},{key:"onDragStart",value:function SliderKnob_onDragStart_(evt){this.hitPoint=evt.positionIn(this.owner);this.nativeCursor="grabbing";}},{key:"onDrag",value:function SliderKnob_onDrag_(evt){var hitPoint=this.hitPoint,slider=this.owner;if(!hitPoint)return;var delta=slider.localize(evt.position).subPt(hitPoint),p=this.bounds().center().addPt(delta),bnds=slider.innerBounds(),ext=slider.sliderExtent;if(slider.isVertical){var elevPix=Math.max(ext*bnds.height,slider.mss),newValue=p.y/(bnds.height-elevPix);}else{var elevPix=Math.max(ext*bnds.width,slider.mss),newValue=p.x/(bnds.width-elevPix);}if(isNaN(newValue))newValue=0;var prevVal=slider.scaledValue;slider.scaledValue=slider.clipValue(newValue);var newVal=slider.scaledValue;if(+newVal!=+prevVal)this.hitPoint=slider.localize(evt.position);}},{key:"onDragEnd",value:function SliderKnob_onDragEnd_(){this.nativeCursor="grab";this.animate({scale:1,duration:300});}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"SliderKnob";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"SliderKnob",version:"0.1.1-17"};}},{start:129,end:1766});}(__varRecorder__$1.Morph);SliderKnob=__varRecorder__$1.SliderKnob;__varRecorder__$1["default"]=SliderKnob;}};});System.register("10",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./index-83723532.js','./index-6da14585.js'],function(){'use strict';var InteractiveMorph,initializeClass,pt,Point,rect,Color,Morph,Image,connect,string,num,arr,promise,resource;return{setters:[function(module){InteractiveMorph=module.I;initializeClass=module.i;pt=module.p;Point=module.g;rect=module.h;Color=module.C;Morph=module.M;Image=module.j;connect=module.c;string=module.s;num=module.n;arr=module.k;promise=module.a;resource=module.r;},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("SplitAnimation/index.js");__varRecorder__.InteractiveMorph=InteractiveMorph;var SplitAnimation=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("SplitAnimation/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("SplitAnimation")&&typeof __lively_classholder__.SplitAnimation==="function"?__lively_classholder__.SplitAnimation:__lively_classholder__.SplitAnimation=function SplitAnimation(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"update",value:function SplitAnimation_update_(p){var _this$ui19=this.ui,agencyAnimation1=_this$ui19.agencyAnimation1,agencyAnimation2=_this$ui19.agencyAnimation2,agencyAnimation3=_this$ui19.agencyAnimation3;if(p>=0&&p<0.28){agencyAnimation1.progress=p/0.28;agencyAnimation2.progress=0;agencyAnimation3.progress=0;}if(p>=0.28&&p<0.61){agencyAnimation1.progress=1;agencyAnimation2.progress=(p-0.28)/(0.61-0.28);agencyAnimation3.progress=0;}if(p>=0.61&&p<=1){agencyAnimation1.progress=1;agencyAnimation2.progress=1;agencyAnimation3.progress=(p-0.61)/(1-0.61);}}},{key:"test",value:function SplitAnimation_test_(){var _this245=this;this.animate({customTween:function customTween(p){return _this245.update(p);}});}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"SplitAnimation";}},{key:"properties",get:function get(){return{progress:{set:function set(p){this.update(p);}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"SplitAnimation",version:"0.1.1-5"};}},{start:88,end:950});}(__varRecorder__.InteractiveMorph);SplitAnimation=__varRecorder__.SplitAnimation;__varRecorder__["default"]=SplitAnimation;var __varRecorder__$1=lively.FreezerRuntime.recorderFor("lively.components/canvas.js");__varRecorder__$1.pt=pt;__varRecorder__$1.Point=Point;__varRecorder__$1.rect=rect;__varRecorder__$1.Color=Color;__varRecorder__$1.Morph=Morph;__varRecorder__$1.Image=Image;__varRecorder__$1.connect=connect;var Canvas=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("lively.components/canvas.js");var __lively_class__=__lively_classholder__.hasOwnProperty("Canvas")&&typeof __lively_classholder__.Canvas==="function"?__lively_classholder__.Canvas:__lively_classholder__.Canvas=function Canvas(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"context",get:function get(){if(this._canvas){return this._canvas.getContext(this.contextType);}else if(!this.world()||!this.env.renderer.getNodeForMorph(this)){console.warn("Context not yet rendered. Please ensure that the Canvas Morph has been rendered first before accessing the context. This can be achieved by waiting for the whenRendered() promise before you proceed accessing the context property.");}return null;}},{key:"_canvas",set:function set(new_canvas){var old_canvas=this.__canvas__;this.__canvas__=new_canvas;this.restoreContent(old_canvas,new_canvas);}},{key:"_canvas",get:function get(){return this.__canvas__;}},{key:Symbol["for"]("lively-instance-initialize"),value:function Canvas_initialize_(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,props);__varRecorder__$1.connect(this,"extent",this,"onExtentChanged");}},{key:"afterRender",value:function Canvas_afterRender_(canvasNode,hasNewCanvasNode){if(hasNewCanvasNode)this._canvas=canvasNode;else if(typeof this.__canvas_init__==="function"){this.__canvas_init__();delete this.__canvas_init__;}}},{key:"restoreContent",value:function Canvas_restoreContent_(old_canvas,new_canvas){var contextType=this.contextType,preserveContents=this.preserveContents;if(typeof this.__canvas_init__==="function"){this.__canvas_init__();delete this.__canvas_init__;}else if(preserveContents&&contextType=="2d"&&old_canvas&&old_canvas!==new_canvas){this.context.drawImage(old_canvas,0,0);}}},{key:"onExtentChanged",value:function Canvas_onExtentChanged_(){var _this246=this;if(this._canvas&&this.preserveContents&&this.context.getImageData){var _this$_canvas=this._canvas,w=_this$_canvas.width,h=_this$_canvas.height;var contents=this.context.getImageData(0,0,w,h);this.__canvas_init__=function(){_this246.context.putImageData(contents,0,0);};}}},{key:"clear",value:function Canvas_clear_(color){var ctx=this.context;if(ctx){var _this$_canvas2=this._canvas,w=_this$_canvas2.width,h=_this$_canvas2.height;ctx.save();ctx.setTransform(1,0,0,1,0,0);if(color){if(color.toCSSString)color=color.toCSSString();ctx.fillStyle=color;ctx.fillRect(0,0,w,h);}else{ctx.clearRect(0,0,w,h);}ctx.restore();}}},{key:"render",value:function Canvas_render_(renderer){return renderer.renderCanvas(this);}},{key:"withContextDo",value:function Canvas_withContextDo_(func){var _this247=this;if(this._canvas)func(this.context);else this.__canvas_init__=function(){return func(_this247.context);};}},{key:"toDataURI",value:function Canvas_toDataURI_(){return this._canvas&&this._canvas.toDataURL();}},{key:"fromDataURI",value:function Canvas_fromDataURI_(uri){var _this248=this;var img=new __varRecorder__$1.Image();img.onload=function(){_this248._canvas.width=img.width;_this248._canvas.height=img.height;_this248.context.drawImage(img,0,0);};img.src=uri;}},{key:"imageData",value:function Canvas_imageData_(bounds){if(!bounds)bounds=this.canvasBounds;var _bounds2=bounds,x=_bounds2.x,y=_bounds2.y,width=_bounds2.width,height=_bounds2.height;return this.context.getImageData(x,y,width,height);}},{key:"nonTransparentArea",value:function Canvas_nonTransparentArea_(){var imageData=this.imageData();var data=imageData.data,width=imageData.width,height=imageData.height;var minX=width;var minY=height;for(var y=0;y<height;y++){for(var x=0;x<minX;x++){if(data[(y*width+x)*4+3]>0){minX=x;if(minY>y)minY=y;}}}if(minX===width)return __varRecorder__$1.rect(0,0,0,0);var maxX=minX;var maxY=minY;for(var _y15=height-1;_y15>minY;_y15--){for(var _x244=width-1;_x244>maxX;_x244--){if(data[(_y15*width+_x244)*4+3]>0){maxX=_x244;if(maxY<_y15)maxY=_y15;}}}return{imageData:imageData,bounds:__varRecorder__$1.rect(minX,minY,maxX-minX+1,maxY-minY+1)};}},{key:"trimNonTransparent",value:function Canvas_trimNonTransparent_(){var _this$nonTransparentA=this.nonTransparentArea(),imageData=_this$nonTransparentA.imageData,bounds=_this$nonTransparentA.bounds;if(!bounds.topLeft().equals(__varRecorder__$1.pt(0,0))){var context=this.context;var x=bounds.x,y=bounds.y,width=bounds.width,height=bounds.height;context.putImageData(imageData,-x,-y,x,y,width,height);this.position=this.position.addPt(bounds.topLeft());}if(!bounds.extent().equals(this.extent)){this.extent=bounds.extent();}}},{key:"finishDraw",value:function Canvas_finishDraw_(){var style=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var c=this.context;var _style$color=style.color,color=_style$color===void 0?"rgba(0,0,0,0.6)":_style$color,_style$width=style.width,width=_style$width===void 0?4:_style$width,_style$fill=style.fill,fill=_style$fill===void 0?false:_style$fill;var fillColor=style.fillColor||color;if(color.toCSSString)color=color.toCSSString();if(fillColor.toCSSString)fillColor=fillColor.toCSSString();c.strokeStyle=color;c.lineWidth=width;c.stroke();c.closePath();if(fill){c.fillStyle=fillColor;c.fill();}}},{key:"line",value:function Canvas_line_(from,to){var style=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var c=this.context;c.beginPath();c.moveTo(from.x,from.y);c.lineTo(to.x,to.y);c.lineCap="round";this.finishDraw(style);}},{key:"arc",value:function Canvas_arc_(center,radius,startTheta,endTheta){var counterClockwise=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var style=arguments.length>5&&arguments[5]!==undefined?arguments[5]:{};var c=this.context;c.beginPath();c.arc(center.x,center.y,radius,startTheta,endTheta,counterClockwise);this.finishDraw(style);}},{key:"polygon",value:function Canvas_polygon_(vertices){var style=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var c=this.context;c.beginPath();c.moveTo(vertices[0].x,vertices[0].y);for(var i=0;i<vertices.length;i++){c.lineTo(vertices[i].x,vertices[i].y);}c.lineTo(vertices[0].x,vertices[0].y);this.finishDraw(style);}},{key:"text",value:function Canvas_text_(textString,atPt){var style=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var ctx=this.context;var _style$color2=style.color,color=_style$color2===void 0?"black":_style$color2,_style$font=style.font,font=_style$font===void 0?"14px Arial":_style$font,_style$align=style.align,align=_style$align===void 0?"start":_style$align,_style$baseline=style.baseline,baseline=_style$baseline===void 0?"bottom":_style$baseline;ctx.save();ctx.font=font;ctx.fillStyle=color;ctx.textAlign=align;ctx.textBaseline=baseline;if(style.angle&&!isNaN(style.angle)){ctx.translate(atPt.x,atPt.y);ctx.rotate(style.angle);ctx.translate(-atPt.x,-atPt.y);}ctx.fillText(textString,atPt.x,atPt.y);ctx.restore();}},{key:"line",value:function Canvas_line_(from,to){var style=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var c=this.context;var color=style.color||"rgba(0,0,0,0.6)";var width=style.width||4;if(color.toCSSString)color=color.toCSSString();c.strokeStyle=color;c.beginPath();c.lineWidth=width;c.moveTo(from.x,from.y);c.lineTo(to.x,to.y);c.stroke();c.closePath();}},{key:"spiral",value:function Canvas_spiral_(){this.clear(__varRecorder__$1.Color.white);var start=this.innerBounds().center();var rotation=0;var stepSize=1;for(var i=0;i<150;i++){var end=start.addPt(__varRecorder__$1.Point.polar(stepSize,rotation));this.line(start,end,{color:__varRecorder__$1.Color.random()});start=end;rotation+=Math.PI/10;stepSize+=0.3;}}},{key:"rect",value:function Canvas_rect_(atPt,extent){var style=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var c=this.context;c.beginPath();c.rect(atPt.x,atPt.y,extent.x,extent.y);this.finishDraw(style);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"Canvas";}},{key:"properties",get:function get(){return{extent:{defaultValue:__varRecorder__$1.pt(200,200)},fill:{defaultValue:__varRecorder__$1.Color.transparent},contextType:{defaultValue:"2d"},preserveContents:{defaultValue:true},canvasExtent:{get:function get(){return this._canvas&&__varRecorder__$1.pt(this._canvas.width,this._canvas.height);}},pixelRatio:{derived:true,set:function set(ratio){if(this._canvas){this._canvas.width=ratio*this.width;this._canvas.height=ratio*this.height;}}},canvasBounds:{readOnly:true,get:function get(){return this._canvas&&this.canvasExtent.extentAsRectangle();}},_serializedContents:{get:function get(){return this.preserveContents&&this.toDataURI();},set:function set(s){var _this249=this;this.withContextDo(function(){return _this249.fromDataURI(s);});}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"canvas.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"lively.components",version:"0.1.0"};}},{start:233,end:8859});}(__varRecorder__$1.Morph);__varRecorder__$1.Canvas=Canvas;__varRecorder__$1.Canvas=Canvas;__varRecorder__$1.Canvas=Canvas;var __varRecorder__$2=lively.FreezerRuntime.recorderFor("MJPEGCanvas/index.js");__varRecorder__$2.Canvas=Canvas;__varRecorder__$2.string=string;__varRecorder__$2.num=num;__varRecorder__$2.arr=arr;__varRecorder__$2.promise=promise;__varRecorder__$2.resource=resource;var MJPEGCanvas=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("MJPEGCanvas/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("MJPEGCanvas")&&typeof __lively_classholder__.MJPEGCanvas==="function"?__lively_classholder__.MJPEGCanvas:__lively_classholder__.MJPEGCanvas=function MJPEGCanvas(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onLoad",value:function MJPEGCanvas_onLoad_(){var _this250=this;this.currentFrame=1;__varRecorder__$2.arr.range(0,this.maxFrames).forEach(function(i){_this250.getFrame(i);});}},{key:"test",value:function MJPEGCanvas_test_(){var _this251=this;this.animate({duration:1000,customTween:function customTween(p){_this251.drawFrame(__varRecorder__$2.num.roundTo(p*_this251.maxFrames,1));}});}},{key:"getFrame",value:function MJPEGCanvas_getFrame_(i){var _this252=this;var basePath="https://fra1.digitaloceanspaces.com/";var _varRecorder__$2$res=__varRecorder__$2.resource(basePath).join(this.animationFolder+"/frame-".concat(String(i),"-fs8.png")),url=_varRecorder__$2$res.url;if(!this._cache)this._cache={};return this._cache[url]||function(){var img=_this252._cache[url]=new window.Image();var loaded=__varRecorder__$2.promise.deferred();img.crossOrigin="Anonymous";img.src=url;img._isLoaded=loaded.promise;img.onload=function(){loaded.resolve(true);};return img;}();}},{key:"drawFrame",value:function(){var _MJPEGCanvas_drawFrame_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee242(i){var img;return regeneratorRuntime.wrap(function _callee242$(_context242){while(1){switch(_context242.prev=_context242.next){case 0:if(this.context){_context242.next=2;break;}return _context242.abrupt("return");case 2:img=this.getFrame(i);this._loadingImage=img;_context242.next=6;return img._isLoaded;case 6:if(!(this._loadingImage!=img)){_context242.next=8;break;}return _context242.abrupt("return");case 8:this.context.clearRect(0,0,this.width,this.height);this.context.drawImage(img,0,0);case 10:case"end":return _context242.stop();}}},_callee242,this);}));function MJPEGCanvas_drawFrame_(_x245){return _MJPEGCanvas_drawFrame_.apply(this,arguments);}return MJPEGCanvas_drawFrame_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"MJPEGCanvas";}},{key:"properties",get:function get(){return{maxFrames:{},progress:{derived:true,serialize:false,set:function set(p){this.drawFrame(__varRecorder__$2.num.roundTo(p*this.maxFrames,1));}},animationFolder:{},currentFrame:{type:"Number",set:function set(i){this.setProperty("currentFrame",i);this.drawFrame(i);}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"MJPEGCanvas",version:"0.1.1-57"};}},{start:190,end:1925});}(__varRecorder__$2.Canvas);MJPEGCanvas=__varRecorder__$2.MJPEGCanvas;__varRecorder__$2["default"]=MJPEGCanvas;}};});System.register("11",['./__root_module__-5782ff42.js'],function(){'use strict';var Morph,initializeClass;return{setters:[function(module){Morph=module.M;initializeClass=module.i;}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("AgencySection/index.js");__varRecorder__.Morph=Morph;var AgencySection=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("AgencySection/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("AgencySection")&&typeof __lively_classholder__.AgencySection==="function"?__lively_classholder__.AgencySection:__lively_classholder__.AgencySection=function AgencySection(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayoutOnMobile",value:function AgencySection_relayoutOnMobile_(){this.getSubmorphNamed("about agency").width=Math.min(340,this.width-50);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"AgencySection";}},{key:"properties",get:function get(){return{progress:{derived:true,set:function set(p){this.getSubmorphNamed("scrollytelling agency").progress=p;}}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"AgencySection",version:"0.1.1-12"};}},{start:56,end:405});}(__varRecorder__.Morph);AgencySection=__varRecorder__.AgencySection;__varRecorder__["default"]=AgencySection;}};});System.register("12",['./__root_module__-5782ff42.js'],function(){'use strict';var HTMLMorph,initializeClass;return{setters:[function(module){HTMLMorph=module.H;initializeClass=module.i;}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("HTMLSelfWritingText/index.js");__varRecorder__.HTMLMorph=HTMLMorph;var HTMLSelfWritingText=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("HTMLSelfWritingText/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("HTMLSelfWritingText")&&typeof __lively_classholder__.HTMLSelfWritingText==="function"?__lively_classholder__.HTMLSelfWritingText:__lively_classholder__.HTMLSelfWritingText=function HTMLSelfWritingText(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"update",value:function HTMLSelfWritingText_update_(n){this.html="\n      <span class=\"black\">".concat("WIR MACHEN".slice(0,n),"</span>\n      <span class=\"light\">").concat("INTERACTIVE".slice(0,Math.max(0,n-10)),"</span>\n      <span class=\"light\">").concat("CONTENT".slice(0,Math.max(0,n-21)),"</span>\n    ");}},{key:"typeOut",value:function(){var _HTMLSelfWritingText_typeOut_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee243(){var ts,i;return regeneratorRuntime.wrap(function _callee243$(_context243){while(1){switch(_context243.prev=_context243.next){case 0:i=0;case 1:if(!(i<29)){_context243.next=12;break;}this.update(i);ts=Date.now();case 4:if(!(Date.now()-ts<80)){_context243.next=9;break;}_context243.next=7;return this.whenRendered();case 7:_context243.next=4;break;case 9:i++;_context243.next=1;break;case 12:case"end":return _context243.stop();}}},_callee243,this);}));function HTMLSelfWritingText_typeOut_(){return _HTMLSelfWritingText_typeOut_.apply(this,arguments);}return HTMLSelfWritingText_typeOut_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"HTMLSelfWritingText";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"HTMLSelfWritingText",version:"0.1.1-11"};}},{start:74,end:627});}(__varRecorder__.HTMLMorph);HTMLSelfWritingText=__varRecorder__.HTMLSelfWritingText;__varRecorder__["default"]=HTMLSelfWritingText;}};});System.register("13",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./services-bc1b0444.js','./index-a3af1ede.js','./index-83723532.js','./index-6da14585.js'],function(){'use strict';return{setters:[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){}};});System.register("14",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./index-6da14585.js'],function(){'use strict';var Morph,touchInputDevice,pt,Point,Color,arr,num,initializeClass;return{setters:[function(module){Morph=module.M;touchInputDevice=module.t;pt=module.p;Point=module.g;Color=module.C;arr=module.k;num=module.n;initializeClass=module.i;},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("SnakeGame/index.js");__varRecorder__.Morph=Morph;__varRecorder__.touchInputDevice=touchInputDevice;__varRecorder__.pt=pt;__varRecorder__.Point=Point;__varRecorder__.Color=Color;__varRecorder__.arr=arr;__varRecorder__.num=num;var SnakeGame=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("SnakeGame/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("SnakeGame")&&typeof __lively_classholder__.SnakeGame==="function"?__lively_classholder__.SnakeGame:__lively_classholder__.SnakeGame=function SnakeGame(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"getDeltaPoint",value:function SnakeGame_getDeltaPoint_(){var vSteps=22;var hSteps=40;var vd=this.height/vSteps;var hd=this.width/hSteps;return __varRecorder__.pt(hd,vd);}},{key:"getPoints",value:function SnakeGame_getPoints_(){var vSteps=22;var hSteps=40;var vd=this.height/vSteps;var hd=this.width/hSteps;var x=0;var y=0;var points=[];for(var j=0;j<=2*vSteps;j++){x=j%2==0?hd/2:hd/2;for(var i=0;i<=hSteps;i++){points.push(__varRecorder__.pt(x,y));x+=hd;}y+=vd/2;}return points;}},{key:"onMouseMove",value:function SnakeGame_onMouseMove_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseMove",this).call(this,evt);this.collectHoveredPoints(evt.positionIn(this));}},{key:"collectHoveredPoints",value:function SnakeGame_collectHoveredPoints_(pos){var points=this.getPoints();var closestPoint=__varRecorder__.arr.min(points,function(p){return p.dist(pos);});var path=this.get("mouse trajectory");var maxLength=100;this.get("indicator").center=closestPoint;if(!this._last10Points)this._last10Points=[];if(!this._last10Points.find(function(p){return p.equals(closestPoint);})){this._last10Points.push(closestPoint);}if(this._last10Points.length>maxLength)this._last10Points.splice(0,this._last10Points.length-maxLength);path.position=__varRecorder__.pt(0,0);path.vertices=this._last10Points;path.borderColor=this.getNextColorShade();}},{key:"getNextColorShade",value:function SnakeGame_getNextColorShade_(){var colorsToMorph=[__varRecorder__.Color.rgb(241,101,119),__varRecorder__.Color.rgb(56,227,144),__varRecorder__.Color.rgb(98,179,209)];if(!this._lastInterpolationStep||this._lastInterpolationStep>999)this._lastInterpolationStep=1;else this._lastInterpolationStep++;var p=this._lastInterpolationStep%333/333;var firstColorIndex=Math.min(colorsToMorph.length-1,Math.floor(this._lastInterpolationStep/333));var secondColorIndex=firstColorIndex<colorsToMorph.length-1?firstColorIndex+1:0;return colorsToMorph[firstColorIndex].interpolate(p,colorsToMorph[secondColorIndex]);}},{key:"startRandomWalk",value:function SnakeGame_startRandomWalk_(){var path=this.get("predefined path");this.pathPoints=__varRecorder__.arr.range(0,250).map(function(i){return path.getPointOnPath(i/250);});this.startStepping(50,"randomWalk");}},{key:"randomWalk",value:function SnakeGame_randomWalk_(){var p=(this.pathPoints=__varRecorder__.arr.rotate(this.pathPoints))[0];this.collectHoveredPoints(p.addPt(this.get("predefined path").position));}},{key:"stopRandomWalk",value:function SnakeGame_stopRandomWalk_(){this.stopStepping();}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"SnakeGame";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"SnakeGame",version:"0.1.1-98"};}},{start:184,end:3000});}(__varRecorder__.Morph);SnakeGame=__varRecorder__.SnakeGame;__varRecorder__["default"]=SnakeGame;}};});System.register("15",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./index-6da14585.js'],function(){'use strict';var Morph,num,pt,initializeClass,Image,easings,arr;return{setters:[function(module){Morph=module.M;num=module.n;pt=module.p;initializeClass=module.i;Image=module.j;easings=module.e;arr=module.k;},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("AboutSection/index.js");__varRecorder__.Morph=Morph;__varRecorder__.num=num;__varRecorder__.pt=pt;var AboutSection=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("AboutSection/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("AboutSection")&&typeof __lively_classholder__.AboutSection==="function"?__lively_classholder__.AboutSection:__lively_classholder__.AboutSection=function AboutSection(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"relayout",value:function AboutSection_relayout_(){var game=this.get("block game");var about=this.get("about explaination");about.width=Math.min(360,this.width-80);this.layout.align=this.width<700?"left":"center";game.scale=Math.min(2,this.width/350);game.bottomRight=this.innerBounds().insetBy(50).bottomRight().minPt(__varRecorder__.pt(700,Infinity));if(game.left<0)game.left=0;}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"AboutSection";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"AboutSection",version:"0.1.1-29"};}},{start:147,end:591});}(__varRecorder__.Morph);AboutSection=__varRecorder__.AboutSection;__varRecorder__["default"]=AboutSection;var __varRecorder__$1=lively.FreezerRuntime.recorderFor("DraggableBlock/index.js");__varRecorder__$1.Image=Image;__varRecorder__$1.easings=easings;__varRecorder__$1.arr=arr;__varRecorder__$1.pt=pt;var DraggableBlock=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("DraggableBlock/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("DraggableBlock")&&typeof __lively_classholder__.DraggableBlock==="function"?__lively_classholder__.DraggableBlock:__lively_classholder__.DraggableBlock=function DraggableBlock(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onDragStart",value:function(){var _DraggableBlock_onDragStart_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee244(evt){return regeneratorRuntime.wrap(function _callee244$(_context244){while(1){switch(_context244.prev=_context244.next){case 0:initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onDragStart",this).call(this,evt);_context244.next=3;return this.removeFromGrid();case 3:evt.state.dragStartMorphPosition=_context244.sent;case 4:case"end":return _context244.stop();}}},_callee244,this);}));function DraggableBlock_onDragStart_(_x246){return _DraggableBlock_onDragStart_.apply(this,arguments);}return DraggableBlock_onDragStart_;}()},{key:"removeFromGrid",value:function(){var _DraggableBlock_removeFromGrid_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee245(){var localizedPosition;return regeneratorRuntime.wrap(function _callee245$(_context245){while(1){switch(_context245.prev=_context245.next){case 0:localizedPosition=this.owner.owner.localizePointFrom(__varRecorder__$1.pt(0,0),this);this.owner.owner.addMorph(this);this.position=localizedPosition;this._removed=true;return _context245.abrupt("return",localizedPosition);case 5:case"end":return _context245.stop();}}},_callee245,this);}));function DraggableBlock_removeFromGrid_(){return _DraggableBlock_removeFromGrid_.apply(this,arguments);}return DraggableBlock_removeFromGrid_;}()},{key:"snapBack",value:function(){var _DraggableBlock_snapBack_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee246(){return regeneratorRuntime.wrap(function _callee246$(_context246){while(1){switch(_context246.prev=_context246.next){case 0:_context246.next=2;return this.snapToNearestBox();case 2:this.animate({scale:1,position:__varRecorder__$1.pt(0,0),easing:__varRecorder__$1.easings.outExpo,duration:300});case 3:case"end":return _context246.stop();}}},_callee246,this);}));function DraggableBlock_snapBack_(){return _DraggableBlock_snapBack_.apply(this,arguments);}return DraggableBlock_snapBack_;}()},{key:"onDrag",value:function DraggableBlock_onDrag_(evt){if(this._removed){var _evt$state4=evt.state,dragStartMorphPosition=_evt$state4.dragStartMorphPosition,absDragDelta=_evt$state4.absDragDelta;var globalTransform=this.getGlobalTransform();this.position=dragStartMorphPosition.addPt(globalTransform.inverse().transformDirection(absDragDelta));}}},{key:"snapToNearestBox",value:function(){var _DraggableBlock_snapToNearestBox_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee247(){var _this253=this;var closest;return regeneratorRuntime.wrap(function _callee247$(_context247){while(1){switch(_context247.prev=_context247.next){case 0:closest=__varRecorder__$1.arr.min(this.owner.getAllNamed(/frame/).filter(function(m){return m.submorphs.length==0;}),function(frame){return frame.center.dist(_this253.center);});_context247.next=3;return this.animate({topRight:this.owner.localizePointFrom(__varRecorder__$1.pt(43,10),closest),duration:300,easing:__varRecorder__$1.easings.inExpo});case 3:closest.addMorph(this);case 4:case"end":return _context247.stop();}}},_callee247,this);}));function DraggableBlock_snapToNearestBox_(){return _DraggableBlock_snapToNearestBox_.apply(this,arguments);}return DraggableBlock_snapToNearestBox_;}()},{key:"onDragEnd",value:function(){var _DraggableBlock_onDragEnd_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee248(evt){return regeneratorRuntime.wrap(function _callee248$(_context248){while(1){switch(_context248.prev=_context248.next){case 0:this._removed=false;initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onDragEnd",this).call(this,evt);this.snapBack();case 3:case"end":return _context248.stop();}}},_callee248,this);}));function DraggableBlock_onDragEnd_(_x247){return _DraggableBlock_onDragEnd_.apply(this,arguments);}return DraggableBlock_onDragEnd_;}()},{key:"illustrateDrag",value:function(){var _DraggableBlock_illustrateDrag_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee249(){return regeneratorRuntime.wrap(function _callee249$(_context249){while(1){switch(_context249.prev=_context249.next){case 0:if(!this._simulated){_context249.next=2;break;}return _context249.abrupt("return");case 2:this._simulated=true;_context249.next=5;return this.removeFromGrid();case 5:_context249.next=7;return this.animate({duration:2000,position:this.position.subPt(__varRecorder__$1.pt(160,-40))});case 7:_context249.next=9;return this.snapBack();case 9:case"end":return _context249.stop();}}},_callee249,this);}));function DraggableBlock_illustrateDrag_(){return _DraggableBlock_illustrateDrag_.apply(this,arguments);}return DraggableBlock_illustrateDrag_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"DraggableBlock";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"DraggableBlock",version:"0.1.1-39"};}},{start:156,end:1970});}(__varRecorder__$1.Image);DraggableBlock=__varRecorder__$1.DraggableBlock;__varRecorder__$1["default"]=DraggableBlock;}};});System.register("16",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./services-bc1b0444.js','./index-a3af1ede.js'],function(){'use strict';return{setters:[function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){}};});System.register("17",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage'],function(){'use strict';return{setters:[function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){}};});System.register("18",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage'],function(){'use strict';return{setters:[function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){}};});System.register("19",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage'],function(){'use strict';var InteractiveMorph,Color,easings,initializeClass;return{setters:[function(module){InteractiveMorph=module.I;Color=module.C;easings=module.e;initializeClass=module.i;},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("ReferenceButton/index.js");__varRecorder__.InteractiveMorph=InteractiveMorph;__varRecorder__.Color=Color;__varRecorder__.easings=easings;var ReferenceButton=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("ReferenceButton/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ReferenceButton")&&typeof __lively_classholder__.ReferenceButton==="function"?__lively_classholder__.ReferenceButton:__lively_classholder__.ReferenceButton=function ReferenceButton(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onMouseUp",value:function ReferenceButton_onMouseUp_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseUp",this).call(this,evt);if(lively.FreezerRuntime)document.location=this.link;}},{key:"toggleClick",value:function ReferenceButton_toggleClick_(active){var _this254=this;var duration=300;var easing=__varRecorder__.easings.inOutExpo;if(active&&this.ui.buttenSurface.fill.equals(this.fill))return;if(!active&&this.ui.buttenSurface.fill.equals(__varRecorder__.Color.white))return;this.withAnimationDo(function(){_this254.ui.hoveredImg.opacity=active?1:0;_this254.ui.defaultImg.opacity=active?0:1;_this254.ui.buttenSurface.fill=active?_this254.hoverColor||_this254.fill:__varRecorder__.Color.white;_this254.ui.innerFill.fill=active?_this254.hoverColor||_this254.fill:__varRecorder__.Color.white;_this254.ui.buffer.height=active?0:7;_this254.bottom=_this254.bottom+(active?14:-14)*_this254.scale;},{duration:duration,easing:easing});}},{key:"onHoverIn",value:function ReferenceButton_onHoverIn_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onHoverIn",this).call(this,evt);this.toggleClick(true);}},{key:"onHoverOut",value:function ReferenceButton_onHoverOut_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onHoverOut",this).call(this,evt);this.toggleClick(false);}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ReferenceButton";}},{key:"properties",get:function get(){return{hoverColor:{},link:{}};}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"ReferenceButton",version:"0.1.1-62"};}},{start:189,end:1453});}(__varRecorder__.InteractiveMorph);ReferenceButton=__varRecorder__.ReferenceButton;__varRecorder__["default"]=ReferenceButton;}};});System.register("20",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage','./services-bc1b0444.js','./index-a3af1ede.js'],function(){'use strict';var Morph,easings,pt,initializeClass;return{setters:[function(module){Morph=module.M;easings=module.e;pt=module.p;initializeClass=module.i;},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){var __varRecorder__=lively.FreezerRuntime.recorderFor("ContactSection/index.js");__varRecorder__.Morph=Morph;__varRecorder__.easings=easings;__varRecorder__.pt=pt;var ContactSection=function(superclass){var __lively_classholder__=lively.FreezerRuntime.recorderFor("ContactSection/index.js");var __lively_class__=__lively_classholder__.hasOwnProperty("ContactSection")&&typeof __lively_classholder__.ContactSection==="function"?__lively_classholder__.ContactSection:__lively_classholder__.ContactSection=function ContactSection(__first_arg__){if(__first_arg__&&__first_arg__[Symbol["for"]("lively-instance-restorer")]);else{this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments);}};return initializeClass(__lively_class__,superclass,[{key:"onMouseDown",value:function ContactSection_onMouseDown_(evt){initializeClass._get(Object.getPrototypeOf(__lively_class__.prototype),"onMouseDown",this).call(this,evt);if(evt.targetMorph.name=="open contact form button"){this.openContactForm();}if(evt.targetMorph.name=="close contact form button"){this.closeContactForm();}}},{key:"relayout",value:function ContactSection_relayout_(){this.get("tiling wrapper").width=this.width;this.get("contact info").width=Math.min(this.width-80,400);this.get("contact form").width=Math.min(this.width-50,1000);}},{key:"openContactForm",value:function(){var _ContactSection_openContactForm_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee250(){var _this255=this;var contactForm,openButton;return regeneratorRuntime.wrap(function _callee250$(_context250){while(1){switch(_context250.prev=_context250.next){case 0:contactForm=this.get("contact form");openButton=this.get("open contact form button");contactForm.scale=openButton.height/contactForm.height;contactForm.topCenter=this.localizePointFrom(openButton.topCenter,openButton.owner);contactForm.opacity=0;contactForm.reactsToPointer=true;this.clipMode="visible";contactForm.animate({scale:1,duration:300,easing:__varRecorder__.easings.inOutExpo});_context250.next=10;return this.withAnimationDo(function(){openButton.opacity=0;contactForm.topCenter=__varRecorder__.pt(_this255.width/2,100);contactForm.opacity=1;},{duration:300,easing:__varRecorder__.easings.inOutExpo});case 10:contactForm.resizeTextAreas();case 11:case"end":return _context250.stop();}}},_callee250,this);}));function ContactSection_openContactForm_(){return _ContactSection_openContactForm_.apply(this,arguments);}return ContactSection_openContactForm_;}()},{key:"closeContactForm",value:function(){var _ContactSection_closeContactForm_=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee251(){var _this256=this;var contactForm,openButton;return regeneratorRuntime.wrap(function _callee251$(_context251){while(1){switch(_context251.prev=_context251.next){case 0:contactForm=this.get("contact form");openButton=this.get("open contact form button");contactForm.animate({scale:openButton.height/contactForm.height,duration:300,easing:__varRecorder__.easings.inOutExpo});_context251.next=5;return this.withAnimationDo(function(){openButton.opacity=1;contactForm.topCenter=_this256.localizePointFrom(openButton.topCenter,openButton.owner);contactForm.opacity=0;},{duration:300,easing:__varRecorder__.easings.inOutExpo});case 5:contactForm.reactsToPointer=false;contactForm.scale=1;contactForm.topCenter=__varRecorder__.pt(this.width/2,0);this.clipMode="hidden";case 9:case"end":return _context251.stop();}}},_callee251,this);}));function ContactSection_closeContactForm_(){return _ContactSection_closeContactForm_.apply(this,arguments);}return ContactSection_closeContactForm_;}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function get(){return"ContactSection";}}],__lively_classholder__,{pathInPackage:function pathInPackage(){return"index.js";},unsubscribeFromToplevelDefinitionChanges:function unsubscribeFromToplevelDefinitionChanges(){return function(){};},subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){return function(){};},"package":function _package(){return{name:"ContactSection",version:"0.1.1-33"};}},{start:112,end:2158});}(__varRecorder__.Morph);ContactSection=__varRecorder__.ContactSection;__varRecorder__["default"]=ContactSection;}};});System.register("21",['./__root_module__-5782ff42.js','lively.ast','lively.vm','babel-plugin-transform-jsx','lively.modules','lively.storage'],function(){'use strict';return{setters:[function(){},function(){},function(){},function(){},function(){},function(){}],execute:function execute(){}};});
