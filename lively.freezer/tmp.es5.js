function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}function _toArray2(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableRest();}function _toConsumableArray2(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e3){throw _e3;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]();},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e4){didErr=true;err=_e4;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _get2(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get2=Reflect.get;}else{_get2=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver);}return desc.value;};}return _get2(target,property,receiver||target);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof2(call)==="object"||typeof call==="function")){return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _slicedToArray2(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _typeof2(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof2=function _typeof2(obj){return typeof obj;};}else{_typeof2=function _typeof2(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof2(obj);}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"])_i["return"]();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError("Invalid attempt to destructure non-iterable instance");}};}();var _typeof=typeof Symbol==="function"&&_typeof2(Symbol.iterator)==="symbol"?function(obj){return _typeof2(obj);}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj);};function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr);}(/*global self,global,System*/ /*

Code in here will not be directly executed but stringified and embedded in bundles!

*/function runtimeDefinition(){var G=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:this;if(_typeof(G.lively)!=="object")G.lively={};function prepareGlobal(moduleName,exports,globals,encapsulate){// disable module detection
var curDefine=G.define;G.define=undefined;// set globals
var oldGlobals;if(globals){oldGlobals={};for(var g in globals){oldGlobals[g]=G[g];G[g]=globals[g];}}// store a complete copy of the global object in order to detect changes
if(!exports){globalSnapshot={};forEachGlobalValue(function(name,value){globalSnapshot[name]=value;});}// return function to retrieve global
return function(){var globalValue=exports?getGlobalValue(exports):{};var singleGlobal;var multipleExports=!!exports;if(!exports||encapsulate)forEachGlobalValue(function(name,value){if(globalSnapshot[name]===value)return;if(typeof value=='undefined')return;// allow global encapsulation where globals are removed
if(encapsulate)G[name]=undefined;if(!exports){globalValue[name]=value;if(typeof singleGlobal!='undefined'){if(!multipleExports&&singleGlobal!==value)multipleExports=true;}else{singleGlobal=value;}}});globalValue=multipleExports?globalValue:singleGlobal;// revert globals
if(oldGlobals){for(var g in oldGlobals){G[g]=oldGlobals[g];}}G.define=curDefine;return globalValue;};}G.prepareGlobal=prepareGlobal;// set as global
var version,registry={},globalModules={},globalSnapshot={};// bare minimum ignores from SystemJS
var ignoredGlobalProps=['_g','sessionStorage','localStorage','clipboardData','frames','frameElement','external','mozAnimationStartTime','webkitStorageInfo','webkitIndexedDB','mozInnerScreenY','mozInnerScreenX'];// taken from SystemJS
function forEachGlobal(callback){if(Object.keys)Object.keys(G).forEach(callback);else for(var g in G){if(!Object.hasOwnProperty.call(G,g))continue;callback(g);}};function forEachGlobalValue(callback){forEachGlobal(function(globalName){var value;if(ignoredGlobalProps.indexOf(globalName)!=-1)return;try{value=G[globalName];}catch(e){ignoredGlobalProps.push(globalName);}callback(globalName,value);});};function readMemberExpression(p,value){var pParts=p.split('.');while(pParts.length){value=value[pParts.shift()];}return value;}function getGlobalValue(exports){if(typeof exports=='string')return readMemberExpression(exports,G);if(!(exports instanceof Array))throw new Error('Global exports must be a string or array.');var globalValue={};var first=true;for(var i=0;i<exports.length;i++){var val=readMemberExpression(exports[i],G);if(first){globalValue['default']=val;first=false;}globalValue[exports[i].split('.').pop()]=val;}return globalValue;}if(G.lively.FreezerRuntime){var _version$split$map=version.split(".").map(Number),_version$split$map2=_slicedToArray(_version$split$map,3),myMajor=_version$split$map2[0],myMinor=_version$split$map2[1],myPatch=_version$split$map2[2],_G$lively$FreezerRunt=G.lively.FreezerRuntime.version.split(".").map(Number),_G$lively$FreezerRunt2=_slicedToArray(_G$lively$FreezerRunt,3),otherMajor=_G$lively$FreezerRunt2[0],otherMinor=_G$lively$FreezerRunt2[1],otherPatch=_G$lively$FreezerRunt2[2],update=false;if(isNaN(otherMajor)||!isNaN(myMajor)&&myMajor>otherMajor)update=true;if(!update&&(isNaN(otherMinor)||!isNaN(myMinor)&&myMinor>otherMinor))update=true;if(!update&&(isNaN(otherPatch)||!isNaN(myPatch)&&myPatch>otherPatch))update=true;if(!update)return;registry=G.lively.FreezerRuntime.registry;}globalModules["@lively-env"]={executed:true,options:{},// this is for lively.serializer2 locateClass()
moduleEnv:function moduleEnv(id){var m=System.get(id,false)||System.fetchStandaloneFor(id)||System.get(id+'index.js',false);return{recorder:m.recorder||m.exports};}};globalModules["@system-env"]={executed:true,browser:true};var loc=G.document&&G.document.location.href.split('?')[0];if(loc&&loc.endsWith('.html')){// ensure we do not point to a html file
loc=loc.split('/').slice(0,-1).join('/')+'/';}G.lively.FreezerRuntime={global:G,location:loc,baseURL:G.System?G.System.baseURL:loc,version:version,registry:registry,globalModules:globalModules,get:function get(moduleId){var recorder=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(moduleId&&moduleId.startsWith('@'))return this.globalModules[moduleId];var mod=this.registry[moduleId];return recorder?mod&&mod.recorder:mod;},set:function set(moduleId,module){return this.registry[moduleId]=module;},add:function add(id){var dependencies=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var exports=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var executed=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var module={id:id,dependencies:dependencies,executed:executed,exports:exports,execute:function execute(){},setters:[],subscribeToToplevelDefinitionChanges:function subscribeToToplevelDefinitionChanges(){},"package":function _package(){}};this.set(id,module);return module;},decanonicalize:function decanonicalize(name){if(name.endsWith('.json'))return G.lively.resources.resource(G.origin).join(name).url;if(!name.endsWith('.js')&&!name.endsWith('/'))// just import via package name
return name.split('/').concat(['index.js']).filter(Boolean).join('/');return name;// this decanonicalize forces all modules to contain version numbers (if not provided)
// and to start with the local:// prefix.
// This only applies to modules, that is all .js file that are requested in this context.
// assets such as .css files etc, keep their usual decanonicalization
// is global id?
if(G.lively.FreezerRuntime.globalModules[name])return name;// check if this is a submodule of a global module, that can be 
var localName=name.replace("lively-object-modules/","").replace(G.System.baseURL,'');// includes local prefix?
localName=localName.includes('local://')?localName:'local://'+localName;// includes package version? 
// this fucks up if there are packages wich share a prefix in their naming
if(!localName.match(/\@\S*\//)){(function(){var _localName$replace$sp=localName.replace('local://','').split('/'),_localName$replace$sp2=_toArray(_localName$replace$sp),packageName=_localName$replace$sp2[0],rest=_localName$replace$sp2.slice(1),pkg=Object.keys(G.lively.FreezerRuntime.registry).find(function(k){return k.replace('local://','').split('@')[0]==packageName;}),version=pkg&&pkg.match(/\@[\d|\.|\-|\~]*\//)[0];//if (!pkg) return proceed(name, parent, isPlugin);
// return pkg;
localName="local://"+packageName+version+rest;})();}return localName;},loadObjectFromPartsbinFolder:function loadObjectFromPartsbinFolder(name){var location=this.location;var r=G.lively.resources.resource(location);if(!r.isDirectory())r=r.parent();return r.join("dynamicParts/"+name+".json").readJson().then(function(snapshot){return G.lively.morphic.loadMorphFromSnapshot(snapshot,{onDeserializationStart:false,migrations:[]});});},fetchStandaloneFor:function fetchStandaloneFor(name){for(var glob in this.globalModules){if(name.match(glob.replace("local://","").replace(/\@.*\//,"/").replace("/index.js","")))return this.globalModules[glob];}},resolveSync:function resolveSync(name,parentName){var mod=this.get(name);if(mod)return mod;// try global
if(!name.includes("/")){var parts=name.split("."),_obj=G;while(_obj&&parts.length){_obj=_obj[parts.shift()];}if(_obj)return{executed:true,exports:_obj,dependencies:[]};}var obj=this.get(this.decanonicalize(name,parentName));if(obj)return{executed:true,exports:obj,dependencies:[]};mod=this.fetchStandaloneFor(name);if(mod)return mod;throw new Error("Module "+name+" cannot be found in lively.freezer bundle!");},"import":function _import(id){return Promise.resolve(this.registry[id]?this.registry[id].exports:{});},register:function register(id,dependencies,defineFn){var module=this.add(id,dependencies),body=defineFn(function(name,val){if(typeof name==="string"){module.exports[name]=val;}else{// * export
var prevExports={};for(var key in module.exports){prevExports[key]=module.exports[key];}module.exports=name;for(var _key in prevExports){if(!module.exports[_key])module.exports[_key]=prevExports[_key];}}});module.execute=body.execute;module.setters=body.setters;// how to actually propagate module information inside system?
// window.System._loader.modules[id] = {module: module.exports};
return module;},updateImports:function updateImports(module){if(!module.dependencies)return;for(var i=0;i<module.dependencies.length;i++){var depName=module.dependencies[i],mod=depName!='@empty'&&this.resolveSync(depName,module.id);mod&&module.setters[i](mod.exports);}},updateDependent:function updateDependent(module,dependentModule){for(var i=0;i<dependentModule.dependencies.length;i++){var depName=dependentModule.dependencies[i];if(depName!='@empty'&&module==this.resolveSync(depName,dependentModule.id)){dependentModule.setters[i](module.exports);}}},computeUniqDepGraphs:function computeUniqDepGraphs(depGraph){var dependencies=[],remainingSeen={},uniqDepGraph={"@empty":[]},inverseDepGraph={"@empty":[]};if(!depGraph){var g={},r=lively.FreezerRuntime.registry;for(var modName in r){g[modName]=r[modName].dependencies;}depGraph=g;}for(var key in depGraph){if(!remainingSeen.hasOwnProperty(key)){remainingSeen[key]=true;dependencies.push(key);}var deps=depGraph[key],uniqDeps={};if(deps){uniqDepGraph[key]=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=deps[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var dep=_step.value;if(uniqDeps.hasOwnProperty(dep)||key===dep)continue;var inverse=inverseDepGraph[dep]||(inverseDepGraph[dep]=[]);if(!inverse.includes(key))inverse.push(key);uniqDeps[dep]=true;uniqDepGraph[key].push(dep);if(!remainingSeen.hasOwnProperty(dep)){remainingSeen[dep]=true;dependencies.push(dep);}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]();}}finally{if(_didIteratorError){throw _iteratorError;}}}}}return{uniqDepGraph:uniqDepGraph,inverseDepGraph:inverseDepGraph,dependencies:dependencies};},sortForLoad:function sortForLoad(entry){var debug=false;// establish unique list of keys
var _computeUniqDepGraphs=this.computeUniqDepGraphs(),remaining=_computeUniqDepGraphs.dependencies,uniqDepGraph=_computeUniqDepGraphs.uniqDepGraph,inverseDepGraph=_computeUniqDepGraphs.inverseDepGraph,groups=[],packages={},moduleId;function getPackageName(m){return m.split('/')[0];}function getPackageRefs(m){return(uniqDepGraph[moduleId]||[]).filter(function(m){return!isGlobalModule(m);}).map(function(d){return getPackageName(d);});}function isGlobalModule(m){return m=='@empty'||!!lively.FreezerRuntime.globalModules[m];}// this should just be pre computed once for each package
function reachable(m,id){var seen=arguments.length>2&&arguments[2]!==undefined?arguments[2]:new Set();if(m==id)return true;if(uniqDepGraph[m]){return uniqDepGraph[m].includes(id)||uniqDepGraph[m].some(function(m){return!seen.has(m)&&reachable(m,id,new Set([].concat(_toConsumableArray(seen),_toConsumableArray(uniqDepGraph[m]))));});}return false;}for(var _i=remaining.length;_i--;){moduleId=remaining[_i];if(isGlobalModule(moduleId)){// 0.) exclude all global modules
groups.push(moduleId);}else{// 1.) identify packages
var _packageId=getPackageName(moduleId);// only add module to package, if reachable from index.js
if(!reachable(_packageId+'/index.js',moduleId))continue;if(packages[_packageId]){var _packages$_packageId$;packages[_packageId].modules.push(moduleId);(_packages$_packageId$=packages[_packageId].deps).push.apply(_packages$_packageId$,_toConsumableArray(getPackageRefs(moduleId)));}else{packages[_packageId]={modules:[moduleId],deps:getPackageRefs(moduleId)};}}remaining.splice(_i,1);}var detachedModules=remaining;// these are modules part of a package, yet not reachable via index;
// free floating modules are worth excluding at this stage, since they can confuse the static load order for packages
debug&&console.log('unreachable from package index: ',detachedModules);// 2.) try to order package partitions such that their dependencies are satisfied
for(var p in packages){packages[p].deps=new Set(packages[p].deps.filter(function(d){return d!=p;}));}debug&&console.log('Identified packages: ',packages);function haveBeenDeclared(deps){for(var _len=arguments.length,declared=Array(_len>1?_len-1:0),_key2=1;_key2<_len;_key2++){declared[_key2-1]=arguments[_key2];}return deps.filter(function(dep){return dep!='@empty'&&!dep.includes('/index.js');}).every(function(d){return declared.some(function(dcls){return dcls.includes(d);});});}remaining=Object.keys(packages);var orderedPackages=[];while(remaining.length){var minDepCount=Infinity,minKeys=[],minKeyIndexes=[],affectedKeys=[];for(var i=0;i<remaining.length;i++){var key=remaining[i];var deps=[].concat(_toConsumableArray(packages[key].deps));if(deps.length>minDepCount)continue;if(deps.length===minDepCount&&haveBeenDeclared(deps,orderedPackages,minKeys)){minKeys.push(key);minKeyIndexes.push(i);continue;}minDepCount=deps.length;if(!haveBeenDeclared(deps,orderedPackages,minKeys))continue;minKeys=[key];minKeyIndexes=[i];}if(minKeys.length==0)break;// this means that the remaining modules contain a cycle somewhere
for(var i=minKeyIndexes.length;i--;){var key=remaining[minKeyIndexes[i]];remaining.splice(minKeyIndexes[i],1);}orderedPackages.push.apply(orderedPackages,_toConsumableArray(minKeys));}debug&&console.log('could not sort: ',remaining);var unsortablePackages=remaining;// the remaining packages will be sorted by breaking up package bounds together with the non reachable packages
//orderedPackages.push(...remaining);
debug&&console.log('Sorting Packages in order: ',orderedPackages);// 3.) sort packages in isolation
// for each iteration find the keys with the minimum number of dependencies
// and add them to the result group list
var packageModules;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=orderedPackages[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var packageId=_step2.value;packageModules=packages[packageId].modules;while(packageModules.length){var minDepCount=Infinity,minKeys=[],minKeyIndexes=[],affectedKeys=[];for(var i=0;i<packageModules.length;i++){var key=packageModules[i];var _deps2=uniqDepGraph[key]||[];if(_deps2.length>minDepCount)continue;if(_deps2.length===minDepCount&&haveBeenDeclared(_deps2,groups,minKeys)){var _affectedKeys2;minKeys.push(key);minKeyIndexes.push(i);(_affectedKeys2=affectedKeys).push.apply(_affectedKeys2,_toConsumableArray(inverseDepGraph[key]||[]));continue;}minDepCount=_deps2.length;if(!haveBeenDeclared(_deps2,groups,minKeys))continue;minKeys=[key];minKeyIndexes=[i];affectedKeys=(inverseDepGraph[key]||[]).slice();}if(minKeys.length==0)break;// this means that the remaining modules contain a cycle somewhere
for(var i=minKeyIndexes.length;i--;){var key=packageModules[minKeyIndexes[i]];inverseDepGraph[key]=[];packageModules.splice(minKeyIndexes[i],1);}var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=affectedKeys[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var key=_step5.value;uniqDepGraph[key]=uniqDepGraph[key].filter(function(ea){return!minKeys.includes(ea);});}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]){_iterator5["return"]();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}groups.push.apply(groups,_toConsumableArray(minKeys));}debug&&console.log(packageId+' could not order modules ',packageModules);groups.push.apply(groups,_toConsumableArray(packageModules));// insert them anyway and let async load hanlde those things later in the game
}// return groups;
// 4.) attempt to sort the unsortable packages together with the free standing modules
// var groups = [];
// 
// function haveBeenDeclared(deps, ...declared) {
//   return deps.every(d => declared.some(dcls => dcls.includes(d)))
// }
// 
}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]){_iterator2["return"]();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}remaining=detachedModules;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=unsortablePackages[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var _remaining;var packageId=_step3.value;(_remaining=remaining).push.apply(_remaining,_toConsumableArray(packages[packageId].modules));}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]){_iterator3["return"]();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}debug&&console.log('sorting remaining: ',remaining);while(remaining.length){var minDepCount=Infinity,minKeys=[],minKeyIndexes=[],affectedKeys=[];for(var i=0;i<remaining.length;i++){var key=remaining[i];var _deps=uniqDepGraph[key]||[];if(_deps.length>minDepCount)continue;if(_deps.length===minDepCount&&haveBeenDeclared(_deps,groups,minKeys)){var _affectedKeys;minKeys.push(key);minKeyIndexes.push(i);(_affectedKeys=affectedKeys).push.apply(_affectedKeys,_toConsumableArray(inverseDepGraph[key]||[]));continue;}minDepCount=_deps.length;if(!haveBeenDeclared(_deps,groups,minKeys))continue;minKeys=[key];minKeyIndexes=[i];affectedKeys=(inverseDepGraph[key]||[]).slice();}if(minKeys.length==0)break;// this means that the remaining modules contain a cycle somewhere
for(var i=minKeyIndexes.length;i--;){var key=remaining[minKeyIndexes[i]];inverseDepGraph[key]=[];remaining.splice(minKeyIndexes[i],1);}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=affectedKeys[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var key=_step4.value;uniqDepGraph[key]=uniqDepGraph[key].filter(function(ea){return!minKeys.includes(ea);});}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]){_iterator4["return"]();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}groups.push.apply(groups,_toConsumableArray(minKeys));}debug&&console.log('totally unsortable and probably cyclic: ',remaining);var asyncModules=[];for(var _key3 in groups){if((uniqDepGraph[_key3]||[]).length)asyncModules.push(_key3);}console.log('async modules due to preserved module structures: ',[].concat(asyncModules,_toConsumableArray(remaining)));return[groups,remaining];},initializeClass:function initializeClass(constructorFunc,superclassSpec){var instanceMethods=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var classMethods=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var classHolder=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var currentModule=arguments[5];var sourceLoc=arguments[6];if(typeof superclassSpec=='undefined')throw Error('Superclass can not be undefined!');G.System.initializeClass._get=G.lively.classes.runtime.initializeClass._get;G.System.initializeClass._set=G.lively.classes.runtime.initializeClass._set;return lively.classes.runtime.initializeClass(constructorFunc,superclassSpec,instanceMethods,classMethods,classHolder,currentModule,sourceLoc);},prepareGlobal:function prepareGlobal(moduleName,exports,globals,encapsulate){// disable module detection
var curDefine=G.define;G.define=undefined;// set globals
var oldGlobals;if(globals){oldGlobals={};for(var g in globals){oldGlobals[g]=G[g];G[g]=globals[g];}}// store a complete copy of the global object in order to detect changes
if(!exports){globalSnapshot={};forEachGlobalValue(function(name,value){globalSnapshot[name]=value;});}// return function to retrieve global
return function(){var globalValue=exports?getGlobalValue(exports):{};var singleGlobal;var multipleExports=!!exports;if(!exports||encapsulate)forEachGlobalValue(function(name,value){if(globalSnapshot[name]===value)return;if(typeof value=='undefined')return;// allow global encapsulation where globals are removed
if(encapsulate)G[name]=undefined;if(!exports){globalValue[name]=value;if(typeof singleGlobal!='undefined'){if(!multipleExports&&singleGlobal!==value)multipleExports=true;}else{singleGlobal=value;}}});globalValue=multipleExports?globalValue:singleGlobal;// revert globals
if(oldGlobals){for(var g in oldGlobals){G[g]=oldGlobals[g];}}G.define=curDefine;return globalValue;};},recorderFor:function recorderFor(moduleId){var rec={};return(this.registry[moduleId]=this.registry[moduleId]||{recorder:rec,exports:rec}).recorder;},load:function load(moduleId){var _this=this;var _sortForLoad=this.sortForLoad(moduleId),_sortForLoad2=_slicedToArray(_sortForLoad,2),syncLoad=_sortForLoad2[0],cyclicLoad=_sortForLoad2[1],_computeUniqDepGraphs2=this.computeUniqDepGraphs(),inverseDepGraph=_computeUniqDepGraphs2.inverseDepGraph,modulesToLoad=[].concat(_toConsumableArray(syncLoad),_toConsumableArray(cyclicLoad)),failedModules=[],maxAttempts=5,updateDependents=function updateDependents(m){var dependents=inverseDepGraph[m.id]||[];dependents.forEach(function(dependent){var dm=_this.get(dependent);try{_this.updateDependent(m,dm);}catch(e){m.executed=false;}});},loadModules=function loadModules(modulesToLoad){var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=modulesToLoad[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var modName=_step6.value;var m=_this.get(modName);if(!m||m.executed)continue;m.executed=true;try{_this.updateImports(m);m.execute();}catch(e){m.executed=false;}updateDependents(m);}}catch(err){_didIteratorError6=true;_iteratorError6=err;}finally{try{if(!_iteratorNormalCompletion6&&_iterator6["return"]){_iterator6["return"]();}}finally{if(_didIteratorError6){throw _iteratorError6;}}}};for(var i=0;modulesToLoad.some(function(m){return _this.get(m)&&!_this.get(m).executed;})&&i<maxAttempts;i++){loadModules(modulesToLoad);}return this.get(moduleId).exports;}};G.loadCompiledFrozenPart=G.lively.FreezerRuntime.loadObjectFromPartsbinFolder.bind(G.lively.FreezerRuntime);})();var G=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:this;if(!G.System)G.System=G.lively.FreezerRuntime;/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var runtime=function(exports){"use strict";var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;var undefined;// More compressible than void 0.
var $Symbol=typeof Symbol==="function"?Symbol:{};var iteratorSymbol=$Symbol.iterator||"@@iterator";var asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator";var toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";function define(obj,key,value){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});return obj[key];}try{// IE 8 has a broken Object.defineProperty that only works on DOM objects.
define({},"");}catch(err){define=function define(obj,key,value){return obj[key]=value;};}function wrap(innerFn,outerFn,self,tryLocsList){// If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator;var generator=Object.create(protoGenerator.prototype);var context=new Context(tryLocsList||[]);// The ._invoke method unifies the implementations of the .next,
// .throw, and .return methods.
generator._invoke=makeInvokeMethod(innerFn,self,context);return generator;}exports.wrap=wrap;// Try/catch helper to minimize deoptimizations. Returns a completion
// record like context.tryEntries[i].completion. This interface could
// have been (and was previously) designed to take a closure to be
// invoked without arguments, but in all the cases we care about we
// already have an existing method we want to call, so there's no need
// to create a new function object. We can even get away with assuming
// the method takes exactly one argument, since that happens to be true
// in every case, so we don't have to touch the arguments object. The
// only additional allocation required is the completion record, which
// has a stable shape and so hopefully should be cheap to allocate.
function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)};}catch(err){return{type:"throw",arg:err};}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";// Returning this object from the innerFn has the same effect as
// breaking out of the dispatch switch statement.
var ContinueSentinel={};// Dummy constructor functions that we use as the .constructor and
// .constructor.prototype properties for functions that return Generator
// objects. For full spec compliance, you may wish to configure your
// minifier not to mangle the names of these two functions.
function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}// This is a polyfill for %IteratorPrototype% for environments that
// don't natively support it.
var IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this;};var getProto=Object.getPrototypeOf;var NativeIteratorPrototype=getProto&&getProto(getProto(values([])));if(NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)){// This environment has a native %IteratorPrototype%; use it instead
// of the polyfill.
IteratorPrototype=NativeIteratorPrototype;}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunction.displayName=define(GeneratorFunctionPrototype,toStringTagSymbol,"GeneratorFunction");// Helper for defining the .next, .throw, and .return methods of the
// Iterator interface in terms of a single ._invoke method.
function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){define(prototype,method,function(arg){return this._invoke(method,arg);});});}exports.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||// For the native GeneratorFunction constructor, the best we can
// do is to check its .name property.
(ctor.displayName||ctor.name)==="GeneratorFunction":false;};exports.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype);}else{genFun.__proto__=GeneratorFunctionPrototype;define(genFun,toStringTagSymbol,"GeneratorFunction");}genFun.prototype=Object.create(Gp);return genFun;};// Within the body of any async function, `await x` is transformed to
// `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
// `hasOwn.call(value, "__await")` to determine if the yielded value is
// meant to be awaited.
exports.awrap=function(arg){return{__await:arg};};function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if(record.type==="throw"){reject(record.arg);}else{var result=record.arg;var value=result.value;if(value&&_typeof2(value)==="object"&&hasOwn.call(value,"__await")){return PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject);},function(err){invoke("throw",err,resolve,reject);});}return PromiseImpl.resolve(value).then(function(unwrapped){// When a yielded Promise is resolved, its final value becomes
// the .value of the Promise<{value,done}> result for the
// current iteration.
result.value=unwrapped;resolve(result);},function(error){// If a rejected Promise was yielded, throw the rejection back
// into the async generator function so it can be handled there.
return invoke("throw",error,resolve,reject);});}}var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject);});}return previousPromise=// If enqueue has been called before, then we want to wait until
// all previous Promises have been resolved before calling invoke,
// so that results are always delivered in the correct order. If
// enqueue has not been called before, then it is important to
// call invoke immediately, without waiting on a callback to fire,
// so that the async generator function has the opportunity to do
// any necessary setup in a predictable way. This predictability
// is why the Promise constructor synchronously invokes its
// executor callback, and why async functions synchronously
// execute code before the first await. Since we implement simple
// async functions in terms of async generators, it is especially
// important to get this right, even though it requires care.
previousPromise?previousPromise.then(callInvokeWithMethodAndArg,// Avoid propagating failures to Promises returned by later
// invocations of the iterator.
callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();}// Define the unified helper method that is used to implement .next,
// .throw, and .return (see defineIteratorMethods).
this._invoke=enqueue;}defineIteratorMethods(AsyncIterator.prototype);AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this;};exports.AsyncIterator=AsyncIterator;// Note that simple async functions are implemented on top of
// AsyncIterator objects; they just return a Promise for the value of
// the final result produced by the iterator.
exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){if(PromiseImpl===void 0)PromiseImpl=Promise;var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter// If outerFn is a generator, return the full iterator.
:iter.next().then(function(result){return result.done?result.value:iter.next();});};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running");}if(state===GenStateCompleted){if(method==="throw"){throw arg;}// Be forgiving, per 25.3.3.3.3 of the spec:
// https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
return doneResult();}context.method=method;context.arg=arg;while(true){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult;}}if(context.method==="next"){// Setting context._sent for legacy support of Babel's
// function.sent implementation.
context.sent=context._sent=context.arg;}else if(context.method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw context.arg;}context.dispatchException(context.arg);}else if(context.method==="return"){context.abrupt("return",context.arg);}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){// If an exception is thrown from innerFn, we leave state ===
// GenStateExecuting and loop back for another invocation.
state=context.done?GenStateCompleted:GenStateSuspendedYield;if(record.arg===ContinueSentinel){continue;}return{value:record.arg,done:context.done};}else if(record.type==="throw"){state=GenStateCompleted;// Dispatch the exception by looping back around to the
// context.dispatchException(context.arg) call above.
context.method="throw";context.arg=record.arg;}}};}// Call delegate.iterator[context.method](context.arg) and handle the
// result, either by returning a { value, done } result from the
// delegate iterator, or by modifying context.method and context.arg,
// setting context.delegate to null, and returning the ContinueSentinel.
function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){// A .throw or .return when the delegate iterator has no .throw
// method always terminates the yield* loop.
context.delegate=null;if(context.method==="throw"){// Note: ["return"] must be used for ES3 parsing compatibility.
if(delegate.iterator["return"]){// If the delegate iterator has a return method, give it a
// chance to clean up.
context.method="return";context.arg=undefined;maybeInvokeDelegate(delegate,context);if(context.method==="throw"){// If maybeInvokeDelegate(context) changed context.method from
// "return" to "throw", let that override the TypeError below.
return ContinueSentinel;}}context.method="throw";context.arg=new TypeError("The iterator does not provide a 'throw' method");}return ContinueSentinel;}var record=tryCatch(method,delegate.iterator,context.arg);if(record.type==="throw"){context.method="throw";context.arg=record.arg;context.delegate=null;return ContinueSentinel;}var info=record.arg;if(!info){context.method="throw";context.arg=new TypeError("iterator result is not an object");context.delegate=null;return ContinueSentinel;}if(info.done){// Assign the result of the finished delegate to the temporary
// variable specified by delegate.resultName (see delegateYield).
context[delegate.resultName]=info.value;// Resume execution at the desired location (see delegateYield).
context.next=delegate.nextLoc;// If context.method was "throw" but the delegate handled the
// exception, let the outer generator proceed normally. If
// context.method was "next", forget context.arg since it has been
// "consumed" by the delegate iterator. If context.method was
// "return", allow the original .return call to continue in the
// outer generator.
if(context.method!=="return"){context.method="next";context.arg=undefined;}}else{// Re-yield the result returned by the delegate method.
return info;}// The delegate iterator is finished, so forget it and continue with
// the outer generator.
context.delegate=null;return ContinueSentinel;}// Define Generator.prototype.{next,throw,return} in terms of the
// unified ._invoke helper method.
defineIteratorMethods(Gp);define(Gp,toStringTagSymbol,"Generator");// A Generator should always return itself as the iterator object when the
// @@iterator function is called on it. Some browsers' implementations of the
// iterator prototype chain incorrectly implement this, causing the Generator
// object to not be returned from this call. This ensures that doesn't happen.
// See https://github.com/facebook/regenerator/issues/274 for more details.
Gp[iteratorSymbol]=function(){return this;};Gp.toString=function(){return"[object Generator]";};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1];}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3];}this.tryEntries.push(entry);}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record;}function Context(tryLocsList){// The root entry object (effectively a try statement without a catch
// or a finally block) gives us a place to store values thrown from
// locations where there is no enclosing try statement.
this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true);}exports.keys=function(object){var keys=[];for(var key in object){keys.push(key);}keys.reverse();// Rather than returning an object with a next method, we keep
// things simple and return the next function itself.
return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next;}}// To avoid creating an additional object, we just hang the .value
// and .done properties off the next function object itself. This
// also ensures that the minifier will not anonymize the function.
next.done=true;return next;};};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable);}if(typeof iterable.next==="function"){return iterable;}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next;}}next.value=undefined;next.done=true;return next;};return next.next=next;}}// Return an iterator with no values.
return{next:doneResult};}exports.values=values;function doneResult(){return{value:undefined,done:true};}Context.prototype={constructor:Context,reset:function reset(skipTempReset){this.prev=0;this.next=0;// Resetting context._sent for legacy support of Babel's
// function.sent implementation.
this.sent=this._sent=undefined;this.done=false;this.delegate=null;this.method="next";this.arg=undefined;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){// Not sure about the optimal order of these conditions:
if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined;}}}},stop:function stop(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg;}return this.rval;},dispatchException:function dispatchException(exception){if(this.done){throw exception;}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;if(caught){// If the dispatched exception was caught by a catch block,
// then let that catch block handle the exception normally.
context.method="next";context.arg=undefined;}return!!caught;}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){// Exception thrown outside of any try block that could handle
// it, so set the completion value of the entire function to
// throw the exception.
return handle("end");}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true);}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc);}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true);}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc);}}else{throw new Error("try statement without catch or finally");}}}},abrupt:function abrupt(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break;}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){// Ignore the finally entry if control is not jumping to a
// location outside the try/catch block.
finallyEntry=null;}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.method="next";this.next=finallyEntry.finallyLoc;return ContinueSentinel;}return this.complete(record);},complete:function complete(record,afterLoc){if(record.type==="throw"){throw record.arg;}if(record.type==="break"||record.type==="continue"){this.next=record.arg;}else if(record.type==="return"){this.rval=this.arg=record.arg;this.method="return";this.next="end";}else if(record.type==="normal"&&afterLoc){this.next=afterLoc;}return ContinueSentinel;},finish:function finish(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel;}}},"catch":function _catch(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry);}return thrown;}}// The context.catch method must only be called with a location
// argument that corresponds to a known catch block.
throw new Error("illegal catch attempt");},delegateYield:function delegateYield(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};if(this.method==="next"){// Deliberately forget the last sent value so that we don't
// accidentally pass it on to the delegate.
this.arg=undefined;}return ContinueSentinel;}};// Regardless of whether this script is executing as a CommonJS module
// or not, return the runtime object so that we can declare the variable
// regeneratorRuntime in the outer scope, which allows this module to be
// injected easily by `bin/regenerator --include-runtime script.js`.
return exports;}(// If this script is executing as a CommonJS module, use module.exports
// as the regeneratorRuntime namespace. Otherwise create a new empty
// object. Either way, the resulting object will be used to initialize
// the regeneratorRuntime variable at the top of this file.
(typeof module==="undefined"?"undefined":_typeof2(module))==="object"?module.exports:{});try{regeneratorRuntime=runtime;}catch(accidentalStrictMode){// This module should not be running in strict mode, so the above
// assignment should always work unless something is misconfigured. Just
// in case runtime.js accidentally runs in strict mode, we can escape
// strict mode using a global Function call. This could conceivably fail
// if a Content Security Policy forbids using Function, but in that case
// the proper solution is to fix the accidental strict mode problem. If
// you've misconfigured your bundler to force strict mode and applied a
// CSP to forbid Function, and you're not willing to fix either of those
// problems, please detail your unique predicament in a GitHub issue.
Function("r","regeneratorRuntime = r")(runtime);}var fs=require("fs");var _missingExportShim,show,System,require,timing,lively,Namespace,localStorage;var babelPluginTransformJsx={};'use strict';var transformJSX=require('babel-plugin-transform-jsx');function _interopDefaultLegacy(e){return e&&_typeof2(e)==='object'&&'default'in e?e:{'default':e};}var transformJSX__default=/*#__PURE__*/_interopDefaultLegacy(transformJSX);/*global System,Babel,global,require,__dirname,self*/(function configure(){if(typeof System==='undefined')System=global.System;System.useModuleTranslationCache=!urlQuery().noModuleCache;if(System.get("lively.transpiler")||System.map['plugin-babel']&&System.map['systemjs-plugin-babel']){console.log("[lively.modules] System seems already to be configured");return;}var features=featureTest();var transpiler=decideAboutTranspiler(features);if(transpiler==="lively.transpiler")setupLivelyTranspiler(features);else if(transpiler==="plugin-babel")setupPluginBabelTranspiler();else console.error("[lively.modules] could not find System transpiler for platform!");// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function decideAboutTranspiler(features){return features.supportsAsyncAwait?"lively.transpiler":"plugin-babel";}function setupLivelyTranspiler(features){if(features.isBrowser){if(typeof Babel!=="undefined"){System.global.babel=Babel;delete System.global.Babel;}if(!System.global.babel){console.error("[lively.modules] in browser environments babel is required to be loaded before lively.modules!");return;}}else{System.global.babel=loadBabel_node();}console.log("[lively.modules] SystemJS configured with lively.transpiler & babel");function Transpiler(System,moduleId,env){this.System=System;this.moduleId=moduleId;this.env=env;}Transpiler.prototype.transpileDoit=function transpileDoit(source,options){// wrap in async function so we can use await top-level
var System=this.System,source="(async function(__rec) {\n"+source.replace(/(\/\/# sourceURL=.+)$|$/,"\n}).call(this);\n$1"),opts=System.babelOptions,needsBabel=opts.plugins&&opts.plugins.length||opts.presets&&opts.presets.length;return needsBabel?System.global.babel.transform(source,opts).code:source;};Transpiler.prototype.transpileModule=function transpileModule(source,options){var System=this.System,opts=Object.assign({},System.babelOptions);opts.plugins=opts.plugins?opts.plugins.slice():[];opts.plugins.push("transform-es2015-modules-systemjs");return System.global.babel.transform(source,opts).code;};function translate(load,traceOpts){return new Transpiler(this,load.name,{}).transpileModule(load.source,{});}System.set("lively.transpiler",System.newModule({"default":Transpiler,translate:translate}));System._loader.transpilerPromise=Promise.resolve({translate:translate});System.config({transpiler:'lively.transpiler',babelOptions:{sourceMaps:false,compact:"auto",comments:"true",presets:features.supportsAsyncAwait?[]:["es2015"]}});}function setupPluginBabelTranspiler(features){var isBrowser=!!System.get("@system-env").browser,pluginBabelPath=isBrowser?findSystemJSPluginBabel_browser():findSystemJSPluginBabel_node(),babel=System.global.babel;if(!pluginBabelPath&&!babel){console.error("[lively.modules] Could not find path to systemjs-plugin-babel nor a babel global! This will likely break lively.modules!");return;}if(!pluginBabelPath){console.warn("[lively.modules] Could not find path to systemjs-plugin-babel but babel! Will fallback but there might be features in lively.modules that won't work!");System.config({transpiler:'babel'});}else{console.log("[lively.modules] SystemJS configured with systemjs-plugin-babel transpiler from "+pluginBabelPath);System.config({map:{'plugin-babel':pluginBabelPath+'/plugin-babel.js','systemjs-babel-build':pluginBabelPath+(isBrowser?'/systemjs-babel-browser.js':"/systemjs-babel-node.js")},transpiler:'plugin-babel',babelOptions:Object.assign({sourceMaps:"inline",stage3:true,es2015:true,modularRuntime:true},System.babelOptions)});}}function featureTest(){var isBrowser=System.get("@system-env").browser||typeof self!=='undefined';// "feature test": we assume if the browser supports async/await it will also
// support other es6/7/8 features we care about. In this case only use the
// system-register transform. Otherwise use full transpilation.
var supportsAsyncAwait=false;try{eval("async function foo() {}");supportsAsyncAwait=true;}catch(e){}return{supportsAsyncAwait:supportsAsyncAwait,isBrowser:isBrowser};}function loadBabel_node(){if(global.Babel&&!global.babel)global.babel=global.Babel;if(global.babel)return global.babel;var parent;try{parent=require.cache[require.resolve("lively.modules")];}catch(err){}try{parent=require.cache[require.resolve(__dirname+"/../")];}catch(err){}if(!parent)throw new Error("Cannot find batch to babel-standalone module");var babelPath=require("module").Module._resolveFilename("babel-standalone",parent);global.window=global;global.navigator={};var babel=require(babelPath);delete global.navigator;delete global.window;return babel;}function urlQuery(){if(typeof document==="undefined"||!document.location)return{};return(document.location.search||"").replace(/^\?/,"").split("&").reduce(function(query,ea){var split=ea.split("="),key=split[0],value=split[1];if(value==="true"||value==="false")value=eval(value);else if(!isNaN(Number(value)))value=Number(value);query[key]=value;return query;},{});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function findSystemJSPluginBabel_browser(){// walks the script tags
var scripts=[].slice.call(document.getElementsByTagName("script")),pluginBabelPath;for(var i=scripts.length-1;i>=0;i--){var src=scripts[i].src;// is lively.modules loaded? Use it's node_modules folder
var index1=src.indexOf("lively.modules/");if(index1>-1){pluginBabelPath=src.slice(0,index1)+"lively.next-node_modules/systemjs-plugin-babel";break;}// is systemjs loaded? Assume that systemjs-plugin-babel sits in the same folder...
var index2=src.indexOf("systemjs/dist/system");if(index2>-1){pluginBabelPath=src.slice(0,index2)+"systemjs-plugin-babel";break;}// for LivelyKernel environments
var index3=src.indexOf("core/lively/bootstrap.js");if(index3>-1){pluginBabelPath=src.slice(0,index3)+"node_modules/lively.modules/node_modules/systemjs-plugin-babel";break;}var match=src.match(/(.*)generated\/[^\/]+\/combinedModules.js/);if(match){pluginBabelPath=match[1]+"node_modules/lively.modules/node_modules/systemjs-plugin-babel";break;}}return pluginBabelPath;}function findSystemJSPluginBabel_node(){if(global.systemjsPluginBabel)return global.systemjsPluginBabel;var attempts=[attempt1,attempt2,attempt3];for(var i=0;i<attempts.length;i++){try{return attempts[i]();}catch(err){}}return null;function attempt1(){var parent=require.cache[require.resolve("lively.modules")],pluginBabelPath=require("module").Module._resolveFilename("systemjs-plugin-babel",parent);if(pluginBabelPath)return require('path').dirname(pluginBabelPath);}function attempt2(){var pluginBabelPath=require.resolve("systemjs-plugin-babel");if(pluginBabelPath)return require('path').dirname(pluginBabelPath);}function attempt3(){var pluginBabelPath=require.resolve(require("path").join(__dirname,"systemjs-babel-node.js"));if(pluginBabelPath)return require('path').dirname(pluginBabelPath);}}})();var parameterRegex=/function[^\(]*\(([^\)]*)\)|\(?([^\)=]*)\)?\s*=>/;var Closure=/*#__PURE__*/function(){_createClass(Closure,null,[{key:"fromFunction",value:function fromFunction(func,varMapping){/* show-in-doc */return new this(func,varMapping||{});}},{key:"fromSource",value:function fromSource(source,varMapping){/* show-in-doc */return new this(null,varMapping||{},source);}}]);function Closure(func,varMapping,source,funcProperties){_classCallCheck(this,Closure);this.originalFunc=func;this.varMapping=varMapping||{};this.setFuncSource(source||func);this.setFuncProperties(func||funcProperties);}_createClass(Closure,[{key:"setFuncSource",// accessing
value:function setFuncSource(src){/* show-in-doc */src=typeof lively!=='undefined'&&lively.sourceTransform&&typeof lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder==='function'?lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder(src):String(src);return this.source=src;}},{key:"getFuncSource",value:function getFuncSource(){/* show-in-doc */return this.source||this.setFuncSource(this.originalFunc);}},{key:"hasFuncSource",value:function hasFuncSource(){/* show-in-doc */return this.source&&true;}},{key:"getFunc",value:function getFunc(){/* show-in-doc */return this.originalFunc||this.recreateFunc();}},{key:"getFuncProperties",value:function getFuncProperties(){// ignore-in-doc
// a function may have state attached
return this.funcProperties||(this.funcProperties={});}},{key:"setFuncProperties",value:function setFuncProperties(obj){// ignore-in-doc
var props=this.getFuncProperties();for(var name in obj){// The AST implementation assumes that Function objects are some
// kind of value object. When their identity changes cached state
// should not be carried over to new function instances. This is a
// pretty intransparent way to invalidate attributes that are used
// for caches.
// @cschuster, can you please fix this by making invalidation more
// explicit?
if(obj.hasOwnProperty(name))props[name]=obj[name];}}},{key:"lookup",value:function lookup(name){/* show-in-doc */return this.varMapping[name];}},{key:"parameterNames",value:function parameterNames(methodString){// ignore-in-doc
if(typeof lively!=='undefined'&&lively.ast&&lively.ast.parseFunction){return(lively.ast.parseFunction(methodString).params||[]).map(function(ea){if(ea.type==='Identifier')return ea.name;if(ea.left&&ea.left.type==='Identifier')return ea.left.name;return null;}).filter(Boolean);}var paramsMatch=parameterRegex.exec(methodString);if(!paramsMatch)return[];var paramsString=paramsMatch[1]||paramsMatch[2]||'';return paramsString.split(',').map(function(ea){return ea.trim();});}},{key:"firstParameter",value:function firstParameter(src){// ignore-in-doc
return this.parameterNames(src)[0]||null;}// -=-=-=-=-=-=-=-=-=-
// function creation
// -=-=-=-=-=-=-=-=-=-
},{key:"recreateFunc",value:function recreateFunc(){// Creates a real function object
return this.recreateFuncFromSource(this.getFuncSource(),this.originalFunc);}},{key:"recreateFuncFromSource",value:function recreateFuncFromSource(funcSource,optFunc){// ignore-in-doc
// what about objects that are copied by value, e.g. numbers?
// when those are modified after the originalFunc we captured
// varMapping then we will have divergent state
var closureVars=[];var specificSuperHandling=this.firstParameter(funcSource)==='$super';for(var name in this.varMapping){if(!this.varMapping.hasOwnProperty(name))continue;if(name=='this'){continue;}// closureVars.push(`var ${name} = this.varMapping.${name};\n`);
closureVars.push('var '+name+' = this.varMapping.'+name+';\n');}var src='';if(closureVars.length>0)src+=closureVars.join('\n');if(specificSuperHandling)src+='(function superWrapperForClosure() { return ';src+='('+funcSource+')';if(specificSuperHandling){src+='.apply(this, [$super.bind(this)]'+'.concat(Array.from(arguments))) })';}try{var func=evalJS.call(this,src)||this.couldNotCreateFunc(src);this.addFuncProperties(func);this.originalFunc=func;return func;}catch(e){// var msg = `Cannot create function ${e} src: ${src}`;
var msg='Cannot create function '+e+' src: '+src;console.error(msg);throw new Error(msg);}}},{key:"addFuncProperties",value:function addFuncProperties(func){// ignore-in-doc
var props=this.getFuncProperties();for(var name in props){if(props.hasOwnProperty(name)){func[name]=props[name];}}this.addClosureInformation(func);}},{key:"couldNotCreateFunc",value:function couldNotCreateFunc(src){// ignore-in-doc
var msg='Could not recreate closure from source: \n'+src;console.error(msg);return function(){throw new Error(msg);};}// -=-=-=-=-=-
// conversion
// -=-=-=-=-=-
},{key:"asFunction",value:function asFunction(){/* ignore-in-doc */return this.recreateFunc();}// -=-=-=-=-=-=-=-=-=-=-=-
// function modification
// -=-=-=-=-=-=-=-=-=-=-=-
},{key:"addClosureInformation",value:function addClosureInformation(f){/* ignore-in-doc-in-doc */f.hasLivelyClosure=true;f.livelyClosure=this;return f;}},{key:"isLivelyClosure",get:function get(){return true;}// serialization
},{key:"doNotSerialize",get:function get(){return['originalFunc'];}}]);return Closure;}();// show-in-doc
var Group=/*#__PURE__*/function(){function Group(){_classCallCheck(this,Group);}_createClass(Group,[{key:"toArray",value:function toArray(){// Example:
// var group = arr.groupBy([1,2,3,4,5], function(n) { return n % 2; })
// group.toArray(); // => [[2,4],[1,3,5]]
return this.reduceGroups(function(all,_,group){return all.concat([group]);},[]);}},{key:"forEach",value:function forEach(iterator,context){// Iteration for each item in each group, called like `iterator(groupKey, groupItem)`
var groups=this;Object.keys(groups).forEach(function(groupName){groups[groupName].forEach(iterator.bind(context,groupName));});return groups;}},{key:"forEachGroup",value:function forEachGroup(iterator,context){// Iteration for each group, called like `iterator(groupKey, group)`
var groups=this;Object.keys(groups).forEach(function(groupName){iterator.call(context,groupName,groups[groupName]);});return groups;}},{key:"map",value:function map(iterator,context){// Map for each item in each group, called like `iterator(groupKey, group)`
var result=new Group();this.forEachGroup(function(groupName,group){result[groupName]=group.map(iterator.bind(context,groupName));});return result;}},{key:"mapGroups",value:function mapGroups(iterator,context){// Map for each group, called like `iterator(groupKey, group)`
var result=new Group();this.forEachGroup(function(groupName,group){result[groupName]=iterator.call(context,groupName,group);});return result;}},{key:"keys",value:function keys(){// show-in-docs
return Object.keys(this);}},{key:"reduceGroups",value:function reduceGroups(iterator,carryOver,context){// Reduce/fold for each group, called like `iterator(carryOver, groupKey, group)`
this.forEachGroup(function(groupName,group){carryOver=iterator.call(context,carryOver,groupName,group);});return carryOver;}},{key:"count",value:function count(){// counts the elements of each group
return this.reduceGroups(function(groupCount,groupName,group){groupCount[groupName]=group.length;return groupCount;},{});}}],[{key:"fromArray",value:function fromArray(array,hashFunc,context){// Example:
// Group.fromArray([1,2,3,4,5,6], function(n) { return n % 2; })
// // => {"0": [2,4,6], "1": [1,3,5]}
var grouping=new Group();for(var _i2=0,len=array.length;_i2<len;_i2++){var hash=hashFunc.call(context,array[_i2],_i2);if(Group.prototype.hasOwnProperty(hash))hash='_'+hash;if(!grouping[hash])grouping[hash]=[];grouping[hash].push(array[_i2]);}return grouping;}},{key:"by",get:function get(){return groupBy;}}]);return Group;}();/* global System, global */var GLOBAL=typeof System!=='undefined'?System.global:typeof window!=='undefined'?window:global;var features={from:!!Array.from,filter:!!Array.prototype.filter,find:!!Array.prototype.find,findIndex:!!Array.prototype.findIndex,includes:!!Array.prototype.includes};// variety of functions for Arrays
// -=-=-=-=-=-=-=-
// array creations
// -=-=-=-=-=-=-=-
function range(begin,end,step){// Examples:
//   arr.range(0,5) // => [0,1,2,3,4,5]
//   arr.range(0,10,2) // => [0,2,4,6,8,10]
step=step||0;var result=[];if(begin<=end){if(step<=0)step=-step||1;for(var i=begin;i<=end;i+=step){result.push(i);}}else{if(step>=0)step=-step||-1;for(var i=begin;i>=end;i+=step){result.push(i);}}return result;}var from=features.from?Array.from:function(iterable){// Makes JS arrays out of array like objects like `arguments` or DOM `childNodes`
if(!iterable)return[];if(Array.isArray(iterable))return iterable;if(iterable.toArray)return iterable.toArray();var length=iterable.length;var results=new Array(length);while(length--){results[length]=iterable[length];}return results;};function withN(n,obj){// Example:
//   arr.withN(3, "Hello") // => ["Hello","Hello","Hello"]
var result=new Array(n);while(n>0){result[--n]=obj;}return result;}function genN(n,generator){// Number -> Function -> Array
// Takes a generator function that is called for each `n`.
// Example:
//   arr.genN(3, num.random) // => [46,77,95]
var result=new Array(n);while(n>0){result[--n]=generator(n);}return result;}// -=-=-=-=-
// filtering
// -=-=-=-=-
function filter(array,iterator,context){// [a] -> (a -> Boolean) -> c? -> [a]
// Calls `iterator` for each element in `array` and returns a subset of it
// including the elements for which `iterator` returned a truthy value.
// Like `Array.prototype.filter`.
var res=[];for(var idx=0;idx<array.length;idx++){var currentItem=array[idx];if(iterator.call(context,currentItem)){res.push(currentItem);}}return res;}var detect=features.find?function(arr,iterator,context){return arr.find(iterator,context);}:function(arr,iterator,context){// [a] -> (a -> Boolean) -> c? -> a
// returns the first occurrence of an element in `arr` for which iterator
// returns a truthy value
for(var value,i=0,len=arr.length;i<len;i++){value=arr[i];if(iterator.call(context,value,i))return value;}return undefined;};function binarySearchFor(array,searchValue,converter){var returnClosestElement=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;// Returns the element equal to the given search value or undefined
// If defined, a converter function will be applied to compare an
//   array element with the search value
// If returnClosestElement is true, the element closest to the search value will be returned,
//   even if it is not equal
//   If false, only an exact match will be returned, otherwise undefined
if(!array||!isArray(array))return;var leftLimit=0;var rightLimit=array.length-1;// classic binary search with converter,
//   https://en.wikipedia.org/wiki/Binary_search_algorithm used for reference
while(leftLimit<=rightLimit){var pivot=leftLimit+Math.floor((rightLimit-leftLimit)/2);var compareValue=!converter?array[pivot]:converter(array[pivot]);if(compareValue===searchValue){return array[pivot];}else{if(compareValue>searchValue){rightLimit=pivot-1;}else{leftLimit=pivot+1;}}}if(returnClosestElement){// left and right limit point to two elements
//   of which one must be the elemnt closest to the search value
if(!array[leftLimit])return array[rightLimit];if(!array[rightLimit])return array[leftLimit];var compareValueL=!converter?array[leftLimit]:converter(array[leftLimit]);var compareValueR=!converter?array[rightLimit]:converter(array[rightLimit]);var diffOfElementL=Math.abs(compareValueL-searchValue);var diffOfElementR=Math.abs(compareValueR-searchValue);return diffOfElementL-diffOfElementR<0?array[leftLimit]:array[rightLimit];}return undefined;}var findIndex=features.findIndex?function(arr,iterator,context){return arr.findIndex(iterator,context);}:function(arr,iterator,context){var i=-1;return arr.find(function(ea,j){i=j;return iterator.call(ea,context);})?i:-1;};function findAndGet(arr,iterator){// find the first occurence for which `iterator` returns a truthy value and
// return *this* value, i.e. unlike find the iterator result and not the
// element of the list is returned
var result;arr.find(function(ea,i){return result=iterator(ea,i);});return result;}function filterByKey(arr,key){// [a] -> String -> [a]
// Example:
//   var objects = [{x: 3}, {y: 4}, {x:5}]
//   arr.filterByKey(objects, "x") // => [{x: 3},{x: 5}]
return arr.filter(function(ea){return!!ea[key];});}function grep(arr,test,context){// [a] -> String|RegExp -> [a]
// `filter` can be a String or RegExp. Will stringify each element in
// Example:
// ["Hello", "World", "Lively", "User"].grep("l") // => ["Hello","World","Lively"]
if(typeof test==='string')test=new RegExp(test,'i');return filter(arr,filter.test.bind(test));}function mask(array,mask){// select every element in array for which array's element is truthy
// Example: [1,2,3].mask([false, true, false]) => [2]
return filter(array,function(_,i){return!!mask[i];});}function reject(array,func,context){// show-in-doc
function iterator(val,i){return!func.call(context,val,i);}return filter(array,iterator);}function rejectByKey(array,key){// show-in-doc
return filter(array,function(ea){return!ea[key];});}function without(array,elem){// non-mutating
// Example:
// arr.without([1,2,3,4,5,6], 3) // => [1,2,4,5,6]
return filter(array,function(val){return val!==elem;});}function withoutAll(array,otherArr){// non-mutating
// Example:
// arr.withoutAll([1,2,3,4,5,6], [3,4]) // => [1,2,5,6]
return filter(array,function(val){return otherArr.indexOf(val)===-1;});}function uniq(array,sorted){// non-mutating
// Removes duplicates from array.
// if sorted == true then assume array is sorted which allows uniq to be more
// efficient
// uniq([3,5,6,2,3,4,2,6,4])
if(!array.length)return array;var result=[array[0]];if(sorted){for(var _i3=1;_i3<array.length;_i3++){var val=array[_i3];if(val!==result[result.length]){result.push(val);}}}else{for(var _i4=1;_i4<array.length;_i4++){var _val=array[_i4];if(result.indexOf(_val)===-1){result.push(_val);}}}return result;}function uniqBy(array,comparator,context){// like `arr.uniq` but with custom equality: `comparator(a,b)` returns
// BOOL. True if a and be should be regarded equal, false otherwise.
var result=array.slice();for(var _i5=result.length;_i5--;){var item=array[_i5];for(var j=_i5+1;j<result.length;j++){if(comparator.call(context,item,result[j])){result.splice(j--,1);}}}return result;}function uniqByKey(array,key){// like `arr.uniq` but with equality based on item[key]
var seen={};var result=[];for(var _i6=0;_i6<array.length;_i6++){var item=array[_i6];if(!seen[item[key]]){seen[item[key]]=true;result.push(item);}}return result;}function compact(array){// removes falsy values
// Example:
// arr.compact([1,2,undefined,4,0]) // => [1,2,4]
return filter(array,Boolean);}function mutableCompact(array){// fix gaps that were created with 'delete'
var i=0;var j=0;var len=array.length;while(i<len){if(array.hasOwnProperty(i))array[j++]=array[i];i++;}while(j++<len){array.pop();}return array;}// -=-=-=-=-
// iteration
// -=-=-=-=-
function forEach(array,iterator,context){// [a] -> (a -> Undefined) -> c? -> Undefined
// `iterator` is called on each element in `array` for side effects. Like
// `Array.prototype.forEach`.
return array.forEach(iterator,context);}function zip()/* arr, arr2, arr3 */{// Takes any number of lists as arguments. Combines them elment-wise.
// Example:
// arr.zip([1,2,3], ["a", "b", "c"], ["A", "B"])
// // => [[1,"a","A"],[2,"b","B"],[3,"c",undefined]]
var args=Array.from(arguments);var array=args.shift();var iterator=typeof last(args)==='function'?args.pop():function(x){return x;};var collections=[array].concat(args).map(function(ea){return Array.from(ea);});return array.map(function(value,index){return iterator(pluck(collections,index),index);});}function flatten(array,optDepth){// Turns a nested collection into a flat one.
// Example:
// arr.flatten([1, [2, [3,4,5], [6]], 7,8])
// // => [1,2,3,4,5,6,7,8]
if(typeof optDepth==='number'){if(optDepth<=0)return array;optDepth--;}return array.reduce(function(flattened,value){return flattened.concat(Array.isArray(value)?flatten(value,optDepth):[value]);},[]);}function flatmap(array,it,ctx){// the simple version
// Array.prototype.concat.apply([], array.map(it, ctx));
// causes stack overflows with really big arrays
var results=[];for(var _i7=0;_i7<array.length;_i7++){results.push.apply(results,it.call(ctx,array[_i7],_i7));}return results;}function interpose(array,delim){// Injects delim between elements of array
// Example:
// lively.lang.arr.interpose(["test", "abc", 444], "aha"));
// // => ["test","aha","abc","aha",444]
return array.reduce(function(xs,x){if(xs.length>0)xs.push(delim);xs.push(x);return xs;},[]);}function delimWith(array,delim){// ignore-in-doc
// previously used, use interpose now!
return interpose(array,delim);}// -=-=-=-=-
// mapping
// -=-=-=-=-
function map(array,iterator,context){// [a] -> (a -> b) -> c? -> [b]
// Applies `iterator` to each element of `array` and returns a new Array
// with the results of those calls. Like `Array.prototype.some`.
return array.map(iterator,context);}function invoke(array,method,arg1,arg2,arg3,arg4,arg5,arg6){// Calls `method` on each element in `array`, passing all arguments. Often
// a handy way to avoid verbose `map` calls.
// Example: arr.invoke(["hello", "world"], "toUpperCase") // => ["HELLO","WORLD"]
return array.map(function(ea){return ea[method](arg1,arg2,arg3,arg4,arg5,arg6);});}function pluck(array,property){// Returns `property` or undefined from each element of array. For quick
// `map`s and similar to `invoke`.
// Example: arr.pluck(["hello", "world"], 0) // => ["h","w"]
return array.map(function(ea){return ea[property];});}// -=-=-=-=-
// folding
// -=-=-=-=-
function reduce(array,iterator,memo,context){// Array -> Function -> Object? -> Object? -> Object?
// Applies `iterator` to each element of `array` and returns a new Array
// with the results of those calls. Like `Array.prototype.some`.
return array.reduce(iterator,memo,context);}function reduceRight(array,iterator,memo,context){// show-in-doc
return array.reduceRight(iterator,memo,context);}// -=-=-=-=-
// testing
// -=-=-=-=-
var isArray=Array.isArray;var includes=features.includes?function(array,object){return array.includes(object);}:function(array,object){// Example: arr.include([1,2,3], 2) // => true
return array.indexOf(object)!==-1;};var include=includes;function some(array,iterator,context){// [a] -> (a -> Boolean) -> c? -> Boolean
// Returns true if there is at least one abject in `array` for which
// `iterator` returns a truthy result. Like `Array.prototype.some`.
return array.some(iterator,context);}function every(array,iterator,context){// [a] -> (a -> Boolean) -> c? -> Boolean
// Returns true if for all abjects in `array` `iterator` returns a truthy
// result. Like `Array.prototype.every`.
return array.every(iterator,context);}function equals(array,otherArray){// Returns true iff each element in `array` is equal (`==`) to its
// corresponding element in `otherArray`
var len=array.length;if(!otherArray||len!==otherArray.length)return false;for(var _i8=0;_i8<len;_i8++){if(array[_i8]&&otherArray[_i8]&&array[_i8].equals&&otherArray[_i8].equals){if(!array[_i8].equals(otherArray[_i8])){return false;}else{continue;}}if(array[_i8]!=otherArray[_i8])return false;}return true;}function deepEquals(array,otherArray){// Returns true iff each element in `array` is structurally equal
// (`lang.obj.equals`) to its corresponding element in `otherArray`
var len=array.length;if(!otherArray||len!==otherArray.length)return false;for(var _i9=0;_i9<len;_i9++){if(!equals$1(array[_i9],otherArray[_i9]))return false;}return true;}// -=-=-=-=-
// sorting
// -=-=-=-=-
function isSorted(array,descending){if(descending){for(var i=1;i<array.length;i++){if(array[i-1]<array[i])return false;}}else{for(var i=1;i<array.length;i++){if(array[i-1]>array[i])return false;}}return true;}function sort(array,sortFunc){// [a] -> (a -> Number)? -> [a]
// Just `Array.prototype.sort`
return array.sort(sortFunc);}function sortBy(array,iterator,context){// Example:
// arr.sortBy(["Hello", "Lively", "User"], function(ea) {
//   return ea.charCodeAt(ea.length-1); }) // => ["Hello","User","Lively"]
return pluck(array.map(function(value,index){return{value:value,criteria:iterator.call(context,value,index)};}).sort(function(left,right){var a=left.criteria;var b=right.criteria;return a<b?-1:a>b?1:0;}),'value');}function sortByKey(array,key){// Example:
// lively.lang.arr.sortByKey([{x: 3}, {x: 2}, {x: 8}], "x")
// // => [{x: 2},{x: 3},{x: 8}]
return sortBy(array,function(ea){return ea[key];});}function reverse(array){return array.reverse();}function reversed(array){return array.slice().reverse();}// -=-=-=-=-=-=-=-=-=-=-=-=-
// RegExp / String matching
// -=-=-=-=-=-=-=-=-=-=-=-=-
function reMatches(arr,re,stringifier){// result might include null items if re did not match (usful for masking)
// Example:
//   var morphs = $world.withAllSubmorphsDo(function(x) { return x; ;
//   morphs.mask(morphs.reMatches(/code/i))
stringifier=stringifier||String;return arr.map(function(ea){return stringifier(ea).match(re);});}// -=-=-=-=-=-
// accessors
// -=-=-=-=-=-
function first(array){return array[0];}function last(array){return array[array.length-1];}// -=-=-=-=-=-=-=-
// Set operations
// -=-=-=-=-=-=-=-
function intersect(array1,array2){// set-like intersection
return filter(uniq(array1),function(item){return array2.indexOf(item)>-1;});}function union(array1,array2){// set-like union
var result=array1.slice();for(var _i10=0;_i10<array2.length;_i10++){var item=array2[_i10];if(result.indexOf(item)===-1)result.push(item);}return result;}function pushAt(array,item,index){// inserts `item` at `index`, mutating
array.splice(index,0,item);}function removeAt(array,index){// inserts item at `index`, mutating
array.splice(index,1);}function _remove4(array,item){// removes first occurrence of item in `array`, mutating
var index=array.indexOf(item);if(index>=0)removeAt(array,index);return item;}function pushAll(array,items){// appends all `items`, mutating
array.push.apply(array,items);return array;}function pushAllAt(array,items,idx){// inserts all `items` at `idx`, mutating
array.splice.apply(array,[idx,0].concat(items));}function pushIfNotIncluded(array,item){// only appends `item` if its not already in `array`, mutating
if(!array.includes(item))array.push(item);}function replaceAt(array,item,index){// mutating
array.splice(index,1,item);}function clear(array){// removes all items, mutating
array.length=0;return array;}function isSubset(list1,list2){// are all elements in list1 in list2?
for(var _i11=0;_i11<list1.length;_i11++){if(!list2.includes(list1[_i11])){return false;}}return true;}// -=-=-=-=-=-=-=-=-=-=-=-
// asynchronous iteration
// -=-=-=-=-=-=-=-=-=-=-=-
function doAndContinue(array,iterator,endFunc,context){// Iterates over array but instead of consecutively calling iterator,
// iterator gets passed in the invocation for the next iteration step
// as a function as first parameter. This allows to wait arbitrarily
// between operation steps, great for managing dependencies between tasks.
// Related is [`fun.composeAsync`]().
// Example:
// arr.doAndContinue([1,2,3,4], function(next, n) {
//   alert("At " + n);
//   setTimeout(next, 100);
// }, function() { alert("Done"); })
// // If the elements are functions you can leave out the iterator:
// arr.doAndContinue([
//   function(next) { alert("At " + 1); next(); },
//   function(next) { alert("At " + 2); next(); }
// ], null, function() { alert("Done"); });
endFunc=endFunc||Null;context=context||GLOBAL;iterator=iterator||function(next,ea,idx){ea.call(context,next,idx);};return array.reduceRight(function(nextFunc,ea,idx){return function(){iterator.call(context,nextFunc,ea,idx);};},endFunc)();}function nestedDelay(array,iterator,waitSecs,endFunc,context,optSynchronChunks){// Calls `iterator` for every element in `array` and waits between iterator
// calls `waitSecs`. Eventually `endFunc` is called. When passing a number n
// as `optSynchronChunks`, only every nth iteration is delayed.
endFunc=endFunc||function(){};return array.clone().reverse().reduce(function(nextFunc,ea,idx){return function(){iterator.call(context||GLOBAL,ea,idx);// only really delay every n'th call optionally
if(optSynchronChunks&&idx%optSynchronChunks!==0){nextFunc();}else{nextFunc.delay(waitSecs);}};},endFunc)();}function forEachShowingProgress()/* array, progressBar, iterator, labelFunc, whenDoneFunc, context or spec */{// ignore-in-doc
var args=Array.from(arguments);var array=args.shift();var steps=array.length;var progressBar;var iterator;var labelFunc;var whenDoneFunc;var context;var progressBarAdded=false;// init args
if(args.length===1){progressBar=args[0].progressBar;iterator=args[0].iterator;labelFunc=args[0].labelFunction;whenDoneFunc=args[0].whenDone;context=args[0].context;}else{progressBar=args[0];iterator=args[1];labelFunc=args[2];whenDoneFunc=args[3];context=args[4];}if(!context)context=typeof window!=='undefined'?window:global;if(!labelFunc)labelFunc=function labelFunc(x){return x;};// init progressbar
if(!progressBar){progressBarAdded=true;var _Global=typeof window!=='undefined'?window:global;var world=_Global.lively&&lively.morphic&&lively.morphic.World.current();progressBar=world?world.addProgressBar():{value:null,label:null,remove:function remove(){}};}progressBar.value=0;// nest functions so that the iterator calls the next after a delay
array.reduceRight(function(nextFunc,item,idx){return function(){try{progressBar.value=idx/steps;if(labelFunc)progressBar.label=labelFunc.call(context,item,idx);iterator.call(context,item,idx);}catch(e){console.error('Error in forEachShowingProgress at %s (%s)\n%s\n%s',idx,item,e,e.stack);}delay(nextFunc,0);};},function(){progressBar.value=1;if(progressBarAdded)(function(){progressBar.remove();}).delay(0);if(whenDoneFunc)whenDoneFunc.call(context);})();return array;}function swap(array,index1,index2){// mutating
// Example:
// var a = [1,2,3,4];
// arr.swap(a, 3, 1);
// a // => [1,4,3,2]
if(index1<0)index1=array.length+index1;if(index2<0)index2=array.length+index2;var temp=array[index1];array[index1]=array[index2];array[index2]=temp;return array;}function rotate(array,times){// non-mutating
// Example:
// arr.rotate([1,2,3]) // => [2,3,1]
times=times||1;return array.slice(times).concat(array.slice(0,times));}// -=-=-=-=-
// grouping
// -=-=-=-=-
function groupBy(array,iterator,context){// Applies `iterator` to each element in `array`, and puts the return value
// into a collection (the group) associated to it's stringified representation
// (the "hash").
// See [`Group.prototype`] for available operations on groups.
// Example:
// Example 1: Groups characters by how often they occur in a string:
// var chars = arr.from("Hello World");
// arr.groupBy(arr.uniq(chars), function(c) {
//   return arr.count(chars, c); })
// // => {
// //   "1": ["H","e"," ","W","r","d"],
// //   "2": ["o"],
// //   "3": ["l"]
// // }
// // Example 2: Group numbers by a custom qualifier:
// arr.groupBy([3,4,1,7,4,3,8,4], function(n) {
//   if (n <= 3) return "small";
//   if (n <= 7) return "medium";
//   return "large";
// });
// // => {
// //   large: [8],
// //   medium: [4,7,4,4],
// //   small: [3,1,3]
// // }
return Group.fromArray(array,iterator,context);}function groupByKey(array,key){// var objects = [{x: }]
// arr.groupBy(arr.uniq(chars), function(c) {
//   return arr.count(chars, c); })
// // => {
// //   "1": ["H","e"," ","W","r","d"],
// //   "2": ["o"],
// //   "3": ["l"]
// // }
return groupBy(array,function(ea){return ea[key];});}function partition(array,iterator,context){// Example:
// var array = [1,2,3,4,5,6];
// arr.partition(array, function(ea) { return ea > 3; })
// // => [[1,2,3,4],[5,6]]
iterator=iterator||function(x){return x;};var trues=[];var falses=[];array.forEach(function(value,index){(iterator.call(context,value,index)?trues:falses).push(value);});return[trues,falses];}function batchify(array,constrainedFunc,context){// Takes elements and fits them into subarrays (= batches) so that for
// each batch constrainedFunc returns true. Note that contrained func
// should at least produce 1-length batches, otherwise an error is raised
// Example:
// // Assume you have list of things that have different sizes and you want to
// // create sub-arrays of these things, with each sub-array having if possible
// // less than a `batchMaxSize` of combined things in it:
// var sizes = [
//   Math.pow(2, 15), // 32KB
//   Math.pow(2, 29), // 512MB
//   Math.pow(2, 29), // 512MB
//   Math.pow(2, 27), // 128MB
//   Math.pow(2, 26), // 64MB
//   Math.pow(2, 26), // 64MB
//   Math.pow(2, 24), // 16MB
//   Math.pow(2, 26)] // 64MB
// var batchMaxSize = Math.pow(2, 28)/*256MB*/;
// function batchConstrained(batch) {
//   return batch.length == 1 || batch.sum() < batchMaxSize;
// }
// var batches = sizes.batchify(batchConstrained);
// batches.pluck('length') // => [4,1,1,2]
// batches.map(arr.sum).map(num.humanReadableByteSize) // => ["208.03MB","512MB","512MB","128MB"]
return findBatches([],array);// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function extractBatch(batch,sizes){// ignore-in-doc
// Array -> Array -> Array[Array,Array]
// case 1: no sizes to distribute, we are done
if(!sizes.length)return[batch,[]];var first=sizes[0];var rest=sizes.slice(1);// if batch is empty we have to take at least one
// if batch and first still fits, add first
var candidate=batch.concat([first]);if(constrainedFunc.call(context,candidate))return extractBatch(candidate,rest);// otherwise leave first out for now
var batchAndSizes=extractBatch(batch,rest);return[batchAndSizes[0],[first].concat(batchAndSizes[1])];}function findBatches(batches,sizes){if(!sizes.length)return batches;var extracted=extractBatch([],sizes);if(!extracted[0].length){throw new Error('Batchify constrained does not ensure consumption '+'of at least one item per batch!');}return findBatches(batches.concat([extracted[0]]),extracted[1]);}}function toTuples(array,tupleLength){// Creates sub-arrays with length `tupleLength`
// Example:
// arr.toTuples(["H","e","l","l","o"," ","W","o","r","l","d"], 4)
// // => [["H","e","l","l"],["o"," ","W","o"],["r","l","d"]]
tupleLength=tupleLength||1;return range(0,Math.ceil(array.length/tupleLength)-1).map(function(n){return array.slice(n*tupleLength,n*tupleLength+tupleLength);},array);}var permutations=function(){function computePermutations(restArray,values){return!restArray.length?[values]:flatmap(restArray,function(ea,i){return computePermutations(restArray.slice(0,i).concat(restArray.slice(i+1)),values.concat([ea]));});}return function(array){return computePermutations(array,[]);};}();function combinationsPick(listOfListsOfValues,pickIndices){// Given a "listOfListsOfValues" in the form of an array of arrays and
// `pickIndices` list with the size of the number of arrays which indicates what
// values to pick from each of the arrays, return a list with two values:
// 1. values picked from each of the arrays, 2. the next pickIndices or null if at end
// Example:
//  var searchSpace = [["a", "b", "c"], [1,2]];
//  arr.combinationsPick(searchSpace, [0,1]);
//    // => [["a",2], [1,0]]
//  arr.combinationsPick(searchSpace, [1,0]);
//    // => [["b",1], [1,1]]
var values=listOfListsOfValues.map(function(subspace,i){return subspace[pickIndices[i]];});var nextState=pickIndices.slice();for(var _i12=listOfListsOfValues.length;_i12--;_i12>=0){var subspace=listOfListsOfValues[_i12];var nextIndex=nextState[_i12]+1;if(subspace[nextIndex]){nextState[_i12]=nextIndex;break;}else if(_i12===0){nextState=undefined;break;}else{nextState[_i12]=0;}}return[values,nextState];}function combinations(listOfListsOfValues){// Given a "listOfListsOfValues" in the form of an array of arrays,
// retrieve all the combinations by picking one item from each array.
// This basically creates a search tree, traverses it and gathers all node
// values whenever a leaf node is reached.
// Example:
//   lively.lang.arr.combinations([['a', 'b', 'c'], [1, 2]])
//    // => [["a", 1], ["a", 2], ["b", 1], ["b", 2], ["c", 1], ["c", 2]]
var size=listOfListsOfValues.reduce(function(prod,space){return prod*space.length;},1);var searchState=listOfListsOfValues.map(function(_){return 0;});var results=new Array(size);for(var _i13=0;_i13<size;_i13++){var result=combinationsPick(listOfListsOfValues,searchState);results[_i13]=result[0];searchState=result[1];}return results;}function take(arr,n){return arr.slice(0,n);}function drop(arr,n){return arr.slice(n);}function takeWhile(arr,fun,context){var i=0;for(;i<arr.length;i++){if(!fun.call(context,arr[i],i))break;}return arr.slice(0,i);}function dropWhile(arr,fun,context){var i=0;for(;i<arr.length;i++){if(!fun.call(context,arr[i],i))break;}return arr.slice(i);}// -=-=-=-=-=-
// randomness
// -=-=-=-=-=-
function shuffle(array){// Ramdomize the order of elements of array. Does not mutate array.
// Example:
// shuffle([1,2,3,4,5]) // => [3,1,2,5,4]
var unusedIndexes=range(0,array.length-1);var shuffled=Array(array.length);for(var _i14=0;_i14<array.length;_i14++){var shuffledIndex=unusedIndexes.splice(Math.round(Math.random()*(unusedIndexes.length-1)),1);shuffled[shuffledIndex]=array[_i14];}return shuffled;}// -=-=-=-=-=-=-=-
// Number related
// -=-=-=-=-=-=-=-
function max(array,iterator,context){// Example:
//   var array = [{x:3,y:2}, {x:5,y:1}, {x:1,y:5}];
//   arr.max(array, function(ea) { return ea.x; }) // => {x: 5, y: 1}
iterator=iterator||function(x){return x;};var result;array.reduce(function(max,ea,i){var val=iterator.call(context,ea,i);if(typeof val!=='number'||val<=max)return max;result=ea;return val;},-Infinity);return result;}function min(array,iterator,context){// Similar to `arr.max`.
iterator=iterator||function(x){return x;};return max(array,function(ea,i){return-iterator.call(context,ea,i);});}function sum(array){// show-in-doc
var sum=0;for(var _i15=0;_i15<array.length;_i15++){sum+=array[_i15];}return sum;}function count(array,item){return array.reduce(function(count,ea){return ea===item?count+1:count;},0);}function size(array){return array.length;}function histogram(data,binSpec){// ignore-in-doc
// Without a `binSpec` argument partition the data
// var numbers = arr.genN(10, num.random);
// var numbers = arr.withN(10, "a");
// => [65,73,34,94,92,31,27,55,95,48]
// => [[65,73],[34,94],[92,31],[27,55],[95,48]]
// => [[82,50,16],[25,43,77],[40,64,31],[51,39,13],[17,34,87],[51,33,30]]
if(typeof binSpec==='undefined'||typeof binSpec==='number'){var binNumber=binSpec||function sturge(){return Math.ceil(Math.log(data.length)/Math.log(2)+1);}();var binSize=Math.ceil(Math.round(data.length/binNumber));return range(0,binNumber-1).map(function(i){return data.slice(i*binSize,(i+1)*binSize);});}else if(binSpec instanceof Array){// ignore-in-doc
// bins specifies n threshold values that will create n-1 bins.
// Each data value d is placed inside a bin i if:
// threshold[i] >= d && threshold[i+1] < d
var thresholds=binSpec;return data.reduce(function(bins,d){if(d<thresholds[1]){bins[0].push(d);return bins;}for(var _i16=1;_i16<thresholds.length;_i16++){if(d>=thresholds[_i16]&&(!thresholds[_i16+1]||d<=thresholds[_i16+1])){bins[_i16].push(d);return bins;}}throw new Error("Histogram creation: Cannot group data ".concat(d," into thresholds ").concat(thresholds));},range(1,thresholds.length).map(function(){return[];}));}}// -=-=-=-=-
// Copying
// -=-=-=-=-
function clone(array){// shallow copy
return[].concat(array);}// -=-=-=-=-=-
// conversion
// -=-=-=-=-=-
function toArray(array){return from(array);}// -=-=-=-=-=-
// DEPRECATED
// -=-=-=-=-=-
function each(arr,iterator,context){return arr.forEach(iterator,context);}function all(arr,iterator,context){return arr.every(iterator,context);}function any(arr,iterator,context){return arr.some(iterator,context);}function collect(arr,iterator,context){return arr.map(iterator,context);}function findAll(arr,iterator,context){return filter(arr,iterator,context);}function inject(array,memo,iterator,context){if(context)iterator=iterator.bind(context);return array.reduce(iterator,memo);}// asynch methods
function mapAsyncSeries(array,iterator,callback){// Apply `iterator` over `array`. Unlike `mapAsync` the invocation of
// the iterator happens step by step in the order of the items of the array
// and not concurrently.
// ignore-in-doc
// Could simply be:
// return exports.arr.mapAsync(array, {parallel: 1}, iterator, callback);
// but the version below is 2x faster
var result=[];var callbackTriggered=false;return array.reduceRight(function(nextFunc,ea,idx){if(callbackTriggered)return;return function(err,eaResult){if(err)return maybeDone(err);if(idx>0)result.push(eaResult);try{iterator(ea,idx,once(nextFunc));}catch(e){maybeDone(e);}};},function(err,eaResult){result.push(eaResult);maybeDone(err,true);})();function maybeDone(err,finalCall){if(callbackTriggered||!err&&!finalCall)return;callbackTriggered=true;try{callback(err,result);}catch(e){console.error('Error in mapAsyncSeries - callback invocation error:\n'+(e.stack||e));}}}function mapAsync(array,options,iterator,callback){// Apply `iterator` over `array`. In each iterator gets a callback as third
// argument that should be called when the iteration is done. After all
// iterators have called their callbacks, the main `callback` function is
// invoked with the result array.
// Example:
// lively.lang.arr.mapAsync([1,2,3,4],
//   function(n, i, next) { setTimeout(function() { next(null, n + i); }, 20); },
//   function(err, result) { /* result => [1,3,5,7] */ });
if(typeof options==='function'){callback=iterator;iterator=options;options=null;}options=options||{};if(!array.length)return callback&&callback(null,[]);if(!options.parallel)options.parallel=Infinity;var results=[];var completed=[];var callbackTriggered=false;var lastIteratorIndex=0;var nActive=0;var iterators=array.map(function(item,i){return function(){nActive++;try{iterator(item,i,once(function(err,result){results[i]=err||result;maybeDone(i,err);}));}catch(e){maybeDone(i,e);}};});return activate();// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function activate(){while(nActive<options.parallel&&lastIteratorIndex<array.length){iterators[lastIteratorIndex++]();}}function maybeDone(idx,err){if(completed.indexOf(idx)>-1)return;completed.push(idx);nActive--;if(callbackTriggered)return;if(!err&&completed.length<array.length){activate();return;}callbackTriggered=true;try{callback&&callback(err,results);}catch(e){console.error('Error in mapAsync - main callback invocation error:\n'+(e.stack||e));}}}// poly-filling...
if(!features.from)Array.from=from;if(!features.filter)Array.prototype.filter=function(it,ctx){return filter(this,it,ctx);};if(!features.find)Array.prototype.find=function(it,ctx){return detect(this,it,ctx);};if(!features.findIndex)Array.prototype.findIndex=function(it,ctx){return findIndex(this,it,ctx);};if(!features.includes)Array.prototype.includes=function(x){return includes(this,x);};var arr=/*#__PURE__*/Object.freeze({__proto__:null,range:range,from:from,withN:withN,genN:genN,filter:filter,detect:detect,binarySearchFor:binarySearchFor,findIndex:findIndex,findAndGet:findAndGet,filterByKey:filterByKey,grep:grep,mask:mask,reject:reject,rejectByKey:rejectByKey,without:without,withoutAll:withoutAll,uniq:uniq,uniqBy:uniqBy,uniqByKey:uniqByKey,compact:compact,mutableCompact:mutableCompact,forEach:forEach,zip:zip,flatten:flatten,flatmap:flatmap,interpose:interpose,delimWith:delimWith,map:map,invoke:invoke,pluck:pluck,reduce:reduce,reduceRight:reduceRight,isArray:isArray,includes:includes,include:include,some:some,every:every,equals:equals,deepEquals:deepEquals,isSorted:isSorted,sort:sort,sortBy:sortBy,sortByKey:sortByKey,reverse:reverse,reversed:reversed,reMatches:reMatches,first:first,last:last,intersect:intersect,union:union,pushAt:pushAt,removeAt:removeAt,remove:_remove4,pushAll:pushAll,pushAllAt:pushAllAt,pushIfNotIncluded:pushIfNotIncluded,replaceAt:replaceAt,clear:clear,isSubset:isSubset,doAndContinue:doAndContinue,nestedDelay:nestedDelay,forEachShowingProgress:forEachShowingProgress,swap:swap,rotate:rotate,groupBy:groupBy,groupByKey:groupByKey,partition:partition,batchify:batchify,toTuples:toTuples,permutations:permutations,combinationsPick:combinationsPick,combinations:combinations,take:take,drop:drop,takeWhile:takeWhile,dropWhile:dropWhile,shuffle:shuffle,max:max,min:min,sum:sum,count:count,size:size,histogram:histogram,clone:clone,toArray:toArray,each:each,all:all,any:any,collect:collect,findAll:findAll,inject:inject,mapAsyncSeries:mapAsyncSeries,mapAsync:mapAsync});/* global clearTimeout, setTimeout */ // -=-=-=-=-=-=-=-=-
// static functions
// -=-=-=-=-=-=-=-=-
function Empty(){/* `function() {}` */return function(){};}function K(){/* `function(arg) { return arg; }` */return function(arg){return arg;};}function Null(){/* `function() { return null; }` */return function(){return null;};}function False(){/* `function() { return false; }` */return function(){return false;};}function True(){/* `function() { return true; }` */return function(){return true;};}function notYetImplemented(){return function(){throw new Error('Not yet implemented');};}// -=-=-=-=-=-
// accessing
// -=-=-=-=-=-
function all$1(object){// Returns all property names of `object` that reference a function.
// Example:
// var obj = {foo: 23, bar: function() { return 42; }};
// all(obj) // => ["bar"]
var a=[];for(var name in object){if(!object.__lookupGetter__(name)&&typeof object[name]==='function')a.push(name);}return a;}function own(object){// Returns all local (non-prototype) property names of `object` that
// reference a function.
// Example:
// var obj1 = {foo: 23, bar: function() { return 42; }};
// var obj2 = {baz: function() { return 43; }};
// obj2.__proto__ = obj1
// own(obj2) // => ["baz"]
// /*vs.*/ all(obj2) // => ["baz","bar"]
var a=[];for(var name in object){if(!object.__lookupGetter__(name)&&object.hasOwnProperty(name)&&typeof object[name]==='function')a.push(name);}return a;}// -=-=-=-=-=-
// inspection
// -=-=-=-=-=-
function argumentNames(f){// Example:
// argumentNames(function(arg1, arg2) {}) // => ["arg1","arg2"]
// argumentNames(function(/*var args*/) {}) // => []
if(f.superclass)return[];// it's a class...
var src=f.toString();var names='';var arrowMatch=src.match(/(?:\(([^\)]*)\)|([^\(\)-+!]+))\s*=>/);if(arrowMatch)names=arrowMatch[1]||arrowMatch[2]||'';else{var headerMatch=src.match(/^[\s\(]*function[^(]*\(([^)]*)\)/);if(headerMatch&&headerMatch[1])names=headerMatch[1];}return names.replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,'').replace(/\s+/g,'').split(',').map(function(ea){return ea.trim();}).filter(function(name){return!!name;});}function qualifiedMethodName(f){// ignore-in-doc
var objString='';if(f.declaredClass){objString+=f.declaredClass+'>>';}else if(f.declaredObject){objString+=f.declaredObject+'.';}return objString+(f.methodName||f.displayName||f.name||'anonymous');}function extractBody(func){// superflous indent. Useful when you have to stringify code but not want
// to construct strings by hand.
// Example:
// extractBody(function(arg) {
//   var x = 34;
//   alert(2 + arg);
// }) => "var x = 34;\nalert(2 + arg);"
var codeString=String(func).replace(/^function[^\{]+\{\s*/,'').replace(/\}$/,'').trim();var lines=codeString.split(/\n|\r/);var indent;for(var _i17=0;_i17<lines.length;_i17++){var _m=lines[_i17].match(/^(\s+)[^\s]/);if(_m&&(indent===undefined||_m[1].length<indent.length))indent=_m[1];}return indent?codeString.replace(new RegExp('^'+indent,'gm'),''):codeString;}// -=-=-=-
// timing
// -=-=-=-
function timeToRun(func){// returns synchronous runtime of calling `func` in ms
// Example:
// timeToRun(function() { new WebResource("http://google.de").beSync().get() });
// // => 278 (or something else...)
var startTime=Date.now();func();return Date.now()-startTime;}function timeToRunN(func,n){// Like `timeToRun` but calls function `n` times instead of once. Returns
// the average runtime of a call in ms.
var startTime=Date.now();for(var _i18=0;_i18<n;_i18++){func();}return(Date.now()-startTime)/n;}function delay(func,timeout/*, arg1...argN */){// Delays calling `func` for `timeout` seconds(!).
// Example:
// (function() { alert("Run in the future!"); }).delay(1);
var args=Array.prototype.slice.call(arguments);var __method=args.shift();var timeout=args.shift()*1000;return setTimeout(function delayed(){return __method.apply(__method,args);},timeout);}// these last two methods are Underscore.js 1.3.3 and are slightly adapted
// Underscore.js license:
// (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
// Underscore is distributed under the MIT license.
function throttle(func,wait){// Exec func at most once every wait ms even when called more often
// useful to calm down eagerly running updaters and such.
// Example:
// var i = 0;
// var throttled = throttle(function() { alert(++i + '-' + Date.now()) }, 500);
// Array.range(0,100).forEach(function(n) { throttled() });
var context;var args;var timeout;var throttling;var more;var result;var whenDone=debounce(wait,function(){more=throttling=false;});return function(){context=this;args=arguments;var later=function later(){timeout=null;if(more)func.apply(context,args);whenDone();};if(!timeout)timeout=setTimeout(later,wait);if(throttling){more=true;}else{result=func.apply(context,args);}whenDone();throttling=true;return result;};}function debounce(wait,func,immediate){// Call `func` after `wait` milliseconds elapsed since the last invocation.
// Unlike `throttle` an invocation will restart the wait period. This is
// useful if you have a stream of events that you want to wait for to finish
// and run a subsequent function afterwards. When you pass arguments to the
// debounced functions then the arguments from the last call will be use for
// the invocation.
//
// With `immediate` set to true, immediately call `func` but when called again during `wait` before
// wait ms are done nothing happens. E.g. to not exec a user invoked
// action twice accidentally.
// Example:
// var start = Date.now();
// var f = debounce(200, function(arg1) {
//   alert("running after " + (Date.now()-start) + "ms with arg " + arg1);
// });
// f("call1");
// delay(curry(f, "call2"), 0.1);
// delay(curry(f, "call3"), 0.15);
// => Will eventually output: "running after 352ms with arg call3"
var timeout;return function(){var context=this;var args=arguments;var later=function later(){timeout=null;if(!immediate)func.apply(context,args);};if(immediate&&!timeout)func.apply(context,args);clearTimeout(timeout);timeout=setTimeout(later,wait);};}var _throttledByName={};function throttleNamed(name,wait,func){// Like `throttle` but remembers the throttled function once created and
// repeated calls to `throttleNamed` with the identical name will use the same
// throttled function. This allows to throttle functions in a central place
// that might be called various times in different contexts without having to
// manually store the throttled function.
var store=_throttledByName;if(store[name])return store[name];function throttleNamedWrapper(){// ignore-in-doc, cleaning up
debounceNamed(name,wait,function(){delete store[name];})();return func.apply(this,arguments);}return store[name]=throttle(throttleNamedWrapper,wait);}var _debouncedByName={};function debounceNamed(name,wait,func,immediate){// Like `debounce` but remembers the debounced function once created and
// repeated calls to `debounceNamed` with the identical name will use the same
// debounced function. This allows to debounce functions in a central place
// that might be called various times in different contexts without having to
// manually store the debounced function.
var store=_debouncedByName;if(store[name])return store[name];function debounceNamedWrapper(){// ignore-in-doc, cleaning up
delete store[name];return func.apply(this,arguments);}return store[name]=debounce(wait,debounceNamedWrapper,immediate);}var _queues={};function createQueue(id,workerFunc){// A simple queue with an attached asynchronous `workerFunc` to process
// queued tasks. Calling `createQueue` will return an object with the
// following interface:
// ```js
// {
//   push: function(task) {/**/},
//   pushAll: function(tasks) {/**/},
//   handleError: function(err) {}, // Overwrite to handle errors
//   drain: function() {}, // Overwrite to react when the queue empties
// }
// Example:
// var sum = 0;
// var q = createQueue("example-queue", function(arg, thenDo) { sum += arg; thenDo(); });
// q.pushAll([1,2,3]);
// queues will be remembered by their name
// createQueue("example-queue").push(4);
// sum // => 6
var store=_queues;var queue=store[id]||(store[id]={_workerActive:false,worker:workerFunc,tasks:[],drain:null,// can be overwritten by a function
push:function push(task){queue.tasks.push(task);if(!queue._workerActive)queue.activateWorker();},pushAll:function pushAll(tasks){tasks.forEach(function(ea){queue.tasks.push(ea);});if(!queue._workerActive)queue.activateWorker();},pushNoActivate:function pushNoActivate(task){queue.tasks.push(task);},handleError:function handleError(err){// can be overwritten
err&&console.error('Error in queue: '+err);},activateWorker:function activateWorker(){function callback(err){queue.handleError(err);queue.activateWorker();}var tasks=queue.tasks;var active=queue._workerActive;if(tasks.length===0){if(active){queue._workerActive=false;if(typeof queue.drain==='function')queue.drain();}delete store[id];}else{if(!active)queue._workerActive=true;try{queue.worker(tasks.shift(),callback);}catch(err){callback(err);}}}});return queue;}var _queueUntilCallbacks={};function workerWithCallbackQueue(id,workerFunc,optTimeout){// This functions helps when you have a long running computation that
// multiple call sites (independent from each other) depend on. This
// function does the housekeeping to start the long running computation
// just once and returns an object that allows to schedule callbacks
// once the workerFunc is done.
// Example:
// var worker = workerWithCallbackQueue("example",
//   function slowFunction(thenDo) {
//     var theAnswer = 42;
//     setTimeout(function() { thenDo(null, theAnswer); });
//   });
// // all "call sites" depend on `slowFunction` but don't have to know about
// // each other
// worker.whenDone(function callsite1(err, theAnswer) { alert("callback1: " + theAnswer); })
// worker.whenDone(function callsite2(err, theAnswer) { alert("callback2: " + theAnswer); })
// workerWithCallbackQueue("example").whenDone(function callsite3(err, theAnswer) { alert("callback3: " + theAnswer); })
// // => Will eventually show: callback1: 42, callback2: 42 and callback3: 42
// ignore-in-doc
// This is how it works:
// If `id` does not exist, workerFunc is called, otherwise ignored.
// workerFunc is expected to call thenDoFunc with arguments: error, arg1, ..., argN
// if called subsequently before workerFunc is done, the other thenDoFunc
// will "pile up" and called with the same arguments as the first
// thenDoFunc once workerFunc is done
var store=_queueUntilCallbacks;var queueCallbacks=store[id];var isRunning=!!queueCallbacks;if(isRunning)return queueCallbacks;var callbacksRun=false;var canceled=false;function cleanup(){if(timeoutProc)clearTimeout(timeoutProc);callbacksRun=true;delete store[id];}function runCallbacks(args){if(callbacksRun)return;cleanup();queueCallbacks.callbacks.forEach(function(cb){try{cb.apply(null,args);}catch(e){console.error('Error when invoking callbacks in queueUntil ['+id+']:\n'+String(e.stack||e));}});}// timeout
if(optTimeout){var timeoutProc=setTimeout(function(){if(callbacksRun)return;runCallbacks([new Error('timeout')]);},optTimeout);}// init the store
queueCallbacks=store[id]={callbacks:[],cancel:function cancel(){canceled=true;cleanup();},whenDone:function whenDone(cb){queueCallbacks.callbacks.push(cb);return queueCallbacks;}};// call worker, but delay so we can immediately return
setTimeout(function(){if(canceled)return;try{workerFunc(function()/* args */{runCallbacks(arguments);});}catch(e){runCallbacks([e]);}},0);return queueCallbacks;}function _composeAsyncDefaultEndCallback(err,arg1/* err + args */){if(err)console.error('lively.lang.composeAsync error',err);}function composeAsync()/* functions */{// Composes functions that are asynchronous and expecting continuations to
// be called in node.js callback style (error is first argument, real
// arguments follow).
// A call like `composeAsync(f,g,h)(arg1, arg2)` has a flow of control like:
//  `f(arg1, arg2, thenDo1)` -> `thenDo1(err, fResult)`
// -> `g(fResult, thenDo2)` -> `thenDo2(err, gResult)` ->
// -> `h(fResult, thenDo3)` -> `thenDo2(err, hResult)`
// Example:
// composeAsync(
//   function(a,b, thenDo) { thenDo(null, a+b); },
//   function(x, thenDo) { thenDo(x*4); }
//  )(3,2, function(err, result) { alert(result); });
var toArray=Array.prototype.slice;var functions=toArray.call(arguments);var defaultEndCb=_composeAsyncDefaultEndCallback;var endCallback=defaultEndCb;var endSuccess;var endFailure;var endPromise=new Promise(function(resolve,reject){endSuccess=resolve;endFailure=reject;});return functions.reverse().reduce(function(prevFunc,funcOrPromise,i){var nextActivated=false;return function(){var args=toArray.call(arguments);// ignore-in-doc
// the last arg needs to be function, discard all non-args
// following it. This allows to have an optional callback func that can
// even be `undefined`, e.g. when calling this func from a callsite
// using var args;
if(endCallback===defaultEndCb&&i===functions.length-1/* first function */){while(args.length&&typeof args[args.length-1]!=='function'){args.pop();}if(typeof args[args.length-1]==='function')endCallback=args.pop();}function next()/* err and args */{nextActivated=true;var args=toArray.call(arguments);var err=args.shift();if(err){endCallback(err);endFailure(err);}else prevFunc.apply(null,args);}if(typeof funcOrPromise==='function'){try{var result=funcOrPromise.apply(this,args.concat([next]));if(result&&typeof result.then==='function'&&typeof result["catch"]==='function'){result.then(function(value){return next(null,value);})["catch"](function(err){return next(err);});}}catch(e){console.error('composeAsync: ',e.stack||e);if(!nextActivated){endCallback(e);endFailure(e);}}}else if(funcOrPromise&&typeof funcOrPromise.then==='function'&&typeof funcOrPromise["catch"]==='function'){funcOrPromise.then(function(value){next(null,value);})["catch"](function(err){next(err);});}else{var err=new Error('Invalid argument to composeAsync: '+funcOrPromise);endCallback(err);endFailure(err);}return endPromise;};},function(){var args=toArray.call(arguments);endCallback.apply(null,[null].concat(args));endSuccess(args[0]);});}function compose()/* functions */{// Composes synchronousefunctions:
// `compose(f,g,h)(arg1, arg2)` = `h(g(f(arg1, arg2)))`
// Example:
// compose(
//   function(a,b) { return a+b; },
//   function(x) {return x*4}
// )(3,2) // => 20
var functions=Array.prototype.slice.call(arguments);return functions.reverse().reduce(function(prevFunc,func){return function(){return prevFunc(func.apply(this,arguments));};},function(x){return x;});}function flip(f){// Swaps the first two args
// Example:
// flip(function(a, b, c) {
//   return a + b + c; })(' World', 'Hello', '!') // => "Hello World!"
return function flipped()/* args */{var args=Array.prototype.slice.call(arguments);var flippedArgs=[args[1],args[0]].concat(args.slice(2));return f.apply(null,flippedArgs);};}function withNull(func){// returns a modified version of func that will have `null` always curried
// as first arg. Usful e.g. to make a nodejs-style callback work with a
// then-able:
// Example:
// promise.then(withNull(cb)).catch(cb);
func=func||function(){};return function()/* args */{var args=from(arguments);func.apply(null,[null].concat(args));};}function waitFor(timeoutMs,waitTesterFunc,thenDo){// Wait for waitTesterFunc to return true, then run thenDo, passing
// failure/timout err as first parameter. A timout occurs after
// timeoutMs. During the wait period waitTesterFunc might be called
// multiple times.
var start=Date.now();var timeStep=50;if(!thenDo){thenDo=waitTesterFunc;waitTesterFunc=timeoutMs;timeoutMs=undefined;}(function test(){if(waitTesterFunc())return thenDo();if(timeoutMs){var duration=Date.now()-start;var timeLeft=timeoutMs-duration;if(timeLeft<=0)return thenDo(new Error('timeout'));if(timeLeft<timeStep)timeStep=timeLeft;}setTimeout(test,timeStep);})();}function waitForAll(options,funcs,thenDo){// Wait for multiple asynchronous functions. Once all have called the
// continuation, call `thenDo`.
// options can be: `{timeout: NUMBER}` (how long to wait in milliseconds).
if(!thenDo){thenDo=funcs;funcs=options;options=null;}options=options||{};var results=funcs.map(function(){return null;});if(!funcs.length){thenDo(null,results);return;}var leftFuncs=Array.prototype.slice.call(funcs);funcs.forEach(function(f,i){try{f(function()/* err and args */{var args=Array.prototype.slice.call(arguments);var err=args.shift();markAsDone(f,i,err,args);});}catch(e){markAsDone(f,i,e,null);}});if(options.timeout){setTimeout(function(){if(!leftFuncs.length)return;var missing=results.map(function(ea,i){return ea===null&&i;}).filter(function(ea){return typeof ea==='number';}).join(', ');var err=new Error('waitForAll timed out, functions at '+missing+' not done');markAsDone(null,null,err,null);},options.timeout);}function markAsDone(f,i,err,result){if(!leftFuncs.length)return;var waitForAllErr=null;var fidx=leftFuncs.indexOf(f);fidx>-1&&leftFuncs.splice(fidx,1);if(err){leftFuncs.length=0;waitForAllErr=new Error('in waitForAll at'+(typeof i==='number'?' '+i:'')+': \n'+(err.stack||String(err)));}else if(result)results[i]=result;if(!leftFuncs.length){setTimeout(function(){thenDo(waitForAllErr,results);},0);}}}// -=-=-=-=-
// wrapping
// -=-=-=-=-
function curry(func,arg1,arg2,argN/* func and curry args */){// Return a version of `func` with args applied.
// Example:
// var add1 = (function(a, b) { return a + b; }).curry(1);
// add1(3) // => 4
if(arguments.length<=1)return arguments[0];var args=Array.prototype.slice.call(arguments);var func=args.shift();function wrappedFunc(){return func.apply(this,args.concat(Array.prototype.slice.call(arguments)));}wrappedFunc.isWrapper=true;wrappedFunc.originalFunction=func;return wrappedFunc;}function wrap(func,wrapper){// A `wrapper` is another function that is being called with the arguments
// of `func` and a proceed function that, when called, runs the originally
// wrapped function.
// Example:
// function original(a, b) { return a+b }
// var wrapped = wrap(original, function logWrapper(proceed, a, b) {
//   alert("original called with " + a + "and " + b);
//   return proceed(a, b);
// })
// wrapped(3,4) // => 7 and a message will pop up
var __method=func;var wrappedFunc=function wrapped(){var args=Array.prototype.slice.call(arguments);var wrapperArgs=wrapper.isWrapper?args:[__method.bind(this)].concat(args);return wrapper.apply(this,wrapperArgs);};wrappedFunc.isWrapper=true;wrappedFunc.originalFunction=__method;return wrappedFunc;}function getOriginal(func){// Get the original function that was augmented by `wrap`. `getOriginal`
// will traversed as many wrappers as necessary.
while(func.originalFunction){func=func.originalFunction;}return func;}function wrapperChain(method){// Function wrappers used for wrapping, cop, and other method
// manipulations attach a property "originalFunction" to the wrapper. By
// convention this property references the wrapped method like wrapper
// -> cop wrapper -> real method.
// tThis method gives access to the linked list starting with the outmost
// wrapper.
var result=[];do{result.push(method);method=method.originalFunction;}while(method);return result;}function replaceMethodForOneCall(obj,methodName,replacement){// Change an objects method for a single invocation.
// Example:
// var obj = {foo: function() { return "foo"}};
// lively.lang.replaceMethodForOneCall(obj, "foo", function() { return "bar"; });
// obj.foo(); // => "bar"
// obj.foo(); // => "foo"
replacement.originalFunction=obj[methodName];var reinstall=obj.hasOwnProperty(methodName);obj[methodName]=function(){if(reinstall)obj[methodName]=replacement.originalFunction;else delete obj[methodName];return replacement.apply(this,arguments);};return obj;}function once(func){// Ensure that `func` is only executed once. Multiple calls will not call
// `func` again but will return the original result.
if(!func)return undefined;if(typeof func!=='function'){throw new Error('once() expecting a function');}var invoked=false;var result;return function(){if(invoked)return result;invoked=true;return result=func.apply(this,arguments);};}function either()/* funcs */{// Accepts multiple functions and returns an array of wrapped
// functions. Those wrapped functions ensure that only one of the original
// function is run (the first on to be invoked).
//
// This is useful if you have multiple asynchronous choices of how the
// control flow might continue but want to ensure that a continuation
// is  only triggered once, like in a timeout situation:
//
// ```js
// function outerFunction(callback) {
//   function timeoutAction() { callback(new Error('timeout!')); }
//   function otherAction() { callback(null, "All OK"); }
//   setTimeout(timeoutAction, 200);
//   doSomethingAsync(otherAction);
// }
// ```
//
// To ensure that `callback` only runs once you would normally have to write boilerplate like this:
//
// ```js
// var ran = false;
// function timeoutAction() { if (ran) return; ran = true; callback(new Error('timeout!')); }
// function otherAction() { if (ran) return; ran = true; callback(null, "All OK"); }
// ```
//
// Since this can get tedious an error prone, especially if more than two choices are involved, `either` can be used like this:
// Example:
// function outerFunction(callback) {
//   var actions = either(
//     function() { callback(new Error('timeout!')); },
//     function() { callback(null, "All OK"); });
//   setTimeout(actions[0], 200);
//   doSomethingAsync(actions[1]);
// }
var funcs=Array.prototype.slice.call(arguments);var wasCalled=false;return funcs.map(function(func){return function(){if(wasCalled)return undefined;wasCalled=true;return func.apply(this,arguments);};});}var _eitherNameRegistry={};function eitherNamed(name,func){// Works like [`either`](#) but usage does not require to wrap all
// functions at once:
// Example:
// var log = "", name = "either-example-" + Date.now();
// function a() { log += "aRun"; };
// function b() { log += "bRun"; };
// function c() { log += "cRun"; };
// setTimeout(eitherNamed(name, a), 100);
// setTimeout(eitherNamed(name, b), 40);
// setTimeout(eitherNamed(name, c), 80);
// setTimeout(function() { alert(log); /* => "bRun" */ }, 150);
var funcs=Array.prototype.slice.call(arguments);var registry=_eitherNameRegistry;var name=funcs.shift();var eitherCall=registry[name]||(registry[name]={wasCalled:false,callsLeft:0});eitherCall.callsLeft++;return function(){eitherCall.callsLeft--;// cleanup the storage if all registered functions fired
if(eitherCall.callsLeft<=0)delete registry[name];if(eitherCall.wasCalled)return undefined;eitherCall.wasCalled=true;return func.apply(this,arguments);};}// -=-=-=-=-
// creation
// -=-=-=-=-
function evalJS(src){return eval(src);}function fromString(funcOrString){// Example:
// fromString("function() { return 3; }")() // => 3
return evalJS('('+funcOrString.toString()+');');}function asScript(func,optVarMapping){// Lifts `func` to become a `Closure`, that is that free variables referenced
// in `func` will be bound to the values of an object that can be passed in as
// the second parameter. Keys of this object are mapped to the free variables.
//
// Please see [`Closure`](#) for a more detailed explanation and examples.
return Closure.fromFunction(func,optVarMapping).recreateFunc();}function asScriptOf(f,obj,optName,optMapping){// Like `asScript` but makes `f` a method of `obj` as `optName` or the name
// of the function.
var name=optName||f.name;if(!name){throw Error('Function that wants to be a script needs a name: '+this);}var proto=Object.getPrototypeOf(obj);var mapping={"this":obj};if(optMapping)mapping=merge([mapping,optMapping]);if(proto&&proto[name]){var superFunc=function superFunc(){try{// FIXME super is supposed to be static
return Object.getPrototypeOf(obj)[name].apply(obj,arguments);}catch(e){if(typeof $world!=='undefined')$world.logError(e,'Error in $super call');else console.error('Error in $super call: '+e+'\n'+e.stack);return null;}};mapping.$super=Closure.fromFunction(superFunc,{obj:obj,name:name}).recreateFunc();}return addToObject(asScript(f,mapping),obj,name);}// -=-=-=-=-=-=-=-=-
// closure related
// -=-=-=-=-=-=-=-=-
function addToObject(f,obj,name){// ignore-in-doc
f.displayName=name;var methodConnections=obj.attributeConnections?obj.attributeConnections.filter(function(con){return con.getSourceAttrName()==='update';}):[];if(methodConnections){methodConnections.forEach(function(ea){ea.disconnect();});}obj[name]=f;if(_typeof2(obj))f.declaredObject=safeToString(obj);// suppport for tracing
if(typeof lively!=='undefined'&&obj&&lively.Tracing&&lively.Tracing.stackTracingEnabled){lively.Tracing.instrumentMethod(obj,name,{declaredObject:safeToString(obj)});}if(methodConnections){methodConnections.forEach(function(ea){ea.connect();});}return f;}function binds(f,varMapping){// ignore-in-doc
// convenience function
return Closure.fromFunction(f,varMapping||{}).recreateFunc();}function setLocalVarValue(f,name,value){// ignore-in-doc
if(f.hasLivelyClosure)f.livelyClosure.funcProperties[name]=value;}function getVarMapping(f){// ignore-in-doc
if(f.hasLivelyClosure)return f.livelyClosure.varMapping;if(f.isWrapper)return f.originalFunction.varMapping;if(f.varMapping)return f.varMapping;return{};}function setProperty(func,name,value){func[name]=value;if(func.hasLivelyClosure)func.livelyClosure.funcProperties[name]=value;}// -=-=-=-=-=-=-=-=-=-=-=-=-
// class-related functions
// -=-=-=-=-=-=-=-=-=-=-=-=-
function functionNames(klass){// Treats passed function as class (constructor).
// Example:
// var Klass1 = function() {}
// Klass1.prototype.foo = function(a, b) { return a + b; };
// Klass1.prototype.bar = function(a) { return this.foo(a, 3); };
// Klass1.prototype.baz = 23;
// functionNames(Klass1); // => ["bar","foo"]
var result=[];var lookupObj=klass.prototype;while(lookupObj){result=Object.keys(lookupObj).reduce(function(result,name){if(typeof lookupObj[name]==='function'&&result.indexOf(name)===-1){result.push(name);}return result;},result);lookupObj=Object.getPrototypeOf(lookupObj);}return result;}function localFunctionNames(func){return Object.keys(func.prototype).filter(function(name){return typeof func.prototype[name]==='function';});}// -=-=-=-=-=-=-=-=-=-=-
// tracing and logging
// -=-=-=-=-=-=-=-=-=-=-
function logErrors(func,prefix){var advice=function logErrorsAdvice(proceed/*, args */){var args=Array.prototype.slice.call(arguments);args.shift();try{return proceed.apply(func,args);}catch(er){if(typeof lively!=='undefined'&&lively.morphic&&lively.morphic.World&&lively.morphic.World.current()){lively.morphic.World.current().logError(er);throw er;}if(prefix)console.warn('ERROR: %s.%s(%s): err: %s %s',func,prefix,args,er,er.stack||'');else console.warn('ERROR: %s %s',er,er.stack||'');throw er;}};advice.methodName='$logErrorsAdvice';var result=wrap(func,advice);result.originalFunction=func;result.methodName='$logErrorsWrapper';return result;}function logCompletion(func,module){var advice=function logCompletionAdvice(proceed){var args=Array.prototype.slice.call(arguments);args.shift();try{var result=proceed.apply(func,args);}catch(er){console.warn('failed to load '+module+': '+er);if(typeof lively!=='undefined'&&lively.lang.Execution){lively.lang.Execution.showStack();}throw er;}console.log('completed '+module);return result;};advice.methodName='$logCompletionAdvice::'+module;var result=wrap(func,advice);result.methodName='$logCompletionWrapper::'+module;result.originalFunction=func;return result;}function logCalls(func,isUrgent){var original=func;var advice=function logCallsAdvice(proceed){var args=Array.prototype.slice.call(arguments);args.shift(),result=proceed.apply(func,args);if(isUrgent){console.warn('%s(%s) -> %s',qualifiedMethodName(original),args,result);}else{console.log('%s(%s) -> %s',qualifiedMethodName(original),args,result);}return result;};advice.methodName='$logCallsAdvice::'+qualifiedMethodName(func);var result=wrap(func,advice);result.originalFunction=func;result.methodName='$logCallsWrapper::'+qualifiedMethodName(func);return result;}function traceCalls(func,stack){var advice=function traceCallsAdvice(proceed){var args=Array.prototype.slice.call(arguments);args.shift();stack.push(args);var result=proceed.apply(func,args);stack.pop();return result;};return wrap(func,advice);}function webkitStack(){// this won't work in every browser
try{throw new Error();}catch(e){// remove "Error" and this function from stack, rewrite it nicely
return String(e.stack).split(/\n/).slice(2).map(function(line){return line.replace(/^\s*at\s*([^\s]+).*/,'$1');}).join('\n');}}var fun=/*#__PURE__*/Object.freeze({__proto__:null,Empty:Empty,K:K,Null:Null,False:False,True:True,notYetImplemented:notYetImplemented,withNull:withNull,all:all$1,own:own,argumentNames:argumentNames,qualifiedMethodName:qualifiedMethodName,extractBody:extractBody,timeToRun:timeToRun,timeToRunN:timeToRunN,delay:delay,throttle:throttle,debounce:debounce,throttleNamed:throttleNamed,debounceNamed:debounceNamed,createQueue:createQueue,workerWithCallbackQueue:workerWithCallbackQueue,composeAsync:composeAsync,compose:compose,waitFor:waitFor,waitForAll:waitForAll,flip:flip,curry:curry,wrap:wrap,binds:binds,getOriginal:getOriginal,wrapperChain:wrapperChain,replaceMethodForOneCall:replaceMethodForOneCall,once:once,either:either,eitherNamed:eitherNamed,evalJS:evalJS,fromString:fromString,asScript:asScript,asScriptOf:asScriptOf,addToObject:addToObject,setLocalVarValue:setLocalVarValue,getVarMapping:getVarMapping,setProperty:setProperty,functionNames:functionNames,localFunctionNames:localFunctionNames,logErrors:logErrors,logCompletion:logCompletion,logCalls:logCalls,traceCalls:traceCalls,webkitStack:webkitStack});/*
 * Utility functions that help to inspect, enumerate, and create JS objects
 */ // -=-=-=-=-=-=-=-=-
// internal helper
// -=-=-=-=-=-=-=-=-
// serveral methods in lib/object.js are inspired or derived from
// Prototype JavaScript framework, version 1.6.0_rc1
// (c) 2005-2007 Sam Stephenson
// Prototype is freely distributable under the terms of an MIT-style license.
// For details, see the Prototype web site: http://www.prototypejs.org/
function print(object){if(object&&Array.isArray(object)){return'['+object.map(print)+']';}if(typeof object!=='string'){return String(object);}var result=String(object);result=result.replace(/\n/g,'\\n\\\n');result=result.replace(/(")/g,'\\$1');result='\"'+result+'\"';return result;}function indent(str,indentString,depth){if(!depth||depth<=0)return str;while(depth>0){depth--;str=indentString+str;}return str;}var getOwnPropertyDescriptors=typeof Object.getOwnPropertyDescriptors==='function'?Object.getOwnPropertyDescriptors:function getOwnPropertyDescriptors(object){var descriptors={};for(var name in object){if(!Object.prototype.hasOwnProperty.call(object,name))continue;Object.defineProperty(descriptors,name,{configurable:true,enumerable:true,writable:true,value:Object.getOwnPropertyDescriptor(object,name)});}return descriptors;};// show-in-doc
// -=-=-=-=-
// testing
// -=-=-=-=-
function isArray$1(obj){/* show-in-doc */return Array.isArray(obj);}function isElement(object){/* show-in-doc */return object&&object.nodeType==1;}function isFunction(object){/* show-in-doc */return object instanceof Function;}function isBoolean(object){/* show-in-doc */return typeof object==='boolean';}function isString(object){/* show-in-doc */return typeof object==='string';}function isNumber(object){/* show-in-doc */return typeof object==='number';}function isUndefined(object){/* show-in-doc */return typeof object==='undefined';}function isRegExp(object){/* show-in-doc */return object instanceof RegExp;}function isObject(object){/* show-in-doc */return _typeof2(object)==='object';}function isPrimitive(obj){// show-in-doc
if(!obj)return true;switch(_typeof2(obj)){case'string':case'number':case'boolean':return true;}return false;}function isEmpty(object){/* show-in-doc */for(var key in object){if(object.hasOwnProperty(key))return false;}return true;}function equals$1(a,b){// Is object `a` structurally equivalent to object `b`? Deep comparison.
if(a===b)return true;if(!a||!b)return a==b;if(Array.isArray(a))return deepEquals(a,b);switch(a.constructor){case String:case Date:case Boolean:case Number:return a==b;}if(typeof a.isEqualNode==='function')return a.isEqualNode(b);if(typeof a.equals==='function')return a.equals(b);var seenInA=[];for(var name in a){seenInA.push(name);if(typeof a[name]==='function')continue;if(!equals$1(a[name],b[name]))return false;}for(var name in b){if(seenInA.indexOf(name)!==-1)continue;if(typeof b[name]==='function')continue;if(!equals$1(b[name],a[name]))return false;}return true;}// -=-=-=-=-=-
// accessing
// -=-=-=-=-=-
var keys=Object.keys;function values(object){// Example:
// var obj1 = {x: 22}, obj2 = {x: 23, y: {z: 3}};
// obj2.__proto__ = obj1;
// obj.values(obj1) // => [22]
// obj.values(obj2) // => [23,{z: 3}]
return object?Object.keys(object).map(function(k){return object[k];}):[];}function select(obj,keys){// return a new object that copies all properties with `keys` from `obj`
var selected={};for(var _i19=0;_i19<keys.length;_i19++){selected[keys[_i19]]=obj[keys[_i19]];}return selected;}function dissoc(object,keys){object=object||{};var descriptors=getOwnPropertyDescriptors(object);for(var _i20=0;_i20<keys.length;_i20++){if(keys[_i20]in descriptors)delete descriptors[keys[_i20]];}return Object.defineProperties({},descriptors);}function addScript(object,funcOrString,optName,optMapping){var func=fromString(funcOrString);return asScriptOf(func,object,optName,optMapping);}// -=-=-=-=-
// mutation
// -=-=-=-=-
function extend(destination,source){// Add all properties of `source` to `destination`.
// Example:
// var dest = {x: 22}, src = {x: 23, y: 24}
// obj.extend(dest, src);
// dest // => {x: 23,y: 24}
var currentCategoryNames=null;for(var _i21=1;_i21<arguments.length;_i21++){if(typeof arguments[_i21]==='string'){var catName=arguments[_i21];if(!destination.categories)destination.categories={};if(!destination.categories[catName])destination.categories[catName]=[];currentCategoryNames=destination.categories[catName];continue;}var source=arguments[_i21];for(var property in source){var getter=source.__lookupGetter__(property);var setter=source.__lookupSetter__(property);if(getter){destination.__defineGetter__(property,getter);}if(setter){destination.__defineSetter__(property,setter);}if(getter||setter){continue;}var sourceObj=source[property];destination[property]=sourceObj;if(currentCategoryNames){currentCategoryNames.push(property);}if(typeof sourceObj==='function'){if(!sourceObj.displayName){sourceObj.displayName=property;}// remember the module that contains the definition
if(typeof lively!=='undefined'&&lively.Module&&lively.Module.current){sourceObj.sourceModule=lively.Module.current();}}}}return destination;}// -=-=-=-=-
// clone
// -=-=-=-=-
function clone$1(object){// Shallow copy
if(isPrimitive(object))return object;if(Array.isArray(object))return Array.prototype.slice.call(object);var clone={};for(var key in object){if(object.hasOwnProperty(key)){clone[key]=object[key];}}clone.__proto__=object.__proto__;// ensure same proto
return clone;}function extract(object,properties,mapFunc){// Takes a list of properties and returns a new object with those
// properties shallow-copied from object
var copied={};for(var _i22=0;_i22<properties.length;_i22++){if(properties[_i22]in object){copied[properties[_i22]]=mapFunc?mapFunc(properties[_i22],object[properties[_i22]]):object[properties[_i22]];}}return copied;}// -=-=-=-=-=-
// inspection
// -=-=-=-=-=-
function inspect(object,options,depth){// Prints a human-readable representation of `obj`. The printed
// representation will be syntactically correct JavaScript but will not
// necessarily evaluate to a structurally identical object. `inspect` is
// meant to be used while interactivively exploring JavaScript programs and
// state.
//
// `options` can be {
//   printFunctionSource: BOOLEAN,
//   escapeKeys: BOOLEAN,
//   maxDepth: NUMBER,
//   customPrinter: FUNCTION,
//   maxNumberOfKeys: NUMBER
// }
options=options||{};depth=depth||0;if(options.customPrinter){var ignoreSignal=options._ignoreSignal||(options._ignoreSignal={});var continueInspectFn=function continueInspectFn(obj){return inspect(obj,options,depth+1);};var customInspected=options.customPrinter(object,ignoreSignal,continueInspectFn);if(customInspected!==ignoreSignal)return customInspected;}if(!object)return print(object);// print function
if(typeof object==='function'){return options.printFunctionSource?String(object):'function'+(object.name?' '+object.name:'')+'('+argumentNames(object).join(',')+') {/*...*/}';}// print "primitive"
switch(object.constructor){case String:case Boolean:case RegExp:case Number:return print(object);}if(typeof object.serializeExpr==='function'){return object.serializeExpr();}var isArray=object&&Array.isArray(object);var openBr=isArray?'[':'{';var closeBr=isArray?']':'}';if(options.maxDepth&&depth>=options.maxDepth){return openBr+'/*...*/'+closeBr;}var printedProps=[];if(isArray){printedProps=object.map(function(ea){return inspect(ea,options,depth+1);});}else{var propsToPrint=Object.keys(object).sort(function(a,b){var aIsFunc=typeof object[a]==='function';var bIsFunc=typeof object[b]==='function';if(aIsFunc===bIsFunc){if(a<b)return-1;if(a>b)return 1;return 0;}return aIsFunc?1:-1;});for(var _i23=0;_i23<propsToPrint.length;_i23++){if(_i23>(options.maxNumberOfKeys||Infinity)){var hiddenEntryCount=propsToPrint.length-_i23;printedProps.push("...".concat(hiddenEntryCount," hidden ").concat(hiddenEntryCount>1?'entries':'entry',"..."));break;}var key=propsToPrint[_i23];if(isArray)inspect(object[key],options,depth+1);var printedVal=inspect(object[key],options,depth+1);printedProps.push((options.escapeKeys?JSON.stringify(key):key)+': '+printedVal);}}if(printedProps.length===0){return openBr+closeBr;}var printedPropsJoined=printedProps.join(', ');var useNewLines=(!isArray||options.newLineInArrays)&&(!options.minLengthForNewLine||printedPropsJoined.length>=options.minLengthForNewLine);var ind=indent('',options.indent||'  ',depth);var propIndent=indent('',options.indent||'  ',depth+1);var startBreak=useNewLines&&!isArray?'\n'+propIndent:'';var eachBreak=useNewLines?'\n'+propIndent:'';var endBreak=useNewLines&&!isArray?'\n'+ind:'';if(useNewLines)printedPropsJoined=printedProps.join(','+eachBreak);return openBr+startBreak+printedPropsJoined+endBreak+closeBr;}// -=-=-=-=-
// merging
// -=-=-=-=-
function merge(objs){// `objs` can be a list of objects. The return value will be a new object,
// containing all properties of all objects. If the same property exist in
// multiple objects, the right-most property takes precedence.
//
// Like `extend` but will not mutate objects in `objs`.
// if objs are arrays just concat them
// if objs are real objs then merge propertdies
if(arguments.length>1){return merge(Array.prototype.slice.call(arguments));}if(Array.isArray(objs[0])){// test for all?
return Array.prototype.concat.apply([],objs);}return objs.reduce(function(merged,ea){for(var name in ea){if(ea.hasOwnProperty(name)){merged[name]=ea[name];}}return merged;},{});}function deepMerge(objA,objB){// `objs` can be a list of objects. The return value will be a new object,
// containing all properties of all objects. If the same property exist in
// multiple objects, the right-most property takes precedence.
//
// Like `extend` but will not mutate objects in `objs`.
// if objs are arrays just concat them
// if objs are real objs then merge propertdies
if(!objA)return objB;if(!objB)return objA;if(Array.isArray(objA)){if(!Array.isArray(objB))return objB;var merged=objA.map(function(ea,i){return deepMerge(ea,objB[i]);});if(objB.length>objA.length)merged=merged.concat(objB.slice(objA.length));return merged;}if(_typeof2(objA)!=='object'||_typeof2(objB)!=='object')return objB;return Object.keys(objA).concat(Object.keys(objB)).reduce(function(merged,name){if(!objA[name])merged[name]=objB[name];else if(!objB[name])merged[name]=objA[name];else if(_typeof2(objA[name])!=='object'||_typeof2(objB[name])!=='object')merged[name]=objB[name];else merged[name]=deepMerge(objA[name],objB[name]);return merged;},{});}function sortKeysWithBeforeAndAfterConstraints(properties){var throwErrorOnMissing=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var remaining=[];for(var key in properties){var _prop=properties[key];var before=_prop.hasOwnProperty('before')?_prop.before:_prop.before=[];var after=_prop.hasOwnProperty('after')?_prop.after:_prop.after=[];for(var _i24=before.length;_i24--;){var beforePropName=before[_i24];var beforeProp=properties[beforePropName];if(!beforeProp){console.warn("[initializeProperties] ".concat(this," sortProperties: ")+"Property ".concat(key," requires to be initialized before ").concat(beforePropName," ")+'but that property cannot be found.');before.splice(_i24,1);continue;}if(!beforeProp.hasOwnProperty('after'))beforeProp.after=[];beforeProp.after.push(key);}for(var _i25=after.length;_i25--;){var afterPropName=after[_i25];var afterProp=properties[afterPropName];if(!afterProp){console.warn("[initializeProperties] ".concat(this," sortProperties: ")+"Property ".concat(key," requires to be initialized after ").concat(afterPropName," ")+'but that property cannot be found.');after.splice(_i25,1);}}remaining.push(key);}// ignore-in-doc
// compute order
var resolvedGroups=[];var resolvedKeys=[];var lastLength=remaining.length+1;while(remaining.length){if(lastLength===remaining.length){throw new Error('Circular dependencies in handler order, could not resolve properties '+remaining.map(function(key){var before=properties[key].before;var after=properties[key].after;if((!before||!before.length)&&(!after||!after.length))return'';var report="".concat(key,"\n");if(before&&before.length)report+="  - before ".concat(before.join(','),"\n");if(after&&after.length)report+="  - after ".concat(after.join(','),"\n");return report;}).join(''));}lastLength=remaining.length;var resolvedGroup=[];for(var _i26=remaining.length;_i26--;){var _key4=remaining[_i26];if(isSubset(properties[_key4].after,resolvedKeys)){remaining.splice(_i26,1);resolvedKeys.push(_key4);resolvedGroup.push(_key4);}}resolvedGroups.push(resolvedGroup);}return flatten(resolvedGroups,1);}// -=-=-=-=-=-=-
// inheritance
// -=-=-=-=-=-=-
function inherit(obj){return Object.create(obj);}function valuesInPropertyHierarchy(obj,name){// Lookup all properties named name in the proto hierarchy of obj.
// Example:
// var a = {foo: 3}, b = Object.create(a), c = Object.create(b);
// c.foo = 4;
// obj.valuesInPropertyHierarchy(c, "foo") // => [3,4]
var result=[];var lookupObj=obj;while(lookupObj){if(lookupObj.hasOwnProperty(name))result.unshift(lookupObj[name]);lookupObj=Object.getPrototypeOf(lookupObj);}return result;}function mergePropertyInHierarchy(obj,propName){// like `merge` but automatically gets all definitions of the value in the
// prototype chain and merges those.
// Example:
// var o1 = {x: {foo: 23}}, o2 = {x: {foo: 24, bar: 15}}, o3 = {x: {baz: "zork"}};
// o2.__proto__ = o1; o3.__proto__ = o2;
// obj.mergePropertyInHierarchy(o3, "x");
// // => {bar: 15, baz: "zork",foo: 24}
return merge(valuesInPropertyHierarchy(obj,propName));}function deepCopy(object){// Recursively traverses `object` and its properties to create a copy.
if(!object||_typeof2(object)!=='object'||object instanceof RegExp)return object;var result=Array.isArray(object)?Array(object.length):{};for(var key in object){if(object.hasOwnProperty(key)){result[key]=deepCopy(object[key]);}}return result;}// -=-=-=-=-=-=-=-=-
// stringification
// -=-=-=-=-=-=-=-=-
function typeStringOf(obj){// ignore-in-doc
if(obj===null)return'null';if(typeof obj==='undefined')return'undefined';return obj.constructor.name;}function shortPrintStringOf(obj){// ignore-in-doc
// primitive values
if(!isMutableType(obj))return safeToString(obj);// constructed objects
if(obj.constructor.name!=='Object'&&!Array.isArray(obj)){if(obj.constructor.name){return obj.constructor.name?obj.constructor.name:Object.prototype.toString.call(obj).split(' ')[1].split(']')[0];}}// arrays or plain objects
var typeString='';function displayTypeAndLength(obj,collectionType,firstBracket,secondBracket){if(obj.constructor.name===collectionType){typeString+=firstBracket;if(obj.length||Object.keys(obj).length)typeString+='...';typeString+=secondBracket;}}displayTypeAndLength(obj,'Object','{','}');displayTypeAndLength(obj,'Array','[',']');return typeString;}function isMutableType(obj){// Is `obj` a value or mutable type?
var immutableTypes=['null','undefined','Boolean','Number','String'];return immutableTypes.indexOf(typeStringOf(obj))===-1;}function safeToString(obj){// Like `toString` but catches errors.
try{return(obj?obj.toString():String(obj)).replace('\n','');}catch(e){return'<error printing object>';}}function asObject(obj){switch(_typeof2(obj)){case'string':return new String(obj);case'boolean':return new Boolean(obj);case'number':return new Number(obj);default:return obj;}}function newKeyIn(obj){var base=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'_';var i=1;var key;do{key=base+'-'+i++;}while(key in obj);return key;}var obj=/*#__PURE__*/Object.freeze({__proto__:null,isArray:isArray$1,isElement:isElement,isFunction:isFunction,isBoolean:isBoolean,isString:isString,isNumber:isNumber,isUndefined:isUndefined,isRegExp:isRegExp,isObject:isObject,isPrimitive:isPrimitive,isEmpty:isEmpty,equals:equals$1,keys:keys,values:values,select:select,dissoc:dissoc,addScript:addScript,extend:extend,clone:clone$1,extract:extract,inspect:inspect,merge:merge,deepMerge:deepMerge,inherit:inherit,valuesInPropertyHierarchy:valuesInPropertyHierarchy,mergePropertyInHierarchy:mergePropertyInHierarchy,sortKeysWithBeforeAndAfterConstraints:sortKeysWithBeforeAndAfterConstraints,deepCopy:deepCopy,typeStringOf:typeStringOf,shortPrintStringOf:shortPrintStringOf,isMutableType:isMutableType,safeToString:safeToString,asObject:asObject,newKeyIn:newKeyIn,getOwnPropertyDescriptors:getOwnPropertyDescriptors});var exports$1={};// Generated by CoffeeScript 1.10.0
(function(){var a,articlize,arts,_find,n,slice=[].slice;a="a";n="an";arts={0:{8:{_:n},9:{_:n},"-":{1:{1:{_:n}},4:{" ":{_:a},_:n},6:{"-":{_:n}},8:{_:n}}},1:{1:{0:{_:a},1:{_:a},2:{_:a},3:{_:a},4:{_:a},5:{_:a},6:{_:a},7:{_:a},8:{_:a},9:{_:a},_:n,".":{4:{_:a}}},8:{0:{0:{_:n},1:{_:n},2:{_:n},3:{_:n},4:{_:n},5:{_:n},6:{_:n},7:{_:n},8:{_:n},9:{_:n},_:a},1:{"-":{_:a}," ":{_:a}},2:{"-":{_:a}," ":{_:a}},3:{"-":{_:a}," ":{_:a}},4:{"-":{_:a}," ":{_:a}},5:{"-":{_:a}," ":{_:a}},6:{"-":{_:a}," ":{_:a}},7:{"-":{_:a}," ":{_:a}},8:{"-":{_:a}," ":{_:a}},9:{"-":{_:a}," ":{_:a}},_:n}},8:{0:{0:{x:{_:a}}},9:{0:{_:a}},_:n,",":{1:{_:a}}},"`":{a:{_:n}},"\xA3":{8:{_:n}},"\u221E":{_:n},a:{" ":{_:a},b:{o:{u:{t:{"-":{_:n}},_:a}}},g:{a:{i:{_:a}}},l:{"-":{I:{_:a}},g:{u:{_:a}},t:{h:{_:a}}},m:{o:{n:{_:a}}},n:{" ":{_:a},d:{a:{_:n},e:{_:n},r:{_:n},_:a},o:{t:{_:a}},y:{w:{_:a}}},p:{r:{e:{_:a}}},r:{e:{" ":{_:a},":":{_:a}},t:{"\xED":{_:a}}},_:n},A:{$:{_:a},A:{A:{_:a}},n:{d:{a:{l:{u:{c:{_:a}}}}}},r:{m:{a:{t:{_:a}}}},s:{t:{u:{r:{i:{a:{s:{_:a}}}}}}},t:{h:{l:{e:{t:{i:{_:n}}},o:{_:n},_:a}}},U:{$:{_:a},D:{_:a},S:{C:{_:a}}},_:n},"\xC1":{_:n},"\xE1":{";":{_:n}},"\xE0":{_:n},"\xC4":{_:n},"\u0101":{_:n},"\xC5":{_:n},"\xE6":{_:n},"\xC6":{n:{_:a},_:n},D:{"\xFA":{n:{_:a}}},e:{".":{g:{_:a}},a:{c:{h:{" ":{_:a}}}},i:{t:{h:{e:{r:{" ":{_:a},".":{_:a}}}}}},l:{"-":{_:a},l:{a:{_:a}}},m:{p:{e:{z:{_:a}}}},n:{o:{u:{g:{_:a}}}},u:{p:{" ":{_:n}},_:a},w:{_:a},x:{i:{s:{t:{s:{_:a}}}}},_:n},E:{m:{p:{e:{z:{_:a}}}},n:{a:{m:{_:a}}},s:{p:{a:{d:{_:n}},e:{_:n},o:{_:n},_:a}},u:{l:{_:n},_:a},U:{R:{_:a}},_:n},"\xE9":{g:{_:a},t:{a:{_:n},u:{_:n},_:a},_:n},"\xC9":{_:n},f:{"-":{_:n}," ":{_:n},"/":{_:n},M:{_:n},p:{_:n},t:{_:n}},F:{0:{_:n},1:{_:n},2:{_:n},3:{_:n},4:{_:n},5:{_:n},6:{_:n},9:{_:n},"'":{_:n},"-":{_:n}," ":{_:n},"\"":{_:n},"#":{_:n},",":{_:n},".":{_:n},"/":{_:n},"\u201D":{_:n},A:{C:{_:a},D:{_:a},I:{R:{_:a}},L:{_:a},M:{_:a},N:{_:a},P:{_:a},Q:{_:a},R:{_:a},S:{_:a},T:{_:a},_:n},B:{_:n},C:{_:n},c:{_:n},D:{_:n},E:{C:{_:n},I:{_:n}},F:{" ":{_:a},_:n},f:{_:n},h:{_:n},H:{_:n},I:{A:{T:{_:a},_:n},D:{" ":{_:n}},R:{" ":{_:n}},S:{" ":{_:n}}},K:{_:n},L:{C:{_:n},N:{_:n},P:{_:n}},M:{R:{_:a},_:n},O:{" ":{_:n},I:{" ":{_:n}}},P:{".":{_:a},"?":{_:a},C:{"?":{_:a}},_:n},R:{C:{_:n},S:{_:n}},S:{_:n},T:{S:{_:a},T:{_:a},_:n},U:{" ":{_:n},",":{_:n},".":{_:n}},V:{_:n},W:{D:{_:a},_:n},X:{_:n},Y:{_:n},"\u03C3":{_:n}},G:{h:{a:{e:{_:n},i:{_:n}}}},h:{"'":{_:n},"-":{U:{_:a},_:n}," ":{_:n},"\"":{_:n},",":{_:n},C:{_:n},e:{i:{r:{a:{_:a},_:n}}},i:{m:{s:{_:n}},s:{t:{o:{r:{i:{c:{_:a}}}}}}},o:{m:{a:{_:n},m:{_:n}},n:{e:{y:{_:a}},k:{_:a},v:{_:a},_:n},r:{s:{" ":{_:n}}},u:{r:{_:n}}},t:{t:{p:{" ":{_:n}},_:a},_:n}},H:{1:{_:n},2:{_:n},3:{_:n},4:{_:n},5:{_:n},"'":{_:n},"-":{_:n}," ":{_:n},"\"":{_:n},"&":{_:n},",":{_:n},".":{A:{_:a},_:n},"+":{_:n},a:{b:{i:{l:{i:{t:{a:{t:{i:{o:{n:{s:{_:n}}}}}}}}}}}},B:{_:n},C:{_:n},D:{B:{_:a},_:n},e:{i:{r:{_:n}}},F:{_:n},G:{_:n},H:{_:n},I:{D:{_:a},G:{_:a},M:{_:a},P:{_:a},_:n},L:{A:{"-":{D:{_:a}}},_:n},M:{_:n},N:{_:n},o:{n:{d:{_:a},e:{s:{_:n},_:a},g:{_:a},k:{_:a},o:{l:{_:a}},_:n},u:{r:{_:n}}},O:{" ":{_:n},V:{_:n}},P:{_:n},Q:{_:n},R:{T:{_:a},_:n},S:{" ":{_:a},R:{_:a},T:{_:a},_:n},T:{P:{_:a},_:n},V:{_:n},W:{T:{_:n}}},i:{".":{e:{_:a}},b:{n:{_:a}},f:{" ":{_:a}},i:{_:a},n:{c:{l:{u:{d:{i:{_:a}}}}},d:{i:{c:{a:{t:{e:{s:{_:a}}}}}}},s:{t:{e:{a:{d:{"?":{_:n}},_:a}}}}},s:{" ":{_:a},".":{_:a}},t:{" ":{_:a}},u:{_:a},_:n},I:{"-":{A:{_:a},I:{_:a}},I:{I:{_:a}},l:{b:{_:a}},M:{H:{_:a}},m:{a:{m:{s:{_:a}}}},R:{"\xA3":{_:a}},s:{l:{a:{m:{" ":{_:a},",":{_:a},".":{_:a}},n:{d:{s:{_:a}}}}}},_:n},"\u0130":{_:n},J:{i:{a:{n:{_:a},_:n}}},k:{u:{" ":{_:n}}},l:{" ":{_:n},"\"":{_:n},p:{_:n}},L:{1:{_:n},2:{_:n},3:{_:n},5:{_:n},"'":{A:{_:a},_:n},"-":{a:{_:a},_:n}," ":{_:n},"\"":{_:n},"&":{_:n},",":{_:n},".":{_:n},"/":{_:n},a:{e:{_:n},o:{i:{g:{_:n}}}},A:{" ":{_:n},L:{_:n},P:{_:n}},B:{_:n},C:{_:n},D:{_:n},E:{A:{_:a},E:{_:a},G:{_:a},O:{_:a},P:{_:a},T:{_:a},_:n},F:{_:n},G:{_:n},H:{_:n},I:{R:{_:n}},L:{_:n},M:{X:{_:a},_:n},N:{_:n},o:{c:{h:{a:{_:n}}}},O:{E:{_:n}},P:{_:n},R:{_:n},S:{_:n},T:{_:n},U:{" ":{_:n}},V:{_:n},X:{_:n},Z:{_:n}},m:{"-":{_:n}," ":{_:n},"\"":{_:n},"&":{_:n},a:{k:{e:{s:{" ":{_:n}}}}},b:{_:n},e:{i:{n:{_:n}},n:{t:{i:{o:{n:{s:{_:n}}}}}}},f:{_:n},p:{_:n},R:{_:n},t:{_:n}},M:{1:{9:{0:{_:n},_:a},_:n},2:{_:n},3:{_:n},4:{_:n},5:{_:n},6:{_:n},7:{_:n},8:{_:n},9:{_:n},"'":{_:n},"-":{t:{_:a},_:n}," ":{_:n},"\"":{_:n},"&":{_:n},",":{_:n},".":{A:{".":{S:{_:a}}},_:n},"/":{_:n},A:{C:{_:a},D:{_:a},F:{_:a},G:{_:a},J:{_:a},L:{_:a},M:{_:a},N:{_:a},P:{_:a},R:{_:a},S:{_:a},T:{_:a},X:{_:a},Y:{_:a},_:n},B:{_:n},C:{_:n},D:{_:n},e:{"-":{_:n}},E:{d:{_:n},n:{_:n},P:{_:n}},F:{_:n},f:{_:n},G:{_:n},H:{_:n},h:{_:n},i:{e:{_:n}},I:{5:{_:n},6:{_:n}," ":{_:n},A:{_:n},T:{_:n}},K:{_:n},L:{_:n},M:{T:{_:a},_:n},N:{_:n},o:{U:{_:n}},O:{" ":{_:n},T:{" ":{_:n}},U:{_:n}},P:{_:n},R:{_:n},S:{_:n},s:{c:{_:n}},T:{R:{_:a},_:n},U:{V:{_:n}},V:{_:n},X:{_:n}},N:{4:{_:n},6:{_:n},"'":{_:n},"-":{a:{_:a},S:{_:a},_:n}," ":{_:n},"\"":{_:n},",":{_:n},".":{Y:{_:a},_:n},"=":{_:n},"\xB2":{_:n},a:{o:{_:n}},A:{" ":{_:n},A:{F:{_:a},_:n},I:{_:n},S:{L:{_:n}}},B:{_:n},C:{_:n},D:{_:n},E:{A:{_:n},H:{_:n},S:{" ":{_:n}}},F:{_:n},G:{_:n},H:{_:n},I:{C:{_:a},L:{_:a},M:{H:{_:n},_:a},N:{_:a},S:{_:a},_:n},J:{C:{_:n}},K:{_:n},L:{S:{_:a},_:n},M:{_:n},N:{R:{_:n},T:{_:n}},P:{O:{V:{"-":{_:n}},_:a},_:n},R:{J:{_:a},T:{_:a},_:n},S:{W:{_:a},_:n},T:{$:{_:a},_:n},U:{S:{_:n}},V:{_:n},v:{_:n},W:{A:{_:n}},X:{_:n},Y:{P:{_:n},U:{_:n}}},n:{"-":{_:n},"\u2212":{_:n}," ":{_:n},"\"":{_:n},"&":{_:n},",":{_:n},"+":{_:n},"\xD7":{_:n},d:{a:{_:n}},p:{a:{_:n}},t:{_:n},V:{_:n},W:{_:n}},o:{b:{r:{_:a}},c:{c:{u:{r:{s:{_:a}}}},h:{o:{_:a}}},f:{" ":{_:a}},n:{"-":{_:n},"/":{_:n},b:{_:n},c:{o:{_:n}},d:{_:n},e:{r:{_:n}},g:{_:n},i:{_:n},l:{_:n},m:{_:n},o:{_:n},r:{_:n},s:{_:n},t:{_:n},u:{_:n},w:{_:n},y:{_:n},_:a},r:{" ":{_:a},",":{_:a}},u:{i:{_:a}},_:n},O:{b:{e:{r:{s:{t:{" ":{_:n},l:{_:n}},_:a}}}},l:{v:{_:a}},n:{e:{i:{_:n},_:a}},N:{E:{_:a}},o:{p:{_:a}},u:{i:{_:a}},_:n},"\xD3":{_:n},"\xD6":{_:n},"\xF6":{_:n},"\u014C":{_:n},"\u014D":{_:n},P:{h:{o:{b:{_:n},i:{_:n}}}},r:{"'":{_:n},"-":{_:n}," ":{_:n},"\"":{_:n},"&":{_:n},".":{_:n},e:{f:{e:{r:{s:{_:n}}}}},f:{_:n},m:{_:n},s:{_:n}},R:{1:{0:{_:a},_:n},2:{_:n},3:{_:n},4:{_:n},5:{_:n},6:{_:n},"'":{_:n},"-":{_:n}," ":{_:n},"\"":{_:n},"&":{_:n},",":{_:n},".":{C:{_:a},_:n},"/":{_:n},A:{" ":{_:n},F:{_:n}},B:{_:n},C:{_:n},D:{_:n},E:{" ":{_:n},R:{_:n}},F:{_:n},f:{_:n},G:{_:n},H:{S:{_:n}},I:{A:{_:n},C:{" ":{_:n}}},J:{_:n},K:{_:n},L:{" ":{_:a},_:n},M:{1:{_:a},_:n},N:{G:{_:a},_:n},O:{T:{_:n}},P:{_:n},Q:{_:n},R:{_:n},S:{" ":{_:a},")":{_:a},",":{_:a},".":{_:a},"?":{_:a},T:{_:a},_:n},T:{_:n},U:{_:n},V:{_:n},X:{_:n}},s:{"-":{_:n},"\"":{_:n},")":{_:n},",":{_:n},".":{_:n},a:{y:{s:{_:n}}},i:{c:{h:{_:n}}},p:{3:{_:n},r:{o:{t:{_:n}}}},s:{h:{_:n}},t:{a:{t:{e:{s:{" ":{_:n},":":{_:n}}}}}},v:{a:{_:a},e:{_:a},_:n}},S:{1:{_:n},2:{_:n},3:{_:n},4:{_:n},5:{_:n},6:{_:n},"'":{_:n},"-":{_:n}," ":{_:n},"\"":{_:n},"&":{W:{_:a},_:n},",":{_:n},".":{B:{_:n},M:{_:n},O:{_:n}},"\u201D":{_:n},A:{"-":{1:{_:a},_:n}," ":{_:n},C:{D:{_:n}},E:{_:n},S:{E:{_:a},_:n},T:{" ":{_:n},B:{_:n}}},B:{_:n},C:{A:{" ":{_:n}},C:{_:n},M:{_:n},O:{" ":{_:n}},R:{A:{_:a},_:n},T:{_:n}},D:{_:n},E:{" ":{_:n},C:{O:{_:a},R:{_:a},_:n},I:{_:n},O:{_:n}},F:{_:n},G:{_:n},H:{2:{_:n},3:{_:n},"-":{_:n}},I:{" ":{_:n}},J:{_:n},K:{_:n},L:{A:{_:a},I:{_:a},O:{_:a},_:n},M:{A:{_:a},E:{" ":{_:n},_:a},I:{_:a},_:n},N:{A:{_:a},E:{_:a},O:{_:a},_:n},O:{"(":{_:n},A:{" ":{_:n},I:{_:n}},E:{_:n},I:{_:n},S:{_:n},V:{_:n}},P:{A:{C:{_:a},D:{_:a},M:{_:a},N:{_:a},R:{_:a}},E:{" ":{_:n},_:a},I:{C:{_:a}},O:{_:a},U:{_:a},_:n},R:{_:n},S:{_:n},T:{"-":{_:n},A:{" ":{_:n}},B:{_:n},C:{_:n},D:{_:n},F:{_:n},L:{_:n},M:{_:n},S:{_:n},V:{_:n}},u:{r:{a:{" ":{_:n}}}},U:{B:{_:a},L:{_:a},N:{_:a},P:{_:a},S:{_:a},_:n},V:{_:n},W:{F:{_:n},P:{_:n},R:{_:n}},X:{S:{_:a},_:n}},t:{"-":{S:{_:n}},S:{_:n}},T:{a:{v:{e:{s:{_:n}}}},"\xE0":{_:n}},u:{"-":{_:a}," ":{_:a},"\"":{_:a},".":{_:a},b:{e:{_:n},_:a},f:{_:a},k:{a:{_:n},_:a},l:{u:{_:a}},m:{" ":{_:a}},n:{" ":{_:a},a:{" ":{_:a},n:{a:{_:n},n:{_:n},s:{_:n},t:{_:n},_:a},r:{y:{_:a}}},e:{" ":{_:a}},i:{c:{o:{r:{p:{_:n}}}},d:{i:{_:a},_:n},m:{o:{_:a},_:n},n:{_:n},v:{o:{_:n}},_:a},l:{e:{s:{_:a}}}},p:{o:{_:a}},r:{a:{_:a},e:{_:a},i:{_:a},l:{_:a},o:{_:a}},s:{"-":{_:n}," ":{_:n},h:{_:n},_:a},t:{m:{_:n},t:{_:n},_:a},v:{_:a},w:{_:a},_:n},U:{1:{_:n},"-":{B:{o:{_:a},_:n}},a:{_:n},b:{i:{_:a},_:n},D:{P:{"-":{_:n}}},d:{_:n},g:{l:{_:n}},h:{_:n},i:{_:n},l:{i:{_:a},_:n},m:{_:n},M:{N:{_:n}},n:{"-":{_:n},a:{n:{_:a},_:n},b:{_:n},c:{_:n},d:{_:n},e:{s:{_:a},_:n},f:{_:n},g:{_:n},h:{_:n},i:{d:{_:n},n:{_:n}},k:{_:n},l:{_:n},m:{_:n},n:{_:n},o:{_:n},p:{_:n},r:{_:n},s:{_:n},t:{e:{r:{s:{_:a}}},_:n},u:{_:n},w:{_:n}},p:{_:n},r:{a:{_:a},i:{_:a},u:{g:{u:{a:{y:{a:{n:{"-":{_:n}}}}}}},k:{_:n},_:a},_:n},s:{h:{_:n},t:{_:n}},t:{n:{_:n},o:{"-":{_:n}},r:{_:n},t:{_:n}},x:{_:n},z:{_:n}},"\xFC":{_:n},"\xDC":{_:n},V:{I:{I:{_:n}}},x:{a:{_:a},e:{_:a},i:{_:a},o:{_:a},x:{_:a},y:{_:a},_:n},X:{a:{_:a},A:{_:a},e:{_:a},h:{_:a},i:{_:a},I:{V:{_:a},X:{_:a}},o:{_:a},u:{_:a},U:{_:a},V:{_:a},X:{" ":{_:n},_:a},y:{_:a},_:n},Y:{p:{_:n}},"\u03B1":{_:n},"\u03B5":{_:n},"\u03C9":{_:n}};_find=function find(word,obj,article){var key;if(obj==null){obj=arts;}if(article==null){article="a";}if(word==null){return article;}key=word.slice(0,1);obj=obj[key];if(key!=null&&obj!=null){return _find(word.slice(1),obj,obj._||article);}else{return article;}};articlize=function articlize(){var input,inputs,out;inputs=1<=arguments.length?slice.call(arguments,0):[];out=function(){var i,len,results;results=[];for(i=0,len=inputs.length;i<len;i++){input=inputs[i];if(input!=null){results.push(_find(input)+" "+input);}}return results;}();if(inputs.length===1){return out[0];}else{return out;}};exports$1={find:_find,articlize:articlize};}).call(exports$1);var exports$1$1=exports$1;var find=exports$1.find,articlize=exports$1.articlize;/* global btoa,JsDiff */var features$1={repeat:!!String.prototype.repeat,includes:!!String.prototype.includes,startsWith:!!String.prototype.startsWith,endsWith:!!String.prototype.endsWith};// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// printing and formatting strings
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function format(){// String+ -> String
// Takes a variable number of arguments. The first argument is the format
// string. Placeholders in the format string are marked with `"%s"`.
// Example:
//   lively.lang.string.format("Hello %s!", "Lively User"); // => "Hello Lively User!"
return formatFromArray(Array.prototype.slice.call(arguments));}function formatFromArray(objects){var self=objects.shift();if(!self){console.log('Error in Strings>>formatFromArray, first arg is undefined');}function appendText(object,string){return''+object;}function appendInteger(value,string){return value.toString();}function appendFloat(value,string,precision){if(precision>-1)return value.toFixed(precision);else return value.toString();}function appendObject(value,string){return inspect(value);}var appenderMap={s:appendText,d:appendInteger,i:appendInteger,f:appendFloat,o:appendObject};var reg=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/;function parseFormat(fmt){var parts=[];for(var _m2=reg.exec(fmt);_m2;_m2=reg.exec(fmt)){var type=_m2[8]||_m2[5];var appender=type in appenderMap?appenderMap[type]:appendObject;var _precision=_m2[3]?parseInt(_m2[3]):_m2[4]=='.'?-1:0;parts.push(fmt.substr(0,_m2[0][0]=='%'?_m2.index:_m2.index+1));parts.push({appender:appender,precision:_precision});fmt=fmt.substr(_m2.index+_m2[0].length);}if(fmt){parts.push(fmt.toString());}return parts;}var parts=parseFormat(self);var str='';var objIndex=0;for(var _i27=0;_i27<parts.length;++_i27){var part=parts[_i27];if(part&&_typeof2(part)==='object'){var object=objects[objIndex++];str+=(part.appender||appendText)(object,str,part.precision);}else{str+=appendText(part);}}return str;}function indent$1(str,indentString,depth){// String -> String -> String? -> String
// Example:
//   string.indent("Hello", "  ", 2) // => "    Hello"
if(!depth||depth<=0)return str;var indent='';while(depth>0){depth--;indent+=indentString;}return lines(str).map(function(line){return indent+line;}).join('\n');}function minIndent(str,indentString){// Find out what the minum indentation of the text in str is
// Example:
//   minIndent("    Hello", "  ") // => 2
if(!indentString)indentString='  ';var indentRe=new RegExp('^('+indentString+')*','gm');return min(str.match(indentRe).map(function(ea){return Math.floor(ea.length/indentString.length);}));}function changeIndent(str,indentString,depth){// Add or remove indent from lines in str to match depth
// Example:
//   string.changeIndent("    Hello", "  ", 1) // => "  Hello"
if(!indentString)indentString='  ';if(!depth)depth=0;var existingIndent=minIndent(str,indentString);if(existingIndent===depth)return str;if(existingIndent<depth)return indent$1(str,indentString,depth-existingIndent);var prefixToRemove=indentString.repeat(existingIndent-depth);return lines(str).map(function(line){return line.slice(prefixToRemove.length);}).join('\n');}function quote(str){// Example:
//   string.print("fo\"o") // => "\"fo\\\"o\""
return'"'+str.replace(/"/g,'\\"')+'"';}function articlize$1(str){return exports$1$1.articlize(str);}function findArticle(str){return exports$1$1.find(str);}function print$1(obj){// Prints Arrays and escapes quotations. See `obj.inspect` for how to
// completely print / inspect JavaScript data strcutures
// Example:
//   string.print([[1,2,3], "string", {foo: 23}])
//      // => [[1,2,3],"string",[object Object]]
if(obj&&Array.isArray(obj))return'['+obj.map(print$1)+']';if(typeof obj!=='string')return String(obj);var result=String(obj);result=result.replace(/\n/g,'\\n\\\n');result=result.replace(/(")/g,'\\$1');result='\"'+result+'\"';return result;}function printNested(list,depth){// Example:
//   string.printNested([1,2,[3,4,5]]) // => "1\n2\n  3\n  4\n  5\n"
depth=depth||0;return list.reduce(function(s,ea){return s+=Array.isArray(ea)?printNested(ea,depth+1):indent$1(ea+'\n','  ',depth);},'');}function pad(string,n,left){// Examples:
// pad("Foo", 2) // => "Foo  "
// pad("Foo", 2, true) // => "  Foo"
return left?' '.repeat(n)+string:string+' '.repeat(n);}function printTable(tableArray,options){// Array -> Object? -> String
// Takes a 2D Array and prints a table string. Kind of the reverse
// operation to `tableize`
// Example:
//   string.printTable([["aaa", "b", "c"], ["d", "e","f"]])
//    // =>
//    // aaa b c
//    // d   e f
var columnWidths=[];var separator=options&&options.separator||' ';var alignLeftAll=!options||!options.align||options.align==='left';var alignRightAll=options&&options.align==='right';function alignRight(columnIndex){if(alignLeftAll)return false;if(alignRightAll)return true;return options&&Array.isArray(options.align)&&options.align[columnIndex]==='right';}tableArray.forEach(function(row){row.forEach(function(cellVal,i){if(columnWidths[i]===undefined)columnWidths[i]=0;columnWidths[i]=Math.max(columnWidths[i],String(cellVal).length);});});return tableArray.map(function(row){return row.map(function(cellVal,i){var cellString=String(cellVal);return pad(cellString,columnWidths[i]-cellString.length,alignRight(i));}).join(separator);}).join('\n');}function printTree(rootNode,nodePrinter,childGetter,indent){// Object -> Function -> Function -> Number? -> String
// A generic function to print a tree representation from a nested data structure.
// Receives three arguments:
// - `rootNode` an object representing the root node of the tree
// - `nodePrinter` is a function that gets a tree node and should return stringified version of it
// - `childGetter` is a function that gets a tree node and should return a list of child nodes
// Example:
// var root = {name: "a", subs: [{name: "b", subs: [{name: "c"}]}, {name: "d"}]};
// string.printTree(root, function(n) { return n.name; }, function(n) { return n.subs; });
// // =>
// // a
// // |-b
// // | \-c
// // \-d
var nodeList=[];indent=indent||'  ';iterator(0,0,rootNode);return nodeList.join('\n');// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function iterator(depth,index,node){// ignore-in-doc
// 1. Create stringified representation of node
nodeList[index]=indent.repeat(depth)+nodePrinter(node,depth);var children=childGetter(node,depth);var childIndex=index+1;if(!children||!children.length)return childIndex;// 2. If there are children then assemble those linear inside nodeList
// The childIndex is the pointer of the current items of childList into
// nodeList.
var lastIndex=childIndex;var lastI=children.length-1;children.forEach(function(ea,i){childIndex=iterator(depth+1,childIndex,ea);// 3. When we have printed the recursive version then augment the
// printed version of the direct children with horizontal slashes
// directly in front of the represented representation
var isLast=lastI===i;var cs=nodeList[lastIndex].split('');var fromSlash=depth*indent.length+1;var toSlash=depth*indent.length+indent.length;for(var i=fromSlash;i<toSlash;i++){cs[i]='-';}if(isLast)cs[depth*indent.length]='\\';nodeList[lastIndex]=cs.join('');// 4. For all children (direct and indirect) except for the
// last one (itself and all its children) add vertical bars in
// front of each at position of the current nodes depth. This
// makes is much easier to see which child node belongs to which
// parent
if(!isLast){nodeList.slice(lastIndex,childIndex).forEach(function(ea,i){var cs2=ea.split('');cs2[depth*indent.length]='|';nodeList[lastIndex+i]=cs2.join('');});}lastIndex=childIndex;});return childIndex;}}function toArray$1(s){// Example:
// string.toArray("fooo") // => ["f","o","o","o"]
return s.split('');}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// parsing strings into other entities
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function lines(str){// Example: string.lines("foo\nbar\n\rbaz") // => ["foo","bar","baz"]
return str.split(/\n\r?/);}function paragraphs(string,options){// Examples:
// var text = "Hello, this is a pretty long sentence\nthat even includes new lines."
//         + "\n\n\nThis is a sentence in  a new paragraph.";
// string.paragraphs(text) // => [
//   // "Hello, this is a pretty long sentence\nthat even includes new lines.",
//   // "This is a sentence in  a new paragraph."]
// string.paragraphs(text, {keepEmptyLines: true}) // => [
//   // "Hello, this is a pretty long sentence\n that even includes new lines.",
//   // "\n ",
//   // "This is a sentence in  a new paragraph."]
var sep=options?options.sep:'\n\n';if(!options||!options.keepEmptyLines)return string.split(new RegExp(sep+'+'));function isWhiteSpace(s){return /^\s*$/.test(s);}return string.split('\n').concat('').reduce(function(parasAndLast,line){var paras=parasAndLast[0];var last=parasAndLast[1];if(isWhiteSpace(last)===isWhiteSpace(line)){last+='\n'+line;}else{last.length&&paras.push(last);last=line;}return[paras,last];},[[],''])[0];}function nonEmptyLines(str){// Example: string.nonEmptyLines("foo\n\nbar\n") // => ["foo","bar"]
return lines(str).compact();}function tokens(str,regex){// Example:
// string.tokens(' a b c') => ['a', 'b', 'c']
return str.split(regex||/\s+/).filter(function(tok){return!/^\s*$/.test(tok);});}function tableize(s,options){// String -> Object? -> Array
// Takes a String representing a "table" and parses it into a 2D-Array (as
// accepted by the `collection.Grid` methods or `string.printTable`)
// ```js
// options = {
//     convertTypes: BOOLEAN, // automatically convert to Numbers, Dates, ...?
//     cellSplitter: REGEXP // how to recognize "cells", by default just spaces
// }
// ```
// Examples:
// string.tableize('a b c\nd e f')
// // => [["a","b","c"],["d","e","f"]]
// // can also parse csv like
// var csv = '"Symbol","Name","LastSale",\n'
//         + '"FLWS","1-800 FLOWERS.COM, Inc.","5.65",\n'
//         + '"FCTY","1st Century Bancshares, Inc","5.65",'
// string.tableize(csv, {cellSplitter: /^\s*"|","|",?\s*$/g})
// // => [["Symbol","Name","LastSale"],
// //     ["FLWS","1-800 FLOWERS.COM, Inc.",5.65],
// //     ["FCTY","1st Century Bancshares, Inc",5.65]]
options=options||{};var splitter=options.cellSplitter||/\s+/;var emptyStringRe=/^\s*$/;var convertTypes=options.hasOwnProperty('convertTypes')?!!options.convertTypes:true;var _lines=lines(s);var table=[];for(var _i28=0;_i28<_lines.length;_i28++){var _tokens=tokens(_lines[_i28],splitter);if(convertTypes){_tokens=_tokens.map(function(tok){if(tok.match(emptyStringRe))return tok;var num=Number(tok);if(!isNaN(num))return num;var date=new Date(tok);if(!isNaN(+date))return date;return tok.trim();});}if(_tokens.length>0)table.push(_tokens);}return table;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// (un)escape / encoding / decoding
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function unescapeCharacterEntities(s){// Converts [character entities](http://dev.w3.org/html5/html-author/charref)
// into utf-8 strings
// Example:
//   string.unescapeCharacterEntities("foo &amp;&amp; bar") // => "foo && bar"
if(typeof document==='undefined')throw new Error('Cannot unescapeCharacterEntities');var div=document.createElement('div');div.innerHTML=s;return div.textContent;}function toQueryParams(s,separator){// Example:
// string.toQueryParams("http://example.com?foo=23&bar=test")
//   // => {bar: "test", foo: "23"}
var match=s.trim().match(/([^?#]*)(#.*)?$/);if(!match)return{};var hash=match[1].split(separator||'&').inject({},function(hash,pair){if((pair=pair.split('='))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash){if(!Array.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}else hash[key]=value;}return hash;});return hash;}function base64EncodeUnicode(str){// [https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem]()
// Base64 encode a unicode string
// First we use encodeURIComponent to get percent-encoded UTF-8,
// then we convert the percent encodings into raw bytes which
// can be fed into btoa.
return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function toSolidBytes(match,p1){return String.fromCharCode('0x'+p1);}));}function base64DecodeUnicode(str){// [https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem]()
// Decode a base64 encoded string to a unicode string
// Going backwards: from bytestream, to percent-encoding, to original string.
return decodeURIComponent(atob(str).split('').map(function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));}// -=-=-=-=-=-=-=-=-=-=-=-=-
// file system path support
// -=-=-=-=-=-=-=-=-=-=-=-=-
var pathDotRe=/\/\.\//g;var pathDoubleDotRe=/\/[^\/]+\/\.\./;var pathDoubleSlashRe=/(^|[^:])[\/]+/g;var urlStartRe=/^[a-z0-9-_\.]+:\/\//;function normalizePath(pathString){var urlStartMatch=pathString.match(urlStartRe);var urlStart=urlStartMatch?urlStartMatch[0]:null;var result=urlStart?pathString.slice(urlStart.length):pathString;// /foo/../bar --> /bar
do{pathString=result;result=pathString.replace(pathDoubleDotRe,'');}while(result!=pathString);// foo//bar --> foo/bar
result=result.replace(pathDoubleSlashRe,'$1/');// foo/./bar --> foo/bar
result=result.replace(pathDotRe,'/');if(urlStart)result=urlStart+result;return result;}function joinPath()/* paths */{// Joins the strings passed as paramters together so that ea string is
// connected via a single "/".
// Example:
// string.joinPath("foo", "bar") // => "foo/bar";
return normalizePath(Array.prototype.slice.call(arguments).reduce(function(path,ea){return typeof ea==='string'?path.replace(/\/*$/,'')+'/'+ea.replace(/^\/*/,''):path;}));}// -=-=-=-=-=-=-=-=-
// ids and hashing
// -=-=-=-=-=-=-=-=-
var newUUIDTemplate='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';var newUUIDRe=/[xy]/g;var newUUIDReplacer=function newUUIDReplacer(c){var r=Math.random()*16|0;var v=c=='x'?r:r&0x3|0x8;return v.toString(16);};function newUUID(){// Example:
//   newUUID() // => "3B3E74D0-85EA-45F2-901C-23ECF3EAB9FB"
return newUUIDTemplate.replace(newUUIDRe,newUUIDReplacer).toUpperCase();}function createDataURI(content,mimeType){// String -> String -> String
// Takes some string representing content and a mime type.
// For a list of mime types see: [http://www.iana.org/assignments/media-types/media-types.xhtml]()
// More about data URIs: [https://developer.mozilla.org/en-US/docs/Web/HTTP/data_URIs]()
// Example:
//   window.open(string.createDataURI('<h1>test</h1>', 'text/html'));
mimeType=mimeType||'text/plain';return'data:'+mimeType+';base64,'+base64EncodeUnicode(content);}function hashCode(s){// [http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/]()
// Example: string.hashCode("foo") // => 101574
var hash=0;var len=s.length;if(len==0)return hash;for(var _i29=0;_i29<len;_i29++){var _c2=s.charCodeAt(_i29);hash=(hash<<5)-hash+_c2;hash=hash&hash;// Convert to 32bit integer
}return hash;}function md5(string){// © Joseph Myers [http://www.myersdaily.org/joseph/javascript/md5-text.html]()
// Example:
//   string.md5("foo") // => "acbd18db4cc2f85cedef654fccc4a4d8"
/* ignore-in-doc
		this function is much faster,
		so if possible we use it. Some IEs
		are the only ones I know of that
		need the idiotic second function,
		generated by an if clause.  */ // var add32 = hex(md51("hello")) === "5d41402abc4b2a76b9719d911017c592" ?
//   function add32(a, b) { return (a + b) & 0xFFFFFFFF; } :
var add32=function add32(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&0xFFFF;};function cmn(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32(a<<s|a>>>32-s,b);}function ff(a,b,c,d,x,s,t){return cmn(b&c|~b&d,a,b,x,s,t);}function gg(a,b,c,d,x,s,t){return cmn(b&d|c&~d,a,b,x,s,t);}function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t);}function ii(a,b,c,d,x,s,t){return cmn(c^(b|~d),a,b,x,s,t);}function md5cycle(x,k){var a=x[0];var b=x[1];var c=x[2];var d=x[3];a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3]);}function md51(s){var n=s.length;var state=[1732584193,-271733879,-1732584194,271733878];var i;for(i=64;i<=n;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)));}s=s.substring(i-64);var tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var sl=s.length;for(i=0;i<sl;i++){tail[i>>2]|=s.charCodeAt(i)<<(i%4<<3);}tail[i>>2]|=0x80<<(i%4<<3);if(i>55){md5cycle(state,tail);i=16;while(i--){tail[i]=0;}//			for (i=0; i<16; i++) tail[i] = 0;
}tail[14]=n*8;md5cycle(state,tail);return state;}/* ignore-in-doc
		 * there needs to be support for Unicode here,
		 * unless we pretend that we can redefine the MD-5
		 * algorithm for multi-byte characters (perhaps
		 * by adding every four 16-bit characters and
		 * shortening the sum to 32 bits). Otherwise
		 * I suggest performing MD-5 as if every character
		 * was two bytes--e.g., 0040 0025 = @%--but then
		 * how will an ordinary MD-5 sum be matched?
		 * There is no way to standardize text to something
		 * like UTF-8 before transformation; speed cost is
		 * utterly prohibitive. The JavaScript standard
		 * itself needs to look at this: it should start
		 * providing access to strings as preformed UTF-8
		 * 8-bit unsigned value arrays.
		 */function md5blk(s){// ignore-in-doc
/* I figured global was faster.   */var md5blks=[];var i;/* Andy King said do it this way. */for(i=0;i<64;i+=4){md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24);}return md5blks;}var hex_chr='0123456789abcdef'.split('');function rhex(n){var s='';var j=0;for(;j<4;j++){s+=hex_chr[n>>j*8+4&0x0F]+hex_chr[n>>j*8&0x0F];}return s;}function hex(x){var l=x.length;for(var _i30=0;_i30<l;_i30++){x[_i30]=rhex(x[_i30]);}return x.join('');}return hex(md51(string));}// -=-=-=-=-=-=-=-=-=-=-=-=-=-
// matching strings / regexps
// -=-=-=-=-=-=-=-=-=-=-=-=-=-
function reMatches$1(string,re){// Different to the native `match` function this method returns an object
// with `start`, `end`, and `match` fields
// Example:
//   string.reMatches("Hello World", /o/g)
//   // => [{start: 4, end: 5, match: "o"},{start: 7, end: 8, match: "o"}]
var matches=[];string.replace(re,function(match,idx){matches.push({match:match,start:idx,end:idx+match.length});});return matches;}function stringMatch(s,patternString,options){// returns `{matched: true}` if success otherwise
// `{matched: false, error: EXPLANATION, pattern: STRING|RE, pos: NUMBER}`
// Example:
//   string.stringMatch("foo 123 bar", "foo __/[0-9]+/__ bar") // => {matched: true}
//   string.stringMatch("foo aaa bar", "foo __/[0-9]+/__ bar")
//     // => {
//     //   error: "foo <--UNMATCHED-->aaa bar",
//     //   matched: false,
//     //   pattern: /[0-9]+/,
//     //   pos: 4
//     // }
options=options||{};if(options.normalizeWhiteSpace)s=s.replace(/\s+/g,' ');if(options.ignoreIndent){s=s.replace(/^\s+/gm,'');patternString=patternString.replace(/^\s+/gm,'');}return s==patternString?{matched:true}:embeddedReMatch(s,patternString);// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function splitInThree(string,start,end,startGap,endGap){// ignore-in-doc
// split string at start and end
// return (0, start), (start, end), (end, ...)
startGap=startGap||0;endGap=endGap||0;return[string.slice(0,start),string.slice(start+startGap,end-endGap),string.slice(end)];}function matchStringForward(s,pattern){// ignore-in-doc
// try to match pattern at beginning of string. if matched, return
// result object with {
//   match: STRING,
//   REST: STRING -- remaining string after pattern was consumed
// }
if(pattern.constructor!==RegExp){var idx=s.indexOf(pattern);if(idx===0)return{match:pattern,rest:s.slice(pattern.length)};// no match
for(var _i31=0;_i31<pattern.length;_i31++)// figure out where we failed
{if(pattern[_i31]!=s[_i31]){return{match:null,pos:_i31};}}return{match:null};}var matches=reMatches$1(s,pattern);// show(matches)
// show(string.slice(matches[0].end));
return!matches||!matches.length||matches[0].start!==0?{match:null}:{match:matches[0].match,rest:s.slice(matches[0].end)};}function matchStringForwardWithAllPatterns(s,patterns){// ignore-in-doc
// like matchStringForward, just apply list of patterns
var pos=0;for(var _i32=0;_i32<patterns.length;_i32++){var _p=patterns[_i32];var result=matchStringForward(s,_p);if(!result.match)return{matched:false,pos:pos+(result.pos||0),pattern:_p};pos+=result.match.length;s=result.rest;}return s.length?{matched:false,pos:pos}:{matched:true};}function splitIntoPatterns(matcher){var starts=reMatches$1(matcher,/__\//g);var ends=reMatches$1(matcher,/\/__/g);if(starts.length!==ends.length){throw new Error('pattern invalid: '+matcher+' cannot be split into __/.../__ embedded RegExps'+'\nstarts: '+JSON.stringify(starts)+'\nvs ends:\n'+JSON.stringify(ends));}var consumed=0;return starts.reduce(function(patterns,start,i){var end=ends[i];var matcher=patterns.pop();var splitted=splitInThree(matcher,start.start-consumed,end.end-consumed,3,3);if(splitted[0].length){patterns.push(splitted[0]);consumed+=splitted[0].length;}try{if(splitted[1].length){patterns.push(new RegExp(splitted[1]));consumed+=splitted[1].length+3+3;}}catch(e){throw new Error('Cannot create pattern re from: '+inspect(splitted));}if(splitted[2].length){patterns.push(splitted[2]);}return patterns;},[matcher]);}function embeddedReMatch(s,patternString){// ignore-in-doc
// the main match func
var patterns=splitIntoPatterns(patternString);var result=matchStringForwardWithAllPatterns(s,patterns);if(result.matched)return result;result.error=s.slice(0,result.pos)+'<--UNMATCHED-->'+s.slice(result.pos);return result;}}function peekRight(s,start,needle){// Finds the next occurence of `needle` (String or RegExp). Returns delta
// index.
// Example:
// peekRight("Hello World", 0, /o/g) // => 4
// peekRight("Hello World", 5, /o/) // => 2
s=s.slice(start);if(typeof needle==='string'){var idx=s.indexOf(needle);return idx===-1?null:idx+start;}else if(needle.constructor===RegExp){var matches=reMatches$1(s,needle);return matches[0]?matches[0].start:null;}return null;}function peekLeft(s,start,needle){// Similar to `peekRight`
s=s.slice(0,start);if(typeof needle==='string'){var idx=s.lastIndexOf(needle);return idx===-1?null:idx;}else if(needle.constructor===RegExp){var matches=reMatches$1(s,needle);return last(matches)?last(matches).start:null;}return null;}function lineIndexComputer(s){// String -> Function
// For converting character positions to line numbers.
// Returns a function accepting char positions. If the char pos is outside
// of the line ranges -1 is returned.
// Example:
// var idxComp = lineIndexComputer("Hello\nWorld\n\nfoo");
// idxComp(3) // => 0 (index 3 is "l")
// idxComp(6) // => 1 (index 6 is "W")
// idxComp(12) // => 2 (index 12 is "\n")
// ignore-in-doc
// line ranges: list of numbers, each line has two entries:
// i -> start of line, i+1 -> end of line
var _lineRanges=lineRanges(s);// ignore-in-doc
// FIXME, this is O(n). Make cumputation more efficient, binary lookup?
return function(pos){for(var line=0;line<_lineRanges.length;line++){var lineRange=_lineRanges[line];if(pos>=lineRange[0]&&pos<lineRange[1]){return line;}}return-1;};}function lineNumberToIndexesComputer(s){// String -> Function
// For converting line numbers to [startIndex, endIndex]
// Example:
// var idxComp = lineNumberToIndexesComputer("Hello\nWorld\n\nfoo");
// idxComp(1) // => [6,12]
return function(lineNo){return lineRanges(s)[lineNo];};}function lineRanges(s){var from=0;var to=0;var linesOfS=lines(s);var result=[];for(var _i33=0;_i33<linesOfS.length;_i33++){var line=linesOfS[_i33];to=from+line.length+1;result.push([from,to]);from=to;}return result;}function findLineWithIndexInLineRanges(lineRanges,idx){// given a list of `lineRanges` (produced by
// `livley.lang.string.lineRanges(string)`) like lineRanges = [[0, 12], [12, 33]]
// and an string index `idx` into `string`, find the line no (the index into
// `lineRanges`) that includes idx.  The index intervals include start and exclude end:
// Example:
// findLineWithIndex2(lineRanges, 2); // => 0
// findLineWithIndex2(lineRanges, 12); // => 1
// findLineWithIndex2(lineRanges, 33); // => 1
// findLineWithIndex2(lineRanges, 34); // => -1
// findLineWithIndex2(lineRanges, -4); // => -1
var nRows=lineRanges.length;if(nRows===0)return-1;// let currentRow = Math.floor(nRows/2), lastRow = nRows;
var startRow=0;var endRow=nRows;while(true){var middle=startRow+Math.floor((endRow-startRow)/2);var _lineRanges$middle=_slicedToArray2(lineRanges[middle],2),_from=_lineRanges$middle[0],to=_lineRanges$middle[1];if(idx<_from){if(middle===0)return-1;endRow=middle;continue;}if(idx>to){startRow=middle;continue;}return middle;}return-1;}function regexIndexOf(string,regex){var startpos=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var indexOf=this.substring(startpos||0).search(regex);return indexOf>=0?indexOf+(startpos||0):indexOf;}function regexLastIndexOf(string,regex){var startpos=arguments.length>2&&arguments[2]!==undefined?arguments[2]:string.length;regex=regex.global?regex:new RegExp(regex.source,'g'+(regex.ignoreCase?'i':'')+(regex.multiLine?'m':''));var stringToWorkWith=this.substring(0,startpos+1);var lastIndexOf=-1;var nextStop=0;var result;while((result=regex.exec(stringToWorkWith))!=null){lastIndexOf=result.index;regex.lastIndex=++nextStop;}return lastIndexOf;}// -=-=-=-=-
// diffing
// -=-=-=-=-
function diff(s1,s2){if(typeof JsDiff==='undefined')return'diff not supported';return JsDiff.convertChangesToXML(JsDiff.diffWordsWithSpace(s1,s2));}// -=-=-=-=-
// testing
// -=-=-=-=-
function empty(s){// show-in-doc
return s=='';}var includes$1=features$1.includes?function(s,pattern){return s.includes(pattern);}:function(s,pattern){// Example:
// include("fooo!", "oo") // => true
return s.indexOf(pattern)>-1;};var include$1=includes$1;var startsWith=features$1.startsWith?function(s,pattern){return s.startsWith(pattern);}:function(s,pattern){// Example:
// startsWith("fooo!", "foo") // => true
return s.indexOf(pattern)===0;};function startsWithVowel(s){// show-in-doc
var c=s[0];return c==='A'||c==='E'||c==='I'||c==='O'||c==='U'||c==='a'||c==='e'||c==='i'||c==='o'||c==='u'||false;}var endsWith=features$1.endsWith?function(s,pattern){return s.endsWith(pattern);}:function(s,pattern){// Example:
// endsWith("fooo!", "o!") // => true
var d=s.length-pattern.length;return d>=0&&s.lastIndexOf(pattern)===d;};// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// string conversion and manipulation
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function withDecimalPrecision(str,precision){// String -> Number -> String
// Example: withDecimalPrecision("1.12345678", 3) // => "1.123"
var floatValue=parseFloat(str);return isNaN(floatValue)?str:floatValue.toFixed(precision);}function capitalize(s){// Example:
// capitalize("foo bar") // => "Foo bar"
return s.length?s.charAt(0).toUpperCase()+s.slice(1):s;}function camelCaseString(s){// Spaces to camels, including first char
// Example: camelCaseString("foo bar baz") // => "FooBarBaz"
return s.split(' ').map(capitalize).join('');}function camelize(s){// Dashes to camels, excluding first char
// Example: camelize("foo-bar-baz") // => "fooBarBaz"
var parts=s.split('-');var len=parts.length;if(len==1)return parts[0];var camelized=s.charAt(0)=='-'?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var _i34=1;_i34<len;_i34++){camelized+=parts[_i34].charAt(0).toUpperCase()+parts[_i34].substring(1);}return camelized;}function truncate(s,length,truncation){// Enforces that s is not more then `length` characters long.
// Example:
// truncate("123456789", 5) // => "12..."
length=length||30;truncation=truncation===undefined?'...':truncation;return s.length>length?s.slice(0,length-truncation.length)+truncation:String(s);}function truncateLeft(s,length,truncation){// Enforces that s is not more then `length` characters long.
// Example:
// truncate("123456789", 5) // => "12..."
length=length||30;truncation=truncation===undefined?'...':truncation;return s.length>length?truncation+s.slice(-length):String(s);}function regExpEscape(s){// For creating RegExps from strings and not worrying about proper escaping
// of RegExp special characters to literally match those.
// Example:
// var re = new RegExp(regExpEscape("fooo{20}"));
// re.test("fooo") // => false
// re.test("fooo{20}") // => true
return s.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,'\\$1').replace(/\x08/g,'\\x08');}function succ(s){// Uses char code.
// Example:
// succ("a") // => "b"
// succ("Z") // => "["
return s.slice(0,s.length-1)+String.fromCharCode(s.charCodeAt(s.length-1)+1);}function digitValue(s){// ignore-in-doc
return s.charCodeAt(0)-'0'.charCodeAt(0);}var times=features$1.repeat?function(s,count){return s.repeat(count);}:function(s,count){// Example:
// string.times("test", 3) // => "testtesttest"
return count<1?'':new Array(count+1).join(s);};function longestCommonSubstring(a,b){// Example:
// longestCommonSubstring("bar foo barrr", "hello fooo world");
// => {indexA: 3, indexB: 5, length: 4, string: " foo"}
var lcs=[];for(var _i35=0;_i35<a.length;_i35++){lcs[_i35]=[];for(var j=0;j<b.length;j++){lcs[_i35][j]=0;}}// if B is null then LCS of A, B =0
for(var _i36=0;_i36<a.length;_i36++){lcs[_i36][0]=0;}// fill the rest of the matrix
for(var _i37=1;_i37<a.length;_i37++){for(var _j=1;_j<b.length;_j++){lcs[_i37][_j]=a[_i37-1]==b[_j-1]?lcs[_i37-1][_j-1]+1:0;}}var maxLength=-1;var indexA=-1;var indexB=-1;for(var _i38=0;_i38<a.length;_i38++){for(var _j2=0;_j2<b.length;_j2++){var length=lcs[_i38][_j2];if(maxLength<length){maxLength=length;indexA=_i38-length;indexB=_j2-length;}}}return{length:maxLength,indexA:indexA,indexB:indexB,string:maxLength>0?a.slice(indexA,indexA+maxLength):''};}function applyChange(string,change){// change is of the form
// `{start: Number, end: Number, lines: [String], action: "insert"|"remove"}`
if(change.action==='insert'){return string.slice(0,change.start)+change.lines.join('\n')+string.slice(change.start);}else if(change.action==='remove'){return string.slice(0,change.start)+string.slice(change.end);}return string;}function applyChanges(s,changes){return changes.reduce(function(result,change){return applyChange(s,change);},s);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// diffing / comparing
function levenshtein(a,b){// How many edit operations separate string a from b?
// MIT licensed, https://gist.github.com/andrei-
// Copyright (c) 2011 Andrei Mackenzie and https://github.com/kigiri
if(a.length===0)return b.length;if(b.length===0)return a.length;var tmp,i,j,prev,val,row;// swap to save some memory O(min(a,b)) instead of O(a)
if(a.length>b.length){tmp=a;a=b;b=tmp;}row=Array(a.length+1);// init the row
for(i=0;i<=a.length;i++){row[i]=i;}// fill in the rest
for(i=1;i<=b.length;i++){prev=i;for(j=1;j<=a.length;j++){if(b[i-1]===a[j-1]){val=row[j-1];// match
}else{val=Math.min(row[j-1]+1,// substitution
Math.min(prev+1,// insertion
row[j]+1));// deletion
}row[j-1]=prev;prev=val;}row[a.length]=prev;}return row[a.length];}var string=/*#__PURE__*/Object.freeze({__proto__:null,format:format,formatFromArray:formatFromArray,indent:indent$1,minIndent:minIndent,changeIndent:changeIndent,quote:quote,articlize:articlize$1,findArticle:findArticle,print:print$1,printNested:printNested,pad:pad,printTable:printTable,printTree:printTree,toArray:toArray$1,lines:lines,paragraphs:paragraphs,nonEmptyLines:nonEmptyLines,tokens:tokens,tableize:tableize,unescapeCharacterEntities:unescapeCharacterEntities,base64EncodeUnicode:base64EncodeUnicode,base64DecodeUnicode:base64DecodeUnicode,toQueryParams:toQueryParams,normalizePath:normalizePath,joinPath:joinPath,newUUID:newUUID,createDataURI:createDataURI,hashCode:hashCode,md5:md5,reMatches:reMatches$1,stringMatch:stringMatch,peekRight:peekRight,peekLeft:peekLeft,lineIndexComputer:lineIndexComputer,lineNumberToIndexesComputer:lineNumberToIndexesComputer,findLineWithIndexInLineRanges:findLineWithIndexInLineRanges,regexIndexOf:regexIndexOf,regexLastIndexOf:regexLastIndexOf,lineRanges:lineRanges,diff:diff,empty:empty,includes:includes$1,include:include$1,startsWith:startsWith,startsWithVowel:startsWithVowel,endsWith:endsWith,withDecimalPrecision:withDecimalPrecision,capitalize:capitalize,camelCaseString:camelCaseString,camelize:camelize,truncate:truncate,truncateLeft:truncateLeft,regExpEscape:regExpEscape,succ:succ,digitValue:digitValue,times:times,longestCommonSubstring:longestCommonSubstring,applyChange:applyChange,applyChanges:applyChanges,levenshtein:levenshtein});/*
 * Utility functions for JS Numbers.
 */function random(min,max){// random number between (and including) `min` and `max`
min=min||0;max=max||100;return Math.round(Math.random()*(max-min)+min);}var normalRandom=function(mean,stdDev){// returns randomized numbers in a normal distribution that can be
// controlled ising the `mean` and `stdDev` parameters
var spare;var isSpareReady=false;return function(mean,stdDev){if(isSpareReady){isSpareReady=false;return spare*stdDev+mean;}else{var _u,v,_s2;do{_u=Math.random()*2-1;v=Math.random()*2-1;_s2=_u*_u+v*v;}while(_s2>=1||_s2==0);var mul=Math.sqrt(-2.0*Math.log(_s2)/_s2);spare=v*mul;isSpareReady=true;return mean+stdDev*_u*mul;}};}();function randomSmallerInteger(n){return Math.floor(Math.random()*n);}function humanReadableByteSize(n){// interpret `n` as byte size and print a more readable version
// Example:
//   num.humanReadableByteSize(Math.pow(2,32)) // => "4096MB"
function round(n){return Math.round(n*100)/100;}if(n<1000)return String(round(n))+'B';n=n/1024;if(n<1000)return String(round(n))+'KB';n=n/1024;return String(round(n))+'MB';}function average(numbers){// show-in-doc
return numbers.reduce(function(sum,n){return sum+n;},0)/numbers.length;}function averageInc(newVal,oldAvg,n){// show-in-doc
// Example:
//   let nums = range(0, 10).map(() => random(0, 10))
//   nums.reduce((avg, ea, i) => avgInc(ea, avg, i+1), 0);
return(newVal-oldAvg)/n+oldAvg;}function median(numbers){// show-in-doc
var sorted=numbers.sort(function(a,b){return b-a;});var len=numbers.length;return len%2===0?0.5*(sorted[len/2-1]+sorted[len/2]):sorted[(len-1)/2];}function between(x,a,b,eps){// is `a` <= `x` <= `y`?
eps=eps||0;var min,max;if(a<b){min=a,max=b;}else{max=a,min=b;}return max-x+eps>=0&&min-x-eps<=0;}function clamp(x,lower,upper){return Math.max(lower,Math.min(upper,x));}function sort$1(arr){// numerical sort, JavaScript native `sort` function is lexical by default.
return arr.sort(function(a,b){return a-b;});}function parseLength(string,toUnit){// This converts the length value to pixels or the specified `toUnit`.
// length converstion, supported units are: mm, cm, in, px, pt, pc
// Examples:
// num.parseLength('3cm') // => 113.38582677165354
// num.parseLength('3cm', "in") // => 1.1811023622047243
toUnit=toUnit||'px';var match=string.match(/([0-9\.]+)\s*(.*)/);if(!match||!match[1])return undefined;var length=parseFloat(match[1]);var fromUnit=match[2];return convertLength(length,fromUnit,toUnit);}var convertLength=function(){// ignore-in-doc
// num.convertLength(20, 'px', 'pt').roundTo(0.01)
function toCm(n,unit){// as defined in http://www.w3.org/TR/css3-values/#absolute-lengths
if(unit==='cm')return n;else if(unit==='mm')return n*0.1;else if(unit==='in')return n*2.54;else if(unit==='px')return n*toCm(1/96,'in');else if(unit==='pt')return n*toCm(1/72,'in');else if(unit==='pc')return n*toCm(12,'pt');}return function to(length,fromUnit,toUnit){if(fromUnit===toUnit)return length;else if(toUnit==='cm')return toCm(length,fromUnit);else if(fromUnit==='cm')return length/toCm(1,toUnit);else return to(to(length,fromUnit,'cm'),'cm',toUnit);};}();function precision(f){// given a float value, returns the number of decimals
if(!isFinite(f))return 0;var e=1;var p=0;while(Math.round(f*e)/e!==f){e*=10;p++;}return p;}function roundTo(n,quantum){// `quantum` is something like 0.01,
// for JS rounding to work we need the reciprocal
quantum=1/quantum;return Math.round(n*quantum)/quantum;}function detent(n,detent,grid,snap){// This function is useful to implement smooth transitions and snapping.
// Map all values that are within detent/2 of any multiple of grid to
// that multiple. Otherwise, if snap is true, return self, meaning that
// the values in the dead zone will never be returned. If snap is
// false, then expand the range between dead zone so that it covers the
// range between multiples of the grid, and scale the value by that
// factor.
// Examples:
// // With snapping:
// num.detent(0.11, 0.2, 0.5, true) // => 0.11
// num.detent(0.39, 0.2, 0.5, true) // => 0.39
// num.detent(0.55, 0.2, 0.5, true)  // => 0.5
// num.detent(0.61, 0.2, 0.5, true)   // => 0.61
// // Smooth transitions without snapping:
// num.detent(0.1,  0.2, 0.5) // => 0
// num.detent(0.11,  0.2, 0.5) // => 0.0166666
// num.detent(0.34,  0.2, 0.5)  // => 0.4
// num.detent(0.39,  0.2, 0.5) // => 0.4833334
// num.detent(0.4,  0.2, 0.5) // => 0.5
// num.detent(0.6,  0.2, 0.5) // => 0.5
var r1=roundTo(n,grid);// Nearest multiple of grid
if(Math.abs(n-r1)<detent/2)return r1;// Snap to that multiple...
if(snap)return n;// ...and return n
// or compute nearest end of dead zone
var r2=n<r1?r1-detent/2:r1+detent/2;// and scale values between dead zones to fill range between multiples
return r1+(n-r2)*grid/(grid-detent);}function toDegrees(n){// Example:
// num.toDegrees(Math.PI/2) // => 90
return n*180/Math.PI%360;}function toRadians(n){// Example:
// num.toRadians(180) // => 3.141592653589793
return n/180*Math.PI;}function backoff(attempt)/* ms */{var base=arguments.length>1&&arguments[1]!==undefined?arguments[1]:5;var cap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:30000;// exponential backoff function
// https://www.awsarchitectureblog.com/2015/03/backoff.html
var temp=Math.min(cap,base*Math.pow(2,attempt));var sleep=temp/2+Math.round(Math.random()*(temp/2));return Math.min(cap,base+Math.random()*(sleep*3-base));}function interpolate(i,a,b){return a+i*(b-a);}var num=/*#__PURE__*/Object.freeze({__proto__:null,random:random,normalRandom:normalRandom,randomSmallerInteger:randomSmallerInteger,humanReadableByteSize:humanReadableByteSize,average:average,averageInc:averageInc,median:median,between:between,sort:sort$1,parseLength:parseLength,convertLength:convertLength,roundTo:roundTo,detent:detent,toDegrees:toDegrees,toRadians:toRadians,backoff:backoff,interpolate:interpolate,clamp:clamp,precision:precision});function allOwnPropertiesOrFunctions(obj,predicate){// ignore-in-doc
return Object.getOwnPropertyNames(obj).reduce(function(result,name){if(predicate?predicate(obj,name):true)result.push(name);return result;},[]);}/*
 * Util functions to print and work with JS date objects.
 */var dateFormat=function setupDateFormat(){/*
   * Date Format 1.2.3
   * (c) 2007-2009 Steven Levithan <stevenlevithan.com>
   * MIT license
   *
   * Includes enhancements by Scott Trenda <scott.trenda.net>
   * and Kris Kowal <cixar.com/~kris.kowal/>
   *
   * Accepts a date, a mask, or a date and a mask.
   * Returns a formatted version of the given date.
   * The date defaults to the current date/time.
   * The mask defaults to dateFormat.masks.default.
   */ // http://blog.stevenlevithan.com/archives/date-time-format
var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g;var timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g;var timezoneClip=/[^-+\dA-Z]/g;var pad=function pad(val,len){val=String(val);len=len||2;while(val.length<len){val='0'+val;}return val;};// Regexes and supporting functions are cached through closure
return function(date,mask,utc){var dF=dateFormat;// You can't provide utc if you skip other args (use the "UTC:" mask prefix)
if(arguments.length==1&&Object.prototype.toString.call(date)=='[object String]'&&!/\d/.test(date)){mask=date;date=undefined;}// Passing date through Date applies Date.parse, if necessary
date=date?new Date(date):new Date();if(isNaN(date))throw SyntaxError('invalid date');mask=String(dF.masks[mask]||mask||dF.masks["default"]);// Allow setting the utc argument via the mask
if(mask.slice(0,4)=='UTC:'){mask=mask.slice(4);utc=true;}var _=utc?'getUTC':'get';var d=date[_+'Date']();var D=date[_+'Day']();var m=date[_+'Month']();var y=date[_+'FullYear']();var H=date[_+'Hours']();var M=date[_+'Minutes']();var s=date[_+'Seconds']();var L=date[_+'Milliseconds']();var o=utc?0:date.getTimezoneOffset();var flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?'a':'p',tt:H<12?'am':'pm',T:H<12?'A':'P',TT:H<12?'AM':'PM',Z:utc?'UTC':(String(date).match(timezone)||['']).pop().replace(timezoneClip,''),o:(o>0?'-':'+')+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:['th','st','nd','rd'][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1);});};}();// Some common format strings
dateFormat.masks={"default":'ddd mmm dd yyyy HH:MM:ss',shortDate:'m/d/yy',mediumDate:'mmm d, yyyy',longDate:'mmmm d, yyyy',fullDate:'dddd, mmmm d, yyyy',shortTime:'h:MM TT',mediumTime:'h:MM:ss TT',longTime:'h:MM:ss TT Z',isoDate:'yyyy-mm-dd',isoTime:'HH:MM:ss',isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};// Internationalization strings
dateFormat.i18n={dayNames:['Sun','Mon','Tue','Wed','Thu','Fri','Sat','Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],monthNames:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec','January','February','March','April','May','June','July','August','September','October','November','December']};return dateFormat;}();// end of setupDateFormat
function format$1(date,mask,utc){// Custom date / time stringifier. Provides default masks:
//
// Mask           | Pattern
// ---------------|--------------------------------
// default        | `"ddd mmm dd yyyy HH:MM:ss"`
// shortDate      | `"m/d/yy"`
// mediumDate     | `"mmm d, yyyy"`
// longDate       | `"mmmm d, yyyy"`
// fullDate       | `"dddd, mmmm d, yyyy"`
// shortTime      | `"h:MM TT"`
// mediumTime     | `"h:MM:ss TT"`
// longTime       | `"h:MM:ss TT Z"`
// isoDate        | `"yyyy-mm-dd"`
// isoTime        | `"HH:MM:ss"`
// isoDateTime    | `"yyyy-mm-dd'T'HH:MM:ss"`
// isoUtcDateTime | `"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"`
//
// and internationalized strings via `date.format.i18n.dayNames`
// and `date.format.i18n.dayNames`
// Examples:
//   date.format(new Date(), date.format.masks.longTime) // => "7:13:31 PM PDT"
//   date.format(new Date(), "yyyy/mm/dd") // => "2014/10/09"
return dateFormat(date,mask,utc);}function equals$2(date,otherDate){// show-in-doc
return otherDate&&otherDate instanceof Date&&otherDate.getTime()===date.getTime();}function relativeTo(date,otherDate){var opts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};// Prints a human readable difference of two Date objects. The older date
// goes first.
// Examples:
//   var now = new Date();
//   date.relativeTo(new Date(now-2000), now) // => "2 secs"
//   date.relativeTo(new Date("10/11/2014"), new Date("10/12/2014")) // => "1 day"
if(!(otherDate instanceof Date))return'';if(otherDate<date)return'';if(otherDate===date)return'now';var minuteString='min';var secondString='sec';var hourString='hour';var dayString='day';var diff=otherDate-date;var totalSecs=Math.round(diff/1000);var secs=totalSecs%60;var mins=Math.floor(totalSecs/60)%60;var hours=Math.floor(totalSecs/60/60)%24;var days=Math.floor(totalSecs/60/60/24);var parts=[];if(days>0){parts.push(days);if(days>1)dayString+='s';parts.push(dayString);}if(opts.forceHours||hours>0&&days<2){parts.push(hours);if(hours>1)hourString+='s';parts.push(hourString);}if(opts.forceMinutes||mins>0&&hours<3&&days===0){parts.push(mins);if(mins>1)minuteString+='s';parts.push(minuteString);}if(opts.forceSeconds||secs>0&&mins<3&&hours===0&&days===0){parts.push(secs);if(secs>1)secondString+='s';parts.push(secondString);}return parts.join(' ');}var date=/*#__PURE__*/Object.freeze({__proto__:null,format:format$1,equals:equals$2,relativeTo:relativeTo,dateFormat:dateFormat});/* global require, process, Promise, System */ /*
 * Methods helping with promises (Promise/A+ model). Not a promise shim.
 */function promise(obj){// Promise object / function converter
// Example:
// promise("foo");
//   // => Promise({state: "fullfilled", value: "foo"})
// lively.lang.promise({then: (resolve, reject) => resolve(23)})
//   // => Promise({state: "fullfilled", value: 23})
// lively.lang.promise(function(val, thenDo) { thenDo(null, val + 1) })(3)
//   // => Promise({state: "fullfilled", value: 4})
return typeof obj==='function'?promise.convertCallbackFun(obj):Promise.resolve(obj);}function delay$1(ms,resolveVal){// Like `Promise.resolve(resolveVal)` but waits for `ms` milliseconds
// before resolving
return new Promise(function(resolve){return setTimeout(resolve,ms,resolveVal);});}function delayReject(ms,rejectVal){// like `promise.delay` but rejects
return new Promise(function(_,reject){return setTimeout(reject,ms,rejectVal);});}function timeout(ms,promise){// Takes a promise and either resolves to the value of the original promise
// when it succeeds before `ms` milliseconds passed or fails with a timeout
// error
return new Promise(function(resolve,reject){var done=false;setTimeout(function(){return!done&&(done=true)&&reject(new Error('Promise timed out'));},ms);promise.then(function(val){return!done&&(done=true)&&resolve(val);},function(err){return!done&&(done=true)&&reject(err);});});}function waitFor$1(ms,tester,timeoutObj){// Tests for a condition calling function `tester` until the result is
// truthy. Resolves with last return value of `tester`. If `ms` is defined
// and `ms` milliseconds passed, reject with timeout error
// if timeoutObj is passed will resolve(!) with this object instead of raise
// an error
if(typeof ms==='function'){tester=ms;ms=undefined;}return new Promise(function(resolve,reject){var stopped=false;var timedout=false;var error;var value;var stopWaiting=function stopWaiting(i){clearInterval(i);};var i=setInterval(function(){if(stopped)return stopWaiting(i);try{value=tester();}catch(e){error=e;}if(!value&&!error&&!timedout)return;stopped=true;stopWaiting(i);if(error)return reject(error);if(timedout){return typeof timeoutObj==='undefined'?reject(new Error('timeout')):resolve(timeoutObj);}return resolve(value);},10);if(typeof ms==='number')setTimeout(function(){return timedout=true;},ms);});}function deferred(){// returns an object
// `{resolve: FUNCTION, reject: FUNCTION, promise: PROMISE}`
// that separates the resolve/reject handling from the promise itself
// Similar to the deprecated `Promise.defer()`
var resolve;var reject;var promise=new Promise(function(_resolve,_reject){resolve=_resolve;reject=_reject;});return{resolve:resolve,reject:reject,promise:promise};}function convertCallbackFun(func){// Takes a function that accepts a nodejs-style callback function as a last
// parameter and converts it to a function *not* taking the callback but
// producing a promise instead. The promise will be resolved with the
// *first* non-error argument.
// nodejs callback convention: a function that takes as first parameter an
// error arg and second+ parameters are the result(s).
// Example:
// var fs = require("fs"),
//     readFile = promise.convertCallbackFun(fs.readFile);
// readFile("./some-file.txt")
//   .then(content => console.log(String(content)))
//   .catch(err => console.error("Could not read file!", err));
return function promiseGenerator()/* args */{var args=Array.from(arguments);var self=this;return new Promise(function(resolve,reject){args.push(function(err,result){return err?reject(err):resolve(result);});func.apply(self,args);});};}function convertCallbackFunWithManyArgs(func){// like convertCallbackFun but the promise will be resolved with the
// all non-error arguments wrapped in an array.
return function promiseGenerator()/* args */{var args=Array.from(arguments);var self=this;return new Promise(function(resolve,reject){args.push(function()/* err + args */{var args=Array.from(arguments);var err=args.shift();return err?reject(err):resolve(args);});func.apply(self,args);});};}function _chainResolveNext(promiseFuncs,prevResult,akku,resolve,reject){var next=promiseFuncs.shift();if(!next)resolve(prevResult);else{try{Promise.resolve(next(prevResult,akku)).then(function(result){return _chainResolveNext(promiseFuncs,result,akku,resolve,reject);})["catch"](function(err){reject(err);});}catch(err){reject(err);}}}function chain(promiseFuncs){// Similar to Promise.all but takes a list of promise-producing functions
// (instead of Promises directly) that are run sequentially. Each function
// gets the result of the previous promise and a shared "state" object passed
// in. The function should return either a value or a promise. The result of
// the entire chain call is a promise itself that either resolves to the last
// returned value or rejects with an error that appeared somewhere in the
// promise chain. In case of an error the chain stops at that point.
// Example:
// lively.lang.promise.chain([
//   () => Promise.resolve(23),
//   (prevVal, state) => { state.first = prevVal; return prevVal + 2 },
//   (prevVal, state) => { state.second = prevVal; return state }
// ]).then(result => console.log(result));
// // => prints {first: 23,second: 25}
return new Promise(function(resolve,reject){return _chainResolveNext(promiseFuncs.slice(),undefined,{},resolve,reject);});}function promise_finally(promise,finallyFn){return Promise.resolve(promise).then(function(result){try{finallyFn();}catch(err){console.error('Error in promise finally: '+err.stack||err);}return result;})["catch"](function(err){try{finallyFn();}catch(err){console.error('Error in promise finally: '+err.stack||err);}throw err;});}function parallel(promiseGenFns){var parallelLimit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Infinity;// Starts functions from promiseGenFns that are expected to return a promise
// Once `parallelLimit` promises are unresolved at the same time, stops
// spawning further promises until a running promise resolves
if(!promiseGenFns.length)return Promise.resolve([]);var results=[];var error=null;var index=0;var left=promiseGenFns.length;var resolve;var reject;return new Promise(function(res,rej){resolve=function resolve(){return res(results);};reject=function reject(err){return rej(error=err);};spawnMore();});function spawn(){parallelLimit--;try{var _i39=index++;var prom=promiseGenFns[_i39]();prom.then(function(result){parallelLimit++;results[_i39]=result;if(--left===0)resolve();else spawnMore();})["catch"](function(err){return reject(err);});}catch(err){reject(err);}}function spawnMore(){while(!error&&left>0&&index<promiseGenFns.length&&parallelLimit>0){spawn();}}}// FIXME!
Object.assign(promise,{delay:delay$1,delayReject:delayReject,timeout:timeout,waitFor:waitFor$1,deferred:deferred,convertCallbackFun:convertCallbackFun,convertCallbackFunWithManyArgs:convertCallbackFunWithManyArgs,chain:chain,"finally":promise_finally,parallel:parallel});// -=-=-=-=-=-=-=-=-=-=-=-=-=-
function Path(p,splitter){if(p instanceof Path)return p;if(!(this instanceof Path))return new Path(p,splitter);this.setSplitter(splitter||'.');this.fromPath(p);}Object.assign(Path.prototype,{get isPathAccessor(){return true;},fromPath:function fromPath(path){// ignore-in-doc
if(typeof path==='string'&&path!==''&&path!==this.splitter){this._parts=path.split(this.splitter);this._path=path;}else if(Array.isArray(path)){this._parts=[].concat(path);this._path=path.join(this.splitter);}else{this._parts=[];this._path='';}return this;},setSplitter:function setSplitter(splitter){// ignore-in-doc
if(splitter)this.splitter=splitter;return this;},map:function map(fn){this._mapper=fn;return this;},parts:function parts(){/* key names as array */return this._parts;},size:function size(){/* show-in-doc */return this._parts.length;},slice:function slice(n,m){/* show-in-doc */return Path(this.parts().slice(n,m));},normalizePath:function normalizePath(){// ignore-in-doc
// FIXME: define normalization
return this._path;},isRoot:function isRoot(obj){return this._parts.length===0;},isIn:function isIn(obj){// Does the Path resolve to a value when applied to `obj`?
if(this.isRoot())return true;var parent=this.get(obj,-1);return parent&&parent.hasOwnProperty(this._parts[this._parts.length-1]);},equals:function equals(obj){// Example:
// var p1 = Path("foo.1.bar.baz"), p2 = Path(["foo", 1, "bar", "baz"]);
// // Path's can be both created via strings or pre-parsed with keys in a list.
// p1.equals(p2) // => true
return obj&&obj.isPathAccessor&&this.parts().equals(obj.parts());},isParentPathOf:function isParentPathOf(otherPath){// Example:
// var p1 = Path("foo.1.bar.baz"), p2 = Path("foo.1.bar");
// p2.isParentPathOf(p1) // => true
// p1.isParentPathOf(p2) // => false
otherPath=otherPath&&otherPath.isPathAccessor?otherPath:Path(otherPath);var parts=this.parts();var otherParts=otherPath.parts();for(var _i40=0;_i40<parts.length;_i40++){if(parts[_i40]!=otherParts[_i40])return false;}return true;},relativePathTo:function relativePathTo(otherPath){// Example:
// var p1 = Path("foo.1.bar.baz"), p2 = Path("foo.1");
// p2.relativePathTo(p1) // => Path(["bar","baz"])
// p1.relativePathTo(p2) // => undefined
otherPath=Path(otherPath);return this.isParentPathOf(otherPath)?otherPath.slice(this.size(),otherPath.size()):undefined;},del:function del(obj){if(this.isRoot())return false;var parent=obj;for(var _i41=0;_i41<this._parts.length-1;_i41++){var part=this._parts[_i41];if(parent.hasOwnProperty(part)){parent=parent[part];}else return false;}return delete parent[this._parts[this._parts.length-1]];},withParentAndKeyDo:function withParentAndKeyDo(obj,ensure,doFunc){// Deeply resolve path in `obj`, not fully, however, only to the parent
// element of the last part of path. Take the parent, the key (the last
// part of path) and pass it to `doFunc`. When `ensure` is true, create
// objects along path it path does not resolve
if(this.isRoot())return doFunc(null,null);var parent=obj;for(var _i42=0;_i42<this._parts.length-1;_i42++){var part=this._parts[_i42];if(parent.hasOwnProperty(part)&&(_typeof2(parent[part])==='object'||typeof parent[part]==='function')){parent=parent[part];}else if(ensure){parent=parent[part]={};}else{return doFunc(null,part);}}return doFunc(parent,this._parts[this._parts.length-1]);},set:function set(obj,val,ensure){// Deeply resolve path in `obj` and set the resulting property to `val`. If
// `ensure` is true, create nested structure in between as necessary.
// Example:
// var o1 = {foo: {bar: {baz: 42}}};
// var path = Path("foo.bar.baz");
// path.set(o1, 43)
// o1 // => {foo: {bar: {baz: 43}}}
// var o2 = {foo: {}};
// path.set(o2, 43, true)
// o2 // => {foo: {bar: {baz: 43}}}
return this.withParentAndKeyDo(obj,ensure,function(parent,key){return parent?parent[key]=val:undefined;});},defineProperty:function defineProperty(obj,propertySpec,ensure){// like `Path>>set`, however uses Objeect.defineProperty
return this.withParentAndKeyDo(obj,ensure,function(parent,key){return parent?Object.defineProperty(parent,key,propertySpec):undefined;});},get:function get(obj,n){// show-in-doc
var parts=n?this._parts.slice(0,n):this._parts;var self=this;return parts.reduce(function(current,pathPart){return current?self._mapper?self._mapper(pathPart,current[pathPart]):current[pathPart]:current;},obj);},concat:function concat(p,splitter){// show-in-doc
return Path(this.parts().concat(Path(p,splitter).parts()));},toString:function toString(){return this.normalizePath();},serializeExpr:function serializeExpr(){// ignore-in-doc
return'lively.lang.Path('+inspect(this.parts())+')';},watch:function watch(options){// React or be notified on reads or writes to a path in a `target`. Options:
// ```js
// {
//   target: OBJECT,
//   uninstall: BOOLEAN,
//   onGet: FUNCTION,
//   onSet: FUNCTION,
//   haltWhenChanged: BOOLEAN,
//   verbose: BOOLEAN
// }
// ```
// Example:
// // Quite useful for debugging to find out what call-sites change an object.
// var o = {foo: {bar: 23}};
// Path("foo.bar").watch({target: o, verbose: true});
// o.foo.bar = 24; // => You should see: "[object Object].bar changed: 23 -> 24"
if(!options||this.isRoot())return;var target=options.target;var parent=this.get(target,-1);var propName=this.parts().slice(-1)[0];var newPropName='propertyWatcher$'+propName;var watcherIsInstalled=parent&&parent.hasOwnProperty(newPropName);var uninstall=options.uninstall;var haltWhenChanged=options.haltWhenChanged;var showStack=options.showStack;var getter=parent.__lookupGetter__(propName);var setter=parent.__lookupSetter__(propName);if(!target||!propName||!parent)return;if(uninstall){if(!watcherIsInstalled)return;delete parent[propName];parent[propName]=parent[newPropName];delete parent[newPropName];var msg='Watcher for '+parent+'.'+propName+' uninstalled';return;}if(watcherIsInstalled){var msg='Watcher for '+parent+'.'+propName+' already installed';return;}if(getter||setter){var msg=parent+'["'+propName+'"] is a getter/setter, watching not support';console.log(msg);return;}// observe slots, for debugging
parent[newPropName]=parent[propName];parent.__defineSetter__(propName,function(v){var oldValue=parent[newPropName];if(options.onSet)options.onSet(v,oldValue);var msg=parent+'.'+propName+' changed: '+oldValue+' -> '+v;if(showStack){msg+='\n'+(typeof lively!=='undefined'?lively.printStack():console.trace());}if(options.verbose){console.log(msg);}if(haltWhenChanged)debugger;return parent[newPropName]=v;});parent.__defineGetter__(propName,function(){if(options.onGet)options.onGet(parent[newPropName]);return parent[newPropName];});var msg='Watcher for '+parent+'.'+propName+' installed';console.log(msg);},debugFunctionWrapper:function debugFunctionWrapper(options){// ignore-in-doc
// options = {target, [haltWhenChanged, showStack, verbose, uninstall]}
var target=options.target;var parent=this.get(target,-1);var funcName=this.parts().slice(-1)[0];var uninstall=options.uninstall;var haltWhenChanged=options.haltWhenChanged===undefined?true:options.haltWhenChanged;var showStack=options.showStack;var func=parent&&funcName&&parent[funcName];var debuggerInstalled=func&&func.isDebugFunctionWrapper;if(!target||!funcName||!func||!parent)return;if(uninstall){if(!debuggerInstalled)return;parent[funcName]=parent[funcName].debugTargetFunction;var msg='Uninstalled debugFunctionWrapper for '+parent+'.'+funcName;console.log(msg);return;}if(debuggerInstalled){var msg='debugFunctionWrapper for '+parent+'.'+funcName+' already installed';console.log(msg);return;}var debugFunc=parent[funcName]=func.wrap(function(proceed){var args=Array.from(arguments);if(haltWhenChanged)debugger;return args.shift().apply(parent,args);});debugFunc.isDebugFunctionWrapper=true;debugFunc.debugTargetFunction=func;var msg='debugFunctionWrapper for '+parent+'.'+funcName+' installed';console.log(msg);}});/*
Computation over graphs. Unless otherwise specified a graph is a simple JS
object whose properties are interpreted as nodes that refer to arrays whose
elements describe edges. Example:

```js
var testGraph = {
  "a": ["b", "c"],
  "b": ["c", "d", "e", "f"],
  "d": ["c", "f"],
  "e": ["a", "f"],
  "f": []
}
```
*/function hull(g,id){var ignoredKeyList=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var maxDepth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Infinity;// Takes a graph in object format and a start id and then traverses the
// graph and gathers all nodes that can be reached from that start id.
// Returns a list of those nodes.
// Optionally use `ignore` list to filter out certain nodes that shouldn't
// be considered and maxDepth to stop early. By default a maxDepth of 20 is
// used.
// Example:
// var testGraph = {
// "a": ["b", "c"],
// "b": ["c", "d", "e", "f"],
// "d": ["c", "f"],
// "e": ["a", "f"],
// "f": []
// }
// hull(testGraph, "d") // => ["c", "f"]
// hull(testGraph, "e") // => ['a', 'f', 'b', 'c', 'd', 'e']
// hull(testGraph, "e", ["b"]) // => ["a", "f", "c"]
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// below is an optimized variant, the functional but slow version:
// return uniq(
//         flatten(
//           values(
//             subgraphReachableBy(
//               graphMap, id, ignore, maxDepth))));
if(!Array.isArray(g[id]))return[];var hull=[];var visited={};var ignoredKeys={};for(var _i43=0;_i43<ignoredKeyList.length;_i43++){ignoredKeys[ignoredKeyList[_i43]]=true;}var toVisitList=g[id].slice();var toVisitMapAndDistFromRoot={};for(var _i44=toVisitList.length;_i44--;){var key=toVisitList[_i44];if(key in ignoredKeys)toVisitList.splice(_i44,1);else toVisitMapAndDistFromRoot[key]=1;}if(ignoredKeyList){while(true){if(toVisitList.length===0)break;for(var _i45=0;_i45<toVisitList.length;_i45++){var _key5=toVisitList.shift();if(_key5 in visited||_key5 in ignoredKeys)continue;var dist=toVisitMapAndDistFromRoot[_key5]||0;if(dist>maxDepth)continue;hull.push(_key5);visited[_key5]=true;var refs=g[_key5];if(!refs)continue;for(var j=0;j<refs.length;j++){var refKey=refs[j];if(refKey in visited||refKey in toVisitMapAndDistFromRoot)continue;toVisitMapAndDistFromRoot[refKey]=dist+1;toVisitList.push(refKey);}}}}return hull;}function invert(g){// inverts the references of graph object `g`.
// Example:
// invert({a: ["b"], b: ["a", "c"]})
//   // => {a: ["b"], b: ["a"], c: ["b"]}
var inverted={};for(var key in g){var refs=g[key];for(var _i46=0;_i46<refs.length;_i46++){var key2=refs[_i46];if(!inverted[key2])inverted[key2]=[key];else inverted[key2].push(key);}}return inverted;}/* global System, global */ // show-in-doc
// Intervals are arrays whose first two elements are numbers and the
// first element should be less or equal the second element, see
// [`interval.isInterval`](). This abstraction is useful when working with text
// ranges in rich text, for example.
var GLOBAL$1=typeof System!=='undefined'?System.global:typeof window!=='undefined'?window:global;/*
 * Methods for traversing and transforming tree structures.
 */function filter$1(treeNode,testFunc,childGetter){// Traverses a `treeNode` recursively and returns all nodes for which
// `testFunc` returns true. `childGetter` is a function to retrieve the
// children from a node.
var result=[];if(testFunc(treeNode))result.push(treeNode);return result.concat(flatten((childGetter(treeNode)||[]).map(function(n){return filter$1(n,testFunc,childGetter);})));}/* global process, require */ /*
 * A simple node.js-like cross-platform event emitter implementation that can
 * be used as a mixin. Emitters support the methods: `on(eventName, handlerFunc)`,
 * `once(eventName, handlerFunc)`, `emit(eventName, eventData)`,
 * `removeListener(eventName, handlerFunc)`, `removeAllListeners(eventName)`
 * Example:
 * var emitter = events.makeEmitter({});
 * var log = [];
 * emitter.on("test", function() { log.push("listener1"); });
 * emitter.once("test", function() { log.push("listener2"); });
 * emitter.emit("test");
 * emitter.emit("test");
 * log // => ["listener1","listener2","listener1"]
 * emitter.removeAllListeners("test");
 * emitter.emit("test");
 * log // => is still ["listener1","listener2","listener1"]
 */var isNode=typeof process!=='undefined'&&process.versions&&process.versions.node;var makeEmitter=isNode?function(obj,options){if(obj.on&&obj.removeListener)return obj;var events=typeof System!=='undefined'?System._nodeRequire('events'):require('events');Object.assign(obj,events.EventEmitter.prototype);events.EventEmitter.call(obj);if(options&&options.maxListenerLimit){obj.setMaxListeners(options.maxListenerLimit);}return obj;}:function(obj){if(obj.on&&obj.removeListener)return obj;obj.listeners={};obj.on=function(type,handler){if(!handler)return;if(!obj.listeners[type]){obj.listeners[type]=[];}obj.listeners[type].push(handler);};obj.once=function(type,handler){if(!handler)return;function onceHandler/* ignore-in-docs args */(){obj.removeListener(type,onceHandler);handler.apply(this,arguments);}obj.on(type,onceHandler);};obj.removeListener=function(type,handler){if(!obj.listeners[type])return;obj.listeners[type]=obj.listeners[type].filter(function(h){return h!==handler;});};obj.removeAllListeners=function(type){if(!obj.listeners[type])return;obj.listeners[type]=[];};obj.emit=function()/* type and args */{var args=Array.prototype.slice.call(arguments);var type=args.shift();var handlers=obj.listeners[type];if(!handlers||!handlers.length)return;handlers.forEach(function(handler){try{handler.apply(null,args);}catch(e){console.error('Error in event handler: %s',e.stack||String(e));}});};return obj;};/* global global,self,process */var isNode$1=typeof process!=='undefined'&&process.env&&typeof process.exit==='function';function chain$1(object){if(!object)return object;if(Array.isArray(object))return createChain(arr,object);if(object.constructor.name==='Date')return createChain(date,object);switch(_typeof2(object)){case'string':return createChain(string,object);case'object':return createChain(obj,object);case'function':return createChain(fun,object);case'number':return createChain(num,object);}throw new Error('Chain for object '+object+' ('+object.constructor.name+') no supported');}function createChain(interfaceObj,obj){return Object.keys(interfaceObj).reduce(function(chained,methodName){chained[methodName]=function()/* args */{var args=Array.prototype.slice.call(arguments);var result=interfaceObj[methodName].apply(null,[obj].concat(args));return chain$1(result);};return chained;},{value:function value(){return obj;}});}function install(System,methodName,hook){var hookName=arguments.length>3&&arguments[3]!==undefined?arguments[3]:hook.name;var wrapper=System[methodName]=wrap(System[methodName],hook);wrapper.hookFunc=hook;hook.hookName=hookName;// function.name is not reliable when minified!
}function remove$1(System,methodName,hookOrName){var chain=[],f=System[methodName];while(f){chain.push(f);f=f.originalFunction;}var found=typeof hookOrName==="string"?chain.find(function(wrapper){return wrapper.hookFunc&&wrapper.hookFunc.hookName===hookOrName;}):chain.find(function(wrapper){return wrapper.hookFunc===hookOrName;});if(!found)return false;_remove4(chain,found);System[methodName]=chain.reduceRight(function(method,wrapper){return wrap(method,wrapper.hookFunc||wrapper);});return true;}function isInstalled(System,methodName,hookOrName){var f=System[methodName];while(f){if(f.hookFunc){if(typeof hookOrName==="string"&&f.hookFunc.hookName===hookOrName)return true;else if(f.hookFunc===hookOrName)return true;}f=f.originalFunction;}return false;}// this module's purpose is to hold references that cause cyclical references
// and screw up the build process of rollup. This is a dirty hack, that should
// be removed as soon as possible from the system.
var classHolder={};// <<<<<<<<<<<<< BEGIN OF AUTO GENERATED CODE <<<<<<<<<<<<<
// Generated on 20-02-27 10:47 GMT+0100
var Visitor=/*#__PURE__*/function(){function Visitor(){_classCallCheck(this,Visitor);}_createClass(Visitor,[{key:"accept",value:function accept(node,state,path){if(!node)throw new Error('Undefined AST node in Visitor.accept:\n  '+path.join('.')+'\n  '+node);if(!node.type)throw new Error('Strangee AST node without type in Visitor.accept:\n  '+path.join('.')+'\n  '+JSON.stringify(node));switch(node.type){case'Node':return this.visitNode(node,state,path);case'SourceLocation':return this.visitSourceLocation(node,state,path);case'Position':return this.visitPosition(node,state,path);case'Program':return this.visitProgram(node,state,path);case'Function':return this.visitFunction(node,state,path);case'Statement':return this.visitStatement(node,state,path);case'Directive':return this.visitDirective(node,state,path);case'SwitchCase':return this.visitSwitchCase(node,state,path);case'CatchClause':return this.visitCatchClause(node,state,path);case'VariableDeclarator':return this.visitVariableDeclarator(node,state,path);case'Expression':return this.visitExpression(node,state,path);case'Property':return this.visitProperty(node,state,path);case'Pattern':return this.visitPattern(node,state,path);case'Super':return this.visitSuper(node,state,path);case'SpreadElement':return this.visitSpreadElement(node,state,path);case'TemplateElement':return this.visitTemplateElement(node,state,path);case'Class':return this.visitClass(node,state,path);case'ClassBody':return this.visitClassBody(node,state,path);case'MethodDefinition':return this.visitMethodDefinition(node,state,path);case'ModuleDeclaration':return this.visitModuleDeclaration(node,state,path);case'ModuleSpecifier':return this.visitModuleSpecifier(node,state,path);case'JSXEmptyExpression':return this.visitJSXEmptyExpression(node,state,path);case'JSXExpressionContainer':return this.visitJSXExpressionContainer(node,state,path);case'JSXSpreadChild':return this.visitJSXSpreadChild(node,state,path);case'JSXBoundaryElement':return this.visitJSXBoundaryElement(node,state,path);case'JSXAttribute':return this.visitJSXAttribute(node,state,path);case'JSXText':return this.visitJSXText(node,state,path);case'JSXOpeningFragment':return this.visitJSXOpeningFragment(node,state,path);case'JSXClosingFragment':return this.visitJSXClosingFragment(node,state,path);case'Identifier':return this.visitIdentifier(node,state,path);case'Literal':return this.visitLiteral(node,state,path);case'ExpressionStatement':return this.visitExpressionStatement(node,state,path);case'BlockStatement':return this.visitBlockStatement(node,state,path);case'EmptyStatement':return this.visitEmptyStatement(node,state,path);case'DebuggerStatement':return this.visitDebuggerStatement(node,state,path);case'WithStatement':return this.visitWithStatement(node,state,path);case'ReturnStatement':return this.visitReturnStatement(node,state,path);case'LabeledStatement':return this.visitLabeledStatement(node,state,path);case'BreakStatement':return this.visitBreakStatement(node,state,path);case'ContinueStatement':return this.visitContinueStatement(node,state,path);case'IfStatement':return this.visitIfStatement(node,state,path);case'SwitchStatement':return this.visitSwitchStatement(node,state,path);case'ThrowStatement':return this.visitThrowStatement(node,state,path);case'TryStatement':return this.visitTryStatement(node,state,path);case'WhileStatement':return this.visitWhileStatement(node,state,path);case'DoWhileStatement':return this.visitDoWhileStatement(node,state,path);case'ForStatement':return this.visitForStatement(node,state,path);case'ForInStatement':return this.visitForInStatement(node,state,path);case'Declaration':return this.visitDeclaration(node,state,path);case'ThisExpression':return this.visitThisExpression(node,state,path);case'ArrayExpression':return this.visitArrayExpression(node,state,path);case'ObjectExpression':return this.visitObjectExpression(node,state,path);case'FunctionExpression':return this.visitFunctionExpression(node,state,path);case'UnaryExpression':return this.visitUnaryExpression(node,state,path);case'UpdateExpression':return this.visitUpdateExpression(node,state,path);case'BinaryExpression':return this.visitBinaryExpression(node,state,path);case'AssignmentExpression':return this.visitAssignmentExpression(node,state,path);case'LogicalExpression':return this.visitLogicalExpression(node,state,path);case'MemberExpression':return this.visitMemberExpression(node,state,path);case'ConditionalExpression':return this.visitConditionalExpression(node,state,path);case'CallExpression':return this.visitCallExpression(node,state,path);case'NewExpression':return this.visitNewExpression(node,state,path);case'SequenceExpression':return this.visitSequenceExpression(node,state,path);case'ArrowFunctionExpression':return this.visitArrowFunctionExpression(node,state,path);case'YieldExpression':return this.visitYieldExpression(node,state,path);case'TemplateLiteral':return this.visitTemplateLiteral(node,state,path);case'TaggedTemplateExpression':return this.visitTaggedTemplateExpression(node,state,path);case'AssignmentProperty':return this.visitAssignmentProperty(node,state,path);case'ObjectPattern':return this.visitObjectPattern(node,state,path);case'ArrayPattern':return this.visitArrayPattern(node,state,path);case'RestElement':return this.visitRestElement(node,state,path);case'AssignmentPattern':return this.visitAssignmentPattern(node,state,path);case'ClassExpression':return this.visitClassExpression(node,state,path);case'MetaProperty':return this.visitMetaProperty(node,state,path);case'ImportDeclaration':return this.visitImportDeclaration(node,state,path);case'ImportSpecifier':return this.visitImportSpecifier(node,state,path);case'ImportDefaultSpecifier':return this.visitImportDefaultSpecifier(node,state,path);case'ImportNamespaceSpecifier':return this.visitImportNamespaceSpecifier(node,state,path);case'ExportNamedDeclaration':return this.visitExportNamedDeclaration(node,state,path);case'ExportSpecifier':return this.visitExportSpecifier(node,state,path);case'AnonymousDefaultExportedFunctionDeclaration':return this.visitAnonymousDefaultExportedFunctionDeclaration(node,state,path);case'AnonymousDefaultExportedClassDeclaration':return this.visitAnonymousDefaultExportedClassDeclaration(node,state,path);case'ExportDefaultDeclaration':return this.visitExportDefaultDeclaration(node,state,path);case'ExportAllDeclaration':return this.visitExportAllDeclaration(node,state,path);case'AwaitExpression':return this.visitAwaitExpression(node,state,path);case'JSXMemberExpression':return this.visitJSXMemberExpression(node,state,path);case'JSXNamespacedName':return this.visitJSXNamespacedName(node,state,path);case'JSXOpeningElement':return this.visitJSXOpeningElement(node,state,path);case'JSXClosingElement':return this.visitJSXClosingElement(node,state,path);case'JSXSpreadAttribute':return this.visitJSXSpreadAttribute(node,state,path);case'JSXElement':return this.visitJSXElement(node,state,path);case'JSXFragment':return this.visitJSXFragment(node,state,path);case'ImportExpression':return this.visitImportExpression(node,state,path);case'RegExpLiteral':return this.visitRegExpLiteral(node,state,path);case'FunctionBody':return this.visitFunctionBody(node,state,path);case'FunctionDeclaration':return this.visitFunctionDeclaration(node,state,path);case'VariableDeclaration':return this.visitVariableDeclaration(node,state,path);case'ForOfStatement':return this.visitForOfStatement(node,state,path);case'ClassDeclaration':return this.visitClassDeclaration(node,state,path);case'JSXIdentifier':return this.visitJSXIdentifier(node,state,path);case'BigIntLiteral':return this.visitBigIntLiteral(node,state,path);}throw new Error('No visit function in AST visitor Visitor for:\n  '+path.join('.')+'\n  '+JSON.stringify(node));}},{key:"visitNode",value:function visitNode(node,state,path){return node;}},{key:"visitSourceLocation",value:function visitSourceLocation(node,state,path){var visitor=this;// start is of types Position
node.start=visitor.accept(node.start,state,path.concat(['start']));// end is of types Position
node.end=visitor.accept(node.end,state,path.concat(['end']));return node;}},{key:"visitPosition",value:function visitPosition(node,state,path){return node;}},{key:"visitProgram",value:function visitProgram(node,state,path){var visitor=this;// body is a list with types Statement, ModuleDeclaration
var newElements=[];for(var _i47=0;_i47<node.body.length;_i47++){var ea=node.body[_i47];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['body',_i47])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.body=newElements;return node;}},{key:"visitFunction",value:function visitFunction(node,state,path){var visitor=this;// id is of types Identifier
if(node.id){node.id=visitor.accept(node.id,state,path.concat(['id']));}// params is a list with types Pattern
var newElements=[];for(var _i48=0;_i48<node.params.length;_i48++){var ea=node.params[_i48];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['params',_i48])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.params=newElements;// body is of types FunctionBody
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitStatement",value:function visitStatement(node,state,path){return node;}},{key:"visitDirective",value:function visitDirective(node,state,path){var visitor=this;// expression is of types Literal
node.expression=visitor.accept(node.expression,state,path.concat(['expression']));return node;}},{key:"visitSwitchCase",value:function visitSwitchCase(node,state,path){var visitor=this;// test is of types Expression
if(node.test){node.test=visitor.accept(node.test,state,path.concat(['test']));}// consequent is a list with types Statement
var newElements=[];for(var _i49=0;_i49<node.consequent.length;_i49++){var ea=node.consequent[_i49];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['consequent',_i49])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.consequent=newElements;return node;}},{key:"visitCatchClause",value:function visitCatchClause(node,state,path){var visitor=this;// param is of types Pattern
if(node.param){node.param=visitor.accept(node.param,state,path.concat(['param']));}// body is of types BlockStatement
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitVariableDeclarator",value:function visitVariableDeclarator(node,state,path){var visitor=this;// id is of types Pattern
node.id=visitor.accept(node.id,state,path.concat(['id']));// init is of types Expression
if(node.init){node.init=visitor.accept(node.init,state,path.concat(['init']));}return node;}},{key:"visitExpression",value:function visitExpression(node,state,path){return node;}},{key:"visitProperty",value:function visitProperty(node,state,path){var visitor=this;// key is of types Expression
node.key=visitor.accept(node.key,state,path.concat(['key']));// value is of types Expression
node.value=visitor.accept(node.value,state,path.concat(['value']));return node;}},{key:"visitPattern",value:function visitPattern(node,state,path){return node;}},{key:"visitSuper",value:function visitSuper(node,state,path){return node;}},{key:"visitSpreadElement",value:function visitSpreadElement(node,state,path){var visitor=this;// argument is of types Expression
node.argument=visitor.accept(node.argument,state,path.concat(['argument']));return node;}},{key:"visitTemplateElement",value:function visitTemplateElement(node,state,path){return node;}},{key:"visitClass",value:function visitClass(node,state,path){var visitor=this;// id is of types Identifier
if(node.id){node.id=visitor.accept(node.id,state,path.concat(['id']));}// superClass is of types Expression
if(node.superClass){node.superClass=visitor.accept(node.superClass,state,path.concat(['superClass']));}// body is of types ClassBody
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitClassBody",value:function visitClassBody(node,state,path){var visitor=this;// body is a list with types MethodDefinition
var newElements=[];for(var _i50=0;_i50<node.body.length;_i50++){var ea=node.body[_i50];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['body',_i50])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.body=newElements;return node;}},{key:"visitMethodDefinition",value:function visitMethodDefinition(node,state,path){var visitor=this;// key is of types Expression
node.key=visitor.accept(node.key,state,path.concat(['key']));// value is of types FunctionExpression
node.value=visitor.accept(node.value,state,path.concat(['value']));return node;}},{key:"visitModuleDeclaration",value:function visitModuleDeclaration(node,state,path){return node;}},{key:"visitModuleSpecifier",value:function visitModuleSpecifier(node,state,path){var visitor=this;// local is of types Identifier
node.local=visitor.accept(node.local,state,path.concat(['local']));return node;}},{key:"visitJSXEmptyExpression",value:function visitJSXEmptyExpression(node,state,path){return node;}},{key:"visitJSXExpressionContainer",value:function visitJSXExpressionContainer(node,state,path){var visitor=this;// expression is of types Expression, JSXEmptyExpression
node.expression=visitor.accept(node.expression,state,path.concat(['expression']));return node;}},{key:"visitJSXSpreadChild",value:function visitJSXSpreadChild(node,state,path){var visitor=this;// expression is of types Expression
node.expression=visitor.accept(node.expression,state,path.concat(['expression']));return node;}},{key:"visitJSXBoundaryElement",value:function visitJSXBoundaryElement(node,state,path){var visitor=this;// name is of types JSXIdentifier, JSXMemberExpression, JSXNamespacedName
node.name=visitor.accept(node.name,state,path.concat(['name']));return node;}},{key:"visitJSXAttribute",value:function visitJSXAttribute(node,state,path){var visitor=this;// name is of types JSXIdentifier, JSXNamespacedName
node.name=visitor.accept(node.name,state,path.concat(['name']));// value is of types Literal, JSXExpressionContainer, JSXElement, JSXFragment
if(node.value){node.value=visitor.accept(node.value,state,path.concat(['value']));}return node;}},{key:"visitJSXText",value:function visitJSXText(node,state,path){return node;}},{key:"visitJSXOpeningFragment",value:function visitJSXOpeningFragment(node,state,path){return node;}},{key:"visitJSXClosingFragment",value:function visitJSXClosingFragment(node,state,path){return node;}},{key:"visitIdentifier",value:function visitIdentifier(node,state,path){return node;}},{key:"visitLiteral",value:function visitLiteral(node,state,path){return node;}},{key:"visitExpressionStatement",value:function visitExpressionStatement(node,state,path){var visitor=this;// expression is of types Expression
node.expression=visitor.accept(node.expression,state,path.concat(['expression']));return node;}},{key:"visitBlockStatement",value:function visitBlockStatement(node,state,path){var visitor=this;// body is a list with types Statement
var newElements=[];for(var _i51=0;_i51<node.body.length;_i51++){var ea=node.body[_i51];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['body',_i51])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.body=newElements;return node;}},{key:"visitEmptyStatement",value:function visitEmptyStatement(node,state,path){return node;}},{key:"visitDebuggerStatement",value:function visitDebuggerStatement(node,state,path){return node;}},{key:"visitWithStatement",value:function visitWithStatement(node,state,path){var visitor=this;// object is of types Expression
node.object=visitor.accept(node.object,state,path.concat(['object']));// body is of types Statement
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitReturnStatement",value:function visitReturnStatement(node,state,path){var visitor=this;// argument is of types Expression
if(node.argument){node.argument=visitor.accept(node.argument,state,path.concat(['argument']));}return node;}},{key:"visitLabeledStatement",value:function visitLabeledStatement(node,state,path){var visitor=this;// label is of types Identifier
node.label=visitor.accept(node.label,state,path.concat(['label']));// body is of types Statement
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitBreakStatement",value:function visitBreakStatement(node,state,path){var visitor=this;// label is of types Identifier
if(node.label){node.label=visitor.accept(node.label,state,path.concat(['label']));}return node;}},{key:"visitContinueStatement",value:function visitContinueStatement(node,state,path){var visitor=this;// label is of types Identifier
if(node.label){node.label=visitor.accept(node.label,state,path.concat(['label']));}return node;}},{key:"visitIfStatement",value:function visitIfStatement(node,state,path){var visitor=this;// test is of types Expression
node.test=visitor.accept(node.test,state,path.concat(['test']));// consequent is of types Statement
node.consequent=visitor.accept(node.consequent,state,path.concat(['consequent']));// alternate is of types Statement
if(node.alternate){node.alternate=visitor.accept(node.alternate,state,path.concat(['alternate']));}return node;}},{key:"visitSwitchStatement",value:function visitSwitchStatement(node,state,path){var visitor=this;// discriminant is of types Expression
node.discriminant=visitor.accept(node.discriminant,state,path.concat(['discriminant']));// cases is a list with types SwitchCase
var newElements=[];for(var _i52=0;_i52<node.cases.length;_i52++){var ea=node.cases[_i52];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['cases',_i52])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.cases=newElements;return node;}},{key:"visitThrowStatement",value:function visitThrowStatement(node,state,path){var visitor=this;// argument is of types Expression
node.argument=visitor.accept(node.argument,state,path.concat(['argument']));return node;}},{key:"visitTryStatement",value:function visitTryStatement(node,state,path){var visitor=this;// block is of types BlockStatement
node.block=visitor.accept(node.block,state,path.concat(['block']));// handler is of types CatchClause
if(node.handler){node.handler=visitor.accept(node.handler,state,path.concat(['handler']));}// finalizer is of types BlockStatement
if(node.finalizer){node.finalizer=visitor.accept(node.finalizer,state,path.concat(['finalizer']));}return node;}},{key:"visitWhileStatement",value:function visitWhileStatement(node,state,path){var visitor=this;// test is of types Expression
node.test=visitor.accept(node.test,state,path.concat(['test']));// body is of types Statement
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitDoWhileStatement",value:function visitDoWhileStatement(node,state,path){var visitor=this;// body is of types Statement
node.body=visitor.accept(node.body,state,path.concat(['body']));// test is of types Expression
node.test=visitor.accept(node.test,state,path.concat(['test']));return node;}},{key:"visitForStatement",value:function visitForStatement(node,state,path){var visitor=this;// init is of types VariableDeclaration, Expression
if(node.init){node.init=visitor.accept(node.init,state,path.concat(['init']));}// test is of types Expression
if(node.test){node.test=visitor.accept(node.test,state,path.concat(['test']));}// update is of types Expression
if(node.update){node.update=visitor.accept(node.update,state,path.concat(['update']));}// body is of types Statement
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitForInStatement",value:function visitForInStatement(node,state,path){var visitor=this;// left is of types VariableDeclaration, Pattern
node.left=visitor.accept(node.left,state,path.concat(['left']));// right is of types Expression
node.right=visitor.accept(node.right,state,path.concat(['right']));// body is of types Statement
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitDeclaration",value:function visitDeclaration(node,state,path){return node;}},{key:"visitThisExpression",value:function visitThisExpression(node,state,path){return node;}},{key:"visitArrayExpression",value:function visitArrayExpression(node,state,path){var visitor=this;// elements is a list with types Expression, SpreadElement
if(node.elements){var newElements=[];for(var _i53=0;_i53<node.elements.length;_i53++){var ea=node.elements[_i53];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['elements',_i53])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.elements=newElements;}return node;}},{key:"visitObjectExpression",value:function visitObjectExpression(node,state,path){var visitor=this;// properties is a list with types Property, SpreadElement
var newElements=[];for(var _i54=0;_i54<node.properties.length;_i54++){var ea=node.properties[_i54];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['properties',_i54])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.properties=newElements;return node;}},{key:"visitFunctionExpression",value:function visitFunctionExpression(node,state,path){var visitor=this;// id is of types Identifier
if(node.id){node.id=visitor.accept(node.id,state,path.concat(['id']));}// params is a list with types Pattern
var newElements=[];for(var _i55=0;_i55<node.params.length;_i55++){var ea=node.params[_i55];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['params',_i55])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.params=newElements;// body is of types FunctionBody
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitUnaryExpression",value:function visitUnaryExpression(node,state,path){var visitor=this;// argument is of types Expression
node.argument=visitor.accept(node.argument,state,path.concat(['argument']));return node;}},{key:"visitUpdateExpression",value:function visitUpdateExpression(node,state,path){var visitor=this;// argument is of types Expression
node.argument=visitor.accept(node.argument,state,path.concat(['argument']));return node;}},{key:"visitBinaryExpression",value:function visitBinaryExpression(node,state,path){var visitor=this;// left is of types Expression
node.left=visitor.accept(node.left,state,path.concat(['left']));// right is of types Expression
node.right=visitor.accept(node.right,state,path.concat(['right']));return node;}},{key:"visitAssignmentExpression",value:function visitAssignmentExpression(node,state,path){var visitor=this;// left is of types Pattern
node.left=visitor.accept(node.left,state,path.concat(['left']));// right is of types Expression
node.right=visitor.accept(node.right,state,path.concat(['right']));return node;}},{key:"visitLogicalExpression",value:function visitLogicalExpression(node,state,path){var visitor=this;// left is of types Expression
node.left=visitor.accept(node.left,state,path.concat(['left']));// right is of types Expression
node.right=visitor.accept(node.right,state,path.concat(['right']));return node;}},{key:"visitMemberExpression",value:function visitMemberExpression(node,state,path){var visitor=this;// object is of types Expression, Super
node.object=visitor.accept(node.object,state,path.concat(['object']));// property is of types Expression
node.property=visitor.accept(node.property,state,path.concat(['property']));return node;}},{key:"visitConditionalExpression",value:function visitConditionalExpression(node,state,path){var visitor=this;// test is of types Expression
node.test=visitor.accept(node.test,state,path.concat(['test']));// alternate is of types Expression
node.alternate=visitor.accept(node.alternate,state,path.concat(['alternate']));// consequent is of types Expression
node.consequent=visitor.accept(node.consequent,state,path.concat(['consequent']));return node;}},{key:"visitCallExpression",value:function visitCallExpression(node,state,path){var visitor=this;// callee is of types Expression, Super
node.callee=visitor.accept(node.callee,state,path.concat(['callee']));// arguments is a list with types Expression, SpreadElement
var newElements=[];for(var _i56=0;_i56<node.arguments.length;_i56++){var ea=node.arguments[_i56];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['arguments',_i56])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.arguments=newElements;return node;}},{key:"visitNewExpression",value:function visitNewExpression(node,state,path){var visitor=this;// callee is of types Expression
node.callee=visitor.accept(node.callee,state,path.concat(['callee']));// arguments is a list with types Expression, SpreadElement
var newElements=[];for(var _i57=0;_i57<node.arguments.length;_i57++){var ea=node.arguments[_i57];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['arguments',_i57])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.arguments=newElements;return node;}},{key:"visitSequenceExpression",value:function visitSequenceExpression(node,state,path){var visitor=this;// expressions is a list with types Expression
var newElements=[];for(var _i58=0;_i58<node.expressions.length;_i58++){var ea=node.expressions[_i58];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['expressions',_i58])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.expressions=newElements;return node;}},{key:"visitArrowFunctionExpression",value:function visitArrowFunctionExpression(node,state,path){var visitor=this;// body is of types FunctionBody, Expression
node.body=visitor.accept(node.body,state,path.concat(['body']));// id is of types Identifier
if(node.id){node.id=visitor.accept(node.id,state,path.concat(['id']));}// params is a list with types Pattern
var newElements=[];for(var _i59=0;_i59<node.params.length;_i59++){var ea=node.params[_i59];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['params',_i59])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.params=newElements;return node;}},{key:"visitYieldExpression",value:function visitYieldExpression(node,state,path){var visitor=this;// argument is of types Expression
if(node.argument){node.argument=visitor.accept(node.argument,state,path.concat(['argument']));}return node;}},{key:"visitTemplateLiteral",value:function visitTemplateLiteral(node,state,path){var visitor=this;// quasis is a list with types TemplateElement
var newElements=[];for(var i=0;i<node.quasis.length;i++){var ea=node.quasis[i];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['quasis',i])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.quasis=newElements;// expressions is a list with types Expression
var newElements=[];for(var i=0;i<node.expressions.length;i++){var ea=node.expressions[i];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['expressions',i])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.expressions=newElements;return node;}},{key:"visitTaggedTemplateExpression",value:function visitTaggedTemplateExpression(node,state,path){var visitor=this;// tag is of types Expression
node.tag=visitor.accept(node.tag,state,path.concat(['tag']));// quasi is of types TemplateLiteral
node.quasi=visitor.accept(node.quasi,state,path.concat(['quasi']));return node;}},{key:"visitAssignmentProperty",value:function visitAssignmentProperty(node,state,path){var visitor=this;// value is of types Pattern, Expression
node.value=visitor.accept(node.value,state,path.concat(['value']));// key is of types Expression
node.key=visitor.accept(node.key,state,path.concat(['key']));return node;}},{key:"visitObjectPattern",value:function visitObjectPattern(node,state,path){var visitor=this;// properties is a list with types AssignmentProperty, RestElement
var newElements=[];for(var _i60=0;_i60<node.properties.length;_i60++){var ea=node.properties[_i60];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['properties',_i60])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.properties=newElements;return node;}},{key:"visitArrayPattern",value:function visitArrayPattern(node,state,path){var visitor=this;// elements is a list with types Pattern
if(node.elements){var newElements=[];for(var _i61=0;_i61<node.elements.length;_i61++){var ea=node.elements[_i61];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['elements',_i61])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.elements=newElements;}return node;}},{key:"visitRestElement",value:function visitRestElement(node,state,path){var visitor=this;// argument is of types Pattern
node.argument=visitor.accept(node.argument,state,path.concat(['argument']));return node;}},{key:"visitAssignmentPattern",value:function visitAssignmentPattern(node,state,path){var visitor=this;// left is of types Pattern
node.left=visitor.accept(node.left,state,path.concat(['left']));// right is of types Expression
node.right=visitor.accept(node.right,state,path.concat(['right']));return node;}},{key:"visitClassExpression",value:function visitClassExpression(node,state,path){var visitor=this;// id is of types Identifier
if(node.id){node.id=visitor.accept(node.id,state,path.concat(['id']));}// superClass is of types Expression
if(node.superClass){node.superClass=visitor.accept(node.superClass,state,path.concat(['superClass']));}// body is of types ClassBody
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitMetaProperty",value:function visitMetaProperty(node,state,path){var visitor=this;// meta is of types Identifier
node.meta=visitor.accept(node.meta,state,path.concat(['meta']));// property is of types Identifier
node.property=visitor.accept(node.property,state,path.concat(['property']));return node;}},{key:"visitImportDeclaration",value:function visitImportDeclaration(node,state,path){var visitor=this;// specifiers is a list with types ImportSpecifier, ImportDefaultSpecifier, ImportNamespaceSpecifier
var newElements=[];for(var _i62=0;_i62<node.specifiers.length;_i62++){var ea=node.specifiers[_i62];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['specifiers',_i62])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.specifiers=newElements;// source is of types Literal
node.source=visitor.accept(node.source,state,path.concat(['source']));return node;}},{key:"visitImportSpecifier",value:function visitImportSpecifier(node,state,path){var visitor=this;// imported is of types Identifier
node.imported=visitor.accept(node.imported,state,path.concat(['imported']));// local is of types Identifier
node.local=visitor.accept(node.local,state,path.concat(['local']));return node;}},{key:"visitImportDefaultSpecifier",value:function visitImportDefaultSpecifier(node,state,path){var visitor=this;// local is of types Identifier
node.local=visitor.accept(node.local,state,path.concat(['local']));return node;}},{key:"visitImportNamespaceSpecifier",value:function visitImportNamespaceSpecifier(node,state,path){var visitor=this;// local is of types Identifier
node.local=visitor.accept(node.local,state,path.concat(['local']));return node;}},{key:"visitExportNamedDeclaration",value:function visitExportNamedDeclaration(node,state,path){var visitor=this;// declaration is of types Declaration
if(node.declaration){node.declaration=visitor.accept(node.declaration,state,path.concat(['declaration']));}// specifiers is a list with types ExportSpecifier
var newElements=[];for(var _i63=0;_i63<node.specifiers.length;_i63++){var ea=node.specifiers[_i63];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['specifiers',_i63])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.specifiers=newElements;// source is of types Literal
if(node.source){node.source=visitor.accept(node.source,state,path.concat(['source']));}return node;}},{key:"visitExportSpecifier",value:function visitExportSpecifier(node,state,path){var visitor=this;// exported is of types Identifier
node.exported=visitor.accept(node.exported,state,path.concat(['exported']));// local is of types Identifier
node.local=visitor.accept(node.local,state,path.concat(['local']));return node;}},{key:"visitAnonymousDefaultExportedFunctionDeclaration",value:function visitAnonymousDefaultExportedFunctionDeclaration(node,state,path){var visitor=this;// id is of types Identifier
if(node.id){node.id=visitor.accept(node.id,state,path.concat(['id']));}// params is a list with types Pattern
var newElements=[];for(var _i64=0;_i64<node.params.length;_i64++){var ea=node.params[_i64];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['params',_i64])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.params=newElements;// body is of types FunctionBody
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitAnonymousDefaultExportedClassDeclaration",value:function visitAnonymousDefaultExportedClassDeclaration(node,state,path){var visitor=this;// id is of types Identifier
if(node.id){node.id=visitor.accept(node.id,state,path.concat(['id']));}// superClass is of types Expression
if(node.superClass){node.superClass=visitor.accept(node.superClass,state,path.concat(['superClass']));}// body is of types ClassBody
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitExportDefaultDeclaration",value:function visitExportDefaultDeclaration(node,state,path){var visitor=this;// declaration is of types AnonymousDefaultExportedFunctionDeclaration, FunctionDeclaration, AnonymousDefaultExportedClassDeclaration, ClassDeclaration, Expression
node.declaration=visitor.accept(node.declaration,state,path.concat(['declaration']));return node;}},{key:"visitExportAllDeclaration",value:function visitExportAllDeclaration(node,state,path){var visitor=this;// source is of types Literal
node.source=visitor.accept(node.source,state,path.concat(['source']));return node;}},{key:"visitAwaitExpression",value:function visitAwaitExpression(node,state,path){var visitor=this;// argument is of types Expression
node.argument=visitor.accept(node.argument,state,path.concat(['argument']));return node;}},{key:"visitJSXMemberExpression",value:function visitJSXMemberExpression(node,state,path){var visitor=this;// object is of types JSXMemberExpression, JSXIdentifier
node.object=visitor.accept(node.object,state,path.concat(['object']));// property is of types JSXIdentifier
node.property=visitor.accept(node.property,state,path.concat(['property']));return node;}},{key:"visitJSXNamespacedName",value:function visitJSXNamespacedName(node,state,path){var visitor=this;// namespace is of types JSXIdentifier
node.namespace=visitor.accept(node.namespace,state,path.concat(['namespace']));// name is of types JSXIdentifier
node.name=visitor.accept(node.name,state,path.concat(['name']));return node;}},{key:"visitJSXOpeningElement",value:function visitJSXOpeningElement(node,state,path){var visitor=this;// attributes is a list with types JSXAttribute, JSXSpreadAttribute
var newElements=[];for(var _i65=0;_i65<node.attributes.length;_i65++){var ea=node.attributes[_i65];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['attributes',_i65])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.attributes=newElements;// name is of types JSXIdentifier, JSXMemberExpression, JSXNamespacedName
node.name=visitor.accept(node.name,state,path.concat(['name']));return node;}},{key:"visitJSXClosingElement",value:function visitJSXClosingElement(node,state,path){var visitor=this;// name is of types JSXIdentifier, JSXMemberExpression, JSXNamespacedName
node.name=visitor.accept(node.name,state,path.concat(['name']));return node;}},{key:"visitJSXSpreadAttribute",value:function visitJSXSpreadAttribute(node,state,path){var visitor=this;// argument is of types Expression
node.argument=visitor.accept(node.argument,state,path.concat(['argument']));return node;}},{key:"visitJSXElement",value:function visitJSXElement(node,state,path){var visitor=this;// openingElement is of types JSXOpeningElement
node.openingElement=visitor.accept(node.openingElement,state,path.concat(['openingElement']));// children is a list with types JSXText, JSXExpressionContainer, JSXSpreadChild, JSXElement, JSXFragment
var newElements=[];for(var _i66=0;_i66<node.children.length;_i66++){var ea=node.children[_i66];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['children',_i66])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.children=newElements;// closingElement is of types JSXClosingElement
if(node.closingElement){node.closingElement=visitor.accept(node.closingElement,state,path.concat(['closingElement']));}return node;}},{key:"visitJSXFragment",value:function visitJSXFragment(node,state,path){var visitor=this;// openingFragment is of types JSXOpeningFragment
node.openingFragment=visitor.accept(node.openingFragment,state,path.concat(['openingFragment']));// children is a list with types JSXText, JSXExpressionContainer, JSXSpreadChild, JSXElement, JSXFragment
var newElements=[];for(var _i67=0;_i67<node.children.length;_i67++){var ea=node.children[_i67];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['children',_i67])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.children=newElements;// closingFragment is of types JSXClosingFragment
node.closingFragment=visitor.accept(node.closingFragment,state,path.concat(['closingFragment']));return node;}},{key:"visitImportExpression",value:function visitImportExpression(node,state,path){var visitor=this;// source is of types Expression
node.source=visitor.accept(node.source,state,path.concat(['source']));return node;}},{key:"visitRegExpLiteral",value:function visitRegExpLiteral(node,state,path){return node;}},{key:"visitFunctionBody",value:function visitFunctionBody(node,state,path){var visitor=this;// body is a list with types Directive, Statement
var newElements=[];for(var _i68=0;_i68<node.body.length;_i68++){var ea=node.body[_i68];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['body',_i68])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.body=newElements;return node;}},{key:"visitFunctionDeclaration",value:function visitFunctionDeclaration(node,state,path){var visitor=this;// id is of types Identifier
if(node.id){node.id=visitor.accept(node.id,state,path.concat(['id']));}// params is a list with types Pattern
var newElements=[];for(var _i69=0;_i69<node.params.length;_i69++){var ea=node.params[_i69];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['params',_i69])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.params=newElements;// body is of types FunctionBody
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitVariableDeclaration",value:function visitVariableDeclaration(node,state,path){var visitor=this;// declarations is a list with types VariableDeclarator
var newElements=[];for(var _i70=0;_i70<node.declarations.length;_i70++){var ea=node.declarations[_i70];var acceptedNodes=ea?visitor.accept(ea,state,path.concat(['declarations',_i70])):ea;if(Array.isArray(acceptedNodes))newElements.push.apply(newElements,acceptedNodes);else newElements.push(acceptedNodes);}node.declarations=newElements;return node;}},{key:"visitForOfStatement",value:function visitForOfStatement(node,state,path){var visitor=this;// left is of types VariableDeclaration, Pattern
node.left=visitor.accept(node.left,state,path.concat(['left']));// right is of types Expression
node.right=visitor.accept(node.right,state,path.concat(['right']));// body is of types Statement
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitClassDeclaration",value:function visitClassDeclaration(node,state,path){var visitor=this;// id is of types Identifier
node.id=visitor.accept(node.id,state,path.concat(['id']));// superClass is of types Expression
if(node.superClass){node.superClass=visitor.accept(node.superClass,state,path.concat(['superClass']));}// body is of types ClassBody
node.body=visitor.accept(node.body,state,path.concat(['body']));return node;}},{key:"visitJSXIdentifier",value:function visitJSXIdentifier(node,state,path){return node;}},{key:"visitBigIntLiteral",value:function visitBigIntLiteral(node,state,path){return node;}}]);return Visitor;}();// >>>>>>>>>>>>> END OF AUTO GENERATED CODE >>>>>>>>>>>>>
/* global process, global, exports */var PrinterVisitor=/*#__PURE__*/function(_Visitor){_inherits(PrinterVisitor,_Visitor);var _super=_createSuper(PrinterVisitor);function PrinterVisitor(){_classCallCheck(this,PrinterVisitor);return _super.apply(this,arguments);}_createClass(PrinterVisitor,[{key:"accept",value:function accept(node,state,path){var pathString=path.map(function(ea){return typeof ea==='string'?".".concat(ea):"[".concat(ea,"]");}).join('');var myChildren=[];var result=_get2(_getPrototypeOf(PrinterVisitor.prototype),"accept",this).call(this,node,{index:state.index,tree:myChildren},path);state.tree.push({node:node,path:pathString,index:state.index++,children:myChildren});return result;}}]);return PrinterVisitor;}(Visitor);var ComparisonVisitor=/*#__PURE__*/function(_Visitor2){_inherits(ComparisonVisitor,_Visitor2);var _super2=_createSuper(ComparisonVisitor);function ComparisonVisitor(){_classCallCheck(this,ComparisonVisitor);return _super2.apply(this,arguments);}_createClass(ComparisonVisitor,[{key:"recordNotEqual",value:function recordNotEqual(node1,node2,state,msg){state.comparisons.errors.push({node1:node1,node2:node2,path:state.completePath,msg:msg});}},{key:"compareType",value:function compareType(node1,node2,state){return this.compareField('type',node1,node2,state);}},{key:"compareField",value:function compareField(field,node1,node2,state){node2=Path(state.completePath.join('.')).get(node2);if(node1&&node2&&node1[field]===node2[field])return true;if(node1&&node1[field]==='*'||node2&&node2[field]==='*')return true;var fullPath=state.completePath.join('.')+'.'+field;var msg;if(!node1)msg='node1 on '+fullPath+' not defined';else if(!node2)msg='node2 not defined but node1 ('+fullPath+') is: '+node1[field];else msg=fullPath+' is not equal: '+node1[field]+' vs. '+node2[field];this.recordNotEqual(node1,node2,state,msg);return false;}},{key:"accept",value:function accept(node1,node2,state,path){var patternNode=Path(path.join('.')).get(node2);if(node1==='*'||patternNode==='*')return;var nextState={completePath:path,comparisons:state.comparisons};if(this.compareType(node1,node2,nextState)){this['visit'+node1.type](node1,node2,nextState,path);}}},{key:"visitFunction",value:function visitFunction(node1,node2,state,path){// node1.generator has a specific type that is boolean
if(node1.generator){this.compareField('generator',node1,node2,state);}// node1.expression has a specific type that is boolean
if(node1.expression){this.compareField('expression',node1,node2,state);}return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitFunction",this).call(this,node1,node2,state,path);}},{key:"visitSwitchStatement",value:function visitSwitchStatement(node1,node2,state,path){// node1.lexical has a specific type that is boolean
if(node1.lexical){this.compareField('lexical',node1,node2,state);}return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitSwitchStatement",this).call(this,node1,node2,state,path);}},{key:"visitForInStatement",value:function visitForInStatement(node1,node2,state,path){// node1.each has a specific type that is boolean
if(node1.each){this.compareField('each',node1,node2,state);}return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitForInStatement",this).call(this,node1,node2,state,path);}},{key:"visitFunctionDeclaration",value:function visitFunctionDeclaration(node1,node2,state,path){// node1.generator has a specific type that is boolean
if(node1.generator){this.compareField('generator',node1,node2,state);}// node1.expression has a specific type that is boolean
if(node1.expression){this.compareField('expression',node1,node2,state);}return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitFunctionDeclaration",this).call(this,node1,node2,state,path);}},{key:"visitVariableDeclaration",value:function visitVariableDeclaration(node1,node2,state,path){// node1.kind is "var" or "let" or "const"
this.compareField('kind',node1,node2,state);return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitVariableDeclaration",this).call(this,node1,node2,state,path);}},{key:"visitUnaryExpression",value:function visitUnaryExpression(node1,node2,state,path){// node1.operator is an UnaryOperator enum:
// "-" | "+" | "!" | "~" | "typeof" | "void" | "delete"
this.compareField('operator',node1,node2,state);// node1.prefix has a specific type that is boolean
if(node1.prefix){this.compareField('prefix',node1,node2,state);}return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitUnaryExpression",this).call(this,node1,node2,state,path);}},{key:"visitBinaryExpression",value:function visitBinaryExpression(node1,node2,state,path){// node1.operator is an BinaryOperator enum:
// "==" | "!=" | "===" | "!==" | | "<" | "<=" | ">" | ">=" | | "<<" | ">>" | ">>>" | | "+" | "-" | "*" | "/" | "%" | | "|" | "^" | "&" | "in" | | "instanceof" | ".."
this.compareField('operator',node1,node2,state);return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitBinaryExpression",this).call(this,node1,node2,state,path);}},{key:"visitAssignmentExpression",value:function visitAssignmentExpression(node1,node2,state,path){// node1.operator is an AssignmentOperator enum:
// "=" | "+=" | "-=" | "*=" | "/=" | "%=" | | "<<=" | ">>=" | ">>>=" | | "|=" | "^=" | "&="
this.compareField('operator',node1,node2,state);return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitAssignmentExpression",this).call(this,node1,node2,state,path);}},{key:"visitUpdateExpression",value:function visitUpdateExpression(node1,node2,state,path){// node1.operator is an UpdateOperator enum:
// "++" | "--"
this.compareField('operator',node1,node2,state);// node1.prefix has a specific type that is boolean
if(node1.prefix){this.compareField('prefix',node1,node2,state);}return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitUpdateExpression",this).call(this,node1,node2,state,path);}},{key:"visitLogicalExpression",value:function visitLogicalExpression(node1,node2,state,path){// node1.operator is an LogicalOperator enum:
// "||" | "&&"
this.compareField('operator',node1,node2,state);return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitLogicalExpression",this).call(this,node1,node2,state,path);}},{key:"visitMemberExpression",value:function visitMemberExpression(node1,node2,state,path){// node1.computed has a specific type that is boolean
if(node1.computed){this.compareField('computed',node1,node2,state);}return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitMemberExpression",this).call(this,node1,node2,state,path);}},{key:"visitComprehensionBlock",value:function visitComprehensionBlock(node1,node2,state,path){// node1.each has a specific type that is boolean
if(node1.each){this.compareField('each',node1,node2,state);}return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitComprehensionBlock",this).call(this,node1,node2,state,path);}},{key:"visitIdentifier",value:function visitIdentifier(node1,node2,state,path){// node1.name has a specific type that is string
this.compareField('name',node1,node2,state);return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitIdentifier",this).call(this,node1,node2,state,path);}},{key:"visitLiteral",value:function visitLiteral(node1,node2,state,path){this.compareField('value',node1,node2,state);return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitLiteral",this).call(this,node1,node2,state,path);}},{key:"visitClassDeclaration",value:function visitClassDeclaration(node1,node2,state,path){this.compareField('id',node1,node2,state);if(node1.superClass){this.compareField('superClass',node1,node2,state);}this.compareField('body',node1,node2,state);return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitClassDeclaration",this).call(this,node1,node2,state,path);}},{key:"visitClassBody",value:function visitClassBody(node1,node2,state,path){this.compareField('body',node1,node2,state);return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitClassBody",this).call(this,node1,node2,state,path);}},{key:"visitMethodDefinition",value:function visitMethodDefinition(node1,node2,state,path){this.compareField('static',node1,node2,state);this.compareField('computed',node1,node2,state);this.compareField('kind',node1,node2,state);this.compareField('key',node1,node2,state);this.compareField('value',node1,node2,state);return _get2(_getPrototypeOf(ComparisonVisitor.prototype),"visitMethodDefinition",this).call(this,node1,node2,state,path);}}]);return ComparisonVisitor;}(Visitor);var ScopeVisitor=/*#__PURE__*/function(_Visitor3){_inherits(ScopeVisitor,_Visitor3);var _super3=_createSuper(ScopeVisitor);function ScopeVisitor(){_classCallCheck(this,ScopeVisitor);return _super3.apply(this,arguments);}_createClass(ScopeVisitor,[{key:"newScope",value:function newScope(scopeNode,parentScope){var scope={node:scopeNode,varDecls:[],varDeclPaths:[],funcDecls:[],funcDeclPaths:[],classDecls:[],classDeclPaths:[],classExprs:[],classExprPaths:[],methodDecls:[],methodDeclPaths:[],importSpecifiers:[],importSpecifierPaths:[],exportDecls:[],exportDeclPaths:[],refs:[],thisRefs:[],params:[],catches:[],subScopes:[],resolvedRefMap:new Map()};if(parentScope)parentScope.subScopes.push(scope);return scope;}},{key:"visitVariableDeclaration",value:function visitVariableDeclaration(node,scope,path){scope.varDecls.push(node);scope.varDeclPaths.push(path);return _get2(_getPrototypeOf(ScopeVisitor.prototype),"visitVariableDeclaration",this).call(this,node,scope,path);}},{key:"visitVariableDeclarator",value:function visitVariableDeclarator(node,scope,path){var visitor=this;// ignore id
// // id is of types Pattern
// node["id"] = visitor.accept(node["id"], scope, path.concat(["id"]));
// init is of types Expression
if(node.init){node.init=visitor.accept(node.init,scope,path.concat(['init']));}return node;}},{key:"visitFunction",value:function visitFunction(node,scope,path){var visitor=this;var newScope=this.newScope(node,scope);// AssignmentPattern = default params
// only visit the right side of a default param, we track the declarations
// in newScope.params specificially
node.params.forEach(function(param,i){if(param.type==='AssignmentPattern'){visitor.accept(param.right,newScope,path.concat('params',i,'right'));}});newScope.params=Array.prototype.slice.call(node.params);return newScope;}},{key:"visitFunctionDeclaration",value:function visitFunctionDeclaration(node,scope,path){var newScope=this.visitFunction(node,scope,path);scope.funcDecls.push(node);scope.funcDeclPaths.push(path);// don't visit id and params
var visitor=this;if(node.defaults){node.defaults=node.defaults.reduce(function(results,ea,i){var result=visitor.accept(ea,newScope,path.concat(['defaults',i]));if(Array.isArray(result))results.push.apply(results,result);else results.push(result);return results;},[]);}if(node.rest){node.rest=visitor.accept(node.rest,newScope,path.concat(['rest']));}node.body=visitor.accept(node.body,newScope,path.concat(['body']));// loc is of types SourceLocation
if(node.loc){node.loc=visitor.accept(node.loc,newScope,path.concat(['loc']));}return node;}},{key:"visitFunctionExpression",value:function visitFunctionExpression(node,scope,path){var newScope=this.visitFunction(node,scope,path);// don't visit id and params
var visitor=this;if(node.defaults){node.defaults=node.defaults.reduce(function(results,ea,i){var result=visitor.accept(ea,newScope,path.concat(['defaults',i]));if(Array.isArray(result))results.push.apply(results,result);else results.push(result);return results;},[]);}if(node.rest){node.rest=visitor.accept(node.rest,newScope,path.concat(['rest']));}node.body=visitor.accept(node.body,newScope,path.concat(['body']));// loc is of types SourceLocation
if(node.loc){node.loc=visitor.accept(node.loc,newScope,path.concat(['loc']));}return node;}},{key:"visitArrowFunctionExpression",value:function visitArrowFunctionExpression(node,scope,path){var newScope=this.visitFunction(node,scope,path);var visitor=this;if(node.defaults){node.defaults=node.defaults.reduce(function(results,ea,i){var result=visitor.accept(ea,newScope,path.concat(['defaults',i]));if(Array.isArray(result))results.push.apply(results,result);else results.push(result);return results;},[]);}if(node.rest){node.rest=visitor.accept(node.rest,newScope,path.concat(['rest']));}// body is of types BlockStatement, Expression
node.body=visitor.accept(node.body,newScope,path.concat(['body']));// loc is of types SourceLocation
if(node.loc){node.loc=visitor.accept(node.loc,newScope,path.concat(['loc']));}// node.generator has a specific type that is boolean
if(node.generator);// node.expression has a specific type that is boolean
if(node.expression);return node;}},{key:"visitIdentifier",value:function visitIdentifier(node,scope,path){scope.refs.push(node);return _get2(_getPrototypeOf(ScopeVisitor.prototype),"visitIdentifier",this).call(this,node,scope,path);}},{key:"visitMemberExpression",value:function visitMemberExpression(node,scope,path){// only visit property part when prop is computed so we don't gather
// prop ids
var visitor=this;// object is of types Expression, Super
node.object=visitor.accept(node.object,scope,path.concat(['object']));// property is of types Expression
if(node.computed){node.property=visitor.accept(node.property,scope,path.concat(['property']));}return node;}},{key:"visitProperty",value:function visitProperty(node,scope,path){var visitor=this;// key is of types Expression
if(node.computed){node.key=visitor.accept(node.key,scope,path.concat(['key']));}// value is of types Expression
node.value=visitor.accept(node.value,scope,path.concat(['value']));return node;}},{key:"visitThisExpression",value:function visitThisExpression(node,scope,path){scope.thisRefs.push(node);return _get2(_getPrototypeOf(ScopeVisitor.prototype),"visitThisExpression",this).call(this,node,scope,path);}},{key:"visitTryStatement",value:function visitTryStatement(node,scope,path){var visitor=this;// block is of types BlockStatement
node.block=visitor.accept(node.block,scope,path.concat(['block']));// handler is of types CatchClause
if(node.handler){node.handler=visitor.accept(node.handler,scope,path.concat(['handler']));scope.catches.push(node.handler.param);}// finalizer is of types BlockStatement
if(node.finalizer){node.finalizer=visitor.accept(node.finalizer,scope,path.concat(['finalizer']));}return node;}},{key:"visitLabeledStatement",value:function visitLabeledStatement(node,scope,path){var visitor=this;// ignore label
// // label is of types Identifier
// node["label"] = visitor.accept(node["label"], scope, path.concat(["label"]));
// body is of types Statement
node.body=visitor.accept(node.body,scope,path.concat(['body']));return node;}},{key:"visitClassDeclaration",value:function visitClassDeclaration(node,scope,path){scope.classDecls.push(node);scope.classDeclPaths.push(path);var visitor=this;// ignore id
// // id is of types Identifier
// node["id"] = visitor.accept(node["id"], scope, path.concat(["id"]));
// superClass is of types Expression
if(node.superClass){node.superClass=visitor.accept(node.superClass,scope,path.concat(['superClass']));}// body is of types ClassBody
node.body=visitor.accept(node.body,scope,path.concat(['body']));return node;}},{key:"visitClassExpression",value:function visitClassExpression(node,scope,path){if(node.id){scope.classExprs.push(node);scope.classExprPaths.push(path);}var visitor=this;// ignore id
// // id is of types Identifier
// node["id"] = visitor.accept(node["id"], scope, path.concat(["id"]));
// superClass is of types Expression
if(node.superClass){node.superClass=visitor.accept(node.superClass,scope,path.concat(['superClass']));}// body is of types ClassBody
node.body=visitor.accept(node.body,scope,path.concat(['body']));return node;}},{key:"visitMethodDefinition",value:function visitMethodDefinition(node,scope,path){var visitor=this;// don't visit key Identifier for now
// // key is of types Expression
// node["key"] = visitor.accept(node["key"], scope, path.concat(["key"]));
// value is of types FunctionExpression
node.value=visitor.accept(node.value,scope,path.concat(['value']));return node;}},{key:"visitMetaProperty",value:function visitMetaProperty(node,scope,path){// node['meta'] = visitor.accept(node['meta'], scope, path.concat(['meta']));
// node['property'] = visitor.accept(node['property'],scope, path.concat(['property']));
return node;}},{key:"visitBreakStatement",value:function visitBreakStatement(node,scope,path){return node;}},{key:"visitContinueStatement",value:function visitContinueStatement(node,scope,path){return node;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// es6 modules
},{key:"visitImportSpecifier",value:function visitImportSpecifier(node,scope,path){scope.importSpecifiers.push(node.local);scope.importSpecifierPaths.push(path);// imported is of types Identifier
// node["imported"] = visitor.accept(node["imported"], scope, path.concat(["imported"]));
// local is of types Identifier
// node["local"] = visitor.accept(node["local"], scope, path.concat(["local"]));
return node;}},{key:"visitImportDefaultSpecifier",value:function visitImportDefaultSpecifier(node,scope,path){scope.importSpecifiers.push(node.local);scope.importSpecifierPaths.push(path);// // local is of types Identifier
// node["local"] = visitor.accept(node["local"], scope, path.concat(["local"]));
return node;}},{key:"visitImportNamespaceSpecifier",value:function visitImportNamespaceSpecifier(node,scope,path){scope.importSpecifiers.push(node.local);scope.importSpecifierPaths.push(path);// // local is of types Identifier
// node["local"] = visitor.accept(node["local"], scope, path.concat(["local"]));
return node;}},{key:"visitExportSpecifier",value:function visitExportSpecifier(node,scope,path){var visitor=this;// // exported is of types Identifier
// node["exported"] = visitor.accept(node["exported"], scope, path.concat(["exported"]));
// local is of types Identifier
node.local=visitor.accept(node.local,scope,path.concat(['local']));return node;}},{key:"visitExportNamedDeclaration",value:function visitExportNamedDeclaration(node,scope,path){scope.exportDecls.push(node);scope.exportDeclPaths.push(path);// only descend if it's not an export {...} from "..."
if(!node.source)_get2(_getPrototypeOf(ScopeVisitor.prototype),"visitExportNamedDeclaration",this).call(this,node,scope,path);return node;}},{key:"visitExportDefaultDeclaration",value:function visitExportDefaultDeclaration(node,scope,path){scope.exportDecls.push(node);scope.exportDeclPaths.push(path);return _get2(_getPrototypeOf(ScopeVisitor.prototype),"visitExportDefaultDeclaration",this).call(this,node,scope,path);}},{key:"visitExportAllDeclaration",value:function visitExportAllDeclaration(node,scope,path){scope.exportDecls.push(node);scope.exportDeclPaths.push(path);return _get2(_getPrototypeOf(ScopeVisitor.prototype),"visitExportAllDeclaration",this).call(this,node,scope,path);}}]);return ScopeVisitor;}(Visitor);var _global=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$2={};/*
  Copyright (C) 2012-2013 Yusuke Suzuki <utatane.tea@gmail.com>
  Copyright (C) 2012 Ariya Hidayat <ariya.hidayat@gmail.com>

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/ /*jslint vars:false, bitwise:true*/ /*jshint indent:4*/ /*global exports:true*/(function clone(exports){var Syntax,VisitorOption,VisitorKeys,BREAK,SKIP,REMOVE;function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(_typeof2(val)==="object"&&val!==null){ret[key]=deepCopy(val);}else{ret[key]=val;}}}return ret;}// based on LLVM libc++ upper_bound / lower_bound
// MIT License
function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff;}else{i=current+1;len-=diff+1;}}return i;}Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",// CAUTION: It's deferred to ES7.
BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ChainExpression:"ChainExpression",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",// CAUTION: It's deferred to ES7.
ComprehensionExpression:"ComprehensionExpression",// CAUTION: It's deferred to ES7.
ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",// CAUTION: It's deferred to ES7.
Identifier:"Identifier",IfStatement:"IfStatement",ImportExpression:"ImportExpression",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};VisitorKeys={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],// CAUTION: It's deferred to ES7.
BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ChainExpression:["expression"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],// CAUTION: It's deferred to ES7.
ComprehensionExpression:["blocks","filter","body"],// CAUTION: It's deferred to ES7.
ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],// CAUTION: It's deferred to ES7.
Identifier:[],IfStatement:["test","consequent","alternate"],ImportExpression:["source"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};// unique id
BREAK={};SKIP={};REMOVE={};VisitorOption={Break:BREAK,Skip:SKIP,Remove:REMOVE};function Reference(parent,key){(this||_global).parent=parent;(this||_global).key=key;}Reference.prototype.replace=function replace(node){(this||_global).parent[(this||_global).key]=node;};Reference.prototype.remove=function remove(){if(Array.isArray((this||_global).parent)){(this||_global).parent.splice((this||_global).key,1);return true;}else{this.replace(null);return false;}};function Element(node,path,wrap,ref){(this||_global).node=node;(this||_global).path=path;(this||_global).wrap=wrap;(this||_global).ref=ref;}function Controller(){}// API:
// return property path array from root to current node
Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(Array.isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j]);}}else{result.push(path);}}// root node
if(!(this||_global).__current.path){return null;}// first node is sentinel, second node is root element
result=[];for(i=2,iz=(this||_global).__leavelist.length;i<iz;++i){element=(this||_global).__leavelist[i];addToPath(result,element.path);}addToPath(result,(this||_global).__current.path);return result;};// API:
// return type of current node
Controller.prototype.type=function(){var node=this.current();return node.type||(this||_global).__current.wrap;};// API:
// return array of parent elements
Controller.prototype.parents=function parents(){var i,iz,result;// first node is sentinel
result=[];for(i=1,iz=(this||_global).__leavelist.length;i<iz;++i){result.push((this||_global).__leavelist[i].node);}return result;};// API:
// return current node
Controller.prototype.current=function current(){return(this||_global).__current.node;};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=(this||_global).__current;(this||_global).__current=element;(this||_global).__state=null;if(callback){result=callback.call(this||_global,element.node,(this||_global).__leavelist[(this||_global).__leavelist.length-1].node);}(this||_global).__current=previous;return result;};// API:
// notify control skip / break
Controller.prototype.notify=function notify(flag){(this||_global).__state=flag;};// API:
// skip child nodes of current node
Controller.prototype.skip=function(){this.notify(SKIP);};// API:
// break traversals
Controller.prototype["break"]=function(){this.notify(BREAK);};// API:
// remove node
Controller.prototype.remove=function(){this.notify(REMOVE);};Controller.prototype.__initialize=function(root,visitor){(this||_global).visitor=visitor;(this||_global).root=root;(this||_global).__worklist=[];(this||_global).__leavelist=[];(this||_global).__current=null;(this||_global).__state=null;(this||_global).__fallback=null;if(visitor.fallback==="iteration"){(this||_global).__fallback=Object.keys;}else if(typeof visitor.fallback==="function"){(this||_global).__fallback=visitor.fallback;}(this||_global).__keys=VisitorKeys;if(visitor.keys){(this||_global).__keys=Object.assign(Object.create((this||_global).__keys),visitor.keys);}};function isNode(node){if(node==null){return false;}return _typeof2(node)==="object"&&typeof node.type==="string";}function isProperty(nodeType,key){return(nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===key;}function candidateExistsInLeaveList(leavelist,candidate){for(var i=leavelist.length-1;i>=0;--i){if(leavelist[i].node===candidate){return true;}}return false;}Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};// reference
worklist=(this||_global).__worklist;leavelist=(this||_global).__leavelist;// initialize
worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if((this||_global).__state===BREAK||ret===BREAK){return;}continue;}if(element.node){ret=this.__execute(visitor.enter,element);if((this||_global).__state===BREAK||ret===BREAK){return;}worklist.push(sentinel);leavelist.push(element);if((this||_global).__state===SKIP||ret===SKIP){continue;}node=element.node;nodeType=node.type||element.wrap;candidates=(this||_global).__keys[nodeType];if(!candidates){if((this||_global).__fallback){candidates=this.__fallback(node);}else{throw new Error("Unknown node type "+nodeType+".");}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue;}if(Array.isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue;}if(candidateExistsInLeaveList(leavelist,candidate[current2])){continue;}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",null);}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,null);}else{continue;}worklist.push(element);}}else if(isNode(candidate)){if(candidateExistsInLeaveList(leavelist,candidate)){continue;}worklist.push(new Element(candidate,key,null,null));}}}}};Controller.prototype.replace=function replace(root,visitor){var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;function removeElem(element){var i,key,nextElem,parent;if(element.ref.remove()){// When the reference is an element of an array.
key=element.ref.key;parent=element.ref.parent;// If removed from array, then decrease following items' keys.
i=worklist.length;while(i--){nextElem=worklist[i];if(nextElem.ref&&nextElem.ref.parent===parent){if(nextElem.ref.key<key){break;}--nextElem.ref.key;}}}}this.__initialize(root,visitor);sentinel={};// reference
worklist=(this||_global).__worklist;leavelist=(this||_global).__leavelist;// initialize
outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);// node may be replaced with null,
// so distinguish between undefined and null in this place
if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){// replace
element.ref.replace(target);}if((this||_global).__state===REMOVE||target===REMOVE){removeElem(element);}if((this||_global).__state===BREAK||target===BREAK){return outer.root;}continue;}target=this.__execute(visitor.enter,element);// node may be replaced with null,
// so distinguish between undefined and null in this place
if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){// replace
element.ref.replace(target);element.node=target;}if((this||_global).__state===REMOVE||target===REMOVE){removeElem(element);element.node=null;}if((this||_global).__state===BREAK||target===BREAK){return outer.root;}// node may be null
node=element.node;if(!node){continue;}worklist.push(sentinel);leavelist.push(element);if((this||_global).__state===SKIP||target===SKIP){continue;}nodeType=node.type||element.wrap;candidates=(this||_global).__keys[nodeType];if(!candidates){if((this||_global).__fallback){candidates=this.__fallback(node);}else{throw new Error("Unknown node type "+nodeType+".");}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue;}if(Array.isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue;}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2));}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2));}else{continue;}worklist.push(element);}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)));}}}return outer.root;};function traverse(root,visitor){var controller=new Controller();return controller.traverse(root,visitor);}function replace(root,visitor){var controller=new Controller();return controller.replace(root,visitor);}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0];});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0];}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1];}return comment;}function attachComments(tree,providedComments,tokens){// At first, we should calculate extended comment ranges.
var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information");}// tokens array is empty, we attach comments to tree as 'leadingComments'
if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment);}tree.leadingComments=comments;}return tree;}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens));}// This is based on John Freeman's implementation.
cursor=0;traverse(tree,{enter:function enter(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break;}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[];}node.leadingComments.push(comment);comments.splice(cursor,1);}else{cursor+=1;}}// already out of owned node
if(cursor===comments.length){return VisitorOption.Break;}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip;}}});cursor=0;traverse(tree,{leave:function leave(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break;}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[];}node.trailingComments.push(comment);comments.splice(cursor,1);}else{cursor+=1;}}// already out of owned node
if(cursor===comments.length){return VisitorOption.Break;}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip;}}});return tree;}exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller;exports.cloneEnvironment=function(){return clone({});};return exports;})(exports$2);var exports$3={};/*
  Copyright (C) 2013 Yusuke Suzuki <utatane.tea@gmail.com>

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS'
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/(function(){function isExpression(node){if(node==null){return false;}switch(node.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return true;}return false;}function isIterationStatement(node){if(node==null){return false;}switch(node.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return true;}return false;}function isStatement(node){if(node==null){return false;}switch(node.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return true;}return false;}function isSourceElement(node){return isStatement(node)||node!=null&&node.type==="FunctionDeclaration";}function trailingStatement(node){switch(node.type){case"IfStatement":if(node.alternate!=null){return node.alternate;}return node.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return node.body;}return null;}function isProblematicIfStatement(node){var current;if(node.type!=="IfStatement"){return false;}if(node.alternate==null){return false;}current=node.consequent;do{if(current.type==="IfStatement"){if(current.alternate==null){return true;}}current=trailingStatement(current);}while(current);return false;}exports$3={isExpression:isExpression,isStatement:isStatement,isIterationStatement:isIterationStatement,isSourceElement:isSourceElement,isProblematicIfStatement:isProblematicIfStatement,trailingStatement:trailingStatement};})();/* vim: set sw=4 ts=4 et tw=80 : */var _ast=exports$3;var isExpression=exports$3.isExpression,isStatement=exports$3.isStatement,isIterationStatement=exports$3.isIterationStatement,isSourceElement=exports$3.isSourceElement,isProblematicIfStatement=exports$3.isProblematicIfStatement,trailingStatement=exports$3.trailingStatement;var exports$4={};/*
  Copyright (C) 2013-2014 Yusuke Suzuki <utatane.tea@gmail.com>
  Copyright (C) 2014 Ivan Nikulin <ifaaan@gmail.com>

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/(function(){var ES6Regex,ES5Regex,NON_ASCII_WHITESPACES,IDENTIFIER_START,IDENTIFIER_PART,ch;// See `tools/generate-identifier-regex.js`.
ES5Regex={// ECMAScript 5.1/Unicode v9.0.0 NonAsciiIdentifierStart:
NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,// ECMAScript 5.1/Unicode v9.0.0 NonAsciiIdentifierPart:
NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/};ES6Regex={// ECMAScript 6/Unicode v9.0.0 NonAsciiIdentifierStart:
NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,// ECMAScript 6/Unicode v9.0.0 NonAsciiIdentifierPart:
NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};function isDecimalDigit(ch){return 48<=ch&&ch<=57;// 0..9
}function isHexDigit(ch){return 48<=ch&&ch<=57||// 0..9
97<=ch&&ch<=102||// a..f
65<=ch&&ch<=70;// A..F
}function isOctalDigit(ch){return ch>=48&&ch<=55;// 0..7
}// 7.2 White Space
NON_ASCII_WHITESPACES=[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&NON_ASCII_WHITESPACES.indexOf(ch)>=0;}// 7.3 Line Terminators
function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233;}// 7.6 Identifier Names and Identifiers
function fromCodePoint(cp){if(cp<=65535){return String.fromCharCode(cp);}var cu1=String.fromCharCode(Math.floor((cp-65536)/1024)+55296);var cu2=String.fromCharCode((cp-65536)%1024+56320);return cu1+cu2;}IDENTIFIER_START=new Array(128);for(ch=0;ch<128;++ch){IDENTIFIER_START[ch]=ch>=97&&ch<=122||// a..z
ch>=65&&ch<=90||// A..Z
ch===36||ch===95;// $ (dollar) and _ (underscore)
}IDENTIFIER_PART=new Array(128);for(ch=0;ch<128;++ch){IDENTIFIER_PART[ch]=ch>=97&&ch<=122||// a..z
ch>=65&&ch<=90||// A..Z
ch>=48&&ch<=57||// 0..9
ch===36||ch===95;// $ (dollar) and _ (underscore)
}function isIdentifierStartES5(ch){return ch<128?IDENTIFIER_START[ch]:ES5Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch));}function isIdentifierPartES5(ch){return ch<128?IDENTIFIER_PART[ch]:ES5Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch));}function isIdentifierStartES6(ch){return ch<128?IDENTIFIER_START[ch]:ES6Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch));}function isIdentifierPartES6(ch){return ch<128?IDENTIFIER_PART[ch]:ES6Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch));}exports$4={isDecimalDigit:isDecimalDigit,isHexDigit:isHexDigit,isOctalDigit:isOctalDigit,isWhiteSpace:isWhiteSpace,isLineTerminator:isLineTerminator,isIdentifierStartES5:isIdentifierStartES5,isIdentifierPartES5:isIdentifierPartES5,isIdentifierStartES6:isIdentifierStartES6,isIdentifierPartES6:isIdentifierPartES6};})();/* vim: set sw=4 ts=4 et tw=80 : */var _code=exports$4;var exports$1$2={};/*
  Copyright (C) 2013 Yusuke Suzuki <utatane.tea@gmail.com>

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/(function(){var code=_code;function isStrictModeReservedWordES6(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return true;default:return false;}}function isKeywordES5(id,strict){// yield should not be treated as keyword under non-strict mode.
if(!strict&&id==="yield"){return false;}return isKeywordES6(id,strict);}function isKeywordES6(id,strict){if(strict&&isStrictModeReservedWordES6(id)){return true;}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false;}}function isReservedWordES5(id,strict){return id==="null"||id==="true"||id==="false"||isKeywordES5(id,strict);}function isReservedWordES6(id,strict){return id==="null"||id==="true"||id==="false"||isKeywordES6(id,strict);}function isRestrictedWord(id){return id==="eval"||id==="arguments";}function isIdentifierNameES5(id){var i,iz,ch;if(id.length===0){return false;}ch=id.charCodeAt(0);if(!code.isIdentifierStartES5(ch)){return false;}for(i=1,iz=id.length;i<iz;++i){ch=id.charCodeAt(i);if(!code.isIdentifierPartES5(ch)){return false;}}return true;}function decodeUtf16(lead,trail){return(lead-55296)*1024+(trail-56320)+65536;}function isIdentifierNameES6(id){var i,iz,ch,lowCh,check;if(id.length===0){return false;}check=code.isIdentifierStartES6;for(i=0,iz=id.length;i<iz;++i){ch=id.charCodeAt(i);if(55296<=ch&&ch<=56319){++i;if(i>=iz){return false;}lowCh=id.charCodeAt(i);if(!(56320<=lowCh&&lowCh<=57343)){return false;}ch=decodeUtf16(ch,lowCh);}if(!check(ch)){return false;}check=code.isIdentifierPartES6;}return true;}function isIdentifierES5(id,strict){return isIdentifierNameES5(id)&&!isReservedWordES5(id,strict);}function isIdentifierES6(id,strict){return isIdentifierNameES6(id)&&!isReservedWordES6(id,strict);}exports$1$2={isKeywordES5:isKeywordES5,isKeywordES6:isKeywordES6,isReservedWordES5:isReservedWordES5,isReservedWordES6:isReservedWordES6,isRestrictedWord:isRestrictedWord,isIdentifierNameES5:isIdentifierNameES5,isIdentifierNameES6:isIdentifierNameES6,isIdentifierES5:isIdentifierES5,isIdentifierES6:isIdentifierES6};})();/* vim: set sw=4 ts=4 et tw=80 : */var _keyword=exports$1$2;var exports$2$1={};/*
  Copyright (C) 2013 Yusuke Suzuki <utatane.tea@gmail.com>

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/(function(){exports$2$1.ast=_ast;exports$2$1.code=_code;exports$2$1.keyword=_keyword;})();var exports$5={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */ /**
 * This is a helper function for getting values from parameter/options
 * objects.
 *
 * @param args The object we are extracting values from
 * @param name The name of the property we are getting.
 * @param defaultValue An optional value to return if the property is missing
 * from the object. If this is not specified and the property is missing, an
 * error will be thrown.
 */function getArg(aArgs,aName,aDefaultValue){if(aName in aArgs){return aArgs[aName];}else if(arguments.length===3){return aDefaultValue;}else{throw new Error("\""+aName+"\" is a required argument.");}}exports$5.getArg=getArg;var urlRegexp=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/;var dataUrlRegexp=/^data:.+\,.+$/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);if(!match){return null;}return{scheme:match[1],auth:match[2],host:match[3],port:match[4],path:match[5]};}exports$5.urlParse=urlParse;function urlGenerate(aParsedUrl){var url="";if(aParsedUrl.scheme){url+=aParsedUrl.scheme+":";}url+="//";if(aParsedUrl.auth){url+=aParsedUrl.auth+"@";}if(aParsedUrl.host){url+=aParsedUrl.host;}if(aParsedUrl.port){url+=":"+aParsedUrl.port;}if(aParsedUrl.path){url+=aParsedUrl.path;}return url;}exports$5.urlGenerate=urlGenerate;/**
 * Normalizes a path, or the path portion of a URL:
 *
 * - Replaces consecutive slashes with one slash.
 * - Removes unnecessary '.' parts.
 * - Removes unnecessary '<dir>/..' parts.
 *
 * Based on code in the Node.js 'path' core module.
 *
 * @param aPath The path or url to normalize.
 */function normalize(aPath){var path=aPath;var url=urlParse(aPath);if(url){if(!url.path){return aPath;}path=url.path;}var isAbsolute=exports$5.isAbsolute(path);var parts=path.split(/\/+/);for(var part,up=0,i=parts.length-1;i>=0;i--){part=parts[i];if(part==="."){parts.splice(i,1);}else if(part===".."){up++;}else if(up>0){if(part===""){// The first part is blank if the path is absolute. Trying to go
// above the root is a no-op. Therefore we can remove all '..' parts
// directly after the root.
parts.splice(i+1,up);up=0;}else{parts.splice(i,2);up--;}}}path=parts.join("/");if(path===""){path=isAbsolute?"/":".";}if(url){url.path=path;return urlGenerate(url);}return path;}exports$5.normalize=normalize;/**
 * Joins two paths/URLs.
 *
 * @param aRoot The root path or URL.
 * @param aPath The path or URL to be joined with the root.
 *
 * - If aPath is a URL or a data URI, aPath is returned, unless aPath is a
 *   scheme-relative URL: Then the scheme of aRoot, if any, is prepended
 *   first.
 * - Otherwise aPath is a path. If aRoot is a URL, then its path portion
 *   is updated with the result and aRoot is returned. Otherwise the result
 *   is returned.
 *   - If aPath is absolute, the result is aPath.
 *   - Otherwise the two paths are joined with a slash.
 * - Joining for example 'http://' and 'www.example.com' is also supported.
 */function join(aRoot,aPath){if(aRoot===""){aRoot=".";}if(aPath===""){aPath=".";}var aPathUrl=urlParse(aPath);var aRootUrl=urlParse(aRoot);if(aRootUrl){aRoot=aRootUrl.path||"/";}// `join(foo, '//www.example.org')`
if(aPathUrl&&!aPathUrl.scheme){if(aRootUrl){aPathUrl.scheme=aRootUrl.scheme;}return urlGenerate(aPathUrl);}if(aPathUrl||aPath.match(dataUrlRegexp)){return aPath;}// `join('http://', 'www.example.com')`
if(aRootUrl&&!aRootUrl.host&&!aRootUrl.path){aRootUrl.host=aPath;return urlGenerate(aRootUrl);}var joined=aPath.charAt(0)==="/"?aPath:normalize(aRoot.replace(/\/+$/,"")+"/"+aPath);if(aRootUrl){aRootUrl.path=joined;return urlGenerate(aRootUrl);}return joined;}exports$5.join=join;exports$5.isAbsolute=function(aPath){return aPath.charAt(0)==="/"||urlRegexp.test(aPath);};/**
 * Make a path relative to a URL or another path.
 *
 * @param aRoot The root path or URL.
 * @param aPath The path or URL to be made relative to aRoot.
 */function relative(aRoot,aPath){if(aRoot===""){aRoot=".";}aRoot=aRoot.replace(/\/$/,"");// It is possible for the path to be above the root. In this case, simply
// checking whether the root is a prefix of the path won't work. Instead, we
// need to remove components from the root one by one, until either we find
// a prefix that fits, or we run out of components to remove.
var level=0;while(aPath.indexOf(aRoot+"/")!==0){var index=aRoot.lastIndexOf("/");if(index<0){return aPath;}// If the only part of the root that is left is the scheme (i.e. http://,
// file:///, etc.), one or more slashes (/), or simply nothing at all, we
// have exhausted all components, so the path is not relative to the root.
aRoot=aRoot.slice(0,index);if(aRoot.match(/^([^\/]+:\/)?\/*$/)){return aPath;}++level;}// Make sure we add a "../" for each component we removed from the root.
return Array(level+1).join("../")+aPath.substr(aRoot.length+1);}exports$5.relative=relative;var supportsNullProto=function(){var obj=Object.create(null);return!("__proto__"in obj);}();function identity(s){return s;}/**
 * Because behavior goes wacky when you set `__proto__` on objects, we
 * have to prefix all the strings in our set with an arbitrary character.
 *
 * See https://github.com/mozilla/source-map/pull/31 and
 * https://github.com/mozilla/source-map/issues/30
 *
 * @param String aStr
 */function toSetString(aStr){if(isProtoString(aStr)){return"$"+aStr;}return aStr;}exports$5.toSetString=supportsNullProto?identity:toSetString;function fromSetString(aStr){if(isProtoString(aStr)){return aStr.slice(1);}return aStr;}exports$5.fromSetString=supportsNullProto?identity:fromSetString;function isProtoString(s){if(!s){return false;}var length=s.length;if(length<9/* "__proto__".length */){return false;}if(s.charCodeAt(length-1)!==95/* '_' */||s.charCodeAt(length-2)!==95/* '_' */||s.charCodeAt(length-3)!==111/* 'o' */||s.charCodeAt(length-4)!==116/* 't' */||s.charCodeAt(length-5)!==111/* 'o' */||s.charCodeAt(length-6)!==114/* 'r' */||s.charCodeAt(length-7)!==112/* 'p' */||s.charCodeAt(length-8)!==95/* '_' */||s.charCodeAt(length-9)!==95/* '_' */){return false;}for(var i=length-10;i>=0;i--){if(s.charCodeAt(i)!==36/* '$' */){return false;}}return true;}/**
 * Comparator between two mappings where the original positions are compared.
 *
 * Optionally pass in `true` as `onlyCompareGenerated` to consider two
 * mappings with the same original source/line/column, but different generated
 * line and column the same. Useful when searching for a mapping with a
 * stubbed out mapping.
 */function compareByOriginalPositions(mappingA,mappingB,onlyCompareOriginal){var cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp;}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp;}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0||onlyCompareOriginal){return cmp;}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp;}cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp;}return strcmp(mappingA.name,mappingB.name);}exports$5.compareByOriginalPositions=compareByOriginalPositions;/**
 * Comparator between two mappings with deflated source and name indices where
 * the generated positions are compared.
 *
 * Optionally pass in `true` as `onlyCompareGenerated` to consider two
 * mappings with the same generated line and column, but different
 * source/name/original line and column the same. Useful when searching for a
 * mapping with a stubbed out mapping.
 */function compareByGeneratedPositionsDeflated(mappingA,mappingB,onlyCompareGenerated){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp;}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0||onlyCompareGenerated){return cmp;}cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp;}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp;}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp;}return strcmp(mappingA.name,mappingB.name);}exports$5.compareByGeneratedPositionsDeflated=compareByGeneratedPositionsDeflated;function strcmp(aStr1,aStr2){if(aStr1===aStr2){return 0;}if(aStr1===null){return 1;// aStr2 !== null
}if(aStr2===null){return-1;// aStr1 !== null
}if(aStr1>aStr2){return 1;}return-1;}/**
 * Comparator between two mappings with inflated source and name strings where
 * the generated positions are compared.
 */function compareByGeneratedPositionsInflated(mappingA,mappingB){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp;}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp;}cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp;}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp;}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp;}return strcmp(mappingA.name,mappingB.name);}exports$5.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated;/**
 * Strip any JSON XSSI avoidance prefix from the string (as documented
 * in the source maps specification), and then parse the string as
 * JSON.
 */function parseSourceMapInput(str){return JSON.parse(str.replace(/^\)]}'[^\n]*\n/,""));}exports$5.parseSourceMapInput=parseSourceMapInput;/**
 * Compute the URL of a source given the the source root, the source's
 * URL, and the source map's URL.
 */function computeSourceURL(sourceRoot,sourceURL,sourceMapURL){sourceURL=sourceURL||"";if(sourceRoot){// This follows what Chrome does.
if(sourceRoot[sourceRoot.length-1]!=="/"&&sourceURL[0]!=="/"){sourceRoot+="/";}// The spec says:
//   Line 4: An optional source root, useful for relocating source
//   files on a server or removing repeated values in the
//   “sources” entry.  This value is prepended to the individual
//   entries in the “source” field.
sourceURL=sourceRoot+sourceURL;}// Historically, SourceMapConsumer did not take the sourceMapURL as
// a parameter.  This mode is still somewhat supported, which is why
// this code block is conditional.  However, it's preferable to pass
// the source map URL to SourceMapConsumer, so that this function
// can implement the source URL resolution algorithm as outlined in
// the spec.  This block is basically the equivalent of:
//    new URL(sourceURL, sourceMapURL).toString()
// ... except it avoids using URL, which wasn't available in the
// older releases of node still supported by this library.
//
// The spec says:
//   If the sources are not absolute URLs after prepending of the
//   “sourceRoot”, the sources are resolved relative to the
//   SourceMap (like resolving script src in a html document).
if(sourceMapURL){var parsed=urlParse(sourceMapURL);if(!parsed){throw new Error("sourceMapURL could not be parsed");}if(parsed.path){// Strip the last path component, but keep the "/".
var index=parsed.path.lastIndexOf("/");if(index>=0){parsed.path=parsed.path.substring(0,index+1);}}sourceURL=join(urlGenerate(parsed),sourceURL);}return normalize(sourceURL);}exports$5.computeSourceURL=computeSourceURL;var exports$6={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */var intToCharMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");/**
 * Encode an integer in the range of 0 to 63 to a single base 64 digit.
 */exports$6.encode=function(number){if(0<=number&&number<intToCharMap.length){return intToCharMap[number];}throw new TypeError("Must be between 0 and 63: "+number);};/**
 * Decode a single base 64 character code digit to an integer. Returns -1 on
 * failure.
 */exports$6.decode=function(charCode){var bigA=65;// 'A'
var bigZ=90;// 'Z'
var littleA=97;// 'a'
var littleZ=122;// 'z'
var zero=48;// '0'
var nine=57;// '9'
var plus=43;// '+'
var slash=47;// '/'
var littleOffset=26;var numberOffset=52;// 0 - 25: ABCDEFGHIJKLMNOPQRSTUVWXYZ
if(bigA<=charCode&&charCode<=bigZ){return charCode-bigA;}// 26 - 51: abcdefghijklmnopqrstuvwxyz
if(littleA<=charCode&&charCode<=littleZ){return charCode-littleA+littleOffset;}// 52 - 61: 0123456789
if(zero<=charCode&&charCode<=nine){return charCode-zero+numberOffset;}// 62: +
if(charCode==plus){return 62;}// 63: /
if(charCode==slash){return 63;}// Invalid base64 digit.
return-1;};var exports$1$3={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 *
 * Based on the Base 64 VLQ implementation in Closure Compiler:
 * https://code.google.com/p/closure-compiler/source/browse/trunk/src/com/google/debugging/sourcemap/Base64VLQ.java
 *
 * Copyright 2011 The Closure Compiler Authors. All rights reserved.
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *  * Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *  * Redistributions in binary form must reproduce the above
 *    copyright notice, this list of conditions and the following
 *    disclaimer in the documentation and/or other materials provided
 *    with the distribution.
 *  * Neither the name of Google Inc. nor the names of its
 *    contributors may be used to endorse or promote products derived
 *    from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */var base64=exports$6;// A single base 64 digit can contain 6 bits of data. For the base 64 variable
// length quantities we use in the source map spec, the first bit is the sign,
// the next four bits are the actual value, and the 6th bit is the
// continuation bit. The continuation bit tells us whether there are more
// digits in this value following this digit.
//
//   Continuation
//   |    Sign
//   |    |
//   V    V
//   101011
var VLQ_BASE_SHIFT=5;// binary: 100000
var VLQ_BASE=1<<VLQ_BASE_SHIFT;// binary: 011111
var VLQ_BASE_MASK=VLQ_BASE-1;// binary: 100000
var VLQ_CONTINUATION_BIT=VLQ_BASE;/**
 * Converts from a two-complement value to a value where the sign bit is
 * placed in the least significant bit.  For example, as decimals:
 *   1 becomes 2 (10 binary), -1 becomes 3 (11 binary)
 *   2 becomes 4 (100 binary), -2 becomes 5 (101 binary)
 */function toVLQSigned(aValue){return aValue<0?(-aValue<<1)+1:(aValue<<1)+0;}/**
 * Converts to a two-complement value from a value where the sign bit is
 * placed in the least significant bit.  For example, as decimals:
 *   2 (10 binary) becomes 1, 3 (11 binary) becomes -1
 *   4 (100 binary) becomes 2, 5 (101 binary) becomes -2
 */function fromVLQSigned(aValue){var isNegative=(aValue&1)===1;var shifted=aValue>>1;return isNegative?-shifted:shifted;}/**
 * Returns the base 64 VLQ encoded value.
 */exports$1$3.encode=function base64VLQ_encode(aValue){var encoded="";var digit;var vlq=toVLQSigned(aValue);do{digit=vlq&VLQ_BASE_MASK;vlq>>>=VLQ_BASE_SHIFT;if(vlq>0){// There are still more digits in this value, so we must make sure the
// continuation bit is marked.
digit|=VLQ_CONTINUATION_BIT;}encoded+=base64.encode(digit);}while(vlq>0);return encoded;};/**
 * Decodes the next base 64 VLQ value from the given string and returns the
 * value and the rest of the string via the out parameter.
 */exports$1$3.decode=function base64VLQ_decode(aStr,aIndex,aOutParam){var strLen=aStr.length;var result=0;var shift=0;var continuation,digit;do{if(aIndex>=strLen){throw new Error("Expected more digits in base 64 VLQ value.");}digit=base64.decode(aStr.charCodeAt(aIndex++));if(digit===-1){throw new Error("Invalid base64 digit: "+aStr.charAt(aIndex-1));}continuation=!!(digit&VLQ_CONTINUATION_BIT);digit&=VLQ_BASE_MASK;result=result+(digit<<shift);shift+=VLQ_BASE_SHIFT;}while(continuation);aOutParam.value=fromVLQSigned(result);aOutParam.rest=aIndex;};var _global$1=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$2$2={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */var util=exports$5;var has=Object.prototype.hasOwnProperty;var hasNativeMap=typeof Map!=="undefined";/**
 * A data structure which is a combination of an array and a set. Adding a new
 * member is O(1), testing for membership is O(1), and finding the index of an
 * element is O(1). Removing elements from the set is not supported. Only
 * strings are supported for membership.
 */function ArraySet(){(this||_global$1)._array=[];(this||_global$1)._set=hasNativeMap?new Map():Object.create(null);}/**
 * Static method for creating ArraySet instances from an existing array.
 */ArraySet.fromArray=function ArraySet_fromArray(aArray,aAllowDuplicates){var set=new ArraySet();for(var i=0,len=aArray.length;i<len;i++){set.add(aArray[i],aAllowDuplicates);}return set;};/**
 * Return how many unique items are in this ArraySet. If duplicates have been
 * added, than those do not count towards the size.
 *
 * @returns Number
 */ArraySet.prototype.size=function ArraySet_size(){return hasNativeMap?(this||_global$1)._set.size:Object.getOwnPropertyNames((this||_global$1)._set).length;};/**
 * Add the given string to this set.
 *
 * @param String aStr
 */ArraySet.prototype.add=function ArraySet_add(aStr,aAllowDuplicates){var sStr=hasNativeMap?aStr:util.toSetString(aStr);var isDuplicate=hasNativeMap?this.has(aStr):has.call((this||_global$1)._set,sStr);var idx=(this||_global$1)._array.length;if(!isDuplicate||aAllowDuplicates){(this||_global$1)._array.push(aStr);}if(!isDuplicate){if(hasNativeMap){(this||_global$1)._set.set(aStr,idx);}else{(this||_global$1)._set[sStr]=idx;}}};/**
 * Is the given string a member of this set?
 *
 * @param String aStr
 */ArraySet.prototype.has=function ArraySet_has(aStr){if(hasNativeMap){return(this||_global$1)._set.has(aStr);}else{var sStr=util.toSetString(aStr);return has.call((this||_global$1)._set,sStr);}};/**
 * What is the index of the given string in the array?
 *
 * @param String aStr
 */ArraySet.prototype.indexOf=function ArraySet_indexOf(aStr){if(hasNativeMap){var idx=(this||_global$1)._set.get(aStr);if(idx>=0){return idx;}}else{var sStr=util.toSetString(aStr);if(has.call((this||_global$1)._set,sStr)){return(this||_global$1)._set[sStr];}}throw new Error("\""+aStr+"\" is not in the set.");};/**
 * What is the element at the given index?
 *
 * @param Number aIdx
 */ArraySet.prototype.at=function ArraySet_at(aIdx){if(aIdx>=0&&aIdx<(this||_global$1)._array.length){return(this||_global$1)._array[aIdx];}throw new Error("No element indexed by "+aIdx);};/**
 * Returns the array representation of this set (which has the proper indices
 * indicated by indexOf). Note that this is a copy of the internal array used
 * for storing the members so that no one can mess with internal state.
 */ArraySet.prototype.toArray=function ArraySet_toArray(){return(this||_global$1)._array.slice();};exports$2$2.ArraySet=ArraySet;var _global$2=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$7={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2014 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */var util$1=exports$5;/**
 * Determine whether mappingB is after mappingA with respect to generated
 * position.
 */function generatedPositionAfter(mappingA,mappingB){// Optimized for most common case
var lineA=mappingA.generatedLine;var lineB=mappingB.generatedLine;var columnA=mappingA.generatedColumn;var columnB=mappingB.generatedColumn;return lineB>lineA||lineB==lineA&&columnB>=columnA||util$1.compareByGeneratedPositionsInflated(mappingA,mappingB)<=0;}/**
 * A data structure to provide a sorted view of accumulated mappings in a
 * performance conscious manner. It trades a neglibable overhead in general
 * case for a large speedup in case of mappings being added in order.
 */function MappingList(){(this||_global$2)._array=[];(this||_global$2)._sorted=true;// Serves as infimum
(this||_global$2)._last={generatedLine:-1,generatedColumn:0};}/**
 * Iterate through internal items. This method takes the same arguments that
 * `Array.prototype.forEach` takes.
 *
 * NOTE: The order of the mappings is NOT guaranteed.
 */MappingList.prototype.unsortedForEach=function MappingList_forEach(aCallback,aThisArg){(this||_global$2)._array.forEach(aCallback,aThisArg);};/**
 * Add the given source mapping.
 *
 * @param Object aMapping
 */MappingList.prototype.add=function MappingList_add(aMapping){if(generatedPositionAfter((this||_global$2)._last,aMapping)){(this||_global$2)._last=aMapping;(this||_global$2)._array.push(aMapping);}else{(this||_global$2)._sorted=false;(this||_global$2)._array.push(aMapping);}};/**
 * Returns the flat, sorted array of mappings. The mappings are sorted by
 * generated position.
 *
 * WARNING: This method returns internal data without copying, for
 * performance. The return value must NOT be mutated, and should be treated as
 * an immutable borrow. If you want to take ownership, you must make your own
 * copy.
 */MappingList.prototype.toArray=function MappingList_toArray(){if(!(this||_global$2)._sorted){(this||_global$2)._array.sort(util$1.compareByGeneratedPositionsInflated);(this||_global$2)._sorted=true;}return(this||_global$2)._array;};exports$7.MappingList=MappingList;var _global$1$1=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$1$4={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */var base64VLQ=exports$1$3;var util$1$1=exports$5;var ArraySet$1=exports$2$2.ArraySet;var MappingList$1=exports$7.MappingList;/**
 * An instance of the SourceMapGenerator represents a source map which is
 * being built incrementally. You may pass an object with the following
 * properties:
 *
 *   - file: The filename of the generated source.
 *   - sourceRoot: A root for all relative URLs in this source map.
 */function SourceMapGenerator(aArgs){if(!aArgs){aArgs={};}(this||_global$1$1)._file=util$1$1.getArg(aArgs,"file",null);(this||_global$1$1)._sourceRoot=util$1$1.getArg(aArgs,"sourceRoot",null);(this||_global$1$1)._skipValidation=util$1$1.getArg(aArgs,"skipValidation",false);(this||_global$1$1)._sources=new ArraySet$1();(this||_global$1$1)._names=new ArraySet$1();(this||_global$1$1)._mappings=new MappingList$1();(this||_global$1$1)._sourcesContents=null;}SourceMapGenerator.prototype._version=3;/**
 * Creates a new SourceMapGenerator based on a SourceMapConsumer
 *
 * @param aSourceMapConsumer The SourceMap.
 */SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot;var generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};if(mapping.source!=null){newMapping.source=mapping.source;if(sourceRoot!=null){newMapping.source=util$1$1.relative(sourceRoot,newMapping.source);}newMapping.original={line:mapping.originalLine,column:mapping.originalColumn};if(mapping.name!=null){newMapping.name=mapping.name;}}generator.addMapping(newMapping);});aSourceMapConsumer.sources.forEach(function(sourceFile){var sourceRelative=sourceFile;if(sourceRoot!==null){sourceRelative=util$1$1.relative(sourceRoot,sourceFile);}if(!generator._sources.has(sourceRelative)){generator._sources.add(sourceRelative);}var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){generator.setSourceContent(sourceFile,content);}});return generator;};/**
 * Add a single mapping from original source line and column to the generated
 * source's line and column for this source map being created. The mapping
 * object should have the following properties:
 *
 *   - generated: An object with the generated line and column positions.
 *   - original: An object with the original line and column positions.
 *   - source: The original source file (relative to the sourceRoot).
 *   - name: An optional original token name for this mapping.
 */SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(aArgs){var generated=util$1$1.getArg(aArgs,"generated");var original=util$1$1.getArg(aArgs,"original",null);var source=util$1$1.getArg(aArgs,"source",null);var name=util$1$1.getArg(aArgs,"name",null);if(!(this||_global$1$1)._skipValidation){this._validateMapping(generated,original,source,name);}if(source!=null){source=String(source);if(!(this||_global$1$1)._sources.has(source)){(this||_global$1$1)._sources.add(source);}}if(name!=null){name=String(name);if(!(this||_global$1$1)._names.has(name)){(this||_global$1$1)._names.add(name);}}(this||_global$1$1)._mappings.add({generatedLine:generated.line,generatedColumn:generated.column,originalLine:original!=null&&original.line,originalColumn:original!=null&&original.column,source:source,name:name});};/**
 * Set the source content for a source file.
 */SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(aSourceFile,aSourceContent){var source=aSourceFile;if((this||_global$1$1)._sourceRoot!=null){source=util$1$1.relative((this||_global$1$1)._sourceRoot,source);}if(aSourceContent!=null){// Add the source content to the _sourcesContents map.
// Create a new _sourcesContents map if the property is null.
if(!(this||_global$1$1)._sourcesContents){(this||_global$1$1)._sourcesContents=Object.create(null);}(this||_global$1$1)._sourcesContents[util$1$1.toSetString(source)]=aSourceContent;}else if((this||_global$1$1)._sourcesContents){// Remove the source file from the _sourcesContents map.
// If the _sourcesContents map is empty, set the property to null.
delete(this||_global$1$1)._sourcesContents[util$1$1.toSetString(source)];if(Object.keys((this||_global$1$1)._sourcesContents).length===0){(this||_global$1$1)._sourcesContents=null;}}};/**
 * Applies the mappings of a sub-source-map for a specific source file to the
 * source map being generated. Each mapping to the supplied source file is
 * rewritten using the supplied source map. Note: The resolution for the
 * resulting mappings is the minimium of this map and the supplied map.
 *
 * @param aSourceMapConsumer The source map to be applied.
 * @param aSourceFile Optional. The filename of the source file.
 *        If omitted, SourceMapConsumer's file property will be used.
 * @param aSourceMapPath Optional. The dirname of the path to the source map
 *        to be applied. If relative, it is relative to the SourceMapConsumer.
 *        This parameter is needed when the two source maps aren't in the same
 *        directory, and the source map to be applied contains relative source
 *        paths. If so, those relative source paths need to be rewritten
 *        relative to the SourceMapGenerator.
 */SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(aSourceMapConsumer,aSourceFile,aSourceMapPath){var sourceFile=aSourceFile;// If aSourceFile is omitted, we will use the file property of the SourceMap
if(aSourceFile==null){if(aSourceMapConsumer.file==null){throw new Error("SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, "+"or the source map's \"file\" property. Both were omitted.");}sourceFile=aSourceMapConsumer.file;}var sourceRoot=(this||_global$1$1)._sourceRoot;// Make "sourceFile" relative if an absolute Url is passed.
if(sourceRoot!=null){sourceFile=util$1$1.relative(sourceRoot,sourceFile);}// Applying the SourceMap can add and remove items from the sources and
// the names array.
var newSources=new ArraySet$1();var newNames=new ArraySet$1();// Find mappings for the "sourceFile"
(this||_global$1$1)._mappings.unsortedForEach(function(mapping){if(mapping.source===sourceFile&&mapping.originalLine!=null){// Check if it can be mapped by the source map, then update the mapping.
var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});if(original.source!=null){// Copy mapping
mapping.source=original.source;if(aSourceMapPath!=null){mapping.source=util$1$1.join(aSourceMapPath,mapping.source);}if(sourceRoot!=null){mapping.source=util$1$1.relative(sourceRoot,mapping.source);}mapping.originalLine=original.line;mapping.originalColumn=original.column;if(original.name!=null){mapping.name=original.name;}}}var source=mapping.source;if(source!=null&&!newSources.has(source)){newSources.add(source);}var name=mapping.name;if(name!=null&&!newNames.has(name)){newNames.add(name);}},this||_global$1$1);(this||_global$1$1)._sources=newSources;(this||_global$1$1)._names=newNames;// Copy sourcesContents of applied map.
aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aSourceMapPath!=null){sourceFile=util$1$1.join(aSourceMapPath,sourceFile);}if(sourceRoot!=null){sourceFile=util$1$1.relative(sourceRoot,sourceFile);}this.setSourceContent(sourceFile,content);}},this||_global$1$1);};/**
 * A mapping can have one of the three levels of data:
 *
 *   1. Just the generated position.
 *   2. The Generated position, original position, and original source.
 *   3. Generated and original position, original source, as well as a name
 *      token.
 *
 * To maintain consistency, we validate that any new mapping being added falls
 * in to one of these categories.
 */SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(aGenerated,aOriginal,aSource,aName){// When aOriginal is truthy but has empty values for .line and .column,
// it is most likely a programmer error. In this case we throw a very
// specific error message to try to guide them the right way.
// For example: https://github.com/Polymer/polymer-bundler/pull/519
if(aOriginal&&typeof aOriginal.line!=="number"&&typeof aOriginal.column!=="number"){throw new Error("original.line and original.column are not numbers -- you probably meant to omit "+"the original mapping entirely and only map the generated position. If so, pass "+"null for the original mapping instead of an object with empty or null values.");}if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aGenerated.line>0&&aGenerated.column>=0&&!aOriginal&&!aSource&&!aName){// Case 1.
return;}else if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aOriginal&&"line"in aOriginal&&"column"in aOriginal&&aGenerated.line>0&&aGenerated.column>=0&&aOriginal.line>0&&aOriginal.column>=0&&aSource){// Cases 2 and 3.
return;}else{throw new Error("Invalid mapping: "+JSON.stringify({generated:aGenerated,source:aSource,original:aOriginal,name:aName}));}};/**
 * Serialize the accumulated mappings in to the stream of base 64 VLQs
 * specified by the source map format.
 */SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){var previousGeneratedColumn=0;var previousGeneratedLine=1;var previousOriginalColumn=0;var previousOriginalLine=0;var previousName=0;var previousSource=0;var result="";var next;var mapping;var nameIdx;var sourceIdx;var mappings=(this||_global$1$1)._mappings.toArray();for(var i=0,len=mappings.length;i<len;i++){mapping=mappings[i];next="";if(mapping.generatedLine!==previousGeneratedLine){previousGeneratedColumn=0;while(mapping.generatedLine!==previousGeneratedLine){next+=";";previousGeneratedLine++;}}else{if(i>0){if(!util$1$1.compareByGeneratedPositionsInflated(mapping,mappings[i-1])){continue;}next+=",";}}next+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn);previousGeneratedColumn=mapping.generatedColumn;if(mapping.source!=null){sourceIdx=(this||_global$1$1)._sources.indexOf(mapping.source);next+=base64VLQ.encode(sourceIdx-previousSource);previousSource=sourceIdx;// lines are stored 0-based in SourceMap spec version 3
next+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine);previousOriginalLine=mapping.originalLine-1;next+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn);previousOriginalColumn=mapping.originalColumn;if(mapping.name!=null){nameIdx=(this||_global$1$1)._names.indexOf(mapping.name);next+=base64VLQ.encode(nameIdx-previousName);previousName=nameIdx;}}result+=next;}return result;};SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(aSources,aSourceRoot){return aSources.map(function(source){if(!(this||_global$1$1)._sourcesContents){return null;}if(aSourceRoot!=null){source=util$1$1.relative(aSourceRoot,source);}var key=util$1$1.toSetString(source);return Object.prototype.hasOwnProperty.call((this||_global$1$1)._sourcesContents,key)?(this||_global$1$1)._sourcesContents[key]:null;},this||_global$1$1);};/**
 * Externalize the source map.
 */SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var map={version:(this||_global$1$1)._version,sources:(this||_global$1$1)._sources.toArray(),names:(this||_global$1$1)._names.toArray(),mappings:this._serializeMappings()};if((this||_global$1$1)._file!=null){map.file=(this||_global$1$1)._file;}if((this||_global$1$1)._sourceRoot!=null){map.sourceRoot=(this||_global$1$1)._sourceRoot;}if((this||_global$1$1)._sourcesContents){map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot);}return map;};/**
 * Render the source map being generated to a string.
 */SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this.toJSON());};exports$1$4.SourceMapGenerator=SourceMapGenerator;var exports$8={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */exports$8.GREATEST_LOWER_BOUND=1;exports$8.LEAST_UPPER_BOUND=2;/**
 * Recursive implementation of binary search.
 *
 * @param aLow Indices here and lower do not contain the needle.
 * @param aHigh Indices here and higher do not contain the needle.
 * @param aNeedle The element being searched for.
 * @param aHaystack The non-empty array being searched.
 * @param aCompare Function which takes two elements and returns -1, 0, or 1.
 * @param aBias Either 'binarySearch.GREATEST_LOWER_BOUND' or
 *     'binarySearch.LEAST_UPPER_BOUND'. Specifies whether to return the
 *     closest element that is smaller than or greater than the one we are
 *     searching for, respectively, if the exact element cannot be found.
 */function recursiveSearch(aLow,aHigh,aNeedle,aHaystack,aCompare,aBias){// This function terminates when one of the following is true:
//
//   1. We find the exact element we are looking for.
//
//   2. We did not find the exact element, but we can return the index of
//      the next-closest element.
//
//   3. We did not find the exact element, and there is no next-closest
//      element than the one we are searching for, so we return -1.
var mid=Math.floor((aHigh-aLow)/2)+aLow;var cmp=aCompare(aNeedle,aHaystack[mid],true);if(cmp===0){// Found the element we are looking for.
return mid;}else if(cmp>0){// Our needle is greater than aHaystack[mid].
if(aHigh-mid>1){// The element is in the upper half.
return recursiveSearch(mid,aHigh,aNeedle,aHaystack,aCompare,aBias);}// The exact needle element was not found in this haystack. Determine if
// we are in termination case (3) or (2) and return the appropriate thing.
if(aBias==exports$8.LEAST_UPPER_BOUND){return aHigh<aHaystack.length?aHigh:-1;}else{return mid;}}else{// Our needle is less than aHaystack[mid].
if(mid-aLow>1){// The element is in the lower half.
return recursiveSearch(aLow,mid,aNeedle,aHaystack,aCompare,aBias);}// we are in termination case (3) or (2) and return the appropriate thing.
if(aBias==exports$8.LEAST_UPPER_BOUND){return mid;}else{return aLow<0?-1:aLow;}}}/**
 * This is an implementation of binary search which will always try and return
 * the index of the closest element if there is no exact hit. This is because
 * mappings between original and generated line/col pairs are single points,
 * and there is an implicit region between each of them, so a miss just means
 * that you aren't on the very start of a region.
 *
 * @param aNeedle The element you are looking for.
 * @param aHaystack The array that is being searched.
 * @param aCompare A function which takes the needle and an element in the
 *     array and returns -1, 0, or 1 depending on whether the needle is less
 *     than, equal to, or greater than the element, respectively.
 * @param aBias Either 'binarySearch.GREATEST_LOWER_BOUND' or
 *     'binarySearch.LEAST_UPPER_BOUND'. Specifies whether to return the
 *     closest element that is smaller than or greater than the one we are
 *     searching for, respectively, if the exact element cannot be found.
 *     Defaults to 'binarySearch.GREATEST_LOWER_BOUND'.
 */exports$8.search=function search(aNeedle,aHaystack,aCompare,aBias){if(aHaystack.length===0){return-1;}var index=recursiveSearch(-1,aHaystack.length,aNeedle,aHaystack,aCompare,aBias||exports$8.GREATEST_LOWER_BOUND);if(index<0){return-1;}// We have found either the exact element, or the next-closest element than
// the one we are searching for. However, there may be more than one such
// element. Make sure we always return the smallest of these.
while(index-1>=0){if(aCompare(aHaystack[index],aHaystack[index-1],true)!==0){break;}--index;}return index;};var exports$1$5={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */ // It turns out that some (most?) JavaScript engines don't self-host
// `Array.prototype.sort`. This makes sense because C++ will likely remain
// faster than JS when doing raw CPU-intensive sorting. However, when using a
// custom comparator function, calling back and forth between the VM's C++ and
// JIT'd JS is rather slow *and* loses JIT type information, resulting in
// worse generated code for the comparator function than would be optimal. In
// fact, when sorting with a comparator, these costs outweigh the benefits of
// sorting in C++. By using our own JS-implemented Quick Sort (below), we get
// a ~3500ms mean speed-up in `bench/bench.html`.
/**
 * Swap the elements indexed by `x` and `y` in the array `ary`.
 *
 * @param {Array} ary
 *        The array.
 * @param {Number} x
 *        The index of the first item.
 * @param {Number} y
 *        The index of the second item.
 */function swap$1(ary,x,y){var temp=ary[x];ary[x]=ary[y];ary[y]=temp;}/**
 * Returns a random integer within the range `low .. high` inclusive.
 *
 * @param {Number} low
 *        The lower bound on the range.
 * @param {Number} high
 *        The upper bound on the range.
 */function randomIntInRange(low,high){return Math.round(low+Math.random()*(high-low));}/**
 * The Quick Sort algorithm.
 *
 * @param {Array} ary
 *        An array to sort.
 * @param {function} comparator
 *        Function to use to compare two items.
 * @param {Number} p
 *        Start index of the array
 * @param {Number} r
 *        End index of the array
 */function doQuickSort(ary,comparator,p,r){// If our lower bound is less than our upper bound, we (1) partition the
// array into two pieces and (2) recurse on each half. If it is not, this is
// the empty array and our base case.
if(p<r){// (1) Partitioning.
//
// The partitioning chooses a pivot between `p` and `r` and moves all
// elements that are less than or equal to the pivot to the before it, and
// all the elements that are greater than it after it. The effect is that
// once partition is done, the pivot is in the exact place it will be when
// the array is put in sorted order, and it will not need to be moved
// again. This runs in O(n) time.
// Always choose a random pivot so that an input array which is reverse
// sorted does not cause O(n^2) running time.
var pivotIndex=randomIntInRange(p,r);var i=p-1;swap$1(ary,pivotIndex,r);var pivot=ary[r];// Immediately after `j` is incremented in this loop, the following hold
// true:
//
//   * Every element in `ary[p .. i]` is less than or equal to the pivot.
//
//   * Every element in `ary[i+1 .. j-1]` is greater than the pivot.
for(var j=p;j<r;j++){if(comparator(ary[j],pivot)<=0){i+=1;swap$1(ary,i,j);}}swap$1(ary,i+1,j);var q=i+1;// (2) Recurse on each half.
doQuickSort(ary,comparator,p,q-1);doQuickSort(ary,comparator,q+1,r);}}/**
 * Sort the given array in-place with the given comparator function.
 *
 * @param {Array} ary
 *        An array to sort.
 * @param {function} comparator
 *        Function to use to compare two items.
 */exports$1$5.quickSort=function(ary,comparator){doQuickSort(ary,comparator,0,ary.length-1);};var _global$3=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$2$3={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */var util$2=exports$5;var binarySearch=exports$8;var ArraySet$2=exports$2$2.ArraySet;var base64VLQ$1=exports$1$3;var quickSort=exports$1$5.quickSort;function SourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=util$2.parseSourceMapInput(aSourceMap);}return sourceMap.sections!=null?new IndexedSourceMapConsumer(sourceMap,aSourceMapURL):new BasicSourceMapConsumer(sourceMap,aSourceMapURL);}SourceMapConsumer.fromSourceMap=function(aSourceMap,aSourceMapURL){return BasicSourceMapConsumer.fromSourceMap(aSourceMap,aSourceMapURL);};/**
 * The version of the source mapping spec that we are consuming.
 */SourceMapConsumer.prototype._version=3;// `__generatedMappings` and `__originalMappings` are arrays that hold the
// parsed mapping coordinates from the source map's "mappings" attribute. They
// are lazily instantiated, accessed via the `_generatedMappings` and
// `_originalMappings` getters respectively, and we only parse the mappings
// and create these arrays once queried for a source location. We jump through
// these hoops because there can be many thousands of mappings, and parsing
// them is expensive, so we only want to do it if we must.
//
// Each object in the arrays is of the form:
//
//     {
//       generatedLine: The line number in the generated code,
//       generatedColumn: The column number in the generated code,
//       source: The path to the original source file that generated this
//               chunk of code,
//       originalLine: The line number in the original source that
//                     corresponds to this chunk of generated code,
//       originalColumn: The column number in the original source that
//                       corresponds to this chunk of generated code,
//       name: The name of the original symbol which generated this chunk of
//             code.
//     }
//
// All properties except for `generatedLine` and `generatedColumn` can be
// `null`.
//
// `_generatedMappings` is ordered by the generated positions.
//
// `_originalMappings` is ordered by the original positions.
SourceMapConsumer.prototype.__generatedMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{configurable:true,enumerable:true,get:function get(){if(!(this||_global$3).__generatedMappings){this._parseMappings((this||_global$3)._mappings,(this||_global$3).sourceRoot);}return(this||_global$3).__generatedMappings;}});SourceMapConsumer.prototype.__originalMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{configurable:true,enumerable:true,get:function get(){if(!(this||_global$3).__originalMappings){this._parseMappings((this||_global$3)._mappings,(this||_global$3).sourceRoot);}return(this||_global$3).__originalMappings;}});SourceMapConsumer.prototype._charIsMappingSeparator=function SourceMapConsumer_charIsMappingSeparator(aStr,index){var c=aStr.charAt(index);return c===";"||c===",";};/**
 * Parse the mappings in a string in to a data structure which we can easily
 * query (the ordered arrays in the `this.__generatedMappings` and
 * `this.__originalMappings` properties).
 */SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){throw new Error("Subclasses must implement _parseMappings");};SourceMapConsumer.GENERATED_ORDER=1;SourceMapConsumer.ORIGINAL_ORDER=2;SourceMapConsumer.GREATEST_LOWER_BOUND=1;SourceMapConsumer.LEAST_UPPER_BOUND=2;/**
 * Iterate over each mapping between an original source/line/column and a
 * generated line/column in this source map.
 *
 * @param Function aCallback
 *        The function that is called with each mapping.
 * @param Object aContext
 *        Optional. If specified, this object will be the value of `this` every
 *        time that `aCallback` is called.
 * @param aOrder
 *        Either `SourceMapConsumer.GENERATED_ORDER` or
 *        `SourceMapConsumer.ORIGINAL_ORDER`. Specifies whether you want to
 *        iterate over the mappings sorted by the generated file's line/column
 *        order or the original's source/line/column order, respectively. Defaults to
 *        `SourceMapConsumer.GENERATED_ORDER`.
 */SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(aCallback,aContext,aOrder){var context=aContext||null;var order=aOrder||SourceMapConsumer.GENERATED_ORDER;var mappings;switch(order){case SourceMapConsumer.GENERATED_ORDER:mappings=(this||_global$3)._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=(this||_global$3)._originalMappings;break;default:throw new Error("Unknown order of iteration.");}var sourceRoot=(this||_global$3).sourceRoot;mappings.map(function(mapping){var source=mapping.source===null?null:(this||_global$3)._sources.at(mapping.source);source=util$2.computeSourceURL(sourceRoot,source,(this||_global$3)._sourceMapURL);return{source:source,generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name===null?null:(this||_global$3)._names.at(mapping.name)};},this||_global$3).forEach(aCallback,context);};/**
 * Returns all generated line and column information for the original source,
 * line, and column provided. If no column is provided, returns all mappings
 * corresponding to a either the line we are searching for or the next
 * closest line that has any mappings. Otherwise, returns all mappings
 * corresponding to the given line and either the column we are searching for
 * or the next closest column that has any offsets.
 *
 * The only argument is an object with the following properties:
 *
 *   - source: The filename of the original source.
 *   - line: The line number in the original source.  The line number is 1-based.
 *   - column: Optional. the column number in the original source.
 *    The column number is 0-based.
 *
 * and an array of objects is returned, each with the following properties:
 *
 *   - line: The line number in the generated source, or null.  The
 *    line number is 1-based.
 *   - column: The column number in the generated source, or null.
 *    The column number is 0-based.
 */SourceMapConsumer.prototype.allGeneratedPositionsFor=function SourceMapConsumer_allGeneratedPositionsFor(aArgs){var line=util$2.getArg(aArgs,"line");// When there is no exact match, BasicSourceMapConsumer.prototype._findMapping
// returns the index of the closest mapping less than the needle. By
// setting needle.originalColumn to 0, we thus find the last mapping for
// the given line, provided such a mapping exists.
var needle={source:util$2.getArg(aArgs,"source"),originalLine:line,originalColumn:util$2.getArg(aArgs,"column",0)};needle.source=this._findSourceIndex(needle.source);if(needle.source<0){return[];}var mappings=[];var index=this._findMapping(needle,(this||_global$3)._originalMappings,"originalLine","originalColumn",util$2.compareByOriginalPositions,binarySearch.LEAST_UPPER_BOUND);if(index>=0){var mapping=(this||_global$3)._originalMappings[index];if(aArgs.column===undefined){var originalLine=mapping.originalLine;// Iterate until either we run out of mappings, or we run into
// a mapping for a different line than the one we found. Since
// mappings are sorted, this is guaranteed to find all mappings for
// the line we found.
while(mapping&&mapping.originalLine===originalLine){mappings.push({line:util$2.getArg(mapping,"generatedLine",null),column:util$2.getArg(mapping,"generatedColumn",null),lastColumn:util$2.getArg(mapping,"lastGeneratedColumn",null)});mapping=(this||_global$3)._originalMappings[++index];}}else{var originalColumn=mapping.originalColumn;// Iterate until either we run out of mappings, or we run into
// a mapping for a different line than the one we were searching for.
// Since mappings are sorted, this is guaranteed to find all mappings for
// the line we are searching for.
while(mapping&&mapping.originalLine===line&&mapping.originalColumn==originalColumn){mappings.push({line:util$2.getArg(mapping,"generatedLine",null),column:util$2.getArg(mapping,"generatedColumn",null),lastColumn:util$2.getArg(mapping,"lastGeneratedColumn",null)});mapping=(this||_global$3)._originalMappings[++index];}}}return mappings;};exports$2$3.SourceMapConsumer=SourceMapConsumer;/**
 * A BasicSourceMapConsumer instance represents a parsed source map which we can
 * query for information about the original file positions by giving it a file
 * position in the generated source.
 *
 * The first parameter is the raw source map (either as a JSON string, or
 * already parsed to an object). According to the spec, source maps have the
 * following attributes:
 *
 *   - version: Which version of the source map spec this map is following.
 *   - sources: An array of URLs to the original source files.
 *   - names: An array of identifiers which can be referrenced by individual mappings.
 *   - sourceRoot: Optional. The URL root from which all sources are relative.
 *   - sourcesContent: Optional. An array of contents of the original source files.
 *   - mappings: A string of base64 VLQs which contain the actual mappings.
 *   - file: Optional. The generated file this source map is associated with.
 *
 * Here is an example source map, taken from the source map spec[0]:
 *
 *     {
 *       version : 3,
 *       file: "out.js",
 *       sourceRoot : "",
 *       sources: ["foo.js", "bar.js"],
 *       names: ["src", "maps", "are", "fun"],
 *       mappings: "AA,AB;;ABCDE;"
 *     }
 *
 * The second parameter, if given, is a string whose value is the URL
 * at which the source map was found.  This URL is used to compute the
 * sources array.
 *
 * [0]: https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit?pli=1#
 */function BasicSourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=util$2.parseSourceMapInput(aSourceMap);}var version=util$2.getArg(sourceMap,"version");var sources=util$2.getArg(sourceMap,"sources");// Sass 3.3 leaves out the 'names' array, so we deviate from the spec (which
// requires the array) to play nice here.
var names=util$2.getArg(sourceMap,"names",[]);var sourceRoot=util$2.getArg(sourceMap,"sourceRoot",null);var sourcesContent=util$2.getArg(sourceMap,"sourcesContent",null);var mappings=util$2.getArg(sourceMap,"mappings");var file=util$2.getArg(sourceMap,"file",null);// Once again, Sass deviates from the spec and supplies the version as a
// string rather than a number, so we use loose equality checking here.
if(version!=(this||_global$3)._version){throw new Error("Unsupported version: "+version);}if(sourceRoot){sourceRoot=util$2.normalize(sourceRoot);}sources=sources.map(String)// Some source maps produce relative source paths like "./foo.js" instead of
// "foo.js".  Normalize these first so that future comparisons will succeed.
// See bugzil.la/1090768.
.map(util$2.normalize)// Always ensure that absolute sources are internally stored relative to
// the source root, if the source root is absolute. Not doing this would
// be particularly problematic when the source root is a prefix of the
// source (valid, but why??). See github issue #199 and bugzil.la/1188982.
.map(function(source){return sourceRoot&&util$2.isAbsolute(sourceRoot)&&util$2.isAbsolute(source)?util$2.relative(sourceRoot,source):source;});// Pass `true` below to allow duplicate names and sources. While source maps
// are intended to be compressed and deduplicated, the TypeScript compiler
// sometimes generates source maps with duplicates in them. See Github issue
// #72 and bugzil.la/889492.
(this||_global$3)._names=ArraySet$2.fromArray(names.map(String),true);(this||_global$3)._sources=ArraySet$2.fromArray(sources,true);(this||_global$3)._absoluteSources=(this||_global$3)._sources.toArray().map(function(s){return util$2.computeSourceURL(sourceRoot,s,aSourceMapURL);});(this||_global$3).sourceRoot=sourceRoot;(this||_global$3).sourcesContent=sourcesContent;(this||_global$3)._mappings=mappings;(this||_global$3)._sourceMapURL=aSourceMapURL;(this||_global$3).file=file;}BasicSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer;/**
 * Utility function to find the index of a source.  Returns -1 if not
 * found.
 */BasicSourceMapConsumer.prototype._findSourceIndex=function(aSource){var relativeSource=aSource;if((this||_global$3).sourceRoot!=null){relativeSource=util$2.relative((this||_global$3).sourceRoot,relativeSource);}if((this||_global$3)._sources.has(relativeSource)){return(this||_global$3)._sources.indexOf(relativeSource);}// Maybe aSource is an absolute URL as returned by |sources|.  In
// this case we can't simply undo the transform.
var i;for(i=0;i<(this||_global$3)._absoluteSources.length;++i){if((this||_global$3)._absoluteSources[i]==aSource){return i;}}return-1;};/**
 * Create a BasicSourceMapConsumer from a SourceMapGenerator.
 *
 * @param SourceMapGenerator aSourceMap
 *        The source map that will be consumed.
 * @param String aSourceMapURL
 *        The URL at which the source map can be found (optional)
 * @returns BasicSourceMapConsumer
 */BasicSourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(aSourceMap,aSourceMapURL){var smc=Object.create(BasicSourceMapConsumer.prototype);var names=smc._names=ArraySet$2.fromArray(aSourceMap._names.toArray(),true);var sources=smc._sources=ArraySet$2.fromArray(aSourceMap._sources.toArray(),true);smc.sourceRoot=aSourceMap._sourceRoot;smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot);smc.file=aSourceMap._file;smc._sourceMapURL=aSourceMapURL;smc._absoluteSources=smc._sources.toArray().map(function(s){return util$2.computeSourceURL(smc.sourceRoot,s,aSourceMapURL);});// Because we are modifying the entries (by converting string sources and
// names to indices into the sources and names ArraySets), we have to make
// a copy of the entry or else bad things happen. Shared mutable state
// strikes again! See github issue #191.
var generatedMappings=aSourceMap._mappings.toArray().slice();var destGeneratedMappings=smc.__generatedMappings=[];var destOriginalMappings=smc.__originalMappings=[];for(var i=0,length=generatedMappings.length;i<length;i++){var srcMapping=generatedMappings[i];var destMapping=new Mapping();destMapping.generatedLine=srcMapping.generatedLine;destMapping.generatedColumn=srcMapping.generatedColumn;if(srcMapping.source){destMapping.source=sources.indexOf(srcMapping.source);destMapping.originalLine=srcMapping.originalLine;destMapping.originalColumn=srcMapping.originalColumn;if(srcMapping.name){destMapping.name=names.indexOf(srcMapping.name);}destOriginalMappings.push(destMapping);}destGeneratedMappings.push(destMapping);}quickSort(smc.__originalMappings,util$2.compareByOriginalPositions);return smc;};/**
 * The version of the source mapping spec that we are consuming.
 */BasicSourceMapConsumer.prototype._version=3;/**
 * The list of original sources.
 */Object.defineProperty(BasicSourceMapConsumer.prototype,"sources",{get:function get(){return(this||_global$3)._absoluteSources.slice();}});/**
 * Provide the JIT with a nice shape / hidden class.
 */function Mapping(){(this||_global$3).generatedLine=0;(this||_global$3).generatedColumn=0;(this||_global$3).source=null;(this||_global$3).originalLine=null;(this||_global$3).originalColumn=null;(this||_global$3).name=null;}/**
 * Parse the mappings in a string in to a data structure which we can easily
 * query (the ordered arrays in the `this.__generatedMappings` and
 * `this.__originalMappings` properties).
 */BasicSourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){var generatedLine=1;var previousGeneratedColumn=0;var previousOriginalLine=0;var previousOriginalColumn=0;var previousSource=0;var previousName=0;var length=aStr.length;var index=0;var cachedSegments={};var temp={};var originalMappings=[];var generatedMappings=[];var mapping,str,segment,end,value;while(index<length){if(aStr.charAt(index)===";"){generatedLine++;index++;previousGeneratedColumn=0;}else if(aStr.charAt(index)===","){index++;}else{mapping=new Mapping();mapping.generatedLine=generatedLine;// Because each offset is encoded relative to the previous one,
// many segments often have the same encoding. We can exploit this
// fact by caching the parsed variable length fields of each segment,
// allowing us to avoid a second parse if we encounter the same
// segment again.
for(end=index;end<length;end++){if(this._charIsMappingSeparator(aStr,end)){break;}}str=aStr.slice(index,end);segment=cachedSegments[str];if(segment){index+=str.length;}else{segment=[];while(index<end){base64VLQ$1.decode(aStr,index,temp);value=temp.value;index=temp.rest;segment.push(value);}if(segment.length===2){throw new Error("Found a source, but no line and column");}if(segment.length===3){throw new Error("Found a source and line, but no column");}cachedSegments[str]=segment;}// Generated column.
mapping.generatedColumn=previousGeneratedColumn+segment[0];previousGeneratedColumn=mapping.generatedColumn;if(segment.length>1){// Original source.
mapping.source=previousSource+segment[1];previousSource+=segment[1];// Original line.
mapping.originalLine=previousOriginalLine+segment[2];previousOriginalLine=mapping.originalLine;// Lines are stored 0-based
mapping.originalLine+=1;// Original column.
mapping.originalColumn=previousOriginalColumn+segment[3];previousOriginalColumn=mapping.originalColumn;if(segment.length>4){// Original name.
mapping.name=previousName+segment[4];previousName+=segment[4];}}generatedMappings.push(mapping);if(typeof mapping.originalLine==="number"){originalMappings.push(mapping);}}}quickSort(generatedMappings,util$2.compareByGeneratedPositionsDeflated);(this||_global$3).__generatedMappings=generatedMappings;quickSort(originalMappings,util$2.compareByOriginalPositions);(this||_global$3).__originalMappings=originalMappings;};/**
 * Find the mapping that best matches the hypothetical "needle" mapping that
 * we are searching for in the given "haystack" of mappings.
 */BasicSourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(aNeedle,aMappings,aLineName,aColumnName,aComparator,aBias){// To return the position we are searching for, we must first find the
// mapping for the given position and then return the opposite position it
// points to. Because the mappings are sorted, we can use binary search to
// find the best mapping.
if(aNeedle[aLineName]<=0){throw new TypeError("Line must be greater than or equal to 1, got "+aNeedle[aLineName]);}if(aNeedle[aColumnName]<0){throw new TypeError("Column must be greater than or equal to 0, got "+aNeedle[aColumnName]);}return binarySearch.search(aNeedle,aMappings,aComparator,aBias);};/**
 * Compute the last column for each generated mapping. The last column is
 * inclusive.
 */BasicSourceMapConsumer.prototype.computeColumnSpans=function SourceMapConsumer_computeColumnSpans(){for(var index=0;index<(this||_global$3)._generatedMappings.length;++index){var mapping=(this||_global$3)._generatedMappings[index];// Mappings do not contain a field for the last generated columnt. We
// can come up with an optimistic estimate, however, by assuming that
// mappings are contiguous (i.e. given two consecutive mappings, the
// first mapping ends where the second one starts).
if(index+1<(this||_global$3)._generatedMappings.length){var nextMapping=(this||_global$3)._generatedMappings[index+1];if(mapping.generatedLine===nextMapping.generatedLine){mapping.lastGeneratedColumn=nextMapping.generatedColumn-1;continue;}}// The last mapping for each line spans the entire line.
mapping.lastGeneratedColumn=Infinity;}};/**
 * Returns the original source, line, and column information for the generated
 * source's line and column positions provided. The only argument is an object
 * with the following properties:
 *
 *   - line: The line number in the generated source.  The line number
 *     is 1-based.
 *   - column: The column number in the generated source.  The column
 *     number is 0-based.
 *   - bias: Either 'SourceMapConsumer.GREATEST_LOWER_BOUND' or
 *     'SourceMapConsumer.LEAST_UPPER_BOUND'. Specifies whether to return the
 *     closest element that is smaller than or greater than the one we are
 *     searching for, respectively, if the exact element cannot be found.
 *     Defaults to 'SourceMapConsumer.GREATEST_LOWER_BOUND'.
 *
 * and an object is returned with the following properties:
 *
 *   - source: The original source file, or null.
 *   - line: The line number in the original source, or null.  The
 *     line number is 1-based.
 *   - column: The column number in the original source, or null.  The
 *     column number is 0-based.
 *   - name: The original identifier, or null.
 */BasicSourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util$2.getArg(aArgs,"line"),generatedColumn:util$2.getArg(aArgs,"column")};var index=this._findMapping(needle,(this||_global$3)._generatedMappings,"generatedLine","generatedColumn",util$2.compareByGeneratedPositionsDeflated,util$2.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=(this||_global$3)._generatedMappings[index];if(mapping.generatedLine===needle.generatedLine){var source=util$2.getArg(mapping,"source",null);if(source!==null){source=(this||_global$3)._sources.at(source);source=util$2.computeSourceURL((this||_global$3).sourceRoot,source,(this||_global$3)._sourceMapURL);}var name=util$2.getArg(mapping,"name",null);if(name!==null){name=(this||_global$3)._names.at(name);}return{source:source,line:util$2.getArg(mapping,"originalLine",null),column:util$2.getArg(mapping,"originalColumn",null),name:name};}}return{source:null,line:null,column:null,name:null};};/**
 * Return true if we have the source content for every source in the source
 * map, false otherwise.
 */BasicSourceMapConsumer.prototype.hasContentsOfAllSources=function BasicSourceMapConsumer_hasContentsOfAllSources(){if(!(this||_global$3).sourcesContent){return false;}return(this||_global$3).sourcesContent.length>=(this||_global$3)._sources.size()&&!(this||_global$3).sourcesContent.some(function(sc){return sc==null;});};/**
 * Returns the original source content. The only argument is the url of the
 * original source file. Returns null if no original source content is
 * available.
 */BasicSourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(aSource,nullOnMissing){if(!(this||_global$3).sourcesContent){return null;}var index=this._findSourceIndex(aSource);if(index>=0){return(this||_global$3).sourcesContent[index];}var relativeSource=aSource;if((this||_global$3).sourceRoot!=null){relativeSource=util$2.relative((this||_global$3).sourceRoot,relativeSource);}var url;if((this||_global$3).sourceRoot!=null&&(url=util$2.urlParse((this||_global$3).sourceRoot))){// XXX: file:// URIs and absolute paths lead to unexpected behavior for
// many users. We can help them out when they expect file:// URIs to
// behave like it would if they were running a local HTTP server. See
// https://bugzilla.mozilla.org/show_bug.cgi?id=885597.
var fileUriAbsPath=relativeSource.replace(/^file:\/\//,"");if(url.scheme=="file"&&(this||_global$3)._sources.has(fileUriAbsPath)){return(this||_global$3).sourcesContent[(this||_global$3)._sources.indexOf(fileUriAbsPath)];}if((!url.path||url.path=="/")&&(this||_global$3)._sources.has("/"+relativeSource)){return(this||_global$3).sourcesContent[(this||_global$3)._sources.indexOf("/"+relativeSource)];}}// This function is used recursively from
// IndexedSourceMapConsumer.prototype.sourceContentFor. In that case, we
// don't want to throw if we can't find the source - we just want to
// return null, so we provide a flag to exit gracefully.
if(nullOnMissing){return null;}else{throw new Error("\""+relativeSource+"\" is not in the SourceMap.");}};/**
 * Returns the generated line and column information for the original source,
 * line, and column positions provided. The only argument is an object with
 * the following properties:
 *
 *   - source: The filename of the original source.
 *   - line: The line number in the original source.  The line number
 *     is 1-based.
 *   - column: The column number in the original source.  The column
 *     number is 0-based.
 *   - bias: Either 'SourceMapConsumer.GREATEST_LOWER_BOUND' or
 *     'SourceMapConsumer.LEAST_UPPER_BOUND'. Specifies whether to return the
 *     closest element that is smaller than or greater than the one we are
 *     searching for, respectively, if the exact element cannot be found.
 *     Defaults to 'SourceMapConsumer.GREATEST_LOWER_BOUND'.
 *
 * and an object is returned with the following properties:
 *
 *   - line: The line number in the generated source, or null.  The
 *     line number is 1-based.
 *   - column: The column number in the generated source, or null.
 *     The column number is 0-based.
 */BasicSourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(aArgs){var source=util$2.getArg(aArgs,"source");source=this._findSourceIndex(source);if(source<0){return{line:null,column:null,lastColumn:null};}var needle={source:source,originalLine:util$2.getArg(aArgs,"line"),originalColumn:util$2.getArg(aArgs,"column")};var index=this._findMapping(needle,(this||_global$3)._originalMappings,"originalLine","originalColumn",util$2.compareByOriginalPositions,util$2.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=(this||_global$3)._originalMappings[index];if(mapping.source===needle.source){return{line:util$2.getArg(mapping,"generatedLine",null),column:util$2.getArg(mapping,"generatedColumn",null),lastColumn:util$2.getArg(mapping,"lastGeneratedColumn",null)};}}return{line:null,column:null,lastColumn:null};};exports$2$3.BasicSourceMapConsumer=BasicSourceMapConsumer;/**
 * An IndexedSourceMapConsumer instance represents a parsed source map which
 * we can query for information. It differs from BasicSourceMapConsumer in
 * that it takes "indexed" source maps (i.e. ones with a "sections" field) as
 * input.
 *
 * The first parameter is a raw source map (either as a JSON string, or already
 * parsed to an object). According to the spec for indexed source maps, they
 * have the following attributes:
 *
 *   - version: Which version of the source map spec this map is following.
 *   - file: Optional. The generated file this source map is associated with.
 *   - sections: A list of section definitions.
 *
 * Each value under the "sections" field has two fields:
 *   - offset: The offset into the original specified at which this section
 *       begins to apply, defined as an object with a "line" and "column"
 *       field.
 *   - map: A source map definition. This source map could also be indexed,
 *       but doesn't have to be.
 *
 * Instead of the "map" field, it's also possible to have a "url" field
 * specifying a URL to retrieve a source map from, but that's currently
 * unsupported.
 *
 * Here's an example source map, taken from the source map spec[0], but
 * modified to omit a section which uses the "url" field.
 *
 *  {
 *    version : 3,
 *    file: "app.js",
 *    sections: [{
 *      offset: {line:100, column:10},
 *      map: {
 *        version : 3,
 *        file: "section.js",
 *        sources: ["foo.js", "bar.js"],
 *        names: ["src", "maps", "are", "fun"],
 *        mappings: "AAAA,E;;ABCDE;"
 *      }
 *    }],
 *  }
 *
 * The second parameter, if given, is a string whose value is the URL
 * at which the source map was found.  This URL is used to compute the
 * sources array.
 *
 * [0]: https://docs.google.com/document/d/1U1RGAehQwRypUTovF1KRlpiOFze0b-_2gc6fAH0KY0k/edit#heading=h.535es3xeprgt
 */function IndexedSourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=util$2.parseSourceMapInput(aSourceMap);}var version=util$2.getArg(sourceMap,"version");var sections=util$2.getArg(sourceMap,"sections");if(version!=(this||_global$3)._version){throw new Error("Unsupported version: "+version);}(this||_global$3)._sources=new ArraySet$2();(this||_global$3)._names=new ArraySet$2();var lastOffset={line:-1,column:0};(this||_global$3)._sections=sections.map(function(s){if(s.url){// The url field will require support for asynchronicity.
// See https://github.com/mozilla/source-map/issues/16
throw new Error("Support for url field in sections not implemented.");}var offset=util$2.getArg(s,"offset");var offsetLine=util$2.getArg(offset,"line");var offsetColumn=util$2.getArg(offset,"column");if(offsetLine<lastOffset.line||offsetLine===lastOffset.line&&offsetColumn<lastOffset.column){throw new Error("Section offsets must be ordered and non-overlapping.");}lastOffset=offset;return{generatedOffset:{// The offset fields are 0-based, but we use 1-based indices when
// encoding/decoding from VLQ.
generatedLine:offsetLine+1,generatedColumn:offsetColumn+1},consumer:new SourceMapConsumer(util$2.getArg(s,"map"),aSourceMapURL)};});}IndexedSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);IndexedSourceMapConsumer.prototype.constructor=SourceMapConsumer;/**
 * The version of the source mapping spec that we are consuming.
 */IndexedSourceMapConsumer.prototype._version=3;/**
 * The list of original sources.
 */Object.defineProperty(IndexedSourceMapConsumer.prototype,"sources",{get:function get(){var sources=[];for(var i=0;i<(this||_global$3)._sections.length;i++){for(var j=0;j<(this||_global$3)._sections[i].consumer.sources.length;j++){sources.push((this||_global$3)._sections[i].consumer.sources[j]);}}return sources;}});/**
 * Returns the original source, line, and column information for the generated
 * source's line and column positions provided. The only argument is an object
 * with the following properties:
 *
 *   - line: The line number in the generated source.  The line number
 *     is 1-based.
 *   - column: The column number in the generated source.  The column
 *     number is 0-based.
 *
 * and an object is returned with the following properties:
 *
 *   - source: The original source file, or null.
 *   - line: The line number in the original source, or null.  The
 *     line number is 1-based.
 *   - column: The column number in the original source, or null.  The
 *     column number is 0-based.
 *   - name: The original identifier, or null.
 */IndexedSourceMapConsumer.prototype.originalPositionFor=function IndexedSourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util$2.getArg(aArgs,"line"),generatedColumn:util$2.getArg(aArgs,"column")};// Find the section containing the generated position we're trying to map
// to an original position.
var sectionIndex=binarySearch.search(needle,(this||_global$3)._sections,function(needle,section){var cmp=needle.generatedLine-section.generatedOffset.generatedLine;if(cmp){return cmp;}return needle.generatedColumn-section.generatedOffset.generatedColumn;});var section=(this||_global$3)._sections[sectionIndex];if(!section){return{source:null,line:null,column:null,name:null};}return section.consumer.originalPositionFor({line:needle.generatedLine-(section.generatedOffset.generatedLine-1),column:needle.generatedColumn-(section.generatedOffset.generatedLine===needle.generatedLine?section.generatedOffset.generatedColumn-1:0),bias:aArgs.bias});};/**
 * Return true if we have the source content for every source in the source
 * map, false otherwise.
 */IndexedSourceMapConsumer.prototype.hasContentsOfAllSources=function IndexedSourceMapConsumer_hasContentsOfAllSources(){return(this||_global$3)._sections.every(function(s){return s.consumer.hasContentsOfAllSources();});};/**
 * Returns the original source content. The only argument is the url of the
 * original source file. Returns null if no original source content is
 * available.
 */IndexedSourceMapConsumer.prototype.sourceContentFor=function IndexedSourceMapConsumer_sourceContentFor(aSource,nullOnMissing){for(var i=0;i<(this||_global$3)._sections.length;i++){var section=(this||_global$3)._sections[i];var content=section.consumer.sourceContentFor(aSource,true);if(content){return content;}}if(nullOnMissing){return null;}else{throw new Error("\""+aSource+"\" is not in the SourceMap.");}};/**
 * Returns the generated line and column information for the original source,
 * line, and column positions provided. The only argument is an object with
 * the following properties:
 *
 *   - source: The filename of the original source.
 *   - line: The line number in the original source.  The line number
 *     is 1-based.
 *   - column: The column number in the original source.  The column
 *     number is 0-based.
 *
 * and an object is returned with the following properties:
 *
 *   - line: The line number in the generated source, or null.  The
 *     line number is 1-based. 
 *   - column: The column number in the generated source, or null.
 *     The column number is 0-based.
 */IndexedSourceMapConsumer.prototype.generatedPositionFor=function IndexedSourceMapConsumer_generatedPositionFor(aArgs){for(var i=0;i<(this||_global$3)._sections.length;i++){var section=(this||_global$3)._sections[i];// Only consider this section if the requested source is in the list of
// sources of the consumer.
if(section.consumer._findSourceIndex(util$2.getArg(aArgs,"source"))===-1){continue;}var generatedPosition=section.consumer.generatedPositionFor(aArgs);if(generatedPosition){var ret={line:generatedPosition.line+(section.generatedOffset.generatedLine-1),column:generatedPosition.column+(section.generatedOffset.generatedLine===generatedPosition.line?section.generatedOffset.generatedColumn-1:0)};return ret;}}return{line:null,column:null};};/**
 * Parse the mappings in a string in to a data structure which we can easily
 * query (the ordered arrays in the `this.__generatedMappings` and
 * `this.__originalMappings` properties).
 */IndexedSourceMapConsumer.prototype._parseMappings=function IndexedSourceMapConsumer_parseMappings(aStr,aSourceRoot){(this||_global$3).__generatedMappings=[];(this||_global$3).__originalMappings=[];for(var i=0;i<(this||_global$3)._sections.length;i++){var section=(this||_global$3)._sections[i];var sectionMappings=section.consumer._generatedMappings;for(var j=0;j<sectionMappings.length;j++){var mapping=sectionMappings[j];var source=section.consumer._sources.at(mapping.source);source=util$2.computeSourceURL(section.consumer.sourceRoot,source,(this||_global$3)._sourceMapURL);(this||_global$3)._sources.add(source);source=(this||_global$3)._sources.indexOf(source);var name=null;if(mapping.name){name=section.consumer._names.at(mapping.name);(this||_global$3)._names.add(name);name=(this||_global$3)._names.indexOf(name);}// The mappings coming from the consumer for the section have
// generated positions relative to the start of the section, so we
// need to offset them to be relative to the start of the concatenated
// generated file.
var adjustedMapping={source:source,generatedLine:mapping.generatedLine+(section.generatedOffset.generatedLine-1),generatedColumn:mapping.generatedColumn+(section.generatedOffset.generatedLine===mapping.generatedLine?section.generatedOffset.generatedColumn-1:0),originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:name};(this||_global$3).__generatedMappings.push(adjustedMapping);if(typeof adjustedMapping.originalLine==="number"){(this||_global$3).__originalMappings.push(adjustedMapping);}}}quickSort((this||_global$3).__generatedMappings,util$2.compareByGeneratedPositionsDeflated);quickSort((this||_global$3).__originalMappings,util$2.compareByOriginalPositions);};exports$2$3.IndexedSourceMapConsumer=IndexedSourceMapConsumer;var _global$4=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$9={};/* -*- Mode: js; js-indent-level: 2; -*- */ /*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */var SourceMapGenerator$1=exports$1$4.SourceMapGenerator;var util$3=exports$5;// Matches a Windows-style `\r\n` newline or a `\n` newline used by all other
// operating systems these days (capturing the result).
var REGEX_NEWLINE=/(\r?\n)/;// Newline character code for charCodeAt() comparisons
var NEWLINE_CODE=10;// Private symbol for identifying `SourceNode`s when multiple versions of
// the source-map library are loaded. This MUST NOT CHANGE across
// versions!
var isSourceNode="$$$isSourceNode$$$";/**
 * SourceNodes provide a way to abstract over interpolating/concatenating
 * snippets of generated JavaScript source code while maintaining the line and
 * column information associated with the original source code.
 *
 * @param aLine The original line number.
 * @param aColumn The original column number.
 * @param aSource The original source's filename.
 * @param aChunks Optional. An array of strings which are snippets of
 *        generated JS, or other SourceNodes.
 * @param aName The original identifier.
 */function SourceNode(aLine,aColumn,aSource,aChunks,aName){(this||_global$4).children=[];(this||_global$4).sourceContents={};(this||_global$4).line=aLine==null?null:aLine;(this||_global$4).column=aColumn==null?null:aColumn;(this||_global$4).source=aSource==null?null:aSource;(this||_global$4).name=aName==null?null:aName;(this||_global$4)[isSourceNode]=true;if(aChunks!=null)this.add(aChunks);}/**
 * Creates a SourceNode from generated code and a SourceMapConsumer.
 *
 * @param aGeneratedCode The generated code
 * @param aSourceMapConsumer The SourceMap for the generated code
 * @param aRelativePath Optional. The path that relative sources in the
 *        SourceMapConsumer should be relative to.
 */SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(aGeneratedCode,aSourceMapConsumer,aRelativePath){// The SourceNode we want to fill with the generated code
// and the SourceMap
var node=new SourceNode();// All even indices of this array are one line of the generated code,
// while all odd indices are the newlines between two adjacent lines
// (since `REGEX_NEWLINE` captures its match).
// Processed fragments are accessed by calling `shiftNextLine`.
var remainingLines=aGeneratedCode.split(REGEX_NEWLINE);var remainingLinesIndex=0;var shiftNextLine=function shiftNextLine(){var lineContents=getNextLine();// The last line of a file might not have a newline.
var newLine=getNextLine()||"";return lineContents+newLine;function getNextLine(){return remainingLinesIndex<remainingLines.length?remainingLines[remainingLinesIndex++]:undefined;}};// We need to remember the position of "remainingLines"
var lastGeneratedLine=1,lastGeneratedColumn=0;// The generate SourceNodes we need a code range.
// To extract it current and last mapping is used.
// Here we store the last mapping.
var lastMapping=null;aSourceMapConsumer.eachMapping(function(mapping){if(lastMapping!==null){// We add the code from "lastMapping" to "mapping":
// First check if there is a new line in between.
if(lastGeneratedLine<mapping.generatedLine){// Associate first line with "lastMapping"
addMappingWithCode(lastMapping,shiftNextLine());lastGeneratedLine++;lastGeneratedColumn=0;// The remaining code is added without mapping
}else{// There is no new line in between.
// Associate the code between "lastGeneratedColumn" and
// "mapping.generatedColumn" with "lastMapping"
var nextLine=remainingLines[remainingLinesIndex]||"";var code=nextLine.substr(0,mapping.generatedColumn-lastGeneratedColumn);remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn);lastGeneratedColumn=mapping.generatedColumn;addMappingWithCode(lastMapping,code);// No more remaining code, continue
lastMapping=mapping;return;}}// We add the generated code until the first mapping
// to the SourceNode without any mapping.
// Each line is added as separate string.
while(lastGeneratedLine<mapping.generatedLine){node.add(shiftNextLine());lastGeneratedLine++;}if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[remainingLinesIndex]||"";node.add(nextLine.substr(0,mapping.generatedColumn));remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn;}lastMapping=mapping;},this||_global$4);// We have processed all mappings.
if(remainingLinesIndex<remainingLines.length){if(lastMapping){// Associate the remaining code in the current line with "lastMapping"
addMappingWithCode(lastMapping,shiftNextLine());}// and add the remaining lines without any mapping
node.add(remainingLines.splice(remainingLinesIndex).join(""));}// Copy sourcesContent into SourceNode
aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aRelativePath!=null){sourceFile=util$3.join(aRelativePath,sourceFile);}node.setSourceContent(sourceFile,content);}});return node;function addMappingWithCode(mapping,code){if(mapping===null||mapping.source===undefined){node.add(code);}else{var source=aRelativePath?util$3.join(aRelativePath,mapping.source):mapping.source;node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,source,code,mapping.name));}}};/**
 * Add a chunk of generated JS to this source node.
 *
 * @param aChunk A string snippet of generated JS code, another instance of
 *        SourceNode, or an array where each member is one of those things.
 */SourceNode.prototype.add=function SourceNode_add(aChunk){if(Array.isArray(aChunk)){aChunk.forEach(function(chunk){this.add(chunk);},this||_global$4);}else if(aChunk[isSourceNode]||typeof aChunk==="string"){if(aChunk){(this||_global$4).children.push(aChunk);}}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk);}return this||_global$4;};/**
 * Add a chunk of generated JS to the beginning of this source node.
 *
 * @param aChunk A string snippet of generated JS code, another instance of
 *        SourceNode, or an array where each member is one of those things.
 */SourceNode.prototype.prepend=function SourceNode_prepend(aChunk){if(Array.isArray(aChunk)){for(var i=aChunk.length-1;i>=0;i--){this.prepend(aChunk[i]);}}else if(aChunk[isSourceNode]||typeof aChunk==="string"){(this||_global$4).children.unshift(aChunk);}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk);}return this||_global$4;};/**
 * Walk over the tree of JS snippets in this node and its children. The
 * walking function is called once for each snippet of JS and is passed that
 * snippet and the its original associated source's line/column location.
 *
 * @param aFn The traversal function.
 */SourceNode.prototype.walk=function SourceNode_walk(aFn){var chunk;for(var i=0,len=(this||_global$4).children.length;i<len;i++){chunk=(this||_global$4).children[i];if(chunk[isSourceNode]){chunk.walk(aFn);}else{if(chunk!==""){aFn(chunk,{source:(this||_global$4).source,line:(this||_global$4).line,column:(this||_global$4).column,name:(this||_global$4).name});}}}};/**
 * Like `String.prototype.join` except for SourceNodes. Inserts `aStr` between
 * each of `this.children`.
 *
 * @param aSep The separator.
 */SourceNode.prototype.join=function SourceNode_join(aSep){var newChildren;var i;var len=(this||_global$4).children.length;if(len>0){newChildren=[];for(i=0;i<len-1;i++){newChildren.push((this||_global$4).children[i]);newChildren.push(aSep);}newChildren.push((this||_global$4).children[i]);(this||_global$4).children=newChildren;}return this||_global$4;};/**
 * Call String.prototype.replace on the very right-most source snippet. Useful
 * for trimming whitespace from the end of a source node, etc.
 *
 * @param aPattern The pattern to replace.
 * @param aReplacement The thing to replace the pattern with.
 */SourceNode.prototype.replaceRight=function SourceNode_replaceRight(aPattern,aReplacement){var lastChild=(this||_global$4).children[(this||_global$4).children.length-1];if(lastChild[isSourceNode]){lastChild.replaceRight(aPattern,aReplacement);}else if(typeof lastChild==="string"){(this||_global$4).children[(this||_global$4).children.length-1]=lastChild.replace(aPattern,aReplacement);}else{(this||_global$4).children.push("".replace(aPattern,aReplacement));}return this||_global$4;};/**
 * Set the source content for a source file. This will be added to the SourceMapGenerator
 * in the sourcesContent field.
 *
 * @param aSourceFile The filename of the source file
 * @param aSourceContent The content of the source file
 */SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(aSourceFile,aSourceContent){(this||_global$4).sourceContents[util$3.toSetString(aSourceFile)]=aSourceContent;};/**
 * Walk over the tree of SourceNodes. The walking function is called for each
 * source file content and is passed the filename and source content.
 *
 * @param aFn The traversal function.
 */SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(aFn){for(var i=0,len=(this||_global$4).children.length;i<len;i++){if((this||_global$4).children[i][isSourceNode]){(this||_global$4).children[i].walkSourceContents(aFn);}}var sources=Object.keys((this||_global$4).sourceContents);for(var i=0,len=sources.length;i<len;i++){aFn(util$3.fromSetString(sources[i]),(this||_global$4).sourceContents[sources[i]]);}};/**
 * Return the string representation of this source node. Walks over the tree
 * and concatenates all the various snippets together to one string.
 */SourceNode.prototype.toString=function SourceNode_toString(){var str="";this.walk(function(chunk){str+=chunk;});return str;};/**
 * Returns the string representation of this source node along with a source
 * map.
 */SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(aArgs){var generated={code:"",line:1,column:0};var map=new SourceMapGenerator$1(aArgs);var sourceMappingActive=false;var lastOriginalSource=null;var lastOriginalLine=null;var lastOriginalColumn=null;var lastOriginalName=null;this.walk(function(chunk,original){generated.code+=chunk;if(original.source!==null&&original.line!==null&&original.column!==null){if(lastOriginalSource!==original.source||lastOriginalLine!==original.line||lastOriginalColumn!==original.column||lastOriginalName!==original.name){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name});}lastOriginalSource=original.source;lastOriginalLine=original.line;lastOriginalColumn=original.column;lastOriginalName=original.name;sourceMappingActive=true;}else if(sourceMappingActive){map.addMapping({generated:{line:generated.line,column:generated.column}});lastOriginalSource=null;sourceMappingActive=false;}for(var idx=0,length=chunk.length;idx<length;idx++){if(chunk.charCodeAt(idx)===NEWLINE_CODE){generated.line++;generated.column=0;// Mappings end at eol
if(idx+1===length){lastOriginalSource=null;sourceMappingActive=false;}else if(sourceMappingActive){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name});}}else{generated.column++;}}});this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent);});return{code:generated.code,map:map};};exports$9.SourceNode=SourceNode;var exports$1$6={};/*
 * Copyright 2009-2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE.txt or:
 * http://opensource.org/licenses/BSD-3-Clause
 */exports$1$6.SourceMapGenerator=exports$1$4.SourceMapGenerator;exports$1$6.SourceMapConsumer=exports$2$3.SourceMapConsumer;exports$1$6.SourceNode=exports$9.SourceNode;var _package={"name":"escodegen","description":"ECMAScript code generator","homepage":"http://github.com/estools/escodegen","main":"escodegen.js","bin":{"esgenerate":"./bin/esgenerate.js","escodegen":"./bin/escodegen.js"},"files":["LICENSE.BSD","README.md","bin","escodegen.js","package.json"],"version":"2.0.0","engines":{"node":">=6.0"},"maintainers":[{"name":"Yusuke Suzuki","email":"utatane.tea@gmail.com","web":"http://github.com/Constellation"}],"repository":{"type":"git","url":"http://github.com/estools/escodegen.git"},"dependencies":{"estraverse":"^5.2.0","esutils":"^2.0.2","esprima":"^4.0.1","optionator":"^0.8.1"},"optionalDependencies":{"source-map":"~0.6.1"},"devDependencies":{"acorn":"^7.3.1","bluebird":"^3.4.7","bower-registry-client":"^1.0.0","chai":"^4.2.0","chai-exclude":"^2.0.2","commonjs-everywhere":"^0.9.7","gulp":"^3.8.10","gulp-eslint":"^3.0.1","gulp-mocha":"^3.0.1","semver":"^5.1.0"},"license":"BSD-2-Clause","scripts":{"test":"gulp travis","unit-test":"gulp test","lint":"gulp lint","release":"node tools/release.js","build-min":"./node_modules/.bin/cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js","build":"./node_modules/.bin/cjsify -a path: tools/entry-point.js > escodegen.browser.js"}};var _global$5=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var exports$a={};/*
  Copyright (C) 2012-2014 Yusuke Suzuki <utatane.tea@gmail.com>
  Copyright (C) 2015 Ingvar Stepanyan <me@rreverser.com>
  Copyright (C) 2014 Ivan Nikulin <ifaaan@gmail.com>
  Copyright (C) 2012-2013 Michael Ficarra <escodegen.copyright@michael.ficarra.me>
  Copyright (C) 2012-2013 Mathias Bynens <mathias@qiwi.be>
  Copyright (C) 2013 Irakli Gozalishvili <rfobic@gmail.com>
  Copyright (C) 2012 Robert Gust-Bardon <donate@robert.gust-bardon.org>
  Copyright (C) 2012 John Freeman <jfreeman08@gmail.com>
  Copyright (C) 2011-2012 Ariya Hidayat <ariya.hidayat@gmail.com>
  Copyright (C) 2012 Joost-Wim Boekesteijn <joost-wim@boekesteijn.nl>
  Copyright (C) 2012 Kris Kowal <kris.kowal@cixar.com>
  Copyright (C) 2012 Arpad Borsos <arpad.borsos@googlemail.com>

  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are met:

    * Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/ /*global exports:true, require:true, global:true*/(function(){var Syntax,Precedence,BinaryPrecedence,SourceNode,estraverse,esutils,base,indent,json,renumber,hexadecimal,quotes,escapeless,newline,space,parentheses,semicolons,safeConcatenation,directive,extra,parse,sourceMap,sourceCode,preserveBlankLines,FORMAT_MINIFY,FORMAT_DEFAULTS;estraverse=exports$2;esutils=exports$2$1;Syntax=estraverse.Syntax;// Generation is done by generateExpression.
function isExpression(node){return CodeGenerator.Expression.hasOwnProperty(node.type);}// Generation is done by generateStatement.
function isStatement(node){return CodeGenerator.Statement.hasOwnProperty(node.type);}Precedence={Sequence:0,Yield:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Exponentiation:13,Await:14,Unary:14,Postfix:15,OptionalChaining:16,Call:17,New:18,TaggedTemplate:19,Member:20,Primary:21};BinaryPrecedence={"||":Precedence.LogicalOR,"&&":Precedence.LogicalAND,"|":Precedence.BitwiseOR,"^":Precedence.BitwiseXOR,"&":Precedence.BitwiseAND,"==":Precedence.Equality,"!=":Precedence.Equality,"===":Precedence.Equality,"!==":Precedence.Equality,"is":Precedence.Equality,"isnt":Precedence.Equality,"<":Precedence.Relational,">":Precedence.Relational,"<=":Precedence.Relational,">=":Precedence.Relational,"in":Precedence.Relational,"instanceof":Precedence.Relational,"<<":Precedence.BitwiseSHIFT,">>":Precedence.BitwiseSHIFT,">>>":Precedence.BitwiseSHIFT,"+":Precedence.Additive,"-":Precedence.Additive,"*":Precedence.Multiplicative,"%":Precedence.Multiplicative,"/":Precedence.Multiplicative,"**":Precedence.Exponentiation};//Flags
var F_ALLOW_IN=1,F_ALLOW_CALL=1<<1,F_ALLOW_UNPARATH_NEW=1<<2,F_FUNC_BODY=1<<3,F_DIRECTIVE_CTX=1<<4,F_SEMICOLON_OPT=1<<5;//Expression flag sets
//NOTE: Flag order:
// F_ALLOW_IN
// F_ALLOW_CALL
// F_ALLOW_UNPARATH_NEW
var E_FTT=F_ALLOW_CALL|F_ALLOW_UNPARATH_NEW,E_TTF=F_ALLOW_IN|F_ALLOW_CALL,E_TTT=F_ALLOW_IN|F_ALLOW_CALL|F_ALLOW_UNPARATH_NEW,E_TFF=F_ALLOW_IN,E_FFT=F_ALLOW_UNPARATH_NEW,E_TFT=F_ALLOW_IN|F_ALLOW_UNPARATH_NEW;//Statement flag sets
//NOTE: Flag order:
// F_ALLOW_IN
// F_FUNC_BODY
// F_DIRECTIVE_CTX
// F_SEMICOLON_OPT
var S_TFFF=F_ALLOW_IN,S_TFFT=F_ALLOW_IN|F_SEMICOLON_OPT,S_FFFF=0,S_TFTF=F_ALLOW_IN|F_DIRECTIVE_CTX,S_TTFF=F_ALLOW_IN|F_FUNC_BODY;function getDefaultOptions(){// default options
return{indent:null,base:null,parse:null,comment:false,format:{indent:{style:"    ",base:0,adjustMultilineComment:false},newline:"\n",space:" ",json:false,renumber:false,hexadecimal:false,quotes:"single",escapeless:false,compact:false,parentheses:true,semicolons:true,safeConcatenation:false,preserveBlankLines:false},moz:{comprehensionExpressionStartsWithAssignment:false,starlessGenerator:false},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:false,directive:false,raw:true,verbatim:null,sourceCode:null};}function stringRepeat(str,num){var result="";for(num|=0;num>0;num>>>=1,str+=str){if(num&1){result+=str;}}return result;}function hasLineTerminator(str){return /[\r\n]/g.test(str);}function endsWithLineTerminator(str){var len=str.length;return len&&esutils.code.isLineTerminator(str.charCodeAt(len-1));}function merge(target,override){var key;for(key in override){if(override.hasOwnProperty(key)){target[key]=override[key];}}return target;}function updateDeeply(target,override){var key,val;function isHashObject(target){return _typeof2(target)==="object"&&target instanceof Object&&!(target instanceof RegExp);}for(key in override){if(override.hasOwnProperty(key)){val=override[key];if(isHashObject(val)){if(isHashObject(target[key])){updateDeeply(target[key],val);}else{target[key]=updateDeeply({},val);}}else{target[key]=val;}}}return target;}function generateNumber(value){var result,point,temp,exponent,pos;if(value!==value){throw new Error("Numeric literal whose value is NaN");}if(value<0||value===0&&1/value<0){throw new Error("Numeric literal whose value is negative");}if(value===1/0){return json?"null":renumber?"1e400":"1e+400";}result=""+value;if(!renumber||result.length<3){return result;}point=result.indexOf(".");if(!json&&result.charCodeAt(0)===48/* 0 */&&point===1){point=0;result=result.slice(1);}temp=result;result=result.replace("e+","e");exponent=0;if((pos=temp.indexOf("e"))>0){exponent=+temp.slice(pos+1);temp=temp.slice(0,pos);}if(point>=0){exponent-=temp.length-point-1;temp=+(temp.slice(0,point)+temp.slice(point+1))+"";}pos=0;while(temp.charCodeAt(temp.length+pos-1)===48/* 0 */){--pos;}if(pos!==0){exponent-=pos;temp=temp.slice(0,pos);}if(exponent!==0){temp+="e"+exponent;}if((temp.length<result.length||hexadecimal&&value>1000000000000&&Math.floor(value)===value&&(temp="0x"+value.toString(16)).length<result.length)&&+temp===value){result=temp;}return result;}// Generate valid RegExp expression.
// This function is based on https://github.com/Constellation/iv Engine
function escapeRegExpCharacter(ch,previousIsBackslash){// not handling '\' and handling \u2028 or \u2029 to unicode escape sequence
if((ch&~1)===8232){return(previousIsBackslash?"u":"\\u")+(ch===8232?"2028":"2029");}else if(ch===10||ch===13){// \n, \r
return(previousIsBackslash?"":"\\")+(ch===10?"n":"r");}return String.fromCharCode(ch);}function generateRegExp(reg){var match,result,flags,i,iz,ch,characterInBrack,previousIsBackslash;result=reg.toString();if(reg.source){// extract flag from toString result
match=result.match(/\/([^/]*)$/);if(!match){return result;}flags=match[1];result="";characterInBrack=false;previousIsBackslash=false;for(i=0,iz=reg.source.length;i<iz;++i){ch=reg.source.charCodeAt(i);if(!previousIsBackslash){if(characterInBrack){if(ch===93){// ]
characterInBrack=false;}}else{if(ch===47){// /
result+="\\";}else if(ch===91){// [
characterInBrack=true;}}result+=escapeRegExpCharacter(ch,previousIsBackslash);previousIsBackslash=ch===92;// \
}else{// if new RegExp("\\\n') is provided, create /\n/
result+=escapeRegExpCharacter(ch,previousIsBackslash);// prevent like /\\[/]/
previousIsBackslash=false;}}return"/"+result+"/"+flags;}return result;}function escapeAllowedCharacter(code,next){var hex;if(code===8/* \b */){return"\\b";}if(code===12/* \f */){return"\\f";}if(code===9/* \t */){return"\\t";}hex=code.toString(16).toUpperCase();if(json||code>255){return"\\u"+"0000".slice(hex.length)+hex;}else if(code===0&&!esutils.code.isDecimalDigit(next)){return"\\0";}else if(code===11/* \v */){// '\v'
return"\\x0B";}else{return"\\x"+"00".slice(hex.length)+hex;}}function escapeDisallowedCharacter(code){if(code===92/* \ */){return"\\\\";}if(code===10/* \n */){return"\\n";}if(code===13/* \r */){return"\\r";}if(code===8232){return"\\u2028";}if(code===8233){return"\\u2029";}throw new Error("Incorrectly classified character");}function escapeDirective(str){var i,iz,code,quote;quote=quotes==="double"?"\"":"'";for(i=0,iz=str.length;i<iz;++i){code=str.charCodeAt(i);if(code===39/* ' */){quote="\"";break;}else if(code===34/* " */){quote="'";break;}else if(code===92/* \ */){++i;}}return quote+str+quote;}function escapeString(str){var result="",i,len,code,singleQuotes=0,doubleQuotes=0,single,quote;for(i=0,len=str.length;i<len;++i){code=str.charCodeAt(i);if(code===39/* ' */){++singleQuotes;}else if(code===34/* " */){++doubleQuotes;}else if(code===47/* / */&&json){result+="\\";}else if(esutils.code.isLineTerminator(code)||code===92/* \ */){result+=escapeDisallowedCharacter(code);continue;}else if(!esutils.code.isIdentifierPartES5(code)&&(json&&code<32/* SP */||!json&&!escapeless&&(code<32/* SP */||code>126/* ~ */))){result+=escapeAllowedCharacter(code,str.charCodeAt(i+1));continue;}result+=String.fromCharCode(code);}single=!(quotes==="double"||quotes==="auto"&&doubleQuotes<singleQuotes);quote=single?"'":"\"";if(!(single?singleQuotes:doubleQuotes)){return quote+result+quote;}str=result;result=quote;for(i=0,len=str.length;i<len;++i){code=str.charCodeAt(i);if(code===39/* ' */&&single||code===34/* " */&&!single){result+="\\";}result+=String.fromCharCode(code);}return result+quote;}/**
   * flatten an array to a string, where the array can contain
   * either strings or nested arrays
   */function flattenToString(arr){var i,iz,elem,result="";for(i=0,iz=arr.length;i<iz;++i){elem=arr[i];result+=Array.isArray(elem)?flattenToString(elem):elem;}return result;}/**
   * convert generated to a SourceNode when source maps are enabled.
   */function toSourceNodeWhenNeeded(generated,node){if(!sourceMap){// with no source maps, generated is either an
// array or a string.  if an array, flatten it.
// if a string, just return it
if(Array.isArray(generated)){return flattenToString(generated);}else{return generated;}}if(node==null){if(generated instanceof SourceNode){return generated;}else{node={};}}if(node.loc==null){return new SourceNode(null,null,sourceMap,generated,node.name||null);}return new SourceNode(node.loc.start.line,node.loc.start.column,sourceMap===true?node.loc.source||null:sourceMap,generated,node.name||null);}function noEmptySpace(){return space?space:" ";}function join(left,right){var leftSource,rightSource,leftCharCode,rightCharCode;leftSource=toSourceNodeWhenNeeded(left).toString();if(leftSource.length===0){return[right];}rightSource=toSourceNodeWhenNeeded(right).toString();if(rightSource.length===0){return[left];}leftCharCode=leftSource.charCodeAt(leftSource.length-1);rightCharCode=rightSource.charCodeAt(0);if((leftCharCode===43/* + */||leftCharCode===45/* - */)&&leftCharCode===rightCharCode||esutils.code.isIdentifierPartES5(leftCharCode)&&esutils.code.isIdentifierPartES5(rightCharCode)||leftCharCode===47/* / */&&rightCharCode===105/* i */){// infix word operators all start with `i`
return[left,noEmptySpace(),right];}else if(esutils.code.isWhiteSpace(leftCharCode)||esutils.code.isLineTerminator(leftCharCode)||esutils.code.isWhiteSpace(rightCharCode)||esutils.code.isLineTerminator(rightCharCode)){return[left,right];}return[left,space,right];}function addIndent(stmt){return[base,stmt];}function withIndent(fn){var previousBase;previousBase=base;base+=indent;fn(base);base=previousBase;}function calculateSpaces(str){var i;for(i=str.length-1;i>=0;--i){if(esutils.code.isLineTerminator(str.charCodeAt(i))){break;}}return str.length-1-i;}function adjustMultilineComment(value,specialBase){var array,i,len,line,j,spaces,previousBase,sn;array=value.split(/\r\n|[\r\n]/);spaces=Number.MAX_VALUE;// first line doesn't have indentation
for(i=1,len=array.length;i<len;++i){line=array[i];j=0;while(j<line.length&&esutils.code.isWhiteSpace(line.charCodeAt(j))){++j;}if(spaces>j){spaces=j;}}if(typeof specialBase!=="undefined"){// pattern like
// {
//   var t = 20;  /*
//                 * this is comment
//                 */
// }
previousBase=base;if(array[1][spaces]==="*"){specialBase+=" ";}base=specialBase;}else{if(spaces&1){// /*
//  *
//  */
// If spaces are odd number, above pattern is considered.
// We waste 1 space.
--spaces;}previousBase=base;}for(i=1,len=array.length;i<len;++i){sn=toSourceNodeWhenNeeded(addIndent(array[i].slice(spaces)));array[i]=sourceMap?sn.join(""):sn;}base=previousBase;return array.join("\n");}function generateComment(comment,specialBase){if(comment.type==="Line"){if(endsWithLineTerminator(comment.value)){return"//"+comment.value;}else{// Always use LineTerminator
var result="//"+comment.value;if(!preserveBlankLines){result+="\n";}return result;}}if(extra.format.indent.adjustMultilineComment&&/[\n\r]/.test(comment.value)){return adjustMultilineComment("/*"+comment.value+"*/",specialBase);}return"/*"+comment.value+"*/";}function addComments(stmt,result){var i,len,comment,save,tailingToStatement,specialBase,fragment,extRange,range,prevRange,prefix,infix,suffix,count;if(stmt.leadingComments&&stmt.leadingComments.length>0){save=result;if(preserveBlankLines){comment=stmt.leadingComments[0];result=[];extRange=comment.extendedRange;range=comment.range;prefix=sourceCode.substring(extRange[0],range[0]);count=(prefix.match(/\n/g)||[]).length;if(count>0){result.push(stringRepeat("\n",count));result.push(addIndent(generateComment(comment)));}else{result.push(prefix);result.push(generateComment(comment));}prevRange=range;for(i=1,len=stmt.leadingComments.length;i<len;i++){comment=stmt.leadingComments[i];range=comment.range;infix=sourceCode.substring(prevRange[1],range[0]);count=(infix.match(/\n/g)||[]).length;result.push(stringRepeat("\n",count));result.push(addIndent(generateComment(comment)));prevRange=range;}suffix=sourceCode.substring(range[1],extRange[1]);count=(suffix.match(/\n/g)||[]).length;result.push(stringRepeat("\n",count));}else{comment=stmt.leadingComments[0];result=[];if(safeConcatenation&&stmt.type===Syntax.Program&&stmt.body.length===0){result.push("\n");}result.push(generateComment(comment));if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push("\n");}for(i=1,len=stmt.leadingComments.length;i<len;++i){comment=stmt.leadingComments[i];fragment=[generateComment(comment)];if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){fragment.push("\n");}result.push(addIndent(fragment));}}result.push(addIndent(save));}if(stmt.trailingComments){if(preserveBlankLines){comment=stmt.trailingComments[0];extRange=comment.extendedRange;range=comment.range;prefix=sourceCode.substring(extRange[0],range[0]);count=(prefix.match(/\n/g)||[]).length;if(count>0){result.push(stringRepeat("\n",count));result.push(addIndent(generateComment(comment)));}else{result.push(prefix);result.push(generateComment(comment));}}else{tailingToStatement=!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());specialBase=stringRepeat(" ",calculateSpaces(toSourceNodeWhenNeeded([base,result,indent]).toString()));for(i=0,len=stmt.trailingComments.length;i<len;++i){comment=stmt.trailingComments[i];if(tailingToStatement){// We assume target like following script
//
// var t = 20;  /**
//               * This is comment of t
//               */
if(i===0){// first case
result=[result,indent];}else{result=[result,specialBase];}result.push(generateComment(comment,specialBase));}else{result=[result,addIndent(generateComment(comment))];}if(i!==len-1&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result=[result,"\n"];}}}}return result;}function generateBlankLines(start,end,result){var j,newlineCount=0;for(j=start;j<end;j++){if(sourceCode[j]==="\n"){newlineCount++;}}for(j=1;j<newlineCount;j++){result.push(newline);}}function parenthesize(text,current,should){if(current<should){return["(",text,")"];}return text;}function generateVerbatimString(string){var i,iz,result;result=string.split(/\r\n|\n/);for(i=1,iz=result.length;i<iz;i++){result[i]=newline+base+result[i];}return result;}function generateVerbatim(expr,precedence){var verbatim,result,prec;verbatim=expr[extra.verbatim];if(typeof verbatim==="string"){result=parenthesize(generateVerbatimString(verbatim),Precedence.Sequence,precedence);}else{// verbatim is object
result=generateVerbatimString(verbatim.content);prec=verbatim.precedence!=null?verbatim.precedence:Precedence.Sequence;result=parenthesize(result,prec,precedence);}return toSourceNodeWhenNeeded(result,expr);}function CodeGenerator(){}// Helpers.
CodeGenerator.prototype.maybeBlock=function(stmt,flags){var result,noLeadingComment,that=this||_global$5;noLeadingComment=!extra.comment||!stmt.leadingComments;if(stmt.type===Syntax.BlockStatement&&noLeadingComment){return[space,this.generateStatement(stmt,flags)];}if(stmt.type===Syntax.EmptyStatement&&noLeadingComment){return";";}withIndent(function(){result=[newline,addIndent(that.generateStatement(stmt,flags))];});return result;};CodeGenerator.prototype.maybeBlockSuffix=function(stmt,result){var ends=endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());if(stmt.type===Syntax.BlockStatement&&(!extra.comment||!stmt.leadingComments)&&!ends){return[result,space];}if(ends){return[result,base];}return[result,newline,base];};function generateIdentifier(node){return toSourceNodeWhenNeeded(node.name,node);}function generateAsyncPrefix(node,spaceRequired){return node.async?"async"+(spaceRequired?noEmptySpace():space):"";}function generateStarSuffix(node){var isGenerator=node.generator&&!extra.moz.starlessGenerator;return isGenerator?"*"+space:"";}function generateMethodPrefix(prop){var func=prop.value,prefix="";if(func.async){prefix+=generateAsyncPrefix(func,!prop.computed);}if(func.generator){// avoid space before method name
prefix+=generateStarSuffix(func)?"*":"";}return prefix;}CodeGenerator.prototype.generatePattern=function(node,precedence,flags){if(node.type===Syntax.Identifier){return generateIdentifier(node);}return this.generateExpression(node,precedence,flags);};CodeGenerator.prototype.generateFunctionParams=function(node){var i,iz,result,hasDefault;hasDefault=false;if(node.type===Syntax.ArrowFunctionExpression&&!node.rest&&(!node.defaults||node.defaults.length===0)&&node.params.length===1&&node.params[0].type===Syntax.Identifier){// arg => { } case
result=[generateAsyncPrefix(node,true),generateIdentifier(node.params[0])];}else{result=node.type===Syntax.ArrowFunctionExpression?[generateAsyncPrefix(node,false)]:[];result.push("(");if(node.defaults){hasDefault=true;}for(i=0,iz=node.params.length;i<iz;++i){if(hasDefault&&node.defaults[i]){// Handle default values.
result.push(this.generateAssignment(node.params[i],node.defaults[i],"=",Precedence.Assignment,E_TTT));}else{result.push(this.generatePattern(node.params[i],Precedence.Assignment,E_TTT));}if(i+1<iz){result.push(","+space);}}if(node.rest){if(node.params.length){result.push(","+space);}result.push("...");result.push(generateIdentifier(node.rest));}result.push(")");}return result;};CodeGenerator.prototype.generateFunctionBody=function(node){var result,expr;result=this.generateFunctionParams(node);if(node.type===Syntax.ArrowFunctionExpression){result.push(space);result.push("=>");}if(node.expression){result.push(space);expr=this.generateExpression(node.body,Precedence.Assignment,E_TTT);if(expr.toString().charAt(0)==="{"){expr=["(",expr,")"];}result.push(expr);}else{result.push(this.maybeBlock(node.body,S_TTFF));}return result;};CodeGenerator.prototype.generateIterationForStatement=function(operator,stmt,flags){var result=["for"+(stmt["await"]?noEmptySpace()+"await":"")+space+"("],that=this||_global$5;withIndent(function(){if(stmt.left.type===Syntax.VariableDeclaration){withIndent(function(){result.push(stmt.left.kind+noEmptySpace());result.push(that.generateStatement(stmt.left.declarations[0],S_FFFF));});}else{result.push(that.generateExpression(stmt.left,Precedence.Call,E_TTT));}result=join(result,operator);result=[join(result,that.generateExpression(stmt.right,Precedence.Assignment,E_TTT)),")"];});result.push(this.maybeBlock(stmt.body,flags));return result;};CodeGenerator.prototype.generatePropertyKey=function(expr,computed){var result=[];if(computed){result.push("[");}result.push(this.generateExpression(expr,Precedence.Assignment,E_TTT));if(computed){result.push("]");}return result;};CodeGenerator.prototype.generateAssignment=function(left,right,operator,precedence,flags){if(Precedence.Assignment<precedence){flags|=F_ALLOW_IN;}return parenthesize([this.generateExpression(left,Precedence.Call,flags),space+operator+space,this.generateExpression(right,Precedence.Assignment,flags)],Precedence.Assignment,precedence);};CodeGenerator.prototype.semicolon=function(flags){if(!semicolons&&flags&F_SEMICOLON_OPT){return"";}return";";};// Statements.
CodeGenerator.Statement={BlockStatement:function BlockStatement(stmt,flags){var range,content,result=["{",newline],that=this||_global$5;withIndent(function(){// handle functions without any code
if(stmt.body.length===0&&preserveBlankLines){range=stmt.range;if(range[1]-range[0]>2){content=sourceCode.substring(range[0]+1,range[1]-1);if(content[0]==="\n"){result=["{"];}result.push(content);}}var i,iz,fragment,bodyFlags;bodyFlags=S_TFFF;if(flags&F_FUNC_BODY){bodyFlags|=F_DIRECTIVE_CTX;}for(i=0,iz=stmt.body.length;i<iz;++i){if(preserveBlankLines){// handle spaces before the first line
if(i===0){if(stmt.body[0].leadingComments){range=stmt.body[0].leadingComments[0].extendedRange;content=sourceCode.substring(range[0],range[1]);if(content[0]==="\n"){result=["{"];}}if(!stmt.body[0].leadingComments){generateBlankLines(stmt.range[0],stmt.body[0].range[0],result);}}// handle spaces between lines
if(i>0){if(!stmt.body[i-1].trailingComments&&!stmt.body[i].leadingComments){generateBlankLines(stmt.body[i-1].range[1],stmt.body[i].range[0],result);}}}if(i===iz-1){bodyFlags|=F_SEMICOLON_OPT;}if(stmt.body[i].leadingComments&&preserveBlankLines){fragment=that.generateStatement(stmt.body[i],bodyFlags);}else{fragment=addIndent(that.generateStatement(stmt.body[i],bodyFlags));}result.push(fragment);if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){if(preserveBlankLines&&i<iz-1){// don't add a new line if there are leading coments
// in the next statement
if(!stmt.body[i+1].leadingComments){result.push(newline);}}else{result.push(newline);}}if(preserveBlankLines){// handle spaces after the last line
if(i===iz-1){if(!stmt.body[i].trailingComments){generateBlankLines(stmt.body[i].range[1],stmt.range[1],result);}}}}});result.push(addIndent("}"));return result;},BreakStatement:function BreakStatement(stmt,flags){if(stmt.label){return"break "+stmt.label.name+this.semicolon(flags);}return"break"+this.semicolon(flags);},ContinueStatement:function ContinueStatement(stmt,flags){if(stmt.label){return"continue "+stmt.label.name+this.semicolon(flags);}return"continue"+this.semicolon(flags);},ClassBody:function ClassBody(stmt,flags){var result=["{",newline],that=this||_global$5;withIndent(function(indent){var i,iz;for(i=0,iz=stmt.body.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(stmt.body[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(newline);}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline);}result.push(base);result.push("}");return result;},ClassDeclaration:function ClassDeclaration(stmt,flags){var result,fragment;result=["class"];if(stmt.id){result=join(result,this.generateExpression(stmt.id,Precedence.Sequence,E_TTT));}if(stmt.superClass){fragment=join("extends",this.generateExpression(stmt.superClass,Precedence.Unary,E_TTT));result=join(result,fragment);}result.push(space);result.push(this.generateStatement(stmt.body,S_TFFT));return result;},DirectiveStatement:function DirectiveStatement(stmt,flags){if(extra.raw&&stmt.raw){return stmt.raw+this.semicolon(flags);}return escapeDirective(stmt.directive)+this.semicolon(flags);},DoWhileStatement:function DoWhileStatement(stmt,flags){// Because `do 42 while (cond)` is Syntax Error. We need semicolon.
var result=join("do",this.maybeBlock(stmt.body,S_TFFF));result=this.maybeBlockSuffix(stmt.body,result);return join(result,["while"+space+"(",this.generateExpression(stmt.test,Precedence.Sequence,E_TTT),")"+this.semicolon(flags)]);},CatchClause:function CatchClause(stmt,flags){var result,that=this||_global$5;withIndent(function(){var guard;if(stmt.param){result=["catch"+space+"(",that.generateExpression(stmt.param,Precedence.Sequence,E_TTT),")"];if(stmt.guard){guard=that.generateExpression(stmt.guard,Precedence.Sequence,E_TTT);result.splice(2,0," if ",guard);}}else{result=["catch"];}});result.push(this.maybeBlock(stmt.body,S_TFFF));return result;},DebuggerStatement:function DebuggerStatement(stmt,flags){return"debugger"+this.semicolon(flags);},EmptyStatement:function EmptyStatement(stmt,flags){return";";},ExportDefaultDeclaration:function ExportDefaultDeclaration(stmt,flags){var result=["export"],bodyFlags;bodyFlags=flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF;// export default HoistableDeclaration[Default]
// export default AssignmentExpression[In] ;
result=join(result,"default");if(isStatement(stmt.declaration)){result=join(result,this.generateStatement(stmt.declaration,bodyFlags));}else{result=join(result,this.generateExpression(stmt.declaration,Precedence.Assignment,E_TTT)+this.semicolon(flags));}return result;},ExportNamedDeclaration:function ExportNamedDeclaration(stmt,flags){var result=["export"],bodyFlags,that=this||_global$5;bodyFlags=flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF;// export VariableStatement
// export Declaration[Default]
if(stmt.declaration){return join(result,this.generateStatement(stmt.declaration,bodyFlags));}// export ExportClause[NoReference] FromClause ;
// export ExportClause ;
if(stmt.specifiers){if(stmt.specifiers.length===0){result=join(result,"{"+space+"}");}else if(stmt.specifiers[0].type===Syntax.ExportBatchSpecifier){result=join(result,this.generateExpression(stmt.specifiers[0],Precedence.Sequence,E_TTT));}else{result=join(result,"{");withIndent(function(indent){var i,iz;result.push(newline);for(i=0,iz=stmt.specifiers.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(stmt.specifiers[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+newline);}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline);}result.push(base+"}");}if(stmt.source){result=join(result,["from"+space,// ModuleSpecifier
this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)]);}else{result.push(this.semicolon(flags));}}return result;},ExportAllDeclaration:function ExportAllDeclaration(stmt,flags){// export * FromClause ;
return["export"+space,"*"+space,"from"+space,// ModuleSpecifier
this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)];},ExpressionStatement:function ExpressionStatement(stmt,flags){var result,fragment;function isClassPrefixed(fragment){var code;if(fragment.slice(0,5)!=="class"){return false;}code=fragment.charCodeAt(5);return code===123/* '{' */||esutils.code.isWhiteSpace(code)||esutils.code.isLineTerminator(code);}function isFunctionPrefixed(fragment){var code;if(fragment.slice(0,8)!=="function"){return false;}code=fragment.charCodeAt(8);return code===40/* '(' */||esutils.code.isWhiteSpace(code)||code===42/* '*' */||esutils.code.isLineTerminator(code);}function isAsyncPrefixed(fragment){var code,i,iz;if(fragment.slice(0,5)!=="async"){return false;}if(!esutils.code.isWhiteSpace(fragment.charCodeAt(5))){return false;}for(i=6,iz=fragment.length;i<iz;++i){if(!esutils.code.isWhiteSpace(fragment.charCodeAt(i))){break;}}if(i===iz){return false;}if(fragment.slice(i,i+8)!=="function"){return false;}code=fragment.charCodeAt(i+8);return code===40/* '(' */||esutils.code.isWhiteSpace(code)||code===42/* '*' */||esutils.code.isLineTerminator(code);}result=[this.generateExpression(stmt.expression,Precedence.Sequence,E_TTT)];// 12.4 '{', 'function', 'class' is not allowed in this position.
// wrap expression with parentheses
fragment=toSourceNodeWhenNeeded(result).toString();if(fragment.charCodeAt(0)===123/* '{' */||// ObjectExpression
isClassPrefixed(fragment)||isFunctionPrefixed(fragment)||isAsyncPrefixed(fragment)||directive&&flags&F_DIRECTIVE_CTX&&stmt.expression.type===Syntax.Literal&&typeof stmt.expression.value==="string"){result=["(",result,")"+this.semicolon(flags)];}else{result.push(this.semicolon(flags));}return result;},ImportDeclaration:function ImportDeclaration(stmt,flags){// ES6: 15.2.1 valid import declarations:
//     - import ImportClause FromClause ;
//     - import ModuleSpecifier ;
var result,cursor,that=this||_global$5;// If no ImportClause is present,
// this should be `import ModuleSpecifier` so skip `from`
// ModuleSpecifier is StringLiteral.
if(stmt.specifiers.length===0){// import ModuleSpecifier ;
return["import",space,// ModuleSpecifier
this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)];}// import ImportClause FromClause ;
result=["import"];cursor=0;// ImportedBinding
if(stmt.specifiers[cursor].type===Syntax.ImportDefaultSpecifier){result=join(result,[this.generateExpression(stmt.specifiers[cursor],Precedence.Sequence,E_TTT)]);++cursor;}if(stmt.specifiers[cursor]){if(cursor!==0){result.push(",");}if(stmt.specifiers[cursor].type===Syntax.ImportNamespaceSpecifier){// NameSpaceImport
result=join(result,[space,this.generateExpression(stmt.specifiers[cursor],Precedence.Sequence,E_TTT)]);}else{// NamedImports
result.push(space+"{");if(stmt.specifiers.length-cursor===1){// import { ... } from "...";
result.push(space);result.push(this.generateExpression(stmt.specifiers[cursor],Precedence.Sequence,E_TTT));result.push(space+"}"+space);}else{// import {
//    ...,
//    ...,
// } from "...";
withIndent(function(indent){var i,iz;result.push(newline);for(i=cursor,iz=stmt.specifiers.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(stmt.specifiers[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+newline);}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline);}result.push(base+"}"+space);}}}result=join(result,["from"+space,// ModuleSpecifier
this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)]);return result;},VariableDeclarator:function VariableDeclarator(stmt,flags){var itemFlags=flags&F_ALLOW_IN?E_TTT:E_FTT;if(stmt.init){return[this.generateExpression(stmt.id,Precedence.Assignment,itemFlags),space,"=",space,this.generateExpression(stmt.init,Precedence.Assignment,itemFlags)];}return this.generatePattern(stmt.id,Precedence.Assignment,itemFlags);},VariableDeclaration:function VariableDeclaration(stmt,flags){// VariableDeclarator is typed as Statement,
// but joined with comma (not LineTerminator).
// So if comment is attached to target node, we should specialize.
var result,i,iz,node,bodyFlags,that=this||_global$5;result=[stmt.kind];bodyFlags=flags&F_ALLOW_IN?S_TFFF:S_FFFF;function block(){node=stmt.declarations[0];if(extra.comment&&node.leadingComments){result.push("\n");result.push(addIndent(that.generateStatement(node,bodyFlags)));}else{result.push(noEmptySpace());result.push(that.generateStatement(node,bodyFlags));}for(i=1,iz=stmt.declarations.length;i<iz;++i){node=stmt.declarations[i];if(extra.comment&&node.leadingComments){result.push(","+newline);result.push(addIndent(that.generateStatement(node,bodyFlags)));}else{result.push(","+space);result.push(that.generateStatement(node,bodyFlags));}}}if(stmt.declarations.length>1){withIndent(block);}else{block();}result.push(this.semicolon(flags));return result;},ThrowStatement:function ThrowStatement(stmt,flags){return[join("throw",this.generateExpression(stmt.argument,Precedence.Sequence,E_TTT)),this.semicolon(flags)];},TryStatement:function TryStatement(stmt,flags){var result,i,iz,guardedHandlers;result=["try",this.maybeBlock(stmt.block,S_TFFF)];result=this.maybeBlockSuffix(stmt.block,result);if(stmt.handlers){// old interface
for(i=0,iz=stmt.handlers.length;i<iz;++i){result=join(result,this.generateStatement(stmt.handlers[i],S_TFFF));if(stmt.finalizer||i+1!==iz){result=this.maybeBlockSuffix(stmt.handlers[i].body,result);}}}else{guardedHandlers=stmt.guardedHandlers||[];for(i=0,iz=guardedHandlers.length;i<iz;++i){result=join(result,this.generateStatement(guardedHandlers[i],S_TFFF));if(stmt.finalizer||i+1!==iz){result=this.maybeBlockSuffix(guardedHandlers[i].body,result);}}// new interface
if(stmt.handler){if(Array.isArray(stmt.handler)){for(i=0,iz=stmt.handler.length;i<iz;++i){result=join(result,this.generateStatement(stmt.handler[i],S_TFFF));if(stmt.finalizer||i+1!==iz){result=this.maybeBlockSuffix(stmt.handler[i].body,result);}}}else{result=join(result,this.generateStatement(stmt.handler,S_TFFF));if(stmt.finalizer){result=this.maybeBlockSuffix(stmt.handler.body,result);}}}}if(stmt.finalizer){result=join(result,["finally",this.maybeBlock(stmt.finalizer,S_TFFF)]);}return result;},SwitchStatement:function SwitchStatement(stmt,flags){var result,fragment,i,iz,bodyFlags,that=this||_global$5;withIndent(function(){result=["switch"+space+"(",that.generateExpression(stmt.discriminant,Precedence.Sequence,E_TTT),")"+space+"{"+newline];});if(stmt.cases){bodyFlags=S_TFFF;for(i=0,iz=stmt.cases.length;i<iz;++i){if(i===iz-1){bodyFlags|=F_SEMICOLON_OPT;}fragment=addIndent(this.generateStatement(stmt.cases[i],bodyFlags));result.push(fragment);if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline);}}}result.push(addIndent("}"));return result;},SwitchCase:function SwitchCase(stmt,flags){var result,fragment,i,iz,bodyFlags,that=this||_global$5;withIndent(function(){if(stmt.test){result=[join("case",that.generateExpression(stmt.test,Precedence.Sequence,E_TTT)),":"];}else{result=["default:"];}i=0;iz=stmt.consequent.length;if(iz&&stmt.consequent[0].type===Syntax.BlockStatement){fragment=that.maybeBlock(stmt.consequent[0],S_TFFF);result.push(fragment);i=1;}if(i!==iz&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline);}bodyFlags=S_TFFF;for(;i<iz;++i){if(i===iz-1&&flags&F_SEMICOLON_OPT){bodyFlags|=F_SEMICOLON_OPT;}fragment=addIndent(that.generateStatement(stmt.consequent[i],bodyFlags));result.push(fragment);if(i+1!==iz&&!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline);}}});return result;},IfStatement:function IfStatement(stmt,flags){var result,bodyFlags,semicolonOptional,that=this||_global$5;withIndent(function(){result=["if"+space+"(",that.generateExpression(stmt.test,Precedence.Sequence,E_TTT),")"];});semicolonOptional=flags&F_SEMICOLON_OPT;bodyFlags=S_TFFF;if(semicolonOptional){bodyFlags|=F_SEMICOLON_OPT;}if(stmt.alternate){result.push(this.maybeBlock(stmt.consequent,S_TFFF));result=this.maybeBlockSuffix(stmt.consequent,result);if(stmt.alternate.type===Syntax.IfStatement){result=join(result,["else ",this.generateStatement(stmt.alternate,bodyFlags)]);}else{result=join(result,join("else",this.maybeBlock(stmt.alternate,bodyFlags)));}}else{result.push(this.maybeBlock(stmt.consequent,bodyFlags));}return result;},ForStatement:function ForStatement(stmt,flags){var result,that=this||_global$5;withIndent(function(){result=["for"+space+"("];if(stmt.init){if(stmt.init.type===Syntax.VariableDeclaration){result.push(that.generateStatement(stmt.init,S_FFFF));}else{// F_ALLOW_IN becomes false.
result.push(that.generateExpression(stmt.init,Precedence.Sequence,E_FTT));result.push(";");}}else{result.push(";");}if(stmt.test){result.push(space);result.push(that.generateExpression(stmt.test,Precedence.Sequence,E_TTT));result.push(";");}else{result.push(";");}if(stmt.update){result.push(space);result.push(that.generateExpression(stmt.update,Precedence.Sequence,E_TTT));result.push(")");}else{result.push(")");}});result.push(this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF));return result;},ForInStatement:function ForInStatement(stmt,flags){return this.generateIterationForStatement("in",stmt,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF);},ForOfStatement:function ForOfStatement(stmt,flags){return this.generateIterationForStatement("of",stmt,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF);},LabeledStatement:function LabeledStatement(stmt,flags){return[stmt.label.name+":",this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF)];},Program:function Program(stmt,flags){var result,fragment,i,iz,bodyFlags;iz=stmt.body.length;result=[safeConcatenation&&iz>0?"\n":""];bodyFlags=S_TFTF;for(i=0;i<iz;++i){if(!safeConcatenation&&i===iz-1){bodyFlags|=F_SEMICOLON_OPT;}if(preserveBlankLines){// handle spaces before the first line
if(i===0){if(!stmt.body[0].leadingComments){generateBlankLines(stmt.range[0],stmt.body[i].range[0],result);}}// handle spaces between lines
if(i>0){if(!stmt.body[i-1].trailingComments&&!stmt.body[i].leadingComments){generateBlankLines(stmt.body[i-1].range[1],stmt.body[i].range[0],result);}}}fragment=addIndent(this.generateStatement(stmt.body[i],bodyFlags));result.push(fragment);if(i+1<iz&&!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){if(preserveBlankLines){if(!stmt.body[i+1].leadingComments){result.push(newline);}}else{result.push(newline);}}if(preserveBlankLines){// handle spaces after the last line
if(i===iz-1){if(!stmt.body[i].trailingComments){generateBlankLines(stmt.body[i].range[1],stmt.range[1],result);}}}}return result;},FunctionDeclaration:function FunctionDeclaration(stmt,flags){return[generateAsyncPrefix(stmt,true),"function",generateStarSuffix(stmt)||noEmptySpace(),stmt.id?generateIdentifier(stmt.id):"",this.generateFunctionBody(stmt)];},ReturnStatement:function ReturnStatement(stmt,flags){if(stmt.argument){return[join("return",this.generateExpression(stmt.argument,Precedence.Sequence,E_TTT)),this.semicolon(flags)];}return["return"+this.semicolon(flags)];},WhileStatement:function WhileStatement(stmt,flags){var result,that=this||_global$5;withIndent(function(){result=["while"+space+"(",that.generateExpression(stmt.test,Precedence.Sequence,E_TTT),")"];});result.push(this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF));return result;},WithStatement:function WithStatement(stmt,flags){var result,that=this||_global$5;withIndent(function(){result=["with"+space+"(",that.generateExpression(stmt.object,Precedence.Sequence,E_TTT),")"];});result.push(this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF));return result;}};merge(CodeGenerator.prototype,CodeGenerator.Statement);// Expressions.
CodeGenerator.Expression={SequenceExpression:function SequenceExpression(expr,precedence,flags){var result,i,iz;if(Precedence.Sequence<precedence){flags|=F_ALLOW_IN;}result=[];for(i=0,iz=expr.expressions.length;i<iz;++i){result.push(this.generateExpression(expr.expressions[i],Precedence.Assignment,flags));if(i+1<iz){result.push(","+space);}}return parenthesize(result,Precedence.Sequence,precedence);},AssignmentExpression:function AssignmentExpression(expr,precedence,flags){return this.generateAssignment(expr.left,expr.right,expr.operator,precedence,flags);},ArrowFunctionExpression:function ArrowFunctionExpression(expr,precedence,flags){return parenthesize(this.generateFunctionBody(expr),Precedence.ArrowFunction,precedence);},ConditionalExpression:function ConditionalExpression(expr,precedence,flags){if(Precedence.Conditional<precedence){flags|=F_ALLOW_IN;}return parenthesize([this.generateExpression(expr.test,Precedence.LogicalOR,flags),space+"?"+space,this.generateExpression(expr.consequent,Precedence.Assignment,flags),space+":"+space,this.generateExpression(expr.alternate,Precedence.Assignment,flags)],Precedence.Conditional,precedence);},LogicalExpression:function LogicalExpression(expr,precedence,flags){return this.BinaryExpression(expr,precedence,flags);},BinaryExpression:function BinaryExpression(expr,precedence,flags){var result,leftPrecedence,rightPrecedence,currentPrecedence,fragment,leftSource;currentPrecedence=BinaryPrecedence[expr.operator];leftPrecedence=expr.operator==="**"?Precedence.Postfix:currentPrecedence;rightPrecedence=expr.operator==="**"?currentPrecedence:currentPrecedence+1;if(currentPrecedence<precedence){flags|=F_ALLOW_IN;}fragment=this.generateExpression(expr.left,leftPrecedence,flags);leftSource=fragment.toString();if(leftSource.charCodeAt(leftSource.length-1)===47/* / */&&esutils.code.isIdentifierPartES5(expr.operator.charCodeAt(0))){result=[fragment,noEmptySpace(),expr.operator];}else{result=join(fragment,expr.operator);}fragment=this.generateExpression(expr.right,rightPrecedence,flags);if(expr.operator==="/"&&fragment.toString().charAt(0)==="/"||expr.operator.slice(-1)==="<"&&fragment.toString().slice(0,3)==="!--"){// If '/' concats with '/' or `<` concats with `!--`, it is interpreted as comment start
result.push(noEmptySpace());result.push(fragment);}else{result=join(result,fragment);}if(expr.operator==="in"&&!(flags&F_ALLOW_IN)){return["(",result,")"];}return parenthesize(result,currentPrecedence,precedence);},CallExpression:function CallExpression(expr,precedence,flags){var result,i,iz;// F_ALLOW_UNPARATH_NEW becomes false.
result=[this.generateExpression(expr.callee,Precedence.Call,E_TTF)];if(expr.optional){result.push("?.");}result.push("(");for(i=0,iz=expr["arguments"].length;i<iz;++i){result.push(this.generateExpression(expr["arguments"][i],Precedence.Assignment,E_TTT));if(i+1<iz){result.push(","+space);}}result.push(")");if(!(flags&F_ALLOW_CALL)){return["(",result,")"];}return parenthesize(result,Precedence.Call,precedence);},ChainExpression:function ChainExpression(expr,precedence,flags){if(Precedence.OptionalChaining<precedence){flags|=F_ALLOW_CALL;}var result=this.generateExpression(expr.expression,Precedence.OptionalChaining,flags);return parenthesize(result,Precedence.OptionalChaining,precedence);},NewExpression:function NewExpression(expr,precedence,flags){var result,length,i,iz,itemFlags;length=expr["arguments"].length;// F_ALLOW_CALL becomes false.
// F_ALLOW_UNPARATH_NEW may become false.
itemFlags=flags&F_ALLOW_UNPARATH_NEW&&!parentheses&&length===0?E_TFT:E_TFF;result=join("new",this.generateExpression(expr.callee,Precedence.New,itemFlags));if(!(flags&F_ALLOW_UNPARATH_NEW)||parentheses||length>0){result.push("(");for(i=0,iz=length;i<iz;++i){result.push(this.generateExpression(expr["arguments"][i],Precedence.Assignment,E_TTT));if(i+1<iz){result.push(","+space);}}result.push(")");}return parenthesize(result,Precedence.New,precedence);},MemberExpression:function MemberExpression(expr,precedence,flags){var result,fragment;// F_ALLOW_UNPARATH_NEW becomes false.
result=[this.generateExpression(expr.object,Precedence.Call,flags&F_ALLOW_CALL?E_TTF:E_TFF)];if(expr.computed){if(expr.optional){result.push("?.");}result.push("[");result.push(this.generateExpression(expr.property,Precedence.Sequence,flags&F_ALLOW_CALL?E_TTT:E_TFT));result.push("]");}else{if(!expr.optional&&expr.object.type===Syntax.Literal&&typeof expr.object.value==="number"){fragment=toSourceNodeWhenNeeded(result).toString();// When the following conditions are all true,
//   1. No floating point
//   2. Don't have exponents
//   3. The last character is a decimal digit
//   4. Not hexadecimal OR octal number literal
// we should add a floating point.
if(fragment.indexOf(".")<0&&!/[eExX]/.test(fragment)&&esutils.code.isDecimalDigit(fragment.charCodeAt(fragment.length-1))&&!(fragment.length>=2&&fragment.charCodeAt(0)===48)// '0'
){result.push(" ");}}result.push(expr.optional?"?.":".");result.push(generateIdentifier(expr.property));}return parenthesize(result,Precedence.Member,precedence);},MetaProperty:function MetaProperty(expr,precedence,flags){var result;result=[];result.push(typeof expr.meta==="string"?expr.meta:generateIdentifier(expr.meta));result.push(".");result.push(typeof expr.property==="string"?expr.property:generateIdentifier(expr.property));return parenthesize(result,Precedence.Member,precedence);},UnaryExpression:function UnaryExpression(expr,precedence,flags){var result,fragment,rightCharCode,leftSource,leftCharCode;fragment=this.generateExpression(expr.argument,Precedence.Unary,E_TTT);if(space===""){result=join(expr.operator,fragment);}else{result=[expr.operator];if(expr.operator.length>2){// delete, void, typeof
// get `typeof []`, not `typeof[]`
result=join(result,fragment);}else{// Prevent inserting spaces between operator and argument if it is unnecessary
// like, `!cond`
leftSource=toSourceNodeWhenNeeded(result).toString();leftCharCode=leftSource.charCodeAt(leftSource.length-1);rightCharCode=fragment.toString().charCodeAt(0);if((leftCharCode===43/* + */||leftCharCode===45/* - */)&&leftCharCode===rightCharCode||esutils.code.isIdentifierPartES5(leftCharCode)&&esutils.code.isIdentifierPartES5(rightCharCode)){result.push(noEmptySpace());result.push(fragment);}else{result.push(fragment);}}}return parenthesize(result,Precedence.Unary,precedence);},YieldExpression:function YieldExpression(expr,precedence,flags){var result;if(expr.delegate){result="yield*";}else{result="yield";}if(expr.argument){result=join(result,this.generateExpression(expr.argument,Precedence.Yield,E_TTT));}return parenthesize(result,Precedence.Yield,precedence);},AwaitExpression:function AwaitExpression(expr,precedence,flags){var result=join(expr.all?"await*":"await",this.generateExpression(expr.argument,Precedence.Await,E_TTT));return parenthesize(result,Precedence.Await,precedence);},UpdateExpression:function UpdateExpression(expr,precedence,flags){if(expr.prefix){return parenthesize([expr.operator,this.generateExpression(expr.argument,Precedence.Unary,E_TTT)],Precedence.Unary,precedence);}return parenthesize([this.generateExpression(expr.argument,Precedence.Postfix,E_TTT),expr.operator],Precedence.Postfix,precedence);},FunctionExpression:function FunctionExpression(expr,precedence,flags){var result=[generateAsyncPrefix(expr,true),"function"];if(expr.id){result.push(generateStarSuffix(expr)||noEmptySpace());result.push(generateIdentifier(expr.id));}else{result.push(generateStarSuffix(expr)||space);}result.push(this.generateFunctionBody(expr));return result;},ArrayPattern:function ArrayPattern(expr,precedence,flags){return this.ArrayExpression(expr,precedence,flags,true);},ArrayExpression:function ArrayExpression(expr,precedence,flags,isPattern){var result,multiline,that=this||_global$5;if(!expr.elements.length){return"[]";}multiline=isPattern?false:expr.elements.length>1;result=["[",multiline?newline:""];withIndent(function(indent){var i,iz;for(i=0,iz=expr.elements.length;i<iz;++i){if(!expr.elements[i]){if(multiline){result.push(indent);}if(i+1===iz){result.push(",");}}else{result.push(multiline?indent:"");result.push(that.generateExpression(expr.elements[i],Precedence.Assignment,E_TTT));}if(i+1<iz){result.push(","+(multiline?newline:space));}}});if(multiline&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline);}result.push(multiline?base:"");result.push("]");return result;},RestElement:function RestElement(expr,precedence,flags){return"..."+this.generatePattern(expr.argument);},ClassExpression:function ClassExpression(expr,precedence,flags){var result,fragment;result=["class"];if(expr.id){result=join(result,this.generateExpression(expr.id,Precedence.Sequence,E_TTT));}if(expr.superClass){fragment=join("extends",this.generateExpression(expr.superClass,Precedence.Unary,E_TTT));result=join(result,fragment);}result.push(space);result.push(this.generateStatement(expr.body,S_TFFT));return result;},MethodDefinition:function MethodDefinition(expr,precedence,flags){var result,fragment;if(expr["static"]){result=["static"+space];}else{result=[];}if(expr.kind==="get"||expr.kind==="set"){fragment=[join(expr.kind,this.generatePropertyKey(expr.key,expr.computed)),this.generateFunctionBody(expr.value)];}else{fragment=[generateMethodPrefix(expr),this.generatePropertyKey(expr.key,expr.computed),this.generateFunctionBody(expr.value)];}return join(result,fragment);},Property:function Property(expr,precedence,flags){if(expr.kind==="get"||expr.kind==="set"){return[expr.kind,noEmptySpace(),this.generatePropertyKey(expr.key,expr.computed),this.generateFunctionBody(expr.value)];}if(expr.shorthand){if(expr.value.type==="AssignmentPattern"){return this.AssignmentPattern(expr.value,Precedence.Sequence,E_TTT);}return this.generatePropertyKey(expr.key,expr.computed);}if(expr.method){return[generateMethodPrefix(expr),this.generatePropertyKey(expr.key,expr.computed),this.generateFunctionBody(expr.value)];}return[this.generatePropertyKey(expr.key,expr.computed),":"+space,this.generateExpression(expr.value,Precedence.Assignment,E_TTT)];},ObjectExpression:function ObjectExpression(expr,precedence,flags){var multiline,result,fragment,that=this||_global$5;if(!expr.properties.length){return"{}";}multiline=expr.properties.length>1;withIndent(function(){fragment=that.generateExpression(expr.properties[0],Precedence.Sequence,E_TTT);});if(!multiline){// issues 4
// Do not transform from
//   dejavu.Class.declare({
//       method2: function () {}
//   });
// to
//   dejavu.Class.declare({method2: function () {
//       }});
if(!hasLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){return["{",space,fragment,space,"}"];}}withIndent(function(indent){var i,iz;result=["{",newline,indent,fragment];if(multiline){result.push(","+newline);for(i=1,iz=expr.properties.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(expr.properties[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+newline);}}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline);}result.push(base);result.push("}");return result;},AssignmentPattern:function AssignmentPattern(expr,precedence,flags){return this.generateAssignment(expr.left,expr.right,"=",precedence,flags);},ObjectPattern:function ObjectPattern(expr,precedence,flags){var result,i,iz,multiline,property,that=this||_global$5;if(!expr.properties.length){return"{}";}multiline=false;if(expr.properties.length===1){property=expr.properties[0];if(property.type===Syntax.Property&&property.value.type!==Syntax.Identifier){multiline=true;}}else{for(i=0,iz=expr.properties.length;i<iz;++i){property=expr.properties[i];if(property.type===Syntax.Property&&!property.shorthand){multiline=true;break;}}}result=["{",multiline?newline:""];withIndent(function(indent){var i,iz;for(i=0,iz=expr.properties.length;i<iz;++i){result.push(multiline?indent:"");result.push(that.generateExpression(expr.properties[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+(multiline?newline:space));}}});if(multiline&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline);}result.push(multiline?base:"");result.push("}");return result;},ThisExpression:function ThisExpression(expr,precedence,flags){return"this";},Super:function Super(expr,precedence,flags){return"super";},Identifier:function Identifier(expr,precedence,flags){return generateIdentifier(expr);},ImportDefaultSpecifier:function ImportDefaultSpecifier(expr,precedence,flags){return generateIdentifier(expr.id||expr.local);},ImportNamespaceSpecifier:function ImportNamespaceSpecifier(expr,precedence,flags){var result=["*"];var id=expr.id||expr.local;if(id){result.push(space+"as"+noEmptySpace()+generateIdentifier(id));}return result;},ImportSpecifier:function ImportSpecifier(expr,precedence,flags){var imported=expr.imported;var result=[imported.name];var local=expr.local;if(local&&local.name!==imported.name){result.push(noEmptySpace()+"as"+noEmptySpace()+generateIdentifier(local));}return result;},ExportSpecifier:function ExportSpecifier(expr,precedence,flags){var local=expr.local;var result=[local.name];var exported=expr.exported;if(exported&&exported.name!==local.name){result.push(noEmptySpace()+"as"+noEmptySpace()+generateIdentifier(exported));}return result;},Literal:function Literal(expr,precedence,flags){var raw;if(expr.hasOwnProperty("raw")&&parse&&extra.raw){try{raw=parse(expr.raw).body[0].expression;if(raw.type===Syntax.Literal){if(raw.value===expr.value){return expr.raw;}}}catch(e){// not use raw property
}}if(expr.regex){return"/"+expr.regex.pattern+"/"+expr.regex.flags;}if(expr.value===null){return"null";}if(typeof expr.value==="string"){return escapeString(expr.value);}if(typeof expr.value==="number"){return generateNumber(expr.value);}if(typeof expr.value==="boolean"){return expr.value?"true":"false";}return generateRegExp(expr.value);},GeneratorExpression:function GeneratorExpression(expr,precedence,flags){return this.ComprehensionExpression(expr,precedence,flags);},ComprehensionExpression:function ComprehensionExpression(expr,precedence,flags){// GeneratorExpression should be parenthesized with (...), ComprehensionExpression with [...]
// Due to https://bugzilla.mozilla.org/show_bug.cgi?id=883468 position of expr.body can differ in Spidermonkey and ES6
var result,i,iz,fragment,that=this||_global$5;result=expr.type===Syntax.GeneratorExpression?["("]:["["];if(extra.moz.comprehensionExpressionStartsWithAssignment){fragment=this.generateExpression(expr.body,Precedence.Assignment,E_TTT);result.push(fragment);}if(expr.blocks){withIndent(function(){for(i=0,iz=expr.blocks.length;i<iz;++i){fragment=that.generateExpression(expr.blocks[i],Precedence.Sequence,E_TTT);if(i>0||extra.moz.comprehensionExpressionStartsWithAssignment){result=join(result,fragment);}else{result.push(fragment);}}});}if(expr.filter){result=join(result,"if"+space);fragment=this.generateExpression(expr.filter,Precedence.Sequence,E_TTT);result=join(result,["(",fragment,")"]);}if(!extra.moz.comprehensionExpressionStartsWithAssignment){fragment=this.generateExpression(expr.body,Precedence.Assignment,E_TTT);result=join(result,fragment);}result.push(expr.type===Syntax.GeneratorExpression?")":"]");return result;},ComprehensionBlock:function ComprehensionBlock(expr,precedence,flags){var fragment;if(expr.left.type===Syntax.VariableDeclaration){fragment=[expr.left.kind,noEmptySpace(),this.generateStatement(expr.left.declarations[0],S_FFFF)];}else{fragment=this.generateExpression(expr.left,Precedence.Call,E_TTT);}fragment=join(fragment,expr.of?"of":"in");fragment=join(fragment,this.generateExpression(expr.right,Precedence.Sequence,E_TTT));return["for"+space+"(",fragment,")"];},SpreadElement:function SpreadElement(expr,precedence,flags){return["...",this.generateExpression(expr.argument,Precedence.Assignment,E_TTT)];},TaggedTemplateExpression:function TaggedTemplateExpression(expr,precedence,flags){var itemFlags=E_TTF;if(!(flags&F_ALLOW_CALL)){itemFlags=E_TFF;}var result=[this.generateExpression(expr.tag,Precedence.Call,itemFlags),this.generateExpression(expr.quasi,Precedence.Primary,E_FFT)];return parenthesize(result,Precedence.TaggedTemplate,precedence);},TemplateElement:function TemplateElement(expr,precedence,flags){// Don't use "cooked". Since tagged template can use raw template
// representation. So if we do so, it breaks the script semantics.
return expr.value.raw;},TemplateLiteral:function TemplateLiteral(expr,precedence,flags){var result,i,iz;result=["`"];for(i=0,iz=expr.quasis.length;i<iz;++i){result.push(this.generateExpression(expr.quasis[i],Precedence.Primary,E_TTT));if(i+1<iz){result.push("${"+space);result.push(this.generateExpression(expr.expressions[i],Precedence.Sequence,E_TTT));result.push(space+"}");}}result.push("`");return result;},ModuleSpecifier:function ModuleSpecifier(expr,precedence,flags){return this.Literal(expr,precedence,flags);},ImportExpression:function ImportExpression(expr,precedence,flag){return parenthesize(["import(",this.generateExpression(expr.source,Precedence.Assignment,E_TTT),")"],Precedence.Call,precedence);}};merge(CodeGenerator.prototype,CodeGenerator.Expression);CodeGenerator.prototype.generateExpression=function(expr,precedence,flags){var result,type;type=expr.type||Syntax.Property;if(extra.verbatim&&expr.hasOwnProperty(extra.verbatim)){return generateVerbatim(expr,precedence);}result=this[type](expr,precedence,flags);if(extra.comment){result=addComments(expr,result);}return toSourceNodeWhenNeeded(result,expr);};CodeGenerator.prototype.generateStatement=function(stmt,flags){var result,fragment;result=this[stmt.type](stmt,flags);// Attach comments
if(extra.comment){result=addComments(stmt,result);}fragment=toSourceNodeWhenNeeded(result).toString();if(stmt.type===Syntax.Program&&!safeConcatenation&&newline===""&&fragment.charAt(fragment.length-1)==="\n"){result=sourceMap?toSourceNodeWhenNeeded(result).replaceRight(/\s+$/,""):fragment.replace(/\s+$/,"");}return toSourceNodeWhenNeeded(result,stmt);};function generateInternal(node){var codegen;codegen=new CodeGenerator();if(isStatement(node)){return codegen.generateStatement(node,S_TFFF);}if(isExpression(node)){return codegen.generateExpression(node,Precedence.Sequence,E_TTT);}throw new Error("Unknown node type: "+node.type);}function generate(node,options){var defaultOptions=getDefaultOptions(),result,pair;if(options!=null){// Obsolete options
//
//   `options.indent`
//   `options.base`
//
// Instead of them, we can use `option.format.indent`.
if(typeof options.indent==="string"){defaultOptions.format.indent.style=options.indent;}if(typeof options.base==="number"){defaultOptions.format.indent.base=options.base;}options=updateDeeply(defaultOptions,options);indent=options.format.indent.style;if(typeof options.base==="string"){base=options.base;}else{base=stringRepeat(indent,options.format.indent.base);}}else{options=defaultOptions;indent=options.format.indent.style;base=stringRepeat(indent,options.format.indent.base);}json=options.format.json;renumber=options.format.renumber;hexadecimal=json?false:options.format.hexadecimal;quotes=json?"double":options.format.quotes;escapeless=options.format.escapeless;newline=options.format.newline;space=options.format.space;if(options.format.compact){newline=space=indent=base="";}parentheses=options.format.parentheses;semicolons=options.format.semicolons;safeConcatenation=options.format.safeConcatenation;directive=options.directive;parse=json?null:options.parse;sourceMap=options.sourceMap;sourceCode=options.sourceCode;preserveBlankLines=options.format.preserveBlankLines&&sourceCode!==null;extra=options;if(sourceMap){if(!exports$a.browser){// We assume environment is node.js
// And prevent from including source-map by browserify
SourceNode=exports$1$6.SourceNode;}else{SourceNode=_global$5.sourceMap.SourceNode;}}result=generateInternal(node);if(!sourceMap){pair={code:result.toString(),map:null};return options.sourceMapWithCode?pair:pair.code;}pair=result.toStringWithSourceMap({file:options.file,sourceRoot:options.sourceMapRoot});if(options.sourceContent){pair.map.setSourceContent(options.sourceMap,options.sourceContent);}if(options.sourceMapWithCode){return pair;}return pair.map.toString();}FORMAT_MINIFY={indent:{style:"",base:0},renumber:true,hexadecimal:true,quotes:"auto",escapeless:true,compact:true,parentheses:false,semicolons:false};FORMAT_DEFAULTS=getDefaultOptions().format;exports$a.version=_package.version;exports$a.generate=generate;exports$a.attachComments=estraverse.attachComments;exports$a.Precedence=updateDeeply({},Precedence);exports$a.browser=false;exports$a.FORMAT_MINIFY=FORMAT_MINIFY;exports$a.FORMAT_DEFAULTS=FORMAT_DEFAULTS;})();var version=exports$a.version,generate=exports$a.generate,attachComments=exports$a.attachComments,Precedence=exports$a.Precedence,browser=exports$a.browser,FORMAT_MINIFY=exports$a.FORMAT_MINIFY,FORMAT_DEFAULTS=exports$a.FORMAT_DEFAULTS;var escodegen=/*#__PURE__*/Object.freeze({__proto__:null,escodegen:_missingExportShim,'default':exports$a,FORMAT_DEFAULTS:FORMAT_DEFAULTS,FORMAT_MINIFY:FORMAT_MINIFY,Precedence:Precedence,attachComments:attachComments,browser:browser,generate:generate,version:version});var es=_missingExportShim||escodegen;function stringify(node){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var optsIndent=opts&&opts.format&&opts.format.indent||{};var indent={style:'  ',base:0,adjustMultilineComment:false,optsIndent:optsIndent};var optsFormat=opts&&opts.format||{};var format=_objectSpread({indent:indent,quotes:'double'},dissoc(optsFormat,['indent']));opts=_objectSpread({format:format,comment:false},dissoc(opts,['format']));return es.generate(node,opts);}// Reserved word lists for various dialects of the language
var reservedWords={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"};// And the keywords
var ecma5AndLessKeywords="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this";var keywords={5:ecma5AndLessKeywords,"5module":ecma5AndLessKeywords+" export import",6:ecma5AndLessKeywords+" const class extends export import super"};var keywordRelationalOperator=/^in(stanceof)?$/;// ## Character categories
// Big ugly regular expressions that match characters in the
// whitespace, identifier, and identifier-start categories. These
// are only applied when a character is found to actually have a
// code point above 128.
// Generated by `bin/generate-identifier-regex.js`.
var nonASCIIidentifierStartChars="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC";var nonASCIIidentifierChars="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F";var nonASCIIidentifierStart=new RegExp("["+nonASCIIidentifierStartChars+"]");var nonASCIIidentifier=new RegExp("["+nonASCIIidentifierStartChars+nonASCIIidentifierChars+"]");nonASCIIidentifierStartChars=nonASCIIidentifierChars=null;// These are a run-length and offset encoded representation of the
// >0xffff code points that are a valid part of identifiers. The
// offset starts at 0x10000, and each pair of numbers represents an
// offset to the next range, and then a size of the range. They were
// generated by bin/generate-identifier-regex.js
// eslint-disable-next-line comma-spacing
var astralIdentifierStartCodes=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938];// eslint-disable-next-line comma-spacing
var astralIdentifierCodes=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];// This has a complexity linear to the value of the code. The
// assumption is that looking up astral identifier characters is
// rare.
function isInAstralSet(code,set){var pos=0x10000;for(var i=0;i<set.length;i+=2){pos+=set[i];if(pos>code){return false;}pos+=set[i+1];if(pos>=code){return true;}}}// Test whether a given character code starts an identifier.
function isIdentifierStart(code,astral){if(code<65){return code===36;}if(code<91){return true;}if(code<97){return code===95;}if(code<123){return true;}if(code<=0xffff){return code>=0xaa&&nonASCIIidentifierStart.test(String.fromCharCode(code));}if(astral===false){return false;}return isInAstralSet(code,astralIdentifierStartCodes);}// Test whether a given character is part of an identifier.
function isIdentifierChar(code,astral){if(code<48){return code===36;}if(code<58){return true;}if(code<65){return false;}if(code<91){return true;}if(code<97){return code===95;}if(code<123){return true;}if(code<=0xffff){return code>=0xaa&&nonASCIIidentifier.test(String.fromCharCode(code));}if(astral===false){return false;}return isInAstralSet(code,astralIdentifierStartCodes)||isInAstralSet(code,astralIdentifierCodes);}// ## Token types
// The assignment of fine-grained, information-carrying type objects
// allows the tokenizer to store the information it has about a
// token in a way that is very cheap for the parser to look up.
// All token type variables start with an underscore, to make them
// easy to recognize.
// The `beforeExpr` property is used to disambiguate between regular
// expressions and divisions. It is set on all token types that can
// be followed by an expression (thus, a slash after them would be a
// regular expression).
//
// The `startsExpr` property is used to check if the token ends a
// `yield` expression. It is set on all token types that either can
// directly start an expression (like a quotation mark) or can
// continue an expression (like the body of a string).
//
// `isLoop` marks a keyword as starting a loop, which is important
// to know when parsing a label, in order to allow or disallow
// continue jumps to that label.
var TokenType=function TokenType(label,conf){if(conf===void 0)conf={};this.label=label;this.keyword=conf.keyword;this.beforeExpr=!!conf.beforeExpr;this.startsExpr=!!conf.startsExpr;this.isLoop=!!conf.isLoop;this.isAssign=!!conf.isAssign;this.prefix=!!conf.prefix;this.postfix=!!conf.postfix;this.binop=conf.binop||null;this.updateContext=null;};function binop(name,prec){return new TokenType(name,{beforeExpr:true,binop:prec});}var beforeExpr={beforeExpr:true},startsExpr={startsExpr:true};// Map keyword names to token types.
var keywords$1={};// Succinct definitions of keyword token types
function kw(name,options){if(options===void 0)options={};options.keyword=name;return keywords$1[name]=new TokenType(name,options);}var types={num:new TokenType("num",startsExpr),regexp:new TokenType("regexp",startsExpr),string:new TokenType("string",startsExpr),name:new TokenType("name",startsExpr),eof:new TokenType("eof"),// Punctuation token types.
bracketL:new TokenType("[",{beforeExpr:true,startsExpr:true}),bracketR:new TokenType("]"),braceL:new TokenType("{",{beforeExpr:true,startsExpr:true}),braceR:new TokenType("}"),parenL:new TokenType("(",{beforeExpr:true,startsExpr:true}),parenR:new TokenType(")"),comma:new TokenType(",",beforeExpr),semi:new TokenType(";",beforeExpr),colon:new TokenType(":",beforeExpr),dot:new TokenType("."),question:new TokenType("?",beforeExpr),questionDot:new TokenType("?."),arrow:new TokenType("=>",beforeExpr),template:new TokenType("template"),invalidTemplate:new TokenType("invalidTemplate"),ellipsis:new TokenType("...",beforeExpr),backQuote:new TokenType("`",startsExpr),dollarBraceL:new TokenType("${",{beforeExpr:true,startsExpr:true}),// Operators. These carry several kinds of properties to help the
// parser use them properly (the presence of these properties is
// what categorizes them as operators).
//
// `binop`, when present, specifies that this operator is a binary
// operator, and will refer to its precedence.
//
// `prefix` and `postfix` mark the operator as a prefix or postfix
// unary operator.
//
// `isAssign` marks all of `=`, `+=`, `-=` etcetera, which act as
// binary operators with a very low precedence, that should result
// in AssignmentExpression nodes.
eq:new TokenType("=",{beforeExpr:true,isAssign:true}),assign:new TokenType("_=",{beforeExpr:true,isAssign:true}),incDec:new TokenType("++/--",{prefix:true,postfix:true,startsExpr:true}),prefix:new TokenType("!/~",{beforeExpr:true,prefix:true,startsExpr:true}),logicalOR:binop("||",1),logicalAND:binop("&&",2),bitwiseOR:binop("|",3),bitwiseXOR:binop("^",4),bitwiseAND:binop("&",5),equality:binop("==/!=/===/!==",6),relational:binop("</>/<=/>=",7),bitShift:binop("<</>>/>>>",8),plusMin:new TokenType("+/-",{beforeExpr:true,binop:9,prefix:true,startsExpr:true}),modulo:binop("%",10),star:binop("*",10),slash:binop("/",10),starstar:new TokenType("**",{beforeExpr:true}),coalesce:binop("??",1),// Keyword token types.
_break:kw("break"),_case:kw("case",beforeExpr),_catch:kw("catch"),_continue:kw("continue"),_debugger:kw("debugger"),_default:kw("default",beforeExpr),_do:kw("do",{isLoop:true,beforeExpr:true}),_else:kw("else",beforeExpr),_finally:kw("finally"),_for:kw("for",{isLoop:true}),_function:kw("function",startsExpr),_if:kw("if"),_return:kw("return",beforeExpr),_switch:kw("switch"),_throw:kw("throw",beforeExpr),_try:kw("try"),_var:kw("var"),_const:kw("const"),_while:kw("while",{isLoop:true}),_with:kw("with"),_new:kw("new",{beforeExpr:true,startsExpr:true}),_this:kw("this",startsExpr),_super:kw("super",startsExpr),_class:kw("class",startsExpr),_extends:kw("extends",beforeExpr),_export:kw("export"),_import:kw("import",startsExpr),_null:kw("null",startsExpr),_true:kw("true",startsExpr),_false:kw("false",startsExpr),_in:kw("in",{beforeExpr:true,binop:7}),_instanceof:kw("instanceof",{beforeExpr:true,binop:7}),_typeof:kw("typeof",{beforeExpr:true,prefix:true,startsExpr:true}),_void:kw("void",{beforeExpr:true,prefix:true,startsExpr:true}),_delete:kw("delete",{beforeExpr:true,prefix:true,startsExpr:true})};// Matches a whole line break (where CRLF is considered a single
// line break). Used to count lines.
var lineBreak=/\r\n?|\n|\u2028|\u2029/;var lineBreakG=new RegExp(lineBreak.source,"g");function isNewLine(code,ecma2019String){return code===10||code===13||!ecma2019String&&(code===0x2028||code===0x2029);}var nonASCIIwhitespace=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/;var skipWhiteSpace=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g;var ref=Object.prototype;var hasOwnProperty=ref.hasOwnProperty;var toString=ref.toString;// Checks if an object has a property.
function has$1(obj,propName){return hasOwnProperty.call(obj,propName);}var isArray$2=Array.isArray||function(obj){return toString.call(obj)==="[object Array]";};function wordsRegexp(words){return new RegExp("^(?:"+words.replace(/ /g,"|")+")$");}// These are used when `options.locations` is on, for the
// `startLoc` and `endLoc` properties.
var Position=function Position(line,col){this.line=line;this.column=col;};Position.prototype.offset=function offset(n){return new Position(this.line,this.column+n);};var SourceLocation=function SourceLocation(p,start,end){this.start=start;this.end=end;if(p.sourceFile!==null){this.source=p.sourceFile;}};// The `getLineInfo` function is mostly useful when the
// `locations` option is off (for performance reasons) and you
// want to find the line/column position for a given character
// offset. `input` should be the code string that the offset refers
// into.
function getLineInfo(input,offset){for(var line=1,cur=0;;){lineBreakG.lastIndex=cur;var match=lineBreakG.exec(input);if(match&&match.index<offset){++line;cur=match.index+match[0].length;}else{return new Position(line,offset-cur);}}}// A second argument must be given to configure the parser process.
// These options are recognized (only `ecmaVersion` is required):
var defaultOptions={// `ecmaVersion` indicates the ECMAScript version to parse. Must be
// either 3, 5, 6 (or 2015), 7 (2016), 8 (2017), 9 (2018), 10
// (2019), 11 (2020), 12 (2021), or `"latest"` (the latest version
// the library supports). This influences support for strict mode,
// the set of reserved words, and support for new syntax features.
ecmaVersion:null,// `sourceType` indicates the mode the code should be parsed in.
// Can be either `"script"` or `"module"`. This influences global
// strict mode and parsing of `import` and `export` declarations.
sourceType:"script",// `onInsertedSemicolon` can be a callback that will be called
// when a semicolon is automatically inserted. It will be passed
// the position of the comma as an offset, and if `locations` is
// enabled, it is given the location as a `{line, column}` object
// as second argument.
onInsertedSemicolon:null,// `onTrailingComma` is similar to `onInsertedSemicolon`, but for
// trailing commas.
onTrailingComma:null,// By default, reserved words are only enforced if ecmaVersion >= 5.
// Set `allowReserved` to a boolean value to explicitly turn this on
// an off. When this option has the value "never", reserved words
// and keywords can also not be used as property names.
allowReserved:null,// When enabled, a return at the top level is not considered an
// error.
allowReturnOutsideFunction:false,// When enabled, import/export statements are not constrained to
// appearing at the top of the program.
allowImportExportEverywhere:false,// When enabled, await identifiers are allowed to appear at the top-level scope,
// but they are still not allowed in non-async functions.
allowAwaitOutsideFunction:false,// When enabled, hashbang directive in the beginning of file
// is allowed and treated as a line comment.
allowHashBang:false,// When `locations` is on, `loc` properties holding objects with
// `start` and `end` properties in `{line, column}` form (with
// line being 1-based and column 0-based) will be attached to the
// nodes.
locations:false,// A function can be passed as `onToken` option, which will
// cause Acorn to call that function with object in the same
// format as tokens returned from `tokenizer().getToken()`. Note
// that you are not allowed to call the parser from the
// callback—that will corrupt its internal state.
onToken:null,// A function can be passed as `onComment` option, which will
// cause Acorn to call that function with `(block, text, start,
// end)` parameters whenever a comment is skipped. `block` is a
// boolean indicating whether this is a block (`/* */`) comment,
// `text` is the content of the comment, and `start` and `end` are
// character offsets that denote the start and end of the comment.
// When the `locations` option is on, two more parameters are
// passed, the full `{line, column}` locations of the start and
// end of the comments. Note that you are not allowed to call the
// parser from the callback—that will corrupt its internal state.
onComment:null,// Nodes have their start and end characters offsets recorded in
// `start` and `end` properties (directly on the node, rather than
// the `loc` object, which holds line/column data. To also add a
// [semi-standardized][range] `range` property holding a `[start,
// end]` array with the same numbers, set the `ranges` option to
// `true`.
//
// [range]: https://bugzilla.mozilla.org/show_bug.cgi?id=745678
ranges:false,// It is possible to parse multiple files into a single AST by
// passing the tree produced by parsing the first file as
// `program` option in subsequent parses. This will add the
// toplevel forms of the parsed file to the `Program` (top) node
// of an existing parse tree.
program:null,// When `locations` is on, you can pass this to record the source
// file in every node's `loc` object.
sourceFile:null,// This value, if given, is stored in every node, whether
// `locations` is on or off.
directSourceFile:null,// When enabled, parenthesized expressions are represented by
// (non-standard) ParenthesizedExpression nodes
preserveParens:false};// Interpret and default an options object
var warnedAboutEcmaVersion=false;function getOptions(opts){var options={};for(var opt in defaultOptions){options[opt]=opts&&has$1(opts,opt)?opts[opt]:defaultOptions[opt];}if(options.ecmaVersion==="latest"){options.ecmaVersion=1e8;}else if(options.ecmaVersion==null){if(!warnedAboutEcmaVersion&&(typeof console==="undefined"?"undefined":_typeof2(console))==="object"&&console.warn){warnedAboutEcmaVersion=true;console.warn("Since Acorn 8.0.0, options.ecmaVersion is required.\nDefaulting to 2020, but this will stop working in the future.");}options.ecmaVersion=11;}else if(options.ecmaVersion>=2015){options.ecmaVersion-=2009;}if(options.allowReserved==null){options.allowReserved=options.ecmaVersion<5;}if(isArray$2(options.onToken)){var tokens=options.onToken;options.onToken=function(token){return tokens.push(token);};}if(isArray$2(options.onComment)){options.onComment=pushComment(options,options.onComment);}return options;}function pushComment(options,array){return function(block,text,start,end,startLoc,endLoc){var comment={type:block?"Block":"Line",value:text,start:start,end:end};if(options.locations){comment.loc=new SourceLocation(this,startLoc,endLoc);}if(options.ranges){comment.range=[start,end];}array.push(comment);};}// Each scope gets a bitset that may contain these flags
var SCOPE_TOP=1,SCOPE_FUNCTION=2,SCOPE_VAR=SCOPE_TOP|SCOPE_FUNCTION,SCOPE_ASYNC=4,SCOPE_GENERATOR=8,SCOPE_ARROW=16,SCOPE_SIMPLE_CATCH=32,SCOPE_SUPER=64,SCOPE_DIRECT_SUPER=128;function functionFlags(async,generator){return SCOPE_FUNCTION|(async?SCOPE_ASYNC:0)|(generator?SCOPE_GENERATOR:0);}// Used in checkLVal* and declareName to determine the type of a binding
var BIND_NONE=0,// Not a binding
BIND_VAR=1,// Var-style binding
BIND_LEXICAL=2,// Let- or const-style binding
BIND_FUNCTION=3,// Function declaration
BIND_SIMPLE_CATCH=4,// Simple (identifier pattern) catch binding
BIND_OUTSIDE=5;// Special case for function names as bound inside the function
var Parser=function Parser(options,input,startPos){this.options=options=getOptions(options);this.sourceFile=options.sourceFile;this.keywords=wordsRegexp(keywords[options.ecmaVersion>=6?6:options.sourceType==="module"?"5module":5]);var reserved="";if(options.allowReserved!==true){reserved=reservedWords[options.ecmaVersion>=6?6:options.ecmaVersion===5?5:3];if(options.sourceType==="module"){reserved+=" await";}}this.reservedWords=wordsRegexp(reserved);var reservedStrict=(reserved?reserved+" ":"")+reservedWords.strict;this.reservedWordsStrict=wordsRegexp(reservedStrict);this.reservedWordsStrictBind=wordsRegexp(reservedStrict+" "+reservedWords.strictBind);this.input=String(input);// Used to signal to callers of `readWord1` whether the word
// contained any escape sequences. This is needed because words with
// escape sequences must not be interpreted as keywords.
this.containsEsc=false;// Set up token state
// The current position of the tokenizer in the input.
if(startPos){this.pos=startPos;this.lineStart=this.input.lastIndexOf("\n",startPos-1)+1;this.curLine=this.input.slice(0,this.lineStart).split(lineBreak).length;}else{this.pos=this.lineStart=0;this.curLine=1;}// Properties of the current token:
// Its type
this.type=types.eof;// For tokens that include more information than their type, the value
this.value=null;// Its start and end offset
this.start=this.end=this.pos;// And, if locations are used, the {line, column} object
// corresponding to those offsets
this.startLoc=this.endLoc=this.curPosition();// Position information for the previous token
this.lastTokEndLoc=this.lastTokStartLoc=null;this.lastTokStart=this.lastTokEnd=this.pos;// The context stack is used to superficially track syntactic
// context to predict whether a regular expression is allowed in a
// given position.
this.context=this.initialContext();this.exprAllowed=true;// Figure out if it's a module code.
this.inModule=options.sourceType==="module";this.strict=this.inModule||this.strictDirective(this.pos);// Used to signify the start of a potential arrow function
this.potentialArrowAt=-1;// Positions to delayed-check that yield/await does not exist in default parameters.
this.yieldPos=this.awaitPos=this.awaitIdentPos=0;// Labels in scope.
this.labels=[];// Thus-far undefined exports.
this.undefinedExports={};// If enabled, skip leading hashbang line.
if(this.pos===0&&options.allowHashBang&&this.input.slice(0,2)==="#!"){this.skipLineComment(2);}// Scope tracking for duplicate variable names (see scope.js)
this.scopeStack=[];this.enterScope(SCOPE_TOP);// For RegExp validation
this.regexpState=null;};var prototypeAccessors={inFunction:{configurable:true},inGenerator:{configurable:true},inAsync:{configurable:true},allowSuper:{configurable:true},allowDirectSuper:{configurable:true},treatFunctionsAsVar:{configurable:true},inNonArrowFunction:{configurable:true}};Parser.prototype.parse=function parse(){var node=this.options.program||this.startNode();this.nextToken();return this.parseTopLevel(node);};prototypeAccessors.inFunction.get=function(){return(this.currentVarScope().flags&SCOPE_FUNCTION)>0;};prototypeAccessors.inGenerator.get=function(){return(this.currentVarScope().flags&SCOPE_GENERATOR)>0;};prototypeAccessors.inAsync.get=function(){return(this.currentVarScope().flags&SCOPE_ASYNC)>0;};prototypeAccessors.allowSuper.get=function(){return(this.currentThisScope().flags&SCOPE_SUPER)>0;};prototypeAccessors.allowDirectSuper.get=function(){return(this.currentThisScope().flags&SCOPE_DIRECT_SUPER)>0;};prototypeAccessors.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope());};prototypeAccessors.inNonArrowFunction.get=function(){return(this.currentThisScope().flags&SCOPE_FUNCTION)>0;};Parser.extend=function extend(){var plugins=[],len=arguments.length;while(len--){plugins[len]=arguments[len];}var cls=this;for(var i=0;i<plugins.length;i++){cls=plugins[i](cls);}return cls;};Parser.parse=function parse(input,options){return new this(options,input).parse();};Parser.parseExpressionAt=function parseExpressionAt(input,pos,options){var parser=new this(options,input,pos);parser.nextToken();return parser.parseExpression();};Parser.tokenizer=function tokenizer(input,options){return new this(options,input);};Object.defineProperties(Parser.prototype,prototypeAccessors);var pp=Parser.prototype;// ## Parser utilities
var literal=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;pp.strictDirective=function(start){for(;;){// Try to find string literal.
skipWhiteSpace.lastIndex=start;start+=skipWhiteSpace.exec(this.input)[0].length;var match=literal.exec(this.input.slice(start));if(!match){return false;}if((match[1]||match[2])==="use strict"){skipWhiteSpace.lastIndex=start+match[0].length;var spaceAfter=skipWhiteSpace.exec(this.input),end=spaceAfter.index+spaceAfter[0].length;var next=this.input.charAt(end);return next===";"||next==="}"||lineBreak.test(spaceAfter[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(next)||next==="!"&&this.input.charAt(end+1)==="=");}start+=match[0].length;// Skip semicolon, if any.
skipWhiteSpace.lastIndex=start;start+=skipWhiteSpace.exec(this.input)[0].length;if(this.input[start]===";"){start++;}}};// Predicate that tests whether the next token is of the given
// type, and if yes, consumes it as a side effect.
pp.eat=function(type){if(this.type===type){this.next();return true;}else{return false;}};// Tests whether parsed token is a contextual keyword.
pp.isContextual=function(name){return this.type===types.name&&this.value===name&&!this.containsEsc;};// Consumes contextual keyword if possible.
pp.eatContextual=function(name){if(!this.isContextual(name)){return false;}this.next();return true;};// Asserts that following token is given contextual keyword.
pp.expectContextual=function(name){if(!this.eatContextual(name)){this.unexpected();}};// Test whether a semicolon can be inserted at the current position.
pp.canInsertSemicolon=function(){return this.type===types.eof||this.type===types.braceR||lineBreak.test(this.input.slice(this.lastTokEnd,this.start));};pp.insertSemicolon=function(){if(this.canInsertSemicolon()){if(this.options.onInsertedSemicolon){this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc);}return true;}};// Consume a semicolon, or, failing that, see if we are allowed to
// pretend that there is a semicolon at this position.
pp.semicolon=function(){if(!this.eat(types.semi)&&!this.insertSemicolon()){this.unexpected();}};pp.afterTrailingComma=function(tokType,notNext){if(this.type===tokType){if(this.options.onTrailingComma){this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc);}if(!notNext){this.next();}return true;}};// Expect a token of a given type. If found, consume it, otherwise,
// raise an unexpected token error.
pp.expect=function(type){this.eat(type)||this.unexpected();};// Raise an unexpected token error.
pp.unexpected=function(pos){this.raise(pos!=null?pos:this.start,"Unexpected token");};function DestructuringErrors(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1;}pp.checkPatternErrors=function(refDestructuringErrors,isAssign){if(!refDestructuringErrors){return;}if(refDestructuringErrors.trailingComma>-1){this.raiseRecoverable(refDestructuringErrors.trailingComma,"Comma is not permitted after the rest element");}var parens=isAssign?refDestructuringErrors.parenthesizedAssign:refDestructuringErrors.parenthesizedBind;if(parens>-1){this.raiseRecoverable(parens,"Parenthesized pattern");}};pp.checkExpressionErrors=function(refDestructuringErrors,andThrow){if(!refDestructuringErrors){return false;}var shorthandAssign=refDestructuringErrors.shorthandAssign;var doubleProto=refDestructuringErrors.doubleProto;if(!andThrow){return shorthandAssign>=0||doubleProto>=0;}if(shorthandAssign>=0){this.raise(shorthandAssign,"Shorthand property assignments are valid only in destructuring patterns");}if(doubleProto>=0){this.raiseRecoverable(doubleProto,"Redefinition of __proto__ property");}};pp.checkYieldAwaitInDefaultParams=function(){if(this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)){this.raise(this.yieldPos,"Yield expression cannot be a default value");}if(this.awaitPos){this.raise(this.awaitPos,"Await expression cannot be a default value");}};pp.isSimpleAssignTarget=function(expr){if(expr.type==="ParenthesizedExpression"){return this.isSimpleAssignTarget(expr.expression);}return expr.type==="Identifier"||expr.type==="MemberExpression";};var pp$1=Parser.prototype;// ### Statement parsing
// Parse a program. Initializes the parser, reads any number of
// statements, and wraps them in a Program node.  Optionally takes a
// `program` argument.  If present, the statements will be appended
// to its body instead of creating a new node.
pp$1.parseTopLevel=function(node){var exports={};if(!node.body){node.body=[];}while(this.type!==types.eof){var stmt=this.parseStatement(null,true,exports);node.body.push(stmt);}if(this.inModule){for(var i=0,list=Object.keys(this.undefinedExports);i<list.length;i+=1){var name=list[i];this.raiseRecoverable(this.undefinedExports[name].start,"Export '"+name+"' is not defined");}}this.adaptDirectivePrologue(node.body);this.next();node.sourceType=this.options.sourceType;return this.finishNode(node,"Program");};var loopLabel={kind:"loop"},switchLabel={kind:"switch"};pp$1.isLet=function(context){if(this.options.ecmaVersion<6||!this.isContextual("let")){return false;}skipWhiteSpace.lastIndex=this.pos;var skip=skipWhiteSpace.exec(this.input);var next=this.pos+skip[0].length,nextCh=this.input.charCodeAt(next);// For ambiguous cases, determine if a LexicalDeclaration (or only a
// Statement) is allowed here. If context is not empty then only a Statement
// is allowed. However, `let [` is an explicit negative lookahead for
// ExpressionStatement, so special-case it first.
if(nextCh===91){return true;}// '['
if(context){return false;}if(nextCh===123){return true;}// '{'
if(isIdentifierStart(nextCh,true)){var pos=next+1;while(isIdentifierChar(this.input.charCodeAt(pos),true)){++pos;}var ident=this.input.slice(next,pos);if(!keywordRelationalOperator.test(ident)){return true;}}return false;};// check 'async [no LineTerminator here] function'
// - 'async /*foo*/ function' is OK.
// - 'async /*\n*/ function' is invalid.
pp$1.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async")){return false;}skipWhiteSpace.lastIndex=this.pos;var skip=skipWhiteSpace.exec(this.input);var next=this.pos+skip[0].length;return!lineBreak.test(this.input.slice(this.pos,next))&&this.input.slice(next,next+8)==="function"&&(next+8===this.input.length||!isIdentifierChar(this.input.charAt(next+8)));};// Parse a single statement.
//
// If expecting a statement and finding a slash operator, parse a
// regular expression literal. This is to handle cases like
// `if (foo) /blah/.exec(foo)`, where looking at the previous token
// does not help.
pp$1.parseStatement=function(context,topLevel,exports){var starttype=this.type,node=this.startNode(),kind;if(this.isLet(context)){starttype=types._var;kind="let";}// Most types of statements are recognized by the keyword they
// start with. Many are trivial to parse, some require a bit of
// complexity.
switch(starttype){case types._break:case types._continue:return this.parseBreakContinueStatement(node,starttype.keyword);case types._debugger:return this.parseDebuggerStatement(node);case types._do:return this.parseDoStatement(node);case types._for:return this.parseForStatement(node);case types._function:// Function as sole body of either an if statement or a labeled statement
// works, but not when it is part of a labeled statement that is the sole
// body of an if statement.
if(context&&(this.strict||context!=="if"&&context!=="label")&&this.options.ecmaVersion>=6){this.unexpected();}return this.parseFunctionStatement(node,false,!context);case types._class:if(context){this.unexpected();}return this.parseClass(node,true);case types._if:return this.parseIfStatement(node);case types._return:return this.parseReturnStatement(node);case types._switch:return this.parseSwitchStatement(node);case types._throw:return this.parseThrowStatement(node);case types._try:return this.parseTryStatement(node);case types._const:case types._var:kind=kind||this.value;if(context&&kind!=="var"){this.unexpected();}return this.parseVarStatement(node,kind);case types._while:return this.parseWhileStatement(node);case types._with:return this.parseWithStatement(node);case types.braceL:return this.parseBlock(true,node);case types.semi:return this.parseEmptyStatement(node);case types._export:case types._import:if(this.options.ecmaVersion>10&&starttype===types._import){skipWhiteSpace.lastIndex=this.pos;var skip=skipWhiteSpace.exec(this.input);var next=this.pos+skip[0].length,nextCh=this.input.charCodeAt(next);if(nextCh===40||nextCh===46)// '(' or '.'
{return this.parseExpressionStatement(node,this.parseExpression());}}if(!this.options.allowImportExportEverywhere){if(!topLevel){this.raise(this.start,"'import' and 'export' may only appear at the top level");}if(!this.inModule){this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'");}}return starttype===types._import?this.parseImport(node):this.parseExport(node,exports);// If the statement does not start with a statement keyword or a
// brace, it's an ExpressionStatement or LabeledStatement. We
// simply start parsing an expression, and afterwards, if the
// next token is a colon and the expression was a simple
// Identifier node, we switch to interpreting it as a label.
default:if(this.isAsyncFunction()){if(context){this.unexpected();}this.next();return this.parseFunctionStatement(node,true,!context);}var maybeName=this.value,expr=this.parseExpression();if(starttype===types.name&&expr.type==="Identifier"&&this.eat(types.colon)){return this.parseLabeledStatement(node,maybeName,expr,context);}else{return this.parseExpressionStatement(node,expr);}}};pp$1.parseBreakContinueStatement=function(node,keyword){var isBreak=keyword==="break";this.next();if(this.eat(types.semi)||this.insertSemicolon()){node.label=null;}else if(this.type!==types.name){this.unexpected();}else{node.label=this.parseIdent();this.semicolon();}// Verify that there is an actual destination to break or
// continue to.
var i=0;for(;i<this.labels.length;++i){var lab=this.labels[i];if(node.label==null||lab.name===node.label.name){if(lab.kind!=null&&(isBreak||lab.kind==="loop")){break;}if(node.label&&isBreak){break;}}}if(i===this.labels.length){this.raise(node.start,"Unsyntactic "+keyword);}return this.finishNode(node,isBreak?"BreakStatement":"ContinueStatement");};pp$1.parseDebuggerStatement=function(node){this.next();this.semicolon();return this.finishNode(node,"DebuggerStatement");};pp$1.parseDoStatement=function(node){this.next();this.labels.push(loopLabel);node.body=this.parseStatement("do");this.labels.pop();this.expect(types._while);node.test=this.parseParenExpression();if(this.options.ecmaVersion>=6){this.eat(types.semi);}else{this.semicolon();}return this.finishNode(node,"DoWhileStatement");};// Disambiguating between a `for` and a `for`/`in` or `for`/`of`
// loop is non-trivial. Basically, we have to parse the init `var`
// statement or expression, disallowing the `in` operator (see
// the second parameter to `parseExpression`), and then check
// whether the next token is `in` or `of`. When there is no init
// part (semicolon immediately after the opening parenthesis), it
// is a regular `for` loop.
pp$1.parseForStatement=function(node){this.next();var awaitAt=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;this.labels.push(loopLabel);this.enterScope(0);this.expect(types.parenL);if(this.type===types.semi){if(awaitAt>-1){this.unexpected(awaitAt);}return this.parseFor(node,null);}var isLet=this.isLet();if(this.type===types._var||this.type===types._const||isLet){var init$1=this.startNode(),kind=isLet?"let":this.value;this.next();this.parseVar(init$1,true,kind);this.finishNode(init$1,"VariableDeclaration");if((this.type===types._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&init$1.declarations.length===1){if(this.options.ecmaVersion>=9){if(this.type===types._in){if(awaitAt>-1){this.unexpected(awaitAt);}}else{node["await"]=awaitAt>-1;}}return this.parseForIn(node,init$1);}if(awaitAt>-1){this.unexpected(awaitAt);}return this.parseFor(node,init$1);}var refDestructuringErrors=new DestructuringErrors();var init=this.parseExpression(true,refDestructuringErrors);if(this.type===types._in||this.options.ecmaVersion>=6&&this.isContextual("of")){if(this.options.ecmaVersion>=9){if(this.type===types._in){if(awaitAt>-1){this.unexpected(awaitAt);}}else{node["await"]=awaitAt>-1;}}this.toAssignable(init,false,refDestructuringErrors);this.checkLValPattern(init);return this.parseForIn(node,init);}else{this.checkExpressionErrors(refDestructuringErrors,true);}if(awaitAt>-1){this.unexpected(awaitAt);}return this.parseFor(node,init);};pp$1.parseFunctionStatement=function(node,isAsync,declarationPosition){this.next();return this.parseFunction(node,FUNC_STATEMENT|(declarationPosition?0:FUNC_HANGING_STATEMENT),false,isAsync);};pp$1.parseIfStatement=function(node){this.next();node.test=this.parseParenExpression();// allow function declarations in branches, but only in non-strict mode
node.consequent=this.parseStatement("if");node.alternate=this.eat(types._else)?this.parseStatement("if"):null;return this.finishNode(node,"IfStatement");};pp$1.parseReturnStatement=function(node){if(!this.inFunction&&!this.options.allowReturnOutsideFunction){this.raise(this.start,"'return' outside of function");}this.next();// In `return` (and `break`/`continue`), the keywords with
// optional arguments, we eagerly look for a semicolon or the
// possibility to insert one.
if(this.eat(types.semi)||this.insertSemicolon()){node.argument=null;}else{node.argument=this.parseExpression();this.semicolon();}return this.finishNode(node,"ReturnStatement");};pp$1.parseSwitchStatement=function(node){this.next();node.discriminant=this.parseParenExpression();node.cases=[];this.expect(types.braceL);this.labels.push(switchLabel);this.enterScope(0);// Statements under must be grouped (by label) in SwitchCase
// nodes. `cur` is used to keep the node that we are currently
// adding statements to.
var cur;for(var sawDefault=false;this.type!==types.braceR;){if(this.type===types._case||this.type===types._default){var isCase=this.type===types._case;if(cur){this.finishNode(cur,"SwitchCase");}node.cases.push(cur=this.startNode());cur.consequent=[];this.next();if(isCase){cur.test=this.parseExpression();}else{if(sawDefault){this.raiseRecoverable(this.lastTokStart,"Multiple default clauses");}sawDefault=true;cur.test=null;}this.expect(types.colon);}else{if(!cur){this.unexpected();}cur.consequent.push(this.parseStatement(null));}}this.exitScope();if(cur){this.finishNode(cur,"SwitchCase");}this.next();// Closing brace
this.labels.pop();return this.finishNode(node,"SwitchStatement");};pp$1.parseThrowStatement=function(node){this.next();if(lineBreak.test(this.input.slice(this.lastTokEnd,this.start))){this.raise(this.lastTokEnd,"Illegal newline after throw");}node.argument=this.parseExpression();this.semicolon();return this.finishNode(node,"ThrowStatement");};// Reused empty array added for node fields that are always empty.
var empty$1=[];pp$1.parseTryStatement=function(node){this.next();node.block=this.parseBlock();node.handler=null;if(this.type===types._catch){var clause=this.startNode();this.next();if(this.eat(types.parenL)){clause.param=this.parseBindingAtom();var simple=clause.param.type==="Identifier";this.enterScope(simple?SCOPE_SIMPLE_CATCH:0);this.checkLValPattern(clause.param,simple?BIND_SIMPLE_CATCH:BIND_LEXICAL);this.expect(types.parenR);}else{if(this.options.ecmaVersion<10){this.unexpected();}clause.param=null;this.enterScope(0);}clause.body=this.parseBlock(false);this.exitScope();node.handler=this.finishNode(clause,"CatchClause");}node.finalizer=this.eat(types._finally)?this.parseBlock():null;if(!node.handler&&!node.finalizer){this.raise(node.start,"Missing catch or finally clause");}return this.finishNode(node,"TryStatement");};pp$1.parseVarStatement=function(node,kind){this.next();this.parseVar(node,false,kind);this.semicolon();return this.finishNode(node,"VariableDeclaration");};pp$1.parseWhileStatement=function(node){this.next();node.test=this.parseParenExpression();this.labels.push(loopLabel);node.body=this.parseStatement("while");this.labels.pop();return this.finishNode(node,"WhileStatement");};pp$1.parseWithStatement=function(node){if(this.strict){this.raise(this.start,"'with' in strict mode");}this.next();node.object=this.parseParenExpression();node.body=this.parseStatement("with");return this.finishNode(node,"WithStatement");};pp$1.parseEmptyStatement=function(node){this.next();return this.finishNode(node,"EmptyStatement");};pp$1.parseLabeledStatement=function(node,maybeName,expr,context){for(var i$1=0,list=this.labels;i$1<list.length;i$1+=1){var label=list[i$1];if(label.name===maybeName){this.raise(expr.start,"Label '"+maybeName+"' is already declared");}}var kind=this.type.isLoop?"loop":this.type===types._switch?"switch":null;for(var i=this.labels.length-1;i>=0;i--){var label$1=this.labels[i];if(label$1.statementStart===node.start){// Update information about previous labels on this node
label$1.statementStart=this.start;label$1.kind=kind;}else{break;}}this.labels.push({name:maybeName,kind:kind,statementStart:this.start});node.body=this.parseStatement(context?context.indexOf("label")===-1?context+"label":context:"label");this.labels.pop();node.label=expr;return this.finishNode(node,"LabeledStatement");};pp$1.parseExpressionStatement=function(node,expr){node.expression=expr;this.semicolon();return this.finishNode(node,"ExpressionStatement");};// Parse a semicolon-enclosed block of statements, handling `"use
// strict"` declarations when `allowStrict` is true (used for
// function bodies).
pp$1.parseBlock=function(createNewLexicalScope,node,exitStrict){if(createNewLexicalScope===void 0)createNewLexicalScope=true;if(node===void 0)node=this.startNode();node.body=[];this.expect(types.braceL);if(createNewLexicalScope){this.enterScope(0);}while(this.type!==types.braceR){var stmt=this.parseStatement(null);node.body.push(stmt);}if(exitStrict){this.strict=false;}this.next();if(createNewLexicalScope){this.exitScope();}return this.finishNode(node,"BlockStatement");};// Parse a regular `for` loop. The disambiguation code in
// `parseStatement` will already have parsed the init statement or
// expression.
pp$1.parseFor=function(node,init){node.init=init;this.expect(types.semi);node.test=this.type===types.semi?null:this.parseExpression();this.expect(types.semi);node.update=this.type===types.parenR?null:this.parseExpression();this.expect(types.parenR);node.body=this.parseStatement("for");this.exitScope();this.labels.pop();return this.finishNode(node,"ForStatement");};// Parse a `for`/`in` and `for`/`of` loop, which are almost
// same from parser's perspective.
pp$1.parseForIn=function(node,init){var isForIn=this.type===types._in;this.next();if(init.type==="VariableDeclaration"&&init.declarations[0].init!=null&&(!isForIn||this.options.ecmaVersion<8||this.strict||init.kind!=="var"||init.declarations[0].id.type!=="Identifier")){this.raise(init.start,(isForIn?"for-in":"for-of")+" loop variable declaration may not have an initializer");}node.left=init;node.right=isForIn?this.parseExpression():this.parseMaybeAssign();this.expect(types.parenR);node.body=this.parseStatement("for");this.exitScope();this.labels.pop();return this.finishNode(node,isForIn?"ForInStatement":"ForOfStatement");};// Parse a list of variable declarations.
pp$1.parseVar=function(node,isFor,kind){node.declarations=[];node.kind=kind;for(;;){var decl=this.startNode();this.parseVarId(decl,kind);if(this.eat(types.eq)){decl.init=this.parseMaybeAssign(isFor);}else if(kind==="const"&&!(this.type===types._in||this.options.ecmaVersion>=6&&this.isContextual("of"))){this.unexpected();}else if(decl.id.type!=="Identifier"&&!(isFor&&(this.type===types._in||this.isContextual("of")))){this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value");}else{decl.init=null;}node.declarations.push(this.finishNode(decl,"VariableDeclarator"));if(!this.eat(types.comma)){break;}}return node;};pp$1.parseVarId=function(decl,kind){decl.id=this.parseBindingAtom();this.checkLValPattern(decl.id,kind==="var"?BIND_VAR:BIND_LEXICAL,false);};var FUNC_STATEMENT=1,FUNC_HANGING_STATEMENT=2,FUNC_NULLABLE_ID=4;// Parse a function declaration or literal (depending on the
// `statement & FUNC_STATEMENT`).
// Remove `allowExpressionBody` for 7.0.0, as it is only called with false
pp$1.parseFunction=function(node,statement,allowExpressionBody,isAsync){this.initFunction(node);if(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!isAsync){if(this.type===types.star&&statement&FUNC_HANGING_STATEMENT){this.unexpected();}node.generator=this.eat(types.star);}if(this.options.ecmaVersion>=8){node.async=!!isAsync;}if(statement&FUNC_STATEMENT){node.id=statement&FUNC_NULLABLE_ID&&this.type!==types.name?null:this.parseIdent();if(node.id&&!(statement&FUNC_HANGING_STATEMENT))// If it is a regular function declaration in sloppy mode, then it is
// subject to Annex B semantics (BIND_FUNCTION). Otherwise, the binding
// mode depends on properties of the current scope (see
// treatFunctionsAsVar).
{this.checkLValSimple(node.id,this.strict||node.generator||node.async?this.treatFunctionsAsVar?BIND_VAR:BIND_LEXICAL:BIND_FUNCTION);}}var oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;this.enterScope(functionFlags(node.async,node.generator));if(!(statement&FUNC_STATEMENT)){node.id=this.type===types.name?this.parseIdent():null;}this.parseFunctionParams(node);this.parseFunctionBody(node,allowExpressionBody,false);this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.finishNode(node,statement&FUNC_STATEMENT?"FunctionDeclaration":"FunctionExpression");};pp$1.parseFunctionParams=function(node){this.expect(types.parenL);node.params=this.parseBindingList(types.parenR,false,this.options.ecmaVersion>=8);this.checkYieldAwaitInDefaultParams();};// Parse a class declaration or literal (depending on the
// `isStatement` parameter).
pp$1.parseClass=function(node,isStatement){this.next();// ecma-262 14.6 Class Definitions
// A class definition is always strict mode code.
var oldStrict=this.strict;this.strict=true;this.parseClassId(node,isStatement);this.parseClassSuper(node);var classBody=this.startNode();var hadConstructor=false;classBody.body=[];this.expect(types.braceL);while(this.type!==types.braceR){var element=this.parseClassElement(node.superClass!==null);if(element){classBody.body.push(element);if(element.type==="MethodDefinition"&&element.kind==="constructor"){if(hadConstructor){this.raise(element.start,"Duplicate constructor in the same class");}hadConstructor=true;}}}this.strict=oldStrict;this.next();node.body=this.finishNode(classBody,"ClassBody");return this.finishNode(node,isStatement?"ClassDeclaration":"ClassExpression");};pp$1.parseClassElement=function(constructorAllowsSuper){var this$1=this;if(this.eat(types.semi)){return null;}var method=this.startNode();var tryContextual=function tryContextual(k,noLineBreak){if(noLineBreak===void 0)noLineBreak=false;var start=this$1.start,startLoc=this$1.startLoc;if(!this$1.eatContextual(k)){return false;}if(this$1.type!==types.parenL&&(!noLineBreak||!this$1.canInsertSemicolon())){return true;}if(method.key){this$1.unexpected();}method.computed=false;method.key=this$1.startNodeAt(start,startLoc);method.key.name=k;this$1.finishNode(method.key,"Identifier");return false;};method.kind="method";method["static"]=tryContextual("static");var isGenerator=this.eat(types.star);var isAsync=false;if(!isGenerator){if(this.options.ecmaVersion>=8&&tryContextual("async",true)){isAsync=true;isGenerator=this.options.ecmaVersion>=9&&this.eat(types.star);}else if(tryContextual("get")){method.kind="get";}else if(tryContextual("set")){method.kind="set";}}if(!method.key){this.parsePropertyName(method);}var key=method.key;var allowsDirectSuper=false;if(!method.computed&&!method["static"]&&(key.type==="Identifier"&&key.name==="constructor"||key.type==="Literal"&&key.value==="constructor")){if(method.kind!=="method"){this.raise(key.start,"Constructor can't have get/set modifier");}if(isGenerator){this.raise(key.start,"Constructor can't be a generator");}if(isAsync){this.raise(key.start,"Constructor can't be an async method");}method.kind="constructor";allowsDirectSuper=constructorAllowsSuper;}else if(method["static"]&&key.type==="Identifier"&&key.name==="prototype"){this.raise(key.start,"Classes may not have a static property named prototype");}this.parseClassMethod(method,isGenerator,isAsync,allowsDirectSuper);if(method.kind==="get"&&method.value.params.length!==0){this.raiseRecoverable(method.value.start,"getter should have no params");}if(method.kind==="set"&&method.value.params.length!==1){this.raiseRecoverable(method.value.start,"setter should have exactly one param");}if(method.kind==="set"&&method.value.params[0].type==="RestElement"){this.raiseRecoverable(method.value.params[0].start,"Setter cannot use rest params");}return method;};pp$1.parseClassMethod=function(method,isGenerator,isAsync,allowsDirectSuper){method.value=this.parseMethod(isGenerator,isAsync,allowsDirectSuper);return this.finishNode(method,"MethodDefinition");};pp$1.parseClassId=function(node,isStatement){if(this.type===types.name){node.id=this.parseIdent();if(isStatement){this.checkLValSimple(node.id,BIND_LEXICAL,false);}}else{if(isStatement===true){this.unexpected();}node.id=null;}};pp$1.parseClassSuper=function(node){node.superClass=this.eat(types._extends)?this.parseExprSubscripts():null;};// Parses module export declaration.
pp$1.parseExport=function(node,exports){this.next();// export * from '...'
if(this.eat(types.star)){if(this.options.ecmaVersion>=11){if(this.eatContextual("as")){node.exported=this.parseIdent(true);this.checkExport(exports,node.exported.name,this.lastTokStart);}else{node.exported=null;}}this.expectContextual("from");if(this.type!==types.string){this.unexpected();}node.source=this.parseExprAtom();this.semicolon();return this.finishNode(node,"ExportAllDeclaration");}if(this.eat(types._default)){// export default ...
this.checkExport(exports,"default",this.lastTokStart);var isAsync;if(this.type===types._function||(isAsync=this.isAsyncFunction())){var fNode=this.startNode();this.next();if(isAsync){this.next();}node.declaration=this.parseFunction(fNode,FUNC_STATEMENT|FUNC_NULLABLE_ID,false,isAsync);}else if(this.type===types._class){var cNode=this.startNode();node.declaration=this.parseClass(cNode,"nullableID");}else{node.declaration=this.parseMaybeAssign();this.semicolon();}return this.finishNode(node,"ExportDefaultDeclaration");}// export var|const|let|function|class ...
if(this.shouldParseExportStatement()){node.declaration=this.parseStatement(null);if(node.declaration.type==="VariableDeclaration"){this.checkVariableExport(exports,node.declaration.declarations);}else{this.checkExport(exports,node.declaration.id.name,node.declaration.id.start);}node.specifiers=[];node.source=null;}else{// export { x, y as z } [from '...']
node.declaration=null;node.specifiers=this.parseExportSpecifiers(exports);if(this.eatContextual("from")){if(this.type!==types.string){this.unexpected();}node.source=this.parseExprAtom();}else{for(var i=0,list=node.specifiers;i<list.length;i+=1){// check for keywords used as local names
var spec=list[i];this.checkUnreserved(spec.local);// check if export is defined
this.checkLocalExport(spec.local);}node.source=null;}this.semicolon();}return this.finishNode(node,"ExportNamedDeclaration");};pp$1.checkExport=function(exports,name,pos){if(!exports){return;}if(has$1(exports,name)){this.raiseRecoverable(pos,"Duplicate export '"+name+"'");}exports[name]=true;};pp$1.checkPatternExport=function(exports,pat){var type=pat.type;if(type==="Identifier"){this.checkExport(exports,pat.name,pat.start);}else if(type==="ObjectPattern"){for(var i=0,list=pat.properties;i<list.length;i+=1){var prop=list[i];this.checkPatternExport(exports,prop);}}else if(type==="ArrayPattern"){for(var i$1=0,list$1=pat.elements;i$1<list$1.length;i$1+=1){var elt=list$1[i$1];if(elt){this.checkPatternExport(exports,elt);}}}else if(type==="Property"){this.checkPatternExport(exports,pat.value);}else if(type==="AssignmentPattern"){this.checkPatternExport(exports,pat.left);}else if(type==="RestElement"){this.checkPatternExport(exports,pat.argument);}else if(type==="ParenthesizedExpression"){this.checkPatternExport(exports,pat.expression);}};pp$1.checkVariableExport=function(exports,decls){if(!exports){return;}for(var i=0,list=decls;i<list.length;i+=1){var decl=list[i];this.checkPatternExport(exports,decl.id);}};pp$1.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction();};// Parses a comma-separated list of module exports.
pp$1.parseExportSpecifiers=function(exports){var nodes=[],first=true;// export { x, y as z } [from '...']
this.expect(types.braceL);while(!this.eat(types.braceR)){if(!first){this.expect(types.comma);if(this.afterTrailingComma(types.braceR)){break;}}else{first=false;}var node=this.startNode();node.local=this.parseIdent(true);node.exported=this.eatContextual("as")?this.parseIdent(true):node.local;this.checkExport(exports,node.exported.name,node.exported.start);nodes.push(this.finishNode(node,"ExportSpecifier"));}return nodes;};// Parses import declaration.
pp$1.parseImport=function(node){this.next();// import '...'
if(this.type===types.string){node.specifiers=empty$1;node.source=this.parseExprAtom();}else{node.specifiers=this.parseImportSpecifiers();this.expectContextual("from");node.source=this.type===types.string?this.parseExprAtom():this.unexpected();}this.semicolon();return this.finishNode(node,"ImportDeclaration");};// Parses a comma-separated list of module imports.
pp$1.parseImportSpecifiers=function(){var nodes=[],first=true;if(this.type===types.name){// import defaultObj, { x, y as z } from '...'
var node=this.startNode();node.local=this.parseIdent();this.checkLValSimple(node.local,BIND_LEXICAL);nodes.push(this.finishNode(node,"ImportDefaultSpecifier"));if(!this.eat(types.comma)){return nodes;}}if(this.type===types.star){var node$1=this.startNode();this.next();this.expectContextual("as");node$1.local=this.parseIdent();this.checkLValSimple(node$1.local,BIND_LEXICAL);nodes.push(this.finishNode(node$1,"ImportNamespaceSpecifier"));return nodes;}this.expect(types.braceL);while(!this.eat(types.braceR)){if(!first){this.expect(types.comma);if(this.afterTrailingComma(types.braceR)){break;}}else{first=false;}var node$2=this.startNode();node$2.imported=this.parseIdent(true);if(this.eatContextual("as")){node$2.local=this.parseIdent();}else{this.checkUnreserved(node$2.imported);node$2.local=node$2.imported;}this.checkLValSimple(node$2.local,BIND_LEXICAL);nodes.push(this.finishNode(node$2,"ImportSpecifier"));}return nodes;};// Set `ExpressionStatement#directive` property for directive prologues.
pp$1.adaptDirectivePrologue=function(statements){for(var i=0;i<statements.length&&this.isDirectiveCandidate(statements[i]);++i){statements[i].directive=statements[i].expression.raw.slice(1,-1);}};pp$1.isDirectiveCandidate=function(statement){return statement.type==="ExpressionStatement"&&statement.expression.type==="Literal"&&typeof statement.expression.value==="string"&&(// Reject parenthesized strings.
this.input[statement.start]==="\""||this.input[statement.start]==="'");};var pp$2=Parser.prototype;// Convert existing expression atom to assignable pattern
// if possible.
pp$2.toAssignable=function(node,isBinding,refDestructuringErrors){if(this.options.ecmaVersion>=6&&node){switch(node.type){case"Identifier":if(this.inAsync&&node.name==="await"){this.raise(node.start,"Cannot use 'await' as identifier inside an async function");}break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":node.type="ObjectPattern";if(refDestructuringErrors){this.checkPatternErrors(refDestructuringErrors,true);}for(var i=0,list=node.properties;i<list.length;i+=1){var prop=list[i];this.toAssignable(prop,isBinding);// Early error:
//   AssignmentRestProperty[Yield, Await] :
//     `...` DestructuringAssignmentTarget[Yield, Await]
//
//   It is a Syntax Error if |DestructuringAssignmentTarget| is an |ArrayLiteral| or an |ObjectLiteral|.
if(prop.type==="RestElement"&&(prop.argument.type==="ArrayPattern"||prop.argument.type==="ObjectPattern")){this.raise(prop.argument.start,"Unexpected token");}}break;case"Property":// AssignmentProperty has type === "Property"
if(node.kind!=="init"){this.raise(node.key.start,"Object pattern can't contain getter or setter");}this.toAssignable(node.value,isBinding);break;case"ArrayExpression":node.type="ArrayPattern";if(refDestructuringErrors){this.checkPatternErrors(refDestructuringErrors,true);}this.toAssignableList(node.elements,isBinding);break;case"SpreadElement":node.type="RestElement";this.toAssignable(node.argument,isBinding);if(node.argument.type==="AssignmentPattern"){this.raise(node.argument.start,"Rest elements cannot have a default value");}break;case"AssignmentExpression":if(node.operator!=="="){this.raise(node.left.end,"Only '=' operator can be used for specifying default value.");}node.type="AssignmentPattern";delete node.operator;this.toAssignable(node.left,isBinding);break;case"ParenthesizedExpression":this.toAssignable(node.expression,isBinding,refDestructuringErrors);break;case"ChainExpression":this.raiseRecoverable(node.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!isBinding){break;}default:this.raise(node.start,"Assigning to rvalue");}}else if(refDestructuringErrors){this.checkPatternErrors(refDestructuringErrors,true);}return node;};// Convert list of expression atoms to binding list.
pp$2.toAssignableList=function(exprList,isBinding){var end=exprList.length;for(var i=0;i<end;i++){var elt=exprList[i];if(elt){this.toAssignable(elt,isBinding);}}if(end){var last=exprList[end-1];if(this.options.ecmaVersion===6&&isBinding&&last&&last.type==="RestElement"&&last.argument.type!=="Identifier"){this.unexpected(last.argument.start);}}return exprList;};// Parses spread element.
pp$2.parseSpread=function(refDestructuringErrors){var node=this.startNode();this.next();node.argument=this.parseMaybeAssign(false,refDestructuringErrors);return this.finishNode(node,"SpreadElement");};pp$2.parseRestBinding=function(){var node=this.startNode();this.next();// RestElement inside of a function parameter must be an identifier
if(this.options.ecmaVersion===6&&this.type!==types.name){this.unexpected();}node.argument=this.parseBindingAtom();return this.finishNode(node,"RestElement");};// Parses lvalue (assignable) atom.
pp$2.parseBindingAtom=function(){if(this.options.ecmaVersion>=6){switch(this.type){case types.bracketL:var node=this.startNode();this.next();node.elements=this.parseBindingList(types.bracketR,true,true);return this.finishNode(node,"ArrayPattern");case types.braceL:return this.parseObj(true);}}return this.parseIdent();};pp$2.parseBindingList=function(close,allowEmpty,allowTrailingComma){var elts=[],first=true;while(!this.eat(close)){if(first){first=false;}else{this.expect(types.comma);}if(allowEmpty&&this.type===types.comma){elts.push(null);}else if(allowTrailingComma&&this.afterTrailingComma(close)){break;}else if(this.type===types.ellipsis){var rest=this.parseRestBinding();this.parseBindingListItem(rest);elts.push(rest);if(this.type===types.comma){this.raise(this.start,"Comma is not permitted after the rest element");}this.expect(close);break;}else{var elem=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(elem);elts.push(elem);}}return elts;};pp$2.parseBindingListItem=function(param){return param;};// Parses assignment pattern around given atom if possible.
pp$2.parseMaybeDefault=function(startPos,startLoc,left){left=left||this.parseBindingAtom();if(this.options.ecmaVersion<6||!this.eat(types.eq)){return left;}var node=this.startNodeAt(startPos,startLoc);node.left=left;node.right=this.parseMaybeAssign();return this.finishNode(node,"AssignmentPattern");};// The following three functions all verify that a node is an lvalue —
// something that can be bound, or assigned to. In order to do so, they perform
// a variety of checks:
//
// - Check that none of the bound/assigned-to identifiers are reserved words.
// - Record name declarations for bindings in the appropriate scope.
// - Check duplicate argument names, if checkClashes is set.
//
// If a complex binding pattern is encountered (e.g., object and array
// destructuring), the entire pattern is recursively checked.
//
// There are three versions of checkLVal*() appropriate for different
// circumstances:
//
// - checkLValSimple() shall be used if the syntactic construct supports
//   nothing other than identifiers and member expressions. Parenthesized
//   expressions are also correctly handled. This is generally appropriate for
//   constructs for which the spec says
//
//   > It is a Syntax Error if AssignmentTargetType of [the production] is not
//   > simple.
//
//   It is also appropriate for checking if an identifier is valid and not
//   defined elsewhere, like import declarations or function/class identifiers.
//
//   Examples where this is used include:
//     a += …;
//     import a from '…';
//   where a is the node to be checked.
//
// - checkLValPattern() shall be used if the syntactic construct supports
//   anything checkLValSimple() supports, as well as object and array
//   destructuring patterns. This is generally appropriate for constructs for
//   which the spec says
//
//   > It is a Syntax Error if [the production] is neither an ObjectLiteral nor
//   > an ArrayLiteral and AssignmentTargetType of [the production] is not
//   > simple.
//
//   Examples where this is used include:
//     (a = …);
//     const a = …;
//     try { … } catch (a) { … }
//   where a is the node to be checked.
//
// - checkLValInnerPattern() shall be used if the syntactic construct supports
//   anything checkLValPattern() supports, as well as default assignment
//   patterns, rest elements, and other constructs that may appear within an
//   object or array destructuring pattern.
//
//   As a special case, function parameters also use checkLValInnerPattern(),
//   as they also support defaults and rest constructs.
//
// These functions deliberately support both assignment and binding constructs,
// as the logic for both is exceedingly similar. If the node is the target of
// an assignment, then bindingType should be set to BIND_NONE. Otherwise, it
// should be set to the appropriate BIND_* constant, like BIND_VAR or
// BIND_LEXICAL.
//
// If the function is called with a non-BIND_NONE bindingType, then
// additionally a checkClashes object may be specified to allow checking for
// duplicate argument names. checkClashes is ignored if the provided construct
// is an assignment (i.e., bindingType is BIND_NONE).
pp$2.checkLValSimple=function(expr,bindingType,checkClashes){if(bindingType===void 0)bindingType=BIND_NONE;var isBind=bindingType!==BIND_NONE;switch(expr.type){case"Identifier":if(this.strict&&this.reservedWordsStrictBind.test(expr.name)){this.raiseRecoverable(expr.start,(isBind?"Binding ":"Assigning to ")+expr.name+" in strict mode");}if(isBind){if(bindingType===BIND_LEXICAL&&expr.name==="let"){this.raiseRecoverable(expr.start,"let is disallowed as a lexically bound name");}if(checkClashes){if(has$1(checkClashes,expr.name)){this.raiseRecoverable(expr.start,"Argument name clash");}checkClashes[expr.name]=true;}if(bindingType!==BIND_OUTSIDE){this.declareName(expr.name,bindingType,expr.start);}}break;case"ChainExpression":this.raiseRecoverable(expr.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(isBind){this.raiseRecoverable(expr.start,"Binding member expression");}break;case"ParenthesizedExpression":if(isBind){this.raiseRecoverable(expr.start,"Binding parenthesized expression");}return this.checkLValSimple(expr.expression,bindingType,checkClashes);default:this.raise(expr.start,(isBind?"Binding":"Assigning to")+" rvalue");}};pp$2.checkLValPattern=function(expr,bindingType,checkClashes){if(bindingType===void 0)bindingType=BIND_NONE;switch(expr.type){case"ObjectPattern":for(var i=0,list=expr.properties;i<list.length;i+=1){var prop=list[i];this.checkLValInnerPattern(prop,bindingType,checkClashes);}break;case"ArrayPattern":for(var i$1=0,list$1=expr.elements;i$1<list$1.length;i$1+=1){var elem=list$1[i$1];if(elem){this.checkLValInnerPattern(elem,bindingType,checkClashes);}}break;default:this.checkLValSimple(expr,bindingType,checkClashes);}};pp$2.checkLValInnerPattern=function(expr,bindingType,checkClashes){if(bindingType===void 0)bindingType=BIND_NONE;switch(expr.type){case"Property":// AssignmentProperty has type === "Property"
this.checkLValInnerPattern(expr.value,bindingType,checkClashes);break;case"AssignmentPattern":this.checkLValPattern(expr.left,bindingType,checkClashes);break;case"RestElement":this.checkLValPattern(expr.argument,bindingType,checkClashes);break;default:this.checkLValPattern(expr,bindingType,checkClashes);}};// A recursive descent parser operates by defining functions for all
var pp$3=Parser.prototype;// Check if property name clashes with already added.
// Object/class getters and setters are not allowed to clash —
// either with each other or with an init property — and in
// strict mode, init properties are also not allowed to be repeated.
pp$3.checkPropClash=function(prop,propHash,refDestructuringErrors){if(this.options.ecmaVersion>=9&&prop.type==="SpreadElement"){return;}if(this.options.ecmaVersion>=6&&(prop.computed||prop.method||prop.shorthand)){return;}var key=prop.key;var name;switch(key.type){case"Identifier":name=key.name;break;case"Literal":name=String(key.value);break;default:return;}var kind=prop.kind;if(this.options.ecmaVersion>=6){if(name==="__proto__"&&kind==="init"){if(propHash.proto){if(refDestructuringErrors){if(refDestructuringErrors.doubleProto<0){refDestructuringErrors.doubleProto=key.start;}// Backwards-compat kludge. Can be removed in version 6.0
}else{this.raiseRecoverable(key.start,"Redefinition of __proto__ property");}}propHash.proto=true;}return;}name="$"+name;var other=propHash[name];if(other){var redefinition;if(kind==="init"){redefinition=this.strict&&other.init||other.get||other.set;}else{redefinition=other.init||other[kind];}if(redefinition){this.raiseRecoverable(key.start,"Redefinition of property");}}else{other=propHash[name]={init:false,get:false,set:false};}other[kind]=true;};// ### Expression parsing
// These nest, from the most general expression type at the top to
// 'atomic', nondivisible expression types at the bottom. Most of
// the functions will simply let the function(s) below them parse,
// and, *if* the syntactic construct they handle is present, wrap
// the AST node that the inner parser gave them in another node.
// Parse a full expression. The optional arguments are used to
// forbid the `in` operator (in for loops initalization expressions)
// and provide reference for storing '=' operator inside shorthand
// property assignment in contexts where both object expression
// and object pattern might appear (so it's possible to raise
// delayed syntax error at correct position).
pp$3.parseExpression=function(noIn,refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseMaybeAssign(noIn,refDestructuringErrors);if(this.type===types.comma){var node=this.startNodeAt(startPos,startLoc);node.expressions=[expr];while(this.eat(types.comma)){node.expressions.push(this.parseMaybeAssign(noIn,refDestructuringErrors));}return this.finishNode(node,"SequenceExpression");}return expr;};// Parse an assignment expression. This includes applications of
// operators like `+=`.
pp$3.parseMaybeAssign=function(noIn,refDestructuringErrors,afterLeftParse){if(this.isContextual("yield")){if(this.inGenerator){return this.parseYield(noIn);}// The tokenizer will assume an expression is allowed after
// `yield`, but this isn't that kind of yield
else{this.exprAllowed=false;}}var ownDestructuringErrors=false,oldParenAssign=-1,oldTrailingComma=-1;if(refDestructuringErrors){oldParenAssign=refDestructuringErrors.parenthesizedAssign;oldTrailingComma=refDestructuringErrors.trailingComma;refDestructuringErrors.parenthesizedAssign=refDestructuringErrors.trailingComma=-1;}else{refDestructuringErrors=new DestructuringErrors();ownDestructuringErrors=true;}var startPos=this.start,startLoc=this.startLoc;if(this.type===types.parenL||this.type===types.name){this.potentialArrowAt=this.start;}var left=this.parseMaybeConditional(noIn,refDestructuringErrors);if(afterLeftParse){left=afterLeftParse.call(this,left,startPos,startLoc);}if(this.type.isAssign){var node=this.startNodeAt(startPos,startLoc);node.operator=this.value;if(this.type===types.eq){left=this.toAssignable(left,false,refDestructuringErrors);}if(!ownDestructuringErrors){refDestructuringErrors.parenthesizedAssign=refDestructuringErrors.trailingComma=refDestructuringErrors.doubleProto=-1;}if(refDestructuringErrors.shorthandAssign>=left.start){refDestructuringErrors.shorthandAssign=-1;}// reset because shorthand default was used correctly
if(this.type===types.eq){this.checkLValPattern(left);}else{this.checkLValSimple(left);}node.left=left;this.next();node.right=this.parseMaybeAssign(noIn);return this.finishNode(node,"AssignmentExpression");}else{if(ownDestructuringErrors){this.checkExpressionErrors(refDestructuringErrors,true);}}if(oldParenAssign>-1){refDestructuringErrors.parenthesizedAssign=oldParenAssign;}if(oldTrailingComma>-1){refDestructuringErrors.trailingComma=oldTrailingComma;}return left;};// Parse a ternary conditional (`?:`) operator.
pp$3.parseMaybeConditional=function(noIn,refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseExprOps(noIn,refDestructuringErrors);if(this.checkExpressionErrors(refDestructuringErrors)){return expr;}if(this.eat(types.question)){var node=this.startNodeAt(startPos,startLoc);node.test=expr;node.consequent=this.parseMaybeAssign();this.expect(types.colon);node.alternate=this.parseMaybeAssign(noIn);return this.finishNode(node,"ConditionalExpression");}return expr;};// Start the precedence parser.
pp$3.parseExprOps=function(noIn,refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseMaybeUnary(refDestructuringErrors,false);if(this.checkExpressionErrors(refDestructuringErrors)){return expr;}return expr.start===startPos&&expr.type==="ArrowFunctionExpression"?expr:this.parseExprOp(expr,startPos,startLoc,-1,noIn);};// Parse binary operators with the operator precedence parsing
// algorithm. `left` is the left-hand side of the operator.
// `minPrec` provides context that allows the function to stop and
// defer further parser to one of its callers when it encounters an
// operator that has a lower precedence than the set it is parsing.
pp$3.parseExprOp=function(left,leftStartPos,leftStartLoc,minPrec,noIn){var prec=this.type.binop;if(prec!=null&&(!noIn||this.type!==types._in)){if(prec>minPrec){var logical=this.type===types.logicalOR||this.type===types.logicalAND;var coalesce=this.type===types.coalesce;if(coalesce){// Handle the precedence of `tt.coalesce` as equal to the range of logical expressions.
// In other words, `node.right` shouldn't contain logical expressions in order to check the mixed error.
prec=types.logicalAND.binop;}var op=this.value;this.next();var startPos=this.start,startLoc=this.startLoc;var right=this.parseExprOp(this.parseMaybeUnary(null,false),startPos,startLoc,prec,noIn);var node=this.buildBinary(leftStartPos,leftStartLoc,left,right,op,logical||coalesce);if(logical&&this.type===types.coalesce||coalesce&&(this.type===types.logicalOR||this.type===types.logicalAND)){this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses");}return this.parseExprOp(node,leftStartPos,leftStartLoc,minPrec,noIn);}}return left;};pp$3.buildBinary=function(startPos,startLoc,left,right,op,logical){var node=this.startNodeAt(startPos,startLoc);node.left=left;node.operator=op;node.right=right;return this.finishNode(node,logical?"LogicalExpression":"BinaryExpression");};// Parse unary operators, both prefix and postfix.
pp$3.parseMaybeUnary=function(refDestructuringErrors,sawUnary){var startPos=this.start,startLoc=this.startLoc,expr;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)){expr=this.parseAwait();sawUnary=true;}else if(this.type.prefix){var node=this.startNode(),update=this.type===types.incDec;node.operator=this.value;node.prefix=true;this.next();node.argument=this.parseMaybeUnary(null,true);this.checkExpressionErrors(refDestructuringErrors,true);if(update){this.checkLValSimple(node.argument);}else if(this.strict&&node.operator==="delete"&&node.argument.type==="Identifier"){this.raiseRecoverable(node.start,"Deleting local variable in strict mode");}else{sawUnary=true;}expr=this.finishNode(node,update?"UpdateExpression":"UnaryExpression");}else{expr=this.parseExprSubscripts(refDestructuringErrors);if(this.checkExpressionErrors(refDestructuringErrors)){return expr;}while(this.type.postfix&&!this.canInsertSemicolon()){var node$1=this.startNodeAt(startPos,startLoc);node$1.operator=this.value;node$1.prefix=false;node$1.argument=expr;this.checkLValSimple(expr);this.next();expr=this.finishNode(node$1,"UpdateExpression");}}if(!sawUnary&&this.eat(types.starstar)){return this.buildBinary(startPos,startLoc,expr,this.parseMaybeUnary(null,false),"**",false);}else{return expr;}};// Parse call, dot, and `[]`-subscript expressions.
pp$3.parseExprSubscripts=function(refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseExprAtom(refDestructuringErrors);if(expr.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")"){return expr;}var result=this.parseSubscripts(expr,startPos,startLoc);if(refDestructuringErrors&&result.type==="MemberExpression"){if(refDestructuringErrors.parenthesizedAssign>=result.start){refDestructuringErrors.parenthesizedAssign=-1;}if(refDestructuringErrors.parenthesizedBind>=result.start){refDestructuringErrors.parenthesizedBind=-1;}}return result;};pp$3.parseSubscripts=function(base,startPos,startLoc,noCalls){var maybeAsyncArrow=this.options.ecmaVersion>=8&&base.type==="Identifier"&&base.name==="async"&&this.lastTokEnd===base.end&&!this.canInsertSemicolon()&&base.end-base.start===5&&this.potentialArrowAt===base.start;var optionalChained=false;while(true){var element=this.parseSubscript(base,startPos,startLoc,noCalls,maybeAsyncArrow,optionalChained);if(element.optional){optionalChained=true;}if(element===base||element.type==="ArrowFunctionExpression"){if(optionalChained){var chainNode=this.startNodeAt(startPos,startLoc);chainNode.expression=element;element=this.finishNode(chainNode,"ChainExpression");}return element;}base=element;}};pp$3.parseSubscript=function(base,startPos,startLoc,noCalls,maybeAsyncArrow,optionalChained){var optionalSupported=this.options.ecmaVersion>=11;var optional=optionalSupported&&this.eat(types.questionDot);if(noCalls&&optional){this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");}var computed=this.eat(types.bracketL);if(computed||optional&&this.type!==types.parenL&&this.type!==types.backQuote||this.eat(types.dot)){var node=this.startNodeAt(startPos,startLoc);node.object=base;node.property=computed?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never");node.computed=!!computed;if(computed){this.expect(types.bracketR);}if(optionalSupported){node.optional=optional;}base=this.finishNode(node,"MemberExpression");}else if(!noCalls&&this.eat(types.parenL)){var refDestructuringErrors=new DestructuringErrors(),oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;var exprList=this.parseExprList(types.parenR,this.options.ecmaVersion>=8,false,refDestructuringErrors);if(maybeAsyncArrow&&!optional&&!this.canInsertSemicolon()&&this.eat(types.arrow)){this.checkPatternErrors(refDestructuringErrors,false);this.checkYieldAwaitInDefaultParams();if(this.awaitIdentPos>0){this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function");}this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),exprList,true);}this.checkExpressionErrors(refDestructuringErrors,true);this.yieldPos=oldYieldPos||this.yieldPos;this.awaitPos=oldAwaitPos||this.awaitPos;this.awaitIdentPos=oldAwaitIdentPos||this.awaitIdentPos;var node$1=this.startNodeAt(startPos,startLoc);node$1.callee=base;node$1.arguments=exprList;if(optionalSupported){node$1.optional=optional;}base=this.finishNode(node$1,"CallExpression");}else if(this.type===types.backQuote){if(optional||optionalChained){this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");}var node$2=this.startNodeAt(startPos,startLoc);node$2.tag=base;node$2.quasi=this.parseTemplate({isTagged:true});base=this.finishNode(node$2,"TaggedTemplateExpression");}return base;};// Parse an atomic expression — either a single token that is an
// expression, an expression started by a keyword like `function` or
// `new`, or an expression wrapped in punctuation like `()`, `[]`,
// or `{}`.
pp$3.parseExprAtom=function(refDestructuringErrors){// If a division operator appears in an expression position, the
// tokenizer got confused, and we force it to read a regexp instead.
if(this.type===types.slash){this.readRegexp();}var node,canBeArrow=this.potentialArrowAt===this.start;switch(this.type){case types._super:if(!this.allowSuper){this.raise(this.start,"'super' keyword outside a method");}node=this.startNode();this.next();if(this.type===types.parenL&&!this.allowDirectSuper){this.raise(node.start,"super() call outside constructor of a subclass");}// The `super` keyword can appear at below:
// SuperProperty:
//     super [ Expression ]
//     super . IdentifierName
// SuperCall:
//     super ( Arguments )
if(this.type!==types.dot&&this.type!==types.bracketL&&this.type!==types.parenL){this.unexpected();}return this.finishNode(node,"Super");case types._this:node=this.startNode();this.next();return this.finishNode(node,"ThisExpression");case types.name:var startPos=this.start,startLoc=this.startLoc,containsEsc=this.containsEsc;var id=this.parseIdent(false);if(this.options.ecmaVersion>=8&&!containsEsc&&id.name==="async"&&!this.canInsertSemicolon()&&this.eat(types._function)){return this.parseFunction(this.startNodeAt(startPos,startLoc),0,false,true);}if(canBeArrow&&!this.canInsertSemicolon()){if(this.eat(types.arrow)){return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),[id],false);}if(this.options.ecmaVersion>=8&&id.name==="async"&&this.type===types.name&&!containsEsc){id=this.parseIdent(false);if(this.canInsertSemicolon()||!this.eat(types.arrow)){this.unexpected();}return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),[id],true);}}return id;case types.regexp:var value=this.value;node=this.parseLiteral(value.value);node.regex={pattern:value.pattern,flags:value.flags};return node;case types.num:case types.string:return this.parseLiteral(this.value);case types._null:case types._true:case types._false:node=this.startNode();node.value=this.type===types._null?null:this.type===types._true;node.raw=this.type.keyword;this.next();return this.finishNode(node,"Literal");case types.parenL:var start=this.start,expr=this.parseParenAndDistinguishExpression(canBeArrow);if(refDestructuringErrors){if(refDestructuringErrors.parenthesizedAssign<0&&!this.isSimpleAssignTarget(expr)){refDestructuringErrors.parenthesizedAssign=start;}if(refDestructuringErrors.parenthesizedBind<0){refDestructuringErrors.parenthesizedBind=start;}}return expr;case types.bracketL:node=this.startNode();this.next();node.elements=this.parseExprList(types.bracketR,true,true,refDestructuringErrors);return this.finishNode(node,"ArrayExpression");case types.braceL:return this.parseObj(false,refDestructuringErrors);case types._function:node=this.startNode();this.next();return this.parseFunction(node,0);case types._class:return this.parseClass(this.startNode(),false);case types._new:return this.parseNew();case types.backQuote:return this.parseTemplate();case types._import:if(this.options.ecmaVersion>=11){return this.parseExprImport();}else{return this.unexpected();}default:this.unexpected();}};pp$3.parseExprImport=function(){var node=this.startNode();// Consume `import` as an identifier for `import.meta`.
// Because `this.parseIdent(true)` doesn't check escape sequences, it needs the check of `this.containsEsc`.
if(this.containsEsc){this.raiseRecoverable(this.start,"Escape sequence in keyword import");}var meta=this.parseIdent(true);switch(this.type){case types.parenL:return this.parseDynamicImport(node);case types.dot:node.meta=meta;return this.parseImportMeta(node);default:this.unexpected();}};pp$3.parseDynamicImport=function(node){this.next();// skip `(`
// Parse node.source.
node.source=this.parseMaybeAssign();// Verify ending.
if(!this.eat(types.parenR)){var errorPos=this.start;if(this.eat(types.comma)&&this.eat(types.parenR)){this.raiseRecoverable(errorPos,"Trailing comma is not allowed in import()");}else{this.unexpected(errorPos);}}return this.finishNode(node,"ImportExpression");};pp$3.parseImportMeta=function(node){this.next();// skip `.`
var containsEsc=this.containsEsc;node.property=this.parseIdent(true);if(node.property.name!=="meta"){this.raiseRecoverable(node.property.start,"The only valid meta property for import is 'import.meta'");}if(containsEsc){this.raiseRecoverable(node.start,"'import.meta' must not contain escaped characters");}if(this.options.sourceType!=="module"){this.raiseRecoverable(node.start,"Cannot use 'import.meta' outside a module");}return this.finishNode(node,"MetaProperty");};pp$3.parseLiteral=function(value){var node=this.startNode();node.value=value;node.raw=this.input.slice(this.start,this.end);if(node.raw.charCodeAt(node.raw.length-1)===110){node.bigint=node.raw.slice(0,-1).replace(/_/g,"");}this.next();return this.finishNode(node,"Literal");};pp$3.parseParenExpression=function(){this.expect(types.parenL);var val=this.parseExpression();this.expect(types.parenR);return val;};pp$3.parseParenAndDistinguishExpression=function(canBeArrow){var startPos=this.start,startLoc=this.startLoc,val,allowTrailingComma=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var innerStartPos=this.start,innerStartLoc=this.startLoc;var exprList=[],first=true,lastIsComma=false;var refDestructuringErrors=new DestructuringErrors(),oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,spreadStart;this.yieldPos=0;this.awaitPos=0;// Do not save awaitIdentPos to allow checking awaits nested in parameters
while(this.type!==types.parenR){first?first=false:this.expect(types.comma);if(allowTrailingComma&&this.afterTrailingComma(types.parenR,true)){lastIsComma=true;break;}else if(this.type===types.ellipsis){spreadStart=this.start;exprList.push(this.parseParenItem(this.parseRestBinding()));if(this.type===types.comma){this.raise(this.start,"Comma is not permitted after the rest element");}break;}else{exprList.push(this.parseMaybeAssign(false,refDestructuringErrors,this.parseParenItem));}}var innerEndPos=this.start,innerEndLoc=this.startLoc;this.expect(types.parenR);if(canBeArrow&&!this.canInsertSemicolon()&&this.eat(types.arrow)){this.checkPatternErrors(refDestructuringErrors,false);this.checkYieldAwaitInDefaultParams();this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;return this.parseParenArrowList(startPos,startLoc,exprList);}if(!exprList.length||lastIsComma){this.unexpected(this.lastTokStart);}if(spreadStart){this.unexpected(spreadStart);}this.checkExpressionErrors(refDestructuringErrors,true);this.yieldPos=oldYieldPos||this.yieldPos;this.awaitPos=oldAwaitPos||this.awaitPos;if(exprList.length>1){val=this.startNodeAt(innerStartPos,innerStartLoc);val.expressions=exprList;this.finishNodeAt(val,"SequenceExpression",innerEndPos,innerEndLoc);}else{val=exprList[0];}}else{val=this.parseParenExpression();}if(this.options.preserveParens){var par=this.startNodeAt(startPos,startLoc);par.expression=val;return this.finishNode(par,"ParenthesizedExpression");}else{return val;}};pp$3.parseParenItem=function(item){return item;};pp$3.parseParenArrowList=function(startPos,startLoc,exprList){return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),exprList);};// New's precedence is slightly tricky. It must allow its argument to
// be a `[]` or dot subscript expression, but not a call — at least,
// not without wrapping it in parentheses. Thus, it uses the noCalls
// argument to parseSubscripts to prevent it from consuming the
// argument list.
var empty$1$1=[];pp$3.parseNew=function(){if(this.containsEsc){this.raiseRecoverable(this.start,"Escape sequence in keyword new");}var node=this.startNode();var meta=this.parseIdent(true);if(this.options.ecmaVersion>=6&&this.eat(types.dot)){node.meta=meta;var containsEsc=this.containsEsc;node.property=this.parseIdent(true);if(node.property.name!=="target"){this.raiseRecoverable(node.property.start,"The only valid meta property for new is 'new.target'");}if(containsEsc){this.raiseRecoverable(node.start,"'new.target' must not contain escaped characters");}if(!this.inNonArrowFunction){this.raiseRecoverable(node.start,"'new.target' can only be used in functions");}return this.finishNode(node,"MetaProperty");}var startPos=this.start,startLoc=this.startLoc,isImport=this.type===types._import;node.callee=this.parseSubscripts(this.parseExprAtom(),startPos,startLoc,true);if(isImport&&node.callee.type==="ImportExpression"){this.raise(startPos,"Cannot use new with import()");}if(this.eat(types.parenL)){node.arguments=this.parseExprList(types.parenR,this.options.ecmaVersion>=8,false);}else{node.arguments=empty$1$1;}return this.finishNode(node,"NewExpression");};// Parse template expression.
pp$3.parseTemplateElement=function(ref){var isTagged=ref.isTagged;var elem=this.startNode();if(this.type===types.invalidTemplate){if(!isTagged){this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal");}elem.value={raw:this.value,cooked:null};}else{elem.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value};}this.next();elem.tail=this.type===types.backQuote;return this.finishNode(elem,"TemplateElement");};pp$3.parseTemplate=function(ref){if(ref===void 0)ref={};var isTagged=ref.isTagged;if(isTagged===void 0)isTagged=false;var node=this.startNode();this.next();node.expressions=[];var curElt=this.parseTemplateElement({isTagged:isTagged});node.quasis=[curElt];while(!curElt.tail){if(this.type===types.eof){this.raise(this.pos,"Unterminated template literal");}this.expect(types.dollarBraceL);node.expressions.push(this.parseExpression());this.expect(types.braceR);node.quasis.push(curElt=this.parseTemplateElement({isTagged:isTagged}));}this.next();return this.finishNode(node,"TemplateLiteral");};pp$3.isAsyncProp=function(prop){return!prop.computed&&prop.key.type==="Identifier"&&prop.key.name==="async"&&(this.type===types.name||this.type===types.num||this.type===types.string||this.type===types.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===types.star)&&!lineBreak.test(this.input.slice(this.lastTokEnd,this.start));};// Parse an object literal or binding pattern.
pp$3.parseObj=function(isPattern,refDestructuringErrors){var node=this.startNode(),first=true,propHash={};node.properties=[];this.next();while(!this.eat(types.braceR)){if(!first){this.expect(types.comma);if(this.options.ecmaVersion>=5&&this.afterTrailingComma(types.braceR)){break;}}else{first=false;}var prop=this.parseProperty(isPattern,refDestructuringErrors);if(!isPattern){this.checkPropClash(prop,propHash,refDestructuringErrors);}node.properties.push(prop);}return this.finishNode(node,isPattern?"ObjectPattern":"ObjectExpression");};pp$3.parseProperty=function(isPattern,refDestructuringErrors){var prop=this.startNode(),isGenerator,isAsync,startPos,startLoc;if(this.options.ecmaVersion>=9&&this.eat(types.ellipsis)){if(isPattern){prop.argument=this.parseIdent(false);if(this.type===types.comma){this.raise(this.start,"Comma is not permitted after the rest element");}return this.finishNode(prop,"RestElement");}// To disallow parenthesized identifier via `this.toAssignable()`.
if(this.type===types.parenL&&refDestructuringErrors){if(refDestructuringErrors.parenthesizedAssign<0){refDestructuringErrors.parenthesizedAssign=this.start;}if(refDestructuringErrors.parenthesizedBind<0){refDestructuringErrors.parenthesizedBind=this.start;}}// Parse argument.
prop.argument=this.parseMaybeAssign(false,refDestructuringErrors);// To disallow trailing comma via `this.toAssignable()`.
if(this.type===types.comma&&refDestructuringErrors&&refDestructuringErrors.trailingComma<0){refDestructuringErrors.trailingComma=this.start;}// Finish
return this.finishNode(prop,"SpreadElement");}if(this.options.ecmaVersion>=6){prop.method=false;prop.shorthand=false;if(isPattern||refDestructuringErrors){startPos=this.start;startLoc=this.startLoc;}if(!isPattern){isGenerator=this.eat(types.star);}}var containsEsc=this.containsEsc;this.parsePropertyName(prop);if(!isPattern&&!containsEsc&&this.options.ecmaVersion>=8&&!isGenerator&&this.isAsyncProp(prop)){isAsync=true;isGenerator=this.options.ecmaVersion>=9&&this.eat(types.star);this.parsePropertyName(prop,refDestructuringErrors);}else{isAsync=false;}this.parsePropertyValue(prop,isPattern,isGenerator,isAsync,startPos,startLoc,refDestructuringErrors,containsEsc);return this.finishNode(prop,"Property");};pp$3.parsePropertyValue=function(prop,isPattern,isGenerator,isAsync,startPos,startLoc,refDestructuringErrors,containsEsc){if((isGenerator||isAsync)&&this.type===types.colon){this.unexpected();}if(this.eat(types.colon)){prop.value=isPattern?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(false,refDestructuringErrors);prop.kind="init";}else if(this.options.ecmaVersion>=6&&this.type===types.parenL){if(isPattern){this.unexpected();}prop.kind="init";prop.method=true;prop.value=this.parseMethod(isGenerator,isAsync);}else if(!isPattern&&!containsEsc&&this.options.ecmaVersion>=5&&!prop.computed&&prop.key.type==="Identifier"&&(prop.key.name==="get"||prop.key.name==="set")&&this.type!==types.comma&&this.type!==types.braceR&&this.type!==types.eq){if(isGenerator||isAsync){this.unexpected();}prop.kind=prop.key.name;this.parsePropertyName(prop);prop.value=this.parseMethod(false);var paramCount=prop.kind==="get"?0:1;if(prop.value.params.length!==paramCount){var start=prop.value.start;if(prop.kind==="get"){this.raiseRecoverable(start,"getter should have no params");}else{this.raiseRecoverable(start,"setter should have exactly one param");}}else{if(prop.kind==="set"&&prop.value.params[0].type==="RestElement"){this.raiseRecoverable(prop.value.params[0].start,"Setter cannot use rest params");}}}else if(this.options.ecmaVersion>=6&&!prop.computed&&prop.key.type==="Identifier"){if(isGenerator||isAsync){this.unexpected();}this.checkUnreserved(prop.key);if(prop.key.name==="await"&&!this.awaitIdentPos){this.awaitIdentPos=startPos;}prop.kind="init";if(isPattern){prop.value=this.parseMaybeDefault(startPos,startLoc,this.copyNode(prop.key));}else if(this.type===types.eq&&refDestructuringErrors){if(refDestructuringErrors.shorthandAssign<0){refDestructuringErrors.shorthandAssign=this.start;}prop.value=this.parseMaybeDefault(startPos,startLoc,this.copyNode(prop.key));}else{prop.value=this.copyNode(prop.key);}prop.shorthand=true;}else{this.unexpected();}};pp$3.parsePropertyName=function(prop){if(this.options.ecmaVersion>=6){if(this.eat(types.bracketL)){prop.computed=true;prop.key=this.parseMaybeAssign();this.expect(types.bracketR);return prop.key;}else{prop.computed=false;}}return prop.key=this.type===types.num||this.type===types.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never");};// Initialize empty function node.
pp$3.initFunction=function(node){node.id=null;if(this.options.ecmaVersion>=6){node.generator=node.expression=false;}if(this.options.ecmaVersion>=8){node.async=false;}};// Parse object or class method.
pp$3.parseMethod=function(isGenerator,isAsync,allowDirectSuper){var node=this.startNode(),oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.initFunction(node);if(this.options.ecmaVersion>=6){node.generator=isGenerator;}if(this.options.ecmaVersion>=8){node.async=!!isAsync;}this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;this.enterScope(functionFlags(isAsync,node.generator)|SCOPE_SUPER|(allowDirectSuper?SCOPE_DIRECT_SUPER:0));this.expect(types.parenL);node.params=this.parseBindingList(types.parenR,false,this.options.ecmaVersion>=8);this.checkYieldAwaitInDefaultParams();this.parseFunctionBody(node,false,true);this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.finishNode(node,"FunctionExpression");};// Parse arrow function expression with given parameters.
pp$3.parseArrowExpression=function(node,params,isAsync){var oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.enterScope(functionFlags(isAsync,false)|SCOPE_ARROW);this.initFunction(node);if(this.options.ecmaVersion>=8){node.async=!!isAsync;}this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;node.params=this.toAssignableList(params,true);this.parseFunctionBody(node,true,false);this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.finishNode(node,"ArrowFunctionExpression");};// Parse function body and check parameters.
pp$3.parseFunctionBody=function(node,isArrowFunction,isMethod){var isExpression=isArrowFunction&&this.type!==types.braceL;var oldStrict=this.strict,useStrict=false;if(isExpression){node.body=this.parseMaybeAssign();node.expression=true;this.checkParams(node,false);}else{var nonSimple=this.options.ecmaVersion>=7&&!this.isSimpleParamList(node.params);if(!oldStrict||nonSimple){useStrict=this.strictDirective(this.end);// If this is a strict mode function, verify that argument names
// are not repeated, and it does not try to bind the words `eval`
// or `arguments`.
if(useStrict&&nonSimple){this.raiseRecoverable(node.start,"Illegal 'use strict' directive in function with non-simple parameter list");}}// Start a new scope with regard to labels and the `inFunction`
// flag (restore them to their old value afterwards).
var oldLabels=this.labels;this.labels=[];if(useStrict){this.strict=true;}// Add the params to varDeclaredNames to ensure that an error is thrown
// if a let/const declaration in the function clashes with one of the params.
this.checkParams(node,!oldStrict&&!useStrict&&!isArrowFunction&&!isMethod&&this.isSimpleParamList(node.params));// Ensure the function name isn't a forbidden identifier in strict mode, e.g. 'eval'
if(this.strict&&node.id){this.checkLValSimple(node.id,BIND_OUTSIDE);}node.body=this.parseBlock(false,undefined,useStrict&&!oldStrict);node.expression=false;this.adaptDirectivePrologue(node.body.body);this.labels=oldLabels;}this.exitScope();};pp$3.isSimpleParamList=function(params){for(var i=0,list=params;i<list.length;i+=1){var param=list[i];if(param.type!=="Identifier"){return false;}}return true;};// Checks function params for various disallowed patterns such as using "eval"
// or "arguments" and duplicate parameters.
pp$3.checkParams=function(node,allowDuplicates){var nameHash={};for(var i=0,list=node.params;i<list.length;i+=1){var param=list[i];this.checkLValInnerPattern(param,BIND_VAR,allowDuplicates?null:nameHash);}};// Parses a comma-separated list of expressions, and returns them as
// an array. `close` is the token type that ends the list, and
// `allowEmpty` can be turned on to allow subsequent commas with
// nothing in between them to be parsed as `null` (which is needed
// for array literals).
pp$3.parseExprList=function(close,allowTrailingComma,allowEmpty,refDestructuringErrors){var elts=[],first=true;while(!this.eat(close)){if(!first){this.expect(types.comma);if(allowTrailingComma&&this.afterTrailingComma(close)){break;}}else{first=false;}var elt=void 0;if(allowEmpty&&this.type===types.comma){elt=null;}else if(this.type===types.ellipsis){elt=this.parseSpread(refDestructuringErrors);if(refDestructuringErrors&&this.type===types.comma&&refDestructuringErrors.trailingComma<0){refDestructuringErrors.trailingComma=this.start;}}else{elt=this.parseMaybeAssign(false,refDestructuringErrors);}elts.push(elt);}return elts;};pp$3.checkUnreserved=function(ref){var start=ref.start;var end=ref.end;var name=ref.name;if(this.inGenerator&&name==="yield"){this.raiseRecoverable(start,"Cannot use 'yield' as identifier inside a generator");}if(this.inAsync&&name==="await"){this.raiseRecoverable(start,"Cannot use 'await' as identifier inside an async function");}if(this.keywords.test(name)){this.raise(start,"Unexpected keyword '"+name+"'");}if(this.options.ecmaVersion<6&&this.input.slice(start,end).indexOf("\\")!==-1){return;}var re=this.strict?this.reservedWordsStrict:this.reservedWords;if(re.test(name)){if(!this.inAsync&&name==="await"){this.raiseRecoverable(start,"Cannot use keyword 'await' outside an async function");}this.raiseRecoverable(start,"The keyword '"+name+"' is reserved");}};// Parse the next token as an identifier. If `liberal` is true (used
// when parsing properties), it will also convert keywords into
// identifiers.
pp$3.parseIdent=function(liberal,isBinding){var node=this.startNode();if(this.type===types.name){node.name=this.value;}else if(this.type.keyword){node.name=this.type.keyword;// To fix https://github.com/acornjs/acorn/issues/575
// `class` and `function` keywords push new context into this.context.
// But there is no chance to pop the context if the keyword is consumed as an identifier such as a property name.
// If the previous token is a dot, this does not apply because the context-managing code already ignored the keyword
if((node.name==="class"||node.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)){this.context.pop();}}else{this.unexpected();}this.next(!!liberal);this.finishNode(node,"Identifier");if(!liberal){this.checkUnreserved(node);if(node.name==="await"&&!this.awaitIdentPos){this.awaitIdentPos=node.start;}}return node;};// Parses yield expression inside generator.
pp$3.parseYield=function(noIn){if(!this.yieldPos){this.yieldPos=this.start;}var node=this.startNode();this.next();if(this.type===types.semi||this.canInsertSemicolon()||this.type!==types.star&&!this.type.startsExpr){node.delegate=false;node.argument=null;}else{node.delegate=this.eat(types.star);node.argument=this.parseMaybeAssign(noIn);}return this.finishNode(node,"YieldExpression");};pp$3.parseAwait=function(){if(!this.awaitPos){this.awaitPos=this.start;}var node=this.startNode();this.next();node.argument=this.parseMaybeUnary(null,true);return this.finishNode(node,"AwaitExpression");};var pp$4=Parser.prototype;// This function is used to raise exceptions on parse errors. It
// takes an offset integer (into the current `input`) to indicate
// the location of the error, attaches the position to the end
// of the error message, and then raises a `SyntaxError` with that
// message.
pp$4.raise=function(pos,message){var loc=getLineInfo(this.input,pos);message+=" ("+loc.line+":"+loc.column+")";var err=new SyntaxError(message);err.pos=pos;err.loc=loc;err.raisedAt=this.pos;throw err;};pp$4.raiseRecoverable=pp$4.raise;pp$4.curPosition=function(){if(this.options.locations){return new Position(this.curLine,this.pos-this.lineStart);}};var pp$5=Parser.prototype;var Scope=function Scope(flags){this.flags=flags;// A list of var-declared names in the current lexical scope
this["var"]=[];// A list of lexically-declared names in the current lexical scope
this.lexical=[];// A list of lexically-declared FunctionDeclaration names in the current lexical scope
this.functions=[];};// The functions in this module keep track of declared variables in the current scope in order to detect duplicate variable names.
pp$5.enterScope=function(flags){this.scopeStack.push(new Scope(flags));};pp$5.exitScope=function(){this.scopeStack.pop();};// The spec says:
// > At the top level of a function, or script, function declarations are
// > treated like var declarations rather than like lexical declarations.
pp$5.treatFunctionsAsVarInScope=function(scope){return scope.flags&SCOPE_FUNCTION||!this.inModule&&scope.flags&SCOPE_TOP;};pp$5.declareName=function(name,bindingType,pos){var redeclared=false;if(bindingType===BIND_LEXICAL){var scope=this.currentScope();redeclared=scope.lexical.indexOf(name)>-1||scope.functions.indexOf(name)>-1||scope["var"].indexOf(name)>-1;scope.lexical.push(name);if(this.inModule&&scope.flags&SCOPE_TOP){delete this.undefinedExports[name];}}else if(bindingType===BIND_SIMPLE_CATCH){var scope$1=this.currentScope();scope$1.lexical.push(name);}else if(bindingType===BIND_FUNCTION){var scope$2=this.currentScope();if(this.treatFunctionsAsVar){redeclared=scope$2.lexical.indexOf(name)>-1;}else{redeclared=scope$2.lexical.indexOf(name)>-1||scope$2["var"].indexOf(name)>-1;}scope$2.functions.push(name);}else{for(var i=this.scopeStack.length-1;i>=0;--i){var scope$3=this.scopeStack[i];if(scope$3.lexical.indexOf(name)>-1&&!(scope$3.flags&SCOPE_SIMPLE_CATCH&&scope$3.lexical[0]===name)||!this.treatFunctionsAsVarInScope(scope$3)&&scope$3.functions.indexOf(name)>-1){redeclared=true;break;}scope$3["var"].push(name);if(this.inModule&&scope$3.flags&SCOPE_TOP){delete this.undefinedExports[name];}if(scope$3.flags&SCOPE_VAR){break;}}}if(redeclared){this.raiseRecoverable(pos,"Identifier '"+name+"' has already been declared");}};pp$5.checkLocalExport=function(id){// scope.functions must be empty as Module code is always strict.
if(this.scopeStack[0].lexical.indexOf(id.name)===-1&&this.scopeStack[0]["var"].indexOf(id.name)===-1){this.undefinedExports[id.name]=id;}};pp$5.currentScope=function(){return this.scopeStack[this.scopeStack.length-1];};pp$5.currentVarScope=function(){for(var i=this.scopeStack.length-1;;i--){var scope=this.scopeStack[i];if(scope.flags&SCOPE_VAR){return scope;}}};// Could be useful for `this`, `new.target`, `super()`, `super.property`, and `super[property]`.
pp$5.currentThisScope=function(){for(var i=this.scopeStack.length-1;;i--){var scope=this.scopeStack[i];if(scope.flags&SCOPE_VAR&&!(scope.flags&SCOPE_ARROW)){return scope;}}};var Node=function Node(parser,pos,loc){this.type="";this.start=pos;this.end=0;if(parser.options.locations){this.loc=new SourceLocation(parser,loc);}if(parser.options.directSourceFile){this.sourceFile=parser.options.directSourceFile;}if(parser.options.ranges){this.range=[pos,0];}};// Start an AST node, attaching a start offset.
var pp$6=Parser.prototype;pp$6.startNode=function(){return new Node(this,this.start,this.startLoc);};pp$6.startNodeAt=function(pos,loc){return new Node(this,pos,loc);};// Finish an AST node, adding `type` and `end` properties.
function finishNodeAt(node,type,pos,loc){node.type=type;node.end=pos;if(this.options.locations){node.loc.end=loc;}if(this.options.ranges){node.range[1]=pos;}return node;}pp$6.finishNode=function(node,type){return finishNodeAt.call(this,node,type,this.lastTokEnd,this.lastTokEndLoc);};// Finish node at given position
pp$6.finishNodeAt=function(node,type,pos,loc){return finishNodeAt.call(this,node,type,pos,loc);};pp$6.copyNode=function(node){var newNode=new Node(this,node.start,this.startLoc);for(var prop in node){newNode[prop]=node[prop];}return newNode;};// The algorithm used to determine whether a regexp can appear at a
var TokContext=function TokContext(token,isExpr,preserveSpace,override,generator){this.token=token;this.isExpr=!!isExpr;this.preserveSpace=!!preserveSpace;this.override=override;this.generator=!!generator;};var types$1={b_stat:new TokContext("{",false),b_expr:new TokContext("{",true),b_tmpl:new TokContext("${",false),p_stat:new TokContext("(",false),p_expr:new TokContext("(",true),q_tmpl:new TokContext("`",true,true,function(p){return p.tryReadTemplateToken();}),f_stat:new TokContext("function",false),f_expr:new TokContext("function",true),f_expr_gen:new TokContext("function",true,false,null,true),f_gen:new TokContext("function",false,false,null,true)};var pp$7=Parser.prototype;pp$7.initialContext=function(){return[types$1.b_stat];};pp$7.braceIsBlock=function(prevType){var parent=this.curContext();if(parent===types$1.f_expr||parent===types$1.f_stat){return true;}if(prevType===types.colon&&(parent===types$1.b_stat||parent===types$1.b_expr)){return!parent.isExpr;}// The check for `tt.name && exprAllowed` detects whether we are
// after a `yield` or `of` construct. See the `updateContext` for
// `tt.name`.
if(prevType===types._return||prevType===types.name&&this.exprAllowed){return lineBreak.test(this.input.slice(this.lastTokEnd,this.start));}if(prevType===types._else||prevType===types.semi||prevType===types.eof||prevType===types.parenR||prevType===types.arrow){return true;}if(prevType===types.braceL){return parent===types$1.b_stat;}if(prevType===types._var||prevType===types._const||prevType===types.name){return false;}return!this.exprAllowed;};pp$7.inGeneratorContext=function(){for(var i=this.context.length-1;i>=1;i--){var context=this.context[i];if(context.token==="function"){return context.generator;}}return false;};pp$7.updateContext=function(prevType){var update,type=this.type;if(type.keyword&&prevType===types.dot){this.exprAllowed=false;}else if(update=type.updateContext){update.call(this,prevType);}else{this.exprAllowed=type.beforeExpr;}};// Token-specific context update code
types.parenR.updateContext=types.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=true;return;}var out=this.context.pop();if(out===types$1.b_stat&&this.curContext().token==="function"){out=this.context.pop();}this.exprAllowed=!out.isExpr;};types.braceL.updateContext=function(prevType){this.context.push(this.braceIsBlock(prevType)?types$1.b_stat:types$1.b_expr);this.exprAllowed=true;};types.dollarBraceL.updateContext=function(){this.context.push(types$1.b_tmpl);this.exprAllowed=true;};types.parenL.updateContext=function(prevType){var statementParens=prevType===types._if||prevType===types._for||prevType===types._with||prevType===types._while;this.context.push(statementParens?types$1.p_stat:types$1.p_expr);this.exprAllowed=true;};types.incDec.updateContext=function(){// tokExprAllowed stays unchanged
};types._function.updateContext=types._class.updateContext=function(prevType){if(prevType.beforeExpr&&prevType!==types._else&&!(prevType===types.semi&&this.curContext()!==types$1.p_stat)&&!(prevType===types._return&&lineBreak.test(this.input.slice(this.lastTokEnd,this.start)))&&!((prevType===types.colon||prevType===types.braceL)&&this.curContext()===types$1.b_stat)){this.context.push(types$1.f_expr);}else{this.context.push(types$1.f_stat);}this.exprAllowed=false;};types.backQuote.updateContext=function(){if(this.curContext()===types$1.q_tmpl){this.context.pop();}else{this.context.push(types$1.q_tmpl);}this.exprAllowed=false;};types.star.updateContext=function(prevType){if(prevType===types._function){var index=this.context.length-1;if(this.context[index]===types$1.f_expr){this.context[index]=types$1.f_expr_gen;}else{this.context[index]=types$1.f_gen;}}this.exprAllowed=true;};types.name.updateContext=function(prevType){var allowed=false;if(this.options.ecmaVersion>=6&&prevType!==types.dot){if(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext()){allowed=true;}}this.exprAllowed=allowed;};// This file contains Unicode properties extracted from the ECMAScript
// specification. The lists are extracted like so:
// $$('#table-binary-unicode-properties > figure > table > tbody > tr > td:nth-child(1) code').map(el => el.innerText)
// #table-binary-unicode-properties
var ecma9BinaryProperties="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS";var ecma10BinaryProperties=ecma9BinaryProperties+" Extended_Pictographic";var ecma11BinaryProperties=ecma10BinaryProperties;var ecma12BinaryProperties=ecma11BinaryProperties+" EBase EComp EMod EPres ExtPict";var unicodeBinaryProperties={9:ecma9BinaryProperties,10:ecma10BinaryProperties,11:ecma11BinaryProperties,12:ecma12BinaryProperties};// #table-unicode-general-category-values
var unicodeGeneralCategoryValues="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu";// #table-unicode-script-values
var ecma9ScriptValues="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb";var ecma10ScriptValues=ecma9ScriptValues+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd";var ecma11ScriptValues=ecma10ScriptValues+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho";var ecma12ScriptValues=ecma11ScriptValues+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi";var unicodeScriptValues={9:ecma9ScriptValues,10:ecma10ScriptValues,11:ecma11ScriptValues,12:ecma12ScriptValues};var data={};function buildUnicodeData(ecmaVersion){var d=data[ecmaVersion]={binary:wordsRegexp(unicodeBinaryProperties[ecmaVersion]+" "+unicodeGeneralCategoryValues),nonBinary:{General_Category:wordsRegexp(unicodeGeneralCategoryValues),Script:wordsRegexp(unicodeScriptValues[ecmaVersion])}};d.nonBinary.Script_Extensions=d.nonBinary.Script;d.nonBinary.gc=d.nonBinary.General_Category;d.nonBinary.sc=d.nonBinary.Script;d.nonBinary.scx=d.nonBinary.Script_Extensions;}buildUnicodeData(9);buildUnicodeData(10);buildUnicodeData(11);buildUnicodeData(12);var pp$8=Parser.prototype;var RegExpValidationState=function RegExpValidationState(parser){this.parser=parser;this.validFlags="gim"+(parser.options.ecmaVersion>=6?"uy":"")+(parser.options.ecmaVersion>=9?"s":"");this.unicodeProperties=data[parser.options.ecmaVersion>=12?12:parser.options.ecmaVersion];this.source="";this.flags="";this.start=0;this.switchU=false;this.switchN=false;this.pos=0;this.lastIntValue=0;this.lastStringValue="";this.lastAssertionIsQuantifiable=false;this.numCapturingParens=0;this.maxBackReference=0;this.groupNames=[];this.backReferenceNames=[];};RegExpValidationState.prototype.reset=function reset(start,pattern,flags){var unicode=flags.indexOf("u")!==-1;this.start=start|0;this.source=pattern+"";this.flags=flags;this.switchU=unicode&&this.parser.options.ecmaVersion>=6;this.switchN=unicode&&this.parser.options.ecmaVersion>=9;};RegExpValidationState.prototype.raise=function raise(message){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+message);};// If u flag is given, this returns the code point at the index (it combines a surrogate pair).
// Otherwise, this returns the code unit of the index (can be a part of a surrogate pair).
RegExpValidationState.prototype.at=function at(i,forceU){if(forceU===void 0)forceU=false;var s=this.source;var l=s.length;if(i>=l){return-1;}var c=s.charCodeAt(i);if(!(forceU||this.switchU)||c<=0xD7FF||c>=0xE000||i+1>=l){return c;}var next=s.charCodeAt(i+1);return next>=0xDC00&&next<=0xDFFF?(c<<10)+next-0x35FDC00:c;};RegExpValidationState.prototype.nextIndex=function nextIndex(i,forceU){if(forceU===void 0)forceU=false;var s=this.source;var l=s.length;if(i>=l){return l;}var c=s.charCodeAt(i),next;if(!(forceU||this.switchU)||c<=0xD7FF||c>=0xE000||i+1>=l||(next=s.charCodeAt(i+1))<0xDC00||next>0xDFFF){return i+1;}return i+2;};RegExpValidationState.prototype.current=function current(forceU){if(forceU===void 0)forceU=false;return this.at(this.pos,forceU);};RegExpValidationState.prototype.lookahead=function lookahead(forceU){if(forceU===void 0)forceU=false;return this.at(this.nextIndex(this.pos,forceU),forceU);};RegExpValidationState.prototype.advance=function advance(forceU){if(forceU===void 0)forceU=false;this.pos=this.nextIndex(this.pos,forceU);};RegExpValidationState.prototype.eat=function eat(ch,forceU){if(forceU===void 0)forceU=false;if(this.current(forceU)===ch){this.advance(forceU);return true;}return false;};function codePointToString(ch){if(ch<=0xFFFF){return String.fromCharCode(ch);}ch-=0x10000;return String.fromCharCode((ch>>10)+0xD800,(ch&0x03FF)+0xDC00);}/**
 * Validate the flags part of a given RegExpLiteral.
 *
 * @param {RegExpValidationState} state The state to validate RegExp.
 * @returns {void}
 */pp$8.validateRegExpFlags=function(state){var validFlags=state.validFlags;var flags=state.flags;for(var i=0;i<flags.length;i++){var flag=flags.charAt(i);if(validFlags.indexOf(flag)===-1){this.raise(state.start,"Invalid regular expression flag");}if(flags.indexOf(flag,i+1)>-1){this.raise(state.start,"Duplicate regular expression flag");}}};/**
 * Validate the pattern part of a given RegExpLiteral.
 *
 * @param {RegExpValidationState} state The state to validate RegExp.
 * @returns {void}
 */pp$8.validateRegExpPattern=function(state){this.regexp_pattern(state);// The goal symbol for the parse is |Pattern[~U, ~N]|. If the result of
// parsing contains a |GroupName|, reparse with the goal symbol
// |Pattern[~U, +N]| and use this result instead. Throw a *SyntaxError*
// exception if _P_ did not conform to the grammar, if any elements of _P_
// were not matched by the parse, or if any Early Error conditions exist.
if(!state.switchN&&this.options.ecmaVersion>=9&&state.groupNames.length>0){state.switchN=true;this.regexp_pattern(state);}};// https://www.ecma-international.org/ecma-262/8.0/#prod-Pattern
pp$8.regexp_pattern=function(state){state.pos=0;state.lastIntValue=0;state.lastStringValue="";state.lastAssertionIsQuantifiable=false;state.numCapturingParens=0;state.maxBackReference=0;state.groupNames.length=0;state.backReferenceNames.length=0;this.regexp_disjunction(state);if(state.pos!==state.source.length){// Make the same messages as V8.
if(state.eat(0x29/* ) */)){state.raise("Unmatched ')'");}if(state.eat(0x5D/* ] */)||state.eat(0x7D/* } */)){state.raise("Lone quantifier brackets");}}if(state.maxBackReference>state.numCapturingParens){state.raise("Invalid escape");}for(var i=0,list=state.backReferenceNames;i<list.length;i+=1){var name=list[i];if(state.groupNames.indexOf(name)===-1){state.raise("Invalid named capture referenced");}}};// https://www.ecma-international.org/ecma-262/8.0/#prod-Disjunction
pp$8.regexp_disjunction=function(state){this.regexp_alternative(state);while(state.eat(0x7C/* | */)){this.regexp_alternative(state);}// Make the same message as V8.
if(this.regexp_eatQuantifier(state,true)){state.raise("Nothing to repeat");}if(state.eat(0x7B/* { */)){state.raise("Lone quantifier brackets");}};// https://www.ecma-international.org/ecma-262/8.0/#prod-Alternative
pp$8.regexp_alternative=function(state){while(state.pos<state.source.length&&this.regexp_eatTerm(state)){}};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-Term
pp$8.regexp_eatTerm=function(state){if(this.regexp_eatAssertion(state)){// Handle `QuantifiableAssertion Quantifier` alternative.
// `state.lastAssertionIsQuantifiable` is true if the last eaten Assertion
// is a QuantifiableAssertion.
if(state.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(state)){// Make the same message as V8.
if(state.switchU){state.raise("Invalid quantifier");}}return true;}if(state.switchU?this.regexp_eatAtom(state):this.regexp_eatExtendedAtom(state)){this.regexp_eatQuantifier(state);return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-Assertion
pp$8.regexp_eatAssertion=function(state){var start=state.pos;state.lastAssertionIsQuantifiable=false;// ^, $
if(state.eat(0x5E/* ^ */)||state.eat(0x24/* $ */)){return true;}// \b \B
if(state.eat(0x5C/* \ */)){if(state.eat(0x42/* B */)||state.eat(0x62/* b */)){return true;}state.pos=start;}// Lookahead / Lookbehind
if(state.eat(0x28/* ( */)&&state.eat(0x3F/* ? */)){var lookbehind=false;if(this.options.ecmaVersion>=9){lookbehind=state.eat(0x3C/* < */);}if(state.eat(0x3D/* = */)||state.eat(0x21/* ! */)){this.regexp_disjunction(state);if(!state.eat(0x29/* ) */)){state.raise("Unterminated group");}state.lastAssertionIsQuantifiable=!lookbehind;return true;}}state.pos=start;return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-Quantifier
pp$8.regexp_eatQuantifier=function(state,noError){if(noError===void 0)noError=false;if(this.regexp_eatQuantifierPrefix(state,noError)){state.eat(0x3F/* ? */);return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-QuantifierPrefix
pp$8.regexp_eatQuantifierPrefix=function(state,noError){return state.eat(0x2A/* * */)||state.eat(0x2B/* + */)||state.eat(0x3F/* ? */)||this.regexp_eatBracedQuantifier(state,noError);};pp$8.regexp_eatBracedQuantifier=function(state,noError){var start=state.pos;if(state.eat(0x7B/* { */)){var min=0,max=-1;if(this.regexp_eatDecimalDigits(state)){min=state.lastIntValue;if(state.eat(0x2C/* , */)&&this.regexp_eatDecimalDigits(state)){max=state.lastIntValue;}if(state.eat(0x7D/* } */)){// SyntaxError in https://www.ecma-international.org/ecma-262/8.0/#sec-term
if(max!==-1&&max<min&&!noError){state.raise("numbers out of order in {} quantifier");}return true;}}if(state.switchU&&!noError){state.raise("Incomplete quantifier");}state.pos=start;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-Atom
pp$8.regexp_eatAtom=function(state){return this.regexp_eatPatternCharacters(state)||state.eat(0x2E/* . */)||this.regexp_eatReverseSolidusAtomEscape(state)||this.regexp_eatCharacterClass(state)||this.regexp_eatUncapturingGroup(state)||this.regexp_eatCapturingGroup(state);};pp$8.regexp_eatReverseSolidusAtomEscape=function(state){var start=state.pos;if(state.eat(0x5C/* \ */)){if(this.regexp_eatAtomEscape(state)){return true;}state.pos=start;}return false;};pp$8.regexp_eatUncapturingGroup=function(state){var start=state.pos;if(state.eat(0x28/* ( */)){if(state.eat(0x3F/* ? */)&&state.eat(0x3A/* : */)){this.regexp_disjunction(state);if(state.eat(0x29/* ) */)){return true;}state.raise("Unterminated group");}state.pos=start;}return false;};pp$8.regexp_eatCapturingGroup=function(state){if(state.eat(0x28/* ( */)){if(this.options.ecmaVersion>=9){this.regexp_groupSpecifier(state);}else if(state.current()===0x3F/* ? */){state.raise("Invalid group");}this.regexp_disjunction(state);if(state.eat(0x29/* ) */)){state.numCapturingParens+=1;return true;}state.raise("Unterminated group");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ExtendedAtom
pp$8.regexp_eatExtendedAtom=function(state){return state.eat(0x2E/* . */)||this.regexp_eatReverseSolidusAtomEscape(state)||this.regexp_eatCharacterClass(state)||this.regexp_eatUncapturingGroup(state)||this.regexp_eatCapturingGroup(state)||this.regexp_eatInvalidBracedQuantifier(state)||this.regexp_eatExtendedPatternCharacter(state);};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-InvalidBracedQuantifier
pp$8.regexp_eatInvalidBracedQuantifier=function(state){if(this.regexp_eatBracedQuantifier(state,true)){state.raise("Nothing to repeat");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-SyntaxCharacter
pp$8.regexp_eatSyntaxCharacter=function(state){var ch=state.current();if(isSyntaxCharacter(ch)){state.lastIntValue=ch;state.advance();return true;}return false;};function isSyntaxCharacter(ch){return ch===0x24/* $ */||ch>=0x28/* ( */&&ch<=0x2B/* + */||ch===0x2E/* . */||ch===0x3F/* ? */||ch>=0x5B/* [ */&&ch<=0x5E/* ^ */||ch>=0x7B/* { */&&ch<=0x7D/* } */;}// https://www.ecma-international.org/ecma-262/8.0/#prod-PatternCharacter
// But eat eager.
pp$8.regexp_eatPatternCharacters=function(state){var start=state.pos;var ch=0;while((ch=state.current())!==-1&&!isSyntaxCharacter(ch)){state.advance();}return state.pos!==start;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ExtendedPatternCharacter
pp$8.regexp_eatExtendedPatternCharacter=function(state){var ch=state.current();if(ch!==-1&&ch!==0x24/* $ */&&!(ch>=0x28/* ( */&&ch<=0x2B/* + */)&&ch!==0x2E/* . */&&ch!==0x3F/* ? */&&ch!==0x5B/* [ */&&ch!==0x5E/* ^ */&&ch!==0x7C/* | */){state.advance();return true;}return false;};// GroupSpecifier ::
//   [empty]
//   `?` GroupName
pp$8.regexp_groupSpecifier=function(state){if(state.eat(0x3F/* ? */)){if(this.regexp_eatGroupName(state)){if(state.groupNames.indexOf(state.lastStringValue)!==-1){state.raise("Duplicate capture group name");}state.groupNames.push(state.lastStringValue);return;}state.raise("Invalid group");}};// GroupName ::
//   `<` RegExpIdentifierName `>`
// Note: this updates `state.lastStringValue` property with the eaten name.
pp$8.regexp_eatGroupName=function(state){state.lastStringValue="";if(state.eat(0x3C/* < */)){if(this.regexp_eatRegExpIdentifierName(state)&&state.eat(0x3E/* > */)){return true;}state.raise("Invalid capture group name");}return false;};// RegExpIdentifierName ::
//   RegExpIdentifierStart
//   RegExpIdentifierName RegExpIdentifierPart
// Note: this updates `state.lastStringValue` property with the eaten name.
pp$8.regexp_eatRegExpIdentifierName=function(state){state.lastStringValue="";if(this.regexp_eatRegExpIdentifierStart(state)){state.lastStringValue+=codePointToString(state.lastIntValue);while(this.regexp_eatRegExpIdentifierPart(state)){state.lastStringValue+=codePointToString(state.lastIntValue);}return true;}return false;};// RegExpIdentifierStart ::
//   UnicodeIDStart
//   `$`
//   `_`
//   `\` RegExpUnicodeEscapeSequence[+U]
pp$8.regexp_eatRegExpIdentifierStart=function(state){var start=state.pos;var forceU=this.options.ecmaVersion>=11;var ch=state.current(forceU);state.advance(forceU);if(ch===0x5C/* \ */&&this.regexp_eatRegExpUnicodeEscapeSequence(state,forceU)){ch=state.lastIntValue;}if(isRegExpIdentifierStart(ch)){state.lastIntValue=ch;return true;}state.pos=start;return false;};function isRegExpIdentifierStart(ch){return isIdentifierStart(ch,true)||ch===0x24/* $ */||ch===0x5F;/* _ */}// RegExpIdentifierPart ::
//   UnicodeIDContinue
//   `$`
//   `_`
//   `\` RegExpUnicodeEscapeSequence[+U]
//   <ZWNJ>
//   <ZWJ>
pp$8.regexp_eatRegExpIdentifierPart=function(state){var start=state.pos;var forceU=this.options.ecmaVersion>=11;var ch=state.current(forceU);state.advance(forceU);if(ch===0x5C/* \ */&&this.regexp_eatRegExpUnicodeEscapeSequence(state,forceU)){ch=state.lastIntValue;}if(isRegExpIdentifierPart(ch)){state.lastIntValue=ch;return true;}state.pos=start;return false;};function isRegExpIdentifierPart(ch){return isIdentifierChar(ch,true)||ch===0x24/* $ */||ch===0x5F/* _ */||ch===0x200C/* <ZWNJ> */||ch===0x200D;/* <ZWJ> */}// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-AtomEscape
pp$8.regexp_eatAtomEscape=function(state){if(this.regexp_eatBackReference(state)||this.regexp_eatCharacterClassEscape(state)||this.regexp_eatCharacterEscape(state)||state.switchN&&this.regexp_eatKGroupName(state)){return true;}if(state.switchU){// Make the same message as V8.
if(state.current()===0x63/* c */){state.raise("Invalid unicode escape");}state.raise("Invalid escape");}return false;};pp$8.regexp_eatBackReference=function(state){var start=state.pos;if(this.regexp_eatDecimalEscape(state)){var n=state.lastIntValue;if(state.switchU){// For SyntaxError in https://www.ecma-international.org/ecma-262/8.0/#sec-atomescape
if(n>state.maxBackReference){state.maxBackReference=n;}return true;}if(n<=state.numCapturingParens){return true;}state.pos=start;}return false;};pp$8.regexp_eatKGroupName=function(state){if(state.eat(0x6B/* k */)){if(this.regexp_eatGroupName(state)){state.backReferenceNames.push(state.lastStringValue);return true;}state.raise("Invalid named reference");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-CharacterEscape
pp$8.regexp_eatCharacterEscape=function(state){return this.regexp_eatControlEscape(state)||this.regexp_eatCControlLetter(state)||this.regexp_eatZero(state)||this.regexp_eatHexEscapeSequence(state)||this.regexp_eatRegExpUnicodeEscapeSequence(state,false)||!state.switchU&&this.regexp_eatLegacyOctalEscapeSequence(state)||this.regexp_eatIdentityEscape(state);};pp$8.regexp_eatCControlLetter=function(state){var start=state.pos;if(state.eat(0x63/* c */)){if(this.regexp_eatControlLetter(state)){return true;}state.pos=start;}return false;};pp$8.regexp_eatZero=function(state){if(state.current()===0x30/* 0 */&&!isDecimalDigit(state.lookahead())){state.lastIntValue=0;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-ControlEscape
pp$8.regexp_eatControlEscape=function(state){var ch=state.current();if(ch===0x74/* t */){state.lastIntValue=0x09;/* \t */state.advance();return true;}if(ch===0x6E/* n */){state.lastIntValue=0x0A;/* \n */state.advance();return true;}if(ch===0x76/* v */){state.lastIntValue=0x0B;/* \v */state.advance();return true;}if(ch===0x66/* f */){state.lastIntValue=0x0C;/* \f */state.advance();return true;}if(ch===0x72/* r */){state.lastIntValue=0x0D;/* \r */state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-ControlLetter
pp$8.regexp_eatControlLetter=function(state){var ch=state.current();if(isControlLetter(ch)){state.lastIntValue=ch%0x20;state.advance();return true;}return false;};function isControlLetter(ch){return ch>=0x41/* A */&&ch<=0x5A/* Z */||ch>=0x61/* a */&&ch<=0x7A/* z */;}// https://www.ecma-international.org/ecma-262/8.0/#prod-RegExpUnicodeEscapeSequence
pp$8.regexp_eatRegExpUnicodeEscapeSequence=function(state,forceU){if(forceU===void 0)forceU=false;var start=state.pos;var switchU=forceU||state.switchU;if(state.eat(0x75/* u */)){if(this.regexp_eatFixedHexDigits(state,4)){var lead=state.lastIntValue;if(switchU&&lead>=0xD800&&lead<=0xDBFF){var leadSurrogateEnd=state.pos;if(state.eat(0x5C/* \ */)&&state.eat(0x75/* u */)&&this.regexp_eatFixedHexDigits(state,4)){var trail=state.lastIntValue;if(trail>=0xDC00&&trail<=0xDFFF){state.lastIntValue=(lead-0xD800)*0x400+(trail-0xDC00)+0x10000;return true;}}state.pos=leadSurrogateEnd;state.lastIntValue=lead;}return true;}if(switchU&&state.eat(0x7B/* { */)&&this.regexp_eatHexDigits(state)&&state.eat(0x7D/* } */)&&isValidUnicode(state.lastIntValue)){return true;}if(switchU){state.raise("Invalid unicode escape");}state.pos=start;}return false;};function isValidUnicode(ch){return ch>=0&&ch<=0x10FFFF;}// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-IdentityEscape
pp$8.regexp_eatIdentityEscape=function(state){if(state.switchU){if(this.regexp_eatSyntaxCharacter(state)){return true;}if(state.eat(0x2F/* / */)){state.lastIntValue=0x2F;/* / */return true;}return false;}var ch=state.current();if(ch!==0x63/* c */&&(!state.switchN||ch!==0x6B/* k */)){state.lastIntValue=ch;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-DecimalEscape
pp$8.regexp_eatDecimalEscape=function(state){state.lastIntValue=0;var ch=state.current();if(ch>=0x31/* 1 */&&ch<=0x39/* 9 */){do{state.lastIntValue=10*state.lastIntValue+(ch-0x30/* 0 */);state.advance();}while((ch=state.current())>=0x30/* 0 */&&ch<=0x39/* 9 */);return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-CharacterClassEscape
pp$8.regexp_eatCharacterClassEscape=function(state){var ch=state.current();if(isCharacterClassEscape(ch)){state.lastIntValue=-1;state.advance();return true;}if(state.switchU&&this.options.ecmaVersion>=9&&(ch===0x50/* P */||ch===0x70/* p */)){state.lastIntValue=-1;state.advance();if(state.eat(0x7B/* { */)&&this.regexp_eatUnicodePropertyValueExpression(state)&&state.eat(0x7D/* } */)){return true;}state.raise("Invalid property name");}return false;};function isCharacterClassEscape(ch){return ch===0x64/* d */||ch===0x44/* D */||ch===0x73/* s */||ch===0x53/* S */||ch===0x77/* w */||ch===0x57/* W */;}// UnicodePropertyValueExpression ::
//   UnicodePropertyName `=` UnicodePropertyValue
//   LoneUnicodePropertyNameOrValue
pp$8.regexp_eatUnicodePropertyValueExpression=function(state){var start=state.pos;// UnicodePropertyName `=` UnicodePropertyValue
if(this.regexp_eatUnicodePropertyName(state)&&state.eat(0x3D/* = */)){var name=state.lastStringValue;if(this.regexp_eatUnicodePropertyValue(state)){var value=state.lastStringValue;this.regexp_validateUnicodePropertyNameAndValue(state,name,value);return true;}}state.pos=start;// LoneUnicodePropertyNameOrValue
if(this.regexp_eatLoneUnicodePropertyNameOrValue(state)){var nameOrValue=state.lastStringValue;this.regexp_validateUnicodePropertyNameOrValue(state,nameOrValue);return true;}return false;};pp$8.regexp_validateUnicodePropertyNameAndValue=function(state,name,value){if(!has$1(state.unicodeProperties.nonBinary,name)){state.raise("Invalid property name");}if(!state.unicodeProperties.nonBinary[name].test(value)){state.raise("Invalid property value");}};pp$8.regexp_validateUnicodePropertyNameOrValue=function(state,nameOrValue){if(!state.unicodeProperties.binary.test(nameOrValue)){state.raise("Invalid property name");}};// UnicodePropertyName ::
//   UnicodePropertyNameCharacters
pp$8.regexp_eatUnicodePropertyName=function(state){var ch=0;state.lastStringValue="";while(isUnicodePropertyNameCharacter(ch=state.current())){state.lastStringValue+=codePointToString(ch);state.advance();}return state.lastStringValue!=="";};function isUnicodePropertyNameCharacter(ch){return isControlLetter(ch)||ch===0x5F;/* _ */}// UnicodePropertyValue ::
//   UnicodePropertyValueCharacters
pp$8.regexp_eatUnicodePropertyValue=function(state){var ch=0;state.lastStringValue="";while(isUnicodePropertyValueCharacter(ch=state.current())){state.lastStringValue+=codePointToString(ch);state.advance();}return state.lastStringValue!=="";};function isUnicodePropertyValueCharacter(ch){return isUnicodePropertyNameCharacter(ch)||isDecimalDigit(ch);}// LoneUnicodePropertyNameOrValue ::
//   UnicodePropertyValueCharacters
pp$8.regexp_eatLoneUnicodePropertyNameOrValue=function(state){return this.regexp_eatUnicodePropertyValue(state);};// https://www.ecma-international.org/ecma-262/8.0/#prod-CharacterClass
pp$8.regexp_eatCharacterClass=function(state){if(state.eat(0x5B/* [ */)){state.eat(0x5E/* ^ */);this.regexp_classRanges(state);if(state.eat(0x5D/* ] */)){return true;}// Unreachable since it threw "unterminated regular expression" error before.
state.raise("Unterminated character class");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-ClassRanges
// https://www.ecma-international.org/ecma-262/8.0/#prod-NonemptyClassRanges
// https://www.ecma-international.org/ecma-262/8.0/#prod-NonemptyClassRangesNoDash
pp$8.regexp_classRanges=function(state){while(this.regexp_eatClassAtom(state)){var left=state.lastIntValue;if(state.eat(0x2D/* - */)&&this.regexp_eatClassAtom(state)){var right=state.lastIntValue;if(state.switchU&&(left===-1||right===-1)){state.raise("Invalid character class");}if(left!==-1&&right!==-1&&left>right){state.raise("Range out of order in character class");}}}};// https://www.ecma-international.org/ecma-262/8.0/#prod-ClassAtom
// https://www.ecma-international.org/ecma-262/8.0/#prod-ClassAtomNoDash
pp$8.regexp_eatClassAtom=function(state){var start=state.pos;if(state.eat(0x5C/* \ */)){if(this.regexp_eatClassEscape(state)){return true;}if(state.switchU){// Make the same message as V8.
var ch$1=state.current();if(ch$1===0x63/* c */||isOctalDigit(ch$1)){state.raise("Invalid class escape");}state.raise("Invalid escape");}state.pos=start;}var ch=state.current();if(ch!==0x5D/* ] */){state.lastIntValue=ch;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ClassEscape
pp$8.regexp_eatClassEscape=function(state){var start=state.pos;if(state.eat(0x62/* b */)){state.lastIntValue=0x08;/* <BS> */return true;}if(state.switchU&&state.eat(0x2D/* - */)){state.lastIntValue=0x2D;/* - */return true;}if(!state.switchU&&state.eat(0x63/* c */)){if(this.regexp_eatClassControlLetter(state)){return true;}state.pos=start;}return this.regexp_eatCharacterClassEscape(state)||this.regexp_eatCharacterEscape(state);};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ClassControlLetter
pp$8.regexp_eatClassControlLetter=function(state){var ch=state.current();if(isDecimalDigit(ch)||ch===0x5F/* _ */){state.lastIntValue=ch%0x20;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-HexEscapeSequence
pp$8.regexp_eatHexEscapeSequence=function(state){var start=state.pos;if(state.eat(0x78/* x */)){if(this.regexp_eatFixedHexDigits(state,2)){return true;}if(state.switchU){state.raise("Invalid escape");}state.pos=start;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-DecimalDigits
pp$8.regexp_eatDecimalDigits=function(state){var start=state.pos;var ch=0;state.lastIntValue=0;while(isDecimalDigit(ch=state.current())){state.lastIntValue=10*state.lastIntValue+(ch-0x30/* 0 */);state.advance();}return state.pos!==start;};function isDecimalDigit(ch){return ch>=0x30/* 0 */&&ch<=0x39;/* 9 */}// https://www.ecma-international.org/ecma-262/8.0/#prod-HexDigits
pp$8.regexp_eatHexDigits=function(state){var start=state.pos;var ch=0;state.lastIntValue=0;while(isHexDigit(ch=state.current())){state.lastIntValue=16*state.lastIntValue+hexToInt(ch);state.advance();}return state.pos!==start;};function isHexDigit(ch){return ch>=0x30/* 0 */&&ch<=0x39/* 9 */||ch>=0x41/* A */&&ch<=0x46/* F */||ch>=0x61/* a */&&ch<=0x66/* f */;}function hexToInt(ch){if(ch>=0x41/* A */&&ch<=0x46/* F */){return 10+(ch-0x41/* A */);}if(ch>=0x61/* a */&&ch<=0x66/* f */){return 10+(ch-0x61/* a */);}return ch-0x30;/* 0 */}// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-LegacyOctalEscapeSequence
// Allows only 0-377(octal) i.e. 0-255(decimal).
pp$8.regexp_eatLegacyOctalEscapeSequence=function(state){if(this.regexp_eatOctalDigit(state)){var n1=state.lastIntValue;if(this.regexp_eatOctalDigit(state)){var n2=state.lastIntValue;if(n1<=3&&this.regexp_eatOctalDigit(state)){state.lastIntValue=n1*64+n2*8+state.lastIntValue;}else{state.lastIntValue=n1*8+n2;}}else{state.lastIntValue=n1;}return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-OctalDigit
pp$8.regexp_eatOctalDigit=function(state){var ch=state.current();if(isOctalDigit(ch)){state.lastIntValue=ch-0x30;/* 0 */state.advance();return true;}state.lastIntValue=0;return false;};function isOctalDigit(ch){return ch>=0x30/* 0 */&&ch<=0x37;/* 7 */}// https://www.ecma-international.org/ecma-262/8.0/#prod-Hex4Digits
// https://www.ecma-international.org/ecma-262/8.0/#prod-HexDigit
// And HexDigit HexDigit in https://www.ecma-international.org/ecma-262/8.0/#prod-HexEscapeSequence
pp$8.regexp_eatFixedHexDigits=function(state,length){var start=state.pos;state.lastIntValue=0;for(var i=0;i<length;++i){var ch=state.current();if(!isHexDigit(ch)){state.pos=start;return false;}state.lastIntValue=16*state.lastIntValue+hexToInt(ch);state.advance();}return true;};// Object type used to represent tokens. Note that normally, tokens
// simply exist as properties on the parser object. This is only
// used for the onToken callback and the external tokenizer.
var Token=function Token(p){this.type=p.type;this.value=p.value;this.start=p.start;this.end=p.end;if(p.options.locations){this.loc=new SourceLocation(p,p.startLoc,p.endLoc);}if(p.options.ranges){this.range=[p.start,p.end];}};// ## Tokenizer
var pp$9=Parser.prototype;// Move to the next token
pp$9.next=function(ignoreEscapeSequenceInKeyword){if(!ignoreEscapeSequenceInKeyword&&this.type.keyword&&this.containsEsc){this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword);}if(this.options.onToken){this.options.onToken(new Token(this));}this.lastTokEnd=this.end;this.lastTokStart=this.start;this.lastTokEndLoc=this.endLoc;this.lastTokStartLoc=this.startLoc;this.nextToken();};pp$9.getToken=function(){this.next();return new Token(this);};// If we're in an ES6 environment, make parsers iterable
if(typeof Symbol!=="undefined"){pp$9[Symbol.iterator]=function(){var this$1=this;return{next:function next(){var token=this$1.getToken();return{done:token.type===types.eof,value:token};}};};}// Toggle strict mode. Re-reads the next number or string to please
// pedantic tests (`"use strict"; 010;` should fail).
pp$9.curContext=function(){return this.context[this.context.length-1];};// Read a single token, updating the parser object's token-related
// properties.
pp$9.nextToken=function(){var curContext=this.curContext();if(!curContext||!curContext.preserveSpace){this.skipSpace();}this.start=this.pos;if(this.options.locations){this.startLoc=this.curPosition();}if(this.pos>=this.input.length){return this.finishToken(types.eof);}if(curContext.override){return curContext.override(this);}else{this.readToken(this.fullCharCodeAtPos());}};pp$9.readToken=function(code){// Identifier or keyword. '\uXXXX' sequences are allowed in
// identifiers, so '\' also dispatches to that.
if(isIdentifierStart(code,this.options.ecmaVersion>=6)||code===92/* '\' */){return this.readWord();}return this.getTokenFromCode(code);};pp$9.fullCharCodeAtPos=function(){var code=this.input.charCodeAt(this.pos);if(code<=0xd7ff||code>=0xe000){return code;}var next=this.input.charCodeAt(this.pos+1);return(code<<10)+next-0x35fdc00;};pp$9.skipBlockComment=function(){var startLoc=this.options.onComment&&this.curPosition();var start=this.pos,end=this.input.indexOf("*/",this.pos+=2);if(end===-1){this.raise(this.pos-2,"Unterminated comment");}this.pos=end+2;if(this.options.locations){lineBreakG.lastIndex=start;var match;while((match=lineBreakG.exec(this.input))&&match.index<this.pos){++this.curLine;this.lineStart=match.index+match[0].length;}}if(this.options.onComment){this.options.onComment(true,this.input.slice(start+2,end),start,this.pos,startLoc,this.curPosition());}};pp$9.skipLineComment=function(startSkip){var start=this.pos;var startLoc=this.options.onComment&&this.curPosition();var ch=this.input.charCodeAt(this.pos+=startSkip);while(this.pos<this.input.length&&!isNewLine(ch)){ch=this.input.charCodeAt(++this.pos);}if(this.options.onComment){this.options.onComment(false,this.input.slice(start+startSkip,this.pos),start,this.pos,startLoc,this.curPosition());}};// Called at the start of the parse and after every token. Skips
// whitespace and comments, and.
pp$9.skipSpace=function(){loop:while(this.pos<this.input.length){var ch=this.input.charCodeAt(this.pos);switch(ch){case 32:case 160:// ' '
++this.pos;break;case 13:if(this.input.charCodeAt(this.pos+1)===10){++this.pos;}case 10:case 8232:case 8233:++this.pos;if(this.options.locations){++this.curLine;this.lineStart=this.pos;}break;case 47:// '/'
switch(this.input.charCodeAt(this.pos+1)){case 42:// '*'
this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break loop;}break;default:if(ch>8&&ch<14||ch>=5760&&nonASCIIwhitespace.test(String.fromCharCode(ch))){++this.pos;}else{break loop;}}}};// Called at the end of every token. Sets `end`, `val`, and
// maintains `context` and `exprAllowed`, and skips the space after
// the token, so that the next one's `start` will point at the
// right position.
pp$9.finishToken=function(type,val){this.end=this.pos;if(this.options.locations){this.endLoc=this.curPosition();}var prevType=this.type;this.type=type;this.value=val;this.updateContext(prevType);};// ### Token reading
// This is the function that is called to fetch the next token. It
// is somewhat obscure, because it works in character codes rather
// than characters, and because operator parsing has been inlined
// into it.
//
// All in the name of speed.
//
pp$9.readToken_dot=function(){var next=this.input.charCodeAt(this.pos+1);if(next>=48&&next<=57){return this.readNumber(true);}var next2=this.input.charCodeAt(this.pos+2);if(this.options.ecmaVersion>=6&&next===46&&next2===46){// 46 = dot '.'
this.pos+=3;return this.finishToken(types.ellipsis);}else{++this.pos;return this.finishToken(types.dot);}};pp$9.readToken_slash=function(){// '/'
var next=this.input.charCodeAt(this.pos+1);if(this.exprAllowed){++this.pos;return this.readRegexp();}if(next===61){return this.finishOp(types.assign,2);}return this.finishOp(types.slash,1);};pp$9.readToken_mult_modulo_exp=function(code){// '%*'
var next=this.input.charCodeAt(this.pos+1);var size=1;var tokentype=code===42?types.star:types.modulo;// exponentiation operator ** and **=
if(this.options.ecmaVersion>=7&&code===42&&next===42){++size;tokentype=types.starstar;next=this.input.charCodeAt(this.pos+2);}if(next===61){return this.finishOp(types.assign,size+1);}return this.finishOp(tokentype,size);};pp$9.readToken_pipe_amp=function(code){// '|&'
var next=this.input.charCodeAt(this.pos+1);if(next===code){if(this.options.ecmaVersion>=12){var next2=this.input.charCodeAt(this.pos+2);if(next2===61){return this.finishOp(types.assign,3);}}return this.finishOp(code===124?types.logicalOR:types.logicalAND,2);}if(next===61){return this.finishOp(types.assign,2);}return this.finishOp(code===124?types.bitwiseOR:types.bitwiseAND,1);};pp$9.readToken_caret=function(){// '^'
var next=this.input.charCodeAt(this.pos+1);if(next===61){return this.finishOp(types.assign,2);}return this.finishOp(types.bitwiseXOR,1);};pp$9.readToken_plus_min=function(code){// '+-'
var next=this.input.charCodeAt(this.pos+1);if(next===code){if(next===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||lineBreak.test(this.input.slice(this.lastTokEnd,this.pos)))){// A `-->` line comment
this.skipLineComment(3);this.skipSpace();return this.nextToken();}return this.finishOp(types.incDec,2);}if(next===61){return this.finishOp(types.assign,2);}return this.finishOp(types.plusMin,1);};pp$9.readToken_lt_gt=function(code){// '<>'
var next=this.input.charCodeAt(this.pos+1);var size=1;if(next===code){size=code===62&&this.input.charCodeAt(this.pos+2)===62?3:2;if(this.input.charCodeAt(this.pos+size)===61){return this.finishOp(types.assign,size+1);}return this.finishOp(types.bitShift,size);}if(next===33&&code===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45){// `<!--`, an XML-style comment that should be interpreted as a line comment
this.skipLineComment(4);this.skipSpace();return this.nextToken();}if(next===61){size=2;}return this.finishOp(types.relational,size);};pp$9.readToken_eq_excl=function(code){// '=!'
var next=this.input.charCodeAt(this.pos+1);if(next===61){return this.finishOp(types.equality,this.input.charCodeAt(this.pos+2)===61?3:2);}if(code===61&&next===62&&this.options.ecmaVersion>=6){// '=>'
this.pos+=2;return this.finishToken(types.arrow);}return this.finishOp(code===61?types.eq:types.prefix,1);};pp$9.readToken_question=function(){// '?'
var ecmaVersion=this.options.ecmaVersion;if(ecmaVersion>=11){var next=this.input.charCodeAt(this.pos+1);if(next===46){var next2=this.input.charCodeAt(this.pos+2);if(next2<48||next2>57){return this.finishOp(types.questionDot,2);}}if(next===63){if(ecmaVersion>=12){var next2$1=this.input.charCodeAt(this.pos+2);if(next2$1===61){return this.finishOp(types.assign,3);}}return this.finishOp(types.coalesce,2);}}return this.finishOp(types.question,1);};pp$9.getTokenFromCode=function(code){switch(code){// The interpretation of a dot depends on whether it is followed
// by a digit or another two dots.
case 46:// '.'
return this.readToken_dot();// Punctuation tokens.
case 40:++this.pos;return this.finishToken(types.parenL);case 41:++this.pos;return this.finishToken(types.parenR);case 59:++this.pos;return this.finishToken(types.semi);case 44:++this.pos;return this.finishToken(types.comma);case 91:++this.pos;return this.finishToken(types.bracketL);case 93:++this.pos;return this.finishToken(types.bracketR);case 123:++this.pos;return this.finishToken(types.braceL);case 125:++this.pos;return this.finishToken(types.braceR);case 58:++this.pos;return this.finishToken(types.colon);case 96:// '`'
if(this.options.ecmaVersion<6){break;}++this.pos;return this.finishToken(types.backQuote);case 48:// '0'
var next=this.input.charCodeAt(this.pos+1);if(next===120||next===88){return this.readRadixNumber(16);}// '0x', '0X' - hex number
if(this.options.ecmaVersion>=6){if(next===111||next===79){return this.readRadixNumber(8);}// '0o', '0O' - octal number
if(next===98||next===66){return this.readRadixNumber(2);}// '0b', '0B' - binary number
}// Anything else beginning with a digit is an integer, octal
// number, or float.
case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:// 1-9
return this.readNumber(false);// Quotes produce strings.
case 34:case 39:// '"', "'"
return this.readString(code);// Operators are parsed inline in tiny state machines. '=' (61) is
// often referred to. `finishOp` simply skips the amount of
// characters it is given as second argument, and returns a token
// of the type given by its first argument.
case 47:// '/'
return this.readToken_slash();case 37:case 42:// '%*'
return this.readToken_mult_modulo_exp(code);case 124:case 38:// '|&'
return this.readToken_pipe_amp(code);case 94:// '^'
return this.readToken_caret();case 43:case 45:// '+-'
return this.readToken_plus_min(code);case 60:case 62:// '<>'
return this.readToken_lt_gt(code);case 61:case 33:// '=!'
return this.readToken_eq_excl(code);case 63:// '?'
return this.readToken_question();case 126:// '~'
return this.finishOp(types.prefix,1);}this.raise(this.pos,"Unexpected character '"+codePointToString$1(code)+"'");};pp$9.finishOp=function(type,size){var str=this.input.slice(this.pos,this.pos+size);this.pos+=size;return this.finishToken(type,str);};pp$9.readRegexp=function(){var escaped,inClass,start=this.pos;for(;;){if(this.pos>=this.input.length){this.raise(start,"Unterminated regular expression");}var ch=this.input.charAt(this.pos);if(lineBreak.test(ch)){this.raise(start,"Unterminated regular expression");}if(!escaped){if(ch==="["){inClass=true;}else if(ch==="]"&&inClass){inClass=false;}else if(ch==="/"&&!inClass){break;}escaped=ch==="\\";}else{escaped=false;}++this.pos;}var pattern=this.input.slice(start,this.pos);++this.pos;var flagsStart=this.pos;var flags=this.readWord1();if(this.containsEsc){this.unexpected(flagsStart);}// Validate pattern
var state=this.regexpState||(this.regexpState=new RegExpValidationState(this));state.reset(start,pattern,flags);this.validateRegExpFlags(state);this.validateRegExpPattern(state);// Create Literal#value property value.
var value=null;try{value=new RegExp(pattern,flags);}catch(e){// ESTree requires null if it failed to instantiate RegExp object.
// https://github.com/estree/estree/blob/a27003adf4fd7bfad44de9cef372a2eacd527b1c/es5.md#regexpliteral
}return this.finishToken(types.regexp,{pattern:pattern,flags:flags,value:value});};// Read an integer in the given radix. Return null if zero digits
// were read, the integer value otherwise. When `len` is given, this
// will return `null` unless the integer has exactly `len` digits.
pp$9.readInt=function(radix,len,maybeLegacyOctalNumericLiteral){// `len` is used for character escape sequences. In that case, disallow separators.
var allowSeparators=this.options.ecmaVersion>=12&&len===undefined;// `maybeLegacyOctalNumericLiteral` is true if it doesn't have prefix (0x,0o,0b)
// and isn't fraction part nor exponent part. In that case, if the first digit
// is zero then disallow separators.
var isLegacyOctalNumericLiteral=maybeLegacyOctalNumericLiteral&&this.input.charCodeAt(this.pos)===48;var start=this.pos,total=0,lastCode=0;for(var i=0,e=len==null?Infinity:len;i<e;++i,++this.pos){var code=this.input.charCodeAt(this.pos),val=void 0;if(allowSeparators&&code===95){if(isLegacyOctalNumericLiteral){this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals");}if(lastCode===95){this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore");}if(i===0){this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits");}lastCode=code;continue;}if(code>=97){val=code-97+10;}// a
else if(code>=65){val=code-65+10;}// A
else if(code>=48&&code<=57){val=code-48;}// 0-9
else{val=Infinity;}if(val>=radix){break;}lastCode=code;total=total*radix+val;}if(allowSeparators&&lastCode===95){this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits");}if(this.pos===start||len!=null&&this.pos-start!==len){return null;}return total;};function stringToNumber(str,isLegacyOctalNumericLiteral){if(isLegacyOctalNumericLiteral){return parseInt(str,8);}// `parseFloat(value)` stops parsing at the first numeric separator then returns a wrong value.
return parseFloat(str.replace(/_/g,""));}function stringToBigInt(str){if(typeof BigInt!=="function"){return null;}// `BigInt(value)` throws syntax error if the string contains numeric separators.
return BigInt(str.replace(/_/g,""));}pp$9.readRadixNumber=function(radix){var start=this.pos;this.pos+=2;// 0x
var val=this.readInt(radix);if(val==null){this.raise(this.start+2,"Expected number in radix "+radix);}if(this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110){val=stringToBigInt(this.input.slice(start,this.pos));++this.pos;}else if(isIdentifierStart(this.fullCharCodeAtPos())){this.raise(this.pos,"Identifier directly after number");}return this.finishToken(types.num,val);};// Read an integer, octal integer, or floating-point number.
pp$9.readNumber=function(startsWithDot){var start=this.pos;if(!startsWithDot&&this.readInt(10,undefined,true)===null){this.raise(start,"Invalid number");}var octal=this.pos-start>=2&&this.input.charCodeAt(start)===48;if(octal&&this.strict){this.raise(start,"Invalid number");}var next=this.input.charCodeAt(this.pos);if(!octal&&!startsWithDot&&this.options.ecmaVersion>=11&&next===110){var val$1=stringToBigInt(this.input.slice(start,this.pos));++this.pos;if(isIdentifierStart(this.fullCharCodeAtPos())){this.raise(this.pos,"Identifier directly after number");}return this.finishToken(types.num,val$1);}if(octal&&/[89]/.test(this.input.slice(start,this.pos))){octal=false;}if(next===46&&!octal){// '.'
++this.pos;this.readInt(10);next=this.input.charCodeAt(this.pos);}if((next===69||next===101)&&!octal){// 'eE'
next=this.input.charCodeAt(++this.pos);if(next===43||next===45){++this.pos;}// '+-'
if(this.readInt(10)===null){this.raise(start,"Invalid number");}}if(isIdentifierStart(this.fullCharCodeAtPos())){this.raise(this.pos,"Identifier directly after number");}var val=stringToNumber(this.input.slice(start,this.pos),octal);return this.finishToken(types.num,val);};// Read a string value, interpreting backslash-escapes.
pp$9.readCodePoint=function(){var ch=this.input.charCodeAt(this.pos),code;if(ch===123){// '{'
if(this.options.ecmaVersion<6){this.unexpected();}var codePos=++this.pos;code=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos);++this.pos;if(code>0x10FFFF){this.invalidStringToken(codePos,"Code point out of bounds");}}else{code=this.readHexChar(4);}return code;};function codePointToString$1(code){// UTF-16 Decoding
if(code<=0xFFFF){return String.fromCharCode(code);}code-=0x10000;return String.fromCharCode((code>>10)+0xD800,(code&1023)+0xDC00);}pp$9.readString=function(quote){var out="",chunkStart=++this.pos;for(;;){if(this.pos>=this.input.length){this.raise(this.start,"Unterminated string constant");}var ch=this.input.charCodeAt(this.pos);if(ch===quote){break;}if(ch===92){// '\'
out+=this.input.slice(chunkStart,this.pos);out+=this.readEscapedChar(false);chunkStart=this.pos;}else{if(isNewLine(ch,this.options.ecmaVersion>=10)){this.raise(this.start,"Unterminated string constant");}++this.pos;}}out+=this.input.slice(chunkStart,this.pos++);return this.finishToken(types.string,out);};// Reads template string tokens.
var INVALID_TEMPLATE_ESCAPE_ERROR={};pp$9.tryReadTemplateToken=function(){this.inTemplateElement=true;try{this.readTmplToken();}catch(err){if(err===INVALID_TEMPLATE_ESCAPE_ERROR){this.readInvalidTemplateToken();}else{throw err;}}this.inTemplateElement=false;};pp$9.invalidStringToken=function(position,message){if(this.inTemplateElement&&this.options.ecmaVersion>=9){throw INVALID_TEMPLATE_ESCAPE_ERROR;}else{this.raise(position,message);}};pp$9.readTmplToken=function(){var out="",chunkStart=this.pos;for(;;){if(this.pos>=this.input.length){this.raise(this.start,"Unterminated template");}var ch=this.input.charCodeAt(this.pos);if(ch===96||ch===36&&this.input.charCodeAt(this.pos+1)===123){// '`', '${'
if(this.pos===this.start&&(this.type===types.template||this.type===types.invalidTemplate)){if(ch===36){this.pos+=2;return this.finishToken(types.dollarBraceL);}else{++this.pos;return this.finishToken(types.backQuote);}}out+=this.input.slice(chunkStart,this.pos);return this.finishToken(types.template,out);}if(ch===92){// '\'
out+=this.input.slice(chunkStart,this.pos);out+=this.readEscapedChar(true);chunkStart=this.pos;}else if(isNewLine(ch)){out+=this.input.slice(chunkStart,this.pos);++this.pos;switch(ch){case 13:if(this.input.charCodeAt(this.pos)===10){++this.pos;}case 10:out+="\n";break;default:out+=String.fromCharCode(ch);break;}if(this.options.locations){++this.curLine;this.lineStart=this.pos;}chunkStart=this.pos;}else{++this.pos;}}};// Reads a template token to search for the end, without validating any escape sequences
pp$9.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++){switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{"){break;}// falls through
case"`":return this.finishToken(types.invalidTemplate,this.input.slice(this.start,this.pos));// no default
}}this.raise(this.start,"Unterminated template");};// Used to read escaped characters
pp$9.readEscapedChar=function(inTemplate){var ch=this.input.charCodeAt(++this.pos);++this.pos;switch(ch){case 110:return"\n";// 'n' -> '\n'
case 114:return"\r";// 'r' -> '\r'
case 120:return String.fromCharCode(this.readHexChar(2));// 'x'
case 117:return codePointToString$1(this.readCodePoint());// 'u'
case 116:return"\t";// 't' -> '\t'
case 98:return"\b";// 'b' -> '\b'
case 118:return"\x0B";// 'v' -> '\u000b'
case 102:return"\f";// 'f' -> '\f'
case 13:if(this.input.charCodeAt(this.pos)===10){++this.pos;}// '\r\n'
case 10:// ' \n'
if(this.options.locations){this.lineStart=this.pos;++this.curLine;}return"";case 56:case 57:if(this.strict){this.invalidStringToken(this.pos-1,"Invalid escape sequence");}if(inTemplate){var codePos=this.pos-1;this.invalidStringToken(codePos,"Invalid escape sequence in template string");return null;}default:if(ch>=48&&ch<=55){var octalStr=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0];var octal=parseInt(octalStr,8);if(octal>255){octalStr=octalStr.slice(0,-1);octal=parseInt(octalStr,8);}this.pos+=octalStr.length-1;ch=this.input.charCodeAt(this.pos);if((octalStr!=="0"||ch===56||ch===57)&&(this.strict||inTemplate)){this.invalidStringToken(this.pos-1-octalStr.length,inTemplate?"Octal literal in template string":"Octal literal in strict mode");}return String.fromCharCode(octal);}if(isNewLine(ch)){// Unicode new line characters after \ get removed from output in both
// template literals and strings
return"";}return String.fromCharCode(ch);}};// Used to read character escape sequences ('\x', '\u', '\U').
pp$9.readHexChar=function(len){var codePos=this.pos;var n=this.readInt(16,len);if(n===null){this.invalidStringToken(codePos,"Bad character escape sequence");}return n;};// Read an identifier, and return it as a string. Sets `this.containsEsc`
// to whether the word contained a '\u' escape.
//
// Incrementally adds only escaped chars, adding other chunks as-is
// as a micro-optimization.
pp$9.readWord1=function(){this.containsEsc=false;var word="",first=true,chunkStart=this.pos;var astral=this.options.ecmaVersion>=6;while(this.pos<this.input.length){var ch=this.fullCharCodeAtPos();if(isIdentifierChar(ch,astral)){this.pos+=ch<=0xffff?1:2;}else if(ch===92){// "\"
this.containsEsc=true;word+=this.input.slice(chunkStart,this.pos);var escStart=this.pos;if(this.input.charCodeAt(++this.pos)!==117)// "u"
{this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX");}++this.pos;var esc=this.readCodePoint();if(!(first?isIdentifierStart:isIdentifierChar)(esc,astral)){this.invalidStringToken(escStart,"Invalid Unicode escape");}word+=codePointToString$1(esc);chunkStart=this.pos;}else{break;}first=false;}return word+this.input.slice(chunkStart,this.pos);};// Read an identifier or keyword token. Will check for reserved
// words when necessary.
pp$9.readWord=function(){var word=this.readWord1();var type=types.name;if(this.keywords.test(word)){type=keywords$1[word];}return this.finishToken(type,word);};// Acorn is a tiny, fast JavaScript parser written in JavaScript.
var version$1="8.0.4";Parser.acorn={Parser:Parser,version:version$1,defaultOptions:defaultOptions,Position:Position,SourceLocation:SourceLocation,getLineInfo:getLineInfo,Node:Node,TokenType:TokenType,tokTypes:types,keywordTypes:keywords$1,TokContext:TokContext,tokContexts:types$1,isIdentifierChar:isIdentifierChar,isIdentifierStart:isIdentifierStart,Token:Token,isNewLine:isNewLine,lineBreak:lineBreak,lineBreakG:lineBreakG,nonASCIIwhitespace:nonASCIIwhitespace};// The main exported interface (under `self.acorn` when in the
// browser) is a `parse` function that takes a code string and
// returns an abstract syntax tree as specified by [Mozilla parser
// API][api].
//
// [api]: https://developer.mozilla.org/en-US/docs/SpiderMonkey/Parser_API
function parse(input,options){return Parser.parse(input,options);}// AST walker module for Mozilla Parser API compatible trees
// A recursive walk is one where your functions override the default
// walkers. They can modify and replace the state parameter that's
// threaded through the walk, and can opt how and whether to walk
// their child nodes (by calling their third argument on these
// nodes).
function recursive(node,state,funcs,baseVisitor,override){var visitor=funcs?make(funcs,baseVisitor||undefined):baseVisitor;(function c(node,st,override){visitor[override||node.type](node,st,c);})(node,state,override);}function makeTest(test){if(typeof test==="string"){return function(type){return type===test;};}else if(!test){return function(){return true;};}else{return test;}}var Found=function Found(node,state){this.node=node;this.state=state;};// Find the innermost node of a given type that contains the given
// position. Interface similar to findNodeAt.
function findNodeAround(node,pos,test,baseVisitor,state){test=makeTest(test);if(!baseVisitor){baseVisitor=base;}try{(function c(node,st,override){var type=override||node.type;if(node.start>pos||node.end<pos){return;}baseVisitor[type](node,st,c);if(test(type,node)){throw new Found(node,st);}})(node,state);}catch(e){if(e instanceof Found){return e;}throw e;}}// Used to create a custom walker. Will fill in all missing node
// type properties with the defaults.
function make(funcs,baseVisitor){var visitor=Object.create(baseVisitor||base);for(var type in funcs){visitor[type]=funcs[type];}return visitor;}function skipThrough(node,st,c){c(node,st);}function ignore(_node,_st,_c){}// Node walkers.
var base={};base.Program=base.BlockStatement=function(node,st,c){for(var i=0,list=node.body;i<list.length;i+=1){var stmt=list[i];c(stmt,st,"Statement");}};base.Statement=skipThrough;base.EmptyStatement=ignore;base.ExpressionStatement=base.ParenthesizedExpression=base.ChainExpression=function(node,st,c){return c(node.expression,st,"Expression");};base.IfStatement=function(node,st,c){c(node.test,st,"Expression");c(node.consequent,st,"Statement");if(node.alternate){c(node.alternate,st,"Statement");}};base.LabeledStatement=function(node,st,c){return c(node.body,st,"Statement");};base.BreakStatement=base.ContinueStatement=ignore;base.WithStatement=function(node,st,c){c(node.object,st,"Expression");c(node.body,st,"Statement");};base.SwitchStatement=function(node,st,c){c(node.discriminant,st,"Expression");for(var i$1=0,list$1=node.cases;i$1<list$1.length;i$1+=1){var cs=list$1[i$1];if(cs.test){c(cs.test,st,"Expression");}for(var i=0,list=cs.consequent;i<list.length;i+=1){var cons=list[i];c(cons,st,"Statement");}}};base.SwitchCase=function(node,st,c){if(node.test){c(node.test,st,"Expression");}for(var i=0,list=node.consequent;i<list.length;i+=1){var cons=list[i];c(cons,st,"Statement");}};base.ReturnStatement=base.YieldExpression=base.AwaitExpression=function(node,st,c){if(node.argument){c(node.argument,st,"Expression");}};base.ThrowStatement=base.SpreadElement=function(node,st,c){return c(node.argument,st,"Expression");};base.TryStatement=function(node,st,c){c(node.block,st,"Statement");if(node.handler){c(node.handler,st);}if(node.finalizer){c(node.finalizer,st,"Statement");}};base.CatchClause=function(node,st,c){if(node.param){c(node.param,st,"Pattern");}c(node.body,st,"Statement");};base.WhileStatement=base.DoWhileStatement=function(node,st,c){c(node.test,st,"Expression");c(node.body,st,"Statement");};base.ForStatement=function(node,st,c){if(node.init){c(node.init,st,"ForInit");}if(node.test){c(node.test,st,"Expression");}if(node.update){c(node.update,st,"Expression");}c(node.body,st,"Statement");};base.ForInStatement=base.ForOfStatement=function(node,st,c){c(node.left,st,"ForInit");c(node.right,st,"Expression");c(node.body,st,"Statement");};base.ForInit=function(node,st,c){if(node.type==="VariableDeclaration"){c(node,st);}else{c(node,st,"Expression");}};base.DebuggerStatement=ignore;base.FunctionDeclaration=function(node,st,c){return c(node,st,"Function");};base.VariableDeclaration=function(node,st,c){for(var i=0,list=node.declarations;i<list.length;i+=1){var decl=list[i];c(decl,st);}};base.VariableDeclarator=function(node,st,c){c(node.id,st,"Pattern");if(node.init){c(node.init,st,"Expression");}};base.Function=function(node,st,c){if(node.id){c(node.id,st,"Pattern");}for(var i=0,list=node.params;i<list.length;i+=1){var param=list[i];c(param,st,"Pattern");}c(node.body,st,node.expression?"Expression":"Statement");};base.Pattern=function(node,st,c){if(node.type==="Identifier"){c(node,st,"VariablePattern");}else if(node.type==="MemberExpression"){c(node,st,"MemberPattern");}else{c(node,st);}};base.VariablePattern=ignore;base.MemberPattern=skipThrough;base.RestElement=function(node,st,c){return c(node.argument,st,"Pattern");};base.ArrayPattern=function(node,st,c){for(var i=0,list=node.elements;i<list.length;i+=1){var elt=list[i];if(elt){c(elt,st,"Pattern");}}};base.ObjectPattern=function(node,st,c){for(var i=0,list=node.properties;i<list.length;i+=1){var prop=list[i];if(prop.type==="Property"){if(prop.computed){c(prop.key,st,"Expression");}c(prop.value,st,"Pattern");}else if(prop.type==="RestElement"){c(prop.argument,st,"Pattern");}}};base.Expression=skipThrough;base.ThisExpression=base.Super=base.MetaProperty=ignore;base.ArrayExpression=function(node,st,c){for(var i=0,list=node.elements;i<list.length;i+=1){var elt=list[i];if(elt){c(elt,st,"Expression");}}};base.ObjectExpression=function(node,st,c){for(var i=0,list=node.properties;i<list.length;i+=1){var prop=list[i];c(prop,st);}};base.FunctionExpression=base.ArrowFunctionExpression=base.FunctionDeclaration;base.SequenceExpression=function(node,st,c){for(var i=0,list=node.expressions;i<list.length;i+=1){var expr=list[i];c(expr,st,"Expression");}};base.TemplateLiteral=function(node,st,c){for(var i=0,list=node.quasis;i<list.length;i+=1){var quasi=list[i];c(quasi,st);}for(var i$1=0,list$1=node.expressions;i$1<list$1.length;i$1+=1){var expr=list$1[i$1];c(expr,st,"Expression");}};base.TemplateElement=ignore;base.UnaryExpression=base.UpdateExpression=function(node,st,c){c(node.argument,st,"Expression");};base.BinaryExpression=base.LogicalExpression=function(node,st,c){c(node.left,st,"Expression");c(node.right,st,"Expression");};base.AssignmentExpression=base.AssignmentPattern=function(node,st,c){c(node.left,st,"Pattern");c(node.right,st,"Expression");};base.ConditionalExpression=function(node,st,c){c(node.test,st,"Expression");c(node.consequent,st,"Expression");c(node.alternate,st,"Expression");};base.NewExpression=base.CallExpression=function(node,st,c){c(node.callee,st,"Expression");if(node.arguments){for(var i=0,list=node.arguments;i<list.length;i+=1){var arg=list[i];c(arg,st,"Expression");}}};base.MemberExpression=function(node,st,c){c(node.object,st,"Expression");if(node.computed){c(node.property,st,"Expression");}};base.ExportNamedDeclaration=base.ExportDefaultDeclaration=function(node,st,c){if(node.declaration){c(node.declaration,st,node.type==="ExportNamedDeclaration"||node.declaration.id?"Statement":"Expression");}if(node.source){c(node.source,st,"Expression");}};base.ExportAllDeclaration=function(node,st,c){if(node.exported){c(node.exported,st);}c(node.source,st,"Expression");};base.ImportDeclaration=function(node,st,c){for(var i=0,list=node.specifiers;i<list.length;i+=1){var spec=list[i];c(spec,st);}c(node.source,st,"Expression");};base.ImportExpression=function(node,st,c){c(node.source,st,"Expression");};base.ImportSpecifier=base.ImportDefaultSpecifier=base.ImportNamespaceSpecifier=base.Identifier=base.PrivateIdentifier=base.Literal=ignore;base.TaggedTemplateExpression=function(node,st,c){c(node.tag,st,"Expression");c(node.quasi,st,"Expression");};base.ClassDeclaration=base.ClassExpression=function(node,st,c){return c(node,st,"Class");};base.Class=function(node,st,c){if(node.id){c(node.id,st,"Pattern");}if(node.superClass){c(node.superClass,st,"Expression");}c(node.body,st);};base.ClassBody=function(node,st,c){for(var i=0,list=node.body;i<list.length;i+=1){var elt=list[i];c(elt,st);}};base.MethodDefinition=base.PropertyDefinition=base.Property=function(node,st,c){if(node.computed){c(node.key,st,"Expression");}if(node.value){c(node.value,st,"Expression");}};// Reserved word lists for various dialects of the language
var reservedWords$1={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"};// And the keywords
var ecma5AndLessKeywords$1="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this";var keywords$2={5:ecma5AndLessKeywords$1,"5module":ecma5AndLessKeywords$1+" export import",6:ecma5AndLessKeywords$1+" const class extends export import super"};var keywordRelationalOperator$1=/^in(stanceof)?$/;// ## Character categories
// Big ugly regular expressions that match characters in the
// whitespace, identifier, and identifier-start categories. These
// are only applied when a character is found to actually have a
// code point above 128.
// Generated by `bin/generate-identifier-regex.js`.
var nonASCIIidentifierStartChars$1="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC";var nonASCIIidentifierChars$1="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F";var nonASCIIidentifierStart$1=new RegExp("["+nonASCIIidentifierStartChars$1+"]");var nonASCIIidentifier$1=new RegExp("["+nonASCIIidentifierStartChars$1+nonASCIIidentifierChars$1+"]");nonASCIIidentifierStartChars$1=nonASCIIidentifierChars$1=null;// These are a run-length and offset encoded representation of the
// >0xffff code points that are a valid part of identifiers. The
// offset starts at 0x10000, and each pair of numbers represents an
// offset to the next range, and then a size of the range. They were
// generated by bin/generate-identifier-regex.js
// eslint-disable-next-line comma-spacing
var astralIdentifierStartCodes$1=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938];// eslint-disable-next-line comma-spacing
var astralIdentifierCodes$1=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];// This has a complexity linear to the value of the code. The
// assumption is that looking up astral identifier characters is
// rare.
function isInAstralSet$1(code,set){var pos=0x10000;for(var i=0;i<set.length;i+=2){pos+=set[i];if(pos>code){return false;}pos+=set[i+1];if(pos>=code){return true;}}}// Test whether a given character code starts an identifier.
function isIdentifierStart$1(code,astral){if(code<65){return code===36;}if(code<91){return true;}if(code<97){return code===95;}if(code<123){return true;}if(code<=0xffff){return code>=0xaa&&nonASCIIidentifierStart$1.test(String.fromCharCode(code));}if(astral===false){return false;}return isInAstralSet$1(code,astralIdentifierStartCodes$1);}// Test whether a given character is part of an identifier.
function isIdentifierChar$1(code,astral){if(code<48){return code===36;}if(code<58){return true;}if(code<65){return false;}if(code<91){return true;}if(code<97){return code===95;}if(code<123){return true;}if(code<=0xffff){return code>=0xaa&&nonASCIIidentifier$1.test(String.fromCharCode(code));}if(astral===false){return false;}return isInAstralSet$1(code,astralIdentifierStartCodes$1)||isInAstralSet$1(code,astralIdentifierCodes$1);}// ## Token types
// The assignment of fine-grained, information-carrying type objects
// allows the tokenizer to store the information it has about a
// token in a way that is very cheap for the parser to look up.
// All token type variables start with an underscore, to make them
// easy to recognize.
// The `beforeExpr` property is used to disambiguate between regular
// expressions and divisions. It is set on all token types that can
// be followed by an expression (thus, a slash after them would be a
// regular expression).
//
// The `startsExpr` property is used to check if the token ends a
// `yield` expression. It is set on all token types that either can
// directly start an expression (like a quotation mark) or can
// continue an expression (like the body of a string).
//
// `isLoop` marks a keyword as starting a loop, which is important
// to know when parsing a label, in order to allow or disallow
// continue jumps to that label.
var TokenType$1=function TokenType(label,conf){if(conf===void 0)conf={};this.label=label;this.keyword=conf.keyword;this.beforeExpr=!!conf.beforeExpr;this.startsExpr=!!conf.startsExpr;this.isLoop=!!conf.isLoop;this.isAssign=!!conf.isAssign;this.prefix=!!conf.prefix;this.postfix=!!conf.postfix;this.binop=conf.binop||null;this.updateContext=null;};function binop$1(name,prec){return new TokenType$1(name,{beforeExpr:true,binop:prec});}var beforeExpr$1={beforeExpr:true},startsExpr$1={startsExpr:true};// Map keyword names to token types.
var keywords$1$1={};// Succinct definitions of keyword token types
function kw$1(name,options){if(options===void 0)options={};options.keyword=name;return keywords$1$1[name]=new TokenType$1(name,options);}var types$2={num:new TokenType$1("num",startsExpr$1),regexp:new TokenType$1("regexp",startsExpr$1),string:new TokenType$1("string",startsExpr$1),name:new TokenType$1("name",startsExpr$1),privateId:new TokenType$1("privateId",startsExpr$1),eof:new TokenType$1("eof"),// Punctuation token types.
bracketL:new TokenType$1("[",{beforeExpr:true,startsExpr:true}),bracketR:new TokenType$1("]"),braceL:new TokenType$1("{",{beforeExpr:true,startsExpr:true}),braceR:new TokenType$1("}"),parenL:new TokenType$1("(",{beforeExpr:true,startsExpr:true}),parenR:new TokenType$1(")"),comma:new TokenType$1(",",beforeExpr$1),semi:new TokenType$1(";",beforeExpr$1),colon:new TokenType$1(":",beforeExpr$1),dot:new TokenType$1("."),question:new TokenType$1("?",beforeExpr$1),questionDot:new TokenType$1("?."),arrow:new TokenType$1("=>",beforeExpr$1),template:new TokenType$1("template"),invalidTemplate:new TokenType$1("invalidTemplate"),ellipsis:new TokenType$1("...",beforeExpr$1),backQuote:new TokenType$1("`",startsExpr$1),dollarBraceL:new TokenType$1("${",{beforeExpr:true,startsExpr:true}),// Operators. These carry several kinds of properties to help the
// parser use them properly (the presence of these properties is
// what categorizes them as operators).
//
// `binop`, when present, specifies that this operator is a binary
// operator, and will refer to its precedence.
//
// `prefix` and `postfix` mark the operator as a prefix or postfix
// unary operator.
//
// `isAssign` marks all of `=`, `+=`, `-=` etcetera, which act as
// binary operators with a very low precedence, that should result
// in AssignmentExpression nodes.
eq:new TokenType$1("=",{beforeExpr:true,isAssign:true}),assign:new TokenType$1("_=",{beforeExpr:true,isAssign:true}),incDec:new TokenType$1("++/--",{prefix:true,postfix:true,startsExpr:true}),prefix:new TokenType$1("!/~",{beforeExpr:true,prefix:true,startsExpr:true}),logicalOR:binop$1("||",1),logicalAND:binop$1("&&",2),bitwiseOR:binop$1("|",3),bitwiseXOR:binop$1("^",4),bitwiseAND:binop$1("&",5),equality:binop$1("==/!=/===/!==",6),relational:binop$1("</>/<=/>=",7),bitShift:binop$1("<</>>/>>>",8),plusMin:new TokenType$1("+/-",{beforeExpr:true,binop:9,prefix:true,startsExpr:true}),modulo:binop$1("%",10),star:binop$1("*",10),slash:binop$1("/",10),starstar:new TokenType$1("**",{beforeExpr:true}),coalesce:binop$1("??",1),// Keyword token types.
_break:kw$1("break"),_case:kw$1("case",beforeExpr$1),_catch:kw$1("catch"),_continue:kw$1("continue"),_debugger:kw$1("debugger"),_default:kw$1("default",beforeExpr$1),_do:kw$1("do",{isLoop:true,beforeExpr:true}),_else:kw$1("else",beforeExpr$1),_finally:kw$1("finally"),_for:kw$1("for",{isLoop:true}),_function:kw$1("function",startsExpr$1),_if:kw$1("if"),_return:kw$1("return",beforeExpr$1),_switch:kw$1("switch"),_throw:kw$1("throw",beforeExpr$1),_try:kw$1("try"),_var:kw$1("var"),_const:kw$1("const"),_while:kw$1("while",{isLoop:true}),_with:kw$1("with"),_new:kw$1("new",{beforeExpr:true,startsExpr:true}),_this:kw$1("this",startsExpr$1),_super:kw$1("super",startsExpr$1),_class:kw$1("class",startsExpr$1),_extends:kw$1("extends",beforeExpr$1),_export:kw$1("export"),_import:kw$1("import",startsExpr$1),_null:kw$1("null",startsExpr$1),_true:kw$1("true",startsExpr$1),_false:kw$1("false",startsExpr$1),_in:kw$1("in",{beforeExpr:true,binop:7}),_instanceof:kw$1("instanceof",{beforeExpr:true,binop:7}),_typeof:kw$1("typeof",{beforeExpr:true,prefix:true,startsExpr:true}),_void:kw$1("void",{beforeExpr:true,prefix:true,startsExpr:true}),_delete:kw$1("delete",{beforeExpr:true,prefix:true,startsExpr:true})};// Matches a whole line break (where CRLF is considered a single
// line break). Used to count lines.
var lineBreak$1=/\r\n?|\n|\u2028|\u2029/;var lineBreakG$1=new RegExp(lineBreak$1.source,"g");function isNewLine$1(code,ecma2019String){return code===10||code===13||!ecma2019String&&(code===0x2028||code===0x2029);}var nonASCIIwhitespace$1=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/;var skipWhiteSpace$1=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g;var ref$1=Object.prototype;var hasOwnProperty$1=ref$1.hasOwnProperty;var toString$1=ref$1.toString;// Checks if an object has a property.
function has$2(obj,propName){return hasOwnProperty$1.call(obj,propName);}var isArray$3=Array.isArray||function(obj){return toString$1.call(obj)==="[object Array]";};function wordsRegexp$1(words){return new RegExp("^(?:"+words.replace(/ /g,"|")+")$");}// These are used when `options.locations` is on, for the
// `startLoc` and `endLoc` properties.
var Position$1=function Position(line,col){this.line=line;this.column=col;};Position$1.prototype.offset=function offset(n){return new Position$1(this.line,this.column+n);};var SourceLocation$1=function SourceLocation(p,start,end){this.start=start;this.end=end;if(p.sourceFile!==null){this.source=p.sourceFile;}};// The `getLineInfo` function is mostly useful when the
// `locations` option is off (for performance reasons) and you
// want to find the line/column position for a given character
// offset. `input` should be the code string that the offset refers
// into.
function getLineInfo$1(input,offset){for(var line=1,cur=0;;){lineBreakG$1.lastIndex=cur;var match=lineBreakG$1.exec(input);if(match&&match.index<offset){++line;cur=match.index+match[0].length;}else{return new Position$1(line,offset-cur);}}}// A second argument must be given to configure the parser process.
// These options are recognized (only `ecmaVersion` is required):
var defaultOptions$1={// `ecmaVersion` indicates the ECMAScript version to parse. Must be
// either 3, 5, 6 (or 2015), 7 (2016), 8 (2017), 9 (2018), 10
// (2019), 11 (2020), 12 (2021), or `"latest"` (the latest version
// the library supports). This influences support for strict mode,
// the set of reserved words, and support for new syntax features.
ecmaVersion:null,// `sourceType` indicates the mode the code should be parsed in.
// Can be either `"script"` or `"module"`. This influences global
// strict mode and parsing of `import` and `export` declarations.
sourceType:"script",// `onInsertedSemicolon` can be a callback that will be called
// when a semicolon is automatically inserted. It will be passed
// the position of the comma as an offset, and if `locations` is
// enabled, it is given the location as a `{line, column}` object
// as second argument.
onInsertedSemicolon:null,// `onTrailingComma` is similar to `onInsertedSemicolon`, but for
// trailing commas.
onTrailingComma:null,// By default, reserved words are only enforced if ecmaVersion >= 5.
// Set `allowReserved` to a boolean value to explicitly turn this on
// an off. When this option has the value "never", reserved words
// and keywords can also not be used as property names.
allowReserved:null,// When enabled, a return at the top level is not considered an
// error.
allowReturnOutsideFunction:false,// When enabled, import/export statements are not constrained to
// appearing at the top of the program, and an import.meta expression
// in a script isn't considered an error.
allowImportExportEverywhere:false,// When enabled, await identifiers are allowed to appear at the top-level scope,
// but they are still not allowed in non-async functions.
allowAwaitOutsideFunction:false,// When enabled, hashbang directive in the beginning of file
// is allowed and treated as a line comment.
allowHashBang:false,// When `locations` is on, `loc` properties holding objects with
// `start` and `end` properties in `{line, column}` form (with
// line being 1-based and column 0-based) will be attached to the
// nodes.
locations:false,// A function can be passed as `onToken` option, which will
// cause Acorn to call that function with object in the same
// format as tokens returned from `tokenizer().getToken()`. Note
// that you are not allowed to call the parser from the
// callback—that will corrupt its internal state.
onToken:null,// A function can be passed as `onComment` option, which will
// cause Acorn to call that function with `(block, text, start,
// end)` parameters whenever a comment is skipped. `block` is a
// boolean indicating whether this is a block (`/* */`) comment,
// `text` is the content of the comment, and `start` and `end` are
// character offsets that denote the start and end of the comment.
// When the `locations` option is on, two more parameters are
// passed, the full `{line, column}` locations of the start and
// end of the comments. Note that you are not allowed to call the
// parser from the callback—that will corrupt its internal state.
onComment:null,// Nodes have their start and end characters offsets recorded in
// `start` and `end` properties (directly on the node, rather than
// the `loc` object, which holds line/column data. To also add a
// [semi-standardized][range] `range` property holding a `[start,
// end]` array with the same numbers, set the `ranges` option to
// `true`.
//
// [range]: https://bugzilla.mozilla.org/show_bug.cgi?id=745678
ranges:false,// It is possible to parse multiple files into a single AST by
// passing the tree produced by parsing the first file as
// `program` option in subsequent parses. This will add the
// toplevel forms of the parsed file to the `Program` (top) node
// of an existing parse tree.
program:null,// When `locations` is on, you can pass this to record the source
// file in every node's `loc` object.
sourceFile:null,// This value, if given, is stored in every node, whether
// `locations` is on or off.
directSourceFile:null,// When enabled, parenthesized expressions are represented by
// (non-standard) ParenthesizedExpression nodes
preserveParens:false};// Interpret and default an options object
var warnedAboutEcmaVersion$1=false;function getOptions$1(opts){var options={};for(var opt in defaultOptions$1){options[opt]=opts&&has$2(opts,opt)?opts[opt]:defaultOptions$1[opt];}if(options.ecmaVersion==="latest"){options.ecmaVersion=1e8;}else if(options.ecmaVersion==null){if(!warnedAboutEcmaVersion$1&&(typeof console==="undefined"?"undefined":_typeof2(console))==="object"&&console.warn){warnedAboutEcmaVersion$1=true;console.warn("Since Acorn 8.0.0, options.ecmaVersion is required.\nDefaulting to 2020, but this will stop working in the future.");}options.ecmaVersion=11;}else if(options.ecmaVersion>=2015){options.ecmaVersion-=2009;}if(options.allowReserved==null){options.allowReserved=options.ecmaVersion<5;}if(isArray$3(options.onToken)){var tokens=options.onToken;options.onToken=function(token){return tokens.push(token);};}if(isArray$3(options.onComment)){options.onComment=pushComment$1(options,options.onComment);}return options;}function pushComment$1(options,array){return function(block,text,start,end,startLoc,endLoc){var comment={type:block?"Block":"Line",value:text,start:start,end:end};if(options.locations){comment.loc=new SourceLocation$1(this,startLoc,endLoc);}if(options.ranges){comment.range=[start,end];}array.push(comment);};}// Each scope gets a bitset that may contain these flags
var SCOPE_TOP$1=1,SCOPE_FUNCTION$1=2,SCOPE_VAR$1=SCOPE_TOP$1|SCOPE_FUNCTION$1,SCOPE_ASYNC$1=4,SCOPE_GENERATOR$1=8,SCOPE_ARROW$1=16,SCOPE_SIMPLE_CATCH$1=32,SCOPE_SUPER$1=64,SCOPE_DIRECT_SUPER$1=128;function functionFlags$1(async,generator){return SCOPE_FUNCTION$1|(async?SCOPE_ASYNC$1:0)|(generator?SCOPE_GENERATOR$1:0);}// Used in checkLVal* and declareName to determine the type of a binding
var BIND_NONE$1=0,// Not a binding
BIND_VAR$1=1,// Var-style binding
BIND_LEXICAL$1=2,// Let- or const-style binding
BIND_FUNCTION$1=3,// Function declaration
BIND_SIMPLE_CATCH$1=4,// Simple (identifier pattern) catch binding
BIND_OUTSIDE$1=5;// Special case for function names as bound inside the function
var Parser$1=function Parser(options,input,startPos){this.options=options=getOptions$1(options);this.sourceFile=options.sourceFile;this.keywords=wordsRegexp$1(keywords$2[options.ecmaVersion>=6?6:options.sourceType==="module"?"5module":5]);var reserved="";if(options.allowReserved!==true){reserved=reservedWords$1[options.ecmaVersion>=6?6:options.ecmaVersion===5?5:3];if(options.sourceType==="module"){reserved+=" await";}}this.reservedWords=wordsRegexp$1(reserved);var reservedStrict=(reserved?reserved+" ":"")+reservedWords$1.strict;this.reservedWordsStrict=wordsRegexp$1(reservedStrict);this.reservedWordsStrictBind=wordsRegexp$1(reservedStrict+" "+reservedWords$1.strictBind);this.input=String(input);// Used to signal to callers of `readWord1` whether the word
// contained any escape sequences. This is needed because words with
// escape sequences must not be interpreted as keywords.
this.containsEsc=false;// Set up token state
// The current position of the tokenizer in the input.
if(startPos){this.pos=startPos;this.lineStart=this.input.lastIndexOf("\n",startPos-1)+1;this.curLine=this.input.slice(0,this.lineStart).split(lineBreak$1).length;}else{this.pos=this.lineStart=0;this.curLine=1;}// Properties of the current token:
// Its type
this.type=types$2.eof;// For tokens that include more information than their type, the value
this.value=null;// Its start and end offset
this.start=this.end=this.pos;// And, if locations are used, the {line, column} object
// corresponding to those offsets
this.startLoc=this.endLoc=this.curPosition();// Position information for the previous token
this.lastTokEndLoc=this.lastTokStartLoc=null;this.lastTokStart=this.lastTokEnd=this.pos;// The context stack is used to superficially track syntactic
// context to predict whether a regular expression is allowed in a
// given position.
this.context=this.initialContext();this.exprAllowed=true;// Figure out if it's a module code.
this.inModule=options.sourceType==="module";this.strict=this.inModule||this.strictDirective(this.pos);// Used to signify the start of a potential arrow function
this.potentialArrowAt=-1;this.potentialArrowInForAwait=false;// Positions to delayed-check that yield/await does not exist in default parameters.
this.yieldPos=this.awaitPos=this.awaitIdentPos=0;// Labels in scope.
this.labels=[];// Thus-far undefined exports.
this.undefinedExports=Object.create(null);// If enabled, skip leading hashbang line.
if(this.pos===0&&options.allowHashBang&&this.input.slice(0,2)==="#!"){this.skipLineComment(2);}// Scope tracking for duplicate variable names (see scope.js)
this.scopeStack=[];this.enterScope(SCOPE_TOP$1);// For RegExp validation
this.regexpState=null;// The stack of private names.
// Each element has two properties: 'declared' and 'used'.
// When it exited from the outermost class definition, all used private names must be declared.
this.privateNameStack=[];};var prototypeAccessors$1={inFunction:{configurable:true},inGenerator:{configurable:true},inAsync:{configurable:true},allowSuper:{configurable:true},allowDirectSuper:{configurable:true},treatFunctionsAsVar:{configurable:true},inNonArrowFunction:{configurable:true}};Parser$1.prototype.parse=function parse(){var node=this.options.program||this.startNode();this.nextToken();return this.parseTopLevel(node);};prototypeAccessors$1.inFunction.get=function(){return(this.currentVarScope().flags&SCOPE_FUNCTION$1)>0;};prototypeAccessors$1.inGenerator.get=function(){return(this.currentVarScope().flags&SCOPE_GENERATOR$1)>0&&!this.currentVarScope().inClassFieldInit;};prototypeAccessors$1.inAsync.get=function(){return(this.currentVarScope().flags&SCOPE_ASYNC$1)>0&&!this.currentVarScope().inClassFieldInit;};prototypeAccessors$1.allowSuper.get=function(){var ref=this.currentThisScope();var flags=ref.flags;var inClassFieldInit=ref.inClassFieldInit;return(flags&SCOPE_SUPER$1)>0||inClassFieldInit;};prototypeAccessors$1.allowDirectSuper.get=function(){return(this.currentThisScope().flags&SCOPE_DIRECT_SUPER$1)>0;};prototypeAccessors$1.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope());};prototypeAccessors$1.inNonArrowFunction.get=function(){var ref=this.currentThisScope();var flags=ref.flags;var inClassFieldInit=ref.inClassFieldInit;return(flags&SCOPE_FUNCTION$1)>0||inClassFieldInit;};Parser$1.extend=function extend(){var plugins=[],len=arguments.length;while(len--){plugins[len]=arguments[len];}var cls=this;for(var i=0;i<plugins.length;i++){cls=plugins[i](cls);}return cls;};Parser$1.parse=function parse(input,options){return new this(options,input).parse();};Parser$1.parseExpressionAt=function parseExpressionAt(input,pos,options){var parser=new this(options,input,pos);parser.nextToken();return parser.parseExpression();};Parser$1.tokenizer=function tokenizer(input,options){return new this(options,input);};Object.defineProperties(Parser$1.prototype,prototypeAccessors$1);var pp$a=Parser$1.prototype;// ## Parser utilities
var literal$1=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;pp$a.strictDirective=function(start){for(;;){// Try to find string literal.
skipWhiteSpace$1.lastIndex=start;start+=skipWhiteSpace$1.exec(this.input)[0].length;var match=literal$1.exec(this.input.slice(start));if(!match){return false;}if((match[1]||match[2])==="use strict"){skipWhiteSpace$1.lastIndex=start+match[0].length;var spaceAfter=skipWhiteSpace$1.exec(this.input),end=spaceAfter.index+spaceAfter[0].length;var next=this.input.charAt(end);return next===";"||next==="}"||lineBreak$1.test(spaceAfter[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(next)||next==="!"&&this.input.charAt(end+1)==="=");}start+=match[0].length;// Skip semicolon, if any.
skipWhiteSpace$1.lastIndex=start;start+=skipWhiteSpace$1.exec(this.input)[0].length;if(this.input[start]===";"){start++;}}};// Predicate that tests whether the next token is of the given
// type, and if yes, consumes it as a side effect.
pp$a.eat=function(type){if(this.type===type){this.next();return true;}else{return false;}};// Tests whether parsed token is a contextual keyword.
pp$a.isContextual=function(name){return this.type===types$2.name&&this.value===name&&!this.containsEsc;};// Consumes contextual keyword if possible.
pp$a.eatContextual=function(name){if(!this.isContextual(name)){return false;}this.next();return true;};// Asserts that following token is given contextual keyword.
pp$a.expectContextual=function(name){if(!this.eatContextual(name)){this.unexpected();}};// Test whether a semicolon can be inserted at the current position.
pp$a.canInsertSemicolon=function(){return this.type===types$2.eof||this.type===types$2.braceR||lineBreak$1.test(this.input.slice(this.lastTokEnd,this.start));};pp$a.insertSemicolon=function(){if(this.canInsertSemicolon()){if(this.options.onInsertedSemicolon){this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc);}return true;}};// Consume a semicolon, or, failing that, see if we are allowed to
// pretend that there is a semicolon at this position.
pp$a.semicolon=function(){if(!this.eat(types$2.semi)&&!this.insertSemicolon()){this.unexpected();}};pp$a.afterTrailingComma=function(tokType,notNext){if(this.type===tokType){if(this.options.onTrailingComma){this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc);}if(!notNext){this.next();}return true;}};// Expect a token of a given type. If found, consume it, otherwise,
// raise an unexpected token error.
pp$a.expect=function(type){this.eat(type)||this.unexpected();};// Raise an unexpected token error.
pp$a.unexpected=function(pos){this.raise(pos!=null?pos:this.start,"Unexpected token");};function DestructuringErrors$1(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1;}pp$a.checkPatternErrors=function(refDestructuringErrors,isAssign){if(!refDestructuringErrors){return;}if(refDestructuringErrors.trailingComma>-1){this.raiseRecoverable(refDestructuringErrors.trailingComma,"Comma is not permitted after the rest element");}var parens=isAssign?refDestructuringErrors.parenthesizedAssign:refDestructuringErrors.parenthesizedBind;if(parens>-1){this.raiseRecoverable(parens,"Parenthesized pattern");}};pp$a.checkExpressionErrors=function(refDestructuringErrors,andThrow){if(!refDestructuringErrors){return false;}var shorthandAssign=refDestructuringErrors.shorthandAssign;var doubleProto=refDestructuringErrors.doubleProto;if(!andThrow){return shorthandAssign>=0||doubleProto>=0;}if(shorthandAssign>=0){this.raise(shorthandAssign,"Shorthand property assignments are valid only in destructuring patterns");}if(doubleProto>=0){this.raiseRecoverable(doubleProto,"Redefinition of __proto__ property");}};pp$a.checkYieldAwaitInDefaultParams=function(){if(this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)){this.raise(this.yieldPos,"Yield expression cannot be a default value");}if(this.awaitPos){this.raise(this.awaitPos,"Await expression cannot be a default value");}};pp$a.isSimpleAssignTarget=function(expr){if(expr.type==="ParenthesizedExpression"){return this.isSimpleAssignTarget(expr.expression);}return expr.type==="Identifier"||expr.type==="MemberExpression";};var pp$1$1=Parser$1.prototype;// ### Statement parsing
// Parse a program. Initializes the parser, reads any number of
// statements, and wraps them in a Program node.  Optionally takes a
// `program` argument.  If present, the statements will be appended
// to its body instead of creating a new node.
pp$1$1.parseTopLevel=function(node){var exports=Object.create(null);if(!node.body){node.body=[];}while(this.type!==types$2.eof){var stmt=this.parseStatement(null,true,exports);node.body.push(stmt);}if(this.inModule){for(var i=0,list=Object.keys(this.undefinedExports);i<list.length;i+=1){var name=list[i];this.raiseRecoverable(this.undefinedExports[name].start,"Export '"+name+"' is not defined");}}this.adaptDirectivePrologue(node.body);this.next();node.sourceType=this.options.sourceType;return this.finishNode(node,"Program");};var loopLabel$1={kind:"loop"},switchLabel$1={kind:"switch"};pp$1$1.isLet=function(context){if(this.options.ecmaVersion<6||!this.isContextual("let")){return false;}skipWhiteSpace$1.lastIndex=this.pos;var skip=skipWhiteSpace$1.exec(this.input);var next=this.pos+skip[0].length,nextCh=this.input.charCodeAt(next);// For ambiguous cases, determine if a LexicalDeclaration (or only a
// Statement) is allowed here. If context is not empty then only a Statement
// is allowed. However, `let [` is an explicit negative lookahead for
// ExpressionStatement, so special-case it first.
if(nextCh===91){return true;}// '['
if(context){return false;}if(nextCh===123){return true;}// '{'
if(isIdentifierStart$1(nextCh,true)){var pos=next+1;while(isIdentifierChar$1(this.input.charCodeAt(pos),true)){++pos;}var ident=this.input.slice(next,pos);if(!keywordRelationalOperator$1.test(ident)){return true;}}return false;};// check 'async [no LineTerminator here] function'
// - 'async /*foo*/ function' is OK.
// - 'async /*\n*/ function' is invalid.
pp$1$1.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async")){return false;}skipWhiteSpace$1.lastIndex=this.pos;var skip=skipWhiteSpace$1.exec(this.input);var next=this.pos+skip[0].length;return!lineBreak$1.test(this.input.slice(this.pos,next))&&this.input.slice(next,next+8)==="function"&&(next+8===this.input.length||!isIdentifierChar$1(this.input.charAt(next+8)));};// Parse a single statement.
//
// If expecting a statement and finding a slash operator, parse a
// regular expression literal. This is to handle cases like
// `if (foo) /blah/.exec(foo)`, where looking at the previous token
// does not help.
pp$1$1.parseStatement=function(context,topLevel,exports){var starttype=this.type,node=this.startNode(),kind;if(this.isLet(context)){starttype=types$2._var;kind="let";}// Most types of statements are recognized by the keyword they
// start with. Many are trivial to parse, some require a bit of
// complexity.
switch(starttype){case types$2._break:case types$2._continue:return this.parseBreakContinueStatement(node,starttype.keyword);case types$2._debugger:return this.parseDebuggerStatement(node);case types$2._do:return this.parseDoStatement(node);case types$2._for:return this.parseForStatement(node);case types$2._function:// Function as sole body of either an if statement or a labeled statement
// works, but not when it is part of a labeled statement that is the sole
// body of an if statement.
if(context&&(this.strict||context!=="if"&&context!=="label")&&this.options.ecmaVersion>=6){this.unexpected();}return this.parseFunctionStatement(node,false,!context);case types$2._class:if(context){this.unexpected();}return this.parseClass(node,true);case types$2._if:return this.parseIfStatement(node);case types$2._return:return this.parseReturnStatement(node);case types$2._switch:return this.parseSwitchStatement(node);case types$2._throw:return this.parseThrowStatement(node);case types$2._try:return this.parseTryStatement(node);case types$2._const:case types$2._var:kind=kind||this.value;if(context&&kind!=="var"){this.unexpected();}return this.parseVarStatement(node,kind);case types$2._while:return this.parseWhileStatement(node);case types$2._with:return this.parseWithStatement(node);case types$2.braceL:return this.parseBlock(true,node);case types$2.semi:return this.parseEmptyStatement(node);case types$2._export:case types$2._import:if(this.options.ecmaVersion>10&&starttype===types$2._import){skipWhiteSpace$1.lastIndex=this.pos;var skip=skipWhiteSpace$1.exec(this.input);var next=this.pos+skip[0].length,nextCh=this.input.charCodeAt(next);if(nextCh===40||nextCh===46)// '(' or '.'
{return this.parseExpressionStatement(node,this.parseExpression());}}if(!this.options.allowImportExportEverywhere){if(!topLevel){this.raise(this.start,"'import' and 'export' may only appear at the top level");}if(!this.inModule){this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'");}}return starttype===types$2._import?this.parseImport(node):this.parseExport(node,exports);// If the statement does not start with a statement keyword or a
// brace, it's an ExpressionStatement or LabeledStatement. We
// simply start parsing an expression, and afterwards, if the
// next token is a colon and the expression was a simple
// Identifier node, we switch to interpreting it as a label.
default:if(this.isAsyncFunction()){if(context){this.unexpected();}this.next();return this.parseFunctionStatement(node,true,!context);}var maybeName=this.value,expr=this.parseExpression();if(starttype===types$2.name&&expr.type==="Identifier"&&this.eat(types$2.colon)){return this.parseLabeledStatement(node,maybeName,expr,context);}else{return this.parseExpressionStatement(node,expr);}}};pp$1$1.parseBreakContinueStatement=function(node,keyword){var isBreak=keyword==="break";this.next();if(this.eat(types$2.semi)||this.insertSemicolon()){node.label=null;}else if(this.type!==types$2.name){this.unexpected();}else{node.label=this.parseIdent();this.semicolon();}// Verify that there is an actual destination to break or
// continue to.
var i=0;for(;i<this.labels.length;++i){var lab=this.labels[i];if(node.label==null||lab.name===node.label.name){if(lab.kind!=null&&(isBreak||lab.kind==="loop")){break;}if(node.label&&isBreak){break;}}}if(i===this.labels.length){this.raise(node.start,"Unsyntactic "+keyword);}return this.finishNode(node,isBreak?"BreakStatement":"ContinueStatement");};pp$1$1.parseDebuggerStatement=function(node){this.next();this.semicolon();return this.finishNode(node,"DebuggerStatement");};pp$1$1.parseDoStatement=function(node){this.next();this.labels.push(loopLabel$1);node.body=this.parseStatement("do");this.labels.pop();this.expect(types$2._while);node.test=this.parseParenExpression();if(this.options.ecmaVersion>=6){this.eat(types$2.semi);}else{this.semicolon();}return this.finishNode(node,"DoWhileStatement");};// Disambiguating between a `for` and a `for`/`in` or `for`/`of`
// loop is non-trivial. Basically, we have to parse the init `var`
// statement or expression, disallowing the `in` operator (see
// the second parameter to `parseExpression`), and then check
// whether the next token is `in` or `of`. When there is no init
// part (semicolon immediately after the opening parenthesis), it
// is a regular `for` loop.
pp$1$1.parseForStatement=function(node){this.next();var awaitAt=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;this.labels.push(loopLabel$1);this.enterScope(0);this.expect(types$2.parenL);if(this.type===types$2.semi){if(awaitAt>-1){this.unexpected(awaitAt);}return this.parseFor(node,null);}var isLet=this.isLet();if(this.type===types$2._var||this.type===types$2._const||isLet){var init$1=this.startNode(),kind=isLet?"let":this.value;this.next();this.parseVar(init$1,true,kind);this.finishNode(init$1,"VariableDeclaration");if((this.type===types$2._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&init$1.declarations.length===1){if(this.options.ecmaVersion>=9){if(this.type===types$2._in){if(awaitAt>-1){this.unexpected(awaitAt);}}else{node["await"]=awaitAt>-1;}}return this.parseForIn(node,init$1);}if(awaitAt>-1){this.unexpected(awaitAt);}return this.parseFor(node,init$1);}var refDestructuringErrors=new DestructuringErrors$1();var init=this.parseExpression(awaitAt>-1?"await":true,refDestructuringErrors);if(this.type===types$2._in||this.options.ecmaVersion>=6&&this.isContextual("of")){if(this.options.ecmaVersion>=9){if(this.type===types$2._in){if(awaitAt>-1){this.unexpected(awaitAt);}}else{node["await"]=awaitAt>-1;}}this.toAssignable(init,false,refDestructuringErrors);this.checkLValPattern(init);return this.parseForIn(node,init);}else{this.checkExpressionErrors(refDestructuringErrors,true);}if(awaitAt>-1){this.unexpected(awaitAt);}return this.parseFor(node,init);};pp$1$1.parseFunctionStatement=function(node,isAsync,declarationPosition){this.next();return this.parseFunction(node,FUNC_STATEMENT$1|(declarationPosition?0:FUNC_HANGING_STATEMENT$1),false,isAsync);};pp$1$1.parseIfStatement=function(node){this.next();node.test=this.parseParenExpression();// allow function declarations in branches, but only in non-strict mode
node.consequent=this.parseStatement("if");node.alternate=this.eat(types$2._else)?this.parseStatement("if"):null;return this.finishNode(node,"IfStatement");};pp$1$1.parseReturnStatement=function(node){if(!this.inFunction&&!this.options.allowReturnOutsideFunction){this.raise(this.start,"'return' outside of function");}this.next();// In `return` (and `break`/`continue`), the keywords with
// optional arguments, we eagerly look for a semicolon or the
// possibility to insert one.
if(this.eat(types$2.semi)||this.insertSemicolon()){node.argument=null;}else{node.argument=this.parseExpression();this.semicolon();}return this.finishNode(node,"ReturnStatement");};pp$1$1.parseSwitchStatement=function(node){this.next();node.discriminant=this.parseParenExpression();node.cases=[];this.expect(types$2.braceL);this.labels.push(switchLabel$1);this.enterScope(0);// Statements under must be grouped (by label) in SwitchCase
// nodes. `cur` is used to keep the node that we are currently
// adding statements to.
var cur;for(var sawDefault=false;this.type!==types$2.braceR;){if(this.type===types$2._case||this.type===types$2._default){var isCase=this.type===types$2._case;if(cur){this.finishNode(cur,"SwitchCase");}node.cases.push(cur=this.startNode());cur.consequent=[];this.next();if(isCase){cur.test=this.parseExpression();}else{if(sawDefault){this.raiseRecoverable(this.lastTokStart,"Multiple default clauses");}sawDefault=true;cur.test=null;}this.expect(types$2.colon);}else{if(!cur){this.unexpected();}cur.consequent.push(this.parseStatement(null));}}this.exitScope();if(cur){this.finishNode(cur,"SwitchCase");}this.next();// Closing brace
this.labels.pop();return this.finishNode(node,"SwitchStatement");};pp$1$1.parseThrowStatement=function(node){this.next();if(lineBreak$1.test(this.input.slice(this.lastTokEnd,this.start))){this.raise(this.lastTokEnd,"Illegal newline after throw");}node.argument=this.parseExpression();this.semicolon();return this.finishNode(node,"ThrowStatement");};// Reused empty array added for node fields that are always empty.
var empty$2=[];pp$1$1.parseTryStatement=function(node){this.next();node.block=this.parseBlock();node.handler=null;if(this.type===types$2._catch){var clause=this.startNode();this.next();if(this.eat(types$2.parenL)){clause.param=this.parseBindingAtom();var simple=clause.param.type==="Identifier";this.enterScope(simple?SCOPE_SIMPLE_CATCH$1:0);this.checkLValPattern(clause.param,simple?BIND_SIMPLE_CATCH$1:BIND_LEXICAL$1);this.expect(types$2.parenR);}else{if(this.options.ecmaVersion<10){this.unexpected();}clause.param=null;this.enterScope(0);}clause.body=this.parseBlock(false);this.exitScope();node.handler=this.finishNode(clause,"CatchClause");}node.finalizer=this.eat(types$2._finally)?this.parseBlock():null;if(!node.handler&&!node.finalizer){this.raise(node.start,"Missing catch or finally clause");}return this.finishNode(node,"TryStatement");};pp$1$1.parseVarStatement=function(node,kind){this.next();this.parseVar(node,false,kind);this.semicolon();return this.finishNode(node,"VariableDeclaration");};pp$1$1.parseWhileStatement=function(node){this.next();node.test=this.parseParenExpression();this.labels.push(loopLabel$1);node.body=this.parseStatement("while");this.labels.pop();return this.finishNode(node,"WhileStatement");};pp$1$1.parseWithStatement=function(node){if(this.strict){this.raise(this.start,"'with' in strict mode");}this.next();node.object=this.parseParenExpression();node.body=this.parseStatement("with");return this.finishNode(node,"WithStatement");};pp$1$1.parseEmptyStatement=function(node){this.next();return this.finishNode(node,"EmptyStatement");};pp$1$1.parseLabeledStatement=function(node,maybeName,expr,context){for(var i$1=0,list=this.labels;i$1<list.length;i$1+=1){var label=list[i$1];if(label.name===maybeName){this.raise(expr.start,"Label '"+maybeName+"' is already declared");}}var kind=this.type.isLoop?"loop":this.type===types$2._switch?"switch":null;for(var i=this.labels.length-1;i>=0;i--){var label$1=this.labels[i];if(label$1.statementStart===node.start){// Update information about previous labels on this node
label$1.statementStart=this.start;label$1.kind=kind;}else{break;}}this.labels.push({name:maybeName,kind:kind,statementStart:this.start});node.body=this.parseStatement(context?context.indexOf("label")===-1?context+"label":context:"label");this.labels.pop();node.label=expr;return this.finishNode(node,"LabeledStatement");};pp$1$1.parseExpressionStatement=function(node,expr){node.expression=expr;this.semicolon();return this.finishNode(node,"ExpressionStatement");};// Parse a semicolon-enclosed block of statements, handling `"use
// strict"` declarations when `allowStrict` is true (used for
// function bodies).
pp$1$1.parseBlock=function(createNewLexicalScope,node,exitStrict){if(createNewLexicalScope===void 0)createNewLexicalScope=true;if(node===void 0)node=this.startNode();node.body=[];this.expect(types$2.braceL);if(createNewLexicalScope){this.enterScope(0);}while(this.type!==types$2.braceR){var stmt=this.parseStatement(null);node.body.push(stmt);}if(exitStrict){this.strict=false;}this.next();if(createNewLexicalScope){this.exitScope();}return this.finishNode(node,"BlockStatement");};// Parse a regular `for` loop. The disambiguation code in
// `parseStatement` will already have parsed the init statement or
// expression.
pp$1$1.parseFor=function(node,init){node.init=init;this.expect(types$2.semi);node.test=this.type===types$2.semi?null:this.parseExpression();this.expect(types$2.semi);node.update=this.type===types$2.parenR?null:this.parseExpression();this.expect(types$2.parenR);node.body=this.parseStatement("for");this.exitScope();this.labels.pop();return this.finishNode(node,"ForStatement");};// Parse a `for`/`in` and `for`/`of` loop, which are almost
// same from parser's perspective.
pp$1$1.parseForIn=function(node,init){var isForIn=this.type===types$2._in;this.next();if(init.type==="VariableDeclaration"&&init.declarations[0].init!=null&&(!isForIn||this.options.ecmaVersion<8||this.strict||init.kind!=="var"||init.declarations[0].id.type!=="Identifier")){this.raise(init.start,(isForIn?"for-in":"for-of")+" loop variable declaration may not have an initializer");}node.left=init;node.right=isForIn?this.parseExpression():this.parseMaybeAssign();this.expect(types$2.parenR);node.body=this.parseStatement("for");this.exitScope();this.labels.pop();return this.finishNode(node,isForIn?"ForInStatement":"ForOfStatement");};// Parse a list of variable declarations.
pp$1$1.parseVar=function(node,isFor,kind){node.declarations=[];node.kind=kind;for(;;){var decl=this.startNode();this.parseVarId(decl,kind);if(this.eat(types$2.eq)){decl.init=this.parseMaybeAssign(isFor);}else if(kind==="const"&&!(this.type===types$2._in||this.options.ecmaVersion>=6&&this.isContextual("of"))){this.unexpected();}else if(decl.id.type!=="Identifier"&&!(isFor&&(this.type===types$2._in||this.isContextual("of")))){this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value");}else{decl.init=null;}node.declarations.push(this.finishNode(decl,"VariableDeclarator"));if(!this.eat(types$2.comma)){break;}}return node;};pp$1$1.parseVarId=function(decl,kind){decl.id=this.parseBindingAtom();this.checkLValPattern(decl.id,kind==="var"?BIND_VAR$1:BIND_LEXICAL$1,false);};var FUNC_STATEMENT$1=1,FUNC_HANGING_STATEMENT$1=2,FUNC_NULLABLE_ID$1=4;// Parse a function declaration or literal (depending on the
// `statement & FUNC_STATEMENT`).
// Remove `allowExpressionBody` for 7.0.0, as it is only called with false
pp$1$1.parseFunction=function(node,statement,allowExpressionBody,isAsync){this.initFunction(node);if(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!isAsync){if(this.type===types$2.star&&statement&FUNC_HANGING_STATEMENT$1){this.unexpected();}node.generator=this.eat(types$2.star);}if(this.options.ecmaVersion>=8){node.async=!!isAsync;}if(statement&FUNC_STATEMENT$1){node.id=statement&FUNC_NULLABLE_ID$1&&this.type!==types$2.name?null:this.parseIdent();if(node.id&&!(statement&FUNC_HANGING_STATEMENT$1))// If it is a regular function declaration in sloppy mode, then it is
// subject to Annex B semantics (BIND_FUNCTION). Otherwise, the binding
// mode depends on properties of the current scope (see
// treatFunctionsAsVar).
{this.checkLValSimple(node.id,this.strict||node.generator||node.async?this.treatFunctionsAsVar?BIND_VAR$1:BIND_LEXICAL$1:BIND_FUNCTION$1);}}var oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;this.enterScope(functionFlags$1(node.async,node.generator));if(!(statement&FUNC_STATEMENT$1)){node.id=this.type===types$2.name?this.parseIdent():null;}this.parseFunctionParams(node);this.parseFunctionBody(node,allowExpressionBody,false);this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.finishNode(node,statement&FUNC_STATEMENT$1?"FunctionDeclaration":"FunctionExpression");};pp$1$1.parseFunctionParams=function(node){this.expect(types$2.parenL);node.params=this.parseBindingList(types$2.parenR,false,this.options.ecmaVersion>=8);this.checkYieldAwaitInDefaultParams();};// Parse a class declaration or literal (depending on the
// `isStatement` parameter).
pp$1$1.parseClass=function(node,isStatement){this.next();// ecma-262 14.6 Class Definitions
// A class definition is always strict mode code.
var oldStrict=this.strict;this.strict=true;this.parseClassId(node,isStatement);this.parseClassSuper(node);var privateNameMap=this.enterClassBody();var classBody=this.startNode();var hadConstructor=false;classBody.body=[];this.expect(types$2.braceL);while(this.type!==types$2.braceR){var element=this.parseClassElement(node.superClass!==null);if(element){classBody.body.push(element);if(element.type==="MethodDefinition"&&element.kind==="constructor"){if(hadConstructor){this.raise(element.start,"Duplicate constructor in the same class");}hadConstructor=true;}else if(element.key.type==="PrivateIdentifier"&&isPrivateNameConflicted(privateNameMap,element)){this.raiseRecoverable(element.key.start,"Identifier '#"+element.key.name+"' has already been declared");}}}this.strict=oldStrict;this.next();node.body=this.finishNode(classBody,"ClassBody");this.exitClassBody();return this.finishNode(node,isStatement?"ClassDeclaration":"ClassExpression");};pp$1$1.parseClassElement=function(constructorAllowsSuper){if(this.eat(types$2.semi)){return null;}var ecmaVersion=this.options.ecmaVersion;var node=this.startNode();var keyName="";var isGenerator=false;var isAsync=false;var kind="method";// Parse modifiers
node["static"]=false;if(this.eatContextual("static")){if(this.isClassElementNameStart()||this.type===types$2.star){node["static"]=true;}else{keyName="static";}}if(!keyName&&ecmaVersion>=8&&this.eatContextual("async")){if((this.isClassElementNameStart()||this.type===types$2.star)&&!this.canInsertSemicolon()){isAsync=true;}else{keyName="async";}}if(!keyName&&(ecmaVersion>=9||!isAsync)&&this.eat(types$2.star)){isGenerator=true;}if(!keyName&&!isAsync&&!isGenerator){var lastValue=this.value;if(this.eatContextual("get")||this.eatContextual("set")){if(this.isClassElementNameStart()){kind=lastValue;}else{keyName=lastValue;}}}// Parse element name
if(keyName){// 'async', 'get', 'set', or 'static' were not a keyword contextually.
// The last token is any of those. Make it the element name.
node.computed=false;node.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc);node.key.name=keyName;this.finishNode(node.key,"Identifier");}else{this.parseClassElementName(node);}// Parse element value
if(ecmaVersion<13||this.type===types$2.parenL||kind!=="method"||isGenerator||isAsync){var isConstructor=!node["static"]&&checkKeyName(node,"constructor");var allowsDirectSuper=isConstructor&&constructorAllowsSuper;// Couldn't move this check into the 'parseClassMethod' method for backward compatibility.
if(isConstructor&&kind!=="method"){this.raise(node.key.start,"Constructor can't have get/set modifier");}node.kind=isConstructor?"constructor":kind;this.parseClassMethod(node,isGenerator,isAsync,allowsDirectSuper);}else{this.parseClassField(node);}return node;};pp$1$1.isClassElementNameStart=function(){return this.type===types$2.name||this.type===types$2.privateId||this.type===types$2.num||this.type===types$2.string||this.type===types$2.bracketL||this.type.keyword;};pp$1$1.parseClassElementName=function(element){if(this.type===types$2.privateId){if(this.value==="constructor"){this.raise(this.start,"Classes can't have an element named '#constructor'");}element.computed=false;element.key=this.parsePrivateIdent();}else{this.parsePropertyName(element);}};pp$1$1.parseClassMethod=function(method,isGenerator,isAsync,allowsDirectSuper){// Check key and flags
var key=method.key;if(method.kind==="constructor"){if(isGenerator){this.raise(key.start,"Constructor can't be a generator");}if(isAsync){this.raise(key.start,"Constructor can't be an async method");}}else if(method["static"]&&checkKeyName(method,"prototype")){this.raise(key.start,"Classes may not have a static property named prototype");}// Parse value
var value=method.value=this.parseMethod(isGenerator,isAsync,allowsDirectSuper);// Check value
if(method.kind==="get"&&value.params.length!==0){this.raiseRecoverable(value.start,"getter should have no params");}if(method.kind==="set"&&value.params.length!==1){this.raiseRecoverable(value.start,"setter should have exactly one param");}if(method.kind==="set"&&value.params[0].type==="RestElement"){this.raiseRecoverable(value.params[0].start,"Setter cannot use rest params");}return this.finishNode(method,"MethodDefinition");};pp$1$1.parseClassField=function(field){if(checkKeyName(field,"constructor")){this.raise(field.key.start,"Classes can't have a field named 'constructor'");}else if(field["static"]&&checkKeyName(field,"prototype")){this.raise(field.key.start,"Classes can't have a static field named 'prototype'");}if(this.eat(types$2.eq)){// To raise SyntaxError if 'arguments' exists in the initializer.
var scope=this.currentThisScope();var inClassFieldInit=scope.inClassFieldInit;scope.inClassFieldInit=true;field.value=this.parseMaybeAssign();scope.inClassFieldInit=inClassFieldInit;}else{field.value=null;}this.semicolon();return this.finishNode(field,"PropertyDefinition");};pp$1$1.parseClassId=function(node,isStatement){if(this.type===types$2.name){node.id=this.parseIdent();if(isStatement){this.checkLValSimple(node.id,BIND_LEXICAL$1,false);}}else{if(isStatement===true){this.unexpected();}node.id=null;}};pp$1$1.parseClassSuper=function(node){node.superClass=this.eat(types$2._extends)?this.parseExprSubscripts():null;};pp$1$1.enterClassBody=function(){var element={declared:Object.create(null),used:[]};this.privateNameStack.push(element);return element.declared;};pp$1$1.exitClassBody=function(){var ref=this.privateNameStack.pop();var declared=ref.declared;var used=ref.used;var len=this.privateNameStack.length;var parent=len===0?null:this.privateNameStack[len-1];for(var i=0;i<used.length;++i){var id=used[i];if(!has$2(declared,id.name)){if(parent){parent.used.push(id);}else{this.raiseRecoverable(id.start,"Private field '#"+id.name+"' must be declared in an enclosing class");}}}};function isPrivateNameConflicted(privateNameMap,element){var name=element.key.name;var curr=privateNameMap[name];var next="true";if(element.type==="MethodDefinition"&&(element.kind==="get"||element.kind==="set")){next=(element["static"]?"s":"i")+element.kind;}// `class { get #a(){}; static set #a(_){} }` is also conflict.
if(curr==="iget"&&next==="iset"||curr==="iset"&&next==="iget"||curr==="sget"&&next==="sset"||curr==="sset"&&next==="sget"){privateNameMap[name]="true";return false;}else if(!curr){privateNameMap[name]=next;return false;}else{return true;}}function checkKeyName(node,name){var computed=node.computed;var key=node.key;return!computed&&(key.type==="Identifier"&&key.name===name||key.type==="Literal"&&key.value===name);}// Parses module export declaration.
pp$1$1.parseExport=function(node,exports){this.next();// export * from '...'
if(this.eat(types$2.star)){if(this.options.ecmaVersion>=11){if(this.eatContextual("as")){node.exported=this.parseIdent(true);this.checkExport(exports,node.exported.name,this.lastTokStart);}else{node.exported=null;}}this.expectContextual("from");if(this.type!==types$2.string){this.unexpected();}node.source=this.parseExprAtom();this.semicolon();return this.finishNode(node,"ExportAllDeclaration");}if(this.eat(types$2._default)){// export default ...
this.checkExport(exports,"default",this.lastTokStart);var isAsync;if(this.type===types$2._function||(isAsync=this.isAsyncFunction())){var fNode=this.startNode();this.next();if(isAsync){this.next();}node.declaration=this.parseFunction(fNode,FUNC_STATEMENT$1|FUNC_NULLABLE_ID$1,false,isAsync);}else if(this.type===types$2._class){var cNode=this.startNode();node.declaration=this.parseClass(cNode,"nullableID");}else{node.declaration=this.parseMaybeAssign();this.semicolon();}return this.finishNode(node,"ExportDefaultDeclaration");}// export var|const|let|function|class ...
if(this.shouldParseExportStatement()){node.declaration=this.parseStatement(null);if(node.declaration.type==="VariableDeclaration"){this.checkVariableExport(exports,node.declaration.declarations);}else{this.checkExport(exports,node.declaration.id.name,node.declaration.id.start);}node.specifiers=[];node.source=null;}else{// export { x, y as z } [from '...']
node.declaration=null;node.specifiers=this.parseExportSpecifiers(exports);if(this.eatContextual("from")){if(this.type!==types$2.string){this.unexpected();}node.source=this.parseExprAtom();}else{for(var i=0,list=node.specifiers;i<list.length;i+=1){// check for keywords used as local names
var spec=list[i];this.checkUnreserved(spec.local);// check if export is defined
this.checkLocalExport(spec.local);}node.source=null;}this.semicolon();}return this.finishNode(node,"ExportNamedDeclaration");};pp$1$1.checkExport=function(exports,name,pos){if(!exports){return;}if(has$2(exports,name)){this.raiseRecoverable(pos,"Duplicate export '"+name+"'");}exports[name]=true;};pp$1$1.checkPatternExport=function(exports,pat){var type=pat.type;if(type==="Identifier"){this.checkExport(exports,pat.name,pat.start);}else if(type==="ObjectPattern"){for(var i=0,list=pat.properties;i<list.length;i+=1){var prop=list[i];this.checkPatternExport(exports,prop);}}else if(type==="ArrayPattern"){for(var i$1=0,list$1=pat.elements;i$1<list$1.length;i$1+=1){var elt=list$1[i$1];if(elt){this.checkPatternExport(exports,elt);}}}else if(type==="Property"){this.checkPatternExport(exports,pat.value);}else if(type==="AssignmentPattern"){this.checkPatternExport(exports,pat.left);}else if(type==="RestElement"){this.checkPatternExport(exports,pat.argument);}else if(type==="ParenthesizedExpression"){this.checkPatternExport(exports,pat.expression);}};pp$1$1.checkVariableExport=function(exports,decls){if(!exports){return;}for(var i=0,list=decls;i<list.length;i+=1){var decl=list[i];this.checkPatternExport(exports,decl.id);}};pp$1$1.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction();};// Parses a comma-separated list of module exports.
pp$1$1.parseExportSpecifiers=function(exports){var nodes=[],first=true;// export { x, y as z } [from '...']
this.expect(types$2.braceL);while(!this.eat(types$2.braceR)){if(!first){this.expect(types$2.comma);if(this.afterTrailingComma(types$2.braceR)){break;}}else{first=false;}var node=this.startNode();node.local=this.parseIdent(true);node.exported=this.eatContextual("as")?this.parseIdent(true):node.local;this.checkExport(exports,node.exported.name,node.exported.start);nodes.push(this.finishNode(node,"ExportSpecifier"));}return nodes;};// Parses import declaration.
pp$1$1.parseImport=function(node){this.next();// import '...'
if(this.type===types$2.string){node.specifiers=empty$2;node.source=this.parseExprAtom();}else{node.specifiers=this.parseImportSpecifiers();this.expectContextual("from");node.source=this.type===types$2.string?this.parseExprAtom():this.unexpected();}this.semicolon();return this.finishNode(node,"ImportDeclaration");};// Parses a comma-separated list of module imports.
pp$1$1.parseImportSpecifiers=function(){var nodes=[],first=true;if(this.type===types$2.name){// import defaultObj, { x, y as z } from '...'
var node=this.startNode();node.local=this.parseIdent();this.checkLValSimple(node.local,BIND_LEXICAL$1);nodes.push(this.finishNode(node,"ImportDefaultSpecifier"));if(!this.eat(types$2.comma)){return nodes;}}if(this.type===types$2.star){var node$1=this.startNode();this.next();this.expectContextual("as");node$1.local=this.parseIdent();this.checkLValSimple(node$1.local,BIND_LEXICAL$1);nodes.push(this.finishNode(node$1,"ImportNamespaceSpecifier"));return nodes;}this.expect(types$2.braceL);while(!this.eat(types$2.braceR)){if(!first){this.expect(types$2.comma);if(this.afterTrailingComma(types$2.braceR)){break;}}else{first=false;}var node$2=this.startNode();node$2.imported=this.parseIdent(true);if(this.eatContextual("as")){node$2.local=this.parseIdent();}else{this.checkUnreserved(node$2.imported);node$2.local=node$2.imported;}this.checkLValSimple(node$2.local,BIND_LEXICAL$1);nodes.push(this.finishNode(node$2,"ImportSpecifier"));}return nodes;};// Set `ExpressionStatement#directive` property for directive prologues.
pp$1$1.adaptDirectivePrologue=function(statements){for(var i=0;i<statements.length&&this.isDirectiveCandidate(statements[i]);++i){statements[i].directive=statements[i].expression.raw.slice(1,-1);}};pp$1$1.isDirectiveCandidate=function(statement){return statement.type==="ExpressionStatement"&&statement.expression.type==="Literal"&&typeof statement.expression.value==="string"&&(// Reject parenthesized strings.
this.input[statement.start]==="\""||this.input[statement.start]==="'");};var pp$2$1=Parser$1.prototype;// Convert existing expression atom to assignable pattern
// if possible.
pp$2$1.toAssignable=function(node,isBinding,refDestructuringErrors){if(this.options.ecmaVersion>=6&&node){switch(node.type){case"Identifier":if(this.inAsync&&node.name==="await"){this.raise(node.start,"Cannot use 'await' as identifier inside an async function");}break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":node.type="ObjectPattern";if(refDestructuringErrors){this.checkPatternErrors(refDestructuringErrors,true);}for(var i=0,list=node.properties;i<list.length;i+=1){var prop=list[i];this.toAssignable(prop,isBinding);// Early error:
//   AssignmentRestProperty[Yield, Await] :
//     `...` DestructuringAssignmentTarget[Yield, Await]
//
//   It is a Syntax Error if |DestructuringAssignmentTarget| is an |ArrayLiteral| or an |ObjectLiteral|.
if(prop.type==="RestElement"&&(prop.argument.type==="ArrayPattern"||prop.argument.type==="ObjectPattern")){this.raise(prop.argument.start,"Unexpected token");}}break;case"Property":// AssignmentProperty has type === "Property"
if(node.kind!=="init"){this.raise(node.key.start,"Object pattern can't contain getter or setter");}this.toAssignable(node.value,isBinding);break;case"ArrayExpression":node.type="ArrayPattern";if(refDestructuringErrors){this.checkPatternErrors(refDestructuringErrors,true);}this.toAssignableList(node.elements,isBinding);break;case"SpreadElement":node.type="RestElement";this.toAssignable(node.argument,isBinding);if(node.argument.type==="AssignmentPattern"){this.raise(node.argument.start,"Rest elements cannot have a default value");}break;case"AssignmentExpression":if(node.operator!=="="){this.raise(node.left.end,"Only '=' operator can be used for specifying default value.");}node.type="AssignmentPattern";delete node.operator;this.toAssignable(node.left,isBinding);break;case"ParenthesizedExpression":this.toAssignable(node.expression,isBinding,refDestructuringErrors);break;case"ChainExpression":this.raiseRecoverable(node.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!isBinding){break;}default:this.raise(node.start,"Assigning to rvalue");}}else if(refDestructuringErrors){this.checkPatternErrors(refDestructuringErrors,true);}return node;};// Convert list of expression atoms to binding list.
pp$2$1.toAssignableList=function(exprList,isBinding){var end=exprList.length;for(var i=0;i<end;i++){var elt=exprList[i];if(elt){this.toAssignable(elt,isBinding);}}if(end){var last=exprList[end-1];if(this.options.ecmaVersion===6&&isBinding&&last&&last.type==="RestElement"&&last.argument.type!=="Identifier"){this.unexpected(last.argument.start);}}return exprList;};// Parses spread element.
pp$2$1.parseSpread=function(refDestructuringErrors){var node=this.startNode();this.next();node.argument=this.parseMaybeAssign(false,refDestructuringErrors);return this.finishNode(node,"SpreadElement");};pp$2$1.parseRestBinding=function(){var node=this.startNode();this.next();// RestElement inside of a function parameter must be an identifier
if(this.options.ecmaVersion===6&&this.type!==types$2.name){this.unexpected();}node.argument=this.parseBindingAtom();return this.finishNode(node,"RestElement");};// Parses lvalue (assignable) atom.
pp$2$1.parseBindingAtom=function(){if(this.options.ecmaVersion>=6){switch(this.type){case types$2.bracketL:var node=this.startNode();this.next();node.elements=this.parseBindingList(types$2.bracketR,true,true);return this.finishNode(node,"ArrayPattern");case types$2.braceL:return this.parseObj(true);}}return this.parseIdent();};pp$2$1.parseBindingList=function(close,allowEmpty,allowTrailingComma){var elts=[],first=true;while(!this.eat(close)){if(first){first=false;}else{this.expect(types$2.comma);}if(allowEmpty&&this.type===types$2.comma){elts.push(null);}else if(allowTrailingComma&&this.afterTrailingComma(close)){break;}else if(this.type===types$2.ellipsis){var rest=this.parseRestBinding();this.parseBindingListItem(rest);elts.push(rest);if(this.type===types$2.comma){this.raise(this.start,"Comma is not permitted after the rest element");}this.expect(close);break;}else{var elem=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(elem);elts.push(elem);}}return elts;};pp$2$1.parseBindingListItem=function(param){return param;};// Parses assignment pattern around given atom if possible.
pp$2$1.parseMaybeDefault=function(startPos,startLoc,left){left=left||this.parseBindingAtom();if(this.options.ecmaVersion<6||!this.eat(types$2.eq)){return left;}var node=this.startNodeAt(startPos,startLoc);node.left=left;node.right=this.parseMaybeAssign();return this.finishNode(node,"AssignmentPattern");};// The following three functions all verify that a node is an lvalue —
// something that can be bound, or assigned to. In order to do so, they perform
// a variety of checks:
//
// - Check that none of the bound/assigned-to identifiers are reserved words.
// - Record name declarations for bindings in the appropriate scope.
// - Check duplicate argument names, if checkClashes is set.
//
// If a complex binding pattern is encountered (e.g., object and array
// destructuring), the entire pattern is recursively checked.
//
// There are three versions of checkLVal*() appropriate for different
// circumstances:
//
// - checkLValSimple() shall be used if the syntactic construct supports
//   nothing other than identifiers and member expressions. Parenthesized
//   expressions are also correctly handled. This is generally appropriate for
//   constructs for which the spec says
//
//   > It is a Syntax Error if AssignmentTargetType of [the production] is not
//   > simple.
//
//   It is also appropriate for checking if an identifier is valid and not
//   defined elsewhere, like import declarations or function/class identifiers.
//
//   Examples where this is used include:
//     a += …;
//     import a from '…';
//   where a is the node to be checked.
//
// - checkLValPattern() shall be used if the syntactic construct supports
//   anything checkLValSimple() supports, as well as object and array
//   destructuring patterns. This is generally appropriate for constructs for
//   which the spec says
//
//   > It is a Syntax Error if [the production] is neither an ObjectLiteral nor
//   > an ArrayLiteral and AssignmentTargetType of [the production] is not
//   > simple.
//
//   Examples where this is used include:
//     (a = …);
//     const a = …;
//     try { … } catch (a) { … }
//   where a is the node to be checked.
//
// - checkLValInnerPattern() shall be used if the syntactic construct supports
//   anything checkLValPattern() supports, as well as default assignment
//   patterns, rest elements, and other constructs that may appear within an
//   object or array destructuring pattern.
//
//   As a special case, function parameters also use checkLValInnerPattern(),
//   as they also support defaults and rest constructs.
//
// These functions deliberately support both assignment and binding constructs,
// as the logic for both is exceedingly similar. If the node is the target of
// an assignment, then bindingType should be set to BIND_NONE. Otherwise, it
// should be set to the appropriate BIND_* constant, like BIND_VAR or
// BIND_LEXICAL.
//
// If the function is called with a non-BIND_NONE bindingType, then
// additionally a checkClashes object may be specified to allow checking for
// duplicate argument names. checkClashes is ignored if the provided construct
// is an assignment (i.e., bindingType is BIND_NONE).
pp$2$1.checkLValSimple=function(expr,bindingType,checkClashes){if(bindingType===void 0)bindingType=BIND_NONE$1;var isBind=bindingType!==BIND_NONE$1;switch(expr.type){case"Identifier":if(this.strict&&this.reservedWordsStrictBind.test(expr.name)){this.raiseRecoverable(expr.start,(isBind?"Binding ":"Assigning to ")+expr.name+" in strict mode");}if(isBind){if(bindingType===BIND_LEXICAL$1&&expr.name==="let"){this.raiseRecoverable(expr.start,"let is disallowed as a lexically bound name");}if(checkClashes){if(has$2(checkClashes,expr.name)){this.raiseRecoverable(expr.start,"Argument name clash");}checkClashes[expr.name]=true;}if(bindingType!==BIND_OUTSIDE$1){this.declareName(expr.name,bindingType,expr.start);}}break;case"ChainExpression":this.raiseRecoverable(expr.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(isBind){this.raiseRecoverable(expr.start,"Binding member expression");}break;case"ParenthesizedExpression":if(isBind){this.raiseRecoverable(expr.start,"Binding parenthesized expression");}return this.checkLValSimple(expr.expression,bindingType,checkClashes);default:this.raise(expr.start,(isBind?"Binding":"Assigning to")+" rvalue");}};pp$2$1.checkLValPattern=function(expr,bindingType,checkClashes){if(bindingType===void 0)bindingType=BIND_NONE$1;switch(expr.type){case"ObjectPattern":for(var i=0,list=expr.properties;i<list.length;i+=1){var prop=list[i];this.checkLValInnerPattern(prop,bindingType,checkClashes);}break;case"ArrayPattern":for(var i$1=0,list$1=expr.elements;i$1<list$1.length;i$1+=1){var elem=list$1[i$1];if(elem){this.checkLValInnerPattern(elem,bindingType,checkClashes);}}break;default:this.checkLValSimple(expr,bindingType,checkClashes);}};pp$2$1.checkLValInnerPattern=function(expr,bindingType,checkClashes){if(bindingType===void 0)bindingType=BIND_NONE$1;switch(expr.type){case"Property":// AssignmentProperty has type === "Property"
this.checkLValInnerPattern(expr.value,bindingType,checkClashes);break;case"AssignmentPattern":this.checkLValPattern(expr.left,bindingType,checkClashes);break;case"RestElement":this.checkLValPattern(expr.argument,bindingType,checkClashes);break;default:this.checkLValPattern(expr,bindingType,checkClashes);}};// A recursive descent parser operates by defining functions for all
var pp$3$1=Parser$1.prototype;// Check if property name clashes with already added.
// Object/class getters and setters are not allowed to clash —
// either with each other or with an init property — and in
// strict mode, init properties are also not allowed to be repeated.
pp$3$1.checkPropClash=function(prop,propHash,refDestructuringErrors){if(this.options.ecmaVersion>=9&&prop.type==="SpreadElement"){return;}if(this.options.ecmaVersion>=6&&(prop.computed||prop.method||prop.shorthand)){return;}var key=prop.key;var name;switch(key.type){case"Identifier":name=key.name;break;case"Literal":name=String(key.value);break;default:return;}var kind=prop.kind;if(this.options.ecmaVersion>=6){if(name==="__proto__"&&kind==="init"){if(propHash.proto){if(refDestructuringErrors){if(refDestructuringErrors.doubleProto<0){refDestructuringErrors.doubleProto=key.start;}// Backwards-compat kludge. Can be removed in version 6.0
}else{this.raiseRecoverable(key.start,"Redefinition of __proto__ property");}}propHash.proto=true;}return;}name="$"+name;var other=propHash[name];if(other){var redefinition;if(kind==="init"){redefinition=this.strict&&other.init||other.get||other.set;}else{redefinition=other.init||other[kind];}if(redefinition){this.raiseRecoverable(key.start,"Redefinition of property");}}else{other=propHash[name]={init:false,get:false,set:false};}other[kind]=true;};// ### Expression parsing
// These nest, from the most general expression type at the top to
// 'atomic', nondivisible expression types at the bottom. Most of
// the functions will simply let the function(s) below them parse,
// and, *if* the syntactic construct they handle is present, wrap
// the AST node that the inner parser gave them in another node.
// Parse a full expression. The optional arguments are used to
// forbid the `in` operator (in for loops initalization expressions)
// and provide reference for storing '=' operator inside shorthand
// property assignment in contexts where both object expression
// and object pattern might appear (so it's possible to raise
// delayed syntax error at correct position).
pp$3$1.parseExpression=function(forInit,refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseMaybeAssign(forInit,refDestructuringErrors);if(this.type===types$2.comma){var node=this.startNodeAt(startPos,startLoc);node.expressions=[expr];while(this.eat(types$2.comma)){node.expressions.push(this.parseMaybeAssign(forInit,refDestructuringErrors));}return this.finishNode(node,"SequenceExpression");}return expr;};// Parse an assignment expression. This includes applications of
// operators like `+=`.
pp$3$1.parseMaybeAssign=function(forInit,refDestructuringErrors,afterLeftParse){if(this.isContextual("yield")){if(this.inGenerator){return this.parseYield(forInit);}// The tokenizer will assume an expression is allowed after
// `yield`, but this isn't that kind of yield
else{this.exprAllowed=false;}}var ownDestructuringErrors=false,oldParenAssign=-1,oldTrailingComma=-1;if(refDestructuringErrors){oldParenAssign=refDestructuringErrors.parenthesizedAssign;oldTrailingComma=refDestructuringErrors.trailingComma;refDestructuringErrors.parenthesizedAssign=refDestructuringErrors.trailingComma=-1;}else{refDestructuringErrors=new DestructuringErrors$1();ownDestructuringErrors=true;}var startPos=this.start,startLoc=this.startLoc;if(this.type===types$2.parenL||this.type===types$2.name){this.potentialArrowAt=this.start;this.potentialArrowInForAwait=forInit==="await";}var left=this.parseMaybeConditional(forInit,refDestructuringErrors);if(afterLeftParse){left=afterLeftParse.call(this,left,startPos,startLoc);}if(this.type.isAssign){var node=this.startNodeAt(startPos,startLoc);node.operator=this.value;if(this.type===types$2.eq){left=this.toAssignable(left,false,refDestructuringErrors);}if(!ownDestructuringErrors){refDestructuringErrors.parenthesizedAssign=refDestructuringErrors.trailingComma=refDestructuringErrors.doubleProto=-1;}if(refDestructuringErrors.shorthandAssign>=left.start){refDestructuringErrors.shorthandAssign=-1;}// reset because shorthand default was used correctly
if(this.type===types$2.eq){this.checkLValPattern(left);}else{this.checkLValSimple(left);}node.left=left;this.next();node.right=this.parseMaybeAssign(forInit);return this.finishNode(node,"AssignmentExpression");}else{if(ownDestructuringErrors){this.checkExpressionErrors(refDestructuringErrors,true);}}if(oldParenAssign>-1){refDestructuringErrors.parenthesizedAssign=oldParenAssign;}if(oldTrailingComma>-1){refDestructuringErrors.trailingComma=oldTrailingComma;}return left;};// Parse a ternary conditional (`?:`) operator.
pp$3$1.parseMaybeConditional=function(forInit,refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseExprOps(forInit,refDestructuringErrors);if(this.checkExpressionErrors(refDestructuringErrors)){return expr;}if(this.eat(types$2.question)){var node=this.startNodeAt(startPos,startLoc);node.test=expr;node.consequent=this.parseMaybeAssign();this.expect(types$2.colon);node.alternate=this.parseMaybeAssign(forInit);return this.finishNode(node,"ConditionalExpression");}return expr;};// Start the precedence parser.
pp$3$1.parseExprOps=function(forInit,refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseMaybeUnary(refDestructuringErrors,false);if(this.checkExpressionErrors(refDestructuringErrors)){return expr;}return expr.start===startPos&&expr.type==="ArrowFunctionExpression"?expr:this.parseExprOp(expr,startPos,startLoc,-1,forInit);};// Parse binary operators with the operator precedence parsing
// algorithm. `left` is the left-hand side of the operator.
// `minPrec` provides context that allows the function to stop and
// defer further parser to one of its callers when it encounters an
// operator that has a lower precedence than the set it is parsing.
pp$3$1.parseExprOp=function(left,leftStartPos,leftStartLoc,minPrec,forInit){var prec=this.type.binop;if(prec!=null&&(!forInit||this.type!==types$2._in)){if(prec>minPrec){var logical=this.type===types$2.logicalOR||this.type===types$2.logicalAND;var coalesce=this.type===types$2.coalesce;if(coalesce){// Handle the precedence of `tt.coalesce` as equal to the range of logical expressions.
// In other words, `node.right` shouldn't contain logical expressions in order to check the mixed error.
prec=types$2.logicalAND.binop;}var op=this.value;this.next();var startPos=this.start,startLoc=this.startLoc;var right=this.parseExprOp(this.parseMaybeUnary(null,false),startPos,startLoc,prec,forInit);var node=this.buildBinary(leftStartPos,leftStartLoc,left,right,op,logical||coalesce);if(logical&&this.type===types$2.coalesce||coalesce&&(this.type===types$2.logicalOR||this.type===types$2.logicalAND)){this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses");}return this.parseExprOp(node,leftStartPos,leftStartLoc,minPrec,forInit);}}return left;};pp$3$1.buildBinary=function(startPos,startLoc,left,right,op,logical){var node=this.startNodeAt(startPos,startLoc);node.left=left;node.operator=op;node.right=right;return this.finishNode(node,logical?"LogicalExpression":"BinaryExpression");};// Parse unary operators, both prefix and postfix.
pp$3$1.parseMaybeUnary=function(refDestructuringErrors,sawUnary,incDec){var startPos=this.start,startLoc=this.startLoc,expr;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)){expr=this.parseAwait();sawUnary=true;}else if(this.type.prefix){var node=this.startNode(),update=this.type===types$2.incDec;node.operator=this.value;node.prefix=true;this.next();node.argument=this.parseMaybeUnary(null,true,update);this.checkExpressionErrors(refDestructuringErrors,true);if(update){this.checkLValSimple(node.argument);}else if(this.strict&&node.operator==="delete"&&node.argument.type==="Identifier"){this.raiseRecoverable(node.start,"Deleting local variable in strict mode");}else if(node.operator==="delete"&&isPrivateFieldAccess(node.argument)){this.raiseRecoverable(node.start,"Private fields can not be deleted");}else{sawUnary=true;}expr=this.finishNode(node,update?"UpdateExpression":"UnaryExpression");}else{expr=this.parseExprSubscripts(refDestructuringErrors);if(this.checkExpressionErrors(refDestructuringErrors)){return expr;}while(this.type.postfix&&!this.canInsertSemicolon()){var node$1=this.startNodeAt(startPos,startLoc);node$1.operator=this.value;node$1.prefix=false;node$1.argument=expr;this.checkLValSimple(expr);this.next();expr=this.finishNode(node$1,"UpdateExpression");}}if(!incDec&&this.eat(types$2.starstar)){if(sawUnary){this.unexpected(this.lastTokStart);}else{return this.buildBinary(startPos,startLoc,expr,this.parseMaybeUnary(null,false),"**",false);}}else{return expr;}};function isPrivateFieldAccess(node){return node.type==="MemberExpression"&&node.property.type==="PrivateIdentifier"||node.type==="ChainExpression"&&isPrivateFieldAccess(node.expression);}// Parse call, dot, and `[]`-subscript expressions.
pp$3$1.parseExprSubscripts=function(refDestructuringErrors){var startPos=this.start,startLoc=this.startLoc;var expr=this.parseExprAtom(refDestructuringErrors);if(expr.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")"){return expr;}var result=this.parseSubscripts(expr,startPos,startLoc);if(refDestructuringErrors&&result.type==="MemberExpression"){if(refDestructuringErrors.parenthesizedAssign>=result.start){refDestructuringErrors.parenthesizedAssign=-1;}if(refDestructuringErrors.parenthesizedBind>=result.start){refDestructuringErrors.parenthesizedBind=-1;}if(refDestructuringErrors.trailingComma>=result.start){refDestructuringErrors.trailingComma=-1;}}return result;};pp$3$1.parseSubscripts=function(base,startPos,startLoc,noCalls){var maybeAsyncArrow=this.options.ecmaVersion>=8&&base.type==="Identifier"&&base.name==="async"&&this.lastTokEnd===base.end&&!this.canInsertSemicolon()&&base.end-base.start===5&&this.potentialArrowAt===base.start;var optionalChained=false;while(true){var element=this.parseSubscript(base,startPos,startLoc,noCalls,maybeAsyncArrow,optionalChained);if(element.optional){optionalChained=true;}if(element===base||element.type==="ArrowFunctionExpression"){if(optionalChained){var chainNode=this.startNodeAt(startPos,startLoc);chainNode.expression=element;element=this.finishNode(chainNode,"ChainExpression");}return element;}base=element;}};pp$3$1.parseSubscript=function(base,startPos,startLoc,noCalls,maybeAsyncArrow,optionalChained){var optionalSupported=this.options.ecmaVersion>=11;var optional=optionalSupported&&this.eat(types$2.questionDot);if(noCalls&&optional){this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");}var computed=this.eat(types$2.bracketL);if(computed||optional&&this.type!==types$2.parenL&&this.type!==types$2.backQuote||this.eat(types$2.dot)){var node=this.startNodeAt(startPos,startLoc);node.object=base;if(computed){node.property=this.parseExpression();this.expect(types$2.bracketR);}else if(this.type===types$2.privateId&&base.type!=="Super"){node.property=this.parsePrivateIdent();}else{node.property=this.parseIdent(this.options.allowReserved!=="never");}node.computed=!!computed;if(optionalSupported){node.optional=optional;}base=this.finishNode(node,"MemberExpression");}else if(!noCalls&&this.eat(types$2.parenL)){var refDestructuringErrors=new DestructuringErrors$1(),oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;var exprList=this.parseExprList(types$2.parenR,this.options.ecmaVersion>=8,false,refDestructuringErrors);if(maybeAsyncArrow&&!optional&&!this.canInsertSemicolon()&&this.eat(types$2.arrow)){this.checkPatternErrors(refDestructuringErrors,false);this.checkYieldAwaitInDefaultParams();if(this.awaitIdentPos>0){this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function");}this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),exprList,true);}this.checkExpressionErrors(refDestructuringErrors,true);this.yieldPos=oldYieldPos||this.yieldPos;this.awaitPos=oldAwaitPos||this.awaitPos;this.awaitIdentPos=oldAwaitIdentPos||this.awaitIdentPos;var node$1=this.startNodeAt(startPos,startLoc);node$1.callee=base;node$1.arguments=exprList;if(optionalSupported){node$1.optional=optional;}base=this.finishNode(node$1,"CallExpression");}else if(this.type===types$2.backQuote){if(optional||optionalChained){this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");}var node$2=this.startNodeAt(startPos,startLoc);node$2.tag=base;node$2.quasi=this.parseTemplate({isTagged:true});base=this.finishNode(node$2,"TaggedTemplateExpression");}return base;};// Parse an atomic expression — either a single token that is an
// expression, an expression started by a keyword like `function` or
// `new`, or an expression wrapped in punctuation like `()`, `[]`,
// or `{}`.
pp$3$1.parseExprAtom=function(refDestructuringErrors){// If a division operator appears in an expression position, the
// tokenizer got confused, and we force it to read a regexp instead.
if(this.type===types$2.slash){this.readRegexp();}var node,canBeArrow=this.potentialArrowAt===this.start;switch(this.type){case types$2._super:if(!this.allowSuper){this.raise(this.start,"'super' keyword outside a method");}node=this.startNode();this.next();if(this.type===types$2.parenL&&!this.allowDirectSuper){this.raise(node.start,"super() call outside constructor of a subclass");}// The `super` keyword can appear at below:
// SuperProperty:
//     super [ Expression ]
//     super . IdentifierName
// SuperCall:
//     super ( Arguments )
if(this.type!==types$2.dot&&this.type!==types$2.bracketL&&this.type!==types$2.parenL){this.unexpected();}return this.finishNode(node,"Super");case types$2._this:node=this.startNode();this.next();return this.finishNode(node,"ThisExpression");case types$2.name:var startPos=this.start,startLoc=this.startLoc,containsEsc=this.containsEsc;var id=this.parseIdent(false);if(this.options.ecmaVersion>=8&&!containsEsc&&id.name==="async"&&!this.canInsertSemicolon()&&this.eat(types$2._function)){return this.parseFunction(this.startNodeAt(startPos,startLoc),0,false,true);}if(canBeArrow&&!this.canInsertSemicolon()){if(this.eat(types$2.arrow)){return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),[id],false);}if(this.options.ecmaVersion>=8&&id.name==="async"&&this.type===types$2.name&&!containsEsc&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc)){id=this.parseIdent(false);if(this.canInsertSemicolon()||!this.eat(types$2.arrow)){this.unexpected();}return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),[id],true);}}return id;case types$2.regexp:var value=this.value;node=this.parseLiteral(value.value);node.regex={pattern:value.pattern,flags:value.flags};return node;case types$2.num:case types$2.string:return this.parseLiteral(this.value);case types$2._null:case types$2._true:case types$2._false:node=this.startNode();node.value=this.type===types$2._null?null:this.type===types$2._true;node.raw=this.type.keyword;this.next();return this.finishNode(node,"Literal");case types$2.parenL:var start=this.start,expr=this.parseParenAndDistinguishExpression(canBeArrow);if(refDestructuringErrors){if(refDestructuringErrors.parenthesizedAssign<0&&!this.isSimpleAssignTarget(expr)){refDestructuringErrors.parenthesizedAssign=start;}if(refDestructuringErrors.parenthesizedBind<0){refDestructuringErrors.parenthesizedBind=start;}}return expr;case types$2.bracketL:node=this.startNode();this.next();node.elements=this.parseExprList(types$2.bracketR,true,true,refDestructuringErrors);return this.finishNode(node,"ArrayExpression");case types$2.braceL:return this.parseObj(false,refDestructuringErrors);case types$2._function:node=this.startNode();this.next();return this.parseFunction(node,0);case types$2._class:return this.parseClass(this.startNode(),false);case types$2._new:return this.parseNew();case types$2.backQuote:return this.parseTemplate();case types$2._import:if(this.options.ecmaVersion>=11){return this.parseExprImport();}else{return this.unexpected();}default:this.unexpected();}};pp$3$1.parseExprImport=function(){var node=this.startNode();// Consume `import` as an identifier for `import.meta`.
// Because `this.parseIdent(true)` doesn't check escape sequences, it needs the check of `this.containsEsc`.
if(this.containsEsc){this.raiseRecoverable(this.start,"Escape sequence in keyword import");}var meta=this.parseIdent(true);switch(this.type){case types$2.parenL:return this.parseDynamicImport(node);case types$2.dot:node.meta=meta;return this.parseImportMeta(node);default:this.unexpected();}};pp$3$1.parseDynamicImport=function(node){this.next();// skip `(`
// Parse node.source.
node.source=this.parseMaybeAssign();// Verify ending.
if(!this.eat(types$2.parenR)){var errorPos=this.start;if(this.eat(types$2.comma)&&this.eat(types$2.parenR)){this.raiseRecoverable(errorPos,"Trailing comma is not allowed in import()");}else{this.unexpected(errorPos);}}return this.finishNode(node,"ImportExpression");};pp$3$1.parseImportMeta=function(node){this.next();// skip `.`
var containsEsc=this.containsEsc;node.property=this.parseIdent(true);if(node.property.name!=="meta"){this.raiseRecoverable(node.property.start,"The only valid meta property for import is 'import.meta'");}if(containsEsc){this.raiseRecoverable(node.start,"'import.meta' must not contain escaped characters");}if(this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere){this.raiseRecoverable(node.start,"Cannot use 'import.meta' outside a module");}return this.finishNode(node,"MetaProperty");};pp$3$1.parseLiteral=function(value){var node=this.startNode();node.value=value;node.raw=this.input.slice(this.start,this.end);if(node.raw.charCodeAt(node.raw.length-1)===110){node.bigint=node.raw.slice(0,-1).replace(/_/g,"");}this.next();return this.finishNode(node,"Literal");};pp$3$1.parseParenExpression=function(){this.expect(types$2.parenL);var val=this.parseExpression();this.expect(types$2.parenR);return val;};pp$3$1.parseParenAndDistinguishExpression=function(canBeArrow){var startPos=this.start,startLoc=this.startLoc,val,allowTrailingComma=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var innerStartPos=this.start,innerStartLoc=this.startLoc;var exprList=[],first=true,lastIsComma=false;var refDestructuringErrors=new DestructuringErrors$1(),oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,spreadStart;this.yieldPos=0;this.awaitPos=0;// Do not save awaitIdentPos to allow checking awaits nested in parameters
while(this.type!==types$2.parenR){first?first=false:this.expect(types$2.comma);if(allowTrailingComma&&this.afterTrailingComma(types$2.parenR,true)){lastIsComma=true;break;}else if(this.type===types$2.ellipsis){spreadStart=this.start;exprList.push(this.parseParenItem(this.parseRestBinding()));if(this.type===types$2.comma){this.raise(this.start,"Comma is not permitted after the rest element");}break;}else{exprList.push(this.parseMaybeAssign(false,refDestructuringErrors,this.parseParenItem));}}var innerEndPos=this.start,innerEndLoc=this.startLoc;this.expect(types$2.parenR);if(canBeArrow&&!this.canInsertSemicolon()&&this.eat(types$2.arrow)){this.checkPatternErrors(refDestructuringErrors,false);this.checkYieldAwaitInDefaultParams();this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;return this.parseParenArrowList(startPos,startLoc,exprList);}if(!exprList.length||lastIsComma){this.unexpected(this.lastTokStart);}if(spreadStart){this.unexpected(spreadStart);}this.checkExpressionErrors(refDestructuringErrors,true);this.yieldPos=oldYieldPos||this.yieldPos;this.awaitPos=oldAwaitPos||this.awaitPos;if(exprList.length>1){val=this.startNodeAt(innerStartPos,innerStartLoc);val.expressions=exprList;this.finishNodeAt(val,"SequenceExpression",innerEndPos,innerEndLoc);}else{val=exprList[0];}}else{val=this.parseParenExpression();}if(this.options.preserveParens){var par=this.startNodeAt(startPos,startLoc);par.expression=val;return this.finishNode(par,"ParenthesizedExpression");}else{return val;}};pp$3$1.parseParenItem=function(item){return item;};pp$3$1.parseParenArrowList=function(startPos,startLoc,exprList){return this.parseArrowExpression(this.startNodeAt(startPos,startLoc),exprList);};// New's precedence is slightly tricky. It must allow its argument to
// be a `[]` or dot subscript expression, but not a call — at least,
// not without wrapping it in parentheses. Thus, it uses the noCalls
// argument to parseSubscripts to prevent it from consuming the
// argument list.
var empty$1$2=[];pp$3$1.parseNew=function(){if(this.containsEsc){this.raiseRecoverable(this.start,"Escape sequence in keyword new");}var node=this.startNode();var meta=this.parseIdent(true);if(this.options.ecmaVersion>=6&&this.eat(types$2.dot)){node.meta=meta;var containsEsc=this.containsEsc;node.property=this.parseIdent(true);if(node.property.name!=="target"){this.raiseRecoverable(node.property.start,"The only valid meta property for new is 'new.target'");}if(containsEsc){this.raiseRecoverable(node.start,"'new.target' must not contain escaped characters");}if(!this.inNonArrowFunction){this.raiseRecoverable(node.start,"'new.target' can only be used in functions");}return this.finishNode(node,"MetaProperty");}var startPos=this.start,startLoc=this.startLoc,isImport=this.type===types$2._import;node.callee=this.parseSubscripts(this.parseExprAtom(),startPos,startLoc,true);if(isImport&&node.callee.type==="ImportExpression"){this.raise(startPos,"Cannot use new with import()");}if(this.eat(types$2.parenL)){node.arguments=this.parseExprList(types$2.parenR,this.options.ecmaVersion>=8,false);}else{node.arguments=empty$1$2;}return this.finishNode(node,"NewExpression");};// Parse template expression.
pp$3$1.parseTemplateElement=function(ref){var isTagged=ref.isTagged;var elem=this.startNode();if(this.type===types$2.invalidTemplate){if(!isTagged){this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal");}elem.value={raw:this.value,cooked:null};}else{elem.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value};}this.next();elem.tail=this.type===types$2.backQuote;return this.finishNode(elem,"TemplateElement");};pp$3$1.parseTemplate=function(ref){if(ref===void 0)ref={};var isTagged=ref.isTagged;if(isTagged===void 0)isTagged=false;var node=this.startNode();this.next();node.expressions=[];var curElt=this.parseTemplateElement({isTagged:isTagged});node.quasis=[curElt];while(!curElt.tail){if(this.type===types$2.eof){this.raise(this.pos,"Unterminated template literal");}this.expect(types$2.dollarBraceL);node.expressions.push(this.parseExpression());this.expect(types$2.braceR);node.quasis.push(curElt=this.parseTemplateElement({isTagged:isTagged}));}this.next();return this.finishNode(node,"TemplateLiteral");};pp$3$1.isAsyncProp=function(prop){return!prop.computed&&prop.key.type==="Identifier"&&prop.key.name==="async"&&(this.type===types$2.name||this.type===types$2.num||this.type===types$2.string||this.type===types$2.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===types$2.star)&&!lineBreak$1.test(this.input.slice(this.lastTokEnd,this.start));};// Parse an object literal or binding pattern.
pp$3$1.parseObj=function(isPattern,refDestructuringErrors){var node=this.startNode(),first=true,propHash={};node.properties=[];this.next();while(!this.eat(types$2.braceR)){if(!first){this.expect(types$2.comma);if(this.options.ecmaVersion>=5&&this.afterTrailingComma(types$2.braceR)){break;}}else{first=false;}var prop=this.parseProperty(isPattern,refDestructuringErrors);if(!isPattern){this.checkPropClash(prop,propHash,refDestructuringErrors);}node.properties.push(prop);}return this.finishNode(node,isPattern?"ObjectPattern":"ObjectExpression");};pp$3$1.parseProperty=function(isPattern,refDestructuringErrors){var prop=this.startNode(),isGenerator,isAsync,startPos,startLoc;if(this.options.ecmaVersion>=9&&this.eat(types$2.ellipsis)){if(isPattern){prop.argument=this.parseIdent(false);if(this.type===types$2.comma){this.raise(this.start,"Comma is not permitted after the rest element");}return this.finishNode(prop,"RestElement");}// To disallow parenthesized identifier via `this.toAssignable()`.
if(this.type===types$2.parenL&&refDestructuringErrors){if(refDestructuringErrors.parenthesizedAssign<0){refDestructuringErrors.parenthesizedAssign=this.start;}if(refDestructuringErrors.parenthesizedBind<0){refDestructuringErrors.parenthesizedBind=this.start;}}// Parse argument.
prop.argument=this.parseMaybeAssign(false,refDestructuringErrors);// To disallow trailing comma via `this.toAssignable()`.
if(this.type===types$2.comma&&refDestructuringErrors&&refDestructuringErrors.trailingComma<0){refDestructuringErrors.trailingComma=this.start;}// Finish
return this.finishNode(prop,"SpreadElement");}if(this.options.ecmaVersion>=6){prop.method=false;prop.shorthand=false;if(isPattern||refDestructuringErrors){startPos=this.start;startLoc=this.startLoc;}if(!isPattern){isGenerator=this.eat(types$2.star);}}var containsEsc=this.containsEsc;this.parsePropertyName(prop);if(!isPattern&&!containsEsc&&this.options.ecmaVersion>=8&&!isGenerator&&this.isAsyncProp(prop)){isAsync=true;isGenerator=this.options.ecmaVersion>=9&&this.eat(types$2.star);this.parsePropertyName(prop,refDestructuringErrors);}else{isAsync=false;}this.parsePropertyValue(prop,isPattern,isGenerator,isAsync,startPos,startLoc,refDestructuringErrors,containsEsc);return this.finishNode(prop,"Property");};pp$3$1.parsePropertyValue=function(prop,isPattern,isGenerator,isAsync,startPos,startLoc,refDestructuringErrors,containsEsc){if((isGenerator||isAsync)&&this.type===types$2.colon){this.unexpected();}if(this.eat(types$2.colon)){prop.value=isPattern?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(false,refDestructuringErrors);prop.kind="init";}else if(this.options.ecmaVersion>=6&&this.type===types$2.parenL){if(isPattern){this.unexpected();}prop.kind="init";prop.method=true;prop.value=this.parseMethod(isGenerator,isAsync);}else if(!isPattern&&!containsEsc&&this.options.ecmaVersion>=5&&!prop.computed&&prop.key.type==="Identifier"&&(prop.key.name==="get"||prop.key.name==="set")&&this.type!==types$2.comma&&this.type!==types$2.braceR&&this.type!==types$2.eq){if(isGenerator||isAsync){this.unexpected();}prop.kind=prop.key.name;this.parsePropertyName(prop);prop.value=this.parseMethod(false);var paramCount=prop.kind==="get"?0:1;if(prop.value.params.length!==paramCount){var start=prop.value.start;if(prop.kind==="get"){this.raiseRecoverable(start,"getter should have no params");}else{this.raiseRecoverable(start,"setter should have exactly one param");}}else{if(prop.kind==="set"&&prop.value.params[0].type==="RestElement"){this.raiseRecoverable(prop.value.params[0].start,"Setter cannot use rest params");}}}else if(this.options.ecmaVersion>=6&&!prop.computed&&prop.key.type==="Identifier"){if(isGenerator||isAsync){this.unexpected();}this.checkUnreserved(prop.key);if(prop.key.name==="await"&&!this.awaitIdentPos){this.awaitIdentPos=startPos;}prop.kind="init";if(isPattern){prop.value=this.parseMaybeDefault(startPos,startLoc,this.copyNode(prop.key));}else if(this.type===types$2.eq&&refDestructuringErrors){if(refDestructuringErrors.shorthandAssign<0){refDestructuringErrors.shorthandAssign=this.start;}prop.value=this.parseMaybeDefault(startPos,startLoc,this.copyNode(prop.key));}else{prop.value=this.copyNode(prop.key);}prop.shorthand=true;}else{this.unexpected();}};pp$3$1.parsePropertyName=function(prop){if(this.options.ecmaVersion>=6){if(this.eat(types$2.bracketL)){prop.computed=true;prop.key=this.parseMaybeAssign();this.expect(types$2.bracketR);return prop.key;}else{prop.computed=false;}}return prop.key=this.type===types$2.num||this.type===types$2.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never");};// Initialize empty function node.
pp$3$1.initFunction=function(node){node.id=null;if(this.options.ecmaVersion>=6){node.generator=node.expression=false;}if(this.options.ecmaVersion>=8){node.async=false;}};// Parse object or class method.
pp$3$1.parseMethod=function(isGenerator,isAsync,allowDirectSuper){var node=this.startNode(),oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.initFunction(node);if(this.options.ecmaVersion>=6){node.generator=isGenerator;}if(this.options.ecmaVersion>=8){node.async=!!isAsync;}this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;this.enterScope(functionFlags$1(isAsync,node.generator)|SCOPE_SUPER$1|(allowDirectSuper?SCOPE_DIRECT_SUPER$1:0));this.expect(types$2.parenL);node.params=this.parseBindingList(types$2.parenR,false,this.options.ecmaVersion>=8);this.checkYieldAwaitInDefaultParams();this.parseFunctionBody(node,false,true);this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.finishNode(node,"FunctionExpression");};// Parse arrow function expression with given parameters.
pp$3$1.parseArrowExpression=function(node,params,isAsync){var oldYieldPos=this.yieldPos,oldAwaitPos=this.awaitPos,oldAwaitIdentPos=this.awaitIdentPos;this.enterScope(functionFlags$1(isAsync,false)|SCOPE_ARROW$1);this.initFunction(node);if(this.options.ecmaVersion>=8){node.async=!!isAsync;}this.yieldPos=0;this.awaitPos=0;this.awaitIdentPos=0;node.params=this.toAssignableList(params,true);this.parseFunctionBody(node,true,false);this.yieldPos=oldYieldPos;this.awaitPos=oldAwaitPos;this.awaitIdentPos=oldAwaitIdentPos;return this.finishNode(node,"ArrowFunctionExpression");};// Parse function body and check parameters.
pp$3$1.parseFunctionBody=function(node,isArrowFunction,isMethod){var isExpression=isArrowFunction&&this.type!==types$2.braceL;var oldStrict=this.strict,useStrict=false;if(isExpression){node.body=this.parseMaybeAssign();node.expression=true;this.checkParams(node,false);}else{var nonSimple=this.options.ecmaVersion>=7&&!this.isSimpleParamList(node.params);if(!oldStrict||nonSimple){useStrict=this.strictDirective(this.end);// If this is a strict mode function, verify that argument names
// are not repeated, and it does not try to bind the words `eval`
// or `arguments`.
if(useStrict&&nonSimple){this.raiseRecoverable(node.start,"Illegal 'use strict' directive in function with non-simple parameter list");}}// Start a new scope with regard to labels and the `inFunction`
// flag (restore them to their old value afterwards).
var oldLabels=this.labels;this.labels=[];if(useStrict){this.strict=true;}// Add the params to varDeclaredNames to ensure that an error is thrown
// if a let/const declaration in the function clashes with one of the params.
this.checkParams(node,!oldStrict&&!useStrict&&!isArrowFunction&&!isMethod&&this.isSimpleParamList(node.params));// Ensure the function name isn't a forbidden identifier in strict mode, e.g. 'eval'
if(this.strict&&node.id){this.checkLValSimple(node.id,BIND_OUTSIDE$1);}node.body=this.parseBlock(false,undefined,useStrict&&!oldStrict);node.expression=false;this.adaptDirectivePrologue(node.body.body);this.labels=oldLabels;}this.exitScope();};pp$3$1.isSimpleParamList=function(params){for(var i=0,list=params;i<list.length;i+=1){var param=list[i];if(param.type!=="Identifier"){return false;}}return true;};// Checks function params for various disallowed patterns such as using "eval"
// or "arguments" and duplicate parameters.
pp$3$1.checkParams=function(node,allowDuplicates){var nameHash=Object.create(null);for(var i=0,list=node.params;i<list.length;i+=1){var param=list[i];this.checkLValInnerPattern(param,BIND_VAR$1,allowDuplicates?null:nameHash);}};// Parses a comma-separated list of expressions, and returns them as
// an array. `close` is the token type that ends the list, and
// `allowEmpty` can be turned on to allow subsequent commas with
// nothing in between them to be parsed as `null` (which is needed
// for array literals).
pp$3$1.parseExprList=function(close,allowTrailingComma,allowEmpty,refDestructuringErrors){var elts=[],first=true;while(!this.eat(close)){if(!first){this.expect(types$2.comma);if(allowTrailingComma&&this.afterTrailingComma(close)){break;}}else{first=false;}var elt=void 0;if(allowEmpty&&this.type===types$2.comma){elt=null;}else if(this.type===types$2.ellipsis){elt=this.parseSpread(refDestructuringErrors);if(refDestructuringErrors&&this.type===types$2.comma&&refDestructuringErrors.trailingComma<0){refDestructuringErrors.trailingComma=this.start;}}else{elt=this.parseMaybeAssign(false,refDestructuringErrors);}elts.push(elt);}return elts;};pp$3$1.checkUnreserved=function(ref){var start=ref.start;var end=ref.end;var name=ref.name;if(this.inGenerator&&name==="yield"){this.raiseRecoverable(start,"Cannot use 'yield' as identifier inside a generator");}if(this.inAsync&&name==="await"){this.raiseRecoverable(start,"Cannot use 'await' as identifier inside an async function");}if(this.currentThisScope().inClassFieldInit&&name==="arguments"){this.raiseRecoverable(start,"Cannot use 'arguments' in class field initializer");}if(this.keywords.test(name)){this.raise(start,"Unexpected keyword '"+name+"'");}if(this.options.ecmaVersion<6&&this.input.slice(start,end).indexOf("\\")!==-1){return;}var re=this.strict?this.reservedWordsStrict:this.reservedWords;if(re.test(name)){if(!this.inAsync&&name==="await"){this.raiseRecoverable(start,"Cannot use keyword 'await' outside an async function");}this.raiseRecoverable(start,"The keyword '"+name+"' is reserved");}};// Parse the next token as an identifier. If `liberal` is true (used
// when parsing properties), it will also convert keywords into
// identifiers.
pp$3$1.parseIdent=function(liberal,isBinding){var node=this.startNode();if(this.type===types$2.name){node.name=this.value;}else if(this.type.keyword){node.name=this.type.keyword;// To fix https://github.com/acornjs/acorn/issues/575
// `class` and `function` keywords push new context into this.context.
// But there is no chance to pop the context if the keyword is consumed as an identifier such as a property name.
// If the previous token is a dot, this does not apply because the context-managing code already ignored the keyword
if((node.name==="class"||node.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)){this.context.pop();}}else{this.unexpected();}this.next(!!liberal);this.finishNode(node,"Identifier");if(!liberal){this.checkUnreserved(node);if(node.name==="await"&&!this.awaitIdentPos){this.awaitIdentPos=node.start;}}return node;};pp$3$1.parsePrivateIdent=function(){var node=this.startNode();if(this.type===types$2.privateId){node.name=this.value;}else{this.unexpected();}this.next();this.finishNode(node,"PrivateIdentifier");// For validating existence
if(this.privateNameStack.length===0){this.raise(node.start,"Private field '#"+node.name+"' must be declared in an enclosing class");}else{this.privateNameStack[this.privateNameStack.length-1].used.push(node);}return node;};// Parses yield expression inside generator.
pp$3$1.parseYield=function(forInit){if(!this.yieldPos){this.yieldPos=this.start;}var node=this.startNode();this.next();if(this.type===types$2.semi||this.canInsertSemicolon()||this.type!==types$2.star&&!this.type.startsExpr){node.delegate=false;node.argument=null;}else{node.delegate=this.eat(types$2.star);node.argument=this.parseMaybeAssign(forInit);}return this.finishNode(node,"YieldExpression");};pp$3$1.parseAwait=function(){if(!this.awaitPos){this.awaitPos=this.start;}var node=this.startNode();this.next();node.argument=this.parseMaybeUnary(null,true);return this.finishNode(node,"AwaitExpression");};var pp$4$1=Parser$1.prototype;// This function is used to raise exceptions on parse errors. It
// takes an offset integer (into the current `input`) to indicate
// the location of the error, attaches the position to the end
// of the error message, and then raises a `SyntaxError` with that
// message.
pp$4$1.raise=function(pos,message){var loc=getLineInfo$1(this.input,pos);message+=" ("+loc.line+":"+loc.column+")";var err=new SyntaxError(message);err.pos=pos;err.loc=loc;err.raisedAt=this.pos;throw err;};pp$4$1.raiseRecoverable=pp$4$1.raise;pp$4$1.curPosition=function(){if(this.options.locations){return new Position$1(this.curLine,this.pos-this.lineStart);}};var pp$5$1=Parser$1.prototype;var Scope$1=function Scope(flags){this.flags=flags;// A list of var-declared names in the current lexical scope
this["var"]=[];// A list of lexically-declared names in the current lexical scope
this.lexical=[];// A list of lexically-declared FunctionDeclaration names in the current lexical scope
this.functions=[];// A switch to disallow the identifier reference 'arguments'
this.inClassFieldInit=false;};// The functions in this module keep track of declared variables in the current scope in order to detect duplicate variable names.
pp$5$1.enterScope=function(flags){this.scopeStack.push(new Scope$1(flags));};pp$5$1.exitScope=function(){this.scopeStack.pop();};// The spec says:
// > At the top level of a function, or script, function declarations are
// > treated like var declarations rather than like lexical declarations.
pp$5$1.treatFunctionsAsVarInScope=function(scope){return scope.flags&SCOPE_FUNCTION$1||!this.inModule&&scope.flags&SCOPE_TOP$1;};pp$5$1.declareName=function(name,bindingType,pos){var redeclared=false;if(bindingType===BIND_LEXICAL$1){var scope=this.currentScope();redeclared=scope.lexical.indexOf(name)>-1||scope.functions.indexOf(name)>-1||scope["var"].indexOf(name)>-1;scope.lexical.push(name);if(this.inModule&&scope.flags&SCOPE_TOP$1){delete this.undefinedExports[name];}}else if(bindingType===BIND_SIMPLE_CATCH$1){var scope$1=this.currentScope();scope$1.lexical.push(name);}else if(bindingType===BIND_FUNCTION$1){var scope$2=this.currentScope();if(this.treatFunctionsAsVar){redeclared=scope$2.lexical.indexOf(name)>-1;}else{redeclared=scope$2.lexical.indexOf(name)>-1||scope$2["var"].indexOf(name)>-1;}scope$2.functions.push(name);}else{for(var i=this.scopeStack.length-1;i>=0;--i){var scope$3=this.scopeStack[i];if(scope$3.lexical.indexOf(name)>-1&&!(scope$3.flags&SCOPE_SIMPLE_CATCH$1&&scope$3.lexical[0]===name)||!this.treatFunctionsAsVarInScope(scope$3)&&scope$3.functions.indexOf(name)>-1){redeclared=true;break;}scope$3["var"].push(name);if(this.inModule&&scope$3.flags&SCOPE_TOP$1){delete this.undefinedExports[name];}if(scope$3.flags&SCOPE_VAR$1){break;}}}if(redeclared){this.raiseRecoverable(pos,"Identifier '"+name+"' has already been declared");}};pp$5$1.checkLocalExport=function(id){// scope.functions must be empty as Module code is always strict.
if(this.scopeStack[0].lexical.indexOf(id.name)===-1&&this.scopeStack[0]["var"].indexOf(id.name)===-1){this.undefinedExports[id.name]=id;}};pp$5$1.currentScope=function(){return this.scopeStack[this.scopeStack.length-1];};pp$5$1.currentVarScope=function(){for(var i=this.scopeStack.length-1;;i--){var scope=this.scopeStack[i];if(scope.flags&SCOPE_VAR$1){return scope;}}};// Could be useful for `this`, `new.target`, `super()`, `super.property`, and `super[property]`.
pp$5$1.currentThisScope=function(){for(var i=this.scopeStack.length-1;;i--){var scope=this.scopeStack[i];if(scope.flags&SCOPE_VAR$1&&!(scope.flags&SCOPE_ARROW$1)){return scope;}}};var Node$1=function Node(parser,pos,loc){this.type="";this.start=pos;this.end=0;if(parser.options.locations){this.loc=new SourceLocation$1(parser,loc);}if(parser.options.directSourceFile){this.sourceFile=parser.options.directSourceFile;}if(parser.options.ranges){this.range=[pos,0];}};// Start an AST node, attaching a start offset.
var pp$6$1=Parser$1.prototype;pp$6$1.startNode=function(){return new Node$1(this,this.start,this.startLoc);};pp$6$1.startNodeAt=function(pos,loc){return new Node$1(this,pos,loc);};// Finish an AST node, adding `type` and `end` properties.
function finishNodeAt$1(node,type,pos,loc){node.type=type;node.end=pos;if(this.options.locations){node.loc.end=loc;}if(this.options.ranges){node.range[1]=pos;}return node;}pp$6$1.finishNode=function(node,type){return finishNodeAt$1.call(this,node,type,this.lastTokEnd,this.lastTokEndLoc);};// Finish node at given position
pp$6$1.finishNodeAt=function(node,type,pos,loc){return finishNodeAt$1.call(this,node,type,pos,loc);};pp$6$1.copyNode=function(node){var newNode=new Node$1(this,node.start,this.startLoc);for(var prop in node){newNode[prop]=node[prop];}return newNode;};// The algorithm used to determine whether a regexp can appear at a
var TokContext$1=function TokContext(token,isExpr,preserveSpace,override,generator){this.token=token;this.isExpr=!!isExpr;this.preserveSpace=!!preserveSpace;this.override=override;this.generator=!!generator;};var types$1$1={b_stat:new TokContext$1("{",false),b_expr:new TokContext$1("{",true),b_tmpl:new TokContext$1("${",false),p_stat:new TokContext$1("(",false),p_expr:new TokContext$1("(",true),q_tmpl:new TokContext$1("`",true,true,function(p){return p.tryReadTemplateToken();}),f_stat:new TokContext$1("function",false),f_expr:new TokContext$1("function",true),f_expr_gen:new TokContext$1("function",true,false,null,true),f_gen:new TokContext$1("function",false,false,null,true)};var pp$7$1=Parser$1.prototype;pp$7$1.initialContext=function(){return[types$1$1.b_stat];};pp$7$1.braceIsBlock=function(prevType){var parent=this.curContext();if(parent===types$1$1.f_expr||parent===types$1$1.f_stat){return true;}if(prevType===types$2.colon&&(parent===types$1$1.b_stat||parent===types$1$1.b_expr)){return!parent.isExpr;}// The check for `tt.name && exprAllowed` detects whether we are
// after a `yield` or `of` construct. See the `updateContext` for
// `tt.name`.
if(prevType===types$2._return||prevType===types$2.name&&this.exprAllowed){return lineBreak$1.test(this.input.slice(this.lastTokEnd,this.start));}if(prevType===types$2._else||prevType===types$2.semi||prevType===types$2.eof||prevType===types$2.parenR||prevType===types$2.arrow){return true;}if(prevType===types$2.braceL){return parent===types$1$1.b_stat;}if(prevType===types$2._var||prevType===types$2._const||prevType===types$2.name){return false;}return!this.exprAllowed;};pp$7$1.inGeneratorContext=function(){for(var i=this.context.length-1;i>=1;i--){var context=this.context[i];if(context.token==="function"){return context.generator;}}return false;};pp$7$1.updateContext=function(prevType){var update,type=this.type;if(type.keyword&&prevType===types$2.dot){this.exprAllowed=false;}else if(update=type.updateContext){update.call(this,prevType);}else{this.exprAllowed=type.beforeExpr;}};// Token-specific context update code
types$2.parenR.updateContext=types$2.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=true;return;}var out=this.context.pop();if(out===types$1$1.b_stat&&this.curContext().token==="function"){out=this.context.pop();}this.exprAllowed=!out.isExpr;};types$2.braceL.updateContext=function(prevType){this.context.push(this.braceIsBlock(prevType)?types$1$1.b_stat:types$1$1.b_expr);this.exprAllowed=true;};types$2.dollarBraceL.updateContext=function(){this.context.push(types$1$1.b_tmpl);this.exprAllowed=true;};types$2.parenL.updateContext=function(prevType){var statementParens=prevType===types$2._if||prevType===types$2._for||prevType===types$2._with||prevType===types$2._while;this.context.push(statementParens?types$1$1.p_stat:types$1$1.p_expr);this.exprAllowed=true;};types$2.incDec.updateContext=function(){// tokExprAllowed stays unchanged
};types$2._function.updateContext=types$2._class.updateContext=function(prevType){if(prevType.beforeExpr&&prevType!==types$2._else&&!(prevType===types$2.semi&&this.curContext()!==types$1$1.p_stat)&&!(prevType===types$2._return&&lineBreak$1.test(this.input.slice(this.lastTokEnd,this.start)))&&!((prevType===types$2.colon||prevType===types$2.braceL)&&this.curContext()===types$1$1.b_stat)){this.context.push(types$1$1.f_expr);}else{this.context.push(types$1$1.f_stat);}this.exprAllowed=false;};types$2.backQuote.updateContext=function(){if(this.curContext()===types$1$1.q_tmpl){this.context.pop();}else{this.context.push(types$1$1.q_tmpl);}this.exprAllowed=false;};types$2.star.updateContext=function(prevType){if(prevType===types$2._function){var index=this.context.length-1;if(this.context[index]===types$1$1.f_expr){this.context[index]=types$1$1.f_expr_gen;}else{this.context[index]=types$1$1.f_gen;}}this.exprAllowed=true;};types$2.name.updateContext=function(prevType){var allowed=false;if(this.options.ecmaVersion>=6&&prevType!==types$2.dot){if(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext()){allowed=true;}}this.exprAllowed=allowed;};// This file contains Unicode properties extracted from the ECMAScript
// specification. The lists are extracted like so:
// $$('#table-binary-unicode-properties > figure > table > tbody > tr > td:nth-child(1) code').map(el => el.innerText)
// #table-binary-unicode-properties
var ecma9BinaryProperties$1="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS";var ecma10BinaryProperties$1=ecma9BinaryProperties$1+" Extended_Pictographic";var ecma11BinaryProperties$1=ecma10BinaryProperties$1;var ecma12BinaryProperties$1=ecma11BinaryProperties$1+" EBase EComp EMod EPres ExtPict";var unicodeBinaryProperties$1={9:ecma9BinaryProperties$1,10:ecma10BinaryProperties$1,11:ecma11BinaryProperties$1,12:ecma12BinaryProperties$1};// #table-unicode-general-category-values
var unicodeGeneralCategoryValues$1="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu";// #table-unicode-script-values
var ecma9ScriptValues$1="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb";var ecma10ScriptValues$1=ecma9ScriptValues$1+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd";var ecma11ScriptValues$1=ecma10ScriptValues$1+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho";var ecma12ScriptValues$1=ecma11ScriptValues$1+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi";var unicodeScriptValues$1={9:ecma9ScriptValues$1,10:ecma10ScriptValues$1,11:ecma11ScriptValues$1,12:ecma12ScriptValues$1};var data$1={};function buildUnicodeData$1(ecmaVersion){var d=data$1[ecmaVersion]={binary:wordsRegexp$1(unicodeBinaryProperties$1[ecmaVersion]+" "+unicodeGeneralCategoryValues$1),nonBinary:{General_Category:wordsRegexp$1(unicodeGeneralCategoryValues$1),Script:wordsRegexp$1(unicodeScriptValues$1[ecmaVersion])}};d.nonBinary.Script_Extensions=d.nonBinary.Script;d.nonBinary.gc=d.nonBinary.General_Category;d.nonBinary.sc=d.nonBinary.Script;d.nonBinary.scx=d.nonBinary.Script_Extensions;}buildUnicodeData$1(9);buildUnicodeData$1(10);buildUnicodeData$1(11);buildUnicodeData$1(12);var pp$8$1=Parser$1.prototype;var RegExpValidationState$1=function RegExpValidationState(parser){this.parser=parser;this.validFlags="gim"+(parser.options.ecmaVersion>=6?"uy":"")+(parser.options.ecmaVersion>=9?"s":"");this.unicodeProperties=data$1[parser.options.ecmaVersion>=12?12:parser.options.ecmaVersion];this.source="";this.flags="";this.start=0;this.switchU=false;this.switchN=false;this.pos=0;this.lastIntValue=0;this.lastStringValue="";this.lastAssertionIsQuantifiable=false;this.numCapturingParens=0;this.maxBackReference=0;this.groupNames=[];this.backReferenceNames=[];};RegExpValidationState$1.prototype.reset=function reset(start,pattern,flags){var unicode=flags.indexOf("u")!==-1;this.start=start|0;this.source=pattern+"";this.flags=flags;this.switchU=unicode&&this.parser.options.ecmaVersion>=6;this.switchN=unicode&&this.parser.options.ecmaVersion>=9;};RegExpValidationState$1.prototype.raise=function raise(message){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+message);};// If u flag is given, this returns the code point at the index (it combines a surrogate pair).
// Otherwise, this returns the code unit of the index (can be a part of a surrogate pair).
RegExpValidationState$1.prototype.at=function at(i,forceU){if(forceU===void 0)forceU=false;var s=this.source;var l=s.length;if(i>=l){return-1;}var c=s.charCodeAt(i);if(!(forceU||this.switchU)||c<=0xD7FF||c>=0xE000||i+1>=l){return c;}var next=s.charCodeAt(i+1);return next>=0xDC00&&next<=0xDFFF?(c<<10)+next-0x35FDC00:c;};RegExpValidationState$1.prototype.nextIndex=function nextIndex(i,forceU){if(forceU===void 0)forceU=false;var s=this.source;var l=s.length;if(i>=l){return l;}var c=s.charCodeAt(i),next;if(!(forceU||this.switchU)||c<=0xD7FF||c>=0xE000||i+1>=l||(next=s.charCodeAt(i+1))<0xDC00||next>0xDFFF){return i+1;}return i+2;};RegExpValidationState$1.prototype.current=function current(forceU){if(forceU===void 0)forceU=false;return this.at(this.pos,forceU);};RegExpValidationState$1.prototype.lookahead=function lookahead(forceU){if(forceU===void 0)forceU=false;return this.at(this.nextIndex(this.pos,forceU),forceU);};RegExpValidationState$1.prototype.advance=function advance(forceU){if(forceU===void 0)forceU=false;this.pos=this.nextIndex(this.pos,forceU);};RegExpValidationState$1.prototype.eat=function eat(ch,forceU){if(forceU===void 0)forceU=false;if(this.current(forceU)===ch){this.advance(forceU);return true;}return false;};function codePointToString$2(ch){if(ch<=0xFFFF){return String.fromCharCode(ch);}ch-=0x10000;return String.fromCharCode((ch>>10)+0xD800,(ch&0x03FF)+0xDC00);}/**
 * Validate the flags part of a given RegExpLiteral.
 *
 * @param {RegExpValidationState} state The state to validate RegExp.
 * @returns {void}
 */pp$8$1.validateRegExpFlags=function(state){var validFlags=state.validFlags;var flags=state.flags;for(var i=0;i<flags.length;i++){var flag=flags.charAt(i);if(validFlags.indexOf(flag)===-1){this.raise(state.start,"Invalid regular expression flag");}if(flags.indexOf(flag,i+1)>-1){this.raise(state.start,"Duplicate regular expression flag");}}};/**
 * Validate the pattern part of a given RegExpLiteral.
 *
 * @param {RegExpValidationState} state The state to validate RegExp.
 * @returns {void}
 */pp$8$1.validateRegExpPattern=function(state){this.regexp_pattern(state);// The goal symbol for the parse is |Pattern[~U, ~N]|. If the result of
// parsing contains a |GroupName|, reparse with the goal symbol
// |Pattern[~U, +N]| and use this result instead. Throw a *SyntaxError*
// exception if _P_ did not conform to the grammar, if any elements of _P_
// were not matched by the parse, or if any Early Error conditions exist.
if(!state.switchN&&this.options.ecmaVersion>=9&&state.groupNames.length>0){state.switchN=true;this.regexp_pattern(state);}};// https://www.ecma-international.org/ecma-262/8.0/#prod-Pattern
pp$8$1.regexp_pattern=function(state){state.pos=0;state.lastIntValue=0;state.lastStringValue="";state.lastAssertionIsQuantifiable=false;state.numCapturingParens=0;state.maxBackReference=0;state.groupNames.length=0;state.backReferenceNames.length=0;this.regexp_disjunction(state);if(state.pos!==state.source.length){// Make the same messages as V8.
if(state.eat(0x29/* ) */)){state.raise("Unmatched ')'");}if(state.eat(0x5D/* ] */)||state.eat(0x7D/* } */)){state.raise("Lone quantifier brackets");}}if(state.maxBackReference>state.numCapturingParens){state.raise("Invalid escape");}for(var i=0,list=state.backReferenceNames;i<list.length;i+=1){var name=list[i];if(state.groupNames.indexOf(name)===-1){state.raise("Invalid named capture referenced");}}};// https://www.ecma-international.org/ecma-262/8.0/#prod-Disjunction
pp$8$1.regexp_disjunction=function(state){this.regexp_alternative(state);while(state.eat(0x7C/* | */)){this.regexp_alternative(state);}// Make the same message as V8.
if(this.regexp_eatQuantifier(state,true)){state.raise("Nothing to repeat");}if(state.eat(0x7B/* { */)){state.raise("Lone quantifier brackets");}};// https://www.ecma-international.org/ecma-262/8.0/#prod-Alternative
pp$8$1.regexp_alternative=function(state){while(state.pos<state.source.length&&this.regexp_eatTerm(state)){}};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-Term
pp$8$1.regexp_eatTerm=function(state){if(this.regexp_eatAssertion(state)){// Handle `QuantifiableAssertion Quantifier` alternative.
// `state.lastAssertionIsQuantifiable` is true if the last eaten Assertion
// is a QuantifiableAssertion.
if(state.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(state)){// Make the same message as V8.
if(state.switchU){state.raise("Invalid quantifier");}}return true;}if(state.switchU?this.regexp_eatAtom(state):this.regexp_eatExtendedAtom(state)){this.regexp_eatQuantifier(state);return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-Assertion
pp$8$1.regexp_eatAssertion=function(state){var start=state.pos;state.lastAssertionIsQuantifiable=false;// ^, $
if(state.eat(0x5E/* ^ */)||state.eat(0x24/* $ */)){return true;}// \b \B
if(state.eat(0x5C/* \ */)){if(state.eat(0x42/* B */)||state.eat(0x62/* b */)){return true;}state.pos=start;}// Lookahead / Lookbehind
if(state.eat(0x28/* ( */)&&state.eat(0x3F/* ? */)){var lookbehind=false;if(this.options.ecmaVersion>=9){lookbehind=state.eat(0x3C/* < */);}if(state.eat(0x3D/* = */)||state.eat(0x21/* ! */)){this.regexp_disjunction(state);if(!state.eat(0x29/* ) */)){state.raise("Unterminated group");}state.lastAssertionIsQuantifiable=!lookbehind;return true;}}state.pos=start;return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-Quantifier
pp$8$1.regexp_eatQuantifier=function(state,noError){if(noError===void 0)noError=false;if(this.regexp_eatQuantifierPrefix(state,noError)){state.eat(0x3F/* ? */);return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-QuantifierPrefix
pp$8$1.regexp_eatQuantifierPrefix=function(state,noError){return state.eat(0x2A/* * */)||state.eat(0x2B/* + */)||state.eat(0x3F/* ? */)||this.regexp_eatBracedQuantifier(state,noError);};pp$8$1.regexp_eatBracedQuantifier=function(state,noError){var start=state.pos;if(state.eat(0x7B/* { */)){var min=0,max=-1;if(this.regexp_eatDecimalDigits(state)){min=state.lastIntValue;if(state.eat(0x2C/* , */)&&this.regexp_eatDecimalDigits(state)){max=state.lastIntValue;}if(state.eat(0x7D/* } */)){// SyntaxError in https://www.ecma-international.org/ecma-262/8.0/#sec-term
if(max!==-1&&max<min&&!noError){state.raise("numbers out of order in {} quantifier");}return true;}}if(state.switchU&&!noError){state.raise("Incomplete quantifier");}state.pos=start;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-Atom
pp$8$1.regexp_eatAtom=function(state){return this.regexp_eatPatternCharacters(state)||state.eat(0x2E/* . */)||this.regexp_eatReverseSolidusAtomEscape(state)||this.regexp_eatCharacterClass(state)||this.regexp_eatUncapturingGroup(state)||this.regexp_eatCapturingGroup(state);};pp$8$1.regexp_eatReverseSolidusAtomEscape=function(state){var start=state.pos;if(state.eat(0x5C/* \ */)){if(this.regexp_eatAtomEscape(state)){return true;}state.pos=start;}return false;};pp$8$1.regexp_eatUncapturingGroup=function(state){var start=state.pos;if(state.eat(0x28/* ( */)){if(state.eat(0x3F/* ? */)&&state.eat(0x3A/* : */)){this.regexp_disjunction(state);if(state.eat(0x29/* ) */)){return true;}state.raise("Unterminated group");}state.pos=start;}return false;};pp$8$1.regexp_eatCapturingGroup=function(state){if(state.eat(0x28/* ( */)){if(this.options.ecmaVersion>=9){this.regexp_groupSpecifier(state);}else if(state.current()===0x3F/* ? */){state.raise("Invalid group");}this.regexp_disjunction(state);if(state.eat(0x29/* ) */)){state.numCapturingParens+=1;return true;}state.raise("Unterminated group");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ExtendedAtom
pp$8$1.regexp_eatExtendedAtom=function(state){return state.eat(0x2E/* . */)||this.regexp_eatReverseSolidusAtomEscape(state)||this.regexp_eatCharacterClass(state)||this.regexp_eatUncapturingGroup(state)||this.regexp_eatCapturingGroup(state)||this.regexp_eatInvalidBracedQuantifier(state)||this.regexp_eatExtendedPatternCharacter(state);};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-InvalidBracedQuantifier
pp$8$1.regexp_eatInvalidBracedQuantifier=function(state){if(this.regexp_eatBracedQuantifier(state,true)){state.raise("Nothing to repeat");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-SyntaxCharacter
pp$8$1.regexp_eatSyntaxCharacter=function(state){var ch=state.current();if(isSyntaxCharacter$1(ch)){state.lastIntValue=ch;state.advance();return true;}return false;};function isSyntaxCharacter$1(ch){return ch===0x24/* $ */||ch>=0x28/* ( */&&ch<=0x2B/* + */||ch===0x2E/* . */||ch===0x3F/* ? */||ch>=0x5B/* [ */&&ch<=0x5E/* ^ */||ch>=0x7B/* { */&&ch<=0x7D/* } */;}// https://www.ecma-international.org/ecma-262/8.0/#prod-PatternCharacter
// But eat eager.
pp$8$1.regexp_eatPatternCharacters=function(state){var start=state.pos;var ch=0;while((ch=state.current())!==-1&&!isSyntaxCharacter$1(ch)){state.advance();}return state.pos!==start;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ExtendedPatternCharacter
pp$8$1.regexp_eatExtendedPatternCharacter=function(state){var ch=state.current();if(ch!==-1&&ch!==0x24/* $ */&&!(ch>=0x28/* ( */&&ch<=0x2B/* + */)&&ch!==0x2E/* . */&&ch!==0x3F/* ? */&&ch!==0x5B/* [ */&&ch!==0x5E/* ^ */&&ch!==0x7C/* | */){state.advance();return true;}return false;};// GroupSpecifier ::
//   [empty]
//   `?` GroupName
pp$8$1.regexp_groupSpecifier=function(state){if(state.eat(0x3F/* ? */)){if(this.regexp_eatGroupName(state)){if(state.groupNames.indexOf(state.lastStringValue)!==-1){state.raise("Duplicate capture group name");}state.groupNames.push(state.lastStringValue);return;}state.raise("Invalid group");}};// GroupName ::
//   `<` RegExpIdentifierName `>`
// Note: this updates `state.lastStringValue` property with the eaten name.
pp$8$1.regexp_eatGroupName=function(state){state.lastStringValue="";if(state.eat(0x3C/* < */)){if(this.regexp_eatRegExpIdentifierName(state)&&state.eat(0x3E/* > */)){return true;}state.raise("Invalid capture group name");}return false;};// RegExpIdentifierName ::
//   RegExpIdentifierStart
//   RegExpIdentifierName RegExpIdentifierPart
// Note: this updates `state.lastStringValue` property with the eaten name.
pp$8$1.regexp_eatRegExpIdentifierName=function(state){state.lastStringValue="";if(this.regexp_eatRegExpIdentifierStart(state)){state.lastStringValue+=codePointToString$2(state.lastIntValue);while(this.regexp_eatRegExpIdentifierPart(state)){state.lastStringValue+=codePointToString$2(state.lastIntValue);}return true;}return false;};// RegExpIdentifierStart ::
//   UnicodeIDStart
//   `$`
//   `_`
//   `\` RegExpUnicodeEscapeSequence[+U]
pp$8$1.regexp_eatRegExpIdentifierStart=function(state){var start=state.pos;var forceU=this.options.ecmaVersion>=11;var ch=state.current(forceU);state.advance(forceU);if(ch===0x5C/* \ */&&this.regexp_eatRegExpUnicodeEscapeSequence(state,forceU)){ch=state.lastIntValue;}if(isRegExpIdentifierStart$1(ch)){state.lastIntValue=ch;return true;}state.pos=start;return false;};function isRegExpIdentifierStart$1(ch){return isIdentifierStart$1(ch,true)||ch===0x24/* $ */||ch===0x5F;/* _ */}// RegExpIdentifierPart ::
//   UnicodeIDContinue
//   `$`
//   `_`
//   `\` RegExpUnicodeEscapeSequence[+U]
//   <ZWNJ>
//   <ZWJ>
pp$8$1.regexp_eatRegExpIdentifierPart=function(state){var start=state.pos;var forceU=this.options.ecmaVersion>=11;var ch=state.current(forceU);state.advance(forceU);if(ch===0x5C/* \ */&&this.regexp_eatRegExpUnicodeEscapeSequence(state,forceU)){ch=state.lastIntValue;}if(isRegExpIdentifierPart$1(ch)){state.lastIntValue=ch;return true;}state.pos=start;return false;};function isRegExpIdentifierPart$1(ch){return isIdentifierChar$1(ch,true)||ch===0x24/* $ */||ch===0x5F/* _ */||ch===0x200C/* <ZWNJ> */||ch===0x200D;/* <ZWJ> */}// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-AtomEscape
pp$8$1.regexp_eatAtomEscape=function(state){if(this.regexp_eatBackReference(state)||this.regexp_eatCharacterClassEscape(state)||this.regexp_eatCharacterEscape(state)||state.switchN&&this.regexp_eatKGroupName(state)){return true;}if(state.switchU){// Make the same message as V8.
if(state.current()===0x63/* c */){state.raise("Invalid unicode escape");}state.raise("Invalid escape");}return false;};pp$8$1.regexp_eatBackReference=function(state){var start=state.pos;if(this.regexp_eatDecimalEscape(state)){var n=state.lastIntValue;if(state.switchU){// For SyntaxError in https://www.ecma-international.org/ecma-262/8.0/#sec-atomescape
if(n>state.maxBackReference){state.maxBackReference=n;}return true;}if(n<=state.numCapturingParens){return true;}state.pos=start;}return false;};pp$8$1.regexp_eatKGroupName=function(state){if(state.eat(0x6B/* k */)){if(this.regexp_eatGroupName(state)){state.backReferenceNames.push(state.lastStringValue);return true;}state.raise("Invalid named reference");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-CharacterEscape
pp$8$1.regexp_eatCharacterEscape=function(state){return this.regexp_eatControlEscape(state)||this.regexp_eatCControlLetter(state)||this.regexp_eatZero(state)||this.regexp_eatHexEscapeSequence(state)||this.regexp_eatRegExpUnicodeEscapeSequence(state,false)||!state.switchU&&this.regexp_eatLegacyOctalEscapeSequence(state)||this.regexp_eatIdentityEscape(state);};pp$8$1.regexp_eatCControlLetter=function(state){var start=state.pos;if(state.eat(0x63/* c */)){if(this.regexp_eatControlLetter(state)){return true;}state.pos=start;}return false;};pp$8$1.regexp_eatZero=function(state){if(state.current()===0x30/* 0 */&&!isDecimalDigit$1(state.lookahead())){state.lastIntValue=0;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-ControlEscape
pp$8$1.regexp_eatControlEscape=function(state){var ch=state.current();if(ch===0x74/* t */){state.lastIntValue=0x09;/* \t */state.advance();return true;}if(ch===0x6E/* n */){state.lastIntValue=0x0A;/* \n */state.advance();return true;}if(ch===0x76/* v */){state.lastIntValue=0x0B;/* \v */state.advance();return true;}if(ch===0x66/* f */){state.lastIntValue=0x0C;/* \f */state.advance();return true;}if(ch===0x72/* r */){state.lastIntValue=0x0D;/* \r */state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-ControlLetter
pp$8$1.regexp_eatControlLetter=function(state){var ch=state.current();if(isControlLetter$1(ch)){state.lastIntValue=ch%0x20;state.advance();return true;}return false;};function isControlLetter$1(ch){return ch>=0x41/* A */&&ch<=0x5A/* Z */||ch>=0x61/* a */&&ch<=0x7A/* z */;}// https://www.ecma-international.org/ecma-262/8.0/#prod-RegExpUnicodeEscapeSequence
pp$8$1.regexp_eatRegExpUnicodeEscapeSequence=function(state,forceU){if(forceU===void 0)forceU=false;var start=state.pos;var switchU=forceU||state.switchU;if(state.eat(0x75/* u */)){if(this.regexp_eatFixedHexDigits(state,4)){var lead=state.lastIntValue;if(switchU&&lead>=0xD800&&lead<=0xDBFF){var leadSurrogateEnd=state.pos;if(state.eat(0x5C/* \ */)&&state.eat(0x75/* u */)&&this.regexp_eatFixedHexDigits(state,4)){var trail=state.lastIntValue;if(trail>=0xDC00&&trail<=0xDFFF){state.lastIntValue=(lead-0xD800)*0x400+(trail-0xDC00)+0x10000;return true;}}state.pos=leadSurrogateEnd;state.lastIntValue=lead;}return true;}if(switchU&&state.eat(0x7B/* { */)&&this.regexp_eatHexDigits(state)&&state.eat(0x7D/* } */)&&isValidUnicode$1(state.lastIntValue)){return true;}if(switchU){state.raise("Invalid unicode escape");}state.pos=start;}return false;};function isValidUnicode$1(ch){return ch>=0&&ch<=0x10FFFF;}// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-IdentityEscape
pp$8$1.regexp_eatIdentityEscape=function(state){if(state.switchU){if(this.regexp_eatSyntaxCharacter(state)){return true;}if(state.eat(0x2F/* / */)){state.lastIntValue=0x2F;/* / */return true;}return false;}var ch=state.current();if(ch!==0x63/* c */&&(!state.switchN||ch!==0x6B/* k */)){state.lastIntValue=ch;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-DecimalEscape
pp$8$1.regexp_eatDecimalEscape=function(state){state.lastIntValue=0;var ch=state.current();if(ch>=0x31/* 1 */&&ch<=0x39/* 9 */){do{state.lastIntValue=10*state.lastIntValue+(ch-0x30/* 0 */);state.advance();}while((ch=state.current())>=0x30/* 0 */&&ch<=0x39/* 9 */);return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-CharacterClassEscape
pp$8$1.regexp_eatCharacterClassEscape=function(state){var ch=state.current();if(isCharacterClassEscape$1(ch)){state.lastIntValue=-1;state.advance();return true;}if(state.switchU&&this.options.ecmaVersion>=9&&(ch===0x50/* P */||ch===0x70/* p */)){state.lastIntValue=-1;state.advance();if(state.eat(0x7B/* { */)&&this.regexp_eatUnicodePropertyValueExpression(state)&&state.eat(0x7D/* } */)){return true;}state.raise("Invalid property name");}return false;};function isCharacterClassEscape$1(ch){return ch===0x64/* d */||ch===0x44/* D */||ch===0x73/* s */||ch===0x53/* S */||ch===0x77/* w */||ch===0x57/* W */;}// UnicodePropertyValueExpression ::
//   UnicodePropertyName `=` UnicodePropertyValue
//   LoneUnicodePropertyNameOrValue
pp$8$1.regexp_eatUnicodePropertyValueExpression=function(state){var start=state.pos;// UnicodePropertyName `=` UnicodePropertyValue
if(this.regexp_eatUnicodePropertyName(state)&&state.eat(0x3D/* = */)){var name=state.lastStringValue;if(this.regexp_eatUnicodePropertyValue(state)){var value=state.lastStringValue;this.regexp_validateUnicodePropertyNameAndValue(state,name,value);return true;}}state.pos=start;// LoneUnicodePropertyNameOrValue
if(this.regexp_eatLoneUnicodePropertyNameOrValue(state)){var nameOrValue=state.lastStringValue;this.regexp_validateUnicodePropertyNameOrValue(state,nameOrValue);return true;}return false;};pp$8$1.regexp_validateUnicodePropertyNameAndValue=function(state,name,value){if(!has$2(state.unicodeProperties.nonBinary,name)){state.raise("Invalid property name");}if(!state.unicodeProperties.nonBinary[name].test(value)){state.raise("Invalid property value");}};pp$8$1.regexp_validateUnicodePropertyNameOrValue=function(state,nameOrValue){if(!state.unicodeProperties.binary.test(nameOrValue)){state.raise("Invalid property name");}};// UnicodePropertyName ::
//   UnicodePropertyNameCharacters
pp$8$1.regexp_eatUnicodePropertyName=function(state){var ch=0;state.lastStringValue="";while(isUnicodePropertyNameCharacter$1(ch=state.current())){state.lastStringValue+=codePointToString$2(ch);state.advance();}return state.lastStringValue!=="";};function isUnicodePropertyNameCharacter$1(ch){return isControlLetter$1(ch)||ch===0x5F;/* _ */}// UnicodePropertyValue ::
//   UnicodePropertyValueCharacters
pp$8$1.regexp_eatUnicodePropertyValue=function(state){var ch=0;state.lastStringValue="";while(isUnicodePropertyValueCharacter$1(ch=state.current())){state.lastStringValue+=codePointToString$2(ch);state.advance();}return state.lastStringValue!=="";};function isUnicodePropertyValueCharacter$1(ch){return isUnicodePropertyNameCharacter$1(ch)||isDecimalDigit$1(ch);}// LoneUnicodePropertyNameOrValue ::
//   UnicodePropertyValueCharacters
pp$8$1.regexp_eatLoneUnicodePropertyNameOrValue=function(state){return this.regexp_eatUnicodePropertyValue(state);};// https://www.ecma-international.org/ecma-262/8.0/#prod-CharacterClass
pp$8$1.regexp_eatCharacterClass=function(state){if(state.eat(0x5B/* [ */)){state.eat(0x5E/* ^ */);this.regexp_classRanges(state);if(state.eat(0x5D/* ] */)){return true;}// Unreachable since it threw "unterminated regular expression" error before.
state.raise("Unterminated character class");}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-ClassRanges
// https://www.ecma-international.org/ecma-262/8.0/#prod-NonemptyClassRanges
// https://www.ecma-international.org/ecma-262/8.0/#prod-NonemptyClassRangesNoDash
pp$8$1.regexp_classRanges=function(state){while(this.regexp_eatClassAtom(state)){var left=state.lastIntValue;if(state.eat(0x2D/* - */)&&this.regexp_eatClassAtom(state)){var right=state.lastIntValue;if(state.switchU&&(left===-1||right===-1)){state.raise("Invalid character class");}if(left!==-1&&right!==-1&&left>right){state.raise("Range out of order in character class");}}}};// https://www.ecma-international.org/ecma-262/8.0/#prod-ClassAtom
// https://www.ecma-international.org/ecma-262/8.0/#prod-ClassAtomNoDash
pp$8$1.regexp_eatClassAtom=function(state){var start=state.pos;if(state.eat(0x5C/* \ */)){if(this.regexp_eatClassEscape(state)){return true;}if(state.switchU){// Make the same message as V8.
var ch$1=state.current();if(ch$1===0x63/* c */||isOctalDigit$1(ch$1)){state.raise("Invalid class escape");}state.raise("Invalid escape");}state.pos=start;}var ch=state.current();if(ch!==0x5D/* ] */){state.lastIntValue=ch;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ClassEscape
pp$8$1.regexp_eatClassEscape=function(state){var start=state.pos;if(state.eat(0x62/* b */)){state.lastIntValue=0x08;/* <BS> */return true;}if(state.switchU&&state.eat(0x2D/* - */)){state.lastIntValue=0x2D;/* - */return true;}if(!state.switchU&&state.eat(0x63/* c */)){if(this.regexp_eatClassControlLetter(state)){return true;}state.pos=start;}return this.regexp_eatCharacterClassEscape(state)||this.regexp_eatCharacterEscape(state);};// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-ClassControlLetter
pp$8$1.regexp_eatClassControlLetter=function(state){var ch=state.current();if(isDecimalDigit$1(ch)||ch===0x5F/* _ */){state.lastIntValue=ch%0x20;state.advance();return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-HexEscapeSequence
pp$8$1.regexp_eatHexEscapeSequence=function(state){var start=state.pos;if(state.eat(0x78/* x */)){if(this.regexp_eatFixedHexDigits(state,2)){return true;}if(state.switchU){state.raise("Invalid escape");}state.pos=start;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-DecimalDigits
pp$8$1.regexp_eatDecimalDigits=function(state){var start=state.pos;var ch=0;state.lastIntValue=0;while(isDecimalDigit$1(ch=state.current())){state.lastIntValue=10*state.lastIntValue+(ch-0x30/* 0 */);state.advance();}return state.pos!==start;};function isDecimalDigit$1(ch){return ch>=0x30/* 0 */&&ch<=0x39;/* 9 */}// https://www.ecma-international.org/ecma-262/8.0/#prod-HexDigits
pp$8$1.regexp_eatHexDigits=function(state){var start=state.pos;var ch=0;state.lastIntValue=0;while(isHexDigit$1(ch=state.current())){state.lastIntValue=16*state.lastIntValue+hexToInt$1(ch);state.advance();}return state.pos!==start;};function isHexDigit$1(ch){return ch>=0x30/* 0 */&&ch<=0x39/* 9 */||ch>=0x41/* A */&&ch<=0x46/* F */||ch>=0x61/* a */&&ch<=0x66/* f */;}function hexToInt$1(ch){if(ch>=0x41/* A */&&ch<=0x46/* F */){return 10+(ch-0x41/* A */);}if(ch>=0x61/* a */&&ch<=0x66/* f */){return 10+(ch-0x61/* a */);}return ch-0x30;/* 0 */}// https://www.ecma-international.org/ecma-262/8.0/#prod-annexB-LegacyOctalEscapeSequence
// Allows only 0-377(octal) i.e. 0-255(decimal).
pp$8$1.regexp_eatLegacyOctalEscapeSequence=function(state){if(this.regexp_eatOctalDigit(state)){var n1=state.lastIntValue;if(this.regexp_eatOctalDigit(state)){var n2=state.lastIntValue;if(n1<=3&&this.regexp_eatOctalDigit(state)){state.lastIntValue=n1*64+n2*8+state.lastIntValue;}else{state.lastIntValue=n1*8+n2;}}else{state.lastIntValue=n1;}return true;}return false;};// https://www.ecma-international.org/ecma-262/8.0/#prod-OctalDigit
pp$8$1.regexp_eatOctalDigit=function(state){var ch=state.current();if(isOctalDigit$1(ch)){state.lastIntValue=ch-0x30;/* 0 */state.advance();return true;}state.lastIntValue=0;return false;};function isOctalDigit$1(ch){return ch>=0x30/* 0 */&&ch<=0x37;/* 7 */}// https://www.ecma-international.org/ecma-262/8.0/#prod-Hex4Digits
// https://www.ecma-international.org/ecma-262/8.0/#prod-HexDigit
// And HexDigit HexDigit in https://www.ecma-international.org/ecma-262/8.0/#prod-HexEscapeSequence
pp$8$1.regexp_eatFixedHexDigits=function(state,length){var start=state.pos;state.lastIntValue=0;for(var i=0;i<length;++i){var ch=state.current();if(!isHexDigit$1(ch)){state.pos=start;return false;}state.lastIntValue=16*state.lastIntValue+hexToInt$1(ch);state.advance();}return true;};// Object type used to represent tokens. Note that normally, tokens
// simply exist as properties on the parser object. This is only
// used for the onToken callback and the external tokenizer.
var Token$1=function Token(p){this.type=p.type;this.value=p.value;this.start=p.start;this.end=p.end;if(p.options.locations){this.loc=new SourceLocation$1(p,p.startLoc,p.endLoc);}if(p.options.ranges){this.range=[p.start,p.end];}};// ## Tokenizer
var pp$9$1=Parser$1.prototype;// Move to the next token
pp$9$1.next=function(ignoreEscapeSequenceInKeyword){if(!ignoreEscapeSequenceInKeyword&&this.type.keyword&&this.containsEsc){this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword);}if(this.options.onToken){this.options.onToken(new Token$1(this));}this.lastTokEnd=this.end;this.lastTokStart=this.start;this.lastTokEndLoc=this.endLoc;this.lastTokStartLoc=this.startLoc;this.nextToken();};pp$9$1.getToken=function(){this.next();return new Token$1(this);};// If we're in an ES6 environment, make parsers iterable
if(typeof Symbol!=="undefined"){pp$9$1[Symbol.iterator]=function(){var this$1=this;return{next:function next(){var token=this$1.getToken();return{done:token.type===types$2.eof,value:token};}};};}// Toggle strict mode. Re-reads the next number or string to please
// pedantic tests (`"use strict"; 010;` should fail).
pp$9$1.curContext=function(){return this.context[this.context.length-1];};// Read a single token, updating the parser object's token-related
// properties.
pp$9$1.nextToken=function(){var curContext=this.curContext();if(!curContext||!curContext.preserveSpace){this.skipSpace();}this.start=this.pos;if(this.options.locations){this.startLoc=this.curPosition();}if(this.pos>=this.input.length){return this.finishToken(types$2.eof);}if(curContext.override){return curContext.override(this);}else{this.readToken(this.fullCharCodeAtPos());}};pp$9$1.readToken=function(code){// Identifier or keyword. '\uXXXX' sequences are allowed in
// identifiers, so '\' also dispatches to that.
if(isIdentifierStart$1(code,this.options.ecmaVersion>=6)||code===92/* '\' */){return this.readWord();}return this.getTokenFromCode(code);};pp$9$1.fullCharCodeAtPos=function(){var code=this.input.charCodeAt(this.pos);if(code<=0xd7ff||code>=0xdc00){return code;}var next=this.input.charCodeAt(this.pos+1);return next<=0xdbff||next>=0xe000?code:(code<<10)+next-0x35fdc00;};pp$9$1.skipBlockComment=function(){var startLoc=this.options.onComment&&this.curPosition();var start=this.pos,end=this.input.indexOf("*/",this.pos+=2);if(end===-1){this.raise(this.pos-2,"Unterminated comment");}this.pos=end+2;if(this.options.locations){lineBreakG$1.lastIndex=start;var match;while((match=lineBreakG$1.exec(this.input))&&match.index<this.pos){++this.curLine;this.lineStart=match.index+match[0].length;}}if(this.options.onComment){this.options.onComment(true,this.input.slice(start+2,end),start,this.pos,startLoc,this.curPosition());}};pp$9$1.skipLineComment=function(startSkip){var start=this.pos;var startLoc=this.options.onComment&&this.curPosition();var ch=this.input.charCodeAt(this.pos+=startSkip);while(this.pos<this.input.length&&!isNewLine$1(ch)){ch=this.input.charCodeAt(++this.pos);}if(this.options.onComment){this.options.onComment(false,this.input.slice(start+startSkip,this.pos),start,this.pos,startLoc,this.curPosition());}};// Called at the start of the parse and after every token. Skips
// whitespace and comments, and.
pp$9$1.skipSpace=function(){loop:while(this.pos<this.input.length){var ch=this.input.charCodeAt(this.pos);switch(ch){case 32:case 160:// ' '
++this.pos;break;case 13:if(this.input.charCodeAt(this.pos+1)===10){++this.pos;}case 10:case 8232:case 8233:++this.pos;if(this.options.locations){++this.curLine;this.lineStart=this.pos;}break;case 47:// '/'
switch(this.input.charCodeAt(this.pos+1)){case 42:// '*'
this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break loop;}break;default:if(ch>8&&ch<14||ch>=5760&&nonASCIIwhitespace$1.test(String.fromCharCode(ch))){++this.pos;}else{break loop;}}}};// Called at the end of every token. Sets `end`, `val`, and
// maintains `context` and `exprAllowed`, and skips the space after
// the token, so that the next one's `start` will point at the
// right position.
pp$9$1.finishToken=function(type,val){this.end=this.pos;if(this.options.locations){this.endLoc=this.curPosition();}var prevType=this.type;this.type=type;this.value=val;this.updateContext(prevType);};// ### Token reading
// This is the function that is called to fetch the next token. It
// is somewhat obscure, because it works in character codes rather
// than characters, and because operator parsing has been inlined
// into it.
//
// All in the name of speed.
//
pp$9$1.readToken_dot=function(){var next=this.input.charCodeAt(this.pos+1);if(next>=48&&next<=57){return this.readNumber(true);}var next2=this.input.charCodeAt(this.pos+2);if(this.options.ecmaVersion>=6&&next===46&&next2===46){// 46 = dot '.'
this.pos+=3;return this.finishToken(types$2.ellipsis);}else{++this.pos;return this.finishToken(types$2.dot);}};pp$9$1.readToken_slash=function(){// '/'
var next=this.input.charCodeAt(this.pos+1);if(this.exprAllowed){++this.pos;return this.readRegexp();}if(next===61){return this.finishOp(types$2.assign,2);}return this.finishOp(types$2.slash,1);};pp$9$1.readToken_mult_modulo_exp=function(code){// '%*'
var next=this.input.charCodeAt(this.pos+1);var size=1;var tokentype=code===42?types$2.star:types$2.modulo;// exponentiation operator ** and **=
if(this.options.ecmaVersion>=7&&code===42&&next===42){++size;tokentype=types$2.starstar;next=this.input.charCodeAt(this.pos+2);}if(next===61){return this.finishOp(types$2.assign,size+1);}return this.finishOp(tokentype,size);};pp$9$1.readToken_pipe_amp=function(code){// '|&'
var next=this.input.charCodeAt(this.pos+1);if(next===code){if(this.options.ecmaVersion>=12){var next2=this.input.charCodeAt(this.pos+2);if(next2===61){return this.finishOp(types$2.assign,3);}}return this.finishOp(code===124?types$2.logicalOR:types$2.logicalAND,2);}if(next===61){return this.finishOp(types$2.assign,2);}return this.finishOp(code===124?types$2.bitwiseOR:types$2.bitwiseAND,1);};pp$9$1.readToken_caret=function(){// '^'
var next=this.input.charCodeAt(this.pos+1);if(next===61){return this.finishOp(types$2.assign,2);}return this.finishOp(types$2.bitwiseXOR,1);};pp$9$1.readToken_plus_min=function(code){// '+-'
var next=this.input.charCodeAt(this.pos+1);if(next===code){if(next===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||lineBreak$1.test(this.input.slice(this.lastTokEnd,this.pos)))){// A `-->` line comment
this.skipLineComment(3);this.skipSpace();return this.nextToken();}return this.finishOp(types$2.incDec,2);}if(next===61){return this.finishOp(types$2.assign,2);}return this.finishOp(types$2.plusMin,1);};pp$9$1.readToken_lt_gt=function(code){// '<>'
var next=this.input.charCodeAt(this.pos+1);var size=1;if(next===code){size=code===62&&this.input.charCodeAt(this.pos+2)===62?3:2;if(this.input.charCodeAt(this.pos+size)===61){return this.finishOp(types$2.assign,size+1);}return this.finishOp(types$2.bitShift,size);}if(next===33&&code===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45){// `<!--`, an XML-style comment that should be interpreted as a line comment
this.skipLineComment(4);this.skipSpace();return this.nextToken();}if(next===61){size=2;}return this.finishOp(types$2.relational,size);};pp$9$1.readToken_eq_excl=function(code){// '=!'
var next=this.input.charCodeAt(this.pos+1);if(next===61){return this.finishOp(types$2.equality,this.input.charCodeAt(this.pos+2)===61?3:2);}if(code===61&&next===62&&this.options.ecmaVersion>=6){// '=>'
this.pos+=2;return this.finishToken(types$2.arrow);}return this.finishOp(code===61?types$2.eq:types$2.prefix,1);};pp$9$1.readToken_question=function(){// '?'
var ecmaVersion=this.options.ecmaVersion;if(ecmaVersion>=11){var next=this.input.charCodeAt(this.pos+1);if(next===46){var next2=this.input.charCodeAt(this.pos+2);if(next2<48||next2>57){return this.finishOp(types$2.questionDot,2);}}if(next===63){if(ecmaVersion>=12){var next2$1=this.input.charCodeAt(this.pos+2);if(next2$1===61){return this.finishOp(types$2.assign,3);}}return this.finishOp(types$2.coalesce,2);}}return this.finishOp(types$2.question,1);};pp$9$1.readToken_numberSign=function(){// '#'
var ecmaVersion=this.options.ecmaVersion;var code=35;// '#'
if(ecmaVersion>=13){++this.pos;code=this.fullCharCodeAtPos();if(isIdentifierStart$1(code,true)||code===92/* '\' */){return this.finishToken(types$2.privateId,this.readWord1());}}this.raise(this.pos,"Unexpected character '"+codePointToString$1$1(code)+"'");};pp$9$1.getTokenFromCode=function(code){switch(code){// The interpretation of a dot depends on whether it is followed
// by a digit or another two dots.
case 46:// '.'
return this.readToken_dot();// Punctuation tokens.
case 40:++this.pos;return this.finishToken(types$2.parenL);case 41:++this.pos;return this.finishToken(types$2.parenR);case 59:++this.pos;return this.finishToken(types$2.semi);case 44:++this.pos;return this.finishToken(types$2.comma);case 91:++this.pos;return this.finishToken(types$2.bracketL);case 93:++this.pos;return this.finishToken(types$2.bracketR);case 123:++this.pos;return this.finishToken(types$2.braceL);case 125:++this.pos;return this.finishToken(types$2.braceR);case 58:++this.pos;return this.finishToken(types$2.colon);case 96:// '`'
if(this.options.ecmaVersion<6){break;}++this.pos;return this.finishToken(types$2.backQuote);case 48:// '0'
var next=this.input.charCodeAt(this.pos+1);if(next===120||next===88){return this.readRadixNumber(16);}// '0x', '0X' - hex number
if(this.options.ecmaVersion>=6){if(next===111||next===79){return this.readRadixNumber(8);}// '0o', '0O' - octal number
if(next===98||next===66){return this.readRadixNumber(2);}// '0b', '0B' - binary number
}// Anything else beginning with a digit is an integer, octal
// number, or float.
case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:// 1-9
return this.readNumber(false);// Quotes produce strings.
case 34:case 39:// '"', "'"
return this.readString(code);// Operators are parsed inline in tiny state machines. '=' (61) is
// often referred to. `finishOp` simply skips the amount of
// characters it is given as second argument, and returns a token
// of the type given by its first argument.
case 47:// '/'
return this.readToken_slash();case 37:case 42:// '%*'
return this.readToken_mult_modulo_exp(code);case 124:case 38:// '|&'
return this.readToken_pipe_amp(code);case 94:// '^'
return this.readToken_caret();case 43:case 45:// '+-'
return this.readToken_plus_min(code);case 60:case 62:// '<>'
return this.readToken_lt_gt(code);case 61:case 33:// '=!'
return this.readToken_eq_excl(code);case 63:// '?'
return this.readToken_question();case 126:// '~'
return this.finishOp(types$2.prefix,1);case 35:// '#'
return this.readToken_numberSign();}this.raise(this.pos,"Unexpected character '"+codePointToString$1$1(code)+"'");};pp$9$1.finishOp=function(type,size){var str=this.input.slice(this.pos,this.pos+size);this.pos+=size;return this.finishToken(type,str);};pp$9$1.readRegexp=function(){var escaped,inClass,start=this.pos;for(;;){if(this.pos>=this.input.length){this.raise(start,"Unterminated regular expression");}var ch=this.input.charAt(this.pos);if(lineBreak$1.test(ch)){this.raise(start,"Unterminated regular expression");}if(!escaped){if(ch==="["){inClass=true;}else if(ch==="]"&&inClass){inClass=false;}else if(ch==="/"&&!inClass){break;}escaped=ch==="\\";}else{escaped=false;}++this.pos;}var pattern=this.input.slice(start,this.pos);++this.pos;var flagsStart=this.pos;var flags=this.readWord1();if(this.containsEsc){this.unexpected(flagsStart);}// Validate pattern
var state=this.regexpState||(this.regexpState=new RegExpValidationState$1(this));state.reset(start,pattern,flags);this.validateRegExpFlags(state);this.validateRegExpPattern(state);// Create Literal#value property value.
var value=null;try{value=new RegExp(pattern,flags);}catch(e){// ESTree requires null if it failed to instantiate RegExp object.
// https://github.com/estree/estree/blob/a27003adf4fd7bfad44de9cef372a2eacd527b1c/es5.md#regexpliteral
}return this.finishToken(types$2.regexp,{pattern:pattern,flags:flags,value:value});};// Read an integer in the given radix. Return null if zero digits
// were read, the integer value otherwise. When `len` is given, this
// will return `null` unless the integer has exactly `len` digits.
pp$9$1.readInt=function(radix,len,maybeLegacyOctalNumericLiteral){// `len` is used for character escape sequences. In that case, disallow separators.
var allowSeparators=this.options.ecmaVersion>=12&&len===undefined;// `maybeLegacyOctalNumericLiteral` is true if it doesn't have prefix (0x,0o,0b)
// and isn't fraction part nor exponent part. In that case, if the first digit
// is zero then disallow separators.
var isLegacyOctalNumericLiteral=maybeLegacyOctalNumericLiteral&&this.input.charCodeAt(this.pos)===48;var start=this.pos,total=0,lastCode=0;for(var i=0,e=len==null?Infinity:len;i<e;++i,++this.pos){var code=this.input.charCodeAt(this.pos),val=void 0;if(allowSeparators&&code===95){if(isLegacyOctalNumericLiteral){this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals");}if(lastCode===95){this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore");}if(i===0){this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits");}lastCode=code;continue;}if(code>=97){val=code-97+10;}// a
else if(code>=65){val=code-65+10;}// A
else if(code>=48&&code<=57){val=code-48;}// 0-9
else{val=Infinity;}if(val>=radix){break;}lastCode=code;total=total*radix+val;}if(allowSeparators&&lastCode===95){this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits");}if(this.pos===start||len!=null&&this.pos-start!==len){return null;}return total;};function stringToNumber$1(str,isLegacyOctalNumericLiteral){if(isLegacyOctalNumericLiteral){return parseInt(str,8);}// `parseFloat(value)` stops parsing at the first numeric separator then returns a wrong value.
return parseFloat(str.replace(/_/g,""));}function stringToBigInt$1(str){if(typeof BigInt!=="function"){return null;}// `BigInt(value)` throws syntax error if the string contains numeric separators.
return BigInt(str.replace(/_/g,""));}pp$9$1.readRadixNumber=function(radix){var start=this.pos;this.pos+=2;// 0x
var val=this.readInt(radix);if(val==null){this.raise(this.start+2,"Expected number in radix "+radix);}if(this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110){val=stringToBigInt$1(this.input.slice(start,this.pos));++this.pos;}else if(isIdentifierStart$1(this.fullCharCodeAtPos())){this.raise(this.pos,"Identifier directly after number");}return this.finishToken(types$2.num,val);};// Read an integer, octal integer, or floating-point number.
pp$9$1.readNumber=function(startsWithDot){var start=this.pos;if(!startsWithDot&&this.readInt(10,undefined,true)===null){this.raise(start,"Invalid number");}var octal=this.pos-start>=2&&this.input.charCodeAt(start)===48;if(octal&&this.strict){this.raise(start,"Invalid number");}var next=this.input.charCodeAt(this.pos);if(!octal&&!startsWithDot&&this.options.ecmaVersion>=11&&next===110){var val$1=stringToBigInt$1(this.input.slice(start,this.pos));++this.pos;if(isIdentifierStart$1(this.fullCharCodeAtPos())){this.raise(this.pos,"Identifier directly after number");}return this.finishToken(types$2.num,val$1);}if(octal&&/[89]/.test(this.input.slice(start,this.pos))){octal=false;}if(next===46&&!octal){// '.'
++this.pos;this.readInt(10);next=this.input.charCodeAt(this.pos);}if((next===69||next===101)&&!octal){// 'eE'
next=this.input.charCodeAt(++this.pos);if(next===43||next===45){++this.pos;}// '+-'
if(this.readInt(10)===null){this.raise(start,"Invalid number");}}if(isIdentifierStart$1(this.fullCharCodeAtPos())){this.raise(this.pos,"Identifier directly after number");}var val=stringToNumber$1(this.input.slice(start,this.pos),octal);return this.finishToken(types$2.num,val);};// Read a string value, interpreting backslash-escapes.
pp$9$1.readCodePoint=function(){var ch=this.input.charCodeAt(this.pos),code;if(ch===123){// '{'
if(this.options.ecmaVersion<6){this.unexpected();}var codePos=++this.pos;code=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos);++this.pos;if(code>0x10FFFF){this.invalidStringToken(codePos,"Code point out of bounds");}}else{code=this.readHexChar(4);}return code;};function codePointToString$1$1(code){// UTF-16 Decoding
if(code<=0xFFFF){return String.fromCharCode(code);}code-=0x10000;return String.fromCharCode((code>>10)+0xD800,(code&1023)+0xDC00);}pp$9$1.readString=function(quote){var out="",chunkStart=++this.pos;for(;;){if(this.pos>=this.input.length){this.raise(this.start,"Unterminated string constant");}var ch=this.input.charCodeAt(this.pos);if(ch===quote){break;}if(ch===92){// '\'
out+=this.input.slice(chunkStart,this.pos);out+=this.readEscapedChar(false);chunkStart=this.pos;}else{if(isNewLine$1(ch,this.options.ecmaVersion>=10)){this.raise(this.start,"Unterminated string constant");}++this.pos;}}out+=this.input.slice(chunkStart,this.pos++);return this.finishToken(types$2.string,out);};// Reads template string tokens.
var INVALID_TEMPLATE_ESCAPE_ERROR$1={};pp$9$1.tryReadTemplateToken=function(){this.inTemplateElement=true;try{this.readTmplToken();}catch(err){if(err===INVALID_TEMPLATE_ESCAPE_ERROR$1){this.readInvalidTemplateToken();}else{throw err;}}this.inTemplateElement=false;};pp$9$1.invalidStringToken=function(position,message){if(this.inTemplateElement&&this.options.ecmaVersion>=9){throw INVALID_TEMPLATE_ESCAPE_ERROR$1;}else{this.raise(position,message);}};pp$9$1.readTmplToken=function(){var out="",chunkStart=this.pos;for(;;){if(this.pos>=this.input.length){this.raise(this.start,"Unterminated template");}var ch=this.input.charCodeAt(this.pos);if(ch===96||ch===36&&this.input.charCodeAt(this.pos+1)===123){// '`', '${'
if(this.pos===this.start&&(this.type===types$2.template||this.type===types$2.invalidTemplate)){if(ch===36){this.pos+=2;return this.finishToken(types$2.dollarBraceL);}else{++this.pos;return this.finishToken(types$2.backQuote);}}out+=this.input.slice(chunkStart,this.pos);return this.finishToken(types$2.template,out);}if(ch===92){// '\'
out+=this.input.slice(chunkStart,this.pos);out+=this.readEscapedChar(true);chunkStart=this.pos;}else if(isNewLine$1(ch)){out+=this.input.slice(chunkStart,this.pos);++this.pos;switch(ch){case 13:if(this.input.charCodeAt(this.pos)===10){++this.pos;}case 10:out+="\n";break;default:out+=String.fromCharCode(ch);break;}if(this.options.locations){++this.curLine;this.lineStart=this.pos;}chunkStart=this.pos;}else{++this.pos;}}};// Reads a template token to search for the end, without validating any escape sequences
pp$9$1.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++){switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{"){break;}// falls through
case"`":return this.finishToken(types$2.invalidTemplate,this.input.slice(this.start,this.pos));// no default
}}this.raise(this.start,"Unterminated template");};// Used to read escaped characters
pp$9$1.readEscapedChar=function(inTemplate){var ch=this.input.charCodeAt(++this.pos);++this.pos;switch(ch){case 110:return"\n";// 'n' -> '\n'
case 114:return"\r";// 'r' -> '\r'
case 120:return String.fromCharCode(this.readHexChar(2));// 'x'
case 117:return codePointToString$1$1(this.readCodePoint());// 'u'
case 116:return"\t";// 't' -> '\t'
case 98:return"\b";// 'b' -> '\b'
case 118:return"\x0B";// 'v' -> '\u000b'
case 102:return"\f";// 'f' -> '\f'
case 13:if(this.input.charCodeAt(this.pos)===10){++this.pos;}// '\r\n'
case 10:// ' \n'
if(this.options.locations){this.lineStart=this.pos;++this.curLine;}return"";case 56:case 57:if(this.strict){this.invalidStringToken(this.pos-1,"Invalid escape sequence");}if(inTemplate){var codePos=this.pos-1;this.invalidStringToken(codePos,"Invalid escape sequence in template string");return null;}default:if(ch>=48&&ch<=55){var octalStr=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0];var octal=parseInt(octalStr,8);if(octal>255){octalStr=octalStr.slice(0,-1);octal=parseInt(octalStr,8);}this.pos+=octalStr.length-1;ch=this.input.charCodeAt(this.pos);if((octalStr!=="0"||ch===56||ch===57)&&(this.strict||inTemplate)){this.invalidStringToken(this.pos-1-octalStr.length,inTemplate?"Octal literal in template string":"Octal literal in strict mode");}return String.fromCharCode(octal);}if(isNewLine$1(ch)){// Unicode new line characters after \ get removed from output in both
// template literals and strings
return"";}return String.fromCharCode(ch);}};// Used to read character escape sequences ('\x', '\u', '\U').
pp$9$1.readHexChar=function(len){var codePos=this.pos;var n=this.readInt(16,len);if(n===null){this.invalidStringToken(codePos,"Bad character escape sequence");}return n;};// Read an identifier, and return it as a string. Sets `this.containsEsc`
// to whether the word contained a '\u' escape.
//
// Incrementally adds only escaped chars, adding other chunks as-is
// as a micro-optimization.
pp$9$1.readWord1=function(){this.containsEsc=false;var word="",first=true,chunkStart=this.pos;var astral=this.options.ecmaVersion>=6;while(this.pos<this.input.length){var ch=this.fullCharCodeAtPos();if(isIdentifierChar$1(ch,astral)){this.pos+=ch<=0xffff?1:2;}else if(ch===92){// "\"
this.containsEsc=true;word+=this.input.slice(chunkStart,this.pos);var escStart=this.pos;if(this.input.charCodeAt(++this.pos)!==117)// "u"
{this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX");}++this.pos;var esc=this.readCodePoint();if(!(first?isIdentifierStart$1:isIdentifierChar$1)(esc,astral)){this.invalidStringToken(escStart,"Invalid Unicode escape");}word+=codePointToString$1$1(esc);chunkStart=this.pos;}else{break;}first=false;}return word+this.input.slice(chunkStart,this.pos);};// Read an identifier or keyword token. Will check for reserved
// words when necessary.
pp$9$1.readWord=function(){var word=this.readWord1();var type=types$2.name;if(this.keywords.test(word)){type=keywords$1$1[word];}return this.finishToken(type,word);};// Acorn is a tiny, fast JavaScript parser written in JavaScript.
var version$2="8.2.4";Parser$1.acorn={Parser:Parser$1,version:version$2,defaultOptions:defaultOptions$1,Position:Position$1,SourceLocation:SourceLocation$1,getLineInfo:getLineInfo$1,Node:Node$1,TokenType:TokenType$1,tokTypes:types$2,keywordTypes:keywords$1$1,TokContext:TokContext$1,tokContexts:types$1$1,isIdentifierChar:isIdentifierChar$1,isIdentifierStart:isIdentifierStart$1,Token:Token$1,isNewLine:isNewLine$1,lineBreak:lineBreak$1,lineBreakG:lineBreakG$1,nonASCIIwhitespace:nonASCIIwhitespace$1};var dummyValue="✖";function isDummy(node){return node.name===dummyValue;}function noop(){}var LooseParser=function LooseParser(input,options){if(options===void 0)options={};this.toks=this.constructor.BaseParser.tokenizer(input,options);this.options=this.toks.options;this.input=this.toks.input;this.tok=this.last={type:types$2.eof,start:0,end:0};this.tok.validateRegExpFlags=noop;this.tok.validateRegExpPattern=noop;if(this.options.locations){var here=this.toks.curPosition();this.tok.loc=new SourceLocation$1(this.toks,here,here);}this.ahead=[];// Tokens ahead
this.context=[];// Indentation contexted
this.curIndent=0;this.curLineStart=0;this.nextLineStart=this.lineEnd(this.curLineStart)+1;this.inAsync=false;this.inGenerator=false;this.inFunction=false;};LooseParser.prototype.startNode=function startNode(){return new Node$1(this.toks,this.tok.start,this.options.locations?this.tok.loc.start:null);};LooseParser.prototype.storeCurrentPos=function storeCurrentPos(){return this.options.locations?[this.tok.start,this.tok.loc.start]:this.tok.start;};LooseParser.prototype.startNodeAt=function startNodeAt(pos){if(this.options.locations){return new Node$1(this.toks,pos[0],pos[1]);}else{return new Node$1(this.toks,pos);}};LooseParser.prototype.finishNode=function finishNode(node,type){node.type=type;node.end=this.last.end;if(this.options.locations){node.loc.end=this.last.loc.end;}if(this.options.ranges){node.range[1]=this.last.end;}return node;};LooseParser.prototype.dummyNode=function dummyNode(type){var dummy=this.startNode();dummy.type=type;dummy.end=dummy.start;if(this.options.locations){dummy.loc.end=dummy.loc.start;}if(this.options.ranges){dummy.range[1]=dummy.start;}this.last={type:types$2.name,start:dummy.start,end:dummy.start,loc:dummy.loc};return dummy;};LooseParser.prototype.dummyIdent=function dummyIdent(){var dummy=this.dummyNode("Identifier");dummy.name=dummyValue;return dummy;};LooseParser.prototype.dummyString=function dummyString(){var dummy=this.dummyNode("Literal");dummy.value=dummy.raw=dummyValue;return dummy;};LooseParser.prototype.eat=function eat(type){if(this.tok.type===type){this.next();return true;}else{return false;}};LooseParser.prototype.isContextual=function isContextual(name){return this.tok.type===types$2.name&&this.tok.value===name;};LooseParser.prototype.eatContextual=function eatContextual(name){return this.tok.value===name&&this.eat(types$2.name);};LooseParser.prototype.canInsertSemicolon=function canInsertSemicolon(){return this.tok.type===types$2.eof||this.tok.type===types$2.braceR||lineBreak$1.test(this.input.slice(this.last.end,this.tok.start));};LooseParser.prototype.semicolon=function semicolon(){return this.eat(types$2.semi);};LooseParser.prototype.expect=function expect(type){if(this.eat(type)){return true;}for(var i=1;i<=2;i++){if(this.lookAhead(i).type===type){for(var j=0;j<i;j++){this.next();}return true;}}};LooseParser.prototype.pushCx=function pushCx(){this.context.push(this.curIndent);};LooseParser.prototype.popCx=function popCx(){this.curIndent=this.context.pop();};LooseParser.prototype.lineEnd=function lineEnd(pos){while(pos<this.input.length&&!isNewLine$1(this.input.charCodeAt(pos))){++pos;}return pos;};LooseParser.prototype.indentationAfter=function indentationAfter(pos){for(var count=0;;++pos){var ch=this.input.charCodeAt(pos);if(ch===32){++count;}else if(ch===9){count+=this.options.tabSize;}else{return count;}}};LooseParser.prototype.closes=function closes(closeTok,indent,line,blockHeuristic){if(this.tok.type===closeTok||this.tok.type===types$2.eof){return true;}return line!==this.curLineStart&&this.curIndent<indent&&this.tokenStartsLine()&&(!blockHeuristic||this.nextLineStart>=this.input.length||this.indentationAfter(this.nextLineStart)<indent);};LooseParser.prototype.tokenStartsLine=function tokenStartsLine(){for(var p=this.tok.start-1;p>=this.curLineStart;--p){var ch=this.input.charCodeAt(p);if(ch!==9&&ch!==32){return false;}}return true;};LooseParser.prototype.extend=function extend(name,f){this[name]=f(this[name]);};LooseParser.prototype.parse=function parse(){this.next();return this.parseTopLevel();};LooseParser.extend=function extend(){var plugins=[],len=arguments.length;while(len--){plugins[len]=arguments[len];}var cls=this;for(var i=0;i<plugins.length;i++){cls=plugins[i](cls);}return cls;};LooseParser.parse=function parse(input,options){return new this(input,options).parse();};// Allows plugins to extend the base parser / tokenizer used
LooseParser.BaseParser=Parser$1;var lp=LooseParser.prototype;function isSpace(ch){return ch<14&&ch>8||ch===32||ch===160||isNewLine$1(ch);}lp.next=function(){this.last=this.tok;if(this.ahead.length){this.tok=this.ahead.shift();}else{this.tok=this.readToken();}if(this.tok.start>=this.nextLineStart){while(this.tok.start>=this.nextLineStart){this.curLineStart=this.nextLineStart;this.nextLineStart=this.lineEnd(this.curLineStart)+1;}this.curIndent=this.indentationAfter(this.curLineStart);}};lp.readToken=function(){for(;;){try{this.toks.next();if(this.toks.type===types$2.dot&&this.input.substr(this.toks.end,1)==="."&&this.options.ecmaVersion>=6){this.toks.end++;this.toks.type=types$2.ellipsis;}return new Token$1(this.toks);}catch(e){if(!(e instanceof SyntaxError)){throw e;}// Try to skip some text, based on the error message, and then continue
var msg=e.message,pos=e.raisedAt,replace=true;if(/unterminated/i.test(msg)){pos=this.lineEnd(e.pos+1);if(/string/.test(msg)){replace={start:e.pos,end:pos,type:types$2.string,value:this.input.slice(e.pos+1,pos)};}else if(/regular expr/i.test(msg)){var re=this.input.slice(e.pos,pos);try{re=new RegExp(re);}catch(e){/* ignore compilation error due to new syntax */}replace={start:e.pos,end:pos,type:types$2.regexp,value:re};}else if(/template/.test(msg)){replace={start:e.pos,end:pos,type:types$2.template,value:this.input.slice(e.pos,pos)};}else{replace=false;}}else if(/invalid (unicode|regexp|number)|expecting unicode|octal literal|is reserved|directly after number|expected number in radix/i.test(msg)){while(pos<this.input.length&&!isSpace(this.input.charCodeAt(pos))){++pos;}}else if(/character escape|expected hexadecimal/i.test(msg)){while(pos<this.input.length){var ch=this.input.charCodeAt(pos++);if(ch===34||ch===39||isNewLine$1(ch)){break;}}}else if(/unexpected character/i.test(msg)){pos++;replace=false;}else if(/regular expression/i.test(msg)){replace=true;}else{throw e;}this.resetTo(pos);if(replace===true){replace={start:pos,end:pos,type:types$2.name,value:dummyValue};}if(replace){if(this.options.locations){replace.loc=new SourceLocation$1(this.toks,getLineInfo$1(this.input,replace.start),getLineInfo$1(this.input,replace.end));}return replace;}}}};lp.resetTo=function(pos){this.toks.pos=pos;var ch=this.input.charAt(pos-1);this.toks.exprAllowed=!ch||/[[{(,;:?/*=+\-~!|&%^<>]/.test(ch)||/[enwfd]/.test(ch)&&/\b(case|else|return|throw|new|in|(instance|type)?of|delete|void)$/.test(this.input.slice(pos-10,pos));if(this.options.locations){this.toks.curLine=1;this.toks.lineStart=lineBreakG$1.lastIndex=0;var match;while((match=lineBreakG$1.exec(this.input))&&match.index<pos){++this.toks.curLine;this.toks.lineStart=match.index+match[0].length;}}};lp.lookAhead=function(n){while(n>this.ahead.length){this.ahead.push(this.readToken());}return this.ahead[n-1];};var lp$1=LooseParser.prototype;lp$1.parseTopLevel=function(){var node=this.startNodeAt(this.options.locations?[0,getLineInfo$1(this.input,0)]:0);node.body=[];while(this.tok.type!==types$2.eof){node.body.push(this.parseStatement());}this.toks.adaptDirectivePrologue(node.body);this.last=this.tok;node.sourceType=this.options.sourceType;return this.finishNode(node,"Program");};lp$1.parseStatement=function(){var starttype=this.tok.type,node=this.startNode(),kind;if(this.toks.isLet()){starttype=types$2._var;kind="let";}switch(starttype){case types$2._break:case types$2._continue:this.next();var isBreak=starttype===types$2._break;if(this.semicolon()||this.canInsertSemicolon()){node.label=null;}else{node.label=this.tok.type===types$2.name?this.parseIdent():null;this.semicolon();}return this.finishNode(node,isBreak?"BreakStatement":"ContinueStatement");case types$2._debugger:this.next();this.semicolon();return this.finishNode(node,"DebuggerStatement");case types$2._do:this.next();node.body=this.parseStatement();node.test=this.eat(types$2._while)?this.parseParenExpression():this.dummyIdent();this.semicolon();return this.finishNode(node,"DoWhileStatement");case types$2._for:this.next();// `for` keyword
var isAwait=this.options.ecmaVersion>=9&&this.eatContextual("await");this.pushCx();this.expect(types$2.parenL);if(this.tok.type===types$2.semi){return this.parseFor(node,null);}var isLet=this.toks.isLet();if(isLet||this.tok.type===types$2._var||this.tok.type===types$2._const){var init$1=this.parseVar(this.startNode(),true,isLet?"let":this.tok.value);if(init$1.declarations.length===1&&(this.tok.type===types$2._in||this.isContextual("of"))){if(this.options.ecmaVersion>=9&&this.tok.type!==types$2._in){node["await"]=isAwait;}return this.parseForIn(node,init$1);}return this.parseFor(node,init$1);}var init=this.parseExpression(true);if(this.tok.type===types$2._in||this.isContextual("of")){if(this.options.ecmaVersion>=9&&this.tok.type!==types$2._in){node["await"]=isAwait;}return this.parseForIn(node,this.toAssignable(init));}return this.parseFor(node,init);case types$2._function:this.next();return this.parseFunction(node,true);case types$2._if:this.next();node.test=this.parseParenExpression();node.consequent=this.parseStatement();node.alternate=this.eat(types$2._else)?this.parseStatement():null;return this.finishNode(node,"IfStatement");case types$2._return:this.next();if(this.eat(types$2.semi)||this.canInsertSemicolon()){node.argument=null;}else{node.argument=this.parseExpression();this.semicolon();}return this.finishNode(node,"ReturnStatement");case types$2._switch:var blockIndent=this.curIndent,line=this.curLineStart;this.next();node.discriminant=this.parseParenExpression();node.cases=[];this.pushCx();this.expect(types$2.braceL);var cur;while(!this.closes(types$2.braceR,blockIndent,line,true)){if(this.tok.type===types$2._case||this.tok.type===types$2._default){var isCase=this.tok.type===types$2._case;if(cur){this.finishNode(cur,"SwitchCase");}node.cases.push(cur=this.startNode());cur.consequent=[];this.next();if(isCase){cur.test=this.parseExpression();}else{cur.test=null;}this.expect(types$2.colon);}else{if(!cur){node.cases.push(cur=this.startNode());cur.consequent=[];cur.test=null;}cur.consequent.push(this.parseStatement());}}if(cur){this.finishNode(cur,"SwitchCase");}this.popCx();this.eat(types$2.braceR);return this.finishNode(node,"SwitchStatement");case types$2._throw:this.next();node.argument=this.parseExpression();this.semicolon();return this.finishNode(node,"ThrowStatement");case types$2._try:this.next();node.block=this.parseBlock();node.handler=null;if(this.tok.type===types$2._catch){var clause=this.startNode();this.next();if(this.eat(types$2.parenL)){clause.param=this.toAssignable(this.parseExprAtom(),true);this.expect(types$2.parenR);}else{clause.param=null;}clause.body=this.parseBlock();node.handler=this.finishNode(clause,"CatchClause");}node.finalizer=this.eat(types$2._finally)?this.parseBlock():null;if(!node.handler&&!node.finalizer){return node.block;}return this.finishNode(node,"TryStatement");case types$2._var:case types$2._const:return this.parseVar(node,false,kind||this.tok.value);case types$2._while:this.next();node.test=this.parseParenExpression();node.body=this.parseStatement();return this.finishNode(node,"WhileStatement");case types$2._with:this.next();node.object=this.parseParenExpression();node.body=this.parseStatement();return this.finishNode(node,"WithStatement");case types$2.braceL:return this.parseBlock();case types$2.semi:this.next();return this.finishNode(node,"EmptyStatement");case types$2._class:return this.parseClass(true);case types$2._import:if(this.options.ecmaVersion>10){var nextType=this.lookAhead(1).type;if(nextType===types$2.parenL||nextType===types$2.dot){node.expression=this.parseExpression();this.semicolon();return this.finishNode(node,"ExpressionStatement");}}return this.parseImport();case types$2._export:return this.parseExport();default:if(this.toks.isAsyncFunction()){this.next();this.next();return this.parseFunction(node,true,true);}var expr=this.parseExpression();if(isDummy(expr)){this.next();if(this.tok.type===types$2.eof){return this.finishNode(node,"EmptyStatement");}return this.parseStatement();}else if(starttype===types$2.name&&expr.type==="Identifier"&&this.eat(types$2.colon)){node.body=this.parseStatement();node.label=expr;return this.finishNode(node,"LabeledStatement");}else{node.expression=expr;this.semicolon();return this.finishNode(node,"ExpressionStatement");}}};lp$1.parseBlock=function(){var node=this.startNode();this.pushCx();this.expect(types$2.braceL);var blockIndent=this.curIndent,line=this.curLineStart;node.body=[];while(!this.closes(types$2.braceR,blockIndent,line,true)){node.body.push(this.parseStatement());}this.popCx();this.eat(types$2.braceR);return this.finishNode(node,"BlockStatement");};lp$1.parseFor=function(node,init){node.init=init;node.test=node.update=null;if(this.eat(types$2.semi)&&this.tok.type!==types$2.semi){node.test=this.parseExpression();}if(this.eat(types$2.semi)&&this.tok.type!==types$2.parenR){node.update=this.parseExpression();}this.popCx();this.expect(types$2.parenR);node.body=this.parseStatement();return this.finishNode(node,"ForStatement");};lp$1.parseForIn=function(node,init){var type=this.tok.type===types$2._in?"ForInStatement":"ForOfStatement";this.next();node.left=init;node.right=this.parseExpression();this.popCx();this.expect(types$2.parenR);node.body=this.parseStatement();return this.finishNode(node,type);};lp$1.parseVar=function(node,noIn,kind){node.kind=kind;this.next();node.declarations=[];do{var decl=this.startNode();decl.id=this.options.ecmaVersion>=6?this.toAssignable(this.parseExprAtom(),true):this.parseIdent();decl.init=this.eat(types$2.eq)?this.parseMaybeAssign(noIn):null;node.declarations.push(this.finishNode(decl,"VariableDeclarator"));}while(this.eat(types$2.comma));if(!node.declarations.length){var decl$1=this.startNode();decl$1.id=this.dummyIdent();node.declarations.push(this.finishNode(decl$1,"VariableDeclarator"));}if(!noIn){this.semicolon();}return this.finishNode(node,"VariableDeclaration");};lp$1.parseClass=function(isStatement){var node=this.startNode();this.next();if(this.tok.type===types$2.name){node.id=this.parseIdent();}else if(isStatement===true){node.id=this.dummyIdent();}else{node.id=null;}node.superClass=this.eat(types$2._extends)?this.parseExpression():null;node.body=this.startNode();node.body.body=[];this.pushCx();var indent=this.curIndent+1,line=this.curLineStart;this.eat(types$2.braceL);if(this.curIndent+1<indent){indent=this.curIndent;line=this.curLineStart;}while(!this.closes(types$2.braceR,indent,line)){var element=this.parseClassElement();if(element){node.body.body.push(element);}}this.popCx();if(!this.eat(types$2.braceR)){// If there is no closing brace, make the node span to the start
// of the next token (this is useful for Tern)
this.last.end=this.tok.start;if(this.options.locations){this.last.loc.end=this.tok.loc.start;}}this.semicolon();this.finishNode(node.body,"ClassBody");return this.finishNode(node,isStatement?"ClassDeclaration":"ClassExpression");};lp$1.parseClassElement=function(){if(this.eat(types$2.semi)){return null;}var ref=this.options;var ecmaVersion=ref.ecmaVersion;var locations=ref.locations;var indent=this.curIndent;var line=this.curLineStart;var node=this.startNode();var keyName="";var isGenerator=false;var isAsync=false;var kind="method";// Parse modifiers
node["static"]=false;if(this.eatContextual("static")){if(this.isClassElementNameStart()||this.toks.type===types$2.star){node["static"]=true;}else{keyName="static";}}if(!keyName&&ecmaVersion>=8&&this.eatContextual("async")){if((this.isClassElementNameStart()||this.toks.type===types$2.star)&&!this.canInsertSemicolon()){isAsync=true;}else{keyName="async";}}if(!keyName){isGenerator=this.eat(types$2.star);var lastValue=this.toks.value;if(this.eatContextual("get")||this.eatContextual("set")){if(this.isClassElementNameStart()){kind=lastValue;}else{keyName=lastValue;}}}// Parse element name
if(keyName){// 'async', 'get', 'set', or 'static' were not a keyword contextually.
// The last token is any of those. Make it the element name.
node.computed=false;node.key=this.startNodeAt(locations?[this.toks.lastTokStart,this.toks.lastTokStartLoc]:this.toks.lastTokStart);node.key.name=keyName;this.finishNode(node.key,"Identifier");}else{this.parseClassElementName(node);// From https://github.com/acornjs/acorn/blob/7deba41118d6384a2c498c61176b3cf434f69590/acorn-loose/src/statement.js#L291
// Skip broken stuff.
if(isDummy(node.key)){if(isDummy(this.parseMaybeAssign())){this.next();}this.eat(types$2.comma);return null;}}// Parse element value
if(ecmaVersion<13||this.toks.type===types$2.parenL||kind!=="method"||isGenerator||isAsync){// Method
var isConstructor=!node.computed&&!node["static"]&&!isGenerator&&!isAsync&&kind==="method"&&(node.key.type==="Identifier"&&node.key.name==="constructor"||node.key.type==="Literal"&&node.key.value==="constructor");node.kind=isConstructor?"constructor":kind;node.value=this.parseMethod(isGenerator,isAsync);this.finishNode(node,"MethodDefinition");}else{// Field
if(this.eat(types$2.eq)){if(this.curLineStart!==line&&this.curIndent<=indent&&this.tokenStartsLine()){// Estimated the next line is the next class element by indentations.
node.value=null;}else{var oldInAsync=this.inAsync;var oldInGenerator=this.inGenerator;this.inAsync=false;this.inGenerator=false;node.value=this.parseMaybeAssign();this.inAsync=oldInAsync;this.inGenerator=oldInGenerator;}}else{node.value=null;}this.semicolon();this.finishNode(node,"PropertyDefinition");}return node;};lp$1.isClassElementNameStart=function(){return this.toks.isClassElementNameStart();};lp$1.parseClassElementName=function(element){if(this.toks.type===types$2.privateId){element.computed=false;element.key=this.parsePrivateIdent();}else{this.parsePropertyName(element);}};lp$1.parseFunction=function(node,isStatement,isAsync){var oldInAsync=this.inAsync,oldInGenerator=this.inGenerator,oldInFunction=this.inFunction;this.initFunction(node);if(this.options.ecmaVersion>=6){node.generator=this.eat(types$2.star);}if(this.options.ecmaVersion>=8){node.async=!!isAsync;}if(this.tok.type===types$2.name){node.id=this.parseIdent();}else if(isStatement===true){node.id=this.dummyIdent();}this.inAsync=node.async;this.inGenerator=node.generator;this.inFunction=true;node.params=this.parseFunctionParams();node.body=this.parseBlock();this.toks.adaptDirectivePrologue(node.body.body);this.inAsync=oldInAsync;this.inGenerator=oldInGenerator;this.inFunction=oldInFunction;return this.finishNode(node,isStatement?"FunctionDeclaration":"FunctionExpression");};lp$1.parseExport=function(){var node=this.startNode();this.next();if(this.eat(types$2.star)){if(this.options.ecmaVersion>=11){if(this.eatContextual("as")){node.exported=this.parseExprAtom();}else{node.exported=null;}}node.source=this.eatContextual("from")?this.parseExprAtom():this.dummyString();return this.finishNode(node,"ExportAllDeclaration");}if(this.eat(types$2._default)){// export default (function foo() {}) // This is FunctionExpression.
var isAsync;if(this.tok.type===types$2._function||(isAsync=this.toks.isAsyncFunction())){var fNode=this.startNode();this.next();if(isAsync){this.next();}node.declaration=this.parseFunction(fNode,"nullableID",isAsync);}else if(this.tok.type===types$2._class){node.declaration=this.parseClass("nullableID");}else{node.declaration=this.parseMaybeAssign();this.semicolon();}return this.finishNode(node,"ExportDefaultDeclaration");}if(this.tok.type.keyword||this.toks.isLet()||this.toks.isAsyncFunction()){node.declaration=this.parseStatement();node.specifiers=[];node.source=null;}else{node.declaration=null;node.specifiers=this.parseExportSpecifierList();node.source=this.eatContextual("from")?this.parseExprAtom():null;this.semicolon();}return this.finishNode(node,"ExportNamedDeclaration");};lp$1.parseImport=function(){var node=this.startNode();this.next();if(this.tok.type===types$2.string){node.specifiers=[];node.source=this.parseExprAtom();}else{var elt;if(this.tok.type===types$2.name&&this.tok.value!=="from"){elt=this.startNode();elt.local=this.parseIdent();this.finishNode(elt,"ImportDefaultSpecifier");this.eat(types$2.comma);}node.specifiers=this.parseImportSpecifiers();node.source=this.eatContextual("from")&&this.tok.type===types$2.string?this.parseExprAtom():this.dummyString();if(elt){node.specifiers.unshift(elt);}}this.semicolon();return this.finishNode(node,"ImportDeclaration");};lp$1.parseImportSpecifiers=function(){var elts=[];if(this.tok.type===types$2.star){var elt=this.startNode();this.next();elt.local=this.eatContextual("as")?this.parseIdent():this.dummyIdent();elts.push(this.finishNode(elt,"ImportNamespaceSpecifier"));}else{var indent=this.curIndent,line=this.curLineStart,continuedLine=this.nextLineStart;this.pushCx();this.eat(types$2.braceL);if(this.curLineStart>continuedLine){continuedLine=this.curLineStart;}while(!this.closes(types$2.braceR,indent+(this.curLineStart<=continuedLine?1:0),line)){var elt$1=this.startNode();if(this.eat(types$2.star)){elt$1.local=this.eatContextual("as")?this.parseIdent():this.dummyIdent();this.finishNode(elt$1,"ImportNamespaceSpecifier");}else{if(this.isContextual("from")){break;}elt$1.imported=this.parseIdent();if(isDummy(elt$1.imported)){break;}elt$1.local=this.eatContextual("as")?this.parseIdent():elt$1.imported;this.finishNode(elt$1,"ImportSpecifier");}elts.push(elt$1);this.eat(types$2.comma);}this.eat(types$2.braceR);this.popCx();}return elts;};lp$1.parseExportSpecifierList=function(){var elts=[];var indent=this.curIndent,line=this.curLineStart,continuedLine=this.nextLineStart;this.pushCx();this.eat(types$2.braceL);if(this.curLineStart>continuedLine){continuedLine=this.curLineStart;}while(!this.closes(types$2.braceR,indent+(this.curLineStart<=continuedLine?1:0),line)){if(this.isContextual("from")){break;}var elt=this.startNode();elt.local=this.parseIdent();if(isDummy(elt.local)){break;}elt.exported=this.eatContextual("as")?this.parseIdent():elt.local;this.finishNode(elt,"ExportSpecifier");elts.push(elt);this.eat(types$2.comma);}this.eat(types$2.braceR);this.popCx();return elts;};var lp$2=LooseParser.prototype;lp$2.checkLVal=function(expr){if(!expr){return expr;}switch(expr.type){case"Identifier":case"MemberExpression":return expr;case"ParenthesizedExpression":expr.expression=this.checkLVal(expr.expression);return expr;default:return this.dummyIdent();}};lp$2.parseExpression=function(noIn){var start=this.storeCurrentPos();var expr=this.parseMaybeAssign(noIn);if(this.tok.type===types$2.comma){var node=this.startNodeAt(start);node.expressions=[expr];while(this.eat(types$2.comma)){node.expressions.push(this.parseMaybeAssign(noIn));}return this.finishNode(node,"SequenceExpression");}return expr;};lp$2.parseParenExpression=function(){this.pushCx();this.expect(types$2.parenL);var val=this.parseExpression();this.popCx();this.expect(types$2.parenR);return val;};lp$2.parseMaybeAssign=function(noIn){// `yield` should be an identifier reference if it's not in generator functions.
if(this.inGenerator&&this.toks.isContextual("yield")){var node=this.startNode();this.next();if(this.semicolon()||this.canInsertSemicolon()||this.tok.type!==types$2.star&&!this.tok.type.startsExpr){node.delegate=false;node.argument=null;}else{node.delegate=this.eat(types$2.star);node.argument=this.parseMaybeAssign();}return this.finishNode(node,"YieldExpression");}var start=this.storeCurrentPos();var left=this.parseMaybeConditional(noIn);if(this.tok.type.isAssign){var node$1=this.startNodeAt(start);node$1.operator=this.tok.value;node$1.left=this.tok.type===types$2.eq?this.toAssignable(left):this.checkLVal(left);this.next();node$1.right=this.parseMaybeAssign(noIn);return this.finishNode(node$1,"AssignmentExpression");}return left;};lp$2.parseMaybeConditional=function(noIn){var start=this.storeCurrentPos();var expr=this.parseExprOps(noIn);if(this.eat(types$2.question)){var node=this.startNodeAt(start);node.test=expr;node.consequent=this.parseMaybeAssign();node.alternate=this.expect(types$2.colon)?this.parseMaybeAssign(noIn):this.dummyIdent();return this.finishNode(node,"ConditionalExpression");}return expr;};lp$2.parseExprOps=function(noIn){var start=this.storeCurrentPos();var indent=this.curIndent,line=this.curLineStart;return this.parseExprOp(this.parseMaybeUnary(false),start,-1,noIn,indent,line);};lp$2.parseExprOp=function(left,start,minPrec,noIn,indent,line){if(this.curLineStart!==line&&this.curIndent<indent&&this.tokenStartsLine()){return left;}var prec=this.tok.type.binop;if(prec!=null&&(!noIn||this.tok.type!==types$2._in)){if(prec>minPrec){var node=this.startNodeAt(start);node.left=left;node.operator=this.tok.value;this.next();if(this.curLineStart!==line&&this.curIndent<indent&&this.tokenStartsLine()){node.right=this.dummyIdent();}else{var rightStart=this.storeCurrentPos();node.right=this.parseExprOp(this.parseMaybeUnary(false),rightStart,prec,noIn,indent,line);}this.finishNode(node,/&&|\|\||\?\?/.test(node.operator)?"LogicalExpression":"BinaryExpression");return this.parseExprOp(node,start,minPrec,noIn,indent,line);}}return left;};lp$2.parseMaybeUnary=function(sawUnary){var start=this.storeCurrentPos(),expr;if(this.options.ecmaVersion>=8&&this.toks.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)){expr=this.parseAwait();sawUnary=true;}else if(this.tok.type.prefix){var node=this.startNode(),update=this.tok.type===types$2.incDec;if(!update){sawUnary=true;}node.operator=this.tok.value;node.prefix=true;this.next();node.argument=this.parseMaybeUnary(true);if(update){node.argument=this.checkLVal(node.argument);}expr=this.finishNode(node,update?"UpdateExpression":"UnaryExpression");}else if(this.tok.type===types$2.ellipsis){var node$1=this.startNode();this.next();node$1.argument=this.parseMaybeUnary(sawUnary);expr=this.finishNode(node$1,"SpreadElement");}else{expr=this.parseExprSubscripts();while(this.tok.type.postfix&&!this.canInsertSemicolon()){var node$2=this.startNodeAt(start);node$2.operator=this.tok.value;node$2.prefix=false;node$2.argument=this.checkLVal(expr);this.next();expr=this.finishNode(node$2,"UpdateExpression");}}if(!sawUnary&&this.eat(types$2.starstar)){var node$3=this.startNodeAt(start);node$3.operator="**";node$3.left=expr;node$3.right=this.parseMaybeUnary(false);return this.finishNode(node$3,"BinaryExpression");}return expr;};lp$2.parseExprSubscripts=function(){var start=this.storeCurrentPos();return this.parseSubscripts(this.parseExprAtom(),start,false,this.curIndent,this.curLineStart);};lp$2.parseSubscripts=function(base,start,noCalls,startIndent,line){var optionalSupported=this.options.ecmaVersion>=11;var optionalChained=false;for(;;){if(this.curLineStart!==line&&this.curIndent<=startIndent&&this.tokenStartsLine()){if(this.tok.type===types$2.dot&&this.curIndent===startIndent){--startIndent;}else{break;}}var maybeAsyncArrow=base.type==="Identifier"&&base.name==="async"&&!this.canInsertSemicolon();var optional=optionalSupported&&this.eat(types$2.questionDot);if(optional){optionalChained=true;}if(optional&&this.tok.type!==types$2.parenL&&this.tok.type!==types$2.bracketL&&this.tok.type!==types$2.backQuote||this.eat(types$2.dot)){var node=this.startNodeAt(start);node.object=base;if(this.curLineStart!==line&&this.curIndent<=startIndent&&this.tokenStartsLine()){node.property=this.dummyIdent();}else{node.property=this.parsePropertyAccessor()||this.dummyIdent();}node.computed=false;if(optionalSupported){node.optional=optional;}base=this.finishNode(node,"MemberExpression");}else if(this.tok.type===types$2.bracketL){this.pushCx();this.next();var node$1=this.startNodeAt(start);node$1.object=base;node$1.property=this.parseExpression();node$1.computed=true;if(optionalSupported){node$1.optional=optional;}this.popCx();this.expect(types$2.bracketR);base=this.finishNode(node$1,"MemberExpression");}else if(!noCalls&&this.tok.type===types$2.parenL){var exprList=this.parseExprList(types$2.parenR);if(maybeAsyncArrow&&this.eat(types$2.arrow)){return this.parseArrowExpression(this.startNodeAt(start),exprList,true);}var node$2=this.startNodeAt(start);node$2.callee=base;node$2.arguments=exprList;if(optionalSupported){node$2.optional=optional;}base=this.finishNode(node$2,"CallExpression");}else if(this.tok.type===types$2.backQuote){var node$3=this.startNodeAt(start);node$3.tag=base;node$3.quasi=this.parseTemplate();base=this.finishNode(node$3,"TaggedTemplateExpression");}else{break;}}if(optionalChained){var chainNode=this.startNodeAt(start);chainNode.expression=base;base=this.finishNode(chainNode,"ChainExpression");}return base;};lp$2.parseExprAtom=function(){var node;switch(this.tok.type){case types$2._this:case types$2._super:var type=this.tok.type===types$2._this?"ThisExpression":"Super";node=this.startNode();this.next();return this.finishNode(node,type);case types$2.name:var start=this.storeCurrentPos();var id=this.parseIdent();var isAsync=false;if(id.name==="async"&&!this.canInsertSemicolon()){if(this.eat(types$2._function)){return this.parseFunction(this.startNodeAt(start),false,true);}if(this.tok.type===types$2.name){id=this.parseIdent();isAsync=true;}}return this.eat(types$2.arrow)?this.parseArrowExpression(this.startNodeAt(start),[id],isAsync):id;case types$2.regexp:node=this.startNode();var val=this.tok.value;node.regex={pattern:val.pattern,flags:val.flags};node.value=val.value;node.raw=this.input.slice(this.tok.start,this.tok.end);this.next();return this.finishNode(node,"Literal");case types$2.num:case types$2.string:node=this.startNode();node.value=this.tok.value;node.raw=this.input.slice(this.tok.start,this.tok.end);if(this.tok.type===types$2.num&&node.raw.charCodeAt(node.raw.length-1)===110){node.bigint=node.raw.slice(0,-1).replace(/_/g,"");}this.next();return this.finishNode(node,"Literal");case types$2._null:case types$2._true:case types$2._false:node=this.startNode();node.value=this.tok.type===types$2._null?null:this.tok.type===types$2._true;node.raw=this.tok.type.keyword;this.next();return this.finishNode(node,"Literal");case types$2.parenL:var parenStart=this.storeCurrentPos();this.next();var inner=this.parseExpression();this.expect(types$2.parenR);if(this.eat(types$2.arrow)){// (a,)=>a // SequenceExpression makes dummy in the last hole. Drop the dummy.
var params=inner.expressions||[inner];if(params.length&&isDummy(params[params.length-1])){params.pop();}return this.parseArrowExpression(this.startNodeAt(parenStart),params);}if(this.options.preserveParens){var par=this.startNodeAt(parenStart);par.expression=inner;inner=this.finishNode(par,"ParenthesizedExpression");}return inner;case types$2.bracketL:node=this.startNode();node.elements=this.parseExprList(types$2.bracketR,true);return this.finishNode(node,"ArrayExpression");case types$2.braceL:return this.parseObj();case types$2._class:return this.parseClass(false);case types$2._function:node=this.startNode();this.next();return this.parseFunction(node,false);case types$2._new:return this.parseNew();case types$2.backQuote:return this.parseTemplate();case types$2._import:if(this.options.ecmaVersion>=11){return this.parseExprImport();}else{return this.dummyIdent();}default:return this.dummyIdent();}};lp$2.parseExprImport=function(){var node=this.startNode();var meta=this.parseIdent(true);switch(this.tok.type){case types$2.parenL:return this.parseDynamicImport(node);case types$2.dot:node.meta=meta;return this.parseImportMeta(node);default:node.name="import";return this.finishNode(node,"Identifier");}};lp$2.parseDynamicImport=function(node){node.source=this.parseExprList(types$2.parenR)[0]||this.dummyString();return this.finishNode(node,"ImportExpression");};lp$2.parseImportMeta=function(node){this.next();// skip '.'
node.property=this.parseIdent(true);return this.finishNode(node,"MetaProperty");};lp$2.parseNew=function(){var node=this.startNode(),startIndent=this.curIndent,line=this.curLineStart;var meta=this.parseIdent(true);if(this.options.ecmaVersion>=6&&this.eat(types$2.dot)){node.meta=meta;node.property=this.parseIdent(true);return this.finishNode(node,"MetaProperty");}var start=this.storeCurrentPos();node.callee=this.parseSubscripts(this.parseExprAtom(),start,true,startIndent,line);if(this.tok.type===types$2.parenL){node.arguments=this.parseExprList(types$2.parenR);}else{node.arguments=[];}return this.finishNode(node,"NewExpression");};lp$2.parseTemplateElement=function(){var elem=this.startNode();// The loose parser accepts invalid unicode escapes even in untagged templates.
if(this.tok.type===types$2.invalidTemplate){elem.value={raw:this.tok.value,cooked:null};}else{elem.value={raw:this.input.slice(this.tok.start,this.tok.end).replace(/\r\n?/g,"\n"),cooked:this.tok.value};}this.next();elem.tail=this.tok.type===types$2.backQuote;return this.finishNode(elem,"TemplateElement");};lp$2.parseTemplate=function(){var node=this.startNode();this.next();node.expressions=[];var curElt=this.parseTemplateElement();node.quasis=[curElt];while(!curElt.tail){this.next();node.expressions.push(this.parseExpression());if(this.expect(types$2.braceR)){curElt=this.parseTemplateElement();}else{curElt=this.startNode();curElt.value={cooked:"",raw:""};curElt.tail=true;this.finishNode(curElt,"TemplateElement");}node.quasis.push(curElt);}this.expect(types$2.backQuote);return this.finishNode(node,"TemplateLiteral");};lp$2.parseObj=function(){var node=this.startNode();node.properties=[];this.pushCx();var indent=this.curIndent+1,line=this.curLineStart;this.eat(types$2.braceL);if(this.curIndent+1<indent){indent=this.curIndent;line=this.curLineStart;}while(!this.closes(types$2.braceR,indent,line)){var prop=this.startNode(),isGenerator=void 0,isAsync=void 0,start=void 0;if(this.options.ecmaVersion>=9&&this.eat(types$2.ellipsis)){prop.argument=this.parseMaybeAssign();node.properties.push(this.finishNode(prop,"SpreadElement"));this.eat(types$2.comma);continue;}if(this.options.ecmaVersion>=6){start=this.storeCurrentPos();prop.method=false;prop.shorthand=false;isGenerator=this.eat(types$2.star);}this.parsePropertyName(prop);if(this.toks.isAsyncProp(prop)){isAsync=true;isGenerator=this.options.ecmaVersion>=9&&this.eat(types$2.star);this.parsePropertyName(prop);}else{isAsync=false;}if(isDummy(prop.key)){if(isDummy(this.parseMaybeAssign())){this.next();}this.eat(types$2.comma);continue;}if(this.eat(types$2.colon)){prop.kind="init";prop.value=this.parseMaybeAssign();}else if(this.options.ecmaVersion>=6&&(this.tok.type===types$2.parenL||this.tok.type===types$2.braceL)){prop.kind="init";prop.method=true;prop.value=this.parseMethod(isGenerator,isAsync);}else if(this.options.ecmaVersion>=5&&prop.key.type==="Identifier"&&!prop.computed&&(prop.key.name==="get"||prop.key.name==="set")&&this.tok.type!==types$2.comma&&this.tok.type!==types$2.braceR&&this.tok.type!==types$2.eq){prop.kind=prop.key.name;this.parsePropertyName(prop);prop.value=this.parseMethod(false);}else{prop.kind="init";if(this.options.ecmaVersion>=6){if(this.eat(types$2.eq)){var assign=this.startNodeAt(start);assign.operator="=";assign.left=prop.key;assign.right=this.parseMaybeAssign();prop.value=this.finishNode(assign,"AssignmentExpression");}else{prop.value=prop.key;}}else{prop.value=this.dummyIdent();}prop.shorthand=true;}node.properties.push(this.finishNode(prop,"Property"));this.eat(types$2.comma);}this.popCx();if(!this.eat(types$2.braceR)){// If there is no closing brace, make the node span to the start
// of the next token (this is useful for Tern)
this.last.end=this.tok.start;if(this.options.locations){this.last.loc.end=this.tok.loc.start;}}return this.finishNode(node,"ObjectExpression");};lp$2.parsePropertyName=function(prop){if(this.options.ecmaVersion>=6){if(this.eat(types$2.bracketL)){prop.computed=true;prop.key=this.parseExpression();this.expect(types$2.bracketR);return;}else{prop.computed=false;}}var key=this.tok.type===types$2.num||this.tok.type===types$2.string?this.parseExprAtom():this.parseIdent();prop.key=key||this.dummyIdent();};lp$2.parsePropertyAccessor=function(){if(this.tok.type===types$2.name||this.tok.type.keyword){return this.parseIdent();}if(this.tok.type===types$2.privateId){return this.parsePrivateIdent();}};lp$2.parseIdent=function(){var name=this.tok.type===types$2.name?this.tok.value:this.tok.type.keyword;if(!name){return this.dummyIdent();}var node=this.startNode();this.next();node.name=name;return this.finishNode(node,"Identifier");};lp$2.parsePrivateIdent=function(){var node=this.startNode();node.name=this.tok.value;this.next();return this.finishNode(node,"PrivateIdentifier");};lp$2.initFunction=function(node){node.id=null;node.params=[];if(this.options.ecmaVersion>=6){node.generator=false;node.expression=false;}if(this.options.ecmaVersion>=8){node.async=false;}};// Convert existing expression atom to assignable pattern
// if possible.
lp$2.toAssignable=function(node,binding){if(!node||node.type==="Identifier"||node.type==="MemberExpression"&&!binding);else if(node.type==="ParenthesizedExpression"){this.toAssignable(node.expression,binding);}else if(this.options.ecmaVersion<6){return this.dummyIdent();}else if(node.type==="ObjectExpression"){node.type="ObjectPattern";for(var i=0,list=node.properties;i<list.length;i+=1){var prop=list[i];this.toAssignable(prop,binding);}}else if(node.type==="ArrayExpression"){node.type="ArrayPattern";this.toAssignableList(node.elements,binding);}else if(node.type==="Property"){this.toAssignable(node.value,binding);}else if(node.type==="SpreadElement"){node.type="RestElement";this.toAssignable(node.argument,binding);}else if(node.type==="AssignmentExpression"){node.type="AssignmentPattern";delete node.operator;}else{return this.dummyIdent();}return node;};lp$2.toAssignableList=function(exprList,binding){for(var i=0,list=exprList;i<list.length;i+=1){var expr=list[i];this.toAssignable(expr,binding);}return exprList;};lp$2.parseFunctionParams=function(params){params=this.parseExprList(types$2.parenR);return this.toAssignableList(params,true);};lp$2.parseMethod=function(isGenerator,isAsync){var node=this.startNode(),oldInAsync=this.inAsync,oldInGenerator=this.inGenerator,oldInFunction=this.inFunction;this.initFunction(node);if(this.options.ecmaVersion>=6){node.generator=!!isGenerator;}if(this.options.ecmaVersion>=8){node.async=!!isAsync;}this.inAsync=node.async;this.inGenerator=node.generator;this.inFunction=true;node.params=this.parseFunctionParams();node.body=this.parseBlock();this.toks.adaptDirectivePrologue(node.body.body);this.inAsync=oldInAsync;this.inGenerator=oldInGenerator;this.inFunction=oldInFunction;return this.finishNode(node,"FunctionExpression");};lp$2.parseArrowExpression=function(node,params,isAsync){var oldInAsync=this.inAsync,oldInGenerator=this.inGenerator,oldInFunction=this.inFunction;this.initFunction(node);if(this.options.ecmaVersion>=8){node.async=!!isAsync;}this.inAsync=node.async;this.inGenerator=false;this.inFunction=true;node.params=this.toAssignableList(params,true);node.expression=this.tok.type!==types$2.braceL;if(node.expression){node.body=this.parseMaybeAssign();}else{node.body=this.parseBlock();this.toks.adaptDirectivePrologue(node.body.body);}this.inAsync=oldInAsync;this.inGenerator=oldInGenerator;this.inFunction=oldInFunction;return this.finishNode(node,"ArrowFunctionExpression");};lp$2.parseExprList=function(close,allowEmpty){this.pushCx();var indent=this.curIndent,line=this.curLineStart,elts=[];this.next();// Opening bracket
while(!this.closes(close,indent+1,line)){if(this.eat(types$2.comma)){elts.push(allowEmpty?null:this.dummyIdent());continue;}var elt=this.parseMaybeAssign();if(isDummy(elt)){if(this.closes(close,indent,line)){break;}this.next();}else{elts.push(elt);}this.eat(types$2.comma);}this.popCx();if(!this.eat(close)){// If there is no closing brace, make the node span to the start
// of the next token (this is useful for Tern)
this.last.end=this.tok.start;if(this.options.locations){this.last.loc.end=this.tok.loc.start;}}return elts;};lp$2.parseAwait=function(){var node=this.startNode();this.next();node.argument=this.parseMaybeUnary();return this.finishNode(node,"AwaitExpression");};// Acorn: Loose parser
defaultOptions$1.tabSize=4;function parse$1(input,options){return LooseParser.parse(input,options);}/* global acorn,global,self */ // // rk 2016-05-17 FIXME: the current version of acorn.walk doesn't support async
// // await. We patch the walker here until it does
// if (!walk.base.AwaitExpression) {
//   walk.base.AwaitExpression = function (node, st, c) {
//     if (node.argument)
//         c(node.argument, st, 'Expression');
//   }
// }
var custom={};custom.forEachNode=forEachNode;custom.matchNodes=matchNodes;custom.findNodesIncluding=findNodesIncluding;custom.withParentInfo=withParentInfo;custom.copy=copy;custom.findSiblings=findSiblings;custom.findNodeByAstIndex=findNodeByAstIndex;custom.findStatementOfNode=findStatementOfNode;custom.addAstIndex=addAstIndex;// -=-=-=-=-=-=-=-=-=-=-=-
// from lively.ast.acorn
// -=-=-=-=-=-=-=-=-=-=-=-
function forEachNode(parsed,func,state,options){// note: func can get called with the same node for different
// visitor callbacks!
// func args: node, state, depth, type
options=options||{};var traversal=options.traversal||'preorder';// also: postorder
var visitors=clone$1(options.visitors?options.visitors:make(custom.visitors.withMemberExpression));var iterator=traversal==='preorder'?function(orig,type,node,depth,cont){func(node,state,depth,type);return orig(node,depth+1,cont);}:function(orig,type,node,depth,cont){var result=orig(node,depth+1,cont);func(node,state,depth,type);return result;};Object.keys(visitors).forEach(function(type){var orig=visitors[type];visitors[type]=function(node,depth,cont){return iterator(orig,type,node,depth,cont);};});recursive(parsed,0,null,visitors);return parsed;}function matchNodes(parsed,visitor,state,options){function visit(node,state,depth,type){if(visitor[node.type])visitor[node.type](node,state,depth,type);}return forEachNode(parsed,visit,state,options);}// findNodesIncluding: function(ast, pos, test, base) {
//   var nodes = [];
//   base = base || acorn.walk.make({});
//   Object.keys(base).forEach(function(name) {
//       var orig = base[name];
//       base[name] = function(node, state, cont) {
//           nodes.pushIfNotIncluded(node);
//           return orig(node, state, cont);
//       }
//   });
//   acorn.walk.findNodeAround(ast, pos, test, base);
//   return nodes;
// }
function findNodesIncluding(parsed,pos,test,base$1){var nodes=[];base$1=base$1||make(custom.withMemberExpression);Object.keys(base).forEach(function(name){var orig=base$1[name];base$1[name]=function(node,state,cont){pushIfNotIncluded(nodes,node);return orig(node,state,cont);};});base$1.Property=function(node,st,c){pushIfNotIncluded(nodes,node);c(node.key,st,'Expression');c(node.value,st,'Expression');};base$1.LabeledStatement=function(node,st,c){node.label&&c(node.label,st,'Expression');c(node.body,st,'Statement');};findNodeAround(parsed,pos,test,base$1);return nodes;}function withParentInfo(parsed,iterator,options){// options = {visitAllNodes: BOOL}
options=options||{};function makeScope(parentScope){var scope={id:newUUID(),parentScope:parentScope,containingScopes:[]};parentScope&&parentScope.containingScopes.push(scope);return scope;}var visitors=make({Function:function Function(node,st,c){if(st&&st.scope)st.scope=makeScope(st.scope);c(node.body,st,'ScopeBody');},VariableDeclarator:function VariableDeclarator(node,st,c){// node.id && c(node.id, st, 'Identifier');
node.init&&c(node.init,st,'Expression');},VariableDeclaration:function VariableDeclaration(node,st,c){for(var _i71=0;_i71<node.declarations.length;++_i71){var decl=node.declarations[_i71];if(decl)c(decl,st,'VariableDeclarator');}},ObjectExpression:function ObjectExpression(node,st,c){for(var _i72=0;_i72<node.properties.length;++_i72){var _prop2=node.properties[_i72];c(_prop2.key,st,'Expression');c(_prop2.value,st,'Expression');}},MemberExpression:function MemberExpression(node,st,c){c(node.object,st,'Expression');c(node.property,st,'Expression');}},base);var lastActiveProp;var getters=[];forEachNode(parsed,function(node){withoutAll(Object.keys(node),['end','start','type','source','raw']).forEach(function(propName){if(node.__lookupGetter__(propName))return;// already defined
var val=node[propName];node.__defineGetter__(propName,function(){lastActiveProp=propName;return val;});getters.push([node,propName,node[propName]]);});},null,{visitors:visitors});var result=[];Object.keys(visitors).forEach(function(type){var orig=visitors[type];visitors[type]=function(node,state,cont){if(type===node.type||options.visitAllNodes){result.push(iterator.call(null,node,{scope:state.scope,depth:state.depth,parent:state.parent,type:type,propertyInParent:lastActiveProp}));return orig(node,{scope:state.scope,parent:node,depth:state.depth+1},cont);}else{return orig(node,state,cont);}};});recursive(parsed,{scope:makeScope(),parent:null,propertyInParent:'',depth:0},null,visitors);getters.forEach(function(nodeNameVal){delete nodeNameVal[0][nodeNameVal[1]];nodeNameVal[0][nodeNameVal[1]]=nodeNameVal[2];});return result;}function copy(ast,override){var visitors=extend({Program:function Program(n,c){return{start:n.start,end:n.end,type:'Program',body:n.body.map(c),source:n.source,astIndex:n.astIndex};},FunctionDeclaration:function FunctionDeclaration(n,c){return{start:n.start,end:n.end,type:'FunctionDeclaration',id:c(n.id),params:n.params.map(c),body:c(n.body),source:n.source,astIndex:n.astIndex};},BlockStatement:function BlockStatement(n,c){return{start:n.start,end:n.end,type:'BlockStatement',body:n.body.map(c),source:n.source,astIndex:n.astIndex};},ExpressionStatement:function ExpressionStatement(n,c){return{start:n.start,end:n.end,type:'ExpressionStatement',expression:c(n.expression),source:n.source,astIndex:n.astIndex};},CallExpression:function CallExpression(n,c){return{start:n.start,end:n.end,type:'CallExpression',callee:c(n.callee),arguments:n.arguments.map(c),source:n.source,astIndex:n.astIndex};},MemberExpression:function MemberExpression(n,c){return{start:n.start,end:n.end,type:'MemberExpression',object:c(n.object),property:c(n.property),computed:n.computed,source:n.source,astIndex:n.astIndex};},NewExpression:function NewExpression(n,c){return{start:n.start,end:n.end,type:'NewExpression',callee:c(n.callee),arguments:n.arguments.map(c),source:n.source,astIndex:n.astIndex};},VariableDeclaration:function VariableDeclaration(n,c){return{start:n.start,end:n.end,type:'VariableDeclaration',declarations:n.declarations.map(c),kind:n.kind,source:n.source,astIndex:n.astIndex};},VariableDeclarator:function VariableDeclarator(n,c){return{start:n.start,end:n.end,type:'VariableDeclarator',id:c(n.id),init:c(n.init),source:n.source,astIndex:n.astIndex};},FunctionExpression:function FunctionExpression(n,c){return{start:n.start,end:n.end,type:'FunctionExpression',id:c(n.id),params:n.params.map(c),body:c(n.body),source:n.source,astIndex:n.astIndex};},IfStatement:function IfStatement(n,c){return{start:n.start,end:n.end,type:'IfStatement',test:c(n.test),consequent:c(n.consequent),alternate:c(n.alternate),source:n.source,astIndex:n.astIndex};},ConditionalExpression:function ConditionalExpression(n,c){return{start:n.start,end:n.end,type:'ConditionalExpression',test:c(n.test),consequent:c(n.consequent),alternate:c(n.alternate),source:n.source,astIndex:n.astIndex};},SwitchStatement:function SwitchStatement(n,c){return{start:n.start,end:n.end,type:'SwitchStatement',discriminant:c(n.discriminant),cases:n.cases.map(c),source:n.source,astIndex:n.astIndex};},SwitchCase:function SwitchCase(n,c){return{start:n.start,end:n.end,type:'SwitchCase',test:c(n.test),consequent:n.consequent.map(c),source:n.source,astIndex:n.astIndex};},BreakStatement:function BreakStatement(n,c){return{start:n.start,end:n.end,type:'BreakStatement',label:n.label,source:n.source,astIndex:n.astIndex};},ContinueStatement:function ContinueStatement(n,c){return{start:n.start,end:n.end,type:'ContinueStatement',label:n.label,source:n.source,astIndex:n.astIndex};},TryStatement:function TryStatement(n,c){return{start:n.start,end:n.end,type:'TryStatement',block:c(n.block),handler:c(n.handler),finalizer:c(n.finalizer),guardedHandlers:n.guardedHandlers.map(c),source:n.source,astIndex:n.astIndex};},CatchClause:function CatchClause(n,c){return{start:n.start,end:n.end,type:'CatchClause',param:c(n.param),guard:c(n.guard),body:c(n.body),source:n.source,astIndex:n.astIndex};},ThrowStatement:function ThrowStatement(n,c){return{start:n.start,end:n.end,type:'ThrowStatement',argument:c(n.argument),source:n.source,astIndex:n.astIndex};},ForStatement:function ForStatement(n,c){return{start:n.start,end:n.end,type:'ForStatement',init:c(n.init),test:c(n.test),update:c(n.update),body:c(n.body),source:n.source,astIndex:n.astIndex};},ForInStatement:function ForInStatement(n,c){return{start:n.start,end:n.end,type:'ForInStatement',left:c(n.left),right:c(n.right),body:c(n.body),source:n.source,astIndex:n.astIndex};},WhileStatement:function WhileStatement(n,c){return{start:n.start,end:n.end,type:'WhileStatement',test:c(n.test),body:c(n.body),source:n.source,astIndex:n.astIndex};},DoWhileStatement:function DoWhileStatement(n,c){return{start:n.start,end:n.end,type:'DoWhileStatement',test:c(n.test),body:c(n.body),source:n.source,astIndex:n.astIndex};},WithStatement:function WithStatement(n,c){return{start:n.start,end:n.end,type:'WithStatement',object:c(n.object),body:c(n.body),source:n.source,astIndex:n.astIndex};},UnaryExpression:function UnaryExpression(n,c){return{start:n.start,end:n.end,type:'UnaryExpression',argument:c(n.argument),operator:n.operator,prefix:n.prefix,source:n.source,astIndex:n.astIndex};},BinaryExpression:function BinaryExpression(n,c){return{start:n.start,end:n.end,type:'BinaryExpression',left:c(n.left),operator:n.operator,right:c(n.right),source:n.source,astIndex:n.astIndex};},LogicalExpression:function LogicalExpression(n,c){return{start:n.start,end:n.end,type:'LogicalExpression',left:c(n.left),operator:n.operator,right:c(n.right),source:n.source,astIndex:n.astIndex};},AssignmentExpression:function AssignmentExpression(n,c){return{start:n.start,end:n.end,type:'AssignmentExpression',left:c(n.left),operator:n.operator,right:c(n.right),source:n.source,astIndex:n.astIndex};},UpdateExpression:function UpdateExpression(n,c){return{start:n.start,end:n.end,type:'UpdateExpression',argument:c(n.argument),operator:n.operator,prefix:n.prefix,source:n.source,astIndex:n.astIndex};},ReturnStatement:function ReturnStatement(n,c){return{start:n.start,end:n.end,type:'ReturnStatement',argument:c(n.argument),source:n.source,astIndex:n.astIndex};},Identifier:function Identifier(n,c){return{start:n.start,end:n.end,type:'Identifier',name:n.name,source:n.source,astIndex:n.astIndex};},Literal:function Literal(n,c){return{start:n.start,end:n.end,type:'Literal',value:n.value,raw:n.raw/* Acorn-specific */,source:n.source,astIndex:n.astIndex};},ObjectExpression:function ObjectExpression(n,c){return{start:n.start,end:n.end,type:'ObjectExpression',properties:n.properties.map(function(prop){return{key:c(prop.key),value:c(prop.value),kind:prop.kind};}),source:n.source,astIndex:n.astIndex};},ArrayExpression:function ArrayExpression(n,c){return{start:n.start,end:n.end,type:'ArrayExpression',elements:n.elements.map(c),source:n.source,astIndex:n.astIndex};},SequenceExpression:function SequenceExpression(n,c){return{start:n.start,end:n.end,type:'SequenceExpression',expressions:n.expressions.map(c),source:n.source,astIndex:n.astIndex};},EmptyStatement:function EmptyStatement(n,c){return{start:n.start,end:n.end,type:'EmptyStatement',source:n.source,astIndex:n.astIndex};},ThisExpression:function ThisExpression(n,c){return{start:n.start,end:n.end,type:'ThisExpression',source:n.source,astIndex:n.astIndex};},DebuggerStatement:function DebuggerStatement(n,c){return{start:n.start,end:n.end,type:'DebuggerStatement',source:n.source,astIndex:n.astIndex};},LabeledStatement:function LabeledStatement(n,c){return{start:n.start,end:n.end,type:'LabeledStatement',label:n.label,body:c(n.body),source:n.source,astIndex:n.astIndex};}},override||{});function c(node){if(node===null)return null;return visitors[node.type](node,c);}return c(ast);}function findSiblings(parsed,node,beforeOrAfter){if(!node)return[];var nodes=findNodesIncluding(parsed,node.start);var idx=nodes.indexOf(node);var parents=nodes.slice(0,idx);var parentWithBody=detect(parents.reverse(),function(p){return Array.isArray(p.body);});var siblingsWithNode=parentWithBody.body;if(!beforeOrAfter)return without(siblingsWithNode,node);var nodeIdxInSiblings=siblingsWithNode.indexOf(node);return beforeOrAfter==='before'?siblingsWithNode.slice(0,nodeIdxInSiblings):siblingsWithNode.slice(nodeIdxInSiblings+1);}// // cached visitors that are used often
custom.visitors={stopAtFunctions:make(_objectSpread({Function:function Function(){/* stop descent */}},base)),withMemberExpression:make({MemberExpression:function MemberExpression(node,st,c){c(node.object,st,'Expression');c(node.property,st,'Expression');}},base)};// -=-=-=-=-=-=-=-=-=-=-=-=-=-
// from lively.ast.AstHelper
// -=-=-=-=-=-=-=-=-=-=-=-=-=-
function findNodeByAstIndex(parsed,astIndexToFind,addIndex){addIndex=addIndex==null?true:!!addIndex;if(!parsed.astIndex&&addIndex)addAstIndex(parsed);// we need to visit every node, forEachNode is highly
// inefficient, the compilled Mozilla visitors are a better fit
var found=null;withMozillaAstDo(parsed,null,function(next,node,state){if(found)return;var idx=node.astIndex;if(idx<astIndexToFind)return;if(node.astIndex===astIndexToFind){found=node;return;}next();});return found;}// FIXME: global (and temporary) findNodeByAstIndex is used by __getClosure and defined in Rewriting.js
// Global.findNodeByAstIndex = findNodeByAstIndex;
function findStatementOfNode(options,parsed,target){// DEPRECATED in favor of query.statementOf(parsed, node)
// Can also be called with just ast and target. options can be {asPath: BOOLEAN}.
// Find the statement that a target node is in. Example:
// let source be "var x = 1; x + 1;" and we are looking for the
// Identifier "x" in "x+1;". The second statement is what will be found.
if(!target){target=parsed;parsed=options;options=null;}if(!options)options={};if(!parsed.astIndex)addAstIndex(parsed);var found;var targetReached=false;var statements=[// ES5
'EmptyStatement','BlockStatement','ExpressionStatement','IfStatement','LabeledStatement','BreakStatement','ContinueStatement','WithStatement','SwitchStatement','ReturnStatement','ThrowStatement','TryStatement','WhileStatement','DoWhileStatement','ForStatement','ForInStatement','DebuggerStatement','FunctionDeclaration','VariableDeclaration',// ES2015:
'ClassDeclaration'];withMozillaAstDo(parsed,{},function(next,node,state,path){if(targetReached||node.astIndex<target.astIndex)return;if(node===target||node.astIndex===target.astIndex){targetReached=true;if(options.asPath){found=path;}else{var _p2=Path(path);do{found=_p2.get(parsed);_p2=_p2.slice(0,_p2.size()-1);}while(statements.indexOf(found.type)==-1&&_p2.size()>0);}}!targetReached&&next();});return found;}function addAstIndex(parsed){// we need to visit every node, forEachNode is highly
// inefficient, the compilled Mozilla visitors are a better fit
withMozillaAstDo(parsed,{index:0},function(next,node,state){next();node.astIndex=state.index++;});return parsed;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// simple ast traversing
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var AllNodesVisitor=/*#__PURE__*/function(_Visitor4){_inherits(AllNodesVisitor,_Visitor4);var _super4=_createSuper(AllNodesVisitor);function AllNodesVisitor(){_classCallCheck(this,AllNodesVisitor);return _super4.apply(this,arguments);}_createClass(AllNodesVisitor,[{key:"accept",value:function accept(node,state,path){this.doFunc(node,state,path);return _get2(_getPrototypeOf(AllNodesVisitor.prototype),"accept",this).call(this,node,state,path);}}],[{key:"run",value:function run(parsed,doFunc,state){var v=new this();v.doFunc=doFunc;v.accept(parsed,state,[]);return state;}}]);return AllNodesVisitor;}(Visitor);// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// scoping
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var FindToplevelFuncDeclVisitor=/*#__PURE__*/function(_Visitor5){_inherits(FindToplevelFuncDeclVisitor,_Visitor5);var _super5=_createSuper(FindToplevelFuncDeclVisitor);function FindToplevelFuncDeclVisitor(){_classCallCheck(this,FindToplevelFuncDeclVisitor);return _super5.apply(this,arguments);}_createClass(FindToplevelFuncDeclVisitor,[{key:"accept",value:function accept(node,funcDecls,path){switch(node.type){case'ArrowFunctionExpression':return node;case'FunctionExpression':return node;case'FunctionDeclaration':funcDecls.unshift({node:node,path:path});return node;default:return _get2(_getPrototypeOf(FindToplevelFuncDeclVisitor.prototype),"accept",this).call(this,node,funcDecls,path);}}}],[{key:"run",value:function run(parsed){var state=[];new this().accept(parsed,state,[]);return state;}}]);return FindToplevelFuncDeclVisitor;}(Visitor);// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// replacement
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var canBeInlinedSym=Symbol('canBeInlined');function blockInliner(node){// FIXME what about () => x kind of functions?
if(Array.isArray(node.body)){for(var _i73=node.body.length-1;_i73>=0;_i73--){var stmt=node.body[_i73];if(stmt.type==='BlockStatement'&&stmt[canBeInlinedSym]){node.body.splice.apply(node.body,[_i73,1].concat(stmt.body));}}}return node;}function block(nodes){return{type:'BlockStatement',body:nodes};}var ReplaceManyVisitor=/*#__PURE__*/function(_Visitor6){_inherits(ReplaceManyVisitor,_Visitor6);var _super6=_createSuper(ReplaceManyVisitor);function ReplaceManyVisitor(){_classCallCheck(this,ReplaceManyVisitor);return _super6.apply(this,arguments);}_createClass(ReplaceManyVisitor,[{key:"accept",value:function accept(node,state,path){// return this.replacer(super.accept(node, state, path));
var replaced=this.replacer(_get2(_getPrototypeOf(ReplaceManyVisitor.prototype),"accept",this).call(this,node,state,path));return!Array.isArray(replaced)?replaced:replaced.length===1?replaced[0]:Object.assign(block(replaced),_defineProperty({},canBeInlinedSym,true));}},{key:"visitBlockStatement",value:function visitBlockStatement(node,state,path){return blockInliner(_get2(_getPrototypeOf(ReplaceManyVisitor.prototype),"visitBlockStatement",this).call(this,node,state,path));}},{key:"visitProgram",value:function visitProgram(node,state,path){return blockInliner(_get2(_getPrototypeOf(ReplaceManyVisitor.prototype),"visitProgram",this).call(this,node,state,path));}}],[{key:"run",value:function run(parsed,replacer){var v=new this();v.replacer=replacer;return v.accept(parsed,null,[]);}}]);return ReplaceManyVisitor;}(Visitor);var ReplaceVisitor=/*#__PURE__*/function(_Visitor7){_inherits(ReplaceVisitor,_Visitor7);var _super7=_createSuper(ReplaceVisitor);function ReplaceVisitor(){_classCallCheck(this,ReplaceVisitor);return _super7.apply(this,arguments);}_createClass(ReplaceVisitor,[{key:"accept",value:function accept(node,state,path){return this.replacer(_get2(_getPrototypeOf(ReplaceVisitor.prototype),"accept",this).call(this,node,state,path),path);}}],[{key:"run",value:function run(parsed,replacer){var v=new this();v.replacer=replacer;return v.accept(parsed,null,[]);}}]);return ReplaceVisitor;}(Visitor);custom.addSource=addSource;function addSource(parsed,source){if(typeof parsed==='string'){source=parsed;parsed=parse$2(parsed);}source&&AllNodesVisitor.run(parsed,function(node,state,path){return!node.source&&(node.source=source.slice(node.start,node.end));});return parsed;}function nodesAt(pos,ast){ast=typeof ast==='string'?this.parse(ast):ast;return findNodesIncluding(ast,pos);}function fuzzyParse(source,options){// options: verbose, addSource, type
options=options||{};options.ecmaVersion=options.ecmaVersion||11;options.sourceType=options.sourceType||'module';options.plugins=options.plugins||{};// if (options.plugins.hasOwnProperty("jsx")) options.plugins.jsx = options.plugins.jsx;
options.plugins.jsx=options.plugins.hasOwnProperty('jsx')?options.plugins.jsx:true;options.plugins.asyncawait=options.plugins.hasOwnProperty('asyncawait')?options.plugins.asyncawait:{inAsyncFunction:true};options.plugins.objectSpread=options.plugins.hasOwnProperty('objectSpread')?options.plugins.objectSpread:true;var ast,safeSource,err;if(options.type==='LabeledStatement'){safeSource='$={'+source+'}';}try{// we only parse to find errors
ast=parse$2(safeSource||source,options);if(safeSource)ast=null;// we parsed only for finding errors
else if(options.addSource)addSource(ast,source);}catch(e){err=e;}if(err&&err.raisedAt!==undefined){if(safeSource){// fix error pos
err.pos-=3;err.raisedAt-=3;err.loc.column-=3;}var parseErrorSource='';parseErrorSource+=source.slice(err.raisedAt-20,err.raisedAt);parseErrorSource+='<-error->';parseErrorSource+=source.slice(err.raisedAt,err.raisedAt+20);options.verbose&&console.log('parse error: '+parseErrorSource);err.parseErrorSource=parseErrorSource;}else if(err&&options.verbose){console.log(''+err+err.stack);}if(!ast){ast=parse$1(source,options);if(options.addSource)addSource(ast,source);ast.isFuzzy=true;ast.parseError=err;}return ast;}function parse$2(source,options){// proxy function to acorn.parse.
// Note that we will implement useful functionality on top of the pure
// acorn interface and make it available here (such as more convenient
// comment parsing). For using the pure acorn interface use the acorn
// global.
// See https://github.com/marijnh/acorn for full acorn doc and parse options.
// options: {
//   addSource: BOOL, -- add source property to each node
//   addAstIndex: BOOL, -- each node gets an index  number
//   withComments: BOOL, -- adds comment objects to Program/BlockStatements:
//              {isBlock: BOOL, text: STRING, node: NODE,
//               start: INTEGER, end: INTEGER, line: INTEGER, column: INTEGER}
//   ecmaVersion: 3|5|6,
//   allowReturnOutsideFunction: BOOL, -- Default is false
//   locations: BOOL -- Default is false
// }
options=options||{};options.ecmaVersion=options.ecmaVersion||11;options.allowAwaitOutsideFunction=true;options.sourceType=options.sourceType||'module';if(!options.hasOwnProperty('allowImportExportEverywhere')){options.allowImportExportEverywhere=true;}options.plugins=options.plugins||{};options.plugins.jsx=options.plugins.hasOwnProperty('jsx')?options.plugins.jsx:true;options.plugins.asyncawait=options.plugins.hasOwnProperty('asyncawait')?options.plugins.asyncawait:{inAsyncFunction:true};options.plugins.objectSpread=options.plugins.hasOwnProperty('objectSpread')?options.plugins.objectSpread:true;if(options.withComments){// record comments
delete options.withComments;var comments=[];options.onComment=function(isBlock,text,start,end,line,column){comments.push({isBlock:isBlock,text:text,node:null,start:start,end:end,line:line,column:column});};}try{var parsed=parse(source,options);}catch(err){if(typeof SyntaxError!=='undefined'&&err instanceof SyntaxError&&err.loc){var _lines2=source.split('\n');var message=err.message,_err$loc=err.loc,row=_err$loc.line,column=_err$loc.column,pos=err.pos;var line=_lines2[row-1];var newMessage="Syntax error at line ".concat(row," column ").concat(column," (index ").concat(pos,") \"").concat(message,"\"\nsource: ").concat(line.slice(0,column),"<--SyntaxError-->").concat(line.slice(column));var betterErr=new SyntaxError(newMessage);betterErr.loc={line:row,column:column};betterErr.pos=pos;throw betterErr;}else throw err;}if(options.addSource)addSource(parsed,source);if(options.addAstIndex&&!parsed.hasOwnProperty('astIndex'))addAstIndex(parsed);if(parsed&&comments)attachCommentsToAST({ast:parsed,comments:comments,nodesWithComments:[]});return parsed;// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function attachCommentsToAST(commentData){// for each comment: assign the comment to a block-level AST node
commentData=mergeComments(assignCommentsToBlockNodes(commentData));parsed.allComments=commentData.comments;}function assignCommentsToBlockNodes(commentData){comments.forEach(function(comment){var node=detect(nodesAt(comment.start,parsed).reverse(),function(node){return node.type==='BlockStatement'||node.type==='Program';});if(!node)node=parsed;if(!node.comments)node.comments=[];node.comments.push(comment);commentData.nodesWithComments.push(node);});return commentData;}function mergeComments(commentData){// coalesce non-block comments (multiple following lines of "// ...") into one comment.
// This only happens if line comments aren't seperated by newlines
commentData.nodesWithComments.forEach(function(blockNode){clone(blockNode.comments).reduce(function(coalesceData,comment){if(comment.isBlock){coalesceData.lastComment=null;return coalesceData;}if(!coalesceData.lastComment){coalesceData.lastComment=comment;return coalesceData;}// if the comments are seperated by a statement, don't merge
var last=coalesceData.lastComment;var nodeInbetween=detect(blockNode.body,function(node){return node.start>=last.end&&node.end<=comment.start;});if(nodeInbetween){coalesceData.lastComment=comment;return coalesceData;}// if the comments are seperated by a newline, don't merge
var codeInBetween=source.slice(last.end,comment.start);if(/[\n\r][\n\r]+/.test(codeInBetween)){coalesceData.lastComment=comment;return coalesceData;}// merge comments into one
last.text+='\n'+comment.text;last.end=comment.end;_remove4(blockNode.comments,comment);_remove4(commentData.comments,comment);return coalesceData;},{lastComment:null});});return commentData;}}/* global process, global, exports */var methods={withMozillaAstDo:function withMozillaAstDo(parsed,state,func){// simple interface to mozilla AST visitor. function gets passed three
// arguments:
// acceptNext, -- continue visiting
// node, -- current node being visited
// state -- state variable that is passed along
var vis=new Visitor();var origAccept=vis.accept;vis.accept=function(node,st,path){var next=function next(){origAccept.call(vis,node,st,path);};state=func(next,node,st,path);return node;};vis.accept(parsed,state,[]);return state;},printAst:function printAst(astOrSource,options){options=options||{};var printSource=options.printSource||false;var printPositions=options.printPositions||false;var printIndex=options.printIndex||false;var source;var parsed;var tree=[];if(typeof astOrSource==='string'){source=astOrSource;parsed=parse$2(astOrSource);}else{parsed=astOrSource;source=options.source||parsed.source;}if(printSource&&!parsed.source){// ensure that nodes have source attached
if(!source){source=stringify(parsed);parsed=parse$2(source);}addSource(parsed,source);}function printFunc(ea){var line=ea.path+':'+ea.node.type;var additional=[];if(printIndex){additional.push(ea.index);}if(printPositions){additional.push(ea.node.start+'-'+ea.node.end);}if(printSource){var src=ea.node.source||source.slice(ea.node.start,ea.node.end);var printed=print$1(src.truncate(60).replace(/\n/g,'').replace(/\s+/g,' '));additional.push(printed);}if(additional.length){line+='('+additional.join(',')+')';}return line;}new PrinterVisitor().accept(parsed,{index:0,tree:tree},[]);return printTree(tree[0],printFunc,function(ea){return ea.children;},'  ');},compareAst:function compareAst(node1,node2){if(!node1||!node2)throw new Error('node'+(node1?'1':'2')+' not defined');var state={completePath:[],comparisons:{errors:[]}};new ComparisonVisitor().accept(node1,node2,state,[]);return!state.comparisons.errors.length?null:state.comparisons.errors.pluck('msg');},pathToNode:function pathToNode(parsed,index,options){if(!parsed.astIndex)addAstIndex(parsed);var vis=new Visitor();var found=null;(vis.accept=function(node,pathToHere,state,path){if(found)return;var fullPath=pathToHere.concat(path);if(node.astIndex===index){var pathString=fullPath.map(function(ea){return typeof ea==='string'?'.'+ea:'['+ea+']';}).join('');found={pathString:pathString,path:fullPath,node:node};}return this['visit'+node.type](node,fullPath,state,path);}).call(vis,parsed,[],{},[]);return found;},rematchAstWithSource:function rematchAstWithSource(parsed,source,addLocations,subTreePath){addLocations=!!addLocations;var parsed2=parse$2(source,addLocations?{locations:true}:undefined);var visitor=new Visitor();if(subTreePath)parsed2=Path(subTreePath).get(parsed2);visitor.accept=function(node,state,path){path=path||[];var node2=path.reduce(function(node,pathElem){return node[pathElem];},parsed);node2.start=node.start;node2.end=node.end;if(addLocations)node2.loc=node.loc;return this['visit'+node.type](node,state,path);};visitor.accept(parsed2);}};// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var withMozillaAstDo=methods.withMozillaAstDo;// obj.extend(ast, methods);
// FIXME! Don't extend acorn object!
// obj.extend(ast.acorn, methods);
var identifierRe=/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/;function isIdentifier(string){// Note: It's not so easy...
// http://wiki.ecmascript.org/doku.php?id=strawman:identifier_identification
// https://mathiasbynens.be/notes/javascript-identifiers-es6
return identifierRe.test(string)&&string.indexOf('-')===-1;}function id(name){return name==='this'?{type:'ThisExpression'}:{name:String(name),type:'Identifier'};}function literal$2(value){return{type:'Literal',value:value};}function exprStmt(expression){return{type:'ExpressionStatement',expression:expression};}function returnStmt(expr){return{type:'ReturnStatement',argument:expr};}function empty$3(){return{type:'EmptyStatement'};}function binaryExpr(left,op,right){return{left:left,right:right,operator:op,type:'BinaryExpression'};}function funcExpr(_ref){var arrow=_ref.arrow,funcId=_ref.id,expression=_ref.expression,generator=_ref.generator;var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];// lively.ast.stringify(funcExpr({id: "foo"}, ["a"], exprStmt(id("3"))))
// // => "function foo(a) { 3; }"
params=params.map(function(ea){return typeof ea==='string'?id(ea):ea;});for(var _len2=arguments.length,statements=new Array(_len2>2?_len2-2:0),_key6=2;_key6<_len2;_key6++){statements[_key6-2]=arguments[_key6];}return{type:(arrow?'Arrow':'')+'FunctionExpression',id:funcId?typeof funcId==='string'?id(funcId):funcId:undefined,params:params,body:expression&&statements.length===1?statements[0]:{body:statements,type:'BlockStatement'},expression:expression||false,generator:generator||false};}function funcCall(callee){if(typeof callee==='string')callee=id(callee);for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key7=1;_key7<_len3;_key7++){args[_key7-1]=arguments[_key7];}return{type:'CallExpression',callee:callee,arguments:args};}function varDecl(id,init,kind){if(typeof id==='string')id={name:id,type:'Identifier'};return{type:'VariableDeclaration',kind:kind||'var',declarations:[{type:'VariableDeclarator',id:id,init:init}]};}function member(obj,prop,computed){// Example:
// lively.ast.stringify(member("foo", "bar"))
// // => "foo.bar"
// lively.ast.stringify(member("foo", "b-a-r"))
// // => "foo['b-a-r']"
// lively.ast.stringify(member("foo", "zork", true))
// // => "foo['zork']"
// lively.ast.stringify(member("foo", 0))
// // => "foo[0]"
if(typeof obj==='string')obj=id(obj);if(typeof prop==='string'){if(!computed&&!isIdentifier(prop))computed=true;prop=computed?literal$2(prop):id(prop);}else if(typeof prop==='number'){prop=literal$2(prop);computed=true;}else if(prop.type==='Literal'){computed=true;}return{type:'MemberExpression',computed:!!computed,object:obj,property:prop};}function memberChain(first){for(var _len4=arguments.length,rest=new Array(_len4>1?_len4-1:0),_key8=1;_key8<_len4;_key8++){rest[_key8-1]=arguments[_key8];}// lively.ast.stringify(memberChain("foo", "bar", 0, "baz-zork"));
// // => "foo.bar[0]['baz-zork']"
return rest.reduce(function(memberExpr,key){return member(memberExpr,key);},_typeof2(first)==='object'?first:id(first));}function assign(left,right){// lively.ast.stringify(assign("a", "x"))
// // => "a = x"
// lively.ast.stringify(assign(member("a", "x"), literal(23)))
// // => "a.x = 23"
return{type:'AssignmentExpression',operator:'=',right:right?typeof right==='string'?id(right):right:id('undefined'),left:typeof left==='string'?id(left):left};}function block$1(){for(var _len5=arguments.length,body=new Array(_len5),_key9=0;_key9<_len5;_key9++){body[_key9]=arguments[_key9];}return{body:Array.isArray(body[0])?body[0]:body,type:'BlockStatement'};}function program(){return Object.assign(block$1.apply(void 0,arguments),{sourceType:'module',type:'Program'});}function tryStmt(exName,handlerBody,finalizerBody){for(var _len6=arguments.length,body=new Array(_len6>3?_len6-3:0),_key10=3;_key10<_len6;_key10++){body[_key10-3]=arguments[_key10];}// Example:
// var stmt = exprStmt(binaryExpr(literal(3), "+", literal(2)));
// lively.ast.stringify(tryStmt("err", [stmt], [stmt], stmt, stmt))
// // => "try { 3 + 2; 3 + 2; } catch (err) { 3 + 2; } finally { 3 + 2; }"
if(!Array.isArray(finalizerBody)){body.unshift(finalizerBody);finalizerBody=null;}return{block:block$1(body),finalizer:finalizerBody?block$1(finalizerBody):null,handler:{body:block$1(handlerBody),param:id(exName),type:'CatchClause'},type:'TryStatement'};}function prop(key,value){return{type:'Property',key:key,computed:key.type!=='Identifier',shorthand:false,value:value};}function objectLiteral(keysAndValues){var props=[];for(var _i74=0;_i74<keysAndValues.length;_i74+=2){var key=keysAndValues[_i74];if(typeof key==='string')key=id(key);props.push(prop(key,keysAndValues[_i74+1]));}return{properties:props,type:'ObjectExpression'};}function ifStmt(test){var consequent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:block$1();var alternate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:block$1();return{consequent:consequent,alternate:alternate,test:test,type:'IfStatement'};}function forIn(varDeclOrName,objExprOrName,body){return{type:'ForInStatement',left:typeof varDeclOrName==='string'?varDecl(varDeclOrName):varDeclOrName,right:typeof objExprOrName==='string'?id(objExprOrName):objExprOrName,body:body};}function conditional(test){var consequent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:id('undefined');var alternate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:id('undefined');return{consequent:consequent,alternate:alternate,test:test,type:'ConditionalExpression'};}function logical(op,left,right){return{operator:op,left:left,right:right,type:'LogicalExpression'};}var nodes=/*#__PURE__*/Object.freeze({__proto__:null,isIdentifier:isIdentifier,id:id,literal:literal$2,objectLiteral:objectLiteral,prop:prop,exprStmt:exprStmt,returnStmt:returnStmt,empty:empty$3,binaryExpr:binaryExpr,funcExpr:funcExpr,funcCall:funcCall,varDecl:varDecl,member:member,memberChain:memberChain,assign:assign,block:block$1,program:program,tryStmt:tryStmt,ifStmt:ifStmt,forIn:forIn,conditional:conditional,logical:logical});// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var helpers={declIds:function declIds(nodes){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];for(var _i75=0;_i75<nodes.length;_i75++){var node=nodes[_i75];if(!node)continue;else if(node.type==='Identifier')result.push(node);else if(node.type==='RestElement')result.push(node.argument);// AssignmentPattern: default arg like function(local = defaultVal) {}
else if(node.type==='AssignmentPattern')helpers.declIds([node.left],result);else if(node.type==='ObjectPattern'){for(var j=0;j<node.properties.length;j++){var _prop3=node.properties[j];helpers.declIds([_prop3.value||_prop3],result);}}else if(node.type==='ArrayPattern'){helpers.declIds(node.elements,result);}}return result;},varDecls:function varDecls(scope){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var _iterator7=_createForOfIteratorHelper(scope.varDecls),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var _varDecl=_step7.value;var _iterator8=_createForOfIteratorHelper(_varDecl.declarations),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var decl=_step8.value;var _iterator9=_createForOfIteratorHelper(helpers.declIds([decl.id])),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var _id=_step9.value;result.push([decl,_id]);}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}return result;},varDeclIds:function varDeclIds(scope){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var _iterator10=_createForOfIteratorHelper(scope.varDecls),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var _varDecl2=_step10.value;var _iterator11=_createForOfIteratorHelper(_varDecl2.declarations),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var decl=_step11.value;helpers.declIds([decl.id],result);}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}return result;},objPropertiesAsList:function objPropertiesAsList(objExpr,path,onlyLeafs){var result=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];// takes an obj expr like {x: 23, y: [{z: 4}]} an returns the key and value
// nodes as a list
var _iterator12=_createForOfIteratorHelper(objExpr.properties),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var _prop4=_step12.value;var key=_prop4.key.name;var thisNode={key:path.concat([key]),value:_prop4.value};switch(_prop4.value.type){case'ArrayExpression':case'ArrayPattern':if(!onlyLeafs)result.push(thisNode);for(var _i76=0;_i76<_prop4.value.elements.length;_i76++){var el=_prop4.value.elements[_i76];helpers.objPropertiesAsList(el,path.concat([key,_i76]),onlyLeafs,result);}break;case'ObjectExpression':case'ObjectPattern':if(!onlyLeafs)result.push(thisNode);helpers.objPropertiesAsList(_prop4.value,path.concat([key]),onlyLeafs,result);break;case'AssignmentPattern':if(!onlyLeafs)result.push(thisNode);helpers.objPropertiesAsList(_prop4.left,path.concat([key]),onlyLeafs,result);break;default:result.push(thisNode);}}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}return result;},isDeclaration:function isDeclaration(node){return node.type==='FunctionDeclaration'||node.type==='VariableDeclaration'||node.type==='ClassDeclaration';}};// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var knownGlobals=['closed','true','false','null','undefined','arguments','Object','Function','Array','Number','parseFloat','parseInt','Infinity','NaN','Boolean','String','Symbol','Date','Promise','RegExp','Error','EvalError','RangeError','ReferenceError','SyntaxError','TypeError','URIError','JSON','Math','console','ArrayBuffer','Uint8Array','Int8Array','Uint16Array','Int16Array','Uint32Array','Int32Array','Float32Array','Float64Array','Uint8ClampedArray','DataView','Map','Set','WeakMap','WeakSet','Proxy','Reflect','decodeURI','decodeURIComponent','encodeURI','encodeURIComponent','escape','unescape','eval','isFinite','isNaN','Intl','navigator','window','document','Blob','setTimeout','clearTimeout','setInterval','clearInterval','requestAnimationFrame','cancelAnimationFrame','btoa','atob','sessionStorage','localStorage','$world','lively','System','customElements','performance','addEventListener','closed'];function scopes(parsed){var vis=new ScopeVisitor();var scope=vis.newScope(parsed,null);vis.accept(parsed,scope,[]);return scope;}function nodesAtIndex(parsed,index){return withMozillaAstDo(parsed,[],function(next,node,found){if(node.start<=index&&index<=node.end){found.push(node);next();}return found;});}function scopesAtIndex(parsed,index){return filter$1(scopes(parsed),function(scope){var n=scope.node;var start=n.start;var end=n.end;if(n.type==='FunctionDeclaration'){start=n.params.length?n.params[0].start:n.body.start;end=n.body.end;}return start<=index&&index<=end;},function(s){return s.subScopes;});}function scopeAtIndex(parsed,index){return last(scopesAtIndex(parsed,index));}function scopesAtPos(pos,parsed){// DEPRECATED
// FIXME "scopes" should actually not referer to a node but to a scope
// object, see exports.scopes!
return filter(nodesAt$1(pos,parsed),function(node){return node.type==='Program'||node.type==='FunctionDeclaration'||node.type==='FunctionExpression';});}function nodesInScopeOf(node){// DEPRECATED
// FIXME "scopes" should actually not referer to a node but to a scope
// object, see exports.scopes!
return withMozillaAstDo(node,{root:node,result:[]},function(next,node,state){state.result.push(node);if(node!==state.root&&(node.type==='Program'||node.type==='FunctionDeclaration'||node.type==='FunctionExpression'))return state;next();return state;}).result;}function declarationsOfScope(scope,includeOuter){var result=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];// returns Identifier nodes
if(includeOuter&&scope.node.id&&scope.node.id.name){result.push(scope.node.id);}helpers.declIds(scope.params,result);for(var i=0;i<scope.funcDecls.length;i++){var id=scope.funcDecls[i].id;if(id)result.push(id);}helpers.varDeclIds(scope,result);result.push.apply(result,_toConsumableArray2(scope.catches));for(var i=0;i<scope.classDecls.length;i++){var id=scope.classDecls[i].id;if(id)result.push(id);}result.push.apply(result,_toConsumableArray2(scope.importSpecifiers));return compact(result);}function declarationsWithIdsOfScope(scope){// returns a list of pairs [(DeclarationNode,IdentifierNode)]
var bareIds=compact(helpers.declIds(scope.params).concat(scope.catches));var declNodes=[].concat(_toConsumableArray2(scope.node.id&&scope.node.id.name?[scope.node]:[]),_toConsumableArray2(filter(scope.funcDecls,function(ea){return ea.id;})),_toConsumableArray2(filter(scope.classDecls,function(ea){return ea.id;})));return bareIds.map(function(ea){return[ea,ea];}).concat(declNodes.map(function(ea){return[ea,ea.id];})).concat(helpers.varDecls(scope)).concat(scope.importSpecifiers.map(function(im){return[statementOf(scope.node,im),im];}));}function _declaredVarNames(scope,useComments){var result=[];var _iterator13=_createForOfIteratorHelper(declarationsOfScope(scope,true)),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var decl=_step13.value;result.push(decl.name);}}catch(err){_iterator13.e(err);}finally{_iterator13.f();}if(useComments){_findJsLintGlobalDeclarations(scope.node.type==='Program'?scope.node:scope.node.body,result);}return result;}var globalDeclRe=/^\s*global\s*/;function _findJsLintGlobalDeclarations(node){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(!node||!node.comments)return result;var _iterator14=_createForOfIteratorHelper(node.comments),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var comment=_step14.value;var text=comment.text.trim();if(!text.startsWith('global'))continue;var _iterator15=_createForOfIteratorHelper(text.replace(globalDeclRe,'').split(',')),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var globalDecl=_step15.value;result.push(globalDecl.trim());}}catch(err){_iterator15.e(err);}finally{_iterator15.f();}}}catch(err){_iterator14.e(err);}finally{_iterator14.f();}return result;}function topLevelFuncDecls(parsed){return FindToplevelFuncDeclVisitor.run(parsed);}function resolveReference(ref,scopePath){if(scopePath.length==0)return[null,null];var _scopePath=_toArray2(scopePath),scope=_scopePath[0],outer=_scopePath.slice(1);var decls=scope.decls||declarationsWithIdsOfScope(scope);scope.decls=decls;var decl=decls.find(function(_ref2){var _ref3=_slicedToArray2(_ref2,2),_=_ref3[0],id=_ref3[1];return id.name==ref;});return decl||resolveReference(ref,outer);}function resolveReferences(scope){function rec(scope,outerScopes){var path=[scope].concat(outerScopes);scope.refs.forEach(function(ref){var _resolveReference=resolveReference(ref.name,path),_resolveReference2=_slicedToArray2(_resolveReference,2),decl=_resolveReference2[0],id=_resolveReference2[1];map.set(ref,{decl:decl,declId:id,ref:ref});});scope.subScopes.forEach(function(s){return rec(s,path);});}if(scope.referencesResolvedSafely)return scope;var map=scope.resolvedRefMap||(scope.resolvedRefMap=new Map());rec(scope,[]);scope.referencesResolvedSafely=true;return scope;}function refWithDeclAt(pos,scope){var _iterator16=_createForOfIteratorHelper(scope.resolvedRefMap.values()),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var _ref4=_step16.value;var _ref4$ref=_ref4.ref,start=_ref4$ref.start,end=_ref4$ref.end;if(start<=pos&&pos<=end)return _ref4;}}catch(err){_iterator16.e(err);}finally{_iterator16.f();}}function topLevelDeclsAndRefs(parsed,options){options=options||{};options.withComments=true;if(typeof parsed==='string')parsed=parse$2(parsed,options);var scope=scopes(parsed);var useComments=!!options.jslintGlobalComment;var declared=_declaredVarNames(scope,useComments);var refs=scope.refs.concat(flatten(scope.subScopes.map(findUndeclaredReferences)));var undeclared=withoutAll(refs.map(function(ea){return ea.name;}),declared);return{scope:scope,varDecls:scope.varDecls,funcDecls:filter(scope.funcDecls,function(ea){return ea.id;}),classDecls:filter(scope.classDecls,function(ea){return ea.id;}),declaredNames:declared,undeclaredNames:undeclared,refs:refs,thisRefs:scope.thisRefs};// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function findUndeclaredReferences(scope){var names=_declaredVarNames(scope,useComments);return filter(scope.subScopes.map(findUndeclaredReferences).reduce(function(refs,ea){return refs.concat(ea);},scope.refs),function(ref){return names.indexOf(ref.name)===-1;});}}function findGlobalVarRefs(parsed,options){var topLevel=topLevelDeclsAndRefs(parsed,options);var noGlobals=topLevel.declaredNames.concat(knownGlobals);return filter(topLevel.refs,function(ea){return noGlobals.indexOf(ea.name)===-1;});}function findNodesIncludingLines(parsed,code,lines,options){if(!code&&!parsed)throw new Error('Need at least ast or code');code=code||stringify(parsed);parsed=parsed&&parsed.loc?parsed:parse$2(code,{locations:true});return withMozillaAstDo(parsed,[],function(next,node,found){if(lines.every(function(line){return between(line,node.loc.start.line,node.loc.end.line);})){pushIfNotIncluded(found,node);next();}return found;});}function __varDeclIdsFor(scope,name){var result=[];var _iterator17=_createForOfIteratorHelper(scope.params),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var ea=_step17.value;if(ea.name===name)result.push(ea);}}catch(err){_iterator17.e(err);}finally{_iterator17.f();}var _iterator18=_createForOfIteratorHelper(scope.funcDecls),_step18;try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var ea=_step18.value;if(ea.id&&ea.id.name===name)result.push(ea.id);}}catch(err){_iterator18.e(err);}finally{_iterator18.f();}var _iterator19=_createForOfIteratorHelper(scope.classDecls),_step19;try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var ea=_step19.value;if(ea.id&&ea.id.name===name)result.push(ea.id);}}catch(err){_iterator19.e(err);}finally{_iterator19.f();}var _iterator20=_createForOfIteratorHelper(scope.importSpecifiers),_step20;try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var ea=_step20.value;if(ea.name===name)result.push(ea);}}catch(err){_iterator20.e(err);}finally{_iterator20.f();}var _iterator21=_createForOfIteratorHelper(helpers.varDeclIds(scope)),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var ea=_step21.value;if(ea.name===name)result.push(ea);}}catch(err){_iterator21.e(err);}finally{_iterator21.f();}return result;}function findReferencesAndDeclsInScope(scope,name){var _result$decls;var startingScope=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var result=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{refs:[],decls:[]};if(name==='this'){var _result$refs;(_result$refs=result.refs).push.apply(_result$refs,_toConsumableArray2(scope.thisRefs));return result;}var decls=__varDeclIdsFor(scope,name);if(!startingScope&&decls.length)return result;// name shadowed in sub-scope
var _iterator22=_createForOfIteratorHelper(scope.refs),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var _ref5=_step22.value;if(_ref5.name===name)result.refs.push(_ref5);}}catch(err){_iterator22.e(err);}finally{_iterator22.f();}(_result$decls=result.decls).push.apply(_result$decls,_toConsumableArray2(decls));var _iterator23=_createForOfIteratorHelper(scope.subScopes),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var subScope=_step23.value;findReferencesAndDeclsInScope(subScope,name,false,result);}}catch(err){_iterator23.e(err);}finally{_iterator23.f();}return result;}function findDeclarationClosestToIndex(parsed,name,index){var found=null;detect(scopesAtIndex(parsed,index).reverse(),function(scope){var decls=declarationsOfScope(scope,true);var idx=pluck(decls,'name').indexOf(name);if(idx===-1)return false;found=decls[idx];return true;});return found;}function nodesAt$1(pos,ast){ast=typeof ast==='string'?parse$2(ast):ast;return custom.findNodesIncluding(ast,pos);}var _stmtTypes=['EmptyStatement','BlockStatement','ExpressionStatement','IfStatement','BreakStatement','ContinueStatement','WithStatement','ReturnStatement','ThrowStatement','TryStatement','WhileStatement','DoWhileStatement','ForStatement','ForInStatement','ForOfStatement','DebuggerStatement','FunctionDeclaration','VariableDeclaration','ClassDeclaration','ImportDeclaration','ImportDeclaration','ExportNamedDeclaration','ExportDefaultDeclaration','ExportAllDeclaration'];function statementOf(parsed,node,options){// Find the statement that a target node is in. Example:
// let source be "var x = 1; x + 1;" and we are looking for the
// Identifier "x" in "x+1;". The second statement is what will be found.
var nodes=nodesAt$1(node.start,parsed);var found=nodes.reverse().find(function(node){return include(_stmtTypes,node.type);});if(options&&options.asPath){var v=new Visitor();var foundPath;v.accept=wrap(v.accept,function(proceed,node,state,path){if(node===found){foundPath=path;throw new Error('stop search');}return proceed(node,state,path);});try{v.accept(parsed,{},[]);}catch(e){}return foundPath;}return found;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// imports and exports
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function _imports(scope){// like import "fooo";
var imports=[];var stmts=scope.node.body||[];for(var _i77=0;_i77<stmts.length;_i77++){var stmt=stmts[_i77];if(stmt.type!=='ImportDeclaration')continue;if(stmt.specifiers.length===0){imports.push({local:null,imported:null,fromModule:stmt.source.value,node:stmt});continue;}// like import { x as y } from "fooo"; import * as x from "fooo"; import x from "fooo";
var from=stmt.source?stmt.source.value:'unknown module';imports.push.apply(imports,_toConsumableArray2(stmt.specifiers.map(function(importSpec){var imported;if(importSpec.type==='ImportNamespaceSpecifier')imported='*';else if(importSpec.type==='ImportDefaultSpecifier')imported='default';else if(importSpec.type==='ImportSpecifier')imported=importSpec.imported.name;else imported=null;return{local:importSpec.local?importSpec.local.name:null,imported:imported,fromModule:from,node:stmt};})));}return imports;}function exports$b(scope){var resolve=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(resolve)resolveReferences(scope);var exports=[];var _iterator24=_createForOfIteratorHelper(scope.exportDecls),_step24;try{var _loop=function _loop(){var node=_step24.value;exportsStmt=statementOf(scope.node,node);if(!exportsStmt)return"continue";from=exportsStmt.source?exportsStmt.source.value:null;if(exportsStmt.type==='ExportAllDeclaration'){exports.push({local:null,exported:'*',imported:'*',fromModule:from,node:node,type:'all'});return"continue";}if(exportsStmt.type==='ExportDefaultDeclaration'){if(helpers.isDeclaration(exportsStmt.declaration)){exports.push({local:exportsStmt.declaration.id?exportsStmt.declaration.id.name:null,exported:'default',type:exportsStmt.declaration.type==='FunctionDeclaration'?'function':exportsStmt.declaration.type==='ClassDeclaration'?'class':null,fromModule:null,node:node,decl:exportsStmt.declaration,declId:exportsStmt.declaration.id});return"continue";}if(exportsStmt.declaration.type==='Identifier'){var _ref6=scope.resolvedRefMap.get(exportsStmt.declaration)||{},decl=_ref6.decl,declId=_ref6.declId;exports.push({local:exportsStmt.declaration.name,exported:'default',fromModule:null,node:node,type:'id',decl:decl,declId:declId});return"continue";}// exportsStmt.declaration is an expression
exports.push({local:null,exported:'default',fromModule:null,node:node,type:'expr',decl:exportsStmt.declaration,declId:exportsStmt.declaration});return"continue";}if(exportsStmt.specifiers&&exportsStmt.specifiers.length){exports.push.apply(exports,_toConsumableArray2(exportsStmt.specifiers.map(function(exportSpec){var decl,declId;if(from){// "export { x as y } from 'foo'" is the only case where export
// creates a (non-local) declaration itself
decl=node;declId=exportSpec.exported;}else if(exportSpec.local){var resolved=scope.resolvedRefMap.get(exportSpec.local);decl=resolved?resolved.decl:null;declId=resolved?resolved.declId:null;}return{local:!from&&exportSpec.local?exportSpec.local.name:null,exported:exportSpec.exported?exportSpec.exported.name:null,imported:from&&exportSpec.local?exportSpec.local.name:null,fromModule:from||null,type:'id',node:node,decl:decl,declId:declId};})));return"continue";}if(exportsStmt.declaration&&exportsStmt.declaration.declarations){exports.push.apply(exports,_toConsumableArray2(exportsStmt.declaration.declarations.map(function(decl){return{local:decl.id?decl.id.name:'default',exported:decl.id?decl.id.name:'default',type:exportsStmt.declaration.kind,fromModule:null,node:node,decl:decl,declId:decl.id};})));return"continue";}if(exportsStmt.declaration){exports.push({local:exportsStmt.declaration.id?exportsStmt.declaration.id.name:'default',exported:exportsStmt.declaration.id?exportsStmt.declaration.id.name:'default',type:exportsStmt.declaration.type==='FunctionDeclaration'?'function':exportsStmt.declaration.type==='ClassDeclaration'?'class':null,fromModule:null,node:node,decl:exportsStmt.declaration,declId:exportsStmt.declaration.id});return"continue";}};for(_iterator24.s();!(_step24=_iterator24.n()).done;){var exportsStmt;var from;var _ret=_loop();if(_ret==="continue")continue;}}catch(err){_iterator24.e(err);}finally{_iterator24.f();}return uniqBy(exports,function(a,b){return a.local==b.local&&a.exported==b.exported&&a.fromModule==b.fromModule;});}var query=/*#__PURE__*/Object.freeze({__proto__:null,helpers:helpers,knownGlobals:knownGlobals,scopes:scopes,nodesAtIndex:nodesAtIndex,scopesAtIndex:scopesAtIndex,scopeAtIndex:scopeAtIndex,scopesAtPos:scopesAtPos,nodesInScopeOf:nodesInScopeOf,declarationsOfScope:declarationsOfScope,_declaredVarNames:_declaredVarNames,_findJsLintGlobalDeclarations:_findJsLintGlobalDeclarations,topLevelDeclsAndRefs:topLevelDeclsAndRefs,topLevelFuncDecls:topLevelFuncDecls,findGlobalVarRefs:findGlobalVarRefs,findNodesIncludingLines:findNodesIncludingLines,findReferencesAndDeclsInScope:findReferencesAndDeclsInScope,findDeclarationClosestToIndex:findDeclarationClosestToIndex,nodesAt:nodesAt$1,statementOf:statementOf,resolveReferences:resolveReferences,refWithDeclAt:refWithDeclAt,imports:_imports,exports:exports$b});var ObjectSpreadTransformer=/*#__PURE__*/function(_Visitor8){_inherits(ObjectSpreadTransformer,_Visitor8);var _super8=_createSuper(ObjectSpreadTransformer);function ObjectSpreadTransformer(){_classCallCheck(this,ObjectSpreadTransformer);return _super8.apply(this,arguments);}_createClass(ObjectSpreadTransformer,[{key:"accept",value:function accept(node,state,path){if(node.type==='ObjectExpression'){node=this.transformSpreadElement(node);}return _get2(_getPrototypeOf(ObjectSpreadTransformer.prototype),"accept",this).call(this,node,state,path);}},{key:"transformSpreadElement",value:function transformSpreadElement(node){var currentGroup=[];var propGroups=[currentGroup];node.properties.forEach(function(prop){if(prop.type!=='SpreadElement'){prop.shorthand=false;// also ensure its a key value pair
currentGroup.push(prop);}else{propGroups.push(prop);currentGroup=[];propGroups.push(currentGroup);}});if(propGroups.length===1)return node;if(!currentGroup.length)propGroups.pop();return funcCall.apply(void 0,[member('Object','assign')].concat(_toConsumableArray2(propGroups.map(function(group){return group.type==='SpreadElement'?group.argument:{properties:group,type:'ObjectExpression'};}))));}}]);return ObjectSpreadTransformer;}(Visitor);function objectSpreadTransform(parsed){// "var x = {y, ...z}" => "var x = Object.assign({ y }, z);"
// "var x = {y, ...z}" => "var x = Object.assign({ y: y }, z);"
return new ObjectSpreadTransformer().accept(parsed,{},[]);}/* global process, global, exports */function wrapInStartEndCall(parsed,options){// Wraps a piece of code into two function calls: One before the first
// statement and one after the last. Also wraps the entire thing into a try /
// catch block. The end call gets the result of the last statement (if it is
// something that returns a value, i.e. an expression) passed as the second
// argument. If an error occurs the end function is called with an error as
// first parameter
// Why? This allows to easily track execution of code, especially for
// asynchronus / await code!
// Example:
// stringify(wrapInStartEndCall("var y = x + 23; y"))
// // generates code
// try {
//     __start_execution();
//     __lvVarRecorder.y = x + 23;
//     return __end_execution(null, __lvVarRecorder.y);
// } catch (err) {
//     return __end_execution(err, undefined);
// }
if(typeof parsed==='string')parsed=parse$2(parsed);options=options||{};var isProgram=parsed.type==='Program';var startFuncNode=options.startFuncNode||id('__start_execution');var endFuncNode=options.endFuncNode||id('__end_execution');var funcDecls=topLevelFuncDecls(parsed);var innerBody=parsed.body;var outerBody=[];// 1. Hoist func decls outside the actual eval start - end code. The async /
// generator transforms require this!
funcDecls.forEach(function(_ref7){var node=_ref7.node,path=_ref7.path;Path(path).set(parsed,exprStmt(node.id));outerBody.push(node);});// 2. add start-eval call
innerBody.unshift(exprStmt(funcCall(startFuncNode)));// 3. if last statement is an expression, transform it so we can pass it to
// the end-eval call, replacing the original expression. If it's a
// non-expression we record undefined as the eval result
var last$1=last(innerBody);if(last$1.type==='ExpressionStatement'){innerBody.pop();innerBody.push(exprStmt(funcCall(endFuncNode,id('null'),last$1.expression)));}else if(last$1.type==='VariableDeclaration'&&last(last$1.declarations).id.type==='Identifier'){innerBody.push(exprStmt(funcCall(endFuncNode,id('null'),last(last$1.declarations).id)));}else{innerBody.push(exprStmt(funcCall(endFuncNode,id('null'),id('undefined'))));}// 4. Wrap that stuff in a try stmt
outerBody.push(tryStmt.apply(void 0,['err',[exprStmt(funcCall(endFuncNode,id('err'),id('undefined')))]].concat(_toConsumableArray2(innerBody))));return isProgram?program.apply(void 0,outerBody):block$1.apply(void 0,outerBody);}var isProbablySingleExpressionRe=/^\s*(\{|function\s*\()/;function transformSingleExpression(code){// evaling certain expressions such as single functions or object
// literals will fail or not work as intended. When the code being
// evaluated consists just out of a single expression we will wrap it in
// parens to allow for those cases
// Example:
// transformSingleExpression("{foo: 23}") // => "({foo: 23})"
if(!isProbablySingleExpressionRe.test(code)||code.split('\n').length>30)return code;try{var parsed=fuzzyParse(code);if(parsed.body.length===1&&(parsed.body[0].type==='FunctionDeclaration'||parsed.body[0].type==='BlockStatement'&&parsed.body[0].body[0].type==='LabeledStatement')){code='('+code.replace(/;\s*$/,'')+')';}}catch(e){if(typeof $world!=='undefined')$world.logError(e);else console.error('Eval preprocess error: %s',e.stack||e);}return code;}// ignore-in-doc
// As defined in the Ecmascript standard (http://www.ecma-international.org/ecma-262/5.1/#sec-7.6)
// JS identifiers can consist out of several unicode character classes.
// The code below was generated using the MIT licensed CSET library, see http://inimino.org/~inimino/blog/javascript_cset
var isValidIdentifierRe=/^(?!(?:do|if|in|for|let|new|try|var|case|default|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*$/;function isValidIdentifier(string){return isValidIdentifierRe.test(string);}var Node$2=parse$2('').constructor;Object.defineProperty(Node$2.prototype,'__serialize__',{configurable:true,value:function value(){return{__expr__:'('+JSON.stringify(this)+')'};}});/*global System,global,Global,self,Node,ImageData*/function getGlobal(){if(typeof System!=="undefined")return System.global;if(typeof window!=="undefined")return window;if(typeof global!=="undefined")return global;if(typeof Global!=="undefined")return Global;if(typeof self!=="undefined")return self;return function(){return this;}();}var knownSymbols=function(){return Object.getOwnPropertyNames(Symbol).filter(function(ea){return _typeof2(Symbol[ea])==="symbol";}).reduce(function(map,ea){return map.set(Symbol[ea],"Symbol."+ea);},new Map());}();var member$1=nodes.member,prop$1=nodes.prop,varDecl$1=nodes.varDecl,assign$1=nodes.assign,id$1=nodes.id,literal$3=nodes.literal,exprStmt$1=nodes.exprStmt,conditional$1=nodes.conditional,binaryExpr$1=nodes.binaryExpr,funcCall$1=nodes.funcCall;var topLevelDeclsAndRefs$1=query.topLevelDeclsAndRefs,queryHelpers=query.helpers;function rewriteToCaptureTopLevelVariables(parsed,assignToObj,options){/* replaces var and function declarations with assignment statements.
   * Example:
     stringify(
       rewriteToCaptureTopLevelVariables(
         parse("var x = 3, y = 2, z = 4"),
         {name: "A", type: "Identifier"},
         {exclude: ['z']}));
     // => "A.x = 3; A.y = 2; z = 4"
   */if(!assignToObj)assignToObj={type:'Identifier',name:'__rec'};options=_objectSpread({ignoreUndeclaredExcept:null,includeRefs:null,excludeRefs:options&&options.exclude||[],includeDecls:null,excludeDecls:options&&options.exclude||[],recordDefRanges:false,es6ExportFuncId:null,es6ImportFuncId:null,captureObj:assignToObj,moduleExportFunc:{name:options&&options.es6ExportFuncId||'_moduleExport',type:'Identifier'},moduleImportFunc:{name:options&&options.es6ImportFuncId||'_moduleImport',type:'Identifier'},declarationWrapper:undefined,classTransform:function classTransform(parsed){return parsed;}},options);var rewritten=parsed;// "ignoreUndeclaredExcept" is null if we want to capture all globals in the toplevel scope
// if it is a list of names we will capture all refs with those names
if(options.ignoreUndeclaredExcept){var topLevel=topLevelDeclsAndRefs$1(parsed);options.excludeRefs=withoutAll(topLevel.undeclaredNames,options.ignoreUndeclaredExcept).concat(options.excludeRefs);options.excludeDecls=withoutAll(topLevel.undeclaredNames,options.ignoreUndeclaredExcept).concat(options.excludeDecls);}options.excludeRefs=options.excludeRefs.concat(options.captureObj.name);options.excludeDecls=options.excludeDecls.concat(options.captureObj.name);// 1. def ranges so that we know at which source code positions the
// definitions are
var defRanges=options.recordDefRanges?computeDefRanges(rewritten):null;// 2. find those var declarations that should not be rewritten. we
// currently ignore var declarations in for loops and the error parameter
// declaration in catch clauses. Also es6 import / export declaration need
// a special treatment
// DO NOT rewrite exports like "export { foo as bar }" => "export { _rec.foo as bar }"
// as this is not valid syntax. Instead we add a var declaration using the
// recorder as init for those exports later
options.excludeRefs=options.excludeRefs.concat(additionalIgnoredRefs(parsed));options.excludeDecls=options.excludeDecls.concat(additionalIgnoredDecls(parsed));rewritten=fixDefaultAsyncFunctionExportForRegeneratorBug(rewritten);// 3. if the es6ExportFuncId options is defined we rewrite the es6 form into an
// obj assignment, converting es6 code to es5 using the extra
// options.moduleExportFunc and options.moduleImportFunc as capture / sources
if(options.es6ExportFuncId){options.excludeRefs.push(options.es6ExportFuncId);options.excludeRefs.push(options.es6ImportFuncId);rewritten=es6ModuleTransforms(rewritten,options);}// 4. make all references declared in the toplevel scope into property
// reads of captureObj
// Example "var foo = 3; 99 + foo;" -> "var foo = 3; 99 + Global.foo;"
rewritten=replaceRefs(rewritten,options);// 5.a turn var declarations into assignments to captureObj
// Example: "var foo = 3; 99 + foo;" -> "Global.foo = 3; 99 + foo;"
// if declarationWrapper is requested:
//   "var foo = 3;" -> "Global.foo = _define(3, 'foo', _rec, 'var');"
rewritten=replaceVarDecls(rewritten,options);// clear empty exports
// rms 26.05.20: removes statements of the sort "export {}"
//               This is technically illegal ESM syntax, however
//               this sometimes is served by jspm due to auto generated esm modules
//               It's therefore worth tolerating this kind of syntax for convenience sake.
rewritten=clearEmptyExports(rewritten);// 5.b record class declarations
// Example: "class Foo {}" -> "class Foo {}; Global.Foo = Foo;"
// if declarationWrapper is requested:
//   "class Foo {}" -> "Global.Foo = _define(class Foo {});"
rewritten=replaceClassDecls(rewritten,options);rewritten=splitExportDeclarations(rewritten);// 6. es6 export declaration are left untouched but a capturing assignment
// is added after the export so that we get the value:
// "export var x = 23;" => "export var x = 23; Global.x = x;"
rewritten=insertCapturesForExportDeclarations(rewritten,options);// 7. es6 import declaration are left untouched but a capturing assignment
// is added after the import so that we get the value:
// "import x from './some-es6-module.js';" =>
//   "import x from './some-es6-module.js';\n_rec.x = x;"
rewritten=insertCapturesForImportDeclarations(rewritten,options);// 8. Since variable declarations like "var x = 23" were transformed to sth
// like "_rex.x = 23" exports can't simply reference vars anymore and
// "export { _rec.x }" is invalid syntax. So in front of those exports we add
// var decls manually
rewritten=insertDeclarationsForExports(rewritten,options);// 9. assignments for function declarations in the top level scope are
// put in front of everything else to mirror the func hoisting:
// "return bar(); function bar() { return 23 }" ->
//   "Global.bar = bar; return bar(); function bar() { return 23 }"
// if declarationWrapper is requested:
//   "Global.bar = _define(bar, 'bar', _rec, 'function'); function bar() {}"
rewritten=putFunctionDeclsInFront(rewritten,options);rewritten=transformImportMeta(rewritten,options);return rewritten;}function transformImportMeta(parsed,options){return ReplaceVisitor.run(parsed,function(node){if(node.type=='MetaProperty'&&node.meta.name=='import'){return options.classToFunction.currentModuleAccessor?objectLiteral(['url',member(options.classToFunction.currentModuleAccessor,'id')]):parse$2('({url: eval("_context").id})').body[0].expression;}return node;});}function rewriteToRegisterModuleToCaptureSetters(parsed,assignToObj,options){// for rewriting the setters part in code like
// ```js
//   System.register(["a.js"], function (_export, _context) {
//     var a, _rec;
//     return {
//       setters: [function(foo_a_js) { a = foo_a_js.x }],
//       execute: function () { _rec.x = 23 + _rec.a; }
//     };
//   });
// ```
// This allows us to capture (and potentially re-export) imports and their
// changes without actively running the module again.
options=_objectSpread({captureObj:assignToObj||{type:'Identifier',name:'__rec'},exclude:[],declarationWrapper:undefined},options);var registerCall=Path('body.0.expression').get(parsed);if(registerCall.callee.object.name!=='System'){throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: ".concat(stringify(parsed).slice(0,300),"..."));}if(registerCall.callee.property.name!=='register'){throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call: ".concat(stringify(parsed).slice(0,300),"..."));}var registerBody=Path('arguments.1.body.body').get(registerCall);var registerReturn=last(registerBody);if(registerReturn.type!=='ReturnStatement'){throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at return statement: ".concat(stringify(parsed).slice(0,300),"..."));}var setters=registerReturn.argument.properties.find(function(prop){return prop.key.name==='setters';});if(!setters){throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding setters: ".concat(stringify(parsed).slice(0,300),"..."));}var execute=registerReturn.argument.properties.find(function(prop){return prop.key.name==='execute';});if(!execute){throw new Error("rewriteToRegisterModuleToCaptureSetters: input doesn't seem to be a System.register call, at finding execute: ".concat(stringify(parsed).slice(0,300),"..."));}// in each setter function: intercept the assignments to local vars and inject capture object
setters.value.elements.forEach(function(funcExpr){funcExpr.params[0]=assign$1(funcExpr.params[0],objectLiteral({}));funcExpr.body.body=funcExpr.body.body.map(function(stmt){if(stmt.type!=='ExpressionStatement'||stmt.expression.type!=='AssignmentExpression'||stmt.expression.left.type!=='Identifier'||include(options.exclude,stmt.expression.left.name))return stmt;var id=stmt.expression.left;var rhs=options.declarationWrapper?declarationWrapperCall(options.declarationWrapper,null,literal$3(id.name),literal$3('var'),stmt.expression,options.captureObj,options):stmt.expression;return exprStmt$1(assign$1(member$1(options.captureObj,id),rhs));});});var captureInitialize=execute.value.body.body.find(function(stmt){return stmt.type==='ExpressionStatement'&&stmt.expression.type=='AssignmentExpression'&&stmt.expression.left.name===options.captureObj.name;});if(!captureInitialize){captureInitialize=execute.value.body.body.find(function(stmt){return stmt.type==='VariableDeclaration'&&stmt.declarations[0].id&&stmt.declarations[0].id.name===options.captureObj.name;});}if(captureInitialize){_remove4(execute.value.body.body,captureInitialize);pushAt(registerBody,captureInitialize,registerBody.length-1);}if(options.sourceAccessorName){var origSourceInitialize=execute.value.body.body.find(function(stmt){return stmt.type==='ExpressionStatement'&&stmt.expression.type=='AssignmentExpression'&&stmt.expression.left.name===options.sourceAccessorName;});if(!origSourceInitialize){origSourceInitialize=execute.value.body.body.find(function(stmt){return stmt.type==='VariableDeclaration'&&stmt.declarations[0].id&&stmt.declarations[0].id.name===options.sourceAccessorName;});}if(origSourceInitialize){_remove4(execute.value.body.body,origSourceInitialize);pushAt(registerBody,origSourceInitialize,registerBody.length-1);}}return parsed;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// replacement helpers
function clearEmptyExports(parsed,options){var topLevel=topLevelDeclsAndRefs$1(parsed);var _iterator25=_createForOfIteratorHelper(topLevel.scope.exportDecls),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var exp=_step25.value;if(!exp.declaration&&exp.specifiers&&!exp.specifiers.length){_remove4(parsed.body,exp);}}}catch(err){_iterator25.e(err);}finally{_iterator25.f();}return parsed;}function replaceRefs(parsed,options){var topLevel=topLevelDeclsAndRefs$1(parsed);var refsToReplace=topLevel.refs.filter(function(ref){return shouldRefBeCaptured(ref,topLevel,options);});var locallyIgnored=[];var replaced=ReplaceVisitor.run(parsed,function(node,path){// cs 2016/06/27, 1a4661
// ensure keys of shorthand properties are not renamed while capturing
if(node.type==='Property'&&refsToReplace.includes(node.key)&&node.shorthand){return prop$1(id$1(node.key.name),node.value);}// don't replace var refs in expressions such as "export { x }" or "export var x;"
// We make sure that those var references are defined in insertDeclarationsForExports()
if(node.type==='ExportNamedDeclaration'){var declaration=node.declaration,specifiers=node.specifiers;if(declaration){if(declaration.id)locallyIgnored.push(declaration.id);else if(declaration.declarations){locallyIgnored.push.apply(locallyIgnored,_toConsumableArray2(declaration.declarations.map(function(_ref8){var id=_ref8.id;return id;})));}}specifiers&&specifiers.forEach(function(_ref9){var local=_ref9.local;return locallyIgnored.push(local);});return node;}// declaration wrapper function for assignments
// "a = 3" => "a = _define('a', 'assignment', 3, _rec)"
if(node.type==='AssignmentExpression'&&refsToReplace.includes(node.left)&&options.declarationWrapper){return _objectSpread(_objectSpread({},node),{},{right:declarationWrapperCall(options.declarationWrapper,null,literal$3(node.left.name),literal$3('assignment'),node.right,options.captureObj,options)});}return node;});return ReplaceVisitor.run(replaced,function(node,path,parent){return refsToReplace.includes(node)&&!locallyIgnored.includes(node)?member$1(options.captureObj,node):node;});}function replaceVarDecls(parsed,options){// rewrites var declarations so that they can be captured by
// `options.captureObj`.
// For normal vars we will do a transform like
//   "var x = 23;" => "_rec.x = 23";
// For patterns (destructuring assignments) we will create assignments for
// all properties that are being destructured, creating helper vars as needed
//   "var {x: [y]} = foo" => "var _1 = foo; var _1$x = _1.x; __rec.y = _1$x[0];"
var topLevel=topLevelDeclsAndRefs$1(parsed);return ReplaceManyVisitor.run(parsed,function(node){if(!topLevel.varDecls.includes(node)||node.declarations.every(function(decl){return!shouldDeclBeCaptured(decl,options);}))return node;var replaced=[];for(var _i78=0;_i78<node.declarations.length;_i78++){var decl=node.declarations[_i78];if(!shouldDeclBeCaptured(decl,options)){replaced.push({type:'VariableDeclaration',kind:node.kind||'var',declarations:[decl]});continue;}var init=decl.init||{operator:'||',type:'LogicalExpression',left:{computed:false,object:options.captureObj,property:decl.id,type:'MemberExpression'},right:{name:'undefined',type:'Identifier'}};var initWrapped=options.declarationWrapper&&decl.id.name?declarationWrapperCall(options.declarationWrapper,decl,literal$3(decl.id.name),literal$3(node.kind),init,options.captureObj,options):init;// Here we create the object pattern / destructuring replacements
if(decl.id.type.includes('Pattern')){var declRootName=generateUniqueName(topLevel.declaredNames,'destructured_1');var declRoot={type:'Identifier',name:declRootName};var state={parent:declRoot,declaredNames:topLevel.declaredNames};var extractions=transformPattern(decl.id,state).map(function(decl){return decl[annotationSym]&&decl[annotationSym].capture?assignExpr(options.captureObj,decl.declarations[0].id,options.declarationWrapper?declarationWrapperCall(options.declarationWrapper,null,literal$3(decl.declarations[0].id.name),literal$3(node.kind),decl.declarations[0].init,options.captureObj,options):decl.declarations[0].init,false):decl;});topLevel.declaredNames.push(declRootName);replaced.push.apply(replaced,_toConsumableArray2([varDecl$1(declRoot,initWrapped,node.kind)].concat(extractions)));continue;}// This is rewriting normal vars
replaced.push(assignExpr(options.captureObj,decl.id,initWrapped,false));if(options.keepTopLevelVarDecls){replaced.push(varDecl$1(decl.id,member$1(options.captureObj,decl.id)));}}return replaced;});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// naming
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function generateUniqueName(declaredNames,hint){var unique=hint;var n=1;while(declaredNames.indexOf(unique)>-1){if(n>1000)throw new Error('Endless loop searching for unique variable '+unique);unique=unique.replace(/_[0-9]+$|$/,'_'+ ++n);}return unique;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// exclude / include helpers
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function additionalIgnoredDecls(parsed,options){var topLevel=topLevelDeclsAndRefs$1(parsed);var ignoreDecls=[];for(var _i79=0;_i79<topLevel.scope.varDecls.length;_i79++){var decl=topLevel.scope.varDecls[_i79];var path=Path(topLevel.scope.varDeclPaths[_i79]);var parent=path.slice(0,-1).get(parsed);if(parent.type==='ForStatement'||parent.type==='ForInStatement'||parent.type==='ForOfStatement'||parent.type==='ExportNamedDeclaration')ignoreDecls.push.apply(ignoreDecls,_toConsumableArray2(decl.declarations));}return topLevel.scope.catches.map(function(ea){return ea.name;}).concat(ignoreDecls.map(function(ea){return ea.id.name;}));}function additionalIgnoredRefs(parsed,options){// FIXME rk 2016-05-11: in shouldRefBeCaptured we now also test for import
// decls, this should somehow be consolidated with this function and with the
// fact that naming based ignores aren't good enough...
var topLevel=topLevelDeclsAndRefs$1(parsed);var ignoreDecls=[];for(var _i80=0;_i80<topLevel.scope.varDecls.length;_i80++){var decl=topLevel.scope.varDecls[_i80];var path=Path(topLevel.scope.varDeclPaths[_i80]);var parent=path.slice(0,-1).get(parsed);if(parent.type==='ForStatement'||parent.type==='ForInStatement'||parent.type==='ForOfStatement')ignoreDecls.push.apply(ignoreDecls,_toConsumableArray2(decl.declarations));}return topLevel.scope.catches.map(function(ea){return ea.name;}).concat(queryHelpers.declIds(ignoreDecls.map(function(ea){return ea.id;})).map(function(ea){return ea.name;}));}function shouldDeclBeCaptured(decl,options){return options.excludeDecls.indexOf(decl.id.name)===-1&&(!options.includeDecls||options.includeDecls.indexOf(decl.id.name)>-1);}function shouldRefBeCaptured(ref,toplevel,options){if(toplevel.scope.importSpecifiers.includes(ref))return false;for(var _i81=0;_i81<toplevel.scope.exportDecls.length;_i81++){var ea=toplevel.scope.exportDecls[_i81];if(ea.declarations&&ea.declarations.includes(ref))return false;if(ea.declaration===ref)return false;}if(options.excludeRefs.includes(ref.name))return false;if(options.includeRefs&&!options.includeRefs.includes(ref.name))return false;return true;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// capturing specific code
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function replaceClassDecls(parsed,options){if(options.classToFunction){return options.classToFunction.transform(parsed,options.classToFunction);}var topLevel=topLevelDeclsAndRefs$1(parsed);if(!topLevel.classDecls.length)return parsed;for(var _i82=parsed.body.length-1;_i82>=0;_i82--){var stmt=parsed.body[_i82];if(stmt.id&&topLevel.classDecls.includes(stmt)){parsed.body.splice(_i82+1,0,assignExpr(options.captureObj,stmt.id,stmt.id,false));}}return parsed;}function splitExportDeclarations(parsed,options){var stmts=parsed.body;var newNodes=parsed.body=[];for(var _i83=0;_i83<stmts.length;_i83++){var stmt=stmts[_i83];if(stmt.type!=='ExportNamedDeclaration'||!stmt.declaration||stmt.declaration.type!=='VariableDeclaration'||stmt.declaration.declarations.length<=1){newNodes.push(stmt);continue;}var decls=stmt.declaration.declarations;for(var j=0;j<decls.length;j++){newNodes.push({type:'ExportNamedDeclaration',specifiers:[],declaration:varDecl$1(decls[j].id,decls[j].init,stmt.declaration.kind)});}}return parsed;}function insertCapturesForExportDeclarations(parsed,options){var body=[];for(var _i84=0;_i84<parsed.body.length;_i84++){var stmt=parsed.body[_i84];body.push(stmt);// ExportNamedDeclaration can have specifieres = refs, those should already
// be captured. Only focus on export declarations and only those
// declarations that are no refs, i.e.
// ignore: "export default x;"
// capture: "export default function foo () {};", "export var x = 23, y = 3;"
if(stmt.type!=='ExportNamedDeclaration'&&stmt.type!=='ExportDefaultDeclaration'||!stmt.declaration);else if(stmt.type==='ExportDefaultDeclaration'&&stmt.declaration.type==='Literal'){// default export of an unnamed primitive value, i.e.
// "export default "foo"", "export default 27;"
var decl=stmt.declaration;var assignVal=decl.raw;var refId=generateUniqueName(topLevelDeclsAndRefs$1(parsed).declaredNames,'$'+decl.raw.split('"').join(''));stmt.declaration=id$1(refId);pushAt(body,assignExpr(options.captureObj,refId,decl.raw,false),body.indexOf(stmt));}else if(stmt.declaration.declarations){body.push.apply(body,_toConsumableArray2(stmt.declaration.declarations.map(function(decl){var assignVal=decl.id;if(options.declarationWrapper){var alreadyWrapped=decl.init.callee&&decl.init.callee.name===options.declarationWrapper.name;if(!alreadyWrapped){assignVal=declarationWrapperCall(options.declarationWrapper,decl,literal$3(decl.id.name),literal$3('assignment'),decl.id,options.captureObj,options);}}return assignExpr(options.captureObj,decl.id,assignVal,false);})));}else if(stmt.declaration.type==='FunctionDeclaration');else if(stmt.declaration.type==='ClassDeclaration'){body.push(assignExpr(options.captureObj,stmt.declaration.id,stmt.declaration.id,false));}}parsed.body=body;return parsed;}function insertCapturesForImportDeclarations(parsed,options){parsed.body=parsed.body.reduce(function(stmts,stmt){return stmts.concat(stmt.type!=='ImportDeclaration'||!stmt.specifiers.length?[stmt]:[stmt].concat(stmt.specifiers.map(function(specifier){return assignExpr(options.captureObj,specifier.local,specifier.local,false);})));},[]);return parsed;}function insertDeclarationsForExports(parsed,options){var topLevel=topLevelDeclsAndRefs$1(parsed);var body=[];for(var _i85=0;_i85<parsed.body.length;_i85++){var stmt=parsed.body[_i85];if(options.classToFunction&&stmt.type==='ExportDefaultDeclaration'&&stmt.declaration&&!stmt.declaration.type.includes('Declaration')&&(stmt.declaration.type==='Identifier'||stmt.declaration.id)){body=body.concat([varDeclOrAssignment(parsed,{type:'VariableDeclarator',id:stmt.declaration,init:member$1(options.captureObj,stmt.declaration)}),stmt]);}else if(stmt.type!=='ExportNamedDeclaration'||!stmt.specifiers.length||stmt.source){body.push(stmt);}else{body=body.concat(stmt.specifiers.map(function(specifier){return topLevel.declaredNames.includes(specifier.local.name)?null:varDeclOrAssignment(parsed,{type:'VariableDeclarator',id:specifier.local,init:member$1(options.captureObj,specifier.local)});}).filter(Boolean)).concat(stmt);}}parsed.body=body;return parsed;}function fixDefaultAsyncFunctionExportForRegeneratorBug(parsed,options){// rk 2016-06-02: see https://github.com/LivelyKernel/lively.modules/issues/9
// FIXME this needs to be removed as soon as the cause for the issue is fixed
var body=[];for(var _i86=0;_i86<parsed.body.length;_i86++){var stmt=parsed.body[_i86];if(stmt.type==='ExportDefaultDeclaration'&&stmt.declaration.type==='FunctionDeclaration'&&stmt.declaration.id&&stmt.declaration.async){body.push(stmt.declaration);stmt.declaration={type:'Identifier',name:stmt.declaration.id.name};}body.push(stmt);}parsed.body=body;return parsed;}function es6ModuleTransforms(parsed,options){parsed.body=parsed.body.reduce(function(stmts,stmt){var nodes;if(stmt.type==='ExportNamedDeclaration'){if(stmt.source){var key=moduleId=stmt.source;nodes=stmt.specifiers.map(function(specifier){return{type:'ExpressionStatement',expression:exportFromImport({type:'Literal',value:specifier.exported.name},{type:'Literal',value:specifier.local.name},moduleId,options.moduleExportFunc,options.moduleImportFunc)};});}else if(stmt.declaration){var decls=stmt.declaration.declarations;if(!decls){// func decl or class
nodes=[stmt.declaration].concat(exportCallStmt(options.moduleExportFunc,stmt.declaration.id.name,stmt.declaration.id));}else{nodes=decls.map(function(decl){options.excludeDecls.push(decl.id);return varDecl$1(decl.id,assignExpr(options.captureObj,decl.id,options.declarationWrapper?declarationWrapperCall(options.declarationWrapper,null,literal$3(decl.id.name),literal$3(stmt.declaration.kind),decl,options.captureObj,options):decl.init,false),stmt.declaration.kind);}).concat(decls.map(function(decl){return exportCallStmt(options.moduleExportFunc,decl.id.name,decl.id);}));}}else{nodes=stmt.specifiers.map(function(specifier){return exportCallStmt(options.moduleExportFunc,specifier.exported.name,shouldDeclBeCaptured({id:specifier.local},options)?member$1(options.captureObj,specifier.local):specifier.local);});}}else if(stmt.type==='ExportDefaultDeclaration'){if(stmt.declaration&&stmt.declaration.id){nodes=[stmt.declaration].concat(exportCallStmt(options.moduleExportFunc,'default',stmt.declaration.id));}else{nodes=[exportCallStmt(options.moduleExportFunc,'default',stmt.declaration)];}}else if(stmt.type==='ExportAllDeclaration'){var key={name:options.es6ExportFuncId+'__iterator__',type:'Identifier'};var moduleId=stmt.source;nodes=[{type:'ForInStatement',body:{type:'ExpressionStatement',expression:exportFromImport(key,key,moduleId,options.moduleExportFunc,options.moduleImportFunc)},left:{type:'VariableDeclaration',kind:'var',declarations:[{type:'VariableDeclarator',id:key,init:null}]},right:importCall(null,moduleId,options.moduleImportFunc)}];options.excludeRefs.push(key.name);options.excludeDecls.push(key.name);}else if(stmt.type==='ImportDeclaration'){nodes=stmt.specifiers.length?stmt.specifiers.map(function(specifier){var local=specifier.local;var imported=specifier.type==='ImportSpecifier'&&specifier.imported.name||specifier.type==='ImportDefaultSpecifier'&&'default'||null;return varDeclAndImportCall(parsed,local,imported||null,stmt.source,options.moduleImportFunc);}):importCallStmt(null,stmt.source,options.moduleImportFunc);}else nodes=[stmt];return stmts.concat(nodes);},[]);return parsed;}function putFunctionDeclsInFront(parsed,options){var scope=topLevelDeclsAndRefs$1(parsed).scope;var funcDecls=scope.funcDecls;if(!funcDecls.length)return parsed;var putInFront=[];for(var _i87=funcDecls.length;_i87--;){var decl=funcDecls[_i87];if(!decl.id||!shouldDeclBeCaptured(decl,options))continue;var parentPath=scope.funcDeclPaths[_i87].slice(0,-1);// ge the parent so we can replace the original function:
var parent=Path(parentPath).get(scope.node);var funcId={type:'Identifier',name:decl.id.name};// what we capture:
var init=options.declarationWrapper?declarationWrapperCall(options.declarationWrapper,decl,literal$3(funcId.name),literal$3('function'),funcId,options.captureObj,options):funcId;var declFront=_objectSpread({},decl);if(Array.isArray(parent)){// If the parent is a body array we remove the original func decl from it
// and replace it with a reference to the function
parent.splice(parent.indexOf(decl),1,exprStmt$1(decl.id));}else if(parent.type==='ExportNamedDeclaration'){// If the function is exported we change the export declaration into a reference
var parentIndexInBody=scope.node.body.indexOf(parent);if(parentIndexInBody>-1){scope.node.body.splice(parentIndexInBody,1,{type:'ExportNamedDeclaration',specifiers:[{type:'ExportSpecifier',exported:decl.id,local:decl.id}]});}}else if(parent.type==='ExportDefaultDeclaration'){parent.declaration=decl.id;}else;// hoist the function to the front, also it's capture
putInFront.unshift(assignExpr(options.captureObj,funcId,init,false));putInFront.unshift(declFront);}parsed.body=putInFront.concat(parsed.body);return parsed;}function computeDefRanges(parsed,options){var topLevel=topLevelDeclsAndRefs$1(parsed);return chain$1(topLevel.scope.varDecls).pluck('declarations').flatten().value().concat(topLevel.scope.funcDecls.filter(function(ea){return ea.id;})).reduce(function(defs,decl){if(!defs[decl.id.name])defs[decl.id.name]=[];defs[decl.id.name].push({type:decl.type,start:decl.start,end:decl.end});return defs;},{});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// capturing oobject patters / destructuring
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var annotationSym=Symbol('lively.ast-destructuring-transform');function transformPattern(pattern,transformState){// For transforming destructuring expressions into plain vars and member access.
// Takes a var or argument pattern node (of type ArrayPattern or
// ObjectPattern) and transforms it into a set of var declarations that will
// "pull out" the nested properties
// Example:
// var parsed = parse("var [{b: {c: [a]}}] = foo;");
// var state = {parent: {type: "Identifier", name: "arg"}, declaredNames: ["foo"]}
// transformPattern(parsed.body[0].declarations[0].id, state).map(stringify).join("\n");
// // => "var arg$0 = arg[0];\n"
// //  + "var arg$0$b = arg$0.b;\n"
// //  + "var arg$0$b$c = arg$0$b.c;\n"
// //  + "var a = arg$0$b$c[0];"
return pattern.type==='ArrayPattern'?transformArrayPattern(pattern,transformState):pattern.type==='ObjectPattern'?transformObjectPattern(pattern,transformState):[];}function transformArrayPattern(pattern,transformState){var declaredNames=transformState.declaredNames;var p=annotationSym;var transformed=[];for(var _i88=0;_i88<pattern.elements.length;_i88++){var el=pattern.elements[_i88];// like [a]
if(el.type==='Identifier'){var decl=varDecl$1(el,member$1(transformState.parent,id$1(_i88),true));decl[p]={capture:true};transformed.push(decl);// like [...foo]
}else if(el.type==='RestElement'){var decl=varDecl$1(el.argument,{type:'CallExpression',arguments:[{type:'Literal',value:_i88}],callee:member$1(transformState.parent,id$1('slice'),false)});decl[p]={capture:true};transformed.push(decl);}else if(el.type=='AssignmentPattern'){// like [x = 23]
var decl=varDecl$1(el.left/* id */,conditional$1(binaryExpr$1(member$1(transformState.parent,id$1(_i88),true),'===',id$1('undefined')),el.right,member$1(transformState.parent,id$1(_i88),true)));decl[p]={capture:true};transformed.push(decl);// like [{x}]
}else{var helperVarId=id$1(generateUniqueName(declaredNames,transformState.parent.name+'$'+_i88));var helperVar=varDecl$1(helperVarId,member$1(transformState.parent,_i88));// helperVar[p] = {capture: true};
declaredNames.push(helperVarId.name);transformed.push(helperVar);transformed.push.apply(transformed,_toConsumableArray2(transformPattern(el,{parent:helperVarId,declaredNames:declaredNames})));}}return transformed;}function transformObjectPattern(pattern,transformState){var declaredNames=transformState.declaredNames;var p=annotationSym;var transformed=[];for(var _i89=0;_i89<pattern.properties.length;_i89++){var _prop5=pattern.properties[_i89];if(_prop5.type=='RestElement'){var knownKeys=pattern.properties.map(function(ea){return ea.key&&ea.key.name;}).filter(Boolean);var decl=varDecl(_prop5.argument.name,objectLiteral([]));var captureDecl=varDecl(_prop5.argument.name,id$1(_prop5.argument.name));var defCall=exprStmt(funcCall(funcExpr({},[],forIn('__key',transformState.parent,block$1.apply(void 0,_toConsumableArray2(knownKeys.length?knownKeys.map(function(knownKey){return ifStmt(binaryExpr(id('__key'),'===',literal$2(knownKey)),{type:'ContinueStatement',label:null},null);}):[]).concat([exprStmt(assign(member(_prop5.argument.name,id('__key'),true),member(transformState.parent,id('__key'),true)))]))))));captureDecl[p]={capture:true};transformed.push(decl,captureDecl,defCall);}else if(_prop5.value.type=='Identifier'){// like {x: y}
var decl=varDecl$1(_prop5.value,member$1(transformState.parent,_prop5.key));decl[p]={capture:true};transformed.push(decl);}else if(_prop5.value.type=='AssignmentPattern'){// like {x = 23}
var decl=varDecl$1(_prop5.value.left/* id */,conditional$1(binaryExpr$1(member$1(transformState.parent,_prop5.key),'===',id$1('undefined')),_prop5.value.right,member$1(transformState.parent,_prop5.key)));decl[p]={capture:true};transformed.push(decl);}else{// like {x: {z}} or {x: [a]}
var helperVarId=id$1(generateUniqueName(declaredNames,transformState.parent.name+'$'+_prop5.key.name));var helperVar=varDecl$1(helperVarId,member$1(transformState.parent,_prop5.key));helperVar[p]={capture:false};declaredNames.push(helperVarId.name);transformed.push.apply(transformed,_toConsumableArray2([helperVar].concat(transformPattern(_prop5.value,{parent:helperVarId,declaredNames:declaredNames}))));}}return transformed;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// code generation helpers
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function varDeclOrAssignment(parsed,declarator,kind){var topLevel=topLevelDeclsAndRefs$1(parsed);var name=declarator.id.name;return topLevel.declaredNames.indexOf(name)>-1// only create a new declaration if necessary
?exprStmt$1(assign$1(declarator.id,declarator.init)):{declarations:[declarator],kind:kind||'var',type:'VariableDeclaration'};}function assignExpr(assignee,propId,value,computed){return exprStmt$1(assign$1(member$1(assignee,propId,computed),value||id$1('undefined')));}function exportFromImport(keyLeft,keyRight,moduleId,moduleExportFunc,moduleImportFunc){return exportCall(moduleExportFunc,keyLeft,importCall(keyRight,moduleId,moduleImportFunc));}function varDeclAndImportCall(parsed,localId,imported,moduleSource,moduleImportFunc){// return varDeclOrAssignment(parsed, {
//   type: "VariableDeclarator",
//   id: localId,
//   init: importCall(imported, moduleSource, moduleImportFunc)
// });
return varDecl$1(localId,importCall(imported,moduleSource,moduleImportFunc));}function importCall(imported,moduleSource,moduleImportFunc){if(typeof imported==='string')imported=literal$3(imported);return{arguments:[moduleSource].concat(imported||[]),callee:moduleImportFunc,type:'CallExpression'};}function importCallStmt(imported,moduleSource,moduleImportFunc){return exprStmt$1(importCall(imported,moduleSource,moduleImportFunc));}function exportCall(exportFunc,local,exportedObj){if(typeof local==='string')local=literal$3(local);exportedObj=deepCopy(exportedObj);return funcCall$1(exportFunc,local,exportedObj);}function exportCallStmt(exportFunc,local,exportedObj){return exprStmt$1(exportCall(exportFunc,local,exportedObj));}function declarationWrapperCall(declarationWrapperNode,declNode,varNameLiteral,varKindLiteral,valueNode,recorder,options){if(declNode){// here we pass compile-time meta data into the runtime
var keyVals=[];var addMeta=false;if(declNode['x-lively-object-meta']){var _declNode$xLivelyOb=declNode['x-lively-object-meta'],start=_declNode$xLivelyOb.start,end=_declNode$xLivelyOb.end,evalId=_declNode$xLivelyOb.evalId,sourceAccessorName=_declNode$xLivelyOb.sourceAccessorName;addMeta=true;keyVals.push('start',literal$2(start),'end',literal$2(end));}if(evalId===undefined&&options.hasOwnProperty('evalId')){evalId=options.evalId;addMeta=true;}if(sourceAccessorName===undefined&&options.hasOwnProperty('sourceAccessorName')){sourceAccessorName=options.sourceAccessorName;addMeta=true;}if(evalId!==undefined)keyVals.push('evalId',literal$2(evalId));if(sourceAccessorName)keyVals.push('moduleSource',id(sourceAccessorName));if(addMeta){return funcCall$1(declarationWrapperNode,varNameLiteral,varKindLiteral,valueNode,recorder,objectLiteral(keyVals)/* meta node */);}}return funcCall$1(declarationWrapperNode,varNameLiteral,varKindLiteral,valueNode,recorder);}var exports$c={};Object.defineProperty(exports$c,"__esModule",{value:true});exports$c.declare=declare;function declare(builder){return function(api,options,dirname){var _clonedApi2;var clonedApi;for(var _i90=0,_Object$keys=Object.keys(apiPolyfills);_i90<_Object$keys.length;_i90++){var name=_Object$keys[_i90];var _clonedApi;if(api[name])continue;clonedApi=(_clonedApi=clonedApi)!=null?_clonedApi:copyApiObject(api);clonedApi[name]=apiPolyfills[name](clonedApi);}return builder((_clonedApi2=clonedApi)!=null?_clonedApi2:api,options||{},dirname);};}var apiPolyfills={assertVersion:function assertVersion(api){return function(range){throwVersionError(range,api.version);};},targets:function targets(){return function(){return{};};},assumption:function assumption(){return function(){};}};function copyApiObject(api){var proto=null;if(typeof api.version==="string"&&/^7\./.test(api.version)){proto=Object.getPrototypeOf(api);if(proto&&(!has$3(proto,"version")||!has$3(proto,"transform")||!has$3(proto,"template")||!has$3(proto,"types"))){proto=null;}}return Object.assign({},proto,api);}function has$3(obj,key){return Object.prototype.hasOwnProperty.call(obj,key);}function throwVersionError(range,version){if(typeof range==="number"){if(!Number.isInteger(range)){throw new Error("Expected string or integer value.");}range="^".concat(range,".0.0-0");}if(typeof range!=="string"){throw new Error("Expected string or integer value.");}var limit=Error.stackTraceLimit;if(typeof limit==="number"&&limit<25){Error.stackTraceLimit=25;}var err;if(version.slice(0,2)==="7."){err=new Error("Requires Babel \"^7.0.0-beta.41\", but was loaded with \"".concat(version,"\". ")+"You'll need to update your @babel/core version.");}else{err=new Error("Requires Babel \"".concat(range,"\", but was loaded with \"").concat(version,"\". ")+"If you are sure you have a compatible version of @babel/core, "+"it is likely that something in your build process is loading the "+"wrong version. Inspect the stack trace of this error to look for "+"the first entry that doesn't mention \"@babel/core\" or \"babel-core\" "+"to see what is calling Babel.");}if(typeof limit==="number"){Error.stackTraceLimit=limit;}throw Object.assign(err,{code:"BABEL_VERSION_UNSUPPORTED",version:version,range:range});}var __esModule=exports$c.__esModule;var _declare=exports$c.declare;var _helperPluginUtils3=/*#__PURE__*/Object.freeze({__proto__:null,'default':exports$c,__esModule:__esModule,declare:_declare});var exports$d={};Object.defineProperty(exports$d,"__esModule",{value:true});exports$d["default"]=void 0;var _helperPluginUtils=exports$c;var _default=(0,_helperPluginUtils.declare)(function(api){api.assertVersion(7);return{name:"syntax-optional-catch-binding",manipulateOptions:function manipulateOptions(opts,parserOpts){parserOpts.plugins.push("optionalCatchBinding");}};});exports$d["default"]=_default;var __esModule$1=exports$d.__esModule;var _pluginSyntaxOptionalCatchBinding3=/*#__PURE__*/Object.freeze({__proto__:null,'default':exports$d,__esModule:__esModule$1});var _helperPluginUtils2="default"in _helperPluginUtils3?exports$c:_helperPluginUtils3;var _pluginSyntaxOptionalCatchBinding2="default"in _pluginSyntaxOptionalCatchBinding3?exports$d:_pluginSyntaxOptionalCatchBinding3;var exports$e={};Object.defineProperty(exports$e,"__esModule",{value:true});exports$e["default"]=void 0;var _helperPluginUtils$1=_helperPluginUtils2;var _pluginSyntaxOptionalCatchBinding=_pluginSyntaxOptionalCatchBinding2;var _default$1=(0,_helperPluginUtils$1.declare)(function(api){api.assertVersion(7);return{name:"proposal-optional-catch-binding",inherits:_pluginSyntaxOptionalCatchBinding["default"],visitor:{CatchClause:function CatchClause(path){if(!path.node.param){var uid=path.scope.generateUidIdentifier("unused");var paramPath=path.get("param");paramPath.replaceWith(uid);}}}};});exports$e["default"]=_default$1;var exports$f={};Object.defineProperty(exports$f,"__esModule",{value:true});exports$f["default"]=void 0;var _helperPluginUtils$2=exports$c;var _default$2=(0,_helperPluginUtils$2.declare)(function(api){api.assertVersion(7);return{name:"syntax-import-meta",manipulateOptions:function manipulateOptions(opts,parserOpts){parserOpts.plugins.push("importMeta");}};});exports$f["default"]=_default$2;/* global global, babel */ // fixme: this is a sort of bad placement
function ensureJSXPlugin(){if(!transformJSX__default['default'])return;typeof babel!=='undefined'&&!babel.availablePlugins['transform-jsx']&&!(lively||global.lively).FreezerRuntime&&babel.registerPlugin('transform-jsx',transformJSX__default['default']["default"]);}function ensureOptionalCatchBinding(){if(!exports$e)return;typeof babel!=='undefined'&&!babel.availablePlugins['optional-catch-binding']&&!(lively||global.lively).FreezerRuntime&&babel.registerPlugin('optional-catch-binding',exports$e["default"]);}function ensureImportMeta(){if(!exports$f)return;typeof babel!=='undefined'&&!babel.availablePlugins['syntax-import-meta']&&!(lively||global.lively).FreezerRuntime&&babel.registerPlugin('syntax-import-meta',exports$f["default"]);}function es5Transpilation(source){if(typeof babel==='undefined'){console.warn('[lively.freezer] Skipped async/await transpilation because babel not loaded.');return source;}ensureJSXPlugin();ensureOptionalCatchBinding();ensureImportMeta();var options={sourceMap:undefined,// 'inline' || true || false
inputSourceMap:undefined,babelrc:false,presets:[['es2015',{modules:false}]],plugins:['transform-exponentiation-operator','transform-async-to-generator','syntax-object-rest-spread','transform-object-rest-spread'// 'syntax-import-meta', 'optional-catch-binding',
// ['transform-jsx', { "module": 'lively.ide/jsx/generator.js'}]
],code:true,ast:false};// System.babelOptions.plugins.push('optional-catch-binding')
var sourceForBabel=source;var transpiled=babel.transform(sourceForBabel,options).code;transpiled=transpiled.replace(/\}\)\.call\(undefined\);$/,'}).call(this)');if(transpiled.startsWith('(function')&&transpiled.endsWith(');'))transpiled=transpiled.slice(1,-2);return transpiled;}var id$2=nodes.id,literal$4=nodes.literal,member$2=nodes.member,objectLiteral$1=nodes.objectLiteral;var defaultDeclarationWrapperName="lively.capturing-declaration-wrapper",defaultClassToFunctionConverterName="initializeES6ClassForLively";function processInlineCodeTransformOptions(parsed,options){if(!parsed.comments)return options;var livelyComment=parsed.comments.find(function(ea){return ea.text.startsWith("lively.vm ");});if(!livelyComment)return options;try{var inlineOptions=eval("inlineOptions = {"+livelyComment.text.slice("lively.vm ".length)+"};");return Object.assign(options,inlineOptions);}catch(err){return options;}}function evalCodeTransform(code,options){// variable declaration and references in the the source code get
// transformed so that they are bound to `varRecorderName` aren't local
// state. THis makes it possible to capture eval results, e.g. for
// inspection, watching and recording changes, workspace vars, and
// incrementally evaluating var declarations and having values bound later.
// 1. Allow evaluation of function expressions and object literals
code=transformSingleExpression(code);var parsed=parse$2(code,{withComments:true});options=processInlineCodeTransformOptions(parsed,options);// 2. Annotate definitions with code location. This is being used by the
// function-wrapper-source transform.
var _topLevelDeclsAndRefs=topLevelDeclsAndRefs(parsed),classDecls=_topLevelDeclsAndRefs.classDecls,funcDecls=_topLevelDeclsAndRefs.funcDecls,varDecls=_topLevelDeclsAndRefs.varDecls,annotation={};if(options.hasOwnProperty("evalId"))annotation.evalId=options.evalId;if(options.sourceAccessorName)annotation.sourceAccessorName=options.sourceAccessorName;[].concat(_toConsumableArray2(classDecls),_toConsumableArray2(funcDecls)).forEach(function(node){return node["x-lively-object-meta"]=_objectSpread(_objectSpread({},annotation),{},{start:node.start,end:node.end});});varDecls.forEach(function(node){return node.declarations.forEach(function(decl){return decl["x-lively-object-meta"]=_objectSpread(_objectSpread({},annotation),{},{start:decl.start,end:decl.end});});});// transforming experimental ES features into accepted es6 form...
parsed=objectSpreadTransform(parsed);// 3. capture top level vars into topLevelVarRecorder "environment"
if(!options.topLevelVarRecorder&&options.topLevelVarRecorderName){var _G=getGlobal();if(options.topLevelVarRecorderName==="GLOBAL"){// "magic"
options.topLevelVarRecorder=getGlobal();}else{options.topLevelVarRecorder=Path(options.topLevelVarRecorderName).get(_G);}}if(options.topLevelVarRecorder){// capture and wrap logic
var blacklist=(options.dontTransform||[]).concat(["arguments"]),undeclaredToTransform=!!options.recordGlobals?null/*all*/:withoutAll(Object.keys(options.topLevelVarRecorder),blacklist),varRecorder=id$2(options.varRecorderName||'__lvVarRecorder'),es6ClassToFunctionOptions=undefined;if(options.declarationWrapperName||typeof options.declarationCallback==="function"){// 2.1 declare a function that wraps all definitions, i.e. all var
// decls, functions, classes etc that get captured will be wrapped in this
// function. This allows to define some behavior that is run whenever
// variables get initialized or changed as well as transform values.
// The parameters passed are:
//   name, kind, value, recorder
// Note that the return value of declarationCallback is used as the
// actual value in the code being executed. This allows to transform the
// value as necessary but also means that declarationCallback needs to
// return sth meaningful!
var declarationWrapperName=options.declarationWrapperName||defaultDeclarationWrapperName;options.declarationWrapper=member$2(id$2(options.varRecorderName||'__lvVarRecorder'),literal$4(declarationWrapperName),true);if(options.declarationCallback)options.topLevelVarRecorder[declarationWrapperName]=options.declarationCallback;}var transformES6Classes=options.hasOwnProperty("transformES6Classes")?options.transformES6Classes:true;if(transformES6Classes){// Class declarations and expressions are converted into a function call
// to `createOrExtendClass`, a helper that will produce (or extend an
// existing) constructor function in a way that allows us to redefine
// methods and properties of the class while keeping the class object
// identical
es6ClassToFunctionOptions={currentModuleAccessor:options.currentModuleAccessor,classHolder:varRecorder,functionNode:member$2(varRecorder,defaultClassToFunctionConverterName),declarationWrapper:options.declarationWrapper,evalId:options.evalId,sourceAccessorName:options.sourceAccessorName,transform:options.classTransform};}// 3.2 Here we call out to the actual code transformation that installs the captured top level vars
parsed=rewriteToCaptureTopLevelVariables(parsed,varRecorder,{es6ImportFuncId:options.es6ImportFuncId,es6ExportFuncId:options.es6ExportFuncId,ignoreUndeclaredExcept:undeclaredToTransform,exclude:blacklist,declarationWrapper:options.declarationWrapper||undefined,classToFunction:es6ClassToFunctionOptions,evalId:options.evalId,sourceAccessorName:options.sourceAccessorName,keepTopLevelVarDecls:options.keepTopLevelVarDecls});}if(options.wrapInStartEndCall){parsed=wrapInStartEndCall(parsed,{startFuncNode:options.startFuncNode,endFuncNode:options.endFuncNode});}var result=stringify(parsed);if(options.jsx)result=es5Transpilation(result);if(options.sourceURL)result+="\n//# sourceURL="+options.sourceURL.replace(/\s/g,"_");return result;}function evalCodeTransformOfSystemRegisterSetters(code){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!options.topLevelVarRecorder)return code;if(typeof options.declarationCallback==="function"||options.declarationWrapperName){var declarationWrapperName=options.declarationWrapperName||defaultDeclarationWrapperName;options.declarationWrapper=member$2(id$2(options.varRecorderName),literal$4(declarationWrapperName),true);if(options.declarationCallback)options.topLevelVarRecorder[declarationWrapperName]=options.declarationCallback;}var parsed=parse$2(code),blacklist=(options.dontTransform||[]).concat(["arguments"]),undeclaredToTransform=!!options.recordGlobals?null/*all*/:withoutAll(Object.keys(options.topLevelVarRecorder),blacklist),result=rewriteToRegisterModuleToCaptureSetters(parsed,id$2(options.varRecorderName||'__lvVarRecorder'),_objectSpread({exclude:blacklist},options));return stringify(result);}/*global: global, System*/ // -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// eval
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// this is needed to prevent google closure from optimizing away the variable names
var _eval=Closure.fromSource("function _eval(__lvEvalStatement, __lvVarRecorder/*needed as arg for capturing*/, __lvOriginalCode) {\n  return eval(__lvEvalStatement);\n}").getFunc();/*global System*/ // type EventType = string
// type EventTime = number
// type Notification = {type: EventType, time: EventTime, ...};
// type Handler = Notification -> ()
// type Notifications = { [number]: Notification, limit: number }
// type Emitter = {isRecording: boolean, isLogging: boolean, ... }
// type Env = {emitter: Emitter, notifications: Notifications}
var env=null;function getEnv(_System){// System? -> Env
if(_System===undefined){if(typeof System==="undefined"){// fallback if not System is available
return env;}_System=System;}var livelyEnv=_System.get("@lively-env");if(!livelyEnv)_System.set("@lively-env",_System.newModule({options:{}}));var options=livelyEnv.options;if(!options)throw new Error("@lively-env registered read-only");if(!options.emitter){Object.assign(options,{emitter:_System["__lively.notifications_emitter"]||(_System["__lively.notifications_emitter"]=makeEmitter({},{maxListenerLimit:10000})),notifications:_System["__lively.notifications_notifications"]||(_System["__lively.notifications_notifications"]=[])});}var emitter=options.emitter,notifications=options.notifications;return{emitter:emitter,notifications:notifications};}function subscribe(type,handler,system){// EventType, Handler, System? -> Handler
getEnv(system).emitter.on(type,handler);return handler;}function emit(type){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var time=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Date.now();var system=arguments.length>3?arguments[3]:undefined;// EventType, Notification?, EventTime?, System? -> Notification
var notification=Object.assign({type:type,time:time},data),_getEnv=getEnv(system),emitter=_getEnv.emitter,notifications=_getEnv.notifications;emitter.emit(type,notification);if(emitter.isLogging)log(notification);if(emitter.isRecording)record(notifications,notification);return notification;}function unsubscribe(type,handler,system){// EventType, Handler, System? -> Handler
getEnv(system).emitter.removeListener(type,handler);return handler;}function record(notifications,notification){// Array<Notification>, Notification -> ()
notifications.push(notification);if(notifications.limit){notifications.splice(0,notifications.length-notifications.limit);}}function log(notification){// Notification -> ()
var padded=notification.type+" ".repeat(Math.max(0,32-notification.type.length));console.log(padded+" "+inspect(notification,{maxDepth:2}));}function computeRequireMap(System){if(System.loads){var store=System.loads,modNames=uniq(Object.keys(loadedModules(System)).concat(Object.keys(store)));return modNames.reduce(function(requireMap,k){var depMap=store[k]?store[k].depMap:{};requireMap[k]=Object.keys(depMap).map(function(localName){var resolvedName=depMap[localName];if(resolvedName==="@empty")return"".concat(resolvedName,"/").concat(localName);return resolvedName;});return requireMap;},{});}return Object.keys(System._loader.moduleRecords).reduce(function(requireMap,k){requireMap[k]=System._loader.moduleRecords[k].dependencies.filter(Boolean).map(function(ea){return ea.name;});return requireMap;},{});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Changing exports of module
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function scheduleModuleExportsChange(System,moduleId,name,value,addNewExport){var pendingExportChanges=System.get("@lively-env").pendingExportChanges,rec=module$1(System,moduleId).record();if(rec&&(name in rec.exports||addNewExport)){var pending=pendingExportChanges[moduleId]||(pendingExportChanges[moduleId]={});pending[name]=value;}}function runScheduledExportChanges(System,moduleId){var pendingExportChanges=System.get("@lively-env").pendingExportChanges,keysAndValues=pendingExportChanges[moduleId];if(!keysAndValues)return;clearPendingModuleExportChanges(System,moduleId);updateModuleExports(System,moduleId,keysAndValues);}function clearPendingModuleExportChanges(System,moduleId){var pendingExportChanges=System.get("@lively-env").pendingExportChanges;delete pendingExportChanges[moduleId];}function updateModuleExports(System,moduleId,keysAndValues){var debug=System.debug;module$1(System,moduleId).updateRecord(function(record){var newExports=[],existingExports=[];Object.keys(keysAndValues).forEach(function(name){var value=keysAndValues[name];debug&&console.log("[lively.vm es6 updateModuleExports] %s export %s = %s",moduleId,name,String(value).slice(0,30).replace(/\n/g,"")+"...");var isNewExport=!(name in record.exports);if(isNewExport)record.__lively_modules__.evalOnlyExport[name]=true;// var isEvalOnlyExport = record.__lively_vm__.evalOnlyExport[name];
record.exports[name]=value;if(isNewExport)newExports.push(name);else existingExports.push(name);});// if it's a new export we don't need to update dependencies, just the
// module itself since no depends know about the export...
// HMM... what about *-imports?
if(newExports.length){var m=System.get(moduleId);if(Object.isFrozen(m)){console.warn("[lively.vm es6 updateModuleExports] Since module %s is frozen a new module object was installed in the system. Note that only(!) exisiting module bindings are updated. New exports that were added will only be available in already loaded modules after those are reloaded!",moduleId);System.set(moduleId,System.newModule(record.exports));}else{debug&&console.log("[lively.vm es6 updateModuleExports] adding new exports to %s",moduleId);newExports.forEach(function(name){Object.defineProperty(m,name,{configurable:false,enumerable:true,get:function get(){return record.exports[name];},set:function set(){throw new Error("exports cannot be changed from the outside");}});});}}if(existingExports.length){debug&&console.log("[lively.vm es6 updateModuleExports] updating %s dependents of %s",record.importers.length,moduleId);for(var i=0,l=record.importers.length;i<l;i++){var importerModule=record.importers[i];if(!importerModule.locked){// via the module bindings to importer modules we refresh the values
// bound in those modules by triggering the setters defined in the
// records of those modules
var importerIndex,found=importerModule.dependencies.some(function(dep,i){importerIndex=i;return dep&&dep.name===record.name;});if(found){if(debug){var mod=module$1(System,importerModule.name);console.log("[lively.vm es6 updateModuleExports] calling setters of ".concat(mod["package"]().name,"/").concat(mod.pathInPackage()));}// We could run the entire module again with
//   importerModule.execute();
// but this has too many unwanted side effects, so just run the
// setters:
module$1(System,importerModule.name).evaluationStart();importerModule.setters[importerIndex](record.exports);module$1(System,importerModule.name).evaluationEnd();}}}}});}function moduleSourceChange(_x,_x2,_x3,_x4,_x5){return _moduleSourceChange.apply(this,arguments);}function _moduleSourceChange(){_moduleSourceChange=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee87(System,moduleId,newSource,format,options){var changeResult;return regeneratorRuntime.wrap(function _callee87$(_context87){while(1){switch(_context87.prev=_context87.next){case 0:_context87.prev=0;System.debug&&console.log("[module change] ".concat(moduleId," ").concat(newSource.slice(0,50).replace(/\n/g,"")," ").concat(format));if(!(!format||format==="es6"||format==="esm"||format==="register"||format==="defined")){_context87.next=8;break;}_context87.next=5;return moduleSourceChangeEsm(System,moduleId,newSource,options);case 5:changeResult=_context87.sent;_context87.next=15;break;case 8:if(!(format==="global")){_context87.next=14;break;}_context87.next=11;return moduleSourceChangeGlobal(System,moduleId,newSource,options);case 11:changeResult=_context87.sent;_context87.next=15;break;case 14:throw new Error("moduleSourceChange is not supported for module ".concat(moduleId," with format ").concat(format));case 15:emit("lively.modules/modulechanged",{module:moduleId,newSource:newSource,options:options},Date.now(),System);return _context87.abrupt("return",changeResult);case 19:_context87.prev=19;_context87.t0=_context87["catch"](0);emit("lively.modules/modulechanged",{module:moduleId,newSource:newSource,error:_context87.t0,options:options},Date.now(),System);throw _context87.t0;case 23:case"end":return _context87.stop();}}},_callee87,null,[[0,19]]);}));return _moduleSourceChange.apply(this,arguments);}function moduleSourceChangeEsm(_x6,_x7,_x8,_x9){return _moduleSourceChangeEsm.apply(this,arguments);}function _moduleSourceChangeEsm(){_moduleSourceChangeEsm=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee88(System,moduleId,newSource,options){var debug,load,updateData,_exports,declared,deps,_iterator49,_step49,depName,depId,depModule,exports,prevLoad,mod,record;return regeneratorRuntime.wrap(function _callee88$(_context88){while(1){switch(_context88.prev=_context88.next){case 0:debug=System.debug,load={status:'loading',source:newSource,name:moduleId,address:moduleId,linkSets:[],dependencies:[],metadata:{format:"esm"}};// translate the source and produce a {declare: FUNCTION, localDeps:
// [STRING]} object
_context88.next=3;return instrumentSourceOfEsmModuleLoad(System,load);case 3:updateData=_context88.sent;// evaluate the module source, to get the register module object with execute
// and setters fields
_exports=function _exports(name,val){return scheduleModuleExportsChange(System,load.name,name,val,true);},declared=updateData.declare(_exports);debug&&console.log("[lively.vm es6] sourceChange of %s with deps",load.name,updateData.localDeps);// ensure dependencies are loaded
deps=[];_iterator49=_createForOfIteratorHelper(updateData.localDeps);_context88.prev=8;_iterator49.s();case 10:if((_step49=_iterator49.n()).done){_context88.next=22;break;}depName=_step49.value;_context88.next=14;return System.normalize(depName,load.name);case 14:depId=_context88.sent;depModule=classHolder.module(System,depId);_context88.next=18;return depModule.load();case 18:exports=_context88.sent;deps.push({name:depName,fullname:depId,module:depModule,exports:exports});case 20:_context88.next=10;break;case 22:_context88.next=27;break;case 24:_context88.prev=24;_context88.t0=_context88["catch"](8);_iterator49.e(_context88.t0);case 27:_context88.prev=27;_iterator49.f();return _context88.finish(27);case 30:// hmm... for house keeping... not really needed right now, though
prevLoad=System.loads&&System.loads[load.name];if(prevLoad){prevLoad.deps=deps.map(function(ea){return ea.name;});prevLoad.depMap=deps.reduce(function(map,dep){map[dep.name]=dep.fullname;return map;},{});if(prevLoad.metadata&&prevLoad.metadata.entry){prevLoad.metadata.entry.deps=prevLoad.deps;prevLoad.metadata.entry.normalizedDeps=deps.map(function(ea){return ea.fullname;});prevLoad.metadata.entry.declare=updateData.declare;}}mod=classHolder.module(System,load.name),record=mod.record();// 1. update the record so that when its dependencies change and cause a
// re-execute, the correct code (new version) is run
deps.forEach(function(ea,i){return mod.addDependencyToModuleRecord(ea.module,declared.setters[i]);});if(record)record.execute=declared.execute;// 2. run setters to populate imports
deps.forEach(function(d,i){return declared.setters[i](d.exports);});// 3. execute module body
return _context88.abrupt("return",declared.execute());case 37:case"end":return _context88.stop();}}},_callee88,null,[[8,24,27,30]]);}));return _moduleSourceChangeEsm.apply(this,arguments);}function moduleSourceChangeGlobal(_x10,_x11,_x12,_x13){return _moduleSourceChangeGlobal.apply(this,arguments);}function _moduleSourceChangeGlobal(){_moduleSourceChangeGlobal=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee89(System,moduleId,newSource,options){var load,updateData,entry;return regeneratorRuntime.wrap(function _callee89$(_context89){while(1){switch(_context89.prev=_context89.next){case 0:load={status:'loading',source:newSource,name:moduleId,address:moduleId,linkSets:[],dependencies:[],metadata:{format:"global"}};if(System.get(moduleId)){_context89.next=4;break;}_context89.next=4;return System["import"](moduleId);case 4:_context89.next=6;return instrumentSourceOfGlobalModuleLoad(System,load);case 6:updateData=_context89.sent;load.source=updateData.translated;entry=doInstantiateGlobalModule(System,load);System["delete"](moduleId);System.set(entry.name,entry.esModule);return _context89.abrupt("return",entry.module);case 12:case"end":return _context89.stop();}}},_callee89);}));return _moduleSourceChangeGlobal.apply(this,arguments);}function doInstantiateGlobalModule(System,load){var entry=__createEntry();entry.name=load.name;entry.esmExports=true;load.metadata.entry=entry;entry.deps=[];for(var g in load.metadata.globals){var gl=load.metadata.globals[g];if(gl)entry.deps.push(gl);}entry.execute=function executeGlobalModule(require,exports,m){// SystemJS exports detection for global modules is based in new props
// added to the global. In order to allow re-load we remove previously
// "exported" values
var prevMeta=classHolder.module(System,m.id).metadata(),exports=prevMeta&&prevMeta.entry&&prevMeta.entry.module&&prevMeta.entry.module.exports;if(exports)Object.keys(exports).forEach(function(name){try{delete System.global[name];}catch(e){console.warn("[lively.modules] executeGlobalModule: Cannot delete global[\"".concat(name,"\"]"));}});var globals;if(load.metadata.globals){globals={};for(var g in load.metadata.globals){if(load.metadata.globals[g])globals[g]=require(load.metadata.globals[g]);}}var exportName=load.metadata.exports;if(exportName)load.source+="\nSystem.global[\"".concat(exportName,"\"] = ").concat(exportName,";");var retrieveGlobal=System.get('@@global-helpers').prepareGlobal(m.id,exportName,globals);__evaluateGlobalLoadSource(System,load);return retrieveGlobal();};return runExecuteOfGlobalModule(System,entry);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function __createEntry(){return{name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:false,declarative:false,normalizedDeps:null,groupIndex:null,evaluated:false,module:null,esModule:null,esmExports:false};}function __evaluateGlobalLoadSource(System,load){// System clobbering protection (mostly for Traceur)
var curLoad,curSystem,callCounter=0,__global=System.global;return __exec.call(System,load);function preExec(loader,load){if(callCounter++==0)curSystem=__global.System;__global.System=__global.SystemJS=loader;}function postExec(){if(--callCounter==0)__global.System=__global.SystemJS=curSystem;curLoad=undefined;}function __exec(load){// if ((load.metadata.integrity || load.metadata.nonce) && supportsScriptExec)
//   return scriptExec.call(this, load);
try{preExec(this,load);curLoad=load;(0,eval)(load.source);postExec();}catch(e){postExec();throw new Error("Error evaluating ".concat(load.address,":\n").concat(e.stack));}}}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function runExecuteOfGlobalModule(System,entry){// if (entry.module) return;
var exports={},module=entry.module={exports:exports,id:entry.name};// // AMD requires execute the tree first
// if (!entry.executingRequire) {
//   for (var i = 0, l = entry.normalizedDeps.length; i < l; i++) {
//     var depName = entry.normalizedDeps[i];
//     var depEntry = loader.defined[depName];
//     if (depEntry)
//       linkDynamicModule(depEntry, loader);
//   }
// }
// now execute
entry.evaluated=true;var output=entry.execute.call(System.global,function(name){var dep=entry.deps.find(function(dep){return dep===name;}),loadedDep=dep&&System.get(entry.normalizedDeps[entry.deps.indexOf(dep)])||System.get(System.decanonicalize(name,entry.name));if(loadedDep)return loadedDep;throw new Error('Module '+name+' not declared as a dependency of '+entry.name);},exports,module);if(output)module.exports=output;// create the esModule object, which allows ES6 named imports of dynamics
exports=module.exports;// __esModule flag treats as already-named
var Module=System.get("@system-env").constructor;if(exports&&(exports.__esModule||exports instanceof Module))entry.esModule=exports;// set module as 'default' export, then fake named exports by iterating properties
else if(entry.esmExports&&exports!==System.global)entry.esModule=System.newModule(exports);// just use the 'default' export
else entry.esModule={'default':exports};return entry;}function applyExclude(exclude,resources){if(Array.isArray(exclude)){return exclude.reduce(function(intersect,exclude){return applyExclude(exclude,intersect);},resources);}if(typeof exclude==='string'){return resources.filter(function(ea){return ea.path()!==exclude&&ea.name()!==exclude;});}if(exclude instanceof RegExp){return resources.filter(function(ea){return!exclude.test(ea.path())&&!exclude.test(ea.name());});}if(typeof exclude==='function'){return resources.filter(function(ea){return!exclude(ea);});}return resources;}/*

applyExclude(["foo", "foo"], [
  {path: () => "foo", name: () => "foo"},
  {path: () => "bar", name: () => "bar"},
  {path: () => "baz", name: () => "baz"}
])

applyExclude(["bar", "foo"], [
  {path: () => "foo", name: () => "foo"},
  {path: () => "bar", name: () => "bar"},
  {path: () => "baz", name: () => "baz"}
])

*/ // parseQuery('?hello=world&x={"foo":{"bar": "baz"}}')
// parseQuery("?db=test-object-db&url=lively.morphic%2Fworlds%2Fdefault.json&type=world&name=default&commitSpec=%7B%22user%22%3A%7B%22name%22%3A%22robert%22%2C%22realm%22%3A%22https%3A%2F%2Fauth.lively-next.org%22%2C%22email%22%3A%22robert%40kra.hn%22%7D%2C%22description%22%3A%22An%20empty%20world.%20A%20place%20to%20start%20from%20scratch.%22%2C%22metadata%22%3A%7B%22belongsToCore%22%3Atrue%7D%7D&purgeHistory=true")
function parseQuery(url){var url=url;var _url$split=url.split('?'),_url$split2=_slicedToArray2(_url$split,2),_=_url$split2[0],search=_url$split2[1];var query={};if(!search)return query;var args=search.split('&');if(args){for(var _i91=0;_i91<args.length;_i91++){var keyAndVal=args[_i91].split('=');var key=keyAndVal[0];var val=true;if(keyAndVal.length>1){val=decodeURIComponent(keyAndVal.slice(1).join('='));if(val==='undefined')val=undefined;else if(val.match(/^(true|false|null|[0-9"[{].*)$/)){try{val=JSON.parse(val);}catch(e){if(val[0]==='[')val=val.slice(1,-1).split(',');// handle string arrays
// if not JSON use string itself
}}}query[key]=val;}}return query;}function stringifyQuery(query){return Object.keys(query).map(function(key){return"".concat(key,"=").concat(encodeURIComponent(String(query[key])));}).join('&');}var urlRe=/^([^:\/]+):\/\/([^\/]*)(.*)/;// for resolve path:
var pathDotRe$1=/\/\.\//g;var pathDoubleDotRe$1=/\/[^\/]+\/\.\./;var pathDoubleSlashRe$1=/(^|[^:])[\/]+/g;function _withRelativePartsResolved(inputPath){var path=inputPath;var result=path;// foo//bar --> foo/bar
result=result.replace(pathDoubleSlashRe$1,'$1/');// foo/./bar --> foo/bar
result=result.replace(pathDotRe$1,'/');// /foo/../bar --> /bar
do{path=result;result=path.replace(pathDoubleDotRe$1,'');}while(result!=path);return result;}function _relativePathBetween_checkPathes(path1,path2){if(path1.startsWith('/'))path1=path1.slice(1);if(path2.startsWith('/'))path2=path2.slice(1);var paths1=path1.split('/');var paths2=path2.split('/');for(var i=0;i<paths2.length;i++){if(!paths1[i]||paths1[i]!=paths2[i])break;}// now that's some JavaScript FOO
var result='../'.repeat(Math.max(0,paths2.length-i-1))+paths1.splice(i,paths1.length).join('/');return result;}// pathA = "http://foo/bar/"
// pathB = "http://foo/bar/oink/baz.js";
function relativePathBetween(pathA,pathB){// produces the relative path to get from `pathA` to `pathB`
// Example:
//   relativePathBetween("/foo/bar/", "/foo/baz.js"); // => ../baz.js
var urlMatchA=pathA.match(urlRe);var urlMatchB=pathB.match(urlRe);var protocolA;var domainA;var protocolB;var domainB;var compatible=true;if(urlMatchA&&!urlMatchB||!urlMatchA&&urlMatchB)compatible=false;if(urlMatchA&&urlMatchB){protocolA=urlMatchA[1];domainA=urlMatchA[2];protocolB=urlMatchB[1];domainB=urlMatchB[2];if(protocolA!==protocolB)compatible=false;else if(domainA!==domainB)compatible=false;else{pathA=urlMatchA[3];pathB=urlMatchB[3];}}if(!compatible){throw new Error("[relativePathBetween] incompatible paths: ".concat(pathA," vs. ").concat(pathB));}pathA=_withRelativePartsResolved(pathA);pathB=_withRelativePartsResolved(pathB);if(pathA==pathB)return'';var relPath=_relativePathBetween_checkPathes(pathB,pathA);if(!relPath){throw new Error('pathname differs in relativePathFrom '+pathA+' vs '+pathB);}return relPath;}var extensions=extensions||[];function resource(url,opts){if(!url)throw new Error('lively.resource resource constructor: expects url but got '+url);if(url.isResource)return url;url=String(url);for(var _i92=0;_i92<extensions.length;_i92++){if(extensions[_i92].matches(url)){return new extensions[_i92].resourceClass(url,opts);}}throw new Error("Cannot find resource type for url ".concat(url));}function createFiles(_x14,_x15,_x16){return _createFiles.apply(this,arguments);}function _createFiles(){_createFiles=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee90(baseDir,fileSpec,opts){var base,name,_resource;return regeneratorRuntime.wrap(function _callee90$(_context90){while(1){switch(_context90.prev=_context90.next){case 0:// creates resources as specified in fileSpec, e.g.
// {"foo.txt": "hello world", "sub-dir/bar.js": "23 + 19"}
// supports both sync and async resources
base=resource(baseDir,opts).asDirectory();_context90.next=3;return base.ensureExistance();case 3:_context90.t0=regeneratorRuntime.keys(fileSpec);case 4:if((_context90.t1=_context90.t0()).done){_context90.next=18;break;}name=_context90.t1.value;if(fileSpec.hasOwnProperty(name)){_context90.next=8;break;}return _context90.abrupt("continue",4);case 8:_resource=base.join(name);if(!(_typeof2(fileSpec[name])==='object')){_context90.next=14;break;}_context90.next=12;return createFiles(_resource,fileSpec[name],opts);case 12:_context90.next=16;break;case 14:_context90.next=16;return _resource.write(fileSpec[name]);case 16:_context90.next=4;break;case 18:return _context90.abrupt("return",base);case 19:case"end":return _context90.stop();}}},_callee90);}));return _createFiles.apply(this,arguments);}function registerExtension(extension){// extension = {name: STRING, matches: FUNCTION, resourceClass: RESOURCE}
// name: uniquely identifying this extension
// predicate matches gets a resource url (string) passed and decides if the
// extension handles it
// resourceClass needs to implement the Resource interface
var name=extension.name;extensions=extensions.filter(function(ea){return ea.name!==name;}).concat(extension);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var windowsURLPrefixRe=/^file:\/\/\/[a-z]:\//i;var windowsPathPrefixRe=/^[a-z]:\//i;var windowsRootPathRe=/^[a-z]:\/$/i;var slashEndRe=/\/+$/;var slashStartRe=/^\/+/;var protocolRe=/^[a-z0-9-_\.]+:/;var slashslashRe=/^\/\/[^\/]+/;function nyi(obj,name){throw new Error("".concat(name," for ").concat(obj.constructor.name," not yet implemented"));}var Resource=/*#__PURE__*/function(){_createClass(Resource,null,[{key:"fromProps",value:function fromProps(){var props=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};// props can have the keys contentType, type, size, etag, created, lastModified, url
// it should have at least url
return new this(props.url).assignProperties(props);}}]);function Resource(url){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,Resource);if(!url)throw new Error('Cannot create resource without url');this.url=String(url);this.binary=false;this.lastModified=undefined;this.created=undefined;this.etag=undefined;this.size=undefined;this.type=undefined;this.contentType=undefined;this.user=undefined;this.group=undefined;this.mode=undefined;this._isDirectory=undefined;this._isLink=undefined;this.linkCount=undefined;}_createClass(Resource,[{key:"equals",value:function equals(otherResource){if(!otherResource||this.constructor!==otherResource.constructor){return false;}var myURL=this.url;var otherURL=otherResource.url;if(myURL[myURL.length-1]==='/')myURL=myURL.slice(0,-1);if(otherURL[otherURL.length-1]==='/')otherURL=otherURL.slice(0,-1);return myURL===otherURL;}},{key:"toString",value:function toString(){return"".concat(this.constructor.name,"(\"").concat(this.url,"\")");}},{key:"newResource",value:function newResource(url){return resource(url,this);}},{key:"path",value:function path(){var path=this.url.replace(protocolRe,'').replace(slashslashRe,'');return path===''?'/':path;}},{key:"pathWithoutQuery",value:function pathWithoutQuery(){return this.path().split('?')[0];}},{key:"name",value:function name(){var path=this.path();var queryIndex=path.lastIndexOf('?');if(queryIndex>-1)path=path.slice(0,queryIndex);if(path.endsWith('/'))path=path.slice(0,-1);var parts=path.split('/');var lastPart=parts[parts.length-1];return decodeURIComponent(lastPart);}},{key:"ext",value:function ext(){var url=this.url;if(url.endsWith('/'))return'';var _ref10=url.match(/\.([^\/\.]+$)/)||['',''],_ref11=_slicedToArray2(_ref10,2),_=_ref11[0],ext=_ref11[1];return ext.toLowerCase();}},{key:"nameWithoutExt",value:function nameWithoutExt(){var name=this.name();var extIndex=name.lastIndexOf('.');if(extIndex>0)name=name.slice(0,extIndex);return name;}},{key:"scheme",value:function scheme(){return this.url.split(':')[0];}},{key:"host",value:function host(){var idx=this.url.indexOf('://');if(idx===-1)return null;var noScheme=this.url.slice(idx+3);var slashIdx=noScheme.indexOf('/');return noScheme.slice(0,slashIdx>-1?slashIdx:noScheme.length);}},{key:"schemeAndHost",value:function schemeAndHost(){if(this.isRoot())return this.asFile().url;return this.url.slice(0,this.url.length-this.path().length);}},{key:"parent",value:function parent(){// drops the query
return this.isRoot()?null:this.newResource(this.url.split('?')[0].replace(slashEndRe,'').split('/').slice(0,-1).join('/')+'/');}},{key:"parents",value:function parents(){var result=[];var p=this.parent();while(p){result.unshift(p);p=p.parent();}return result;}},{key:"isParentOf",value:function isParentOf(otherRes){var _this2=this;return otherRes.schemeAndHost()===this.schemeAndHost()&&otherRes.parents().some(function(p){return p.equals(_this2);});}},{key:"query",value:function query(){return parseQuery(this.url);}},{key:"withQuery",value:function withQuery(queryObj){var query=_objectSpread(_objectSpread({},this.query()),queryObj);var _this$url$split=this.url.split('?'),_this$url$split2=_slicedToArray2(_this$url$split,1),url=_this$url$split2[0];var queryString=stringifyQuery(query);return this.newResource("".concat(url,"?").concat(queryString));}},{key:"commonDirectory",value:function commonDirectory(other){if(other.schemeAndHost()!==this.schemeAndHost())return null;if(this.isDirectory()&&this.equals(other))return this;if(this.isRoot())return this.asDirectory();if(other.isRoot())return other.asDirectory();var otherParents=other.parents();var myParents=this.parents();var common=this.root();for(var _i93=0;_i93<myParents.length;_i93++){var myP=myParents[_i93];var otherP=otherParents[_i93];if(!otherP||!myP.equals(otherP))return common;common=myP;}return common;}},{key:"withRelativePartsResolved",value:function withRelativePartsResolved(){var path=this.path();var result=_withRelativePartsResolved(path);if(result===path)return this;if(result.startsWith('/'))result=result.slice(1);if(result[1]===':'.startsWith('/'))result=result.slice(1);else if(result[1]===':'&&result.match(windowsPathPrefixRe))result=result.slice(3);return this.newResource(this.root().url+result);}},{key:"relativePathFrom",value:function relativePathFrom(fromResource){return relativePathBetween(fromResource.url,this.url);}},{key:"withPath",value:function withPath(path){var root=this.isRoot()?this:this.root();return root.join(path);}},{key:"join",value:function join(path){return this.newResource(this.url.replace(slashEndRe,'')+'/'+path.replace(slashStartRe,''));}},{key:"isRoot",value:function isRoot(){return this.path()==='/';}},{key:"isFile",value:function isFile(){return!this.isRoot()&&!this.url.match(slashEndRe);}},{key:"isDirectory",value:function isDirectory(){return!this.isFile();}},{key:"asDirectory",value:function asDirectory(){if(this.url.endsWith('/'))return this;return this.newResource(this.url.replace(slashEndRe,'')+'/');}},{key:"root",value:function root(){if(this.isRoot())return this;var toplevel=this.url.slice(0,-this.path().length);return this.newResource(toplevel+'/');}},{key:"asFile",value:function asFile(){if(!this.url.endsWith('/'))return this;return this.newResource(this.url.replace(slashEndRe,''));}},{key:"assignProperties",value:function assignProperties(props){// lastModified, etag, ...
for(var name in props){if(name==='url')continue;// rename some properties to not create conflicts
var myPropName=name;if(name==='isLink'||name==='isDirectory'){myPropName='_'+name;}this[myPropName]=props[name];}return this;}},{key:"ensureExistance",value:function(){var _ensureExistance=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee(optionalContent){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.exists();case 2:if(!_context.sent){_context.next=4;break;}return _context.abrupt("return",this);case 4:_context.next=6;return this.parent().ensureExistance();case 6:if(!this.isFile()){_context.next=11;break;}_context.next=9;return this.write(optionalContent||'');case 9:_context.next=13;break;case 11:_context.next=13;return this.mkdir();case 13:return _context.abrupt("return",this);case 14:case"end":return _context.stop();}}},_callee,this);}));function ensureExistance(_x17){return _ensureExistance.apply(this,arguments);}return ensureExistance;}()},{key:"copyTo",value:function(){var _copyTo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee2(otherResource){var _this3=this;var ensureParent,toFile,fromResources,toResources,_args2=arguments;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:ensureParent=_args2.length>1&&_args2[1]!==undefined?_args2[1]:true;if(!this.isFile()){_context2.next=14;break;}toFile=otherResource.isFile()?otherResource:otherResource.join(this.name());if(!ensureParent){_context2.next=6;break;}_context2.next=6;return toFile.parent().ensureExistance();case 6:_context2.t0=toFile;_context2.next=9;return this.read();case 9:_context2.t1=_context2.sent;_context2.next=12;return _context2.t0.write.call(_context2.t0,_context2.t1);case 12:_context2.next=26;break;case 14:if(otherResource.isDirectory()){_context2.next=16;break;}throw new Error('Cannot copy a directory to a file!');case 16:_context2.next=18;return this.dirList('infinity');case 18:fromResources=_context2.sent;toResources=fromResources.map(function(ea){return otherResource.join(ea.relativePathFrom(_this3));});// First create directory structure, this needs to happen in order
_context2.next=22;return otherResource.ensureExistance();case 22:_context2.next=24;return fromResources.reduceRight(function(next,ea,i){return function(){return Promise.resolve(ea.isDirectory()&&toResources[i].ensureExistance()).then(next);};},function(){return Promise.resolve();})();case 24:_context2.next=26;return fromResources.reduceRight(function(next,ea,i){return function(){return Promise.resolve(ea.isFile()&&ea.copyTo(toResources[i],false)).then(next);};},function(){return Promise.resolve();})();case 26:return _context2.abrupt("return",this);case 27:case"end":return _context2.stop();}}},_callee2,this);}));function copyTo(_x18){return _copyTo.apply(this,arguments);}return copyTo;}()},{key:"rename",value:function(){var _rename=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee3(otherResource){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return this.copyTo(otherResource);case 2:this.remove();return _context3.abrupt("return",otherResource);case 4:case"end":return _context3.stop();}}},_callee3,this);}));function rename(_x19){return _rename.apply(this,arguments);}return rename;}()},{key:"beBinary",value:function beBinary(bool){return this.setBinary(true);}},{key:"setBinary",value:function setBinary(bool){this.binary=bool;return this;}},{key:"read",value:function(){var _read=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:nyi(this,'read');case 1:case"end":return _context4.stop();}}},_callee4,this);}));function read(){return _read.apply(this,arguments);}return read;}()},{key:"write",value:function(){var _write=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:nyi(this,'write');case 1:case"end":return _context5.stop();}}},_callee5,this);}));function write(){return _write.apply(this,arguments);}return write;}()},{key:"mkdir",value:function(){var _mkdir=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:nyi(this,'mkdir');case 1:case"end":return _context6.stop();}}},_callee6,this);}));function mkdir(){return _mkdir.apply(this,arguments);}return mkdir;}()},{key:"exists",value:function(){var _exists=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee7(){return regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:nyi(this,'exists');case 1:case"end":return _context7.stop();}}},_callee7,this);}));function exists(){return _exists.apply(this,arguments);}return exists;}()},{key:"remove",value:function(){var _remove=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee8(){return regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:nyi(this,'remove');case 1:case"end":return _context8.stop();}}},_callee8,this);}));function remove(){return _remove.apply(this,arguments);}return remove;}()},{key:"dirList",value:function(){var _dirList=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee9(depth,opts){return regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:nyi(this,'dirList');case 1:case"end":return _context9.stop();}}},_callee9,this);}));function dirList(_x20,_x21){return _dirList.apply(this,arguments);}return dirList;}()},{key:"readProperties",value:function(){var _readProperties=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee10(opts){return regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:nyi(this,'readProperties');case 1:case"end":return _context10.stop();}}},_callee10,this);}));function readProperties(_x22){return _readProperties.apply(this,arguments);}return readProperties;}()},{key:"writeJson",value:function writeJson(obj){var pretty=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return this.write(pretty?JSON.stringify(obj,null,2):JSON.stringify(obj));}},{key:"readJson",value:function(){var _readJson=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee11(obj){return regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.t0=JSON;_context11.next=3;return this.read();case 3:_context11.t1=_context11.sent;return _context11.abrupt("return",_context11.t0.parse.call(_context11.t0,_context11.t1));case 5:case"end":return _context11.stop();}}},_callee11,this);}));function readJson(_x23){return _readJson.apply(this,arguments);}return readJson;}()// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// serialization
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"__serialize__",value:function __serialize__(){return{__expr__:"var r = null; try { r = resource(\"".concat(this.url,"\");} catch (err) {}; r"),bindings:{'lively.resources':['resource']}};}},{key:"isResource",get:function get(){return true;}},{key:"canDealWithJSON",get:function get(){return false;}}]);return Resource;}();/* global fetch, DOMParser, XPathEvaluator, XPathResult, Namespace,System,global,process,XMLHttpRequest,Buffer */var XPathQuery=/*#__PURE__*/function(){function XPathQuery(expression){_classCallCheck(this,XPathQuery);this.expression=expression;this.contextNode=null;this.xpe=new XPathEvaluator();}_createClass(XPathQuery,[{key:"establishContext",value:function establishContext(node){if(this.nsResolver)return;var ctx=node.ownerDocument?node.ownerDocument.documentElement:node.documentElement;if(ctx!==this.contextNode){this.contextNode=ctx;this.nsResolver=this.xpe.createNSResolver(ctx);}}},{key:"manualNSLookup",value:function manualNSLookup(){this.nsResolver=function(prefix){return Namespace[prefix.toUpperCase()]||null;};return this;}},{key:"findAll",value:function findAll(node,defaultValue){this.establishContext(node);var result=this.xpe.evaluate(this.expression,node,this.nsResolver,XPathResult.ANY_TYPE,null);var accumulator=[];var res=null;while(res=result.iterateNext()){accumulator.push(res);}return accumulator.length>0||defaultValue===undefined?accumulator:defaultValue;}},{key:"findFirst",value:function findFirst(node){this.establishContext(node);var result=this.xpe.evaluate(this.expression,node,this.nsResolver,XPathResult.ANY_TYPE,null);return result.iterateNext();}}]);return XPathQuery;}();function davNs(xmlString){// finds the declaration of the webdav namespace, usually "d" or "D"
var davNSMatch=xmlString.match(/\/([a-z]+?):multistatus/i);return davNSMatch?davNSMatch[1]:'d';}var propertyNodeMap={getlastmodified:'lastModified',creationDate:'created',getetag:'etag',getcontentlength:'size',resourcetype:'type',// collection or file
getcontenttype:'contentType'// mime type
};function readPropertyNode(propNode){var result=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var tagName=propNode.tagName.replace(/[^:]+:/,'');var key=propertyNodeMap[tagName];var value=propNode.textContent;switch(key){case'lastModified':case'created':value=new Date(value);break;case'size':value=Number(value);break;// code
}result[key]=value;return result;}function readXMLPropfindResult(xmlString){// the xmlString looks like this:
// <?xml version="1.0" encoding="utf-8"?>
// <d:multistatus xmlns:d="DAV:" xmlns:a="http://ajax.org/2005/aml">
//   <d:response>
//     <d:href>sub-dir/</d:href>
//     <d:propstat>
//       <d:prop>
//         <d:getlastmodified xmlns:b="urn:uuid:c2f41010-65b3-11d1-a29f-00aa00c14882/" b:dt="dateTime.rfc1123">Fri, 24 Jun 2016 09:58:20 -0700</d:getlastmodified>
//         <d:resourcetype>
//           <d:collection/>
//         </d:resourcetype>
//       </d:prop>
//       <d:status>HTTP/1.1 200 Ok</d:status>
//     </d:propstat>
//   </d:response>
// ...
// </d:multistatus>
var doc=new DOMParser().parseFromString(xmlString,'text/xml');var ns=davNs(xmlString);var nodes=new XPathQuery("/".concat(ns,":multistatus/").concat(ns,":response")).findAll(doc.documentElement);var urlQ=new XPathQuery("".concat(ns,":href"));var propsQ=new XPathQuery("".concat(ns,":propstat/").concat(ns,":prop"));return nodes.map(function(node){var propsNode=propsQ.findFirst(node);var props=Array.from(propsNode.childNodes).reduce(function(props,node){return readPropertyNode(node,props);},{});var urlNode=urlQ.findFirst(node);props.url=urlNode.textContent||urlNode.text;// text is FIX for IE9+;
return props;});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// MIT License Copyright (c) Sindre Sorhus <sindresorhus@gmail.com>
// https://github.com/sindresorhus/binary-extensions
var binaryExtensions=['3ds','3g2','3gp','7z','a','aac','adp','ai','aif','aiff','alz','ape','apk','ar','arj','asf','au','avi','bak','bh','bin','bk','bmp','btif','bz2','bzip2','cab','caf','cgm','class','cmx','cpio','cr2','csv','cur','dat','deb','dex','djvu','dll','dmg','dng','doc','docm','docx','dot','dotm','dra','DS_Store','dsk','dts','dtshd','dvb','dwg','dxf','ecelp4800','ecelp7470','ecelp9600','egg','eol','eot','epub','exe','f4v','fbs','fh','fla','flac','fli','flv','fpx','fst','fvt','g3','gif','graffle','gz','gzip','h261','h263','h264','icns','ico','ief','img','ipa','iso','jar','jpeg','jpg','jpgv','jpm','jxr','key','ktx','lha','lvp','lz','lzh','lzma','lzo','m3u','m4a','m4v','mar','mdi','mht','mid','midi','mj2','mka','mkv','mmr','mng','mobi','mov','movie','mp3','mp4','mp4a','mpeg','mpg','mpga','mxu','nef','npx','numbers','o','oga','ogg','ogv','otf','pages','pbm','pcx','pdf','pea','pgm','pic','png','pnm','pot','potm','potx','ppa','ppam','ppm','pps','ppsm','ppsx','ppt','pptm','pptx','psd','pya','pyc','pyo','pyv','qt','rar','ras','raw','rgb','rip','rlc','rmf','rmvb','rtf','rz','s3m','s7z','scpt','sgi','shar','sil','sketch','slk','smv','so','sub','swf','tar','tbz','tbz2','tga','tgz','thmx','tif','tiff','tlz','ttc','ttf','txz','udf','uvh','uvi','uvm','uvp','uvs','uvu','viv','vob','war','wav','wax','wbmp','wdp','weba','webm','webp','whl','wim','wm','wma','wmv','wmx','woff','woff2','wvx','xbm','xif','xla','xlam','xls','xlsb','xlsm','xlsx','xlt','xltm','xltx','xm','xmind','xpi','xpm','xwd','xz','z','zip','zipx'];// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var isNode$2=typeof System!=='undefined'?System.get('@system-env').node:typeof global!=='undefined'&&typeof process!=='undefined';function defaultOrigin(){return System.baseURL||document.location.origin;}function makeRequest(resource){var method=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'GET';var body=arguments.length>2?arguments[2]:undefined;var headers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var onProgress=arguments.length>4&&arguments[4]!==undefined?arguments[4]:function(){};var url=resource.url;var useCors=resource.useCors,useProxy=resource.useProxy,moreHeaders=resource.headers;var useCors=typeof useCors!=='undefined'?useCors:true;var useProxy=typeof useProxy!=='undefined'?useProxy:true;var fetchOpts={method:method};if(useProxy){Object.assign(headers,{// pragma: 'no-cache',
'cache-control':'no-cache','x-lively-proxy-request':url});url=resource.proxyDomain||defaultOrigin();}if(useCors)fetchOpts.mode='cors';if(body)fetchOpts.body=body;fetchOpts.redirect='follow';fetchOpts.headers=_objectSpread(_objectSpread({},headers),moreHeaders);return fetch(url,fetchOpts);}function upload(resource,body){var _resource$useProxy=resource.useProxy,useProxy=_resource$useProxy===void 0?true:_resource$useProxy,_resource$useCors=resource.useCors,useCors=_resource$useCors===void 0?true:_resource$useCors,url=resource.url,onLoad=resource.onLoad,headers=resource.headers,onProgress=resource.onProgress;var xhr=new XMLHttpRequest();var res=promise.deferred();xhr.open('PUT',url);if(useProxy){Object.assign(headers,{pragma:'no-cache','cache-control':'no-cache','x-lively-proxy-request':url});url=resource.proxyDomain||defaultOrigin();}for(var header in headers){xhr.setRequestHeader(header,headers[header]);}xhr.upload.addEventListener('progress',onProgress);xhr.responseType='json';xhr.onload=function(){onLoad(xhr.response);res.resolve(xhr);};if(useCors)xhr.withCredentials=true;xhr.send(body);return res.promise;}var WebDAVResource=/*#__PURE__*/function(_Resource){_inherits(WebDAVResource,_Resource);var _super9=_createSuper(WebDAVResource);function WebDAVResource(url){var _this4;var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,WebDAVResource);_this4=_super9.call(this,url,opts);_this4.onLoad=opts.onLoad||function(){};_this4.onProgress=opts.onProgress||function(){};_this4.useProxy=opts.hasOwnProperty('useProxy')?opts.useProxy:false;_this4.proxyDomain=opts.proxyDomain||undefined;_this4.useCors=opts.hasOwnProperty('useCors')?opts.useCors:false;_this4.headers=opts.headers||{};_this4.binary=_this4.isFile()?binaryExtensions.includes(_this4.ext()):false;_this4.errorOnHTTPStatusCodes=opts.hasOwnProperty('errorOnHTTPStatusCodes')?opts.errorOnHTTPStatusCodes:true;return _this4;}_createClass(WebDAVResource,[{key:"join",value:function join(path){return Object.assign(_get2(_getPrototypeOf(WebDAVResource.prototype),"join",this).call(this,path),{headers:this.headers,useCors:this.useCors,useProxy:this.useProxy,proxyDomain:this.proxyDomain});}},{key:"makeProxied",value:function makeProxied(proxyDomain){if(proxyDomain!==undefined)this.proxyDomain=proxyDomain;return this.useProxy?this:new this.constructor(this.url,{headers:this.headers,useCors:this.useCors,useProxy:true,proxyDomain:this.proxyDomain});}},{key:"noErrorOnHTTPStatusCodes",value:function noErrorOnHTTPStatusCodes(){this.errorOnHTTPStatusCodes=false;return this;}},{key:"read",value:function(){var _read2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee12(){var res;return regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return makeRequest(this);case 2:res=_context12.sent;if(!(!res.ok&&this.errorOnHTTPStatusCodes)){_context12.next=5;break;}throw new Error("Cannot read ".concat(this.url,": ").concat(res.statusText," ").concat(res.status));case 5:if(this.binary){_context12.next=7;break;}return _context12.abrupt("return",res.text());case 7:if(!(this.binary==='blob')){_context12.next=9;break;}return _context12.abrupt("return",res.blob());case 9:if(!(typeof res.arrayBuffer==='function')){_context12.next=11;break;}return _context12.abrupt("return",res.arrayBuffer());case 11:if(!(typeof res.buffer==='function')){_context12.next=13;break;}return _context12.abrupt("return",res.buffer());case 13:throw new Error("Don't now how to read binary resource ".concat(this,"'"));case 14:case"end":return _context12.stop();}}},_callee12,this);}));function read(){return _read2.apply(this,arguments);}return read;}()},{key:"write",value:function(){var _write2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee13(content){var res;return regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:if(this.isFile()){_context13.next=2;break;}throw new Error("Cannot write a non-file: ".concat(this.url));case 2:_context13.next=4;return upload(this,content);case 4:res=_context13.sent;if(!(!between(res.status,200,300)&&this.errorOnHTTPStatusCodes)){_context13.next=7;break;}throw new Error("Cannot write ".concat(this.url,": ").concat(res.statusText," ").concat(res.status));case 7:return _context13.abrupt("return",this);case 8:case"end":return _context13.stop();}}},_callee13,this);}));function write(_x24){return _write2.apply(this,arguments);}return write;}()},{key:"mkdir",value:function(){var _mkdir2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee14(){var res;return regeneratorRuntime.wrap(function _callee14$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:if(!this.isFile()){_context14.next=2;break;}throw new Error("Cannot mkdir on a file: ".concat(this.url));case 2:_context14.next=4;return makeRequest(this,'MKCOL');case 4:res=_context14.sent;if(!(!res.ok&&this.errorOnHTTPStatusCodes)){_context14.next=7;break;}throw new Error("Cannot create directory ".concat(this.url,": ").concat(res.statusText," ").concat(res.status));case 7:return _context14.abrupt("return",this);case 8:case"end":return _context14.stop();}}},_callee14,this);}));function mkdir(){return _mkdir2.apply(this,arguments);}return mkdir;}()},{key:"exists",value:function(){var _exists2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee15(){return regeneratorRuntime.wrap(function _callee15$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:if(!this.isRoot()){_context15.next=4;break;}_context15.t0=true;_context15.next=7;break;case 4:_context15.next=6;return makeRequest(this,'HEAD');case 6:_context15.t0=!!_context15.sent.ok;case 7:return _context15.abrupt("return",_context15.t0);case 8:case"end":return _context15.stop();}}},_callee15,this);}));function exists(){return _exists2.apply(this,arguments);}return exists;}()},{key:"remove",value:function(){var _remove2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee16(){return regeneratorRuntime.wrap(function _callee16$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:_context16.next=2;return makeRequest(this,'DELETE');case 2:return _context16.abrupt("return",this);case 3:case"end":return _context16.stop();}}},_callee16,this);}));function remove(){return _remove2.apply(this,arguments);}return remove;}()},{key:"_propfind",value:function(){var _propfind2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee17(){var res,xmlString,root;return regeneratorRuntime.wrap(function _callee17$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:_context17.next=2;return makeRequest(this,'PROPFIND',null,// propfindRequestPayload(),
{'Content-Type':'text/xml'// rk 2016-06-24: jsDAV does not support PROPFIND via depth: 'infinity'
// 'Depth': String(depth)
});case 2:res=_context17.sent;if(!(!res.ok&&this.errorOnHTTPStatusCodes)){_context17.next=5;break;}throw new Error("Error in dirList for ".concat(this.url,": ").concat(res.statusText));case 5:_context17.next=7;return res.text();case 7:xmlString=_context17.sent;root=this.root();// list of properties for all resources in the multistatus list
return _context17.abrupt("return",readXMLPropfindResult(xmlString).map(function(props){return root.join(props.url).assignProperties(props);}));case 10:case"end":return _context17.stop();}}},_callee17,this);}));function _propfind(){return _propfind2.apply(this,arguments);}return _propfind;}()},{key:"dirList",value:function(){var _dirList2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee18(){var depth,opts,exclude,resources,_self,subResources,subCollections,_args18=arguments;return regeneratorRuntime.wrap(function _callee18$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:depth=_args18.length>0&&_args18[0]!==undefined?_args18[0]:1;opts=_args18.length>1&&_args18[1]!==undefined?_args18[1]:{};if(!(typeof depth!=='number'&&depth!=='infinity')){_context18.next=4;break;}throw new Error("dirList \u2013 invalid depth argument: ".concat(depth));case 4:exclude=opts.exclude;if(depth<=0)depth=1;if(!(depth===1)){_context18.next=15;break;}_context18.next=9;return this._propfind();case 9:resources=_context18.sent;// request to set resources props...
_self=resources.shift();if(exclude)resources=applyExclude(exclude,resources);return _context18.abrupt("return",resources);case 15:_context18.next=17;return this.dirList(1,opts);case 17:subResources=_context18.sent;subCollections=subResources.filter(function(ea){return ea.isDirectory();});return _context18.abrupt("return",Promise.all(subCollections.map(function(col){return col.dirList(typeof depth==='number'?depth-1:depth,opts);})).then(function(recursiveResult){return recursiveResult.reduce(function(all,ea){return all.concat(ea);},subResources);}));case 20:case"end":return _context18.stop();}}},_callee18,this);}));function dirList(){return _dirList2.apply(this,arguments);}return dirList;}()},{key:"readProperties",value:function(){var _readProperties2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee19(opts){var props;return regeneratorRuntime.wrap(function _callee19$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:_context19.next=2;return this._propfind();case 2:props=_context19.sent[0];return _context19.abrupt("return",this.assignProperties(props));case 4:case"end":return _context19.stop();}}},_callee19,this);}));function readProperties(_x25){return _readProperties2.apply(this,arguments);}return readProperties;}()},{key:"post",value:function(){var _post=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee20(){var body,res,text,json,_args20=arguments;return regeneratorRuntime.wrap(function _callee20$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:body=_args20.length>0&&_args20[0]!==undefined?_args20[0]:null;if(typeof body!=='string')body=JSON.stringify(body);_context20.next=4;return makeRequest(this,'POST',body,{});case 4:res=_context20.sent;_context20.prev=5;_context20.next=8;return res.text();case 8:text=_context20.sent;_context20.next=13;break;case 11:_context20.prev=11;_context20.t0=_context20["catch"](5);case 13:if(text&&res.headers.get('content-type')==='application/json'){try{json=JSON.parse(text);}catch(err){}}if(!(!res.ok&&this.errorOnHTTPStatusCodes)){_context20.next=18;break;}throw new Error("Error in POST ".concat(this.url,": ").concat(text||res.statusText));case 18:return _context20.abrupt("return",json||text);case 19:case"end":return _context20.stop();}}},_callee20,this,[[5,11]]);}));function post(){return _post.apply(this,arguments);}return post;}()},{key:"copyTo",value:function(){var _copyTo2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee21(otherResource){var ensureParent,toFile,_args21=arguments;return regeneratorRuntime.wrap(function _callee21$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:ensureParent=_args21.length>1&&_args21[1]!==undefined?_args21[1]:true;if(!this.isFile()){_context21.next=8;break;}toFile=otherResource.isFile()?otherResource:otherResource.join(this.name());// optimized copy, using pipes, for HTTP
if(!isNode$2){_context21.next=8;break;}if(!toFile.isHTTPResource){_context21.next=6;break;}return _context21.abrupt("return",this._copyTo_file_nodejs_http(toFile,ensureParent));case 6:if(!toFile.isNodeJSFileResource){_context21.next=8;break;}return _context21.abrupt("return",this._copyTo_file_nodejs_fs(toFile,ensureParent));case 8:return _context21.abrupt("return",_get2(_getPrototypeOf(WebDAVResource.prototype),"copyTo",this).call(this,otherResource,ensureParent));case 9:case"end":return _context21.stop();}}},_callee21,this);}));function copyTo(_x26){return _copyTo2.apply(this,arguments);}return copyTo;}()},{key:"_copyFrom_file_nodejs_fs",value:function(){var _copyFrom_file_nodejs_fs2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee22(fromFile){var ensureParent,error,stream,toRes,_args22=arguments;return regeneratorRuntime.wrap(function _callee22$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:ensureParent=_args22.length>1&&_args22[1]!==undefined?_args22[1]:true;if(!ensureParent){_context22.next=4;break;}_context22.next=4;return this.parent().ensureExistance();case 4:stream=fromFile._createReadStream();stream.on('error',function(err){return error=err;});_context22.next=8;return makeRequest(this,'PUT',stream);case 8:toRes=_context22.sent;if(!error){_context22.next=11;break;}throw error;case 11:if(!(!toRes.ok&&this.errorOnHTTPStatusCodes)){_context22.next=13;break;}throw new Error("copyTo: Cannot GET: ".concat(toRes.statusText," ").concat(toRes.status));case 13:return _context22.abrupt("return",this);case 14:case"end":return _context22.stop();}}},_callee22,this);}));function _copyFrom_file_nodejs_fs(_x27){return _copyFrom_file_nodejs_fs2.apply(this,arguments);}return _copyFrom_file_nodejs_fs;}()},{key:"_copyTo_file_nodejs_fs",value:function(){var _copyTo_file_nodejs_fs2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee23(toFile){var _this5=this;var ensureParent,fromRes,error,_args23=arguments;return regeneratorRuntime.wrap(function _callee23$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:ensureParent=_args23.length>1&&_args23[1]!==undefined?_args23[1]:true;if(!ensureParent){_context23.next=4;break;}_context23.next=4;return toFile.parent().ensureExistance();case 4:_context23.next=6;return makeRequest(this,'GET');case 6:fromRes=_context23.sent;if(!(!fromRes.ok&&this.errorOnHTTPStatusCodes)){_context23.next=9;break;}throw new Error("copyTo: Cannot GET: ".concat(fromRes.statusText," ").concat(fromRes.status));case 9:return _context23.abrupt("return",new Promise(function(resolve,reject){return fromRes.body.pipe(toFile._createWriteStream()).on('error',function(err){return error=err;}).on('finish',function(){return error?reject(error):resolve(_this5);});}));case 10:case"end":return _context23.stop();}}},_callee23,this);}));function _copyTo_file_nodejs_fs(_x28){return _copyTo_file_nodejs_fs2.apply(this,arguments);}return _copyTo_file_nodejs_fs;}()},{key:"_copyTo_file_nodejs_http",value:function(){var _copyTo_file_nodejs_http2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee24(toFile){var ensureParent,fromRes,toRes,_args24=arguments;return regeneratorRuntime.wrap(function _callee24$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:ensureParent=_args24.length>1&&_args24[1]!==undefined?_args24[1]:true;if(!ensureParent){_context24.next=4;break;}_context24.next=4;return toFile.parent().ensureExistance();case 4:_context24.next=6;return makeRequest(this,'GET');case 6:fromRes=_context24.sent;if(!(!fromRes.ok&&this.errorOnHTTPStatusCodes)){_context24.next=9;break;}throw new Error("copyTo: Cannot GET: ".concat(fromRes.statusText," ").concat(fromRes.status));case 9:_context24.next=11;return makeRequest(toFile,'PUT',fromRes.body);case 11:toRes=_context24.sent;if(!(!fromRes.ok&&this.errorOnHTTPStatusCodes)){_context24.next=14;break;}throw new Error("copyTo: Cannot PUT: ".concat(toRes.statusText," ").concat(toRes.status));case 14:case"end":return _context24.stop();}}},_callee24,this);}));function _copyTo_file_nodejs_http(_x29){return _copyTo_file_nodejs_http2.apply(this,arguments);}return _copyTo_file_nodejs_http;}()},{key:"isHTTPResource",get:function get(){return true;}}]);return WebDAVResource;}(Resource);var resourceExtension={name:'http-webdav-resource',matches:function matches(url){return url.startsWith('http:')||url.startsWith('https:');},resourceClass:WebDAVResource};/*global require*/var _ref12=System.get('@system-env').node?require('fs'):{},readFile=_ref12.readFile,writeFile=_ref12.writeFile,exists=_ref12.exists,readdir=_ref12.readdir,mkdir=_ref12.mkdir,rmdir=_ref12.rmdir,unlink=_ref12.unlink,lstat=_ref12.lstat,rename=_ref12.rename,createWriteStream=_ref12.createWriteStream,createReadStream=_ref12.createReadStream;/* global process */function wrapInPromise(func){return function(){for(var _len7=arguments.length,args=new Array(_len7),_key11=0;_key11<_len7;_key11++){args[_key11]=arguments[_key11];}return new Promise(function(resolve,reject){return func.apply(null,args.concat(function(err,result){return err?reject(err):resolve(result);}));});};}var readFileP=wrapInPromise(readFile);var writeFileP=wrapInPromise(writeFile);var existsP=function existsP(path){return new Promise(function(resolve,_reject){return exists(path,function(exists){return resolve(!!exists);});});};var readdirP=wrapInPromise(readdir);var mkdirP=wrapInPromise(mkdir);var rmdirP=wrapInPromise(rmdir);var unlinkP=wrapInPromise(unlink);var lstatP=wrapInPromise(lstat);var renameP=wrapInPromise(rename);var NodeJSFileResource=/*#__PURE__*/function(_Resource2){_inherits(NodeJSFileResource,_Resource2);var _super10=_createSuper(NodeJSFileResource);function NodeJSFileResource(){_classCallCheck(this,NodeJSFileResource);return _super10.apply(this,arguments);}_createClass(NodeJSFileResource,[{key:"path",value:function path(){return this.url.replace('file://','');}},{key:"stat",value:function(){var _stat=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee25(){return regeneratorRuntime.wrap(function _callee25$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:return _context25.abrupt("return",lstatP(this.path()));case 1:case"end":return _context25.stop();}}},_callee25,this);}));function stat(){return _stat.apply(this,arguments);}return stat;}()},{key:"read",value:function(){var _read3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee26(){var readP;return regeneratorRuntime.wrap(function _callee26$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:readP=readFileP(this.path());return _context26.abrupt("return",this.binary?readP:readP.then(String));case 2:case"end":return _context26.stop();}}},_callee26,this);}));function read(){return _read3.apply(this,arguments);}return read;}()},{key:"write",value:function(){var _write3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee27(content){return regeneratorRuntime.wrap(function _callee27$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:if(!this.isDirectory()){_context27.next=2;break;}throw new Error("Cannot write into a directory: ".concat(this.path()));case 2:_context27.next=4;return writeFileP(this.path(),content);case 4:return _context27.abrupt("return",this);case 5:case"end":return _context27.stop();}}},_callee27,this);}));function write(_x30){return _write3.apply(this,arguments);}return write;}()},{key:"mkdir",value:function(){var _mkdir3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee28(){return regeneratorRuntime.wrap(function _callee28$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:if(!this.isFile()){_context28.next=2;break;}throw new Error("Cannot mkdir on a file: ".concat(this.path()));case 2:_context28.next=4;return mkdirP(this.path());case 4:return _context28.abrupt("return",this);case 5:case"end":return _context28.stop();}}},_callee28,this);}));function mkdir(){return _mkdir3.apply(this,arguments);}return mkdir;}()},{key:"exists",value:function(){var _exists3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee29(){return regeneratorRuntime.wrap(function _callee29$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:return _context29.abrupt("return",this.isRoot()?true:existsP(this.path()));case 1:case"end":return _context29.stop();}}},_callee29,this);}));function exists(){return _exists3.apply(this,arguments);}return exists;}()},{key:"dirList",value:function(){var _dirList3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee30(){var depth,opts,exclude,_subResources,_iterator26,_step26,name,subResource,stat,subResources,subCollections,_args30=arguments;return regeneratorRuntime.wrap(function _callee30$(_context30){while(1){switch(_context30.prev=_context30.next){case 0:depth=_args30.length>0&&_args30[0]!==undefined?_args30[0]:1;opts=_args30.length>1&&_args30[1]!==undefined?_args30[1]:{};if(!(typeof depth!=='number'&&depth!=='infinity')){_context30.next=4;break;}throw new Error("dirList \u2013 invalid depth argument: ".concat(depth));case 4:exclude=opts.exclude;if(depth<=0)depth=1;if(!(depth===1)){_context30.next=36;break;}_subResources=[];_context30.t0=_createForOfIteratorHelper;_context30.next=11;return readdirP(this.path());case 11:_context30.t1=_context30.sent;_iterator26=(0,_context30.t0)(_context30.t1);_context30.prev=13;_iterator26.s();case 15:if((_step26=_iterator26.n()).done){_context30.next=26;break;}name=_step26.value;subResource=this.join(name);_context30.next=20;return subResource.stat();case 20:stat=_context30.sent;subResource=stat.isDirectory()?subResource.asDirectory():subResource;subResource._assignPropsFromStat(stat);_subResources.push(subResource);case 24:_context30.next=15;break;case 26:_context30.next=31;break;case 28:_context30.prev=28;_context30.t2=_context30["catch"](13);_iterator26.e(_context30.t2);case 31:_context30.prev=31;_iterator26.f();return _context30.finish(31);case 34:if(exclude)_subResources=applyExclude(exclude,_subResources);return _context30.abrupt("return",_subResources);case 36:_context30.next=38;return this.dirList(1,opts);case 38:subResources=_context30.sent;subCollections=subResources.filter(function(ea){return ea.isDirectory();});return _context30.abrupt("return",Promise.all(subCollections.map(function(col){return col.dirList(typeof depth==='number'?depth-1:depth,opts);})).then(function(recursiveResult){return recursiveResult.reduce(function(all,ea){return all.concat(ea);},subResources);}));case 41:case"end":return _context30.stop();}}},_callee30,this,[[13,28,31,34]]);}));function dirList(){return _dirList3.apply(this,arguments);}return dirList;}()},{key:"isEmptyDirectory",value:function(){var _isEmptyDirectory=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee31(){return regeneratorRuntime.wrap(function _callee31$(_context31){while(1){switch(_context31.prev=_context31.next){case 0:_context31.next=2;return this.dirList();case 2:_context31.t0=_context31.sent.length;return _context31.abrupt("return",_context31.t0===0);case 4:case"end":return _context31.stop();}}},_callee31,this);}));function isEmptyDirectory(){return _isEmptyDirectory.apply(this,arguments);}return isEmptyDirectory;}()},{key:"rename",value:function(){var _rename2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee32(toResource){var files,dirs,_iterator27,_step27,subR,_i94,_dirs,subdir,_i95,_files,file;return regeneratorRuntime.wrap(function _callee32$(_context32){while(1){switch(_context32.prev=_context32.next){case 0:if(toResource instanceof this.constructor){_context32.next=2;break;}return _context32.abrupt("return",_get2(_getPrototypeOf(NodeJSFileResource.prototype),"rename",this).call(this,toResource));case 2:if(!this.isFile()){_context32.next=7;break;}toResource=toResource.asFile();renameP(this.path(),toResource.path());_context32.next=36;break;case 7:toResource=toResource.asDirectory();_context32.next=10;return toResource.ensureExistance();case 10:files=[];dirs=[];_context32.t0=_createForOfIteratorHelper;_context32.next=15;return this.dirList('infinity');case 15:_context32.t1=_context32.sent;_iterator27=(0,_context32.t0)(_context32.t1);try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){subR=_step27.value;if(subR.isDirectory())dirs.push(subR);else files.push(subR);}}catch(err){_iterator27.e(err);}finally{_iterator27.f();}_i94=0,_dirs=dirs;case 19:if(!(_i94<_dirs.length)){_context32.next=26;break;}subdir=_dirs[_i94];_context32.next=23;return toResource.join(subdir.relativePathFrom(this)).ensureExistance();case 23:_i94++;_context32.next=19;break;case 26:_i95=0,_files=files;case 27:if(!(_i95<_files.length)){_context32.next=34;break;}file=_files[_i95];_context32.next=31;return file.rename(toResource.join(file.relativePathFrom(this)));case 31:_i95++;_context32.next=27;break;case 34:_context32.next=36;return this.remove();case 36:return _context32.abrupt("return",toResource);case 37:case"end":return _context32.stop();}}},_callee32,this);}));function rename(_x31){return _rename2.apply(this,arguments);}return rename;}()},{key:"remove",value:function(){var _remove3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee33(){var _iterator28,_step28,subResource;return regeneratorRuntime.wrap(function _callee33$(_context33){while(1){switch(_context33.prev=_context33.next){case 0:_context33.next=2;return this.exists();case 2:if(_context33.sent){_context33.next=6;break;};_context33.next=34;break;case 6:if(!this.isDirectory()){_context33.next=32;break;}_context33.t0=_createForOfIteratorHelper;_context33.next=10;return this.dirList();case 10:_context33.t1=_context33.sent;_iterator28=(0,_context33.t0)(_context33.t1);_context33.prev=12;_iterator28.s();case 14:if((_step28=_iterator28.n()).done){_context33.next=20;break;}subResource=_step28.value;_context33.next=18;return subResource.remove();case 18:_context33.next=14;break;case 20:_context33.next=25;break;case 22:_context33.prev=22;_context33.t2=_context33["catch"](12);_iterator28.e(_context33.t2);case 25:_context33.prev=25;_iterator28.f();return _context33.finish(25);case 28:_context33.next=30;return rmdirP(this.path());case 30:_context33.next=34;break;case 32:_context33.next=34;return unlinkP(this.path());case 34:return _context33.abrupt("return",this);case 35:case"end":return _context33.stop();}}},_callee33,this,[[12,22,25,28]]);}));function remove(){return _remove3.apply(this,arguments);}return remove;}()},{key:"readProperties",value:function(){var _readProperties3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee34(){return regeneratorRuntime.wrap(function _callee34$(_context34){while(1){switch(_context34.prev=_context34.next){case 0:_context34.t0=this;_context34.next=3;return this.stat();case 3:_context34.t1=_context34.sent;return _context34.abrupt("return",_context34.t0._assignPropsFromStat.call(_context34.t0,_context34.t1));case 5:case"end":return _context34.stop();}}},_callee34,this);}));function readProperties(){return _readProperties3.apply(this,arguments);}return readProperties;}()},{key:"copyTo",value:function(){var _copyTo3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee35(otherResource){var ensureParent,toFile,_args35=arguments;return regeneratorRuntime.wrap(function _callee35$(_context35){while(1){switch(_context35.prev=_context35.next){case 0:ensureParent=_args35.length>1&&_args35[1]!==undefined?_args35[1]:true;if(!this.isFile()){_context35.next=5;break;}toFile=otherResource.isFile()?otherResource:otherResource.join(this.name());// optimized copy, using pipes, for HTTP
if(!toFile.isHTTPResource){_context35.next=5;break;}return _context35.abrupt("return",toFile._copyFrom_file_nodejs_fs(this,ensureParent=true));case 5:return _context35.abrupt("return",_get2(_getPrototypeOf(NodeJSFileResource.prototype),"copyTo",this).call(this,otherResource,ensureParent));case 6:case"end":return _context35.stop();}}},_callee35,this);}));function copyTo(_x32){return _copyTo3.apply(this,arguments);}return copyTo;}()},{key:"_assignPropsFromStat",value:function _assignPropsFromStat(stat){return this.assignProperties({lastModified:stat.mtime,created:stat.ctime,size:stat.size,type:stat.isDirectory()?'directory':'file',isLink:stat.isSymbolicLink()});}},{key:"_createWriteStream",value:function _createWriteStream(){return createWriteStream(this.path());}},{key:"_createReadStream",value:function _createReadStream(){return createReadStream(this.path());}},{key:"isNodeJSFileResource",get:function get(){return true;}}]);return NodeJSFileResource;}(Resource);var NodeJSWindowsFileResource=/*#__PURE__*/function(_NodeJSFileResource){_inherits(NodeJSWindowsFileResource,_NodeJSFileResource);var _super11=_createSuper(NodeJSWindowsFileResource);function NodeJSWindowsFileResource(url,opts){_classCallCheck(this,NodeJSWindowsFileResource);// rkrk 2019-10-31:
// Windows file uris have three slashes. Since we have used
// file:// throughout the code base we introduce this as a
// single point fix for the time being...
var prefix=url.slice(0,8);if(prefix!=='file:///'&&url.slice(0,7)==='file://'){url='file:///'+url.slice(7);}if(url.includes('\\')){url=url.replace(/\\/g,'/');}return _super11.call(this,url,opts);}_createClass(NodeJSWindowsFileResource,[{key:"path",value:function path(){return this.url.replace('file:///','');}},{key:"isRoot",value:function isRoot(){return!!this.path().match(windowsRootPathRe);}},{key:"root",value:function root(){if(this.isRoot())return this;console.log(this.url);var toplevelMatch=this.url.match(windowsURLPrefixRe);if(toplevelMatch)return this.newResource(toplevelMatch[0]);throw new Error('Could not determine root path of windows file resource for url '+this.url);}}]);return NodeJSWindowsFileResource;}(NodeJSFileResource);var resourceExtension$1={name:'nodejs-file-resource',matches:function matches(url){return url.startsWith('file:');},resourceClass:typeof process!=='undefined'&&process.platform==='win32'?NodeJSWindowsFileResource:NodeJSFileResource};var slashRe=/\//g;function applyExclude$1(resource,exclude){if(!exclude)return true;if(typeof exclude==='string')return!resource.url.includes(exclude);if(typeof exclude==='function')return!exclude(resource);if(exclude instanceof RegExp)return!exclude.test(resource.url);return true;}var LocalResourceInMemoryBackend=/*#__PURE__*/function(){_createClass(LocalResourceInMemoryBackend,null,[{key:"removeHost",value:function removeHost(name){delete this.hosts[name];}},{key:"ensure",value:function ensure(filespec){var _this6=this;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var host=this.named(options.host);return Promise.resolve().then(function(){return filespec?createFiles("local://".concat(host.name),filespec):null;}).then(function(){return _this6;});}},{key:"named",value:function named(name){if(!name)name='default';return this.hosts[name]||(this.hosts[name]=new this(name));}},{key:"hosts",get:function get(){return this._hosts||(this._hosts={});}}]);function LocalResourceInMemoryBackend(name){var filespec=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,LocalResourceInMemoryBackend);if(!name||typeof name!=='string'){throw new Error('LocalResourceInMemoryBackend needs name!');}this.name=name;this._filespec=filespec;}_createClass(LocalResourceInMemoryBackend,[{key:"get",value:function get(path){return this._filespec[path];}},{key:"set",value:function set(path,spec){this._filespec[path]=spec;}},{key:"write",value:function write(path,content){var spec=this._filespec[path];if(!spec)spec=this._filespec[path]={created:new Date()};spec.content=content;spec.isDirectory=false;spec.lastModified=new Date();}},{key:"read",value:function read(path){var spec=this._filespec[path];return!spec||!spec.content?'':spec.content;}},{key:"mkdir",value:function mkdir(path){var spec=this._filespec[path];if(spec&&spec.isDirectory)return;if(!spec)spec=this._filespec[path]={created:new Date()};if(spec.content)delete spec.content;spec.isDirectory=true;spec.lastModified=new Date();}},{key:"partialFilespec",value:function partialFilespec(){var path=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'/';var depth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Infinity;var result={};var filespec=this.filespec;var paths=Object.keys(filespec);for(var _i96=0;_i96<paths.length;_i96++){var childPath=paths[_i96];if(!childPath.startsWith(path)||path===childPath)continue;var trailing=childPath.slice(path.length);var childDepth=trailing.includes('/')?trailing.match(slashRe).length+1:1;if(childDepth>depth)continue;result[childPath]=filespec[childPath];}return result;}},{key:"filespec",get:function get(){return this._filespec;},set:function set(filespec){this._filespec=filespec;}}]);return LocalResourceInMemoryBackend;}();var LocalResource=/*#__PURE__*/function(_Resource3){_inherits(LocalResource,_Resource3);var _super12=_createSuper(LocalResource);function LocalResource(){_classCallCheck(this,LocalResource);return _super12.apply(this,arguments);}_createClass(LocalResource,[{key:"read",value:function read(){return Promise.resolve(this.localBackend.read(this.path()));}},{key:"write",value:function write(content){if(this.isDirectory()){throw new Error("Cannot write into a directory! (".concat(this.url,")"));}var spec=this.localBackend.get(this.path());if(spec&&spec.isDirectory){throw new Error("".concat(this.url," already exists and is a directory (cannot write into it!)"));}this.localBackend.write(this.path(),content);return Promise.resolve(this);}},{key:"mkdir",value:function mkdir(){if(!this.isDirectory()){throw new Error("Cannot mkdir a file! (".concat(this.url,")"));}var spec=this.localBackend.get(this.path());if(spec&&spec.isDirectory)return Promise.resolve(this);if(spec&&!spec.isDirectory){throw new Error("".concat(this.url," already exists and is a file (cannot mkdir it!)"));}this.localBackend.mkdir(this.path());return Promise.resolve(this);}},{key:"exists",value:function exists(){return Promise.resolve(this.isRoot()||this.path()in this.localBackend.filespec);}},{key:"remove",value:function remove(){var _this7=this;var thisPath=this.path();Object.keys(this.localBackend.filespec).forEach(function(path){return path.startsWith(thisPath)&&delete _this7.localBackend.filespec[path];});return Promise.resolve(this);}},{key:"readProperties",value:function readProperties(){throw new Error('not yet implemented');}},{key:"dirList",value:function dirList(){var _this8=this;var depth=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!this.isDirectory())return this.asDirectory().dirList(depth,opts);var exclude=opts.exclude;var prefix=this.path();var children=[];var paths=Object.keys(this.localBackend.filespec);if(depth==='infinity')depth=Infinity;for(var _i97=0;_i97<paths.length;_i97++){var childPath=paths[_i97];if(!childPath.startsWith(prefix)||prefix===childPath)continue;var trailing=childPath.slice(prefix.length);var childDepth=trailing.includes('/')?trailing.match(slashRe).length+1:1;if(childDepth>depth){var _ret2=function(){// add the dir pointing to child
var dirToChild=_this8.join(trailing.split('/').slice(0,depth).join('/')+'/');if(!children.some(function(ea){return ea.equals(dirToChild);}))children.push(dirToChild);return"continue";}();if(_ret2==="continue")continue;}var child=this.join(trailing);if(!exclude||applyExclude$1(child,exclude)){children.push(child);}}return Promise.resolve(children);}},{key:"localBackend",get:function get(){return LocalResourceInMemoryBackend.named(this.host());}}]);return LocalResource;}(Resource);var resourceExtension$2={name:'local-resource',matches:function matches(url){return url.startsWith('local:');},resourceClass:LocalResource};/*global System,babel*/registerExtension(resourceExtension$2);registerExtension(resourceExtension);registerExtension(resourceExtension$1);var join$1=joinPath;function isURL(string){return /^[^:\\]+:\/\//.test(string);}function urlResolve(url){var urlMatch=url.match(/^([^:]+:\/\/)(.*)/);if(!urlMatch)return url;var protocol=urlMatch[1],path=urlMatch[2],result=path;// /foo/../bar --> /bar
do{path=result;result=path.replace(/\/[^\/]+\/\.\./,'');}while(result!=path);// foo//bar --> foo/bar
result=result.replace(/(^|[^:])[\/]+/g,'$1/');// foo/./bar --> foo/bar
result=result.replace(/\/\.\//g,'/');return protocol+result;}var PackageConfiguration=/*#__PURE__*/function(){function PackageConfiguration(pkg){_classCallCheck(this,PackageConfiguration);this.pkg=pkg;}_createClass(PackageConfiguration,[{key:"applyConfig",value:function applyConfig(config){// takes a config json object (typically read from a package.json file but
// can be used standalone) and changes the System configuration to what it finds
// in it.
// In particular uses the "systemjs" section as described in https://github.com/systemjs/systemjs/blob/master/docs/config-api.md
// and uses the "lively" section as described in `applyLivelyConfig`
var System=this.System,packageURL=this.packageURL,pkg=this.pkg;config=deepMerge(pkg.config,config);var name=config.name||packageURL.split("/").slice(-1)[0],version=config.version,sysConfig=config.systemjs||{},livelyConfig=config.lively,main=config.main||"index.js";System.config({map:_defineProperty({},name,packageURL),packages:_defineProperty({},packageURL,_objectSpread(_objectSpread({},sysConfig),{},{meta:_objectSpread({"package.json":{format:"json"}},sysConfig.meta),configured:true}))});// configured flag so SystemJS doesn't try to load a potentially
// non-existing package.json
System.packages[packageURL].configured=true;var packageInSystem=System.getConfig().packages[packageURL]||{};if(!packageInSystem.map)packageInSystem.map={};if(sysConfig){if(livelyConfig&&livelyConfig.main)main=livelyConfig.main;else if(sysConfig.main)main=sysConfig.main;this.applySystemJSConfig(sysConfig);}if(!main.match(/\.[^\/\.]+/))main+=".js";packageInSystem.main=main;// System.packages doesn't allow us to store our own properties
pkg.version=version;pkg.config=config;pkg._name=name;pkg.mergeWithConfig(packageInSystem);return livelyConfig?this.applyLivelyConfig(livelyConfig):{subPackages:[]};}},{key:"applySystemJSConfig",value:function applySystemJSConfig(sysConfig){var System=this.System;// System.debug && console.log("[lively.modules package configuration] applying SystemJS config of %s", pkg);
if(sysConfig.packageConfigPaths)System.config({packageConfigPaths:uniq(System.packageConfigPaths.concat(sysConfig.packageConfigPaths))});if(sysConfig.packages)// packages is normaly not support locally in a package.json
System.config({packages:sysConfig.packages});if(sysConfig.globalmap)System.config({map:sysConfig.globalmap});if(sysConfig.babelOptions)System.config({babelOptions:sysConfig.babelOptions});if(sysConfig.meta)System.config({meta:sysConfig.meta});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// lively config
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"applyLivelyConfig",value:function applyLivelyConfig(livelyConfig){// configures System object from lively config JSON object.
// - adds System.package entry for package
// - installs hook from {hooks: [{name, source}]}
// - merges livelyConfig.packageMap into System.package[pkg.url].map
//   entries in packageMap are specifically meant to be sub-packages!
// Will return a {subPackages: [packageURL,...]} object
this.applyLivelyConfigMeta(livelyConfig);this.applyLivelyConfigHooks(livelyConfig);this.applyLivelyConfigBundles(livelyConfig);}},{key:"applyLivelyConfigHooks",value:function applyLivelyConfigHooks(livelyConfig){var _this9=this;(livelyConfig.hooks||[]).forEach(function(h){try{var f=eval("("+h.source+")");if(!f.name||!isInstalled(_this9.System,h.target,f.name))install(_this9.System,h.target,f);}catch(e){console.error("Error installing hook for %s: %s",_this9.packageURL,e,h);}});}},{key:"applyLivelyConfigBundles",value:function applyLivelyConfigBundles(livelyConfig){var _this10=this;if(!livelyConfig.bundles)return Promise.resolve();var normalized=Object.keys(livelyConfig.bundles).reduce(function(bundles,name){var absName=_this10.packageURL+"/"+name,files=livelyConfig.bundles[name].map(function(f){return _this10.System.decanonicalize(f,_this10.packageURL+"/");});bundles[absName]=files;return bundles;},{});this.System.config({bundles:normalized});return Promise.resolve();}},{key:"applyLivelyConfigMeta",value:function applyLivelyConfigMeta(livelyConfig){if(!livelyConfig.meta)return;var pConf=this.System.getConfig().packages[this.packageURL]||{},c={meta:{},packages:_defineProperty({},this.packageURL,pConf)};Object.keys(livelyConfig.meta).forEach(function(key){var val=livelyConfig.meta[key];if(isURL(key)){c.meta[key]=val;}else{if(!pConf.meta)pConf.meta={};pConf.meta[key]=val;}});this.System.config(c);}},{key:"System",get:function get(){return this.pkg.System;}},{key:"packageURL",get:function get(){return this.pkg.url;}}]);return PackageConfiguration;}();function normalizePackageURL(System,packageURL){var allPackageURLs=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];if(allPackageURLs.some(function(ea){return ea===packageURL;}))return packageURL;var url=System.decanonicalize(packageURL.replace(/[\/]+$/,"")+"/");if(!isURL(url))throw new Error("Strange package URL: ".concat(url," is not a valid URL"));// ensure it's a directory
if(!url.match(/\.js/))url=url;else if(url.indexOf(url+".js")>-1)url=url.replace(/\.js$/,"");else url=url.split("/").slice(0,-1).join("/");if(url.match(/\.js$/)){console.warn("packageURL is expected to point to a directory but seems to be a .js file: "+url);}return String(url).replace(/\/$/,"");}function lookupPackage(System,packageURL){var isNormalized=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var registry=classHolder.PackageRegistry.ofSystem(System),allPackageURLs=registry.allPackageURLs(),url=isNormalized?packageURL:normalizePackageURL(System,packageURL,allPackageURLs);return{pkg:registry.findPackageWithURL(url),url:url,allPackageURLs:allPackageURLs,registry:registry};}function ensurePackage(System,packageURL){var isNormalized=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var _lookupPackage=lookupPackage(System,packageURL,isNormalized),pkg=_lookupPackage.pkg,url=_lookupPackage.url,registry=_lookupPackage.registry;return pkg||registry.addPackageAt(url,"devPackageDirs");}function getPackage(System,packageURL){var isNormalized=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var _lookupPackage2=lookupPackage(System,packageURL,isNormalized),pkg=_lookupPackage2.pkg,url=_lookupPackage2.url;if(pkg)return pkg;throw new Error("[getPackage] package ".concat(packageURL," (as ").concat(url,") not found"));}function applyConfig(System,packageConfig,packageURL){var p=getPackage(System,packageURL);return p.updateConfig(packageConfig);}function importPackage(System,packageURL){return Promise.resolve(ensurePackage(System,packageURL)).then(function(p){return p["import"]();});}function removePackage(System,packageURL){var _lookupPackage3=lookupPackage(System,packageURL),pkg=_lookupPackage3.pkg,url=_lookupPackage3.url,registry=_lookupPackage3.registry;return pkg?pkg.remove():null;}function reloadPackage(System,packageURL,opts){return getPackage(System,packageURL).reload(opts);}function registerPackage(System,packageURL,optPkgConfig){return Promise.resolve(ensurePackage(System,packageURL)).then(function(p){return p.register(optPkgConfig);});}// function normalizeInsidePackage(System, urlOrNameOrMap, packageURL) {
//   // for env dependend rules like {"node": "./foo.js", "~node": "./bar.js"}
//   if (typeof urlOrNameOrMap === "object") {
//     let map = urlOrNameOrMap,
//         env = System.get("@system-env"),
//         found = lively.lang.arr.findAndGet(Object.keys(map), key => {
//           let negate = false, pred = key;
//           if (pred.startsWith("~")) { negate = true; pred = pred.slice(1); }
//           let matches = env[pred]; if (negate) matches = !matches;
//           return matches ? map[key] : null;
//         });
//     if (found) return normalizeInsidePackage(System, found, packageURL);
//   }
// 
//   let urlOrName = urlOrNameOrMap;
//   return isURL(urlOrName) ?
//     // absolute
//     urlOrName :
//     // relative to either the package or the system:
//     urlResolve(join(urlOrName[0] === "." ? packageURL : System.baseURL, urlOrName));
// }
function getPackageSpecs(System){// Note does not return package instances but spec objects that can be JSON
// stringified(!) like
// ```
// [{
//   address: package-address,
//   modules: [module-name-1, module-name-2, ...],
//   name: package-name,
//   names: [package-name, ...]
//   version: semver version number
// }, ... ]
// ```
return Package.allPackages(System).map(function(p){return p.asSpec();});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// package object
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var Package=/*#__PURE__*/function(){_createClass(Package,null,[{key:"allPackages",value:function allPackages(System){return values(classHolder.PackageRegistry.ofSystem(System).byURL);}},{key:"allPackageURLs",value:function allPackageURLs(System){return classHolder.PackageRegistry.ofSystem(System).allPackageURLs();}},{key:"forModule",value:function forModule(System,module){return this.forModuleId(System,module.id);}},{key:"forModuleId",value:function forModuleId(System,moduleId){var pAddress=classHolder.ModulePackageMapping.forSystem(System).getPackageURLForModuleId(moduleId);return pAddress?getPackage(System,pAddress,true/*normalized*/):null;}},{key:"fromJSON",value:function fromJSON(System,jso){return new Package(System).fromJSON(jso);}}]);function Package(System,packageURL,name,version){var config=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};_classCallCheck(this,Package);this.System=System;this.url=packageURL;this.registerProcess=null;this.map={};this.setConfig(config);}_createClass(Package,[{key:"setConfig",value:function setConfig(config){this._name=config.name;this.version=config.version;this.dependencies=config.dependencies||{};this.devDependencies=config.devDependencies||{};this.main=config.main||"index.js";this.systemjs=config.systemjs;this.lively=config.lively;}},{key:"toJSON",value:function toJSON(){var System=this.System,jso=select(this,["url","_name","version","map","dependencies","devDependencies","main","systemjs","lively"]);if(jso.url.startsWith(System.baseURL))jso.url=jso.url.slice(System.baseURL.length).replace(/^\//,"");return jso;}},{key:"fromJSON",value:function fromJSON(jso){var System=this.System;this.url=jso.url;this._name=jso._name;this.version=jso.version;this.map=jso.map||{};this.main=jso.main;this.dependencies=jso.dependencies||{};this.devDependencies=jso.devDependencies||{};this.systemjs=jso.systemjs;this.lively=jso.lively;if(!isURL(this.url))this.url=join$1(System.baseURL,this.url);this.registerWithConfig();return this;}},{key:"asSpec",value:function asSpec(){return _objectSpread(_objectSpread({},select(this,["name","main","map","meta","url","address","version","lively"])),{},{modules:this.modules().map(function(m){return{name:m.id,deps:m.directRequirements().map(function(ea){return ea.id;})};})});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// accessing
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"path",value:function path(){var base=this.System.baseURL;return this.url.indexOf(base)===0?this.url.slice(base.length):this.url;}},{key:"modules",value:function modules(){var url=this.url,System=this.System;return classHolder.ModulePackageMapping.forSystem(System).getModuleIdsForPackageURL(url).map(function(id){return module$1(System,id);});}},{key:"resources",value:function(){var _resources=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee36(matches/*= url => url.match(/\.js$/)*/){var _this11=this;var exclude,System,url,allPackages,packagesToIgnore,dirList,resourceURLs,loadedModules,_args36=arguments;return regeneratorRuntime.wrap(function _callee36$(_context36){while(1){switch(_context36.prev=_context36.next){case 0:exclude=_args36.length>1&&_args36[1]!==undefined?_args36[1]:[".git","node_modules",".module_cache","lively.next-node_modules"];System=this.System;url=this.url;allPackages=Package.allPackageURLs(System);packagesToIgnore=allPackages.filter(function(purl){return purl!==url&&!url.startsWith(purl);}/*parent packages*/);_context36.next=7;return resource(url).dirList('infinity',{exclude:exclude});case 7:dirList=_context36.sent;resourceURLs=dirList.filter(function(ea){return!ea.isDirectory()&&!packagesToIgnore.some(function(purl){return ea.url.startsWith(purl);});}).map(function(ea){return ea.url;});loadedModules=pluck(this.modules(),"id");if(matches)resourceURLs=resourceURLs.filter(matches);return _context36.abrupt("return",resourceURLs.map(function(resourceURL){var nameInPackage=resourceURL.replace(url,"").replace(/^\//,""),isLoaded=loadedModules.includes(resourceURL);return{isLoaded:isLoaded,url:resourceURL,nameInPackage:nameInPackage,"package":_this11};}));case 12:case"end":return _context36.stop();}}},_callee36,this);}));function resources(_x33){return _resources.apply(this,arguments);}return resources;}()},{key:"hasResource",value:function hasResource(urlOrLocalName){var System=this.System,packageURL=this.url,res=urlOrLocalName.startsWith(packageURL)?resource(urlOrLocalName):resource(packageURL).join(urlOrLocalName);return res.exists();}},{key:"toString",value:function toString(){return"Package(".concat(this.name," - ").concat(this.path(),"/)");}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// configuration
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"mergeWithConfig",value:function mergeWithConfig(config){config=_objectSpread({},config);var _config=config,name=_config.name,map=_config.map;if(name){delete config.name;this._name=name;}if(map){delete config.map;Object.assign(this.map,map);}Object.assign(this,config);return this;}},{key:"addMapping",value:function addMapping(name,url){this.map[name]=url;this.System.config({packages:_defineProperty({},this.url,{map:_defineProperty({},name,url)})});}},{key:"tryToLoadPackageConfig",value:function(){var _tryToLoadPackageConfig=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee37(){var System,url,packageConfigURL,config,packageConfigPaths,name;return regeneratorRuntime.wrap(function _callee37$(_context37){while(1){switch(_context37.prev=_context37.next){case 0:System=this.System,url=this.url,packageConfigURL=url+"/package.json";System.config({meta:_defineProperty({},packageConfigURL,{format:"json"}),packages:_defineProperty({},url,{meta:{"package.json":{format:"json"}}})});System.debug&&console.log("[lively.modules package reading config] %s",packageConfigURL);_context37.prev=3;_context37.t0=System.get(packageConfigURL);if(_context37.t0){_context37.next=9;break;}_context37.next=8;return System["import"](packageConfigURL);case 8:_context37.t0=_context37.sent;case 9:config=_context37.t0;packageConfigPaths=_toConsumableArray2(System.packageConfigPaths);pushIfNotIncluded(packageConfigPaths,packageConfigURL);// to inform systemjs that there is a config
System.config({packageConfigPaths:packageConfigPaths});return _context37.abrupt("return",config);case 16:_context37.prev=16;_context37.t1=_context37["catch"](3);console.log("[lively.modules package] Unable loading package config %s for package: ",packageConfigURL,_context37.t1);delete System.meta[packageConfigURL];name=url.split("/").slice(-1)[0];return _context37.abrupt("return",{name:name});case 22:case"end":return _context37.stop();}}},_callee37,this,[[3,16]]);}));function tryToLoadPackageConfig(){return _tryToLoadPackageConfig.apply(this,arguments);}return tryToLoadPackageConfig;}()// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// register / load
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"import",value:function(){var _import2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee38(){var url,System,mainModule,exported;return regeneratorRuntime.wrap(function _callee38$(_context38){while(1){switch(_context38.prev=_context38.next){case 0:_context38.next=2;return this.register();case 2:url=this.url;System=this.System;_context38.t0=module$1;_context38.t1=System;_context38.next=8;return System.normalize(url);case 8:_context38.t2=_context38.sent;mainModule=(0,_context38.t0)(_context38.t1,_context38.t2);_context38.next=12;return System["import"](mainModule.id);case 12:exported=_context38.sent;_context38.next=15;return promise.waitFor(1000,function(){return mainModule.isLoaded();});case 15:return _context38.abrupt("return",exported);case 16:case"end":return _context38.stop();}}},_callee38,this);}));function _import(){return _import2.apply(this,arguments);}return _import;}()},{key:"isRegistering",value:function isRegistering(){return!!this.registerProcess;}},{key:"register",value:function(){var _register=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee39(optPkgConfig){var System,url,registerP,cfg,packageConfigResult;return regeneratorRuntime.wrap(function _callee39$(_context39){while(1){switch(_context39.prev=_context39.next){case 0:if(!this.isRegistering()){_context39.next=2;break;}return _context39.abrupt("return",this.registerProcess.promise);case 2:System=this.System,url=this.url;this.registerProcess=promise.deferred();registerP=this.registerProcess.promise;System.debug&&console.log("[lively.modules package register] %s",url);_context39.prev=6;_context39.t0=optPkgConfig;if(_context39.t0){_context39.next=12;break;}_context39.next=11;return this.tryToLoadPackageConfig();case 11:_context39.t0=_context39.sent;case 12:cfg=_context39.t0;packageConfigResult=this.registerWithConfig(cfg);this.registerProcess.resolve(cfg);_context39.next=21;break;case 17:_context39.prev=17;_context39.t1=_context39["catch"](6);this.registerProcess.reject(_context39.t1);throw _context39.t1;case 21:_context39.prev=21;delete this.registerProcess;return _context39.finish(21);case 24:return _context39.abrupt("return",registerP);case 25:case"end":return _context39.stop();}}},_callee39,this,[[6,17,21,24]]);}));function register(_x34){return _register.apply(this,arguments);}return register;}()},{key:"updateConfig",value:function updateConfig(config){config=_objectSpread(_objectSpread({},this.runtimeConfig),config);var name=this.name,version=this.version,_config2=config,newName=_config2.name,newVersion=_config2.version;new PackageConfiguration(this).applyConfig(config);if(name!==config.name||version!==config.version){console.log("[lively.modules] Updating registry ".concat(name,"@").concat(version," => ").concat(newName,"@").concat(newVersion));var registry=classHolder.PackageRegistry.ofSystem(this.System);registry.updateNameAndVersionOf(this,name,version,newName,newVersion);}}},{key:"registerWithConfig",value:function registerWithConfig(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.runtimeConfig;var System=this.System,url=this.url,result=new PackageConfiguration(this).applyConfig(config),packageConfigURL=join$1(url,"package.json");if(!System.get(packageConfigURL))System.set(packageConfigURL,System.newModule(_objectSpread(_objectSpread({},config),{},{"default":config})));emit("lively.modules/packageregistered",{"package":url},Date.now(),System);return result;}},{key:"remove",value:function remove(opts){opts=_objectSpread({forgetEnv:true,forgetDeps:false,unloadModules:true},opts);var System=this.System,url=this.url;url=url.replace(/\/$/,"");if(opts.unloadModules)this.modules().forEach(function(mod){return mod.unload(opts);});var registry=classHolder.PackageRegistry.ofSystem(System);registry.removePackage(this);var conf=System.getConfig(),packageConfigURL=url+"/package.json";System["delete"](String(packageConfigURL));_remove4(conf.packageConfigPaths||[],packageConfigURL);System.config({meta:_defineProperty({},packageConfigURL,{}),packages:_defineProperty({},url,{}),packageConfigPaths:conf.packageConfigPaths});delete System.packages[url];emit("lively.modules/packageremoved",{"package":this.url},Date.now(),System);}},{key:"reload",value:function reload(opts){var System=this.System,url=this.url,registry=classHolder.PackageRegistry.ofSystem(System),covered=registry.coversDirectory(url);this.remove(opts);registry.addPackageAt(url,covered||"devPackageDirs",_defineProperty({},url,this));return this["import"]();}},{key:"fork",value:function(){var _fork=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee40(newName,newURL){return regeneratorRuntime.wrap(function _callee40$(_context40){while(1){switch(_context40.prev=_context40.next){case 0:if(!newURL){newURL=resource(this.url).join("../".concat(newName)).withRelativePartsResolved().url;}_context40.next=3;return this.changeAddress(newURL,newName,false/*removeOriginal*/);case 3:return _context40.abrupt("return",_context40.sent);case 4:case"end":return _context40.stop();}}},_callee40,this);}));function fork(_x35,_x36){return _fork.apply(this,arguments);}return fork;}()},{key:"rename",value:function(){var _rename3=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee41(newName){var newURL;return regeneratorRuntime.wrap(function _callee41$(_context41){while(1){switch(_context41.prev=_context41.next){case 0:newURL=resource(this.url).join("../".concat(newName)).withRelativePartsResolved().url;_context41.next=3;return this.changeAddress(newURL,newName,true/*removeOriginal*/);case 3:return _context41.abrupt("return",_context41.sent);case 4:case"end":return _context41.stop();}}},_callee41,this);}));function rename(_x37){return _rename3.apply(this,arguments);}return rename;}()},{key:"changeAddress",value:function(){var _changeAddress=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee42(newURL){var newName,removeOriginal,System,oldURL,oldName,oldVersion,config,oldPackageDir,newP,newPackageDir,registry,covered,resourceURLs,modules,_iterator29,_step29,_m3,newId,resourceIndex,_iterator30,_step30,url,_r,localName,configFile,_c3,runtimeC,_args42=arguments;return regeneratorRuntime.wrap(function _callee42$(_context42){while(1){switch(_context42.prev=_context42.next){case 0:newName=_args42.length>1&&_args42[1]!==undefined?_args42[1]:null;removeOriginal=_args42.length>2&&_args42[2]!==undefined?_args42[2]:true;newURL=newURL.replace(/\/?/,"");System=this.System;oldURL=this.url;oldName=this.name;oldVersion=this.version;_context42.next=9;return this.runtimeConfig;case 9:config=_context42.sent;oldPackageDir=resource(oldURL).asDirectory();newP=new Package(System,newURL);_context42.next=14;return resource(newURL).asDirectory();case 14:newPackageDir=_context42.sent;config.name=newName||this.name;registry=classHolder.PackageRegistry.ofSystem(System),covered=registry.coversDirectory(oldURL);classHolder.ModulePackageMapping.forSystem(System).clearCache();if(System.packages[oldURL]){System.packages[newURL]=System.packages[oldURL];if(removeOriginal)delete System.packages[oldURL];}Object.assign(newP,select(this,["_name","map","config"]));_context42.next=22;return newPackageDir.ensureExistance();case 22:_context42.next=24;return this.resources(undefined,[]);case 24:_context42.t0=function(ea){return ea.url;};resourceURLs=_context42.sent.map(_context42.t0);modules=this.modules();// first move modules loaded in runtime, those now how to rename
// themselves...
_iterator29=_createForOfIteratorHelper(modules);_context42.prev=28;_iterator29.s();case 30:if((_step29=_iterator29.n()).done){_context42.next=44;break;}_m3=_step29.value;newId=newPackageDir.join(_m3.pathInPackage()).url;if(!removeOriginal){_context42.next=38;break;}_context42.next=36;return _m3.renameTo(newId);case 36:_context42.next=40;break;case 38:_context42.next=40;return _m3.copyTo(newId);case 40:// keep track of resources
resourceIndex=resourceURLs.indexOf(_m3.id);if(resourceIndex>-1){resourceURLs.splice(resourceIndex,1);}case 42:_context42.next=30;break;case 44:_context42.next=49;break;case 46:_context42.prev=46;_context42.t1=_context42["catch"](28);_iterator29.e(_context42.t1);case 49:_context42.prev=49;_iterator29.f();return _context42.finish(49);case 52:// ensure the existance of the remaining resources
_iterator30=_createForOfIteratorHelper(resourceURLs);_context42.prev=53;_iterator30.s();case 55:if((_step30=_iterator30.n()).done){_context42.next=62;break;}url=_step30.value;_r=resource(url),localName=_r.relativePathFrom(oldPackageDir);_context42.next=60;return _r.copyTo(newPackageDir.join(localName));case 60:_context42.next=55;break;case 62:_context42.next=67;break;case 64:_context42.prev=64;_context42.t2=_context42["catch"](53);_iterator30.e(_context42.t2);case 67:_context42.prev=67;_iterator30.f();return _context42.finish(67);case 70:if(!removeOriginal){_context42.next=75;break;}_context42.next=73;return this.remove({forgetEnv:true,forgetDeps:false});case 73:_context42.next=75;return oldPackageDir.remove();case 75:if(!newName){_context42.next=96;break;}newP.name=newName;newP.config.name=newName;configFile=resource(newURL).join("package.json");_context42.prev=79;_context42.next=82;return configFile.exists();case 82:if(!_context42.sent){_context42.next=92;break;}_context42.next=85;return configFile.readJson();case 85:_c3=_context42.sent;if(!(_c3.name===this.name)){_context42.next=90;break;}_c3.name=newName;_context42.next=90;return configFile.writeJson(_c3,true);case 90:runtimeC=System.get(configFile.url);if(runtimeC){System.set(configFile.url,System.newModule(_objectSpread(_objectSpread({},runtimeC),{},{name:newName})));}case 92:_context42.next=96;break;case 94:_context42.prev=94;_context42.t3=_context42["catch"](79);case 96:// PackageRegistry update;
covered=covered||"individualPackageDirs";if(covered==="individualPackageDirs"||covered==="devPackageDirs"){registry._addPackageDir(newURL,covered,true/*uniqCheck*/);}registry._addPackageWithConfig(newP,config,newURL,covered);registry.resetByURL();registry._updateLatestPackages();return _context42.abrupt("return",newP);case 102:case"end":return _context42.stop();}}},_callee42,this,[[28,46,49,52],[53,64,67,70],[79,94]]);}));function changeAddress(_x38){return _changeAddress.apply(this,arguments);}return changeAddress;}()// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// searching
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"search",value:function(){var _search=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee43(needle){var _this12=this;var options,modules,_args43=arguments;return regeneratorRuntime.wrap(function _callee43$(_context43){while(1){switch(_context43.prev=_context43.next){case 0:options=_args43.length>1&&_args43[1]!==undefined?_args43[1]:{};if(!options.includeUnloaded){_context43.next=8;break;}_context43.next=4;return this.resources(function(url){return url.endsWith(".js");},[".git","node_modules","dist",".module_cache","lively.next-node_modules"]);case 4:_context43.t1=function(_ref13){var url=_ref13.url;return module$1(_this12.System,url);};_context43.t0=_context43.sent.map(_context43.t1);_context43.next=9;break;case 8:_context43.t0=this.modules().filter(function(ea){return ea.isLoaded();});case 9:modules=_context43.t0;return _context43.abrupt("return",Promise.all(modules.map(function(m){return m.search(needle,options)["catch"](function(err){console.error("Error searching module ".concat(m.name,":\n").concat(err.stack));return[];});})).then(function(res){return flatten(res,1);}));case 11:case"end":return _context43.stop();}}},_callee43,this);}));function search(_x39){return _search.apply(this,arguments);}return search;}()},{key:"isPackage",get:function get(){return true;}},{key:"name",get:function get(){if(this._name)return this._name;var config=this.System.get(this.url+"/package.json");if(config&&config.name)return config.name;return last(this.url.replace(/[\/]+$/,"").split("/"));},set:function set(v){return this._name=v;}},{key:"nameAndVersion",get:function get(){return"".concat(this.name,"@").concat(this.version);}},{key:"address",get:function get(){return this.url;},set:function set(v){return this.url=v;}},{key:"runtimeConfig",get:function get(){var name=this.name,version=this.version,dependencies=this.dependencies,devDependencies=this.devDependencies,main=this.main,systemjs=this.systemjs,lively=this.lively,config={name:name,version:version,dependencies:dependencies||{},devDependencies:devDependencies||{}};if(main)config.main=main;if(systemjs)config.systemjs=systemjs;if(lively)config.lively=lively;return config;}}]);return Package;}();var initializeSymbol=Symbol["for"]('lively-instance-initialize');var superclassSymbol=Symbol["for"]('lively-instance-superclass');var moduleMetaSymbol=Symbol["for"]('lively-module-meta');var objMetaSymbol=Symbol["for"]('lively-object-meta');var moduleSubscribeToToplevelChangesSym=Symbol["for"]('lively-klass-changes-subscriber');function getClassHierarchy(klass){var curr=klass;var hierarchy=[];do{hierarchy.push(curr);curr=curr[superclassSymbol];}while(curr&&curr.name);return hierarchy.map(function(c){return c.name;}).join('->');}// compactness
var defaultPropertiesKey="properties",propertiesAndSettingsCacheSym=Symbol["for"]("lively.classes-properties-and-settings");var defaultPropertySettings={defaultSetter:null,defaultGetter:null,valueStoreProperty:"_state"};function prepareClassForManagedPropertiesAfterCreation(klass){var _propertiesAndSetting=propertiesAndSettingsInHierarchyOf(klass),properties=_propertiesAndSetting.properties,propertySettings=_propertiesAndSetting.propertySettings;klass[propertiesAndSettingsCacheSym]={properties:properties,order:sortKeysWithBeforeAndAfterConstraints(properties),propertySettings:propertySettings,classHierarchy:getClassHierarchy(klass)};if(!properties||_typeof2(properties)!=="object"){console.warn("Class ".concat(klass.name," indicates it has managed properties but its ")+"properties accessor (".concat(defaultPropertiesKey,") does not return ")+"a valid property descriptor map");return;}prepareClassForProperties(klass,propertySettings,properties);}function prepareClassForProperties(klass,propertySettings,properties){ensurePropertyInitializer(klass);var valueStoreProperty=propertySettings.valueStoreProperty,defaultGetter=propertySettings.defaultGetter,defaultSetter=propertySettings.defaultSetter,myProto=klass.prototype,keys=Object.keys(properties);keys.forEach(function(key){var descriptor=properties[key];// ... define a getter to the property for the outside world...
var hasGetter=myProto.hasOwnProperty(key)&&myProto.__lookupGetter__(key);if(!hasGetter||hasGetter._wasGenerated){var getter=descriptor.get||typeof defaultGetter==="function"&&function(){return defaultGetter.call(this,key);}||function(){return this[valueStoreProperty][key];};getter._wasGenerated=true;myProto.__defineGetter__(key,getter);}// ...define a setter if necessary
var hasSetter=myProto.hasOwnProperty(key)&&myProto.__lookupSetter__(key);if(!hasSetter||hasSetter._wasGenerated){var descrHasSetter=descriptor.hasOwnProperty("set"),setterNeeded=descrHasSetter||!descriptor.readOnly;if(setterNeeded){var setter=descriptor.set||typeof defaultSetter==="function"&&function(val){defaultSetter.call(this,key,val);}||function(val){this[valueStoreProperty][key]=val;};setter._wasGenerated=true;myProto.__defineSetter__(key,setter);}}});}function ensurePropertyInitializer(klass){// when we inherit from "conventional classes" those don't have an
// initializer method. We install a stub that calls the superclass function
// itself
Object.defineProperty(klass.prototype,"propertiesAndPropertySettings",{enumerable:false,configurable:true,writable:true,value:function value(){var klass=this.constructor,cached=klass[propertiesAndSettingsCacheSym];if(cached){if(cached.classHierarchy!=getClassHierarchy(klass)){var _propertiesAndSetting2=propertiesAndSettingsInHierarchyOf(klass),properties=_propertiesAndSetting2.properties,propertySettings=_propertiesAndSetting2.propertySettings;klass[propertiesAndSettingsCacheSym]={properties:properties,propertySettings:propertySettings,order:sortKeysWithBeforeAndAfterConstraints(properties),classHierarchy:getClassHierarchy(klass)};prepareClassForProperties(klass,propertySettings,properties);}else{return cached;}}return klass[propertiesAndSettingsCacheSym]||propertiesAndSettingsInHierarchyOf(klass);}});Object.defineProperty(klass.prototype,"initializeProperties",{enumerable:false,configurable:true,writable:true,value:function value(values){var _this$propertiesAndPr=this.propertiesAndPropertySettings(),properties=_this$propertiesAndPr.properties,propertySettings=_this$propertiesAndPr.propertySettings,order=_this$propertiesAndPr.order;prepareInstanceForProperties(this,propertySettings,properties,values,order);return this;}});}function propertiesAndSettingsInHierarchyOf(klass){// walks class proto chain
var propertySettings=_objectSpread({},defaultPropertySettings),properties={},allPropSettings=valuesInPropertyHierarchy(klass,"propertySettings"),allProps=valuesInPropertyHierarchy(klass,"properties");for(var i=0;i<allPropSettings.length;i++){var current=allPropSettings[i];current&&_typeof2(current)==="object"&&Object.assign(propertySettings,current);}for(var i=0;i<allProps.length;i++){var _current=allProps[i];if(_typeof2(_current)!=="object"){console.error("[initializeProperties] ".concat(klass," encountered property declaration ")+"that is not a JS object: ".concat(_current));continue;}// "deep" merge
for(var name in _current){if(!properties.hasOwnProperty(name))properties[name]=_current[name];else Object.assign(properties[name],_current[name]);}}return{properties:properties,propertySettings:propertySettings};}function prepareInstanceForProperties(instance,propertySettings,properties,values,sortedKeys){var valueStoreProperty=propertySettings.valueStoreProperty,sortedKeys=sortedKeys||sortKeysWithBeforeAndAfterConstraints(properties),propsNeedingInitialize=[],initActions={};// 1. this[valueStoreProperty] is were the actual values will be stored
if(!instance.hasOwnProperty(valueStoreProperty))instance[valueStoreProperty]={};for(var i=0;i<sortedKeys.length;i++){var key=sortedKeys[i],descriptor=properties[key];var derived=descriptor.derived,foldable=!!descriptor.foldable,defaultValue=descriptor.hasOwnProperty("defaultValue")?descriptor.defaultValue:undefined;if(Array.isArray(defaultValue))defaultValue=defaultValue.slice();if(!derived&&!foldable)instance[valueStoreProperty][key]=defaultValue;var initAction=void 0;if(descriptor.hasOwnProperty("initialize")){initAction=initActions[key]={initialize:defaultValue};propsNeedingInitialize.push(key);}else if(derived&&defaultValue!==undefined){initAction=initActions[key]={derived:defaultValue};propsNeedingInitialize.push(key);}else if(foldable&&defaultValue!==undefined){initAction=initActions[key]={folded:defaultValue};propsNeedingInitialize.push(key);}if(values&&key in values){if(descriptor.readOnly){console.warn("Trying to initialize read-only property ".concat(key," in ").concat(instance,", ")+"skipping setting value");}else{if(!initAction){initAction=initActions[key]={};propsNeedingInitialize.push(key);}initAction.value=values[key];}}}// 2. Run init code for properties
// and if we have values we will initialize the properties from it. Values
// is expected to be a JS object mapping property names to property values
for(var i=0;i<propsNeedingInitialize.length;i++){var _key12=propsNeedingInitialize[i],actions=initActions[_key12],hasValue=actions.hasOwnProperty("value");// if we have an initialize function we call it either with the value from
// values or with the defaultValue
if(actions.hasOwnProperty("initialize")){var value=hasValue?actions.value:actions.initialize;properties[_key12].initialize.call(instance,value);if(hasValue)instance[_key12]=actions.value;}// if we have a derived property we will call the setter with the default
// value or the value from values
else if(actions.hasOwnProperty("derived")){instance[_key12]=hasValue?actions.value:actions.derived;}else if(actions.hasOwnProperty("folded")){instance[_key12]=hasValue?actions.value:actions.folded;}// if we only have the value from values we simply call the setter with it
else if(hasValue){instance[_key12]=actions.value;}}}var constructorArgMatcher=/\([^\\)]*\)/;var defaultPropertyDescriptorForGetterSetter={enumerable:false,configurable:true};var defaultPropertyDescriptorForValue={enumerable:false,configurable:true,writable:true};var setPrototypeOf=typeof Object.setPrototypeOf==="function"?function(obj,proto){return Object.setPrototypeOf(obj,proto);}:function(obj,proto){return obj.__proto__=proto;};function setSuperclass(klass,superclassOrSpec){// define klass.prototype, klass.prototype[constructor], klass[superclassSymbol]
var superclass=!superclassOrSpec?Object:typeof superclassOrSpec==="function"?superclassOrSpec:superclassOrSpec.value?superclassOrSpec.value:Object;var existingSuperclass=klass&&klass[superclassSymbol];// set the superclass if necessary and set prototype
if(!existingSuperclass||existingSuperclass!==superclass){ensureInitializeStub(superclass);klass[superclassSymbol]=superclass;setPrototypeOf(klass.prototype,superclass.prototype);if(superclass!==Object)setPrototypeOf(klass,superclass);}return superclass;}function installValueDescriptor(object,klass,descr){descr=Object.assign(descr,defaultPropertyDescriptorForValue);descr.value.displayName=descr.key;if(descr.needsDeclaringClass){var orig=descr.value.originalFunction||descr.value;descr.value=Object.assign(function declaring_class_wrapper()/*args*/{return orig.call.apply(orig,[this,klass].concat(Array.prototype.slice.call(arguments)));},{originalFunction:orig,toString:function toString(){return orig.toString();},displayName:descr.key});}Object.defineProperty(object,descr.key,descr);}function installGetterSetterDescriptor(klass,descr){descr=Object.assign(descr,defaultPropertyDescriptorForGetterSetter);Object.defineProperty(klass,descr.key,descr);}function installMethods(klass,instanceMethods,classMethods){// install methods from two lists (static + instance) of {key, value} or
// {key, get/set} descriptors
classMethods&&classMethods.forEach(function(ea){ea.value?installValueDescriptor(klass,klass,ea):installGetterSetterDescriptor(klass,ea);});instanceMethods&&instanceMethods.forEach(function(ea){ea.value?installValueDescriptor(klass.prototype,klass,ea):installGetterSetterDescriptor(klass.prototype,ea);});// 4. define initializer method, in our class system the constructor is
// generic and re-directs to the initializer method. This way we can change
// the constructor without loosing the identity of the class
if(!klass.prototype[initializeSymbol]){Object.defineProperty(klass.prototype,initializeSymbol,{enumerable:false,configurable:true,writable:true,value:function value(){}});klass.prototype[initializeSymbol].isDefaultInitializer=true;klass.prototype[initializeSymbol].displayName="lively-initialize";}else{if(Object.getOwnPropertySymbols(klass.prototype).includes(initializeSymbol)){if(klass.prototype[initializeSymbol].isDefaultInitializer){if(klass[superclassSymbol].prototype[initializeSymbol]){delete klass.prototype[initializeSymbol];}}}}// 5. undefine properties that were removed form class definition
var instanceMethodsInClass=instanceMethods.map(function(m){return m.key;}).concat(["constructor","arguments","caller"]),instanceAttributes=Object.getOwnPropertyNames(klass.prototype);for(var _i98=0;_i98<instanceAttributes.length;_i98++){var name=instanceAttributes[_i98];if(!instanceMethodsInClass.includes(name))delete klass.prototype[name];}var classMethodsInClass=classMethods.map(function(m){return m.key;}).concat(["length","name","prototype","arguments","caller"]),classAttributes=Object.getOwnPropertyNames(klass);for(var _i99=0;_i99<classAttributes.length;_i99++){var _name=classAttributes[_i99];if(!classMethodsInClass.includes(_name))delete klass[_name];}}function ensureInitializeStub(superclass){// when we inherit from "conventional classes" those don't have an
// initializer method. We install a stub that calls the superclass function
// itself
if(superclass===Object||superclass.prototype[initializeSymbol])return;Object.defineProperty(superclass.prototype,initializeSymbol,{enumerable:false,configurable:true,writable:true,value:function value()/*args*/{superclass.apply(this,arguments);}});superclass.prototype[initializeSymbol].displayName="lively-initialize-stub";}function initializeClass(constructorFunc,superclassSpec){var instanceMethods=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var classMethods=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];var classHolder=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};var currentModule=arguments.length>5?arguments[5]:undefined;var sourceLoc=arguments.length>6?arguments[6]:undefined;// Given a `classHolder` object as "environment", will try to find a "class"
// (JS constructor function) inside it. If no class is found it will create a
// new costructor function object and will attach the methods to it. If a class
// is found it will be modified.
// This is being used as the compile target for es6 class syntax by the
// lively.ast capturing / transform logic
// Example:
// var Foo = function(superclass) {
//   function Foo() {}
//   return initializeClass(Foo, superclass, [{key: "m", value: function m() { return 23 }}])
// }();
// new Foo().m() // => 23
// 1. create a new constructor function if necessary, re-use an exisiting if the
// classHolder object has it
var className=constructorFunc.name,klass=className&&classHolder.hasOwnProperty(className)&&classHolder[className],existingSuperclass=klass&&klass[superclassSymbol];if(!klass||typeof klass!=="function"||!existingSuperclass)klass=constructorFunc;// 2. set the superclass if necessary and set prototype
var superclass=setSuperclass(klass,superclassSpec);// 3. Install methods
installMethods(klass,instanceMethods,classMethods);klass[objMetaSymbol]=sourceLoc;// 4. If we have a `currentModule` instance (from lively.modules/src/module.js)
// then we also store some meta data about the module. This allows us to
// (de)serialize class instances in lively.serializer
if(currentModule){var p=currentModule["package"]();var prevMeta=klass[moduleMetaSymbol];var t=Date.now();klass[moduleMetaSymbol]={"package":p?{name:p.name,version:p.version}:{},pathInPackage:p?currentModule.pathInPackage():currentModule.id,lastChange:prevMeta&&prevMeta.lastChange&&t<=prevMeta.lastChange?prevMeta.lastChange+1:t,lastSuperclassChange:0};// if we have a module, we can listen to toplevel changes of it in case the
// superclass binding changes. With that we can keep our class up-to-date
// even if the superclass binding changes. This is especially useful for
// situations where modules have a circular dependency and classes in modules
// won't get defined correctly when loaded first. See
// https://github.com/LivelyKernel/lively.modules/issues/27 for more details
if(superclassSpec&&superclassSpec.referencedAs){if(klass.hasOwnProperty(moduleSubscribeToToplevelChangesSym)){currentModule.unsubscribeFromToplevelDefinitionChanges(klass[moduleSubscribeToToplevelChangesSym]);}klass[moduleSubscribeToToplevelChangesSym]=currentModule.subscribeToToplevelDefinitionChanges(function(name,val){if(name!==superclassSpec.referencedAs)return;// console.log(`class ${className}: new superclass ${name} ${name !== superclassSpec.referencedAs ? '(' + superclassSpec.referencedAs + ')' : ''} was defined via module bindings`)
// Only run through the (expensive) updates if superclass really has changes
var superMeta=val&&val[moduleMetaSymbol],myMeta=klass[moduleMetaSymbol];if(superMeta){if(superMeta.lastChange===myMeta.lastSuperclassChange)return;myMeta.lastSuperclassChange=superMeta.lastChange;}setSuperclass(klass,val);installMethods(klass,instanceMethods,classMethods);prepareClassForManagedPropertiesAfterCreation(klass);});}}// 6. Add a toString method for the class to allows us to see its constructor arguments
klass.toString=function(){var constructorArgs=String(this.prototype[initializeSymbol]).match(constructorArgMatcher),className=this.name,superclass=this[superclassSymbol];return"class ".concat(className," ").concat(superclass?"extends ".concat(superclass.name):""," {\n")+"  constructor".concat(constructorArgs?constructorArgs[0]:"()"," { /*...*/ }")+"\n}";};// 7. If the class allows managed properties (auto getters/setters etc., see
// managed-properties.js) then setup those
prepareClassForManagedPropertiesAfterCreation(klass);return klass;}initializeClass._get=function _get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);return parent===null?undefined:_get(parent,property,receiver);}if("value"in desc)return desc.value;var getter=desc.get;return getter===undefined?undefined:getter.call(receiver);};initializeClass._set=function _set(object,property,value,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent!==null)_set(parent,property,value,receiver);}else if("value"in desc&&desc.writable)desc.value=value;else{var setter=desc.set;if(setter!==undefined)setter.call(receiver,value);}return value;};var assign$2=nodes.assign,member$3=nodes.member,id$3=nodes.id,exprStmt$2=nodes.exprStmt,funcCall$2=nodes.funcCall,literal$5=nodes.literal,objectLiteral$2=nodes.objectLiteral,varDecl$2=nodes.varDecl,funcExpr$1=nodes.funcExpr,returnStmt$1=nodes.returnStmt,binaryExpr$2=nodes.binaryExpr,ifStmt$1=nodes.ifStmt,block$2=nodes.block;function isFunctionNode(node){return node.type==="ArrowFunctionExpression"||node.type==="FunctionExpression"||node.type==="FunctionDeclaration";}var firstIdRe=/^[^_a-z]/i,trailingIdRe=/[^_a-z0-9]/ig;function ensureIdentifier(name){return name.replace(firstIdRe,"_").replace(trailingIdRe,"_");}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function constructorTemplate(name){// Creates a function like
// function CLASS() {
//   var firstArg = arguments[0];
//   if (firstArg && firstArg[Symbol.for("lively-instance-restorer")]) {
//     // for deserializing instances just do nothing
//   } else {
//     // automatically call the initialize method
//     this[Symbol.for("lively-instance-initialize")].apply(this, arguments);
//   }
// }
return funcExpr$1({id:name?id$3(name):null},["__first_arg__"],ifStmt$1(binaryExpr$2(id$3("__first_arg__"),"&&",member$3("__first_arg__",funcCall$2(member$3("Symbol","for"),literal$5("lively-instance-restorer")),true)),block$2(),block$2(exprStmt$2(funcCall$2(member$3(member$3("this",funcCall$2(member$3("Symbol","for"),literal$5("lively-instance-initialize")),true),"apply"),id$3("this"),id$3("arguments"))))));}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var isTransformedClassVarDeclSymbol=Symbol();var methodKindSymbol=Symbol();var tempLivelyClassVar="__lively_class__";var tempLivelyClassHolderVar="__lively_classholder__";var ClassReplaceVisitor=/*#__PURE__*/function(_Visitor9){_inherits(ClassReplaceVisitor,_Visitor9);var _super13=_createSuper(ClassReplaceVisitor);function ClassReplaceVisitor(){_classCallCheck(this,ClassReplaceVisitor);return _super13.apply(this,arguments);}_createClass(ClassReplaceVisitor,[{key:"accept",value:function accept(node,state,path){if(isFunctionNode(node)){state=_objectSpread(_objectSpread({},state),{},{classHolder:objectLiteral$2([]),currentMethod:node[methodKindSymbol]?node:state.currentMethod});}if(node.type==="ClassExpression"||node.type==="ClassDeclaration")node=replaceClass(node,state,path,state.options);if(node.type==="Super")node=replaceSuper(node,state,path,state.options);if(node.type==="MemberExpression"&&node.object&&node.object.type==="Super")node=replaceSuperGetter(node,state,path,state.options);if(node.type==="AssignmentExpression"&&node.left.type==="MemberExpression"&&node.left.object.type==="Super")node=replaceSuperSetter(node,state,path,state.options);if(node.type==="CallExpression"&&node.callee.type==="Super")node=replaceDirectSuperCall(node,state,path,state.options);if(node.type==="CallExpression"&&node.callee.object&&node.callee.object.type==="Super")node=replaceSuperMethodCall(node,state,path,state.options);node=_get2(_getPrototypeOf(ClassReplaceVisitor.prototype),"accept",this).call(this,node,state,path);if(node.type==="ExportDefaultDeclaration")return splitExportDefaultWithClass(node,state,path,state.options);return node;}}],[{key:"run",value:function run(parsed,options){var v=new this(),classHolder=options.classHolder||objectLiteral$2([]);return v.accept(parsed,{options:options,classHolder:classHolder},[]);}}]);return ClassReplaceVisitor;}(Visitor);function replaceSuper(node,state,path,options){// just super
console.assert(node.type==="Super");var currentMethod=state.currentMethod;if(!currentMethod){console.warn("[lively.classes] Trying to transform es6 class but got super call outside a method! ".concat(stringify(node)," in ").concat(path.join(".")));// return node;
}var _path$slice=path.slice(-2),_path$slice2=_slicedToArray2(_path$slice,2),parentReferencedAs=_path$slice2[0],referencedAs=_path$slice2[1];if(parentReferencedAs==='callee'&&referencedAs==='object'||referencedAs==='callee')return node;// deal with this in replaceSuperCall
var methodHolder=currentMethod&&currentMethod[methodKindSymbol]==="static"?funcCall$2(member$3("Object","getPrototypeOf"),id$3(tempLivelyClassVar)):funcCall$2(member$3("Object","getPrototypeOf"),member$3(id$3(tempLivelyClassVar),"prototype"));return methodHolder;}// parse("class Foo extends Bar { get x() { return super.x; }}").body[0]
function replaceSuperMethodCall(node,state,path,options){// like super.foo()
console.assert(node.type==="CallExpression");console.assert(node.callee.object.type==="Super");return funcCall$2.apply(void 0,[member$3(funcCall$2(member$3(options.functionNode,"_get"),replaceSuper(node.callee.object,state,path.concat(["callee","object"])),literal$5(node.callee.property.value||node.callee.property.name),id$3("this")),"call"),id$3("this")].concat(_toConsumableArray2(node.arguments)));}function replaceDirectSuperCall(node,state,path,options){// like super()
console.assert(node.type==="CallExpression");console.assert(node.callee.type==="Super");return funcCall$2.apply(void 0,[member$3(funcCall$2(member$3(options.functionNode,"_get"),replaceSuper(node.callee,state,path.concat(["callee"])),funcCall$2(member$3("Symbol","for"),literal$5("lively-instance-initialize")),id$3("this")),"call"),id$3("this")].concat(_toConsumableArray2(node.arguments)));}function replaceSuperGetter(node,state,path,options){console.assert(node.type==="MemberExpression");console.assert(node.object.type==="Super");return funcCall$2(member$3(options.functionNode,"_get"),replaceSuper(node.object,state,path.concat(["object"])),literal$5(node.property.value||node.property.name),id$3("this"));}function replaceSuperSetter(node,state,path,options){console.assert(node.type==="AssignmentExpression");console.assert(node.left.object.type==="Super");return funcCall$2(member$3(options.functionNode,"_set"),replaceSuper(node.left.object,state,path.concat(["left","object"])),literal$5(node.left.property.value||node.left.property.name),node.right,id$3("this"));}function replaceClass(node,state,path,options){console.assert(node.type==="ClassDeclaration"||node.type==="ClassExpression");var body=node.body.body,superClass=node.superClass,classId=node.id,type=node.type,start=node.start,end=node.end,_options$addClassName=options.addClassNameGetter,addClassNameGetter=_options$addClassName===void 0?true:_options$addClassName,instanceProps=id$3("undefined"),classProps=id$3("undefined"),className=classId?classId.name:"anonymous_class",evalId=options.evalId,sourceAccessorName=options.sourceAccessorName,loc=node["x-lively-object-meta"]||{start:start,end:end};if(body.length){var _body$reduce=body.reduce(function(props,propNode){var decl,key=propNode.key,kind=propNode.kind,value=propNode.value,classSide=propNode["static"];if(key.type!=="Literal"&&key.type!=="Identifier"){console.warn("Unexpected key in classToFunctionTransform! ".concat(JSON.stringify(key)));}if(kind==="method"){// The name is just for debugging purposes when it appears in
// native debuggers. We have to be careful about it b/c it shadows
// outer functions / vars, something that is totally not apparent for a user
// of the class syntax. That's the reason for making it a little cryptic
var methodId=id$3(className+"_"+ensureIdentifier(key.name||key.value||Path('property.name').get(key))+"_"),_props=["key",literal$5(key.name||key.value||Path('property.name').get(key)),"value",_objectSpread(_objectSpread({},value),{},_defineProperty({id:methodId},methodKindSymbol,classSide?"static":"proto"))];decl=objectLiteral$2(_props);}else if(kind==="get"||kind==="set"){decl=objectLiteral$2(["key",literal$5(key.name||key.value||Path('property.name').get(key)),kind,Object.assign({},value,_defineProperty({id:id$3(kind)},methodKindSymbol,classSide?"static":"proto"))]);}else if(kind==="constructor"){var _props2=["key",funcCall$2(member$3("Symbol","for"),literal$5("lively-instance-initialize")),"value",_objectSpread(_objectSpread({},value),{},_defineProperty({id:id$3(className+"_initialize_")},methodKindSymbol,"proto"))];decl=objectLiteral$2(_props2);}else{console.warn("[lively.classes] classToFunctionTransform encountered unknown class property with kind ".concat(kind,", ignoring it, ").concat(JSON.stringify(propNode)));}(classSide?props.clazz:props.inst).push(decl);return props;},{inst:[],clazz:addClassNameGetter?[// explicitly add in a static property to ensure the class name is accessible also in google closure env
parse$2("({ key: Symbol.for(\"__LivelyClassName__\"), get: function get() { return \"".concat(className,"\"; } })")).body[0].expression]:[]}),inst=_body$reduce.inst,clazz=_body$reduce.clazz;if(inst.length)instanceProps={type:"ArrayExpression",elements:inst};if(clazz.length)classProps={type:"ArrayExpression",elements:clazz};}var scope=options.scope,superClassReferencedAs,superClassRef;if(superClass&&options.currentModuleAccessor){if(options.classHolder===superClass.object){superClassRef=superClass;superClassReferencedAs=superClass.property.name;}else{var found=scope&&scope.resolvedRefMap&&scope.resolvedRefMap.get(superClass),isTopLevel=found&&found.decl&&scope.decls&&scope.decls.find(function(_ref14){var _ref15=_slicedToArray2(_ref14,1),decl=_ref15[0];return decl===found.decl;});if(isTopLevel){superClassRef=superClass;superClassReferencedAs=superClass.name;}}}var superClassSpec=superClassRef?objectLiteral$2(["referencedAs",literal$5(superClassReferencedAs),"value",superClassRef]):superClass||id$3("undefined");// For persistent storage and retrieval of pre-existing classes in "classHolder" object
var useClassHolder=classId&&type==="ClassDeclaration";var locKeyVals=["start",literal$5(loc.start),"end",literal$5(loc.end)];if(typeof evalId!=="undefined")locKeyVals.push("evalId",literal$5(evalId));if(sourceAccessorName)locKeyVals.push("moduleSource",id(sourceAccessorName));var locNode=objectLiteral$2(locKeyVals);var classCreator=funcCall$2(funcExpr$1({},["superclass"],varDecl$2(tempLivelyClassHolderVar,state.classHolder),varDecl$2(tempLivelyClassVar,useClassHolder?{type:"ConditionalExpression",test:binaryExpr$2(funcCall$2(member$3(tempLivelyClassHolderVar,"hasOwnProperty"),literal$5(classId.name)),"&&",binaryExpr$2({argument:member$3(tempLivelyClassHolderVar,classId),operator:"typeof",prefix:true,type:"UnaryExpression"},"===",literal$5("function"))),consequent:member$3(tempLivelyClassHolderVar,classId),alternate:assign$2(member$3(tempLivelyClassHolderVar,classId),constructorTemplate(classId.name))}:classId?constructorTemplate(classId.name):constructorTemplate(null)),returnStmt$1(funcCall$2(options.functionNode,id$3(tempLivelyClassVar),id$3("superclass"),instanceProps,classProps,id$3(tempLivelyClassHolderVar),options.currentModuleAccessor||id$3("undefined"),locNode))),superClassSpec);if(type==="ClassExpression")return classCreator;var result=classCreator;if(options.declarationWrapper&&state.classHolder===options.classHolder/*i.e. toplevel*/)result=funcCall$2(options.declarationWrapper,literal$5(classId.name),literal$5("class"),result,options.classHolder,locNode);// since it is a declaration and we removed the class construct we need to add a var-decl
result=varDecl$2(classId,result,"var");result[isTransformedClassVarDeclSymbol]=true;return result;}function splitExportDefaultWithClass(node,classHolder,path,options){return!node.declaration||!node.declaration[isTransformedClassVarDeclSymbol]?node:[node.declaration,{declaration:node.declaration.declarations[0].id,type:"ExportDefaultDeclaration"}];}// var opts = {classHolder: {type: "Identifier", name: "_rec"}, functionNode: {type: "Identifier", name: "createOrExtendClass"}};
// stringify(classToFunctionTransform(parse("class Foo extends Bar {m() { super.m(); }}"), opts))
// stringify(classToFunctionTransform(parse("class Foo extends Bar {m() { super.m(arguments[1]); }}"), opts))
// stringify(classToFunctionTransform(parse("class Foo {constructor() {}}"), opts))
function classToFunctionTransform(sourceOrAst,options){// required: options = {functionNode, classHolder}
// From
//   class Foo extends SuperFoo { m() { return 2 + super.m() }}
// produces something like
//   createOrExtend({}, {referencedAs: "SuperFoo", value: SuperFoo}, "Foo2", [{
//     key: "m",
//     value: function m() {
//       return 2 + this.constructor[superclassSymbol].prototype.m.call(this);
//     }
//   }])
// console.log(typeof sourceOrAst === "string" ? sourceOrAst : stringify(sourceOrAst))
var parsed=typeof sourceOrAst==="string"?parse$2(sourceOrAst):sourceOrAst;options.scope=resolveReferences(scopes(parsed));var replaced=ClassReplaceVisitor.run(parsed,options);return replaced;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// injecting the import into a module
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
/*

The injector doesn't actually modify modules (or evaluate import statements)
but only generates the code to do so.

// The import we want to add
var importData = {
  exported: "xxx",
  moduleId: "http://foo/src/b.js",
  packageName: "test-package",
  packageURL: "http://foo/",
  pathInPackage: "src/b.js"
}

// The module and source we want to modify
var m = "http://foo/a.js", src = "import { yyy } from './src/b.js'; class Foo {}";

// run
var {generated, newSource, from, to, standaloneImport, importedVarName} =
  ImportInjector.run(System, m, {name: "test-package"}, src, importData, "zzz");

generated // => ", xxx"
from, to // => 12, 17 , indexes to inject generated
newSource // => "import { yyy, xxx } from './src/b.js'; class Foo {}"
standaloneImport // => import { xxx } from "./src/b.js"; can be used for evaluation
importedVarName // => "xxx"

*/var ImportInjector=/*#__PURE__*/function(){_createClass(ImportInjector,null,[{key:"run",value:function run(System,intoModuleId,intoPackage,intoModuleSource,importData){var alias=arguments.length>5&&arguments[5]!==undefined?arguments[5]:undefined;var optAst=arguments.length>6&&arguments[6]!==undefined?arguments[6]:undefined;return new this(System,intoModuleId,intoPackage,intoModuleSource,importData,alias,optAst).run();}}]);function ImportInjector(System,intoModuleId,intoPackage,intoModuleSource,importData,alias,optAst){_classCallCheck(this,ImportInjector);this.System=System;this.intoModuleId=intoModuleId;this.intoPackage=intoPackage;this.intoModuleSource=intoModuleSource;this.fromModuleId=importData.moduleId;this.importData=importData;this.alias=alias;this.parsed=optAst||fuzzyParse(intoModuleSource);}_createClass(ImportInjector,[{key:"run",value:function run(){var newImport=this.generateImportStatement();var standaloneImport=newImport.standaloneImport,importedVarName=newImport.importedVarName;var _this$existingImports=this.existingImportsOfFromModule(),imports=_this$existingImports.imports,importsOfFromModule=_this$existingImports.importsOfFromModule,importsOfVar=_this$existingImports.importsOfVar;importsOfFromModule=this.importsToBeReused(importsOfFromModule,importsOfVar,newImport);// already imported?
if(importsOfVar.length){return{status:'not modified',newSource:this.intoModuleSource,generated:'',importedVarName:'',standaloneImport:standaloneImport,from:importsOfVar[0].start,to:importsOfVar[0].end};}// modify an existing import?
if(importsOfFromModule.length){var modified=this.modifyExistingImport(importsOfFromModule,standaloneImport);if(modified)return modified;}// prepend new import
var lastImport=last(imports);var insertPos=lastImport?lastImport.end:0;return this.insertNewImport(importsOfFromModule,standaloneImport,importedVarName,insertPos);}},{key:"importsToBeReused",value:function importsToBeReused(importsOfFromModule,importsOfVar,newImport){if(newImport.isDefault){importsOfFromModule=importsOfFromModule.filter(function(ea){return!ea.specifiers.some(function(spec){return spec.type=='ImportDefaultSpecifier';});});}return importsOfFromModule;}},{key:"generateImportStatement",value:function generateImportStatement(){var intoModuleId=this.intoModuleId,fromModuleId=this.fromModuleId,importData=this.importData,intoPackage=this.intoPackage,alias=this.alias;var isDefault=importData.exported==='default';var varName=alias||(isDefault?importData.local:importData.exported);var aliased=!isDefault&&importData.exported!==varName;var intoPackageName=intoPackage&&intoPackage.name;var exportPath=fromModuleId;var packageName=importData.packageName,pathInPackage=importData.pathInPackage,isMain=importData.isMain;if(isMain)exportPath=packageName;else if(intoPackageName===packageName){try{exportPath=resource(fromModuleId).relativePathFrom(resource(intoModuleId));if(!exportPath.startsWith('.'))exportPath='./'+exportPath;}catch(e){if(packageName&&packageName!=='no group'&&pathInPackage){exportPath=packageName+'/'+pathInPackage;}}}else{if(packageName&&packageName!=='no group'&&pathInPackage){exportPath=packageName+'/'+pathInPackage;}}return{isDefault:isDefault,standaloneImport:isDefault?"import ".concat(varName," from \"").concat(exportPath,"\";"):"import { ".concat(importData.exported).concat(aliased?" as ".concat(varName):''," } from \"").concat(exportPath,"\";"),importedVarName:varName};}},{key:"existingImportsOfFromModule",value:function existingImportsOfFromModule(){var System=this.System,fromModuleId=this.fromModuleId,intoModuleId=this.intoModuleId,_this$importData=this.importData,exported=_this$importData.exported,local=_this$importData.local,parsed=this.parsed,alias=this.alias;var isDefault=exported==='default';var imports=parsed.body.filter(function(_ref16){var type=_ref16.type;return type==='ImportDeclaration';});var varName=isDefault?alias||local:alias||exported;var importsOfFromModule=imports.filter(function(ea){if(!ea.source||typeof ea.source.value!=='string')return null;var sourceId=System.decanonicalize(ea.source.value,intoModuleId);return fromModuleId===sourceId;});var importsOfImportedVar=importsOfFromModule.filter(function(ea){return(ea.specifiers||[]).some(function(iSpec){return isDefault?iSpec.type==='ImportDefaultSpecifier'&&iSpec.local.name===varName:Path('imported.name').get(iSpec)===exported&&Path('local.name').get(iSpec)===varName;});});return{imports:imports,importsOfFromModule:importsOfFromModule,importsOfVar:importsOfImportedVar};}},{key:"modifyExistingImport",value:function modifyExistingImport(imports,standaloneImport){var specifiers=flatmap(imports,function(_ref17){var specifiers=_ref17.specifiers;return specifiers||[];});if(!specifiers.length)return null;var _partition=partition(specifiers,function(_ref18){var type=_ref18.type;return type==='ImportDefaultSpecifier';}),_partition2=_slicedToArray2(_partition,2),_partition2$=_slicedToArray2(_partition2[0],1),defaultSpecifier=_partition2$[0],_partition2$2=_slicedToArray2(_partition2[1],1),normalSpecifier=_partition2$2[0];// defaultSpecifier = arr.partition(imports, ({type}) => type === "ImportDefaultSpecifier")[0][0]
// normalSpecifier = arr.partition(imports, ({type}) => type === "ImportDefaultSpecifier")[1][0]
var alias=this.alias,src=this.intoModuleSource,_this$importData2=this.importData,impName=_this$importData2.exported,defaultImpName=_this$importData2.local;var isDefault=impName==='default';// Since this method is only called with imports this should never happen:
if(isDefault)console.assert(!!normalSpecifier,'no ImportSpecifier found');else console.assert(normalSpecifier||defaultSpecifier,'at least one kine of specifier is expected');if(isDefault){var pos=src.slice(0,normalSpecifier.start).lastIndexOf('{')-1;if(pos<0)return null;var generated=(alias||defaultImpName)+',';var pre=src.slice(0,pos);var post=src.slice(pos);if(!pre.endsWith(' ')||!pre.endsWith('\n'))generated=' '+generated;if(!post.startsWith(' '))generated+=' ';return{status:'modified',newSource:"".concat(pre).concat(generated).concat(post),generated:generated,standaloneImport:standaloneImport,importedVarName:alias||defaultImpName,from:pos,to:pos+generated.length};}var pos=normalSpecifier?normalSpecifier.end:defaultSpecifier.end;var aliased=alias&&alias!==impName;var namePart=aliased?"".concat(impName," as ").concat(alias):impName;generated=normalSpecifier?", ".concat(namePart):", { ".concat(namePart," }");return{status:'modified',newSource:"".concat(src.slice(0,pos)).concat(generated).concat(src.slice(pos)),generated:generated,standaloneImport:standaloneImport,importedVarName:aliased?alias:impName,from:pos,to:pos+generated.length};}},{key:"insertNewImport",value:function insertNewImport(importsOfFromModule,standaloneImport,importedVarName){var insertPos=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;if(importsOfFromModule&&importsOfFromModule.length){insertPos=last(importsOfFromModule).end;}var src=this.intoModuleSource;var pre=src.slice(0,insertPos);var post=src.slice(insertPos);var generated=standaloneImport;if(pre.length&&!pre.endsWith('\n'))generated='\n'+generated;if(post.length&&!post.startsWith('\n'))generated+='\n';return{status:'modified',newSource:pre+generated+post,generated:generated,standaloneImport:standaloneImport,importedVarName:importedVarName,from:insertPos,to:insertPos+generated.length};}}]);return ImportInjector;}();// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// removing imports from a module
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
/*

var src = "import { xxx, yyy } from './src/b.js'; class Foo { m() { return yyy + 1 } }";
var unusedImports = ImportRemover.findUnusedImports(src);
unusedImports // => [{local: "xxx", importStmt: {...}}]

var {changes, removedImports, source} = ImportRemover.removeImports(src, unusedImports)
changes // => [{start: 0, end: 38, replacement: "import { yyy } from './src/b.js';"}]
removedImports // => [{from: "./src/b.js", local: "xxx"}]
source // => "import { yyy } from './src/b.js'; class Foo { m() { return yyy + 1 } }"

// or short:
ImportRemover.removeUnusedImports(src)

*/var GlobalInjector=/*#__PURE__*/function(){function GlobalInjector(){_classCallCheck(this,GlobalInjector);}_createClass(GlobalInjector,null,[{key:"getGlobals",value:function getGlobals(src,optAst){var parsed=optAst||fuzzyParse(src,{withComments:true});var globalComment=parsed.comments?parsed.comments.find(function(c){return c.isBlock&&c.text.startsWith('global');}):null;var declaredGlobals=globalComment?globalComment.text.replace(/^global\s*/,'').split(',').map(function(ea){return ea.trim();}).filter(Boolean):[];var knownGlobals$1=[].concat(_toConsumableArray2(declaredGlobals),knownGlobals);var undefinedVariables=findGlobalVarRefs(parsed,{jslintGlobalComment:true}).filter(function(ea){return!knownGlobals$1.includes(ea.name);}).map(function(ea){return ea.name;});return compact([].concat(_toConsumableArray2(declaredGlobals),_toConsumableArray2(undefinedVariables)));}// GlobalInjector.getGlobals(this.textString)
},{key:"run",value:function run(src,namesToDeclareGlobal,optAst){var parsed=optAst||fuzzyParse(src,{withComments:true});var globalComment=parsed.comments?parsed.comments.find(function(c){return c.isBlock&&c.text.startsWith('global');}):null;var existingDecls=globalComment?globalComment.text.replace(/^global\s*/,'').split(',').map(function(ea){return ea.trim();}).filter(Boolean):[];var namesToInsert=namesToDeclareGlobal.filter(function(ea){return!existingDecls.includes(ea);});if(!namesToInsert.length){return{status:'not modified',newSource:src,generated:'',from:0,to:0};}if(!globalComment){var _generated="/*global ".concat(namesToInsert.join(','),"*/\n");var _from2=0;var _to=_generated.length;var _newSource=_generated+src;return{status:'modified',newSource:_newSource,generated:_generated,from:_from2,to:_to};}var from=globalComment.start+'/*'.length+globalComment.text.length;var generated=namesToInsert.join(',');if(!existingDecls.length){if(!globalComment.text.startsWith('global ')){generated=' '+generated;}}else{generated=','+generated;}var to=from+generated.length;var newSource=src.slice(0,from)+generated+src.slice(from);return{status:'modified',newSource:newSource,generated:generated,from:from,to:to};}}]);return GlobalInjector;}();var ImportRemover=/*#__PURE__*/function(){function ImportRemover(){_classCallCheck(this,ImportRemover);}_createClass(ImportRemover,null,[{key:"removeImports",value:function removeImports(moduleSource,importsToRemove,optModuleAst){// returns {
//   source: STRING,
//   modifications: [{start: NUMBER, end: NUMBER, replacement: STRING}]
//   removedImports: [{local: STRING, from: STRING}]
// }
var parsed=optModuleAst||fuzzyParse(moduleSource);// 1.get imports with specifiers
var imports=flatmap(parsed.body,function(ea){if(ea.type!=='ImportDeclaration'||!ea.specifiers.length)return[];return ea.specifiers.map(function(spec){return{local:spec.local,importStmt:ea};});});// 3. figure out what imports need to be removed or changed
var importsToChange=imports.filter(function(ea){return importsToRemove.some(function(rem){return rem.local===ea.local.name;});});var removedImports=importsToChange.map(function(ea){return{local:ea.local.name,from:ea.importStmt.source.value};});var affectedStmts=uniq(importsToChange.map(function(ea){var specToRemove=ea.importStmt.specifiers.find(function(spec){return ea.local===spec.local;});_remove4(ea.importStmt.specifiers,specToRemove);return ea.importStmt;}));// 4. Compute the actual modifications to transform source and also new source itself
var modifications=affectedStmts.slice().reverse().reduce(function(state,importStmt){var source=state.source,changes=state.changes;var start=importStmt.start,end=importStmt.end,specifiers=importStmt.specifiers;var pre=source.slice(0,start);var post=source.slice(end);var removed=source.slice(start,end);var replacement=!specifiers.length?'':stringify(importStmt);if(replacement&&replacement.includes('\n')&&!removed.includes('\n')){replacement=replacement.replace(/\s+/g,' ');}source=pre+replacement+post;changes=changes.concat({replacement:replacement,start:start,end:end});return{source:source,changes:changes};},{source:moduleSource,changes:[]});return _objectSpread(_objectSpread({},modifications),{},{removedImports:removedImports});}},{key:"findUnusedImports",value:function findUnusedImports(moduleSourceOrAst){// get all var references of source without those included in the import
// statments
// 1.get imports with specifiers
var parsed=typeof moduleSourceOrAst==='string'?fuzzyParse(moduleSourceOrAst):moduleSourceOrAst;var imports=flatmap(parsed.body,function(ea){if(ea.type!=='ImportDeclaration'||!ea.specifiers.length)return[];return ea.specifiers.map(function(spec){return{local:spec.local,from:ea.source?ea.source.value:'',importStmt:ea};});});var importIdentifiers=imports.map(function(ea){return ea.local;});var scope=resolveReferences(scopes(parsed));var refsWithoutImports=Array.from(scope.resolvedRefMap.keys()).filter(function(ea){return!importIdentifiers.includes(ea);});var realRefs=uniq(refsWithoutImports.map(function(ea){return ea.name;}));return imports.filter(function(ea){return!realRefs.includes(ea.local.name);}).map(function(ea){return _objectSpread(_objectSpread({},ea),{},{local:ea.local.name});});}},{key:"removeUnusedImports",value:function removeUnusedImports(moduleSource){var parsed=fuzzyParse(moduleSource);return this.removeImports(moduleSource,this.findUnusedImports(parsed),parsed);}}]);return ImportRemover;}();function ensureParent(currentModule,name,parent){if(parent)return parent;var id=currentModule.id,System=currentModule.System,idForNode=id.startsWith("file://")?id.replace("file://",""):id,module=System._nodeRequire("module");parent=module.Module._cache[id];if(parent)return parent;parent={id:idForNode,filename:idForNode,paths:[]};var p=currentModule["package"]();if(p)parent.paths.push(resource(p.url).join("node_modules/").path());return parent;}function relative$1(module,name){return resource(module.id).parent().join(name).url.replace("file://","");}function _require(currentModule,name,parent){parent=ensureParent(currentModule);var System=currentModule.System,module=System._nodeRequire("module");if(name.startsWith("."))name=relative$1(currentModule,name);return module._load(name,parent);}function _resolve(currentModule,name,parent){parent=ensureParent(currentModule);var System=currentModule.System,module=System._nodeRequire("module");if(name.startsWith("."))name=relative$1(currentModule,name);return module._resolveFilename(name,parent);}var detectModuleFormat=function(){var esmFormatCommentRegExp=/['"]format (esm|es6)['"];/;var cjsFormatCommentRegExp=/['"]format cjs['"];/;// Stolen from SystemJS
var esmRegEx=/(^\s*|[}\);\n]\s*)(import\s+(['"]|(\*\s+as\s+)?[^"'\(\)\n;]+\s+from\s+['"]|\{)|export\s+\*\s+from\s+["']|export\s+(\{|default|function|class|var|const|let|async\s+function))/;return function(source,metadata){if(metadata&&metadata.format){if(metadata.format=='es6')metadata.format=='esm';return metadata.format;}if(esmFormatCommentRegExp.test(source.slice(0,5000))||!cjsFormatCommentRegExp.test(source.slice(0,5000))&&esmRegEx.test(source)){return'esm';}if(cjsFormatCommentRegExp.test(source.slice(0,5000))){return'cjs';}return'global';};}();function module$1(System,moduleName,parent){var sysEnv=livelySystemEnv(System);var id=System.decanonicalize(moduleName,parent);return sysEnv.loadedModules[id]||(sysEnv.loadedModules[id]=new ModuleInterface(System,id));}classHolder.module=module$1;function isModuleLoaded(System,name){var isNormalized=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var sysEnv=livelySystemEnv(System);var id=isNormalized?name:System.normalizeSync(name);return id in sysEnv.loadedModules;}function doesModuleExist(_x40,_x41){return _doesModuleExist.apply(this,arguments);}function _doesModuleExist(){_doesModuleExist=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee91(System,name){var isNormalized,sysEnv,id,p,_args91=arguments;return regeneratorRuntime.wrap(function _callee91$(_context91){while(1){switch(_context91.prev=_context91.next){case 0:isNormalized=_args91.length>2&&_args91[2]!==undefined?_args91[2]:false;sysEnv=livelySystemEnv(System);id=isNormalized?name:System.normalizeSync(name);if(!isModuleLoaded(System,id,true)){_context91.next=5;break;}return _context91.abrupt("return",true);case 5:p=Package.forModuleId(System,id);if(!(!p||p.name==='no group')){_context91.next=10;break;}_context91.t0=/* FIXME */System.resource(id).exists();_context91.next=13;break;case 10:_context91.next=12;return p.hasResource(id);case 12:_context91.t0=_context91.sent;case 13:return _context91.abrupt("return",_context91.t0);case 14:case"end":return _context91.stop();}}},_callee91);}));return _doesModuleExist.apply(this,arguments);}var globalProps={initialized:false,descriptors:{}};// ModuleInterface is primarily used to provide an API that integrates the System
// loader state with lively.modules extensions.
// It does not hold any mutable state.
var ModuleInterface=/*#__PURE__*/function(){function ModuleInterface(System,id){var _this13=this;_classCallCheck(this,ModuleInterface);// We assume module ids to be a URL with a scheme
if(!isURL(id)&&!/^@/.test(id)){throw new Error("ModuleInterface constructor called with ".concat(id," that does not seem to be a fully normalized module id."));}this.System=System;this.id=id;// Under what variable name the recorder becomes available during module
// execution and eval
this.recorderName='__lvVarRecorder';this.sourceAccessorName='__lvOriginalCode';this._recorder=null;// cached values
this._source=null;this._ast=null;this._scope=null;this._observersOfTopLevelState=[];this._evaluationsInProgress=0;this._evalId=1;this.createdAt=this.lastModifiedAt=new Date();subscribe('lively.modules/modulechanged',function(data){if(data.module===_this13.id)_this13.reset();});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// properties
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// returns Promise<string>
_createClass(ModuleInterface,[{key:"fullName",value:function fullName(){return this.id;}},{key:"shortName",value:function shortName(){return"".concat(this["package"]().name,"/").concat(this.pathInPackage());}},{key:"source",value:function source(){var _this14=this;// returns Promise<string>
// rk 2016-06-24:
// We should consider using lively.resource here. Unfortunately
// System.fetch (at least with the current systemjs release) will not work in
// all cases b/c modules once loaded by the loaded get cached and System.fetch
// returns "" in those cases
//
// cs 2016-08-06:
// Changed implementation, so it uses System.resource to be consistent
// with module loading
if(this.id==='@empty')return Promise.resolve('');if(this._source)return Promise.resolve(this._source);return this.System.resource(this.id).read().then(function(source){return _this14._source=source;});}},{key:"setSource",value:function setSource(source){/* rms 3.1.17: There appear to be situations where the module system tries to
       set the source to the transformed form instead of the original ES6 format.
       I have not traced down the reason for this, but this check will prevent that
       a module's transformed source will be set to its original source by scanning
       the source string for the recorder and sourceAccessor variables.      */if(this.sourceAccessorName&&this.recorderName&&source.includes('var '+this.recorderName)&&source.includes('var '+this.sourceAccessorName)){return;}if(this._source===source)return;this.reset();this._source=source;}},{key:"ast",value:function(){var _ast2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee44(){return regeneratorRuntime.wrap(function _callee44$(_context44){while(1){switch(_context44.prev=_context44.next){case 0:if(!this._ast){_context44.next=2;break;}return _context44.abrupt("return",this._ast);case 2:_context44.t0=parse$2;_context44.next=5;return this.source();case 5:_context44.t1=_context44.sent;return _context44.abrupt("return",this._ast=(0,_context44.t0)(_context44.t1));case 7:case"end":return _context44.stop();}}},_callee44,this);}));function ast(){return _ast2.apply(this,arguments);}return ast;}()},{key:"scope",value:function(){var _scope2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee45(){var ast;return regeneratorRuntime.wrap(function _callee45$(_context45){while(1){switch(_context45.prev=_context45.next){case 0:if(!this._scope){_context45.next=2;break;}return _context45.abrupt("return",this._scope);case 2:_context45.next=4;return this.ast();case 4:ast=_context45.sent;return _context45.abrupt("return",this._scope=topLevelDeclsAndRefs(ast).scope);case 6:case"end":return _context45.stop();}}},_callee45,this);}));function scope(){return _scope2.apply(this,arguments);}return scope;}()},{key:"resolvedScope",value:function(){var _resolvedScope=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee46(){return regeneratorRuntime.wrap(function _callee46$(_context46){while(1){switch(_context46.prev=_context46.next){case 0:_context46.t0=resolveReferences;_context46.next=3;return this.scope();case 3:_context46.t1=_context46.sent;return _context46.abrupt("return",this._scope=(0,_context46.t0)(_context46.t1));case 5:case"end":return _context46.stop();}}},_callee46,this);}));function resolvedScope(){return _resolvedScope.apply(this,arguments);}return resolvedScope;}()},{key:"metadata",value:function metadata(){var load=this.System.loads?this.System.loads[this.id]:null;return load?load.metadata:null;}},{key:"addMetadata",value:function addMetadata(addedMeta){var System=this.System,id=this.id;var oldMeta=this.metadata();var meta=oldMeta?Object.assign(oldMeta,addedMeta):addedMeta;System.config({meta:_defineProperty({},id,meta)});return System.meta[id];}},{key:"format",value:function format(){// assume esm by default
var meta=this.metadata();if(meta&&meta.format)return meta.format;if(this._source)return detectModuleFormat(this._source);return'global';}},{key:"setFormat",value:function setFormat(format){// assume esm by default
return this.addMetadata({format:format});}},{key:"reset",value:function reset(){this._source=null;this._ast=null;this._scope=null;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// loading
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"get",value:function get(){// opts = {format, instrument}
var id=this.id,System=this.System;return System.get(id);}},{key:"load",value:function(){var _load=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee47(opts){var id,System;return regeneratorRuntime.wrap(function _callee47$(_context47){while(1){switch(_context47.prev=_context47.next){case 0:// opts = {format, instrument}
id=this.id,System=this.System;opts&&this.addMetadata(opts);_context47.t0=System.get(id);if(_context47.t0){_context47.next=7;break;}_context47.next=6;return System["import"](id);case 6:_context47.t0=_context47.sent;case 7:return _context47.abrupt("return",_context47.t0);case 8:case"end":return _context47.stop();}}},_callee47,this);}));function load(_x42){return _load.apply(this,arguments);}return load;}()},{key:"isLoaded",value:function isLoaded(){return!!this.System.get(this.id);}},{key:"unloadEnv",value:function unloadEnv(){this._recorder=null;this._observersOfTopLevelState=[];// FIXME this shouldn't be necessary anymore....
delete livelySystemEnv(this.System).loadedModules[this.id];}},{key:"unloadDeps",value:function unloadDeps(opts){var _this15=this;opts=merge({forgetDeps:true,forgetEnv:true},opts);this.dependents().forEach(function(ea){_this15.System["delete"](ea.id);if(_this15.System.loads)delete _this15.System.loads[ea.id];if(opts.forgetEnv)ea.unloadEnv();});}},{key:"unload",value:function(){var _unload=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee48(opts){var System,id,cache;return regeneratorRuntime.wrap(function _callee48$(_context48){while(1){switch(_context48.prev=_context48.next){case 0:opts=_objectSpread({reset:true,forgetDeps:true,forgetEnv:true},opts);System=this.System,id=this.id;if(opts.reset)this.reset();if(opts.forgetDeps)this.unloadDeps(opts);this.System["delete"](id);if(System.loads){delete System.loads[id];}if(System.meta){delete System.meta[id];}if(opts.forgetEnv){this.unloadEnv();}cache=System._livelyModulesTranslationCache;if(!cache){_context48.next=12;break;}_context48.next=12;return cache.deleteCachedData(id);case 12:emit('lively.modules/moduleunloaded',{module:this.id},Date.now(),this.System);case 13:case"end":return _context48.stop();}}},_callee48,this);}));function unload(_x43){return _unload.apply(this,arguments);}return unload;}()},{key:"reload",value:function(){var _reload=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee49(opts){var _this16=this;var toBeReloaded;return regeneratorRuntime.wrap(function _callee49$(_context49){while(1){switch(_context49.prev=_context49.next){case 0:opts=merge({reloadDeps:true,resetEnv:true},opts);toBeReloaded=[this];if(opts.reloadDeps)toBeReloaded=this.dependents().concat(toBeReloaded);_context49.next=5;return this.unload({forgetDeps:opts.reloadDeps,forgetEnv:opts.resetEnv});case 5:_context49.next=7;return Promise.all(toBeReloaded.map(function(ea){return ea.id!==_this16.id&&ea.load();}));case 7:_context49.next=9;return this.load();case 9:case"end":return _context49.stop();}}},_callee49,this);}));function reload(_x44){return _reload.apply(this,arguments);}return reload;}()},{key:"copyTo",value:function(){var _copyTo4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee50(newId){var System,recorderName,sourceAccessorName,_recorder,_source,_ast,_scope,_observersOfTopLevelState,newM,state;return regeneratorRuntime.wrap(function _callee50$(_context50){while(1){switch(_context50.prev=_context50.next){case 0:_context50.t0=this.System.resource(newId);_context50.next=3;return this.source();case 3:_context50.t1=_context50.sent;_context50.next=6;return _context50.t0.write.call(_context50.t0,_context50.t1);case 6:System=this.System,recorderName=this.recorderName,sourceAccessorName=this.sourceAccessorName,_recorder=this._recorder,_source=this._source,_ast=this._ast,_scope=this._scope,_observersOfTopLevelState=this._observersOfTopLevelState;newM=module$1(System,newId);state=select(this,['_observersOfTopLevelState','_scope','_ast','_source','_recorder','sourceAccessorName','recorderName']);Object.assign(newM,state);System.set(newId,System.newModule(System.get(this.id)));return _context50.abrupt("return",newM);case 12:case"end":return _context50.stop();}}},_callee50,this);}));function copyTo(_x45){return _copyTo4.apply(this,arguments);}return copyTo;}()},{key:"renameTo",value:function(){var _renameTo=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee51(newId){var opts,_opts$unload,unload,_opts$removeFile,removeFile,newM,_args51=arguments;return regeneratorRuntime.wrap(function _callee51$(_context51){while(1){switch(_context51.prev=_context51.next){case 0:opts=_args51.length>1&&_args51[1]!==undefined?_args51[1]:{};_opts$unload=opts.unload,unload=_opts$unload===void 0?true:_opts$unload,_opts$removeFile=opts.removeFile,removeFile=_opts$removeFile===void 0?true:_opts$removeFile;_context51.next=4;return this.copyTo(newId);case 4:newM=_context51.sent;if(!unload){_context51.next=8;break;}_context51.next=8;return this.unload({reset:true,forgetDeps:false,forgetEnv:true});case 8:if(!removeFile){_context51.next=11;break;}_context51.next=11;return this.System.resource(this.id).remove();case 11:return _context51.abrupt("return",newM);case 12:case"end":return _context51.stop();}}},_callee51,this);}));function renameTo(_x46){return _renameTo.apply(this,arguments);}return renameTo;}()},{key:"whenLoaded",value:function whenLoaded(cb){if(this.isLoaded()){try{cb(this);}catch(e){console.error(e);}return;}livelySystemEnv(this.System).onLoadCallbacks.push({moduleName:this.id,resolved:true,callback:cb});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// change
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"changeSourceAction",value:function changeSourceAction(changeFunc){var _this17=this;return Promise.resolve(this.source()).then(function(oldSource){return changeFunc(oldSource);}).then(function(newSource){return _this17.changeSource(newSource);});}},{key:"changeSource",value:function changeSource(newSource,options){options=_objectSpread({doSave:true,doEval:true},options);var System=this.System,id=this.id;var format=this.format();var result;this.reset();this.lastModifiedAt=new Date();return Promise.all([options.doSave&&this.System.resource(id).write(newSource),options.doEval&&moduleSourceChange(System,id,newSource,format,options).then(function(_result){return result=_result;})]).then(function(){return result;});}},{key:"addDependencyToModuleRecord",value:function addDependencyToModuleRecord(dependency){var _this18=this;var setter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(){};// `dependency is another module, setter is the function that gets
// triggered when a dependency's binding changes so that "this" module is updated
var record=this.record();var dependencyRecord=dependency.record();if(record&&dependencyRecord){// 1. update the record so that when its dependencies change and cause a
// re-execute, the correct code (new version) is run
var depIndex;var hasDepenency=record.dependencies.some(function(ea,i){if(!ea)return;depIndex=i;return ea&&ea.name===dependency.id;});if(!hasDepenency){record.dependencies.push(dependencyRecord);}else if(dependencyRecord!==record.dependencies[depIndex]/* happens when a dep is reloaded */){record.dependencies.splice(depIndex,1,dependencyRecord);}// setters are for updating module bindings, the position of the record
// in dependencies should be the same as the position of the setter for that
// dependency...
if(!hasDepenency||!record.setters[depIndex]){record.setters[hasDepenency?depIndex:record.dependencies.length-1]=setter;}// 2. update records of dependencies, so that they know about this module as an importer
var impIndex;var hasImporter=dependencyRecord.importers.some(function(imp,i){if(!imp)return;impIndex=i;return imp&&imp.name===_this18.id;});if(!hasImporter)dependencyRecord.importers.push(record);else if(record!==dependencyRecord.importers[impIndex]){dependencyRecord.importers.splice(impIndex,1,record);}}}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// dependencies
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"dependents",value:function dependents(){var _this19=this;// which modules (module ids) are (in)directly import module with id
// Let's say you have
// module1: export var x = 23;
// module2: import {x} from "module1.js"; export var y = x + 1;
// module3: import {y} from "module2.js"; export var z = y + 1;
// `dependents` gives you an answer what modules are "stale" when you
// change module1 = module2 + module3
return hull(invert(computeRequireMap(this.System)),this.id).map(function(mid){return module$1(_this19.System,mid);});}},{key:"requirements",value:function requirements(){var _this20=this;// which modules (module ids) are (in)directly required by module with id
// Let's say you have
// module1: export var x = 23;
// module2: import {x} from "module1.js"; export var y = x + 1;
// module3: import {y} from "module2.js"; export var z = y + 1;
// `module("./module3").requirements()` will report ./module2 and ./module1
return hull(computeRequireMap(this.System),this.id).map(function(mid){return module$1(_this20.System,mid);});}},{key:"directRequirements",value:function directRequirements(){var _this21=this;var dependencies=(this.record()||{}).dependencies||[];return pluck(dependencies.filter(Boolean),'name').map(function(id){return module$1(_this21.System,id);});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// module environment
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"isMochaTest",value:function isMochaTest(){if(!this._source){return false;}var scope=this._scope||(this._scope=topLevelDeclsAndRefs(parse$2(this._source)).scope);var deps=_imports(scope).map(function(imp){return imp.fromModule;});if(!deps.some(function(ea){return ea.endsWith('mocha-es6')||ea.endsWith('mocha-es6/index.js');})){return false;}return true;}// What variables to not transform during execution, i.e. what variables
// should not be accessed as properties of recorder
},{key:"define",value:function define(varName,value){var exportImmediately=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var meta=arguments.length>3?arguments[3]:undefined;// attaching source info to runtime objects
var System=this.System,id=this.id,recorder=this.recorder;// System.debug && console.log(`[lively.modules] ${this.shortName()} defines ${varName}`);
var metaSym=Symbol["for"]('lively-object-meta');var moduleSym=Symbol["for"]('lively-module-meta');if(typeof value==='function'&&meta&&(meta.kind==='function'||meta.kind==='class')){value[metaSym]=meta;}if(value&&value[metaSym]&&!value[moduleSym]){var pathInPackage=this.pathInPackage();var _p3=this["package"]();value[moduleSym]={"package":_p3?{name:_p3.name,version:_p3.version}:{},pathInPackage:pathInPackage};}// storing local module state
recorder[varName]=value;// exports update
scheduleModuleExportsChange(System,id,varName,value,false/* force adding export */);// system event
this.notifyTopLevelObservers(varName);// immediately update exports (recursivly) when flagged or when the module
// is not currently executing. During module execution we wait until the
// entire module is done to avoid triggering the expensive update process
// multiple times
// ...whether or not this is in accordance with an upcoming es6 module spec
// I don't know...
exportImmediately=exportImmediately||!this.isEvalutionInProgress();if(exportImmediately){runScheduledExportChanges(System,id);}return value;}},{key:"undefine",value:function undefine(varName){delete this.recorder[varName];}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// observing top level state
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"subscribeToToplevelDefinitionChanges",value:function subscribeToToplevelDefinitionChanges(func){this._observersOfTopLevelState.push(func);return func;}},{key:"notifyTopLevelObservers",value:function notifyTopLevelObservers(key){var ignored=['createOrExtendES6ClassForLively','lively.capturing-declaration-wrapper'];var rec=this.recorder;if(include(ignored,key))return;this._observersOfTopLevelState.forEach(function(fn){return fn(key,rec[key]);});}},{key:"unsubscribeFromToplevelDefinitionChanges",value:function unsubscribeFromToplevelDefinitionChanges(funcOrName){this._observersOfTopLevelState=typeof funcOrName==='string'?this._observersOfTopLevelState.filter(function(ea){return ea.name!==funcOrName;}):this._observersOfTopLevelState.filter(function(ea){return ea!==funcOrName;});}// evaluationStart/End are also compiled into instrumented module code so are
// also activated during module executions
},{key:"evaluationStart",value:function evaluationStart(){this._evaluationsInProgress++;}},{key:"evaluationEnd",value:function evaluationEnd(){this._evaluationsInProgress--;runScheduledExportChanges(this.System,this.id);}},{key:"nextEvalId",value:function nextEvalId(){return this._evalId++;}},{key:"isEvalutionInProgress",value:function isEvalutionInProgress(){return this._evaluationsInProgress>0;}},{key:"env",value:function env(){return this;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// package related
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"package",value:function _package(){return Package.forModule(this.System,this);}},{key:"pathInPackage",value:function pathInPackage(){var p=this["package"]();return p&&this.id.indexOf(p.address)===0?this.id.slice(p.address.length).replace(/^\//,''):this.id;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// imports and exports
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"imports",value:function(){var _imports2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee52(){return regeneratorRuntime.wrap(function _callee52$(_context52){while(1){switch(_context52.prev=_context52.next){case 0:_context52.t0=_imports;_context52.next=3;return this.scope();case 3:_context52.t1=_context52.sent;return _context52.abrupt("return",(0,_context52.t0)(_context52.t1));case 5:case"end":return _context52.stop();}}},_callee52,this);}));function imports(){return _imports2.apply(this,arguments);}return imports;}()},{key:"exports",value:function(){var _exports2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee53(){return regeneratorRuntime.wrap(function _callee53$(_context53){while(1){switch(_context53.prev=_context53.next){case 0:_context53.t0=exports$b;_context53.next=3;return this.scope();case 3:_context53.t1=_context53.sent;return _context53.abrupt("return",(0,_context53.t0)(_context53.t1));case 5:case"end":return _context53.stop();}}},_callee53,this);}));function exports(){return _exports2.apply(this,arguments);}return exports;}()},{key:"addImports",value:function(){var _addImports=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee54(specs){var source,_iterator31,_step31,spec,fromModule,fromPackage,importData,alias,_ImportInjector$run,standAloneImport;return regeneratorRuntime.wrap(function _callee54$(_context54){while(1){switch(_context54.prev=_context54.next){case 0:_context54.next=2;return this.source();case 2:source=_context54.sent;_iterator31=_createForOfIteratorHelper(specs);try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){spec=_step31.value;fromModule=module$1(this.System,spec.from||spec.moduleId);fromPackage=fromModule["package"]();importData={exported:spec.exported||spec.local,moduleId:fromModule.id,packageName:fromPackage.name,packageURL:fromPackage.url,pathInPackage:fromModule.pathInPackage()};alias=spec.local;_ImportInjector$run=ImportInjector.run(this.System,this.id,this["package"](),source,importData,alias),source=_ImportInjector$run.newSource,standAloneImport=_ImportInjector$run.standAloneImport;}}catch(err){_iterator31.e(err);}finally{_iterator31.f();}_context54.next=7;return this.changeSource(source);case 7:case"end":return _context54.stop();}}},_callee54,this);}));function addImports(_x47){return _addImports.apply(this,arguments);}return addImports;}()},{key:"addGlobalDeclaration",value:function(){var _addGlobalDeclaration=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee55(varNamesToDeclareAsGlobal){var source,_GlobalInjector$run,status,newSource,changed;return regeneratorRuntime.wrap(function _callee55$(_context55){while(1){switch(_context55.prev=_context55.next){case 0:_context55.next=2;return this.source();case 2:source=_context55.sent;_GlobalInjector$run=GlobalInjector.run(source,varNamesToDeclareAsGlobal),status=_GlobalInjector$run.status,newSource=_GlobalInjector$run.newSource;changed=status==='modified';if(!changed){_context55.next=8;break;}_context55.next=8;return this.changeSource(newSource);case 8:return _context55.abrupt("return",changed);case 9:case"end":return _context55.stop();}}},_callee55,this);}));function addGlobalDeclaration(_x48){return _addGlobalDeclaration.apply(this,arguments);}return addGlobalDeclaration;}()},{key:"removeImports",value:function(){var _removeImports=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee56(specs){var _this22=this;var oldSource,_yield$ImportRemover$,source,removedImports;return regeneratorRuntime.wrap(function _callee56$(_context56){while(1){switch(_context56.prev=_context56.next){case 0:if(specs.length){_context56.next=2;break;}return _context56.abrupt("return");case 2:_context56.next=4;return this.source();case 4:oldSource=_context56.sent;_context56.next=7;return ImportRemover.removeImports(oldSource,specs);case 7:_yield$ImportRemover$=_context56.sent;source=_yield$ImportRemover$.source;removedImports=_yield$ImportRemover$.removedImports;_context56.next=12;return this.changeSource(source);case 12:removedImports.forEach(function(ea){return delete _this22.recorder[ea.local];});case 13:case"end":return _context56.stop();}}},_callee56,this);}));function removeImports(_x49){return _removeImports.apply(this,arguments);}return removeImports;}()// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// bindings
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"_localDeclForRefAt",value:function(){var _localDeclForRefAt2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee57(pos){var scope,ref;return regeneratorRuntime.wrap(function _callee57$(_context57){while(1){switch(_context57.prev=_context57.next){case 0:_context57.next=2;return this.resolvedScope();case 2:scope=_context57.sent;ref=refWithDeclAt(pos,scope);return _context57.abrupt("return",ref&&{decl:ref.decl,id:ref.declId,declModule:this});case 5:case"end":return _context57.stop();}}},_callee57,this);}));function _localDeclForRefAt(_x50){return _localDeclForRefAt2.apply(this,arguments);}return _localDeclForRefAt;}()},{key:"_localDeclForName",value:function(){var _localDeclForName2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee58(nameOfRef){var scope,found,_iterator32,_step32,_ref19,name;return regeneratorRuntime.wrap(function _callee58$(_context58){while(1){switch(_context58.prev=_context58.next){case 0:_context58.next=2;return this.resolvedScope();case 2:scope=_context58.sent;_iterator32=_createForOfIteratorHelper(scope.resolvedRefMap.values());_context58.prev=4;_iterator32.s();case 6:if((_step32=_iterator32.n()).done){_context58.next=14;break;}_ref19=_step32.value;name=_ref19.ref.name;if(!(nameOfRef===name)){_context58.next=12;break;}found=_ref19;return _context58.abrupt("break",14);case 12:_context58.next=6;break;case 14:_context58.next=19;break;case 16:_context58.prev=16;_context58.t0=_context58["catch"](4);_iterator32.e(_context58.t0);case 19:_context58.prev=19;_iterator32.f();return _context58.finish(19);case 22:return _context58.abrupt("return",found&&{decl:found.decl,id:found.declId,declModule:this});case 23:case"end":return _context58.stop();}}},_callee58,this,[[4,16,19,22]]);}));function _localDeclForName(_x51){return _localDeclForName2.apply(this,arguments);}return _localDeclForName;}()},{key:"_importForNSRefAt",value:function(){var _importForNSRefAt2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee59(pos){var scope,ast,nodes,id,member,_ref20,decl,name,spec;return regeneratorRuntime.wrap(function _callee59$(_context59){while(1){switch(_context59.prev=_context59.next){case 0:_context59.next=2;return this.resolvedScope();case 2:scope=_context59.sent;ast=scope.node;nodes=nodesAtIndex(ast,pos);if(!(nodes.length<2)){_context59.next=7;break;}return _context59.abrupt("return",[null,null]);case 7:id=nodes[nodes.length-1];member=nodes[nodes.length-2];if(!(id.type!='Identifier'||member.type!='MemberExpression'||member.computed||member.object.type!=='Identifier')){_context59.next=11;break;}return _context59.abrupt("return",[null,null]);case 11:_ref20=scope.resolvedRefMap.get(member.object)||{},decl=_ref20.decl;if(!(!decl||decl.type!=='ImportDeclaration')){_context59.next=14;break;}return _context59.abrupt("return",[null,null]);case 14:name=member.object.name;spec=decl.specifiers.find(function(s){return s.local.name===name;});return _context59.abrupt("return",spec.type!=='ImportNamespaceSpecifier'?[null,null]:[decl,spec.local,id.name]);case 17:case"end":return _context59.stop();}}},_callee59,this);}));function _importForNSRefAt(_x52){return _importForNSRefAt2.apply(this,arguments);}return _importForNSRefAt;}()},{key:"_resolveImportedDecl",value:function(){var _resolveImportedDecl2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee60(decl){var _decl$id,start,name,type,imports,im,imM;return regeneratorRuntime.wrap(function _callee60$(_context60){while(1){switch(_context60.prev=_context60.next){case 0:if(decl){_context60.next=2;break;}return _context60.abrupt("return",[]);case 2:_decl$id=decl.id,start=_decl$id.start,name=_decl$id.name,type=_decl$id.type;_context60.next=5;return this.imports();case 5:imports=_context60.sent;im=imports.find(function(i){return i.local==name;});if(!im){_context60.next=14;break;}imM=module$1(this.System,im.fromModule,this.id);_context60.t0=[decl];_context60.next=12;return imM.bindingPathForExport(im.imported);case 12:_context60.t1=_context60.sent;return _context60.abrupt("return",_context60.t0.concat.call(_context60.t0,_context60.t1));case 14:return _context60.abrupt("return",[decl]);case 15:case"end":return _context60.stop();}}},_callee60,this);}));function _resolveImportedDecl(_x53){return _resolveImportedDecl2.apply(this,arguments);}return _resolveImportedDecl;}()},{key:"bindingPathFor",value:function(){var _bindingPathFor=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee61(nameOfRef){var decl;return regeneratorRuntime.wrap(function _callee61$(_context61){while(1){switch(_context61.prev=_context61.next){case 0:_context61.next=2;return this._localDeclForName(nameOfRef);case 2:decl=_context61.sent;if(!decl){_context61.next=7;break;}_context61.next=6;return this._resolveImportedDecl(decl);case 6:return _context61.abrupt("return",_context61.sent);case 7:case"end":return _context61.stop();}}},_callee61,this);}));function bindingPathFor(_x54){return _bindingPathFor.apply(this,arguments);}return bindingPathFor;}()},{key:"bindingPathForExport",value:function(){var _bindingPathForExport=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee62(name){var exports,ex,imM,decl;return regeneratorRuntime.wrap(function _callee62$(_context62){while(1){switch(_context62.prev=_context62.next){case 0:_context62.next=2;return this.resolvedScope();case 2:_context62.next=4;return this.exports();case 4:exports=_context62.sent;ex=exports.find(function(e){return e.exported===name;});if(!ex.fromModule){_context62.next=17;break;}imM=module$1(this.System,ex.fromModule,this.id);decl={decl:ex.node,id:ex.declId};decl.declModule=this;_context62.t0=[decl];_context62.next=13;return imM.bindingPathForExport(ex.imported);case 13:_context62.t1=_context62.sent;return _context62.abrupt("return",_context62.t0.concat.call(_context62.t0,_context62.t1));case 17:return _context62.abrupt("return",this._resolveImportedDecl({decl:ex.decl,id:ex.declId,declModule:ex&&ex.decl?this:null}));case 18:case"end":return _context62.stop();}}},_callee62,this);}));function bindingPathForExport(_x55){return _bindingPathForExport.apply(this,arguments);}return bindingPathForExport;}()},{key:"bindingPathForRefAt",value:function(){var _bindingPathForRefAt=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee63(pos){var decl,_yield$this$_importFo,_yield$this$_importFo2,imDecl,id,name,imM;return regeneratorRuntime.wrap(function _callee63$(_context63){while(1){switch(_context63.prev=_context63.next){case 0:_context63.next=2;return this._localDeclForRefAt(pos);case 2:decl=_context63.sent;if(!decl){_context63.next=7;break;}_context63.next=6;return this._resolveImportedDecl(decl);case 6:return _context63.abrupt("return",_context63.sent);case 7:_context63.next=9;return this._importForNSRefAt(pos);case 9:_yield$this$_importFo=_context63.sent;_yield$this$_importFo2=_slicedToArray2(_yield$this$_importFo,3);imDecl=_yield$this$_importFo2[0];id=_yield$this$_importFo2[1];name=_yield$this$_importFo2[2];if(imDecl){_context63.next=16;break;}return _context63.abrupt("return",[]);case 16:imM=module$1(this.System,imDecl.source.value,this.id);_context63.t0=[{decl:imDecl,declModule:this,id:id}];_context63.next=20;return imM.bindingPathForExport(name);case 20:_context63.t1=_context63.sent;return _context63.abrupt("return",_context63.t0.concat.call(_context63.t0,_context63.t1));case 22:case"end":return _context63.stop();}}},_callee63,this);}));function bindingPathForRefAt(_x56){return _bindingPathForRefAt.apply(this,arguments);}return bindingPathForRefAt;}()},{key:"definitionForRefAt",value:function(){var _definitionForRefAt=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee64(pos){var path;return regeneratorRuntime.wrap(function _callee64$(_context64){while(1){switch(_context64.prev=_context64.next){case 0:_context64.next=2;return this.bindingPathForRefAt(pos);case 2:path=_context64.sent;return _context64.abrupt("return",path.length<1?null:path[path.length-1].decl);case 4:case"end":return _context64.stop();}}},_callee64,this);}));function definitionForRefAt(_x57){return _definitionForRefAt.apply(this,arguments);}return definitionForRefAt;}()// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// module records
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"ensureRecord",value:function ensureRecord(){var S=this.System;var records=S._loader.moduleRecords;if(records[this.id])return records[this.id];// see SystemJS getOrCreateModuleRecord
return records[this.id]={name:this.id,exports:S.newModule({}),dependencies:[],importers:[],setters:[]};}},{key:"record",value:function record(){var rec=this.System._loader.moduleRecords[this.id];if(!rec)return null;if(!rec.hasOwnProperty('__lively_modules__')){rec.__lively_modules__={evalOnlyExport:{}};}return rec;}},{key:"updateRecord",value:function updateRecord(doFunc){var record=this.record();if(!record)throw new Error("es6 environment global of ".concat(this.id,": module not loaded, cannot get export object!"));record.locked=true;try{return doFunc(record);}finally{record.locked=false;}}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// search
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"search",value:function(){var _search2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee65(searchStr,options){var _this23=this;var src,re,flags,match,res,_i100,j,line,lineStart,_res$j,idx,length,lineEnd,_p4;return regeneratorRuntime.wrap(function _callee65$(_context65){while(1){switch(_context65.prev=_context65.next){case 0:options=_objectSpread({excludedModules:[]},options);if(!options.excludedModules.some(function(ex){if(typeof ex==='string')return ex===_this23.id;if(ex instanceof RegExp)return ex.test(_this23.id);if(typeof ex==='function')return ex(_this23.id);return false;})){_context65.next=3;break;}return _context65.abrupt("return",[]);case 3:_context65.next=5;return this.source();case 5:src=_context65.sent;if(searchStr instanceof RegExp){flags='g';// add 'g' flag
if(searchStr.ignoreCase)flags+='i';if(searchStr.multiline)flags+='m';re=RegExp(searchStr.source,flags);}else{re=RegExp(searchStr,'g');}res=[];while((match=re.exec(src))!==null){res.push([match.index,match[0].length]);}_i100=0,j=0,line=1,lineStart=0;case 10:if(!(_i100<src.length&&j<res.length)){_context65.next=23;break;}if(src[_i100]=='\n'){line++;lineStart=_i100+1;}_res$j=_slicedToArray2(res[j],2),idx=_res$j[0],length=_res$j[1];if(!(_i100!==idx)){_context65.next=15;break;}return _context65.abrupt("continue",20);case 15:lineEnd=src.slice(lineStart).indexOf('\n');if(lineEnd===-1)lineEnd=src.length;else lineEnd+=lineStart;_p4=this["package"]();res[j]={moduleId:this.id,packageName:_p4?_p4.name:undefined,pathInPackage:_p4?this.pathInPackage():this.id,isLoaded:this.isLoaded(),length:length,line:line,column:_i100-lineStart,lineString:lineEnd-lineStart>1000?"...".concat(src.slice(_i100-10,_i100+100),"..."):src.slice(lineStart,lineEnd)};j++;case 20:_i100++;_context65.next=10;break;case 23:return _context65.abrupt("return",res);case 24:case"end":return _context65.stop();}}},_callee65,this);}));function search(_x58,_x59){return _search2.apply(this,arguments);}return search;}()},{key:"toString",value:function toString(){return"module(".concat(this.id,")");}},{key:"dontTransform",get:function get(){return[this.recorderName,this.sourceAccessorName,'global','self','_moduleExport','_moduleImport','localStorage',// for Firefox, see fetch
// doesn't like to be called as a method, i.e. __lvVarRecorder.fetch
'prompt','alert','fetch','getComputedStyle'].concat(_toConsumableArray2(this.isMochaTest()?[]:GlobalInjector.getGlobals(this._source))).concat(knownGlobals);}// FIXME... better to make this read-only, currently needed for loading
// global modules, from instrumentation.js
},{key:"recorder",set:function set(v){return this._recorder=v;},get:function get(){var _objectSpread4;if(this._recorder)return this._recorder;var S=this.System;var self=this;if(!globalProps.initialized){globalProps.initialized=true;for(var _prop6 in S.global){if(S.global.__lookupGetter__(_prop6)||_prop6=='closed'){globalProps.descriptors[_prop6]={value:undefined,configurable:true,writable:true};}}}var nodejsDescriptors={};if(S.get('@system-env').node){// support for require
var _require2=_require.bind(null,this);_require2.resolve=_resolve.bind(null,this);nodejsDescriptors.require={configurable:true,writable:true,value:_require2};}return this._recorder=Object.create(S.global,_objectSpread(_objectSpread(_objectSpread({},globalProps.descriptors),nodejsDescriptors),{},(_objectSpread4={event:{configurable:true,writable:true,value:undefined},System:{configurable:true,writable:true,value:S},__currentLivelyModule:{value:self}},_defineProperty(_objectSpread4,defaultClassToFunctionConverterName,{configurable:true,writable:true,value:initializeClass}),_defineProperty(_objectSpread4,this.varDefinitionCallbackName,{value:function value(name,kind,_value,recorder,meta){meta=meta||{};meta.kind=kind;return self.define(name,_value,false/* signalChangeImmediately */,meta);}}),_defineProperty(_objectSpread4,"_moduleExport",{value:function value(name,val){scheduleModuleExportsChange(S,self.id,name,val,true/* add export */);}}),_defineProperty(_objectSpread4,"_moduleImport",{value:function value(depName,key){var depId=S.decanonicalize(depName,self.id);var depExports=S.get(depId);if(!depExports){console.warn("import of ".concat(key," failed: ").concat(depName," (tried as ").concat(self.id,") is not loaded!"));return undefined;}self.addDependencyToModuleRecord(module$1(S,depId),// setter is only installed if there isn't a setter already. In
// those cases we make sure that at least the module varRecorder gets
// updated, which is good enough for "virtual modules"
function(imports){return Object.assign(self.recorder,imports);});if(key==undefined)return depExports;if(!depExports.hasOwnProperty(key)){console.warn("import from ".concat(depExports,": Has no export ").concat(key,"!"));}return depExports[key];}}),_objectSpread4)));}},{key:"varDefinitionCallbackName",get:function get(){return'defVar_'+this.id;}}]);return ModuleInterface;}();// update pre-bootstrap modules
/*

var mods = System.get("@lively-env").loadedModules;
Object.keys(mods).forEach(id => {
  if (mods[id].constructor === ModuleInterface) return;
  mods[id] = Object.assign(new ModuleInterface(mods[id].System, mods[id].id), mods[id]);
});

*/ /* global System,process */var funcCall$3=nodes.funcCall,member$4=nodes.member,literal$6=nodes.literal;var isNode$3=System.get('@system-env').node;// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// module cache experiment
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var ModuleTranslationCache=/*#__PURE__*/function(){function ModuleTranslationCache(){_classCallCheck(this,ModuleTranslationCache);}_createClass(ModuleTranslationCache,[{key:"cacheModuleSource",value:function cacheModuleSource(moduleId,hash,source){throw new Error('not yet implemented');}},{key:"fetchStoredModuleSource",value:function fetchStoredModuleSource(moduleId){throw new Error('not yet implemented');}},{key:"deleteCachedData",value:function deleteCachedData(moduleId){throw new Error('not yet implemented');}}],[{key:"earliestDate",get:function get(){return+new Date('Sun Oct 18 2020 16:00:00 GMT-0800 (PST)');}}]);return ModuleTranslationCache;}();var nodejsCacheDirURL=null;function prepareNodejsCaching(){var fs=System._nodeRequire('fs');var path=System._nodeRequire('path');var isWindows=process.platform==='win32';var nodejsCacheDir=!isWindows&&process.cwd()==='/'?path.join(process.env.HOME,'.lively.next'):process.cwd();nodejsCacheDirURL=isWindows?"file:///".concat(nodejsCacheDir.replace(/\\/g,'/')):"file://".concat(nodejsCacheDir);if(!fs.existsSync(nodejsCacheDir))fs.mkdirSync(nodejsCacheDir);}var NodeModuleTranslationCache=/*#__PURE__*/function(_ModuleTranslationCac){_inherits(NodeModuleTranslationCache,_ModuleTranslationCac);var _super14=_createSuper(NodeModuleTranslationCache);function NodeModuleTranslationCache(){_classCallCheck(this,NodeModuleTranslationCache);return _super14.apply(this,arguments);}_createClass(NodeModuleTranslationCache,[{key:"ensurePath",value:function(){var _ensurePath=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee66(path){var url,r,packageInfo,_iterator33,_step33,dir;return regeneratorRuntime.wrap(function _callee66$(_context66){while(1){switch(_context66.prev=_context66.next){case 0:_context66.next=2;return this.moduleCacheDir.join(path).exists();case 2:if(!_context66.sent){_context66.next=4;break;}return _context66.abrupt("return");case 4:url='';_iterator33=_createForOfIteratorHelper(path.split('/'));_context66.prev=6;_iterator33.s();case 8:if((_step33=_iterator33.n()).done){_context66.next=35;break;}dir=_step33.value;url+=dir+'/';r=this.moduleCacheDir.join(url);// why not use r.ensureExistance() ??
_context66.next=14;return r.exists();case 14:if(_context66.sent){_context66.next=24;break;}_context66.prev=15;_context66.next=18;return r.mkdir();case 18:_context66.next=24;break;case 20:_context66.prev=20;_context66.t0=_context66["catch"](15);if(!(_context66.t0.code!='EEXIST')){_context66.next=24;break;}throw _context66.t0;case 24:r=resource('file://'+url+'/package.json');_context66.next=27;return r.exists();case 27:if(!_context66.sent){_context66.next=33;break;}_context66.next=30;return r.read();case 30:packageInfo=_context66.sent;_context66.next=33;return this.moduleCacheDir.join(url+'/package.json').write(packageInfo);case 33:_context66.next=8;break;case 35:_context66.next=40;break;case 37:_context66.prev=37;_context66.t1=_context66["catch"](6);_iterator33.e(_context66.t1);case 40:_context66.prev=40;_iterator33.f();return _context66.finish(40);case 43:case"end":return _context66.stop();}}},_callee66,this,[[6,37,40,43],[15,20]]);}));function ensurePath(_x60){return _ensurePath.apply(this,arguments);}return ensurePath;}()},{key:"dumpModuleCache",value:function(){var _dumpModuleCache=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee67(){var path,r;return regeneratorRuntime.wrap(function _callee67$(_context67){while(1){switch(_context67.prev=_context67.next){case 0:_context67.t0=regeneratorRuntime.keys(System._nodeRequire('module').Module._cache);case 1:if((_context67.t1=_context67.t0()).done){_context67.next=16;break;}path=_context67.t1.value;r=resource('file://'+path);_context67.next=6;return r.exists();case 6:if(!_context67.sent){_context67.next=14;break;}_context67.t2=this;_context67.t3=path;_context67.next=11;return r.read();case 11:_context67.t4=_context67.sent;_context67.next=14;return _context67.t2.cacheModuleSource.call(_context67.t2,_context67.t3,'NO_HASH',_context67.t4);case 14:_context67.next=1;break;case 16:case"end":return _context67.stop();}}},_callee67,this);}));function dumpModuleCache(){return _dumpModuleCache.apply(this,arguments);}return dumpModuleCache;}()},{key:"getFileName",value:function getFileName(moduleId){return moduleId.match(/([^\/]*.)(\.js)?$/)[0];}},{key:"fetchStoredModuleSource",value:function(){var _fetchStoredModuleSource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee68(moduleId){var fname,fpath,r,_yield$r$stat,timestamp,source,hash;return regeneratorRuntime.wrap(function _callee68$(_context68){while(1){switch(_context68.prev=_context68.next){case 0:moduleId=moduleId.replace('file://','');fname=this.getFileName(moduleId);fpath=moduleId.replace(fname,'');r=this.moduleCacheDir.join(moduleId);_context68.next=6;return r.exists();case 6:if(_context68.sent){_context68.next=8;break;}return _context68.abrupt("return",null);case 8:_context68.next=10;return r.stat();case 10:_yield$r$stat=_context68.sent;timestamp=_yield$r$stat.birthtime;_context68.next=14;return r.read();case 14:source=_context68.sent;_context68.next=17;return this.moduleCacheDir.join(fpath+'/.hash_'+fname).read();case 17:hash=_context68.sent;return _context68.abrupt("return",{source:source,timestamp:timestamp,hash:hash});case 19:case"end":return _context68.stop();}}},_callee68,this);}));function fetchStoredModuleSource(_x61){return _fetchStoredModuleSource.apply(this,arguments);}return fetchStoredModuleSource;}()},{key:"cacheModuleSource",value:function(){var _cacheModuleSource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee69(moduleId,hash,source){var fname,fpath;return regeneratorRuntime.wrap(function _callee69$(_context69){while(1){switch(_context69.prev=_context69.next){case 0:moduleId=moduleId.replace('file://','');fname=this.getFileName(moduleId);fpath=moduleId.replace(fname,'');_context69.next=5;return this.ensurePath(fpath);case 5:_context69.next=7;return this.moduleCacheDir.join(moduleId).write(source);case 7:_context69.next=9;return this.moduleCacheDir.join(fpath+'/.hash_'+fname).write(hash);case 9:case"end":return _context69.stop();}}},_callee69,this);}));function cacheModuleSource(_x62,_x63,_x64){return _cacheModuleSource.apply(this,arguments);}return cacheModuleSource;}()},{key:"deleteCachedData",value:function(){var _deleteCachedData=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee70(moduleId){var fname,fpath,r;return regeneratorRuntime.wrap(function _callee70$(_context70){while(1){switch(_context70.prev=_context70.next){case 0:moduleId=moduleId.replace('file://','');fname=this.getFileName(moduleId);fpath=moduleId.replace(fname,'');r=this.moduleCacheDir.join(moduleId);_context70.next=6;return r.exists();case 6:if(_context70.sent){_context70.next=8;break;}return _context70.abrupt("return",false);case 8:_context70.next=10;return r.remove();case 10:return _context70.abrupt("return",true);case 11:case"end":return _context70.stop();}}},_callee70,this);}));function deleteCachedData(_x65){return _deleteCachedData.apply(this,arguments);}return deleteCachedData;}()},{key:"moduleCacheDir",get:function get(){if(!nodejsCacheDirURL)prepareNodejsCaching();return resource("".concat(nodejsCacheDirURL,"/.module_cache/"));}}]);return NodeModuleTranslationCache;}(ModuleTranslationCache);var BrowserModuleTranslationCache=/*#__PURE__*/function(_ModuleTranslationCac2){_inherits(BrowserModuleTranslationCache,_ModuleTranslationCac2);var _super15=_createSuper(BrowserModuleTranslationCache);function BrowserModuleTranslationCache(){var _this24;var dbName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'lively.modules-module-translation-cache';_classCallCheck(this,BrowserModuleTranslationCache);_this24=_super15.call(this);_this24.version=2;_this24.sourceCodeCacheStoreName='sourceCodeStore';_this24.dbName=dbName;_this24.db=_this24.openDb();return _this24;}_createClass(BrowserModuleTranslationCache,[{key:"openDb",value:function openDb(){var _this25=this;var req=System.global.indexedDB.open(this.version);return new Promise(function(resolve,reject){req.onsuccess=function(evt){resolve(this.result);};req.onerror=function(evt){return reject(evt.target);};req.onupgradeneeded=function(evt){return evt.currentTarget.result.createObjectStore(_this25.sourceCodeCacheStoreName,{keyPath:'moduleId'});};});}},{key:"deleteDb",value:function deleteDb(){var req=System.global.indexedDB.deleteDatabase(this.dbName);return new Promise(function(resolve,reject){req.onerror=function(evt){return reject(evt.target);};req.onsuccess=function(evt){return resolve(evt);};});}},{key:"closeDb",value:function(){var _closeDb=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee71(){var db,req;return regeneratorRuntime.wrap(function _callee71$(_context71){while(1){switch(_context71.prev=_context71.next){case 0:_context71.next=2;return this.db;case 2:db=_context71.sent;req=db.close();return _context71.abrupt("return",new Promise(function(resolve,reject){req.onsuccess=function(evt){resolve(this.result);};req.onerror=function(evt){return reject(evt.target.errorCode);};}));case 5:case"end":return _context71.stop();}}},_callee71,this);}));function closeDb(){return _closeDb.apply(this,arguments);}return closeDb;}()},{key:"cacheModuleSource",value:function(){var _cacheModuleSource2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee72(moduleId,hash,source){var _this26=this;var db;return regeneratorRuntime.wrap(function _callee72$(_context72){while(1){switch(_context72.prev=_context72.next){case 0:_context72.next=2;return this.db;case 2:db=_context72.sent;return _context72.abrupt("return",new Promise(function(resolve,reject){var transaction=db.transaction([_this26.sourceCodeCacheStoreName],'readwrite');var store=transaction.objectStore(_this26.sourceCodeCacheStoreName);var timestamp=Date.now();store.put({moduleId:moduleId,hash:hash,source:source,timestamp:timestamp});transaction.oncomplete=resolve;transaction.onerror=reject;}));case 4:case"end":return _context72.stop();}}},_callee72,this);}));function cacheModuleSource(_x66,_x67,_x68){return _cacheModuleSource2.apply(this,arguments);}return cacheModuleSource;}()},{key:"fetchStoredModuleSource",value:function(){var _fetchStoredModuleSource2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee73(moduleId){var _this27=this;var db;return regeneratorRuntime.wrap(function _callee73$(_context73){while(1){switch(_context73.prev=_context73.next){case 0:_context73.next=2;return this.db;case 2:db=_context73.sent;return _context73.abrupt("return",new Promise(function(resolve,reject){var transaction=db.transaction([_this27.sourceCodeCacheStoreName]);var objectStore=transaction.objectStore(_this27.sourceCodeCacheStoreName);var req=objectStore.get(moduleId);req.onerror=reject;req.onsuccess=function(evt){return resolve(req.result);};}));case 4:case"end":return _context73.stop();}}},_callee73,this);}));function fetchStoredModuleSource(_x69){return _fetchStoredModuleSource2.apply(this,arguments);}return fetchStoredModuleSource;}()},{key:"deleteCachedData",value:function(){var _deleteCachedData2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee74(moduleId){var _this28=this;var db;return regeneratorRuntime.wrap(function _callee74$(_context74){while(1){switch(_context74.prev=_context74.next){case 0:_context74.next=2;return this.db;case 2:db=_context74.sent;return _context74.abrupt("return",new Promise(function(resolve,reject){var transaction=db.transaction([_this28.sourceCodeCacheStoreName],'readwrite');var objectStore=transaction.objectStore(_this28.sourceCodeCacheStoreName);var req=objectStore["delete"](moduleId);req.onerror=reject;req.onsuccess=function(evt){return resolve(req.result);};}));case 4:case"end":return _context74.stop();}}},_callee74,this);}));function deleteCachedData(_x70){return _deleteCachedData2.apply(this,arguments);}return deleteCachedData;}()}]);return BrowserModuleTranslationCache;}(ModuleTranslationCache);// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// code instrumentation
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var node_modulesDir=System.decanonicalize('lively.modules/node_modules/');var exceptions=[// id => id.indexOf(resolve("node_modules/")) > -1,
// id => canonicalURL(id).indexOf(node_modulesDir) > -1,
function(id){return!id.endsWith('.js')&&!id.endsWith('.jsx')&&!id.startsWith('https://jspm.dev');},function(id){return id.endsWith('dist/acorn.js')||id.endsWith('dist/escodegen.browser.js')||id.endsWith('bowser.js')||id.endsWith('TweenMax.min.js');},function(id){return id.endsWith('babel-core/browser.js')||id.endsWith('system.src.js')||id.includes('systemjs-plugin-babel');}];function prepareCodeForCustomCompile(System,source,moduleId,module,debug){source=String(source);var sourceAccessorName=module.sourceAccessorName,recorder=module.recorder,recorderName=module.recorderName,dontTransform=module.dontTransform,varDefinitionCallbackName=module.varDefinitionCallbackName,_module$embedOriginal=module.embedOriginalCode,embedOriginalCode=_module$embedOriginal===void 0?true:_module$embedOriginal;sourceAccessorName=embedOriginalCode?sourceAccessorName:undefined;var options={topLevelVarRecorder:recorder,varRecorderName:recorderName,sourceAccessorName:sourceAccessorName,dontTransform:dontTransform,jsx:moduleId.endsWith('.jsx'),recordGlobals:true,keepPreviouslyDeclaredValues:true,declarationWrapperName:varDefinitionCallbackName,evalId:module.nextEvalId(),classTransform:classToFunctionTransform,currentModuleAccessor:funcCall$3(member$4(funcCall$3(member$4(member$4('__lvVarRecorder','System'),'get'),literal$6('@lively-env')),'moduleEnv'),literal$6(moduleId))};var isGlobal=recorderName==='System.global';var header=debug?"console.log(\"[lively.modules] executing module ".concat(moduleId,"\");\n"):'';var footer='';if(isGlobal){// FIXME how to update exports in that case?
delete options.declarationWrapperName;}else{header+="SystemJS.get(\"@lively-env\").evaluationStart(\"".concat(moduleId,"\");\n")+"var ".concat(recorderName," = SystemJS.get(\"@lively-env\").moduleEnv(\"").concat(moduleId,"\").recorder;\n")+(embedOriginalCode?"\nvar ".concat(sourceAccessorName," = ").concat(JSON.stringify(source),";\n"):'');footer+="\nSystemJS.get(\"@lively-env\").evaluationEnd(\"".concat(moduleId,"\");");}try{var rewrittenSource=header+evalCodeTransform(source,options)+footer;if(debug&&typeof $world!=='undefined'&&$world.get('log')&&$world.get('log').isText)$world.get('log').textString=rewrittenSource;return{source:rewrittenSource,options:options};}catch(e){console.error("Error in prepareCodeForCustomCompile of ".concat(moduleId," ").concat(e.stack));return{source:source,options:options};}}function prepareTranslatedCodeForSetterCapture(System,source,moduleId,module,options,debug){source=String(source);var tfmOptions=_objectSpread(_objectSpread({},options),{},{classTransform:classToFunctionTransform,topLevelVarRecorder:module.recorder,varRecorderName:module.recorderName,dontTransform:module.dontTransform,recordGlobals:true,declarationWrapperName:module.varDefinitionCallbackName,currentModuleAccessor:funcCall$3(member$4(funcCall$3(member$4(member$4('__lvVarRecorder','System'),'get'),literal$6('@lively-env')),'moduleEnv'),literal$6(moduleId))});var isGlobal=module.recorderName==='System.global';try{var rewrittenSource=evalCodeTransformOfSystemRegisterSetters(source,tfmOptions);if(debug&&typeof $world!=='undefined'&&$world.get('log')&&$world.get('log').isText)$world.get('log').textString+=rewrittenSource;return rewrittenSource;}catch(e){console.error('Error in prepareTranslatedCodeForSetterCapture',e.stack);return source;}}function getCachedNodejsModule(System,load){// On nodejs we might run alongside normal node modules. To not load those
// twice we have this little hack...
try{var Module=System._nodeRequire('module').Module;var _id2=Module._resolveFilename(load.name.replace(/^file:\/\//,'')// unix
.replace(/^\/([a-z]:\/)/i,'$1'));// windows
var nodeModule=Module._cache[_id2];return nodeModule;}catch(e){System.debug&&console.log('[lively.modules getCachedNodejsModule] %s unknown to nodejs',load.name);}return null;}function addNodejsWrapperSource(System,load){// On nodejs we might run alongside normal node modules. To not load those
// twice we have this little hack...
var m=getCachedNodejsModule(System,load);if(m){load.metadata.format='esm';load.source="var exports = System._nodeRequire('".concat(m.id,"'); export default exports;\n")+allOwnPropertiesOrFunctions(m.exports).map(function(k){return isValidIdentifier(k)?"export var ".concat(k," = exports['").concat(k,"'];"):"/*ignoring export \"".concat(k,"\" b/c it is not a valid identifier*/");}).join('\n');System.debug&&console.log('[lively.modules customTranslate] loading %s from nodejs module cache',load.name);return true;}System.debug&&console.log('[lively.modules customTranslate] %s not yet in nodejs module cache',load.name);return false;}function customTranslate(_x71,_x72){return _customTranslate.apply(this,arguments);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// Functions below are for re-loading modules from change.js. We typically
// start with a load object that skips the normalize / fetch step. Since we need
// to jumo in the "middle" of the load process and SystemJS does not provide an
// interface to this, we need to invoke the translate / instantiate / execute
// manually
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function _customTranslate(){_customTranslate=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee93(proceed,load){var System,debug,meta,ignored,start,format,mod,instrumented,isEsm,useCache,indexdb,hashForCache,cache,stored,options,_prepareCodeForCustom,source,_prepareCodeForCustom2;return regeneratorRuntime.wrap(function _callee93$(_context93){while(1){switch(_context93.prev=_context93.next){case 0:// load like
// {
//   address: "file:///Users/robert/Lively/lively-dev/lively.vm/tests/test-resources/some-es6-module.js",
//   name: "file:///Users/robert/Lively/lively-dev/lively.vm/tests/test-resources/some-es6-module.js",
//   metadata: { deps: [/*...*/], entry: {/*...*/}, format: "esm", sourceMap: ... },
//   source: "..."
// }
System=this;debug=System.debug;meta=load.metadata;ignored=meta&&meta.hasOwnProperty('instrument')&&!meta.instrument||exceptions.some(function(exc){return exc(load.name);});if(!ignored){_context93.next=7;break;}debug&&console.log('[lively.modules customTranslate ignoring] %s',load.name);return _context93.abrupt("return",proceed(load));case 7:if(!(isNode$3&&addNodejsWrapperSource(System,load))){_context93.next=10;break;}debug&&console.log('[lively.modules] loaded %s from nodejs cache',load.name);return _context93.abrupt("return",proceed(load));case 10:start=Date.now();format=detectModuleFormat(load.source,meta);mod=module$1(System,load.name);instrumented=false;isEsm=format==='esm';mod.setSource(load.source);// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// cache experiment part 1
_context93.prev=16;useCache=System.useModuleTranslationCache;indexdb=System.global.indexedDB;hashForCache=useCache&&String(hashCode(load.source));if(!(useCache&&indexdb&&isEsm)){_context93.next=33;break;}cache=System._livelyModulesTranslationCache||(System._livelyModulesTranslationCache=new BrowserModuleTranslationCache());_context93.next=24;return cache.fetchStoredModuleSource(load.name);case 24:stored=_context93.sent;if(!(stored&&stored.hash==hashForCache&&stored.timestamp>=BrowserModuleTranslationCache.earliestDate)){_context93.next=31;break;}if(!stored.source){_context93.next=31;break;}meta.format='register';meta.deps=[];// the real deps will be populated when the
// system register code is run, still need
// to define it here to avoid an
// undefined entry later!
debug&&console.log('[lively.modules customTranslate] loaded %s from browser cache after %sms',load.name,Date.now()-start);return _context93.abrupt("return",Promise.resolve(stored.source));case 31:_context93.next=44;break;case 33:if(!(isNode$3&&useCache&&isEsm)){_context93.next=44;break;}cache=System._livelyModulesTranslationCache||(System._livelyModulesTranslationCache=new NodeModuleTranslationCache());_context93.next=37;return cache.fetchStoredModuleSource(load.name);case 37:stored=_context93.sent;if(!(stored&&stored.hash==hashForCache&&stored.timestamp>=NodeModuleTranslationCache.earliestDate)){_context93.next=44;break;}if(!stored.source){_context93.next=44;break;}meta.format='register';meta.deps=[];// the real deps will be populated when the
// system register code is run, still need
// to define it here to avoid an
// undefined entry later!
debug&&console.log('[lively.modules customTranslate] loaded %s from filesystem cache after %sms',load.name,Date.now()-start);return _context93.abrupt("return",Promise.resolve(stored.source));case 44:_context93.next=49;break;case 46:_context93.prev=46;_context93.t0=_context93["catch"](16);console.error("[lively.modules customTranslate] error reading module translation cache: ".concat(_context93.t0.stack));case 49:// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
options={};if(isEsm){mod.recorderName='__lvVarRecorder';if(mod.recorder===System.global){mod.unloadEnv();}load.metadata.format='esm';_prepareCodeForCustom=prepareCodeForCustomCompile(System,load.source,load.name,mod,debug),options=_prepareCodeForCustom.options,source=_prepareCodeForCustom.source;load.source=source;load.metadata['lively.modules instrumented']=true;instrumented=true;debug&&console.log('[lively.modules] loaded %s as es6 module',load.name);// debug && console.log(load.source)
}else if(load.metadata.format==='global'){mod.recorderName='System.global';mod.recorder=System.global;load.metadata.format='global';_prepareCodeForCustom2=prepareCodeForCustomCompile(System,load.source,load.name,mod,debug),options=_prepareCodeForCustom2.options,source=_prepareCodeForCustom2.source;load.source=source;load.metadata['lively.modules instrumented']=true;instrumented=true;debug&&console.log('[lively.modules] loaded %s as instrumented global module',load.name);}// cjs is currently not supported to be instrumented
// } else if (isCjs && isNode) {
//   load.metadata.format = "cjs";
//   var id = cjs.resolve(load.address.replace(/^file:\/\//, ""));
//   load.source = cjs._prepareCodeForCustomCompile(load.source, id, cjs.envFor(id), debug);
//   load.metadata["lively.modules instrumented"] = true;
//   instrumented = true;
//   debug && console.log("[lively.modules] loaded %s as instrumented cjs module", load.name)
//   // console.log("[lively.modules] no rewrite for cjs module", load.name)
// }
if(!instrumented){debug&&console.log("[lively.modules] customTranslate ignoring %s b/c don't know how to handle format %s",load.name,load.metadata.format);}return _context93.abrupt("return",proceed(load).then(/*#__PURE__*/function(){var _ref28=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee92(translated){var cache;return regeneratorRuntime.wrap(function _callee92$(_context92){while(1){switch(_context92.prev=_context92.next){case 0:if(translated.indexOf('System.register(')===0){debug&&console.log('[lively.modules customTranslate] Installing System.register setter captures for %s',load.name);translated=prepareTranslatedCodeForSetterCapture(System,translated,load.name,mod,options,debug);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// cache experiment part 2
if(!(isNode$3&&useCache&&isEsm)){_context92.next=14;break;}cache=System._livelyModulesTranslationCache||(System._livelyModulesTranslationCache=new NodeModuleTranslationCache());_context92.prev=3;_context92.next=6;return cache.cacheModuleSource(load.name,hashForCache,translated);case 6:debug&&console.log('[lively.modules customTranslate] stored cached version in filesystem for %s',load.name);_context92.next=12;break;case 9:_context92.prev=9;_context92.t0=_context92["catch"](3);console.error("[lively.modules customTranslate] failed storing module cache: ".concat(_context92.t0.stack));case 12:_context92.next=25;break;case 14:if(!(useCache&&indexdb&&isEsm)){_context92.next=25;break;}cache=System._livelyModulesTranslationCache||(System._livelyModulesTranslationCache=new BrowserModuleTranslationCache());_context92.prev=16;_context92.next=19;return cache.cacheModuleSource(load.name,hashForCache,translated);case 19:debug&&console.log('[lively.modules customTranslate] stored cached version for %s',load.name);_context92.next=25;break;case 22:_context92.prev=22;_context92.t1=_context92["catch"](16);console.error("[lively.modules customTranslate] failed storing module cache: ".concat(_context92.t1.stack));case 25:// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
debug&&console.log('[lively.modules customTranslate] done %s after %sms',load.name,Date.now()-start);return _context92.abrupt("return",translated);case 27:case"end":return _context92.stop();}}},_callee92,null,[[3,9],[16,22]]);}));return function(_x93){return _ref28.apply(this,arguments);};}()));case 53:case"end":return _context93.stop();}}},_callee93,this,[[16,46]]);}));return _customTranslate.apply(this,arguments);}function instrumentSourceOfEsmModuleLoad(System,load){// brittle!
// The result of System.translate is source code for a call to
// System.register that can't be run standalone. We parse the necessary
// details from it that we will use to re-define the module
// (dependencies, setters, execute)
// Note: this only works for esm modules!
return System.translate(load).then(function(translated){// translated looks like
// (function(__moduleName){System.register(["./some-es6-module.js", ...], function (_export) {
//   "use strict";
//   var x, z, y;
//   return {
//     setters: [function (_someEs6ModuleJs) { ... }],
//     execute: function () {...}
//   };
// });
var parsed=parse$2(translated);var callExpression=parsed.body.find(function(ea){return ea.expression&&ea.expression.type==='CallExpression'&&ea.expression.callee.property.name==='register';});if(!callExpression)throw new Error("Cannot find register call in translated source of ".concat(load.name));var registerCall=callExpression.expression;var depNames=registerCall.arguments[0].elements.map(function(ea){return ea.value;});var declareFuncNode=registerCall.arguments[1];var declareFuncSource=translated.slice(declareFuncNode.start,declareFuncNode.end);var declare=eval("var __moduleName = \"".concat(load.name,"\";(").concat(declareFuncSource,");\n//# sourceURL=").concat(load.name,"\n"));if(System.debug&&$world!=='undefined'&&$world.get('log')&&$world.get('log').isText){$world.get('log').textString=declare;}return{localDeps:depNames,declare:declare};});}function instrumentSourceOfGlobalModuleLoad(System,load){// return {localDeps: depNames, declare: declare};
return System.translate(load).then(function(translated){return{translated:translated};});}function wrapModuleLoad(System){if(isInstalled(System,'translate','lively_modules_translate_hook'))return;install(System,'translate',function lively_modules_translate_hook(proceed,load){return customTranslate.call(System,proceed,load);},'lively_modules_translate_hook');}function unwrapModuleLoad(System){remove$1(System,'translate','lively_modules_translate_hook');}/* global Buffer */var brotli,fetch$1;if(System.get('@system-env').node){fetch$1=System._nodeRequire('node-fetch');brotli=System._nodeRequire('brotli');}var jsFileHashMap;function fetchResource(_x73,_x74){return _fetchResource.apply(this,arguments);}// FIXME!!!
function _fetchResource(){_fetchResource=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee94(proceed,load){var System,largeModuleSize,res,useNodeFetch,result,error,useCache,indexdb,cache,stored,isWebResource,isCrossDomain,_ref29,_headers,_ref30,_ref31,encoding;return regeneratorRuntime.wrap(function _callee94$(_context94){while(1){switch(_context94.prev=_context94.next){case 0:System=this;largeModuleSize=250*1000;res=System.resource(load.name);useNodeFetch=System.get('@system-env').node&&!res.isNodeJSFileResource;if(!useNodeFetch){_context94.next=8;break;}_context94.next=7;return fetch$1(load.name);case 7:res=_context94.sent;case 8:if(res){_context94.next=10;break;}return _context94.abrupt("return",proceed(load));case 10:if(!(!jsFileHashMap&&!System.get('@system-env').node)){_context94.next=14;break;}_context94.next=13;return System.resource(System.baseURL).join('__JS_FILE_HASHES__').readJson();case 13:jsFileHashMap=_context94.sent;case 14:useCache=System.useModuleTranslationCache;indexdb=System.global.indexedDB;cache=System._livelyModulesTranslationCache;if(!(!System.get('@system-env').node&&useCache&&indexdb&&cache)){_context94.next=24;break;}_context94.next=20;return cache.fetchStoredModuleSource(load.name);case 20:stored=_context94.sent;if(!(stored&&(jsFileHashMap[load.name.replace(System.baseURL,'/')]==stored.hash||load.name.includes('jspm')))){_context94.next=24;break;}load.metadata.instrument=false;// skip instrumentation
return _context94.abrupt("return",stored.source);case 24:if(!(res.isResource&&res.ext()&&res.ext().startsWith('css'))){_context94.next=26;break;}return _context94.abrupt("return",'');case 26:_context94.prev=26;if(!res.isResource){_context94.next=33;break;}_context94.next=30;return res.read();case 30:_context94.t0=_context94.sent;_context94.next=34;break;case 33:_context94.t0=res;case 34:result=_context94.t0;_context94.next=40;break;case 37:_context94.prev=37;_context94.t1=_context94["catch"](26);error=_context94.t1;case 40:if(!(error&&System.get('@system-env').browser)){_context94.next=53;break;}isWebResource=res.url.startsWith('http');isCrossDomain=!res.url.startsWith(document.location.origin);if(!(isWebResource&&isCrossDomain)){_context94.next=53;break;}_context94.prev=44;_context94.next=47;return res.makeProxied(System.baseURL).read();case 47:result=_context94.sent;error=null;_context94.next=53;break;case 51:_context94.prev=51;_context94.t2=_context94["catch"](44);case 53:if(!error){_context94.next=55;break;}throw error;case 55:if(!useNodeFetch){_context94.next=71;break;}// since we run outside of a browser, it is likely not handling brotli decompression
// out of the box if needed
_ref29=result.headers||{},_headers=_ref29._headers;_ref30=_headers&&_headers['content-encoding']||[],_ref31=_slicedToArray2(_ref30,1),encoding=_ref31[0];if(!(encoding=='br')){_context94.next=68;break;}_context94.t3=Buffer;_context94.t4=brotli;_context94.next=63;return result.buffer();case 63:_context94.t5=_context94.sent;_context94.t6=_context94.t4.decompress.call(_context94.t4,_context94.t5);result=_context94.t3.from.call(_context94.t3,_context94.t6).toString();_context94.next=71;break;case 68:_context94.next=70;return result.text();case 70:result=_context94.sent;case 71:if(!(result.length>largeModuleSize&&typeof $world!=='undefined'&&!System._loadingIndicator)){_context94.next=78;break;}System._loadingIndicator=$world.execCommand('open loading indicator',{label:'loading module',status:load.name.replace(System.baseURL,'')});_context94.next=75;return promise.delay(500);case 75:if(!System._loadingIndicator){_context94.next=78;break;}_context94.next=78;return System._loadingIndicator.whenRendered();case 78:return _context94.abrupt("return",result);case 79:case"end":return _context94.stop();}}},_callee94,this,[[26,37],[44,51]]);}));return _fetchResource.apply(this,arguments);}var livelyURLRe=/^lively:\/\/([^\/]+)\/(.*)$/;function livelyProtocol(proceed,url){var match=url.match(livelyURLRe);if(!match)return proceed(url);var _match=_slicedToArray2(match,3),_=_match[0],worldId=_match[1],id=_match[2];return{read:function read(){var m=typeof $world!=='undefined'&&$world.getMorphWithId(id);return Promise.resolve(m?m.textString:"/*Could not locate ".concat(id,"*/"));},write:function write(source){var m=typeof $world!=='undefined'&&$world.getMorphWithId(id);if(!m)return Promise.reject("Could not save morph ".concat(id));m.textString=source;return Promise.resolve(this);}};}function wrapResource(System){System.resource=resource;if(isInstalled(System,'fetch',fetchResource)){remove$1(System,'fetch','fetchResource');}install(System,'fetch',fetchResource);if(isInstalled(System,'resource','livelyProtocol')){remove$1(System,'fetch','livelyProtocol');}install(System,'resource',livelyProtocol);}var LivelyResource=/*#__PURE__*/function(_Resource4){_inherits(LivelyResource,_Resource4);var _super16=_createSuper(LivelyResource);function LivelyResource(){_classCallCheck(this,LivelyResource);return _super16.apply(this,arguments);}_createClass(LivelyResource,[{key:"read",value:function(){var _read4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee75(){var id,m;return regeneratorRuntime.wrap(function _callee75$(_context75){while(1){switch(_context75.prev=_context75.next){case 0:id=this.morphId;m=typeof $world!=='undefined'&&$world.getMorphWithId(id);return _context75.abrupt("return",Promise.resolve(m?m.textString:"/*Could not locate ".concat(id,"*/")));case 3:case"end":return _context75.stop();}}},_callee75,this);}));function read(){return _read4.apply(this,arguments);}return read;}()},{key:"write",value:function(){var _write4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee76(source){var id,m;return regeneratorRuntime.wrap(function _callee76$(_context76){while(1){switch(_context76.prev=_context76.next){case 0:id=this.morphId;m=typeof $world!=='undefined'&&$world.getMorphWithId(id);if(m){_context76.next=4;break;}return _context76.abrupt("return",Promise.reject("Could not save morph ".concat(id)));case 4:m.textString=source;return _context76.abrupt("return",Promise.resolve(this));case 6:case"end":return _context76.stop();}}},_callee76,this);}));function write(_x75){return _write4.apply(this,arguments);}return write;}()},{key:"exists",value:function(){var _exists4=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee77(){return regeneratorRuntime.wrap(function _callee77$(_context77){while(1){switch(_context77.prev=_context77.next){case 0:return _context77.abrupt("return",typeof $world!=='undefined'&&$world.getMorphWithId(this.morphId));case 1:case"end":return _context77.stop();}}},_callee77,this);}));function exists(){return _exists4.apply(this,arguments);}return exists;}()},{key:"remove",value:function(){var _remove5=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee78(){return regeneratorRuntime.wrap(function _callee78$(_context78){while(1){switch(_context78.prev=_context78.next){case 0:// removes the morph
typeof $world!=='undefined'&&$world.getMorphWithId(this.morphId).remove();return _context78.abrupt("return",true);case 2:case"end":return _context78.stop();}}},_callee78,this);}));function remove(){return _remove5.apply(this,arguments);}return remove;}()},{key:"canDealWithJSON",get:function get(){return false;}},{key:"morphId",get:function get(){var match=this.url.match(livelyURLRe);var _match2=_slicedToArray2(match,3),_=_match2[0],worldId=_match2[1],id=_match2[2];return id;}}]);return LivelyResource;}(Resource);var resourceExtension$3={name:'lively.modules',matches:function matches(url){return url.match(livelyURLRe);},resourceClass:LivelyResource};registerExtension(resourceExtension$3);/* global System,process,self,WorkerGlobalScope,location,global */ // -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var isNode$4=System.get('@system-env').node;var GLOBAL$2=typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:undefined;var defaultOptions$2={notificationLimit:null};function wrapModuleResolution(System){if(!isInstalled(System,'normalize','normalizeHook')){install(System,'normalize',normalizeHook,'normalizeHook');}if(!isInstalled(System,'decanonicalize','decanonicalizeHook')){install(System,'decanonicalize',decanonicalizeHook,'decanonicalizeHook');}if(!isInstalled(System,'normalizeSync','decanonicalizeHook')){install(System,'normalizeSync',decanonicalizeHook,'decanonicalizeHook');}if(!isInstalled(System,'newModule','newModule_volatile')){install(System,'newModule',newModule_volatile,'newModule_volatile');}if(!isInstalled(System,'instantiate','instantiate_triggerOnLoadCallbacks')){install(System,'instantiate',instantiate_triggerOnLoadCallbacks,'instantiate_triggerOnLoadCallbacks');}if(!isInstalled(System,'locate','locateHook')){install(System,'locate',locateHook,'locateHook');}}function unwrapModuleResolution(System){remove$1(System,'normalize','normalizeHook');remove$1(System,'decanonicalize','decanonicalizeHook');remove$1(System,'normalizeSync','decanonicalizeHook');remove$1(System,'newModule','newModule_volatile');remove$1(System,'instantiate','instantiate_triggerOnLoadCallbacks');remove$1(System,'locate','locateHook');}// Accessible system-wide via System.get("@lively-env")
function livelySystemEnv(System){return{moduleEnv:function moduleEnv(id){return classHolder.module(System,id);},// TODO this is just a test, won't work in all cases...
get itself(){return System.get(System.decanonicalize('lively.modules/index.js'));},evaluationStart:function evaluationStart(moduleId){classHolder.module(System,moduleId).evaluationStart();},evaluationEnd:function evaluationEnd(moduleId){classHolder.module(System,moduleId).evaluationEnd();},dumpConfig:function dumpConfig(){return JSON.stringify({baseURL:System.baseURL,transpiler:System.transpiler,defaultJSExtensions:System.defaultJSExtensions,map:System.map,meta:System.meta,packages:System.packages,paths:System.paths,packageConfigPaths:System.packageConfigPaths},null,2);},get packageRegistry(){return System['__lively.modules__packageRegistry'];},set packageRegistry(x){System['__lively.modules__packageRegistry']=x;},// this is where the canonical state of the module system is held...
packages:System['__lively.modules__packages']||(System['__lively.modules__packages']={}),loadedModules:System['__lively.modules__loadedModules']||(System['__lively.modules__loadedModules']={}),pendingExportChanges:System['__lively.modules__pendingExportChanges']||(System['__lively.modules__pendingExportChanges']={}),notifications:System['__lively.modules__notifications']||(System['__lively.modules__notifications']=[]),notificationSubscribers:System['__lively.modules__notificationSubscribers']||(System['__lively.modules__notificationSubscribers']={}),options:System['__lively.modules__options']||(System['__lively.modules__options']=deepCopy(defaultOptions$2)),onLoadCallbacks:System['__lively.modules__onLoadCallbacks']||(System['__lively.modules__onLoadCallbacks']=[]),modulePackageMapCache:System['__lively.modules__modulePackageMapCache']};}function systems(){if(!System.constructor.systems)System.constructor.systems={};return System.constructor.systems;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// System creation + access interface
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function nameOfSystem(System){return Object.keys(systems()).detect(function(name){return systems()[name]===System;});}function getSystem(nameOrSystem,config){return nameOrSystem&&typeof nameOrSystem!=='string'?nameOrSystem:systems()[nameOrSystem]||(systems()[nameOrSystem]=makeSystem(config));}function removeSystem(nameOrSystem){// FIXME "unload" code...???
var name=nameOrSystem&&typeof nameOrSystem!=='string'?nameOfSystem(nameOrSystem):nameOrSystem;delete systems()[name];}function makeSystem(cfg){return prepareSystem(new System.constructor(),cfg);}function prepareSystem(System,config){System.trace=true;config=config||{};var useModuleTranslationCache=config.hasOwnProperty('useModuleTranslationCache')?config.useModuleTranslationCache:!urlQuery().noModuleCache;System.useModuleTranslationCache=useModuleTranslationCache;System.set('@lively-env',System.newModule(livelySystemEnv(System)));var isWorker=typeof WorkerGlobalScope!=='undefined';if(isWorker){System.set('@system-env',System.newModule(_objectSpread(_objectSpread({},System.get('@system-env')),{},{browser:true,worker:true,location:location})));}var isElectron=typeof process!=='undefined'&&process.versions&&process.versions.electron;if(isElectron){System.set('@system-env',System.newModule(_objectSpread({electron:isElectron},System.get('@system-env'))));}wrapResource(System);wrapModuleLoad(System);wrapModuleResolution(System);if(isElectron){var electronCoreModules=['electron'];var map=electronCoreModules.reduce(function(map,ea){map[ea]='@node/'+ea;return map;},{});config.map=merge(map,config.map);}if(isNode$4){var nodejsCoreModules=['addons','assert','buffer','child_process','cluster','console','crypto','dgram','dns','domain','events','fs','http','https','module','net','os','path','punycode','querystring','readline','repl','stream','stringdecoder','timers','tls','tty','url','util','v8','vm','zlib','constants'];var map=nodejsCoreModules.reduce(function(map,ea){map[ea]='@node/'+ea;return map;},{});config.map=merge(map,config.map);// for sth l ike map: {"lively.lang": "node_modules:lively.lang"}
// cfg.paths = obj.merge({"node_modules:*": "./node_modules/*"}, cfg.paths);
}config.packageConfigPaths=config.packageConfigPaths||['./node_modules/*/package.json'];if(!config.transpiler&&System.transpiler==='traceur'){var initialSystem=GLOBAL$2.System;if(initialSystem.transpiler==='lively.transpiler'){System.set('lively.transpiler',initialSystem.get('lively.transpiler'));System._loader.transpilerPromise=initialSystem._loader.transpilerPromise;System.config({transpiler:'lively.transpiler',babelOptions:Object.assign(initialSystem.babelOptions||{},config.babelOptions)});}else{System.config({map:{'plugin-babel':initialSystem.map['plugin-babel'],'systemjs-babel-build':initialSystem.map['systemjs-babel-build']},transpiler:initialSystem.transpiler,babelOptions:Object.assign(initialSystem.babelOptions||{},config.babelOptions)});}}System.config(config);return System;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// FIXME! proper config!
function urlQuery(){if(typeof document==='undefined'||!document.location)return{};return(document.location.search||'').replace(/^\?/,'').split('&').reduce(function(query,ea){var split=ea.split('=');var key=split[0];var value=split[1];if(value==='true'||value==='false')value=eval(value);else if(!isNaN(Number(value)))value=Number(value);query[key]=value;return query;},{});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// name resolution extensions
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var dotSlashStartRe=/^\.?\//;var trailingSlashRe=/\/$/;var jsExtRe=/\.js$/;var jsxExtRe=/\.jsx$/;var nodeExtRe=/\.node$/;var jsonExtRe=/\.json$/;var jsonJsExtRe=/(.*\.json)\.js$/i;var jsxJsExtRe=/(.*\.jsx)\.js$/i;var doubleSlashRe=/.\/{2,}/g;var nodeModRe=/\@node.*/;function preNormalize(System,name,parent){// console.log(`> [preNormalize] ${name}`);
if(name==='..')name='../index.js';// Fix ".."
// rk 2016-07-19: sometimes SystemJS doStringMap() will resolve path into
// names with double slashes which causes module id issues later. This fixes
// that...
// name = name.replace(/([^:])\/\/+/g, "$1\/");
name=name.replace(doubleSlashRe,function(match){return match[0]===':'?match:match[0]+'/';});// systemjs' decanonicalize has by default not the fancy
// '{node: "events", "~node": "@empty"}' mapping but we need it
var _System$get=System.get('@lively-env'),packageRegistry=_System$get.packageRegistry;if(packageRegistry){var pkg=parent&&packageRegistry.findPackageHavingURL(parent);if(pkg){var _map3=pkg.map,packageURL=pkg.url;var mappedObject=_map3&&_map3[name]||System.map[name];if(mappedObject){if(_typeof2(mappedObject)==='object'){mappedObject=normalize_doMapWithObject(mappedObject,pkg,System);}if(typeof mappedObject==='string'&&mappedObject!==''){name=mappedObject;}// relative to package
if(name.startsWith('.'))name=urlResolve(join$1(packageURL,name));}}}// <snip> experimental
if(packageRegistry){var resolved=packageRegistry.resolvePath(name,parent);if(resolved){if(resolved.endsWith('/')&&!name.endsWith('/'))resolved=resolved.slice(0,-1);if(!resolved.endsWith('/')&&name.endsWith('/'))resolved=resolved+'/';name=resolved;}}// </snap> experimental
// console.log(`>> [preNormalize] ${name}`);
return name;}function postNormalize(System,normalizeResult,isSync){// console.log(`> [postNormalize] ${normalizeResult}`);
// lookup package main
var base=normalizeResult.replace(jsExtRe,'');// rk 2017-05-13: FIXME, we currently use a form like
// System.decanonicalize("lively.lang/") to figure out the package base path...
if(normalizeResult.endsWith('/')){// console.log(`>> [postNormalize] ${normalizeResult}`);
return normalizeResult;}var _System$get2=System.get('@lively-env'),packageRegistry=_System$get2.packageRegistry;if(packageRegistry){var referencedPackage=packageRegistry.findPackageWithURL(base);if(referencedPackage){var main=(referencedPackage.main||'index.js').replace(dotSlashStartRe,'');var withMain=base.replace(trailingSlashRe,'')+'/'+main;// console.log(`>> [postNormalize] ${withMain} (main 1)`);
return withMain;}}else{if(base in System.packages){var main=System.packages[base].main;if(main){var withMain=base.replace(trailingSlashRe,'')+'/'+main.replace(dotSlashStartRe,'');// console.log(`>> [postNormalize] ${withMain} (main 2)`);
return withMain;}}}// Fix issue with accidentally adding .js
var jsonPath=normalizeResult.match(jsonJsExtRe);// if (!jsExtRe.test(normalizeResult) &&
//   !jsxExtRe.test(normalizeResult) &&
//   !jsonExtRe.test(normalizeResult) &&
//   !nodeModRe.test(normalizeResult) &&
//   !nodeExtRe.test(normalizeResult)) {
//   // make sure this is not a package name
//   normalizeResult += '.js';
// }
System.debug&&console.log(">> [postNormalize] ".concat(jsonPath?jsonPath[1]:normalizeResult));return jsonPath?jsonPath[1]:normalizeResult;}function checkExistence(_x76,_x77){return _checkExistence.apply(this,arguments);}function _checkExistence(){_checkExistence=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee95(url,System){var cache;return regeneratorRuntime.wrap(function _callee95$(_context95){while(1){switch(_context95.prev=_context95.next){case 0:System._fileCheckMap=System._fileCheckMap||{};if(!(url in System._fileCheckMap)){_context95.next=3;break;}return _context95.abrupt("return",System._fileCheckMap[url]);case 3:// first consult if this file has been cached by local storage before
cache=System._livelyModulesTranslationCache;_context95.t0=cache;if(!_context95.t0){_context95.next=9;break;}_context95.next=8;return cache.fetchStoredModuleSource(url);case 8:_context95.t0=_context95.sent;case 9:if(!_context95.t0){_context95.next=11;break;}return _context95.abrupt("return",System._fileCheckMap[url]=true);case 11:_context95.next=13;return resource(url).exists();case 13:return _context95.abrupt("return",System._fileCheckMap[url]=_context95.sent);case 14:case"end":return _context95.stop();}}},_callee95);}));return _checkExistence.apply(this,arguments);}function normalizeHook(_x78,_x79,_x80,_x81){return _normalizeHook.apply(this,arguments);}function _normalizeHook(){_normalizeHook=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee96(proceed,name,parent,parentAddress){var System,stage1,stage2,stage3,isNodePath,indexjs;return regeneratorRuntime.wrap(function _callee96$(_context96){while(1){switch(_context96.prev=_context96.next){case 0:if(!(parent&&name=='cjs')){_context96.next=2;break;}return _context96.abrupt("return",'cjs');case 2:System=this;stage1=preNormalize(System,name,parent);_context96.next=6;return proceed(stage1,parent,parentAddress);case 6:stage2=_context96.sent;stage3=postNormalize(System,stage2||stage1);isNodePath=stage3.startsWith('file:');System.debug&&console.log("[normalize] ".concat(name," => ").concat(stage3));if(!(// Make sure we did not ask for a js or jsx file in the initial query.
!jsExtRe.test(name)&&!jsxExtRe.test(name)&&// Make sure SystemJS has not yet resolved to a json or node module.
// If this happens, the resolution algorithm most likely has already
// figured out things and we assume that it has come up with a reasonable
// answer.
!jsonExtRe.test(stage3)&&!nodeModRe.test(stage3)&&!nodeExtRe.test(stage3)&&// Make sure that the module as not been loaded.
!(System.loads&&System.loads[stage3]))){_context96.next=36;break;}if(!jsExtRe.test(stage3)){_context96.next=27;break;}_context96.next=14;return checkExistence(stage3,System);case 14:if(!_context96.sent){_context96.next=16;break;}return _context96.abrupt("return",stage3);case 16:indexjs=stage3.replace('.js','/index.js');_context96.next=19;return checkExistence(indexjs,System);case 19:_context96.t0=_context96.sent;if(_context96.t0){_context96.next=22;break;}_context96.t0=!isNodePath;case 22:if(!_context96.t0){_context96.next=24;break;}return _context96.abrupt("return",indexjs);case 24:return _context96.abrupt("return",stage3.replace('.js','/index.node'));case 27:if(!(!stage3.includes('jspm.dev')&&stage3!='@empty')){_context96.next=36;break;}_context96.next=30;return checkExistence(stage3+'.js',System);case 30:if(!_context96.sent){_context96.next=32;break;}return _context96.abrupt("return",stage3+'.js');case 32:_context96.next=34;return checkExistence(stage3+'/index.js',System);case 34:if(!_context96.sent){_context96.next=36;break;}return _context96.abrupt("return",stage3+'/index.js');case 36:if(jsxJsExtRe.test(stage3))stage3=stage3.replace('.jsx.js','.jsx');return _context96.abrupt("return",stage3);case 38:case"end":return _context96.stop();}}},_callee96,this);}));return _normalizeHook.apply(this,arguments);}function decanonicalizeHook(proceed,name,parent,isPlugin){var plugin;// some jspm bullshit
if(name&&name.endsWith('!cjs')){name=name.replace('!cjs','');plugin='!cjs';}var System=this;var stage1=preNormalize(System,name,parent);var stage2=proceed(stage1,parent,isPlugin);var stage3=postNormalize(System,stage2);if(plugin)stage3+=plugin;System.debug&&console.log("[normalizeSync] ".concat(name," => ").concat(stage3));return stage3;}function locateHook(_x82,_x83){return _locateHook.apply(this,arguments);}function _locateHook(){_locateHook=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee97(proceed,load){var _load$name$split,_load$name$split2,url,plugin,res;return regeneratorRuntime.wrap(function _callee97$(_context97){while(1){switch(_context97.prev=_context97.next){case 0:// we only support loading of esm modules
// any plugins via the ! notation are ignored
_load$name$split=load.name.split('!'),_load$name$split2=_slicedToArray2(_load$name$split,2),url=_load$name$split2[0],plugin=_load$name$split2[1];load.name=url;_context97.next=4;return proceed(load);case 4:res=_context97.sent;return _context97.abrupt("return",res);case 6:case"end":return _context97.stop();}}},_callee97);}));return _locateHook.apply(this,arguments);}function normalize_doMapWithObject(mappedObject,pkg,loader){// SystemJS allows stuff like {events: {"node": "@node/events", "~node": "@empty"}}
// for conditional name lookups based on the environment. The resolution
// process in SystemJS is asynchronous, this one here synch. to support
// decanonicalize and a one-step-load
var env=loader.get(pkg.map['@env']||'@system-env');// first map condition to match is used
var resolved;for(var _e2 in mappedObject){var negate=_e2[0]=='~';var value=normalize_readMemberExpression(negate?_e2.substr(1):_e2,env);if(!negate&&value||negate&&!value){resolved=mappedObject[_e2];break;}}if(resolved){if(typeof resolved!=='string'){throw new Error('Unable to map a package conditional to a package conditional.');}}return resolved;// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function normalize_readMemberExpression(p,value){var pParts=p.split('.');while(pParts.length){value=value[pParts.shift()];}return value;}}function newModule_volatile(proceed,exports){var freeze=Object.freeze;Object.freeze=function(x){return x;};var m=proceed(exports);Object.freeze=freeze;return m;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// debugging
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function printSystemConfig(System){System=getSystem(System);var json={baseURL:System.baseURL,transpiler:System.transpiler,defaultJSExtensions:System.defaultJSExtensions,defaultExtension:System.defaultExtension,map:System.map,meta:System.meta,packages:System.packages,paths:System.paths,packageConfigPaths:System.packageConfigPaths,bundles:System.bundles};return JSON.stringify(json,null,2);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// on-load / import extensions
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function instantiate_triggerOnLoadCallbacks(proceed,load){var System=this;return proceed(load).then(function(result){// Wait until module is properly loaded, i.e. added to the System module cache.
// Then find those callbacks in System.get("@lively-env").onLoadCallbacks that
// resolve to the loaded module, trigger + remove them
var timeout={};// rms 18.11.20 fixme: replace with promise? this busy wait is a boon on performance
promise.waitFor(60*1000,function(){return System.get(load.name);},timeout).then(function(result){if(result===timeout){console.warn("[lively.modules] instantiate_triggerOnLoadCallbacks for ".concat(load.name," timed out"));return;}var modId=load.name;var mod=classHolder.module(System,modId);var callbacks=System.get('@lively-env').onLoadCallbacks;for(var _i101=callbacks.length;_i101--;){var _callbacks$_i=callbacks[_i101],moduleName=_callbacks$_i.moduleName,resolved=_callbacks$_i.resolved,callback=_callbacks$_i.callback;var _id3=resolved?moduleName:System.decanonicalize(moduleName);if(_id3!==modId)continue;callbacks.splice(_i101,1);try{callback(mod);}catch(e){console.error(e);}}emit('lively.modules/moduleloaded',{module:load.name},Date.now(),System);if(System._loadingIndicator){System._loadingIndicator.remove();System._loadingIndicator=null;}});return result;});}function whenLoaded(System,moduleName,callback){var modId=System.decanonicalize(moduleName);if(System.get(modId)){try{callback(classHolder.module(System,modId));}catch(e){console.error(e);}return;}System.get('@lively-env').onLoadCallbacks.push({moduleName:moduleName,resolved:false,callback:callback});}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// module state
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
function loadedModules(System){return System.get('@lively-env').loadedModules;}function knownModuleNames(System){var fromSystem=System.loads?Object.keys(System.loads):Object.keys(System._loader.moduleRecords);return uniq(fromSystem.concat(Object.keys(loadedModules(System))));}var e,t,n,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:global,o=e={};function i(){throw new Error("setTimeout has not been defined");}function u(){throw new Error("clearTimeout has not been defined");}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0);}catch(n){try{return t.call(null,e,0);}catch(n){return t.call(this||r,e,0);}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i;}catch(e){t=i;}try{n="function"==typeof clearTimeout?clearTimeout:u;}catch(e){n=u;}}();var l,s=[],f=!1,a=-1;function h(){f&&l&&(f=!1,l.length?s=l.concat(s):a=-1,s.length&&d());}function d(){if(!f){var e=c(h);f=!0;for(var t=s.length;t;){for(l=s,s=[];++a<t;){l&&l[a].run();}a=-1,t=s.length;}l=null,f=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===u||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e);}catch(t){try{return n.call(null,e);}catch(t){return n.call(this||r,e);}}}(e);}}function m(e,t){(this||r).fun=e,(this||r).array=t;}function p(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n];}s.push(new m(e,t)),1!==s.length||f||c(d);},m.prototype.run=function(){(this||r).fun.apply(null,(this||r).array);},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=p,o.addListener=p,o.once=p,o.off=p,o.removeListener=p,o.removeAllListeners=p,o.emit=p,o.prependListener=p,o.prependOnceListener=p,o.listeners=function(e){return[];},o.binding=function(e){throw new Error("process.binding is not supported");},o.cwd=function(){return"/";},o.chdir=function(e){throw new Error("process.chdir is not supported");},o.umask=function(){return 0;};var T=e;var addListener=T.addListener;var argv=T.argv;var binding=T.binding;var browser$1=T.browser;var chdir=T.chdir;var cwd=T.cwd;var emit$1=T.emit;var env$1=T.env;var listeners=T.listeners;var nextTick=T.nextTick;var off=T.off;var on=T.on;var once$1=T.once;var prependListener=T.prependListener;var prependOnceListener=T.prependOnceListener;var removeAllListeners=T.removeAllListeners;var removeListener=T.removeListener;var title=T.title;var umask=T.umask;var version$3=T.version;var versions=T.versions;var exports$5$1={},_dewExec$5=false;function dew$5(){if(_dewExec$5)return exports$5$1;_dewExec$5=true;// Note: this is the semver.org version of the spec that it implements
// Not necessarily the package version of this code.
var SEMVER_SPEC_VERSION="2.0.0";var MAX_LENGTH=256;var MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||/* istanbul ignore next */9007199254740991;// Max safe segment length for coercion.
var MAX_SAFE_COMPONENT_LENGTH=16;exports$5$1={SEMVER_SPEC_VERSION:SEMVER_SPEC_VERSION,MAX_LENGTH:MAX_LENGTH,MAX_SAFE_INTEGER:MAX_SAFE_INTEGER,MAX_SAFE_COMPONENT_LENGTH:MAX_SAFE_COMPONENT_LENGTH};return exports$5$1;}var exports$4$1={},_dewExec$4=false;function dew$4(){if(_dewExec$4)return exports$4$1;_dewExec$4=true;var process=T;var debug=_typeof2(process)==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var _console;for(var _len8=arguments.length,args=new Array(_len8),_key13=0;_key13<_len8;_key13++){args[_key13]=arguments[_key13];}return(_console=console).error.apply(_console,["SEMVER"].concat(args));}:function(){};exports$4$1=debug;return exports$4$1;}var exports$3$1={},_dewExec$3=false;function dew$3(){if(_dewExec$3)return exports$3$1;_dewExec$3=true;var _dew$=dew$5(),MAX_SAFE_COMPONENT_LENGTH=_dew$.MAX_SAFE_COMPONENT_LENGTH;var debug=dew$4();exports$3$1=exports$3$1={};// The actual regexps go on exports.re
var re=exports$3$1.re=[];var src=exports$3$1.src=[];var t=exports$3$1.t={};var R=0;var createToken=function createToken(name,value,isGlobal){var index=R++;debug(index,value);t[name]=index;src[index]=value;re[index]=new RegExp(value,isGlobal?"g":undefined);};// The following Regular Expressions can be used for tokenizing,
// validating, and parsing SemVer version strings.
// ## Numeric Identifier
// A single `0`, or a non-zero digit followed by zero or more digits.
createToken("NUMERICIDENTIFIER","0|[1-9]\\d*");createToken("NUMERICIDENTIFIERLOOSE","[0-9]+");// ## Non-numeric Identifier
// Zero or more digits, followed by a letter or hyphen, and then zero or
// more letters, digits, or hyphens.
createToken("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");// ## Main Version
// Three dot-separated numeric identifiers.
createToken("MAINVERSION","(".concat(src[t.NUMERICIDENTIFIER],")\\.")+"(".concat(src[t.NUMERICIDENTIFIER],")\\.")+"(".concat(src[t.NUMERICIDENTIFIER],")"));createToken("MAINVERSIONLOOSE","(".concat(src[t.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(src[t.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(src[t.NUMERICIDENTIFIERLOOSE],")"));// ## Pre-release Version Identifier
// A numeric identifier, or a non-numeric identifier.
createToken("PRERELEASEIDENTIFIER","(?:".concat(src[t.NUMERICIDENTIFIER],"|").concat(src[t.NONNUMERICIDENTIFIER],")"));createToken("PRERELEASEIDENTIFIERLOOSE","(?:".concat(src[t.NUMERICIDENTIFIERLOOSE],"|").concat(src[t.NONNUMERICIDENTIFIER],")"));// ## Pre-release Version
// Hyphen, followed by one or more dot-separated pre-release version
// identifiers.
createToken("PRERELEASE","(?:-(".concat(src[t.PRERELEASEIDENTIFIER],"(?:\\.").concat(src[t.PRERELEASEIDENTIFIER],")*))"));createToken("PRERELEASELOOSE","(?:-?(".concat(src[t.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(src[t.PRERELEASEIDENTIFIERLOOSE],")*))"));// ## Build Metadata Identifier
// Any combination of digits, letters, or hyphens.
createToken("BUILDIDENTIFIER","[0-9A-Za-z-]+");// ## Build Metadata
// Plus sign, followed by one or more period-separated build metadata
// identifiers.
createToken("BUILD","(?:\\+(".concat(src[t.BUILDIDENTIFIER],"(?:\\.").concat(src[t.BUILDIDENTIFIER],")*))"));// ## Full Version String
// A main version, followed optionally by a pre-release version and
// build metadata.
// Note that the only major, minor, patch, and pre-release sections of
// the version string are capturing groups.  The build metadata is not a
// capturing group, because it should not ever be used in version
// comparison.
createToken("FULLPLAIN","v?".concat(src[t.MAINVERSION]).concat(src[t.PRERELEASE],"?").concat(src[t.BUILD],"?"));createToken("FULL","^".concat(src[t.FULLPLAIN],"$"));// like full, but allows v1.2.3 and =1.2.3, which people do sometimes.
// also, 1.0.0alpha1 (prerelease without the hyphen) which is pretty
// common in the npm registry.
createToken("LOOSEPLAIN","[v=\\s]*".concat(src[t.MAINVERSIONLOOSE]).concat(src[t.PRERELEASELOOSE],"?").concat(src[t.BUILD],"?"));createToken("LOOSE","^".concat(src[t.LOOSEPLAIN],"$"));createToken("GTLT","((?:<|>)?=?)");// Something like "2.*" or "1.2.x".
// Note that "x.x" is a valid xRange identifer, meaning "any version"
// Only the first item is strictly required.
createToken("XRANGEIDENTIFIERLOOSE","".concat(src[t.NUMERICIDENTIFIERLOOSE],"|x|X|\\*"));createToken("XRANGEIDENTIFIER","".concat(src[t.NUMERICIDENTIFIER],"|x|X|\\*"));createToken("XRANGEPLAIN","[v=\\s]*(".concat(src[t.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(src[t.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(src[t.XRANGEIDENTIFIER],")")+"(?:".concat(src[t.PRERELEASE],")?").concat(src[t.BUILD],"?")+")?)?");createToken("XRANGEPLAINLOOSE","[v=\\s]*(".concat(src[t.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(src[t.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(src[t.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(src[t.PRERELEASELOOSE],")?").concat(src[t.BUILD],"?")+")?)?");createToken("XRANGE","^".concat(src[t.GTLT],"\\s*").concat(src[t.XRANGEPLAIN],"$"));createToken("XRANGELOOSE","^".concat(src[t.GTLT],"\\s*").concat(src[t.XRANGEPLAINLOOSE],"$"));// Coercion.
// Extract anything that could conceivably be a part of a valid semver
createToken("COERCE","".concat("(^|[^\\d])"+"(\\d{1,").concat(MAX_SAFE_COMPONENT_LENGTH,"})")+"(?:\\.(\\d{1,".concat(MAX_SAFE_COMPONENT_LENGTH,"}))?")+"(?:\\.(\\d{1,".concat(MAX_SAFE_COMPONENT_LENGTH,"}))?")+"(?:$|[^\\d])");createToken("COERCERTL",src[t.COERCE],true);// Tilde ranges.
// Meaning is "reasonably at or greater than"
createToken("LONETILDE","(?:~>?)");createToken("TILDETRIM","(\\s*)".concat(src[t.LONETILDE],"\\s+"),true);exports$3$1.tildeTrimReplace="$1~";createToken("TILDE","^".concat(src[t.LONETILDE]).concat(src[t.XRANGEPLAIN],"$"));createToken("TILDELOOSE","^".concat(src[t.LONETILDE]).concat(src[t.XRANGEPLAINLOOSE],"$"));// Caret ranges.
// Meaning is "at least and backwards compatible with"
createToken("LONECARET","(?:\\^)");createToken("CARETTRIM","(\\s*)".concat(src[t.LONECARET],"\\s+"),true);exports$3$1.caretTrimReplace="$1^";createToken("CARET","^".concat(src[t.LONECARET]).concat(src[t.XRANGEPLAIN],"$"));createToken("CARETLOOSE","^".concat(src[t.LONECARET]).concat(src[t.XRANGEPLAINLOOSE],"$"));// A simple gt/lt/eq thing, or just "" to indicate "any version"
createToken("COMPARATORLOOSE","^".concat(src[t.GTLT],"\\s*(").concat(src[t.LOOSEPLAIN],")$|^$"));createToken("COMPARATOR","^".concat(src[t.GTLT],"\\s*(").concat(src[t.FULLPLAIN],")$|^$"));// An expression to strip any whitespace between the gtlt and the thing
// it modifies, so that `> 1.2.3` ==> `>1.2.3`
createToken("COMPARATORTRIM","(\\s*)".concat(src[t.GTLT],"\\s*(").concat(src[t.LOOSEPLAIN],"|").concat(src[t.XRANGEPLAIN],")"),true);exports$3$1.comparatorTrimReplace="$1$2$3";// Something like `1.2.3 - 1.2.4`
// Note that these all use the loose form, because they'll be
// checked against either the strict or loose comparator form
// later.
createToken("HYPHENRANGE","^\\s*(".concat(src[t.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(src[t.XRANGEPLAIN],")")+"\\s*$");createToken("HYPHENRANGELOOSE","^\\s*(".concat(src[t.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(src[t.XRANGEPLAINLOOSE],")")+"\\s*$");// Star ranges basically just allow anything at all.
createToken("STAR","(<|>)?=?\\s*\\*");// >=0.0.0 is like a star
createToken("GTE0","^\\s*>=\\s*0.0.0\\s*$");createToken("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$");return exports$3$1;}var exports$2$4={},_dewExec$2=false;function dew$2(){if(_dewExec$2)return exports$2$4;_dewExec$2=true;// parse out just the options we care about so we always get a consistent
// obj with keys in a consistent order.
var opts=["includePrerelease","loose","rtl"];var parseOptions=function parseOptions(options){return!options?{}:_typeof2(options)!=="object"?{loose:true}:opts.filter(function(k){return options[k];}).reduce(function(options,k){options[k]=true;return options;},{});};exports$2$4=parseOptions;return exports$2$4;}var exports$1$7={},_dewExec$1=false;function dew$1(){if(_dewExec$1)return exports$1$7;_dewExec$1=true;var numeric=/^[0-9]+$/;var compareIdentifiers=function compareIdentifiers(a,b){var anum=numeric.test(a);var bnum=numeric.test(b);if(anum&&bnum){a=+a;b=+b;}return a===b?0:anum&&!bnum?-1:bnum&&!anum?1:a<b?-1:1;};var rcompareIdentifiers=function rcompareIdentifiers(a,b){return compareIdentifiers(b,a);};exports$1$7={compareIdentifiers:compareIdentifiers,rcompareIdentifiers:rcompareIdentifiers};return exports$1$7;}var exports$g={},_dewExec=false;function dew(){if(_dewExec)return exports$g;_dewExec=true;var debug=dew$4();var _dew$2=dew$5(),MAX_LENGTH=_dew$2.MAX_LENGTH,MAX_SAFE_INTEGER=_dew$2.MAX_SAFE_INTEGER;var _dew$3=dew$3(),re=_dew$3.re,t=_dew$3.t;var parseOptions=dew$2();var _dew$4=dew$1(),compareIdentifiers=_dew$4.compareIdentifiers;var SemVer=/*#__PURE__*/function(){function SemVer(version,options){_classCallCheck(this,SemVer);options=parseOptions(options);if(version instanceof SemVer){if(version.loose===!!options.loose&&version.includePrerelease===!!options.includePrerelease){return version;}else{version=version.version;}}else if(typeof version!=="string"){throw new TypeError("Invalid Version: ".concat(version));}if(version.length>MAX_LENGTH){throw new TypeError("version is longer than ".concat(MAX_LENGTH," characters"));}debug("SemVer",version,options);this.options=options;this.loose=!!options.loose;// this isn't actually relevant for versions, but keep it so that we
// don't run into trouble passing this.options around.
this.includePrerelease=!!options.includePrerelease;var m=version.trim().match(options.loose?re[t.LOOSE]:re[t.FULL]);if(!m){throw new TypeError("Invalid Version: ".concat(version));}this.raw=version;// these are actually numbers
this.major=+m[1];this.minor=+m[2];this.patch=+m[3];if(this.major>MAX_SAFE_INTEGER||this.major<0){throw new TypeError("Invalid major version");}if(this.minor>MAX_SAFE_INTEGER||this.minor<0){throw new TypeError("Invalid minor version");}if(this.patch>MAX_SAFE_INTEGER||this.patch<0){throw new TypeError("Invalid patch version");}// numberify any prerelease numeric ids
if(!m[4]){this.prerelease=[];}else{this.prerelease=m[4].split(".").map(function(id){if(/^[0-9]+$/.test(id)){var _num=+id;if(_num>=0&&_num<MAX_SAFE_INTEGER){return _num;}}return id;});}this.build=m[5]?m[5].split("."):[];this.format();}_createClass(SemVer,[{key:"format",value:function format(){this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch);if(this.prerelease.length){this.version+="-".concat(this.prerelease.join("."));}return this.version;}},{key:"toString",value:function toString(){return this.version;}},{key:"compare",value:function compare(other){debug("SemVer.compare",this.version,this.options,other);if(!(other instanceof SemVer)){if(typeof other==="string"&&other===this.version){return 0;}other=new SemVer(other,this.options);}if(other.version===this.version){return 0;}return this.compareMain(other)||this.comparePre(other);}},{key:"compareMain",value:function compareMain(other){if(!(other instanceof SemVer)){other=new SemVer(other,this.options);}return compareIdentifiers(this.major,other.major)||compareIdentifiers(this.minor,other.minor)||compareIdentifiers(this.patch,other.patch);}},{key:"comparePre",value:function comparePre(other){if(!(other instanceof SemVer)){other=new SemVer(other,this.options);}// NOT having a prerelease is > having one
if(this.prerelease.length&&!other.prerelease.length){return-1;}else if(!this.prerelease.length&&other.prerelease.length){return 1;}else if(!this.prerelease.length&&!other.prerelease.length){return 0;}var i=0;do{var _a=this.prerelease[i];var b=other.prerelease[i];debug("prerelease compare",i,_a,b);if(_a===undefined&&b===undefined){return 0;}else if(b===undefined){return 1;}else if(_a===undefined){return-1;}else if(_a===b){continue;}else{return compareIdentifiers(_a,b);}}while(++i);}},{key:"compareBuild",value:function compareBuild(other){if(!(other instanceof SemVer)){other=new SemVer(other,this.options);}var i=0;do{var _a2=this.build[i];var b=other.build[i];debug("prerelease compare",i,_a2,b);if(_a2===undefined&&b===undefined){return 0;}else if(b===undefined){return 1;}else if(_a2===undefined){return-1;}else if(_a2===b){continue;}else{return compareIdentifiers(_a2,b);}}while(++i);}// preminor will bump the version up to the next minor release, and immediately
// down to pre-release. premajor and prepatch work the same way.
},{key:"inc",value:function inc(release,identifier){switch(release){case"premajor":this.prerelease.length=0;this.patch=0;this.minor=0;this.major++;this.inc("pre",identifier);break;case"preminor":this.prerelease.length=0;this.patch=0;this.minor++;this.inc("pre",identifier);break;case"prepatch":// If this is already a prerelease, it will bump to the next version
// drop any prereleases that might already exist, since they are not
// relevant at this point.
this.prerelease.length=0;this.inc("patch",identifier);this.inc("pre",identifier);break;// If the input is a non-prerelease version, this acts the same as
// prepatch.
case"prerelease":if(this.prerelease.length===0){this.inc("patch",identifier);}this.inc("pre",identifier);break;case"major":// If this is a pre-major version, bump up to the same major version.
// Otherwise increment major.
// 1.0.0-5 bumps to 1.0.0
// 1.1.0 bumps to 2.0.0
if(this.minor!==0||this.patch!==0||this.prerelease.length===0){this.major++;}this.minor=0;this.patch=0;this.prerelease=[];break;case"minor":// If this is a pre-minor version, bump up to the same minor version.
// Otherwise increment minor.
// 1.2.0-5 bumps to 1.2.0
// 1.2.1 bumps to 1.3.0
if(this.patch!==0||this.prerelease.length===0){this.minor++;}this.patch=0;this.prerelease=[];break;case"patch":// If this is not a pre-release version, it will increment the patch.
// If it is a pre-release it will bump up to the same patch version.
// 1.2.0-5 patches to 1.2.0
// 1.2.0 patches to 1.2.1
if(this.prerelease.length===0){this.patch++;}this.prerelease=[];break;// This probably shouldn't be used publicly.
// 1.0.0 'pre' would become 1.0.0-0 which is the wrong direction.
case"pre":if(this.prerelease.length===0){this.prerelease=[0];}else{var _i102=this.prerelease.length;while(--_i102>=0){if(typeof this.prerelease[_i102]==="number"){this.prerelease[_i102]++;_i102=-2;}}if(_i102===-1){// didn't increment anything
this.prerelease.push(0);}}if(identifier){// 1.2.0-beta.1 bumps to 1.2.0-beta.2,
// 1.2.0-beta.fooblz or 1.2.0-beta bumps to 1.2.0-beta.0
if(this.prerelease[0]===identifier){if(isNaN(this.prerelease[1])){this.prerelease=[identifier,0];}}else{this.prerelease=[identifier,0];}}break;default:throw new Error("invalid increment argument: ".concat(release));}this.format();this.raw=this.version;return this;}}]);return SemVer;}();exports$g=SemVer;return exports$g;}var exports$h={},_dewExec$6=false;function dew$6(){if(_dewExec$6)return exports$h;_dewExec$6=true;var _dew$5=dew$5(),MAX_LENGTH=_dew$5.MAX_LENGTH;var _dew$6=dew$3(),re=_dew$6.re,t=_dew$6.t;var SemVer=dew();var parseOptions=dew$2();var parse=function parse(version,options){options=parseOptions(options);if(version instanceof SemVer){return version;}if(typeof version!=="string"){return null;}if(version.length>MAX_LENGTH){return null;}var r=options.loose?re[t.LOOSE]:re[t.FULL];if(!r.test(version)){return null;}try{return new SemVer(version,options);}catch(er){return null;}};exports$h=parse;return exports$h;}var exports$i={},_dewExec$7=false;function dew$7(){if(_dewExec$7)return exports$i;_dewExec$7=true;var parse=dew$6();var valid=function valid(version,options){var v=parse(version,options);return v?v.version:null;};exports$i=valid;return exports$i;}var exports$j={},_dewExec$8=false;function dew$8(){if(_dewExec$8)return exports$j;_dewExec$8=true;var SemVer=dew();var inc=function inc(version,release,options,identifier){if(typeof options==="string"){identifier=options;options=undefined;}try{return new SemVer(version,options).inc(release,identifier).version;}catch(er){return null;}};exports$j=inc;return exports$j;}var exports$k={},_dewExec$9=false;function dew$9(){if(_dewExec$9)return exports$k;_dewExec$9=true;var SemVer=dew();var compare=function compare(a,b,loose){return new SemVer(a,loose).compare(new SemVer(b,loose));};exports$k=compare;return exports$k;}var exports$l={},_dewExec$a=false;function dew$a(){if(_dewExec$a)return exports$l;_dewExec$a=true;var compare=dew$9();var eq=function eq(a,b,loose){return compare(a,b,loose)===0;};exports$l=eq;return exports$l;}var exports$m={},_dewExec$b=false;function dew$b(){if(_dewExec$b)return exports$m;_dewExec$b=true;var SemVer=dew();var major=function major(a,loose){return new SemVer(a,loose).major;};exports$m=major;return exports$m;}var exports$n={},_dewExec$c=false;function dew$c(){if(_dewExec$c)return exports$n;_dewExec$c=true;var parse=dew$6();var prerelease=function prerelease(version,options){var parsed=parse(version,options);return parsed&&parsed.prerelease.length?parsed.prerelease:null;};exports$n=prerelease;return exports$n;}var exports$o={},_dewExec$d=false;function dew$d(){if(_dewExec$d)return exports$o;_dewExec$d=true;var compare=dew$9();var rcompare=function rcompare(a,b,loose){return compare(b,a,loose);};exports$o=rcompare;return exports$o;}var exports$1$8={},_dewExec$1$1=false;function dew$1$1(){if(_dewExec$1$1)return exports$1$8;_dewExec$1$1=true;var SemVer=dew();var compareBuild=function compareBuild(a,b,loose){var versionA=new SemVer(a,loose);var versionB=new SemVer(b,loose);return versionA.compare(versionB)||versionA.compareBuild(versionB);};exports$1$8=compareBuild;return exports$1$8;}var exports$p={},_dewExec$e=false;function dew$e(){if(_dewExec$e)return exports$p;_dewExec$e=true;var compareBuild=dew$1$1();var rsort=function rsort(list,loose){return list.sort(function(a,b){return compareBuild(b,a,loose);});};exports$p=rsort;return exports$p;}var exports$q={},_dewExec$f=false;function dew$f(){if(_dewExec$f)return exports$q;_dewExec$f=true;var compare=dew$9();var gt=function gt(a,b,loose){return compare(a,b,loose)>0;};exports$q=gt;return exports$q;}var exports$r={},_dewExec$g=false;function dew$g(){if(_dewExec$g)return exports$r;_dewExec$g=true;var compare=dew$9();var lt=function lt(a,b,loose){return compare(a,b,loose)<0;};exports$r=lt;return exports$r;}var exports$s={},_dewExec$h=false;function dew$h(){if(_dewExec$h)return exports$s;_dewExec$h=true;var compare=dew$9();var gte=function gte(a,b,loose){return compare(a,b,loose)>=0;};exports$s=gte;return exports$s;}var exports$2$5={},_dewExec$2$1=false;function dew$2$1(){if(_dewExec$2$1)return exports$2$5;_dewExec$2$1=true;var compare=dew$9();var neq=function neq(a,b,loose){return compare(a,b,loose)!==0;};exports$2$5=neq;return exports$2$5;}var exports$1$9={},_dewExec$1$2=false;function dew$1$2(){if(_dewExec$1$2)return exports$1$9;_dewExec$1$2=true;var compare=dew$9();var lte=function lte(a,b,loose){return compare(a,b,loose)<=0;};exports$1$9=lte;return exports$1$9;}var exports$t={},_dewExec$i=false;function dew$i(){if(_dewExec$i)return exports$t;_dewExec$i=true;var eq=dew$a();var neq=dew$2$1();var gt=dew$f();var gte=dew$h();var lt=dew$g();var lte=dew$1$2();var cmp=function cmp(a,op,b,loose){switch(op){case"===":if(_typeof2(a)==="object")a=a.version;if(_typeof2(b)==="object")b=b.version;return a===b;case"!==":if(_typeof2(a)==="object")a=a.version;if(_typeof2(b)==="object")b=b.version;return a!==b;case"":case"=":case"==":return eq(a,b,loose);case"!=":return neq(a,b,loose);case">":return gt(a,b,loose);case">=":return gte(a,b,loose);case"<":return lt(a,b,loose);case"<=":return lte(a,b,loose);default:throw new TypeError("Invalid operator: ".concat(op));}};exports$t=cmp;return exports$t;}var exports$u={},_dewExec$j=false;function dew$j(){if(_dewExec$j)return exports$u;_dewExec$j=true;var SemVer=dew();var parse=dew$6();var _dew$7=dew$3(),re=_dew$7.re,t=_dew$7.t;var coerce=function coerce(version,options){if(version instanceof SemVer){return version;}if(typeof version==="number"){version=String(version);}if(typeof version!=="string"){return null;}options=options||{};var match=null;if(!options.rtl){match=version.match(re[t.COERCE]);}else{// Find the right-most coercible string that does not share
// a terminus with a more left-ward coercible string.
// Eg, '1.2.3.4' wants to coerce '2.3.4', not '3.4' or '4'
//
// Walk through the string checking with a /g regexp
// Manually set the index so as to pick up overlapping matches.
// Stop when we get a match that ends at the string end, since no
// coercible string can be more right-ward without the same terminus.
var next;while((next=re[t.COERCERTL].exec(version))&&(!match||match.index+match[0].length!==version.length)){if(!match||next.index+next[0].length!==match.index+match[0].length){match=next;}re[t.COERCERTL].lastIndex=next.index+next[1].length+next[2].length;}// leave it in a clean state
re[t.COERCERTL].lastIndex=-1;}if(match===null)return null;return parse("".concat(match[2],".").concat(match[3]||"0",".").concat(match[4]||"0"),options);};exports$u=coerce;return exports$u;}var exports$v={};exports$v=function exports$v(Yallist){Yallist.prototype[Symbol.iterator]=/*#__PURE__*/regeneratorRuntime.mark(function _callee79(){var walker;return regeneratorRuntime.wrap(function _callee79$(_context79){while(1){switch(_context79.prev=_context79.next){case 0:walker=this.head;case 1:if(!walker){_context79.next=7;break;}_context79.next=4;return walker.value;case 4:walker=walker.next;_context79.next=1;break;case 7:case"end":return _context79.stop();}}},_callee79,this);});};var _iterator=exports$v;var exports$1$a={};exports$1$a=Yallist;Yallist.Node=Node$3;Yallist.create=Yallist;function Yallist(list){var self=this;if(!(self instanceof Yallist)){self=new Yallist();}self.tail=null;self.head=null;self.length=0;if(list&&typeof list.forEach==="function"){list.forEach(function(item){self.push(item);});}else if(arguments.length>0){for(var i=0,l=arguments.length;i<l;i++){self.push(arguments[i]);}}return self;}Yallist.prototype.removeNode=function(node){if(node.list!==this){throw new Error("removing node which does not belong to this list");}var next=node.next;var prev=node.prev;if(next){next.prev=prev;}if(prev){prev.next=next;}if(node===this.head){this.head=next;}if(node===this.tail){this.tail=prev;}node.list.length--;node.next=null;node.prev=null;node.list=null;return next;};Yallist.prototype.unshiftNode=function(node){if(node===this.head){return;}if(node.list){node.list.removeNode(node);}var head=this.head;node.list=this;node.next=head;if(head){head.prev=node;}this.head=node;if(!this.tail){this.tail=node;}this.length++;};Yallist.prototype.pushNode=function(node){if(node===this.tail){return;}if(node.list){node.list.removeNode(node);}var tail=this.tail;node.list=this;node.prev=tail;if(tail){tail.next=node;}this.tail=node;if(!this.head){this.head=node;}this.length++;};Yallist.prototype.push=function(){for(var i=0,l=arguments.length;i<l;i++){push(this,arguments[i]);}return this.length;};Yallist.prototype.unshift=function(){for(var i=0,l=arguments.length;i<l;i++){unshift(this,arguments[i]);}return this.length;};Yallist.prototype.pop=function(){if(!this.tail){return undefined;}var res=this.tail.value;this.tail=this.tail.prev;if(this.tail){this.tail.next=null;}else{this.head=null;}this.length--;return res;};Yallist.prototype.shift=function(){if(!this.head){return undefined;}var res=this.head.value;this.head=this.head.next;if(this.head){this.head.prev=null;}else{this.tail=null;}this.length--;return res;};Yallist.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=this.head,i=0;walker!==null;i++){fn.call(thisp,walker.value,i,this);walker=walker.next;}};Yallist.prototype.forEachReverse=function(fn,thisp){thisp=thisp||this;for(var walker=this.tail,i=this.length-1;walker!==null;i--){fn.call(thisp,walker.value,i,this);walker=walker.prev;}};Yallist.prototype.get=function(n){for(var i=0,walker=this.head;walker!==null&&i<n;i++){// abort out of the list early if we hit a cycle
walker=walker.next;}if(i===n&&walker!==null){return walker.value;}};Yallist.prototype.getReverse=function(n){for(var i=0,walker=this.tail;walker!==null&&i<n;i++){// abort out of the list early if we hit a cycle
walker=walker.prev;}if(i===n&&walker!==null){return walker.value;}};Yallist.prototype.map=function(fn,thisp){thisp=thisp||this;var res=new Yallist();for(var walker=this.head;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.next;}return res;};Yallist.prototype.mapReverse=function(fn,thisp){thisp=thisp||this;var res=new Yallist();for(var walker=this.tail;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.prev;}return res;};Yallist.prototype.reduce=function(fn,initial){var acc;var walker=this.head;if(arguments.length>1){acc=initial;}else if(this.head){walker=this.head.next;acc=this.head.value;}else{throw new TypeError("Reduce of empty list with no initial value");}for(var i=0;walker!==null;i++){acc=fn(acc,walker.value,i);walker=walker.next;}return acc;};Yallist.prototype.reduceReverse=function(fn,initial){var acc;var walker=this.tail;if(arguments.length>1){acc=initial;}else if(this.tail){walker=this.tail.prev;acc=this.tail.value;}else{throw new TypeError("Reduce of empty list with no initial value");}for(var i=this.length-1;walker!==null;i--){acc=fn(acc,walker.value,i);walker=walker.prev;}return acc;};Yallist.prototype.toArray=function(){var arr=new Array(this.length);for(var i=0,walker=this.head;walker!==null;i++){arr[i]=walker.value;walker=walker.next;}return arr;};Yallist.prototype.toArrayReverse=function(){var arr=new Array(this.length);for(var i=0,walker=this.tail;walker!==null;i++){arr[i]=walker.value;walker=walker.prev;}return arr;};Yallist.prototype.slice=function(from,to){to=to||this.length;if(to<0){to+=this.length;}from=from||0;if(from<0){from+=this.length;}var ret=new Yallist();if(to<from||to<0){return ret;}if(from<0){from=0;}if(to>this.length){to=this.length;}for(var i=0,walker=this.head;walker!==null&&i<from;i++){walker=walker.next;}for(;walker!==null&&i<to;i++,walker=walker.next){ret.push(walker.value);}return ret;};Yallist.prototype.sliceReverse=function(from,to){to=to||this.length;if(to<0){to+=this.length;}from=from||0;if(from<0){from+=this.length;}var ret=new Yallist();if(to<from||to<0){return ret;}if(from<0){from=0;}if(to>this.length){to=this.length;}for(var i=this.length,walker=this.tail;walker!==null&&i>to;i--){walker=walker.prev;}for(;walker!==null&&i>from;i--,walker=walker.prev){ret.push(walker.value);}return ret;};Yallist.prototype.splice=function(start,deleteCount){if(start>this.length){start=this.length-1;}if(start<0){start=this.length+start;}for(var i=0,walker=this.head;walker!==null&&i<start;i++){walker=walker.next;}var ret=[];for(var i=0;walker&&i<deleteCount;i++){ret.push(walker.value);walker=this.removeNode(walker);}if(walker===null){walker=this.tail;}if(walker!==this.head&&walker!==this.tail){walker=walker.prev;}for(var i=0;i<(arguments.length<=2?0:arguments.length-2);i++){walker=insert(this,walker,i+2<2||arguments.length<=i+2?undefined:arguments[i+2]);}return ret;};Yallist.prototype.reverse=function(){var head=this.head;var tail=this.tail;for(var walker=head;walker!==null;walker=walker.prev){var p=walker.prev;walker.prev=walker.next;walker.next=p;}this.head=tail;this.tail=head;return this;};function insert(self,node,value){var inserted=node===self.head?new Node$3(value,null,node,self):new Node$3(value,node,node.next,self);if(inserted.next===null){self.tail=inserted;}if(inserted.prev===null){self.head=inserted;}self.length++;return inserted;}function push(self,item){self.tail=new Node$3(item,self.tail,null,self);if(!self.head){self.head=self.tail;}self.length++;}function unshift(self,item){self.head=new Node$3(item,null,self.head,self);if(!self.tail){self.tail=self.head;}self.length++;}function Node$3(value,prev,next,list){if(!(this instanceof Node$3)){return new Node$3(value,prev,next,list);}this.list=list;this.value=value;if(prev){prev.next=this;this.prev=prev;}else{this.prev=null;}if(next){next.prev=this;this.next=next;}else{this.next=null;}}try{// add if support for Symbol.iterator is present
_iterator(Yallist);}catch(er){}var exports$2$6=exports$1$a;var exports$w={};// A linked list to keep track of recently-used-ness
var Yallist$1=exports$2$6;var MAX=Symbol("max");var LENGTH=Symbol("length");var LENGTH_CALCULATOR=Symbol("lengthCalculator");var ALLOW_STALE=Symbol("allowStale");var MAX_AGE=Symbol("maxAge");var DISPOSE=Symbol("dispose");var NO_DISPOSE_ON_SET=Symbol("noDisposeOnSet");var LRU_LIST=Symbol("lruList");var CACHE=Symbol("cache");var UPDATE_AGE_ON_GET=Symbol("updateAgeOnGet");var naiveLength=function naiveLength(){return 1;};// lruList is a yallist where the head is the youngest
// item, and the tail is the oldest.  the list contains the Hit
// objects as the entries.
// Each Hit object has a reference to its Yallist.Node.  This
// never changes.
//
// cache is a Map (or PseudoMap) that matches the keys to
// the Yallist.Node object.
var LRUCache=/*#__PURE__*/function(){function LRUCache(options){_classCallCheck(this,LRUCache);if(typeof options==="number")options={max:options};if(!options)options={};if(options.max&&(typeof options.max!=="number"||options.max<0))throw new TypeError("max must be a non-negative number");// Kind of weird to have a default max of Infinity, but oh well.
var max=this[MAX]=options.max||Infinity;var lc=options.length||naiveLength;this[LENGTH_CALCULATOR]=typeof lc!=="function"?naiveLength:lc;this[ALLOW_STALE]=options.stale||false;if(options.maxAge&&typeof options.maxAge!=="number")throw new TypeError("maxAge must be a number");this[MAX_AGE]=options.maxAge||0;this[DISPOSE]=options.dispose;this[NO_DISPOSE_ON_SET]=options.noDisposeOnSet||false;this[UPDATE_AGE_ON_GET]=options.updateAgeOnGet||false;this.reset();}// resize the cache when the max changes.
_createClass(LRUCache,[{key:"rforEach",value:function rforEach(fn,thisp){thisp=thisp||this;for(var walker=this[LRU_LIST].tail;walker!==null;){var prev=walker.prev;forEachStep(this,fn,walker,thisp);walker=prev;}}},{key:"forEach",value:function forEach(fn,thisp){thisp=thisp||this;for(var walker=this[LRU_LIST].head;walker!==null;){var next=walker.next;forEachStep(this,fn,walker,thisp);walker=next;}}},{key:"keys",value:function keys(){return this[LRU_LIST].toArray().map(function(k){return k.key;});}},{key:"values",value:function values(){return this[LRU_LIST].toArray().map(function(k){return k.value;});}},{key:"reset",value:function reset(){var _this29=this;if(this[DISPOSE]&&this[LRU_LIST]&&this[LRU_LIST].length){this[LRU_LIST].forEach(function(hit){return _this29[DISPOSE](hit.key,hit.value);});}this[CACHE]=new Map();// hash of items by key
this[LRU_LIST]=new Yallist$1();// list of items in order of use recency
this[LENGTH]=0;// length of items in the list
}},{key:"dump",value:function dump(){var _this30=this;return this[LRU_LIST].map(function(hit){return isStale(_this30,hit)?false:{k:hit.key,v:hit.value,e:hit.now+(hit.maxAge||0)};}).toArray().filter(function(h){return h;});}},{key:"dumpLru",value:function dumpLru(){return this[LRU_LIST];}},{key:"set",value:function set(key,value,maxAge){maxAge=maxAge||this[MAX_AGE];if(maxAge&&typeof maxAge!=="number")throw new TypeError("maxAge must be a number");var now=maxAge?Date.now():0;var len=this[LENGTH_CALCULATOR](value,key);if(this[CACHE].has(key)){if(len>this[MAX]){_del(this,this[CACHE].get(key));return false;}var node=this[CACHE].get(key);var item=node.value;// dispose of the old one before overwriting
// split out into 2 ifs for better coverage tracking
if(this[DISPOSE]){if(!this[NO_DISPOSE_ON_SET])this[DISPOSE](key,item.value);}item.now=now;item.maxAge=maxAge;item.value=value;this[LENGTH]+=len-item.length;item.length=len;this.get(key);trim(this);return true;}var hit=new Entry(key,value,len,now,maxAge);// oversized objects fall out of cache automatically.
if(hit.length>this[MAX]){if(this[DISPOSE])this[DISPOSE](key,value);return false;}this[LENGTH]+=hit.length;this[LRU_LIST].unshift(hit);this[CACHE].set(key,this[LRU_LIST].head);trim(this);return true;}},{key:"has",value:function has(key){if(!this[CACHE].has(key))return false;var hit=this[CACHE].get(key).value;return!isStale(this,hit);}},{key:"get",value:function get(key){return _get3(this,key,true);}},{key:"peek",value:function peek(key){return _get3(this,key,false);}},{key:"pop",value:function pop(){var node=this[LRU_LIST].tail;if(!node)return null;_del(this,node);return node.value;}},{key:"del",value:function del(key){_del(this,this[CACHE].get(key));}},{key:"load",value:function load(arr){// reset the cache
this.reset();var now=Date.now();// A previous serialized cache has the most recent items first
for(var _l=arr.length-1;_l>=0;_l--){var hit=arr[_l];var expiresAt=hit.e||0;if(expiresAt===0)// the item was created without expiration in a non aged cache
this.set(hit.k,hit.v);else{var maxAge=expiresAt-now;// dont add already expired items
if(maxAge>0){this.set(hit.k,hit.v,maxAge);}}}}},{key:"prune",value:function prune(){var _this31=this;this[CACHE].forEach(function(value,key){return _get3(_this31,key,false);});}},{key:"max",set:function set(mL){if(typeof mL!=="number"||mL<0)throw new TypeError("max must be a non-negative number");this[MAX]=mL||Infinity;trim(this);},get:function get(){return this[MAX];}},{key:"allowStale",set:function set(allowStale){this[ALLOW_STALE]=!!allowStale;},get:function get(){return this[ALLOW_STALE];}},{key:"maxAge",set:function set(mA){if(typeof mA!=="number")throw new TypeError("maxAge must be a non-negative number");this[MAX_AGE]=mA;trim(this);},get:function get(){return this[MAX_AGE];}// resize the cache when the lengthCalculator changes.
},{key:"lengthCalculator",set:function set(lC){var _this32=this;if(typeof lC!=="function")lC=naiveLength;if(lC!==this[LENGTH_CALCULATOR]){this[LENGTH_CALCULATOR]=lC;this[LENGTH]=0;this[LRU_LIST].forEach(function(hit){hit.length=_this32[LENGTH_CALCULATOR](hit.value,hit.key);_this32[LENGTH]+=hit.length;});}trim(this);},get:function get(){return this[LENGTH_CALCULATOR];}},{key:"length",get:function get(){return this[LENGTH];}},{key:"itemCount",get:function get(){return this[LRU_LIST].length;}}]);return LRUCache;}();var _get3=function _get3(self,key,doUse){var node=self[CACHE].get(key);if(node){var hit=node.value;if(isStale(self,hit)){_del(self,node);if(!self[ALLOW_STALE])return undefined;}else{if(doUse){if(self[UPDATE_AGE_ON_GET])node.value.now=Date.now();self[LRU_LIST].unshiftNode(node);}}return hit.value;}};var isStale=function isStale(self,hit){if(!hit||!hit.maxAge&&!self[MAX_AGE])return false;var diff=Date.now()-hit.now;return hit.maxAge?diff>hit.maxAge:self[MAX_AGE]&&diff>self[MAX_AGE];};var trim=function trim(self){if(self[LENGTH]>self[MAX]){for(var walker=self[LRU_LIST].tail;self[LENGTH]>self[MAX]&&walker!==null;){// We know that we're about to delete this one, and also
// what the next least recently used key will be, so just
// go ahead and set it now.
var prev=walker.prev;_del(self,walker);walker=prev;}}};var _del=function _del(self,node){if(node){var hit=node.value;if(self[DISPOSE])self[DISPOSE](hit.key,hit.value);self[LENGTH]-=hit.length;self[CACHE]["delete"](hit.key);self[LRU_LIST].removeNode(node);}};var Entry=function Entry(key,value,length,now,maxAge){_classCallCheck(this,Entry);this.key=key;this.value=value;this.length=length;this.now=now;this.maxAge=maxAge||0;};var forEachStep=function forEachStep(self,fn,node,thisp){var hit=node.value;if(isStale(self,hit)){_del(self,node);if(!self[ALLOW_STALE])hit=undefined;}if(hit)fn.call(thisp,hit.value,hit.key,self);};exports$w=LRUCache;var exports$1$b=exports$w;var _lruCache2=/*#__PURE__*/Object.freeze({__proto__:null,'default':exports$1$b});var _lruCache="default"in _lruCache2?exports$1$b:_lruCache2;var exports$1$c={},_dewExec$1$3=false;function dew$1$3(){if(_dewExec$1$3)return exports$1$c;_dewExec$1$3=true;// hoisted class for cyclic dependency
var Range=/*#__PURE__*/function(){function Range(range,options){var _this33=this;_classCallCheck(this,Range);options=parseOptions(options);if(range instanceof Range){if(range.loose===!!options.loose&&range.includePrerelease===!!options.includePrerelease){return range;}else{return new Range(range.raw,options);}}if(range instanceof Comparator){// just put it in the set and return
this.raw=range.value;this.set=[[range]];this.format();return this;}this.options=options;this.loose=!!options.loose;this.includePrerelease=!!options.includePrerelease;// First, split based on boolean or ||
this.raw=range;this.set=range.split(/\s*\|\|\s*/)// map the range to a 2d array of comparators
.map(function(range){return _this33.parseRange(range.trim());})// throw out any comparator lists that are empty
// this generally means that it was not a valid range, which is allowed
// in loose mode, but will still throw if the WHOLE range is invalid.
.filter(function(c){return c.length;});if(!this.set.length){throw new TypeError("Invalid SemVer Range: ".concat(range));}// if we have any that are not the null set, throw out null sets.
if(this.set.length>1){// keep the first one, in case they're all null sets
var _first=this.set[0];this.set=this.set.filter(function(c){return!isNullSet(c[0]);});if(this.set.length===0)this.set=[_first];else if(this.set.length>1){// if we have any that are *, then the range is just *
var _iterator34=_createForOfIteratorHelper(this.set),_step34;try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){var _c4=_step34.value;if(_c4.length===1&&isAny(_c4[0])){this.set=[_c4];break;}}}catch(err){_iterator34.e(err);}finally{_iterator34.f();}}}this.format();}_createClass(Range,[{key:"format",value:function format(){this.range=this.set.map(function(comps){return comps.join(" ").trim();}).join("||").trim();return this.range;}},{key:"toString",value:function toString(){return this.range;}},{key:"parseRange",value:function parseRange(range){var _this34=this;range=range.trim();// memoize range parsing for performance.
// this is a very hot path, and fully deterministic.
var memoOpts=Object.keys(this.options).join(",");var memoKey="parseRange:".concat(memoOpts,":").concat(range);var cached=cache.get(memoKey);if(cached)return cached;var loose=this.options.loose;// `1.2.3 - 1.2.4` => `>=1.2.3 <=1.2.4`
var hr=loose?re[t.HYPHENRANGELOOSE]:re[t.HYPHENRANGE];range=range.replace(hr,hyphenReplace(this.options.includePrerelease));debug("hyphen replace",range);// `> 1.2.3 < 1.2.5` => `>1.2.3 <1.2.5`
range=range.replace(re[t.COMPARATORTRIM],comparatorTrimReplace);debug("comparator trim",range,re[t.COMPARATORTRIM]);// `~ 1.2.3` => `~1.2.3`
range=range.replace(re[t.TILDETRIM],tildeTrimReplace);// `^ 1.2.3` => `^1.2.3`
range=range.replace(re[t.CARETTRIM],caretTrimReplace);// normalize spaces
range=range.split(/\s+/).join(" ");// At this point, the range is completely trimmed and
// ready to be split into comparators.
var compRe=loose?re[t.COMPARATORLOOSE]:re[t.COMPARATOR];var rangeList=range.split(" ").map(function(comp){return parseComparator(comp,_this34.options);}).join(" ").split(/\s+/)// >=0.0.0 is equivalent to *
.map(function(comp){return replaceGTE0(comp,_this34.options);})// in loose mode, throw out any that are not valid comparators
.filter(this.options.loose?function(comp){return!!comp.match(compRe);}:function(){return true;}).map(function(comp){return new Comparator(comp,_this34.options);});// if any comparators are the null set, then replace with JUST null set
// if more than one comparator, remove any * comparators
// also, don't include the same comparator more than once
var l=rangeList.length;var rangeMap=new Map();var _iterator35=_createForOfIteratorHelper(rangeList),_step35;try{for(_iterator35.s();!(_step35=_iterator35.n()).done;){var comp=_step35.value;if(isNullSet(comp))return[comp];rangeMap.set(comp.value,comp);}}catch(err){_iterator35.e(err);}finally{_iterator35.f();}if(rangeMap.size>1&&rangeMap.has(""))rangeMap["delete"]("");var result=_toConsumableArray2(rangeMap.values());cache.set(memoKey,result);return result;}},{key:"intersects",value:function intersects(range,options){if(!(range instanceof Range)){throw new TypeError("a Range is required");}return this.set.some(function(thisComparators){return isSatisfiable(thisComparators,options)&&range.set.some(function(rangeComparators){return isSatisfiable(rangeComparators,options)&&thisComparators.every(function(thisComparator){return rangeComparators.every(function(rangeComparator){return thisComparator.intersects(rangeComparator,options);});});});});}// if ANY of the sets match ALL of its comparators, then pass
},{key:"test",value:function test(version){if(!version){return false;}if(typeof version==="string"){try{version=new SemVer(version,this.options);}catch(er){return false;}}for(var _i103=0;_i103<this.set.length;_i103++){if(testSet(this.set[_i103],version,this.options)){return true;}}return false;}}]);return Range;}();exports$1$c=Range;var LRU=_lruCache;var cache=new LRU({max:1000});var parseOptions=dew$2();var Comparator=dew$k();var debug=dew$4();var SemVer=dew();var _dew$8=dew$3(),re=_dew$8.re,t=_dew$8.t,comparatorTrimReplace=_dew$8.comparatorTrimReplace,tildeTrimReplace=_dew$8.tildeTrimReplace,caretTrimReplace=_dew$8.caretTrimReplace;var isNullSet=function isNullSet(c){return c.value==="<0.0.0-0";};var isAny=function isAny(c){return c.value==="";};// take a set of comparators and determine whether there
// exists a version which can satisfy it
var isSatisfiable=function isSatisfiable(comparators,options){var result=true;var remainingComparators=comparators.slice();var testComparator=remainingComparators.pop();while(result&&remainingComparators.length){result=remainingComparators.every(function(otherComparator){return testComparator.intersects(otherComparator,options);});testComparator=remainingComparators.pop();}return result;};// comprised of xranges, tildes, stars, and gtlt's at this point.
// already replaced the hyphen ranges
// turn into a set of JUST comparators.
var parseComparator=function parseComparator(comp,options){debug("comp",comp,options);comp=replaceCarets(comp,options);debug("caret",comp);comp=replaceTildes(comp,options);debug("tildes",comp);comp=replaceXRanges(comp,options);debug("xrange",comp);comp=replaceStars(comp,options);debug("stars",comp);return comp;};var isX=function isX(id){return!id||id.toLowerCase()==="x"||id==="*";};// ~, ~> --> * (any, kinda silly)
// ~2, ~2.x, ~2.x.x, ~>2, ~>2.x ~>2.x.x --> >=2.0.0 <3.0.0-0
// ~2.0, ~2.0.x, ~>2.0, ~>2.0.x --> >=2.0.0 <2.1.0-0
// ~1.2, ~1.2.x, ~>1.2, ~>1.2.x --> >=1.2.0 <1.3.0-0
// ~1.2.3, ~>1.2.3 --> >=1.2.3 <1.3.0-0
// ~1.2.0, ~>1.2.0 --> >=1.2.0 <1.3.0-0
var replaceTildes=function replaceTildes(comp,options){return comp.trim().split(/\s+/).map(function(comp){return replaceTilde(comp,options);}).join(" ");};var replaceTilde=function replaceTilde(comp,options){var r=options.loose?re[t.TILDELOOSE]:re[t.TILDE];return comp.replace(r,function(_,M,m,p,pr){debug("tilde",comp,_,M,m,p,pr);var ret;if(isX(M)){ret="";}else if(isX(m)){ret=">=".concat(M,".0.0 <").concat(+M+1,".0.0-0");}else if(isX(p)){// ~1.2 == >=1.2.0 <1.3.0-0
ret=">=".concat(M,".").concat(m,".0 <").concat(M,".").concat(+m+1,".0-0");}else if(pr){debug("replaceTilde pr",pr);ret=">=".concat(M,".").concat(m,".").concat(p,"-").concat(pr," <").concat(M,".").concat(+m+1,".0-0");}else{// ~1.2.3 == >=1.2.3 <1.3.0-0
ret=">=".concat(M,".").concat(m,".").concat(p," <").concat(M,".").concat(+m+1,".0-0");}debug("tilde return",ret);return ret;});};// ^ --> * (any, kinda silly)
// ^2, ^2.x, ^2.x.x --> >=2.0.0 <3.0.0-0
// ^2.0, ^2.0.x --> >=2.0.0 <3.0.0-0
// ^1.2, ^1.2.x --> >=1.2.0 <2.0.0-0
// ^1.2.3 --> >=1.2.3 <2.0.0-0
// ^1.2.0 --> >=1.2.0 <2.0.0-0
var replaceCarets=function replaceCarets(comp,options){return comp.trim().split(/\s+/).map(function(comp){return replaceCaret(comp,options);}).join(" ");};var replaceCaret=function replaceCaret(comp,options){debug("caret",comp,options);var r=options.loose?re[t.CARETLOOSE]:re[t.CARET];var z=options.includePrerelease?"-0":"";return comp.replace(r,function(_,M,m,p,pr){debug("caret",comp,_,M,m,p,pr);var ret;if(isX(M)){ret="";}else if(isX(m)){ret=">=".concat(M,".0.0").concat(z," <").concat(+M+1,".0.0-0");}else if(isX(p)){if(M==="0"){ret=">=".concat(M,".").concat(m,".0").concat(z," <").concat(M,".").concat(+m+1,".0-0");}else{ret=">=".concat(M,".").concat(m,".0").concat(z," <").concat(+M+1,".0.0-0");}}else if(pr){debug("replaceCaret pr",pr);if(M==="0"){if(m==="0"){ret=">=".concat(M,".").concat(m,".").concat(p,"-").concat(pr," <").concat(M,".").concat(m,".").concat(+p+1,"-0");}else{ret=">=".concat(M,".").concat(m,".").concat(p,"-").concat(pr," <").concat(M,".").concat(+m+1,".0-0");}}else{ret=">=".concat(M,".").concat(m,".").concat(p,"-").concat(pr," <").concat(+M+1,".0.0-0");}}else{debug("no pr");if(M==="0"){if(m==="0"){ret=">=".concat(M,".").concat(m,".").concat(p).concat(z," <").concat(M,".").concat(m,".").concat(+p+1,"-0");}else{ret=">=".concat(M,".").concat(m,".").concat(p).concat(z," <").concat(M,".").concat(+m+1,".0-0");}}else{ret=">=".concat(M,".").concat(m,".").concat(p," <").concat(+M+1,".0.0-0");}}debug("caret return",ret);return ret;});};var replaceXRanges=function replaceXRanges(comp,options){debug("replaceXRanges",comp,options);return comp.split(/\s+/).map(function(comp){return replaceXRange(comp,options);}).join(" ");};var replaceXRange=function replaceXRange(comp,options){comp=comp.trim();var r=options.loose?re[t.XRANGELOOSE]:re[t.XRANGE];return comp.replace(r,function(ret,gtlt,M,m,p,pr){debug("xRange",comp,ret,gtlt,M,m,p,pr);var xM=isX(M);var xm=xM||isX(m);var xp=xm||isX(p);var anyX=xp;if(gtlt==="="&&anyX){gtlt="";}// if we're including prereleases in the match, then we need
// to fix this to -0, the lowest possible prerelease value
pr=options.includePrerelease?"-0":"";if(xM){if(gtlt===">"||gtlt==="<"){// nothing is allowed
ret="<0.0.0-0";}else{// nothing is forbidden
ret="*";}}else if(gtlt&&anyX){// we know patch is an x, because we have any x at all.
// replace X with 0
if(xm){m=0;}p=0;if(gtlt===">"){// >1 => >=2.0.0
// >1.2 => >=1.3.0
gtlt=">=";if(xm){M=+M+1;m=0;p=0;}else{m=+m+1;p=0;}}else if(gtlt==="<="){// <=0.7.x is actually <0.8.0, since any 0.7.x should
// pass.  Similarly, <=7.x is actually <8.0.0, etc.
gtlt="<";if(xm){M=+M+1;}else{m=+m+1;}}if(gtlt==="<")pr="-0";ret="".concat(gtlt+M,".").concat(m,".").concat(p).concat(pr);}else if(xm){ret=">=".concat(M,".0.0").concat(pr," <").concat(+M+1,".0.0-0");}else if(xp){ret=">=".concat(M,".").concat(m,".0").concat(pr," <").concat(M,".").concat(+m+1,".0-0");}debug("xRange return",ret);return ret;});};// Because * is AND-ed with everything else in the comparator,
// and '' means "any version", just remove the *s entirely.
var replaceStars=function replaceStars(comp,options){debug("replaceStars",comp,options);// Looseness is ignored here.  star is always as loose as it gets!
return comp.trim().replace(re[t.STAR],"");};var replaceGTE0=function replaceGTE0(comp,options){debug("replaceGTE0",comp,options);return comp.trim().replace(re[options.includePrerelease?t.GTE0PRE:t.GTE0],"");};// This function is passed to string.replace(re[t.HYPHENRANGE])
// M, m, patch, prerelease, build
// 1.2 - 3.4.5 => >=1.2.0 <=3.4.5
// 1.2.3 - 3.4 => >=1.2.0 <3.5.0-0 Any 3.4.x will do
// 1.2 - 3.4 => >=1.2.0 <3.5.0-0
var hyphenReplace=function hyphenReplace(incPr){return function($0,from,fM,fm,fp,fpr,fb,to,tM,tm,tp,tpr,tb){if(isX(fM)){from="";}else if(isX(fm)){from=">=".concat(fM,".0.0").concat(incPr?"-0":"");}else if(isX(fp)){from=">=".concat(fM,".").concat(fm,".0").concat(incPr?"-0":"");}else if(fpr){from=">=".concat(from);}else{from=">=".concat(from).concat(incPr?"-0":"");}if(isX(tM)){to="";}else if(isX(tm)){to="<".concat(+tM+1,".0.0-0");}else if(isX(tp)){to="<".concat(tM,".").concat(+tm+1,".0-0");}else if(tpr){to="<=".concat(tM,".").concat(tm,".").concat(tp,"-").concat(tpr);}else if(incPr){to="<".concat(tM,".").concat(tm,".").concat(+tp+1,"-0");}else{to="<=".concat(to);}return"".concat(from," ").concat(to).trim();};};var testSet=function testSet(set,version,options){for(var _i104=0;_i104<set.length;_i104++){if(!set[_i104].test(version)){return false;}}if(version.prerelease.length&&!options.includePrerelease){// Find the set of versions that are allowed to have prereleases
// For example, ^1.2.3-pr.1 desugars to >=1.2.3-pr.1 <2.0.0
// That should allow `1.2.3-pr.2` to pass.
// However, `1.2.4-alpha.notready` should NOT be allowed,
// even though it's within the range set by the comparators.
for(var _i105=0;_i105<set.length;_i105++){debug(set[_i105].semver);if(set[_i105].semver===Comparator.ANY){continue;}if(set[_i105].semver.prerelease.length>0){var allowed=set[_i105].semver;if(allowed.major===version.major&&allowed.minor===version.minor&&allowed.patch===version.patch){return true;}}}// Version has a -pre, but it's not one of the ones we like.
return false;}return true;};return exports$1$c;}var exports$x={},_dewExec$k=false;function dew$k(){if(_dewExec$k)return exports$x;_dewExec$k=true;var ANY=Symbol("SemVer ANY");// hoisted class for cyclic dependency
var Comparator=/*#__PURE__*/function(){_createClass(Comparator,null,[{key:"ANY",get:function get(){return ANY;}}]);function Comparator(comp,options){_classCallCheck(this,Comparator);options=parseOptions(options);if(comp instanceof Comparator){if(comp.loose===!!options.loose){return comp;}else{comp=comp.value;}}debug("comparator",comp,options);this.options=options;this.loose=!!options.loose;this.parse(comp);if(this.semver===ANY){this.value="";}else{this.value=this.operator+this.semver.version;}debug("comp",this);}_createClass(Comparator,[{key:"parse",value:function parse(comp){var r=this.options.loose?re[t.COMPARATORLOOSE]:re[t.COMPARATOR];var m=comp.match(r);if(!m){throw new TypeError("Invalid comparator: ".concat(comp));}this.operator=m[1]!==undefined?m[1]:"";if(this.operator==="="){this.operator="";}// if it literally is just '>' or '' then allow anything.
if(!m[2]){this.semver=ANY;}else{this.semver=new SemVer(m[2],this.options.loose);}}},{key:"toString",value:function toString(){return this.value;}},{key:"test",value:function test(version){debug("Comparator.test",version,this.options.loose);if(this.semver===ANY||version===ANY){return true;}if(typeof version==="string"){try{version=new SemVer(version,this.options);}catch(er){return false;}}return cmp(version,this.operator,this.semver,this.options);}},{key:"intersects",value:function intersects(comp,options){if(!(comp instanceof Comparator)){throw new TypeError("a Comparator is required");}if(!options||_typeof2(options)!=="object"){options={loose:!!options,includePrerelease:false};}if(this.operator===""){if(this.value===""){return true;}return new Range(comp.value,options).test(this.value);}else if(comp.operator===""){if(comp.value===""){return true;}return new Range(this.value,options).test(comp.semver);}var sameDirectionIncreasing=(this.operator===">="||this.operator===">")&&(comp.operator===">="||comp.operator===">");var sameDirectionDecreasing=(this.operator==="<="||this.operator==="<")&&(comp.operator==="<="||comp.operator==="<");var sameSemVer=this.semver.version===comp.semver.version;var differentDirectionsInclusive=(this.operator===">="||this.operator==="<=")&&(comp.operator===">="||comp.operator==="<=");var oppositeDirectionsLessThan=cmp(this.semver,"<",comp.semver,options)&&(this.operator===">="||this.operator===">")&&(comp.operator==="<="||comp.operator==="<");var oppositeDirectionsGreaterThan=cmp(this.semver,">",comp.semver,options)&&(this.operator==="<="||this.operator==="<")&&(comp.operator===">="||comp.operator===">");return sameDirectionIncreasing||sameDirectionDecreasing||sameSemVer&&differentDirectionsInclusive||oppositeDirectionsLessThan||oppositeDirectionsGreaterThan;}}]);return Comparator;}();exports$x=Comparator;var parseOptions=dew$2();var _dew$9=dew$3(),re=_dew$9.re,t=_dew$9.t;var cmp=dew$i();var debug=dew$4();var SemVer=dew();var Range=dew$1$3();return exports$x;}var exports$y={},_dewExec$l=false;function dew$l(){if(_dewExec$l)return exports$y;_dewExec$l=true;var Range=dew$1$3();var satisfies=function satisfies(version,range,options){try{range=new Range(range,options);}catch(er){return false;}return range.test(version);};exports$y=satisfies;return exports$y;}var exports$z={},_dewExec$m=false;function dew$m(){if(_dewExec$m)return exports$z;_dewExec$m=true;var SemVer=dew();var Range=dew$1$3();var maxSatisfying=function maxSatisfying(versions,range,options){var max=null;var maxSV=null;var rangeObj=null;try{rangeObj=new Range(range,options);}catch(er){return null;}versions.forEach(function(v){if(rangeObj.test(v)){// satisfies(v, range, options)
if(!max||maxSV.compare(v)===-1){// compare(max, v, true)
max=v;maxSV=new SemVer(max,options);}}});return max;};exports$z=maxSatisfying;return exports$z;}var exports$A={},_dewExec$n=false;function dew$n(){if(_dewExec$n)return exports$A;_dewExec$n=true;var Range=dew$1$3();var validRange=function validRange(range,options){try{// Return '*' instead of '' so that truthiness works.
// This will throw if it's invalid anyway
return new Range(range,options).range||"*";}catch(er){return null;}};exports$A=validRange;return exports$A;}var exports$B={},_dewExec$o=false;function dew$o(){if(_dewExec$o)return exports$B;_dewExec$o=true;var Range=dew$1$3();var intersects=function intersects(r1,r2,options){r1=new Range(r1,options);r2=new Range(r2,options);return r1.intersects(r2);};exports$B=intersects;return exports$B;}var exports$e$1={},_dewExec$e$1=false;function dew$e$1(){if(_dewExec$e$1)return exports$e$1;_dewExec$e$1=true;var parse=dew$6();var clean=function clean(version,options){var s=parse(version.trim().replace(/^[=v]+/,""),options);return s?s.version:null;};exports$e$1=clean;return exports$e$1;}var exports$d$1={},_dewExec$d$1=false;function dew$d$1(){if(_dewExec$d$1)return exports$d$1;_dewExec$d$1=true;var parse=dew$6();var eq=dew$a();var diff=function diff(version1,version2){if(eq(version1,version2)){return null;}else{var v1=parse(version1);var v2=parse(version2);var hasPre=v1.prerelease.length||v2.prerelease.length;var prefix=hasPre?"pre":"";var defaultResult=hasPre?"prerelease":"";for(var key in v1){if(key==="major"||key==="minor"||key==="patch"){if(v1[key]!==v2[key]){return prefix+key;}}}return defaultResult;// may be undefined
}};exports$d$1=diff;return exports$d$1;}var exports$c$1={},_dewExec$c$1=false;function dew$c$1(){if(_dewExec$c$1)return exports$c$1;_dewExec$c$1=true;var SemVer=dew();var minor=function minor(a,loose){return new SemVer(a,loose).minor;};exports$c$1=minor;return exports$c$1;}var exports$b$1={},_dewExec$b$1=false;function dew$b$1(){if(_dewExec$b$1)return exports$b$1;_dewExec$b$1=true;var SemVer=dew();var patch=function patch(a,loose){return new SemVer(a,loose).patch;};exports$b$1=patch;return exports$b$1;}var exports$a$1={},_dewExec$a$1=false;function dew$a$1(){if(_dewExec$a$1)return exports$a$1;_dewExec$a$1=true;var compare=dew$9();var compareLoose=function compareLoose(a,b){return compare(a,b,true);};exports$a$1=compareLoose;return exports$a$1;}var exports$9$1={},_dewExec$9$1=false;function dew$9$1(){if(_dewExec$9$1)return exports$9$1;_dewExec$9$1=true;var compareBuild=dew$1$1();var sort=function sort(list,loose){return list.sort(function(a,b){return compareBuild(a,b,loose);});};exports$9$1=sort;return exports$9$1;}var exports$8$1={},_dewExec$8$1=false;function dew$8$1(){if(_dewExec$8$1)return exports$8$1;_dewExec$8$1=true;var Range=dew$1$3();// Mostly just for testing and legacy API reasons
var toComparators=function toComparators(range,options){return new Range(range,options).set.map(function(comp){return comp.map(function(c){return c.value;}).join(" ").trim().split(" ");});};exports$8$1=toComparators;return exports$8$1;}var exports$7$1={},_dewExec$7$1=false;function dew$7$1(){if(_dewExec$7$1)return exports$7$1;_dewExec$7$1=true;var SemVer=dew();var Range=dew$1$3();var minSatisfying=function minSatisfying(versions,range,options){var min=null;var minSV=null;var rangeObj=null;try{rangeObj=new Range(range,options);}catch(er){return null;}versions.forEach(function(v){if(rangeObj.test(v)){// satisfies(v, range, options)
if(!min||minSV.compare(v)===1){// compare(min, v, true)
min=v;minSV=new SemVer(min,options);}}});return min;};exports$7$1=minSatisfying;return exports$7$1;}var exports$6$1={},_dewExec$6$1=false;function dew$6$1(){if(_dewExec$6$1)return exports$6$1;_dewExec$6$1=true;var SemVer=dew();var Range=dew$1$3();var gt=dew$f();var minVersion=function minVersion(range,loose){range=new Range(range,loose);var minver=new SemVer("0.0.0");if(range.test(minver)){return minver;}minver=new SemVer("0.0.0-0");if(range.test(minver)){return minver;}minver=null;var _loop2=function _loop2(_i106){var comparators=range.set[_i106];var setMin=null;comparators.forEach(function(comparator){// Clone to avoid manipulating the comparator's semver object.
var compver=new SemVer(comparator.semver.version);switch(comparator.operator){case">":if(compver.prerelease.length===0){compver.patch++;}else{compver.prerelease.push(0);}compver.raw=compver.format();/* fallthrough */case"":case">=":if(!setMin||gt(compver,setMin)){setMin=compver;}break;case"<":case"<=":/* Ignore maximum versions */break;/* istanbul ignore next */default:throw new Error("Unexpected operation: ".concat(comparator.operator));}});if(setMin&&(!minver||gt(minver,setMin)))minver=setMin;};for(var _i106=0;_i106<range.set.length;++_i106){_loop2(_i106);}if(minver&&range.test(minver)){return minver;}return null;};exports$6$1=minVersion;return exports$6$1;}var exports$5$2={},_dewExec$5$1=false;function dew$5$1(){if(_dewExec$5$1)return exports$5$2;_dewExec$5$1=true;var SemVer=dew();var Comparator=dew$k();var ANY=Comparator.ANY;var Range=dew$1$3();var satisfies=dew$l();var gt=dew$f();var lt=dew$g();var lte=dew$1$2();var gte=dew$h();var outside=function outside(version,range,hilo,options){version=new SemVer(version,options);range=new Range(range,options);var gtfn,ltefn,ltfn,comp,ecomp;switch(hilo){case">":gtfn=gt;ltefn=lte;ltfn=lt;comp=">";ecomp=">=";break;case"<":gtfn=lt;ltefn=gte;ltfn=gt;comp="<";ecomp="<=";break;default:throw new TypeError("Must provide a hilo val of \"<\" or \">\"");}// If it satisfies the range it is not outside
if(satisfies(version,range,options)){return false;}// From now on, variable terms are as if we're in "gtr" mode.
// but note that everything is flipped for the "ltr" function.
var _loop3=function _loop3(_i107){var comparators=range.set[_i107];var high=null;var low=null;comparators.forEach(function(comparator){if(comparator.semver===ANY){comparator=new Comparator(">=0.0.0");}high=high||comparator;low=low||comparator;if(gtfn(comparator.semver,high.semver,options)){high=comparator;}else if(ltfn(comparator.semver,low.semver,options)){low=comparator;}});// If the edge version comparator has a operator then our version
// isn't outside it
if(high.operator===comp||high.operator===ecomp){return{v:false};}// If the lowest version comparator has an operator and our version
// is less than it then it isn't higher than the range
if((!low.operator||low.operator===comp)&&ltefn(version,low.semver)){return{v:false};}else if(low.operator===ecomp&&ltfn(version,low.semver)){return{v:false};}};for(var _i107=0;_i107<range.set.length;++_i107){var _ret3=_loop3(_i107);if(_typeof2(_ret3)==="object")return _ret3.v;}return true;};exports$5$2=outside;return exports$5$2;}var exports$4$2={},_dewExec$4$1=false;function dew$4$1(){if(_dewExec$4$1)return exports$4$2;_dewExec$4$1=true;// Determine if version is greater than all the versions possible in the range.
var outside=dew$5$1();var gtr=function gtr(version,range,options){return outside(version,range,">",options);};exports$4$2=gtr;return exports$4$2;}var exports$3$2={},_dewExec$3$1=false;function dew$3$1(){if(_dewExec$3$1)return exports$3$2;_dewExec$3$1=true;var outside=dew$5$1();// Determine if version is less than all the versions possible in the range
var ltr=function ltr(version,range,options){return outside(version,range,"<",options);};exports$3$2=ltr;return exports$3$2;}var exports$2$7={},_dewExec$2$2=false;function dew$2$2(){if(_dewExec$2$2)return exports$2$7;_dewExec$2$2=true;// given a set of versions and a range, create a "simplified" range
// that includes the same versions that the original range does
// If the original range is shorter than the simplified one, return that.
var satisfies=dew$l();var compare=dew$9();exports$2$7=function exports$2$7(versions,range,options){var set=[];var min=null;var prev=null;var v=versions.sort(function(a,b){return compare(a,b,options);});var _iterator36=_createForOfIteratorHelper(v),_step36;try{for(_iterator36.s();!(_step36=_iterator36.n()).done;){var _version=_step36.value;var included=satisfies(_version,range,options);if(included){prev=_version;if(!min)min=_version;}else{if(prev){set.push([min,prev]);}prev=null;min=null;}}}catch(err){_iterator36.e(err);}finally{_iterator36.f();}if(min)set.push([min,null]);var ranges=[];for(var _i108=0,_set2=set;_i108<_set2.length;_i108++){var _set2$_i=_slicedToArray2(_set2[_i108],2),_min=_set2$_i[0],_max=_set2$_i[1];if(_min===_max)ranges.push(_min);else if(!_max&&_min===v[0])ranges.push("*");else if(!_max)ranges.push(">=".concat(_min));else if(_min===v[0])ranges.push("<=".concat(_max));else ranges.push("".concat(_min," - ").concat(_max));}var simplified=ranges.join(" || ");var original=typeof range.raw==="string"?range.raw:String(range);return simplified.length<original.length?simplified:range;};return exports$2$7;}var exports$1$d={},_dewExec$1$4=false;function dew$1$4(){if(_dewExec$1$4)return exports$1$d;_dewExec$1$4=true;var Range=dew$1$3();var Comparator=dew$k();var ANY=Comparator.ANY;var satisfies=dew$l();var compare=dew$9();// Complex range `r1 || r2 || ...` is a subset of `R1 || R2 || ...` iff:
// - Every simple range `r1, r2, ...` is a null set, OR
// - Every simple range `r1, r2, ...` which is not a null set is a subset of
//   some `R1, R2, ...`
//
// Simple range `c1 c2 ...` is a subset of simple range `C1 C2 ...` iff:
// - If c is only the ANY comparator
//   - If C is only the ANY comparator, return true
//   - Else if in prerelease mode, return false
//   - else replace c with `[>=0.0.0]`
// - If C is only the ANY comparator
//   - if in prerelease mode, return true
//   - else replace C with `[>=0.0.0]`
// - Let EQ be the set of = comparators in c
// - If EQ is more than one, return true (null set)
// - Let GT be the highest > or >= comparator in c
// - Let LT be the lowest < or <= comparator in c
// - If GT and LT, and GT.semver > LT.semver, return true (null set)
// - If any C is a = range, and GT or LT are set, return false
// - If EQ
//   - If GT, and EQ does not satisfy GT, return true (null set)
//   - If LT, and EQ does not satisfy LT, return true (null set)
//   - If EQ satisfies every C, return true
//   - Else return false
// - If GT
//   - If GT.semver is lower than any > or >= comp in C, return false
//   - If GT is >=, and GT.semver does not satisfy every C, return false
//   - If GT.semver has a prerelease, and not in prerelease mode
//     - If no C has a prerelease and the GT.semver tuple, return false
// - If LT
//   - If LT.semver is greater than any < or <= comp in C, return false
//   - If LT is <=, and LT.semver does not satisfy every C, return false
//   - If GT.semver has a prerelease, and not in prerelease mode
//     - If no C has a prerelease and the LT.semver tuple, return false
// - Else return true
var subset=function subset(sub,dom){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(sub===dom)return true;sub=new Range(sub,options);dom=new Range(dom,options);var sawNonNull=false;var _iterator37=_createForOfIteratorHelper(sub.set),_step37;try{OUTER:for(_iterator37.s();!(_step37=_iterator37.n()).done;){var simpleSub=_step37.value;var _iterator38=_createForOfIteratorHelper(dom.set),_step38;try{for(_iterator38.s();!(_step38=_iterator38.n()).done;){var simpleDom=_step38.value;var isSub=simpleSubset(simpleSub,simpleDom,options);sawNonNull=sawNonNull||isSub!==null;if(isSub)continue OUTER;}// the null set is a subset of everything, but null simple ranges in
// a complex range should be ignored.  so if we saw a non-null range,
// then we know this isn't a subset, but if EVERY simple range was null,
// then it is a subset.
}catch(err){_iterator38.e(err);}finally{_iterator38.f();}if(sawNonNull)return false;}}catch(err){_iterator37.e(err);}finally{_iterator37.f();}return true;};var simpleSubset=function simpleSubset(sub,dom,options){if(sub===dom)return true;if(sub.length===1&&sub[0].semver===ANY){if(dom.length===1&&dom[0].semver===ANY)return true;else if(options.includePrerelease)sub=[new Comparator(">=0.0.0-0")];else sub=[new Comparator(">=0.0.0")];}if(dom.length===1&&dom[0].semver===ANY){if(options.includePrerelease)return true;else dom=[new Comparator(">=0.0.0")];}var eqSet=new Set();var gt,lt;var _iterator39=_createForOfIteratorHelper(sub),_step39;try{for(_iterator39.s();!(_step39=_iterator39.n()).done;){var _c5=_step39.value;if(_c5.operator===">"||_c5.operator===">=")gt=higherGT(gt,_c5,options);else if(_c5.operator==="<"||_c5.operator==="<=")lt=lowerLT(lt,_c5,options);else eqSet.add(_c5.semver);}}catch(err){_iterator39.e(err);}finally{_iterator39.f();}if(eqSet.size>1)return null;var gtltComp;if(gt&&lt){gtltComp=compare(gt.semver,lt.semver,options);if(gtltComp>0)return null;else if(gtltComp===0&&(gt.operator!==">="||lt.operator!=="<="))return null;}// will iterate one or zero times
var _iterator40=_createForOfIteratorHelper(eqSet),_step40;try{for(_iterator40.s();!(_step40=_iterator40.n()).done;){var eq=_step40.value;if(gt&&!satisfies(eq,String(gt),options))return null;if(lt&&!satisfies(eq,String(lt),options))return null;var _iterator42=_createForOfIteratorHelper(dom),_step42;try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var _c6=_step42.value;if(!satisfies(eq,String(_c6),options))return false;}}catch(err){_iterator42.e(err);}finally{_iterator42.f();}return true;}}catch(err){_iterator40.e(err);}finally{_iterator40.f();}var higher,lower;var hasDomLT,hasDomGT;// if the subset has a prerelease, we need a comparator in the superset
// with the same tuple and a prerelease, or it's not a subset
var needDomLTPre=lt&&!options.includePrerelease&&lt.semver.prerelease.length?lt.semver:false;var needDomGTPre=gt&&!options.includePrerelease&&gt.semver.prerelease.length?gt.semver:false;// exception: <1.2.3-0 is the same as <1.2.3
if(needDomLTPre&&needDomLTPre.prerelease.length===1&&lt.operator==="<"&&needDomLTPre.prerelease[0]===0){needDomLTPre=false;}var _iterator41=_createForOfIteratorHelper(dom),_step41;try{for(_iterator41.s();!(_step41=_iterator41.n()).done;){var _c7=_step41.value;hasDomGT=hasDomGT||_c7.operator===">"||_c7.operator===">=";hasDomLT=hasDomLT||_c7.operator==="<"||_c7.operator==="<=";if(gt){if(needDomGTPre){if(_c7.semver.prerelease&&_c7.semver.prerelease.length&&_c7.semver.major===needDomGTPre.major&&_c7.semver.minor===needDomGTPre.minor&&_c7.semver.patch===needDomGTPre.patch){needDomGTPre=false;}}if(_c7.operator===">"||_c7.operator===">="){higher=higherGT(gt,_c7,options);if(higher===_c7&&higher!==gt)return false;}else if(gt.operator===">="&&!satisfies(gt.semver,String(_c7),options))return false;}if(lt){if(needDomLTPre){if(_c7.semver.prerelease&&_c7.semver.prerelease.length&&_c7.semver.major===needDomLTPre.major&&_c7.semver.minor===needDomLTPre.minor&&_c7.semver.patch===needDomLTPre.patch){needDomLTPre=false;}}if(_c7.operator==="<"||_c7.operator==="<="){lower=lowerLT(lt,_c7,options);if(lower===_c7&&lower!==lt)return false;}else if(lt.operator==="<="&&!satisfies(lt.semver,String(_c7),options))return false;}if(!_c7.operator&&(lt||gt)&&gtltComp!==0)return false;}// if there was a < or >, and nothing in the dom, then must be false
// UNLESS it was limited by another range in the other direction.
// Eg, >1.0.0 <1.0.1 is still a subset of <2.0.0
}catch(err){_iterator41.e(err);}finally{_iterator41.f();}if(gt&&hasDomLT&&!lt&&gtltComp!==0)return false;if(lt&&hasDomGT&&!gt&&gtltComp!==0)return false;// we needed a prerelease range in a specific tuple, but didn't get one
// then this isn't a subset.  eg >=1.2.3-pre is not a subset of >=1.0.0,
// because it includes prereleases in the 1.2.3 tuple
if(needDomGTPre||needDomLTPre)return false;return true;};// >=1.2.3 is lower than >1.2.3
var higherGT=function higherGT(a,b,options){if(!a)return b;var comp=compare(a.semver,b.semver,options);return comp>0?a:comp<0?b:b.operator===">"&&a.operator===">="?b:a;};// <=1.2.3 is higher than <1.2.3
var lowerLT=function lowerLT(a,b,options){if(!a)return b;var comp=compare(a.semver,b.semver,options);return comp<0?a:comp>0?b:b.operator==="<"&&a.operator==="<="?b:a;};exports$1$d=subset;return exports$1$d;}var exports$C={},_dewExec$p=false;function dew$p(){if(_dewExec$p)return exports$C;_dewExec$p=true;// just pre-load all the stuff that index.js lazily exports
var internalRe=dew$3();exports$C={re:internalRe.re,src:internalRe.src,tokens:internalRe.t,SEMVER_SPEC_VERSION:dew$5().SEMVER_SPEC_VERSION,SemVer:dew(),compareIdentifiers:dew$1().compareIdentifiers,rcompareIdentifiers:dew$1().rcompareIdentifiers,parse:dew$6(),valid:dew$7(),clean:dew$e$1(),inc:dew$8(),diff:dew$d$1(),major:dew$b(),minor:dew$c$1(),patch:dew$b$1(),prerelease:dew$c(),compare:dew$9(),rcompare:dew$d(),compareLoose:dew$a$1(),compareBuild:dew$1$1(),sort:dew$9$1(),rsort:dew$e(),gt:dew$f(),lt:dew$g(),eq:dew$a(),neq:dew$2$1(),gte:dew$h(),lte:dew$1$2(),cmp:dew$i(),coerce:dew$j(),Comparator:dew$k(),Range:dew$1$3(),satisfies:dew$l(),toComparators:dew$8$1(),maxSatisfying:dew$m(),minSatisfying:dew$7$1(),minVersion:dew$6$1(),validRange:dew$n(),outside:dew$5$1(),gtr:dew$4$1(),ltr:dew$3$1(),intersects:dew$o(),simplifyRange:dew$2$2(),subset:dew$1$4()};return exports$C;}var exports$D=dew$p();var _$re=exports$D['re'];var urlStartRe$1=/^[a-z\.-_\+]+:/i;function isAbsolute(path){return path.startsWith("/")||path.startsWith("http:")||path.startsWith("https:")||path.startsWith("file:")||path.match(urlStartRe$1);}function ensureResource(path){return path.isResource?path:resource(path);}var PackageRegistry=/*#__PURE__*/function(){_createClass(PackageRegistry,null,[{key:"ofSystem",value:function ofSystem(System){// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// We add a PackageRegistry to the System which basically serves as
// "database" for all module / package related state.
// This also makes it easy to completely replace the module / package state by
// simply replacing the System instance
// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
var registry=System.get("@lively-env").packageRegistry;if(!registry){registry=System["__lively.modules__packageRegistry"]=new this(System);}return registry;}},{key:"forDirectory",value:function forDirectory(System,dir){return new this(System,{packageBaseDirs:[ensureResource(dir)]});}},{key:"fromJSON",value:function fromJSON(System,jso){return new this(System).fromJSON(jso);}}]);function PackageRegistry(System){var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,PackageRegistry);this.System=System;this.packageBaseDirs=opts.packageBaseDirs||[];this.devPackageDirs=opts.devPackageDirs||[];this.individualPackageDirs=opts.individualPackageDirs||[];this._readyPromise=null;this.packageMap={};this._byURL=null;}_createClass(PackageRegistry,[{key:"resetByURL",value:function resetByURL(){this._byURL=null;}},{key:"allPackageURLs",value:function allPackageURLs(){return Object.keys(this.byURL);}},{key:"toJSON",value:function toJSON(){var System=this.System,packageMap=this.packageMap,individualPackageDirs=this.individualPackageDirs,devPackageDirs=this.devPackageDirs,packageBaseDirs=this.packageBaseDirs,packageMapJso={};for(var pName in packageMap){var spec=packageMap[pName];packageMapJso[pName]={};packageMapJso[pName].latest=spec.latest;packageMapJso[pName].versions={};for(var _version2 in spec.versions){packageMapJso[pName].versions[_version2]=spec.versions[_version2].toJSON();}}return{packageMap:packageMapJso,individualPackageDirs:individualPackageDirs.map(serializeURL),devPackageDirs:devPackageDirs.map(serializeURL),packageBaseDirs:packageBaseDirs.map(serializeURL)};function serializeURL(_ref21){var url=_ref21.url;return!url.startsWith(System.baseURL)?url:url.slice(System.baseURL.length).replace(/^\//,"");}}},{key:"fromJSON",value:function fromJSON(jso){var packageMap={},System=this.System,base=resource(System.baseURL);for(var pName in jso.packageMap){var spec=jso.packageMap[pName];packageMap[pName]={};packageMap[pName].latest=spec.latest;packageMap[pName].versions={};for(var _version3 in spec.versions){var pkgSpec=spec.versions[_version3],url=pkgSpec.url;if(!isAbsolute(url))url=base.join(url).url;var pkg=Package.fromJSON(System,_objectSpread(_objectSpread({},pkgSpec),{},{url:url}));packageMap[pName].versions[_version3]=pkg;}}this.packageMap=packageMap;this.individualPackageDirs=jso.individualPackageDirs.map(deserializeURL);this.devPackageDirs=jso.devPackageDirs.map(deserializeURL);this.packageBaseDirs=jso.packageBaseDirs.map(deserializeURL);this.resetByURL();classHolder.ModulePackageMapping.forSystem(System).clearCache();return this;function deserializeURL(url){return isURL(url)?resource(url):resource(System.baseURL).join(url);}}},{key:"updateFromJSON",value:function updateFromJSON(jso){var packageMap=this.packageMap;for(var pName in jso.packageMap){var spec=jso.packageMap[pName];if(!packageMap[pName])packageMap[pName]={};if(packageMap[pName].latest){if(exports$D.gt(spec.latest,packageMap[pName].latest))packageMap[pName].latest=spec.latest;}else packageMap[pName].latest;if(!packageMap[pName].versions)packageMap[pName].versions={};var _System2=this.System,_base=resource(_System2.baseURL);for(var _version4 in spec.versions){var pkgSpec=spec.versions[_version4],url=pkgSpec.url;if(!isAbsolute(url))url=_base.join(url).url;var pkg=new Package.fromJSON(_System2,_objectSpread(_objectSpread({},pkgSpec),{},{url:url}));packageMap[pName].versions[_version4]=pkg;}}this.resetByURL();classHolder.ModulePackageMapping.forSystem(System).clearCache();return this;}},{key:"whenReady",value:function whenReady(){return this._readyPromise||Promise.resolve();}},{key:"isReady",value:function isReady(){return!this._readyPromise;}},{key:"withPackagesDo",value:function withPackagesDo(doFn){for(var pName in this.packageMap){var _versions=this.packageMap[pName].versions;for(var versionName in _versions){doFn(_versions[versionName]);}}}},{key:"findPackage",value:function findPackage(matchFn){for(var pName in this.packageMap){var _versions2=this.packageMap[pName].versions;for(var versionName in _versions2){var pkg=_versions2[versionName];if(matchFn(pkg))return pkg;}}return null;}},{key:"filterPackages",value:function filterPackages(matchFn){var result=[];this.withPackagesDo(function(pkg){return matchFn(pkg)&&result.push(pkg);});return result;}},{key:"allPackages",value:function allPackages(){var result=[];for(var pName in this.packageMap){var _versions3=this.packageMap[pName].versions;for(var versionName in _versions3){result.push(_versions3[versionName]);}}return result;}},{key:"sortPackagesByVersion",value:function sortPackagesByVersion(pkgs){return pkgs.sort(function(a,b){return exports$D.compare(a.version,b.version,true);});}},{key:"matches",value:function matches(pkg,pName,versionRange){// does this package match the package pName@versionRange?
var name=pkg.name,version=pkg.version;if(name!==pName)return false;if(!versionRange)return true;// if (gitSpec && (gitSpec.versionInFileName === version
//   || this.versionInFileName === gitSpec.versionInFileName)) {
//    return true
// }
if(exports$D.validRange(version||"",true)&&exports$D.satisfies(version,versionRange,true))return true;return false;}},{key:"coversDirectory",value:function coversDirectory(dir){dir=ensureResource(dir).asDirectory();var packageBaseDirs=this.packageBaseDirs,devPackageDirs=this.devPackageDirs,individualPackageDirs=this.individualPackageDirs;if(individualPackageDirs.some(function(ea){return ea.equals(dir);}))return"individualPackageDirs";if(devPackageDirs.some(function(ea){return ea.equals(dir);}))return"devPackageDirs";var parent=dir.parent().parent();if(packageBaseDirs.some(function(ea){return ea.equals(parent);})){return this.allPackages().find(function(pkg){return ensureResource(pkg.url).equals(dir);})?"packageCollectionDirs":"maybe packageCollectionDirs";}return null;}},{key:"lookup",value:function lookup(pkgName,versionRange){var _this35=this;// Query the package map if it has a package name@version
// Compatibility is either a semver match or if package comes from a git
// repo then if the git commit matches.  Additionally dev packages are
// supported.  If a dev package with `name` is found it always matches
// let gitSpec = gitSpecFromVersion(versionRange || "");
// return this.findPackage((key, pkg) => pkg.matches(name, versionRange, gitSpec));
// let gitSpec = gitSpecFromVersion(versionRange || "");
var pkgData=this.packageMap[pkgName];if(!pkgData)return null;if(!versionRange||versionRange==="latest")return pkgData.versions[pkgData.latest];if(!exports$D.validRange(versionRange,true))throw new Error("PackageRegistry>>lookup of ".concat(pkgName,": Invalid version - ").concat(versionRange));var pkgs=values(pkgData.versions).filter(function(pkg){return _this35.matches(pkg,pkgName,versionRange);});if(pkgs.length<=1)return pkgs[0];return last(this.sortPackagesByVersion(pkgs));}},{key:"findPackageDependency",value:function findPackageDependency(basePkg,name,version){// name@version is dependency of basePkg
if(!version)version=basePkg.dependencies[name]||basePkg.devDependencies[name];if(!exports$D.validRange(version,true))version=null;return this.lookup(name,version);}},{key:"findPackageWithURL",value:function findPackageWithURL(url){if(url.isResource)url=url.url;if(url.endsWith("/"))url=url.slice(0,-1);return this.byURL[url];}},{key:"findPackageHavingURL",value:function findPackageHavingURL(url){// does url identify a resource inside pkg, maybe pkg.url === url?
if(url.isResource)url=url.url;if(url.endsWith("/"))url=url.slice(0,-1);var penaltySoFar=Infinity,found=null,byURL=this.byURL;for(var pkgURL in byURL){if(url.indexOf(pkgURL)!==0)continue;var penalty=url.slice(pkgURL.length).length;if(penalty>=penaltySoFar)continue;penaltySoFar=penalty;found=byURL[pkgURL];}return found;}},{key:"findPackageForPath",value:function findPackageForPath(pathRequest,optParentPkg){if(isAbsolute(pathRequest))return this.findPackageHavingURL(pathRequest);if(pathRequest.startsWith("."))return null;// relative
// ry to figure out package name and maybe version
var _pathRequest$split=pathRequest.split("/"),_pathRequest$split2=_slicedToArray2(_pathRequest$split,1),pkgName=_pathRequest$split2[0];if(!pkgName)return null;var atIndex=pkgName.indexOf("@"),version;if(atIndex>-1){version=pkgName.slice(atIndex+1);pkgName=pkgName.slice(0,atIndex);}if(!version&&optParentPkg)return this.findPackageDependency(optParentPkg,pkgName);return this.lookup(pkgName,version);}},{key:"resolvePath",value:function resolvePath(path,parentIdOrPkg){// takes a path like foo/index.js or ./foo/index.js and an optional
// parentId or package like http://org/baz.js and tries to resolve the path
if(isAbsolute(path))return path;var parentPackage=parentIdOrPkg&&parentIdOrPkg.isPackage||null;if(!parentPackage&&parentIdOrPkg){if(path.startsWith(".")){var res=resource(parentIdOrPkg);if(!res.isDirectory())res=res.parent();return res.join(path).withRelativePartsResolved().url;}parentPackage=this.findPackageHavingURL(parentIdOrPkg);}var p=this.findPackageForPath(path,parentPackage);if(!p)return null;var slashIndex=path.indexOf("/"),pathInPackage=slashIndex===-1||slashIndex===path.length-1?"":path.slice(slashIndex);return pathInPackage?resource(p.url).join(pathInPackage).url:p.url;}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// reading stuff in
},{key:"update",value:function(){var _update=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee80(){var _this36=this;var deferred,discovered,_iterator43,_step43,dir,_iterator46,_step46,dirWithVersions,_iterator47,_step47,subDir,_iterator44,_step44,_dir,_iterator45,_step45,_dir2,url,_discovered$url,pkg,config,covered;return regeneratorRuntime.wrap(function _callee80$(_context80){while(1){switch(_context80.prev=_context80.next){case 0:if(this.isReady()){_context80.next=2;break;}return _context80.abrupt("return",this.whenReady().then(function(){return _this36.update();}));case 2:deferred=promise.deferred();this._readyPromise=deferred.promise;this.packageBaseDirs=this.packageBaseDirs.map(function(ea){return ea.asDirectory();});this.individualPackageDirs=this.individualPackageDirs.map(function(ea){return ea.asDirectory();});this.devPackageDirs=this.devPackageDirs.map(function(ea){return ea.asDirectory();});discovered={};_context80.prev=8;_iterator43=_createForOfIteratorHelper(this.packageBaseDirs);_context80.prev=10;_iterator43.s();case 12:if((_step43=_iterator43.n()).done){_context80.next=58;break;}dir=_step43.value;_context80.t0=_createForOfIteratorHelper;_context80.next=17;return dir.dirList(1);case 17:_context80.t1=_context80.sent;_iterator46=(0,_context80.t0)(_context80.t1);_context80.prev=19;_iterator46.s();case 21:if((_step46=_iterator46.n()).done){_context80.next=48;break;}dirWithVersions=_step46.value;_context80.t2=_createForOfIteratorHelper;_context80.next=26;return dirWithVersions.dirList(1);case 26:_context80.t3=function(ea){return ea.isDirectory();};_context80.t4=_context80.sent.filter(_context80.t3);_iterator47=(0,_context80.t2)(_context80.t4);_context80.prev=29;_iterator47.s();case 31:if((_step47=_iterator47.n()).done){_context80.next=38;break;}subDir=_step47.value;_context80.next=35;return this._discoverPackagesIn(subDir,discovered,"packageCollectionDirs");case 35:discovered=_context80.sent;case 36:_context80.next=31;break;case 38:_context80.next=43;break;case 40:_context80.prev=40;_context80.t5=_context80["catch"](29);_iterator47.e(_context80.t5);case 43:_context80.prev=43;_iterator47.f();return _context80.finish(43);case 46:_context80.next=21;break;case 48:_context80.next=53;break;case 50:_context80.prev=50;_context80.t6=_context80["catch"](19);_iterator46.e(_context80.t6);case 53:_context80.prev=53;_iterator46.f();return _context80.finish(53);case 56:_context80.next=12;break;case 58:_context80.next=63;break;case 60:_context80.prev=60;_context80.t7=_context80["catch"](10);_iterator43.e(_context80.t7);case 63:_context80.prev=63;_iterator43.f();return _context80.finish(63);case 66:_iterator44=_createForOfIteratorHelper(this.individualPackageDirs);_context80.prev=67;_iterator44.s();case 69:if((_step44=_iterator44.n()).done){_context80.next=76;break;}_dir=_step44.value;_context80.next=73;return this._discoverPackagesIn(_dir,discovered,"individualPackageDirs");case 73:discovered=_context80.sent;case 74:_context80.next=69;break;case 76:_context80.next=81;break;case 78:_context80.prev=78;_context80.t8=_context80["catch"](67);_iterator44.e(_context80.t8);case 81:_context80.prev=81;_iterator44.f();return _context80.finish(81);case 84:_iterator45=_createForOfIteratorHelper(this.devPackageDirs);_context80.prev=85;_iterator45.s();case 87:if((_step45=_iterator45.n()).done){_context80.next=94;break;}_dir2=_step45.value;_context80.next=91;return this._discoverPackagesIn(_dir2,discovered,"devPackageDirs");case 91:discovered=_context80.sent;case 92:_context80.next=87;break;case 94:_context80.next=99;break;case 96:_context80.prev=96;_context80.t9=_context80["catch"](85);_iterator45.e(_context80.t9);case 99:_context80.prev=99;_iterator45.f();return _context80.finish(99);case 102:for(url in discovered){_discovered$url=discovered[url],pkg=_discovered$url.pkg,config=_discovered$url.config,covered=_discovered$url.covered;this.System.debug&&console.log("[PackageRegistry] Adding discovered package ".concat(url," (from ").concat(covered,")"));this._addPackageWithConfig(pkg,config,url+"/",covered);}this._updateLatestPackages();deferred.resolve();_context80.next=110;break;case 107:_context80.prev=107;_context80.t10=_context80["catch"](8);deferred.reject(_context80.t10);case 110:_context80.prev=110;this._readyPromise=null;this.resetByURL();classHolder.ModulePackageMapping.forSystem(this.System).clearCache();return _context80.finish(110);case 115:return _context80.abrupt("return",this);case 116:case"end":return _context80.stop();}}},_callee80,this,[[8,107,110,115],[10,60,63,66],[19,50,53,56],[29,40,43,46],[67,78,81,84],[85,96,99,102]]);}));function update(){return _update.apply(this,arguments);}return update;}()},{key:"addPackageAt",value:function(){var _addPackageAt=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee81(url){var preferedLocation,existingPackageMap,urlString,discovered,discoveredURL,_discovered$discovere,pkg,config,covered,_args81=arguments;return regeneratorRuntime.wrap(function _callee81$(_context81){while(1){switch(_context81.prev=_context81.next){case 0:preferedLocation=_args81.length>1&&_args81[1]!==undefined?_args81[1]:"individualPackageDirs";existingPackageMap=_args81.length>2?_args81[2]:undefined;urlString=url.isResource?url.url:url;if(urlString.endsWith("/"))urlString.slice(0,-1);if(!this.byURL[urlString]){_context81.next=6;break;}throw new Error("package in ".concat(urlString," already added to registry"));case 6:_context81.next=8;return this._discoverPackagesIn(ensureResource(url).asDirectory(),{},undefined,existingPackageMap);case 8:discovered=_context81.sent;_context81.t0=regeneratorRuntime.keys(discovered);case 10:if((_context81.t1=_context81.t0()).done){_context81.next=18;break;}discoveredURL=_context81.t1.value;if(!this.byURL[discoveredURL]){_context81.next=14;break;}return _context81.abrupt("continue",10);case 14:_discovered$discovere=discovered[discoveredURL],pkg=_discovered$discovere.pkg,config=_discovered$discovere.config,covered=this._addPackageDir(discoveredURL,preferedLocation,true/*uniqCheck*/);this._addPackageWithConfig(pkg,config,discoveredURL+"/",covered);_context81.next=10;break;case 18:this.resetByURL();classHolder.ModulePackageMapping.forSystem(this.System).clearCache();this._updateLatestPackages();return _context81.abrupt("return",this.findPackageWithURL(url));case 22:case"end":return _context81.stop();}}},_callee81,this);}));function addPackageAt(_x84){return _addPackageAt.apply(this,arguments);}return addPackageAt;}()},{key:"removePackage",value:function removePackage(pkg){var updateLatestPackage=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var url=pkg.url,name=pkg.name,version=pkg.version,dir=ensureResource(url),known=this.coversDirectory(dir);if(known==="devPackageDirs")this.devPackageDirs=this.devPackageDirs.filter(function(ea){return!ea.equals(dir);});else if(known==="individualPackageDirs")this.individualPackageDirs=this.individualPackageDirs.filter(function(ea){return!ea.equals(dir);});var packageMap=this.packageMap;if(packageMap[name]){delete packageMap[name].versions[version];if(Object.keys(packageMap[name].versions).length===0)delete packageMap[name];}this.resetByURL();classHolder.ModulePackageMapping.forSystem(this.System).clearCache();if(updateLatestPackage)this._updateLatestPackages(pkg.name);}},{key:"updateNameAndVersionOf",value:function updateNameAndVersionOf(pkg,oldName,oldVersion,newName,newVersion){var packageMap=this.packageMap;if(!packageMap[oldName]){console.warn("[PackageRegistry>>updateNameAndVersionOf] ".concat(oldName,"@").concat(oldVersion," not found in registry (").concat(pkg.url,")"));}else if(!packageMap[oldName].versions[oldVersion]){console.warn("[PackageRegistry>>updateNameAndVersionOf] No version entry ".concat(oldVersion," of ").concat(oldName," found in registry (").concat(pkg.url,")"));}this._addToPackageMap(pkg,newName,newVersion);if(packageMap[oldName]&&packageMap[oldName].versions[oldVersion]){delete packageMap[oldName].versions[oldVersion];if(Object.keys(packageMap[oldName].versions).length===0)delete packageMap[oldName];}this._updateLatestPackages(pkg.name);}// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
},{key:"_updateLatestPackages",value:function _updateLatestPackages(name){var packageMap=this.packageMap;if(name&&packageMap[name]){packageMap[name].latest=last(exports$D.sort(Object.keys(packageMap[name].versions),true));return;}for(var eaName in packageMap){packageMap[eaName].latest=last(exports$D.sort(Object.keys(packageMap[eaName].versions),true));}}},{key:"_discoverPackagesIn",value:function(){var _discoverPackagesIn2=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee82(dir,discovered,covered){var existingPackageMap,url,pkg,config,name,_version5,_args82=arguments;return regeneratorRuntime.wrap(function _callee82$(_context82){while(1){switch(_context82.prev=_context82.next){case 0:existingPackageMap=_args82.length>3&&_args82[3]!==undefined?_args82[3]:null;if(dir.isDirectory()){_context82.next=3;break;}return _context82.abrupt("return",discovered);case 3:url=dir.asFile().url;if(!discovered.hasOwnProperty(url)){_context82.next=6;break;}return _context82.abrupt("return",discovered);case 6:_context82.prev=6;pkg=existingPackageMap&&existingPackageMap[url]||new Package(this.System,url);_context82.next=10;return pkg.tryToLoadPackageConfig();case 10:config=_context82.sent;pkg.setConfig(config);discovered[url]={pkg:pkg,config:config,covered:covered};if(this.System.debug){name=config.name,_version5=config.version;console.log("[lively.modules] package ".concat(name,"@").concat(_version5," discovered in ").concat(dir.url));}return _context82.abrupt("return",discovered);case 17:_context82.prev=17;_context82.t0=_context82["catch"](6);return _context82.abrupt("return",discovered);case 20:case"end":return _context82.stop();}}},_callee82,this,[[6,17]]);}));function _discoverPackagesIn(_x85,_x86,_x87){return _discoverPackagesIn2.apply(this,arguments);}return _discoverPackagesIn;}()},{key:"_addToPackageMap",value:function _addToPackageMap(pkg,name,version){var allowOverride=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(!name)throw new Error("Cannot add package without name");// if (!version) throw new Error(`Cannot add package without version`);
if(!version)version="0.0.0";var packageMap=this.packageMap,packageEntry=packageMap[name]||(packageMap[name]={versions:{},latest:null}),isOverride=packageEntry.versions[version];if(isOverride){var msg="Redefining version ".concat(version," of package ").concat(pkg.url);if(!allowOverride)throw new Error(msg+" not allowed");else console.warn(msg);}packageEntry.versions[version]=pkg;}},{key:"_addPackageWithConfig",value:function _addPackageWithConfig(pkg,config,dir){var covered=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!covered){// if (oldLocation === "devPackageDirs") this.devPackageDirs.push(dir);
this._addPackageDir(dir,"individualPackageDirs"/*preferedLocation*/,true/*uniqCheck*/);}pkg.registerWithConfig(config);this._addToPackageMap(pkg,pkg.name,pkg.version);return pkg;}},{key:"_addPackageDir",value:function _addPackageDir(dir){var preferedLocation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"individualPackageDirs";var uniqCheck=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;dir=ensureResource(dir).asDirectory();if(preferedLocation==="packageCollectionDirs"||preferedLocation==="maybe packageCollectionDirs"){var covers=this.coversDirectory(dir)||"";if(covers.includes("packageCollectionDirs"))return"packageCollectionDirs";}var prop=preferedLocation,dirs=this[prop].concat(dir);this[prop]=uniqCheck?uniqBy(dirs,function(a,b){return a.equals(b);}):dirs;return prop;}},{key:"byURL",get:function get(){if(!this._byURL){this._byURL={};var _iterator48=_createForOfIteratorHelper(this.allPackages()),_step48;try{for(_iterator48.s();!(_step48=_iterator48.n()).done;){var _p5=_step48.value;this._byURL[_p5.url]=_p5;}}catch(err){_iterator48.e(err);}finally{_iterator48.f();}}return this._byURL;}}]);return PackageRegistry;}();/*global System*/ // Computes exports of all modules
//
// Returns a list of objects like
// {
//   exported: "Interface",
//   fromModule: null, // if re-exported
//   isMain: true,     // is the exporting module the main module of its package?
//   local: "Interface",
//   moduleId: "http://localhost:9001/node_modules/lively-system-interface/index.js",
//   packageName: "lively-system-interface",
//   packageURL: "http://localhost:9001/node_modules/lively-system-interface",
//   packageVersion: "0.2.0",
//   pathInPackage: "index.js",
//   type: "class"
// }
//
// Usage
// var exports = await ExportLookup.run(System)
// ExportLookup._forSystemMap.has(System)
var ExportLookup=/*#__PURE__*/function(){_createClass(ExportLookup,null,[{key:"forSystem",value:function forSystem(System){if(!this._forSystemMap)this._forSystemMap=new WeakMap();var lookup=this._forSystemMap.get(System);if(lookup)return lookup;lookup=new this(System);this._forSystemMap.set(System,lookup);return lookup;}},{key:"run",value:function run(){var _System=arguments.length>0&&arguments[0]!==undefined?arguments[0]:System;var options=arguments.length>1?arguments[1]:undefined;return this.forSystem(_System).systemExports(options);}},{key:"findExportOfValue",value:function(){var _findExportOfValue=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee83(value){var _System,exports,_args83=arguments;return regeneratorRuntime.wrap(function _callee83$(_context83){while(1){switch(_context83.prev=_context83.next){case 0:_System=_args83.length>1&&_args83[1]!==undefined?_args83[1]:System;_context83.next=3;return this.run(_System);case 3:exports=_context83.sent;return _context83.abrupt("return",exports.find(function(_ref22){var local=_ref22.local,moduleId=_ref22.moduleId;var m=module$1(_System,moduleId),values=m.recorder||_System.get(m.id)||{};try{return values[local]===value;}catch(e){return false;}}));case 5:case"end":return _context83.stop();}}},_callee83,this);}));function findExportOfValue(_x88){return _findExportOfValue.apply(this,arguments);}return findExportOfValue;}()}]);function ExportLookup(System){_classCallCheck(this,ExportLookup);this.System=System;this.subscribeToSystemChanges();}_createClass(ExportLookup,[{key:"subscribeToSystemChanges",value:function subscribeToSystemChanges(){var _this37=this;if(this._notificationHandlers)return;var S=this.System;this._notificationHandlers=[subscribe("lively.modules/moduleloaded",function(evt){return _this37.clearCacheFor(evt.module);},S),subscribe("lively.modules/modulechanged",function(evt){return _this37.clearCacheFor(evt.module);},S),subscribe("lively.vm/doitresult",function(evt){return _this37.clearCacheFor(evt.targetModule);},S)];}},{key:"unsubscribeFromSystemChanges",value:function unsubscribeFromSystemChanges(){if(!this._notificationHandlers)return;var S=this.System;unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],S);unsubscribe("lively.modules/modulechanged",this._notificationHandlers[1],S);unsubscribe("lively.vm/doitresult",this._notificationHandlers[2],S);this._notificationHandlers=null;}},{key:"clearCacheFor",value:function clearCacheFor(moduleId){this.exportByModuleCache[moduleId]=null;}},{key:"systemExports",value:function(){var _systemExports=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee84(options){var _this38=this;var exportsByModule;return regeneratorRuntime.wrap(function _callee84$(_context84){while(1){switch(_context84.prev=_context84.next){case 0:_context84.next=2;return this.rawExportsByModule(options);case 2:exportsByModule=_context84.sent;Object.keys(exportsByModule).forEach(function(id){return _this38.resolveExportsOfModule(id,exportsByModule);});return _context84.abrupt("return",flatmap(Object.keys(exportsByModule),function(id){return exportsByModule[id]?exportsByModule[id].resolvedExports||exportsByModule[id].rawExports:[];}));case 5:case"end":return _context84.stop();}}},_callee84,this);}));function systemExports(_x89){return _systemExports.apply(this,arguments);}return systemExports;}()},{key:"rawExportsByModule",value:function(){var _rawExportsByModule=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee85(options){var _this39=this;var System,livelyEnv,mods,cache,exportsByModule,progressLogger;return regeneratorRuntime.wrap(function _callee85$(_context85){while(1){switch(_context85.prev=_context85.next){case 0:options=options||{};System=this.System,livelyEnv=System.get("@lively-env")||{},mods=Object.keys(livelyEnv.loadedModules||{}),cache=this.exportByModuleCache,exportsByModule={},progressLogger=function progressLogger(i){if(i%50<1&&options.progress.step)options.progress.step("Scanning ...",i/mods.length);};_context85.next=4;return Promise.all(mods.map(function(moduleId,i){if(options.progress)progressLogger(i);return _this39.rawExportsOfModule(moduleId,options,exportsByModule).then(function(result){return result?exportsByModule[moduleId]=result:null;});}));case 4:return _context85.abrupt("return",exportsByModule);case 5:case"end":return _context85.stop();}}},_callee85,this);}));function rawExportsByModule(_x90){return _rawExportsByModule.apply(this,arguments);}return rawExportsByModule;}()},{key:"rawExportsOfModule",value:function(){var _rawExportsOfModule=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee86(moduleId){var opts,System,cache,excludedPackages,excludedURLs,excludeFns,excludedPackageURLs,livelyEnv,mods,_result2,mod,pathInPackage,p,isMain,packageURL,packageName,packageVersion,result,format,_values,key,_args86=arguments;return regeneratorRuntime.wrap(function _callee86$(_context86){while(1){switch(_context86.prev=_context86.next){case 0:opts=_args86.length>1&&_args86[1]!==undefined?_args86[1]:{};System=this.System,cache=this.exportByModuleCache,excludedPackages=opts.excludedPackages||[],excludedURLs=opts.excludedURLs||(opts.excludedURLs=excludedPackages.filter(function(ea){return typeof ea==="string";})),excludeFns=opts.excludeFns||(opts.excludeFns=excludedPackages.filter(function(ea){return typeof ea==="function";})),excludedPackageURLs=opts.excludedPackageURLs||(opts.excludedPackageURLs=excludedURLs.concat(excludedURLs.map(function(url){return System.decanonicalize(url.replace(/\/?$/,"/")).replace(/\/$/,"");}))),livelyEnv=opts.livelyEnv||(opts.livelyEnv=System.get("@lively-env")||{}),mods=opts.modes||(opts.modes=Object.keys(livelyEnv.loadedModules||{}));if(!cache[moduleId]){_context86.next=5;break;}_result2=cache[moduleId].rawExports;return _context86.abrupt("return",excludedPackageURLs.includes(_result2.packageURL)||excludeFns.some(function(fn){return fn(_result2.packageURL);})?null:cache[moduleId]);case 5:mod=module$1(System,moduleId),pathInPackage=mod.pathInPackage(),p=mod["package"](),isMain=p&&p.main&&pathInPackage===p.main,packageURL=p?p.url:"",packageName=p?p.name:"",packageVersion=p?p.version:"",result={moduleId:moduleId,isMain:isMain,pathInPackage:pathInPackage,packageName:packageName,packageURL:packageURL,packageVersion:packageVersion,exports:[]};if(!(excludedPackageURLs.includes(packageURL)||excludeFns.some(function(fn){return fn(packageURL);}))){_context86.next=8;break;}return _context86.abrupt("return",null);case 8:_context86.prev=8;format=mod.format();if(!["register","es6","esm"].includes(format)){_context86.next=16;break;}_context86.next=13;return mod.exports();case 13:result.exports=_context86.sent;_context86.next=28;break;case 16:_context86.next=18;return mod.load();case 18:_values=_context86.sent;result.exports=[];_context86.t0=regeneratorRuntime.keys(_values);case 21:if((_context86.t1=_context86.t0()).done){_context86.next=28;break;}key=_context86.t1.value;if(!(key==="__useDefault"||key==="default")){_context86.next=25;break;}return _context86.abrupt("continue",21);case 25:result.exports.push({exported:key,local:key,type:"id"});_context86.next=21;break;case 28:_context86.next=33;break;case 30:_context86.prev=30;_context86.t2=_context86["catch"](8);result.error=_context86.t2;case 33:return _context86.abrupt("return",cache[moduleId]={rawExports:result});case 34:case"end":return _context86.stop();}}},_callee86,this,[[8,30]]);}));function rawExportsOfModule(_x91){return _rawExportsOfModule.apply(this,arguments);}return rawExportsOfModule;}()},{key:"resolveExportsOfModule",value:function resolveExportsOfModule(moduleId,exportsByModule){var _this40=this;var locked=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};// takes the `rawExports` in `exportsByModule` that was produced by
// `rawExportsByModule` and resolves all "* from" exports. Extends the
// `rawExportsByModule` map with a `resolvedExports` property
// prevent endless recursion
if(locked[moduleId])return;locked[moduleId]=true;var data=exportsByModule[moduleId];if(!data||data.resolvedExports)return;var System=this.System;var base=select(data.rawExports,["moduleId","isMain","packageName","packageURL","packageVersion","pathInPackage"]);data.resolvedExports=flatmap(data.rawExports.exports,function(_ref23){var type=_ref23.type,exported=_ref23.exported,local=_ref23.local,fromModule=_ref23.fromModule;if(type!=="all")return[_objectSpread(_objectSpread({},base),{},{type:type,exported:exported,local:local,fromModule:fromModule})];// resolve "* from"
var fromId=System.decanonicalize(fromModule,moduleId);_this40.resolveExportsOfModule(fromId,exportsByModule,locked);return(exportsByModule[fromId]&&exportsByModule[fromId].resolvedExports||[]).map(function(resolvedExport){var type=resolvedExport.type,exported=resolvedExport.exported,local=resolvedExport.local,resolvedFromModule=resolvedExport.fromModule;return _objectSpread(_objectSpread({},base),{},{type:type,exported:exported,local:local,fromModule:resolvedFromModule||fromModule});});});locked[moduleId]=false;}},{key:"exportByModuleCache",get:function get(){return this._exportByModuleCache||(this._exportByModuleCache={});}}]);return ExportLookup;}();function buildPackageMap(_x92){return _buildPackageMap.apply(this,arguments);}function _buildPackageMap(){_buildPackageMap=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee98(dir){var options,map,depth,maxDepth,excludes,config,key,node_modules,_iterator50,_step50,url,_args98=arguments;return regeneratorRuntime.wrap(function _callee98$(_context98){while(1){switch(_context98.prev=_context98.next){case 0:options=_args98.length>1&&_args98[1]!==undefined?_args98[1]:{maxDepth:0,excludes:[]};map=_args98.length>2&&_args98[2]!==undefined?_args98[2]:{};depth=_args98.length>3&&_args98[3]!==undefined?_args98[3]:0;// fetches the package.json config of dir and stores version and dependencies
// into package map. Recursively searches in node_modules either until
// maxDepth is reached or all packages have been visited. Since the
// name@version is used for testing if package was seen, can deal with cyclic
// symlinks.
// Return value looks like
//    { 'lively.server@0.1.0': 
//       { url: 'file:///Users/robert/Lively/lively-dev/lively.server',
//         name: 'lively.server',
//         version: '0.1.0',
//         dependencies: 
//          { 'lively.modules': '*',
//            'socket.io': '^1.5.1' },
//         devDependencies: { 'mocha-es6': '*' },
//         main: undefined } }
maxDepth=options.maxDepth,excludes=options.excludes;if(!(maxDepth>0&&depth>maxDepth)){_context98.next=6;break;}return _context98.abrupt("return",map);case 6:_context98.prev=6;_context98.t0=JSON;_context98.next=10;return resource(dir).join("package.json").read();case 10:_context98.t1=_context98.sent;config=_context98.t0.parse.call(_context98.t0,_context98.t1);key="".concat(config.name,"@").concat(config.version);if(!(map[key]||excludes.includes(config.name))){_context98.next=15;break;}return _context98.abrupt("return",map);case 15:map[key]=_objectSpread({url:dir},select(config,["name","version","dependencies","devDependencies","main"]));_context98.next=21;break;case 18:_context98.prev=18;_context98.t2=_context98["catch"](6);return _context98.abrupt("return",map);case 21:_context98.prev=21;_context98.next=24;return resource(dir).join("node_modules").dirList(1);case 24:node_modules=_context98.sent;_context98.next=30;break;case 27:_context98.prev=27;_context98.t3=_context98["catch"](21);return _context98.abrupt("return",map);case 30:_iterator50=_createForOfIteratorHelper(node_modules);_context98.prev=31;_iterator50.s();case 33:if((_step50=_iterator50.n()).done){_context98.next=40;break;}url=_step50.value.url;_context98.next=37;return buildPackageMap(url,options,map,depth+1);case 37:map=_context98.sent;case 38:_context98.next=33;break;case 40:_context98.next=45;break;case 42:_context98.prev=42;_context98.t4=_context98["catch"](31);_iterator50.e(_context98.t4);case 45:_context98.prev=45;_iterator50.f();return _context98.finish(45);case 48:return _context98.abrupt("return",map);case 49:case"end":return _context98.stop();}}},_callee98,null,[[6,18],[21,27],[31,42,45,48]]);}));return _buildPackageMap.apply(this,arguments);}function resolvePackageDependencies(pkg,packageMap){// util.inspect(resolvePackageDependencies(packageMap["socket.io@1.5.1"], packageMap))
// =>
// "{ debug: 'debug@2.2.0',
//   'engine.io': 'engine.io@1.7.2', ...}
var deps=_objectSpread(_objectSpread({},pkg.dependencies),pkg.devDependencies);return Object.keys(deps).reduce(function(depMap,depName){var depVersion=deps[depName],_ref24=values(packageMap).find(function(_ref25){var name=_ref25.name,version=_ref25.version;return name===depName&&lively.modules.semver.satisfies(version,depVersion);})||{},name=_ref24.name,version=_ref24.version;depMap[depName]=name?"".concat(name,"@").concat(version):undefined;return depMap;},{});}function dependencyGraph(packageMap){// builds dependency graph of package-name@version tuples:
// {'lively.server@0.1.0':  ['lively.modules@0.5.41', ...],
//  'lively.modules@0.5.41': [...]}
var packages=values(packageMap),cachedVersionQueries={};return Object.keys(packageMap).reduce(function(depMap,name){var pkg=packageMap[name],deps=_objectSpread(_objectSpread({},pkg.dependencies),pkg.devDependencies);depMap[name]=Object.keys(deps).map(function(depName){return findAvailablePackage(depName,deps[depName]);}).filter(function(ea){return!!ea;});return depMap;},{});function findAvailablePackage(depName,depVersionRange){var cacheKey="".concat(depName,"@").concat(depVersionRange);if(cacheKey in cachedVersionQueries)return cachedVersionQueries[cacheKey];var _ref26=packages.find(function(_ref27){var name=_ref27.name,version=_ref27.version;return name===depName&&lively.modules.semver.satisfies(version,depVersionRange);})||{},name=_ref26.name,version=_ref26.version;return cachedVersionQueries[cacheKey]=name?"".concat(name,"@").concat(version):undefined;}}var dependencies=/*#__PURE__*/Object.freeze({__proto__:null,buildPackageMap:buildPackageMap,resolvePackageDependencies:resolvePackageDependencies,dependencyGraph:dependencyGraph});// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
// This deals with which modules are mapped to which packages. There is
// actually not a static ownership of packages to modules but based on the
// currently loaded packages we compute what modules are mapped to which package
// based on the module id / url and the package url. Since it is to expensive
// to compute every time a module wants to know its package or a package its
// modules we have a cache that is invalidated whenever new packages are loaded or
// existing ones removed.
var ModulePackageMapping=/*#__PURE__*/function(){_createClass(ModulePackageMapping,null,[{key:"forSystem",value:function forSystem(System){var existing=System["__lively.modules__modulePackageMapCache"];if(existing)return existing;var instance=new this(System);System["__lively.modules__modulePackageMapCache"]=instance;return instance;}}]);function ModulePackageMapping(System){_classCallCheck(this,ModulePackageMapping);this.System=System;this._notificationHandlers=null;this.clearCache();this.subscribeToSystemChanges();}_createClass(ModulePackageMapping,[{key:"subscribeToSystemChanges",value:function subscribeToSystemChanges(){var _this41=this;if(this._notificationHandlers)return;var S=this.System;this._notificationHandlers=[subscribe("lively.modules/moduleloaded",function(evt){return _this41.addModuleIdToCache(evt.module);},S),subscribe("lively.modules/moduleunloaded",function(evt){return _this41.removeModuleFromCache(evt.module);},S),subscribe("lively.modules/packageregistered",function(evt){return _this41.clearCache();},S),subscribe("lively.modules/packageremoved",function(evt){return _this41.clearCache();},S)];}},{key:"unsubscribeFromSystemChanges",value:function unsubscribeFromSystemChanges(){if(!this._notificationHandlers)return;var S=this.System;unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],S),unsubscribe("lively.modules/moduleunloaded",this._notificationHandlers[1],S),unsubscribe("lively.modules/packageregistered",this._notificationHandlers[2],S),unsubscribe("lively.modules/packageremoved",this._notificationHandlers[3],S);this._notificationHandlers=null;}},{key:"clearCache",value:function clearCache(){this._cacheInitialized=false;this.packageToModule={};this.modulesToPackage={};this.modulesWithoutPackage={};}},{key:"ensureCache",value:function ensureCache(){// The cache is invalidated when packages are added or removed.
// If a new module gets loaded it is added to the caches.
// When a module gets removed it is also removed from both maps.
var System=this.System,_cacheInitialized=this._cacheInitialized,packageToModule=this.packageToModule,modulesToPackage=this.modulesToPackage,modulesWithoutPackage=this.modulesWithoutPackage;if(_cacheInitialized)return this;var packageNames=classHolder.Package.allPackageURLs(System);for(var j=0;j<packageNames.length;j++){packageToModule[packageNames[j]]=[];}// bulk load the cache
var modules=knownModuleNames(System);for(var _i109=0;_i109<modules.length;_i109++){var moduleId=modules[_i109],itsPackage=void 0;for(var _j3=0;_j3<packageNames.length;_j3++){var packageName=packageNames[_j3];if(moduleId.startsWith(packageName)&&(!itsPackage||itsPackage.length<packageName.length))itsPackage=packageName;}if(!itsPackage){modulesWithoutPackage[moduleId]={};}else{packageToModule[itsPackage].push(moduleId);modulesToPackage[moduleId]=itsPackage;}}this._cacheInitialized=true;return this;}},{key:"addModuleIdToCache",value:function addModuleIdToCache(moduleId){this.ensureCache();var packageToModule=this.packageToModule,modulesToPackage=this.modulesToPackage,modulesWithoutPackage=this.modulesWithoutPackage;if(modulesToPackage[moduleId])return modulesToPackage[moduleId];if(modulesWithoutPackage[moduleId])return null;var packageNames=Object.keys(packageToModule),itsPackage;for(var j=0;j<packageNames.length;j++){var packageName=packageNames[j];if(moduleId.startsWith(packageName)&&(!itsPackage||itsPackage.length<packageName.length))itsPackage=packageName;}if(!itsPackage){modulesWithoutPackage[moduleId]={};return null;}else{var _modules=packageToModule[itsPackage]||(packageToModule[itsPackage]=[]);_modules.push(moduleId);return modulesToPackage[moduleId]=itsPackage;}}},{key:"removeModuleFromCache",value:function removeModuleFromCache(moduleId){if(!this._cacheInitialized)return;var packageToModule=this.packageToModule,modulesToPackage=this.modulesToPackage,modulesWithoutPackage=this.modulesWithoutPackage;if(modulesWithoutPackage.hasOwnProperty(moduleId)){delete modulesWithoutPackage[moduleId];return;}var itsPackage=modulesToPackage[moduleId];if(!itsPackage)return;delete modulesToPackage[moduleId];if(packageToModule[itsPackage])_remove4(packageToModule[itsPackage],moduleId);}},{key:"getPackageURLForModuleId",value:function getPackageURLForModuleId(moduleId){return this.modulesToPackage[moduleId]||this.addModuleIdToCache(moduleId);}},{key:"getModuleIdsForPackageURL",value:function getModuleIdsForPackageURL(packageURL){this.ensureCache();return this.packageToModule[packageURL]||[];}}]);return ModulePackageMapping;}();/*

  ### `lively.modules.importPackage(packageName)`

  To load a project into your runtime you will typically use
  `lively.modules.importPackage('some-package-name')`. `'some-package-name'`
  should resolve to a directory with a JSON package config file (typically
  package.json) that at least defines a `name` field. The package will be
  imported, i.e. the main module of the package will be loaded via
  `lively.modules.System.import('some-package-name/index.js')`. By default the
  name of main is `'index.js'` but this can be customized via the `main` field
  of the package config file.

  The result of the importPackage call is the promise for loading the main module.



  #### Specifics of the lively package format

  The main purpose of the lively package format is to make it easy to integrate
  dependent packages in the lively.module and es6 module systems. It allows you
  to define a `"lively"` field in the main JSON that allows to set a separate
  main module, a `"packageMap"` object that maps names that can be used in
  `import` statements to directories of sub-packages. When sub-packages are
  discovered while importing a package, those are recursively imported as well.

  Here is an example how a config inside a package.json file could look like.

  ```json
  {
    "name": "some-package",
    "main": "main-for-non-es6.js",
    "lively": {
      "main": "for-es6.js",
      "packageMap": {
        "dep1": "./node_modules/dep1",
        "dep2": "./libs/dep2"
      }
    }
  }
  ```

  For more examples, see [lively.modules/package.json](https://github.com/LivelyKernel/lively.modules/package.json), or [lively.ast/package.json](https://github.com/LivelyKernel/lively.ast/package.json).



  ### `lively.modules.System`

  The main lively.modules interface provides access to a System loader object
  (currently from the [SystemJS library](https://github.com/systemjs/systemjs)
  that has some improvements added, e.g.   the name normalization respects the
  lively package conventions, translate is   used to instrument code by
  default, etc.

  By default the loader instance is the same as the global loader (e.g.
  window.System). Note: *The System instance can be easily changed* to support
  multiple, isolated environnments.

  Example:

  ```js
  var testSystem = lively.modules.getSystem("my-test-system");
  lively.modules.changeSystem(testSystem, true); // true: make the System global
  System.import("some-module"); // uses the new System loader
  ```

  Now all state (what modules are loaded, their metadata, etc) are stored in
  `testSystem`. Changing to another System allows to define different name
  resolution approach etc.

  Side note: Since all System related implementation functions defined in the
  modules in src/ will take a System loader object as first parameter, the
  implementation is loader independent.



  ### Loader state / module state

  - `lively.modules.loadedModules()`: Returns a list of ids of the currently loaded modules.

  - lively.modules.printSystemConfig(): Returns a stringified version of the [SystemJS config](https://github.com/systemjs/systemjs/blob/master/docs/config-api.md). Useful for debugging SystemJS issues

  #### `lively.modules.requireMap()`

  Will return a JS object whose keys are module ids and the corresponding
  values are lists of module ids of those modules that dependent on the key
  module (including the key module itself). I.e. the importers of that module.



  ### instrumentation

  By default lively.modules will hook into the `System.translate` process so that source code of modules get transformed to allow recording of their internal evaluation state (that is then captured in `moduleEnv`s). You can enable and disable this behavior via

  - `lively.modules.wrapModuleLoad()`
  - `lively.modules.unwrapModuleLoad()`



  ### evaluation

  * This is handled by the [lively.vm module](https://github.com/LivelyKernel/lively.vm)!



  ### ModuleInterface

  #### `lively.modules.module(moduleId)`

  Returns an instance of ModuleInterface with the following methods:

  ##### `ModuleInterface>>dependents()`

  Which modules (module ids) are (in)directly import module with id.

  Let's say you have

  - module1.js: `export var x = 23;`
  - module2.js: `import {x} from "module1.js"; export var y = x + 1;`
  - module3.js: `import {y} from "module2.js"; export var z = y + 1;`

  `module("module1.js").dependents()` returns [module("module2"), module("module3")]

  ##### `ModuleInterface>>requirements()`

  which modules (module ids) are (in)directly required by module with id?

  Let's say you have

  - module1: `export var x = 23;`
  - module2: `import {x} from "module1.js"; export var y = x + 1;`
  - module3: `import {y} from "module2.js"; export var z = y + 1;`

  `module("module3").requirements()` will report [module("module2"), module("module1")]

  ##### `async ModuleInterface>>changeSource(newSource, options)`

  To redefine a module's source code at runtime you can use the
  changeSource method. Given `a.js` from the previous example you can run
  `module('a.js').changeSource('var x = 24;\nexport x;')`.
  This will a) evaluate the changed code and b) try to modify the actual file
  behind the module. In browser environments this is done via a `PUT` request,
  in node.js `fs.writeFile` is used.

  ##### `async ModuleInterface>>reload(options)``

  Will re-import the module identified by `moduleName`. By default this will
  also reload all direct and indirect dependencies of that module. You can
  control that behavior via `options`, the default value of it is
  `{reloadDeps: true, resetEnv: true}`.

  ##### `ModuleInterface>>unload(options)`

  Will remove the module from the loaded module set of lively.modules.System.
  `options` are by default `{forgetDeps: true, forgetEnv: true}`.

  ##### `async ModuleInterface>>imports()` and `async ModuleInterface>>exports()`

  Import and export state. For exports this includes the local name of the
  exported variable, its export name, etc. For imports it includes the imported
  variable name, the module from where it was imported etc.

  Example:

  ```js
  await module("lively.modules/index.js").exports();
    // =>
    //   [{
    //       exported: "getSystem",
    //       local: "getSystem",
    //       fromModule: "http://localhost:9001/node_modules/lively.modules/index.js",
    //     }, ...]

  await module("lively.modules/index.js").imports();
    //   [{
    //       fromModule: "lively.lang",
    //       local: "obj",
    //       localModule: "http://localhost:9001/node_modules/lively.modules/index.js"
    //     }, {
    //       fromModule: "./src/system.js",
    //       local: "getSystem",
    //       localModule: "http://localhost:9001/node_modules/lively.modules/index.js"
    //     }, ...]
    //   })
  ```


  ##### `async ModuleInterface>>source()`

  Returns the source code of the module.

  ##### `async ModuleInterface>>env()`

  Returns the evaluation environment of the module.

  A "module env" is the object used for recording the evaluation state. Each
  module that is loaded with source instrumentation enabled as an according
  moduleEnv It is populated when the module is imported and then used and
  modified when users run evaluations using `lively.vm.runEval()` or change the module's
  code with `ModuleInterface>>changeSource()`. You can get access to the internal module
  state via `module(...).env().recorder` the recorder is a map of
  variable and function names.

  Example: When lively.modules is bootstrapped you can access the state of its
  main module via:

  ```js
  var id = System.decanonicalize("lively.modules/index.js");
  Object.keys(lively.modules.moduleEnv("lively.modules/index.js").recorder);
    // => ["defaultSystem", "changeSystem", "loadedModules", "sourceOf", "moduleEnv", ...]
  lively.modules.moduleEnv("lively.modules/index.js").recorder.changeSystem
    // => function() {...} The actual object defined in the module scope
  ```



  ### hooks

  lively.modules provides an easy way to customize the behavior of the System
  loader object via `installHook` and `removeHook`. To extend the behavior of
  of `lively.modules.System.fetch` you can for example do

  ```js
  installHook("fetch", function myFetch(proceed, load) {
    if (load.name === "my-custom-module.js") return "my.custom.code()";
    return proceed(load); // default behavior
  });
  ```
  
  ### notification
  
  There are five types of system-wide notifications:
  
  1. `{type: "lively.modules/moduleloaded", module}`
  2. `{type: "lively.modules/modulechanged", module, oldSource, newSource, error, options}`
  3. `{type: "lively.modules/moduleunloaded", module}`
  4. `{type: "lively.modules/packageregistered", package}`
  5. `{type: "lively.modules/packageremoved", package}`

  These notifications are all emitted with `lively.notifications`.

 */var GLOBAL$3=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:undefined;var defaultSystem=defaultSystem||prepareSystem(GLOBAL$3.System);function changeSystem(newSystem,makeGlobal){defaultSystem=newSystem;if(makeGlobal)GLOBAL$3.System=newSystem;return newSystem;}function wrapModuleResolution$1(){wrapModuleResolution(defaultSystem);}function unwrapModuleResolution$1(){unwrapModuleResolution(defaultSystem);}function loadedModules$1(){return Object.keys(requireMap());}function module$2(id){return module$1(defaultSystem,id);}function isModuleLoaded$1(name,isNormalized){return isModuleLoaded(defaultSystem,name,isNormalized);}function doesModuleExist$1(name,isNormalized){return doesModuleExist(defaultSystem,name,isNormalized);}function printSystemConfig$1(){return printSystemConfig(defaultSystem);}function whenLoaded$1(moduleName,callback){return whenLoaded(defaultSystem,moduleName,callback);}function importPackage$1(packageURL){return importPackage(defaultSystem,packageURL);}function registerPackage$1(packageURL,optPkgConfig){return registerPackage(defaultSystem,packageURL,optPkgConfig);}function removePackage$1(packageURL){return removePackage(defaultSystem,packageURL);}function reloadPackage$1(packageURL,opts){return reloadPackage(defaultSystem,packageURL,opts);}function getPackages(){return getPackageSpecs(defaultSystem);}function getPackage$1(packageURL){var isNormalized=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return getPackage(defaultSystem,packageURL,isNormalized);}function getPackageOfModule(moduleId){return Package.forModuleId(defaultSystem,moduleId);}function ensurePackage$1(packageURL){return ensurePackage(defaultSystem,packageURL);}function applyPackageConfig(packageConfig,packageURL){return applyConfig(defaultSystem,packageConfig,packageURL);}function lookupPackage$1(packageURL){var isNormalized=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return lookupPackage(defaultSystem,packageURL,isNormalized);}function moduleSourceChange$1(moduleName,newSource,options){return moduleSourceChange(defaultSystem,moduleName,newSource,options);}function requireMap(){return computeRequireMap(defaultSystem);}function isHookInstalled(methodName,hookOrName){return isInstalled(defaultSystem,methodName,hookOrName);}function installHook(hookName,hook){return install(defaultSystem,hookName,hook);}function removeHook(methodName,hookOrName){return remove$1(defaultSystem,methodName,hookOrName);}function wrapModuleLoad$1(){wrapModuleLoad(defaultSystem);}function unwrapModuleLoad$1(){unwrapModuleLoad(defaultSystem);}var scripting=defaultSystem._scripting={module:module$1,ensurePackage:ensurePackage,registerPackage:registerPackage,importPackage:importPackage,lookupPackage:lookupPackage,ImportInjector:ImportInjector};defaultSystem.global[defaultClassToFunctionConverterName]=initializeClass;classHolder.ModulePackageMapping=ModulePackageMapping;classHolder.Package=Package;classHolder.PackageRegistry=PackageRegistry;var modules=/*#__PURE__*/Object.freeze({__proto__:null,get System(){return defaultSystem;},getSystem:getSystem,removeSystem:removeSystem,loadedModules:loadedModules$1,printSystemConfig:printSystemConfig$1,whenLoaded:whenLoaded$1,changeSystem:changeSystem,module:module$2,doesModuleExist:doesModuleExist$1,isModuleLoaded:isModuleLoaded$1,unwrapModuleResolution:unwrapModuleResolution$1,wrapModuleResolution:wrapModuleResolution$1,importPackage:importPackage$1,registerPackage:registerPackage$1,removePackage:removePackage$1,reloadPackage:reloadPackage$1,getPackages:getPackages,getPackage:getPackage$1,getPackageOfModule:getPackageOfModule,ensurePackage:ensurePackage$1,applyPackageConfig:applyPackageConfig,lookupPackage:lookupPackage$1,PackageRegistry:PackageRegistry,moduleSourceChange:moduleSourceChange$1,requireMap:requireMap,isHookInstalled:isHookInstalled,installHook:installHook,removeHook:removeHook,wrapModuleLoad:wrapModuleLoad$1,unwrapModuleLoad:unwrapModuleLoad$1,cjs:dependencies,scripting:scripting,ExportLookup:ExportLookup,semver:exports$D});(lively||global.lively).FreezerRuntime=null;// exposing this variable should be removed from the freezer
(lively||global.lively).modules=modules;if(typeof module!=="undefined"&&typeof require==="function")module.exports=modules;
