System.register(["./__root_module__-590131e3.js"],function(Sa){var Lb,Vb,Fc,jc,sd,kd,Cd,ed,Zc,bd,yd,ke,ue,He;return{setters:[function(ld){Lb=ld.aY;Vb=ld.a;Fc=ld.r;jc=ld.Y;sd=ld.p;kd=ld.X;Cd=ld.bt;ed=ld.aX;Zc=ld.i;bd=ld.s;yd=ld.bu;ke=ld.bv;ue=ld.J;He=ld.bw}],execute:function(){function ld(ac){try{var Oa=eval("("+ec.ast.transform.wrapInFunction("var _; _ = ("+ac+")")+")()")}catch(Da){return JSON.parse(ac)}return"object"!==typeof Oa?null:Oa}function Wd(ac,Oa){var Da,ka,Ba,Ja,Fb,va,Ka,Rb,eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vc){switch(Vc.nextAddress){case 1:return Da=
Oa.world(),Vc.yield(Da.prompt("Enter package name",{requester:Oa,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:ka=Vc.yieldResult;if(!ka)throw"Canceled";Vc.setCatchFinallyBlocks(3);Ja=Dc.resource(ka);ka=Ja.name();Ba=Ja.url;Vc.leaveTryBlock(4);break;case 3:return Vc.enterCatchBlock(),Vc.yield(ac.getConfig(),5);case 5:return Fb=Vc.yieldResult.baseURL,va=Dc.resource(Fb).join(ka).asDirectory().url,Vc.yield(ac.normalize(va),6);case 6:Ba=Vc.yieldResult.replace(/\/\.js$/,
"/");case 4:return Vc.yield(Da.prompt("Confirm or change package location",{requester:Oa,input:Ba,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Ka=Vc.yieldResult;if(!Ka)throw"Canceled";Rb=Dc.resource(Ka).asDirectory();eb=Rb.asFile().url;return Vc.yield(ac.removePackage(eb),8);case 8:return Vc.yield(ac.resourceCreateFiles(eb,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+ka+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+ka+"\n\nNo description for package "+
ka+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+ka+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Vc.return(Dc.loadPackage(ac,{name:ka,address:eb,configFile:Rb.join("package.json").url,main:Rb.join("index.js").url,test:Rb.join("tests/test.js").url,type:"package"}))}})}function gc(ac,Oa,Da){Da=void 0===Da?null:Da;var ka,Ba,Ja,Fb,va,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return ka=
{name:"",address:"",type:"package"},eb.yield(ac.getConfig(),2);case 2:Ba=eb.yieldResult;if(!Da){eb.jumpTo(3);break}return eb.yield(ac.getPackage(Da),4);case 4:if(Ja=eb.yieldResult){eb.jumpTo(5);break}return eb.yield(ac.getPackageForModule(Da),6);case 6:Ja=eb.yieldResult;case 5:Fb=Ja;case 3:return eb.yield(Oa.world().prompt("What is the package directory?",{requester:Oa,input:Fb?Fb.address:Ba.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:va=eb.yieldResult;if(!va)throw"Canceled";
ka.address=va.replace(/\/$/,"");ka.url=new Dc.URL(ka.address+"/");ka.configFile=Dc.resource(ka.url).join("package.json").url;eb.setCatchFinallyBlocks(8);Ka=JSON;Rb=Ka.parse;return eb.yield(ac.moduleRead(ka.configFile),10);case 10:Rb.call(Ka,eb.yieldResult).name;eb.leaveTryBlock(9);break;case 8:eb.enterCatchBlock(),ka.name=String(ka.url).replace(/\/$/,""),ac.resourceEnsureExistance(ka.configFile,'{\n  "name": "'+ka.name+'",\n  "version": "0.1.0"\n}');case 9:return eb.return(Dc.loadPackage(ac,ka))}})}
function cd(ac,Oa,Da){var ka,Ba,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return ka=Dc.resource(Da).asFile().url,Fb.yield(ac.getPackage(ka),2);case 2:if(Ba=Fb.yieldResult){Fb.jumpTo(3);break}return Fb.yield(ac.getPackageForModule(ka),4);case 4:Ba=Fb.yieldResult;case 3:Ja=Ba;if(!Ja)throw Error("Cannot find package for "+ka);return Fb.yield(ac.reloadPackage(ka),5);case 5:if(!Oa){Fb.jumpTo(0);break}return Fb.yield(Oa.updateModuleList(),7);case 7:return Fb.yield(Oa.uiSelect(ka,
!1),8);case 8:return Fb.return(Fb.yieldResult)}})}function Bd(ac,Oa,Da,ka){var Ba,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return Fb.yield(ac.getPackage(Da),2);case 2:return Ba=Fb.yieldResult,Fb.yield((ka||$world).confirm("Unload package "+Ba.name+"?",{requester:Oa}),3);case 3:Ja=Fb.yieldResult;if(!Ja)throw"Canceled";return Fb.yield(ac.removePackage(Da),4);case 4:if(!Oa){Fb.jumpTo(0);break}return Fb.yield(Oa.updateModuleList(),6);case 6:return Fb.yield(Oa.uiSelect(null),
0)}})}function hd(ac,Oa,Da){var ka,Ba,Ja,Fb,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){switch(Ka.nextAddress){case 1:return ka=Oa.world(),Ka.yield(ac.getPackage(Da),2);case 2:return Ba=Ka.yieldResult,Ba?Ka.yield(ka.confirm("Really remove package "+Ba.name+"?",{requester:Oa}),3):($world.inform('No package "'+Da+'" found!',{requester:Oa}),Ka.return());case 3:Ja=Ka.yieldResult;if(!Ja)throw"Canceled";ac.removePackage(Da);return Ka.yield(ka.confirm("Also remove directory "+Ba.name+
" including "+Ba.modules.length+" modules?"),4);case 4:Fb=Ka.yieldResult;if(!Fb){Ka.jumpTo(0);break}return Ka.yield(ka.confirm("REALLY *remove* directory "+Ba.name+"? No undo possible..."),6);case 6:if(va=Ka.yieldResult)return Ka.yield(ac.resourceRemove(Ba.address),0);Ka.jumpTo(0)}})}function Jd(ac,Oa,Da){Da=void 0===Da?$world:Da;var ka,Ba,Ja,Fb,va,Ka,Rb,eb,Vc,Qb,qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wc){switch(Wc.nextAddress){case 1:return Wc.yield(ac.getPackage(Oa),2);case 2:ka=
Wc.yieldResult;if(!ka)throw Error("Cannot find package "+Oa);Ba=[];Ja=$jscomp.makeIterator(ka.modules);Fb=Ja.next();case 3:if(Fb.done)return Wc.yield(Da.execCommand("open text window",{title:"imports and exports of "+Oa,content:Ba.join("\n\n")}),0);va=Fb.value;if(!va.name.match(/\.js$/)){Wc.jumpTo(4);break}Wc.setCatchFinallyBlocks(6);Ka=ac;Rb=Ka.importsAndExportsOf;eb=va.name;return Wc.yield(ac.moduleRead(va.name),9);case 9:return Wc.yield(Rb.call(Ka,eb,Wc.yieldResult),8);case 8:Vc=Wc.yieldResult;
Wc.leaveTryBlock(7);break;case 6:Qb=Wc.enterCatchBlock();Da.logError(Error("Error when getting imports/exports from module "+va.name+":\n"+Qb.stack));Wc.jumpTo(4);break;case 7:qd=""+va.name;if(!Vc.imports.length&&!Vc.exports.length){qd+="\n  does not import / export anything";Wc.jumpTo(4);break}Vc.imports.length&&(qd+="\n  imports:\n",qd+=Dc.arr.groupByKey(Vc.imports,"fromModule").mapGroups(function(Mc,Hb){return"from "+Mc+": "+Hb.map(function(Xd){return Xd.local||Xd.imported?Xd.imported&&Xd.imported!==
Xd.local?Xd.imported+" as "+Xd.local:Xd.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(Mc){return"    "+Mc}).join("\n"));Vc.exports.length&&(qd+="\n  exports:\n",qd+=Vc.exports.map(function(Mc){return Mc.local?Mc.local&&Mc.local!==Mc.exported?Mc.local+" as "+Mc.exported:Mc.exported:Mc.exported+" from "+Mc.fromModule}).join(", ").split("\n").map(function(Mc){return"    "+Mc}).join("\n"));Ba.push(qd);case 4:Fb=Ja.next(),Wc.jumpTo(3)}})}function de(ac){return ac.match(/import.*['"]mocha(-es6)?['"]/)&&
ac.match(/it\(['"]/)}function Zb(ac,Oa,Da){Da=Da&&Da.address;if(Da&&0===Oa.indexOf(Da))var ka=Oa.slice(Da.length).replace(/^\//,"");else a:{Da=ac.getConfig();if(!Da||Da.constructor!==Promise)try{ka=String((new Ta.URL(Oa)).relativePathFrom(new Ta.URL(ac.getConfig().baseURL)));break a}catch(Ba){}ka=Oa}return ka}function Ic(ac,Oa,Da,ka){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return 1==Ba.nextAddress?(ka=Object.assign({targetModule:Oa},ka),Ba.yield(ac.normalize(Oa),2)):3!=Ba.nextAddress?
(Oa=Ba.yieldResult,Ba.yield(ac.moduleSourceChange(Oa,Da,ka),3)):Ba.return(Oa)})}function Ad(ac,Oa,Da,ka,Ba){ka=void 0===ka?!1:ka;Ba=void 0===Ba?!1:Ba;var Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return Oa&&Oa.setStatusMessage("Reloading "+Da),Fb.setCatchFinallyBlocks(2),Fb.yield(ac.reloadModule(Da,{reloadDeps:ka,resetEnv:Ba}),4);case 4:if(!Oa){Fb.jumpTo(5);break}return Fb.yield(Oa.updateModuleList(),6);case 6:case 5:Oa&&Oa.setStatusMessage("Reloded "+
Da);Fb.leaveTryBlock(0);break;case 2:Ja=Fb.enterCatchBlock();Fb.setCatchFinallyBlocks(7);if(!Oa){Fb.jumpTo(9);break}return Fb.yield(Oa.updateEditorWithSourceOf(Da),10);case 10:case 9:Fb.leaveTryBlock(8);break;case 7:Fb.enterCatchBlock();case 8:throw Oa&&Oa.showError(Ja),Ja;}})}function Jc(ac,Oa,Da){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ka){switch(ka.nextAddress){case 1:return ka.yield(ac.forgetModule(Da,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Oa){ka.jumpTo(3);break}return ka.yield(Oa.updateModuleList(),
4);case 4:case 3:ka.jumpToEnd()}})}function zd(ac,Oa,Da){var ka,Ba,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return Fb.yield(ac.normalize(Da),2);case 2:return ka=Fb.yieldResult,Fb.yield(Oa.world().confirm(["Really remove file:\n",{},ka,{fontStyle:"italic",fontWeight:"bold"}," ?",{}],{requester:Oa,lineWrapping:!1}),3);case 3:Ba=Fb.yieldResult;if(!Ba)throw"Canceled";return Fb.yield(ac.forgetModule(ka),4);case 4:return Fb.yield(ac.resourceRemove(ka),
5);case 5:return Fb.yield(ac.getPackageForModule(ka),6);case 6:return Ja=Fb.yieldResult,Fb.return(Ja)}})}function Mb(ac,Oa){var Da,ka,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){if(1==Ja.nextAddress)return Ja.yield(Ta._createAndLoadModules(ac,[Oa]),2);Da=Ja.yieldResult;ka=Ta.arr.compact(Da.map(function(Fb){return Fb.error}));Ba=!!ka.length;return Ja.return(Ba)})}function mb(ac,Oa,Da){var ka,Ba,Ja,Fb,va,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return ka=
Ta.URL,eb.yield(ac.getConfig(),2);case 2:Ba=new ka(eb.yieldResult.baseURL);Ja=Oa.world();if(!Da){eb.jumpTo(3);break}return eb.yield(ac.getPackage(Da),4);case 4:if(Fb=eb.yieldResult){eb.jumpTo(5);break}return eb.yield(ac.getPackageForModule(Da),6);case 6:Fb=eb.yieldResult;case 5:(va=Fb)&&(Ba=new Ta.URL(va.address));case 3:return eb.yield(Ta._searchForExistingFiles(Oa,String(Ba),va),7);case 7:Ka=eb.yieldResult;if(!Ka.includes("[create new module]")){eb.jumpTo(8);break}return eb.yield(Ta._askForModuleName(ac,
Da||String(Ba),Ja),9);case 9:Rb=eb.yieldResult,Ka=[Rb];case 8:return eb.yield(Ta._createAndLoadModules(ac,Ka),10);case 10:return eb.return(eb.yieldResult)}})}function Bc(ac,Oa){var Da,ka,Ba,Ja,Fb,va,Ka,Rb,eb,Vc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qb){if(1==Qb.nextAddress)return Qb.yield(ac.getPackage(Oa),2);if(3!=Qb.nextAddress){Da=Qb.yieldResult;if(!Da||!Da.address.match(/^http/))throw Error("Cannot load package "+Oa);ka=Ta.resource(Da.address);Ba=[];Ja=$jscomp;Fb=Ja.makeIterator;
return Qb.yield(ka.dirList(5,{exclude:Ta.modulesInPackage_defaultExclude}),3)}va=Fb.call(Ja,Qb.yieldResult);for(Ka=va.next();!Ka.done;Ka=va.next())eb=Rb=Ka.value,Vc=eb.url,Vc.match(/\.js$/)&&ac.isModuleLoaded(Vc,!0)&&Ba.push(ac.getModule(Vc));return Qb.return(Ba)})}function xc(ac){ac||(ac="local");if(ac.isSystemInterface)var Oa=ac;else"string"===typeof ac&&ac.startsWith("l2l ")&&(ac={type:"l2l",id:ac.split(" ")[1]}),"string"!==typeof ac&&"l2l"===ac.type&&(Oa=zc.l2lInterfaceFor(ac.id,ac.info)),"string"!==
typeof ac&&($world.setStatusMessage("Unknown system interface "+ac),ac="local"),Oa||(Oa=ac&&"local"!==ac?zc.serverInterfaceFor(ac):zc.localInterface);return Oa}Sa("systemInterfaceNamed",xc);var ec=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");ec.parseJsonLikeObj=ld;ec.ast=Lb;ec.parseJsonLikeObj=ld;ec.parseJsonLikeObj=ld;var Dc=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Dc.loadPackage=function(ac,Oa){var Da,ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){switch(Ba.nextAddress){case 1:return Ba.yield(ac.importPackage(Oa.address+
"/"),2);case 2:if(!Oa.main){Ba.jumpTo(3);break}return Ba.yield(ac.importModule(Oa.main.toString()),3);case 3:if(!Oa.test){Ba.jumpTo(5);break}Ba.setCatchFinallyBlocks(6);return Ba.yield(ac.importPackage("mocha-es6"),8);case 8:return Da=Ba.yieldResult,Ba.yield(Da.installSystemInstantiateHook(),9);case 9:return Ba.yield(ac.importModule(Oa.test.toString()),10);case 10:Ba.leaveTryBlock(5);break;case 6:ka=Ba.enterCatchBlock(),console.warn("Cannot load test of new package: "+ka);case 5:return Ba.return(ac.getPackage(Oa.address))}})};
Dc.interactivelyCreatePackage=Wd;Dc.interactivelyLoadPackage=gc;Dc.interactivelyReloadPackage=cd;Dc.interactivelyUnloadPackage=Bd;Dc.interactivelyRemovePackage=hd;Dc.showExportsAndImportsOf=Jd;Dc.parseJsonLikeObj=ld;Dc.arr=Vb;Dc.resource=Fc;Dc.interactivelyCreatePackage=Wd;Dc.interactivelyCreatePackage=Wd;Dc.interactivelyLoadPackage=gc;Dc.interactivelyLoadPackage=gc;Dc.interactivelyReloadPackage=cd;Dc.interactivelyReloadPackage=cd;Dc.interactivelyUnloadPackage=Bd;Dc.interactivelyUnloadPackage=Bd;
Dc.interactivelyRemovePackage=hd;Dc.interactivelyRemovePackage=hd;Dc.showExportsAndImportsOf=Jd;Dc.showExportsAndImportsOf=Jd;var Ta=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");Ta.isTestModule=de;Ta.shortModuleName=Zb;Ta.interactivelyChangeModule=Ic;Ta.interactivelyReloadModule=Ad;Ta.interactivelyUnloadModule=Jc;Ta.interactivelyRemoveModule=zd;Ta.addModule=Mb;Ta.interactivelyAddModule=mb;Ta._askForModuleName=function(ac,Oa,Da){var ka,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(Da.prompt("Enter module name",
{input:Oa,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Oa=Ja.yieldResult;if(!Oa)throw"Canceled";return Ja.yield(ac.normalize(Oa),3);case 3:return ka=Ja.yieldResult,Ja.yield(Da.confirm(["Create module \n",{},ka,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Ba=Ja.yieldResult;if(!Ba)throw"Canceled";return Ja.return(ka)}})};Ta._searchForExistingFiles=function(ac,Oa,Da){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ka){return String(Oa).match(/^http/)?ka.return(Ta._searchForExistingFilesWeb(ac,
Oa,Da)):ka.return(Ta._searchForExistingFilesManually(ac,Oa,Da))})};Ta._searchForExistingFilesManually=function(ac,Oa,Da){var ka,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(ac.world().multipleChoicePrompt("Add Module",{requester:ac,choices:["Create New Module","Load Existing Module"]}),2);case 2:ka=Ja.yieldResult;if("Create New Module"===ka)return Ja.return("[create new module]");if("Load Existing Module"!==ka){Ja.jumpTo(3);break}return Ja.yield(ac.world().prompt("URL of module?",
{input:Oa,requester:ac,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),4);case 4:if(Ba=Ja.yieldResult)return Ja.return([Ba]);case 3:throw"Canceled";}})};Ta._searchForExistingFilesWeb=function(ac,Oa,Da){function ka(eb){eb.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(eb.name())||Da&&Ta.arr.pluck(Da.modules,"name").includes(eb.url)?!0:!1}var Ba,Ja,Fb,va,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return(Ba=
ac.world())&&(Ja=Ba.showLoadingIndicatorFor(ac,"Loading existing modules...")),eb.yield(Ta.resource(Oa).dirList(5,{exclude:ka}),3);case 3:return eb.yield(eb.yieldResult.map(function(Vc){return Vc.url}),2);case 2:return Fb=eb.yieldResult,va=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Fb.filter(function(Vc){return Vc.endsWith(".js")}).map(function(Vc){return{isListItem:!0,string:Da&&0==Vc.indexOf(Da.address)?Da.name+Vc.slice(Da.address.length):Vc,value:Vc}})),eb.yield(Promise.resolve(Ja&&
Ja.remove()).then(function(){return ac.world().filterableListPrompt("What module to load?",va,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:ac},ac?{extent:ac.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Ka=eb.yieldResult;if(!Ka||"canceled"===Ka.status||!Ka.selected.length)throw"Canceled";Rb=Ka.selected||Ka;Array.isArray(Rb)||(Rb=[Rb]);return eb.return(Rb)}})};Ta._createAndLoadModules=function(ac,Oa){var Da,ka,Ba,Ja,Fb,va,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:Array.isArray(Oa)||
(Oa=[Oa]),Da=[],ka=$jscomp.makeIterator(Oa),Ba=ka.next();case 2:if(Ba.done){eb.jumpTo(4);break}Ja=Ba.value;return eb.yield(ac.forgetModule(Ja,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return eb.yield(ac.resourceEnsureExistance(Ja,'"format esm";\n'),6);case 6:return Fb=eb.yieldResult,va=Ta,Ka=va.isTestModule,eb.yield(Fb.read(),7);case 7:if(!Ka.call(va,eb.yieldResult)){eb.jumpTo(8);break}if(System.global.Mocha&&System.global.chai){eb.jumpTo(8);break}return eb.yield(System.import("mocha-es6"),10);case 10:return eb.yield(Ta.promise.waitFor(function(){return!!System.global.Mocha&&
!!System.global.chai}),8);case 8:return eb.setCatchFinallyBlocks(12),eb.yield(ac.importModule(Ja),14);case 14:Da.push({name:Ja});eb.leaveTryBlock(3);break;case 12:Rb=eb.enterCatchBlock(),Da.push({name:Ja,error:Rb});case 3:Ba=ka.next();eb.jumpTo(2);break;case 4:return eb.return(Da)}})};Ta.modulesInPackage_defaultExclude=function(ac){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(ac.name())?!0:!1};Ta.modulesInPackage=Bc;Ta.obj=jc;Ta.promise=sd;Ta.arr=Vb;Ta.resource=
Fc;Ta.isTestModule=de;Ta.isTestModule=de;Ta.shortModuleName=Zb;Ta.shortModuleName=Zb;Ta.interactivelyChangeModule=Ic;Ta.interactivelyChangeModule=Ic;Ta.interactivelyReloadModule=Ad;Ta.interactivelyReloadModule=Ad;Ta.interactivelyUnloadModule=Jc;Ta.interactivelyUnloadModule=Jc;Ta.interactivelyRemoveModule=zd;Ta.interactivelyRemoveModule=zd;Ta.addModule=Mb;Ta.addModule=Mb;Ta.interactivelyAddModule=mb;Ta.interactivelyAddModule=mb;Ta.modulesInPackage=Bc;Ta.modulesInPackage=Bc;var hc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
hc.todo=function(ac){throw Error(ac+" is not yet implemented!");};hc.parseJsonLikeObj=ld;hc.arr=Vb;hc.Closure=kd;hc.obj=jc;hc.resource=Fc;hc.transform=Cd;hc.modules=ed;var Eb=function(ac){var Oa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),Da=Oa.hasOwnProperty("AbstractCoreInterface")&&"function"===typeof Oa.AbstractCoreInterface?Oa.AbstractCoreInterface:Oa.AbstractCoreInterface=function(ka){ka&&ka[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Zc(Da,ac,[{key:"dynamicCompletionsForPrefix",value:function(ka,Ba,Ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){hc.todo("dynamicCompletionsForPrefix");Fb.jumpToEnd()})}},{key:"runEval",value:function(ka,Ba){hc.todo("runEval")}},{key:"resourceExists",value:function(ka){hc.todo("resourceExists")}},{key:"resourceEnsureExistance",value:function(ka,Ba){hc.todo("resourceEnsureExistance")}},{key:"resourceMkdir",value:function(ka){hc.todo("resourceMkdir")}},{key:"resourceRead",
value:function(ka){hc.todo("resourceRead")}},{key:"resourceRemove",value:function(ka){hc.todo("resourceRemove")}},{key:"resourceWrite",value:function(ka,Ba){hc.todo("resourceWrite")}},{key:"resourceCreateFiles",value:function(ka,Ba){hc.todo("resourceCreateFiles")}},{key:"resourceDirList",value:function(ka,Ba,Ja){hc.todo("resourceDirList")}},{key:"normalizeSync",value:function(ka,Ba,Ja){hc.todo("normalizeSync")}},{key:"normalize",value:function(ka,Ba,Ja){hc.todo("normalize")}},{key:"printSystemConfig",
value:function(){hc.todo("printSystemConfig")}},{key:"getConfig",value:function(){hc.todo("getConfig")}},{key:"setConfig",value:function(ka){hc.todo("setConfig")}},{key:"getPackages",value:function(ka){hc.todo("getPackages")}},{key:"isModuleLoaded",value:function(ka,Ba){hc.todo("isModuleLoaded")}},{key:"doesModuleExist",value:function(ka,Ba){hc.todo("doesModuleExist")}},{key:"getModules",value:function(){var ka=this,Ba,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return 1==Fb.nextAddress?
(Ba=hc.arr,Ja=Ba.flatmap,Fb.yield(ka.getPackages(),2)):Fb.return(Ja.call(Ba,Fb.yieldResult,function(va){return va.modules}))})}},{key:"getModule",value:function(ka){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return 1==Ja.nextAddress?Ja.yield(Ba.getModules(),2):Ja.return(Ja.yieldResult.find(function(Fb){return Fb.name===ka}))})}},{key:"getPackage",value:function(ka){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return 1==Ja.nextAddress?
(ka=ka.replace(/\/+$/,""),Ja.yield(Ba.getPackages(),2)):Ja.return(Ja.yieldResult.find(function(Fb){return Fb.address===ka||Fb.name===ka}))})}},{key:"getPackageForModule",value:function(ka){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("getPackageForModule");Ba.jumpToEnd()})}},{key:"systemConfChange",value:function(ka){var Ba=hc.parseJsonLikeObj(ka);["baseURL"].forEach(function(Ja){return delete Ba[Ja]});return this.setConfig(Ba)}},{key:"resourcesOfPackage",value:function(ka,
Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){hc.todo("resourcesOfPackage");Ja.jumpToEnd()})}},{key:"registerPackage",value:function(ka){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("registerPackage");Ba.jumpToEnd()})}},{key:"importPackage",value:function(ka){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("importPackage");Ba.jumpToEnd()})}},{key:"removePackage",value:function(ka){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("removePackage");
Ba.jumpToEnd()})}},{key:"reloadPackage",value:function(ka){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("reloadPackage");Ba.jumpToEnd()})}},{key:"packageConfChange",value:function(ka,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){hc.todo("packageConfChange");Ja.jumpToEnd()})}},{key:"importModule",value:function(ka){hc.todo("importModule")}},{key:"forgetModule",value:function(ka,Ba){hc.todo("forgetModule")}},{key:"reloadModule",value:function(ka,Ba){hc.todo("reloadModule")}},
{key:"moduleFormat",value:function(ka){hc.todo("moduleFormat")}},{key:"moduleRead",value:function(ka){hc.todo("moduleRead")}},{key:"moduleSourceChange",value:function(ka,Ba,Ja){hc.todo("moduleSourceChange")}},{key:"importsAndExportsOf",value:function(ka,Ba){hc.todo("importsAndExportsOf")}},{key:"keyValueListOfVariablesInModule",value:function(ka,Ba){hc.todo("keyValueListOfVariablesInModule")}},{key:"moduleWrite",value:function(ka,Ba){return this.moduleSourceChange(ka,Ba)}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"AbstractCoreInterface"}}],Oa,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:327,end:3944})}(void 0);hc.AbstractCoreInterface=Eb;hc.AbstractCoreInterface=Eb;hc.AbstractCoreInterface=Eb;var tc=function(ac){var Oa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),
Da=Oa.hasOwnProperty("RemoteCoreInterface")&&"function"===typeof Oa.RemoteCoreInterface?Oa.RemoteCoreInterface:Oa.RemoteCoreInterface=function(ka){ka&&ka[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Zc(Da,ac,[{key:Symbol.for("lively-instance-initialize"),value:function(){Zc._get(Object.getPrototypeOf(Da.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null}},{key:"runEval",value:function(ka,
Ba){throw Error("Not yet implemented");}},{key:"runEvalAndStringify",value:function(ka,Ba){var Ja=this;return this.currentEval?this.currentEval.then(function(){return Ja.runEvalAndStringify(ka,Ba)}):this.currentEval=Promise.resolve().then(function(){var Fb,va,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return eb.yield(Ja.runEval("\n        Promise.resolve((async "+hc.transform.wrapInFunction(ka)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},Ba)),2);case 2:if((Fb=eb.yieldResult)&&Fb.isError)throw Error(String(Fb.value||Fb.error));if(!Fb||!Fb.value)return eb.return(null);if(va=Fb.promisedValue){eb.jumpTo(3);break}return eb.yield(Fb.value,4);case 4:va=eb.yieldResult;case 3:Ka=va;if(!Ka)return eb.return();if("undefined"===Ka)return eb.return(void 0);if("null"===Ka)return eb.return(null);if("true"===Ka)return eb.return(!0);
if("false"===Ka)return eb.return(!1);try{Rb=JSON.parse(Ka)}catch(Vc){return eb.return(Ka)}if(Rb&&Rb.isError)throw Error(String(Rb.value));return eb.return(Rb)}})}).then(function(Fb){delete Ja.currentEval;return Fb},function(Fb){delete Ja.currentEval;return Promise.reject(Fb)})}},{key:"dynamicCompletionsForPrefix",value:function(ka,Ba,Ja){var Fb=this,va,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){va=hc.obj.isString(Ja.context)?Ja.context:!1;Ja=hc.obj.dissoc(Ja,["systemInterface",
"System","context"]);Ka="\n      var prefix = "+JSON.stringify(Ba)+",\n          opts = "+JSON.stringify(Ja)+";\n      opts.context = "+va+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Rb.return(Fb.runEvalAndStringify(Ka))})}},{key:"evalWithResource",value:function(ka,Ba,Ja){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+ka+'").'+Ba+"("+(Ja?JSON.stringify(Ja):"")+");\n    ")}},{key:"resourceExists",value:function(ka){return this.evalWithResource(ka,"exists")}},{key:"resourceEnsureExistance",value:function(ka,Ba){return this.evalWithResource(ka,
"ensureExistance",Ba)}},{key:"resourceMkdir",value:function(ka){return this.evalWithResource(ka,"mkdir")}},{key:"resourceRead",value:function(ka){return this.evalWithResource(ka,"read")}},{key:"resourceRemove",value:function(ka){return this.evalWithResource(ka,"remove")}},{key:"resourceWrite",value:function(ka,Ba){return this.evalWithResource(ka,"write",Ba)}},{key:"resourceCreateFiles",value:function(ka,Ba){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
ka+'", '+JSON.stringify(Ba)+")")}},{key:"resourceDirList",value:function(ka,Ba,Ja){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+ka+'").dirList('+JSON.stringify(Ba)+", "+JSON.stringify(Ja)+"))\n        .map(({url}) => ({url}))")}},{key:"livelySystemAccessor",value:function(ka){ka=void 0===ka?"livelySystem":ka;return"var "+ka+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
ka+') throw new Error("lively-system-interface not available!");'}},{key:"normalizeSync",value:function(ka,Ba,Ja){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(ka)+", "+JSON.stringify(Ba)+", "+Ja+")")}},{key:"normalize",value:function(ka,Ba,Ja){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(ka)+", "+JSON.stringify(Ba)+", "+JSON.stringify(Ja)+")")}},{key:"printSystemConfig",value:function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")}},
{key:"getConfig",value:function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')}},{key:"setConfig",value:function(ka){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(ka)+")")}},{key:"getPackages",value:function(ka){ka=Object.assign({excluded:[]},ka);ka.excluded=ka.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(ka)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')}},{key:"getPackageForModule",value:function(ka){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(ka)+")")}},{key:"isModuleLoaded",value:function(ka,Ba){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+ka+'", '+Ba+")")}},{key:"doesModuleExist",value:function(ka,Ba){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+ka+'", '+Ba+")")}},{key:"registerPackage",value:function(ka){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Ba.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(ka)+")"))})}},
{key:"importPackage",value:function(ka){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Ba.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(ka)+")"))})}},{key:"removePackage",value:function(ka){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Ba.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(ka)+")"))})}},{key:"reloadPackage",value:function(ka,Ba){var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return Fb.return(Ja.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(ka)+", "+JSON.stringify(Ba)+")"))})}},{key:"packageConfChange",value:function(ka,Ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(ka)+", "+JSON.stringify(Ba)+")")}},{key:"resourcesOfPackage",value:function(ka,Ba){Ba=void 0===Ba?[".git","node_modules",".module_cache","lively.next-node_modules"]:Ba;var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){ka.address&&
(ka=ka.address);return Fb.return(Ja.runEvalAndStringify("\n      "+Ja.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(ka)+", "+JSON.stringify(Ba)+");"))})}},{key:"getModule",value:function(ka){var Ba=this,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){if(1==Fb.nextAddress)return Fb.yield(Ba.getModules(),2);Ja=Fb.yieldResult.find(function(va){return va.name===ka});return Fb.return(Ja?hc.modules.module(Ja.name):null)})}},{key:"importModule",
value:function(ka){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(ka)+")")}},{key:"forgetModule",value:function(ka,Ba){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ka)+").unload("+JSON.stringify(Ba)+")")}},{key:"reloadModule",value:function(ka,Ba){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ka)+").reload("+JSON.stringify(Ba)+")")}},{key:"moduleFormat",value:function(ka){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(ka)+").format();")}},{key:"moduleRead",value:function(ka){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ka)+").source()")}},{key:"moduleSourceChange",value:function(ka,Ba,Ja){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ka)+").changeSource("+JSON.stringify(Ba)+", "+JSON.stringify(Ja)+")")}},{key:"keyValueListOfVariablesInModule",value:function(ka,Ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(ka)+", "+JSON.stringify(Ba)+")")}},{key:"importsAndExportsOf",value:function(ka,Ba){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(ka)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(ka)+").exports()})")}},{key:"exportsOfModules",value:function(ka){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(ka)+";\n      options.excludedPackages = ["+ka.excludedPackages.map(function(Ba){return"function"===
typeof Ba?Ba.toString():JSON.stringify(Ba)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")}},{key:"searchInPackage",value:function(ka,Ba,Ja){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(ka)+", "+JSON.stringify(Ba)+", "+JSON.stringify(Ja)+")")}},{key:"loadMochaTestFile",value:function(ka,Ba){Ba=void 0===Ba?[]:Ba;var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return Fb.return(Ja.runEvalAndStringify("\n      "+
Ja.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(ka)+", "+JSON.stringify(Ba)+"), result;\n      result = {testsByFile}"))})}},{key:"runMochaTests",value:function(ka,Ba,Ja,Fb){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){ka&&ka instanceof RegExp&&(ka={isRegExp:!0,value:String(ka).replace(/^\/|\/$/g,"")});return Ka.return(va.runEvalAndStringify("\n      var grep = "+JSON.stringify(ka)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
va.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(Ba||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RemoteCoreInterface"}}],Oa,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:3953,end:16249})}(hc.AbstractCoreInterface);hc.RemoteCoreInterface=tc;hc.RemoteCoreInterface=tc;hc.RemoteCoreInterface=tc;var Ec=
lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Ec.obj=jc;Ec.string=bd;Ec.arr=Vb;Ec.resource=Fc;Ec.createFiles=yd;Ec.ast=Lb;Ec.modules=ed;Ec.vm=ke;Ec.parseJsonLikeObj=ld;Ec.AbstractCoreInterface=Eb;Ec.classToFunctionTransform=ue;Eb=function(ac){var Oa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js"),Da=Oa.hasOwnProperty("LocalCoreInterface")&&"function"===typeof Oa.LocalCoreInterface?Oa.LocalCoreInterface:Oa.LocalCoreInterface=
function(ka){ka&&ka[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Zc(Da,ac,[{key:"name",get:function(){return"local"}},{key:"dynamicCompletionsForPrefix",value:function(ka,Ba,Ja){var Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return va.yield(Ec.vm.completions.getCompletions(function(Ka){return Ec.vm.runEval(Ka.replace("return ",""),Object.assign({targetModule:ka,classTransform:Ec.classToFunctionTransform},
Ja))},Ba),2);Fb=va.yieldResult;if(Fb.isError)throw Fb.value;return va.return({completions:Fb.completions,prefix:Fb.startLetters})})}},{key:"runEval",value:function(ka,Ba){return Ec.vm.runEval(ka,Object.assign({classTransform:Ec.classToFunctionTransform},Ba))}},{key:"resourceExists",value:function(ka){return Ec.resource(ka).exists()}},{key:"resourceEnsureExistance",value:function(ka,Ba){return Ec.resource(ka).ensureExistance(Ba)}},{key:"resourceMkdir",value:function(ka){return Ec.resource(ka).mkdir()}},
{key:"resourceRead",value:function(ka){return Ec.resource(ka).read()}},{key:"resourceRemove",value:function(ka){return Ec.resource(ka).remove()}},{key:"resourceWrite",value:function(ka,Ba){return Ec.resource(ka).write(Ba)}},{key:"resourceCreateFiles",value:function(ka,Ba){return Ec.createFiles(ka,Ba)}},{key:"resourceDirList",value:function(ka,Ba,Ja){return Ec.resource(ka).dirList(Ba,Ja)}},{key:"normalizeSync",value:function(ka,Ba,Ja){return System.decanonicalize(ka,Ba,Ja)}},{key:"normalize",value:function(ka,
Ba,Ja){return System.normalize(ka,Ba,Ja)}},{key:"printSystemConfig",value:function(){return Ec.modules.printSystemConfig()}},{key:"getConfig",value:function(){return System.getConfig()}},{key:"setConfig",value:function(ka){Ec.modules.System.config(ka)}},{key:"getPackages",value:function(ka){ka=Object.assign({},ka);ka=void 0===ka.excluded?[]:ka.excluded;var Ba=ka.filter(function(Fb){return"string"===typeof Fb}),Ja=ka.filter(function(Fb){return"function"===typeof Fb});Ba=Ba.concat(Ba.map(function(Fb){return System.decanonicalize(Fb.replace(/\/?$/,
"/")).replace(/\/$/,"")}));return Ec.modules.getPackages().filter(function(Fb){return!Ba.includes(Fb.url)&&!Ja.some(function(va){return va(Fb.url)})})}},{key:"registerPackage",value:function(ka){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(Ec.modules.registerPackage(ka))})}},{key:"importPackage",value:function(ka){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(Ec.modules.importPackage(ka))})}},{key:"removePackage",value:function(ka){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(Ec.modules.removePackage(ka))})}},
{key:"reloadPackage",value:function(ka,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Ec.modules.reloadPackage(ka,Ba))})}},{key:"packageConfChange",value:function(ka,Ba){var Ja=this,Fb,va,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){if(1==eb.nextAddress)return Fb=Ec.modules.System,va=Ec.parseJsonLikeObj(ka),Ka=JSON.stringify(va,null,2),eb.yield(Ec.modules.module(Ba).changeSource(Ka,{doEval:!1}),2);if(3!=eb.nextAddress)return Fb.set(Ba,
Fb.newModule(va)),eb.yield(Ja.getPackageForModule(Ba),3);(Rb=eb.yieldResult)&&Ec.modules.applyPackageConfig(va,Rb.address);eb.jumpToEnd()})}},{key:"resourcesOfPackage",value:function(ka,Ba){Ba=void 0===Ba?[".git","node_modules",".module_cache"]:Ba;var Ja,Fb,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){if(1==Ka.nextAddress)return Ka.setCatchFinallyBlocks(2),Ja=ka.address?ka.address:ka,Fb=Ec.modules.getPackage(Ja),Ka.yield(Fb.resources(void 0,Ba),4);if(2!=Ka.nextAddress)return Ka.return(Ka.yieldResult.map(function(Rb){return Object.assign(Rb,
{package:Rb.package.url})}));va=Ka.enterCatchBlock();console.warn("resourcesOfPackage error for "+ka+": "+va);return Ka.return([])})}},{key:"getPackageForModule",value:function(ka){return(ka=Ec.modules.getPackageOfModule(ka))?ka.asSpec():ka}},{key:"isModuleLoaded",value:function(ka,Ba){return Ec.modules.isModuleLoaded(ka,Ba)}},{key:"doesModuleExist",value:function(ka,Ba){return Ec.modules.isModuleLoaded(ka,Ba)}},{key:"getModule",value:function(ka){return Ec.modules.module(ka)}},{key:"importModule",
value:function(ka){return Ec.modules.System.import(ka)}},{key:"forgetModule",value:function(ka,Ba){return Ec.modules.module(ka).unload(Ba)}},{key:"reloadModule",value:function(ka,Ba){return Ec.modules.module(ka).reload(Ba)}},{key:"moduleFormat",value:function(ka){return Ec.modules.module(ka).format()}},{key:"moduleRead",value:function(ka){return Ec.modules.module(ka).source()}},{key:"moduleSourceChange",value:function(ka,Ba,Ja){return Ec.modules.module(ka).changeSource(Ba,Ja)}},{key:"keyValueListOfVariablesInModule",
value:function(ka,Ba){var Ja=this,Fb,va,Ka,Rb,eb,Vc,Qb,qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wc){switch(Wc.nextAddress){case 1:if(Ba){Wc.jumpTo(2);break}return Wc.yield(Ja.resourceRead(ka),3);case 3:Ba=Wc.yieldResult;case 2:return Fb="string"===typeof Ba?Ec.ast.parse(Ba):Ba,va=Ja.normalizeSync(ka),Ja.moduleFormat(va),Ka=Ec.modules.module(va).env().recorder,Wc.yield(Ja.importsAndExportsOf(va,Fb),4);case 4:return Rb=Wc.yieldResult,eb=Ec.ast.query.topLevelDeclsAndRefs(Fb),Vc=
Ec.arr.sortByKey(Ec.ast.query.declarationsOfScope(eb.scope,!0),"start"),Qb=Ec.arr.pluck(eb.scope.importSpecifiers,"name"),qd=0,Wc.return(Vc.map(function(Mc){var Hb=Mc.name.length,Xd=Rb.exports.find(function(Gb){return Gb.local===Mc.name}),Tb=Ec.arr.include(Qb,Mc.name);Xd&&(Hb+=9);Tb&&(Hb+=9);qd=Math.max(qd,Hb);return{isExport:Xd,isImport:Tb,name:Mc.name,value:Ka[Mc.name],node:Mc,printedName:Mc.name+(Xd?" [export]":"")+(Tb?" [import]":""),printedValue:Ec.obj.inspect(Ka[Mc.name],{maxDepth:1}).replace(/\n/g,
"")}}).map(function(Mc){return{isListItem:!0,value:Mc,string:Mc.printedName+Ec.string.indent(" = "+Mc.printedValue," ",qd-Mc.printedName.length)}}))}})}},{key:"importsAndExportsOf",value:function(ka,Ba){var Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return 1==Fb.nextAddress?Fb.yield(Ec.modules.module(ka).imports(Ba),2):3!=Fb.nextAddress?(Ja=Fb.yieldResult,Fb.yield(Ec.modules.module(ka).exports(Ba),3)):Fb.return({imports:Ja,exports:Fb.yieldResult})})}},{key:"exportsOfModules",
value:function(ka){return Ec.modules.ExportLookup.run(System,ka)}},{key:"searchInPackage",value:function(ka,Ba,Ja){return Ec.modules.getPackage(ka).search(Ba,Ja)}},{key:"runMochaTests",value:function(ka,Ba,Ja,Fb){var va,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){if(1==Rb.nextAddress)return Rb.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);va=Rb.yieldResult;Ka=va.runMochaTests;return Rb.return(Ka(ka,Ba,Ja,Fb))})}},{key:"loadMochaTestFile",value:function(ka,
Ba){var Ja,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return va.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Ja=va.yieldResult;Fb=Ja.loadMochaTestFile;return va.return(Fb(ka,Ba))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LocalCoreInterface"}}],Oa,{pathInPackage:function(){return"interfaces/local-system.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:411,end:8203})}(Ec.AbstractCoreInterface);Ec.LocalCoreInterface=Eb;Ec.LocalCoreInterface=Eb;Ec.LocalCoreInterface=Eb;var ad=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");ad.evalStrategies=He;ad.RemoteCoreInterface=tc;var td=function(ac){var Oa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js"),Da=Oa.hasOwnProperty("HTTPCoreInterface")&&
"function"===typeof Oa.HTTPCoreInterface?Oa.HTTPCoreInterface:Oa.HTTPCoreInterface=function(ka){ka&&ka[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Zc(Da,ac,[{key:Symbol.for("lively-instance-initialize"),value:function(ka){Zc._get(Object.getPrototypeOf(Da.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null;this.url=ka;this.server=new ad.evalStrategies.HttpEvalStrategy(ka)}},{key:"name",
get:function(){return this.url}},{key:"description",get:function(){return this.url.replace(/^https?:\/\//,"")}},{key:"runEval",value:function(ka,Ba){return this.server.runEval(ka,Ba)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"HTTPCoreInterface"}}],Oa,{pathInPackage:function(){return"interfaces/http-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",
version:"0.2.1"}}},{start:106,end:512})}(ad.RemoteCoreInterface);ad.HTTPCoreInterface=td;ad.HTTPCoreInterface=td;ad.HTTPCoreInterface=td;var fc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");fc.evalStrategies=He;fc.RemoteCoreInterface=tc;tc=function(ac){var Oa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js"),Da=Oa.hasOwnProperty("L2LCoreInterface")&&"function"===typeof Oa.L2LCoreInterface?Oa.L2LCoreInterface:Oa.L2LCoreInterface=
function(ka){ka&&ka[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Zc(Da,ac,[{key:Symbol.for("lively-instance-initialize"),value:function(ka,Ba){Zc._get(Object.getPrototypeOf(Da.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.targetId=ka;this.peer=Ba}},{key:"name",get:function(){return"l2l "+this.targetId}},{key:"description",get:function(){var ka=this.peer,Ba="l2l "+this.targetId.slice(0,5);if(ka){var Ja=
ka.location,Fb=ka.type,va=ka.user;ka=ka.world;Fb&&(Ba+=", "+Fb);Ja&&(Ba+=", "+Ja.replace(/^https?:\/\//,"")+(ka?"/"+ka:""));va&&(Ba+=", "+va.name)}return Ba}},{key:"client",get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}},{key:"isConnected",value:function(){var ka=this,Ba,Ja,Fb,va,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){if(1==Rb.nextAddress)return Ba=ka,Ja=Ba.client,Fb=Ba.targetId,Rb.yield(Ja.sendToAndWait(Ja.trackerId,
"getClients",{}),2);va=Rb.yieldResult;Ka=va.data;return Rb.return(Ka.some(function(eb){eb=$jscomp.makeIterator(eb).next().value;return Fb===eb}))})}},{key:"runEval",value:function(ka,Ba){var Ja=this,Fb,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){Fb=Ja.client;if(!Fb)throw Error("No lively.2lively default client available!");va=new fc.evalStrategies.L2LEvalStrategy(Fb,Ja.targetId);return Ka.return(va.runEval(ka,Ba))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"L2LCoreInterface"}}],
Oa,{pathInPackage:function(){return"interfaces/l2l-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:1449})}(fc.RemoteCoreInterface);fc.L2LCoreInterface=tc;fc.L2LCoreInterface=tc;fc.L2LCoreInterface=tc;var zc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");zc.systemInterfaceNamed=
xc;zc.interactivelyCreatePackage=Wd;zc.interactivelyLoadPackage=gc;zc.interactivelyReloadPackage=cd;zc.interactivelyUnloadPackage=Bd;zc.interactivelyRemovePackage=hd;zc.showExportsAndImportsOf=Jd;zc.shortModuleName=Zb;zc.addModule=Mb;zc.interactivelyChangeModule=Ic;zc.interactivelyReloadModule=Ad;zc.interactivelyUnloadModule=Jc;zc.interactivelyRemoveModule=zd;zc.interactivelyAddModule=mb;zc.modulesInPackage=Bc;zc.LocalCoreInterface=Eb;zc.HTTPCoreInterface=td;zc.L2LCoreInterface=tc;tc=Sa("Interface",
function(ac){var Oa=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js"),Da=Oa.hasOwnProperty("Interface")&&"function"===typeof Oa.Interface?Oa.Interface:Oa.Interface=function(ka){ka&&ka[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Zc(Da,ac,[{key:Symbol.for("lively-instance-initialize"),value:function(ka){this.coreInterface=ka}},{key:"isSystemInterface",get:function(){return!0}},{key:"name",get:function(){return this.coreInterface.name}},
{key:"dynamicCompletionsForPrefix",value:function(ka,Ba,Ja){return this.coreInterface.dynamicCompletionsForPrefix(ka,Ba,Ja)}},{key:"runEval",value:function(ka,Ba){return this.coreInterface.runEval(ka,Ba)}},{key:"printSystemConfig",value:function(ka,Ba,Ja){return this.coreInterface.printSystemConfig(ka,Ba,Ja)}},{key:"getConfig",value:function(ka,Ba,Ja){return this.coreInterface.getConfig(ka,Ba,Ja)}},{key:"getPackages",value:function(ka){return this.coreInterface.getPackages(ka)}},{key:"getModules",
value:function(ka,Ba,Ja){return this.coreInterface.getModules(ka,Ba,Ja)}},{key:"getModule",value:function(ka,Ba,Ja){return this.coreInterface.getModule(ka,Ba,Ja)}},{key:"getPackage",value:function(ka,Ba,Ja){return this.coreInterface.getPackage(ka,Ba,Ja)}},{key:"getPackageForModule",value:function(ka,Ba,Ja){return this.coreInterface.getPackageForModule(ka,Ba,Ja)}},{key:"resourcesOfPackage",value:function(ka,Ba){return this.coreInterface.resourcesOfPackage(ka,Ba)}},{key:"systemConfChange",value:function(ka,
Ba,Ja){return this.coreInterface.systemConfChange(ka,Ba,Ja)}},{key:"registerPackage",value:function(ka){return this.coreInterface.registerPackage(ka)}},{key:"importPackage",value:function(ka){return this.coreInterface.importPackage(ka)}},{key:"removePackage",value:function(ka){return this.coreInterface.removePackage(ka)}},{key:"reloadPackage",value:function(ka){return this.coreInterface.reloadPackage(ka)}},{key:"packageConfChange",value:function(ka,Ba){return this.coreInterface.packageConfChange(ka,
Ba)}},{key:"keyValueListOfVariablesInModule",value:function(ka,Ba){return this.coreInterface.keyValueListOfVariablesInModule(ka,Ba)}},{key:"interactivelyCreatePackage",value:function(ka){return zc.interactivelyCreatePackage(this.coreInterface,ka)}},{key:"interactivelyLoadPackage",value:function(ka,Ba){return zc.interactivelyLoadPackage(this.coreInterface,ka,Ba)}},{key:"interactivelyReloadPackage",value:function(ka,Ba){return zc.interactivelyReloadPackage(this.coreInterface,ka,Ba)}},{key:"interactivelyUnloadPackage",
value:function(ka,Ba,Ja){return zc.interactivelyUnloadPackage(this.coreInterface,ka,Ba,Ja)}},{key:"interactivelyRemovePackage",value:function(ka,Ba){return zc.interactivelyRemovePackage(this.coreInterface,ka,Ba)}},{key:"isModuleLoaded",value:function(ka,Ba){return this.coreInterface.isModuleLoaded(ka,Ba)}},{key:"doesModuleExist",value:function(ka,Ba){return this.coreInterface.doesModuleExist(ka,Ba)}},{key:"createModule",value:function(ka){return zc.addModule(this.coreInterface,ka)}},{key:"importModule",
value:function(ka){return this.coreInterface.importModule(ka)}},{key:"forgetModule",value:function(ka,Ba){return this.coreInterface.forgetModule(ka,Ba)}},{key:"reloadModule",value:function(ka,Ba){return this.coreInterface.reloadModule(ka,Ba)}},{key:"moduleFormat",value:function(ka){return this.coreInterface.moduleFormat(ka)}},{key:"moduleRead",value:function(ka){return this.coreInterface.moduleRead(ka)}},{key:"moduleWrite",value:function(ka,Ba){return this.coreInterface.moduleWrite(ka,Ba)}},{key:"getModulesInPackage",
value:function(ka){return zc.modulesInPackage(this.coreInterface,ka)}},{key:"shortModuleName",value:function(ka,Ba){return zc.shortModuleName(this.coreInterface,ka,Ba)}},{key:"interactivelyChangeModule",value:function(ka,Ba,Ja){return zc.interactivelyChangeModule(this.coreInterface,ka,Ba,Ja)}},{key:"interactivelyReloadModule",value:function(ka,Ba){return zc.interactivelyReloadModule(this.coreInterface,ka,Ba)}},{key:"interactivelyUnloadModule",value:function(ka,Ba){return zc.interactivelyUnloadModule(this.coreInterface,
ka,Ba)}},{key:"interactivelyRemoveModule",value:function(ka,Ba){return zc.interactivelyRemoveModule(this.coreInterface,ka,Ba)}},{key:"interactivelyAddModule",value:function(ka,Ba){return zc.interactivelyAddModule(this.coreInterface,ka,Ba)}},{key:"showExportsAndImportsOf",value:function(ka,Ba){return zc.showExportsAndImportsOf(this.coreInterface,ka,Ba)}},{key:"exportsOfModules",value:function(ka){return this.coreInterface.exportsOfModules(ka)}},{key:"searchInPackage",value:function(ka,Ba,Ja){return this.coreInterface.searchInPackage(ka,
Ba,Ja)}},{key:"searchInAllPackages",value:function(ka,Ba){Ba=void 0===Ba?{}:Ba;var Ja=this,Fb,va,Ka,Rb,eb,Vc,Qb,qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wc){switch(Wc.nextAddress){case 1:return(Fb=Ba.progress)&&Fb.step("Fetching Packages...",0),Wc.yield(Ja.coreInterface.getPackages({excluded:Ba.excludedPackages}),2);case 2:va=Wc.yieldResult,Ka=[],Fb&&Fb.step("Fetching Packages...",.1),Rb=0;case 3:if(!(Rb<va.length)){Wc.jumpTo(5);break}eb=va[Rb];Vc=eb.url;if(!Vc||"no group"===
Vc){Wc.jumpTo(4);break}Fb&&Fb.step(Vc.replace(System.baseURL,"").slice(0,20),.1+Rb/va.length*.9);Wc.setCatchFinallyBlocks(6);return Wc.yield(Ja.coreInterface.searchInPackage(Vc,ka,Ba),8);case 8:Qb=Wc.yieldResult;Ka=Ka.concat(Qb);Wc.leaveTryBlock(4);break;case 6:qd=Wc.enterCatchBlock(),console.error("Error searching in package "+Vc+":\n"+qd.stack);case 4:Rb++;Wc.jumpTo(3);break;case 5:return Wc.return(Ka)}})}},{key:"loadMochaTestFile",value:function(ka,Ba){return this.coreInterface.loadMochaTestFile(ka,
Ba)}},{key:"runMochaTests",value:function(ka,Ba,Ja,Fb){return this.coreInterface.runMochaTests(ka,Ba,Ja,Fb)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Interface"}}],Oa,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:679,end:6188})}(void 0));zc.Interface=tc;zc.Interface=
tc;zc.Interface=tc;zc.systemInterfaceNamed=xc;zc.systemInterfaceNamed=xc;tc=Sa("localInterface",new zc.Interface(new zc.LocalCoreInterface));zc.localInterface=tc;zc.localInterface=tc;zc.localInterface=tc;zc.httpInterfaces={};tc=Sa("serverInterfaceFor",function(ac){return zc.httpInterfaces[ac]||(zc.httpInterfaces[ac]=new zc.Interface(new zc.HTTPCoreInterface(ac)))});zc.serverInterfaceFor=tc;zc.serverInterfaceFor=tc;zc.serverInterfaceFor=tc;zc.l2lInterfaces={};tc=Sa("l2lInterfaceFor",function(ac,Oa){return zc.l2lInterfaces[ac]||
(zc.l2lInterfaces[ac]=new zc.Interface(new zc.L2LCoreInterface(ac,Oa)))});zc.l2lInterfaceFor=tc;zc.l2lInterfaceFor=tc;zc.l2lInterfaceFor=tc}}});