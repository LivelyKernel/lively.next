System.register("./__rootModule___commonjs-entry-71573ff5.js ./editor-plugin-0a8dd45b.js ./messages.cp-7a7411e4.js @babel/plugin-syntax-import-meta ./ui.cp-6289a670.js ./loading-indicator.cp-b18e3b89.js ./index-d18accbd.js ./tooltips.cp-6a2406c0.js ./index-1c08552a.js ./interface-dc23a2c8.js ./index-ca98f65e.js ./index-c79abca0.js ./value-widgets-6cb12552.js ./list.cp-8569fe93.js ./popups.cp-68dc8a4a.js ./editor-modes-5e094c88.js".split(" "),function(Lc){var pd,Nd,Tc,Jc,$d,Bb,rd,Id,Ac,Pc,gd,nd,Fd,
ic,vd,sb,Xb,Nb;return{setters:[function(bc){pd=bc.M;Nd=bc.m;Tc=bc.A;Jc=bc.n;$d=bc.d;Bb=bc.b;rd=bc.C;Id=bc.w;Ac=bc.h;Pc=bc.v;gd=bc.g;nd=bc.i;Fd=bc.x;ic=bc._;vd=bc.D},function(bc){sb=bc.guessTextModeName},function(bc){Xb=bc.StatusMessageConfirm;Nb=bc.StatusMessageWarning},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var bc=window.lively.FreezerRuntime.recorderFor("lively.ide/text-editor.js");
bc.Morph=pd;bc.Text=Nd;bc.config=Tc;bc.num=Jc;bc.promise=$d;bc.pt=Bb;bc.Color=rd;bc.connect=Id;bc.signal=Ac;bc.once=Pc;bc.resource=gd;bc.guessTextModeName=sb;bc.StatusMessageConfirm=Xb;bc.StatusMessageWarning=Nb;bc.editorCommands=[{name:"focus url input",exec:function(cb){cb.ui.urlInput.focus();return!0}},{name:"focus content text",exec:function(cb){cb.ui.contentText.focus();return!0}},{name:"load file",exec:function(){var cb=ic(regeneratorRuntime.mark(function ub(ec){return regeneratorRuntime.wrap(function(yb){for(;;)switch(yb.prev=
yb.next){case 0:return ec.location=ec.ui.urlInput.input,yb.abrupt("return",!0);case 2:case "end":return yb.stop()}},ub)}));return function(ec){return cb.apply(this,arguments)}}()},{name:"save file",exec:function(){var cb=ic(regeneratorRuntime.mark(function ub(ec){var yb,ba;return regeneratorRuntime.wrap(function(wb){for(;;)switch(wb.prev=wb.next){case 0:return yb=ec.customSaveAction||ec.defaultSaveAction,wb.prev=1,wb.next=4,yb(ec);case 4:ba=wb.sent;ba.saved?(ec.setStatusMessage(ba.message||"saved",
bc.StatusMessageConfirm),bc.signal(ec,"contentSaved")):ec.setStatusMessage(ba.message||"not saved");wb.next=11;break;case 8:wb.prev=8,wb.t0=wb["catch"](1),ec.showError("Error saving: ".concat(wb.t0.stack||wb.t0));case 11:return wb.abrupt("return",!0);case 12:case "end":return wb.stop()}},ub,null,[[1,8]])}));return function(ec){return cb.apply(this,arguments)}}()},{name:"remove file",exec:function(){var cb=ic(regeneratorRuntime.mark(function ub(ec){var yb;return regeneratorRuntime.wrap(function(ba){for(;;)switch(ba.prev=
ba.next){case 0:if(yb=ec.locationResource){ba.next=4;break}ec.setStatusMessage("No file selected");return ba.abrupt("return",!0);case 4:return ba.prev=4,ba.next=7,ec.world().confirm("Really remove ".concat(yb.url,"?"));case 7:if(!ba.sent){ba.next=14;break}ba.next=10;return yb.remove();case 10:ec.setStatusMessage("".concat(yb.url," removed!"));ec.reload();ba.next=16;break;case 14:return ba.next=16,ec.world().inform("delete file canceled");case 16:ba.next=21;break;case 18:ba.prev=18,ba.t0=ba["catch"](4),
ec.showError("Error writing ".concat(yb.url,": ").concat(ba.t0.stack||ba.t0));case 21:return ba.abrupt("return",!0);case 22:case "end":return ba.stop()}},ub,null,[[4,18]])}));return function(ec){return cb.apply(this,arguments)}}()}];var hb=Lc("default",function(cb){var Hb=window.lively.FreezerRuntime.recorderFor("lively.ide/text-editor.js"),ec=Hb.hasOwnProperty("TextEditor")&&"function"===typeof Hb.TextEditor?Hb.TextEditor:Hb.TextEditor=function(ub){if(!ub||!ub[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,
arguments)};return nd(ec,cb,[{key:Symbol["for"]("lively-instance-initialize"),value:function(ub){nd._get(Object.getPrototypeOf(ec.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,ub);this.relayout();this._loadPromise=null}},{key:"isTextEditor",get:function(){return!0}},{key:"reload",value:function(){this.location=this.location}},{key:"relayout",value:function(){var ub=this.ui,yb=ub.urlInput,ba=ub.loadButton,wb=ub.saveButton,Xa=ub.removeButton;ub=ub.contentText;yb.width=ub.width=
this.width;yb.top=0;yb.height=20;ba.extent=wb.extent=Xa.extent=bc.pt(this.width/3,20);ba.topLeft=yb.bottomLeft;wb.topLeft=ba.topRight;Xa.topLeft=wb.topRight;ub.topLeft=ba.bottomLeft;ub.height=this.height-ba.bottom}},{key:"whenLoaded",value:function(){var ub=ic(regeneratorRuntime.mark(function ba(){return regeneratorRuntime.wrap(function(wb){for(;;)switch(wb.prev=wb.next){case 0:return wb.abrupt("return",this._loadPromise||Promise.resolve(this));case 1:case "end":return wb.stop()}},ba,this)}));return function(){return ub.apply(this,
arguments)}}()},{key:"parseFileNameInput",value:function(ub){var yb=ub,ba=ub.lastIndexOf(":");if(-1<ba&&ub.slice(ba+1).match(/^[0-9]+$/)){var wb=Number(ub.slice(ba+1));yb=ub.slice(0,ba)}return{lineNumber:wb,url:yb}}},{key:"showFileContent",value:function(){var ub=ic(regeneratorRuntime.mark(function wb(ba){var Xa,Za,Sb,Cb;return regeneratorRuntime.wrap(function(Da){for(;;)switch(Da.prev=Da.next){case 0:Xa=bc.promise.deferred();this._loadPromise=Xa.promise;Da.prev=2;if(!this.customLoadContentAction){Da.next=
9;break}Da.next=6;return this.customLoadContentAction(this,ba);case 6:Sb=Da.sent;Da.next=14;break;case 9:return Za=bc.resource(ba),Da.next=12,Za.read();case 12:Sb=Da.sent,Sb.constructor===ArrayBuffer&&(Sb=(new TextDecoder).decode(Sb));case 14:return Sb||(Sb=""),Da.next=17,this.prepareEditorForFile(ba,Sb);case 17:if(Cb=this.getWindow())Cb.title=Za?Za.name():ba;Xa.resolve(this);Da.next=26;break;case 22:Da.prev=22,Da.t0=Da["catch"](2),this.showError(Da.t0),Xa.reject(Da.t0);case 26:return Da.abrupt("return",
this._loadPromise);case 27:case "end":return Da.stop()}},wb,this,[[2,22]])}));return function(ba){return ub.apply(this,arguments)}}()},{key:"prepareEditorForFile",value:function(){var ub=ic(regeneratorRuntime.mark(function wb(ba){var Xa,Za,Sb,Cb=arguments;return regeneratorRuntime.wrap(function(Da){for(;;)switch(Da.prev=Da.next){case 0:return Xa=1<Cb.length&&void 0!==Cb[1]?Cb[1]:"","object"===vd(Xa)&&(bc.__inter0__=Xa,Xa=bc.__inter0__.content,ba=bc.__inter0__.url),Za=this.ui.contentText,Xa.length>
Math.pow(2,19)?this.setStatusMessage("File content very big, ".concat(bc.num.humanReadableByteSize(Xa.length),". Styling is disabled"),bc.StatusMessageWarning):Sb=bc.guessTextModeName(Xa,ba),Da.prev=4,Da.next=7,Za.changeEditorMode(Sb);case 7:Da.next=15;break;case 11:Da.prev=11,Da.t0=Da["catch"](4),console.warn("Failed to set mode ".concat(Sb,": ").concat(Da.t0)),Za.changeEditorMode(null);case 15:Za.textString=Xa,Za.gotoDocumentStart(),Za.scroll=bc.pt(0,0);case 18:case "end":return Da.stop()}},wb,
this,[[4,11]])}));return function(ba){return ub.apply(this,arguments)}}()},{key:"defaultSaveAction",value:function(){var ub=ic(regeneratorRuntime.mark(function wb(ba){var Xa;return regeneratorRuntime.wrap(function(Za){for(;;)switch(Za.prev=Za.next){case 0:Xa=ba.locationResource;if(!Xa){Za.next=5;break}Za.next=4;return Xa.write(ba.ui.contentText.textString);case 4:return Za.abrupt("return",{saved:!0});case 5:return Za.abrupt("return",{saved:!1,message:"No file selected"});case 6:case "end":return Za.stop()}},
wb)}));return function(ba){return ub.apply(this,arguments)}}()},{key:"focus",value:function(){this.ui.contentText.focus()}},{key:"close",value:function(){var ub=this.getWindow();ub?ub.close():this.remove()}},{key:"onWindowClose",value:function(){bc.signal(this,"closed")}},{key:"commands",get:function(){return bc.editorCommands.concat(nd._get(Object.getPrototypeOf(ec.prototype),"commands",this))}},{key:"keybindings",get:function(){return[{keys:{mac:"Meta-S",win:"Ctrl-S"},command:"save file"},{keys:"Alt-Up",
command:"focus url input"},{keys:"Alt-Down",command:"focus content text"}].concat(nd._get(Object.getPrototypeOf(ec.prototype),"keybindings",this))}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"TextEditor"}},{key:"openURL",value:function(ub,yb){return this.openInWindow(Object.assign({location:ub},yb))}},{key:"openAsEDITOR",value:function(ub,yb){var ba=this.openURL(ub,yb);return new Promise(function(wb,Xa){bc.once(ba,"contentSaved",wb,"call",{updater:function(Za){Za(null,"saved");
this.sourceObj.close()}});bc.once(ba,"closed",wb,"call",{updater:function(Za){return Za(null,"aborted")}})})}},{key:"openInWindow",value:function(ub){ub=new this(ub);ub.env.world.openInWindow(ub).activate();return ub}},{key:"properties",get:function(){return{name:{defaultValue:"text editor"},fill:{defaultValue:bc.Color.white},border:{defaultValue:{width:1,color:bc.Color.black}},extent:{defaultValue:bc.pt(700,600)},historyId:{defaultValue:"lively.morphic-text editor url"},submorphs:{after:["historyId"],
initialize:function(ub){if(!ub.length){this.submorphs=[bc.Text.makeInputLine({name:"urlInput",historyId:this.historyId}),{name:"loadButton",type:"button",label:"reload"},{name:"saveButton",type:"button",label:"save"},{name:"removeButton",type:"button",label:"remove"},Object.assign({},bc.config.codeEditor.defaultStyle,{name:"contentText",type:"text",lineWrapping:!1})];var yb=this.ui;ub=yb.urlInput;var ba=yb.loadButton,wb=yb.saveButton;yb=yb.removeButton;bc.connect(this,"extent",this,"relayout");bc.connect(ub,
"inputAccepted",this,"location");bc.connect(ba,"fire",this,"execCommand",{converter:function(){return"load file"}});bc.connect(wb,"fire",this,"execCommand",{converter:function(){return"save file"}});bc.connect(yb,"fire",this,"execCommand",{converter:function(){return"remove file"}})}}},ui:{readOnly:!0,derived:!0,after:["submorphs"],get:function(){var ub=Fd(this.submorphs,5);return{urlInput:ub[0],loadButton:ub[1],saveButton:ub[2],removeButton:ub[3],contentText:ub[4]}}},location:{derived:!0,after:["submorphs"],
get:function(){return this.ui.urlInput.input},set:function(ub){var yb=this.parseFileNameInput(ub),ba=yb.url;yb=yb.lineNumber;var wb=this.ui,Xa=wb.contentText;wb=wb.urlInput;wb.input=ub||"";wb.acceptInput();wb.isFocused()&&Xa.focus();this.showFileContent(ba);"undefined"!==typeof yb&&(this.lineNumber=yb)}},locationResource:{derived:!0,after:["location"],get:function(){var ub=this.parseFileNameInput(this.location).url;return bc.resource(ub)},set:function(ub){this.location=ub.url}},lineNumber:{derived:!0,
after:["location"],get:function(){return this.ui.contentText.cursorPosition.row},set:function(ub){var yb=this,ba=Number(ub);isNaN(ba)||this.whenLoaded().then(function(){var wb=yb.ui.contentText;wb.cursorPosition={row:ba,column:0};wb.centerRow(ba)})}},customSaveAction:{},customLoadContentAction:{}}}}],Hb,{pathInPackage:function(){return"./text-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",
version:"0.1.0"}}},{start:2019,end:10126})}(bc.Morph));bc["default"]=hb}}});