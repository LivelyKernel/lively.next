System.register(["./__root_module__-7d53b604.js","lively.collab","kld-intersections"],function(wa){var bb,ib,Qb,Ib,ed,qc,pd,uc,Ac,dd,Ad,le,Le,ae,lc;return{setters:[function(Wc){bb=Wc.a7;ib=Wc.P;Qb=Wc.a6;Ib=Wc.p;ed=Wc.bF;qc=Wc.t;pd=Wc.bG;uc=Wc.r;Ac=Wc.bd;dd=Wc.bH;Ad=Wc.bI;le=Wc.bJ;Le=Wc.bK;ae=Wc.bL;lc=Wc.l},function(){},function(){}],execute:function(){function Wc(hc,mc,Hb,ec){ec=void 0===ec?{}:ec;ec=ec.package||Tb.ObjectPackage.lookupPackageForObject(hc,ec);if(!ec)throw Error("Object is not part of an object package: "+
hc);return ec.addScript(hc,mc,Hb)}function Ed(hc,mc){mc=Tb.normalizeOptions(mc).System;hc=(hc=hc[Symbol.for("lively-module-meta")])?hc.package.name:null;return(mc=(hc?Tb.lookupPackage(mc,hc):{}).pkg)?!!Tb.ObjectPackage.forSystemPackage(mc):!1}wa({addScript:Wc,isObjectClass:Ed});var Tb=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");Tb.normalizeOptions=function(hc){hc=Object.assign({baseURL:Tb.defaultBaseURL,System:System},hc);hc.baseURL=hc.baseURL.replace(/\/$/,"");return hc};
Tb.addScript=Wc;Tb.isObjectClass=Ed;Tb.string=bb;Tb.Path=ib;Tb.arr=Qb;Tb.parse=Ib;Tb.isValidIdentifier=ed;Tb.stringify=qc;Tb.parseFunction=pd;Tb.resource=uc;Tb.runEval=Ac;Tb.scripting=dd;Tb.ExportLookup=Ad;var Bd=Tb.scripting;Tb.ensurePackage=Bd.ensurePackage;Tb.registerPackage=Bd.registerPackage;Tb.importPackage=Bd.importPackage;Tb.lookupPackage=Bd.lookupPackage;Tb.module=Bd.module;Tb.ImportInjector=Bd.ImportInjector;Tb.RuntimeSourceDescriptor=le;Tb.toJsIdentifier=Le;Tb.adoptObject=ae;Tb.classToFunctionTransform=
lc;Tb.objectPackageSym=Symbol.for("lively-object-package-data");Tb.defaultBaseURL="local://lively-object-modules";Tb.globalClasses=Object.keys(System.global).map(function(hc){hc=System.global[hc];return"function"===typeof hc&&hc.name&&hc}).filter(Boolean);Tb.addScript=Wc;Tb.addScript=Wc;Tb.isObjectClass=Ed;Tb.isObjectClass=Ed;Tb._packageStore=Tb._packageStore||{};Bd=function(hc,mc){this._id=hc;this.options=Tb.normalizeOptions(mc)};Bd.lookupPackageForObject=function(hc,mc){return this.lookupPackageForClass(hc.constructor,
mc)};Bd.lookupPackageForClass=function(hc,mc){mc=Tb.normalizeOptions(mc).System;hc=(hc=hc[Symbol.for("lively-module-meta")])?hc.package.name:null;return(mc=(hc?Tb.lookupPackage(mc,hc):{}).pkg)?Tb.ObjectPackage.forSystemPackage(mc):null};Bd.forSystemPackage=function(hc){return this.packageStore[hc.name]};Bd.withId=function(hc,mc){return this.packageStore[hc]||(this.packageStore[hc]=new this(hc,mc))};Bd.prototype.ensureSubModule=function(hc){hc=void 0===hc?"index":hc;var mc=this,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){return 1==
ec.nextAddress?(Hb=new Tb.ObjectModule(hc,mc),ec.yield(Hb.ensureExistance(),2)):ec.return(Hb)})};Bd.prototype.resource=function(hc){hc=void 0===hc?"":hc;return Tb.resource(this.packageURL).join(hc)};Bd.prototype.load=function(){return Tb.importPackage(this.System,this.packageURL)};Bd.prototype.ensureExistance=function(){var hc=this,mc,Hb,ec,vc,gd,Zc,Za,Xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jb){switch(jb.nextAddress){case 1:return mc=hc.resource("/"),jb.yield(mc.exists(),2);
case 2:if(jb.yieldResult)return jb.return();Hb=[{resource:mc}];ec=[{resource:hc.resource("package.json"),content:JSON.stringify(hc.config,null,2)}];return jb.yield(Promise.all(Hb.map(function(Fa){return Fa.resource.mkdir()})),3);case 3:return jb.yield(Promise.all(ec.map(function(Fa){var Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ka){switch(ka.nextAddress){case 1:return ka.yield(Fa.resource.exists(),2);case 2:if(!(Ea=!ka.yieldResult)){ka.jumpTo(3);break}return ka.yield(Fa.resource.write(Fa.content),
4);case 4:Ea=ka.yieldResult;case 3:return ka.return(Ea)}})})),4);case 4:return jb.yield(hc.objectModule.ensureExistance(),5);case 5:return vc=hc,gd=vc.System,Zc=vc.packageURL,Za=vc.config,jb.yield(Tb.ensurePackage(gd,Zc),6);case 6:return Xa=jb.yieldResult,Xa.registerWithConfig(Za),console.log(hc.packageURL+" REGISTERED"),jb.return(hc)}})};Bd.prototype.ensureObjectClass=function(hc){var mc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hb){return 1==Hb.nextAddress?Hb.yield(mc.ensureExistance(),
2):Hb.return(mc.objectModule.ensureObjectClass(hc))})};Bd.prototype.adoptObject=function(hc){var mc=this,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){if(1==ec.nextAddress)return mc.objectClass===hc.constructor?ec.return():ec.yield(mc.ensureObjectClass(hc.constructor),2);Hb=ec.yieldResult;Tb.adoptObject(hc,Hb);ec.jumpToEnd()})};Bd.prototype.addScript=function(hc,mc,Hb){return this.objectModule.addScript(hc,mc,Hb)};Bd.prototype.remove=function(){this.systemPackage.remove();delete Tb.ObjectPackage.packageStore[this.id];
return this.resource().remove()};Bd.prototype.renameObjectClass=function(hc,mc){mc=void 0===mc?[]:mc;var Hb=this,ec,vc,gd,Zc,Za,Xa,jb,Fa,Ea,ka,ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==Ca.nextAddress){ec=Hb;vc=ec.objectClass;gd=ec.System;if(!vc||vc[Symbol.for("__LivelyClassName__")]===hc)return Ca.return(vc);if(!Tb.isValidIdentifier(hc))throw Error(hc+" is not a valid name for a class");Za=Zc=Tb.RuntimeSourceDescriptor.for(vc,gd);Xa=Za.source;jb=Za.ast;Fa=jb.id;Ea=Fa.start;
ka=Fa.end;return Ca.yield(Zc.changeSource(Xa.slice(0,Ea)+hc+Xa.slice(ka)),2)}ja=Hb.objectClass;mc.forEach(function(mb){mb.constructor=ja;mb.__proto__=ja.prototype});return Ca.return(ja)})};Bd.prototype.fork=function(hc,mc){var Hb=this,ec,vc,gd,Zc,Za,Xa,jb,Fa,Ea,ka,ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){switch(Ca.nextAddress){case 1:return ec=Hb,vc=ec.System,gd=ec.baseURL,Zc=ec.objectClass,mc=Object.assign({System:vc,baseURL:gd},mc),Za=Tb.RuntimeSourceDescriptor.for(Zc),
Xa=Za._renamedSource(hc),jb=Xa.moduleSource,Fa=Tb.ObjectPackage.withId(hc,mc),Ca.yield(Fa.ensureExistance(),2);case 2:return Ea=Fa,ka=Ea.objectModule,ja=ka.systemModule,Ca.yield(ja.load({format:"esm"}),3);case 3:return Ca.yield(ja.changeSource(jb),4);case 4:return Ca.return(Fa)}})};$jscomp.global.Object.defineProperties(Bd.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,
get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return Tb.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,
get:function(){return this._objectModule||(this._objectModule=new Tb.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(Bd,{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=Tb._packageStore)}}});wa("default",Bd);Tb.ObjectPackage=Bd;var Sd=function(hc,mc){if(!hc)throw Error("ObjectModule needs package!");if(!mc)throw Error("ObjectModule needs package!");
this._moduleName=hc;this._objectPackage=mc};Sd.prototype.read=function(){return this.resource.read()};Sd.prototype.write=function(hc){return this.resource.write(hc)};Sd.prototype.ensureExistance=function(){var hc=this,mc,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){switch(ec.nextAddress){case 1:return mc=hc.resource,ec.yield(mc.exists(),2);case 2:if(ec.yieldResult){ec.jumpTo(3);break}return ec.yield(mc.write("'format esm';\n"),4);case 4:Hb={},hc.System.config({meta:(Hb[hc.url]=
{format:"esm"},Hb)});case 3:return ec.return(hc)}})};Sd.prototype.adoptObject=function(hc){var mc=this,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){if(1==ec.nextAddress)return mc.objectClass===hc.constructor?ec.return():ec.yield(mc.ensureObjectClass(hc.constructor),2);Hb=ec.yieldResult;Tb.adoptObject(hc,Hb);ec.jumpToEnd()})};Sd.prototype.ensureObjectClass=function(hc){var mc=this,Hb=this.objectClass;return Hb&&Hb.prototype.__proto__===hc.prototype?Hb:Promise.resolve(this.ensureObjectClassSource(hc)).then(function(ec){var vc=
ec.source,gd=ec.moduleId,Zc=ec.className,Za=ec.bindings,Xa=mc.System;ec=Tb.module(Xa,gd);if(Za)for(var jb in Za)ec.define(jb,Za[jb]);vc=Tb.runEval(vc,{classTransform:Tb.classToFunctionTransform,sync:!0,targetModule:gd,System:Xa});if(vc.isError)throw vc.value;vc=ec.recorder[Zc];if(!vc)throw Error("Failed to define class "+Zc+" in "+gd);return vc})};Sd.prototype.ensureObjectClassSource=function(hc){return this.createDefaultClassDeclaration(hc)};Sd.prototype.createDefaultClassDeclaration=function(hc){hc=
void 0===hc?Object:hc;var mc=this,Hb,ec,vc,gd,Zc,Za,Xa,jb,Fa,Ea,ka,ja,Ca,mb,Ub,Ya;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){switch($a.nextAddress){case 1:Hb=mc;ec=Hb.System;vc=Hb.systemModule;gd=Hb.objectPackage;Zc=Tb.string.capitalize(Tb.toJsIdentifier(gd.id));Za=hc[Symbol.for("__LivelyClassName__")];Xa=!Za;jb=Tb.globalClasses.includes(hc);Fa="";Ea=null;if(Xa){Za="__anonymous_superclass__";ka={};Ea=(ka[Za]=hc,ka);$a.jumpTo(2);break}if(jb){$a.jumpTo(2);break}return $a.yield(Tb.ExportLookup.findExportOfValue(hc,
ec),4);case 4:(ja=$a.yieldResult)?(Ca=Tb.ImportInjector.run(ec,vc.id,vc.package(),"",ja),mb=Ca.standaloneImport,Fa+=mb+"\n\n"):(Ub={},Ea=(Ub[Za]=hc,Ub));case 2:return Zc===Za&&(Zc="Object"+Zc),Ya="Object"===Za?"class "+Zc+" {}\n":"class "+Zc+" extends "+Za+" {}\n",Fa+="export default "+Ya+"\n",$a.yield(vc.changeSource(Fa),5);case 5:return $a.yield(vc.load(),6);case 6:return $a.return({source:Fa,className:Zc,moduleId:mc.url,bindings:Ea})}})};Sd.prototype.addScript=function(hc,mc,Hb){var ec=this,vc,
gd,Zc,Za,Xa,jb,Fa,Ea,ka,ja,Ca,mb,Ub,Ya,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){switch(Ua.nextAddress){case 1:if(hc.constructor===ec.objectClass){vc=hc.constructor;Ua.jumpTo(2);break}return Ua.yield(ec.ensureObjectClass(hc.constructor),3);case 3:vc=Ua.yieldResult;case 2:gd=vc;Zc="function"===typeof mc?String(mc):mc;Za=Tb.parseFunction(Zc);Xa=Tb.RuntimeSourceDescriptor.for(gd,ec.System);Hb||(Hb=Tb.Path("id.name").get(Za));if(!Hb)throw Error("No name, cannot add "+Tb.string.truncate(Zc,
30).replace(/\n/g,"")+"!");jb=Tb.toJsIdentifier(Hb);console.assert("FunctionExpression"===Za.type||"ArrowFunctionExpression"===Za.type,"not a function expression but: "+Za.type);Fa=Za.params.map(function(U){return Zc.slice(U.start,U.end)});Ea="BlockStatement"===Za.body.type?Zc.slice(Za.body.start,Za.body.end):"{ return "+Zc.slice(Za.body.start,Za.body.end)+" }";ka=jb+"("+Fa.join(",")+") "+Ea;"ArrowFunctionExpression"===Za.type&&(Za.type="FunctionExpression");ja=Xa.source;Ca=Xa.ast;if(!Ca)throw Error("cannot find class decl of "+
Xa.module.id);(mb=Ca.body.body.find(function(U){return U.key.name===jb&&!U.static}))?ja=ja.slice(0,mb.start)+ka+ja.slice(mb.end):(Ub=ja.lastIndexOf("}"),Ya=ja.slice(0,Ub),$a=ja.slice(Ub),/\n\s*$/m.test(Ya)||(Ya+="\n"),ka=Tb.string.changeIndent(ka,"  ",1),/^[ ]*\n/m.test($a)||($a="\n"+$a),ja=Ya+ka+$a);return Ua.yield(Xa.changeSource(ja),4);case 4:return Ua.return({script:gd.prototype[jb],klass:gd,module:Xa.module.id,methodName:jb})}})};$jscomp.global.Object.defineProperties(Sd.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var hc=this.systemModule;return hc.isLoaded()?hc.System.get(hc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return Tb.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});Tb.ObjectModule=Sd;Tb.default=Bd}}});