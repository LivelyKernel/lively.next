System.register(["./__root_module__-7d3cbdeb.js","kld-intersections"],function(Ka){var wb,Ab,gc,Kb,Zc,Kc,md,Fc,Bc,Nc,Uc,ce,Zd,pe,Mc,Kd;return{setters:[function(Jb){wb=Jb.s;Ab=Jb.P;gc=Jb.a;Kb=Jb.v;Zc=Jb.w;Kc=Jb.x;md=Jb.y;Fc=Jb.r;Bc=Jb.z;Nc=Jb.A;Uc=Jb.E;ce=Jb.D;Zd=Jb.F;pe=Jb.G;Mc=Jb.H;Kd=Jb.J},function(){}],execute:function(){function Jb(Eb,ic,jd,jc){jc=void 0===jc?{}:jc;jc=jc.package||Hc.ObjectPackage.lookupModuleForClass(Eb.constructor,jc);if(!jc)throw Error("Object is not part of an object package: "+
Eb);return jc.addScript(Eb,ic,jd)}function Dc(Eb,ic){ic=Hc.normalizeOptions(ic).System;Eb=(Eb=Eb[Symbol.for("lively-module-meta")])?Eb.package.name:null;return(ic=(Eb?Hc.lookupPackage(ic,Eb):{}).pkg)?!!Hc.ObjectPackage.forSystemPackage(ic):!1}function nd(Eb,ic){var jd,jc,kd,vb,db,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mb){return 1==Mb.nextAddress?(jd=Eb.constructor,Hc.withSuperclasses(jd),Symbol.for("lively-module-meta"),kd=jc=Hc.ObjectPackage.lookupPackageForObject(Eb),vb=
kd.baseURL,db=kd.System,Mb.yield(jc.fork(ic,{baseURL:vb,System:db}),2)):3!=Mb.nextAddress?(ec=Mb.yieldResult,Mb.yield(Hc.adoptObject(Eb,ec.objectClass),3)):Mb.return(ec.objectClass[Symbol.for("__LivelyClassName__")])})}Ka({addScript:Jb,interactivelyForkPackage:nd,isObjectClass:Dc});var Hc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");Hc.normalizeOptions=function(Eb){Eb=Object.assign({baseURL:Hc.defaultBaseURL,System:System},Eb);Eb.baseURL=Eb.baseURL.replace(/\/$/,"");return Eb};
Hc.addScript=Jb;Hc.isObjectClass=Dc;Hc.interactivelyForkPackage=nd;Hc.string=wb;Hc.Path=Ab;Hc.arr=gc;Hc.parse=Kb;Hc.isValidIdentifier=Zc;Hc.stringify=Kc;Hc.parseFunction=md;Hc.resource=Fc;Hc.runEval=Bc;Hc.scripting=Nc;Hc.ExportLookup=Uc;var wd=Hc.scripting;Hc.ensurePackage=wd.ensurePackage;Hc.registerPackage=wd.registerPackage;Hc.importPackage=wd.importPackage;Hc.lookupPackage=wd.lookupPackage;Hc.module=wd.module;Hc.ImportInjector=wd.ImportInjector;Hc.RuntimeSourceDescriptor=ce;Hc.toJsIdentifier=
Zd;Hc.withSuperclasses=pe;Hc.adoptObject=Mc;Hc.classToFunctionTransform=Kd;Hc.objectPackageSym=Symbol.for("lively-object-package-data");Hc.defaultBaseURL="local://lively-object-modules";Hc.globalClasses=Object.keys(System.global).map(function(Eb){Eb=System.global[Eb];return"function"===typeof Eb&&Eb.name&&Eb}).filter(Boolean);Hc.addScript=Jb;Hc.addScript=Jb;Hc.isObjectClass=Dc;Hc.isObjectClass=Dc;Hc._packageStore=Hc._packageStore||{};Hc.interactivelyForkPackage=nd;Hc.interactivelyForkPackage=nd;wd=
function(Eb,ic){this._id=Eb;this.options=Hc.normalizeOptions(ic)};wd.lookupPackageForObject=function(Eb,ic){return this.lookupPackageForClass(Eb.constructor,ic)};wd.lookupPackageForClass=function(Eb,ic){ic=Hc.normalizeOptions(ic).System;Eb=(Eb=Eb[Symbol.for("lively-module-meta")])?Eb.package.name:null;return(ic=(Eb?Hc.lookupPackage(ic,Eb):{}).pkg)?Hc.ObjectPackage.forSystemPackage(ic):null};wd.lookupModuleForClass=function(Eb,ic){Hc.normalizeOptions(ic);ic=this.lookupPackageForClass(Eb,ic);Eb=Eb[Symbol.for("lively-module-meta")];
return new Hc.ObjectModule(Eb.pathInPackage,ic)};wd.forSystemPackage=function(Eb){return this.packageStore[Eb.name]};wd.withId=function(Eb,ic){return this.packageStore[Eb]||(this.packageStore[Eb]=new this(Eb,ic))};wd.prototype.ensureSubModule=function(Eb){Eb=void 0===Eb?"index":Eb;var ic=this,jd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jc){return 1==jc.nextAddress?(jd=new Hc.ObjectModule(Eb,ic),jc.yield(jd.ensureExistance(),2)):jc.return(jd)})};wd.prototype.resource=function(Eb){Eb=
void 0===Eb?"":Eb;return Hc.resource(this.packageURL).join(Eb)};wd.prototype.load=function(){return Hc.importPackage(this.System,this.packageURL)};wd.prototype.ensureExistance=function(){var Eb=this,ic,jd,jc,kd,vb,db,ec,Mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hb){switch(Hb.nextAddress){case 1:return ic=Eb.resource("/"),Hb.yield(ic.exists(),2);case 2:if(Hb.yieldResult)return Hb.return();jd=[{resource:ic}];jc=[{resource:Eb.resource("package.json"),content:JSON.stringify(Eb.config,
null,2)}];return Hb.yield(Promise.all(jd.map(function(pc){return pc.resource.mkdir()})),3);case 3:return Hb.yield(Promise.all(jc.map(function(pc){var Ma;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ib){switch(Ib.nextAddress){case 1:return Ib.yield(pc.resource.exists(),2);case 2:if(!(Ma=!Ib.yieldResult)){Ib.jumpTo(3);break}return Ib.yield(pc.resource.write(pc.content),4);case 4:Ma=Ib.yieldResult;case 3:return Ib.return(Ma)}})})),4);case 4:return Hb.yield(Eb.objectModule.ensureExistance(),
5);case 5:return kd=Eb,vb=kd.System,db=kd.packageURL,ec=kd.config,Hb.yield(Hc.ensurePackage(vb,db),6);case 6:return Mb=Hb.yieldResult,Mb.registerWithConfig(ec),console.log(Eb.packageURL+" REGISTERED"),Hb.return(Eb)}})};wd.prototype.ensureObjectClass=function(Eb){var ic=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jd){return 1==jd.nextAddress?jd.yield(ic.ensureExistance(),2):jd.return(ic.objectModule.ensureObjectClass(Eb))})};wd.prototype.adoptObject=function(Eb){var ic=this,jd;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(jc){if(1==jc.nextAddress)return ic.objectClass===Eb.constructor?jc.return():jc.yield(ic.ensureObjectClass(Eb.constructor),2);jd=jc.yieldResult;Hc.adoptObject(Eb,jd);jc.jumpToEnd()})};wd.prototype.addScript=function(Eb,ic,jd){return this.objectModule.addScript(Eb,ic,jd)};wd.prototype.remove=function(){this.systemPackage.remove();delete Hc.ObjectPackage.packageStore[this.id];return this.resource().remove()};wd.prototype.renameObjectClass=function(Eb,
ic){ic=void 0===ic?[]:ic;var jd=this,jc,kd,vb,db,ec,Mb,Hb,pc,Ma,Ib,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){if(1==Ub.nextAddress){jc=jd;kd=jc.objectClass;vb=jc.System;if(!kd||kd[Symbol.for("__LivelyClassName__")]===Eb)return Ub.return(kd);if(!Hc.isValidIdentifier(Eb))throw Error(Eb+" is not a valid name for a class");ec=db=Hc.RuntimeSourceDescriptor.for(kd,vb);Mb=ec.source;Hb=ec.ast;pc=Hb.id;Ma=pc.start;Ib=pc.end;return Ub.yield(db.changeSource(Mb.slice(0,Ma)+Eb+Mb.slice(Ib)),
2)}pb=jd.objectClass;ic.forEach(function(dc){dc.constructor=pb;dc.__proto__=pb.prototype});return Ub.return(pb)})};wd.prototype.fork=function(Eb,ic){var jd=this,jc,kd,vb,db,ec,Mb,Hb,pc,Ma,Ib,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){switch(Ub.nextAddress){case 1:return jc=jd,kd=jc.System,vb=jc.baseURL,db=jc.objectClass,ic=Object.assign({System:kd,baseURL:vb},ic),ec=Hc.RuntimeSourceDescriptor.for(db),Mb=ec._renamedSource(Eb),Hb=Mb.moduleSource,pc=Hc.ObjectPackage.withId(Eb,
ic),Ub.yield(pc.ensureExistance(),2);case 2:return Ma=pc,Ib=Ma.objectModule,pb=Ib.systemModule,Ub.yield(pb.load({format:"esm"}),3);case 3:return Ub.yield(pb.changeSource(Hb),4);case 4:return Ub.return(pc)}})};$jscomp.global.Object.defineProperties(wd.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,
enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return Hc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=
new Hc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(wd,{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=Hc._packageStore)}}});Ka("default",wd);Hc.ObjectPackage=wd;var Qd=function(Eb,ic){if(!Eb)throw Error("ObjectModule needs package!");if(!ic)throw Error("ObjectModule needs package!");this._moduleName=Eb;this._objectPackage=
ic};Qd.prototype.read=function(){return this.resource.read()};Qd.prototype.write=function(Eb){return this.resource.write(Eb)};Qd.prototype.ensureExistance=function(){var Eb=this,ic,jd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jc){switch(jc.nextAddress){case 1:return ic=Eb.resource,jc.yield(ic.exists(),2);case 2:if(jc.yieldResult){jc.jumpTo(3);break}return jc.yield(ic.write("'format esm';\n"),4);case 4:jd={},Eb.System.config({meta:(jd[Eb.url]={format:"esm"},jd)});case 3:return jc.return(Eb)}})};
Qd.prototype.adoptObject=function(Eb,ic){var jd=this,jc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){if(1==kd.nextAddress)return jd.objectClass===Eb.constructor?kd.return():kd.yield(jd.ensureObjectClass(Eb.constructor,ic),2);jc=kd.yieldResult;Hc.adoptObject(Eb,jc);kd.jumpToEnd()})};Qd.prototype.ensureObjectClass=function(Eb,ic){var jd=this,jc=this.objectClass;return jc&&jc.prototype.__proto__===Eb.prototype?jc:Promise.resolve(this.ensureObjectClassSource(Eb,ic)).then(function(kd){var vb=
kd.source,db=kd.moduleId,ec=kd.className,Mb=kd.bindings,Hb=jd.System;kd=Hc.module(Hb,db);if(Mb)for(var pc in Mb)kd.define(pc,Mb[pc]);vb=Hc.runEval(vb,{classTransform:Hc.classToFunctionTransform,sync:!0,targetModule:db,System:Hb});if(vb.isError)throw vb.value;vb=kd.recorder[ec];if(!vb)throw Error("Failed to define class "+ec+" in "+db);return vb})};Qd.prototype.ensureObjectClassSource=function(Eb,ic){return this.createDefaultClassDeclaration(Eb,ic)};Qd.prototype.createDefaultClassDeclaration=function(Eb,
ic){Eb=void 0===Eb?Object:Eb;ic=void 0===ic?!1:ic;var jd=this,jc,kd,vb,db,ec,Mb,Hb,pc,Ma,Ib,pb,Ub,dc,vc,gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:jc=jd;kd=jc.System;vb=jc.systemModule;db=jc.objectPackage;ic=ic||Hc.string.capitalize(Hc.toJsIdentifier(db.id));ec=Eb[Symbol.for("__LivelyClassName__")];Mb=!ec;Hb=Hc.globalClasses.includes(Eb);pc="";Ma=null;if(Mb){ec="__anonymous_superclass__";Ib={};Ma=(Ib[ec]=Eb,Ib);Nb.jumpTo(2);break}if(Hb){Nb.jumpTo(2);
break}return Nb.yield(Hc.ExportLookup.findExportOfValue(Eb,kd),4);case 4:(pb=Nb.yieldResult)?(Ub=Hc.ImportInjector.run(kd,vb.id,vb.package(),"",pb),dc=Ub.standaloneImport,pc+=dc+"\n\n"):(vc={},Ma=(vc[ec]=Eb,vc));case 2:return ic===ec&&(ic="Object"+ic),gd="Object"===ec?"class "+ic+" {}\n":"class "+ic+" extends "+ec+" {}\n",pc+="export default "+gd+"\n",Nb.yield(vb.changeSource(pc),5);case 5:return Nb.yield(vb.load(),6);case 6:return Nb.return({source:pc,className:ic,moduleId:jd.url,bindings:Ma})}})};
Qd.prototype.addScript=function(Eb,ic,jd){var jc=this,kd,vb,db,ec,Mb,Hb,pc,Ma,Ib,pb,Ub,dc,vc,gd,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:if(Eb.constructor===jc.objectClass){kd=Eb.constructor;Fb.jumpTo(2);break}return Fb.yield(jc.ensureObjectClass(Eb.constructor),3);case 3:kd=Fb.yieldResult;case 2:vb=kd;db="function"===typeof ic?String(ic):ic;ec=Hc.parseFunction(db);Mb=Hc.RuntimeSourceDescriptor.for(vb,jc.System);jd||(jd=Hc.Path("id.name").get(ec));
if(!jd)throw Error("No name, cannot add "+Hc.string.truncate(db,30).replace(/\n/g,"")+"!");Hb=Hc.toJsIdentifier(jd);console.assert("FunctionExpression"===ec.type||"ArrowFunctionExpression"===ec.type,"not a function expression but: "+ec.type);pc=ec.params.map(function(sb){return db.slice(sb.start,sb.end)});Ma="BlockStatement"===ec.body.type?db.slice(ec.body.start,ec.body.end):"{ return "+db.slice(ec.body.start,ec.body.end)+" }";Ib=Hb+"("+pc.join(",")+") "+Ma;"ArrowFunctionExpression"===ec.type&&(ec.type=
"FunctionExpression");pb=Mb.source;Ub=Mb.ast;if(!Ub)throw Error("cannot find class decl of "+Mb.module.id);(dc=Ub.body.body.find(function(sb){return sb.key.name===Hb&&!sb.static}))?pb=pb.slice(0,dc.start)+Ib+pb.slice(dc.end):(vc=pb.lastIndexOf("}"),gd=pb.slice(0,vc),Nb=pb.slice(vc),/\n\s*$/m.test(gd)||(gd+="\n"),Ib=Hc.string.changeIndent(Ib,"  ",1),/^[ ]*\n/m.test(Nb)||(Nb="\n"+Nb),pb=gd+Ib+Nb);return Fb.yield(Mb.changeSource(pb),4);case 4:return Fb.return({script:vb.prototype[Hb],klass:vb,module:Mb.module.id,
methodName:Hb})}})};$jscomp.global.Object.defineProperties(Qd.prototype,{objectPackage:{configurable:!0,enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var Eb=this.systemModule;return Eb.isLoaded()?Eb.System.get(Eb.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return Hc.module(this.System,this.url)}},System:{configurable:!0,
enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});Hc.ObjectModule=Qd;Hc.default=wd}}});