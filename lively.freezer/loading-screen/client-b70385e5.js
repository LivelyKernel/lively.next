System.register(["./__root_module__-f9290433.js","kld-intersections"],function(sa){var db,Eb,Vb,Wb,wd,Ic,Ad,Jc;return{setters:[function(Mc){db=Mc.s;Eb=Mc._;Vb=Mc.bi;Wb=Mc.bj;wd=Mc.ar;Ic=Mc.a5;Ad=Mc.bk;Jc=Mc.an},function(){}],execute:function(){function Mc(){function ua(Ya,ob){var kc={};ob.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Sc,Oc,Xb){Oc&&(kc[Oc]=Xb)});return kc}if(ma)return Ca;ma=!0;var ab=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
pb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return Ca=function(Ya){var ob=Ya,kc=Ya.indexOf("["),Sc=Ya.indexOf("]");-1!=kc&&-1!=Sc&&(Ya=Ya.substring(0,kc)+Ya.substring(kc,Sc).replace(/:/g,";")+Ya.substring(Sc,Ya.length));var Oc=ab.exec(Ya||"");Ya={};for(var Xb=14;Xb--;)Ya[pb[Xb]]=Oc[Xb]||"";-1!=kc&&-1!=Sc&&(Ya.source=ob,Ya.host=Ya.host.substring(1,Ya.host.length-1).replace(/;/g,":"),Ya.authority=Ya.authority.replace("[","").replace("]",
"").replace(/;/g,":"),Ya.ipv6uri=!0);ob=Ya.path;kc=ob.replace(/\/{2,9}/g,"/").split("/");"/"!=ob.substr(0,1)&&0!==ob.length||kc.splice(0,1);"/"==ob.substr(ob.length-1,1)&&kc.splice(kc.length-1,1);Ya.pathNames=kc;Ya.queryKey=ua(Ya,Ya.query);return Ya}}function bd(){function ua(ob){ob=String(ob);if(!(100<ob.length)&&(ob=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(ob))){var kc=parseFloat(ob[1]);switch((ob[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return kc*
Ya;case "days":case "day":case "d":return kc*pb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*kc;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*kc;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*kc;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return kc}}}function ab(ob,kc,Sc){if(!(ob<kc))return ob<1.5*kc?Math.floor(ob/kc)+" "+Sc:Math.ceil(ob/kc)+" "+Sc+"s"}if(va)return la;va=!0;var pb=864E5,Ya=365.25*
pb;return la=function(ob,kc){kc=kc||{};var Sc=typeof ob;if("string"===Sc&&0<ob.length)return ua(ob);if("number"===Sc&&!1===isNaN(ob))return kc.long?ab(ob,pb,"day")||ab(ob,36E5,"hour")||ab(ob,6E4,"minute")||ab(ob,1E3,"second")||ob+" ms":ob>=pb?Math.round(ob/pb)+"d":36E5<=ob?Math.round(ob/36E5)+"h":6E4<=ob?Math.round(ob/6E4)+"m":1E3<=ob?Math.round(ob/1E3)+"s":ob+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(ob));}}function ed(){function ua(Ya){var ob=0,kc;for(kc in Ya)ob=
(ob<<5)-ob+Ya.charCodeAt(kc),ob|=0;return cb.colors[Math.abs(ob)%cb.colors.length]}function ab(Ya){function ob(){if(ob.enabled){var Sc=+new Date;ob.diff=Sc-(kc||Sc);ob.prev=kc;kc=ob.curr=Sc;var Oc=Array(arguments.length);for(Sc=0;Sc<Oc.length;Sc++)Oc[Sc]=arguments[Sc];Oc[0]=cb.coerce(Oc[0]);"string"!==typeof Oc[0]&&Oc.unshift("%O");var Xb=0;Oc[0]=Oc[0].replace(/%([a-zA-Z%])/g,function(Pb,tc){if("%%"===Pb)return Pb;Xb++;tc=cb.formatters[tc];"function"===typeof tc&&(Pb=tc.call(ob,Oc[Xb]),Oc.splice(Xb,
1),Xb--);return Pb});cb.formatArgs.call(ob,Oc);(ob.log||cb.log||console.log.bind(console)).apply(ob,Oc)}}var kc;ob.namespace=Ya;ob.enabled=cb.enabled(Ya);ob.useColors=cb.useColors();ob.color=ua(Ya);ob.destroy=pb;"function"===typeof cb.init&&cb.init(ob);cb.instances.push(ob);return ob}function pb(){var Ya=cb.instances.indexOf(this||ec);return-1!==Ya?(cb.instances.splice(Ya,1),!0):!1}if(fb)return cb;fb=!0;cb=cb=ab.debug=ab["default"]=ab;cb.coerce=function(Ya){return Ya instanceof Error?Ya.stack||Ya.message:
Ya};cb.disable=function(){cb.enable("")};cb.enable=function(Ya){cb.save(Ya);cb.names=[];cb.skips=[];var ob,kc=("string"===typeof Ya?Ya:"").split(/[\s,]+/),Sc=kc.length;for(ob=0;ob<Sc;ob++)kc[ob]&&(Ya=kc[ob].replace(/\*/g,".*?"),"-"===Ya[0]?cb.skips.push(new RegExp("^"+Ya.substr(1)+"$")):cb.names.push(new RegExp("^"+Ya+"$")));for(ob=0;ob<cb.instances.length;ob++)Ya=cb.instances[ob],Ya.enabled=cb.enabled(Ya.namespace)};cb.enabled=function(Ya){if("*"===Ya[Ya.length-1])return!0;var ob;var kc=0;for(ob=
cb.skips.length;kc<ob;kc++)if(cb.skips[kc].test(Ya))return!1;kc=0;for(ob=cb.names.length;kc<ob;kc++)if(cb.names[kc].test(Ya))return!0;return!1};cb.humanize=bd();cb.instances=[];cb.names=[];cb.skips=[];cb.formatters={};return cb}function Od(){function ua(){try{var ob=Nc.storage.debug}catch(kc){}!ob&&"undefined"!==typeof ab&&"env"in ab&&(ob=ab.env.DEBUG);return ob}if(pd)return Nc;pd=!0;var ab=Vb;Nc=Nc=ed();Nc.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};Nc.formatArgs=function(ob){var kc=(this||Yd).useColors;ob[0]=(kc?"%c":"")+(this||Yd).namespace+(kc?" %c":" ")+ob[0]+(kc?"%c ":" ")+"+"+Nc.humanize((this||Yd).diff);if(kc){kc="color: "+(this||Yd).color;ob.splice(1,0,kc,"color: inherit");var Sc=0,Oc=0;ob[0].replace(/%[a-zA-Z%]/g,function(Xb){"%%"!==Xb&&(Sc++,"%c"===Xb&&(Oc=Sc))});ob.splice(Oc,0,kc)}};Nc.save=function(ob){try{null==ob?Nc.storage.removeItem("debug"):Nc.storage.debug=ob}catch(kc){}};Nc.load=ua;Nc.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var pb=Nc;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var Ya=chrome.storage.local;else a:{try{Ya=window.localStorage;break a}catch(ob){}Ya=void 0}pb.storage=Ya;Nc.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
Nc.formatters.j=function(ob){try{return JSON.stringify(ob)}catch(kc){return"[UnexpectedJSONParseError]: "+kc.message}};Nc.enable(ua());return Nc}function qd(){if(Qd)return uc;Qd=!0;var ua=Mc(),ab=Od()("socket.io-client:url");return uc=function(pb,Ya){var ob=pb;Ya=Ya||"undefined"!==typeof location&&location;null==pb&&(pb=Ya.protocol+"//"+Ya.host);"string"===typeof pb&&("/"===pb.charAt(0)&&(pb="/"===pb.charAt(1)?Ya.protocol+pb:Ya.host+pb),/^(https?|wss?):\/\//.test(pb)||(ab("protocol-less url %s",pb),
pb="undefined"!==typeof Ya?Ya.protocol+"//"+pb:"https://"+pb),ab("parse %s",pb),ob=ua(pb));ob.port||(/^(http|ws)$/.test(ob.protocol)?ob.port="80":/^(http|ws)s$/.test(ob.protocol)&&(ob.port="443"));ob.path=ob.path||"/";pb=-1!==ob.host.indexOf(":")?"["+ob.host+"]":ob.host;ob.id=ob.protocol+"://"+pb+":"+ob.port;ob.href=ob.protocol+"://"+pb+(Ya&&Ya.port===ob.port?"":":"+ob.port);return ob}}function Xc(){function ua(ab){if(ab){for(var pb in ua.prototype)ab[pb]=ua.prototype[pb];return ab}}if(zb)return cd;
zb=!0;cd=ua;ua.prototype.on=ua.prototype.addEventListener=function(ab,pb){(this||da)._callbacks=(this||da)._callbacks||{};((this||da)._callbacks["$"+ab]=(this||da)._callbacks["$"+ab]||[]).push(pb);return this||da};ua.prototype.once=function(ab,pb){function Ya(){this.off(ab,Ya);pb.apply(this||da,arguments)}Ya.fn=pb;this.on(ab,Ya);return this||da};ua.prototype.off=ua.prototype.removeListener=ua.prototype.removeAllListeners=ua.prototype.removeEventListener=function(ab,pb){(this||da)._callbacks=(this||
da)._callbacks||{};if(0==arguments.length)return(this||da)._callbacks={},this||da;var Ya=(this||da)._callbacks["$"+ab];if(!Ya)return this||da;if(1==arguments.length)return delete (this||da)._callbacks["$"+ab],this||da;for(var ob,kc=0;kc<Ya.length;kc++)if(ob=Ya[kc],ob===pb||ob.fn===pb){Ya.splice(kc,1);break}0===Ya.length&&delete (this||da)._callbacks["$"+ab];return this||da};ua.prototype.emit=function(ab){(this||da)._callbacks=(this||da)._callbacks||{};for(var pb=Array(arguments.length-1),Ya=(this||
da)._callbacks["$"+ab],ob=1;ob<arguments.length;ob++)pb[ob-1]=arguments[ob];if(Ya){Ya=Ya.slice(0);ob=0;for(var kc=Ya.length;ob<kc;++ob)Ya[ob].apply(this||da,pb)}return this||da};ua.prototype.listeners=function(ab){(this||da)._callbacks=(this||da)._callbacks||{};return(this||da)._callbacks["$"+ab]||[]};ua.prototype.hasListeners=function(ab){return!!this.listeners(ab).length};return cd}function Ra(){if(sb)return ra;sb=!0;var ua={}.toString;return ra=Array.isArray||function(ab){return"[object Array]"==
ua.call(ab)}}function wb(){if(fa)return H;fa=!0;var ua=Wb.Buffer;H=function(Ya){var ob;!(ob=ab&&ua.isBuffer(Ya))&&(ob=pb)&&((ob=Ya instanceof ArrayBuffer)||(ob="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(Ya):Ya.buffer instanceof ArrayBuffer));return ob};var ab="function"===typeof ua&&"function"===typeof ua.isBuffer,pb="function"===typeof ArrayBuffer;return H}function mc(){function ua(Oc,Xb){if(!Oc)return Oc;if(Ya(Oc)){var Pb={_placeholder:!0,num:Xb.length};Xb.push(Oc);return Pb}if(pb(Oc)){Pb=
Array(Oc.length);for(var tc=0;tc<Oc.length;tc++)Pb[tc]=ua(Oc[tc],Xb);return Pb}if("object"===typeof Oc&&!(Oc instanceof Date)){Pb={};for(tc in Oc)Pb[tc]=ua(Oc[tc],Xb);return Pb}return Oc}function ab(Oc,Xb){if(!Oc)return Oc;if(Oc&&Oc._placeholder)return Xb[Oc.num];if(pb(Oc))for(var Pb=0;Pb<Oc.length;Pb++)Oc[Pb]=ab(Oc[Pb],Xb);else if("object"===typeof Oc)for(Pb in Oc)Oc[Pb]=ab(Oc[Pb],Xb);return Oc}if(qb)return Fa;qb=!0;var pb=Ra(),Ya=wb(),ob=Object.prototype.toString,kc="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===ob.call(Blob),Sc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===ob.call(File);Fa.deconstructPacket=function(Oc){var Xb=[];Oc.data=ua(Oc.data,Xb);Oc.attachments=Xb.length;return{packet:Oc,buffers:Xb}};Fa.reconstructPacket=function(Oc,Xb){Oc.data=ab(Oc.data,Xb);Oc.attachments=void 0;return Oc};Fa.removeBlobs=function(Oc,Xb){function Pb(Kc,Hd,ge){if(!Kc)return Kc;if(kc&&Kc instanceof Blob||Sc&&Kc instanceof File){tc++;var sd=
new FileReader;sd.onload=function(){ge?ge[Hd]=(this||nc).result:gb=(this||nc).result;--tc||Xb(gb)};sd.readAsArrayBuffer(Kc)}else if(pb(Kc))for(sd=0;sd<Kc.length;sd++)Pb(Kc[sd],sd,Kc);else if("object"===typeof Kc&&!Ya(Kc))for(sd in Kc)Pb(Kc[sd],sd,Kc)}var tc=0,gb=Oc;Pb(gb);tc||Xb(gb)};return Fa}function dc(){function ua(){}function ab(gb){var Kc=""+gb.type;if(xc.BINARY_EVENT===gb.type||xc.BINARY_ACK===gb.type)Kc+=gb.attachments+"-";gb.nsp&&"/"!==gb.nsp&&(Kc+=gb.nsp+",");null!=gb.id&&(Kc+=gb.id);if(null!=
gb.data){try{var Hd=JSON.stringify(gb.data)}catch(ge){Hd=!1}if(!1!==Hd)Kc+=Hd;else return tc}kc("encoded %j as %s",gb,Kc);return Kc}function pb(gb,Kc){Oc.removeBlobs(gb,function(Hd){var ge=Oc.deconstructPacket(Hd);Hd=ab(ge.packet);ge=ge.buffers;ge.unshift(Hd);Kc(ge)})}function Ya(){(this||Cd).reconstructor=null}function ob(gb){(this||Cd).reconPack=gb;(this||Cd).buffers=[]}if(Bd)return xc;Bd=!0;var kc=Od()("socket.io-parser"),Sc=Xc(),Oc=mc(),Xb=Ra(),Pb=wb();xc.protocol=4;xc.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
xc.CONNECT=0;xc.DISCONNECT=1;xc.EVENT=2;xc.ACK=3;xc.ERROR=4;xc.BINARY_EVENT=5;xc.BINARY_ACK=6;xc.Encoder=ua;xc.Decoder=Ya;var tc=xc.ERROR+'"encode error"';ua.prototype.encode=function(gb,Kc){kc("encoding packet %j",gb);xc.BINARY_EVENT===gb.type||xc.BINARY_ACK===gb.type?pb(gb,Kc):(gb=ab(gb),Kc([gb]))};Sc(Ya.prototype);Ya.prototype.add=function(gb){if("string"===typeof gb){a:{var Kc=0,Hd={type:Number(gb.charAt(0))};if(null==xc.types[Hd.type])gb={type:xc.ERROR,data:"parser error: unknown packet type "+
Hd.type};else{if(xc.BINARY_EVENT===Hd.type||xc.BINARY_ACK===Hd.type){for(var ge="";"-"!==gb.charAt(++Kc)&&(ge+=gb.charAt(Kc),Kc!=gb.length););if(ge!=Number(ge)||"-"!==gb.charAt(Kc))throw Error("Illegal attachments");Hd.attachments=Number(ge)}if("/"===gb.charAt(Kc+1))for(Hd.nsp="";++Kc;){ge=gb.charAt(Kc);if(","===ge)break;Hd.nsp+=ge;if(Kc===gb.length)break}else Hd.nsp="/";ge=gb.charAt(Kc+1);if(""!==ge&&Number(ge)==ge){for(Hd.id="";++Kc;){ge=gb.charAt(Kc);if(null==ge||Number(ge)!=ge){--Kc;break}Hd.id+=
gb.charAt(Kc);if(Kc===gb.length)break}Hd.id=Number(Hd.id)}if(gb.charAt(++Kc)){Kc=gb.substr(Kc);try{var sd=JSON.parse(Kc)}catch(he){sd=!1}if(!1===sd||Hd.type!==xc.ERROR&&!Xb(sd)){gb={type:xc.ERROR,data:"parser error: invalid payload"};break a}else Hd.data=sd}kc("decoded %s as %j",gb,Hd);gb=Hd}}xc.BINARY_EVENT===gb.type||xc.BINARY_ACK===gb.type?((this||Cd).reconstructor=new ob(gb),0===(this||Cd).reconstructor.reconPack.attachments&&this.emit("decoded",gb)):this.emit("decoded",gb)}else if(Pb(gb)||gb.base64)if((this||
Cd).reconstructor){if(gb=(this||Cd).reconstructor.takeBinaryData(gb))(this||Cd).reconstructor=null,this.emit("decoded",gb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+gb);};Ya.prototype.destroy=function(){(this||Cd).reconstructor&&(this||Cd).reconstructor.finishedReconstruction()};ob.prototype.takeBinaryData=function(gb){(this||Cd).buffers.push(gb);return(this||Cd).buffers.length===(this||Cd).reconPack.attachments?(gb=Oc.reconstructPacket((this||
Cd).reconPack,(this||Cd).buffers),this.finishedReconstruction(),gb):null};ob.prototype.finishedReconstruction=function(){(this||Cd).reconPack=null;(this||Cd).buffers=[]};return xc}function Rc(){if(re)return Gd;re=!0;return Gd="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function Tc(){if(yf)return He;yf=!0;if(!jd){jd=!0;try{ue="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(pb){ue=!1}}var ua=ue;var ab=Rc();return He=function(pb){var Ya=
pb.xdomain,ob=pb.xscheme;pb=pb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!Ya||ua))return new XMLHttpRequest}catch(kc){}try{if("undefined"!==typeof XDomainRequest&&!ob&&pb)return new XDomainRequest}catch(kc){}if(!Ya)try{return new (ab[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(kc){}}}function zc(){if(yc)return tf;yc=!0;return tf=Object.keys||function(ua){var ab=[],pb=Object.prototype.hasOwnProperty,Ya;for(Ya in ua)pb.call(ua,Ya)&&ab.push(Ya);return ab}}function Fc(){function ua(Sc){if(!Sc||
"object"!==typeof Sc)return!1;if(pb(Sc)){for(var Oc=0,Xb=Sc.length;Oc<Xb;Oc++)if(ua(Sc[Oc]))return!0;return!1}if("function"===typeof ab&&ab.isBuffer&&ab.isBuffer(Sc)||"function"===typeof ArrayBuffer&&Sc instanceof ArrayBuffer||ob&&Sc instanceof Blob||kc&&Sc instanceof File)return!0;if(Sc.toJSON&&"function"===typeof Sc.toJSON&&1===arguments.length)return ua(Sc.toJSON(),!0);for(Oc in Sc)if(Object.prototype.hasOwnProperty.call(Sc,Oc)&&ua(Sc[Oc]))return!0;return!1}if(mf)return Ie;mf=!0;var ab=Wb.Buffer,
pb=Ra(),Ya=Object.prototype.toString,ob="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Ya.call(Blob),kc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Ya.call(File);return Ie=ua}function Jb(){if(Be)return Jf;Be=!0;return Jf=function(ua,ab,pb){var Ya=ua.byteLength;ab=ab||0;pb=pb||Ya;if(ua.slice)return ua.slice(ab,pb);0>ab&&(ab+=Ya);0>pb&&(pb+=Ya);pb>Ya&&(pb=Ya);if(ab>=Ya||ab>=pb||0===Ya)return new ArrayBuffer(0);ua=new Uint8Array(ua);
Ya=new Uint8Array(pb-ab);for(var ob=0;ab<pb;ab++,ob++)Ya[ob]=ua[ab];return Ya.buffer}}function Ac(){function ua(){}if(Na)return xa;Na=!0;return xa=function(ab,pb,Ya){function ob(Sc,Oc){if(0>=ob.count)throw Error("after called too many times");--ob.count;Sc?(kc=!0,pb(Sc),pb=Ya):0!==ob.count||kc||pb(null,Oc)}var kc=!1;Ya=Ya||ua;ob.count=ab;return 0===ab?pb():ob}}function Bc(){function ua(Xb){for(var Pb=[],tc=0,gb=Xb.length,Kc,Hd;tc<gb;)Kc=Xb.charCodeAt(tc++),55296<=Kc&&56319>=Kc&&tc<gb?(Hd=Xb.charCodeAt(tc++),
56320==(Hd&64512)?Pb.push(((Kc&1023)<<10)+(Hd&1023)+65536):(Pb.push(Kc),tc--)):Pb.push(Kc);return Pb}function ab(Xb,Pb){if(55296<=Xb&&57343>=Xb){if(Pb)throw Error("Lone surrogate U+"+Xb.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function pb(){if(Oc>=Sc)throw Error("Invalid byte index");var Xb=kc[Oc]&255;Oc++;if(128==(Xb&192))return Xb&63;throw Error("Invalid continuation byte");}function Ya(Xb){if(Oc>Sc)throw Error("Invalid byte index");if(Oc==Sc)return!1;var Pb=kc[Oc]&
255;Oc++;if(0==(Pb&128))return Pb;if(192==(Pb&224)){var tc=pb();Pb=(Pb&31)<<6|tc;if(128<=Pb)return Pb;throw Error("Invalid continuation byte");}if(224==(Pb&240)){tc=pb();var gb=pb();Pb=(Pb&15)<<12|tc<<6|gb;if(2048<=Pb)return ab(Pb,Xb)?Pb:65533;throw Error("Invalid continuation byte");}if(240==(Pb&248)&&(tc=pb(),gb=pb(),Xb=pb(),Pb=(Pb&7)<<18|tc<<12|gb<<6|Xb,65536<=Pb&&1114111>=Pb))return Pb;throw Error("Invalid UTF-8 detected");}if(Q)return ub;Q=!0;var ob=String.fromCharCode,kc,Sc,Oc;return ub={version:"2.1.2",
encode:function(Xb,Pb){Pb=Pb||{};Pb=!1!==Pb.strict;Xb=ua(Xb);for(var tc=Xb.length,gb=-1,Kc,Hd="";++gb<tc;){Kc=Xb[gb];var ge=Pb;if(0==(Kc&4294967168))Kc=ob(Kc);else{var sd="";0==(Kc&4294965248)?sd=ob(Kc>>6&31|192):0==(Kc&4294901760)?(ab(Kc,ge)||(Kc=65533),sd=ob(Kc>>12&15|224),sd+=ob(Kc>>6&63|128)):0==(Kc&4292870144)&&(sd=ob(Kc>>18&7|240),sd+=ob(Kc>>12&63|128),sd+=ob(Kc>>6&63|128));Kc=sd+=ob(Kc&63|128)}Hd+=Kc}return Hd},decode:function(Xb,Pb){Pb=Pb||{};Pb=!1!==Pb.strict;kc=ua(Xb);Sc=kc.length;Oc=0;
Xb=[];for(var tc;!1!==(tc=Ya(Pb));)Xb.push(tc);Pb=Xb.length;tc=-1;for(var gb,Kc="";++tc<Pb;)gb=Xb[tc],65535<gb&&(gb-=65536,Kc+=ob(gb>>>10&1023|55296),gb=56320|gb&1023),Kc+=ob(gb);return Kc}}}function fd(){if(Xa)return wa;Xa=!0;(function(ua){wa.encode=function(ab){ab=new Uint8Array(ab);var pb,Ya=ab.length,ob="";for(pb=0;pb<Ya;pb+=3)ob+=ua[ab[pb]>>2],ob+=ua[(ab[pb]&3)<<4|ab[pb+1]>>4],ob+=ua[(ab[pb+1]&15)<<2|ab[pb+2]>>6],ob+=ua[ab[pb+2]&63];2===Ya%3?ob=ob.substring(0,ob.length-1)+"=":1===Ya%3&&(ob=ob.substring(0,
ob.length-2)+"==");return ob};wa.decode=function(ab){var pb=.75*ab.length,Ya=ab.length,ob=0;"="===ab[ab.length-1]&&(pb--,"="===ab[ab.length-2]&&pb--);var kc=new ArrayBuffer(pb),Sc=new Uint8Array(kc);for(pb=0;pb<Ya;pb+=4){var Oc=ua.indexOf(ab[pb]);var Xb=ua.indexOf(ab[pb+1]);var Pb=ua.indexOf(ab[pb+2]);var tc=ua.indexOf(ab[pb+3]);Sc[ob++]=Oc<<2|Xb>>4;Sc[ob++]=(Xb&15)<<4|Pb>>2;Sc[ob++]=(Pb&3)<<6|tc&63}return kc}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return wa}function Qb(){function ua(Oc){return Oc.map(function(Xb){if(Xb.buffer instanceof
ArrayBuffer){var Pb=Xb.buffer;if(Xb.byteLength!==Pb.byteLength){var tc=new Uint8Array(Xb.byteLength);tc.set(new Uint8Array(Pb,Xb.byteOffset,Xb.byteLength));Pb=tc.buffer}return Pb}return Xb})}function ab(Oc,Xb){Xb=Xb||{};var Pb=new Ya;ua(Oc).forEach(function(tc){Pb.append(tc)});return Xb.type?Pb.getBlob(Xb.type):Pb.getBlob()}function pb(Oc,Xb){return new Blob(ua(Oc),Xb||{})}if(rc)return ib;rc=!0;var Ya="undefined"!==typeof Ya?Ya:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var ob=2===(new Blob(["hi"])).size}catch(Oc){ob=!1}var kc;if(kc=ob)try{kc=2===(new Blob([new Uint8Array([1,2])])).size}catch(Oc){kc=!1}var Sc=Ya&&Ya.prototype.append&&Ya.prototype.getBlob;"undefined"!==typeof Blob&&(ab.prototype=Blob.prototype,pb.prototype=Blob.prototype);ib=ob?kc?Blob:pb:Sc?ab:void 0;return ib}function xb(){function ua(sd,he,ve){if(!he)return cc.encodeBase64Packet(sd,ve);var Se=new FileReader;
Se.onload=function(){cc.encodePacket({type:sd.type,data:Se.result},he,!0,ve)};return Se.readAsArrayBuffer(sd.data)}function ab(sd,he,ve){var Se=Array(sd.length);ve=kc(sd.length,ve);for(var Te=function(eg,Ve,li){he(Ve,function(ca,Da){Se[eg]=Da;li(ca,Se)})},Kf=0;Kf<sd.length;Kf++)Te(Kf,sd[Kf],ve)}if(ad)return cc;ad=!0;var pb=zc(),Ya=Fc(),ob=Jb(),kc=Ac(),Sc=Bc(),Oc;"undefined"!==typeof ArrayBuffer&&(Oc=fd());var Xb="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),Pb="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),tc=Xb||Pb;cc.protocol=3;var gb=cc.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},Kc=pb(gb),Hd={type:"error",data:"parser error"},ge=Qb();cc.encodePacket=function(sd,he,ve,Se){"function"===typeof he&&(Se=he,he=!1);"function"===typeof ve&&(Se=ve,ve=null);var Te=void 0===sd.data?void 0:sd.data.buffer||sd.data;if("undefined"!==typeof ArrayBuffer&&Te instanceof ArrayBuffer){if(he){ve=sd.data;he=new Uint8Array(ve);ve=new Uint8Array(1+
ve.byteLength);ve[0]=gb[sd.type];for(sd=0;sd<he.length;sd++)ve[sd+1]=he[sd];sd=Se(ve.buffer)}else sd=cc.encodeBase64Packet(sd,Se);return sd}if("undefined"!==typeof ge&&Te instanceof ge)return he?tc?sd=ua(sd,he,Se):(he=new Uint8Array(1),he[0]=gb[sd.type],sd=new ge([he.buffer,sd.data]),sd=Se(sd)):sd=cc.encodeBase64Packet(sd,Se),sd;if(Te&&Te.base64)return Se("b"+cc.packets[sd.type]+sd.data.data);he=gb[sd.type];void 0!==sd.data&&(he+=ve?Sc.encode(String(sd.data),{strict:!1}):String(sd.data));return Se(""+
he)};cc.encodeBase64Packet=function(sd,he){var ve="b"+cc.packets[sd.type];if("undefined"!==typeof ge&&sd.data instanceof ge){var Se=new FileReader;Se.onload=function(){var eg=Se.result.split(",")[1];he(ve+eg)};return Se.readAsDataURL(sd.data)}try{var Te=String.fromCharCode.apply(null,new Uint8Array(sd.data))}catch(eg){sd=new Uint8Array(sd.data);Te=Array(sd.length);for(var Kf=0;Kf<sd.length;Kf++)Te[Kf]=sd[Kf];Te=String.fromCharCode.apply(null,Te)}ve+=btoa(Te);return he(ve)};cc.decodePacket=function(sd,
he,ve){if(void 0===sd)return Hd;if("string"===typeof sd){if("b"===sd.charAt(0))return cc.decodeBase64Packet(sd.substr(1),he);if(ve){a:{he=sd;try{he=Sc.decode(he,{strict:!1})}catch(Se){sd=!1;break a}sd=he}if(!1===sd)return Hd}ve=sd.charAt(0);return Number(ve)==ve&&Kc[ve]?1<sd.length?{type:Kc[ve],data:sd.substring(1)}:{type:Kc[ve]}:Hd}ve=(new Uint8Array(sd))[0];sd=ob(sd,1);ge&&"blob"===he&&(sd=new ge([sd]));return{type:Kc[ve],data:sd}};cc.decodeBase64Packet=function(sd,he){var ve=Kc[sd.charAt(0)];if(!Oc)return{type:ve,
data:{base64:!0,data:sd.substr(1)}};sd=Oc.decode(sd.substr(1));"blob"===he&&ge&&(sd=new ge([sd]));return{type:ve,data:sd}};cc.encodePayload=function(sd,he,ve){"function"===typeof he&&(ve=he,he=null);var Se=Ya(sd);if(he&&Se)return ge&&!tc?cc.encodePayloadAsBlob(sd,ve):cc.encodePayloadAsArrayBuffer(sd,ve);if(!sd.length)return ve("0:");ab(sd,function(Te,Kf){cc.encodePacket(Te,Se?he:!1,!1,function(eg){Kf(null,eg.length+":"+eg)})},function(Te,Kf){return ve(Kf.join(""))})};cc.decodePayload=function(sd,
he,ve){if("string"!==typeof sd)return cc.decodePayloadAsBinary(sd,he,ve);"function"===typeof he&&(ve=he,he=null);if(""===sd)return ve(Hd,0,1);var Se="";for(var Te,Kf,eg=0,Ve=sd.length;eg<Ve;eg++)if(Kf=sd.charAt(eg),":"!==Kf)Se+=Kf;else{if(""===Se||Se!=(Te=Number(Se)))return ve(Hd,0,1);Kf=sd.substr(eg+1,Te);if(Se!=Kf.length)return ve(Hd,0,1);if(Kf.length){Se=cc.decodePacket(Kf,he,!1);if(Hd.type===Se.type&&Hd.data===Se.data)return ve(Hd,0,1);if(!1===ve(Se,eg+Te,Ve))return}eg+=Te;Se=""}if(""!==Se)return ve(Hd,
0,1)};cc.encodePayloadAsArrayBuffer=function(sd,he){if(!sd.length)return he(new ArrayBuffer(0));ab(sd,function(ve,Se){cc.encodePacket(ve,!0,!0,function(Te){return Se(null,Te)})},function(ve,Se){ve=Se.reduce(function(eg,Ve){Ve="string"===typeof Ve?Ve.length:Ve.byteLength;return eg+Ve.toString().length+Ve+2},0);var Te=new Uint8Array(ve),Kf=0;Se.forEach(function(eg){var Ve="string"===typeof eg,li=eg;if(Ve){li=new Uint8Array(eg.length);for(var ca=0;ca<eg.length;ca++)li[ca]=eg.charCodeAt(ca);li=li.buffer}Ve?
Te[Kf++]=0:Te[Kf++]=1;eg=li.byteLength.toString();for(ca=0;ca<eg.length;ca++)Te[Kf++]=parseInt(eg[ca]);Te[Kf++]=255;li=new Uint8Array(li);for(ca=0;ca<li.length;ca++)Te[Kf++]=li[ca]});return he(Te.buffer)})};cc.encodePayloadAsBlob=function(sd,he){ab(sd,function(ve,Se){cc.encodePacket(ve,!0,!0,function(Te){var Kf=new Uint8Array(1);Kf[0]=1;if("string"===typeof Te){for(var eg=new Uint8Array(Te.length),Ve=0;Ve<Te.length;Ve++)eg[Ve]=Te.charCodeAt(Ve);Te=eg.buffer;Kf[0]=0}eg=(Te instanceof ArrayBuffer?Te.byteLength:
Te.size).toString();var li=new Uint8Array(eg.length+1);for(Ve=0;Ve<eg.length;Ve++)li[Ve]=parseInt(eg[Ve]);li[eg.length]=255;ge&&(Te=new ge([Kf.buffer,li.buffer,Te]),Se(null,Te))})},function(ve,Se){return he(new ge(Se))})};cc.decodePayloadAsBinary=function(sd,he,ve){"function"===typeof he&&(ve=he,he=null);for(var Se=[];0<sd.byteLength;){for(var Te=new Uint8Array(sd),Kf=0===Te[0],eg="",Ve=1;255!==Te[Ve];Ve++){if(310<eg.length)return ve(Hd,0,1);eg+=Te[Ve]}sd=ob(sd,2+eg.length);eg=parseInt(eg);Te=ob(sd,
0,eg);if(Kf)try{Te=String.fromCharCode.apply(null,new Uint8Array(Te))}catch(ca){for(Kf=new Uint8Array(Te),Te="",Ve=0;Ve<Kf.length;Ve++)Te+=String.fromCharCode(Kf[Ve])}Se.push(Te);sd=ob(sd,eg)}var li=Se.length;Se.forEach(function(ca,Da){ve(cc.decodePacket(ca,he,!0),Da,li)})};return cc}function eb(){function ua(Ya){(this||$d).path=Ya.path;(this||$d).hostname=Ya.hostname;(this||$d).port=Ya.port;(this||$d).secure=Ya.secure;(this||$d).query=Ya.query;(this||$d).timestampParam=Ya.timestampParam;(this||$d).timestampRequests=
Ya.timestampRequests;(this||$d).readyState="";(this||$d).agent=Ya.agent||!1;(this||$d).socket=Ya.socket;(this||$d).enablesXDR=Ya.enablesXDR;(this||$d).withCredentials=Ya.withCredentials;(this||$d).pfx=Ya.pfx;(this||$d).key=Ya.key;(this||$d).passphrase=Ya.passphrase;(this||$d).cert=Ya.cert;(this||$d).ca=Ya.ca;(this||$d).ciphers=Ya.ciphers;(this||$d).rejectUnauthorized=Ya.rejectUnauthorized;(this||$d).forceNode=Ya.forceNode;(this||$d).isReactNative=Ya.isReactNative;(this||$d).extraHeaders=Ya.extraHeaders;
(this||$d).localAddress=Ya.localAddress}if(Yc)return Vc;Yc=!0;var ab=xb(),pb=Xc();Vc=ua;pb(ua.prototype);ua.prototype.onError=function(Ya,ob){Ya=Error(Ya);Ya.type="TransportError";Ya.description=ob;this.emit("error",Ya);return this||$d};ua.prototype.open=function(){if("closed"===(this||$d).readyState||""===(this||$d).readyState)(this||$d).readyState="opening",this.doOpen();return this||$d};ua.prototype.close=function(){if("opening"===(this||$d).readyState||"open"===(this||$d).readyState)this.doClose(),
this.onClose();return this||$d};ua.prototype.send=function(Ya){if("open"===(this||$d).readyState)this.write(Ya);else throw Error("Transport not open");};ua.prototype.onOpen=function(){(this||$d).readyState="open";(this||$d).writable=!0;this.emit("open")};ua.prototype.onData=function(Ya){Ya=ab.decodePacket(Ya,(this||$d).socket.binaryType);this.onPacket(Ya)};ua.prototype.onPacket=function(Ya){this.emit("packet",Ya)};ua.prototype.onClose=function(){(this||$d).readyState="closed";this.emit("close")};
return Vc}function vb(){if(Bf)return Mf;Bf=!0;Mf.encode=function(ua){var ab="",pb;for(pb in ua)ua.hasOwnProperty(pb)&&(ab.length&&(ab+="&"),ab+=encodeURIComponent(pb)+"="+encodeURIComponent(ua[pb]));return ab};Mf.decode=function(ua){var ab={};ua=ua.split("&");for(var pb=0,Ya=ua.length;pb<Ya;pb++){var ob=ua[pb].split("=");ab[decodeURIComponent(ob[0])]=decodeURIComponent(ob[1])}return ab};return Mf}function Va(){if(cf)return Hg;cf=!0;return Hg=function(ua,ab){var pb=function(){};pb.prototype=ab.prototype;
ua.prototype=new pb;ua.prototype.constructor=ua}}function lb(){function ua(Oc){var Xb="";do Xb=pb[Oc%64]+Xb,Oc=Math.floor(Oc/64);while(0<Oc);return Xb}function ab(){var Oc=ua(+new Date);return Oc!==Sc?(ob=0,Sc=Oc):Oc+"."+ua(ob++)}if(Di)return Bg;Di=!0;for(var pb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ya={},ob=0,kc=0,Sc;64>kc;kc++)Ya[pb[kc]]=kc;ab.encode=ua;ab.decode=function(Oc){var Xb=0;for(kc=0;kc<Oc.length;kc++)Xb=64*Xb+Ya[Oc.charAt(kc)];return Xb};return Bg=
ab}function yb(){function ua(Xb){var Pb=Xb&&Xb.forceBase64;if(!Oc||Pb)(this||Pe).supportsBinary=!1;ab.call(this||Pe,Xb)}if(Nj)return Pg;Nj=!0;var ab=eb(),pb=vb(),Ya=xb(),ob=Va(),kc=lb(),Sc=Od()("engine.io-client:polling");Pg=ua;var Oc=null!=(new (Tc())({xdomain:!1})).responseType;ob(ua,ab);ua.prototype.name="polling";ua.prototype.doOpen=function(){this.poll()};ua.prototype.pause=function(Xb){function Pb(){Sc("paused");tc.readyState="paused";Xb()}var tc=this||Pe;(this||Pe).readyState="pausing";if((this||
Pe).polling||!(this||Pe).writable){var gb=0;(this||Pe).polling&&(Sc("we are currently polling - waiting to pause"),gb++,this.once("pollComplete",function(){Sc("pre-pause polling complete");--gb||Pb()}));(this||Pe).writable||(Sc("we are currently writing - waiting to pause"),gb++,this.once("drain",function(){Sc("pre-pause writing complete");--gb||Pb()}))}else Pb()};ua.prototype.poll=function(){Sc("polling");(this||Pe).polling=!0;this.doPoll();this.emit("poll")};ua.prototype.onData=function(Xb){var Pb=
this||Pe;Sc("polling got data %s",Xb);Ya.decodePayload(Xb,(this||Pe).socket.binaryType,function(tc,gb,Kc){if("opening"===Pb.readyState)Pb.onOpen();if("close"===tc.type)return Pb.onClose(),!1;Pb.onPacket(tc)});"closed"!==(this||Pe).readyState&&((this||Pe).polling=!1,this.emit("pollComplete"),"open"===(this||Pe).readyState?this.poll():Sc('ignoring poll - transport state "%s"',(this||Pe).readyState))};ua.prototype.doClose=function(){function Xb(){Sc("writing close packet");Pb.write([{type:"close"}])}
var Pb=this||Pe;"open"===(this||Pe).readyState?(Sc("transport open - closing"),Xb()):(Sc("transport not open - deferring close"),this.once("open",Xb))};ua.prototype.write=function(Xb){var Pb=this||Pe;(this||Pe).writable=!1;var tc=function(){Pb.writable=!0;Pb.emit("drain")};Ya.encodePayload(Xb,(this||Pe).supportsBinary,function(gb){Pb.doWrite(gb,tc)})};ua.prototype.uri=function(){var Xb=(this||Pe).query||{},Pb=(this||Pe).secure?"https":"http",tc="";!1!==(this||Pe).timestampRequests&&(Xb[(this||Pe).timestampParam]=
kc());(this||Pe).supportsBinary||Xb.sid||(Xb.b64=1);Xb=pb.encode(Xb);(this||Pe).port&&("https"===Pb&&443!==Number((this||Pe).port)||"http"===Pb&&80!==Number((this||Pe).port))&&(tc=":"+(this||Pe).port);Xb.length&&(Xb="?"+Xb);var gb=-1!==(this||Pe).hostname.indexOf(":");return Pb+"://"+(gb?"["+(this||Pe).hostname+"]":(this||Pe).hostname)+tc+(this||Pe).path+Xb};return Pg}function Zb(){function ua(){}function ab(tc){kc.call(this||ce,tc);(this||ce).requestTimeout=tc.requestTimeout;(this||ce).extraHeaders=
tc.extraHeaders;if("undefined"!==typeof location){var gb="https:"===location.protocol,Kc=location.port;Kc||(Kc=gb?443:80);(this||ce).xd="undefined"!==typeof location&&tc.hostname!==location.hostname||Kc!==tc.port;(this||ce).xs=tc.secure!==gb}}function pb(tc){(this||ce).method=tc.method||"GET";(this||ce).uri=tc.uri;(this||ce).xd=!!tc.xd;(this||ce).xs=!!tc.xs;(this||ce).async=!1!==tc.async;(this||ce).data=void 0!==tc.data?tc.data:null;(this||ce).agent=tc.agent;(this||ce).isBinary=tc.isBinary;(this||
ce).supportsBinary=tc.supportsBinary;(this||ce).enablesXDR=tc.enablesXDR;(this||ce).withCredentials=tc.withCredentials;(this||ce).requestTimeout=tc.requestTimeout;(this||ce).pfx=tc.pfx;(this||ce).key=tc.key;(this||ce).passphrase=tc.passphrase;(this||ce).cert=tc.cert;(this||ce).ca=tc.ca;(this||ce).ciphers=tc.ciphers;(this||ce).rejectUnauthorized=tc.rejectUnauthorized;(this||ce).extraHeaders=tc.extraHeaders;this.create()}function Ya(){for(var tc in pb.requests)pb.requests.hasOwnProperty(tc)&&pb.requests[tc].abort()}
if(Kh)return ki;Kh=!0;var ob=Tc(),kc=yb(),Sc=Xc(),Oc=Va(),Xb=Od()("engine.io-client:polling-xhr"),Pb=Rc();ki=ab;ki.Request=pb;Oc(ab,kc);ab.prototype.supportsBinary=!0;ab.prototype.request=function(tc){tc=tc||{};tc.uri=this.uri();tc.xd=(this||ce).xd;tc.xs=(this||ce).xs;tc.agent=(this||ce).agent||!1;tc.supportsBinary=(this||ce).supportsBinary;tc.enablesXDR=(this||ce).enablesXDR;tc.withCredentials=(this||ce).withCredentials;tc.pfx=(this||ce).pfx;tc.key=(this||ce).key;tc.passphrase=(this||ce).passphrase;
tc.cert=(this||ce).cert;tc.ca=(this||ce).ca;tc.ciphers=(this||ce).ciphers;tc.rejectUnauthorized=(this||ce).rejectUnauthorized;tc.requestTimeout=(this||ce).requestTimeout;tc.extraHeaders=(this||ce).extraHeaders;return new pb(tc)};ab.prototype.doWrite=function(tc,gb){tc=this.request({method:"POST",data:tc,isBinary:"string"!==typeof tc&&void 0!==tc});var Kc=this||ce;tc.on("success",gb);tc.on("error",function(Hd){Kc.onError("xhr post error",Hd)});(this||ce).sendXhr=tc};ab.prototype.doPoll=function(){Xb("xhr poll");
var tc=this.request(),gb=this||ce;tc.on("data",function(Kc){gb.onData(Kc)});tc.on("error",function(Kc){gb.onError("xhr poll error",Kc)});(this||ce).pollXhr=tc};Sc(pb.prototype);pb.prototype.create=function(){var tc={agent:(this||ce).agent,xdomain:(this||ce).xd,xscheme:(this||ce).xs,enablesXDR:(this||ce).enablesXDR};tc.pfx=(this||ce).pfx;tc.key=(this||ce).key;tc.passphrase=(this||ce).passphrase;tc.cert=(this||ce).cert;tc.ca=(this||ce).ca;tc.ciphers=(this||ce).ciphers;tc.rejectUnauthorized=(this||ce).rejectUnauthorized;
var gb=(this||ce).xhr=new ob(tc),Kc=this||ce;try{Xb("xhr open %s: %s",(this||ce).method,(this||ce).uri);gb.open((this||ce).method,(this||ce).uri,(this||ce).async);try{if((this||ce).extraHeaders){gb.setDisableHeaderCheck&&gb.setDisableHeaderCheck(!0);for(var Hd in(this||ce).extraHeaders)(this||ce).extraHeaders.hasOwnProperty(Hd)&&gb.setRequestHeader(Hd,(this||ce).extraHeaders[Hd])}}catch(ge){}if("POST"===(this||ce).method)try{(this||ce).isBinary?gb.setRequestHeader("Content-type","application/octet-stream"):
gb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(ge){}try{gb.setRequestHeader("Accept","*/*")}catch(ge){}"withCredentials"in gb&&(gb.withCredentials=(this||ce).withCredentials);(this||ce).requestTimeout&&(gb.timeout=(this||ce).requestTimeout);this.hasXDR()?(gb.onload=function(){Kc.onLoad()},gb.onerror=function(){Kc.onError(gb.responseText)}):gb.onreadystatechange=function(){if(2===gb.readyState)try{var ge=gb.getResponseHeader("Content-Type");if(Kc.supportsBinary&&"application/octet-stream"===
ge||"application/octet-stream; charset=UTF-8"===ge)gb.responseType="arraybuffer"}catch(sd){}if(4===gb.readyState)if(200===gb.status||1223===gb.status)Kc.onLoad();else setTimeout(function(){Kc.onError("number"===typeof gb.status?gb.status:0)},0)};Xb("xhr data %s",(this||ce).data);gb.send((this||ce).data)}catch(ge){setTimeout(function(){Kc.onError(ge)},0);return}"undefined"!==typeof document&&((this||ce).index=pb.requestsCount++,pb.requests[(this||ce).index]=this||ce)};pb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};pb.prototype.onData=function(tc){this.emit("data",tc);this.onSuccess()};pb.prototype.onError=function(tc){this.emit("error",tc);this.cleanup(!0)};pb.prototype.cleanup=function(tc){if("undefined"!==typeof(this||ce).xhr&&null!==(this||ce).xhr){this.hasXDR()?(this||ce).xhr.onload=(this||ce).xhr.onerror=ua:(this||ce).xhr.onreadystatechange=ua;if(tc)try{(this||ce).xhr.abort()}catch(gb){}"undefined"!==typeof document&&delete pb.requests[(this||ce).index];(this||ce).xhr=null}};pb.prototype.onLoad=
function(){try{try{var tc=(this||ce).xhr.getResponseHeader("Content-Type")}catch(Kc){}var gb="application/octet-stream"===tc||"application/octet-stream; charset=UTF-8"===tc?(this||ce).xhr.response||(this||ce).xhr.responseText:(this||ce).xhr.responseText}catch(Kc){this.onError(Kc)}if(null!=gb)this.onData(gb)};pb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||ce).xs&&(this||ce).enablesXDR};pb.prototype.abort=function(){this.cleanup()};pb.requestsCount=0;pb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",Ya):"function"===typeof addEventListener&&addEventListener("onpagehide"in Pb?"pagehide":"unload",Ya,!1));return ki}function Sb(){function ua(){}function ab(Xb){pb.call(this||lg,Xb);(this||lg).query=(this||lg).query||{};Oc||(Oc=ob.___eio=ob.___eio||[]);(this||lg).index=Oc.length;var Pb=this||lg;Oc.push(function(tc){Pb.onData(tc)});(this||lg).query.j=(this||lg).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){Pb.script&&(Pb.script.onerror=ua)},!1)}if(Mj)return gj;Mj=!0;var pb=yb(),Ya=Va(),ob=Rc();gj=ab;var kc=/\n/g,Sc=/\\n/g,Oc;Ya(ab,pb);ab.prototype.supportsBinary=!1;ab.prototype.doClose=function(){(this||lg).script&&((this||lg).script.parentNode.removeChild((this||lg).script),(this||lg).script=null);(this||lg).form&&((this||lg).form.parentNode.removeChild((this||lg).form),(this||lg).form=null,(this||lg).iframe=null);pb.prototype.doClose.call(this||lg)};ab.prototype.doPoll=function(){var Xb=
this||lg,Pb=document.createElement("script");(this||lg).script&&((this||lg).script.parentNode.removeChild((this||lg).script),(this||lg).script=null);Pb.async=!0;Pb.src=this.uri();Pb.onerror=function(gb){Xb.onError("jsonp poll error",gb)};var tc=document.getElementsByTagName("script")[0];tc?tc.parentNode.insertBefore(Pb,tc):(document.head||document.body).appendChild(Pb);(this||lg).script=Pb;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var gb=document.createElement("iframe");
document.body.appendChild(gb);document.body.removeChild(gb)},100)};ab.prototype.doWrite=function(Xb,Pb){function tc(){gb();Pb()}function gb(){if(Kc.iframe)try{Kc.form.removeChild(Kc.iframe)}catch(ve){Kc.onError("jsonp polling iframe removal error",ve)}try{he=document.createElement('<iframe src="javascript:0" name="'+Kc.iframeId+'">')}catch(ve){he=document.createElement("iframe"),he.name=Kc.iframeId,he.src="javascript:0"}he.id=Kc.iframeId;Kc.form.appendChild(he);Kc.iframe=he}var Kc=this||lg;if(!(this||
lg).form){var Hd=document.createElement("form"),ge=document.createElement("textarea"),sd=(this||lg).iframeId="eio_iframe_"+(this||lg).index,he;Hd.className="socketio";Hd.style.position="absolute";Hd.style.top="-1000px";Hd.style.left="-1000px";Hd.target=sd;Hd.method="POST";Hd.setAttribute("accept-charset","utf-8");ge.name="d";Hd.appendChild(ge);document.body.appendChild(Hd);(this||lg).form=Hd;(this||lg).area=ge}(this||lg).form.action=this.uri();gb();Xb=Xb.replace(Sc,"\\\n");(this||lg).area.value=Xb.replace(kc,
"\\n");try{(this||lg).form.submit()}catch(ve){}(this||lg).iframe.attachEvent?(this||lg).iframe.onreadystatechange=function(){"complete"===Kc.iframe.readyState&&tc()}:(this||lg).iframe.onload=tc};return gj}function $a(){if(Tj)return yk;Tj=!0;return yk=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function bb(){function ua(gb){gb&&gb.forceBase64&&((this||zf).supportsBinary=!1);(this||zf).perMessageDeflate=gb.perMessageDeflate;(this||
zf).usingBrowserWebSocket=Xb&&!gb.forceNode;(this||zf).protocols=gb.protocols;(this||zf).usingBrowserWebSocket||(tc=Pb);pb.call(this||zf,gb)}if(Bh)return Bj;Bh=!0;var ab=Wb.Buffer,pb=eb(),Ya=xb(),ob=vb(),kc=Va(),Sc=lb(),Oc=Od()("engine.io-client:websocket"),Xb;"undefined"!==typeof WebSocket?Xb=WebSocket:"undefined"!==typeof self&&(Xb=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var Pb=$a()}catch(gb){}var tc=Xb||Pb;Bj=ua;kc(ua,pb);ua.prototype.name="websocket";ua.prototype.supportsBinary=
!0;ua.prototype.doOpen=function(){if(this.check()){var gb=this.uri(),Kc=(this||zf).protocols,Hd={};(this||zf).isReactNative||(Hd.agent=(this||zf).agent,Hd.perMessageDeflate=(this||zf).perMessageDeflate,Hd.pfx=(this||zf).pfx,Hd.key=(this||zf).key,Hd.passphrase=(this||zf).passphrase,Hd.cert=(this||zf).cert,Hd.ca=(this||zf).ca,Hd.ciphers=(this||zf).ciphers,Hd.rejectUnauthorized=(this||zf).rejectUnauthorized);(this||zf).extraHeaders&&(Hd.headers=(this||zf).extraHeaders);(this||zf).localAddress&&(Hd.localAddress=
(this||zf).localAddress);try{(this||zf).ws=(this||zf).usingBrowserWebSocket&&!(this||zf).isReactNative?Kc?new tc(gb,Kc):new tc(gb):new tc(gb,Kc,Hd)}catch(ge){return this.emit("error",ge)}void 0===(this||zf).ws.binaryType&&((this||zf).supportsBinary=!1);(this||zf).ws.supports&&(this||zf).ws.supports.binary?((this||zf).supportsBinary=!0,(this||zf).ws.binaryType="nodebuffer"):(this||zf).ws.binaryType="arraybuffer";this.addEventListeners()}};ua.prototype.addEventListeners=function(){var gb=this||zf;(this||
zf).ws.onopen=function(){gb.onOpen()};(this||zf).ws.onclose=function(){gb.onClose()};(this||zf).ws.onmessage=function(Kc){gb.onData(Kc.data)};(this||zf).ws.onerror=function(Kc){gb.onError("websocket error",Kc)}};ua.prototype.write=function(gb){function Kc(){Hd.emit("flush");setTimeout(function(){Hd.writable=!0;Hd.emit("drain")},0)}var Hd=this||zf;(this||zf).writable=!1;for(var ge=gb.length,sd=0,he=ge;sd<he;sd++)(function(ve){Ya.encodePacket(ve,Hd.supportsBinary,function(Se){if(!Hd.usingBrowserWebSocket){var Te=
{};ve.options&&(Te.compress=ve.options.compress);Hd.perMessageDeflate&&("string"===typeof Se?ab.byteLength(Se):Se.length)<Hd.perMessageDeflate.threshold&&(Te.compress=!1)}try{Hd.usingBrowserWebSocket?Hd.ws.send(Se):Hd.ws.send(Se,Te)}catch(Kf){Oc("websocket closed before onclose event")}--ge||Kc()})})(gb[sd])};ua.prototype.onClose=function(){pb.prototype.onClose.call(this||zf)};ua.prototype.doClose=function(){"undefined"!==typeof(this||zf).ws&&(this||zf).ws.close()};ua.prototype.uri=function(){var gb=
(this||zf).query||{},Kc=(this||zf).secure?"wss":"ws",Hd="";(this||zf).port&&("wss"===Kc&&443!==Number((this||zf).port)||"ws"===Kc&&80!==Number((this||zf).port))&&(Hd=":"+(this||zf).port);(this||zf).timestampRequests&&(gb[(this||zf).timestampParam]=Sc());(this||zf).supportsBinary||(gb.b64=1);gb=ob.encode(gb);gb.length&&(gb="?"+gb);var ge=-1!==(this||zf).hostname.indexOf(":");return Kc+"://"+(ge?"["+(this||zf).hostname+"]":(this||zf).hostname)+Hd+(this||zf).path+gb};ua.prototype.check=function(){return!!tc&&
!("__initialize"in tc&&(this||zf).name===ua.prototype.name)};return Bj}function Kb(){if(ll)return Ze;ll=!0;var ua=Tc(),ab=Zb(),pb=Sb(),Ya=bb();Ze.polling=function(ob){var kc=!1,Sc=!1,Oc=!1!==ob.jsonp;"undefined"!==typeof location&&(Sc="https:"===location.protocol,(kc=location.port)||(kc=Sc?443:80),kc=ob.hostname!==location.hostname||kc!==ob.port,Sc=ob.secure!==Sc);ob.xdomain=kc;ob.xscheme=Sc;if("open"in new ua(ob)&&!ob.forceJSONP)return new ab(ob);if(!Oc)throw Error("JSONP disabled");return new pb(ob)};
Ze.websocket=Ya;return Ze}function wc(){if(Zc)return Sa;Zc=!0;var ua=[].indexOf;return Sa=function(ab,pb){if(ua)return ab.indexOf(pb);for(var Ya=0;Ya<ab.length;++Ya)if(ab[Ya]===pb)return Ya;return-1}}function fc(){function ua(Xb,Pb){if(!((this||Lc)instanceof ua))return new ua(Xb,Pb);Pb=Pb||{};Xb&&"object"===typeof Xb&&(Pb=Xb,Xb=null);Xb?(Xb=Sc(Xb),Pb.hostname=Xb.host,Pb.secure="https"===Xb.protocol||"wss"===Xb.protocol,Pb.port=Xb.port,Xb.query&&(Pb.query=Xb.query)):Pb.host&&(Pb.hostname=Sc(Pb.host).host);
(this||Lc).secure=null!=Pb.secure?Pb.secure:"undefined"!==typeof location&&"https:"===location.protocol;Pb.hostname&&!Pb.port&&(Pb.port=(this||Lc).secure?"443":"80");(this||Lc).agent=Pb.agent||!1;(this||Lc).hostname=Pb.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||Lc).port=Pb.port||("undefined"!==typeof location&&location.port?location.port:(this||Lc).secure?443:80);(this||Lc).query=Pb.query||{};"string"===typeof(this||Lc).query&&((this||Lc).query=Oc.decode((this||
Lc).query));(this||Lc).upgrade=!1!==Pb.upgrade;(this||Lc).path=(Pb.path||"/engine.io").replace(/\/$/,"")+"/";(this||Lc).forceJSONP=!!Pb.forceJSONP;(this||Lc).jsonp=!1!==Pb.jsonp;(this||Lc).forceBase64=!!Pb.forceBase64;(this||Lc).enablesXDR=!!Pb.enablesXDR;(this||Lc).withCredentials=!1!==Pb.withCredentials;(this||Lc).timestampParam=Pb.timestampParam||"t";(this||Lc).timestampRequests=Pb.timestampRequests;(this||Lc).transports=Pb.transports||["polling","websocket"];(this||Lc).transportOptions=Pb.transportOptions||
{};(this||Lc).readyState="";(this||Lc).writeBuffer=[];(this||Lc).prevBufferLen=0;(this||Lc).policyPort=Pb.policyPort||843;(this||Lc).rememberUpgrade=Pb.rememberUpgrade||!1;(this||Lc).binaryType=null;(this||Lc).onlyBinaryUpgrades=Pb.onlyBinaryUpgrades;(this||Lc).perMessageDeflate=!1!==Pb.perMessageDeflate?Pb.perMessageDeflate||{}:!1;!0===(this||Lc).perMessageDeflate&&((this||Lc).perMessageDeflate={});(this||Lc).perMessageDeflate&&null==(this||Lc).perMessageDeflate.threshold&&((this||Lc).perMessageDeflate.threshold=
1024);(this||Lc).pfx=Pb.pfx||null;(this||Lc).key=Pb.key||null;(this||Lc).passphrase=Pb.passphrase||null;(this||Lc).cert=Pb.cert||null;(this||Lc).ca=Pb.ca||null;(this||Lc).ciphers=Pb.ciphers||null;(this||Lc).rejectUnauthorized=void 0===Pb.rejectUnauthorized?!0:Pb.rejectUnauthorized;(this||Lc).forceNode=!!Pb.forceNode;(this||Lc).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||Lc).isReactNative)Pb.extraHeaders&&
0<Object.keys(Pb.extraHeaders).length&&((this||Lc).extraHeaders=Pb.extraHeaders),Pb.localAddress&&((this||Lc).localAddress=Pb.localAddress);(this||Lc).id=null;(this||Lc).upgrades=null;(this||Lc).pingInterval=null;(this||Lc).pingTimeout=null;(this||Lc).pingIntervalTimer=null;(this||Lc).pingTimeoutTimer=null;this.open()}if(Vd)return Zd;Vd=!0;var ab=Kb(),pb=Xc(),Ya=Od()("engine.io-client:socket"),ob=wc(),kc=xb(),Sc=Mc(),Oc=vb();Zd=ua;ua.priorWebsocketSuccess=!1;pb(ua.prototype);ua.protocol=kc.protocol;
ua.Socket=ua;ua.Transport=eb();ua.transports=Kb();ua.parser=xb();ua.prototype.createTransport=function(Xb){Ya('creating transport "%s"',Xb);var Pb=(this||Lc).query,tc={},gb;for(gb in Pb)Pb.hasOwnProperty(gb)&&(tc[gb]=Pb[gb]);tc.EIO=kc.protocol;tc.transport=Xb;Pb=(this||Lc).transportOptions[Xb]||{};(this||Lc).id&&(tc.sid=(this||Lc).id);return new ab[Xb]({query:tc,socket:this||Lc,agent:Pb.agent||(this||Lc).agent,hostname:Pb.hostname||(this||Lc).hostname,port:Pb.port||(this||Lc).port,secure:Pb.secure||
(this||Lc).secure,path:Pb.path||(this||Lc).path,forceJSONP:Pb.forceJSONP||(this||Lc).forceJSONP,jsonp:Pb.jsonp||(this||Lc).jsonp,forceBase64:Pb.forceBase64||(this||Lc).forceBase64,enablesXDR:Pb.enablesXDR||(this||Lc).enablesXDR,withCredentials:Pb.withCredentials||(this||Lc).withCredentials,timestampRequests:Pb.timestampRequests||(this||Lc).timestampRequests,timestampParam:Pb.timestampParam||(this||Lc).timestampParam,policyPort:Pb.policyPort||(this||Lc).policyPort,pfx:Pb.pfx||(this||Lc).pfx,key:Pb.key||
(this||Lc).key,passphrase:Pb.passphrase||(this||Lc).passphrase,cert:Pb.cert||(this||Lc).cert,ca:Pb.ca||(this||Lc).ca,ciphers:Pb.ciphers||(this||Lc).ciphers,rejectUnauthorized:Pb.rejectUnauthorized||(this||Lc).rejectUnauthorized,perMessageDeflate:Pb.perMessageDeflate||(this||Lc).perMessageDeflate,extraHeaders:Pb.extraHeaders||(this||Lc).extraHeaders,forceNode:Pb.forceNode||(this||Lc).forceNode,localAddress:Pb.localAddress||(this||Lc).localAddress,requestTimeout:Pb.requestTimeout||(this||Lc).requestTimeout,
protocols:Pb.protocols||void 0,isReactNative:(this||Lc).isReactNative})};ua.prototype.open=function(){if((this||Lc).rememberUpgrade&&ua.priorWebsocketSuccess&&-1!==(this||Lc).transports.indexOf("websocket"))var Xb="websocket";else{if(0===(this||Lc).transports.length){var Pb=this||Lc;setTimeout(function(){Pb.emit("error","No transports available")},0);return}Xb=(this||Lc).transports[0]}(this||Lc).readyState="opening";try{Xb=this.createTransport(Xb)}catch(tc){(this||Lc).transports.shift();this.open();
return}Xb.open();this.setTransport(Xb)};ua.prototype.setTransport=function(Xb){Ya("setting transport %s",Xb.name);var Pb=this||Lc;(this||Lc).transport&&(Ya("clearing existing transport %s",(this||Lc).transport.name),(this||Lc).transport.removeAllListeners());(this||Lc).transport=Xb;Xb.on("drain",function(){Pb.onDrain()}).on("packet",function(tc){Pb.onPacket(tc)}).on("error",function(tc){Pb.onError(tc)}).on("close",function(){Pb.onClose("transport close")})};ua.prototype.probe=function(Xb){function Pb(){if(Se.onlyBinaryUpgrades){var Te=
!(this||Lc).supportsBinary&&Se.transport.supportsBinary;ve=ve||Te}ve||(Ya('probe transport "%s" opened',Xb),he.send([{type:"ping",data:"probe"}]),he.once("packet",function(Kf){ve||("pong"===Kf.type&&"probe"===Kf.data?(Ya('probe transport "%s" pong',Xb),Se.upgrading=!0,Se.emit("upgrading",he),he&&(ua.priorWebsocketSuccess="websocket"===he.name,Ya('pausing current transport "%s"',Se.transport.name),Se.transport.pause(function(){ve||"closed"===Se.readyState||(Ya("changing transport and sending upgrade packet"),
sd(),Se.setTransport(he),he.send([{type:"upgrade"}]),Se.emit("upgrade",he),he=null,Se.upgrading=!1,Se.flush())}))):(Ya('probe transport "%s" failed',Xb),Kf=Error("probe error"),Kf.transport=he.name,Se.emit("upgradeError",Kf)))}))}function tc(){ve||(ve=!0,sd(),he.close(),he=null)}function gb(Te){var Kf=Error("probe error: "+Te);Kf.transport=he.name;tc();Ya('probe transport "%s" failed because of error: %s',Xb,Te);Se.emit("upgradeError",Kf)}function Kc(){gb("transport closed")}function Hd(){gb("socket closed")}
function ge(Te){he&&Te.name!==he.name&&(Ya('"%s" works - aborting "%s"',Te.name,he.name),tc())}function sd(){he.removeListener("open",Pb);he.removeListener("error",gb);he.removeListener("close",Kc);Se.removeListener("close",Hd);Se.removeListener("upgrading",ge)}Ya('probing transport "%s"',Xb);var he=this.createTransport(Xb,{probe:1}),ve=!1,Se=this||Lc;ua.priorWebsocketSuccess=!1;he.once("open",Pb);he.once("error",gb);he.once("close",Kc);this.once("close",Hd);this.once("upgrading",ge);he.open()};ua.prototype.onOpen=
function(){Ya("socket open");(this||Lc).readyState="open";ua.priorWebsocketSuccess="websocket"===(this||Lc).transport.name;this.emit("open");this.flush();if("open"===(this||Lc).readyState&&(this||Lc).upgrade&&(this||Lc).transport.pause){Ya("starting upgrade probes");for(var Xb=0,Pb=(this||Lc).upgrades.length;Xb<Pb;Xb++)this.probe((this||Lc).upgrades[Xb])}};ua.prototype.onPacket=function(Xb){if("opening"===(this||Lc).readyState||"open"===(this||Lc).readyState||"closing"===(this||Lc).readyState)switch(Ya('socket receive: type "%s", data "%s"',
Xb.type,Xb.data),this.emit("packet",Xb),this.emit("heartbeat"),Xb.type){case "open":this.onHandshake(JSON.parse(Xb.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var Pb=Error("server error");Pb.code=Xb.data;this.onError(Pb);break;case "message":this.emit("data",Xb.data),this.emit("message",Xb.data)}else Ya('packet received with socket readyState "%s"',(this||Lc).readyState)};ua.prototype.onHandshake=function(Xb){this.emit("handshake",Xb);(this||Lc).id=Xb.sid;(this||Lc).transport.query.sid=
Xb.sid;(this||Lc).upgrades=this.filterUpgrades(Xb.upgrades);(this||Lc).pingInterval=Xb.pingInterval;(this||Lc).pingTimeout=Xb.pingTimeout;this.onOpen();"closed"!==(this||Lc).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||Lc).onHeartbeat),this.on("heartbeat",(this||Lc).onHeartbeat))};ua.prototype.onHeartbeat=function(Xb){clearTimeout((this||Lc).pingTimeoutTimer);var Pb=this||Lc;Pb.pingTimeoutTimer=setTimeout(function(){if("closed"!==Pb.readyState)Pb.onClose("ping timeout")},Xb||
Pb.pingInterval+Pb.pingTimeout)};ua.prototype.setPing=function(){var Xb=this||Lc;clearTimeout(Xb.pingIntervalTimer);Xb.pingIntervalTimer=setTimeout(function(){Ya("writing ping packet - expecting pong within %sms",Xb.pingTimeout);Xb.ping();Xb.onHeartbeat(Xb.pingTimeout)},Xb.pingInterval)};ua.prototype.ping=function(){var Xb=this||Lc;this.sendPacket("ping",function(){Xb.emit("ping")})};ua.prototype.onDrain=function(){(this||Lc).writeBuffer.splice(0,(this||Lc).prevBufferLen);(this||Lc).prevBufferLen=
0;0===(this||Lc).writeBuffer.length?this.emit("drain"):this.flush()};ua.prototype.flush=function(){"closed"!==(this||Lc).readyState&&(this||Lc).transport.writable&&!(this||Lc).upgrading&&(this||Lc).writeBuffer.length&&(Ya("flushing %d packets in socket",(this||Lc).writeBuffer.length),(this||Lc).transport.send((this||Lc).writeBuffer),(this||Lc).prevBufferLen=(this||Lc).writeBuffer.length,this.emit("flush"))};ua.prototype.write=ua.prototype.send=function(Xb,Pb,tc){this.sendPacket("message",Xb,Pb,tc);
return this||Lc};ua.prototype.sendPacket=function(Xb,Pb,tc,gb){"function"===typeof Pb&&(gb=Pb,Pb=void 0);"function"===typeof tc&&(gb=tc,tc=null);if("closing"!==(this||Lc).readyState&&"closed"!==(this||Lc).readyState){tc=tc||{};tc.compress=!1!==tc.compress;Xb={type:Xb,data:Pb,options:tc};this.emit("packetCreate",Xb);(this||Lc).writeBuffer.push(Xb);if(gb)this.once("flush",gb);this.flush()}};ua.prototype.close=function(){function Xb(){gb.onClose("forced close");Ya("socket closing - telling transport to close");
gb.transport.close()}function Pb(){gb.removeListener("upgrade",Pb);gb.removeListener("upgradeError",Pb);Xb()}function tc(){gb.once("upgrade",Pb);gb.once("upgradeError",Pb)}if("opening"===(this||Lc).readyState||"open"===(this||Lc).readyState){(this||Lc).readyState="closing";var gb=this||Lc;if((this||Lc).writeBuffer.length)this.once("drain",function(){(this||Lc).upgrading?tc():Xb()});else(this||Lc).upgrading?tc():Xb()}return this||Lc};ua.prototype.onError=function(Xb){Ya("socket error %j",Xb);ua.priorWebsocketSuccess=
!1;this.emit("error",Xb);this.onClose("transport error",Xb)};ua.prototype.onClose=function(Xb,Pb){if("opening"===(this||Lc).readyState||"open"===(this||Lc).readyState||"closing"===(this||Lc).readyState){Ya('socket close with reason: "%s"',Xb);var tc=this||Lc;clearTimeout((this||Lc).pingIntervalTimer);clearTimeout((this||Lc).pingTimeoutTimer);(this||Lc).transport.removeAllListeners("close");(this||Lc).transport.close();(this||Lc).transport.removeAllListeners();(this||Lc).readyState="closed";(this||
Lc).id=null;this.emit("close",Xb,Pb);tc.writeBuffer=[];tc.prevBufferLen=0}};ua.prototype.filterUpgrades=function(Xb){for(var Pb=[],tc=0,gb=Xb.length;tc<gb;tc++)~ob((this||Lc).transports,Xb[tc])&&Pb.push(Xb[tc]);return Pb};return Zd}function bc(){if(Cm)return Rk;Cm=!0;return Rk=function(ua,ab){for(var pb=[],Ya=(ab=ab||0)||0;Ya<ua.length;Ya++)pb[Ya-ab]=ua[Ya];return pb}}function Tb(){if(hj)return Um;hj=!0;return Um=function(ua,ab,pb){ua.on(ab,pb);return{destroy:function(){ua.removeListener(ab,pb)}}}}
function I(){if(Pk)return Jl;Pk=!0;var ua=[].slice;return Jl=function(ab,pb){"string"==typeof pb&&(pb=ab[pb]);if("function"!=typeof pb)throw Error("bind() requires a function");var Ya=ua.call(arguments,2);return function(){return pb.apply(ab,Ya.concat(ua.call(arguments)))}}}function T(){function ua(gb,Kc,Hd){(this||Ge).io=gb;(this||Ge).nsp=Kc;(this||Ge).json=this||Ge;(this||Ge).ids=0;(this||Ge).acks={};(this||Ge).receiveBuffer=[];(this||Ge).sendBuffer=[];(this||Ge).connected=!1;(this||Ge).disconnected=
!0;(this||Ge).flags={};Hd&&Hd.query&&((this||Ge).query=Hd.query);(this||Ge).io.autoConnect&&this.open()}if(Kl)return zk;Kl=!0;var ab=dc(),pb=Xc(),Ya=bc(),ob=Tb(),kc=I(),Sc=Od()("socket.io-client:socket"),Oc=vb(),Xb=Fc();zk=zk=ua;var Pb={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},tc=pb.prototype.emit;pb(ua.prototype);ua.prototype.subEvents=function(){if(!(this||Ge).subs){var gb=
(this||Ge).io;(this||Ge).subs=[ob(gb,"open",kc(this||Ge,"onopen")),ob(gb,"packet",kc(this||Ge,"onpacket")),ob(gb,"close",kc(this||Ge,"onclose"))]}};ua.prototype.open=ua.prototype.connect=function(){if((this||Ge).connected)return this||Ge;this.subEvents();(this||Ge).io.reconnecting||(this||Ge).io.open();if("open"===(this||Ge).io.readyState)this.onopen();this.emit("connecting");return this||Ge};ua.prototype.send=function(){var gb=Ya(arguments);gb.unshift("message");(this||Ge).emit.apply(this||Ge,gb);
return this||Ge};ua.prototype.emit=function(gb){if(Pb.hasOwnProperty(gb))return tc.apply(this||Ge,arguments),this||Ge;var Kc=Ya(arguments),Hd={type:(void 0!==(this||Ge).flags.binary?(this||Ge).flags.binary:Xb(Kc))?ab.BINARY_EVENT:ab.EVENT,data:Kc,options:{}};Hd.options.compress=!(this||Ge).flags||!1!==(this||Ge).flags.compress;"function"===typeof Kc[Kc.length-1]&&(Sc("emitting packet with ack id %d",(this||Ge).ids),(this||Ge).acks[(this||Ge).ids]=Kc.pop(),Hd.id=(this||Ge).ids++);(this||Ge).connected?
this.packet(Hd):(this||Ge).sendBuffer.push(Hd);(this||Ge).flags={};return this||Ge};ua.prototype.packet=function(gb){gb.nsp=(this||Ge).nsp;(this||Ge).io.packet(gb)};ua.prototype.onopen=function(){Sc("transport is open - connecting");if("/"!==(this||Ge).nsp)if((this||Ge).query){var gb="object"===typeof(this||Ge).query?Oc.encode((this||Ge).query):(this||Ge).query;Sc("sending connect packet with query %s",gb);this.packet({type:ab.CONNECT,query:gb})}else this.packet({type:ab.CONNECT})};ua.prototype.onclose=
function(gb){Sc("close (%s)",gb);(this||Ge).connected=!1;(this||Ge).disconnected=!0;delete (this||Ge).id;this.emit("disconnect",gb)};ua.prototype.onpacket=function(gb){var Kc=gb.type===ab.ERROR&&"/"===gb.nsp;if(gb.nsp===(this||Ge).nsp||Kc)switch(gb.type){case ab.CONNECT:this.onconnect();break;case ab.EVENT:this.onevent(gb);break;case ab.BINARY_EVENT:this.onevent(gb);break;case ab.ACK:this.onack(gb);break;case ab.BINARY_ACK:this.onack(gb);break;case ab.DISCONNECT:this.ondisconnect();break;case ab.ERROR:this.emit("error",
gb.data)}};ua.prototype.onevent=function(gb){var Kc=gb.data||[];Sc("emitting event %j",Kc);null!=gb.id&&(Sc("attaching ack callback to event"),Kc.push(this.ack(gb.id)));(this||Ge).connected?tc.apply(this||Ge,Kc):(this||Ge).receiveBuffer.push(Kc)};ua.prototype.ack=function(gb){var Kc=this||Ge,Hd=!1;return function(){if(!Hd){Hd=!0;var ge=Ya(arguments);Sc("sending ack %j",ge);Kc.packet({type:Xb(ge)?ab.BINARY_ACK:ab.ACK,id:gb,data:ge})}}};ua.prototype.onack=function(gb){var Kc=(this||Ge).acks[gb.id];
"function"===typeof Kc?(Sc("calling ack %s with %j",gb.id,gb.data),Kc.apply(this||Ge,gb.data),delete (this||Ge).acks[gb.id]):Sc("bad ack %s",gb.id)};ua.prototype.onconnect=function(){(this||Ge).connected=!0;(this||Ge).disconnected=!1;this.emit("connect");this.emitBuffered()};ua.prototype.emitBuffered=function(){var gb;for(gb=0;gb<(this||Ge).receiveBuffer.length;gb++)tc.apply(this||Ge,(this||Ge).receiveBuffer[gb]);(this||Ge).receiveBuffer=[];for(gb=0;gb<(this||Ge).sendBuffer.length;gb++)this.packet((this||
Ge).sendBuffer[gb]);(this||Ge).sendBuffer=[]};ua.prototype.ondisconnect=function(){Sc("server disconnect (%s)",(this||Ge).nsp);this.destroy();this.onclose("io server disconnect")};ua.prototype.destroy=function(){if((this||Ge).subs){for(var gb=0;gb<(this||Ge).subs.length;gb++)(this||Ge).subs[gb].destroy();(this||Ge).subs=null}(this||Ge).io.destroy(this||Ge)};ua.prototype.close=ua.prototype.disconnect=function(){(this||Ge).connected&&(Sc("performing disconnect (%s)",(this||Ge).nsp),this.packet({type:ab.DISCONNECT}));
this.destroy();if((this||Ge).connected)this.onclose("io client disconnect");return this||Ge};ua.prototype.compress=function(gb){(this||Ge).flags.compress=gb;return this||Ge};ua.prototype.binary=function(gb){(this||Ge).flags.binary=gb;return this||Ge};return zk}function qa(){function ua(ab){ab=ab||{};(this||ij).ms=ab.min||100;(this||ij).max=ab.max||1E4;(this||ij).factor=ab.factor||2;(this||ij).jitter=0<ab.jitter&&1>=ab.jitter?ab.jitter:0;(this||ij).attempts=0}if(im)return Ik;im=!0;Ik=ua;ua.prototype.duration=
function(){var ab=(this||ij).ms*Math.pow((this||ij).factor,(this||ij).attempts++);if((this||ij).jitter){var pb=Math.random(),Ya=Math.floor(pb*(this||ij).jitter*ab);ab=0==(Math.floor(10*pb)&1)?ab-Ya:ab+Ya}return Math.min(ab,(this||ij).max)|0};ua.prototype.reset=function(){(this||ij).attempts=0};ua.prototype.setMin=function(ab){(this||ij).ms=ab};ua.prototype.setMax=function(ab){(this||ij).max=ab};ua.prototype.setJitter=function(ab){(this||ij).jitter=ab};return Ik}function Ga(){function ua(gb,Kc){if(!((this||
Kd)instanceof ua))return new ua(gb,Kc);gb&&"object"===typeof gb&&(Kc=gb,gb=void 0);Kc=Kc||{};Kc.path=Kc.path||"/socket.io";(this||Kd).nsps={};(this||Kd).subs=[];(this||Kd).opts=Kc;this.reconnection(!1!==Kc.reconnection);this.reconnectionAttempts(Kc.reconnectionAttempts||Infinity);this.reconnectionDelay(Kc.reconnectionDelay||1E3);this.reconnectionDelayMax(Kc.reconnectionDelayMax||5E3);this.randomizationFactor(Kc.randomizationFactor||.5);(this||Kd).backoff=new Pb({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==Kc.timeout?2E4:Kc.timeout);(this||Kd).readyState="closed";(this||Kd).uri=gb;(this||Kd).connecting=[];(this||Kd).lastPing=null;(this||Kd).encoding=!1;(this||Kd).packetBuffer=[];gb=Kc.parser||ob;(this||Kd).encoder=new gb.Encoder;(this||Kd).decoder=new gb.Decoder;(this||Kd).autoConnect=!1!==Kc.autoConnect;(this||Kd).autoConnect&&this.open()}if(ck)return Li;ck=!0;ji||(ji=!0,dg=fc(),dg.parser=xb());var ab=dg;var pb=T(),Ya=Xc(),ob=dc(),kc=Tb(),Sc=I(),
Oc=Od()("socket.io-client:manager"),Xb=wc(),Pb=qa(),tc=Object.prototype.hasOwnProperty;Li=ua;ua.prototype.emitAll=function(){(this||Kd).emit.apply(this||Kd,arguments);for(var gb in(this||Kd).nsps)tc.call((this||Kd).nsps,gb)&&(this||Kd).nsps[gb].emit.apply((this||Kd).nsps[gb],arguments)};ua.prototype.updateSocketIds=function(){for(var gb in(this||Kd).nsps)tc.call((this||Kd).nsps,gb)&&((this||Kd).nsps[gb].id=this.generateId(gb))};ua.prototype.generateId=function(gb){return("/"===gb?"":gb+"#")+(this||
Kd).engine.id};Ya(ua.prototype);ua.prototype.reconnection=function(gb){if(!arguments.length)return(this||Kd)._reconnection;(this||Kd)._reconnection=!!gb;return this||Kd};ua.prototype.reconnectionAttempts=function(gb){if(!arguments.length)return(this||Kd)._reconnectionAttempts;(this||Kd)._reconnectionAttempts=gb;return this||Kd};ua.prototype.reconnectionDelay=function(gb){if(!arguments.length)return(this||Kd)._reconnectionDelay;(this||Kd)._reconnectionDelay=gb;(this||Kd).backoff&&(this||Kd).backoff.setMin(gb);
return this||Kd};ua.prototype.randomizationFactor=function(gb){if(!arguments.length)return(this||Kd)._randomizationFactor;(this||Kd)._randomizationFactor=gb;(this||Kd).backoff&&(this||Kd).backoff.setJitter(gb);return this||Kd};ua.prototype.reconnectionDelayMax=function(gb){if(!arguments.length)return(this||Kd)._reconnectionDelayMax;(this||Kd)._reconnectionDelayMax=gb;(this||Kd).backoff&&(this||Kd).backoff.setMax(gb);return this||Kd};ua.prototype.timeout=function(gb){if(!arguments.length)return(this||
Kd)._timeout;(this||Kd)._timeout=gb;return this||Kd};ua.prototype.maybeReconnectOnOpen=function(){!(this||Kd).reconnecting&&(this||Kd)._reconnection&&0===(this||Kd).backoff.attempts&&this.reconnect()};ua.prototype.open=ua.prototype.connect=function(gb,Kc){Oc("readyState %s",(this||Kd).readyState);if(~(this||Kd).readyState.indexOf("open"))return this||Kd;Oc("opening %s",(this||Kd).uri);(this||Kd).engine=ab((this||Kd).uri,(this||Kd).opts);var Hd=(this||Kd).engine,ge=this||Kd;(this||Kd).readyState="opening";
(this||Kd).skipReconnect=!1;var sd=kc(Hd,"open",function(){ge.onopen();gb&&gb()});Kc=kc(Hd,"error",function(Se){Oc("connect_error");ge.cleanup();ge.readyState="closed";ge.emitAll("connect_error",Se);if(gb){var Te=Error("Connection error");Te.data=Se;gb(Te)}else ge.maybeReconnectOnOpen()});if(!1!==(this||Kd)._timeout){var he=(this||Kd)._timeout;Oc("connect attempt will timeout after %d",he);0===he&&sd.destroy();var ve=setTimeout(function(){Oc("connect attempt timed out after %d",he);sd.destroy();Hd.close();
Hd.emit("error","timeout");ge.emitAll("connect_timeout",he)},he);(this||Kd).subs.push({destroy:function(){clearTimeout(ve)}})}(this||Kd).subs.push(sd);(this||Kd).subs.push(Kc);return this||Kd};ua.prototype.onopen=function(){Oc("open");this.cleanup();(this||Kd).readyState="open";this.emit("open");var gb=(this||Kd).engine;(this||Kd).subs.push(kc(gb,"data",Sc(this||Kd,"ondata")));(this||Kd).subs.push(kc(gb,"ping",Sc(this||Kd,"onping")));(this||Kd).subs.push(kc(gb,"pong",Sc(this||Kd,"onpong")));(this||
Kd).subs.push(kc(gb,"error",Sc(this||Kd,"onerror")));(this||Kd).subs.push(kc(gb,"close",Sc(this||Kd,"onclose")));(this||Kd).subs.push(kc((this||Kd).decoder,"decoded",Sc(this||Kd,"ondecoded")))};ua.prototype.onping=function(){(this||Kd).lastPing=new Date;this.emitAll("ping")};ua.prototype.onpong=function(){this.emitAll("pong",new Date-(this||Kd).lastPing)};ua.prototype.ondata=function(gb){(this||Kd).decoder.add(gb)};ua.prototype.ondecoded=function(gb){this.emit("packet",gb)};ua.prototype.onerror=function(gb){Oc("error",
gb);this.emitAll("error",gb)};ua.prototype.socket=function(gb,Kc){function Hd(){~Xb(sd.connecting,ge)||sd.connecting.push(ge)}var ge=(this||Kd).nsps[gb];if(!ge){ge=new pb(this||Kd,gb,Kc);(this||Kd).nsps[gb]=ge;var sd=this||Kd;ge.on("connecting",Hd);ge.on("connect",function(){ge.id=sd.generateId(gb)});(this||Kd).autoConnect&&Hd()}return ge};ua.prototype.destroy=function(gb){gb=Xb((this||Kd).connecting,gb);~gb&&(this||Kd).connecting.splice(gb,1);(this||Kd).connecting.length||this.close()};ua.prototype.packet=
function(gb){Oc("writing packet %j",gb);var Kc=this||Kd;gb.query&&0===gb.type&&(gb.nsp+="?"+gb.query);Kc.encoding?Kc.packetBuffer.push(gb):(Kc.encoding=!0,(this||Kd).encoder.encode(gb,function(Hd){for(var ge=0;ge<Hd.length;ge++)Kc.engine.write(Hd[ge],gb.options);Kc.encoding=!1;Kc.processPacketQueue()}))};ua.prototype.processPacketQueue=function(){if(0<(this||Kd).packetBuffer.length&&!(this||Kd).encoding){var gb=(this||Kd).packetBuffer.shift();this.packet(gb)}};ua.prototype.cleanup=function(){Oc("cleanup");
for(var gb=(this||Kd).subs.length,Kc=0;Kc<gb;Kc++)(this||Kd).subs.shift().destroy();(this||Kd).packetBuffer=[];(this||Kd).encoding=!1;(this||Kd).lastPing=null;(this||Kd).decoder.destroy()};ua.prototype.close=ua.prototype.disconnect=function(){Oc("disconnect");(this||Kd).skipReconnect=!0;(this||Kd).reconnecting=!1;"opening"===(this||Kd).readyState&&this.cleanup();(this||Kd).backoff.reset();(this||Kd).readyState="closed";(this||Kd).engine&&(this||Kd).engine.close()};ua.prototype.onclose=function(gb){Oc("onclose");
this.cleanup();(this||Kd).backoff.reset();(this||Kd).readyState="closed";this.emit("close",gb);(this||Kd)._reconnection&&!(this||Kd).skipReconnect&&this.reconnect()};ua.prototype.reconnect=function(){if((this||Kd).reconnecting||(this||Kd).skipReconnect)return this||Kd;var gb=this||Kd;if((this||Kd).backoff.attempts>=(this||Kd)._reconnectionAttempts)Oc("reconnect failed"),(this||Kd).backoff.reset(),this.emitAll("reconnect_failed"),(this||Kd).reconnecting=!1;else{var Kc=(this||Kd).backoff.duration();
Oc("will wait %dms before reconnect attempt",Kc);(this||Kd).reconnecting=!0;var Hd=setTimeout(function(){gb.skipReconnect||(Oc("attempting reconnect"),gb.emitAll("reconnect_attempt",gb.backoff.attempts),gb.emitAll("reconnecting",gb.backoff.attempts),gb.skipReconnect||gb.open(function(ge){ge?(Oc("reconnect attempt error"),gb.reconnecting=!1,gb.reconnect(),gb.emitAll("reconnect_error",ge.data)):(Oc("reconnect success"),gb.onreconnect())}))},Kc);(this||Kd).subs.push({destroy:function(){clearTimeout(Hd)}})}};
ua.prototype.onreconnect=function(){var gb=(this||Kd).backoff.attempts;(this||Kd).reconnecting=!1;(this||Kd).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",gb)};return Li}var Mb=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");Mb.nyi=function(ua){throw Error("Not yet implemented: "+ua);};Mb.string=db;Mb.promise=Eb;Mb.debugMessageOrder=!1;var nb=function(ua){this.id=Mb.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};nb.prototype.isOnline=function(){Mb.nyi("isOnline")};nb.prototype.open=function(){Mb.nyi("isOnline")};nb.prototype.close=function(){Mb.nyi("close")};nb.prototype.remove=function(){Mb.nyi("remove")};nb.prototype.whenOnline=function(ua){var ab=this;return Mb.promise.waitFor(ua,function(){return ab.isOnline()}).then(function(){return ab}).catch(function(pb){return Promise.reject(/timeout/i.test(String(pb))?
Error("Timeout in "+ab+".whenOnline"):pb)})};nb.prototype.onError=function(ua){this.debug&&console.log("["+this+"] error: "+ua)};nb.prototype.removeService=function(ua){delete this.actions[ua]};nb.prototype.removeServices=function(ua){var ab=this;ua.forEach(function(pb){return ab.removeService(pb)})};nb.prototype.addService=function(ua,ab){this.actions[ua]=ab};nb.prototype.addServices=function(ua){var ab=this;Object.keys(ua).forEach(function(pb){return ab.addService(pb,ua[pb])})};nb.prototype.ping=
function(ua){var ab=this,pb,Ya,ob,kc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oc){if(1==Oc.nextAddress)return pb=Date.now(),Oc.yield(ab.sendToAndWait(ua,"l2l-ping",{timestamp:pb}),2);Ya=Oc.yieldResult;ob=Ya.data;kc=ob.timestamp;Sc=Date.now();return Oc.return({to:kc-pb,from:Sc-kc,roundtrip:Sc-pb})})};nb.prototype.send=function(ua,ab){Mb.nyi("send")};nb.prototype.sendAndWait=function(ua){var ab=this,pb,Ya,ob,kc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){switch(Sc.nextAddress){case 1:return pb=
new Promise(function(Oc,Xb){return ab.send(ua,Oc)}),Ya={},ob=ab.options.ackTimeout+400,"ackTimeout"in ua&&(ob=!ua.ackTimeout||0>ua.ackTimeout?null:ua.ackTimeout+400),ob?Sc.yield(Promise.race([Mb.promise.delay(ob,Ya),pb]),5):Sc.yield(pb,4);case 4:kc=Sc.yieldResult;Sc.jumpTo(3);break;case 5:kc=Sc.yieldResult;case 3:if(kc===Ya)throw Error("Timeout sending "+ua.action);return Sc.return(kc)}})};nb.prototype.sendTo=function(ua,ab,pb,Ya){return this.send({target:ua,action:ab,data:pb},Ya)};nb.prototype.sendToAndWait=
function(ua,ab,pb,Ya){return this.sendAndWait(Object.assign({target:ua,action:ab,data:pb},Ya))};nb.prototype.prepareSend=function(ua,ab){var pb=ua.target,Ya=ua.action,ob=ua.messageId,kc=ua.sender;if(!Ya)throw Error("Trying to send a message without specifying action!");if(!pb)throw Error("Trying to send message "+Ya+" without specifying target!");ob||(ua.messageId=Mb.string.newUUID());kc||(ua.sender=this.id);Ya=ua.n=this._outgoingOrderNumberingByTargets.get(pb)||0;this._outgoingOrderNumberingByTargets.set(pb,
Ya+1);if("function"===typeof ab){kc=this;var Sc=ab;ab=function(Oc){var Xb=kc._incomingOrderNumberingBySenders.get(Oc.sender)||0;kc.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+kc+" received ack for "+Oc.action+" as msg "+Xb);try{Sc.apply(null,arguments)}catch(Pb){console.error("Error in ack fn of "+kc+": "+Pb.stack)}kc._incomingOrderNumberingBySenders.set(Oc.sender,Xb+1);setTimeout(function(){return kc.invokeOutOfOrderMessages(Oc.sender)},0)}}this.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+Ya+" ("+ua.action+") to "+pb);return[ua,ab]};nb.prototype.prepareAnswerMessage=function(ua,ab){return{action:ua.action+"-response",inResponseTo:ua.messageId,target:ua.sender,data:ab,sender:this.id}};nb.prototype.installEventToMessageTranslator=function(ua){var ab=this,pb=ua.onevent;ua.onevent=function(Ya){var ob=Ya.data||[];pb.call(this,Ya);Ya.data=["*"].concat(ob);pb.call(this,Ya)};ua.on("*",function(Ya,ob){Ya&&"object"===typeof Ya&&Ya.action&&(ob=Ya,Ya=ob.action);var kc=arguments[arguments.length-
1];kc="function"===typeof kc?kc:null;(ob=ob===kc?null:ob)&&ob.data&&("number"===typeof ob.n||ob.broadcast)&&ob.sender?ab.receive(ob,ua,kc):(console.warn(ab+" received non-conformant message "+Ya+":",arguments),"function"===typeof kc&&kc({data:{error:"invalid l2l message"}}))})};nb.prototype.receive=function(ua,ab,pb){this.dispatchL2LMessageToSelf(ua,ab,pb)};nb.prototype.dispatchL2LMessageToSelf=function(ua,ab,pb){var Ya=this,ob=ua.action;if(ua.broadcast)this.safeInvokeServiceHandler(ob,ua,pb,ab);
else try{var kc=this._incomingOrderNumberingBySenders.get(ua.sender)||0,Sc="register"===ob||"unregister";if(!Sc&&ua.n<kc)console.error("[MSG ORDER] ["+this+"] received message no. "+ua.n+" but expected >= "+kc+", dropping "+ob);else if(!Sc&&ua.n>kc){this.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+ob+" ("+ua.n+") for later invocation");var Oc=this._outOfOrderCacheBySenders.get(ua.sender);Oc||(Oc=[],this._outOfOrderCacheBySenders.set(ua.sender,Oc));
Oc.push([ob,ua,pb,ab])}else this.safeInvokeServiceHandler(ob,ua,pb,ab),setTimeout(function(){return Ya.invokeOutOfOrderMessages(ua.sender)},0)}catch(Xb){console.error("Error message ordering when handling "+ob+": "+(Xb.stack||Xb)),"function"===typeof pb&&pb(this.prepareAnswerMessage(ua,{isError:!0,error:String(Xb.stack||Xb)}))}};nb.prototype.invokeOutOfOrderMessages=function(ua){var ab=this._outOfOrderCacheBySenders.get(ua);if(ab&&ab.length){var pb=this._incomingOrderNumberingBySenders.get(ua)||0;
ua=ab.findIndex(function(Ya){Ya=$jscomp.makeIterator(Ya);Ya.next();return Ya.next().value.n===pb});-1!==ua&&(ab.splice(ua,1),this.invokeServiceHandler.apply(this,ab[ua]))}};nb.prototype.renameTarget=function(ua,ab){if(ua!==ab){var pb=this._outgoingOrderNumberingByTargets.get(ua);this._outgoingOrderNumberingByTargets.delete(ua);this._outgoingOrderNumberingByTargets.set(ab,pb)}};nb.prototype.safeInvokeServiceHandler=function(ua,ab,pb,Ya){try{"function"===typeof this.actions[ua]?this.invokeServiceHandler(ua,
ab,pb,Ya):Ya._events&&Object.keys(Ya._events).includes(ua)||(console.warn("WARNING ["+this+"] Unhandled message: "+ua),"function"===typeof pb&&pb(this.prepareAnswerMessage(ab,{isError:!0,error:"message not understood: "+ua})))}catch(ob){console.error("Error when handling "+ua+": "+(ob.stack||ob)),"function"===typeof pb&&pb(this.prepareAnswerMessage(ab,{isError:!0,error:String(ob.stack||ob)}))}};nb.prototype.invokeServiceHandler=function(ua,ab,pb,Ya){var ob=this;this.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+ab.n+" ("+ab.action+") from "+ab.sender);this._incomingOrderNumberingBySenders.set(ab.sender,ab.n+1);if("function"===typeof pb){var kc=!1,Sc=!1,Oc="ackTimeout"in ab?ab.ackTimeout:this.options.ackTimeout,Xb=this._outgoingOrderNumberingByTargets.get(ab.sender)||0;this._outgoingOrderNumberingByTargets.set(ab.sender,Xb+1);var Pb=function(tc){Sc?console.warn("["+ob+"] ackFn for "+ab.action+" called after it timed out, dropping answer!"):kc?console.warn("["+ob+"] ack function called repeatedly when handling "+
ab.action):(kc=!0,pb(ob.prepareAnswerMessage(ab,tc)),ob.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+ob+" sending "+Xb+" (ack for "+ab.action+")"))};Oc&&setTimeout(function(){kc||(Pb({isError:!0,error:"Timeout error: "+ob+" did not send answer for "+ab.action+" after "+Oc+"ms"}),Sc=!0)},Oc)}try{this.actions[ua].call(this,this,ab,Pb,Ya)}catch(tc){console.error("["+this+"] Error handling "+ua+": "+(tc.stack||tc)),Pb&&Pb({error:tc.stack})}};$jscomp.global.Object.defineProperties(nb.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(ua){this.options.debug=ua}}});Mb.L2LConnection=nb;Mb.default=nb;var Ha=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),kb={"l2l-ping":function(ua,ab,pb,Ya){Ya=ab.sender;ab=ab.data.timestamp;var ob=Date.now();"function"===typeof pb&&pb({timestamp:ob});ua.debug&&console.log("[undefined] got ping from "+Ya+", time: "+(ob-ab)+"ms")},"remote-eval":function(ua,ab,pb,Ya){var ob=ab.data.source;
Promise.resolve().then(function(){return eval(ob)}).then(function(kc){return pb({value:kc})}).catch(function(kc){kc.originalErr&&(kc=kc.originalErr);console.error("eval error: "+kc);"function"===typeof pb&&pb({isError:!0,value:String(kc.stack||kc)})})},"remote-eval-2":function(ua,ab,pb,Ya){var ob=ab.data.source;Promise.resolve().then(function(){var kc=eval(ob);if(!(kc instanceof Promise))throw console.error("unexpected eval result:"+kc),Error("unexpected eval result:"+kc);return kc}).then(function(kc){return pb(kc)}).catch(function(kc){console.error("eval error: "+
kc);kc.originalErr&&(kc=kc.originalErr);"function"===typeof pb&&pb({isError:!0,value:String(kc.stack||kc)})})}};Ha.defaultActions=kb;Ha.defaultActions=kb;Ha.defaultActions=kb;var Qc={},qc=(Qc["[broadcast] send"]=function(ua,ab,pb,Ya){var ob=ab.sender,kc=ab.data,Sc,Oc,Xb,Pb,tc,gb,Kc,Hd,ge,sd,he,ve;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Se){Sc=kc;Oc=Sc.action;Xb=Sc.broadcast;Pb=Sc.room;tc=Sc.namespace;gb=Sc.isSystemBroadcast;Kc=Sc.isMultiServerBroadcast;Hd=[];Kc?(console.log(".......isMultiServerBroadcast"),
ge=ua,sd=ge.id,he=ua.getTrackerList(),console.log(he),Hd=he.map(function(Te){return Te.id!=sd?Te.io.nsps["/"+Te.namespace]:Ya.broadcast})):(gb&&(tc=ua.namespace),Hd.push(tc?ua.io.nsps["/"+tc]:Ya.broadcast));Hd.forEach(function(Te){return Te.to(Pb).emit({action:Oc,sender:ob,broadcast:!0,data:Xb})});pb&&"function"===typeof pb&&(ve="message broadcasted to "+Pb,tc&&(ve+=" in namespace "+tc),1<Hd.length&&(ve+=" "+Hd.length+" trackers"),console.log(ve),pb({status:ve}));Se.jumpToEnd()})},Qc["[broadcast] join room"]=
function(ua,ab,pb,Ya){var ob=ab.sender,kc=ab.data.room,Sc,Oc,Xb,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return Oc=!1,Xb=ua.io.nsps["/"+ua.namespace].adapter.rooms,(Pb=Xb[kc]&&Xb[kc].sockets&&Xb[kc].sockets[Ya.id])?(Sc=ob+" already in "+kc,tc.jumpTo(2)):tc.yield(new Promise(function(gb,Kc){return Ya.join(kc,function(Hd){return Hd?Kc(Hd):gb()})}),3);2!=tc.nextAddress&&(Sc=ob+" joined "+kc,Oc=!0);pb&&"function"===typeof pb&&pb({status:Sc,joined:Oc});tc.jumpToEnd()})},
Qc["[broadcast] leave room"]=function(ua,ab,pb,Ya){var ob=ab.sender,kc=ab.data.room,Sc,Oc,Xb,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return Oc=!1,Xb=ua.io.nsps["/"+ua.namespace].adapter.rooms,Pb=Xb[kc]&&Xb[kc].sockets&&Xb[kc].sockets[Ya.id],Pb?tc.yield(new Promise(function(gb,Kc){return Ya.leave(kc,function(Hd){return Hd?Kc(Hd):gb()})}),3):(Sc=ob+" not in "+kc,tc.jumpTo(2));2!=tc.nextAddress&&(Sc=ob+" left room "+kc,Oc=!0);console.log(Sc);pb&&"function"===
typeof pb&&pb({left:Oc,status:Sc});tc.jumpToEnd()})},Qc["[broadcast] my rooms"]=function(ua,ab,pb,Ya){pb(Ya.rooms)},Qc["[broadcast] all rooms"]=function(ua,ab,pb,Ya){pb(ua.io.nsps["/"+ua.namespace].adapter.rooms)},Qc["[broadcast] list room members"]=function(ua,ab,pb,Ya){ab=ab.data.room;Ya=ua.io;ab?(ua=Ya.nsps["/"+ua.namespace].adapter.rooms[ab],pb({room:ab,sockets:ua?ua.sockets:{},length:ua?ua.length:0})):pb({isError:!0,error:"`room` paramerter missing!"})},Qc.getClients=function(ua,ab,pb){ua.removeDisconnectedClients();
pb(Array.from(ua.clients))},Qc);Ha.defaultTrackerActions=qc;Ha.defaultTrackerActions=qc;Ha.defaultTrackerActions=qc;var Cb={},za=(Cb.getRoomList=function(ua){var ab=ua.client,pb=ua.ackFn,Ya;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ob){Ya=ab._socketioClient.rooms;pb(Ya);ob.jumpToEnd()})},Cb["ask for"]=function(ua,ab,pb,Ya){var ob=ab.sender,kc=ab.data.query,Sc=this,Oc,Xb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){if(1==Pb.nextAddress)return Oc=kc.match(/password|sudo/i)?
"passwordPrompt":"prompt",Pb.yield($world[Oc](kc),2);Xb=Pb.yieldResult;"function"===typeof pb&&pb({answer:Xb});ua.debug&&console.log("["+Sc+"] message 'ask for' from "+ob+", query: "+kc);Pb.jumpToEnd()})},Cb["open editor"]=function(ua,ab,pb,Ya){var ob=ab.data.args,kc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress)return ob.length?Sc.yield($world.execCommand("open file for EDITOR",{url:ob[0]}),2):(pb({error:"no file specified"}),Sc.return());kc=Sc.yieldResult;
"function"===typeof pb&&pb("aborted"===kc?{error:String(kc)}:{status:kc});Sc.jumpToEnd()})},Cb.changeWorkingDirectory=function(ua,ab,pb,Ya){var ob=ab.data.args,kc,Sc,Oc,Xb,Pb,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){kc=$jscomp.makeIterator(ob||[]);Sc=kc.next().value;Oc=kc.next().value;Xb="OK";try{if(Sc)if(Oc){if(Pb=$world.getMorphWithId(Oc))if(Pb.__lookupSetter__("cwd"))Pb.cwd=Sc;else if("function"===typeof Pb.changeWorkingDirectory)Pb.changeWorkingDirectory(Sc);else if("function"===
typeof Pb.pluginFind){if(tc=Pb.pluginFind(function(Kc){return Kc.isShellEditorPlugin}))tc.cwd=Sc}else Xb="[changeWorkingDirectory] cannot figure pout how to set dir"}else Xb="[changeWorkingDirectory] No command morph";else Xb="[changeWorkingDirectory] No directory received"}catch(Kc){Xb=String(Kc)}"OK"!==Xb&&console.warn(Xb);"function"===typeof pb&&pb(Xb);gb.jumpToEnd()})},Cb);Ha.defaultClientActions=za;Ha.defaultClientActions=za;Ha.defaultClientActions=za;var Ca={},ma=!1,la={},va=!1,cb={},fb=!1,
ec="undefined"!==typeof self?self:global,Nc={},pd=!1,Yd="undefined"!==typeof self?self:global,uc={},Qd=!1,cd={},zb=!1,da="undefined"!==typeof self?self:global,ra={},sb=!1,H={},fa=!1,Fa={},qb=!1,nc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,xc={},Bd=!1,Cd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ue={},jd=!1,Gd={},re=!1,He={},yf=!1,tf={},yc=!1,Ie={},mf=!1,Jf={},Be=!1,xa={},Na=!1,ub={},Q=!1,wa={},Xa=!1,ib={},rc=!1,cc={},ad=
!1,Vc={},Yc=!1,$d="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Mf={},Bf=!1,Hg={},cf=!1,Bg={},Di=!1,Pg={},Nj=!1,Pe="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ki={},Kh=!1,ce="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,gj={},Mj=!1,lg="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,yk={},Tj=!1,Bj={},Bh=!1,zf="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,Ze={},ll=!1,Sa={},Zc=!1,Zd={},Vd=!1,Lc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,dg={},ji=!1,Rk={},Cm=!1,Um={},hj=!1,Jl={},Pk=!1,zk={},Kl=!1,Ge="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ik={},im=!1,ij="undefined"!==typeof self?self:global,Li={},ck=!1,Kd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Aj={},jj=!1,Qk=function(){function ua(Sc,Oc){"object"===typeof Sc&&
(Oc=Sc,Sc=void 0);Oc=Oc||{};Sc=ab(Sc);var Xb=Sc.source,Pb=Sc.id,tc=Sc.path;tc=kc[Pb]&&tc in kc[Pb].nsps;Oc.forceNew||Oc["force new connection"]||!1===Oc.multiplex||tc?(ob("ignoring socket cache for %s",Xb),Xb=Ya(Xb,Oc)):(kc[Pb]||(ob("new io instance for %s",Xb),kc[Pb]=Ya(Xb,Oc)),Xb=kc[Pb]);Sc.query&&!Oc.query&&(Oc.query=Sc.query);return Xb.socket(Sc.path,Oc)}if(jj)return Aj;jj=!0;var ab=qd(),pb=dc(),Ya=Ga(),ob=Od()("socket.io-client");Aj=Aj=ua;var kc=Aj.managers={};Aj.protocol=pb.protocol;Aj.connect=
ua;Aj.Manager=Ga();Aj.Socket=T();return Aj}(),Lf=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Lf.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Lf.isNode?System._nodeRequire("os").hostname():System.baseURL};Lf.promise=Eb;Lf.fun=wd;Lf.obj=Ic;Lf.events=Ad;Lf.num=Jc;Lf.L2LConnection=nb;Lf.defaultActions=kb;Lf.defaultClientActions=za;Lf.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Lf._ioClient=Qk;Lf.ioClient=Lf.ioClient||void 0;Lf.isNode?(Lf.require=System._nodeRequire("module")._load,Lf.ioClient=Lf.require("socket.io-client")):Lf.ioClient=Lf._ioClient;Lf.urlHelper={isRoot:function(ua){return"/"===Lf.urlHelper.path(ua)},root:function(ua){return Lf.urlHelper.isRoot(ua)?ua:ua.slice(0,-Lf.urlHelper.path(ua).length)+"/"},path:function(){var ua=/^[a-z0-9-_\.]+:/,ab=/^\/\/[^\/]+/;return function(pb){pb=pb.replace(ua,"").replace(ab,"");return""===pb?"/":pb}}(),join:function(ua,
ab){ua.endsWith("/")&&(ua=ua.slice(0,-1));ab.startsWith("/")&&(ab=ab.slice(1));return ua+"/"+ab}};var sg=function(ua,ab,pb,Ya){var ob=Lf.L2LConnection.call(this)||this;Lf.events.makeEmitter(ob);ob.info=Ya;ob.origin=ua;ob.path=ab;ob.namespace=pb.replace(/^\/?/,"/");ob.trackerId=null;ob._socketioClient=null;ob._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Lf.defaultActions).forEach(function(kc){return ob.addService(kc,
Lf.defaultActions[kc])});Object.keys(Lf.defaultClientActions).forEach(function(kc){return ob.addService(kc,Lf.defaultClientActions[kc])});return ob};$jscomp.inherits(sg,Lf.L2LConnection);sg.clientKey=function(ua,ab,pb){ua=ua.replace(/\/$/,"");ab=ab.replace(/^\//,"");pb=pb.replace(/^\//,"");return ua+"-"+ab+"-"+pb};sg.forLivelyInBrowser=function(ua){var ab=!!ua;ua=Object.assign({type:"lively.morphic browser"},ua);var pb=this.default();if(!pb)return Lf.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:ua});ab&&!Lf.obj.equals(pb.info,ua)&&pb.isRegistered()&&(pb.info=ua,pb.unregister().then(function(){return pb.register()}).catch(function(Ya){return console.error("l2l re-register on info change errored: "+Ya)}));return pb};sg.default=function(){var ua=Lf.L2LClient.clients.keys().next().value;return Lf.L2LClient.clients.get(ua)};sg.create=function(ua){var ab=ua=void 0===ua?{}:ua;ua=void 0===ab.debug?!1:ab.debug;var pb=ab.url,Ya=ab.namespace,ob=void 0===ab.autoOpen?
!0:ab.autoOpen;ab=void 0===ab.info?{}:ab.info;if(!pb)throw Error("L2LClient needs server url!");var kc=Lf.urlHelper.root(pb).replace(/\/+$/,"");pb=Lf.urlHelper.path(pb);Ya=new this(kc,pb,Ya||"",ab);ob&&Ya.register();Ya.debug=ua;return Ya};sg.ensure=function(ua){var ab=ua=void 0===ua?{}:ua,pb=ab.url;ab=ab.namespace;if(!pb)throw Error("L2LClient needs server url!");var Ya=Lf.urlHelper.root(pb).replace(/\/+$/,""),ob=Lf.urlHelper.path(pb);Ya=this.clientKey(Ya,ob,ab||"");(ob=this.clients.get(Ya))||this.clients.set(Ya,
ob=this.create(Object.assign({},ua,{url:pb,namespace:ab})));return ob};sg.prototype.isOnline=function(){return this.socket&&this.socket.connected};sg.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};sg.prototype.open=function(){var ua=this,ab,pb,Ya;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ob){if(1==ob.nextAddress)return ua.isOnline()||ua._reconnectState.isOpening?ob.return(ua):ob.yield(ua.close(),2);ua._reconnectState.closed=!1;ab=Lf.urlHelper.join(ua.origin,
ua.namespace);pb={path:ua.path,transports:["websocket","polling"]};Ya=ua._socketioClient=Lf.ioClient(ab,pb);ua.debug&&console.log("["+ua+"] connecting");Ya.on("error",function(kc){ua._reconnectState.isOpening=!1;ua.debug&&console.log("["+ua+"] errored: "+kc)});Ya.on("close",function(kc){return ua.debug&&console.log("["+ua+"] closed: "+kc)});Ya.on("reconnect_failed",function(){return ua.debug&&console.log("["+ua+"] could not reconnect")});Ya.on("reconnect_error",function(kc){return ua.debug&&console.log("["+
ua+"] reconnect error "+kc)});Ya.on("connect",function(){ua.debug&&console.log("["+ua+"] connected");ua.emit("connected",ua);ua._reconnectState.isOpening=!1;ua._reconnectState.isReconnecting=!1;ua._reconnectState.isReconnectingViaSocketio=!1});Ya.on("disconnect",function(){ua._reconnectState.isOpening=!1;ua.debug&&console.log("["+ua+"] disconnected");ua.emit("disconnected",ua);ua.trackerId?("tracker"!==ua.trackerId&&(ua.renameTarget(ua.trackerId,"tracker"),ua.trackerId=null),ua._reconnectState.closed?
ua.debug&&console.log("["+ua+"] won't reconnect b/c client is marked as closed"):ua._reconnectState.autoReconnect?(ua._reconnectState.isReconnecting=!0,setTimeout(function(){ua._reconnectState.closed?ua.debug&&console.log("["+ua+"] won't reconnect b/c client is marked as closed 2"):ua._reconnectState.isReconnectingViaSocketio?ua.debug&&console.log("["+ua+"] won't reconnect again, client already reconnecting"):(ua.debug&&console.log("["+ua+"] initiating reconnection to tracker"),ua.register())},20)):
ua.debug&&console.log("["+ua+"] won't reconnect b/c client has reconnection disabled")):(ua.debug&&console.log("["+ua+"] disconnect: don't have a tracker id, won't try reconnect"),ua.trackerId="tracker")});Ya.on("reconnecting",function(){ua.debug&&console.log("["+ua+"] reconnecting",ua._reconnectState);ua.emit("reconnecting",ua);ua._reconnectState.closed?(ua._reconnectState.isReconnecting=!1,ua._reconnectState.isReconnectingViaSocketio=!1,Ya.close(),ua.close()):(ua._reconnectState.isReconnecting=
!0,ua._reconnectState.isReconnectingViaSocketio=!0)});Ya.on("reconnect",function(){ua.debug&&console.log("["+ua+"] reconnected");ua._reconnectState.isReconnecting=!1;ua._reconnectState.isReconnectingViaSocketio=!1;ua.register()});ua.installEventToMessageTranslator(Ya);ua._reconnectState.isOpening=!0;return ob.return((new Promise(function(kc,Sc){Ya.once("error",Sc);Ya.once("connect",kc)})).then(function(){return ua}))})};sg.prototype.close=function(){var ua=this,ab,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ya){if(1==
Ya.nextAddress){ua._reconnectState.closed=!0;if(ab=ua.socket)ab.removeAllListeners("reconnect"),ab.removeAllListeners("reconnecting"),ab.removeAllListeners("disconnect"),ab.removeAllListeners("connect"),ab.removeAllListeners("reconnect_error"),ab.removeAllListeners("reconnect_failed"),ab.removeAllListeners("close"),ab.removeAllListeners("error"),ab.close();ua.debug&&console.log("["+ua+"] closing...");return ua.isRegistered()?Ya.yield(ua.unregister(),2):Ya.jumpTo(2)}return ua.isOnline()||ua.socket?
ab&&!ab.connected?(ua.debug&&console.log("["+ua+"] socket not connected, considering client closed"),Ya.return(ua)):Ya.return(Promise.race([Lf.promise.delay(2E3).then(function(){return ab.removeAllListeners("disconnect")}),new Promise(function(ob){return ab.once("disconnect",ob)})]).then(function(){ua.debug&&console.log("["+ua+"] closed");return ua})):(ua.debug&&(pb=ua.isOnline()?"no socket":"not online",ua.debug&&console.log("["+ua+"] cannot close: "+pb)),Ya.return(ua))})};sg.prototype.remove=function(){var ua=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(ua);return this.close()};sg.prototype.register=function(){var ua=this,ab,pb,Ya,ob,kc,Sc,Oc,Xb,Pb,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:if(ua.isRegistered())return gb.return();if(ua._reconnectState.closed)return ua.debug&&console.log("["+ua+"] not registering this b/c closed"),ua._reconnectState.registerAttempt=0,gb.return();if(ua._reconnectState.registerProcess)return ua.debug&&
console.log("["+ua+"] not registering this b/c register process exists"),gb.return();gb.setCatchFinallyBlocks(2);if(ua.isOnline()){gb.jumpTo(4);break}return gb.yield(ua.open(),4);case 4:return ua.debug&&console.log("["+ua+"] register"),gb.yield(ua.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Lf.isNode?"node":"browser"),location:Lf.determineLocation()},ua.info)),6);case 6:ab=gb.yieldResult;if(!ab.data)throw pb=Error("Register answer is empty!"),ua.emit("error",
pb),pb;if(ab.data.isError)throw Ya=Error(ab.data.error),ua.emit("error",Ya),Ya;ua._reconnectState.registerAttempt=0;ob=ab;kc=ob.data;Sc=kc.trackerId;Oc=kc.messageNumber;ua.trackerId=Sc;ua._incomingOrderNumberingBySenders.set(Sc,Oc||0);ua.emit("registered",{trackerId:Sc});gb.leaveTryBlock(0);break;case 2:Xb=gb.enterCatchBlock(),console.error("Error in register request of "+ua+": "+Xb),Pb=ua._reconnectState.registerAttempt++,tc=Lf.num.backoff(Pb,4,3E5),ua._reconnectState.registerProcess=setTimeout(function(){ua._reconnectState.registerProcess=
null;ua.register()},tc),gb.jumpToEnd()}})};sg.prototype.unregister=function(){var ua=this,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pb){switch(pb.nextAddress){case 1:if(!ua.isRegistered())return pb.return();ua.debug&&console.log("["+ua+"] unregister");ab=ua.trackerId;pb.setCatchFinallyBlocks(2);return pb.yield(ua.sendToAndWait(ua.trackerId,"unregister",{}),4);case 4:pb.leaveTryBlock(3);break;case 2:pb.enterCatchBlock();case 3:ua.renameTarget(ab,"tracker"),ua.trackerId=null,ua.emit("unregistered",
ua),pb.jumpToEnd()}})};sg.prototype.whenRegistered=function(ua){var ab=this;return Lf.promise.waitFor(ua,function(){return ab.isRegistered()}).catch(function(pb){return Promise.reject(/timeout/i.test(String(pb))?Error("Timeout in "+ab+".whenRegistered"):pb)})};sg.prototype.send=function(ua,ab){var pb=this,Ya=$jscomp.makeIterator(this.prepareSend(ua,ab));ua=Ya.next().value;ab=Ya.next().value;this.whenOnline().then(function(){var ob=pb.socket,kc=ua,Sc=kc.action;kc=kc.target;if(!ob)throw Error("Trying to send message "+
Sc+" to "+kc+" but cannot find a connection to it!");"function"===typeof ab?ob.emit(Sc,ua,ab):ob.emit(Sc,ua)})};sg.prototype.joinRoom=function(ua){var ab=this;return this.whenOnline().then(function(){return ab.sendToAndWait(ab.trackerId,"[broadcast] join room",{room:ua})})};sg.prototype.leaveRoom=function(ua){var ab=this;return this.whenOnline().then(function(){return ab.sendToAndWait(ab.trackerId,"[broadcast] leave room",{room:ua})})};sg.prototype.broadcast=function(ua,ab,pb,Ya,ob){var kc=this,Sc=
{action:ab,room:ua,broadcast:pb};if(void 0===Ya?0:Ya)Sc.isSystemBroadcast=!0;if(void 0===ob?0:ob)Sc.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return kc.sendToAndWait(kc.trackerId,"[broadcast] send",Sc)})};sg.prototype.listRoomMembers=function(ua){var ab=this,pb,Ya;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ob){if(1==ob.nextAddress)return ob.yield(ab.sendToAndWait(ab.trackerId,"[broadcast] list room members",{room:ua}),2);pb=ob.yieldResult;Ya=pb.data;return ob.return(Ya)})};
sg.prototype.joinedRooms=function(){var ua=this,ab,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ya){if(1==Ya.nextAddress)return Ya.yield(ua.sendToAndWait(ua.trackerId,"[broadcast] my rooms",{}),2);ab=Ya.yieldResult;pb=ab.data;return Ya.return(pb)})};sg.prototype.listRooms=function(){var ua=this,ab,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ya){if(1==Ya.nextAddress)return Ya.yield(ua.sendToAndWait(ua.trackerId,"[broadcast] all rooms",{}),2);ab=Ya.yieldResult;pb=
ab.data;return Ya.return(pb)})};sg.prototype.listPeers=function(ua){ua=void 0===ua?!1:ua;var ab=this,pb,Ya,ob,kc,Sc,Oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xb){if(1==Xb.nextAddress)return pb=ab,Ya=pb._peersCached,ob=Date.now(),!ua&&Ya&&1E3>ob-Ya.timestamp?Xb.return(ab._peersCached.sessions):ab.isOnline()?Xb.yield(ab.sendToAndWait(ab.trackerId,"getClients",{}),2):Xb.return([]);kc=Xb.yieldResult;Sc=kc.data;Oc=Sc.map(function(Pb){var tc=$jscomp.makeIterator(Pb);Pb=tc.next().value;
var gb=tc.next().value,Kc=gb.info||{};tc=Kc.userRealm;var Hd=Kc.userToken,ge=Kc.l2lUserToken,sd=Kc.location,he=Kc.type;Kc=Kc.world;Pb=Object.assign({},Lf.obj.dissoc(gb,["info"]),{id:Pb,world:Kc,location:sd,type:he});(Hd=Hd||ge)&&"null"!==Hd&&(lively.user?Pb.user=lively.user.ClientUser.fromToken(Hd,tc):(Pb.userToken=Hd,Pb.userRealm=tc));return Pb});ab._peersCached={timestamp:ob,sessions:Oc};return Xb.return(Oc)})};sg.prototype.toString=function(){var ua=this.origin,ab=this.path,pb=this.namespace,Ya=
this.id,ob=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(Ya||"").slice(0,5)+" "+ua+ab+" - "+pb+" "+ob+")"};$jscomp.global.Object.defineProperties(sg.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(sg,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});sa("default",sg);Lf.L2LClient=sg;Lf.default=sg}}});