System.register(["./__root_module__-7d3cbdeb.js","./index-2d023b08.js","./index-f2f18556.js","./color-picker-8d65425e.js"],function(Ka){var wb,Ab,gc,Kb,Zc,Kc,md,Fc,Bc,Nc,Uc,ce,Zd,pe,Mc,Kd,Jb,Dc,nd,Hc,wd,Qd,Eb,ic,jd,jc,kd,vb,db,ec,Mb,Hb,pc,Ma,Ib,pb,Ub,dc,vc,gd,Nb,Fb,sb,Ea,ua,V,ra,ja,Ca,va,cb,hc,gb,Oc,Cb,Gd,Ec,oc,rb,Md,yb,qb,Ia,Q,za,Ta,xb,Yb,Ac,mc,qd,zd,Ee,se,ke,w,we,ue,Od,He,Te,Ue,ff,gf;return{setters:[function(Wb){wb=Wb.S;Ab=Wb.R;gc=Wb.$;Kb=Wb.C;Zc=Wb.b;Kc=Wb.a0;md=Wb.a1;Fc=Wb.P;Bc=Wb.a;Nc=Wb.s;
Uc=Wb.Y;ce=Wb.a2;Zd=Wb.e;pe=Wb.m;Mc=Wb.K;Kd=Wb.g;Jb=Wb.a3;Dc=Wb.a4;nd=Wb.n;Hc=Wb.a5;wd=Wb.q;Qd=Wb.j;Eb=Wb.r;ic=Wb.a6;jd=Wb.o;jc=Wb.a7;kd=Wb.a8;vb=Wb.a9;db=Wb.M;ec=Wb.T;Mb=Wb.aa;Hb=Wb.ab;pc=Wb.W;Ma=Wb.I;Ib=Wb.ac;pb=Wb.c;Ub=Wb.d;dc=Wb.ad;vc=Wb.i;gd=Wb.f;Nb=Wb.p;Fb=Wb.ae;sb=Wb.V;Ea=Wb.O;ua=Wb.Q;V=Wb.N;ra=Wb.t;ja=Wb.af;Ca=Wb.ag;va=Wb.ah;cb=Wb.l;hc=Wb.ai;gb=Wb.aj;Oc=Wb.ak;Cb=Wb.al;Gd=Wb.am;Ec=Wb.an;oc=Wb.ao;rb=Wb.ap;Md=Wb.aq;yb=Wb.L;qb=Wb.ar;Ia=Wb.h;Q=Wb.as;za=Wb.z;Ta=Wb.Z;xb=Wb.at;Yb=Wb.au},function(Wb){Ac=
Wb.i},function(Wb){mc=Wb.s;qd=Wb.a;zd=Wb.r;Ee=Wb._;se=Wb.P;ke=Wb.H;w=Wb.M;we=Wb.S;ue=Wb.b;Od=Wb.c;He=Wb.G;Te=Wb.F},function(Wb){Ue=Wb.C;ff=Wb.a;gf=Wb.c}],execute:function(){function Wb(){}function Kh(Ha,S,ob){var fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return 1==Ba.nextAddress?S.startsWith("image/")?Ba.yield(ef.fileReadAsDataURL(Ha),3):Ba.jumpTo(2):2!=Ba.nextAddress?(fa=Ba.yieldResult,Ba.return(new ef.Image({imageUrl:fa,autoResize:!0,name:Ha.name}))):Ba.return(null)})}var ef=
lively.FreezerRuntime.recorderFor("lively.morphic/events/html-drop-handler.js");ef.uploadItem=Wb;ef.uploadFile=Kh;ef.fileReadAsDataURL=function(Ha){return new Promise(function(S,ob){ob=new ef.FileReader;ob.onload=function(fa){return S(fa.target.result)};ob.readAsDataURL(Ha)})};ef.Image=wb;ef.uploadItem=Wb;ef.uploadItem=Wb;ef.uploadFile=Kh;ef.uploadFile=Kh;var Fd=lively.FreezerRuntime.recorderFor("lively.ide/world-commands.js");Fd.Rectangle=Ab;Fd.rect=gc;Fd.Color=Kb;Fd.pt=Zc;Fd.tree=Kc;Fd.date=md;
Fd.Path=Fc;Fd.arr=Bc;Fd.string=Nc;Fd.obj=Uc;Fd.inspect=ce;Fd.easings=Zd;Fd.morph=pe;Fd.Text=Mc;Fd.config=Kd;Fd.KeyHandler=Jb;Fd.loadObjectFromPartsbinFolder=Dc;Fd.loadPart=nd;Fd.interactivelySaveWorld=Hc;Fd.show=mc;Fd.showAndSnapToGuides=qd;Fd.removeSnapToGuidesOf=zd;Fd.LoadingIndicator=wd;Fd.createMorphSnapshot=Qd;Fd.interactivelyFreezeWorld=Ac;Fd.resource=Eb;Fd.BrowserModuleTranslationCache=ic;Fd.CommentBrowser=Ee;Fd.once=jd;Fd.commands=[{name:"clear storage and reload",exec:function(){var Ha,S;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(ob){if(1==ob.nextAddress)return ob.yield($world.confirm(["Caution\n",{},"Proceeding will clear all local storage and reload the page! Make sure if you want to save your world before you continue.",{fontSize:15,fontWeight:"normal"}],{width:400}),2);if(Ha=ob.yieldResult)localStorage.clear(),S=new Fd.BrowserModuleTranslationCache("2"),S.closeDb(),S.deleteDb(),window.location.reload(!0);ob.jumpToEnd()})}},{name:"undo",exec:function(Ha){if(Ha.focusedMorph&&
Ha.focusedMorph!==Ha&&Ha.focusedMorph.undoManager)return!1;Ha.env.undoManager.undo();return!0}},{name:"redo",exec:function(Ha){if(Ha.focusedMorph&&Ha.focusedMorph!==Ha&&Ha.focusedMorph.undoManager)return!1;Ha.env.undoManager.redo();return!0}},{name:"run command",handlesCount:!0,exec:function(Ha,S,ob){var fa,Ba,Na,tb,Sb,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(uc){if(1==uc.nextAddress)return fa=Ha.focusedMorph||Ha,Ba=Fd.KeyHandler.generateCommandToKeybindingMap(fa,!0).map(function(rc){var $c=
rc.prettyKeys,Jd=rc.command.name,je=rc.target.constructor.name;$c=$c?$c.join(", "):"";return{isListItem:!0,value:rc,label:[""+je,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+Jd,null],annotation:[$c,{fontSize:"80%",textStyleClasses:["truncated-text"],paddingRight:"5px",maxWidth:140}]}}),uc.yield(Ha.filterableListPrompt("Run command",Ba,{historyId:"lively.morphic-run command",requester:fa,extent:Fd.pt(700,900),prompt:Ha._cachedRunCommandPrompt}),2);Na=uc.yieldResult;tb=
Na.prompt;Sb=$jscomp.makeIterator(Na.selected);lc=Sb.next().value;Ha._cachedRunCommandPrompt=tb;return uc.return(lc?lc.target.execCommand(lc.command,S,ob):!0)})}},{name:"show command history",exec:function(Ha,S){var ob=Ha.commandHandler;S=Fd.arr.sortBy(ob.history,function(fa){return-fa.time}).map(function(fa){return{isListItem:!0,string:ob.printCommand(fa),value:fa}});$world.editListPrompt("select commands",S,{multiSelect:!0,requester:Ha});return!0}},{name:"show halo for focused morph",exec:function(Ha){var S=
Ha.focusedMorph;Ha.showHaloFor(S.getWindow()||S,Ha.firstHand.pointerId);return!0}},{name:"show morph",exec:function(Ha,S){Fd.show(S.morph,void 0===S.loop?!1:S.loop)}},{name:"show and snap to guides",exec:function(Ha,S){Fd.showAndSnapToGuides(S.target,S.showGuides,S.snap)}},{name:"remove snap to guides",exec:function(Ha,S){Fd.removeSnapToGuidesOf(S)}},{name:"copy morph",exec:function(Ha){var S=Ha.focusedMorph;if(!S||S===Ha)return $world.setStatusMessage("no morph selected"),!0;Ha=S.getWindow()||S;
S=Ha.copy();S.openInWorld(Ha.globalPosition.addXY(10,10));S.isWindow&&S.activate();return S}},{name:"select morph",exec:function(Ha,S){S=void 0===S?{root:Ha,selectionFn:null,justReturn:!1,requester:Ha,filterFn:null,prependItems:[],prompt:null,remote:!1}:S;var ob,fa,Ba,Na,tb,Sb,lc,uc,rc,$c,Jd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(je){if(1==je.nextAddress)return ob=0,fa=S.filterFn||function(){return!0},Ba=S.selectionFn||function(td,qe,Wd){return Ha.filterableListPrompt(td,qe,Wd)},
je.yield(System.import("lively.classes/object-classes.js"),2);if(3!=je.nextAddress)return Na=je.yieldResult,tb=Na.default,Sb=Fd.arr.compact(Fd.tree.map(S.root||Ha,function(td,qe){if(!fa(td))return null;var Wd=!!tb.lookupPackageForObject(td);return{isListItem:!0,label:[""+String(++ob)+"\u2003".repeat(qe),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+td,{fontWeight:Wd?"bolder":"normal",fontStyle:Wd?"normal":"italic",fontFamily:"Inconsolata",fontSize:16},Wd?" [Object Class]":
"",{opacity:.5}],value:td}},function(td){return fa(td)?td.submorphs:[]})),lc=["show halo","open object editor","open object inspector"],je.yield(Ba(S.prompt||"Choose morph",(S.prependItems||[]).concat(Sb),{historyId:"lively.morphic-select morph",onSelection:function(td){(void 0).lastSelectionHalo&&(void 0).lastSelectionHalo.remove();td&&td.show&&uc!=td&&((void 0).lastSelectionHalo=td.show(),uc=td)},selectedAction:"show halo",actions:lc}),3);rc=je.yieldResult;$c=rc.selected;Jd=rc.action;if(S.justReturn)return je.return($c);
$c.forEach(function(td){Jd===lc[0]?Ha.showHaloFor(td):Jd===lc[1]?Ha.execCommand("open object editor",{target:td}):Jd===lc[2]&&Ha.execCommand("open object inspector",{target:td})});return je.return($c)})}},{name:"print morph(s)",exec:function(Ha){var S,ob,fa,Ba,Na,tb,Sb,lc,uc,rc,$c,Jd,je,td,qe,Wd,Ud,Re;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wf){switch(wf.nextAddress){case 1:S=!1,ob=[];case 2:if(S)return Sb=Fd.LoadingIndicator.open("printing morph..."),wf.yield(System.import("lively.2lively/client.js"),
6);fa=$jscomp;Ba=fa.makeIterator;return wf.yield(Ha.execCommand("select morph",{justReturn:!0}),4);case 4:return Na=Ba.call(fa,wf.yieldResult),tb=Na.next().value,ob.push(tb),wf.yield(Ha.confirm("Select additional morphs?",{rejectLabel:"NO"}),5);case 5:S=!wf.yieldResult;wf.jumpTo(2);break;case 6:return lc=wf.yieldResult,uc=lc.default,rc=uc.default(),wf.yield(rc.listPeers(!0),7);case 7:return $c=wf.yieldResult,Jd=$c.find(function(Bf){return"pdf printer"===Bf.type}),je={ackTimeout:3E4},td=rc,qe=td.sendToAndWait,
Wd=Jd.id,wf.yield(Promise.all(ob.map(function(Bf){return Fd.createMorphSnapshot(Bf,{addPreview:!1,testLoad:!1})})),9);case 9:return wf.yield(qe.call(td,Wd,"[PDF printer] print",wf.yieldResult,je),8);case 8:Ud=wf.yieldResult;if(Re=Ud.error||Ud.data.error)throw Ha.showError(Re),Re;Ha.serveFileAsDownload(Ud.data,{fileName:ob[0].name+(1<ob.length?".etc":"")+".pdf",type:"application/pdf"});Sb.remove();wf.jumpToEnd()}})}},{name:"escape",exec:function(Ha,S,ob,fa){S=Ha.env.eventDispatcher.eventState;S.menu&&
S.menu.remove();S=Ha.halos();S.forEach(function(Ba){return Ba.remove()});Ha.hands.forEach(function(Ba){return Ba.cancelGrab(!0,fa)});Ha=Fd.arr.last(S)&&Fd.arr.last(S).target||Ha.focusedMorph||Ha;Ha.focus();Ha.isText&&Ha.selection.disableMultiSelect&&Ha.selection.disableMultiSelect();return!1}},{name:"move or resize halo target",exec:function(Ha,S){S=void 0===S?{direction:"left",offset:1,what:"move"}:S;var ob=Ha.halos()[0];if(!ob||ob.changingName||Ha.focusedMorph!=ob)return!1;var fa=S;Ha=fa.direction;
S=fa.offset;fa=fa.what;var Ba=ob.target;S=S||1;switch(Ha){case "left":Ba["move"===fa?"left":"width"]-=S;break;case "right":Ba["move"===fa?"left":"width"]+=S;break;case "up":Ba["move"===fa?"top":"height"]-=S;break;case "down":Ba["move"===fa?"top":"height"]+=S}ob.alignWithTarget();return!0}},{name:"close halo target",exec:function(Ha){Ha=Ha.halos()[0];if(!Ha||Ha.changingName)return!1;Ha.target.selectedMorphs?Ha.target.selectedMorphs.forEach(function(S){return S.abandon()}):Ha.target.abandon();return!0}},
{name:"resize manually",exec:function(Ha,S){S=void 0===S?{}:S;var ob,fa,Ba,Na,tb,Sb,lc,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:Ba=Ha.windowBounds();Na=Ha.bounds();tb=Number;if(Sb=S.width){rc.jumpTo(2);break}return rc.yield(Ha.prompt("Enter world width",{input:Math.max(Na.width,Ba.width),requester:Ha}),3);case 3:Sb=rc.yieldResult;case 2:ob=tb(Sb);if("number"!==typeof ob){rc.jumpTo(4);break}lc=Number;if(uc=S.height){rc.jumpTo(5);break}return rc.yield(Ha.prompt("Enter world height",
{input:Math.max(Na.height,Ba.height),requester:Ha}),6);case 6:uc=rc.yieldResult;case 5:fa=lc(uc);case 4:return"number"!==typeof ob||isNaN(ob)||"number"!==typeof fa||isNaN(fa)||(Ha.extent=Fd.pt(ob,fa)),rc.return(!0)}})}},{name:"resize windows to fit visible world bounds",exec:function(Ha){var S=Ha.getWindows().filter(function(Na){return!Na.minimized});if(!S.length)return!0;Ha=Ha.visibleBoundsExcludingTopBar();var ob=S.reduce(function(Na,tb){return tb.bounds().union(Na)},new Fd.Rectangle(0,0,0,0)),
fa=Ha.width/ob.width,Ba=Ha.height/ob.height;S.forEach(function(Na){var tb=Na.bounds();Na.setBounds(new Fd.Rectangle(tb.x*fa,tb.y*Ba,tb.width*fa,tb.height*Ba))});return!0}},{name:"window switcher",exec:function(Ha){var S,ob,fa,Ba,Na,tb,Sb,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(uc){if(1==uc.nextAddress){if((S=Ha.activePrompt())&&"lively.morphic-window switcher"===S.historyId)return S.focus(),uc.return(S.get("list").execCommand("select down"));ob=Ha.submorphs.filter(function(rc){return rc.isWindow}).reverse().map(function(rc){return{isListItem:!0,
string:rc.title||String(rc),value:rc}});ob.forEach(function(rc){rc.value.opacity=.5;rc.value.blur=1});return uc.yield(Ha.filterableListPrompt("Choose window",ob,{preselect:1,requester:Ha,historyId:"lively.morphic-window switcher",onSelection:function(rc){fa&&(fa.minimized=Ba,fa.blur=1,fa.animate({opacity:.3,duration:200}));if(fa=rc)rc.animate({opacity:1,duration:200}),rc.blur=0,Ba=rc.minimized,rc.minimized=!1},width:1*Ha.visibleBounds().extent().x/3,itemPadding:Fd.Rectangle.inset(4)}),2)}tb=Na=uc.yieldResult;
Sb=$jscomp.makeIterator(tb.selected);lc=Sb.next().value;ob.forEach(function(rc){rc.value.opacity=1;rc.value.blur=0});lc&&(lc.activate(),lc.minimized=!1);return uc.return(!0)})}},{name:"close active window or morph",exec:function(Ha){var S=Ha.focusedMorph;if(!S)return!0;var ob=S.getWindow();Ha.undoStart("window close");ob?ob.close():(Fd.arr.last(Fd.arr.without(S.ownerChain(),Ha)).remove(),(ob=Ha.activeWindow())&&ob.activate());Ha.undoStop("window close");return!0}},{name:"toggle minimize active window",
exec:function(Ha){(Ha=Ha.activeWindow())&&Ha.toggleMinimize();return!0}},{name:"toggle minimize all windows",exec:function(Ha){(Ha=Ha.getWindows())&&Ha.map(function(S){return S.toggleMinimize()});return!0}},{name:"toggle minimize all except active window",exec:function(Ha){(Ha=Ha.getWindows().filter(function(S){return!S.isActive()}))&&Ha.map(function(S){return S.toggleMinimize()});return!0}},{name:"close all except active window",exec:function(Ha){(Ha=Ha.getWindows().filter(function(S){return!S.isActive()}))&&
Ha.map(function(S){return S.close()});return!0}},{name:"close all windows",exec:function(Ha){(Ha=Ha.getWindows())&&Ha.map(function(S){return S.close()});return!0}},{name:"open status message of focused morph",exec:function(Ha){var S=Ha.focusedMorph;if(Ha=$jscomp.makeIterator(S?Ha.visibleStatusMessagesFor(S):[]).next().value)Ha.expand(),Ha.focus();return Ha||!0}},{name:"resize active window",exec:function(Ha,S){function ob(){var Jd,je,td;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qe){if(1==
qe.nextAddress)return qe.yield(Ha.filterableListPrompt("How to resize the window?","full center right left bottom top reset".split(" "),{requester:Ha}),2);Jd=qe.yieldResult;je=$jscomp.makeIterator(Jd.selected);td=je.next().value;return qe.return(td)})}function fa(Jd,je){switch(Jd){case "full":return lc;case "col1":case "left":return $c.withTopLeft(lc.topLeft());case "col2":case "center":return $c.withCenter(lc.center());case "col3":case "right":return $c.translatedBy(Fd.pt(lc.width-rc,0));case "top":return lc.divide([Fd.rect(0,
0,1,.5)])[0];case "bottom":return lc.divide([Fd.rect(0,.5,1,.5)])[0];case "reset":return Sb._normalBounds||Fd.pt(500,400).extentAsRectangle().withCenter(je.center());default:return je}}S=void 0===S?{how:null,window:null}:S;var Ba,Na,tb,Sb,lc,uc,rc,$c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jd){if(1==Jd.nextAddress){Ba=S;Na=Ba.window;tb=Ba.how;Sb=Na||Ha.activeWindow();if(!Sb)return Jd.return();lc=Ha.visibleBoundsExcludingTopBar().insetBy(15);uc=Sb.bounds();Sb._normalBounds||(Sb._normalBounds=
uc);rc=Math.min(700,Math.max(1E3,lc.width/3));$c=lc.withWidth(rc);return tb?Jd.jumpTo(2):Jd.yield(ob(),3)}2!=Jd.nextAddress&&(tb=Jd.yieldResult);if(!tb)return Jd.return();Sb.setBounds(fa(tb,lc));"reset"===tb&&delete Sb._normalBounds;return Jd.return(!0)})}},{name:"[recovery] show last object editor saves",exec:function(Ha,S){return Ha.execCommand("[recovery] show last doits",Object.assign({},S,{title:"logged ObjectEditor save",logAccessFn:function(){return JSON.parse(localStorage["oe helper"]).saves}}))}},
{name:"[recovery] show last doits",description:"browse a list of your last doits",exec:function(Ha,S){S=void 0===S?{}:S;var ob,fa,Ba,Na,tb,Sb,lc,uc,rc,$c,Jd,je,td,qe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wd){if(1==Wd.nextAddress){ob=S;(fa=ob.logAccessFn)||(fa=function(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])});try{Ba=fa()}catch(Ud){}if(!Ba)return Wd.return(Ha.inform("no log yet"));Na=Fd.arr.sortBy(Ba.map(function(Ud,Re){var wf="string"===typeof Ud?Ud:Ud.source;
Ud="string"===typeof Ud?Re:Ud.time||Re;Re=Fd.date.format(new Date(Ud),"yy-mm-dd HH:MM");return{time:Ud,source:wf,printedTime:Re}}),function(Ud){return-Ud.time});tb=Na.map(function(Ud,Re){return{isListItem:!0,string:"["+Ud.printedTime+"] "+Ud.source.slice(0,100).replace(/\n/g,"").trim(),value:Ud}});return Wd.yield(Ha.filterableListPrompt("select doit code",tb,{multiSelect:!0,requester:Ha}),2)}Sb=Wd.yieldResult;lc=Sb.selected;if(lc.length){uc=[];rc=$jscomp.makeIterator(lc);for($c=rc.next();!$c.done;$c=
rc.next())je=Jd=$c.value,td=je.source,qe=je.printedTime,uc.push("// "+qe+"\n"+td);return Wd.return(Ha.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},S,{content:uc.join("\n\n")})))}return Wd.return(!0)})}},{name:"open loading indicator",exec:function(Ha,S){Ha={};"object"===typeof S&&(Ha=S,S=Ha.label);return Fd.LoadingIndicator.open(S,Ha)}},{name:"open workspace",exec:function(Ha,S,ob,fa){S=void 0===S?{}:S;var Ba,Na,tb,Sb,lc,uc,rc,$c,Jd,je;return $jscomp.asyncExecutePromiseGeneratorProgram(function(td){switch(td.nextAddress){case 1:if(Ba=
fa&&Ha.relayCommandExecutionToFocusedMorph(fa))return td.return(Ba);Na=S.language||S.mode||"javascript";tb={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",css:"lively.ide/css/workspace.js",less:"lively.ide/css/less/workspace.js",text:null};Sb=Object.keys(Fd.config.ide.modes.aliases).reduce(function(qe,Wd){var Ud={};return Object.assign(qe,
(Ud[Fd.config.ide.modes.aliases[Wd]]=Wd,Ud))},{});if(!S.askForMode){td.jumpTo(2);break}lc=Object.keys(tb).concat("javascript console");return td.yield(Ha.filterableListPrompt("Open workspace for...",lc),3);case 3:if(uc=td.yieldResult,rc=$jscomp.makeIterator(uc.selected),Na=rc.next().value,!Na)return td.return(!0);case 2:if("javascript console"===Na)return td.return(Ha.execCommand("open console",S));S=Object.assign({content:""},S,{mode:Na,language:Na});$c=tb[S.language]||tb[Sb[S.language]];return"text"!==
Na&&$c?td.yield(System.import($c),4):td.return(Ha.execCommand("open text window",Object.assign({},Fd.config.codeEditor.modes.text,{},S)));case 4:return Jd=td.yieldResult,je=Jd.default,td.return((new je({title:S.title||S.language+" workspace",center:Ha.center,content:S.content,target:S.target,systemInterface:S.systemInterface||S.backend})).activate())}})}},{name:"open console",exec:function(Ha,S){var ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){if(1==fa.nextAddress)return fa.yield(Fd.loadObjectFromPartsbinFolder("Console"),
2);ob=fa.yieldResult;return fa.return(ob.openInWorldNearHand())})}},{name:"open shell workspace",exec:function(Ha,S){return Ha.execCommand("open workspace",Object.assign({},S,{language:"shell"}))}},{name:"open javascript workspace",exec:function(Ha,S){return Ha.execCommand("open workspace",Object.assign({},S,{language:"javascript"}))}},{name:"open shell terminal",exec:function(Ha,S){var ob,fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){if(1==Ba.nextAddress)return Ba.yield(System.import("lively.ide/shell/terminal.js"),
2);ob=Ba.yieldResult;fa=ob.default;return Ba.return(fa.open(S).openInWorldNearHand())})}},{name:"open text window",exec:function(Ha,S){var ob=S=void 0===S?{}:S,fa=ob.title,Ba=ob.extent,Na=ob.content,tb=ob.mode,Sb=ob.name;ob=ob.rangesAndStyles;fa=fa||"text window";Na=Na||"";Ba=Ba||Fd.pt(500,400);Sb=Sb||"text workspace";Na="string"===typeof Na?[Na,null]:Na;S=new Fd.Text(Object.assign({padding:Fd.Rectangle.inset(3)},Fd.obj.dissoc(S,["title","content"]),{textAndAttributes:Na,clipMode:"auto",name:Sb,extent:Ba}));
ob&&S.setTextAttributesWithSortedRanges(ob);tb&&S.changeEditorMode(tb);return Ha.openInWindow(S,{title:fa}).activate()}},{name:"merge and open in window",exec:function(Ha,S){S=void 0===S?{a:"",b:"",format:null,extent:Fd.pt(500,600)}:S;var ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){if(1==fa.nextAddress)return fa.yield(Fd.loadObjectFromPartsbinFolder("text merger"),2);ob=fa.yieldResult;return fa.return(ob.targetMorph.open(S.a,S.b,S))})}},{name:"diff and open in window",exec:function(Ha,
S){var ob,fa,Ba;function Na(je,td,qe){var Wd,Ud,Re,wf,Bf,Wf,Gf,Mf,ph,uh,Oe,Ch,Nf,Xf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qg){if(1==Qg.nextAddress){Wd=qe;Ud=Wd.format;Re=null;if("patch"!==Ud)return Jd=$c[Ud](je,td,qe),wf=Fd.arr.flatmap(Jd,function(xe){var Jh=xe.added;return[xe.value,xe.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:Fd.Color.red}:Jh?{fontWeight:"bold",textDecoration:"",fontColor:Fd.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:Fd.Color.darkGray}]}),
Qg.jumpTo(2);Bf=qe;Wf=Bf.headerA;Gf=Bf.headerB;Mf=Bf.filenameA;ph=Bf.filenameB;uh=Bf.context;wf=[$c.createTwoFilesPatch(Mf||"a",ph||"b",je,td,Wf,Gf,"number"===typeof uh?{context:uh}:void 0),{}];return Qg.yield(System.import("lively.ide/diff/editor-plugin.js"),3)}2!=Qg.nextAddress&&(Oe=Qg.yieldResult,Ch=Oe.default,Re=new Ch);Nf=Ha.execCommand("open text window",qe);Xf=Nf.targetMorph;Nf.extent=rc||Fd.pt(300,200).maxPt(Xf.textBounds().extent());Xf.textAndAttributes=wf;Re&&Xf.addPlugin(Re);return Qg.return(Xf)})}
S=void 0===S?{a:"",b:"",format:null,extent:Fd.pt(500,600)}:S;var tb,Sb,lc,uc,rc,$c,Jd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(je){if(1==je.nextAddress){tb=S;Sb=tb.a;lc=tb.b;uc=tb.format;rc=tb.extent;if(uc)Sb=String(Sb),lc=String(lc);else{a:{var td=Sb,qe=lc;if(Fd.obj.isPrimitive(td)||td instanceof RegExp||Fd.obj.isPrimitive(qe)||qe instanceof RegExp)td=String(td),qe=String(qe);if("string"!==typeof td||"string"!==typeof qe)try{JSON.stringify(td);JSON.stringify(qe);ob="diffJson";
fa=td;Ba=qe;break a}catch(Wd){td=String(td),qe=String(qe)}ob="diffLines";fa=td;Ba=qe}Sb=fa;lc=Ba;uc=ob}return je.yield(System.import("https://jspm.dev/diff"),2)}if(3!=je.nextAddress)return $c=je.yieldResult,je.yield(Na(Sb,lc,Object.assign({fontFamily:"monospace"},S,{format:uc})),3);Jd=je.yieldResult;return je.return(Jd)})}},{name:"merge workspaces",exec:function(Ha,S){return Ha.execCommand("diff workspace",Object.assign({},S,{merge:!0}))}},{name:"diff workspaces",exec:function(Ha,S){function ob(rc,
$c){var Jd=rc.pluginFind(function(td){return td.evalEnvironment});Jd=Jd&&Jd.evalEnvironment.targetModule||"no file";var je=$c.pluginFind(function(td){return td.evalEnvironment});return Ha.execCommand("diff and open in window",{a:rc.textString,b:$c.textString,filenameA:Jd,filenameB:je&&je.evalEnvironment.targetModule||"no file"})}function fa(rc,$c){var Jd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(je){if(1==je.nextAddress)return je.yield(Fd.loadObjectFromPartsbinFolder("text merger"),
2);Jd=je.yieldResult;return je.return(Jd.targetMorph.open(rc.textString,$c.textString))})}function Ba(rc,$c){var Jd,je,td,qe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wd){if(1==Wd.nextAddress)return Jd=rc.map(function(Ud){return{isListItem:!0,value:Ud,string:Ud.name||String(Ud)}}),Wd.yield(Ha.filterableListPrompt("choose text: ",Jd,{onSelection:function(Ud){Ud&&Ud.show()}}),2);je=Wd.yieldResult;td=$jscomp.makeIterator(je.selected);qe=td.next().value;return Wd.return(qe)})}S=void 0===
S?{}:S;var Na,tb,Sb,lc,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:Na=S;tb=Na.editor1;Sb=Na.editor2;lc=Na.merge;tb&&Sb||(uc=Ha.withAllSubmorphsSelect(function($c){return $c.isText&&!$c.isInputLine&&!$c.isUsedAsEpiMorph()}).reverse());if(tb){rc.jumpTo(2);break}return rc.yield(Ba(uc),3);case 3:tb=rc.yieldResult;case 2:if(!tb)return rc.return(Ha.setStatusMessage("Canceled"));if(Sb){rc.jumpTo(4);break}return rc.yield(Ba(Fd.arr.without(uc,tb)),5);case 5:Sb=
rc.yieldResult;case 4:return Sb?rc.return(lc?fa(tb,Sb):ob(tb,Sb)):rc.return(Ha.setStatusMessage("Canceled"))}})}},{name:"search workspaces",exec:function(){function Ha(rc,$c){return rc.map(function(Jd){var je=Jd.world()?Jd.getWindow():$world.withAllSubmorphsDetect(function(Ud){return Ud.isWindow&&Ud.targetMorph===pe}),td=0,qe=Fd.string.lines(Jd.textString).find(function(Ud,Re){Ud=Ud.toLowerCase();td=Re;return $c.every(function(wf){return Ud.includes(wf)})}),Wd=je?je.title:Jd.toString();return qe?
{isListItem:!0,string:Wd+" | "+qe,value:{window:je,morph:Jd,row:td}}:null}).filter(Boolean)}function S(rc){return $world.withAllSubmorphsDo(function($c){$c.isWindow&&$c.minimized&&$c.targetMorph&&$c.targetMorph.isText&&($c=$c.targetMorph);if(!$c.textString||!$c.isText||$c.isUsedAsEpiMorph())return null;var Jd=$c.textString.toLowerCase();return rc.every(function(je){return Jd.includes(je)})?$c:null}).filter(Boolean)}var ob=this,fa,Ba,Na,tb,Sb,lc,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==
rc.nextAddress)return rc.yield($world.filterableListPrompt("search workspaces",[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function($c){$c.getSubmorphNamed("list").updateFilter=function(){var Jd=this.parseInput();if(!(3>Jd.input.length)){var je=S(Jd.lowercasedTokens);this.listMorph.items=Ha(je,Jd.lowercasedTokens)}}}}),2);fa=rc.yieldResult;Ba=$jscomp.makeIterator(fa.selected);return(Na=Ba.next().value)?(tb=Na,Sb=tb.morph,lc=tb.window,uc=tb.row,lc&&(lc.minimized&&lc.toggleMinimize(),
lc.activate()),(lc||Sb).show(),ob.cursorPosition={row:uc,column:0},rc.return(Sb)):rc.return(null)})}},{name:"open PartsBin",exec:function(Ha){var S,ob,fa,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){if(1==Na.nextAddress)return S=Fd.LoadingIndicator.open("Loading Partsbin..."),Na.yield(System.import("lively.morphic/partsbin.js"),2);if(3!=Na.nextAddress)return ob=Na.yieldResult,fa=ob.loadPart,Na.yield(fa("PartsBin"),3);Ba=Na.yieldResult;Ba.openInWorldNearHand();Ba.targetMorph.selectedCategory=
"*basics*";Ba.focus();S.remove();Ba.getWindow().activate();return Na.return(Ba)})}},{name:"browse and load component",exec:function(Ha){var S,ob,fa,Ba,Na,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){switch(Sb.nextAddress){case 1:S=Fd.LoadingIndicator.open("loading component browser");if(Ha._componentsBrowser){Sb.jumpTo(2);break}return Sb.yield(S.whenRendered(),2);case 2:if(ob=Ha._componentsBrowser){Sb.jumpTo(4);break}Ba=fa=Ha;return Sb.yield(Fd.resource("part://SystemDialogs/master component browser").read(),
5);case 5:ob=Ba._componentsBrowser=Sb.yieldResult;case 4:return Na=ob,S.remove(),Sb.yield(Na.activate(),6);case 6:(tb=Sb.yieldResult)&&!tb.world()&&tb.openInWorld(),Sb.jumpToEnd()}})}},{name:"load object from PartsBin",exec:function(Ha,S){S=void 0===S?{}:S;var ob,fa,Ba,Na,tb,Sb,lc,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:return fa=S,Ba=fa.name,Na=void 0===fa.open?!0:fa.open,Ba?rc.yield(System.import("lively.morphic/partsbin.js"),6):rc.yield(System.import("lively.morphic/partsbin.js"),
4);case 4:return tb=rc.yieldResult,Sb=tb.interactivelyLoadObjectFromPartsBinFolder,rc.yield(Sb(),5);case 5:ob=rc.yieldResult;rc.jumpTo(3);break;case 6:return lc=rc.yieldResult,uc=lc.loadObjectFromPartsbinFolder,rc.yield(uc(Ba),7);case 7:ob=rc.yieldResult;case 3:return ob&&Na&&ob.openInWorldNearHand(),rc.return(ob)}})}},{name:"open object drawer",exec:function(Ha){var S,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){if(1==fa.nextAddress)return fa.yield(System.import("lively.components/object-drawer.js"),
2);S=fa.yieldResult;ob=S.default;return fa.return((new ob).openInWorldNearHand())})}},{name:"open object editor",exec:function(Ha,S){S=void 0===S?{target:null,selectedClass:null,selectedMethod:null,evalEnvironment:null}:S;var ob,fa,Ba,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress){if(!S.target)return Ha.setStatusMessage("No target for ObjectEditor"),tb.return(null);ob=S.loadingIndicator=Fd.LoadingIndicator.open("Open Object Editor...");return tb.yield(System.import("lively.ide/js/objecteditor/index.js"),
2)}if(3!=tb.nextAddress)return fa=tb.yieldResult,Ba=fa.ObjectEditor,tb.yield(Ba.open(S),3);Na=tb.yieldResult;ob.remove();return tb.return(Na)})}},{name:"open object inspector",exec:function(Ha,S){S=void 0===S?{target:null}:S;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ob){return S.target?ob.return(Fd.inspect(S.target)):(Ha.setStatusMessage("no target for Inspector"),ob.return(null))})}},{name:"inspect server",exec:function(Ha){var S,ob,fa,Ba,Na,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){switch(Sb.nextAddress){case 1:return Sb.yield(System.import("lively.ide/js/inspector.js"),
2);case 2:return S=Sb.yieldResult,ob=S.default,Sb.yield(System.import("lively-system-interface"),3);case 3:return fa=Sb.yieldResult,Ba=fa.serverInterfaceFor,Na=Ba(System.baseURL+"eval"),tb={format:"esm",context:"global",targetModule:"lively://lively.next-workspace/world",sourceURL:"inspect-server_"+Date.now(),systemInterface:Na},Sb.yield(Na.runEval('\n           import LivelyServer from "lively.server/server.js";\n           let server = LivelyServer.servers.values().next().value;\n        ',tb),
4);case 4:ob.openInWindow({remoteTarget:{code:"server",evalEnvironment:tb}}),Sb.jumpToEnd()}})}},{name:"open scene graph inspector",exec:function(Ha,S){S=void 0===S?{target:null}:S;var ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){if(1==fa.nextAddress)return fa.yield(Fd.loadObjectFromPartsbinFolder("scene graph inspector"),2);ob=fa.yieldResult;ob.targetMorph=S.target||Ha;return fa.return(ob.openInWindow({title:"morph graph"}))})}},{name:"open browser",progressIndicator:"opening browser...",
exec:function(Ha,S,ob,fa){S=void 0===S?{packageName:"lively.morphic",moduleName:"morph.js"}:S;var Ba,Na,tb,Sb,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(uc){switch(uc.nextAddress){case 1:return(Ba=fa&&Ha.relayCommandExecutionToFocusedMorph(fa))?uc.return(Ba):uc.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return Na=uc.yieldResult,tb=Na.default,S?(lc=Fd.obj.select(S,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),uc.yield(tb.browse(lc,
{extent:Fd.pt(700,600)}),6)):uc.yield(tb.open(),5);case 5:Sb=uc.yieldResult;uc.jumpTo(4);break;case 6:Sb=uc.yieldResult;case 4:return Sb.getWindow().activate(),uc.return(Sb)}})}},{name:"choose and browse package resources",progressIndicator:"browsing resources...",exec:function(Ha,S,ob,fa){S=void 0===S?{browser:null,systemInterface:null}:S;var Ba,Na,tb,Sb,lc,uc,rc,$c,Jd,je,td,qe,Wd,Ud,Re,wf,Bf,Wf,Gf,Mf,ph,uh,Oe,Ch;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nf){switch(Nf.nextAddress){case 1:if(Ba=
fa&&Ha.relayCommandExecutionToFocusedMorph(fa))return Nf.return(Ba);Na=(Na=S.browser||Ha.focusedMorph&&Ha.focusedMorph.ownerChain().find(function(Xf){return Xf.isBrowser}))&&Na.isBrowser?Na.getWindow():null;return Nf.yield(System.import("lively-system-interface"),2);case 2:return tb=Nf.yieldResult,Sb=tb.localInterface,lc=S&&S.systemInterface?S.systemInterface:Na?Na.systemInterface:Sb,Nf.yield(lc.getPackages({excluded:Fd.config.ide.js.ignoredPackages}),3);case 3:uc=Nf.yieldResult,rc=[],$c={},Jd=$jscomp.makeIterator(uc),
je=Jd.next();case 4:if(je.done)return Nf.yield(Ha.filterableListPrompt("Choose module to open",rc,{historyId:"lively.morphic-choose and browse package resources",requester:Na,width:700,multiSelect:!0,fuzzy:"value.shortName"}),8);$c.$jscomp$loop$prop$p$2799=je.value;$c.$jscomp$loop$prop$excluded$2798=(Fd.Path("lively.ide.exclude").get($c.$jscomp$loop$prop$p$2799)||[]).map(function(Xf){return Xf.includes("*")?new RegExp(Xf.replace(/\*/g,".*")):Xf});$c.$jscomp$loop$prop$excluded$2798.push(".git","node_modules",
".module_cache");td=rc.push;qe=td.apply;Wd=rc;Ud=$jscomp;Re=Ud.arrayFromIterable;wf=function(Xf){return function(Qg){return{isListItem:!0,string:"["+Xf.$jscomp$loop$prop$p$2799.name+"] "+Qg.nameInPackage+(Qg.isLoaded?"":" [not loaded]"),value:Qg}}}($c);Bf=function(Xf){return function(Qg){var xe=Qg.url;return!xe.endsWith("/")&&!Xf.$jscomp$loop$prop$excluded$2798.some(function(Jh){return Jh instanceof RegExp?Jh.test(xe):xe.includes(Jh)})}}($c);return Nf.yield(lc.resourcesOfPackage($c.$jscomp$loop$prop$p$2799,
$c.$jscomp$loop$prop$excluded$2798),7);case 7:qe.call(td,Wd,Re.call(Ud,Nf.yieldResult.filter(Bf).sort(function(Xf,Qg){return Xf.isLoaded&&!Qg.isLoaded?-1:!Xf.isLoaded&&Qg.isLoaded?1:Xf.nameInPackage.toLowerCase()<Qg.nameInPackage.toLowerCase()?-1:Xf.nameInPackage.toLowerCase()==Qg.nameInPackage.toLowerCase()?0:1}).map(wf)));$c={$jscomp$loop$prop$excluded$2798:$c.$jscomp$loop$prop$excluded$2798,$jscomp$loop$prop$p$2799:$c.$jscomp$loop$prop$p$2799};je=Jd.next();Nf.jumpTo(4);break;case 8:return Wf=Nf.yieldResult,
Gf=Wf.selected,Mf=$jscomp.makeIterator(Fd.arr.partition(Gf,function(Xf){return Xf.url.match(/\.js(on)?/)})),ph=Mf.next().value,uh=Mf.next().value,Nf.yield(System.import("lively.ide/js/browser/index.js"),9);case 9:return Oe=Nf.yieldResult,Ch=Oe.default,Nf.yield(Promise.all(ph.map(function(Xf){return Ch.browse({packageName:Xf.package,moduleName:Xf.url},Na,lc).then(function(Qg){return Qg.activate()})})),10);case 10:if(!uh.length){Nf.jumpTo(11);break}return Nf.yield(Promise.all(uh.map(function(Xf){return Ha.execCommand("open file",
{url:Xf.url})})),11);case 11:return Nf.return(!0)}})}},{name:"choose and browse module",progressIndicator:"browsing module...",handlesCount:!0,exec:function(Ha,S,ob){S=void 0===S?{browser:void 0,systemInterface:void 0}:S;var fa,Ba,Na,tb,Sb,lc,uc,rc,$c,Jd,je,td,qe,Wd,Ud,Re,wf,Bf,Wf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gf){switch(Gf.nextAddress){case 1:if(!S.browser&&(Ba=(fa=Ha.focusedMorph)&&fa.getWindow())&&Ba.targetMorph&&Ba.targetMorph.isFileBrowser)return Gf.return(Ba.targetMorph.execCommand("find file and select",
S,ob));Na=S.browser||fa&&fa.ownerChain().find(function(Mf){return Mf.isBrowser});return Gf.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return tb=Gf.yieldResult,Sb=tb.default,Gf.yield(System.import("lively-system-interface"),3);case 3:return lc=Gf.yieldResult,uc=lc.localInterface,rc=S&&S.systemInterface?S.systemInterface:Na?Na.systemInterface:uc,$c="local"==rc.name?"":" on ["+Fd.string.truncate(rc.name,35,"...")+"]",Gf.yield(rc.getPackages(),4);case 4:Jd=Gf.yieldResult;je=[];td=
$jscomp.makeIterator(Jd);for(qe=td.next();!qe.done;qe=td.next())for(Wd=qe.value,Ud=Fd.Path("lively.ide.exclude").get(Wd)||[],Ud=Ud.map(function(Mf){return Mf.includes("*")?new RegExp(Mf.replace(/\*/g,".*")):Mf}),Re={},wf=$jscomp.makeIterator(Wd.modules),Bf=wf.next();!Bf.done;Re={$jscomp$loop$prop$m$2801:Re.$jscomp$loop$prop$m$2801},Bf=wf.next())Re.$jscomp$loop$prop$m$2801=Bf.value,Ud.some(function(Mf){return function(ph){return ph instanceof RegExp?ph.test(Mf.$jscomp$loop$prop$m$2801.name):Mf.$jscomp$loop$prop$m$2801.name.includes(ph)}}(Re))||
(Wf=rc.shortModuleName(Re.$jscomp$loop$prop$m$2801.name,Wd),je.push({isListItem:!0,string:"["+Wd.name+"] "+Wf,value:{package:Wd,module:Re.$jscomp$loop$prop$m$2801,shortName:Wf}}));je=Fd.arr.sortBy(je,function(Mf){return Mf.string});(function(){var Mf,ph,uh,Oe,Ch,Nf,Xf,Qg,xe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jh){switch(Jh.nextAddress){case 1:return Mf=Na||fa,Jh.yield(Ha.filterableListPrompt("Choose module to open"+$c,je,{historyId:"lively.morphic-choose and browse module",
requester:Mf,height:Math.min(Mf.height,700),width:500,multiSelect:!0,listFontColor:"white",fuzzy:"value.shortName"}),2);case 2:ph=Jh.yieldResult,uh=ph.selected,Oe=0;case 3:if(!(Oe<uh.length)){Jh.jumpTo(0);break}Ch=uh[Oe];Nf=Ch.package;Xf=Ch.shortName;Qg={packageName:Nf.name,moduleName:Xf};return Jh.yield(Sb.browse(Qg,0===Oe?Na:void 0,rc),6);case 6:xe=Jh.yieldResult,xe.moveBy(Fd.pt(20*Oe,20*Oe)),xe.getWindow().activate(),Oe++,Jh.jumpTo(3)}})})();return Gf.return(!0)}})}},{name:"open code search",progressIndicator:"opening code search...",
exec:function(Ha,S){S=void 0===S?{browser:null,systemInterface:null,input:null}:S;var ob,fa,Ba,Na,tb,Sb,lc,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==rc.nextAddress){ob=Ha.focusedMorph?Ha.focusedMorph.ownerChain():[];fa=S.browser||ob.find(function($c){return $c.isBrowser});Ba=Fd.LoadingIndicator.open("loading code search");if(fa&&fa.isBrowser){if(fa.state.associatedSearchPanel)return rc.return(fa.state.associatedSearchPanel.getWindow().activate())}else fa=null;return rc.yield(System.import("lively-system-interface"),
2)}if(3!=rc.nextAddress)return Na=rc.yieldResult,tb=Na.localInterface,Sb=S.systemInterface||fa&&fa.systemInterface,Sb||(Sb=(lc=ob.find(function($c){return $c.isText&&$c.editorPlugin&&$c.editorPlugin.isJSEditorPlugin}))?lc.editorPlugin.systemInterface():tb),rc.yield(Fd.resource("part://SystemIDE/code search").read(),3);uc=rc.yieldResult;Object.assign(uc,{browser:fa,input:S.input,systemInterface:Sb});uc.openInWindow();uc.focus();Ba.remove();fa&&(fa.state.associatedSearchPanel=uc);return rc.return(uc)})}},
{name:"open grep search",progressIndicator:"opening code search...",exec:function(Ha,S){var ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){if(1==fa.nextAddress)return fa.yield(Fd.loadObjectFromPartsbinFolder("grep search"),2);ob=fa.yieldResult;return fa.return(ob.openInWorldNearHand(Ha).activate())})}},{name:"open test runner",progressIndicator:"opening test runner...",exec:function(Ha){var S,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return 1==fa.nextAddress?
fa.yield(System.import("lively.ide/test-runner.js"),2):3!=fa.nextAddress?(S=fa.yieldResult,ob=S.default,fa.yield(ob.open(),3)):fa.return(fa.yieldResult)})}},{name:"open file browser",progressIndicator:"opening file browser...",exec:function(Ha,S){S=void 0===S?{}:S;var ob,fa,Ba,Na,tb,Sb,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(uc){if(1==uc.nextAddress)return uc.yield(System.import("lively.ide/http-file-browser.js"),2);ob=uc.yieldResult;fa=ob.default;Ba=S;Na=Ba.location;tb=Ba.url;
lc=(Sb=Ba.file)?fa.forFile(Sb,Na):fa.forLocation(tb||Na||document.location.origin);return uc.return(Ha.openInWindow(lc).activate())})}},{name:"open file",progressIndicator:"opening file...",exec:function(Ha,S){S=void 0===S?{url:null,lineNumber:null,reuse:!1}:S;var ob,fa,Ba,Na,tb,Sb,lc,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:ob=S;fa=ob.url;Ba=ob.lineNumber;Na=ob.reuse;tb=Ha.commandHandler.progressIndicator;if(fa){rc.jumpTo(2);break}tb.visible=
!1;return rc.yield(Ha.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0}),3);case 3:fa=rc.yieldResult,tb.visible=!0;case 2:if(Na&&(Ha.getWindows().slice(-2),Sb=Fd.arr.findAndGet(Ha.getWindows(),function($c){return($c=$c.targetMorph)&&$c.isTextEditor&&$c.location.split(":")[0]===fa?$c:null})))return"number"===typeof Ba&&(Sb.lineNumber=Ba),rc.return(Sb.getWindow().activate());Ba&&(fa+=":"+Ba);return rc.yield(System.import("lively.ide/text-editor.js"),4);case 4:return lc=
rc.yieldResult,uc=lc.default,rc.return(fa?uc.openURL(fa,Fd.obj.dissoc(S,["url"])):null)}})}},{name:"open file for EDITOR",exec:function(Ha,S){S=void 0===S?{url:null,lineNumber:null}:S;var ob,fa,Ba,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){return 1==tb.nextAddress?tb.yield(System.import("lively.ide/text-editor.js"),2):3!=tb.nextAddress?(ob=tb.yieldResult,fa=ob.default,Ba=S,Na=Ba.url,tb.yield(fa.openAsEDITOR(Na,{}),3)):tb.return(tb.yieldResult)})}},{name:"open subserver controller",
exec:function(Ha,S){var ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){if(1==fa.nextAddress)return fa.yield(Fd.loadPart("subserver controller"),2);ob=fa.yieldResult;return fa.return(ob.openInWorld())})}},{name:"[lively.installer] publish new version of a package",exec:function(Ha){var S,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){switch(fa.nextAddress){case 1:return fa.yield(lively.modules.registerPackage(document.location.origin+"/lively.installer"),2);
case 2:return fa.yield(System.import("lively.installer/packages/publish-new-package-version.js"),3);case 3:return S=fa.yieldResult,ob=S.default,fa.yield(ob(),4);case 4:return fa.return(!0)}})}},{name:"report a bug",exec:function(Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(S){window.open("https://github.com/LivelyKernel/lively.next/issues/new","_blank");return S.return(!0)})}},{name:"fix font metric",exec:function(Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(S){Ha.env.fontMetric.reset();
Ha.withAllSubmorphsDo(function(ob){return ob.isText&&ob.textLayout&&ob.textLayout.reset()});return S.return(!0)})}},{name:"delete change history",exec:function(Ha){var S=Ha.env,ob=S.printStatus();S.deleteHistory();Ha.setStatusMessage(ob);Ha._componentsBrowser&&Ha._componentsBrowser.reset();return!0}},{name:"install global inspect and show",exec:function(Ha){window.show=Fd.show;window.inspect=Fd.inspect;Ha.setStatusMessage("inspect() and show() are now globally available");return!0}},{name:"save world",
exec:function(Ha,S,ob,fa){var Ba,Na,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){if(1==Sb.nextAddress){if(Ba=fa&&Ha.relayCommandExecutionToFocusedMorph(fa))return Sb.return(Ba);S=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},S);Na=Ha.focusedMorph;return Sb.yield(Fd.interactivelySaveWorld(Ha,S),2)}tb=Sb.yieldResult;Na&&Na.focus();return Sb.return(tb)})}},{name:"freeze world",exec:function(Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(S){return S.yield(Fd.interactivelyFreezeWorld(Ha),
0)})}},{name:"save this world",exec:function(Ha,S,ob,fa){return Ha.execCommand("save world",Object.assign({confirmOverwrite:!0},S,{showSaveDialog:!1}))}},{name:"load world",exec:function(Ha,S){S=void 0===S?{}:S;var ob,fa,Ba,Na,tb,Sb,lc,uc,rc,$c,Jd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(je){switch(je.nextAddress){case 1:ob=S;fa=ob.id;Ba=ob.commit;Na=ob.name;tb=ob.ref;Sb=ob.world;lc=Ha.constructor;if(Sb)return je.return(lc.loadWorld(Sb,Ha));if(fa||Ba)return je.return(lc.loadFromCommit(fa||
Ba,Ha));if(Na)return je.return(lc.loadFromDB(Na,tb,Ha));uc=Fd.LoadingIndicator.open("loading project browser...");return je.yield(uc.whenRendered(),2);case 2:rc=Fd.morph({fill:Fd.Color.black.withA(.5),extent:Ha.extent,name:"dark overlay",opacity:0,reactsToPointer:!1,renderOnGPU:!0,halosEnabled:!1});rc.openInWorld(Fd.pt(0,0));rc.animate({opacity:1,duration:300});if($c=Ha.get("a project browser")){je.jumpTo(3);break}return je.yield(Fd.resource("part://partial freezing/project browser").read(),4);case 4:$c=
je.yieldResult;case 3:return Jd=$c,Jd.name="a project browser",Jd.hasFixedPosition=!0,Jd.epiMorph=!0,Jd.bringToFront().alignInWorld(Ha),Jd.update(),Jd.focus(),Fd.once(Jd,"remove",function(){return rc.animate({opacity:0}).then(function(){return rc.remove()})}),uc.remove(),je.return(Jd)}})}},{name:"add external package dependency to object",exec:function(Ha,S){S=void 0===S?{}:S;var ob,fa,Ba,Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress)return ob=S.target||Ha,
fa=ob.metadata&&ob.metadata.externalPackages||[],tb.yield(Ha.editListPrompt("modify package dependencies of "+ob,fa),2);Ba=tb.yieldResult;Na=Ba.list;if(!Na)return tb.return();Na.length?(ob.metadata||(ob.metadata={}),ob.metadata.externalPackages=Na):ob.metadata&&delete ob.metadata.externalPackages;return tb.return(!0)})}},{name:"toggle comment browser",exec:function(Ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(S){Fd.CommentBrowser.toggle();S.jumpToEnd()})}}];var $d=Fd.commands;Fd.default=
$d;var Fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js");Fa.RadialGradient=jc;Fa.Point=kd;Fa.pt=Zc;Fa.rect=gc;Fa.Color=Kb;Fa.LinearGradient=vb;Fa.Morph=db;Fa.Tooltip=ec;Fa.Image=wb;Fa.VerticalLayout=Mb;Fa.GridLayout=Hb;Fa.Text=Mc;Fa.Ellipse=pc;Fa.morph=pe;Fa.Icon=Ma;Fa.num=Ib;Fa.arr=Bc;Fa.connect=pb;Fa.signal=Ub;Fa.Popover=se;Fa.ColorPalette=Ue;Fa.ColorPicker=ff;Fa.colorWidgets=gf;Fa.joinPath=dc;Fa.WHEEL_URL=Fa.joinPath(System.baseURL,"/lively.ide/assets/color-wheel.png");
(function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("GradientTypeSelector")&&"function"===typeof S.GradientTypeSelector?S.GradientTypeSelector:S.GradientTypeSelector=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,[{key:"defaultLinearGradient",get:function(){return new Fa.LinearGradient({stops:[{color:Fa.Color.white,offset:0},{color:Fa.Color.black,
offset:1}]})}},{key:"defaultRadialGradient",get:function(){return new Fa.RadialGradient({stops:[{color:Fa.Color.white,offset:0},{color:Fa.Color.black,offset:1}],focus:Fa.pt(.5,.5),bounds:Fa.rect(0,0,30,30)})}},{key:"update",value:function(fa){var Ba=$jscomp.makeIterator(this.submorphs),Na=Ba.next().value;Ba=Ba.next().value;Na.borderColor=Ba.borderColor=Fa.Color.gray.darker();fa instanceof Fa.RadialGradient?Na.borderColor=Fa.Color.orange:fa instanceof Fa.LinearGradient&&(Ba.borderColor=Fa.Color.orange)}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientTypeSelector"}},{key:"properties",get:function(){return{fill:{defaultValue:Fa.Color.transparent},layout:{initialize:function(){this.extent=Fa.pt(180,40);this.layout=new Fa.GridLayout({grid:[[null,"radialMode",null,"linearMode",null]],autoAssign:!1,fitToCell:!1})}},submorphs:{initialize:function(){var fa=this,Ba=$jscomp.makeIterator(this.submorphs=[Fa.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},
name:"radialMode",fill:this.defaultRadialGradient}),Fa.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"linearMode",fill:this.defaultLinearGradient})]),Na=Ba.next().value;Ba=Ba.next().value;Fa.connect(Na,"onMouseDown",function(){return Fa.signal(fa,"radial")});Fa.connect(Ba,"onMouseDown",function(){return Fa.signal(fa,"linear")})}}}}}],S,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:660,end:2566})})(Fa.Morph);var Wa=function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("GradientEditor")&&"function"===typeof S.GradientEditor?S.GradientEditor:S.GradientEditor=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};
return vc(ob,Ha,[{key:"remove",value:function(){vc._get(Object.getPrototypeOf(ob.prototype),"remove",this).call(this);this.gradientHandle&&this.gradientHandle.remove()}},{key:"selectRadialGradient",value:function(){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return 1==Ba.nextAddress?(fa.get("linearMode").borderColor=Fa.Color.gray.darker(),fa.get("radialMode").borderColor=Fa.Color.orange,Ba.yield(fa.applyGradient(Fa.RadialGradient),2)):Ba.yield(fa.updateGradientHandles(),
0)})}},{key:"selectLinearGradient",value:function(){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return 1==Ba.nextAddress?(fa.get("radialMode").borderColor=Fa.Color.gray.darker(),fa.get("linearMode").borderColor=Fa.Color.orange,Ba.yield(fa.applyGradient(Fa.LinearGradient),2)):Ba.yield(fa.updateGradientHandles(),0)})}},{key:"applyGradient",value:function(fa){var Ba=this,Na,tb,Sb,lc,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){Na=Ba.gradientValue;
Ba.get("gradientEditor");Na&&Na.isGradient?(tb=Na,Sb=tb.stops,lc=tb.focus,uc=tb.vector,Ba.gradientValue=new fa({stops:Sb,bounds:Ba.gradientBounds,focus:lc,vector:uc})):Ba.gradientValue=new fa({stops:[{color:Fa.Color.white,offset:0},{color:Fa.Color.black,offset:1}],bounds:Ba.gradientBounds});Ba.update(Ba.gradientValue);rc.jumpToEnd()})}},{key:"showGradientHandlesOn",value:function(fa){this.handleMorph=fa;this.updateGradientHandles()}},{key:"updateGradientHandles",value:function(){var fa=this,Ba,Na;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress)return Ba=300,Na=fa.gradientValue.__proto__.constructor,fa.handleMorph?fa.gradientHandle?tb.yield(fa.gradientHandle.fadeOut(Ba),3):tb.jumpTo(2):tb.return();Na==Fa.RadialGradient?fa.gradientHandle=new Fa.GradientFocusHandle({target:fa.handleMorph}):Na==Fa.LinearGradient&&(fa.gradientHandle=new Fa.GradientDirectionHandle({target:fa.handleMorph}));fa.gradientHandle&&(Fa.signal(fa,"openHandle",fa.gradientHandle),fa.gradientHandle.relayout(),
fa.gradientHandle.opacity=0,fa.gradientHandle.animate({opacity:1,duration:Ba}));tb.jumpToEnd()})}},{key:"update",value:function(fa){(fa=void 0===fa?this.gradientValue:fa)&&fa.isGradient&&this.get("gradientEditor").update(fa)}},{key:"build",value:function(){var fa;this.submorphs=[fa=new Fa.GradientTypeSelector({name:"typeSelector"}),this.gradientEditor()];Fa.connect(fa,"radial",this,"selectRadialGradient");Fa.connect(fa,"linear",this,"selectLinearGradient");Fa.connect(this,"gradientValue",this,"update");
this.update(this.gradientValue);fa.update(this.gradientValue);this.gradientValue&&this.updateGradientHandles()}},{key:"gradientEditor",value:function(){return Fa.morph({fill:null,clipMode:"hidden",extent:Fa.pt(190,80),submorphs:[new Fa.GradientStopVisualizer({position:Fa.pt(5,30),name:"gradientEditor",gradientEditor:this})]})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientEditor"}},{key:"properties",get:function(){return{layout:{initialize:function(){this.layout=new Fa.VerticalLayout({spacing:3})}},
fill:{defaultValue:Fa.Color.transparent},handleMorph:{},gradientValue:{set:function(fa){fa&&fa.isGradient||(fa=!1);this.setProperty("gradientValue",fa)}},submorphs:{initialize:function(){this.build()}}}}}],S,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:2575,end:6191})}(Fa.Morph);
Fa.GradientEditor=Wa;Fa.GradientEditor=Wa;Fa.GradientEditor=Wa;(function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("StopControlHead")&&"function"===typeof S.StopControlHead?S.StopControlHead:S.StopControlHead=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,[{key:"update",value:function(fa){var Ba=this.getSubmorphNamed("paletteField");this.getSubmorphNamed("pickerField");
Ba||(this.submorphs=[Ba=this.paletteField(Fa.pt(10,10))]);Ba.fill=this.stopColor=fa.stops[this.index].color}},{key:"onHoverIn",value:function(){var fa=this.targetProperty.stops[this.index].color;this.palette=this.palette||new Fa.Popover({name:"Color Palette",targetMorph:new Fa.ColorPalette({color:fa})});Fa.connect(this.palette.targetMorph,"color",this.palette,"color");this.picker=this.picker||new Fa.ColorPicker({color:fa});this.picker.color=fa;this.scheduleExpand()}},{key:"onHoverOut",value:function(){this.scheduleShrink()}},
{key:"scheduleExpand",value:function(){this.queue.pop()||(this.queue.push(this.expand),this.dequeue())}},{key:"scheduleShrink",value:function(){this.queue.pop()||(this.queue.push(this.shrink),this.dequeue())}},{key:"dequeue",value:function(){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){if(1==Ba.nextAddress){if(fa.queueActive)return Ba.return();fa.queueActive=!0}if(3!=Ba.nextAddress)return 0<fa.queue.length?Ba.yield(fa.queue.shift().bind(fa)(),2):Ba.jumpTo(3);fa.queueActive=
!1;Ba.jumpToEnd()})}},{key:"expand",value:function(){var fa=this,Ba,Na,tb,Sb,lc,uc,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){if(1<fa.submorphs.length)return $c.return();Ba=fa.get("paletteField");tb=Fa.pt(2,-14);fa.submorphs=[fa.closeButton(),Ba,fa.pickerField()];fa.master={auto:"styleguide://SystemWidgets/stop control head/expanded"};Na=fa.get("gradientEditor");Sb=fa.transformRectToMorph(Na,fa.innerBounds());lc=Sb.x;uc=Sb.width;rc=lc+uc-Na.width;lc<fa.width/2&&(tb=tb.addXY(fa.width/
3-lc,0));rc>fa.width/2&&(tb=tb.addXY(fa.width/3-rc,0));Ba.extent=Fa.pt(15,15);fa.center=tb;fa.stopVisualizer.gradientEditor.update();$c.jumpToEnd()})}},{key:"shrink",value:function(){var fa=this,Ba,Na,tb,Sb,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(uc){if(3>fa.submorphs.length)return uc.return();Ba=Fa.pt(2,-14);Na=$jscomp.makeIterator([fa.get("close"),fa.get("paletteField"),fa.get("pickerField")]);tb=Na.next().value;Sb=Na.next().value;lc=Na.next().value;Sb.bringToFront();tb.remove();
lc.remove();fa.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"};fa.center=Ba;uc.jumpToEnd()})}},{key:"onWidgetClosed",value:function(){this.palette=this.picker=null;this.shrink()}},{key:"removeStop",value:function(){this.stopVisualizer.removeStop(this.index)&&this.remove()}},{key:"closeButton",value:function(){var fa=new Fa.Morph({name:"close",extent:Fa.pt(15,15),fill:Fa.Color.transparent,origin:Fa.pt(0,-3),clipMode:"hidden",submorphs:[Fa.Icon.makeLabel("times",{styleClasses:["closeButton"]})]});
Fa.connect(fa,"onMouseDown",this,"removeStop");return fa}},{key:"updateColor",value:function(fa){this.stopVisualizer.updateStop(this.index,{color:fa})}},{key:"openColorWidget",value:function(fa){this.stopVisualizer.stopControls.forEach(function(Ba){return Ba.head.closeAllWidgets()});this[fa].topLeft=Fa.pt(0,0);Fa.connect(this[fa],"color",this,"updateColor");Fa.connect(this[fa],"close",this,"onWidgetClosed");Fa.connect(this.stopVisualizer,"remove",this[fa],"remove");Fa.connect(this[fa],"onBlur",this,
"removeWhenLostFocus",{converter:function(){return fa},varMapping:{name:fa}});this[fa].fadeIntoWorld(this.globalBounds().bottomCenter());this[fa].focus()}},{key:"removeWhenLostFocus",value:function(fa){var Ba=this;setTimeout(function(){$world.focusedMorph.ownerChain().includes(Ba[fa])||$world.focusedMorph.isMenuItem?Ba[fa].focus():Ba.closeColorWidget(fa)},100)}},{key:"closeColorWidget",value:function(fa){this[fa]&&this[fa].remove()}},{key:"closeAllWidgets",value:function(){this.closeColorWidget("palette");
this.closeColorWidget("picker")}},{key:"paletteField",value:function(fa){fa=Fa.morph({type:"ellipse",name:"paletteField",extent:fa,styleClasses:["paletteField"]});Fa.connect(fa,"onMouseDown",this,"openColorWidget",{converter:function(){return"palette"}});return fa}},{key:"pickerField",value:function(){var fa=new Fa.Image({name:"pickerField",styleClasses:["pickerField"]});Fa.connect(fa,"onMouseDown",this,"openColorWidget",{converter:function(){return"picker"}});return fa}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"StopControlHead"}},{key:"properties",get:function(){return{stopVisualizer:{},gradientEditor:{},targetProperty:{get:function(){return this.stopVisualizer.targetProperty}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"}}},index:{},queue:{defaultValue:[]},isHaloItem:{defaultValue:!0}}}}],S,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:6193,end:11487})})(Fa.Morph);(function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("GradientStopVisualizer")&&"function"===typeof S.GradientStopVisualizer?S.GradientStopVisualizer:S.GradientStopVisualizer=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return vc(ob,Ha,[{key:"update",value:function(fa){this.fill=new Fa.LinearGradient({stops:fa.stops,vector:"eastwest"});this.get("instruction").animate({visible:!1,duration:300});this.renderStopControls(fa)}},{key:"onHoverOut",value:function(){this.toggleStopPreview(!1)}},{key:"onMouseMove",value:function(fa){var Ba=fa.positionIn(this);fa=Ba.x;this.stopControls&&this.stopControls.find(function(Na){return Na.bounds().containsPoint(Ba)})?this.toggleStopPreview(!1):(this.toggleStopPreview(!0),
this.get("stopControlPreview").position=Fa.pt(fa,0))}},{key:"onMouseDown",value:function(fa){if(this.get("stopControlPreview").visible){var Ba=fa.positionIn(this).x/this.width;fa=this.targetProperty.stops.findIndex(function(Na){return Na.offset>Ba});fa=0>fa?this.targetProperty.stops.length-1:fa;this.insertStop(fa,Ba)}}},{key:"toggleStopPreview",value:function(fa){this.get("instruction").visible||(this.get("stopControlPreview").visible=fa)}},{key:"removeStop",value:function(fa){var Ba=this.targetProperty;
return 2<Ba.stops.length?(Fa.arr.removeAt(Ba.stops,fa),this.targetProperty=Ba,!0):!1}},{key:"insertStop",value:function(fa,Ba){var Na=this.targetProperty;Fa.arr.pushAt(Na.stops,{offset:Ba,color:Na.stops[fa].color},fa);this.targetProperty=Na}},{key:"updateStop",value:function(fa,Ba){var Na=this.targetProperty;Na.stops[fa]=Object.assign({},Na.stops[fa],{},Ba);this.targetProperty=Na}},{key:"renderStopControls",value:function(fa){var Ba=this;if(!this.stopControls||this.stopControls.length!=fa.stops.length){var Na=
$jscomp.makeIterator(this.submorphs),tb=Na.next().value;Na=Na.next().value;this.stopControls=fa.stops.map(function(Sb,lc){return new Fa.GradientStopControl({stopVisualizer:Ba,index:lc})});this.submorphs=[tb,Na].concat($jscomp.arrayFromIterable(this.stopControls));Fa.arr.invoke(this.stopControls,"update",fa)}Fa.arr.invoke(this.stopControls,"update",fa)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopVisualizer"}},{key:"properties",get:function(){return{fill:{defaultValue:Fa.Color.gray},
gradientEditor:{},draggable:{defaultValue:!1},targetProperty:{derived:!0,get:function(){return this.gradientEditor&&this.gradientEditor.gradientValue},set:function(fa){this.gradientEditor.gradientValue=fa}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop visualizer"}}},submorphs:{after:["gradientEditor"],initialize:function(){this.submorphs=[{type:"label",name:"instruction",value:"Select Gradient Type",visible:!(this.targetProperty&&this.targetProperty.isGradient)},
{name:"stopControlPreview",visible:!1,master:{auto:"styleguide://SystemWidgets/stop control preview"},submorphs:[Fa.Icon.makeLabel("plus-circle",{name:"addStopLabel"})]}]}}}}}],S,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:11489,end:14883})})(Fa.Morph);(function(Ha){var S=
lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("GradientStopControl")&&"function"===typeof S.GradientStopControl?S.GradientStopControl:S.GradientStopControl=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,[{key:"update",value:function(fa){this.position=this.stopVisualizer.extent.subPt(Fa.pt(10,0)).scaleByPt(Fa.pt(fa.stops[this.index].offset,0)).addPt(Fa.pt(5,
0));this.head.update(fa)}},{key:"onDragStart",value:function(fa){this.nativeCursor="-webkit-grabbing";this.stopVisualizer.nativeCursor="-webkit-grabbing";this.offsetView=(new Fa.Tooltip).openInWorld(fa.hand.position.addPt(Fa.pt(10,10)))}},{key:"onDrag",value:function(fa){var Ba=Math.max(0,Math.min(1,(this.position.x-5+fa.state.dragDelta.x)/(this.stopVisualizer.width-10)));this.stopVisualizer.updateStop(this.index,{offset:Ba});this.offsetView.description=(100*Ba).toFixed(2)+"%";this.offsetView.position=
fa.hand.position.addPt(Fa.pt(10,10))}},{key:"onDragEnd",value:function(){this.nativeCursor="-webkit-grab";this.stopVisualizer.nativeCursor="auto";this.offsetView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopControl"}},{key:"properties",get:function(){return{index:{},head:{},stopVisualizer:{},styleClasses:{defaultValue:["stopControlLine"]},nativeCursor:{defaultValue:"-webkit-grab"},draggable:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop control"}}},
submorphs:{after:["index","stopVisualizer"],initialize:function(){this.head=new Fa.StopControlHead({name:"stop control head",stopVisualizer:this.stopVisualizer,index:this.index});this.head.stopControl=this;this.addMorph(this.head)}}}}}],S,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},
{start:14885,end:16661})})(Fa.Morph);(function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("FocusHandle")&&"function"===typeof S.FocusHandle?S.FocusHandle:S.FocusHandle=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().center()}},{key:"onDragStart",value:function(fa){this.tfm=
this.gradientHandle.target.getGlobalTransform().inverse();this.focusView=(new Fa.Tooltip).openInWorld(fa.hand.position.addPt(Fa.pt(10,10)))}},{key:"onDrag",value:function(fa){var Ba=fa.state.dragDelta,Na=this.gradientHandle,tb=Na.target.fill;tb.focus=tb.focus.addXY(Ba.x/Na.target.width,Ba.y/Na.target.height);this.focusView.description="x: "+(100*tb.focus.x).toFixed()+"%, y: "+(100*tb.focus.y).toFixed()+"%";this.focusView.position=fa.hand.position.addPt(Fa.pt(10,10));Na.target.makeDirty();Na.relayout()}},
{key:"onDragEnd",value:function(fa){this.focusView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"FocusHandle"}},{key:"properties",get:function(){return{gradientHandle:{},styleClasses:{defaultValue:["focusHandle"]},extent:{defaultValue:Fa.pt(20,20)},fill:{defaultValue:Fa.Color.orange}}}}],S,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:16663,end:17666})})(Fa.Ellipse);(function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("BoundsHandle")&&"function"===typeof S.BoundsHandle?S.BoundsHandle:S.BoundsHandle=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().partNamed(this.side);
this.scale=1/this.gradientHandle.target.getGlobalTransform().getScale()}},{key:"onDragStart",value:function(fa){this.boundsView=(new Fa.Tooltip).openInWorld(fa.hand.position.addPt(Fa.pt(10,10)))}},{key:"onDrag",value:function(fa){var Ba=this.gradientHandle,Na=Ba.target.fill,tb=Na.bounds.partNamed(this.side).addPt(fa.state.dragDelta.scaleBy(2));Na.bounds=Na.bounds.withPartNamed(this.side,tb);this.boundsView.description="w: "+Na.bounds.width.toFixed()+"px h: "+Na.bounds.height.toFixed()+"px";this.boundsView.position=
fa.hand.position.addPt(Fa.pt(10,10));Ba.target.makeDirty();Ba.relayout()}},{key:"onDragEnd",value:function(fa){this.boundsView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"BoundsHandle"}},{key:"properties",get:function(){return{side:{},gradientHandle:{},styleClasses:{after:["side"],initialize:function(){this.styleClasses=["boundsHandle",this.side]}}}}}],S,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:17668,end:18747})})(Fa.Ellipse);var Gb=function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("GradientFocusHandle")&&"function"===typeof S.GradientFocusHandle?S.GradientFocusHandle:S.GradientFocusHandle=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return vc(ob,Ha,[{key:"relayout",value:function(){var fa=this.target.fill,Ba=fa.focus;this.extent=fa.bounds.extent();this.submorphs.forEach(function(Na){return Na.relayout()});this.rotation=this.target.rotation;this.scale=this.target.scale;this.borderWidth=2/this.scale;this.owner&&(this.center=this.owner.localizePointFrom(this.target.extent.scaleByPt(Ba),this.target))}},{key:"initBoundsHandles",value:function(){var fa=this;this.bounds().sides.forEach(function(Ba){fa.addMorph(new Fa.BoundsHandle({gradientHandle:fa,
side:Ba,name:"bounds handle "+Ba.split("C")[0]}))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientFocusHandle"}},{key:"properties",get:function(){return{target:{},isHaloItem:{defaultValue:!0},hasFixedPosition:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient focus handle"}}},submorphs:{initialize:function(){this.submorps=[];this.initBoundsHandles();this.addMorph(new Fa.FocusHandle({gradientHandle:this}));this.relayout()}}}}}],
S,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:18756,end:20039})}(Fa.Ellipse);Fa.GradientFocusHandle=Gb;Fa.GradientFocusHandle=Gb;Fa.GradientFocusHandle=Gb;(function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("RotationPoint")&&
"function"===typeof S.RotationPoint?S.RotationPoint:S.RotationPoint=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,[{key:"relayout",value:function(){this.center=Fa.Point.polar(this.gradientHandle.width/2,this.gradientHandle.target.fill.vectorAsAngle())}},{key:"onDragStart",value:function(fa){this.angleView=(new Fa.Tooltip).openInWorld(fa.hand.position.addPt(Fa.pt(10,10)));this.angleView.rotation=0}},
{key:"onDrag",value:function(fa){var Ba=this.gradientHandle;Ba.target.fill.vector=fa.positionIn(Ba).theta();Ba.target.makeDirty();Ba.relayout();this.angleView.description=(Fa.num.toDegrees(Ba.target.fill.vectorAsAngle())+180).toFixed()+"\u00b0";this.angleView.position=fa.hand.position.addPt(Fa.pt(10,10))}},{key:"onDragEnd",value:function(fa){this.angleView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RotationPoint"}},{key:"properties",get:function(){return{gradientHandle:{}}}}],
S,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20041,end:20838})})(Fa.Ellipse);(function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),ob=S.hasOwnProperty("GradientDirectionHandle")&&"function"===typeof S.GradientDirectionHandle?S.GradientDirectionHandle:
S.GradientDirectionHandle=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,[{key:"isHaloItem",get:function(){return!0}},{key:"relayout",value:function(){this.owner&&(this.position=this.owner.localizePointFrom(this.target.extent.scaleBy(.5),this.target));this.rotationPoint.relayout()}},{key:"initRotationPoint",value:function(){this.rotationPoint=this.addMorph(new Fa.RotationPoint({gradientHandle:this,
name:"rotation point"}))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientDirectionHandle"}},{key:"properties",get:function(){return{target:{},origin:{defaultValue:Fa.pt(25,25)},extent:{defaultValue:Fa.pt(50,50)},hasFixedPosition:{defaultValue:!0},submorphs:{initialize:function(){this.initRotationPoint();this.relayout()}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient direction handle"}}}}}}],S,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20840,end:21812})})(Fa.Ellipse);Fa.colorWidgets.GradientEditor=Fa.GradientEditor;var pa=lively.FreezerRuntime.recorderFor("lively.components/canvas.js");pa.pt=Zc;pa.Point=kd;pa.rect=gc;pa.Color=Kb;pa.Morph=db;pa.Image=wb;pa.connect=pb;Gb=Ka("C",function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.components/canvas.js"),
ob=S.hasOwnProperty("Canvas")&&"function"===typeof S.Canvas?S.Canvas:S.Canvas=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,[{key:"context",get:function(){if(this._canvas)return this._canvas.getContext(this.contextType);this.world()&&this.env.renderer.getNodeForMorph(this)||console.warn("Context not yet rendered. Please ensure that the Canvas Morph has been rendered first before accessing the context. This can be achieved by waiting for the whenRendered() promise before you proceed accessing the context property.");
return null}},{key:"_canvas",set:function(fa){var Ba=this.__canvas__;this.__canvas__=fa;this.restoreContent(Ba,fa)}},{key:"_canvas",get:function(){return this.__canvas__}},{key:Symbol.for("lively-instance-initialize"),value:function(fa){fa=void 0===fa?{}:fa;vc._get(Object.getPrototypeOf(ob.prototype),Symbol.for("lively-instance-initialize"),this).call(this,fa);pa.connect(this,"extent",this,"onExtentChanged")}},{key:"afterRender",value:function(fa,Ba){Ba?this._canvas=fa:"function"===typeof this.__canvas_init__&&
(this.__canvas_init__(),delete this.__canvas_init__)}},{key:"restoreContent",value:function(fa,Ba){var Na=this.contextType,tb=this.preserveContents;"function"===typeof this.__canvas_init__?(this.__canvas_init__(),delete this.__canvas_init__):tb&&"2d"==Na&&fa&&fa!==Ba&&this.context.drawImage(fa,0,0)}},{key:"onExtentChanged",value:function(){var fa=this;if(this._canvas&&this.preserveContents&&this.context.getImageData){var Ba=this._canvas,Na=Ba.width;Ba=Ba.height;if(Na&&Ba){var tb=this.context.getImageData(0,
0,Na,Ba);this.__canvas_init__=function(){fa.context.putImageData(tb,0,0)}}}}},{key:"clear",value:function(fa){var Ba=this.context;if(Ba){var Na=this._canvas,tb=Na.width;Na=Na.height;Ba.save();Ba.setTransform(1,0,0,1,0,0);fa?(fa.toCSSString&&(fa=fa.toCSSString()),Ba.fillStyle=fa,Ba.fillRect(0,0,tb,Na)):Ba.clearRect(0,0,tb,Na);Ba.restore()}}},{key:"render",value:function(fa){return fa.renderCanvas(this)}},{key:"withContextDo",value:function(fa){var Ba=this;this._canvas?fa(this.context):this.__canvas_init__=
function(){return fa(Ba.context)}}},{key:"toDataURI",value:function(){return this._canvas&&this._canvas.toDataURL()}},{key:"fromDataURI",value:function(fa){var Ba=this,Na=new pa.Image;Na.onload=function(){Ba._canvas.width=Na.width;Ba._canvas.height=Na.height;Ba.context.drawImage(Na,0,0)};Na.src=fa}},{key:"imageData",value:function(fa){fa||(fa=this.canvasBounds);return this.context.getImageData(fa.x,fa.y,fa.width,fa.height)}},{key:"nonTransparentArea",value:function(){for(var fa=this.imageData(),Ba=
fa.data,Na=fa.width,tb=fa.height,Sb=Na,lc=tb,uc=0;uc<tb;uc++)for(var rc=0;rc<Sb;rc++)0<Ba[4*(uc*Na+rc)+3]&&(Sb=rc,lc>uc&&(lc=uc));if(Sb===Na)return pa.rect(0,0,0,0);uc=Sb;rc=lc;for(--tb;tb>lc;tb--)for(var $c=Na-1;$c>uc;$c--)0<Ba[4*(tb*Na+$c)+3]&&(uc=$c,rc<tb&&(rc=tb));return{imageData:fa,bounds:pa.rect(Sb,lc,uc-Sb+1,rc-lc+1)}}},{key:"trimNonTransparent",value:function(){var fa=this.nonTransparentArea(),Ba=fa.imageData;fa=fa.bounds;if(!fa.topLeft().equals(pa.pt(0,0))){var Na=fa.x,tb=fa.y;this.context.putImageData(Ba,
-Na,-tb,Na,tb,fa.width,fa.height);this.position=this.position.addPt(fa.topLeft())}fa.extent().equals(this.extent)||(this.extent=fa.extent())}},{key:"finishDraw",value:function(fa){fa=void 0===fa?{}:fa;var Ba=this.context,Na=fa,tb=void 0===Na.color?"rgba(0,0,0,0.6)":Na.color,Sb=void 0===Na.width?4:Na.width;Na=void 0===Na.fill?!1:Na.fill;fa=fa.fillColor||tb;tb.toCSSString&&(tb=tb.toCSSString());fa.toCSSString&&(fa=fa.toCSSString());Ba.strokeStyle=tb;Ba.lineWidth=Sb;Ba.stroke();Ba.closePath();Na&&(Ba.fillStyle=
fa,Ba.fill())}},{key:"line",value:function(fa,Ba,Na){Na=void 0===Na?{}:Na;var tb=this.context;tb.beginPath();tb.moveTo(fa.x,fa.y);tb.lineTo(Ba.x,Ba.y);tb.lineCap="round";this.finishDraw(Na)}},{key:"arc",value:function(fa,Ba,Na,tb,Sb,lc){Sb=void 0===Sb?!1:Sb;lc=void 0===lc?{}:lc;var uc=this.context;uc.beginPath();uc.arc(fa.x,fa.y,Ba,Na,tb,Sb);this.finishDraw(lc)}},{key:"polygon",value:function(fa,Ba){Ba=void 0===Ba?{}:Ba;var Na=this.context;Na.beginPath();Na.moveTo(fa[0].x,fa[0].y);for(var tb=0;tb<
fa.length;tb++)Na.lineTo(fa[tb].x,fa[tb].y);Na.lineTo(fa[0].x,fa[0].y);this.finishDraw(Ba)}},{key:"text",value:function(fa,Ba,Na){Na=void 0===Na?{}:Na;var tb=this.context,Sb=Na,lc=void 0===Sb.color?"black":Sb.color,uc=void 0===Sb.font?"14px Arial":Sb.font,rc=void 0===Sb.align?"start":Sb.align;Sb=void 0===Sb.baseline?"bottom":Sb.baseline;tb.save();tb.font=uc;tb.fillStyle=lc;tb.textAlign=rc;tb.textBaseline=Sb;Na.angle&&!isNaN(Na.angle)&&(tb.translate(Ba.x,Ba.y),tb.rotate(Na.angle),tb.translate(-Ba.x,
-Ba.y));tb.fillText(fa,Ba.x,Ba.y);tb.restore()}},{key:"line",value:function(fa,Ba,Na){Na=void 0===Na?{}:Na;var tb=this.context,Sb=Na.color||"rgba(0,0,0,0.6)";Na=Na.width||4;Sb.toCSSString&&(Sb=Sb.toCSSString());tb.strokeStyle=Sb;tb.beginPath();tb.lineWidth=Na;tb.moveTo(fa.x,fa.y);tb.lineTo(Ba.x,Ba.y);tb.stroke();tb.closePath()}},{key:"spiral",value:function(){this.clear(pa.Color.white);for(var fa=this.innerBounds().center(),Ba=0,Na=1,tb=0;150>tb;tb++){var Sb=fa.addPt(pa.Point.polar(Na,Ba));this.line(fa,
Sb,{color:pa.Color.random()});fa=Sb;Ba+=Math.PI/10;Na+=.3}}},{key:"rect",value:function(fa,Ba,Na){Na=void 0===Na?{}:Na;var tb=this.context;tb.beginPath();tb.rect(fa.x,fa.y,Ba.x,Ba.y);this.finishDraw(Na)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Canvas"}},{key:"properties",get:function(){return{extent:{defaultValue:pa.pt(200,200)},fill:{defaultValue:pa.Color.transparent},contextType:{defaultValue:"2d"},preserveContents:{defaultValue:!0},canvasExtent:{get:function(){return this._canvas&&
pa.pt(this._canvas.width,this._canvas.height)}},canvasBounds:{readOnly:!0,get:function(){return this._canvas&&this.canvasExtent.extentAsRectangle()}},_serializedContents:{get:function(){return this.preserveContents&&this.toDataURI()},set:function(fa){var Ba=this;this.withContextDo(function(){return Ba.fromDataURI(fa)})}}}}}],S,{pathInPackage:function(){return"canvas.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.components",version:"0.1.0"}}},{start:233,end:8699})}(pa.Morph));pa.Canvas=Gb;pa.Canvas=Gb;pa.Canvas=Gb;var xa=lively.FreezerRuntime.recorderFor("lively.ide/world.js");xa.resource=Eb;xa.Rectangle=Ab;xa.Color=Kb;xa.pt=Zc;xa.arr=Bc;xa.fun=gd;xa.obj=Uc;xa.promise=Nb;xa.PropertyPath=Fc;xa.once=jd;xa.GridLayout=Hb;xa.MorphicDB=Fb;xa.easings=Zd;xa.HTMLMorph=sb;xa.Text=Mc;xa.Label=Ea;xa.Path=ua;xa.Polygon=V;xa.morph=pe;xa.Ellipse=pc;xa.touchInputDevice=ra;xa.Icon=Ma;
xa.Morph=db;xa.VerticalLayout=Mb;xa.HorizontalLayout=ja;xa.ProportionalLayout=Ca;xa.Tooltip=ec;xa.Image=wb;xa.inspect=ce;xa.config=Kd;xa.World=va;xa.loadMorphFromSnapshot=cb;xa.loadObjectFromPartsbinFolder=Dc;xa.loadPart=nd;xa.uploadFile=Kh;xa.InformPrompt=hc;xa.ConfirmPrompt=gb;xa.MultipleChoicePrompt=Oc;xa.TextPrompt=Cb;xa.EditPrompt=Gd;xa.PasswordPrompt=Ec;xa.ListPrompt=oc;xa.EditListPrompt=rb;xa.LoadingIndicator=wd;xa.Halo=ke;xa.MorphHighlighter=w;xa.StatusMessage=we;xa.StatusMessageForMorph=
ue;xa.ProportionalLayoutHalo=Od;xa.GridLayoutHalo=He;xa.FlexLayoutHalo=Te;xa.Window=Md;xa.List=yb;xa.FilterableList=qb;xa.Menu=Ia;xa.worldCommands=$d;xa.GradientEditor=Wa;xa.completions=Q;xa.runEval=za;xa.getClassName=Ta;xa.serialize=xb;xa.Canvas=Gb;xa.CommentBrowser=Ee;xa.prefetchCoreStyleguides=Yb;$d=function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),ob=S.hasOwnProperty("LivelyWorld")&&"function"===typeof S.LivelyWorld?S.LivelyWorld:S.LivelyWorld=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||
this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,[{key:"visibleBoundsExcludingTopBar",value:function(){var fa=$world.getSubmorphNamed("lively top bar"),Ba=this.visibleBounds();return fa?new xa.Rectangle(Ba.x,Ba.y+fa.height,Ba.width,Ba.height-fa.height):Ba}},{key:"getListedComponents",value:function(){var fa=this,Ba=this.withAllSubmorphsSelect(function(Na){return Na.isComponent&&!fa.hiddenComponents.includes(Na.name)});return xa.arr.uniq([].concat($jscomp.arrayFromIterable(Ba),
$jscomp.arrayFromIterable(this.localComponents)))}},{key:"activeWindow",value:function(){return this.getWindows().reverse().find(function(fa){return fa.isActive()})}},{key:"getWindows",value:function(){return this.submorphs.filter(function(fa){return fa.isWindow})}},{key:"activePrompt",value:function(){return this.getPrompts().reverse().find(function(fa){return fa.isActive()})}},{key:"getPrompts",value:function(){return this.submorphs.filter(function(fa){return fa.isPrompt})}},{key:"openInWindow",
value:function(fa,Ba){Ba=void 0===Ba?{title:fa.name,name:"window for "+fa.name}:Ba;fa=(new xa.Window(Object.assign({},Ba,{extent:fa.extent.addXY(0,25),targetMorph:fa}))).openInWorld();fa.ensureNotOverTheTop();return fa}},{key:"withTopBarDo",value:function(fa){var Ba=this.get("lively top bar");Ba&&fa(Ba)}},{key:"onTopBarLoaded",value:function(){}},{key:"onKeyUp",value:function(fa){this.withTopBarDo(function(Ba){return Ba.onKeyUp(fa)})}},{key:"onKeyDown",value:function(fa){vc._get(Object.getPrototypeOf(ob.prototype),
"onKeyDown",this).call(this,fa);fa.targetMorph==this&&this.withTopBarDo(function(Ba){return Ba.onKeyDown(fa)})}},{key:"onMouseDown",value:function(fa){vc._get(Object.getPrototypeOf(ob.prototype),"onMouseDown",this).call(this,fa);var Ba=fa.state.clickedOnMorph,Na=this.activeWindow();Na&&Ba==this&&Na.deactivate();this.handleHaloCycle(fa);fa.state.menu&&fa.state.menu.remove();this._tooltipViewer.mouseDown(fa)}},{key:"onMouseUp",value:function(fa){fa.isCommandKey()&&fa.stop();if(fa.isAltDown()&&xa.config.altClickDefinesThat){var Ba=
this.morphsContainingPoint(fa.position)[0];setTimeout(function(){return System.global.that=Ba},100);Ba.show();fa.stop();console.log('Set global "that" to '+Ba)}}},{key:"onDrag",value:function(fa){}},{key:"whenReady",value:function(){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return 1==Ba.nextAddress?Ba.yield(fa._styleLoading,2):Ba.return(!0)})}},{key:"onLoad",value:function(){var fa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){if(1==Ba.nextAddress){fa.opacity=
0;fa.onWindowResize();lively.modules&&lively.modules.removeHook("fetch",window.__logFetch);fa.animate({opacity:1,blur:3,duration:1E3,easing:xa.easings.inOutExpo});if(!fa.showsUserFlap&&!xa.resource(document.location.href).query().showsUserFlap)return Ba.jumpTo(2);fa._styleLoading=xa.prefetchCoreStyleguides(window.worldLoadingIndicator);return Ba.yield(fa._styleLoading,2)}fa.animate({blur:0,duration:1E3,easing:xa.easings.inOutExpo});document.body.style.overflowX="visible";document.body.style.overflowY=
"visible";Ba.jumpToEnd()})}},{key:"isNotUnique",value:function(fa){var Ba,Na,tb,Sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){switch(lc.nextAddress){case 1:return lc.yield(xa.MorphicDB.default.exists("world",fa),2);case 2:if(Ba=lc.yieldResult.exists){lc.jumpTo(3);break}Na=fa+".json";tb=xa;Sb=tb.resource;return lc.yield(System.decanonicalize("lively.morphic/styleguides"),5);case 5:return lc.yield(Sb.call(tb,lc.yieldResult).join(Na).exists(),4);case 4:Ba=lc.yieldResult;case 3:return lc.return(Ba)}})}},
{key:"askForName",value:function(){var fa=this,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){switch(Na.nextAddress){case 1:return Na.yield(fa.whenRendered(),3);case 3:if(Ba){Na.jumpTo(4);break}return Na.yield(fa.prompt(["New Project\n",{},"Enter a name for this project:",{fontWeight:"normal"}],{width:400,hasFixedPosition:!0,forceConfirm:!0}),5);case 5:return Ba=Na.yieldResult,Na.yield(fa.isNotUnique(Ba),6);case 6:if(!Na.yieldResult){Na.jumpTo(3);break}return Na.yield(fa.confirm("This Project name is already taken. Please pick a different one!",
{hasFixedPosition:!0,width:400}),8);case 8:Ba=!1;Na.jumpTo(3);break;case 4:return Na.return(Ba)}})}},{key:"onWindowResize",value:function(fa){vc._get(Object.getPrototypeOf(ob.prototype),"onWindowResize",this).call(this,fa);"elastic"===this.resizePolicy&&this.execCommand("resize to fit window")}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var fa=this,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){if(1==Na.nextAddress)return fa._cachedDragIndicator||(fa._cachedDragIndicator=
xa.loadObjectFromPartsbinFolder("upload-indicator")),Na.yield(fa._cachedDragIndicator,2);Ba=Na.yieldResult;Ba.world()||Ba.openInWorld();xa.fun.debounceNamed("remove-upload-indicator",1E3,function(){fa.nativeDrop_removeUploadIndicator()})();Na.jumpToEnd()})}},{key:"nativeDrop_removeUploadIndicator",value:function(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(fa){return fa.remove()})}},{key:"onNativeDragover",value:function(fa){fa.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},
{key:"onNativeDrop",value:function(fa){var Ba=this,Na,tb,Sb,lc,uc,rc,$c,Jd,je,td,qe,Wd,Ud,Re,wf,Bf,Wf,Gf,Mf,ph,uh,Oe,Ch,Nf,Xf,Qg,xe,Jh,Vb,Pc,ud,Ld,mf,pf,rg,Gj,qj,rj,zl,Rj,Al,bl,Bl,Sj,ci,nk;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vf){switch(vf.nextAddress){case 1:Ba.nativeDrop_removeUploadIndicator();if(fa.targetMorph!=Ba)return vf.return();Na=fa;tb=Na.domEvt;Sb=tb.dataTransfer;lc=Sb.files;uc=document.location.origin;if(!lc.length){vf.jumpTo(2);break}rc=Ba.getCurrentUser();$c=rc.isGuestUser?
"uploads/":"users/"+$world.getCurrentUser().name+"/uploads";if(!fa.isAltDown()){vf.jumpTo(3);break}return vf.yield(Ba.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",input:$c}),4);case 4:if($c=vf.yieldResult,!$c)return vf.return(Ba.setStatusMessage("Canceled upload"));case 3:return vf.yield(Ba.confirm("Upload "+lc.length+" file"+(1<lc.length?"s":"")+"?"),5);case 5:Jd=vf.yieldResult;if(!Jd)return vf.return();je=new xa.FormData;for(td=0;td<lc.length;td++)je.append("file",
lc[td],lc[td].name);Ud=xa.LoadingIndicator.open("Uploading File");vf.setCatchFinallyBlocks(6);Re={};wf=function(Bi){Bi=Bi.loaded/Bi.total;Ud.progress=Bi;Ud.status="Uploaded "+(100*Bi).toFixed()+"%"};rc.isGuestUser||(Re.Authorization="Bearer "+rc.token);qe=xa.resource(System.baseURL,{headers:Re,onProgress:wf,onLoad:function(Bi){return Wd=Bi}});qe=qe.join("/upload?uploadPath="+encodeURIComponent($c));return vf.yield(qe.write(je),8);case 8:vf.leaveTryBlock(7);break;case 6:return Bf=vf.enterCatchBlock(),
vf.return(Ba.showError("Upload failed: "+Bf.message+"\n"));case 7:Ud.remove();vf.setCatchFinallyBlocks(9);Ba.setStatusMessage("Uploaded "+Wd.uploadedFiles.length+" file");Wf=Wd.uploadedFiles.map(function(Bi){var Hj=xa.resource(uc).join(Bi.path);return Object.assign({},Bi,{url:Hj.url,name:Hj.name()})});Gf=[];Mf=[];ph=[];uh=$jscomp.makeIterator(Wf);for(Oe=uh.next();!Oe.done;Oe=uh.next())Ch=Oe.value,Ch.type.startsWith("image/")?Gf.push(Ch):Ch.type.startsWith("video")?Mf.push(Ch):ph.push(Ch);if(!Mf.length){vf.jumpTo(11);
break}Nf=$jscomp.makeIterator(Mf);Xf=Nf.next();case 12:if(Xf.done){vf.jumpTo(11);break}Qg=Xf.value;xe=Object;Jh=xe.assign;return vf.yield(xa.loadObjectFromPartsbinFolder("video morph"),15);case 15:Jh.call(xe,vf.yieldResult,{videoURL:Qg.url,name:Qg.name}).openInWorld();Xf=Nf.next();vf.jumpTo(12);break;case 11:Gf.length&&Gf.forEach(function(Bi){var Hj=new xa.Image({imageUrl:Bi.url,autoResize:!0,name:Bi.name});Hj.whenLoaded().then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cl){if(1==
Cl.nextAddress)return Hj.extent=Hj.naturalExtent.scaleBy(.8*Ba.visibleBounds().height/Hj.height),Hj.openInWorld(),Cl.yield(Hj.whenRendered(),2);Hj.center=Ba.visibleBounds().center();Cl.jumpToEnd()})})});if(!ph.length){vf.jumpTo(16);break}Vb=$jscomp.makeIterator(ph);Pc=Vb.next();case 17:if(Pc.done){vf.jumpTo(16);break}ud=Pc.value;return vf.yield(Ba.confirm("open file "+ud.name+" ("+ud.type+")?"),20);case 20:(Ld=vf.yieldResult)&&Ba.execCommand("open file",{url:ud.url});Pc=Vb.next();vf.jumpTo(17);break;
case 16:vf.leaveTryBlock(10);break;case 9:mf=vf.enterCatchBlock(),Ba.showError(mf);case 10:return vf.return();case 2:pf=tb.dataTransfer.types;if(!pf.includes("text/html")){vf.jumpTo(21);break}rg=tb.dataTransfer.getData("text/html");Gj=(new xa.DOMParser).parseFromString(rg,"text/html");qj=Gj.querySelectorAll("img");if(1===qj.length&&qj[0].src&&pf.includes("text/uri-list")){rj=qj[0].src;zl=new xa.Image({imageUrl:rj,autoResize:!0,name:xa.arr.last(rj.split("/"))});zl.whenLoaded().then(function(){return zl.openInWorld()});
vf.jumpTo(22);break}Rj=Object;Al=Rj.assign;return vf.yield(xa.loadObjectFromPartsbinFolder("html-morph"),23);case 23:Al.call(Rj,vf.yieldResult,{html:rg}).openInWorld();case 22:return vf.return();case 21:bl=0;case 24:if(!(bl<tb.dataTransfer.items.length)){vf.jumpTo(0);break}Bl=tb.dataTransfer.items[bl];if("file"!==Bl.kind){"string"===Bl.kind&&Bl.getAsString(function(Bi){return xa.inspect(Bi)});vf.jumpTo(25);break}Sj=Bl.getAsFile();return vf.yield(Ba.confirm("Upload "+Sj.name+"?"),28);case 28:ci=vf.yieldResult;
if(!ci){vf.jumpTo(25);break}return vf.yield(xa.uploadFile(Sj,Sj.type),30);case 30:(nk=vf.yieldResult)&&nk.openInWorld(),nk.center=Ba.visibleBounds().center();case 25:bl++,vf.jumpTo(24)}})}},{key:"menuItems",value:function(){var fa=this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",target:this},{command:"fix font metric",target:this},{command:"inspect server",target:this}]],["Tools",[{command:"open javascript workspace",
target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",target:this,tooltip:"Opens a workspace like interface\nthat allows you to trigger shell comands\nvia select + eval by pressing either "+(new xa.Text).keysForCommand("doit")+" or "+(new xa.Text).keysForCommand("printit")},{command:"open shell terminal",target:this,tooltip:"Opens a classic remote shell interface,\nthat allows you to send commands to a\nbash session running on the server.\nAlso comes with advanced git support."},
{command:"open workspace",args:{askForMode:!0},target:this}]],{isDivider:!0},{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Exported Components",[["Toggle Select All",function(){0==fa.getListedComponents().length?fa.hiddenComponents=[]:fa.hiddenComponents=fa.withAllSubmorphsSelect(function(Ba){return Ba.isComponent}).map(function(Ba){return Ba.name})}]].concat($jscomp.arrayFromIterable(this.withAllSubmorphsSelect(function(Ba){return Ba.isComponent}).map(function(Ba){var Na=
fa.hiddenComponents.includes(Ba.name);return[[].concat($jscomp.arrayFromIterable(xa.Icon.textAttribute(Na?"square":"check-square")),["  "+Ba.name,{}]),function(){fa.hiddenComponents=Na?xa.arr.without(fa.hiddenComponents,Ba.name):[Ba.name].concat($jscomp.arrayFromIterable(fa.hiddenComponents))}]})))],["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return fa.resizePolicy=
"elastic"}]]:[["switch to manual resizing of world",function(){return fa.resizePolicy="static"}]]],["Troubleshooting",[{command:"report a bug",target:this},{command:"clear storage and reload",target:this}]],{isDivider:!0},["Windows",[{command:"toggle minimize all windows",target:this},{command:"close all windows",target:this}]],{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function(fa,Ba){var Na=this.env.eventDispatcher.eventState;
Na.menu&&Na.menu.remove();return Na.menu=Ba&&Ba.length?xa.Menu.openAtHand(Ba,{hand:fa&&fa.hand||this.firstHand}):null}},{key:"onPaste",value:function(fa){var Ba=this,Na,tb,Sb,lc,uc,rc,$c,Jd,je,td,qe,Wd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ud){switch(Ud.nextAddress){case 1:Ud.setCatchFinallyBlocks(2,3);tb=fa.domEvt.clipboardData;if(!tb.types.includes("application/morphic")){Ud.jumpTo(3);break}fa.stop();Sb=JSON.parse(tb.getData("application/morphic"));lc=[];Array.isArray(Sb)||
(Sb=[Sb]);Na=xa.LoadingIndicator.open("pasting morphs...");uc=$jscomp.makeIterator(Sb);rc=uc.next();case 6:if(rc.done){Ud.jumpTo(8);break}$c=rc.value;return Ud.yield(xa.loadMorphFromSnapshot($c),9);case 9:Jd=Ud.yieldResult;Jd.openInWorld(fa.hand.position);$c.copyMeta&&$c.copyMeta.offset&&(je=$c.copyMeta.offset,td=je.x,qe=je.y,Jd.moveBy(xa.pt(td,qe)));lc.push(Jd);rc=uc.next();Ud.jumpTo(6);break;case 8:Ba.showHaloFor(lc);case 3:Ud.enterFinallyBlock();Na&&Na.remove();Ud.leaveFinallyBlock(0);break;case 2:Wd=
Ud.enterCatchBlock(),Ba.showError(Wd),Ud.jumpTo(3)}})}},{key:"commands",get:function(){return xa.worldCommands.concat(vc._get(Object.getPrototypeOf(ob.prototype),"commands",this)).concat([{name:"open in prototype box",exec:function(fa,Ba){var Na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){if(1==tb.nextAddress)return tb.yield(xa.loadPart("prototype box"),2);Na=tb.yieldResult;Na.wrapProto(Ba.target);tb.jumpToEnd()})}}])}},{key:"keybindings",get:function(){return vc._get(Object.getPrototypeOf(ob.prototype),
"keybindings",this).concat(xa.config.globalKeyBindings)}},{key:"keybindings",set:function(fa){vc._set(Object.getPrototypeOf(ob.prototype),"keybindings",fa,this)}},{key:"halos",value:function(){return this.submorphs.filter(function(fa){return fa.isHalo})}},{key:"haloForPointerId",value:function(fa){return this.submorphs.find(function(Ba){return Ba.isHalo&&Ba.state&&Ba.state.pointerId===fa})}},{key:"showHaloFor",value:function(fa,Ba,Na){Ba=void 0===Ba?this.firstHand&&this.firstHand.pointerId:Ba;Na=
void 0===Na?!0:Na;if(xa.Halo)return fa="function"===typeof fa.createHalo?fa.createHalo(xa.Halo,Ba):new xa.Halo({pointerId:Ba,target:fa}),this.addMorph(fa),Na&&fa.focus(),fa.alignWithTarget(),fa}},{key:"showHaloForSelection",value:function(fa,Ba){return 0<fa.length&&this.showHaloFor(fa,Ba)}},{key:"layoutHaloForPointerId",value:function(fa){fa=void 0===fa?this.firstHand&&this.firstHand.pointerId:fa;return this.submorphs.find(function(Ba){return Ba.isLayoutHalo&&Ba.state&&Ba.state.pointerId===fa})}},
{key:"showLayoutHaloFor",value:function(fa,Ba){Ba=void 0===Ba?this.firstHand&&this.firstHand.pointerId:Ba;var Na=fa===this?null:fa.owner===this?fa:fa.ownerChain().slice(-2)[0];Na=Na?this.submorphs.indexOf(Na)+1:this.submorphs.length;switch(fa.layout.constructor){case xa.ProportionalLayout:var tb=new xa.ProportionalLayoutHalo({container:fa,pointerId:Ba});break;case xa.HorizontalLayout:case xa.VerticalLayout:tb=new xa.FlexLayoutHalo({container:fa,pointerId:Ba});break;case xa.GridLayout:tb=new xa.GridLayoutHalo({container:this.container,
pointerId:Ba})}return tb&&this.addMorphAt(tb,Na)}},{key:"highlightMorph",value:function(fa,Ba,Na,tb){tb=void 0===tb?[]:tb;return xa.MorphHighlighter.for(fa,Ba,void 0===Na?!1:Na,tb)}},{key:"removeHighlighters",value:function(fa){return xa.MorphHighlighter.removeHighlighters(void 0===fa?this:fa)}},{key:"visibleStatusMessages",value:function(){return this.submorphs.filter(function(fa){return fa.isStatusMessage})}},{key:"visibleStatusMessagesFor",value:function(fa){return this.submorphs.filter(function(Ba){return Ba.isStatusMessage&&
Ba.targetMorph===fa})}},{key:"logErrorPreperation",value:function(fa){var Ba=String(fa),Na=fa.stack||"";Na&&fa.message!==fa.stack&&(Na=String(Na),0===Na.indexOf(Ba)&&(Na=Na.slice(Ba.length)),Ba+="\n"+Na);return Ba}},{key:"logError",value:function(fa){this.setStatusMessage(this.logErrorPreperation(fa),xa.Color.red)}},{key:"showError",value:function(fa){return this.logError(fa)}},{key:"showErrorFor",value:function(fa,Ba){return this.setStatusMessageFor(fa,this.logErrorPreperation(Ba),xa.Color.red)}},
{key:"setStatusMessageFor",value:function(fa,Ba,Na,tb,Sb){tb=void 0===tb?5E3:tb;if(xa.StatusMessageForMorph){this.visibleStatusMessagesFor(fa).forEach(function(lc){return lc.remove()});Ba=new xa.StatusMessageForMorph(Object.assign({message:Ba,color:Na},Sb));this.openStatusMessage(Ba,tb);Ba.targetMorph=fa;Ba.fadeIn(300);if(Ba.removeOnTargetMorphChange&&fa.isText)xa.once(fa,"selectionChange",Ba,"fadeOut",{converter:function(){return 200},garbageCollect:!0});return Ba}}},{key:"setStatusMessage",value:function(fa,
Ba,Na,tb){Na=void 0===Na?5E3:Na;tb=void 0===tb?{}:tb;if(xa.StatusMessage)return console[Ba==xa.Color.red?"error":"log"](fa),xa.config.verboseLogging?this.openStatusMessage(new xa.StatusMessage(Object.assign({message:fa,color:Ba,hasFixedPosition:!0},tb)),Na):null}},{key:"openStatusMessage",value:function(fa,Ba){this.addMorph(fa);if(fa.slidable){for(var Na=this.visibleStatusMessages(),tb=$jscomp.makeIterator(Na),Sb=tb.next();!Sb.done;Sb=tb.next()){Sb=Sb.value;if(Na.length<=(xa.config.maxStatusMessages||
0))break;!Sb.stayOpen&&Sb.slidable&&(Sb.remove(),xa.arr.remove(Na,Sb))}xa.arr.without(Na,fa).forEach(function(lc){return $jscomp.asyncExecutePromiseGeneratorProgram(function(uc){!lc.isMaximized&&lc.slidable&&lc.slideTo(lc.position.addPt(xa.pt(0,-fa.extent.y-10)));uc.jumpToEnd()})});Na=this.visibleBounds().bottomRight().addXY(-20,-20);fa.align(fa.bounds().bottomRight(),Na);fa.topRight=Na.addPt(xa.pt(0,40));fa.animate({bottomRight:Na,duration:500})}"number"===typeof Ba&&setTimeout(function(){return fa.stayOpen||
fa.fadeOut()},Ba);return fa}},{key:"addProgressBar",value:function(fa){fa=void 0===fa?{}:fa;var Ba=this,Na,tb,Sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){if(1==lc.nextAddress)return Na=fa,tb=void 0===Na.location?"center":Na.location,lc.yield(xa.loadObjectFromPartsbinFolder("progress bar"),2);Sb=lc.yieldResult;Object.assign(Sb,{progress:0},xa.obj.dissoc(fa,["location"]));Ba.addMorph(Sb);Sb.align(Sb[tb],Ba.visibleBounds()[tb]());return lc.return(Sb)})}},{key:"withProgressBarDo",
value:function(fa,Ba){var Na=this,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){switch(Sb.nextAddress){case 1:return Sb.yield(Na.addProgressBar(Ba),2);case 2:return tb=Sb.yieldResult,Sb.setFinallyBlock(3),Sb.yield(fa(tb),5);case 5:return Sb.return(Sb.yieldResult);case 3:Sb.enterFinallyBlock(),tb.remove(),Sb.leaveFinallyBlock(0)}})}},{key:"openPrompt",value:function(fa,Ba){Ba=void 0===Ba?{requester:null,animated:!1}:Ba;var Na=this,tb,Sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){tb=
Na.focusedMorph;Sb=Na.visibleBounds();return lc.return(Na.withRequesterDo(Ba.requester,function(uc){return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){fa.openInWorldNear(uc,Na);fa.height>Sb.height&&(fa.height=Sb.height-5);"function"===typeof Ba.customize&&Ba.customize(fa);Ba.animated&&Na.previousPrompt&&Na.previousPrompt.world()&&Na.previousPrompt.transitionTo(fa);Na.previousPrompt=fa;return rc.return(xa.promise.finally(fa.activate(Ba),function(){return tb&&tb.focus()}))})}))})}},{key:"withRequesterDo",
value:function(fa,Ba){var Na=this,tb,Sb,lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(uc){switch(uc.nextAddress){case 1:Sb=Na.visibleBounds().center();if(!fa){uc.jumpTo(2);break}Sb=fa.globalBounds().center();fa.isWorld&&(Sb=fa.visibleBounds().center());if(!(tb=fa.getWindow())){uc.jumpTo(2);break}return uc.yield(tb.toggleFader(!0),4);case 4:Sb=tb.globalBounds().center();case 2:return uc.yield(Ba(Sb),5);case 5:return lc=uc.yieldResult,tb&&tb.toggleFader(!1),uc.return(lc)}})}},{key:"inform",
value:function(fa,Ba){Ba=void 0===Ba?{fontSize:16,requester:null,animated:!0}:Ba;return this.openPrompt(new xa.InformPrompt(Object.assign({label:void 0===fa?"no message":fa},Ba)),Ba)}},{key:"prompt",value:function(fa,Ba){Ba=void 0===Ba?{requester:null,input:"",historyId:null,useLastInput:!1,selectInput:!1}:Ba;fa=new xa.TextPrompt(Object.assign({label:fa},Ba));Ba.forceConfirm&&fa.get("cancel button").disable();return this.openPrompt(fa,Ba)}},{key:"editPrompt",value:function(fa,Ba){Ba=void 0===Ba?{requester:null,
input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null}:Ba;return this.openPrompt(new xa.EditPrompt(Object.assign({label:fa},Ba)),Ba)}},{key:"passwordPrompt",value:function(fa,Ba){Ba=void 0===Ba?{requester:null,input:""}:Ba;return this.openPrompt(new xa.PasswordPrompt(Object.assign({label:fa},Ba)),Ba)}},{key:"confirm",value:function(fa,Ba){Ba=void 0===Ba?{requester:null,animated:!0}:Ba;return this.openPrompt(new xa.ConfirmPrompt(Object.assign({label:fa},Ba)),Ba)}},{key:"multipleChoicePrompt",
value:function(fa,Ba){Ba=void 0===Ba?{requester:null,animated:!0,choices:[]}:Ba;return this.openPrompt(new xa.MultipleChoicePrompt(Object.assign({label:fa},Ba)),Ba)}},{key:"listPrompt",value:function(fa,Ba,Na){fa=void 0===fa?"":fa;Ba=void 0===Ba?[]:Ba;Na=void 0===Na?{requester:null,onSelection:null,preselect:0}:Na;return this.openPrompt(new xa.ListPrompt(Object.assign({filterable:!1,padding:xa.Rectangle.inset(3),label:fa,items:Ba},Na)),Na)}},{key:"filterableListPrompt",value:function(fa,Ba,Na){fa=
void 0===fa?"":fa;Ba=void 0===Ba?[]:Ba;Na=void 0===Na?{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"}:Na;return Na.prompt?(fa=Na.prompt.get("list"),fa.items=Ba,fa.selectedIndex=Na.preselect||0,this.openPrompt(Na.prompt,Na)):this.openPrompt(new xa.ListPrompt(Object.assign({filterable:!0,padding:xa.Rectangle.inset(3),label:fa,items:Ba},Na)),Na)}},{key:"editListPrompt",value:function(fa,Ba,Na){Ba=void 0===
Ba?[]:Ba;Na=void 0===Na?{requester:null,multiSelect:!0,historyId:null}:Na;return this.openPrompt(new xa.EditListPrompt(Object.assign({label:void 0===fa?"":fa,multiSelect:!0,items:Ba,padding:xa.Rectangle.inset(3)},Na)),Na)}},{key:"showLoadingIndicatorFor",value:function(fa,Ba){return this.addMorph(xa.LoadingIndicator.open(Ba,{center:fa.globalBounds().center()}))}},{key:"defaultMenuItems",value:function(fa,Ba){function Na(td){var qe=this,Wd=Sb.morphsContainingPoint(uc.worldPoint(xa.pt(0,0)));Wd.pop();
var Ud=Wd.indexOf(uc);Wd=Wd.slice(Ud+1);return Wd.map(function(Re){return[String(Re),td.bind(qe,Re)]})}var tb=this,Sb=this,lc=[],uc=fa;this.reset&&"function"===typeof this.reset&&lc.push(["Reset",function(){tb.reset()}]);lc.push(["Open in...",[["Window",function(){uc.openInWindow()}]]]);lc.push(["Add morph to...",{getItems:Na.bind(uc,function(td){return td.addMorph(uc)})}]);lc.push(["Get halo on...",{getItems:Na.bind(uc,function(td){return td.world().showHaloFor(td)})}]);uc.owner&&1<uc.owner.submorphs.length&&
lc.push(["Arrange morph",[["Bring to front",function(){return uc.owner.addMorph(uc)}],["Send to back",function(){return uc.owner.addMorphBack(uc)}],["Fit to submorphs",function(){var td,qe,Wd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ud){if(1==Ud.nextAddress)return Ud.yield(uc.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:uc}),2);if(3!=Ud.nextAddress)return td=Ud.yieldResult,"string"!==typeof td?
Ud.return():Ud.yield(xa.runEval(td,{topLevelVarRecorder:{Rectangle:xa.Rectangle}}),3);qe=Ud.yieldResult;td=(Wd=qe.value)&&Wd.isRectangle?Wd:xa.Rectangle.inset(0);uc.undoStart("fitToSubmorphs");uc.fitToSubmorphs(td);uc.undoStop("fitToSubmorphs");Ud.jumpToEnd()})}]].concat($jscomp.arrayFromIterable(xa.PropertyPath("master.auto").get(uc)?[["Adjust to Master Component Submorph Hierarchy",function(){return uc.master.reconcileSubmorphs()}]]:[]))]);this.submorphs.length&&lc.push(["Select all submorphs",
function(){return uc.world().showHaloFor(uc.submorphs.slice())}]);var rc=[];uc.startSteppingScripts?rc.push(["Start stepping",function(){uc.startSteppingScripts()}]):rc.push(["Start stepping",function(){var td,qe,Wd,Ud,Re,wf,Bf,Wf,Gf,Mf,ph,uh,Oe,Ch,Nf,Xf,Qg,xe,Jh,Vb,Pc,ud,Ld,mf,pf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rg){switch(rg.nextAddress){case 1:return td=[],qe=$jscomp,Wd=qe.makeIterator,rg.yield(xa.completions.getCompletions(function(){return uc},""),2);case 2:Ud=Wd.call(qe,
rg.yieldResult.completions);for(Re=Ud.next();!Re.done;Re=Ud.next())for(wf=Re.value,Bf=$jscomp.makeIterator(wf),Wf=Bf.next().value,Gf=Bf.next().value,Mf=$jscomp.makeIterator(Gf),ph=Mf.next();!ph.done;ph=Mf.next())uh=ph.value,uh.startsWith("_")||uh.startsWith("$")||(Oe=$jscomp.makeIterator(uh.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[]),Oe.next(),Ch=Oe.next().value,Nf=Oe.next().value,Ch&&"function"===typeof uc[Ch]&&td.push({isListItem:!0,string:Wf+" "+uh,value:{selector:Ch,args:Nf}}));return rg.yield($world.filterableListPrompt("Select method to start",
td,{requester:uc,historyId:"lively.morphic-start-stepping-chooser"}),3);case 3:return Xf=rg.yieldResult,Qg=$jscomp.makeIterator(Xf.selected),(xe=Qg.next().value)?rg.yield($world.prompt("Steptime in ms (how of the method will be called)?",{input:100}),4):rg.return();case 4:Jh=rg.yieldResult;Jh=Number(Jh);if(isNaN(Jh))return rg.return();Vb=[Jh,xe.selector];if(!xe.args){rg.jumpTo(5);break}Pc={targetModule:"lively://lively.morphic-stepping-args/eval.js"};return rg.yield($world.editPrompt("Arguments to pass",
{input:"["+xe.args+"]",mode:"js",evalEnvironment:Pc}),6);case 6:return ud=rg.yieldResult,rg.yield(xa.runEval(ud,Pc),7);case 7:Ld=rg.yieldResult;mf=Ld.value;if(pf=Ld.isError)return $world.inform("Error evaluating the arguments: "+mf),rg.return();Array.isArray(mf)&&Vb.push.apply(Vb,$jscomp.arrayFromIterable(mf));case 5:uc.startStepping.apply(uc,$jscomp.arrayFromIterable(Vb)),rg.jumpToEnd()}})}]);0!=uc.tickingScripts.length&&rc.push(["Stop stepping",function(){return uc.stopStepping()}]);0!=rc.length&&
lc.push(["Stepping",rc]);lc.push(["Change Tooltip",function(){var td;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qe){if(1==qe.nextAddress)return td=uc,qe.yield(uc.world().prompt("Enter Tooltip",{placeholder:"Description",input:uc.tooltip||""}),2);td.tooltip=qe.yieldResult;qe.jumpToEnd()})}]);var $c=["Morphic properties",[]];lc.push($c);lc.push(["display serialization info",function(){var td,qe,Wd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ud){if(1==Ud.nextAddress)return Ud.yield(System.import("lively.serializer2/debugging.js"),
2);td=Ud.yieldResult;qe=td.SnapshotInspector;Wd=xa.serialize(uc);qe.forSnapshot(Wd).openSummary();Ud.jumpToEnd()})}]);lc.push(["display object report",function(){var td,qe,Wd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ud){if(1==Ud.nextAddress)return Ud.yield(System.import("lively.serializer2/debugging.js"),2);td=Ud.yieldResult;qe=td.SnapshotInspector;Wd=xa.serialize(uc);qe.forSnapshot(Wd).openObjectReport();Ud.jumpToEnd()})}]);var Jd=xa.Icon.textAttribute("check-square"),je=xa.Icon.textAttribute("square");
Object.assign(Jd[1],{float:"none",display:"inline"});["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(td){return $c[1].push([[].concat($jscomp.arrayFromIterable(fa[td]?Jd:je),[" "+td,{float:"none"}]),function(){return fa[td]=!fa[td]}])});lc.push(["export to HTML",function(){var td,qe,Wd,Ud;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Re){if(1==Re.nextAddress)return Re.yield(System.import("lively.morphic/rendering/html-generator.js"),2);if(3!=Re.nextAddress)return td=
Re.yieldResult,qe=td.generateHTML,Wd=xa.HTMLMorph,Ud="exported-"+fa.name,Re.yield(qe(fa,null,{isFragment:!0,addStyles:!1}),3);(new Wd({name:Ud,html:Re.yieldResult})).openInWorld();Re.jumpToEnd()})}]);lc.push({isDivider:!0});lc.push(["Add comment",function(){var td,qe,Wd,Ud;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Re){if(1==Re.nextAddress)return Re.yield($world.prompt("Enter comment"),2);if(4!=Re.nextAddress){td=Re.yieldResult;if(!td)return $world.setStatusMessage("Comment not saved",
"red"),Re.jumpTo(0);qe=xa.pt(0,0);Ba&&!Ba.halo&&(Wd=uc.localize(Ba.position).x/uc.width,Ud=uc.localize(Ba.position).y/uc.height,qe=xa.pt(Wd,Ud));return Re.yield(uc.addComment(td,qe),4)}$world.setStatusMessage("Comment saved","green");Re.jumpToEnd()})}]);return lc}},{key:"defaultConnectionMenuItems",value:function(fa){return fa.attributeConnections&&fa.attributeConnections.length?fa.attributeConnections.map(function(Ba){return[String(Ba),[["show",function(){var Na,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){if(1==
Sb.nextAddress)return Sb.yield(System.import("lively.ide/fabrik.js"),2);Na=Sb.yieldResult;tb=Na.interactivelyShowConnection;tb(Ba);Sb.jumpToEnd()})}],["edit",function(){var Na,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){if(1==Sb.nextAddress)return Sb.yield(System.import("lively.ide/fabrik.js"),2);Na=Sb.yieldResult;tb=Na.interactivelyReEvaluateConnection;tb(Ba);Sb.jumpToEnd()})}],["disconnect",function(){Ba.disconnect();$world.setStatusMessage("disconnected "+Ba)}]]]}):null}},
{key:"defaultSourceDataBindings",value:function(fa){var Ba=fa.propertiesAndPropertySettings().properties,Na=xa.arr.groupByKey(Object.keys(Ba).map(function(Sb){Sb=Object.assign({name:Sb},Ba[Sb]);return Sb.group&&Sb.group.startsWith("_")?null:Sb}).filter(Boolean),"group");fa=["core","geometry","interaction","styling","layouting"];var tb=[];fa.forEach(function(Sb){return tb.push(Na[Sb])});xa.arr.withoutAll(Na.keys(),fa).forEach(function(Sb){return tb.push(Na[Sb])});return tb}},{key:"targetDataBindings",
value:function(fa){for(var Ba=[],Na=fa;Na!==Object.prototype;){var tb=Na===fa?String(this):xa.getClassName(Na),Sb=null,lc=xa.obj.getOwnPropertyDescriptors(Na),uc=Object.getPrototypeOf(Na),rc;for(rc in lc){var $c=lc[rc].value;"function"!==typeof $c||$c===Na.constructor||rc.startsWith("$")||rc.startsWith("_")||(Sb||(Sb=[]),$c=xa.fun.argumentNames($c),Sb.push({group:tb+" methods",signature:rc+"("+$c.join(", ")+")",name:rc}))}Sb&&Ba.push(Sb);Na=uc}return this.defaultSourceDataBindings(fa).concat(Ba)}},
{key:"defaultConnectMenuItems",value:function(fa,Ba){var Na=this,tb=this.defaultSourceDataBindings(Ba),Sb=Ba.world();tb=tb.map(function(lc){return[lc[0].group||"uncategorized",lc.map(function(uc){return[uc.name,fa?function(){return fa(uc.name,Ba,uc)}:function(){var rc,$c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jd){if(1==Jd.nextAddress)return Jd.yield(System.import("lively.ide/fabrik.js"),2);rc=Jd.yieldResult;$c=rc.interactiveConnectGivenSource;$c(Ba,uc.name);Jd.jumpToEnd()})}]})]});
Sb&&tb.push(["custom...",fa?function(){return fa("custom...",Ba,null)}:function(){var lc,uc,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){if(1==$c.nextAddress)return $c.yield(System.import("lively.ide/fabrik.js"),2);if(3!=$c.nextAddress)return lc=$c.yieldResult,uc=lc.interactiveConnectGivenSource,$c.yield(Sb.prompt("Enter custom connection point",{requester:Ba,historyId:"lively.morphic-custom-connection-points",useLastInput:!0}),3);(rc=$c.yieldResult)&&uc(Na,rc);$c.jumpToEnd()})}]);
return tb}},{key:"updateVisibleWindowMorphs",value:function(){var fa=this;vc._get(Object.getPrototypeOf(ob.prototype),"updateVisibleWindowMorphs",this).call(this);this.halos().forEach(function(Ba){Ba.maskBounds=fa.visibleBounds()})}},{key:"handleHaloCycle",value:function(fa){var Ba=fa.state.clickedOnMorph,Na=fa.isCommandKey(),tb=fa.isShiftDown(),Sb;Na&&!Ba.isHalo&&(Na=Sb=fa.world.morphsContainingPoint(fa.position),Sb=Sb.filter(function(lc){return lc.halosEnabled}),Na=Na.filter(function(lc){return lc.halosEnabled}),
Sb=Na[0]||Sb[0]);tb&&!Ba.isHaloItem&&Sb&&fa.halo&&fa.halo.borderBox!=Sb?fa.halo.addMorphToSelection(Sb):(Ba=fa.halo&&!fa.targetMorphs.find(function(lc){return lc.isHaloItem||lc.keepHalo&&lc.keepHalo(fa)}),tb=fa.layoutHalo&&!fa.targetMorphs.find(function(lc){return lc.isHaloItem}),Na=(!fa.halo||Ba)&&Sb,tb&&fa.layoutHalo.remove(),Ba&&fa.halo.remove(),Na&&(fa.stop(),this.showHaloFor(Sb,fa.domEvt.pointerId)))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyWorld"}},{key:"properties",
get:function(){return{localComponents:{initialize:function(){var fa=this;this.whenRendered().then(function(){fa.localComponents?fa.localComponents.forEach(function(Ba){var Na,tb,Sb,lc,uc,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){switch($c.nextAddress){case 1:if(Ba.owner){$c.jumpTo(0);break}Na=Ba.withAllSubmorphsSelect(function(Jd){return Jd.master&&!Jd.master._appliedMaster});tb=$jscomp.makeIterator(Na);Sb=tb.next();case 3:if(Sb.done){$c.jumpTo(5);break}lc=Sb.value;return $c.yield(lc.master.applyIfNeeded(!0),
4);case 4:Sb=tb.next();$c.jumpTo(3);break;case 5:uc=fa.withAllSubmorphsSelect(function(Jd){return Jd.master&&Jd.master.uses(Ba)}),rc=fa.localComponents.filter(function(Jd){return Jd.master&&Jd.master.uses(Ba)}),uc.forEach(function(Jd){Jd.requestMasterStyling()}),rc.forEach(function(Jd){return Jd.master.applyIfNeeded(!0)}),$c.jumpToEnd()}})}):fa.localComponents=fa.withAllSubmorphsSelect(function(Ba){return Ba.isComponent})})}},name:{set:function(fa){this.setProperty("name",fa);document.title="lively.next - "+
fa}},hiddenComponents:{initialize:function(){this.hiddenComponents=[]}},fill:{defaultValue:xa.Color.rgb(81,90,90)},draggable:{readOnly:!0,get:function(){return!xa.touchInputDevice}},commentBrowser:{}}}}],S,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1664,end:42380})}(xa.World);xa.LivelyWorld=
$d;xa.LivelyWorld=$d;xa.LivelyWorld=$d;Wa=Ka("a",function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),ob=S.hasOwnProperty("SelectionElement")&&"function"===typeof S.SelectionElement?S.SelectionElement:S.SelectionElement=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SelectionElement"}},{key:"properties",get:function(){return{borderColor:{defaultValue:xa.Color.red},
borderWidth:{defaultValue:1},fill:{defaultValue:xa.Color.transparent},epiMorph:{defaultValue:!0},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],S,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42389,end:42751})}(xa.Morph));xa.SelectionElement=Wa;xa.SelectionElement=Wa;xa.SelectionElement=
Wa;Gb=Ka("S",function(Ha){var S=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),ob=S.hasOwnProperty("Selection")&&"function"===typeof S.Selection?S.Selection:S.Selection=function(fa){fa&&fa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return vc(ob,Ha,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Selection"}},{key:"properties",get:function(){return{fill:{defaultValue:xa.Color.gray.withA(.2)},borderWidth:{defaultValue:2},
borderColor:{defaultValue:xa.Color.gray},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],S,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42760,end:43080})}(xa.Morph));xa.Selection=Gb;xa.Selection=Gb;xa.Selection=Gb;$d=Object.freeze({__proto__:null,LivelyWorld:$d,SelectionElement:Wa,
Selection:Gb});Ka("w",$d)}}});