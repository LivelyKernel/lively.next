System.register(["./__root_module__-3c9a1ccb.js","kld-intersections"],function(sa){var lb,Eb,Wb,Qb,Bd,Fc,wd,Kc,Gc,Yc,jd,Dd,od;return{setters:[function(Zc){lb=Zc.bs;Eb=Zc.a4;Wb=Zc.r;Qb=Zc.a5;Bd=Zc.bm;Fc=Zc.bt;wd=Zc.bu;Kc=Zc.T;Gc=Zc.s;Yc=Zc.bv;jd=Zc.bw;Dd=Zc.n;od=Zc.bx},function(){}],execute:function(){function Zc(I){try{var T=eval("("+ma.ast.transform.wrapInFunction("var _; _ = ("+I+")")+")()")}catch(ta){return JSON.parse(I)}return"object"!==typeof T?null:T}function Ra(I,T){var ta,Ca,Mb,vb,Ia,
Rb,Jc,Rc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){switch(Fa.nextAddress){case 1:return ta=T.world(),Fa.yield(ta.prompt("Enter package name",{requester:T,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:Ca=Fa.yieldResult;if(!Ca)throw"Canceled";Fa.setCatchFinallyBlocks(3);vb=La.resource(Ca);Ca=vb.name();Mb=vb.url;Fa.leaveTryBlock(4);break;case 3:return Fa.enterCatchBlock(),Fa.yield(I.getConfig(),5);case 5:return Ia=Fa.yieldResult.baseURL,Rb=
La.resource(Ia).join(Ca).asDirectory().url,Fa.yield(I.normalize(Rb),6);case 6:Mb=Fa.yieldResult.replace(/\/\.js$/,"/");case 4:return Fa.yield(ta.prompt("Confirm or change package location",{requester:T,input:Mb,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Jc=Fa.yieldResult;if(!Jc)throw"Canceled";Rc=La.resource(Jc).asDirectory();xc=Rc.asFile().url;return Fa.yield(I.removePackage(xc),8);case 8:return Fa.yield(I.resourceCreateFiles(xc,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
Ca+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+Ca+"\n\nNo description for package "+Ca+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+Ca+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Fa.return(La.loadPackage(I,{name:Ca,address:xc,configFile:Rc.join("package.json").url,main:Rc.join("index.js").url,test:Rc.join("tests/test.js").url,type:"package"}))}})}function tb(I,T,ta){ta=void 0===ta?
null:ta;var Ca,Mb,vb,Ia,Rb,Jc,Rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xc){switch(xc.nextAddress){case 1:return Ca={name:"",address:"",type:"package"},xc.yield(I.getConfig(),2);case 2:Mb=xc.yieldResult;if(!ta){xc.jumpTo(3);break}return xc.yield(I.getPackage(ta),4);case 4:if(vb=xc.yieldResult){xc.jumpTo(5);break}return xc.yield(I.getPackageForModule(ta),6);case 6:vb=xc.yieldResult;case 5:Ia=vb;case 3:return xc.yield(T.world().prompt("What is the package directory?",{requester:T,
input:Ia?Ia.address:Mb.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Rb=xc.yieldResult;if(!Rb)throw"Canceled";Ca.address=Rb.replace(/\/$/,"");Ca.url=new URL(Ca.address+"/");Ca.configFile=La.resource(Ca.url).join("package.json").url;xc.setCatchFinallyBlocks(8);Jc=JSON;Rc=Jc.parse;return xc.yield(I.moduleRead(Ca.configFile),10);case 10:Rc.call(Jc,xc.yieldResult).name;xc.leaveTryBlock(9);break;case 8:xc.enterCatchBlock(),Ca.name=String(Ca.url).replace(/\/$/,""),
I.resourceEnsureExistance(Ca.configFile,'{\n  "name": "'+Ca.name+'",\n  "version": "0.1.0"\n}');case 9:return xc.return(La.loadPackage(I,Ca))}})}function dc(I,T,ta){var Ca,Mb,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){switch(Ia.nextAddress){case 1:return Ca=La.resource(ta).asFile().url,Ia.yield(I.getPackage(Ca),2);case 2:if(Mb=Ia.yieldResult){Ia.jumpTo(3);break}return Ia.yield(I.getPackageForModule(Ca),4);case 4:Mb=Ia.yieldResult;case 3:vb=Mb;if(!vb)throw Error("Cannot find package for "+
Ca);return Ia.yield(I.reloadPackage(Ca),5);case 5:if(!T){Ia.jumpTo(0);break}return Ia.yield(T.updateModuleList(),7);case 7:return Ia.yield(T.uiSelect(Ca,!1),8);case 8:return Ia.return(Ia.yieldResult)}})}function bc(I,T,ta,Ca){var Mb,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){switch(Ia.nextAddress){case 1:return Ia.yield(I.getPackage(ta),2);case 2:return Mb=Ia.yieldResult,Ia.yield((Ca||$world).confirm("Unload package "+Mb.name+"?",{requester:T}),3);case 3:vb=Ia.yieldResult;
if(!vb)throw"Canceled";return Ia.yield(I.removePackage(ta),4);case 4:if(!T){Ia.jumpTo(0);break}return Ia.yield(T.updateModuleList(),6);case 6:return Ia.yield(T.uiSelect(null),0)}})}function Xc(I,T,ta){var Ca,Mb,vb,Ia,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jc){switch(Jc.nextAddress){case 1:return Ca=T.world(),Jc.yield(I.getPackage(ta),2);case 2:return Mb=Jc.yieldResult,Mb?Jc.yield(Ca.confirm("Really remove package "+Mb.name+"?",{requester:T}),3):($world.inform('No package "'+
ta+'" found!',{requester:T}),Jc.return());case 3:vb=Jc.yieldResult;if(!vb)throw"Canceled";I.removePackage(ta);return Jc.yield(Ca.confirm("Also remove directory "+Mb.name+" including "+Mb.modules.length+" modules?"),4);case 4:Ia=Jc.yieldResult;if(!Ia){Jc.jumpTo(0);break}return Jc.yield(Ca.confirm("REALLY *remove* directory "+Mb.name+"? No undo possible..."),6);case 6:if(Rb=Jc.yieldResult)return Jc.yield(I.resourceRemove(Mb.address),0);Jc.jumpTo(0)}})}function Oc(I,T,ta){ta=void 0===ta?$world:ta;var Ca,
Mb,vb,Ia,Rb,Jc,Rc,xc,Fa,nc,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){switch(Pa.nextAddress){case 1:return Pa.yield(I.getPackage(T),2);case 2:Ca=Pa.yieldResult;if(!Ca)throw Error("Cannot find package "+T);Mb=[];vb=$jscomp.makeIterator(Ca.modules);Ia=vb.next();case 3:if(Ia.done)return Pa.yield(ta.execCommand("open text window",{title:"imports and exports of "+T,content:Mb.join("\n\n")}),0);Rb=Ia.value;if(!Rb.name.match(/\.js$/)){Pa.jumpTo(4);break}Pa.setCatchFinallyBlocks(6);
Jc=I;Rc=Jc.importsAndExportsOf;xc=Rb.name;return Pa.yield(I.moduleRead(Rb.name),9);case 9:return Pa.yield(Rc.call(Jc,xc,Pa.yieldResult),8);case 8:Fa=Pa.yieldResult;Pa.leaveTryBlock(7);break;case 6:nc=Pa.enterCatchBlock();ta.logError(Error("Error when getting imports/exports from module "+Rb.name+":\n"+nc.stack));Pa.jumpTo(4);break;case 7:$a=""+Rb.name;if(!Fa.imports.length&&!Fa.exports.length){$a+="\n  does not import / export anything";Pa.jumpTo(4);break}Fa.imports.length&&($a+="\n  imports:\n",
$a+=La.arr.groupByKey(Fa.imports,"fromModule").mapGroups(function(Oa,Kb){return"from "+Oa+": "+Kb.map(function(Ib){return Ib.local||Ib.imported?Ib.imported&&Ib.imported!==Ib.local?Ib.imported+" as "+Ib.local:Ib.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(Oa){return"    "+Oa}).join("\n"));Fa.exports.length&&($a+="\n  exports:\n",$a+=Fa.exports.map(function(Oa){return Oa.local?Oa.local&&Oa.local!==Oa.exported?Oa.local+" as "+Oa.exported:Oa.exported:Oa.exported+
" from "+Oa.fromModule}).join(", ").split("\n").map(function(Oa){return"    "+Oa}).join("\n"));Mb.push($a);case 4:Ia=vb.next(),Pa.jumpTo(3)}})}function $b(I,T,ta){ta=ta&&ta.address;if(ta&&0===T.indexOf(ta))var Ca=T.slice(ta.length).replace(/^\//,"");else a:{ta=I.getConfig();if(!ta||ta.constructor!==Promise)try{Ca=String((new URL(T)).relativePathFrom(new URL(I.getConfig().baseURL)));break a}catch(Mb){}Ca=T}return Ca}function zc(I,T,ta,Ca){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mb){return 1==
Mb.nextAddress?(Ca=Object.assign({targetModule:T},Ca),Mb.yield(I.normalize(T),2)):3!=Mb.nextAddress?(T=Mb.yieldResult,Mb.yield(I.moduleSourceChange(T,ta,Ca),3)):Mb.return(T)})}function Fb(I,T,ta,Ca,Mb){Ca=void 0===Ca?!1:Ca;Mb=void 0===Mb?!1:Mb;var vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){switch(Ia.nextAddress){case 1:return T&&T.setStatusMessage("Reloading "+ta),Ia.setCatchFinallyBlocks(2),Ia.yield(I.reloadModule(ta,{reloadDeps:Ca,resetEnv:Mb}),4);case 4:if(!T){Ia.jumpTo(5);
break}return Ia.yield(T.updateModuleList(),6);case 6:case 5:T&&T.setStatusMessage("Reloded "+ta);Ia.leaveTryBlock(0);break;case 2:vb=Ia.enterCatchBlock();Ia.setCatchFinallyBlocks(7);if(!T){Ia.jumpTo(9);break}return Ia.yield(T.updateEditorWithSourceOf(ta),10);case 10:case 9:Ia.leaveTryBlock(8);break;case 7:Ia.enterCatchBlock();case 8:throw T&&T.showError(vb),vb;}})}function Cb(I,T,ta){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){switch(Ca.nextAddress){case 1:return Ca.yield(I.forgetModule(ta,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!T){Ca.jumpTo(3);break}return Ca.yield(T.updateModuleList(),4);case 4:case 3:Ca.jumpToEnd()}})}function pc(I,T,ta){var Ca,Mb,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){switch(Ia.nextAddress){case 1:return Ia.yield(I.normalize(ta),2);case 2:return Ca=Ia.yieldResult,Ia.yield(T.world().confirm("Remove file "+Ca+"?",{requester:T}),3);case 3:Mb=Ia.yieldResult;if(!Mb)throw"Canceled";return Ia.yield(I.forgetModule(Ca),4);case 4:return Ia.yield(I.resourceRemove(Ca),
5);case 5:return Ia.yield(I.getPackageForModule(Ca),6);case 6:return vb=Ia.yieldResult,Ia.return(vb)}})}function Pc(I,T,ta){var Ca,Mb,vb,Ia,Rb,Jc,Rc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){switch(Fa.nextAddress){case 1:return Ca=URL,Fa.yield(I.getConfig(),2);case 2:Mb=new Ca(Fa.yieldResult.baseURL);vb=T.world();if(!ta){Fa.jumpTo(3);break}return Fa.yield(I.getPackage(ta),4);case 4:if(Ia=Fa.yieldResult){Fa.jumpTo(5);break}return Fa.yield(I.getPackageForModule(ta),6);case 6:Ia=
Fa.yieldResult;case 5:(Rb=Ia)&&(Mb=new URL(Rb.address));case 3:return Fa.yield(fb._searchForExistingFiles(T,String(Mb),Rb),7);case 7:Jc=Fa.yieldResult;if(!Jc.includes("[create new module]")){Fa.jumpTo(8);break}return Fa.yield(fb._askForModuleName(I,ta||String(Mb),vb),9);case 9:Rc=Fa.yieldResult,Jc=[Rc];case 8:return Fa.yield(fb._createAndLoadModules(I,Jc),10);case 10:return xc=Fa.yieldResult,fb.arr.compact(xc.map(function(nc){return nc.error})),Fa.return(xc)}})}function wb(I,T){var ta,Ca,Mb,vb,Ia,
Rb,Jc,Rc,xc,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nc){if(1==nc.nextAddress)return nc.yield(I.getPackage(T),2);if(3!=nc.nextAddress){ta=nc.yieldResult;if(!ta||!ta.address.match(/^http/))throw Error("Cannot load package "+T);Ca=fb.resource(ta.address);Mb=[];vb=$jscomp;Ia=vb.makeIterator;return nc.yield(Ca.dirList(5,{exclude:fb.modulesInPackage_defaultExclude}),3)}Rb=Ia.call(vb,nc.yieldResult);for(Jc=Rb.next();!Jc.done;Jc=Rb.next())xc=Rc=Jc.value,Fa=xc.url,Fa.match(/\.js$/)&&
I.isModuleLoaded(Fa,!0)&&Mb.push(I.getModule(Fa));return nc.return(Mb)})}function db(I,T){T=void 0===T?[]:T;var ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==Ca.nextAddress)return Ca.yield(System.import("mocha-es6/index.js"),2);ta=Ca.yieldResult;return Ca.return(ta.loadTestModuleAndExtractTestState(I,T))})}function Ta(I,T,ta,Ca){function Mb(nc){return new Promise(function($a,Pa){var Oa=pb.arr.compact(nc.suite.suites).map(function(Ib){return Ib.file}),Kb=pb.chain(T).filter(function(Ib){return Oa.includes(Ib.file)}).pluck("tests").flatten().value();
if(!Kb||!Kb.length)return Pa(Error("Trying to run tests of "+Oa.join(", ")+" but cannot find them in loaded tests!"));nc.reporter(function(Ib){Ib.on("test",function(bd){try{var Od=Kb.find(function(Zd){return Zd.fullTitle===bd.fullTitle()});Od.state="running";"function"===typeof ta&&ta(Od,"test")}catch(Zd){"function"===typeof Ca&&Ca(Zd,"test")}});Ib.on("pass",function(bd){try{var Od=Kb.find(function(Zd){return Zd.fullTitle===bd.fullTitle()});Od.state="succeeded";Od.duration=bd.duration;"function"===
typeof ta&&ta(Od,"pass")}catch(Zd){"function"===typeof Ca&&Ca(Zd,"pass")}});Ib.on("fail",function(bd,Od){try{var Zd=function(Xd,kd,Bb){Xd.state="failed";Xd.duration=Xd.duration;Xd.error=kd},Te=Kb.find(function(Xd){return Xd.fullTitle===bd.fullTitle()});if(Te)Zd(Te,Od,bd.duration);else{var Qc=pb.arr.invoke(bd.parent.tests,"fullTitle");Kb.filter(function(Xd){return Qc.includes(Xd.fullTitle)}).forEach(function(Xd){return Zd(Xd,Od,bd.duration)})}"function"===typeof ta&&ta(Te,"fail")}catch(Xd){"function"===
typeof Ca&&Ca(Xd,"fail")}})});nc.run(function(Ib){return $a({testsByFile:T,mocha:nc})})})}var vb,Ia,Rb,Jc,Rc,xc,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nc){switch(nc.nextAddress){case 1:vb=$jscomp.makeIterator(T),Ia=vb.next();case 2:if(Ia.done){nc.jumpTo(4);break}Jc=Rb=Ia.value;Rc=Jc.file;return nc.yield(pb.loadMochaTestFile(Rc,T),5);case 5:return xc=nc.yieldResult,Fa=xc.mocha,I&&(Fa=Fa.grep(I)),nc.yield(Mb(Fa),3);case 3:Ia=vb.next();nc.jumpTo(2);break;case 4:return nc.return({mocha:Fa,
testsByFile:T})}})}function cb(I){I||(I="local");if(I.isSystemInterface)var T=I;else"string"===typeof I&&I.startsWith("l2l ")&&(I={type:"l2l",id:I.split(" ")[1]}),"string"!==typeof I&&"l2l"===I.type&&(T=wc.l2lInterfaceFor(I.id,I.info)),"string"!==typeof I&&($world.setStatusMessage("Unknown system interface "+I),I="local"),T||(T=I&&"local"!==I?wc.serverInterfaceFor(I):wc.localInterface);return T}sa("systemInterfaceNamed",cb);var ma=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
ma.parseJsonLikeObj=Zc;ma.ast=lb;ma.parseJsonLikeObj=Zc;ma.parseJsonLikeObj=Zc;var La=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");La.loadPackage=function(I,T){var ta,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mb){switch(Mb.nextAddress){case 1:return Mb.yield(I.importPackage(T.address+"/"),2);case 2:if(!T.main){Mb.jumpTo(3);break}return Mb.yield(I.importModule(T.main.toString()),3);case 3:if(!T.test){Mb.jumpTo(5);break}Mb.setCatchFinallyBlocks(6);
return Mb.yield(I.importPackage("mocha-es6"),8);case 8:return ta=Mb.yieldResult,Mb.yield(ta.installSystemInstantiateHook(),9);case 9:return Mb.yield(I.importModule(T.test.toString()),10);case 10:Mb.leaveTryBlock(5);break;case 6:Ca=Mb.enterCatchBlock(),console.warn("Cannot load test of new package: "+Ca);case 5:return Mb.return(I.getPackage(T.address))}})};La.interactivelyCreatePackage=Ra;La.interactivelyLoadPackage=tb;La.interactivelyReloadPackage=dc;La.interactivelyUnloadPackage=bc;La.interactivelyRemovePackage=
Xc;La.showExportsAndImportsOf=Oc;La.parseJsonLikeObj=Zc;La.arr=Eb;La.resource=Wb;La.interactivelyCreatePackage=Ra;La.interactivelyCreatePackage=Ra;La.interactivelyLoadPackage=tb;La.interactivelyLoadPackage=tb;La.interactivelyReloadPackage=dc;La.interactivelyReloadPackage=dc;La.interactivelyUnloadPackage=bc;La.interactivelyUnloadPackage=bc;La.interactivelyRemovePackage=Xc;La.interactivelyRemovePackage=Xc;La.showExportsAndImportsOf=Oc;La.showExportsAndImportsOf=Oc;var fb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
fb.shortModuleName=$b;fb.interactivelyChangeModule=zc;fb.interactivelyReloadModule=Fb;fb.interactivelyUnloadModule=Cb;fb.interactivelyRemoveModule=pc;fb.interactivelyAddModule=Pc;fb._askForModuleName=function(I,T,ta){var Ca,Mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){switch(vb.nextAddress){case 1:return vb.yield(ta.prompt("Enter module name",{input:T,historyId:"lively.vm-editor-add-module-name"}),2);case 2:T=vb.yieldResult;if(!T)throw"Canceled";return vb.yield(I.normalize(T),
3);case 3:return Ca=vb.yieldResult,vb.yield(ta.confirm(["Create module \n",{},Ca,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Mb=vb.yieldResult;if(!Mb)throw"Canceled";return vb.return(Ca)}})};fb._searchForExistingFiles=function(I,T,ta){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){return String(T).match(/^http/)?Ca.return(fb._searchForExistingFilesWeb(I,T,ta)):Ca.return(fb._searchForExistingFilesManually(I,T,ta))})};fb._searchForExistingFilesManually=function(I,T,ta){var Ca,
Mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){switch(vb.nextAddress){case 1:return vb.yield(I.world().multipleChoicePrompt("Add Module",{requester:I,choices:["Create New Module","Load Existing Module"]}),2);case 2:Ca=vb.yieldResult;if("Create New Module"===Ca)return vb.return("[create new module]");if("Load Existing Module"!==Ca){vb.jumpTo(3);break}return vb.yield(I.world().prompt("URL of module?",{input:T,requester:I,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(Mb=vb.yieldResult)return vb.return([Mb]);case 3:throw"Canceled";}})};fb._searchForExistingFilesWeb=function(I,T,ta){function Ca(xc){xc.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(xc.name())||ta&&fb.arr.pluck(ta.modules,"name").includes(xc.url)?!0:!1}var Mb,vb,Ia,Rb,Jc,Rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xc){switch(xc.nextAddress){case 1:return(Mb=I.world())&&(vb=Mb.showLoadingIndicatorFor(I,"Loading existing modules...")),
xc.yield(fb.resource(T).dirList(5,{exclude:Ca}),3);case 3:return xc.yield(xc.yieldResult.map(function(Fa){return Fa.url}),2);case 2:return Ia=xc.yieldResult,Rb=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Ia.filter(function(Fa){return Fa.endsWith(".js")}).map(function(Fa){return{isListItem:!0,string:ta&&0==Fa.indexOf(ta.address)?ta.name+Fa.slice(ta.address.length):Fa,value:Fa}})),xc.yield(Promise.resolve(vb&&vb.remove()).then(function(){return I.world().filterableListPrompt("What module to load?",
Rb,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:I},I?{extent:I.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Jc=xc.yieldResult;if(!Jc||"canceled"===Jc.status||!Jc.selected.length)throw"Canceled";Rc=Jc.selected||Jc;Array.isArray(Rc)||(Rc=[Rc]);return xc.return(Rc)}})};fb._createAndLoadModules=function(I,T){var ta,Ca,Mb,vb,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){switch(Rb.nextAddress){case 1:Array.isArray(T)||(T=[T]),ta=[],Ca=$jscomp.makeIterator(T),
Mb=Ca.next();case 2:if(Mb.done){Rb.jumpTo(4);break}vb=Mb.value;return Rb.yield(I.forgetModule(vb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return Rb.yield(I.resourceEnsureExistance(vb,'"format esm";\n'),6);case 6:return Rb.setCatchFinallyBlocks(7),Rb.yield(I.importModule(vb),9);case 9:ta.push({name:vb});Rb.leaveTryBlock(3);break;case 7:Ia=Rb.enterCatchBlock(),ta.push({name:vb,error:Ia});case 3:Mb=Ca.next();Rb.jumpTo(2);break;case 4:return Rb.return(ta)}})};fb.modulesInPackage_defaultExclude=function(I){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(I.name())?!0:!1};fb.modulesInPackage=wb;fb.obj=Qb;fb.arr=Eb;fb.resource=Wb;fb.shortModuleName=$b;fb.shortModuleName=$b;fb.interactivelyChangeModule=zc;fb.interactivelyChangeModule=zc;fb.interactivelyReloadModule=Fb;fb.interactivelyReloadModule=Fb;fb.interactivelyUnloadModule=Cb;fb.interactivelyUnloadModule=Cb;fb.interactivelyRemoveModule=pc;fb.interactivelyRemoveModule=pc;fb.interactivelyAddModule=Pc;fb.interactivelyAddModule=Pc;
fb.modulesInPackage=wb;fb.modulesInPackage=wb;var pb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");pb.loadMochaTestFile=db;pb.runMochaTests=Ta;pb.arr=Eb;pb.chain=Bd;pb.loadMochaTestFile=db;pb.loadMochaTestFile=db;pb.runMochaTests=Ta;pb.runMochaTests=Ta;var xb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");xb.todo=function(I){throw Error(I+" is not yet implemented!");};xb.parseJsonLikeObj=Zc;xb.arr=Eb;xb.Closure=Fc;xb.obj=
Qb;xb.resource=Wb;xb.transform=wd;xb.modules=Kc;var Wa=function(){};Wa.prototype.dynamicCompletionsForPrefix=function(I,T,ta){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){xb.todo("dynamicCompletionsForPrefix");Ca.jumpToEnd()})};Wa.prototype.runEval=function(I,T){xb.todo("runEval")};Wa.prototype.resourceExists=function(I){xb.todo("resourceExists")};Wa.prototype.resourceEnsureExistance=function(I,T){xb.todo("resourceEnsureExistance")};Wa.prototype.resourceMkdir=function(I){xb.todo("resourceMkdir")};
Wa.prototype.resourceRead=function(I){xb.todo("resourceRead")};Wa.prototype.resourceRemove=function(I){xb.todo("resourceRemove")};Wa.prototype.resourceWrite=function(I,T){xb.todo("resourceWrite")};Wa.prototype.resourceCreateFiles=function(I,T){xb.todo("resourceCreateFiles")};Wa.prototype.resourceDirList=function(I,T,ta){xb.todo("resourceDirList")};Wa.prototype.normalizeSync=function(I,T,ta){xb.todo("normalizeSync")};Wa.prototype.normalize=function(I,T,ta){xb.todo("normalize")};Wa.prototype.printSystemConfig=
function(){xb.todo("printSystemConfig")};Wa.prototype.getConfig=function(){xb.todo("getConfig")};Wa.prototype.setConfig=function(I){xb.todo("setConfig")};Wa.prototype.getPackages=function(I){xb.todo("getPackages")};Wa.prototype.isModuleLoaded=function(I,T){xb.todo("isModuleLoaded")};Wa.prototype.doesModuleExist=function(I,T){xb.todo("doesModuleExist")};Wa.prototype.getModules=function(){var I=this,T,ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){return 1==Ca.nextAddress?(T=xb.arr,
ta=T.flatmap,Ca.yield(I.getPackages(),2)):Ca.return(ta.call(T,Ca.yieldResult,function(Mb){return Mb.modules}))})};Wa.prototype.getModule=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return 1==ta.nextAddress?ta.yield(T.getModules(),2):ta.return(ta.yieldResult.find(function(Ca){return Ca.name===I}))})};Wa.prototype.getPackage=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return 1==ta.nextAddress?(I=I.replace(/\/+$/,""),
ta.yield(T.getPackages(),2)):ta.return(ta.yieldResult.find(function(Ca){return Ca.address===I||Ca.name===I}))})};Wa.prototype.getPackageForModule=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){xb.todo("getPackageForModule");T.jumpToEnd()})};Wa.prototype.systemConfChange=function(I){var T=xb.parseJsonLikeObj(I);["baseURL"].forEach(function(ta){return delete T[ta]});return this.setConfig(T)};Wa.prototype.resourcesOfPackage=function(I,T){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){xb.todo("resourcesOfPackage");
ta.jumpToEnd()})};Wa.prototype.registerPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){xb.todo("registerPackage");T.jumpToEnd()})};Wa.prototype.importPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){xb.todo("importPackage");T.jumpToEnd()})};Wa.prototype.removePackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){xb.todo("removePackage");T.jumpToEnd()})};Wa.prototype.reloadPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){xb.todo("reloadPackage");
T.jumpToEnd()})};Wa.prototype.packageConfChange=function(I,T){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){xb.todo("packageConfChange");ta.jumpToEnd()})};Wa.prototype.importModule=function(I){xb.todo("importModule")};Wa.prototype.forgetModule=function(I,T){xb.todo("forgetModule")};Wa.prototype.reloadModule=function(I,T){xb.todo("reloadModule")};Wa.prototype.moduleFormat=function(I){xb.todo("moduleFormat")};Wa.prototype.moduleRead=function(I){xb.todo("moduleRead")};Wa.prototype.moduleSourceChange=
function(I,T,ta){xb.todo("moduleSourceChange")};Wa.prototype.importsAndExportsOf=function(I,T){xb.todo("importsAndExportsOf")};Wa.prototype.keyValueListOfVariablesInModule=function(I,T){xb.todo("keyValueListOfVariablesInModule")};Wa.prototype.moduleWrite=function(I,T){return this.moduleSourceChange(I,T)};xb.AbstractCoreInterface=Wa;var Xa=function(){var I=xb.AbstractCoreInterface.call(this)||this;I.currentEval=null;return I};$jscomp.inherits(Xa,xb.AbstractCoreInterface);Xa.prototype.runEval=function(I,
T){throw Error("Not yet implemented");};Xa.prototype.runEvalAndStringify=function(I,T){var ta=this;return this.currentEval?this.currentEval.then(function(){return ta.runEvalAndStringify(I,T)}):this.currentEval=Promise.resolve().then(function(){var Ca,Mb,vb,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){switch(Rb.nextAddress){case 1:return Rb.yield(ta.runEval("\n        Promise.resolve((async "+xb.transform.wrapInFunction(I)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},T)),2);case 2:if((Ca=Rb.yieldResult)&&Ca.isError)throw Error(String(Ca.value||Ca.error));if(!Ca||!Ca.value)return Rb.return(null);if(Mb=Ca.promisedValue){Rb.jumpTo(3);break}return Rb.yield(Ca.value,4);case 4:Mb=Rb.yieldResult;case 3:vb=Mb;if(!vb)return Rb.return();if("undefined"===vb)return Rb.return(void 0);if("null"===vb)return Rb.return(null);if("true"===vb)return Rb.return(!0);
if("false"===vb)return Rb.return(!1);try{Ia=JSON.parse(vb)}catch(Jc){return Rb.return(vb)}if(Ia&&Ia.isError)throw Error(String(Ia.value));return Rb.return(Ia)}})}).then(function(Ca){delete ta.currentEval;return Ca},function(Ca){delete ta.currentEval;return Promise.reject(Ca)})};Xa.prototype.dynamicCompletionsForPrefix=function(I,T,ta){var Ca=this,Mb,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){Mb=xb.obj.isString(ta.context)?ta.context:!1;ta=xb.obj.dissoc(ta,["systemInterface",
"System","context"]);vb="\n      var prefix = "+JSON.stringify(T)+",\n          opts = "+JSON.stringify(ta)+";\n      opts.context = "+Mb+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Ia.return(Ca.runEvalAndStringify(vb))})};Xa.prototype.evalWithResource=function(I,T,ta){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+I+'").'+T+"("+(ta?JSON.stringify(ta):"")+");\n    ")};Xa.prototype.resourceExists=function(I){return this.evalWithResource(I,"exists")};Xa.prototype.resourceEnsureExistance=function(I,T){return this.evalWithResource(I,
"ensureExistance",T)};Xa.prototype.resourceMkdir=function(I){return this.evalWithResource(I,"mkdir")};Xa.prototype.resourceRead=function(I){return this.evalWithResource(I,"read")};Xa.prototype.resourceRemove=function(I){return this.evalWithResource(I,"remove")};Xa.prototype.resourceWrite=function(I,T){return this.evalWithResource(I,"write",T)};Xa.prototype.resourceCreateFiles=function(I,T){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
I+'", '+JSON.stringify(T)+")")};Xa.prototype.resourceDirList=function(I,T,ta){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+I+'").dirList('+JSON.stringify(T)+", "+JSON.stringify(ta)+"))\n        .map(({url}) => ({url}))")};Xa.prototype.livelySystemAccessor=function(I){I=void 0===I?"livelySystem":I;return"var "+I+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
I+') throw new Error("lively-system-interface not available!");'};Xa.prototype.normalizeSync=function(I,T,ta){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(I)+", "+JSON.stringify(T)+", "+ta+")")};Xa.prototype.normalize=function(I,T,ta){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(I)+", "+JSON.stringify(T)+", "+JSON.stringify(ta)+")")};Xa.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
Xa.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};Xa.prototype.setConfig=function(I){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(I)+")")};Xa.prototype.getPackages=function(I){I=Object.assign({excluded:[]},I);I.excluded=I.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(I)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};Xa.prototype.getPackageForModule=function(I){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(I)+")")};Xa.prototype.isModuleLoaded=function(I,T){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+I+'", '+T+")")};Xa.prototype.doesModuleExist=function(I,T){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+I+'", '+T+")")};Xa.prototype.registerPackage=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return ta.return(T.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(I)+")"))})};Xa.prototype.importPackage=
function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return ta.return(T.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(I)+")"))})};Xa.prototype.removePackage=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return ta.return(T.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(I)+")"))})};Xa.prototype.reloadPackage=function(I,T){var ta=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){return Ca.return(ta.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(I)+", "+JSON.stringify(T)+")"))})};Xa.prototype.packageConfChange=function(I,T){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(I)+", "+JSON.stringify(T)+")")};Xa.prototype.resourcesOfPackage=function(I,T){T=void 0===T?[".git","node_modules",".module_cache","lively.next-node_modules"]:T;var ta=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){I.address&&(I=I.address);
return Ca.return(ta.runEvalAndStringify("\n      "+ta.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(I)+", "+JSON.stringify(T)+");"))})};Xa.prototype.getModule=function(I){var T=this,ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==Ca.nextAddress)return Ca.yield(T.getModules(),2);ta=Ca.yieldResult.find(function(Mb){return Mb.name===I});return Ca.return(ta?xb.modules.module(ta.name):null)})};Xa.prototype.importModule=function(I){return this.runEvalAndStringify("lively.modules.System.import("+
JSON.stringify(I)+")")};Xa.prototype.forgetModule=function(I,T){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").unload("+JSON.stringify(T)+")")};Xa.prototype.reloadModule=function(I,T){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").reload("+JSON.stringify(T)+")")};Xa.prototype.moduleFormat=function(I){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").format();")};Xa.prototype.moduleRead=function(I){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(I)+").source()")};Xa.prototype.moduleSourceChange=function(I,T,ta){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").changeSource("+JSON.stringify(T)+", "+JSON.stringify(ta)+")")};Xa.prototype.keyValueListOfVariablesInModule=function(I,T){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+JSON.stringify(I)+", "+JSON.stringify(T)+")")};Xa.prototype.importsAndExportsOf=
function(I,T){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(I)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(I)+").exports()})")};Xa.prototype.exportsOfModules=function(I){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(I)+";\n      options.excludedPackages = ["+I.excludedPackages.map(function(T){return"function"===typeof T?T.toString():JSON.stringify(T)}).join(",")+
"]\n      await livelySystem.localInterface.exportsOfModules(options)")};Xa.prototype.searchInPackage=function(I,T,ta){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(I)+", "+JSON.stringify(T)+", "+JSON.stringify(ta)+")")};Xa.prototype.loadMochaTestFile=function(I,T){T=void 0===T?[]:T;var ta=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){return Ca.return(ta.runEvalAndStringify("\n      "+
ta.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(I)+", "+JSON.stringify(T)+"), result;\n      result = {testsByFile}"))})};Xa.prototype.runMochaTests=function(I,T,ta,Ca){var Mb=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){I&&I instanceof RegExp&&(I={isRegExp:!0,value:String(I).replace(/^\/|\/$/g,"")});return vb.return(Mb.runEvalAndStringify("\n      var grep = "+JSON.stringify(I)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Mb.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(T||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
xb.RemoteCoreInterface=Xa;var Ab=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Ab.obj=Qb;Ab.string=Gc;Ab.arr=Eb;Ab.resource=Wb;Ab.createFiles=Yc;Ab.ast=lb;Ab.modules=Kc;Ab.vm=jd;Ab.loadMochaTestFile=db;Ab.runMochaTests=Ta;Ab.parseJsonLikeObj=Zc;Ab.AbstractCoreInterface=Wa;Ab.classToFunctionTransform=Dd;Wa=function(){return Ab.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(Wa,Ab.AbstractCoreInterface);Wa.prototype.dynamicCompletionsForPrefix=
function(I,T,ta){var Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mb){if(1==Mb.nextAddress)return Mb.yield(Ab.vm.completions.getCompletions(function(vb){return Ab.vm.runEval(vb.replace("return ",""),Object.assign({targetModule:I,classTransform:Ab.classToFunctionTransform},ta))},T),2);Ca=Mb.yieldResult;if(Ca.isError)throw Ca.value;return Mb.return({completions:Ca.completions,prefix:Ca.startLetters})})};Wa.prototype.runEval=function(I,T){return Ab.vm.runEval(I,Object.assign({classTransform:Ab.classToFunctionTransform},
T))};Wa.prototype.resourceExists=function(I){return Ab.resource(I).exists()};Wa.prototype.resourceEnsureExistance=function(I,T){return Ab.resource(I).ensureExistance(T)};Wa.prototype.resourceMkdir=function(I){return Ab.resource(I).mkdir()};Wa.prototype.resourceRead=function(I){return Ab.resource(I).read()};Wa.prototype.resourceRemove=function(I){return Ab.resource(I).remove()};Wa.prototype.resourceWrite=function(I,T){return Ab.resource(I).write(T)};Wa.prototype.resourceCreateFiles=function(I,T){return Ab.createFiles(I,
T)};Wa.prototype.resourceDirList=function(I,T,ta){return Ab.resource(I).dirList(T,ta)};Wa.prototype.normalizeSync=function(I,T,ta){return System.decanonicalize(I,T,ta)};Wa.prototype.normalize=function(I,T,ta){return System.normalize(I,T,ta)};Wa.prototype.printSystemConfig=function(){return Ab.modules.printSystemConfig()};Wa.prototype.getConfig=function(){return System.getConfig()};Wa.prototype.setConfig=function(I){Ab.modules.System.config(I)};Wa.prototype.getPackages=function(I){I=Object.assign({},
I);I=void 0===I.excluded?[]:I.excluded;var T=I.filter(function(Ca){return"string"===typeof Ca}),ta=I.filter(function(Ca){return"function"===typeof Ca});T=T.concat(T.map(function(Ca){return System.decanonicalize(Ca.replace(/\/?$/,"/")).replace(/\/$/,"")}));return Ab.modules.getPackages().filter(function(Ca){return!T.includes(Ca.url)&&!ta.some(function(Mb){return Mb(Ca.url)})})};Wa.prototype.registerPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){return T.return(Ab.modules.registerPackage(I))})};
Wa.prototype.importPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){return T.return(Ab.modules.importPackage(I))})};Wa.prototype.removePackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){return T.return(Ab.modules.removePackage(I))})};Wa.prototype.reloadPackage=function(I,T){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ta){return ta.return(Ab.modules.reloadPackage(I,T))})};Wa.prototype.packageConfChange=function(I,T){var ta=
this,Ca,Mb,vb,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){if(1==Rb.nextAddress)return Ca=Ab.modules.System,Mb=Ab.parseJsonLikeObj(I),vb=JSON.stringify(Mb,null,2),Rb.yield(Ab.modules.module(T).changeSource(vb,{doEval:!1}),2);if(3!=Rb.nextAddress)return Ca.set(T,Ca.newModule(Mb)),Rb.yield(ta.getPackageForModule(T),3);(Ia=Rb.yieldResult)&&Ab.modules.applyPackageConfig(Mb,Ia.address);Rb.jumpToEnd()})};Wa.prototype.resourcesOfPackage=function(I,T){T=void 0===T?[".git","node_modules",
".module_cache"]:T;var ta,Ca,Mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){if(1==vb.nextAddress)return vb.setCatchFinallyBlocks(2),ta=I.address?I.address:I,Ca=Ab.modules.getPackage(ta),vb.yield(Ca.resources(void 0,T),4);if(2!=vb.nextAddress)return vb.return(vb.yieldResult.map(function(Ia){return Object.assign(Ia,{package:Ia.package.url})}));Mb=vb.enterCatchBlock();console.warn("resourcesOfPackage error for "+I+": "+Mb);return vb.return([])})};Wa.prototype.getPackageForModule=
function(I){return(I=Ab.modules.getPackageOfModule(I))?I.asSpec():I};Wa.prototype.isModuleLoaded=function(I,T){return Ab.modules.isModuleLoaded(I,T)};Wa.prototype.doesModuleExist=function(I,T){return Ab.modules.isModuleLoaded(I,T)};Wa.prototype.getModule=function(I){return Ab.modules.module(I)};Wa.prototype.importModule=function(I){return Ab.modules.System.import(I)};Wa.prototype.forgetModule=function(I,T){return Ab.modules.module(I).unload(T)};Wa.prototype.reloadModule=function(I,T){return Ab.modules.module(I).reload(T)};
Wa.prototype.moduleFormat=function(I){return Ab.modules.module(I).format()};Wa.prototype.moduleRead=function(I){return Ab.modules.module(I).source()};Wa.prototype.moduleSourceChange=function(I,T,ta){return Ab.modules.module(I).changeSource(T,ta)};Wa.prototype.keyValueListOfVariablesInModule=function(I,T){var ta=this,Ca,Mb,vb,Ia,Rb,Jc,Rc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){switch(Fa.nextAddress){case 1:if(T){Fa.jumpTo(2);break}return Fa.yield(ta.resourceRead(I),3);case 3:T=
Fa.yieldResult;case 2:return Ca="string"===typeof T?Ab.ast.parse(T):T,Mb=ta.normalizeSync(I),ta.moduleFormat(Mb),vb=Ab.modules.module(Mb).env().recorder,Fa.yield(ta.importsAndExportsOf(Mb,Ca),4);case 4:return Ia=Fa.yieldResult,Rb=Ab.ast.query.topLevelDeclsAndRefs(Ca),Jc=Ab.arr.sortByKey(Ab.ast.query.declarationsOfScope(Rb.scope,!0),"start"),Rc=Ab.arr.pluck(Rb.scope.importSpecifiers,"name"),xc=0,Fa.return(Jc.map(function(nc){var $a=nc.name.length,Pa=Ia.exports.find(function(Kb){return Kb.local===nc.name}),
Oa=Ab.arr.include(Rc,nc.name);Pa&&($a+=9);Oa&&($a+=9);xc=Math.max(xc,$a);return{isExport:Pa,isImport:Oa,name:nc.name,value:vb[nc.name],node:nc,printedName:nc.name+(Pa?" [export]":"")+(Oa?" [import]":""),printedValue:Ab.obj.inspect(vb[nc.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(nc){return{isListItem:!0,value:nc,string:nc.printedName+Ab.string.indent(" = "+nc.printedValue," ",xc-nc.printedName.length)}}))}})};Wa.prototype.importsAndExportsOf=function(I,T){var ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){return 1==
Ca.nextAddress?Ca.yield(Ab.modules.module(I).imports(T),2):3!=Ca.nextAddress?(ta=Ca.yieldResult,Ca.yield(Ab.modules.module(I).exports(T),3)):Ca.return({imports:ta,exports:Ca.yieldResult})})};Wa.prototype.exportsOfModules=function(I){return Ab.modules.ExportLookup.run(System,I)};Wa.prototype.searchInPackage=function(I,T,ta){return Ab.modules.getPackage(I).search(T,ta)};Wa.prototype.runMochaTests=function(I,T,ta,Ca){return Ab.runMochaTests(I,T,ta,Ca)};Wa.prototype.loadMochaTestFile=function(I,T){return Ab.loadMochaTestFile(I,
T)};$jscomp.global.Object.defineProperties(Wa.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});Ab.LocalCoreInterface=Wa;var kc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");kc.evalStrategies=od;kc.RemoteCoreInterface=Xa;var Ub=function(I){var T=kc.RemoteCoreInterface.call(this)||this;T.currentEval=null;T.url=I;T.server=new kc.evalStrategies.HttpEvalStrategy(I);return T};$jscomp.inherits(Ub,kc.RemoteCoreInterface);Ub.prototype.runEval=
function(I,T){return this.server.runEval(I,T)};$jscomp.global.Object.defineProperties(Ub.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});kc.HTTPCoreInterface=Ub;var qc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");qc.evalStrategies=od;qc.RemoteCoreInterface=Xa;Xa=function(I,T){var ta=qc.RemoteCoreInterface.call(this)||this;
ta.targetId=I;ta.peer=T;return ta};$jscomp.inherits(Xa,qc.RemoteCoreInterface);Xa.prototype.isConnected=function(){var I=this,T,ta,Ca,Mb,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){if(1==Ia.nextAddress)return T=I,ta=T.client,Ca=T.targetId,Ia.yield(ta.sendToAndWait(ta.trackerId,"getClients",{}),2);Mb=Ia.yieldResult;vb=Mb.data;return Ia.return(vb.some(function(Rb){Rb=$jscomp.makeIterator(Rb).next().value;return Ca===Rb}))})};Xa.prototype.runEval=function(I,T){var ta=this,Ca,Mb;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){Ca=ta.client;if(!Ca)throw Error("No lively.2lively default client available!");Mb=new qc.evalStrategies.L2LEvalStrategy(Ca,ta.targetId);return vb.return(Mb.runEval(I,T))})};$jscomp.global.Object.defineProperties(Xa.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var I=this.peer,T="l2l "+this.targetId.slice(0,5);if(I){var ta=I.location,
Ca=I.type,Mb=I.user;I=I.world;Ca&&(T+=", "+Ca);ta&&(T+=", "+ta.replace(/^https?:\/\//,"")+(I?"/"+I:""));Mb&&(T+=", "+Mb.name)}return T}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});qc.L2LCoreInterface=Xa;var wc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");wc.systemInterfaceNamed=cb;wc.interactivelyCreatePackage=Ra;wc.interactivelyLoadPackage=tb;wc.interactivelyReloadPackage=
dc;wc.interactivelyUnloadPackage=bc;wc.interactivelyRemovePackage=Xc;wc.showExportsAndImportsOf=Oc;wc.shortModuleName=$b;wc.interactivelyChangeModule=zc;wc.interactivelyReloadModule=Fb;wc.interactivelyUnloadModule=Cb;wc.interactivelyRemoveModule=pc;wc.interactivelyAddModule=Pc;wc.modulesInPackage=wb;wc.LocalCoreInterface=Wa;wc.HTTPCoreInterface=Ub;wc.L2LCoreInterface=Xa;Xa=function(I){this.coreInterface=I};Xa.prototype.dynamicCompletionsForPrefix=function(I,T,ta){return this.coreInterface.dynamicCompletionsForPrefix(I,
T,ta)};Xa.prototype.runEval=function(I,T){return this.coreInterface.runEval(I,T)};Xa.prototype.printSystemConfig=function(I,T,ta){return this.coreInterface.printSystemConfig(I,T,ta)};Xa.prototype.getConfig=function(I,T,ta){return this.coreInterface.getConfig(I,T,ta)};Xa.prototype.getPackages=function(I){return this.coreInterface.getPackages(I)};Xa.prototype.getModules=function(I,T,ta){return this.coreInterface.getModules(I,T,ta)};Xa.prototype.getModule=function(I,T,ta){return this.coreInterface.getModule(I,
T,ta)};Xa.prototype.getPackage=function(I,T,ta){return this.coreInterface.getPackage(I,T,ta)};Xa.prototype.getPackageForModule=function(I,T,ta){return this.coreInterface.getPackageForModule(I,T,ta)};Xa.prototype.resourcesOfPackage=function(I,T){return this.coreInterface.resourcesOfPackage(I,T)};Xa.prototype.systemConfChange=function(I,T,ta){return this.coreInterface.systemConfChange(I,T,ta)};Xa.prototype.registerPackage=function(I){return this.coreInterface.registerPackage(I)};Xa.prototype.importPackage=
function(I){return this.coreInterface.importPackage(I)};Xa.prototype.removePackage=function(I){return this.coreInterface.removePackage(I)};Xa.prototype.reloadPackage=function(I){return this.coreInterface.reloadPackage(I)};Xa.prototype.packageConfChange=function(I,T){return this.coreInterface.packageConfChange(I,T)};Xa.prototype.keyValueListOfVariablesInModule=function(I,T){return this.coreInterface.keyValueListOfVariablesInModule(I,T)};Xa.prototype.interactivelyCreatePackage=function(I){return wc.interactivelyCreatePackage(this.coreInterface,
I)};Xa.prototype.interactivelyLoadPackage=function(I,T){return wc.interactivelyLoadPackage(this.coreInterface,I,T)};Xa.prototype.interactivelyReloadPackage=function(I,T){return wc.interactivelyReloadPackage(this.coreInterface,I,T)};Xa.prototype.interactivelyUnloadPackage=function(I,T,ta){return wc.interactivelyUnloadPackage(this.coreInterface,I,T,ta)};Xa.prototype.interactivelyRemovePackage=function(I,T){return wc.interactivelyRemovePackage(this.coreInterface,I,T)};Xa.prototype.isModuleLoaded=function(I,
T){return this.coreInterface.isModuleLoaded(I,T)};Xa.prototype.doesModuleExist=function(I,T){return this.coreInterface.doesModuleExist(I,T)};Xa.prototype.importModule=function(I){return this.coreInterface.importModule(I)};Xa.prototype.forgetModule=function(I,T){return this.coreInterface.forgetModule(I,T)};Xa.prototype.reloadModule=function(I,T){return this.coreInterface.reloadModule(I,T)};Xa.prototype.moduleFormat=function(I){return this.coreInterface.moduleFormat(I)};Xa.prototype.moduleRead=function(I){return this.coreInterface.moduleRead(I)};
Xa.prototype.moduleWrite=function(I,T){return this.coreInterface.moduleWrite(I,T)};Xa.prototype.getModulesInPackage=function(I){return wc.modulesInPackage(this.coreInterface,I)};Xa.prototype.shortModuleName=function(I,T){return wc.shortModuleName(this.coreInterface,I,T)};Xa.prototype.interactivelyChangeModule=function(I,T,ta){return wc.interactivelyChangeModule(this.coreInterface,I,T,ta)};Xa.prototype.interactivelyReloadModule=function(I,T){return wc.interactivelyReloadModule(this.coreInterface,I,
T)};Xa.prototype.interactivelyUnloadModule=function(I,T){return wc.interactivelyUnloadModule(this.coreInterface,I,T)};Xa.prototype.interactivelyRemoveModule=function(I,T){return wc.interactivelyRemoveModule(this.coreInterface,I,T)};Xa.prototype.interactivelyAddModule=function(I,T){return wc.interactivelyAddModule(this.coreInterface,I,T)};Xa.prototype.showExportsAndImportsOf=function(I,T){return wc.showExportsAndImportsOf(this.coreInterface,I,T)};Xa.prototype.exportsOfModules=function(I){return this.coreInterface.exportsOfModules(I)};
Xa.prototype.searchInPackage=function(I,T,ta){return this.coreInterface.searchInPackage(I,T,ta)};Xa.prototype.searchInAllPackages=function(I,T){T=void 0===T?{}:T;var ta=this,Ca,Mb,vb,Ia,Rb,Jc,Rc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){switch(Fa.nextAddress){case 1:return(Ca=T.progress)&&Ca.step("Fetching Packages...",0),Fa.yield(ta.coreInterface.getPackages({excluded:T.excludedPackages}),2);case 2:Mb=Fa.yieldResult,vb=[],Ca&&Ca.step("Fetching Packages...",.1),Ia=0;case 3:if(!(Ia<
Mb.length)){Fa.jumpTo(5);break}Rb=Mb[Ia];Jc=Rb.url;if(!Jc||"no group"===Jc){Fa.jumpTo(4);break}Ca&&Ca.step(Jc.replace(System.baseURL,"").slice(0,20),.1+Ia/Mb.length*.9);Fa.setCatchFinallyBlocks(6);return Fa.yield(ta.coreInterface.searchInPackage(Jc,I,T),8);case 8:Rc=Fa.yieldResult;vb=vb.concat(Rc);Fa.leaveTryBlock(4);break;case 6:xc=Fa.enterCatchBlock(),console.error("Error searching in package "+Jc+":\n"+xc.stack);case 4:Ia++;Fa.jumpTo(3);break;case 5:return Fa.return(vb)}})};Xa.prototype.loadMochaTestFile=
function(I,T){return this.coreInterface.loadMochaTestFile(I,T)};Xa.prototype.runMochaTests=function(I,T,ta,Ca){return this.coreInterface.runMochaTests(I,T,ta,Ca)};$jscomp.global.Object.defineProperties(Xa.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});sa("Interface",Xa);wc.Interface=Xa;wc.systemInterfaceNamed=cb;wc.systemInterfaceNamed=cb;Xa=sa("localInterface",new wc.Interface(new wc.LocalCoreInterface));
wc.localInterface=Xa;wc.localInterface=Xa;wc.localInterface=Xa;wc.httpInterfaces={};Xa=sa("serverInterfaceFor",function(I){return wc.httpInterfaces[I]||(wc.httpInterfaces[I]=new wc.Interface(new wc.HTTPCoreInterface(I)))});wc.serverInterfaceFor=Xa;wc.serverInterfaceFor=Xa;wc.serverInterfaceFor=Xa;wc.l2lInterfaces={};Xa=sa("l2lInterfaceFor",function(I,T){return wc.l2lInterfaces[I]||(wc.l2lInterfaces[I]=new wc.Interface(new wc.L2LCoreInterface(I,T)))});wc.l2lInterfaceFor=Xa;wc.l2lInterfaceFor=Xa;wc.l2lInterfaceFor=
Xa}}});