System.register(["./__root_module__-11543d52.js","kld-intersections","./client-command-0b340c5b.js"],function(sa){var lb,Eb,Vb,Wb,qd,Ec;return{setters:[function(vd){lb=vd.s;Eb=vd._;Vb=vd.a4;Wb=vd.bC;qd=vd.a5},function(){},function(vd){Ec=vd.runCommand}],execute:function(){function vd(Ra,tb){var dc,bc,Yc,Oc,$b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(zc){if(1==zc.nextAddress)return dc=$c.fileInfoCommandString(Ra,tb),bc=$c.runCommand(dc,tb),zc.yield(bc.whenDone(),2);if(Yc=0!=
bc.exitCode?bc.output:null)throw Yc;Oc=$jscomp.makeIterator($c.parseDirectoryListFromLs(bc.stdout,tb.rootDirectory||"."));$b=Oc.next().value;return zc.return($b)})}function Ic(Ra,tb){return $c.string.lines(Ra).map(function(dc){return dc.trim().length?(new $c.FileInfo(tb)).readFromDirectoryListLine(dc):null}).filter(Boolean)}function Jc(Ra,tb){var dc,bc,Yc,Oc,$b,zc,Fb,Bb,pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pc){dc=Object.assign({findFilesGroup:"default-find-files-process"},
tb);bc=dc.findFilesGroup;Yc=dc.rootDirectory;$b=Oc=$c.findFilesProcesses[bc]||($c.findFilesProcesses[bc]={promiseState:null,commands:[]});zc=$b.commands;Fb=$b.promiseState;Fb||(Oc.promiseState=Fb=$c.promise.deferred());Bb=$c.findFilesCommandString(Ra,tb);zc.forEach(function(xb){return xb.kill()});pc=$c.runCommand(Bb,tb);zc.push(pc);pc.whenDone().then(function(){$c.arr.remove(zc,pc);if(zc.some(function(db){return db.startTime>pc.startTime}))console.log("[findFiles] command "+pc+" exited but a newer findFiles command was started for group "+
bc+", discarding output");else{var xb=0!=pc.exitCode?pc.output:null;xb&&console.warn(xb);xb=xb?[]:$c.parseDirectoryListFromLs(pc.stdout,Yc)||[];Fb.resolve(xb);Object.assign(Oc,{promiseState:null,commands:[]})}}).catch(function(xb){return console.error(xb)});return Pc.return(Fb.promise)})}function Zc(Ra){function tb(dc){return Array.prototype.concat.apply([dc],dc.children?dc.children.map(tb):[])}return tb(Ra).map(function(dc){var bc=dc.fullPath.replace(/^\//,"");return{fileName:bc,path:bc,rootDirectory:"./",
isDirectory:dc.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var $c=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");$c.fileInfo=vd;$c.fileInfoCommandString=function(Ra,tb){var dc=tb=void 0===tb?{}:tb;tb=dc.rootDirectory;dc=dc.platform;tb=tb||".";var bc="win32"===dc?"\\":"/";"win32"===dc||tb.endsWith(bc)||(tb+=bc);return"win32"===dc?"cd "+tb+' && ls -lLd --time-style=locale "'+Ra+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(tb+' && ls -lLd "$timeformat" "'+Ra+'"')};$c.parseDirectoryListFromLs=Ic;$c.findFiles=Jc;$c.findFilesCommandString=function(Ra,tb){var dc=tb=void 0===tb?{}:tb,bc=dc.rootDirectory,Yc=dc.exclude,Oc=dc.depth;dc=dc.platform;bc=bc||".";Yc=Yc||"-iname "+$c.defaultExcludes.map($c.string.print).join(" -o -iname ");var $b="win32"===dc?"\\":"/";"win32"===dc||bc.endsWith($b)||(bc+=$b);Ra=$c.string.format('%s "%s"',tb.re?"-iregex":tb.matchPath?"-ipath":"-iname",Ra);Oc="number"===typeof Oc?" -maxdepth "+Oc:"";
return"win32"===dc?$c.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",bc,tb.re?"-E ":"",Yc.replace(/"/g,""),Ra.replace(/"/g,""),Oc):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+$c.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',bc,tb.re?"-E ":"",Yc,Ra,Oc)};$c.convertDirectoryUploadEntriesToFileInfos=
Zc;$c.runCommand=Ec;$c.string=lb;$c.promise=Eb;$c.arr=Vb;$c.fileInfo=vd;$c.fileInfo=vd;$c.parseDirectoryListFromLs=Ic;$c.parseDirectoryListFromLs=Ic;var Fd=function(Ra){this.rootDirectory=Ra;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};Fd.prototype.readFromDirectoryListLine=function(Ra){var tb=this;if(!Ra.trim().length)return null;var dc=Ra;this.reader.forEach(function(bc){return dc=
bc(dc,tb)});return this};Fd.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(Fd.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(Ra,tb){var dc=Ra.indexOf(" ");tb.mode=Ra.slice(0,dc);tb.isDirectory="d"===tb.mode[0];return Ra.slice(dc+1).trim()},function(Ra,tb){var dc=Ra.indexOf(" ");tb.linkCount=Number(Ra.slice(0,dc));return Ra.slice(dc+1).trim()},function(Ra,tb){var dc=Ra.indexOf(" ");tb.user=Ra.slice(0,dc);return Ra.slice(dc+1).trim()},
function(Ra,tb){var dc=$c.string.peekRight(Ra,0,/\s+[0-9]/);tb.group=Ra.slice(0,dc).trim();return Ra.slice(dc).trim()},function(Ra,tb){var dc=Ra.indexOf(" ");tb.size=Number(Ra.slice(0,dc));return Ra.slice(dc+1).trim()},function(Ra,tb){var dc=$c.string.reMatches(Ra,/[^s]+\s+[0-9:\s]+/);if(!dc||!dc[0])return Ra;tb.lastModified=new Date(dc[0].match+" GMT");return Ra.slice(dc[0].end).trim()},function(Ra,tb){var dc=(Ra=Ra.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&Ra.split(" -> "),bc=""===Ra?!1:Ra&&
2===dc.length,Yc=(dc=bc?dc[0]:Ra)&&0===dc.indexOf(tb.rootDirectory)?dc.slice(tb.rootDirectory.length):dc;tb.fileName=""===Ra?".":Yc;tb.path=dc;tb.isLink=bc;return Yc}]}}});$c.FileInfo=Fd;$c.findFilesProcesses={};$c.findFiles=Jc;$c.findFiles=Jc;$c.defaultExcludes=[".svn",".git","node_modules",".module_cache"];$c.convertDirectoryUploadEntriesToFileInfos=Zc;$c.convertDirectoryUploadEntriesToFileInfos=Zc;var md=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");md.Resource=Wb;md.runCommand=
Ec;md.fileInfo=vd;md.findFiles=Jc;md.string=lb;md.promise=Eb;md.arr=Vb;md.obj=qd;Fd=function(Ra,tb,dc){dc=void 0===dc?{}:dc;Ra=md.Resource.call(this,Ra)||this;Ra.options=Object.assign({},dc,{l2lClient:tb||Ra.constructor.defaultL2lClient});return Ra};$jscomp.inherits(Fd,md.Resource);Fd.prototype.newResource=function(Ra){return new this.constructor(Ra,this.options.l2lClient,this.options)};Fd.prototype.read=function(){var Ra=this,tb=md.runCommand('cat "'+this.url+'"',this.options);return tb.whenDone().then(function(){if(tb.exitCode)throw Error("Read "+
Ra.url+" failed: "+tb.stderr);return tb.output})};Fd.prototype.write=function(Ra){var tb=this,dc,bc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yc){switch(Yc.nextAddress){case 1:return Ra?Yc.yield(md.runCommand('touch "'+tb.url+'" && tee "'+tb.url+'"',Object.assign({stdin:String(Ra)},tb.options)).whenDone(),4):Yc.yield(md.runCommand('echo -n > "'+tb.url+'"',Object.assign({},tb.options)).whenDone(),5);case 4:dc=Yc.yieldResult;Yc.jumpTo(3);break;case 5:dc=Yc.yieldResult;case 3:bc=dc;
if(bc.exitCode)throw Error("Write "+tb.url+" failed: "+bc.stderr);return Yc.return(tb)}})};Fd.prototype.mkdir=function(){var Ra=this,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){if(1==dc.nextAddress)return dc.yield(md.runCommand('mkdir -p "'+Ra.url+'"',Ra.options).whenDone(),2);tb=dc.yieldResult;if(tb.exitCode)throw Error(Ra+" cannot create directory: "+tb.stderr);return dc.return(Ra)})};Fd.prototype.exists=function(){var Ra=md.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return Ra.whenDone().then(function(){return 0===Ra.exitCode})};Fd.prototype.remove=function(){var Ra=this,tb=md.runCommand('rm -rf "'+this.url+'"',this.options);return tb.whenDone().then(function(){if(tb.exitCode)throw Error("Remove of "+Ra.url+" failed: "+tb.stderr);return Ra})};Fd.prototype.gzip=function(Ra){var tb=this,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bc){dc=md.runCommand('gzip > "'+tb.url+'"',Object.assign({stdin:String(Ra)},tb.options));
return bc.return(dc.whenDone().then(function(){if(dc.exitCode)throw Error("Gzip compression of "+tb.url+" failed: "+dc.stderr);return tb}))})};Fd.prototype.brotli=function(Ra){var tb=this,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bc){dc=md.runCommand('brotli > "'+tb.url+'"',Object.assign({stdin:String(Ra)},tb.options));return bc.return(dc.whenDone().then(function(){if(dc.exitCode)throw Error("Brotli compression of "+tb.url+" failed: "+dc.stderr);return tb}))})};Fd.prototype.readProperties=
function(){var Ra=this,tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){if(1==dc.nextAddress)return dc.yield(md.fileInfo(Ra.url,Ra.options),2);tb=dc.yieldResult;Ra.assignProperties(md.obj.dissoc(tb,["fileName","path","rootDirectory"]));return dc.return(Ra)})};Fd.prototype.dirList=function(Ra,tb){Ra=void 0===Ra?1:Ra;tb=void 0===tb?{}:tb;var dc=this,bc,Yc,Oc,$b,zc,Fb,Bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pc){if(1==pc.nextAddress)return bc=tb,Yc=bc.exclude,
Array.isArray(Yc)&&(Yc="-iname "+Yc.map(md.string.print).join(" -o -iname ")),Oc=dc,$b=Oc.url,zc=Oc.options,Fb=zc.l2lClient,pc.yield(md.findFiles("*",{exclude:Yc,depth:Ra,rootDirectory:$b,l2lClient:Fb}),2);Bb=pc.yieldResult;Bb[0].path.replace(/\/$/,"")===dc.url.replace(/\/$/,"")&&Bb.shift();return pc.return(Bb.map(function(Pc){var xb=Pc.path;Pc.isDirectory&&(xb=xb.replace(/\/?$/,"/"));xb=new dc.constructor(xb,Fb,dc.options);xb.assignProperties(md.obj.dissoc(Pc,["fileName","path","rootDirectory"]));
return xb}))})};$jscomp.global.Object.defineProperties(Fd,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||md._defaultL2LClient},set:function(Ra){this._defaultL2lClient=md._defaultL2LClient=Ra}}});sa("default",Fd);md.ShellClientResource=Fd;md._defaultL2LClient=md._defaultL2LClient||void 0;var Vc=sa("resourceExtension",{name:"shell-client",matches:function(Ra){return Ra.startsWith("/")||Ra.match(/[a-z]:\\/i)},resourceClass:md.ShellClientResource});md.resourceExtension=
Vc;md.resourceExtension=Vc;md.resourceExtension=Vc;md.default=Fd}}});