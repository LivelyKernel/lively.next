System.register(["./__root_module__-89b08ab2.js","kld-intersections"],function(ta){var nb,xb,Ob,Hb,qd,Dc,hd,Hc,Fc,Sc,ad,Jd,ed;return{setters:[function(sc){nb=sc.bv;xb=sc.a6;Ob=sc.r;Hb=sc.a7;qd=sc.bp;Dc=sc.bw;hd=sc.bx;Hc=sc.U;Fc=sc.s;Sc=sc.by;ad=sc.bz;Jd=sc.n;ed=sc.bA},function(){}],execute:function(){function sc(I){try{var W=eval("("+ab.ast.transform.wrapInFunction("var _; _ = ("+I+")")+")()")}catch(sa){return JSON.parse(I)}return"object"!==typeof W?null:W}function Sa(I,W){var sa,xa,Eb,Pb,Ha,
Lb,xd,vd,Gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ma){switch(Ma.nextAddress){case 1:return sa=W.world(),Ma.yield(sa.prompt("Enter package name",{requester:W,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:xa=Ma.yieldResult;if(!xa)throw"Canceled";Ma.setCatchFinallyBlocks(3);Pb=cb.resource(xa);xa=Pb.name();Eb=Pb.url;Ma.leaveTryBlock(4);break;case 3:return Ma.enterCatchBlock(),Ma.yield(I.getConfig(),5);case 5:return Ha=Ma.yieldResult.baseURL,Lb=
cb.resource(Ha).join(xa).asDirectory().url,Ma.yield(I.normalize(Lb),6);case 6:Eb=Ma.yieldResult.replace(/\/\.js$/,"/");case 4:return Ma.yield(sa.prompt("Confirm or change package location",{requester:W,input:Eb,historyId:"lively.vm-editor-add-package-address"}),7);case 7:xd=Ma.yieldResult;if(!xd)throw"Canceled";vd=cb.resource(xd).asDirectory();Gc=vd.asFile().url;return Ma.yield(I.removePackage(Gc),8);case 8:return Ma.yield(I.resourceCreateFiles(Gc,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
xa+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+xa+"\n\nNo description for package "+xa+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+xa+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Ma.return(cb.loadPackage(I,{name:xa,address:Gc,configFile:vd.join("package.json").url,main:vd.join("index.js").url,test:vd.join("tests/test.js").url,type:"package"}))}})}function ob(I,W,sa){sa=void 0===sa?
null:sa;var xa,Eb,Pb,Ha,Lb,xd,vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){switch(Gc.nextAddress){case 1:return xa={name:"",address:"",type:"package"},Gc.yield(I.getConfig(),2);case 2:Eb=Gc.yieldResult;if(!sa){Gc.jumpTo(3);break}return Gc.yield(I.getPackage(sa),4);case 4:if(Pb=Gc.yieldResult){Gc.jumpTo(5);break}return Gc.yield(I.getPackageForModule(sa),6);case 6:Pb=Gc.yieldResult;case 5:Ha=Pb;case 3:return Gc.yield(W.world().prompt("What is the package directory?",{requester:W,
input:Ha?Ha.address:Eb.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Lb=Gc.yieldResult;if(!Lb)throw"Canceled";xa.address=Lb.replace(/\/$/,"");xa.url=new URL(xa.address+"/");xa.configFile=cb.resource(xa.url).join("package.json").url;Gc.setCatchFinallyBlocks(8);xd=JSON;vd=xd.parse;return Gc.yield(I.moduleRead(xa.configFile),10);case 10:vd.call(xd,Gc.yieldResult).name;Gc.leaveTryBlock(9);break;case 8:Gc.enterCatchBlock(),xa.name=String(xa.url).replace(/\/$/,""),
I.resourceEnsureExistance(xa.configFile,'{\n  "name": "'+xa.name+'",\n  "version": "0.1.0"\n}');case 9:return Gc.return(cb.loadPackage(I,xa))}})}function $b(I,W,sa){var xa,Eb,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){switch(Ha.nextAddress){case 1:return xa=cb.resource(sa).asFile().url,Ha.yield(I.getPackage(xa),2);case 2:if(Eb=Ha.yieldResult){Ha.jumpTo(3);break}return Ha.yield(I.getPackageForModule(xa),4);case 4:Eb=Ha.yieldResult;case 3:Pb=Eb;if(!Pb)throw Error("Cannot find package for "+
xa);return Ha.yield(I.reloadPackage(xa),5);case 5:if(!W){Ha.jumpTo(0);break}return Ha.yield(W.updateModuleList(),7);case 7:return Ha.yield(W.uiSelect(xa,!1),8);case 8:return Ha.return(Ha.yieldResult)}})}function Sb(I,W,sa,xa){var Eb,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){switch(Ha.nextAddress){case 1:return Ha.yield(I.getPackage(sa),2);case 2:return Eb=Ha.yieldResult,Ha.yield((xa||$world).confirm("Unload package "+Eb.name+"?",{requester:W}),3);case 3:Pb=Ha.yieldResult;
if(!Pb)throw"Canceled";return Ha.yield(I.removePackage(sa),4);case 4:if(!W){Ha.jumpTo(0);break}return Ha.yield(W.updateModuleList(),6);case 6:return Ha.yield(W.uiSelect(null),0)}})}function Bc(I,W,sa){var xa,Eb,Pb,Ha,Lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xd){switch(xd.nextAddress){case 1:return xa=W.world(),xd.yield(I.getPackage(sa),2);case 2:return Eb=xd.yieldResult,Eb?xd.yield(xa.confirm("Really remove package "+Eb.name+"?",{requester:W}),3):($world.inform('No package "'+
sa+'" found!',{requester:W}),xd.return());case 3:Pb=xd.yieldResult;if(!Pb)throw"Canceled";I.removePackage(sa);return xd.yield(xa.confirm("Also remove directory "+Eb.name+" including "+Eb.modules.length+" modules?"),4);case 4:Ha=xd.yieldResult;if(!Ha){xd.jumpTo(0);break}return xd.yield(xa.confirm("REALLY *remove* directory "+Eb.name+"? No undo possible..."),6);case 6:if(Lb=xd.yieldResult)return xd.yield(I.resourceRemove(Eb.address),0);xd.jumpTo(0)}})}function id(I,W,sa){sa=void 0===sa?$world:sa;var xa,
Eb,Pb,Ha,Lb,xd,vd,Gc,Ma,tc,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cc){switch(Cc.nextAddress){case 1:return Cc.yield(I.getPackage(W),2);case 2:xa=Cc.yieldResult;if(!xa)throw Error("Cannot find package "+W);Eb=[];Pb=$jscomp.makeIterator(xa.modules);Ha=Pb.next();case 3:if(Ha.done)return Cc.yield(sa.execCommand("open text window",{title:"imports and exports of "+W,content:Eb.join("\n\n")}),0);Lb=Ha.value;if(!Lb.name.match(/\.js$/)){Cc.jumpTo(4);break}Cc.setCatchFinallyBlocks(6);
xd=I;vd=xd.importsAndExportsOf;Gc=Lb.name;return Cc.yield(I.moduleRead(Lb.name),9);case 9:return Cc.yield(vd.call(xd,Gc,Cc.yieldResult),8);case 8:Ma=Cc.yieldResult;Cc.leaveTryBlock(7);break;case 6:tc=Cc.enterCatchBlock();sa.logError(Error("Error when getting imports/exports from module "+Lb.name+":\n"+tc.stack));Cc.jumpTo(4);break;case 7:$a=""+Lb.name;if(!Ma.imports.length&&!Ma.exports.length){$a+="\n  does not import / export anything";Cc.jumpTo(4);break}Ma.imports.length&&($a+="\n  imports:\n",
$a+=cb.arr.groupByKey(Ma.imports,"fromModule").mapGroups(function(Mc,Ua){return"from "+Mc+": "+Ua.map(function(Fa){return Fa.local||Fa.imported?Fa.imported&&Fa.imported!==Fa.local?Fa.imported+" as "+Fa.local:Fa.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(Mc){return"    "+Mc}).join("\n"));Ma.exports.length&&($a+="\n  exports:\n",$a+=Ma.exports.map(function(Mc){return Mc.local?Mc.local&&Mc.local!==Mc.exported?Mc.local+" as "+Mc.exported:Mc.exported:Mc.exported+
" from "+Mc.fromModule}).join(", ").split("\n").map(function(Mc){return"    "+Mc}).join("\n"));Eb.push($a);case 4:Ha=Pb.next(),Cc.jumpTo(3)}})}function Xb(I,W,sa){sa=sa&&sa.address;if(sa&&0===W.indexOf(sa))var xa=W.slice(sa.length).replace(/^\//,"");else a:{sa=I.getConfig();if(!sa||sa.constructor!==Promise)try{xa=String((new URL(W)).relativePathFrom(new URL(I.getConfig().baseURL)));break a}catch(Eb){}xa=W}return xa}function Ub(I,W,sa,xa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){return 1==
Eb.nextAddress?(xa=Object.assign({targetModule:W},xa),Eb.yield(I.normalize(W),2)):3!=Eb.nextAddress?(W=Eb.yieldResult,Eb.yield(I.moduleSourceChange(W,sa,xa),3)):Eb.return(W)})}function ub(I,W,sa,xa,Eb){xa=void 0===xa?!1:xa;Eb=void 0===Eb?!1:Eb;var Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){switch(Ha.nextAddress){case 1:return W&&W.setStatusMessage("Reloading "+sa),Ha.setCatchFinallyBlocks(2),Ha.yield(I.reloadModule(sa,{reloadDeps:xa,resetEnv:Eb}),4);case 4:if(!W){Ha.jumpTo(5);
break}return Ha.yield(W.updateModuleList(),6);case 6:case 5:W&&W.setStatusMessage("Reloded "+sa);Ha.leaveTryBlock(0);break;case 2:Pb=Ha.enterCatchBlock();Ha.setCatchFinallyBlocks(7);if(!W){Ha.jumpTo(9);break}return Ha.yield(W.updateEditorWithSourceOf(sa),10);case 10:case 9:Ha.leaveTryBlock(8);break;case 7:Ha.enterCatchBlock();case 8:throw W&&W.showError(Pb),Pb;}})}function hc(I,W,sa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){switch(xa.nextAddress){case 1:return xa.yield(I.forgetModule(sa,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!W){xa.jumpTo(3);break}return xa.yield(W.updateModuleList(),4);case 4:case 3:xa.jumpToEnd()}})}function wc(I,W,sa){var xa,Eb,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){switch(Ha.nextAddress){case 1:return Ha.yield(I.normalize(sa),2);case 2:return xa=Ha.yieldResult,Ha.yield(W.world().confirm("Remove file "+xa+"?",{requester:W}),3);case 3:Eb=Ha.yieldResult;if(!Eb)throw"Canceled";return Ha.yield(I.forgetModule(xa),4);case 4:return Ha.yield(I.resourceRemove(xa),
5);case 5:return Ha.yield(I.getPackageForModule(xa),6);case 6:return Pb=Ha.yieldResult,Ha.return(Pb)}})}function bd(I,W,sa){var xa,Eb,Pb,Ha,Lb,xd,vd,Gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ma){switch(Ma.nextAddress){case 1:return xa=URL,Ma.yield(I.getConfig(),2);case 2:Eb=new xa(Ma.yieldResult.baseURL);Pb=W.world();if(!sa){Ma.jumpTo(3);break}return Ma.yield(I.getPackage(sa),4);case 4:if(Ha=Ma.yieldResult){Ma.jumpTo(5);break}return Ma.yield(I.getPackageForModule(sa),6);case 6:Ha=
Ma.yieldResult;case 5:(Lb=Ha)&&(Eb=new URL(Lb.address));case 3:return Ma.yield(Pa._searchForExistingFiles(W,String(Eb),Lb),7);case 7:xd=Ma.yieldResult;if(!xd.includes("[create new module]")){Ma.jumpTo(8);break}return Ma.yield(Pa._askForModuleName(I,sa||String(Eb),Pb),9);case 9:vd=Ma.yieldResult,xd=[vd];case 8:return Ma.yield(Pa._createAndLoadModules(I,xd),10);case 10:return Gc=Ma.yieldResult,Pa.arr.compact(Gc.map(function(tc){return tc.error})),Ma.return(Gc)}})}function cd(I,W){var sa,xa,Eb,Pb,Ha,
Lb,xd,vd,Gc,Ma;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return tc.yield(I.getPackage(W),2);if(3!=tc.nextAddress){sa=tc.yieldResult;if(!sa||!sa.address.match(/^http/))throw Error("Cannot load package "+W);xa=Pa.resource(sa.address);Eb=[];Pb=$jscomp;Ha=Pb.makeIterator;return tc.yield(xa.dirList(5,{exclude:Pa.modulesInPackage_defaultExclude}),3)}Lb=Ha.call(Pb,tc.yieldResult);for(xd=Lb.next();!xd.done;xd=Lb.next())Gc=vd=xd.value,Ma=Gc.url,Ma.match(/\.js$/)&&
I.isModuleLoaded(Ma,!0)&&Eb.push(I.getModule(Ma));return tc.return(Eb)})}function bb(I,W){W=void 0===W?[]:W;var sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){if(1==xa.nextAddress)return xa.yield(System.import("mocha-es6/index.js"),2);sa=xa.yieldResult;return xa.return(sa.loadTestModuleAndExtractTestState(I,W))})}function pb(I,W,sa,xa){function Eb(tc){return new Promise(function($a,Cc){var Mc=Za.arr.compact(tc.suite.suites).map(function(Fa){return Fa.file}),Ua=Za.chain(W).filter(function(Fa){return Mc.includes(Fa.file)}).pluck("tests").flatten().value();
if(!Ua||!Ua.length)return Cc(Error("Trying to run tests of "+Mc.join(", ")+" but cannot find them in loaded tests!"));tc.reporter(function(Fa){Fa.on("test",function(Wb){try{var Bd=Ua.find(function(pd){return pd.fullTitle===Wb.fullTitle()});Bd.state="running";"function"===typeof sa&&sa(Bd,"test")}catch(pd){"function"===typeof xa&&xa(pd,"test")}});Fa.on("pass",function(Wb){try{var Bd=Ua.find(function(pd){return pd.fullTitle===Wb.fullTitle()});Bd.state="succeeded";Bd.duration=Wb.duration;"function"===
typeof sa&&sa(Bd,"pass")}catch(pd){"function"===typeof xa&&xa(pd,"pass")}});Fa.on("fail",function(Wb,Bd){try{var pd=function(Ld,Lc,kb){Ld.state="failed";Ld.duration=Ld.duration;Ld.error=Lc},Vd=Ua.find(function(Ld){return Ld.fullTitle===Wb.fullTitle()});if(Vd)pd(Vd,Bd,Wb.duration);else{var qc=Za.arr.invoke(Wb.parent.tests,"fullTitle");Ua.filter(function(Ld){return qc.includes(Ld.fullTitle)}).forEach(function(Ld){return pd(Ld,Bd,Wb.duration)})}"function"===typeof sa&&sa(Vd,"fail")}catch(Ld){"function"===
typeof xa&&xa(Ld,"fail")}})});tc.run(function(Fa){return $a({testsByFile:W,mocha:tc})})})}var Pb,Ha,Lb,xd,vd,Gc,Ma;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){switch(tc.nextAddress){case 1:Pb=$jscomp.makeIterator(W),Ha=Pb.next();case 2:if(Ha.done){tc.jumpTo(4);break}xd=Lb=Ha.value;vd=xd.file;return tc.yield(Za.loadMochaTestFile(vd,W),5);case 5:return Gc=tc.yieldResult,Ma=Gc.mocha,I&&(Ma=Ma.grep(I)),tc.yield(Eb(Ma),3);case 3:Ha=Pb.next();tc.jumpTo(2);break;case 4:return tc.return({mocha:Ma,
testsByFile:W})}})}function pc(I){I||(I="local");if(I.isSystemInterface)var W=I;else"string"===typeof I&&I.startsWith("l2l ")&&(I={type:"l2l",id:I.split(" ")[1]}),"string"!==typeof I&&"l2l"===I.type&&(W=Yb.l2lInterfaceFor(I.id,I.info)),"string"!==typeof I&&($world.setStatusMessage("Unknown system interface "+I),I="local"),W||(W=I&&"local"!==I?Yb.serverInterfaceFor(I):Yb.localInterface);return W}ta("systemInterfaceNamed",pc);var ab=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
ab.parseJsonLikeObj=sc;ab.ast=nb;ab.parseJsonLikeObj=sc;ab.parseJsonLikeObj=sc;var cb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");cb.loadPackage=function(I,W){var sa,xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){switch(Eb.nextAddress){case 1:return Eb.yield(I.importPackage(W.address+"/"),2);case 2:if(!W.main){Eb.jumpTo(3);break}return Eb.yield(I.importModule(W.main.toString()),3);case 3:if(!W.test){Eb.jumpTo(5);break}Eb.setCatchFinallyBlocks(6);
return Eb.yield(I.importPackage("mocha-es6"),8);case 8:return sa=Eb.yieldResult,Eb.yield(sa.installSystemInstantiateHook(),9);case 9:return Eb.yield(I.importModule(W.test.toString()),10);case 10:Eb.leaveTryBlock(5);break;case 6:xa=Eb.enterCatchBlock(),console.warn("Cannot load test of new package: "+xa);case 5:return Eb.return(I.getPackage(W.address))}})};cb.interactivelyCreatePackage=Sa;cb.interactivelyLoadPackage=ob;cb.interactivelyReloadPackage=$b;cb.interactivelyUnloadPackage=Sb;cb.interactivelyRemovePackage=
Bc;cb.showExportsAndImportsOf=id;cb.parseJsonLikeObj=sc;cb.arr=xb;cb.resource=Ob;cb.interactivelyCreatePackage=Sa;cb.interactivelyCreatePackage=Sa;cb.interactivelyLoadPackage=ob;cb.interactivelyLoadPackage=ob;cb.interactivelyReloadPackage=$b;cb.interactivelyReloadPackage=$b;cb.interactivelyUnloadPackage=Sb;cb.interactivelyUnloadPackage=Sb;cb.interactivelyRemovePackage=Bc;cb.interactivelyRemovePackage=Bc;cb.showExportsAndImportsOf=id;cb.showExportsAndImportsOf=id;var Pa=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
Pa.shortModuleName=Xb;Pa.interactivelyChangeModule=Ub;Pa.interactivelyReloadModule=ub;Pa.interactivelyUnloadModule=hc;Pa.interactivelyRemoveModule=wc;Pa.interactivelyAddModule=bd;Pa._askForModuleName=function(I,W,sa){var xa,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){switch(Pb.nextAddress){case 1:return Pb.yield(sa.prompt("Enter module name",{input:W,historyId:"lively.vm-editor-add-module-name"}),2);case 2:W=Pb.yieldResult;if(!W)throw"Canceled";return Pb.yield(I.normalize(W),
3);case 3:return xa=Pb.yieldResult,Pb.yield(sa.confirm(["Create module \n",{},xa,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Eb=Pb.yieldResult;if(!Eb)throw"Canceled";return Pb.return(xa)}})};Pa._searchForExistingFiles=function(I,W,sa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return String(W).match(/^http/)?xa.return(Pa._searchForExistingFilesWeb(I,W,sa)):xa.return(Pa._searchForExistingFilesManually(I,W,sa))})};Pa._searchForExistingFilesManually=function(I,W,sa){var xa,
Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){switch(Pb.nextAddress){case 1:return Pb.yield(I.world().multipleChoicePrompt("Add Module",{requester:I,choices:["Create New Module","Load Existing Module"]}),2);case 2:xa=Pb.yieldResult;if("Create New Module"===xa)return Pb.return("[create new module]");if("Load Existing Module"!==xa){Pb.jumpTo(3);break}return Pb.yield(I.world().prompt("URL of module?",{input:W,requester:I,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(Eb=Pb.yieldResult)return Pb.return([Eb]);case 3:throw"Canceled";}})};Pa._searchForExistingFilesWeb=function(I,W,sa){function xa(Gc){Gc.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Gc.name())||sa&&Pa.arr.pluck(sa.modules,"name").includes(Gc.url)?!0:!1}var Eb,Pb,Ha,Lb,xd,vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){switch(Gc.nextAddress){case 1:return(Eb=I.world())&&(Pb=Eb.showLoadingIndicatorFor(I,"Loading existing modules...")),
Gc.yield(Pa.resource(W).dirList(5,{exclude:xa}),3);case 3:return Gc.yield(Gc.yieldResult.map(function(Ma){return Ma.url}),2);case 2:return Ha=Gc.yieldResult,Lb=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Ha.filter(function(Ma){return Ma.endsWith(".js")}).map(function(Ma){return{isListItem:!0,string:sa&&0==Ma.indexOf(sa.address)?sa.name+Ma.slice(sa.address.length):Ma,value:Ma}})),Gc.yield(Promise.resolve(Pb&&Pb.remove()).then(function(){return I.world().filterableListPrompt("What module to load?",
Lb,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:I},I?{extent:I.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:xd=Gc.yieldResult;if(!xd||"canceled"===xd.status||!xd.selected.length)throw"Canceled";vd=xd.selected||xd;Array.isArray(vd)||(vd=[vd]);return Gc.return(vd)}})};Pa._createAndLoadModules=function(I,W){var sa,xa,Eb,Pb,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lb){switch(Lb.nextAddress){case 1:Array.isArray(W)||(W=[W]),sa=[],xa=$jscomp.makeIterator(W),
Eb=xa.next();case 2:if(Eb.done){Lb.jumpTo(4);break}Pb=Eb.value;return Lb.yield(I.forgetModule(Pb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return Lb.yield(I.resourceEnsureExistance(Pb,'"format esm";\n'),6);case 6:return Lb.setCatchFinallyBlocks(7),Lb.yield(I.importModule(Pb),9);case 9:sa.push({name:Pb});Lb.leaveTryBlock(3);break;case 7:Ha=Lb.enterCatchBlock(),sa.push({name:Pb,error:Ha});case 3:Eb=xa.next();Lb.jumpTo(2);break;case 4:return Lb.return(sa)}})};Pa.modulesInPackage_defaultExclude=function(I){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(I.name())?!0:!1};Pa.modulesInPackage=cd;Pa.obj=Hb;Pa.arr=xb;Pa.resource=Ob;Pa.shortModuleName=Xb;Pa.shortModuleName=Xb;Pa.interactivelyChangeModule=Ub;Pa.interactivelyChangeModule=Ub;Pa.interactivelyReloadModule=ub;Pa.interactivelyReloadModule=ub;Pa.interactivelyUnloadModule=hc;Pa.interactivelyUnloadModule=hc;Pa.interactivelyRemoveModule=wc;Pa.interactivelyRemoveModule=wc;Pa.interactivelyAddModule=bd;Pa.interactivelyAddModule=bd;
Pa.modulesInPackage=cd;Pa.modulesInPackage=cd;var Za=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");Za.loadMochaTestFile=bb;Za.runMochaTests=pb;Za.arr=xb;Za.chain=qd;Za.loadMochaTestFile=bb;Za.loadMochaTestFile=bb;Za.runMochaTests=pb;Za.runMochaTests=pb;var eb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");eb.todo=function(I){throw Error(I+" is not yet implemented!");};eb.parseJsonLikeObj=sc;eb.arr=xb;eb.Closure=Dc;eb.obj=
Hb;eb.resource=Ob;eb.transform=hd;eb.modules=Hc;var Na=function(){};Na.prototype.dynamicCompletionsForPrefix=function(I,W,sa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){eb.todo("dynamicCompletionsForPrefix");xa.jumpToEnd()})};Na.prototype.runEval=function(I,W){eb.todo("runEval")};Na.prototype.resourceExists=function(I){eb.todo("resourceExists")};Na.prototype.resourceEnsureExistance=function(I,W){eb.todo("resourceEnsureExistance")};Na.prototype.resourceMkdir=function(I){eb.todo("resourceMkdir")};
Na.prototype.resourceRead=function(I){eb.todo("resourceRead")};Na.prototype.resourceRemove=function(I){eb.todo("resourceRemove")};Na.prototype.resourceWrite=function(I,W){eb.todo("resourceWrite")};Na.prototype.resourceCreateFiles=function(I,W){eb.todo("resourceCreateFiles")};Na.prototype.resourceDirList=function(I,W,sa){eb.todo("resourceDirList")};Na.prototype.normalizeSync=function(I,W,sa){eb.todo("normalizeSync")};Na.prototype.normalize=function(I,W,sa){eb.todo("normalize")};Na.prototype.printSystemConfig=
function(){eb.todo("printSystemConfig")};Na.prototype.getConfig=function(){eb.todo("getConfig")};Na.prototype.setConfig=function(I){eb.todo("setConfig")};Na.prototype.getPackages=function(I){eb.todo("getPackages")};Na.prototype.isModuleLoaded=function(I,W){eb.todo("isModuleLoaded")};Na.prototype.doesModuleExist=function(I,W){eb.todo("doesModuleExist")};Na.prototype.getModules=function(){var I=this,W,sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return 1==xa.nextAddress?(W=eb.arr,
sa=W.flatmap,xa.yield(I.getPackages(),2)):xa.return(sa.call(W,xa.yieldResult,function(Eb){return Eb.modules}))})};Na.prototype.getModule=function(I){var W=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return 1==sa.nextAddress?sa.yield(W.getModules(),2):sa.return(sa.yieldResult.find(function(xa){return xa.name===I}))})};Na.prototype.getPackage=function(I){var W=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return 1==sa.nextAddress?(I=I.replace(/\/+$/,""),
sa.yield(W.getPackages(),2)):sa.return(sa.yieldResult.find(function(xa){return xa.address===I||xa.name===I}))})};Na.prototype.getPackageForModule=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){eb.todo("getPackageForModule");W.jumpToEnd()})};Na.prototype.systemConfChange=function(I){var W=eb.parseJsonLikeObj(I);["baseURL"].forEach(function(sa){return delete W[sa]});return this.setConfig(W)};Na.prototype.resourcesOfPackage=function(I,W){return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){eb.todo("resourcesOfPackage");
sa.jumpToEnd()})};Na.prototype.registerPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){eb.todo("registerPackage");W.jumpToEnd()})};Na.prototype.importPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){eb.todo("importPackage");W.jumpToEnd()})};Na.prototype.removePackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){eb.todo("removePackage");W.jumpToEnd()})};Na.prototype.reloadPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){eb.todo("reloadPackage");
W.jumpToEnd()})};Na.prototype.packageConfChange=function(I,W){return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){eb.todo("packageConfChange");sa.jumpToEnd()})};Na.prototype.importModule=function(I){eb.todo("importModule")};Na.prototype.forgetModule=function(I,W){eb.todo("forgetModule")};Na.prototype.reloadModule=function(I,W){eb.todo("reloadModule")};Na.prototype.moduleFormat=function(I){eb.todo("moduleFormat")};Na.prototype.moduleRead=function(I){eb.todo("moduleRead")};Na.prototype.moduleSourceChange=
function(I,W,sa){eb.todo("moduleSourceChange")};Na.prototype.importsAndExportsOf=function(I,W){eb.todo("importsAndExportsOf")};Na.prototype.keyValueListOfVariablesInModule=function(I,W){eb.todo("keyValueListOfVariablesInModule")};Na.prototype.moduleWrite=function(I,W){return this.moduleSourceChange(I,W)};eb.AbstractCoreInterface=Na;var Da=function(){var I=eb.AbstractCoreInterface.call(this)||this;I.currentEval=null;return I};$jscomp.inherits(Da,eb.AbstractCoreInterface);Da.prototype.runEval=function(I,
W){throw Error("Not yet implemented");};Da.prototype.runEvalAndStringify=function(I,W){var sa=this;return this.currentEval?this.currentEval.then(function(){return sa.runEvalAndStringify(I,W)}):this.currentEval=Promise.resolve().then(function(){var xa,Eb,Pb,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lb){switch(Lb.nextAddress){case 1:return Lb.yield(sa.runEval("\n        Promise.resolve((async "+eb.transform.wrapInFunction(I)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},W)),2);case 2:if((xa=Lb.yieldResult)&&xa.isError)throw Error(String(xa.value||xa.error));if(!xa||!xa.value)return Lb.return(null);if(Eb=xa.promisedValue){Lb.jumpTo(3);break}return Lb.yield(xa.value,4);case 4:Eb=Lb.yieldResult;case 3:Pb=Eb;if(!Pb)return Lb.return();if("undefined"===Pb)return Lb.return(void 0);if("null"===Pb)return Lb.return(null);if("true"===Pb)return Lb.return(!0);
if("false"===Pb)return Lb.return(!1);try{Ha=JSON.parse(Pb)}catch(xd){return Lb.return(Pb)}if(Ha&&Ha.isError)throw Error(String(Ha.value));return Lb.return(Ha)}})}).then(function(xa){delete sa.currentEval;return xa},function(xa){delete sa.currentEval;return Promise.reject(xa)})};Da.prototype.dynamicCompletionsForPrefix=function(I,W,sa){var xa=this,Eb,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){Eb=eb.obj.isString(sa.context)?sa.context:!1;sa=eb.obj.dissoc(sa,["systemInterface",
"System","context"]);Pb="\n      var prefix = "+JSON.stringify(W)+",\n          opts = "+JSON.stringify(sa)+";\n      opts.context = "+Eb+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Ha.return(xa.runEvalAndStringify(Pb))})};Da.prototype.evalWithResource=function(I,W,sa){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+I+'").'+W+"("+(sa?JSON.stringify(sa):"")+");\n    ")};Da.prototype.resourceExists=function(I){return this.evalWithResource(I,"exists")};Da.prototype.resourceEnsureExistance=function(I,W){return this.evalWithResource(I,
"ensureExistance",W)};Da.prototype.resourceMkdir=function(I){return this.evalWithResource(I,"mkdir")};Da.prototype.resourceRead=function(I){return this.evalWithResource(I,"read")};Da.prototype.resourceRemove=function(I){return this.evalWithResource(I,"remove")};Da.prototype.resourceWrite=function(I,W){return this.evalWithResource(I,"write",W)};Da.prototype.resourceCreateFiles=function(I,W){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
I+'", '+JSON.stringify(W)+")")};Da.prototype.resourceDirList=function(I,W,sa){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+I+'").dirList('+JSON.stringify(W)+", "+JSON.stringify(sa)+"))\n        .map(({url}) => ({url}))")};Da.prototype.livelySystemAccessor=function(I){I=void 0===I?"livelySystem":I;return"var "+I+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
I+') throw new Error("lively-system-interface not available!");'};Da.prototype.normalizeSync=function(I,W,sa){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(I)+", "+JSON.stringify(W)+", "+sa+")")};Da.prototype.normalize=function(I,W,sa){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(I)+", "+JSON.stringify(W)+", "+JSON.stringify(sa)+")")};Da.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
Da.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};Da.prototype.setConfig=function(I){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(I)+")")};Da.prototype.getPackages=function(I){I=Object.assign({excluded:[]},I);I.excluded=I.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(I)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};Da.prototype.getPackageForModule=function(I){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(I)+")")};Da.prototype.isModuleLoaded=function(I,W){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+I+'", '+W+")")};Da.prototype.doesModuleExist=function(I,W){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+I+'", '+W+")")};Da.prototype.registerPackage=function(I){var W=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return sa.return(W.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(I)+")"))})};Da.prototype.importPackage=
function(I){var W=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return sa.return(W.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(I)+")"))})};Da.prototype.removePackage=function(I){var W=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return sa.return(W.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(I)+")"))})};Da.prototype.reloadPackage=function(I,W){var sa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return xa.return(sa.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(I)+", "+JSON.stringify(W)+")"))})};Da.prototype.packageConfChange=function(I,W){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(I)+", "+JSON.stringify(W)+")")};Da.prototype.resourcesOfPackage=function(I,W){W=void 0===W?[".git","node_modules",".module_cache","lively.next-node_modules"]:W;var sa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){I.address&&(I=I.address);
return xa.return(sa.runEvalAndStringify("\n      "+sa.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(I)+", "+JSON.stringify(W)+");"))})};Da.prototype.getModule=function(I){var W=this,sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){if(1==xa.nextAddress)return xa.yield(W.getModules(),2);sa=xa.yieldResult.find(function(Eb){return Eb.name===I});return xa.return(sa?eb.modules.module(sa.name):null)})};Da.prototype.importModule=function(I){return this.runEvalAndStringify("lively.modules.System.import("+
JSON.stringify(I)+")")};Da.prototype.forgetModule=function(I,W){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").unload("+JSON.stringify(W)+")")};Da.prototype.reloadModule=function(I,W){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").reload("+JSON.stringify(W)+")")};Da.prototype.moduleFormat=function(I){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").format();")};Da.prototype.moduleRead=function(I){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(I)+").source()")};Da.prototype.moduleSourceChange=function(I,W,sa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").changeSource("+JSON.stringify(W)+", "+JSON.stringify(sa)+")")};Da.prototype.keyValueListOfVariablesInModule=function(I,W){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+JSON.stringify(I)+", "+JSON.stringify(W)+")")};Da.prototype.importsAndExportsOf=
function(I,W){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(I)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(I)+").exports()})")};Da.prototype.exportsOfModules=function(I){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(I)+";\n      options.excludedPackages = ["+I.excludedPackages.map(function(W){return"function"===typeof W?W.toString():JSON.stringify(W)}).join(",")+
"]\n      await livelySystem.localInterface.exportsOfModules(options)")};Da.prototype.searchInPackage=function(I,W,sa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(I)+", "+JSON.stringify(W)+", "+JSON.stringify(sa)+")")};Da.prototype.loadMochaTestFile=function(I,W){W=void 0===W?[]:W;var sa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return xa.return(sa.runEvalAndStringify("\n      "+
sa.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(I)+", "+JSON.stringify(W)+"), result;\n      result = {testsByFile}"))})};Da.prototype.runMochaTests=function(I,W,sa,xa){var Eb=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){I&&I instanceof RegExp&&(I={isRegExp:!0,value:String(I).replace(/^\/|\/$/g,"")});return Pb.return(Eb.runEvalAndStringify("\n      var grep = "+JSON.stringify(I)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Eb.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(W||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
eb.RemoteCoreInterface=Da;var mb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");mb.obj=Hb;mb.string=Fc;mb.arr=xb;mb.resource=Ob;mb.createFiles=Sc;mb.ast=nb;mb.modules=Hc;mb.vm=ad;mb.loadMochaTestFile=bb;mb.runMochaTests=pb;mb.parseJsonLikeObj=sc;mb.AbstractCoreInterface=Na;mb.classToFunctionTransform=Jd;Na=function(){return mb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(Na,mb.AbstractCoreInterface);Na.prototype.dynamicCompletionsForPrefix=
function(I,W,sa){var xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){if(1==Eb.nextAddress)return Eb.yield(mb.vm.completions.getCompletions(function(Pb){return mb.vm.runEval(Pb.replace("return ",""),Object.assign({targetModule:I,classTransform:mb.classToFunctionTransform},sa))},W),2);xa=Eb.yieldResult;if(xa.isError)throw xa.value;return Eb.return({completions:xa.completions,prefix:xa.startLetters})})};Na.prototype.runEval=function(I,W){return mb.vm.runEval(I,Object.assign({classTransform:mb.classToFunctionTransform},
W))};Na.prototype.resourceExists=function(I){return mb.resource(I).exists()};Na.prototype.resourceEnsureExistance=function(I,W){return mb.resource(I).ensureExistance(W)};Na.prototype.resourceMkdir=function(I){return mb.resource(I).mkdir()};Na.prototype.resourceRead=function(I){return mb.resource(I).read()};Na.prototype.resourceRemove=function(I){return mb.resource(I).remove()};Na.prototype.resourceWrite=function(I,W){return mb.resource(I).write(W)};Na.prototype.resourceCreateFiles=function(I,W){return mb.createFiles(I,
W)};Na.prototype.resourceDirList=function(I,W,sa){return mb.resource(I).dirList(W,sa)};Na.prototype.normalizeSync=function(I,W,sa){return System.decanonicalize(I,W,sa)};Na.prototype.normalize=function(I,W,sa){return System.normalize(I,W,sa)};Na.prototype.printSystemConfig=function(){return mb.modules.printSystemConfig()};Na.prototype.getConfig=function(){return System.getConfig()};Na.prototype.setConfig=function(I){mb.modules.System.config(I)};Na.prototype.getPackages=function(I){I=Object.assign({},
I);I=void 0===I.excluded?[]:I.excluded;var W=I.filter(function(xa){return"string"===typeof xa}),sa=I.filter(function(xa){return"function"===typeof xa});W=W.concat(W.map(function(xa){return System.decanonicalize(xa.replace(/\/?$/,"/")).replace(/\/$/,"")}));return mb.modules.getPackages().filter(function(xa){return!W.includes(xa.url)&&!sa.some(function(Eb){return Eb(xa.url)})})};Na.prototype.registerPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return W.return(mb.modules.registerPackage(I))})};
Na.prototype.importPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return W.return(mb.modules.importPackage(I))})};Na.prototype.removePackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(W){return W.return(mb.modules.removePackage(I))})};Na.prototype.reloadPackage=function(I,W){return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return sa.return(mb.modules.reloadPackage(I,W))})};Na.prototype.packageConfChange=function(I,W){var sa=
this,xa,Eb,Pb,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lb){if(1==Lb.nextAddress)return xa=mb.modules.System,Eb=mb.parseJsonLikeObj(I),Pb=JSON.stringify(Eb,null,2),Lb.yield(mb.modules.module(W).changeSource(Pb,{doEval:!1}),2);if(3!=Lb.nextAddress)return xa.set(W,xa.newModule(Eb)),Lb.yield(sa.getPackageForModule(W),3);(Ha=Lb.yieldResult)&&mb.modules.applyPackageConfig(Eb,Ha.address);Lb.jumpToEnd()})};Na.prototype.resourcesOfPackage=function(I,W){W=void 0===W?[".git","node_modules",
".module_cache"]:W;var sa,xa,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){if(1==Pb.nextAddress)return Pb.setCatchFinallyBlocks(2),sa=I.address?I.address:I,xa=mb.modules.getPackage(sa),Pb.yield(xa.resources(void 0,W),4);if(2!=Pb.nextAddress)return Pb.return(Pb.yieldResult.map(function(Ha){return Object.assign(Ha,{package:Ha.package.url})}));Eb=Pb.enterCatchBlock();console.warn("resourcesOfPackage error for "+I+": "+Eb);return Pb.return([])})};Na.prototype.getPackageForModule=
function(I){return(I=mb.modules.getPackageOfModule(I))?I.asSpec():I};Na.prototype.isModuleLoaded=function(I,W){return mb.modules.isModuleLoaded(I,W)};Na.prototype.doesModuleExist=function(I,W){return mb.modules.isModuleLoaded(I,W)};Na.prototype.getModule=function(I){return mb.modules.module(I)};Na.prototype.importModule=function(I){return mb.modules.System.import(I)};Na.prototype.forgetModule=function(I,W){return mb.modules.module(I).unload(W)};Na.prototype.reloadModule=function(I,W){return mb.modules.module(I).reload(W)};
Na.prototype.moduleFormat=function(I){return mb.modules.module(I).format()};Na.prototype.moduleRead=function(I){return mb.modules.module(I).source()};Na.prototype.moduleSourceChange=function(I,W,sa){return mb.modules.module(I).changeSource(W,sa)};Na.prototype.keyValueListOfVariablesInModule=function(I,W){var sa=this,xa,Eb,Pb,Ha,Lb,xd,vd,Gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ma){switch(Ma.nextAddress){case 1:if(W){Ma.jumpTo(2);break}return Ma.yield(sa.resourceRead(I),3);case 3:W=
Ma.yieldResult;case 2:return xa="string"===typeof W?mb.ast.parse(W):W,Eb=sa.normalizeSync(I),sa.moduleFormat(Eb),Pb=mb.modules.module(Eb).env().recorder,Ma.yield(sa.importsAndExportsOf(Eb,xa),4);case 4:return Ha=Ma.yieldResult,Lb=mb.ast.query.topLevelDeclsAndRefs(xa),xd=mb.arr.sortByKey(mb.ast.query.declarationsOfScope(Lb.scope,!0),"start"),vd=mb.arr.pluck(Lb.scope.importSpecifiers,"name"),Gc=0,Ma.return(xd.map(function(tc){var $a=tc.name.length,Cc=Ha.exports.find(function(Ua){return Ua.local===tc.name}),
Mc=mb.arr.include(vd,tc.name);Cc&&($a+=9);Mc&&($a+=9);Gc=Math.max(Gc,$a);return{isExport:Cc,isImport:Mc,name:tc.name,value:Pb[tc.name],node:tc,printedName:tc.name+(Cc?" [export]":"")+(Mc?" [import]":""),printedValue:mb.obj.inspect(Pb[tc.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(tc){return{isListItem:!0,value:tc,string:tc.printedName+mb.string.indent(" = "+tc.printedValue," ",Gc-tc.printedName.length)}}))}})};Na.prototype.importsAndExportsOf=function(I,W){var sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return 1==
xa.nextAddress?xa.yield(mb.modules.module(I).imports(W),2):3!=xa.nextAddress?(sa=xa.yieldResult,xa.yield(mb.modules.module(I).exports(W),3)):xa.return({imports:sa,exports:xa.yieldResult})})};Na.prototype.exportsOfModules=function(I){return mb.modules.ExportLookup.run(System,I)};Na.prototype.searchInPackage=function(I,W,sa){return mb.modules.getPackage(I).search(W,sa)};Na.prototype.runMochaTests=function(I,W,sa,xa){return mb.runMochaTests(I,W,sa,xa)};Na.prototype.loadMochaTestFile=function(I,W){return mb.loadMochaTestFile(I,
W)};$jscomp.global.Object.defineProperties(Na.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});mb.LocalCoreInterface=Na;var Zb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");Zb.evalStrategies=ed;Zb.RemoteCoreInterface=Da;var dc=function(I){var W=Zb.RemoteCoreInterface.call(this)||this;W.currentEval=null;W.url=I;W.server=new Zb.evalStrategies.HttpEvalStrategy(I);return W};$jscomp.inherits(dc,Zb.RemoteCoreInterface);dc.prototype.runEval=
function(I,W){return this.server.runEval(I,W)};$jscomp.global.Object.defineProperties(dc.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});Zb.HTTPCoreInterface=dc;var Mb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");Mb.evalStrategies=ed;Mb.RemoteCoreInterface=Da;Da=function(I,W){var sa=Mb.RemoteCoreInterface.call(this)||this;
sa.targetId=I;sa.peer=W;return sa};$jscomp.inherits(Da,Mb.RemoteCoreInterface);Da.prototype.isConnected=function(){var I=this,W,sa,xa,Eb,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return W=I,sa=W.client,xa=W.targetId,Ha.yield(sa.sendToAndWait(sa.trackerId,"getClients",{}),2);Eb=Ha.yieldResult;Pb=Eb.data;return Ha.return(Pb.some(function(Lb){Lb=$jscomp.makeIterator(Lb).next().value;return xa===Lb}))})};Da.prototype.runEval=function(I,W){var sa=this,xa,Eb;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){xa=sa.client;if(!xa)throw Error("No lively.2lively default client available!");Eb=new Mb.evalStrategies.L2LEvalStrategy(xa,sa.targetId);return Pb.return(Eb.runEval(I,W))})};$jscomp.global.Object.defineProperties(Da.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var I=this.peer,W="l2l "+this.targetId.slice(0,5);if(I){var sa=I.location,
xa=I.type,Eb=I.user;I=I.world;xa&&(W+=", "+xa);sa&&(W+=", "+sa.replace(/^https?:\/\//,"")+(I?"/"+I:""));Eb&&(W+=", "+Eb.name)}return W}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});Mb.L2LCoreInterface=Da;var Yb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Yb.systemInterfaceNamed=pc;Yb.interactivelyCreatePackage=Sa;Yb.interactivelyLoadPackage=ob;Yb.interactivelyReloadPackage=
$b;Yb.interactivelyUnloadPackage=Sb;Yb.interactivelyRemovePackage=Bc;Yb.showExportsAndImportsOf=id;Yb.shortModuleName=Xb;Yb.interactivelyChangeModule=Ub;Yb.interactivelyReloadModule=ub;Yb.interactivelyUnloadModule=hc;Yb.interactivelyRemoveModule=wc;Yb.interactivelyAddModule=bd;Yb.modulesInPackage=cd;Yb.LocalCoreInterface=Na;Yb.HTTPCoreInterface=dc;Yb.L2LCoreInterface=Da;Da=function(I){this.coreInterface=I};Da.prototype.dynamicCompletionsForPrefix=function(I,W,sa){return this.coreInterface.dynamicCompletionsForPrefix(I,
W,sa)};Da.prototype.runEval=function(I,W){return this.coreInterface.runEval(I,W)};Da.prototype.printSystemConfig=function(I,W,sa){return this.coreInterface.printSystemConfig(I,W,sa)};Da.prototype.getConfig=function(I,W,sa){return this.coreInterface.getConfig(I,W,sa)};Da.prototype.getPackages=function(I){return this.coreInterface.getPackages(I)};Da.prototype.getModules=function(I,W,sa){return this.coreInterface.getModules(I,W,sa)};Da.prototype.getModule=function(I,W,sa){return this.coreInterface.getModule(I,
W,sa)};Da.prototype.getPackage=function(I,W,sa){return this.coreInterface.getPackage(I,W,sa)};Da.prototype.getPackageForModule=function(I,W,sa){return this.coreInterface.getPackageForModule(I,W,sa)};Da.prototype.resourcesOfPackage=function(I,W){return this.coreInterface.resourcesOfPackage(I,W)};Da.prototype.systemConfChange=function(I,W,sa){return this.coreInterface.systemConfChange(I,W,sa)};Da.prototype.registerPackage=function(I){return this.coreInterface.registerPackage(I)};Da.prototype.importPackage=
function(I){return this.coreInterface.importPackage(I)};Da.prototype.removePackage=function(I){return this.coreInterface.removePackage(I)};Da.prototype.reloadPackage=function(I){return this.coreInterface.reloadPackage(I)};Da.prototype.packageConfChange=function(I,W){return this.coreInterface.packageConfChange(I,W)};Da.prototype.keyValueListOfVariablesInModule=function(I,W){return this.coreInterface.keyValueListOfVariablesInModule(I,W)};Da.prototype.interactivelyCreatePackage=function(I){return Yb.interactivelyCreatePackage(this.coreInterface,
I)};Da.prototype.interactivelyLoadPackage=function(I,W){return Yb.interactivelyLoadPackage(this.coreInterface,I,W)};Da.prototype.interactivelyReloadPackage=function(I,W){return Yb.interactivelyReloadPackage(this.coreInterface,I,W)};Da.prototype.interactivelyUnloadPackage=function(I,W,sa){return Yb.interactivelyUnloadPackage(this.coreInterface,I,W,sa)};Da.prototype.interactivelyRemovePackage=function(I,W){return Yb.interactivelyRemovePackage(this.coreInterface,I,W)};Da.prototype.isModuleLoaded=function(I,
W){return this.coreInterface.isModuleLoaded(I,W)};Da.prototype.doesModuleExist=function(I,W){return this.coreInterface.doesModuleExist(I,W)};Da.prototype.importModule=function(I){return this.coreInterface.importModule(I)};Da.prototype.forgetModule=function(I,W){return this.coreInterface.forgetModule(I,W)};Da.prototype.reloadModule=function(I,W){return this.coreInterface.reloadModule(I,W)};Da.prototype.moduleFormat=function(I){return this.coreInterface.moduleFormat(I)};Da.prototype.moduleRead=function(I){return this.coreInterface.moduleRead(I)};
Da.prototype.moduleWrite=function(I,W){return this.coreInterface.moduleWrite(I,W)};Da.prototype.getModulesInPackage=function(I){return Yb.modulesInPackage(this.coreInterface,I)};Da.prototype.shortModuleName=function(I,W){return Yb.shortModuleName(this.coreInterface,I,W)};Da.prototype.interactivelyChangeModule=function(I,W,sa){return Yb.interactivelyChangeModule(this.coreInterface,I,W,sa)};Da.prototype.interactivelyReloadModule=function(I,W){return Yb.interactivelyReloadModule(this.coreInterface,I,
W)};Da.prototype.interactivelyUnloadModule=function(I,W){return Yb.interactivelyUnloadModule(this.coreInterface,I,W)};Da.prototype.interactivelyRemoveModule=function(I,W){return Yb.interactivelyRemoveModule(this.coreInterface,I,W)};Da.prototype.interactivelyAddModule=function(I,W){return Yb.interactivelyAddModule(this.coreInterface,I,W)};Da.prototype.showExportsAndImportsOf=function(I,W){return Yb.showExportsAndImportsOf(this.coreInterface,I,W)};Da.prototype.exportsOfModules=function(I){return this.coreInterface.exportsOfModules(I)};
Da.prototype.searchInPackage=function(I,W,sa){return this.coreInterface.searchInPackage(I,W,sa)};Da.prototype.searchInAllPackages=function(I,W){W=void 0===W?{}:W;var sa=this,xa,Eb,Pb,Ha,Lb,xd,vd,Gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ma){switch(Ma.nextAddress){case 1:return(xa=W.progress)&&xa.step("Fetching Packages...",0),Ma.yield(sa.coreInterface.getPackages({excluded:W.excludedPackages}),2);case 2:Eb=Ma.yieldResult,Pb=[],xa&&xa.step("Fetching Packages...",.1),Ha=0;case 3:if(!(Ha<
Eb.length)){Ma.jumpTo(5);break}Lb=Eb[Ha];xd=Lb.url;if(!xd||"no group"===xd){Ma.jumpTo(4);break}xa&&xa.step(xd.replace(System.baseURL,"").slice(0,20),.1+Ha/Eb.length*.9);Ma.setCatchFinallyBlocks(6);return Ma.yield(sa.coreInterface.searchInPackage(xd,I,W),8);case 8:vd=Ma.yieldResult;Pb=Pb.concat(vd);Ma.leaveTryBlock(4);break;case 6:Gc=Ma.enterCatchBlock(),console.error("Error searching in package "+xd+":\n"+Gc.stack);case 4:Ha++;Ma.jumpTo(3);break;case 5:return Ma.return(Pb)}})};Da.prototype.loadMochaTestFile=
function(I,W){return this.coreInterface.loadMochaTestFile(I,W)};Da.prototype.runMochaTests=function(I,W,sa,xa){return this.coreInterface.runMochaTests(I,W,sa,xa)};$jscomp.global.Object.defineProperties(Da.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});ta("Interface",Da);Yb.Interface=Da;Yb.systemInterfaceNamed=pc;Yb.systemInterfaceNamed=pc;Da=ta("localInterface",new Yb.Interface(new Yb.LocalCoreInterface));
Yb.localInterface=Da;Yb.localInterface=Da;Yb.localInterface=Da;Yb.httpInterfaces={};Da=ta("serverInterfaceFor",function(I){return Yb.httpInterfaces[I]||(Yb.httpInterfaces[I]=new Yb.Interface(new Yb.HTTPCoreInterface(I)))});Yb.serverInterfaceFor=Da;Yb.serverInterfaceFor=Da;Yb.serverInterfaceFor=Da;Yb.l2lInterfaces={};Da=ta("l2lInterfaceFor",function(I,W){return Yb.l2lInterfaces[I]||(Yb.l2lInterfaces[I]=new Yb.Interface(new Yb.L2LCoreInterface(I,W)))});Yb.l2lInterfaceFor=Da;Yb.l2lInterfaceFor=Da;Yb.l2lInterfaceFor=
Da}}});