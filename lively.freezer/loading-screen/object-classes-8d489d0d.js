System.register(["./__root_module__-f9290433.js","kld-intersections"],function(sa){var db,Eb,Vb,Wb,wd,Ic,Ad,Jc,Mc,bd,ed,Od,qd,Xc,Ra;return{setters:[function(wb){db=wb.s;Eb=wb.P;Vb=wb.a4;Wb=wb.p;wd=wb.bD;Ic=wb.B;Ad=wb.bE;Jc=wb.r;Mc=wb.aQ;bd=wb.bF;ed=wb.bG;Od=wb.bH;qd=wb.bI;Xc=wb.bJ;Ra=wb.n},function(){}],execute:function(){function wb(zc,Fc,Jb,Ac){Ac=void 0===Ac?{}:Ac;Ac=Ac.package||dc.ObjectPackage.lookupPackageForObject(zc,Ac);if(!Ac)throw Error("Object is not part of an object package: "+zc);
return Ac.addScript(zc,Fc,Jb)}function mc(zc,Fc){Fc=dc.normalizeOptions(Fc).System;zc=(zc=zc[Symbol.for("lively-module-meta")])?zc.package.name:null;return(Fc=(zc?dc.lookupPackage(Fc,zc):{}).pkg)?!!dc.ObjectPackage.forSystemPackage(Fc):!1}sa({addScript:wb,isObjectClass:mc});var dc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");dc.normalizeOptions=function(zc){zc=Object.assign({baseURL:dc.defaultBaseURL,System:System},zc);zc.baseURL=zc.baseURL.replace(/\/$/,"");return zc};dc.addScript=
wb;dc.isObjectClass=mc;dc.string=db;dc.Path=Eb;dc.arr=Vb;dc.parse=Wb;dc.isValidIdentifier=wd;dc.stringify=Ic;dc.parseFunction=Ad;dc.resource=Jc;dc.runEval=Mc;dc.scripting=bd;dc.ExportLookup=ed;var Rc=dc.scripting;dc.ensurePackage=Rc.ensurePackage;dc.registerPackage=Rc.registerPackage;dc.importPackage=Rc.importPackage;dc.lookupPackage=Rc.lookupPackage;dc.module=Rc.module;dc.ImportInjector=Rc.ImportInjector;dc.RuntimeSourceDescriptor=Od;dc.toJsIdentifier=qd;dc.adoptObject=Xc;dc.classToFunctionTransform=
Ra;dc.objectPackageSym=Symbol.for("lively-object-package-data");dc.defaultBaseURL="local://lively-object-modules";dc.globalClasses=Object.keys(System.global).map(function(zc){zc=System.global[zc];return"function"===typeof zc&&zc.name&&zc}).filter(Boolean);dc.addScript=wb;dc.addScript=wb;dc.isObjectClass=mc;dc.isObjectClass=mc;dc._packageStore=dc._packageStore||{};Rc=function(zc,Fc){this._id=zc;this.options=dc.normalizeOptions(Fc)};Rc.lookupPackageForObject=function(zc,Fc){return this.lookupPackageForClass(zc.constructor,
Fc)};Rc.lookupPackageForClass=function(zc,Fc){Fc=dc.normalizeOptions(Fc).System;zc=(zc=zc[Symbol.for("lively-module-meta")])?zc.package.name:null;return(Fc=(zc?dc.lookupPackage(Fc,zc):{}).pkg)?dc.ObjectPackage.forSystemPackage(Fc):null};Rc.forSystemPackage=function(zc){return this.packageStore[zc.name]};Rc.withId=function(zc,Fc){return this.packageStore[zc]||(this.packageStore[zc]=new this(zc,Fc))};Rc.prototype.resource=function(zc){zc=void 0===zc?"":zc;return dc.resource(this.packageURL).join(zc)};
Rc.prototype.load=function(){return dc.importPackage(this.System,this.packageURL)};Rc.prototype.ensureExistance=function(){var zc=this,Fc,Jb,Ac,Bc,fd,Qb,xb,eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){switch(vb.nextAddress){case 1:return Fc=zc.resource("/"),vb.yield(Fc.exists(),2);case 2:if(vb.yieldResult)return vb.return();Jb=[{resource:Fc}];Ac=[{resource:zc.resource("package.json"),content:JSON.stringify(zc.config,null,2)}];return vb.yield(Promise.all(Jb.map(function(Va){return Va.resource.mkdir()})),
3);case 3:return vb.yield(Promise.all(Ac.map(function(Va){var lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yb){switch(yb.nextAddress){case 1:return yb.yield(Va.resource.exists(),2);case 2:if(!(lb=!yb.yieldResult)){yb.jumpTo(3);break}return yb.yield(Va.resource.write(Va.content),4);case 4:lb=yb.yieldResult;case 3:return yb.return(lb)}})})),4);case 4:return vb.yield(zc.objectModule.ensureExistance(),5);case 5:return Bc=zc,fd=Bc.System,Qb=Bc.packageURL,xb=Bc.config,vb.yield(dc.ensurePackage(fd,
Qb),6);case 6:return eb=vb.yieldResult,eb.registerWithConfig(xb),console.log(zc.packageURL+" REGISTERED"),vb.return(zc)}})};Rc.prototype.ensureObjectClass=function(zc){var Fc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jb){return 1==Jb.nextAddress?Jb.yield(Fc.ensureExistance(),2):Jb.return(Fc.objectModule.ensureObjectClass(zc))})};Rc.prototype.adoptObject=function(zc){var Fc=this,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ac){if(1==Ac.nextAddress)return Fc.objectClass===
zc.constructor?Ac.return():Ac.yield(Fc.ensureObjectClass(zc.constructor),2);Jb=Ac.yieldResult;dc.adoptObject(zc,Jb);Ac.jumpToEnd()})};Rc.prototype.addScript=function(zc,Fc,Jb){return this.objectModule.addScript(zc,Fc,Jb)};Rc.prototype.remove=function(){this.systemPackage.remove();delete dc.ObjectPackage.packageStore[this.id];return this.resource().remove()};Rc.prototype.renameObjectClass=function(zc,Fc){Fc=void 0===Fc?[]:Fc;var Jb=this,Ac,Bc,fd,Qb,xb,eb,vb,Va,lb,yb,Zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){if(1==
Sb.nextAddress){Ac=Jb;Bc=Ac.objectClass;fd=Ac.System;if(!Bc||Bc.className===zc)return Sb.return(Bc);if(!dc.isValidIdentifier(zc))throw Error(zc+" is not a valid name for a class");xb=Qb=dc.RuntimeSourceDescriptor.for(Bc,fd);eb=xb.source;vb=xb.ast;Va=vb.id;lb=Va.start;yb=Va.end;return Sb.yield(Qb.changeSource(eb.slice(0,lb)+zc+eb.slice(yb)),2)}Zb=Jb.objectClass;Fc.forEach(function($a){$a.constructor=Zb;$a.__proto__=Zb.prototype});return Sb.return(Zb)})};Rc.prototype.fork=function(zc,Fc){var Jb=this,
Ac,Bc,fd,Qb,xb,eb,vb,Va,lb,yb,Zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){switch(Sb.nextAddress){case 1:return Ac=Jb,Bc=Ac.System,fd=Ac.baseURL,Qb=Ac.objectClass,Fc=Object.assign({System:Bc,baseURL:fd},Fc),xb=dc.RuntimeSourceDescriptor.for(Qb),eb=xb._renamedSource(zc),vb=eb.moduleSource,Va=dc.ObjectPackage.withId(zc,Fc),Sb.yield(Va.ensureExistance(),2);case 2:return lb=Va,yb=lb.objectModule,Zb=yb.systemModule,Sb.yield(Zb.load({format:"esm"}),3);case 3:return Sb.yield(Zb.changeSource(vb),
4);case 4:return Sb.return(Va)}})};$jscomp.global.Object.defineProperties(Rc.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return dc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new dc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(Rc,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=dc._packageStore)}}});sa("default",Rc);dc.ObjectPackage=Rc;var Tc=function(zc,Fc){if(!zc)throw Error("ObjectModule needs package!");if(!Fc)throw Error("ObjectModule needs package!");this._moduleName=zc;this._objectPackage=Fc};Tc.prototype.read=function(){return this.resource.read()};Tc.prototype.write=function(zc){return this.resource.write(zc)};Tc.prototype.ensureExistance=function(){var zc=
this,Fc,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ac){switch(Ac.nextAddress){case 1:return Fc=zc.resource,Ac.yield(Fc.exists(),2);case 2:if(Ac.yieldResult){Ac.jumpTo(3);break}return Ac.yield(Fc.write("'format esm';\n"),4);case 4:Jb={},zc.System.config({meta:(Jb[zc.url]={format:"esm"},Jb)});case 3:return Ac.return(zc)}})};Tc.prototype.ensureObjectClass=function(zc){var Fc=this,Jb=this.objectClass;return Jb&&Jb.prototype.__proto__===zc.prototype?Jb:Promise.resolve(this.ensureObjectClassSource(zc)).then(function(Ac){var Bc=
Ac.source,fd=Ac.moduleId,Qb=Ac.className,xb=Ac.bindings,eb=Fc.System;Ac=dc.module(eb,fd);if(xb)for(var vb in xb)Ac.define(vb,xb[vb]);Bc=dc.runEval(Bc,{classTransform:dc.classToFunctionTransform,sync:!0,targetModule:fd,System:eb});if(Bc.isError)throw Bc.value;Bc=Ac.recorder[Qb];if(!Bc)throw Error("Failed to define class "+Qb+" in "+fd);return Bc})};Tc.prototype.ensureObjectClassSource=function(zc){return this.createDefaultClassDeclaration(zc)};Tc.prototype.createDefaultClassDeclaration=function(zc){zc=
void 0===zc?Object:zc;var Fc=this,Jb,Ac,Bc,fd,Qb,xb,eb,vb,Va,lb,yb,Zb,Sb,$a,bb,Kb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){switch(wc.nextAddress){case 1:Jb=Fc;Ac=Jb.System;Bc=Jb.systemModule;fd=Jb.objectPackage;Qb=dc.string.capitalize(dc.toJsIdentifier(fd.id));xb=zc.className;eb=!xb;vb=dc.globalClasses.includes(zc);Va="";lb=null;if(eb){xb="__anonymous_superclass__";yb={};lb=(yb[xb]=zc,yb);wc.jumpTo(2);break}if(vb){wc.jumpTo(2);break}return wc.yield(dc.ExportLookup.findExportOfValue(zc,
Ac),4);case 4:(Zb=wc.yieldResult)?(Sb=dc.ImportInjector.run(Ac,Bc.id,Bc.package(),"",Zb),$a=Sb.standaloneImport,Va+=$a+"\n\n"):(bb={},lb=(bb[xb]=zc,bb));case 2:return Qb===xb&&(Qb="Object"+Qb),Kb="Object"===xb?"class "+Qb+" {}\n":"class "+Qb+" extends "+xb+" {}\n",Va+="export default "+Kb+"\n",wc.yield(Bc.changeSource(Va),5);case 5:return wc.yield(Bc.load(),6);case 6:return wc.return({source:Va,className:Qb,moduleId:Fc.url,bindings:lb})}})};Tc.prototype.addScript=function(zc,Fc,Jb){var Ac=this,Bc,
fd,Qb,xb,eb,vb,Va,lb,yb,Zb,Sb,$a,bb,Kb,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:if(zc.constructor===Ac.objectClass){Bc=zc.constructor;fc.jumpTo(2);break}return fc.yield(Ac.ensureObjectClass(zc.constructor),3);case 3:Bc=fc.yieldResult;case 2:fd=Bc;Qb="function"===typeof Fc?String(Fc):Fc;xb=dc.parseFunction(Qb);eb=dc.RuntimeSourceDescriptor.for(fd,Ac.System);Jb||(Jb=dc.Path("id.name").get(xb));if(!Jb)throw Error("No name, cannot add "+dc.string.truncate(Qb,
30).replace(/\n/g,"")+"!");vb=dc.toJsIdentifier(Jb);console.assert("FunctionExpression"===xb.type||"ArrowFunctionExpression"===xb.type,"not a function expression but: "+xb.type);Va=xb.params.map(function(bc){return Qb.slice(bc.start,bc.end)});lb="BlockStatement"===xb.body.type?Qb.slice(xb.body.start,xb.body.end):"{ return "+Qb.slice(xb.body.start,xb.body.end)+" }";yb=vb+"("+Va.join(",")+") "+lb;"ArrowFunctionExpression"===xb.type&&(xb.type="FunctionExpression");Zb=eb.source;Sb=eb.ast;if(!Sb)throw Error("cannot find class decl of "+
eb.module.id);($a=Sb.body.body.find(function(bc){return bc.key.name===vb&&!bc.static}))?Zb=Zb.slice(0,$a.start)+yb+Zb.slice($a.end):(bb=Zb.lastIndexOf("}"),Kb=Zb.slice(0,bb),wc=Zb.slice(bb),/\n\s*$/m.test(Kb)||(Kb+="\n"),yb=dc.string.changeIndent(yb,"  ",1),/^[ ]*\n/m.test(wc)||(wc="\n"+wc),Zb=Kb+yb+wc);return fc.yield(eb.changeSource(Zb),4);case 4:return fc.return({script:fd.prototype[vb],klass:fd,module:eb.module.id,methodName:vb})}})};$jscomp.global.Object.defineProperties(Tc.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var zc=this.systemModule;return zc.isLoaded()?zc.System.get(zc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return dc.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});dc.ObjectModule=Tc;dc.default=Rc}}});