System.register(["./__root_module__-c4d7431e.js","kld-intersections"],function(ta){var nb,Bb,Vb,Qb,Dd,Ic,ud,Nc;return{setters:[function(Jc){nb=Jc.s;Bb=Jc._;Vb=Jc.bj;Qb=Jc.bk;Dd=Jc.as;Ic=Jc.a6;ud=Jc.bl;Nc=Jc.ao},function(){}],execute:function(){function Jc(){function oa(db,jb){var gc={};jb.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Qc,Oc,Xb){Oc&&(gc[Oc]=Xb)});return gc}if(Za)return qc;Za=!0;var bb=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
mb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return qc=function(db){var jb=db,gc=db.indexOf("["),Qc=db.indexOf("]");-1!=gc&&-1!=Qc&&(db=db.substring(0,gc)+db.substring(gc,Qc).replace(/:/g,";")+db.substring(Qc,db.length));var Oc=bb.exec(db||"");db={};for(var Xb=14;Xb--;)db[mb[Xb]]=Oc[Xb]||"";-1!=gc&&-1!=Qc&&(db.source=jb,db.host=db.host.substring(1,db.host.length-1).replace(/;/g,":"),db.authority=db.authority.replace("[","").replace("]",
"").replace(/;/g,":"),db.ipv6uri=!0);jb=db.path;gc=jb.replace(/\/{2,9}/g,"/").split("/");"/"!=jb.substr(0,1)&&0!==jb.length||gc.splice(0,1);"/"==jb.substr(jb.length-1,1)&&gc.splice(gc.length-1,1);db.pathNames=gc;db.queryKey=oa(db,db.query);return db}}function Xc(){function oa(jb){jb=String(jb);if(!(100<jb.length)&&(jb=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(jb))){var gc=parseFloat(jb[1]);switch((jb[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return gc*
db;case "days":case "day":case "d":return gc*mb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*gc;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*gc;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*gc;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return gc}}}function bb(jb,gc,Qc){if(!(jb<gc))return jb<1.5*gc?Math.floor(jb/gc)+" "+Qc:Math.ceil(jb/gc)+" "+Qc+"s"}if(Qa)return Pa;Qa=!0;var mb=864E5,db=365.25*
mb;return Pa=function(jb,gc){gc=gc||{};var Qc=typeof jb;if("string"===Qc&&0<jb.length)return oa(jb);if("number"===Qc&&!1===isNaN(jb))return gc.long?bb(jb,mb,"day")||bb(jb,36E5,"hour")||bb(jb,6E4,"minute")||bb(jb,1E3,"second")||jb+" ms":jb>=mb?Math.round(jb/mb)+"d":36E5<=jb?Math.round(jb/36E5)+"h":6E4<=jb?Math.round(jb/6E4)+"m":1E3<=jb?Math.round(jb/1E3)+"s":jb+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(jb));}}function id(){function oa(db){var jb=0,gc;for(gc in db)jb=
(jb<<5)-jb+db.charCodeAt(gc),jb|=0;return Hb.colors[Math.abs(jb)%Hb.colors.length]}function bb(db){function jb(){if(jb.enabled){var Qc=+new Date;jb.diff=Qc-(gc||Qc);jb.prev=gc;gc=jb.curr=Qc;var Oc=Array(arguments.length);for(Qc=0;Qc<Oc.length;Qc++)Oc[Qc]=arguments[Qc];Oc[0]=Hb.coerce(Oc[0]);"string"!==typeof Oc[0]&&Oc.unshift("%O");var Xb=0;Oc[0]=Oc[0].replace(/%([a-zA-Z%])/g,function(Ub,uc){if("%%"===Ub)return Ub;Xb++;uc=Hb.formatters[uc];"function"===typeof uc&&(Ub=uc.call(jb,Oc[Xb]),Oc.splice(Xb,
1),Xb--);return Ub});Hb.formatArgs.call(jb,Oc);(jb.log||Hb.log||console.log.bind(console)).apply(jb,Oc)}}var gc;jb.namespace=db;jb.enabled=Hb.enabled(db);jb.useColors=Hb.useColors();jb.color=oa(db);jb.destroy=mb;"function"===typeof Hb.init&&Hb.init(jb);Hb.instances.push(jb);return jb}function mb(){var db=Hb.instances.indexOf(this||ad);return-1!==db?(Hb.instances.splice(db,1),!0):!1}if(Gb)return Hb;Gb=!0;Hb=Hb=bb.debug=bb["default"]=bb;Hb.coerce=function(db){return db instanceof Error?db.stack||db.message:
db};Hb.disable=function(){Hb.enable("")};Hb.enable=function(db){Hb.save(db);Hb.names=[];Hb.skips=[];var jb,gc=("string"===typeof db?db:"").split(/[\s,]+/),Qc=gc.length;for(jb=0;jb<Qc;jb++)gc[jb]&&(db=gc[jb].replace(/\*/g,".*?"),"-"===db[0]?Hb.skips.push(new RegExp("^"+db.substr(1)+"$")):Hb.names.push(new RegExp("^"+db+"$")));for(jb=0;jb<Hb.instances.length;jb++)db=Hb.instances[jb],db.enabled=Hb.enabled(db.namespace)};Hb.enabled=function(db){if("*"===db[db.length-1])return!0;var jb;var gc=0;for(jb=
Hb.skips.length;gc<jb;gc++)if(Hb.skips[gc].test(db))return!1;gc=0;for(jb=Hb.names.length;gc<jb;gc++)if(Hb.names[gc].test(db))return!0;return!1};Hb.humanize=Xc();Hb.instances=[];Hb.names=[];Hb.skips=[];Hb.formatters={};return Hb}function Fd(){function oa(){try{var jb=Td.storage.debug}catch(gc){}!jb&&"undefined"!==typeof bb&&"env"in bb&&(jb=bb.env.DEBUG);return jb}if(Zd)return Td;Zd=!0;var bb=Vb;Td=Td=id();Td.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};Td.formatArgs=function(jb){var gc=(this||Ue).useColors;jb[0]=(gc?"%c":"")+(this||Ue).namespace+(gc?" %c":" ")+jb[0]+(gc?"%c ":" ")+"+"+Td.humanize((this||Ue).diff);if(gc){gc="color: "+(this||Ue).color;jb.splice(1,0,gc,"color: inherit");var Qc=0,Oc=0;jb[0].replace(/%[a-zA-Z%]/g,function(Xb){"%%"!==Xb&&(Qc++,"%c"===Xb&&(Oc=Qc))});jb.splice(Oc,0,gc)}};Td.save=function(jb){try{null==jb?Td.storage.removeItem("debug"):Td.storage.debug=jb}catch(gc){}};Td.load=oa;Td.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var mb=Td;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var db=chrome.storage.local;else a:{try{db=window.localStorage;break a}catch(jb){}db=void 0}mb.storage=db;Td.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
Td.formatters.j=function(jb){try{return JSON.stringify(jb)}catch(gc){return"[UnexpectedJSONParseError]: "+gc.message}};Td.enable(oa());return Td}function nd(){if(Md)return Fc;Md=!0;var oa=Jc(),bb=Fd()("socket.io-client:url");return Fc=function(mb,db){var jb=mb;db=db||"undefined"!==typeof location&&location;null==mb&&(mb=db.protocol+"//"+db.host);"string"===typeof mb&&("/"===mb.charAt(0)&&(mb="/"===mb.charAt(1)?db.protocol+mb:db.host+mb),/^(https?|wss?):\/\//.test(mb)||(bb("protocol-less url %s",mb),
mb="undefined"!==typeof db?db.protocol+"//"+mb:"https://"+mb),bb("parse %s",mb),jb=oa(mb));jb.port||(/^(http|ws)$/.test(jb.protocol)?jb.port="80":/^(http|ws)s$/.test(jb.protocol)&&(jb.port="443"));jb.path=jb.path||"/";mb=-1!==jb.host.indexOf(":")?"["+jb.host+"]":jb.host;jb.id=jb.protocol+"://"+mb+":"+jb.port;jb.href=jb.protocol+"://"+mb+(db&&db.port===jb.port?"":":"+jb.port);return jb}}function Yc(){function oa(bb){if(bb){for(var mb in oa.prototype)bb[mb]=oa.prototype[mb];return bb}}if(Ib)return fd;
Ib=!0;fd=oa;oa.prototype.on=oa.prototype.addEventListener=function(bb,mb){(this||fa)._callbacks=(this||fa)._callbacks||{};((this||fa)._callbacks["$"+bb]=(this||fa)._callbacks["$"+bb]||[]).push(mb);return this||fa};oa.prototype.once=function(bb,mb){function db(){this.off(bb,db);mb.apply(this||fa,arguments)}db.fn=mb;this.on(bb,db);return this||fa};oa.prototype.off=oa.prototype.removeListener=oa.prototype.removeAllListeners=oa.prototype.removeEventListener=function(bb,mb){(this||fa)._callbacks=(this||
fa)._callbacks||{};if(0==arguments.length)return(this||fa)._callbacks={},this||fa;var db=(this||fa)._callbacks["$"+bb];if(!db)return this||fa;if(1==arguments.length)return delete (this||fa)._callbacks["$"+bb],this||fa;for(var jb,gc=0;gc<db.length;gc++)if(jb=db[gc],jb===mb||jb.fn===mb){db.splice(gc,1);break}0===db.length&&delete (this||fa)._callbacks["$"+bb];return this||fa};oa.prototype.emit=function(bb){(this||fa)._callbacks=(this||fa)._callbacks||{};for(var mb=Array(arguments.length-1),db=(this||
fa)._callbacks["$"+bb],jb=1;jb<arguments.length;jb++)mb[jb-1]=arguments[jb];if(db){db=db.slice(0);jb=0;for(var gc=db.length;jb<gc;++jb)db[jb].apply(this||fa,mb)}return this||fa};oa.prototype.listeners=function(bb){(this||fa)._callbacks=(this||fa)._callbacks||{};return(this||fa)._callbacks["$"+bb]||[]};oa.prototype.hasListeners=function(bb){return!!this.listeners(bb).length};return fd}function Ta(){if(tb)return ma;tb=!0;var oa={}.toString;return ma=Array.isArray||function(bb){return"[object Array]"==
oa.call(bb)}}function sb(){if(ka)return H;ka=!0;var oa=Qb.Buffer;H=function(db){var jb;!(jb=bb&&oa.isBuffer(db))&&(jb=mb)&&((jb=db instanceof ArrayBuffer)||(jb="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(db):db.buffer instanceof ArrayBuffer));return jb};var bb="function"===typeof oa&&"function"===typeof oa.isBuffer,mb="function"===typeof ArrayBuffer;return H}function dc(){function oa(Oc,Xb){if(!Oc)return Oc;if(db(Oc)){var Ub={_placeholder:!0,num:Xb.length};Xb.push(Oc);return Ub}if(mb(Oc)){Ub=
Array(Oc.length);for(var uc=0;uc<Oc.length;uc++)Ub[uc]=oa(Oc[uc],Xb);return Ub}if("object"===typeof Oc&&!(Oc instanceof Date)){Ub={};for(uc in Oc)Ub[uc]=oa(Oc[uc],Xb);return Ub}return Oc}function bb(Oc,Xb){if(!Oc)return Oc;if(Oc&&Oc._placeholder)return Xb[Oc.num];if(mb(Oc))for(var Ub=0;Ub<Oc.length;Ub++)Oc[Ub]=bb(Oc[Ub],Xb);else if("object"===typeof Oc)for(Ub in Oc)Oc[Ub]=bb(Oc[Ub],Xb);return Oc}if(rb)return Ca;rb=!0;var mb=Ta(),db=sb(),jb=Object.prototype.toString,gc="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===jb.call(Blob),Qc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===jb.call(File);Ca.deconstructPacket=function(Oc){var Xb=[];Oc.data=oa(Oc.data,Xb);Oc.attachments=Xb.length;return{packet:Oc,buffers:Xb}};Ca.reconstructPacket=function(Oc,Xb){Oc.data=bb(Oc.data,Xb);Oc.attachments=void 0;return Oc};Ca.removeBlobs=function(Oc,Xb){function Ub(Lc,Ed,pe){if(!Lc)return Lc;if(gc&&Lc instanceof Blob||Qc&&Lc instanceof File){uc++;var vd=
new FileReader;vd.onload=function(){pe?pe[Ed]=(this||sc).result:eb=(this||sc).result;--uc||Xb(eb)};vd.readAsArrayBuffer(Lc)}else if(mb(Lc))for(vd=0;vd<Lc.length;vd++)Ub(Lc[vd],vd,Lc);else if("object"===typeof Lc&&!db(Lc))for(vd in Lc)Ub(Lc[vd],vd,Lc)}var uc=0,eb=Oc;Ub(eb);uc||Xb(eb)};return Ca}function ac(){function oa(){}function bb(eb){var Lc=""+eb.type;if(Ac.BINARY_EVENT===eb.type||Ac.BINARY_ACK===eb.type)Lc+=eb.attachments+"-";eb.nsp&&"/"!==eb.nsp&&(Lc+=eb.nsp+",");null!=eb.id&&(Lc+=eb.id);if(null!=
eb.data){try{var Ed=JSON.stringify(eb.data)}catch(pe){Ed=!1}if(!1!==Ed)Lc+=Ed;else return uc}gc("encoded %j as %s",eb,Lc);return Lc}function mb(eb,Lc){Oc.removeBlobs(eb,function(Ed){var pe=Oc.deconstructPacket(Ed);Ed=bb(pe.packet);pe=pe.buffers;pe.unshift(Ed);Lc(pe)})}function db(){(this||kd).reconstructor=null}function jb(eb){(this||kd).reconPack=eb;(this||kd).buffers=[]}if(Bd)return Ac;Bd=!0;var gc=Fd()("socket.io-parser"),Qc=Yc(),Oc=dc(),Xb=Ta(),Ub=sb();Ac.protocol=4;Ac.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
Ac.CONNECT=0;Ac.DISCONNECT=1;Ac.EVENT=2;Ac.ACK=3;Ac.ERROR=4;Ac.BINARY_EVENT=5;Ac.BINARY_ACK=6;Ac.Encoder=oa;Ac.Decoder=db;var uc=Ac.ERROR+'"encode error"';oa.prototype.encode=function(eb,Lc){gc("encoding packet %j",eb);Ac.BINARY_EVENT===eb.type||Ac.BINARY_ACK===eb.type?mb(eb,Lc):(eb=bb(eb),Lc([eb]))};Qc(db.prototype);db.prototype.add=function(eb){if("string"===typeof eb){a:{var Lc=0,Ed={type:Number(eb.charAt(0))};if(null==Ac.types[Ed.type])eb={type:Ac.ERROR,data:"parser error: unknown packet type "+
Ed.type};else{if(Ac.BINARY_EVENT===Ed.type||Ac.BINARY_ACK===Ed.type){for(var pe="";"-"!==eb.charAt(++Lc)&&(pe+=eb.charAt(Lc),Lc!=eb.length););if(pe!=Number(pe)||"-"!==eb.charAt(Lc))throw Error("Illegal attachments");Ed.attachments=Number(pe)}if("/"===eb.charAt(Lc+1))for(Ed.nsp="";++Lc;){pe=eb.charAt(Lc);if(","===pe)break;Ed.nsp+=pe;if(Lc===eb.length)break}else Ed.nsp="/";pe=eb.charAt(Lc+1);if(""!==pe&&Number(pe)==pe){for(Ed.id="";++Lc;){pe=eb.charAt(Lc);if(null==pe||Number(pe)!=pe){--Lc;break}Ed.id+=
eb.charAt(Lc);if(Lc===eb.length)break}Ed.id=Number(Ed.id)}if(eb.charAt(++Lc)){Lc=eb.substr(Lc);try{var vd=JSON.parse(Lc)}catch(ee){vd=!1}if(!1===vd||Ed.type!==Ac.ERROR&&!Xb(vd)){eb={type:Ac.ERROR,data:"parser error: invalid payload"};break a}else Ed.data=vd}gc("decoded %s as %j",eb,Ed);eb=Ed}}Ac.BINARY_EVENT===eb.type||Ac.BINARY_ACK===eb.type?((this||kd).reconstructor=new jb(eb),0===(this||kd).reconstructor.reconPack.attachments&&this.emit("decoded",eb)):this.emit("decoded",eb)}else if(Ub(eb)||eb.base64)if((this||
kd).reconstructor){if(eb=(this||kd).reconstructor.takeBinaryData(eb))(this||kd).reconstructor=null,this.emit("decoded",eb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+eb);};db.prototype.destroy=function(){(this||kd).reconstructor&&(this||kd).reconstructor.finishedReconstruction()};jb.prototype.takeBinaryData=function(eb){(this||kd).buffers.push(eb);return(this||kd).buffers.length===(this||kd).reconPack.attachments?(eb=Oc.reconstructPacket((this||
kd).reconPack,(this||kd).buffers),this.finishedReconstruction(),eb):null};jb.prototype.finishedReconstruction=function(){(this||kd).reconPack=null;(this||kd).buffers=[]};return Ac}function Vc(){if(Ve)return Nd;Ve=!0;return Nd="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function Hd(){if(vf)return Ke;vf=!0;if(!td){td=!0;try{ue="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(mb){ue=!1}}var oa=ue;var bb=Vc();return Ke=function(mb){var db=
mb.xdomain,jb=mb.xscheme;mb=mb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!db||oa))return new XMLHttpRequest}catch(gc){}try{if("undefined"!==typeof XDomainRequest&&!jb&&mb)return new XDomainRequest}catch(gc){}if(!db)try{return new (bb[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(gc){}}}function hc(){if(zc)return Ye;zc=!0;return Ye=Object.keys||function(oa){var bb=[],mb=Object.prototype.hasOwnProperty,db;for(db in oa)mb.call(oa,db)&&bb.push(db);return bb}}function kc(){function oa(Qc){if(!Qc||
"object"!==typeof Qc)return!1;if(mb(Qc)){for(var Oc=0,Xb=Qc.length;Oc<Xb;Oc++)if(oa(Qc[Oc]))return!0;return!1}if("function"===typeof bb&&bb.isBuffer&&bb.isBuffer(Qc)||"function"===typeof ArrayBuffer&&Qc instanceof ArrayBuffer||jb&&Qc instanceof Blob||gc&&Qc instanceof File)return!0;if(Qc.toJSON&&"function"===typeof Qc.toJSON&&1===arguments.length)return oa(Qc.toJSON(),!0);for(Oc in Qc)if(Object.prototype.hasOwnProperty.call(Qc,Oc)&&oa(Qc[Oc]))return!0;return!1}if(If)return Ze;If=!0;var bb=Qb.Buffer,
mb=Ta(),db=Object.prototype.toString,jb="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===db.call(Blob),gc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===db.call(File);return Ze=oa}function xb(){if(Ce)return Kf;Ce=!0;return Kf=function(oa,bb,mb){var db=oa.byteLength;bb=bb||0;mb=mb||db;if(oa.slice)return oa.slice(bb,mb);0>bb&&(bb+=db);0>mb&&(mb+=db);mb>db&&(mb=db);if(bb>=db||bb>=mb||0===db)return new ArrayBuffer(0);oa=new Uint8Array(oa);
db=new Uint8Array(mb-bb);for(var jb=0;bb<mb;bb++,jb++)db[jb]=oa[bb];return db.buffer}}function yb(){function oa(){}if(La)return wa;La=!0;return wa=function(bb,mb,db){function jb(Qc,Oc){if(0>=jb.count)throw Error("after called too many times");--jb.count;Qc?(gc=!0,mb(Qc),mb=db):0!==jb.count||gc||mb(null,Oc)}var gc=!1;db=db||oa;jb.count=bb;return 0===bb?mb():jb}}function wc(){function oa(Xb){for(var Ub=[],uc=0,eb=Xb.length,Lc,Ed;uc<eb;)Lc=Xb.charCodeAt(uc++),55296<=Lc&&56319>=Lc&&uc<eb?(Ed=Xb.charCodeAt(uc++),
56320==(Ed&64512)?Ub.push(((Lc&1023)<<10)+(Ed&1023)+65536):(Ub.push(Lc),uc--)):Ub.push(Lc);return Ub}function bb(Xb,Ub){if(55296<=Xb&&57343>=Xb){if(Ub)throw Error("Lone surrogate U+"+Xb.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function mb(){if(Oc>=Qc)throw Error("Invalid byte index");var Xb=gc[Oc]&255;Oc++;if(128==(Xb&192))return Xb&63;throw Error("Invalid continuation byte");}function db(Xb){if(Oc>Qc)throw Error("Invalid byte index");if(Oc==Qc)return!1;var Ub=gc[Oc]&
255;Oc++;if(0==(Ub&128))return Ub;if(192==(Ub&224)){var uc=mb();Ub=(Ub&31)<<6|uc;if(128<=Ub)return Ub;throw Error("Invalid continuation byte");}if(224==(Ub&240)){uc=mb();var eb=mb();Ub=(Ub&15)<<12|uc<<6|eb;if(2048<=Ub)return bb(Ub,Xb)?Ub:65533;throw Error("Invalid continuation byte");}if(240==(Ub&248)&&(uc=mb(),eb=mb(),Xb=mb(),Ub=(Ub&7)<<18|uc<<12|eb<<6|Xb,65536<=Ub&&1114111>=Ub))return Ub;throw Error("Invalid UTF-8 detected");}if(S)return pb;S=!0;var jb=String.fromCharCode,gc,Qc,Oc;return pb={version:"2.1.2",
encode:function(Xb,Ub){Ub=Ub||{};Ub=!1!==Ub.strict;Xb=oa(Xb);for(var uc=Xb.length,eb=-1,Lc,Ed="";++eb<uc;){Lc=Xb[eb];var pe=Ub;if(0==(Lc&4294967168))Lc=jb(Lc);else{var vd="";0==(Lc&4294965248)?vd=jb(Lc>>6&31|192):0==(Lc&4294901760)?(bb(Lc,pe)||(Lc=65533),vd=jb(Lc>>12&15|224),vd+=jb(Lc>>6&63|128)):0==(Lc&4292870144)&&(vd=jb(Lc>>18&7|240),vd+=jb(Lc>>12&63|128),vd+=jb(Lc>>6&63|128));Lc=vd+=jb(Lc&63|128)}Ed+=Lc}return Ed},decode:function(Xb,Ub){Ub=Ub||{};Ub=!1!==Ub.strict;gc=oa(Xb);Qc=gc.length;Oc=0;
Xb=[];for(var uc;!1!==(uc=db(Ub));)Xb.push(uc);Ub=Xb.length;uc=-1;for(var eb,Lc="";++uc<Ub;)eb=Xb[uc],65535<eb&&(eb-=65536,Lc+=jb(eb>>>10&1023|55296),eb=56320|eb&1023),Lc+=jb(eb);return Lc}}}function Kc(){if(Xa)return xa;Xa=!0;(function(oa){xa.encode=function(bb){bb=new Uint8Array(bb);var mb,db=bb.length,jb="";for(mb=0;mb<db;mb+=3)jb+=oa[bb[mb]>>2],jb+=oa[(bb[mb]&3)<<4|bb[mb+1]>>4],jb+=oa[(bb[mb+1]&15)<<2|bb[mb+2]>>6],jb+=oa[bb[mb+2]&63];2===db%3?jb=jb.substring(0,jb.length-1)+"=":1===db%3&&(jb=jb.substring(0,
jb.length-2)+"==");return jb};xa.decode=function(bb){var mb=.75*bb.length,db=bb.length,jb=0;"="===bb[bb.length-1]&&(mb--,"="===bb[bb.length-2]&&mb--);var gc=new ArrayBuffer(mb),Qc=new Uint8Array(gc);for(mb=0;mb<db;mb+=4){var Oc=oa.indexOf(bb[mb]);var Xb=oa.indexOf(bb[mb+1]);var Ub=oa.indexOf(bb[mb+2]);var uc=oa.indexOf(bb[mb+3]);Qc[jb++]=Oc<<2|Xb>>4;Qc[jb++]=(Xb&15)<<4|Ub>>2;Qc[jb++]=(Ub&3)<<6|uc&63}return gc}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return xa}function zb(){function oa(Oc){return Oc.map(function(Xb){if(Xb.buffer instanceof
ArrayBuffer){var Ub=Xb.buffer;if(Xb.byteLength!==Ub.byteLength){var uc=new Uint8Array(Xb.byteLength);uc.set(new Uint8Array(Ub,Xb.byteOffset,Xb.byteLength));Ub=uc.buffer}return Ub}return Xb})}function bb(Oc,Xb){Xb=Xb||{};var Ub=new db;oa(Oc).forEach(function(uc){Ub.append(uc)});return Xb.type?Ub.getBlob(Xb.type):Ub.getBlob()}function mb(Oc,Xb){return new Blob(oa(Oc),Xb||{})}if(oc)return gb;oc=!0;var db="undefined"!==typeof db?db:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var jb=2===(new Blob(["hi"])).size}catch(Oc){jb=!1}var gc;if(gc=jb)try{gc=2===(new Blob([new Uint8Array([1,2])])).size}catch(Oc){gc=!1}var Qc=db&&db.prototype.append&&db.prototype.getBlob;"undefined"!==typeof Blob&&(bb.prototype=Blob.prototype,mb.prototype=Blob.prototype);gb=jb?gc?Blob:mb:Qc?bb:void 0;return gb}function ab(){function oa(vd,ee,ze){if(!ee)return cc.encodeBase64Packet(vd,ze);var Le=new FileReader;
Le.onload=function(){cc.encodePacket({type:vd.type,data:Le.result},ee,!0,ze)};return Le.readAsArrayBuffer(vd.data)}function bb(vd,ee,ze){var Le=Array(vd.length);ze=gc(vd.length,ze);for(var Pe=function(Vf,jg,Bf){ee(jg,function(ja,va){Le[Vf]=va;Bf(ja,Le)})},Af=0;Af<vd.length;Af++)Pe(Af,vd[Af],ze)}if($c)return cc;$c=!0;var mb=hc(),db=kc(),jb=xb(),gc=yb(),Qc=wc(),Oc;"undefined"!==typeof ArrayBuffer&&(Oc=Kc());var Xb="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),Ub="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),uc=Xb||Ub;cc.protocol=3;var eb=cc.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},Lc=mb(eb),Ed={type:"error",data:"parser error"},pe=zb();cc.encodePacket=function(vd,ee,ze,Le){"function"===typeof ee&&(Le=ee,ee=!1);"function"===typeof ze&&(Le=ze,ze=null);var Pe=void 0===vd.data?void 0:vd.data.buffer||vd.data;if("undefined"!==typeof ArrayBuffer&&Pe instanceof ArrayBuffer){if(ee){ze=vd.data;ee=new Uint8Array(ze);ze=new Uint8Array(1+
ze.byteLength);ze[0]=eb[vd.type];for(vd=0;vd<ee.length;vd++)ze[vd+1]=ee[vd];vd=Le(ze.buffer)}else vd=cc.encodeBase64Packet(vd,Le);return vd}if("undefined"!==typeof pe&&Pe instanceof pe)return ee?uc?vd=oa(vd,ee,Le):(ee=new Uint8Array(1),ee[0]=eb[vd.type],vd=new pe([ee.buffer,vd.data]),vd=Le(vd)):vd=cc.encodeBase64Packet(vd,Le),vd;if(Pe&&Pe.base64)return Le("b"+cc.packets[vd.type]+vd.data.data);ee=eb[vd.type];void 0!==vd.data&&(ee+=ze?Qc.encode(String(vd.data),{strict:!1}):String(vd.data));return Le(""+
ee)};cc.encodeBase64Packet=function(vd,ee){var ze="b"+cc.packets[vd.type];if("undefined"!==typeof pe&&vd.data instanceof pe){var Le=new FileReader;Le.onload=function(){var Vf=Le.result.split(",")[1];ee(ze+Vf)};return Le.readAsDataURL(vd.data)}try{var Pe=String.fromCharCode.apply(null,new Uint8Array(vd.data))}catch(Vf){vd=new Uint8Array(vd.data);Pe=Array(vd.length);for(var Af=0;Af<vd.length;Af++)Pe[Af]=vd[Af];Pe=String.fromCharCode.apply(null,Pe)}ze+=btoa(Pe);return ee(ze)};cc.decodePacket=function(vd,
ee,ze){if(void 0===vd)return Ed;if("string"===typeof vd){if("b"===vd.charAt(0))return cc.decodeBase64Packet(vd.substr(1),ee);if(ze){a:{ee=vd;try{ee=Qc.decode(ee,{strict:!1})}catch(Le){vd=!1;break a}vd=ee}if(!1===vd)return Ed}ze=vd.charAt(0);return Number(ze)==ze&&Lc[ze]?1<vd.length?{type:Lc[ze],data:vd.substring(1)}:{type:Lc[ze]}:Ed}ze=(new Uint8Array(vd))[0];vd=jb(vd,1);pe&&"blob"===ee&&(vd=new pe([vd]));return{type:Lc[ze],data:vd}};cc.decodeBase64Packet=function(vd,ee){var ze=Lc[vd.charAt(0)];if(!Oc)return{type:ze,
data:{base64:!0,data:vd.substr(1)}};vd=Oc.decode(vd.substr(1));"blob"===ee&&pe&&(vd=new pe([vd]));return{type:ze,data:vd}};cc.encodePayload=function(vd,ee,ze){"function"===typeof ee&&(ze=ee,ee=null);var Le=db(vd);if(ee&&Le)return pe&&!uc?cc.encodePayloadAsBlob(vd,ze):cc.encodePayloadAsArrayBuffer(vd,ze);if(!vd.length)return ze("0:");bb(vd,function(Pe,Af){cc.encodePacket(Pe,Le?ee:!1,!1,function(Vf){Af(null,Vf.length+":"+Vf)})},function(Pe,Af){return ze(Af.join(""))})};cc.decodePayload=function(vd,
ee,ze){if("string"!==typeof vd)return cc.decodePayloadAsBinary(vd,ee,ze);"function"===typeof ee&&(ze=ee,ee=null);if(""===vd)return ze(Ed,0,1);var Le="";for(var Pe,Af,Vf=0,jg=vd.length;Vf<jg;Vf++)if(Af=vd.charAt(Vf),":"!==Af)Le+=Af;else{if(""===Le||Le!=(Pe=Number(Le)))return ze(Ed,0,1);Af=vd.substr(Vf+1,Pe);if(Le!=Af.length)return ze(Ed,0,1);if(Af.length){Le=cc.decodePacket(Af,ee,!1);if(Ed.type===Le.type&&Ed.data===Le.data)return ze(Ed,0,1);if(!1===ze(Le,Vf+Pe,jg))return}Vf+=Pe;Le=""}if(""!==Le)return ze(Ed,
0,1)};cc.encodePayloadAsArrayBuffer=function(vd,ee){if(!vd.length)return ee(new ArrayBuffer(0));bb(vd,function(ze,Le){cc.encodePacket(ze,!0,!0,function(Pe){return Le(null,Pe)})},function(ze,Le){ze=Le.reduce(function(Vf,jg){jg="string"===typeof jg?jg.length:jg.byteLength;return Vf+jg.toString().length+jg+2},0);var Pe=new Uint8Array(ze),Af=0;Le.forEach(function(Vf){var jg="string"===typeof Vf,Bf=Vf;if(jg){Bf=new Uint8Array(Vf.length);for(var ja=0;ja<Vf.length;ja++)Bf[ja]=Vf.charCodeAt(ja);Bf=Bf.buffer}jg?
Pe[Af++]=0:Pe[Af++]=1;Vf=Bf.byteLength.toString();for(ja=0;ja<Vf.length;ja++)Pe[Af++]=parseInt(Vf[ja]);Pe[Af++]=255;Bf=new Uint8Array(Bf);for(ja=0;ja<Bf.length;ja++)Pe[Af++]=Bf[ja]});return ee(Pe.buffer)})};cc.encodePayloadAsBlob=function(vd,ee){bb(vd,function(ze,Le){cc.encodePacket(ze,!0,!0,function(Pe){var Af=new Uint8Array(1);Af[0]=1;if("string"===typeof Pe){for(var Vf=new Uint8Array(Pe.length),jg=0;jg<Pe.length;jg++)Vf[jg]=Pe.charCodeAt(jg);Pe=Vf.buffer;Af[0]=0}Vf=(Pe instanceof ArrayBuffer?Pe.byteLength:
Pe.size).toString();var Bf=new Uint8Array(Vf.length+1);for(jg=0;jg<Vf.length;jg++)Bf[jg]=parseInt(Vf[jg]);Bf[Vf.length]=255;pe&&(Pe=new pe([Af.buffer,Bf.buffer,Pe]),Le(null,Pe))})},function(ze,Le){return ee(new pe(Le))})};cc.decodePayloadAsBinary=function(vd,ee,ze){"function"===typeof ee&&(ze=ee,ee=null);for(var Le=[];0<vd.byteLength;){for(var Pe=new Uint8Array(vd),Af=0===Pe[0],Vf="",jg=1;255!==Pe[jg];jg++){if(310<Vf.length)return ze(Ed,0,1);Vf+=Pe[jg]}vd=jb(vd,2+Vf.length);Vf=parseInt(Vf);Pe=jb(vd,
0,Vf);if(Af)try{Pe=String.fromCharCode.apply(null,new Uint8Array(Pe))}catch(ja){for(Af=new Uint8Array(Pe),Pe="",jg=0;jg<Af.length;jg++)Pe+=String.fromCharCode(Af[jg])}Le.push(Pe);vd=jb(vd,Vf)}var Bf=Le.length;Le.forEach(function(ja,va){ze(cc.decodePacket(ja,ee,!0),va,Bf)})};return cc}function Kb(){function oa(db){(this||Yd).path=db.path;(this||Yd).hostname=db.hostname;(this||Yd).port=db.port;(this||Yd).secure=db.secure;(this||Yd).query=db.query;(this||Yd).timestampParam=db.timestampParam;(this||Yd).timestampRequests=
db.timestampRequests;(this||Yd).readyState="";(this||Yd).agent=db.agent||!1;(this||Yd).socket=db.socket;(this||Yd).enablesXDR=db.enablesXDR;(this||Yd).withCredentials=db.withCredentials;(this||Yd).pfx=db.pfx;(this||Yd).key=db.key;(this||Yd).passphrase=db.passphrase;(this||Yd).cert=db.cert;(this||Yd).ca=db.ca;(this||Yd).ciphers=db.ciphers;(this||Yd).rejectUnauthorized=db.rejectUnauthorized;(this||Yd).forceNode=db.forceNode;(this||Yd).isReactNative=db.isReactNative;(this||Yd).extraHeaders=db.extraHeaders;
(this||Yd).localAddress=db.localAddress}if(Wc)return Uc;Wc=!0;var bb=ab(),mb=Yc();Uc=oa;mb(oa.prototype);oa.prototype.onError=function(db,jb){db=Error(db);db.type="TransportError";db.description=jb;this.emit("error",db);return this||Yd};oa.prototype.open=function(){if("closed"===(this||Yd).readyState||""===(this||Yd).readyState)(this||Yd).readyState="opening",this.doOpen();return this||Yd};oa.prototype.close=function(){if("opening"===(this||Yd).readyState||"open"===(this||Yd).readyState)this.doClose(),
this.onClose();return this||Yd};oa.prototype.send=function(db){if("open"===(this||Yd).readyState)this.write(db);else throw Error("Transport not open");};oa.prototype.onOpen=function(){(this||Yd).readyState="open";(this||Yd).writable=!0;this.emit("open")};oa.prototype.onData=function(db){db=bb.decodePacket(db,(this||Yd).socket.binaryType);this.onPacket(db)};oa.prototype.onPacket=function(db){this.emit("packet",db)};oa.prototype.onClose=function(){(this||Yd).readyState="closed";this.emit("close")};
return Uc}function nc(){if(tf)return oe;tf=!0;oe.encode=function(oa){var bb="",mb;for(mb in oa)oa.hasOwnProperty(mb)&&(bb.length&&(bb+="&"),bb+=encodeURIComponent(mb)+"="+encodeURIComponent(oa[mb]));return bb};oe.decode=function(oa){var bb={};oa=oa.split("&");for(var mb=0,db=oa.length;mb<db;mb++){var jb=oa[mb].split("=");bb[decodeURIComponent(jb[0])]=decodeURIComponent(jb[1])}return bb};return oe}function da(){if(Ah)return Dg;Ah=!0;return Dg=function(oa,bb){var mb=function(){};mb.prototype=bb.prototype;
oa.prototype=new mb;oa.prototype.constructor=oa}}function qa(){function oa(Oc){var Xb="";do Xb=mb[Oc%64]+Xb,Oc=Math.floor(Oc/64);while(0<Oc);return Xb}function bb(){var Oc=oa(+new Date);return Oc!==Qc?(jb=0,Qc=Oc):Oc+"."+oa(jb++)}if(ri)return Mg;ri=!0;for(var mb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),db={},jb=0,gc=0,Qc;64>gc;gc++)db[mb[gc]]=gc;bb.encode=oa;bb.decode=function(Oc){var Xb=0;for(gc=0;gc<Oc.length;gc++)Xb=64*Xb+db[Oc.charAt(gc)];return Xb};return Mg=
bb}function Va(){function oa(Xb){var Ub=Xb&&Xb.forceBase64;if(!Oc||Ub)(this||Te).supportsBinary=!1;bb.call(this||Te,Xb)}if(Cj)return Eg;Cj=!0;var bb=Kb(),mb=nc(),db=ab(),jb=da(),gc=qa(),Qc=Fd()("engine.io-client:polling");Eg=oa;var Oc=null!=(new (Hd())({xdomain:!1})).responseType;jb(oa,bb);oa.prototype.name="polling";oa.prototype.doOpen=function(){this.poll()};oa.prototype.pause=function(Xb){function Ub(){Qc("paused");uc.readyState="paused";Xb()}var uc=this||Te;(this||Te).readyState="pausing";if((this||
Te).polling||!(this||Te).writable){var eb=0;(this||Te).polling&&(Qc("we are currently polling - waiting to pause"),eb++,this.once("pollComplete",function(){Qc("pre-pause polling complete");--eb||Ub()}));(this||Te).writable||(Qc("we are currently writing - waiting to pause"),eb++,this.once("drain",function(){Qc("pre-pause writing complete");--eb||Ub()}))}else Ub()};oa.prototype.poll=function(){Qc("polling");(this||Te).polling=!0;this.doPoll();this.emit("poll")};oa.prototype.onData=function(Xb){var Ub=
this||Te;Qc("polling got data %s",Xb);db.decodePayload(Xb,(this||Te).socket.binaryType,function(uc,eb,Lc){if("opening"===Ub.readyState)Ub.onOpen();if("close"===uc.type)return Ub.onClose(),!1;Ub.onPacket(uc)});"closed"!==(this||Te).readyState&&((this||Te).polling=!1,this.emit("pollComplete"),"open"===(this||Te).readyState?this.poll():Qc('ignoring poll - transport state "%s"',(this||Te).readyState))};oa.prototype.doClose=function(){function Xb(){Qc("writing close packet");Ub.write([{type:"close"}])}
var Ub=this||Te;"open"===(this||Te).readyState?(Qc("transport open - closing"),Xb()):(Qc("transport not open - deferring close"),this.once("open",Xb))};oa.prototype.write=function(Xb){var Ub=this||Te;(this||Te).writable=!1;var uc=function(){Ub.writable=!0;Ub.emit("drain")};db.encodePayload(Xb,(this||Te).supportsBinary,function(eb){Ub.doWrite(eb,uc)})};oa.prototype.uri=function(){var Xb=(this||Te).query||{},Ub=(this||Te).secure?"https":"http",uc="";!1!==(this||Te).timestampRequests&&(Xb[(this||Te).timestampParam]=
gc());(this||Te).supportsBinary||Xb.sid||(Xb.b64=1);Xb=mb.encode(Xb);(this||Te).port&&("https"===Ub&&443!==Number((this||Te).port)||"http"===Ub&&80!==Number((this||Te).port))&&(uc=":"+(this||Te).port);Xb.length&&(Xb="?"+Xb);var eb=-1!==(this||Te).hostname.indexOf(":");return Ub+"://"+(eb?"["+(this||Te).hostname+"]":(this||Te).hostname)+uc+(this||Te).path+Xb};return Eg}function cb(){function oa(){}function bb(uc){gc.call(this||$d,uc);(this||$d).requestTimeout=uc.requestTimeout;(this||$d).extraHeaders=
uc.extraHeaders;if("undefined"!==typeof location){var eb="https:"===location.protocol,Lc=location.port;Lc||(Lc=eb?443:80);(this||$d).xd="undefined"!==typeof location&&uc.hostname!==location.hostname||Lc!==uc.port;(this||$d).xs=uc.secure!==eb}}function mb(uc){(this||$d).method=uc.method||"GET";(this||$d).uri=uc.uri;(this||$d).xd=!!uc.xd;(this||$d).xs=!!uc.xs;(this||$d).async=!1!==uc.async;(this||$d).data=void 0!==uc.data?uc.data:null;(this||$d).agent=uc.agent;(this||$d).isBinary=uc.isBinary;(this||
$d).supportsBinary=uc.supportsBinary;(this||$d).enablesXDR=uc.enablesXDR;(this||$d).withCredentials=uc.withCredentials;(this||$d).requestTimeout=uc.requestTimeout;(this||$d).pfx=uc.pfx;(this||$d).key=uc.key;(this||$d).passphrase=uc.passphrase;(this||$d).cert=uc.cert;(this||$d).ca=uc.ca;(this||$d).ciphers=uc.ciphers;(this||$d).rejectUnauthorized=uc.rejectUnauthorized;(this||$d).extraHeaders=uc.extraHeaders;this.create()}function db(){for(var uc in mb.requests)mb.requests.hasOwnProperty(uc)&&mb.requests[uc].abort()}
if(dh)return xi;dh=!0;var jb=Hd(),gc=Va(),Qc=Yc(),Oc=da(),Xb=Fd()("engine.io-client:polling-xhr"),Ub=Vc();xi=bb;xi.Request=mb;Oc(bb,gc);bb.prototype.supportsBinary=!0;bb.prototype.request=function(uc){uc=uc||{};uc.uri=this.uri();uc.xd=(this||$d).xd;uc.xs=(this||$d).xs;uc.agent=(this||$d).agent||!1;uc.supportsBinary=(this||$d).supportsBinary;uc.enablesXDR=(this||$d).enablesXDR;uc.withCredentials=(this||$d).withCredentials;uc.pfx=(this||$d).pfx;uc.key=(this||$d).key;uc.passphrase=(this||$d).passphrase;
uc.cert=(this||$d).cert;uc.ca=(this||$d).ca;uc.ciphers=(this||$d).ciphers;uc.rejectUnauthorized=(this||$d).rejectUnauthorized;uc.requestTimeout=(this||$d).requestTimeout;uc.extraHeaders=(this||$d).extraHeaders;return new mb(uc)};bb.prototype.doWrite=function(uc,eb){uc=this.request({method:"POST",data:uc,isBinary:"string"!==typeof uc&&void 0!==uc});var Lc=this||$d;uc.on("success",eb);uc.on("error",function(Ed){Lc.onError("xhr post error",Ed)});(this||$d).sendXhr=uc};bb.prototype.doPoll=function(){Xb("xhr poll");
var uc=this.request(),eb=this||$d;uc.on("data",function(Lc){eb.onData(Lc)});uc.on("error",function(Lc){eb.onError("xhr poll error",Lc)});(this||$d).pollXhr=uc};Qc(mb.prototype);mb.prototype.create=function(){var uc={agent:(this||$d).agent,xdomain:(this||$d).xd,xscheme:(this||$d).xs,enablesXDR:(this||$d).enablesXDR};uc.pfx=(this||$d).pfx;uc.key=(this||$d).key;uc.passphrase=(this||$d).passphrase;uc.cert=(this||$d).cert;uc.ca=(this||$d).ca;uc.ciphers=(this||$d).ciphers;uc.rejectUnauthorized=(this||$d).rejectUnauthorized;
var eb=(this||$d).xhr=new jb(uc),Lc=this||$d;try{Xb("xhr open %s: %s",(this||$d).method,(this||$d).uri);eb.open((this||$d).method,(this||$d).uri,(this||$d).async);try{if((this||$d).extraHeaders){eb.setDisableHeaderCheck&&eb.setDisableHeaderCheck(!0);for(var Ed in(this||$d).extraHeaders)(this||$d).extraHeaders.hasOwnProperty(Ed)&&eb.setRequestHeader(Ed,(this||$d).extraHeaders[Ed])}}catch(pe){}if("POST"===(this||$d).method)try{(this||$d).isBinary?eb.setRequestHeader("Content-type","application/octet-stream"):
eb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(pe){}try{eb.setRequestHeader("Accept","*/*")}catch(pe){}"withCredentials"in eb&&(eb.withCredentials=(this||$d).withCredentials);(this||$d).requestTimeout&&(eb.timeout=(this||$d).requestTimeout);this.hasXDR()?(eb.onload=function(){Lc.onLoad()},eb.onerror=function(){Lc.onError(eb.responseText)}):eb.onreadystatechange=function(){if(2===eb.readyState)try{var pe=eb.getResponseHeader("Content-Type");if(Lc.supportsBinary&&"application/octet-stream"===
pe||"application/octet-stream; charset=UTF-8"===pe)eb.responseType="arraybuffer"}catch(vd){}if(4===eb.readyState)if(200===eb.status||1223===eb.status)Lc.onLoad();else setTimeout(function(){Lc.onError("number"===typeof eb.status?eb.status:0)},0)};Xb("xhr data %s",(this||$d).data);eb.send((this||$d).data)}catch(pe){setTimeout(function(){Lc.onError(pe)},0);return}"undefined"!==typeof document&&((this||$d).index=mb.requestsCount++,mb.requests[(this||$d).index]=this||$d)};mb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};mb.prototype.onData=function(uc){this.emit("data",uc);this.onSuccess()};mb.prototype.onError=function(uc){this.emit("error",uc);this.cleanup(!0)};mb.prototype.cleanup=function(uc){if("undefined"!==typeof(this||$d).xhr&&null!==(this||$d).xhr){this.hasXDR()?(this||$d).xhr.onload=(this||$d).xhr.onerror=oa:(this||$d).xhr.onreadystatechange=oa;if(uc)try{(this||$d).xhr.abort()}catch(eb){}"undefined"!==typeof document&&delete mb.requests[(this||$d).index];(this||$d).xhr=null}};mb.prototype.onLoad=
function(){try{try{var uc=(this||$d).xhr.getResponseHeader("Content-Type")}catch(Lc){}var eb="application/octet-stream"===uc||"application/octet-stream; charset=UTF-8"===uc?(this||$d).xhr.response||(this||$d).xhr.responseText:(this||$d).xhr.responseText}catch(Lc){this.onError(Lc)}if(null!=eb)this.onData(eb)};mb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||$d).xs&&(this||$d).enablesXDR};mb.prototype.abort=function(){this.cleanup()};mb.requestsCount=0;mb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",db):"function"===typeof addEventListener&&addEventListener("onpagehide"in Ub?"pagehide":"unload",db,!1));return xi}function kb(){function oa(){}function bb(Xb){mb.call(this||bg,Xb);(this||bg).query=(this||bg).query||{};Oc||(Oc=jb.___eio=jb.___eio||[]);(this||bg).index=Oc.length;var Ub=this||bg;Oc.push(function(uc){Ub.onData(uc)});(this||bg).query.j=(this||bg).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){Ub.script&&(Ub.script.onerror=oa)},!1)}if(xk)return ij;xk=!0;var mb=Va(),db=da(),jb=Vc();ij=bb;var gc=/\n/g,Qc=/\\n/g,Oc;db(bb,mb);bb.prototype.supportsBinary=!1;bb.prototype.doClose=function(){(this||bg).script&&((this||bg).script.parentNode.removeChild((this||bg).script),(this||bg).script=null);(this||bg).form&&((this||bg).form.parentNode.removeChild((this||bg).form),(this||bg).form=null,(this||bg).iframe=null);mb.prototype.doClose.call(this||bg)};bb.prototype.doPoll=function(){var Xb=
this||bg,Ub=document.createElement("script");(this||bg).script&&((this||bg).script.parentNode.removeChild((this||bg).script),(this||bg).script=null);Ub.async=!0;Ub.src=this.uri();Ub.onerror=function(eb){Xb.onError("jsonp poll error",eb)};var uc=document.getElementsByTagName("script")[0];uc?uc.parentNode.insertBefore(Ub,uc):(document.head||document.body).appendChild(Ub);(this||bg).script=Ub;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var eb=document.createElement("iframe");
document.body.appendChild(eb);document.body.removeChild(eb)},100)};bb.prototype.doWrite=function(Xb,Ub){function uc(){eb();Ub()}function eb(){if(Lc.iframe)try{Lc.form.removeChild(Lc.iframe)}catch(ze){Lc.onError("jsonp polling iframe removal error",ze)}try{ee=document.createElement('<iframe src="javascript:0" name="'+Lc.iframeId+'">')}catch(ze){ee=document.createElement("iframe"),ee.name=Lc.iframeId,ee.src="javascript:0"}ee.id=Lc.iframeId;Lc.form.appendChild(ee);Lc.iframe=ee}var Lc=this||bg;if(!(this||
bg).form){var Ed=document.createElement("form"),pe=document.createElement("textarea"),vd=(this||bg).iframeId="eio_iframe_"+(this||bg).index,ee;Ed.className="socketio";Ed.style.position="absolute";Ed.style.top="-1000px";Ed.style.left="-1000px";Ed.target=vd;Ed.method="POST";Ed.setAttribute("accept-charset","utf-8");pe.name="d";Ed.appendChild(pe);document.body.appendChild(Ed);(this||bg).form=Ed;(this||bg).area=pe}(this||bg).form.action=this.uri();eb();Xb=Xb.replace(Qc,"\\\n");(this||bg).area.value=Xb.replace(gc,
"\\n");try{(this||bg).form.submit()}catch(ze){}(this||bg).iframe.attachEvent?(this||bg).iframe.onreadystatechange=function(){"complete"===Lc.iframe.readyState&&uc()}:(this||bg).iframe.onload=uc};return ij}function Ma(){if(bk)return Ni;bk=!0;return Ni=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function Oa(){function oa(eb){eb&&eb.forceBase64&&((this||wf).supportsBinary=!1);(this||wf).perMessageDeflate=eb.perMessageDeflate;(this||
wf).usingBrowserWebSocket=Xb&&!eb.forceNode;(this||wf).protocols=eb.protocols;(this||wf).usingBrowserWebSocket||(uc=Ub);mb.call(this||wf,eb)}if(Ki)return dk;Ki=!0;var bb=Qb.Buffer,mb=Kb(),db=ab(),jb=nc(),gc=da(),Qc=qa(),Oc=Fd()("engine.io-client:websocket"),Xb;"undefined"!==typeof WebSocket?Xb=WebSocket:"undefined"!==typeof self&&(Xb=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var Ub=Ma()}catch(eb){}var uc=Xb||Ub;dk=oa;gc(oa,mb);oa.prototype.name="websocket";oa.prototype.supportsBinary=
!0;oa.prototype.doOpen=function(){if(this.check()){var eb=this.uri(),Lc=(this||wf).protocols,Ed={};(this||wf).isReactNative||(Ed.agent=(this||wf).agent,Ed.perMessageDeflate=(this||wf).perMessageDeflate,Ed.pfx=(this||wf).pfx,Ed.key=(this||wf).key,Ed.passphrase=(this||wf).passphrase,Ed.cert=(this||wf).cert,Ed.ca=(this||wf).ca,Ed.ciphers=(this||wf).ciphers,Ed.rejectUnauthorized=(this||wf).rejectUnauthorized);(this||wf).extraHeaders&&(Ed.headers=(this||wf).extraHeaders);(this||wf).localAddress&&(Ed.localAddress=
(this||wf).localAddress);try{(this||wf).ws=(this||wf).usingBrowserWebSocket&&!(this||wf).isReactNative?Lc?new uc(eb,Lc):new uc(eb):new uc(eb,Lc,Ed)}catch(pe){return this.emit("error",pe)}void 0===(this||wf).ws.binaryType&&((this||wf).supportsBinary=!1);(this||wf).ws.supports&&(this||wf).ws.supports.binary?((this||wf).supportsBinary=!0,(this||wf).ws.binaryType="nodebuffer"):(this||wf).ws.binaryType="arraybuffer";this.addEventListeners()}};oa.prototype.addEventListeners=function(){var eb=this||wf;(this||
wf).ws.onopen=function(){eb.onOpen()};(this||wf).ws.onclose=function(){eb.onClose()};(this||wf).ws.onmessage=function(Lc){eb.onData(Lc.data)};(this||wf).ws.onerror=function(Lc){eb.onError("websocket error",Lc)}};oa.prototype.write=function(eb){function Lc(){Ed.emit("flush");setTimeout(function(){Ed.writable=!0;Ed.emit("drain")},0)}var Ed=this||wf;(this||wf).writable=!1;for(var pe=eb.length,vd=0,ee=pe;vd<ee;vd++)(function(ze){db.encodePacket(ze,Ed.supportsBinary,function(Le){if(!Ed.usingBrowserWebSocket){var Pe=
{};ze.options&&(Pe.compress=ze.options.compress);Ed.perMessageDeflate&&("string"===typeof Le?bb.byteLength(Le):Le.length)<Ed.perMessageDeflate.threshold&&(Pe.compress=!1)}try{Ed.usingBrowserWebSocket?Ed.ws.send(Le):Ed.ws.send(Le,Pe)}catch(Af){Oc("websocket closed before onclose event")}--pe||Lc()})})(eb[vd])};oa.prototype.onClose=function(){mb.prototype.onClose.call(this||wf)};oa.prototype.doClose=function(){"undefined"!==typeof(this||wf).ws&&(this||wf).ws.close()};oa.prototype.uri=function(){var eb=
(this||wf).query||{},Lc=(this||wf).secure?"wss":"ws",Ed="";(this||wf).port&&("wss"===Lc&&443!==Number((this||wf).port)||"ws"===Lc&&80!==Number((this||wf).port))&&(Ed=":"+(this||wf).port);(this||wf).timestampRequests&&(eb[(this||wf).timestampParam]=Qc());(this||wf).supportsBinary||(eb.b64=1);eb=jb.encode(eb);eb.length&&(eb="?"+eb);var pe=-1!==(this||wf).hostname.indexOf(":");return Lc+"://"+(pe?"["+(this||wf).hostname+"]":(this||wf).hostname)+Ed+(this||wf).path+eb};oa.prototype.check=function(){return!!uc&&
!("__initialize"in uc&&(this||wf).name===oa.prototype.name)};return dk}function lb(){if(kl)return df;kl=!0;var oa=Hd(),bb=cb(),mb=kb(),db=Oa();df.polling=function(jb){var gc=!1,Qc=!1,Oc=!1!==jb.jsonp;"undefined"!==typeof location&&(Qc="https:"===location.protocol,(gc=location.port)||(gc=Qc?443:80),gc=jb.hostname!==location.hostname||gc!==jb.port,Qc=jb.secure!==Qc);jb.xdomain=gc;jb.xscheme=Qc;if("open"in new oa(jb)&&!jb.forceJSONP)return new bb(jb);if(!Oc)throw Error("JSONP disabled");return new mb(jb)};
df.websocket=db;return df}function Wb(){if(Fb)return Eb;Fb=!0;var oa=[].indexOf;return Eb=function(bb,mb){if(oa)return bb.indexOf(mb);for(var db=0;db<bb.length;++db)if(bb[db]===mb)return db;return-1}}function Nb(){function oa(Xb,Ub){if(!((this||Gc)instanceof oa))return new oa(Xb,Ub);Ub=Ub||{};Xb&&"object"===typeof Xb&&(Ub=Xb,Xb=null);Xb?(Xb=Qc(Xb),Ub.hostname=Xb.host,Ub.secure="https"===Xb.protocol||"wss"===Xb.protocol,Ub.port=Xb.port,Xb.query&&(Ub.query=Xb.query)):Ub.host&&(Ub.hostname=Qc(Ub.host).host);
(this||Gc).secure=null!=Ub.secure?Ub.secure:"undefined"!==typeof location&&"https:"===location.protocol;Ub.hostname&&!Ub.port&&(Ub.port=(this||Gc).secure?"443":"80");(this||Gc).agent=Ub.agent||!1;(this||Gc).hostname=Ub.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||Gc).port=Ub.port||("undefined"!==typeof location&&location.port?location.port:(this||Gc).secure?443:80);(this||Gc).query=Ub.query||{};"string"===typeof(this||Gc).query&&((this||Gc).query=Oc.decode((this||
Gc).query));(this||Gc).upgrade=!1!==Ub.upgrade;(this||Gc).path=(Ub.path||"/engine.io").replace(/\/$/,"")+"/";(this||Gc).forceJSONP=!!Ub.forceJSONP;(this||Gc).jsonp=!1!==Ub.jsonp;(this||Gc).forceBase64=!!Ub.forceBase64;(this||Gc).enablesXDR=!!Ub.enablesXDR;(this||Gc).withCredentials=!1!==Ub.withCredentials;(this||Gc).timestampParam=Ub.timestampParam||"t";(this||Gc).timestampRequests=Ub.timestampRequests;(this||Gc).transports=Ub.transports||["polling","websocket"];(this||Gc).transportOptions=Ub.transportOptions||
{};(this||Gc).readyState="";(this||Gc).writeBuffer=[];(this||Gc).prevBufferLen=0;(this||Gc).policyPort=Ub.policyPort||843;(this||Gc).rememberUpgrade=Ub.rememberUpgrade||!1;(this||Gc).binaryType=null;(this||Gc).onlyBinaryUpgrades=Ub.onlyBinaryUpgrades;(this||Gc).perMessageDeflate=!1!==Ub.perMessageDeflate?Ub.perMessageDeflate||{}:!1;!0===(this||Gc).perMessageDeflate&&((this||Gc).perMessageDeflate={});(this||Gc).perMessageDeflate&&null==(this||Gc).perMessageDeflate.threshold&&((this||Gc).perMessageDeflate.threshold=
1024);(this||Gc).pfx=Ub.pfx||null;(this||Gc).key=Ub.key||null;(this||Gc).passphrase=Ub.passphrase||null;(this||Gc).cert=Ub.cert||null;(this||Gc).ca=Ub.ca||null;(this||Gc).ciphers=Ub.ciphers||null;(this||Gc).rejectUnauthorized=void 0===Ub.rejectUnauthorized?!0:Ub.rejectUnauthorized;(this||Gc).forceNode=!!Ub.forceNode;(this||Gc).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||Gc).isReactNative)Ub.extraHeaders&&
0<Object.keys(Ub.extraHeaders).length&&((this||Gc).extraHeaders=Ub.extraHeaders),Ub.localAddress&&((this||Gc).localAddress=Ub.localAddress);(this||Gc).id=null;(this||Gc).upgrades=null;(this||Gc).pingInterval=null;(this||Gc).pingTimeout=null;(this||Gc).pingIntervalTimer=null;(this||Gc).pingTimeoutTimer=null;this.open()}if(Sd)return Vd;Sd=!0;var bb=lb(),mb=Yc(),db=Fd()("engine.io-client:socket"),jb=Wb(),gc=ab(),Qc=Jc(),Oc=nc();Vd=oa;oa.priorWebsocketSuccess=!1;mb(oa.prototype);oa.protocol=gc.protocol;
oa.Socket=oa;oa.Transport=Kb();oa.transports=lb();oa.parser=ab();oa.prototype.createTransport=function(Xb){db('creating transport "%s"',Xb);var Ub=(this||Gc).query,uc={},eb;for(eb in Ub)Ub.hasOwnProperty(eb)&&(uc[eb]=Ub[eb]);uc.EIO=gc.protocol;uc.transport=Xb;Ub=(this||Gc).transportOptions[Xb]||{};(this||Gc).id&&(uc.sid=(this||Gc).id);return new bb[Xb]({query:uc,socket:this||Gc,agent:Ub.agent||(this||Gc).agent,hostname:Ub.hostname||(this||Gc).hostname,port:Ub.port||(this||Gc).port,secure:Ub.secure||
(this||Gc).secure,path:Ub.path||(this||Gc).path,forceJSONP:Ub.forceJSONP||(this||Gc).forceJSONP,jsonp:Ub.jsonp||(this||Gc).jsonp,forceBase64:Ub.forceBase64||(this||Gc).forceBase64,enablesXDR:Ub.enablesXDR||(this||Gc).enablesXDR,withCredentials:Ub.withCredentials||(this||Gc).withCredentials,timestampRequests:Ub.timestampRequests||(this||Gc).timestampRequests,timestampParam:Ub.timestampParam||(this||Gc).timestampParam,policyPort:Ub.policyPort||(this||Gc).policyPort,pfx:Ub.pfx||(this||Gc).pfx,key:Ub.key||
(this||Gc).key,passphrase:Ub.passphrase||(this||Gc).passphrase,cert:Ub.cert||(this||Gc).cert,ca:Ub.ca||(this||Gc).ca,ciphers:Ub.ciphers||(this||Gc).ciphers,rejectUnauthorized:Ub.rejectUnauthorized||(this||Gc).rejectUnauthorized,perMessageDeflate:Ub.perMessageDeflate||(this||Gc).perMessageDeflate,extraHeaders:Ub.extraHeaders||(this||Gc).extraHeaders,forceNode:Ub.forceNode||(this||Gc).forceNode,localAddress:Ub.localAddress||(this||Gc).localAddress,requestTimeout:Ub.requestTimeout||(this||Gc).requestTimeout,
protocols:Ub.protocols||void 0,isReactNative:(this||Gc).isReactNative})};oa.prototype.open=function(){if((this||Gc).rememberUpgrade&&oa.priorWebsocketSuccess&&-1!==(this||Gc).transports.indexOf("websocket"))var Xb="websocket";else{if(0===(this||Gc).transports.length){var Ub=this||Gc;setTimeout(function(){Ub.emit("error","No transports available")},0);return}Xb=(this||Gc).transports[0]}(this||Gc).readyState="opening";try{Xb=this.createTransport(Xb)}catch(uc){(this||Gc).transports.shift();this.open();
return}Xb.open();this.setTransport(Xb)};oa.prototype.setTransport=function(Xb){db("setting transport %s",Xb.name);var Ub=this||Gc;(this||Gc).transport&&(db("clearing existing transport %s",(this||Gc).transport.name),(this||Gc).transport.removeAllListeners());(this||Gc).transport=Xb;Xb.on("drain",function(){Ub.onDrain()}).on("packet",function(uc){Ub.onPacket(uc)}).on("error",function(uc){Ub.onError(uc)}).on("close",function(){Ub.onClose("transport close")})};oa.prototype.probe=function(Xb){function Ub(){if(Le.onlyBinaryUpgrades){var Pe=
!(this||Gc).supportsBinary&&Le.transport.supportsBinary;ze=ze||Pe}ze||(db('probe transport "%s" opened',Xb),ee.send([{type:"ping",data:"probe"}]),ee.once("packet",function(Af){ze||("pong"===Af.type&&"probe"===Af.data?(db('probe transport "%s" pong',Xb),Le.upgrading=!0,Le.emit("upgrading",ee),ee&&(oa.priorWebsocketSuccess="websocket"===ee.name,db('pausing current transport "%s"',Le.transport.name),Le.transport.pause(function(){ze||"closed"===Le.readyState||(db("changing transport and sending upgrade packet"),
vd(),Le.setTransport(ee),ee.send([{type:"upgrade"}]),Le.emit("upgrade",ee),ee=null,Le.upgrading=!1,Le.flush())}))):(db('probe transport "%s" failed',Xb),Af=Error("probe error"),Af.transport=ee.name,Le.emit("upgradeError",Af)))}))}function uc(){ze||(ze=!0,vd(),ee.close(),ee=null)}function eb(Pe){var Af=Error("probe error: "+Pe);Af.transport=ee.name;uc();db('probe transport "%s" failed because of error: %s',Xb,Pe);Le.emit("upgradeError",Af)}function Lc(){eb("transport closed")}function Ed(){eb("socket closed")}
function pe(Pe){ee&&Pe.name!==ee.name&&(db('"%s" works - aborting "%s"',Pe.name,ee.name),uc())}function vd(){ee.removeListener("open",Ub);ee.removeListener("error",eb);ee.removeListener("close",Lc);Le.removeListener("close",Ed);Le.removeListener("upgrading",pe)}db('probing transport "%s"',Xb);var ee=this.createTransport(Xb,{probe:1}),ze=!1,Le=this||Gc;oa.priorWebsocketSuccess=!1;ee.once("open",Ub);ee.once("error",eb);ee.once("close",Lc);this.once("close",Ed);this.once("upgrading",pe);ee.open()};oa.prototype.onOpen=
function(){db("socket open");(this||Gc).readyState="open";oa.priorWebsocketSuccess="websocket"===(this||Gc).transport.name;this.emit("open");this.flush();if("open"===(this||Gc).readyState&&(this||Gc).upgrade&&(this||Gc).transport.pause){db("starting upgrade probes");for(var Xb=0,Ub=(this||Gc).upgrades.length;Xb<Ub;Xb++)this.probe((this||Gc).upgrades[Xb])}};oa.prototype.onPacket=function(Xb){if("opening"===(this||Gc).readyState||"open"===(this||Gc).readyState||"closing"===(this||Gc).readyState)switch(db('socket receive: type "%s", data "%s"',
Xb.type,Xb.data),this.emit("packet",Xb),this.emit("heartbeat"),Xb.type){case "open":this.onHandshake(JSON.parse(Xb.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var Ub=Error("server error");Ub.code=Xb.data;this.onError(Ub);break;case "message":this.emit("data",Xb.data),this.emit("message",Xb.data)}else db('packet received with socket readyState "%s"',(this||Gc).readyState)};oa.prototype.onHandshake=function(Xb){this.emit("handshake",Xb);(this||Gc).id=Xb.sid;(this||Gc).transport.query.sid=
Xb.sid;(this||Gc).upgrades=this.filterUpgrades(Xb.upgrades);(this||Gc).pingInterval=Xb.pingInterval;(this||Gc).pingTimeout=Xb.pingTimeout;this.onOpen();"closed"!==(this||Gc).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||Gc).onHeartbeat),this.on("heartbeat",(this||Gc).onHeartbeat))};oa.prototype.onHeartbeat=function(Xb){clearTimeout((this||Gc).pingTimeoutTimer);var Ub=this||Gc;Ub.pingTimeoutTimer=setTimeout(function(){if("closed"!==Ub.readyState)Ub.onClose("ping timeout")},Xb||
Ub.pingInterval+Ub.pingTimeout)};oa.prototype.setPing=function(){var Xb=this||Gc;clearTimeout(Xb.pingIntervalTimer);Xb.pingIntervalTimer=setTimeout(function(){db("writing ping packet - expecting pong within %sms",Xb.pingTimeout);Xb.ping();Xb.onHeartbeat(Xb.pingTimeout)},Xb.pingInterval)};oa.prototype.ping=function(){var Xb=this||Gc;this.sendPacket("ping",function(){Xb.emit("ping")})};oa.prototype.onDrain=function(){(this||Gc).writeBuffer.splice(0,(this||Gc).prevBufferLen);(this||Gc).prevBufferLen=
0;0===(this||Gc).writeBuffer.length?this.emit("drain"):this.flush()};oa.prototype.flush=function(){"closed"!==(this||Gc).readyState&&(this||Gc).transport.writable&&!(this||Gc).upgrading&&(this||Gc).writeBuffer.length&&(db("flushing %d packets in socket",(this||Gc).writeBuffer.length),(this||Gc).transport.send((this||Gc).writeBuffer),(this||Gc).prevBufferLen=(this||Gc).writeBuffer.length,this.emit("flush"))};oa.prototype.write=oa.prototype.send=function(Xb,Ub,uc){this.sendPacket("message",Xb,Ub,uc);
return this||Gc};oa.prototype.sendPacket=function(Xb,Ub,uc,eb){"function"===typeof Ub&&(eb=Ub,Ub=void 0);"function"===typeof uc&&(eb=uc,uc=null);if("closing"!==(this||Gc).readyState&&"closed"!==(this||Gc).readyState){uc=uc||{};uc.compress=!1!==uc.compress;Xb={type:Xb,data:Ub,options:uc};this.emit("packetCreate",Xb);(this||Gc).writeBuffer.push(Xb);if(eb)this.once("flush",eb);this.flush()}};oa.prototype.close=function(){function Xb(){eb.onClose("forced close");db("socket closing - telling transport to close");
eb.transport.close()}function Ub(){eb.removeListener("upgrade",Ub);eb.removeListener("upgradeError",Ub);Xb()}function uc(){eb.once("upgrade",Ub);eb.once("upgradeError",Ub)}if("opening"===(this||Gc).readyState||"open"===(this||Gc).readyState){(this||Gc).readyState="closing";var eb=this||Gc;if((this||Gc).writeBuffer.length)this.once("drain",function(){(this||Gc).upgrading?uc():Xb()});else(this||Gc).upgrading?uc():Xb()}return this||Gc};oa.prototype.onError=function(Xb){db("socket error %j",Xb);oa.priorWebsocketSuccess=
!1;this.emit("error",Xb);this.onClose("transport error",Xb)};oa.prototype.onClose=function(Xb,Ub){if("opening"===(this||Gc).readyState||"open"===(this||Gc).readyState||"closing"===(this||Gc).readyState){db('socket close with reason: "%s"',Xb);var uc=this||Gc;clearTimeout((this||Gc).pingIntervalTimer);clearTimeout((this||Gc).pingTimeoutTimer);(this||Gc).transport.removeAllListeners("close");(this||Gc).transport.close();(this||Gc).transport.removeAllListeners();(this||Gc).readyState="closed";(this||
Gc).id=null;this.emit("close",Xb,Ub);uc.writeBuffer=[];uc.prevBufferLen=0}};oa.prototype.filterUpgrades=function(Xb){for(var Ub=[],uc=0,eb=Xb.length;uc<eb;uc++)~jb((this||Gc).transports,Xb[uc])&&Ub.push(Xb[uc]);return Ub};return Vd}function rc(){if(Jl)return Mk;Jl=!0;return Mk=function(oa,bb){for(var mb=[],db=(bb=bb||0)||0;db<oa.length;db++)mb[db-bb]=oa[db];return mb}}function xc(){if(mm)return Bm;mm=!0;return Bm=function(oa,bb,mb){oa.on(bb,mb);return{destroy:function(){oa.removeListener(bb,mb)}}}}
function I(){if(Kl)return jj;Kl=!0;var oa=[].slice;return jj=function(bb,mb){"string"==typeof mb&&(mb=bb[mb]);if("function"!=typeof mb)throw Error("bind() requires a function");var db=oa.call(arguments,2);return function(){return mb.apply(bb,db.concat(oa.call(arguments)))}}}function T(){function oa(eb,Lc,Ed){(this||He).io=eb;(this||He).nsp=Lc;(this||He).json=this||He;(this||He).ids=0;(this||He).acks={};(this||He).receiveBuffer=[];(this||He).sendBuffer=[];(this||He).connected=!1;(this||He).disconnected=
!0;(this||He).flags={};Ed&&Ed.query&&((this||He).query=Ed.query);(this||He).io.autoConnect&&this.open()}if(jl)return yk;jl=!0;var bb=ac(),mb=Yc(),db=rc(),jb=xc(),gc=I(),Qc=Fd()("socket.io-client:socket"),Oc=nc(),Xb=kc();yk=yk=oa;var Ub={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},uc=mb.prototype.emit;mb(oa.prototype);oa.prototype.subEvents=function(){if(!(this||He).subs){var eb=
(this||He).io;(this||He).subs=[jb(eb,"open",gc(this||He,"onopen")),jb(eb,"packet",gc(this||He,"onpacket")),jb(eb,"close",gc(this||He,"onclose"))]}};oa.prototype.open=oa.prototype.connect=function(){if((this||He).connected)return this||He;this.subEvents();(this||He).io.reconnecting||(this||He).io.open();if("open"===(this||He).io.readyState)this.onopen();this.emit("connecting");return this||He};oa.prototype.send=function(){var eb=db(arguments);eb.unshift("message");(this||He).emit.apply(this||He,eb);
return this||He};oa.prototype.emit=function(eb){if(Ub.hasOwnProperty(eb))return uc.apply(this||He,arguments),this||He;var Lc=db(arguments),Ed={type:(void 0!==(this||He).flags.binary?(this||He).flags.binary:Xb(Lc))?bb.BINARY_EVENT:bb.EVENT,data:Lc,options:{}};Ed.options.compress=!(this||He).flags||!1!==(this||He).flags.compress;"function"===typeof Lc[Lc.length-1]&&(Qc("emitting packet with ack id %d",(this||He).ids),(this||He).acks[(this||He).ids]=Lc.pop(),Ed.id=(this||He).ids++);(this||He).connected?
this.packet(Ed):(this||He).sendBuffer.push(Ed);(this||He).flags={};return this||He};oa.prototype.packet=function(eb){eb.nsp=(this||He).nsp;(this||He).io.packet(eb)};oa.prototype.onopen=function(){Qc("transport is open - connecting");if("/"!==(this||He).nsp)if((this||He).query){var eb="object"===typeof(this||He).query?Oc.encode((this||He).query):(this||He).query;Qc("sending connect packet with query %s",eb);this.packet({type:bb.CONNECT,query:eb})}else this.packet({type:bb.CONNECT})};oa.prototype.onclose=
function(eb){Qc("close (%s)",eb);(this||He).connected=!1;(this||He).disconnected=!0;delete (this||He).id;this.emit("disconnect",eb)};oa.prototype.onpacket=function(eb){var Lc=eb.type===bb.ERROR&&"/"===eb.nsp;if(eb.nsp===(this||He).nsp||Lc)switch(eb.type){case bb.CONNECT:this.onconnect();break;case bb.EVENT:this.onevent(eb);break;case bb.BINARY_EVENT:this.onevent(eb);break;case bb.ACK:this.onack(eb);break;case bb.BINARY_ACK:this.onack(eb);break;case bb.DISCONNECT:this.ondisconnect();break;case bb.ERROR:this.emit("error",
eb.data)}};oa.prototype.onevent=function(eb){var Lc=eb.data||[];Qc("emitting event %j",Lc);null!=eb.id&&(Qc("attaching ack callback to event"),Lc.push(this.ack(eb.id)));(this||He).connected?uc.apply(this||He,Lc):(this||He).receiveBuffer.push(Lc)};oa.prototype.ack=function(eb){var Lc=this||He,Ed=!1;return function(){if(!Ed){Ed=!0;var pe=db(arguments);Qc("sending ack %j",pe);Lc.packet({type:Xb(pe)?bb.BINARY_ACK:bb.ACK,id:eb,data:pe})}}};oa.prototype.onack=function(eb){var Lc=(this||He).acks[eb.id];
"function"===typeof Lc?(Qc("calling ack %s with %j",eb.id,eb.data),Lc.apply(this||He,eb.data),delete (this||He).acks[eb.id]):Qc("bad ack %s",eb.id)};oa.prototype.onconnect=function(){(this||He).connected=!0;(this||He).disconnected=!1;this.emit("connect");this.emitBuffered()};oa.prototype.emitBuffered=function(){var eb;for(eb=0;eb<(this||He).receiveBuffer.length;eb++)uc.apply(this||He,(this||He).receiveBuffer[eb]);(this||He).receiveBuffer=[];for(eb=0;eb<(this||He).sendBuffer.length;eb++)this.packet((this||
He).sendBuffer[eb]);(this||He).sendBuffer=[]};oa.prototype.ondisconnect=function(){Qc("server disconnect (%s)",(this||He).nsp);this.destroy();this.onclose("io server disconnect")};oa.prototype.destroy=function(){if((this||He).subs){for(var eb=0;eb<(this||He).subs.length;eb++)(this||He).subs[eb].destroy();(this||He).subs=null}(this||He).io.destroy(this||He)};oa.prototype.close=oa.prototype.disconnect=function(){(this||He).connected&&(Qc("performing disconnect (%s)",(this||He).nsp),this.packet({type:bb.DISCONNECT}));
this.destroy();if((this||He).connected)this.onclose("io client disconnect");return this||He};oa.prototype.compress=function(eb){(this||He).flags.compress=eb;return this||He};oa.prototype.binary=function(eb){(this||He).flags.binary=eb;return this||He};return yk}function ua(){function oa(bb){bb=bb||{};(this||Ei).ms=bb.min||100;(this||Ei).max=bb.max||1E4;(this||Ei).factor=bb.factor||2;(this||Ei).jitter=0<bb.jitter&&1>=bb.jitter?bb.jitter:0;(this||Ei).attempts=0}if(il)return zk;il=!0;zk=oa;oa.prototype.duration=
function(){var bb=(this||Ei).ms*Math.pow((this||Ei).factor,(this||Ei).attempts++);if((this||Ei).jitter){var mb=Math.random(),db=Math.floor(mb*(this||Ei).jitter*bb);bb=0==(Math.floor(10*mb)&1)?bb-db:bb+db}return Math.min(bb,(this||Ei).max)|0};oa.prototype.reset=function(){(this||Ei).attempts=0};oa.prototype.setMin=function(bb){(this||Ei).ms=bb};oa.prototype.setMax=function(bb){(this||Ei).max=bb};oa.prototype.setJitter=function(bb){(this||Ei).jitter=bb};return zk}function Da(){function oa(eb,Lc){if(!((this||
xd)instanceof oa))return new oa(eb,Lc);eb&&"object"===typeof eb&&(Lc=eb,eb=void 0);Lc=Lc||{};Lc.path=Lc.path||"/socket.io";(this||xd).nsps={};(this||xd).subs=[];(this||xd).opts=Lc;this.reconnection(!1!==Lc.reconnection);this.reconnectionAttempts(Lc.reconnectionAttempts||Infinity);this.reconnectionDelay(Lc.reconnectionDelay||1E3);this.reconnectionDelayMax(Lc.reconnectionDelayMax||5E3);this.randomizationFactor(Lc.randomizationFactor||.5);(this||xd).backoff=new Ub({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==Lc.timeout?2E4:Lc.timeout);(this||xd).readyState="closed";(this||xd).uri=eb;(this||xd).connecting=[];(this||xd).lastPing=null;(this||xd).encoding=!1;(this||xd).packetBuffer=[];eb=Lc.parser||jb;(this||xd).encoder=new eb.Encoder;(this||xd).decoder=new eb.Decoder;(this||xd).autoConnect=!1!==Lc.autoConnect;(this||xd).autoConnect&&this.open()}if(wj)return Kk;wj=!0;Ji||(Ji=!0,ig=Nb(),ig.parser=ab());var bb=ig;var mb=T(),db=Yc(),jb=ac(),gc=xc(),Qc=I(),
Oc=Fd()("socket.io-client:manager"),Xb=Wb(),Ub=ua(),uc=Object.prototype.hasOwnProperty;Kk=oa;oa.prototype.emitAll=function(){(this||xd).emit.apply(this||xd,arguments);for(var eb in(this||xd).nsps)uc.call((this||xd).nsps,eb)&&(this||xd).nsps[eb].emit.apply((this||xd).nsps[eb],arguments)};oa.prototype.updateSocketIds=function(){for(var eb in(this||xd).nsps)uc.call((this||xd).nsps,eb)&&((this||xd).nsps[eb].id=this.generateId(eb))};oa.prototype.generateId=function(eb){return("/"===eb?"":eb+"#")+(this||
xd).engine.id};db(oa.prototype);oa.prototype.reconnection=function(eb){if(!arguments.length)return(this||xd)._reconnection;(this||xd)._reconnection=!!eb;return this||xd};oa.prototype.reconnectionAttempts=function(eb){if(!arguments.length)return(this||xd)._reconnectionAttempts;(this||xd)._reconnectionAttempts=eb;return this||xd};oa.prototype.reconnectionDelay=function(eb){if(!arguments.length)return(this||xd)._reconnectionDelay;(this||xd)._reconnectionDelay=eb;(this||xd).backoff&&(this||xd).backoff.setMin(eb);
return this||xd};oa.prototype.randomizationFactor=function(eb){if(!arguments.length)return(this||xd)._randomizationFactor;(this||xd)._randomizationFactor=eb;(this||xd).backoff&&(this||xd).backoff.setJitter(eb);return this||xd};oa.prototype.reconnectionDelayMax=function(eb){if(!arguments.length)return(this||xd)._reconnectionDelayMax;(this||xd)._reconnectionDelayMax=eb;(this||xd).backoff&&(this||xd).backoff.setMax(eb);return this||xd};oa.prototype.timeout=function(eb){if(!arguments.length)return(this||
xd)._timeout;(this||xd)._timeout=eb;return this||xd};oa.prototype.maybeReconnectOnOpen=function(){!(this||xd).reconnecting&&(this||xd)._reconnection&&0===(this||xd).backoff.attempts&&this.reconnect()};oa.prototype.open=oa.prototype.connect=function(eb,Lc){Oc("readyState %s",(this||xd).readyState);if(~(this||xd).readyState.indexOf("open"))return this||xd;Oc("opening %s",(this||xd).uri);(this||xd).engine=bb((this||xd).uri,(this||xd).opts);var Ed=(this||xd).engine,pe=this||xd;(this||xd).readyState="opening";
(this||xd).skipReconnect=!1;var vd=gc(Ed,"open",function(){pe.onopen();eb&&eb()});Lc=gc(Ed,"error",function(Le){Oc("connect_error");pe.cleanup();pe.readyState="closed";pe.emitAll("connect_error",Le);if(eb){var Pe=Error("Connection error");Pe.data=Le;eb(Pe)}else pe.maybeReconnectOnOpen()});if(!1!==(this||xd)._timeout){var ee=(this||xd)._timeout;Oc("connect attempt will timeout after %d",ee);0===ee&&vd.destroy();var ze=setTimeout(function(){Oc("connect attempt timed out after %d",ee);vd.destroy();Ed.close();
Ed.emit("error","timeout");pe.emitAll("connect_timeout",ee)},ee);(this||xd).subs.push({destroy:function(){clearTimeout(ze)}})}(this||xd).subs.push(vd);(this||xd).subs.push(Lc);return this||xd};oa.prototype.onopen=function(){Oc("open");this.cleanup();(this||xd).readyState="open";this.emit("open");var eb=(this||xd).engine;(this||xd).subs.push(gc(eb,"data",Qc(this||xd,"ondata")));(this||xd).subs.push(gc(eb,"ping",Qc(this||xd,"onping")));(this||xd).subs.push(gc(eb,"pong",Qc(this||xd,"onpong")));(this||
xd).subs.push(gc(eb,"error",Qc(this||xd,"onerror")));(this||xd).subs.push(gc(eb,"close",Qc(this||xd,"onclose")));(this||xd).subs.push(gc((this||xd).decoder,"decoded",Qc(this||xd,"ondecoded")))};oa.prototype.onping=function(){(this||xd).lastPing=new Date;this.emitAll("ping")};oa.prototype.onpong=function(){this.emitAll("pong",new Date-(this||xd).lastPing)};oa.prototype.ondata=function(eb){(this||xd).decoder.add(eb)};oa.prototype.ondecoded=function(eb){this.emit("packet",eb)};oa.prototype.onerror=function(eb){Oc("error",
eb);this.emitAll("error",eb)};oa.prototype.socket=function(eb,Lc){function Ed(){~Xb(vd.connecting,pe)||vd.connecting.push(pe)}var pe=(this||xd).nsps[eb];if(!pe){pe=new mb(this||xd,eb,Lc);(this||xd).nsps[eb]=pe;var vd=this||xd;pe.on("connecting",Ed);pe.on("connect",function(){pe.id=vd.generateId(eb)});(this||xd).autoConnect&&Ed()}return pe};oa.prototype.destroy=function(eb){eb=Xb((this||xd).connecting,eb);~eb&&(this||xd).connecting.splice(eb,1);(this||xd).connecting.length||this.close()};oa.prototype.packet=
function(eb){Oc("writing packet %j",eb);var Lc=this||xd;eb.query&&0===eb.type&&(eb.nsp+="?"+eb.query);Lc.encoding?Lc.packetBuffer.push(eb):(Lc.encoding=!0,(this||xd).encoder.encode(eb,function(Ed){for(var pe=0;pe<Ed.length;pe++)Lc.engine.write(Ed[pe],eb.options);Lc.encoding=!1;Lc.processPacketQueue()}))};oa.prototype.processPacketQueue=function(){if(0<(this||xd).packetBuffer.length&&!(this||xd).encoding){var eb=(this||xd).packetBuffer.shift();this.packet(eb)}};oa.prototype.cleanup=function(){Oc("cleanup");
for(var eb=(this||xd).subs.length,Lc=0;Lc<eb;Lc++)(this||xd).subs.shift().destroy();(this||xd).packetBuffer=[];(this||xd).encoding=!1;(this||xd).lastPing=null;(this||xd).decoder.destroy()};oa.prototype.close=oa.prototype.disconnect=function(){Oc("disconnect");(this||xd).skipReconnect=!0;(this||xd).reconnecting=!1;"opening"===(this||xd).readyState&&this.cleanup();(this||xd).backoff.reset();(this||xd).readyState="closed";(this||xd).engine&&(this||xd).engine.close()};oa.prototype.onclose=function(eb){Oc("onclose");
this.cleanup();(this||xd).backoff.reset();(this||xd).readyState="closed";this.emit("close",eb);(this||xd)._reconnection&&!(this||xd).skipReconnect&&this.reconnect()};oa.prototype.reconnect=function(){if((this||xd).reconnecting||(this||xd).skipReconnect)return this||xd;var eb=this||xd;if((this||xd).backoff.attempts>=(this||xd)._reconnectionAttempts)Oc("reconnect failed"),(this||xd).backoff.reset(),this.emitAll("reconnect_failed"),(this||xd).reconnecting=!1;else{var Lc=(this||xd).backoff.duration();
Oc("will wait %dms before reconnect attempt",Lc);(this||xd).reconnecting=!0;var Ed=setTimeout(function(){eb.skipReconnect||(Oc("attempting reconnect"),eb.emitAll("reconnect_attempt",eb.backoff.attempts),eb.emitAll("reconnecting",eb.backoff.attempts),eb.skipReconnect||eb.open(function(pe){pe?(Oc("reconnect attempt error"),eb.reconnecting=!1,eb.reconnect(),eb.emitAll("reconnect_error",pe.data)):(Oc("reconnect success"),eb.onreconnect())}))},Lc);(this||xd).subs.push({destroy:function(){clearTimeout(Ed)}})}};
oa.prototype.onreconnect=function(){var eb=(this||xd).backoff.attempts;(this||xd).reconnecting=!1;(this||xd).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",eb)};return Kk}var Lb=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");Lb.nyi=function(oa){throw Error("Not yet implemented: "+oa);};Lb.string=nb;Lb.promise=Bb;Lb.debugMessageOrder=!1;var ub=function(oa){this.id=Lb.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};ub.prototype.isOnline=function(){Lb.nyi("isOnline")};ub.prototype.open=function(){Lb.nyi("isOnline")};ub.prototype.close=function(){Lb.nyi("close")};ub.prototype.remove=function(){Lb.nyi("remove")};ub.prototype.whenOnline=function(oa){var bb=this;return Lb.promise.waitFor(oa,function(){return bb.isOnline()}).then(function(){return bb}).catch(function(mb){return Promise.reject(/timeout/i.test(String(mb))?
Error("Timeout in "+bb+".whenOnline"):mb)})};ub.prototype.onError=function(oa){this.debug&&console.log("["+this+"] error: "+oa)};ub.prototype.removeService=function(oa){delete this.actions[oa]};ub.prototype.removeServices=function(oa){var bb=this;oa.forEach(function(mb){return bb.removeService(mb)})};ub.prototype.addService=function(oa,bb){this.actions[oa]=bb};ub.prototype.addServices=function(oa){var bb=this;Object.keys(oa).forEach(function(mb){return bb.addService(mb,oa[mb])})};ub.prototype.ping=
function(oa){var bb=this,mb,db,jb,gc,Qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oc){if(1==Oc.nextAddress)return mb=Date.now(),Oc.yield(bb.sendToAndWait(oa,"l2l-ping",{timestamp:mb}),2);db=Oc.yieldResult;jb=db.data;gc=jb.timestamp;Qc=Date.now();return Oc.return({to:gc-mb,from:Qc-gc,roundtrip:Qc-mb})})};ub.prototype.send=function(oa,bb){Lb.nyi("send")};ub.prototype.sendAndWait=function(oa){var bb=this,mb,db,jb,gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){switch(Qc.nextAddress){case 1:return mb=
new Promise(function(Oc,Xb){return bb.send(oa,Oc)}),db={},jb=bb.options.ackTimeout+400,"ackTimeout"in oa&&(jb=!oa.ackTimeout||0>oa.ackTimeout?null:oa.ackTimeout+400),jb?Qc.yield(Promise.race([Lb.promise.delay(jb,db),mb]),5):Qc.yield(mb,4);case 4:gc=Qc.yieldResult;Qc.jumpTo(3);break;case 5:gc=Qc.yieldResult;case 3:if(gc===db)throw Error("Timeout sending "+oa.action);return Qc.return(gc)}})};ub.prototype.sendTo=function(oa,bb,mb,db){return this.send({target:oa,action:bb,data:mb},db)};ub.prototype.sendToAndWait=
function(oa,bb,mb,db){return this.sendAndWait(Object.assign({target:oa,action:bb,data:mb},db))};ub.prototype.prepareSend=function(oa,bb){var mb=oa.target,db=oa.action,jb=oa.messageId,gc=oa.sender;if(!db)throw Error("Trying to send a message without specifying action!");if(!mb)throw Error("Trying to send message "+db+" without specifying target!");jb||(oa.messageId=Lb.string.newUUID());gc||(oa.sender=this.id);db=oa.n=this._outgoingOrderNumberingByTargets.get(mb)||0;this._outgoingOrderNumberingByTargets.set(mb,
db+1);if("function"===typeof bb){gc=this;var Qc=bb;bb=function(Oc){var Xb=gc._incomingOrderNumberingBySenders.get(Oc.sender)||0;gc.debug&&Lb.debugMessageOrder&&console.log("[MSG ORDER] "+gc+" received ack for "+Oc.action+" as msg "+Xb);try{Qc.apply(null,arguments)}catch(Ub){console.error("Error in ack fn of "+gc+": "+Ub.stack)}gc._incomingOrderNumberingBySenders.set(Oc.sender,Xb+1);setTimeout(function(){return gc.invokeOutOfOrderMessages(Oc.sender)},0)}}this.debug&&Lb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+db+" ("+oa.action+") to "+mb);return[oa,bb]};ub.prototype.prepareAnswerMessage=function(oa,bb){return{action:oa.action+"-response",inResponseTo:oa.messageId,target:oa.sender,data:bb,sender:this.id}};ub.prototype.installEventToMessageTranslator=function(oa){var bb=this,mb=oa.onevent;oa.onevent=function(db){var jb=db.data||[];mb.call(this,db);db.data=["*"].concat(jb);mb.call(this,db)};oa.on("*",function(db,jb){db&&"object"===typeof db&&db.action&&(jb=db,db=jb.action);var gc=arguments[arguments.length-
1];gc="function"===typeof gc?gc:null;(jb=jb===gc?null:jb)&&jb.data&&("number"===typeof jb.n||jb.broadcast)&&jb.sender?bb.receive(jb,oa,gc):(console.warn(bb+" received non-conformant message "+db+":",arguments),"function"===typeof gc&&gc({data:{error:"invalid l2l message"}}))})};ub.prototype.receive=function(oa,bb,mb){this.dispatchL2LMessageToSelf(oa,bb,mb)};ub.prototype.dispatchL2LMessageToSelf=function(oa,bb,mb){var db=this,jb=oa.action;if(oa.broadcast)this.safeInvokeServiceHandler(jb,oa,mb,bb);
else try{var gc=this._incomingOrderNumberingBySenders.get(oa.sender)||0,Qc="register"===jb||"unregister";if(!Qc&&oa.n<gc)console.error("[MSG ORDER] ["+this+"] received message no. "+oa.n+" but expected >= "+gc+", dropping "+jb);else if(!Qc&&oa.n>gc){this.debug&&Lb.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+jb+" ("+oa.n+") for later invocation");var Oc=this._outOfOrderCacheBySenders.get(oa.sender);Oc||(Oc=[],this._outOfOrderCacheBySenders.set(oa.sender,Oc));
Oc.push([jb,oa,mb,bb])}else this.safeInvokeServiceHandler(jb,oa,mb,bb),setTimeout(function(){return db.invokeOutOfOrderMessages(oa.sender)},0)}catch(Xb){console.error("Error message ordering when handling "+jb+": "+(Xb.stack||Xb)),"function"===typeof mb&&mb(this.prepareAnswerMessage(oa,{isError:!0,error:String(Xb.stack||Xb)}))}};ub.prototype.invokeOutOfOrderMessages=function(oa){var bb=this._outOfOrderCacheBySenders.get(oa);if(bb&&bb.length){var mb=this._incomingOrderNumberingBySenders.get(oa)||0;
oa=bb.findIndex(function(db){db=$jscomp.makeIterator(db);db.next();return db.next().value.n===mb});-1!==oa&&(bb.splice(oa,1),this.invokeServiceHandler.apply(this,bb[oa]))}};ub.prototype.renameTarget=function(oa,bb){if(oa!==bb){var mb=this._outgoingOrderNumberingByTargets.get(oa);this._outgoingOrderNumberingByTargets.delete(oa);this._outgoingOrderNumberingByTargets.set(bb,mb)}};ub.prototype.safeInvokeServiceHandler=function(oa,bb,mb,db){try{"function"===typeof this.actions[oa]?this.invokeServiceHandler(oa,
bb,mb,db):db._events&&Object.keys(db._events).includes(oa)||(console.warn("WARNING ["+this+"] Unhandled message: "+oa),"function"===typeof mb&&mb(this.prepareAnswerMessage(bb,{isError:!0,error:"message not understood: "+oa})))}catch(jb){console.error("Error when handling "+oa+": "+(jb.stack||jb)),"function"===typeof mb&&mb(this.prepareAnswerMessage(bb,{isError:!0,error:String(jb.stack||jb)}))}};ub.prototype.invokeServiceHandler=function(oa,bb,mb,db){var jb=this;this.debug&&Lb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+bb.n+" ("+bb.action+") from "+bb.sender);this._incomingOrderNumberingBySenders.set(bb.sender,bb.n+1);if("function"===typeof mb){var gc=!1,Qc=!1,Oc="ackTimeout"in bb?bb.ackTimeout:this.options.ackTimeout,Xb=this._outgoingOrderNumberingByTargets.get(bb.sender)||0;this._outgoingOrderNumberingByTargets.set(bb.sender,Xb+1);var Ub=function(uc){Qc?console.warn("["+jb+"] ackFn for "+bb.action+" called after it timed out, dropping answer!"):gc?console.warn("["+jb+"] ack function called repeatedly when handling "+
bb.action):(gc=!0,mb(jb.prepareAnswerMessage(bb,uc)),jb.debug&&Lb.debugMessageOrder&&console.log("[MSG ORDER] "+jb+" sending "+Xb+" (ack for "+bb.action+")"))};Oc&&setTimeout(function(){gc||(Ub({isError:!0,error:"Timeout error: "+jb+" did not send answer for "+bb.action+" after "+Oc+"ms"}),Qc=!0)},Oc)}try{this.actions[oa].call(this,this,bb,Ub,db)}catch(uc){console.error("["+this+"] Error handling "+oa+": "+(uc.stack||uc)),Ub&&Ub({error:uc.stack})}};$jscomp.global.Object.defineProperties(ub.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(oa){this.options.debug=oa}}});Lb.L2LConnection=ub;Lb.default=ub;var Ja=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),Rb={"l2l-ping":function(oa,bb,mb,db){db=bb.sender;bb=bb.data.timestamp;var jb=Date.now();"function"===typeof mb&&mb({timestamp:jb});oa.debug&&console.log("[undefined] got ping from "+db+", time: "+(jb-bb)+"ms")},"remote-eval":function(oa,bb,mb,db){var jb=bb.data.source;
Promise.resolve().then(function(){return eval(jb)}).then(function(gc){return mb({value:gc})}).catch(function(gc){gc.originalErr&&(gc=gc.originalErr);console.error("eval error: "+gc);"function"===typeof mb&&mb({isError:!0,value:String(gc.stack||gc)})})},"remote-eval-2":function(oa,bb,mb,db){var jb=bb.data.source;Promise.resolve().then(function(){var gc=eval(jb);if(!(gc instanceof Promise))throw console.error("unexpected eval result:"+gc),Error("unexpected eval result:"+gc);return gc}).then(function(gc){return mb(gc)}).catch(function(gc){console.error("eval error: "+
gc);gc.originalErr&&(gc=gc.originalErr);"function"===typeof mb&&mb({isError:!0,value:String(gc.stack||gc)})})}};Ja.defaultActions=Rb;Ja.defaultActions=Rb;Ja.defaultActions=Rb;var Mc={},Rc=(Mc["[broadcast] send"]=function(oa,bb,mb,db){var jb=bb.sender,gc=bb.data,Qc,Oc,Xb,Ub,uc,eb,Lc,Ed,pe,vd,ee,ze;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Le){Qc=gc;Oc=Qc.action;Xb=Qc.broadcast;Ub=Qc.room;uc=Qc.namespace;eb=Qc.isSystemBroadcast;Lc=Qc.isMultiServerBroadcast;Ed=[];Lc?(console.log(".......isMultiServerBroadcast"),
pe=oa,vd=pe.id,ee=oa.getTrackerList(),console.log(ee),Ed=ee.map(function(Pe){return Pe.id!=vd?Pe.io.nsps["/"+Pe.namespace]:db.broadcast})):(eb&&(uc=oa.namespace),Ed.push(uc?oa.io.nsps["/"+uc]:db.broadcast));Ed.forEach(function(Pe){return Pe.to(Ub).emit({action:Oc,sender:jb,broadcast:!0,data:Xb})});mb&&"function"===typeof mb&&(ze="message broadcasted to "+Ub,uc&&(ze+=" in namespace "+uc),1<Ed.length&&(ze+=" "+Ed.length+" trackers"),console.log(ze),mb({status:ze}));Le.jumpToEnd()})},Mc["[broadcast] join room"]=
function(oa,bb,mb,db){var jb=bb.sender,gc=bb.data.room,Qc,Oc,Xb,Ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(uc){if(1==uc.nextAddress)return Oc=!1,Xb=oa.io.nsps["/"+oa.namespace].adapter.rooms,(Ub=Xb[gc]&&Xb[gc].sockets&&Xb[gc].sockets[db.id])?(Qc=jb+" already in "+gc,uc.jumpTo(2)):uc.yield(new Promise(function(eb,Lc){return db.join(gc,function(Ed){return Ed?Lc(Ed):eb()})}),3);2!=uc.nextAddress&&(Qc=jb+" joined "+gc,Oc=!0);mb&&"function"===typeof mb&&mb({status:Qc,joined:Oc});uc.jumpToEnd()})},
Mc["[broadcast] leave room"]=function(oa,bb,mb,db){var jb=bb.sender,gc=bb.data.room,Qc,Oc,Xb,Ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(uc){if(1==uc.nextAddress)return Oc=!1,Xb=oa.io.nsps["/"+oa.namespace].adapter.rooms,Ub=Xb[gc]&&Xb[gc].sockets&&Xb[gc].sockets[db.id],Ub?uc.yield(new Promise(function(eb,Lc){return db.leave(gc,function(Ed){return Ed?Lc(Ed):eb()})}),3):(Qc=jb+" not in "+gc,uc.jumpTo(2));2!=uc.nextAddress&&(Qc=jb+" left room "+gc,Oc=!0);console.log(Qc);mb&&"function"===
typeof mb&&mb({left:Oc,status:Qc});uc.jumpToEnd()})},Mc["[broadcast] my rooms"]=function(oa,bb,mb,db){mb(db.rooms)},Mc["[broadcast] all rooms"]=function(oa,bb,mb,db){mb(oa.io.nsps["/"+oa.namespace].adapter.rooms)},Mc["[broadcast] list room members"]=function(oa,bb,mb,db){bb=bb.data.room;db=oa.io;bb?(oa=db.nsps["/"+oa.namespace].adapter.rooms[bb],mb({room:bb,sockets:oa?oa.sockets:{},length:oa?oa.length:0})):mb({isError:!0,error:"`room` paramerter missing!"})},Mc.getClients=function(oa,bb,mb){oa.removeDisconnectedClients();
mb(Array.from(oa.clients))},Mc);Ja.defaultTrackerActions=Rc;Ja.defaultTrackerActions=Rc;Ja.defaultTrackerActions=Rc;var yc={},Ga=(yc.getRoomList=function(oa){var bb=oa.client,mb=oa.ackFn,db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jb){db=bb._socketioClient.rooms;mb(db);jb.jumpToEnd()})},yc["ask for"]=function(oa,bb,mb,db){var jb=bb.sender,gc=bb.data.query,Qc=this,Oc,Xb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){if(1==Ub.nextAddress)return Oc=gc.match(/password|sudo/i)?
"passwordPrompt":"prompt",Ub.yield($world[Oc](gc),2);Xb=Ub.yieldResult;"function"===typeof mb&&mb({answer:Xb});oa.debug&&console.log("["+Qc+"] message 'ask for' from "+jb+", query: "+gc);Ub.jumpToEnd()})},yc["open editor"]=function(oa,bb,mb,db){var jb=bb.data.args,gc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){if(1==Qc.nextAddress)return jb.length?Qc.yield($world.execCommand("open file for EDITOR",{url:jb[0]}),2):(mb({error:"no file specified"}),Qc.return());gc=Qc.yieldResult;
"function"===typeof mb&&mb("aborted"===gc?{error:String(gc)}:{status:gc});Qc.jumpToEnd()})},yc.changeWorkingDirectory=function(oa,bb,mb,db){var jb=bb.data.args,gc,Qc,Oc,Xb,Ub,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){gc=$jscomp.makeIterator(jb||[]);Qc=gc.next().value;Oc=gc.next().value;Xb="OK";try{if(Qc)if(Oc){if(Ub=$world.getMorphWithId(Oc))if(Ub.__lookupSetter__("cwd"))Ub.cwd=Qc;else if("function"===typeof Ub.changeWorkingDirectory)Ub.changeWorkingDirectory(Qc);else if("function"===
typeof Ub.pluginFind){if(uc=Ub.pluginFind(function(Lc){return Lc.isShellEditorPlugin}))uc.cwd=Qc}else Xb="[changeWorkingDirectory] cannot figure pout how to set dir"}else Xb="[changeWorkingDirectory] No command morph";else Xb="[changeWorkingDirectory] No directory received"}catch(Lc){Xb=String(Lc)}"OK"!==Xb&&console.warn(Xb);"function"===typeof mb&&mb(Xb);eb.jumpToEnd()})},yc);Ja.defaultClientActions=Ga;Ja.defaultClientActions=Ga;Ja.defaultClientActions=Ga;var qc={},Za=!1,Pa={},Qa=!1,Hb={},Gb=!1,
ad="undefined"!==typeof self?self:global,Td={},Zd=!1,Ue="undefined"!==typeof self?self:global,Fc={},Md=!1,fd={},Ib=!1,fa="undefined"!==typeof self?self:global,ma={},tb=!1,H={},ka=!1,Ca={},rb=!1,sc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ac={},Bd=!1,kd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ue={},td=!1,Nd={},Ve=!1,Ke={},vf=!1,Ye={},zc=!1,Ze={},If=!1,Kf={},Ce=!1,wa={},La=!1,pb={},S=!1,xa={},Xa=!1,gb={},oc=!1,cc={},$c=
!1,Uc={},Wc=!1,Yd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,oe={},tf=!1,Dg={},Ah=!1,Mg={},ri=!1,Eg={},Cj=!1,Te="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,xi={},dh=!1,$d="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ij={},xk=!1,bg="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ni={},bk=!1,dk={},Ki=!1,wf="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,df={},kl=!1,Eb={},Fb=!1,Vd={},Sd=!1,Gc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ig={},Ji=!1,Mk={},Jl=!1,Bm={},mm=!1,jj={},Kl=!1,yk={},jl=!1,He="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,zk={},il=!1,Ei="undefined"!==typeof self?self:global,Kk={},wj=!1,xd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Bj={},xj=!1,Lk=function(){function oa(Qc,Oc){"object"===typeof Qc&&
(Oc=Qc,Qc=void 0);Oc=Oc||{};Qc=bb(Qc);var Xb=Qc.source,Ub=Qc.id,uc=Qc.path;uc=gc[Ub]&&uc in gc[Ub].nsps;Oc.forceNew||Oc["force new connection"]||!1===Oc.multiplex||uc?(jb("ignoring socket cache for %s",Xb),Xb=db(Xb,Oc)):(gc[Ub]||(jb("new io instance for %s",Xb),gc[Ub]=db(Xb,Oc)),Xb=gc[Ub]);Qc.query&&!Oc.query&&(Oc.query=Qc.query);return Xb.socket(Qc.path,Oc)}if(xj)return Bj;xj=!0;var bb=nd(),mb=ac(),db=Da(),jb=Fd()("socket.io-client");Bj=Bj=oa;var gc=Bj.managers={};Bj.protocol=mb.protocol;Bj.connect=
oa;Bj.Manager=Da();Bj.Socket=T();return Bj}(),Rf=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Rf.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Rf.isNode?System._nodeRequire("os").hostname():System.baseURL};Rf.promise=Bb;Rf.fun=Dd;Rf.obj=Ic;Rf.events=ud;Rf.num=Nc;Rf.L2LConnection=ub;Rf.defaultActions=Rb;Rf.defaultClientActions=Ga;Rf.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Rf._ioClient=Lk;Rf.ioClient=Rf.ioClient||void 0;Rf.isNode?(Rf.require=System._nodeRequire("module")._load,Rf.ioClient=Rf.require("socket.io-client")):Rf.ioClient=Rf._ioClient;Rf.urlHelper={isRoot:function(oa){return"/"===Rf.urlHelper.path(oa)},root:function(oa){return Rf.urlHelper.isRoot(oa)?oa:oa.slice(0,-Rf.urlHelper.path(oa).length)+"/"},path:function(){var oa=/^[a-z0-9-_\.]+:/,bb=/^\/\/[^\/]+/;return function(mb){mb=mb.replace(oa,"").replace(bb,"");return""===mb?"/":mb}}(),join:function(oa,
bb){oa.endsWith("/")&&(oa=oa.slice(0,-1));bb.startsWith("/")&&(bb=bb.slice(1));return oa+"/"+bb}};var nh=function(oa,bb,mb,db){var jb=Rf.L2LConnection.call(this)||this;Rf.events.makeEmitter(jb);jb.info=db;jb.origin=oa;jb.path=bb;jb.namespace=mb.replace(/^\/?/,"/");jb.trackerId=null;jb._socketioClient=null;jb._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Rf.defaultActions).forEach(function(gc){return jb.addService(gc,
Rf.defaultActions[gc])});Object.keys(Rf.defaultClientActions).forEach(function(gc){return jb.addService(gc,Rf.defaultClientActions[gc])});return jb};$jscomp.inherits(nh,Rf.L2LConnection);nh.clientKey=function(oa,bb,mb){oa=oa.replace(/\/$/,"");bb=bb.replace(/^\//,"");mb=mb.replace(/^\//,"");return oa+"-"+bb+"-"+mb};nh.forLivelyInBrowser=function(oa){var bb=!!oa;oa=Object.assign({type:"lively.morphic browser"},oa);var mb=this.default();if(!mb)return Rf.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:oa});bb&&!Rf.obj.equals(mb.info,oa)&&mb.isRegistered()&&(mb.info=oa,mb.unregister().then(function(){return mb.register()}).catch(function(db){return console.error("l2l re-register on info change errored: "+db)}));return mb};nh.default=function(){var oa=Rf.L2LClient.clients.keys().next().value;return Rf.L2LClient.clients.get(oa)};nh.create=function(oa){var bb=oa=void 0===oa?{}:oa;oa=void 0===bb.debug?!1:bb.debug;var mb=bb.url,db=bb.namespace,jb=void 0===bb.autoOpen?
!0:bb.autoOpen;bb=void 0===bb.info?{}:bb.info;if(!mb)throw Error("L2LClient needs server url!");var gc=Rf.urlHelper.root(mb).replace(/\/+$/,"");mb=Rf.urlHelper.path(mb);db=new this(gc,mb,db||"",bb);jb&&db.register();db.debug=oa;return db};nh.ensure=function(oa){var bb=oa=void 0===oa?{}:oa,mb=bb.url;bb=bb.namespace;if(!mb)throw Error("L2LClient needs server url!");var db=Rf.urlHelper.root(mb).replace(/\/+$/,""),jb=Rf.urlHelper.path(mb);db=this.clientKey(db,jb,bb||"");(jb=this.clients.get(db))||this.clients.set(db,
jb=this.create(Object.assign({},oa,{url:mb,namespace:bb})));return jb};nh.prototype.isOnline=function(){return this.socket&&this.socket.connected};nh.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};nh.prototype.open=function(){var oa=this,bb,mb,db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jb){if(1==jb.nextAddress)return oa.isOnline()||oa._reconnectState.isOpening?jb.return(oa):jb.yield(oa.close(),2);oa._reconnectState.closed=!1;bb=Rf.urlHelper.join(oa.origin,
oa.namespace);mb={path:oa.path,transports:["websocket","polling"]};db=oa._socketioClient=Rf.ioClient(bb,mb);oa.debug&&console.log("["+oa+"] connecting");db.on("error",function(gc){oa._reconnectState.isOpening=!1;oa.debug&&console.log("["+oa+"] errored: "+gc)});db.on("close",function(gc){return oa.debug&&console.log("["+oa+"] closed: "+gc)});db.on("reconnect_failed",function(){return oa.debug&&console.log("["+oa+"] could not reconnect")});db.on("reconnect_error",function(gc){return oa.debug&&console.log("["+
oa+"] reconnect error "+gc)});db.on("connect",function(){oa.debug&&console.log("["+oa+"] connected");oa.emit("connected",oa);oa._reconnectState.isOpening=!1;oa._reconnectState.isReconnecting=!1;oa._reconnectState.isReconnectingViaSocketio=!1});db.on("disconnect",function(){oa._reconnectState.isOpening=!1;oa.debug&&console.log("["+oa+"] disconnected");oa.emit("disconnected",oa);oa.trackerId?("tracker"!==oa.trackerId&&(oa.renameTarget(oa.trackerId,"tracker"),oa.trackerId=null),oa._reconnectState.closed?
oa.debug&&console.log("["+oa+"] won't reconnect b/c client is marked as closed"):oa._reconnectState.autoReconnect?(oa._reconnectState.isReconnecting=!0,setTimeout(function(){oa._reconnectState.closed?oa.debug&&console.log("["+oa+"] won't reconnect b/c client is marked as closed 2"):oa._reconnectState.isReconnectingViaSocketio?oa.debug&&console.log("["+oa+"] won't reconnect again, client already reconnecting"):(oa.debug&&console.log("["+oa+"] initiating reconnection to tracker"),oa.register())},20)):
oa.debug&&console.log("["+oa+"] won't reconnect b/c client has reconnection disabled")):(oa.debug&&console.log("["+oa+"] disconnect: don't have a tracker id, won't try reconnect"),oa.trackerId="tracker")});db.on("reconnecting",function(){oa.debug&&console.log("["+oa+"] reconnecting",oa._reconnectState);oa.emit("reconnecting",oa);oa._reconnectState.closed?(oa._reconnectState.isReconnecting=!1,oa._reconnectState.isReconnectingViaSocketio=!1,db.close(),oa.close()):(oa._reconnectState.isReconnecting=
!0,oa._reconnectState.isReconnectingViaSocketio=!0)});db.on("reconnect",function(){oa.debug&&console.log("["+oa+"] reconnected");oa._reconnectState.isReconnecting=!1;oa._reconnectState.isReconnectingViaSocketio=!1;oa.register()});oa.installEventToMessageTranslator(db);oa._reconnectState.isOpening=!0;return jb.return((new Promise(function(gc,Qc){db.once("error",Qc);db.once("connect",gc)})).then(function(){return oa}))})};nh.prototype.close=function(){var oa=this,bb,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(db){if(1==
db.nextAddress){oa._reconnectState.closed=!0;if(bb=oa.socket)bb.removeAllListeners("reconnect"),bb.removeAllListeners("reconnecting"),bb.removeAllListeners("disconnect"),bb.removeAllListeners("connect"),bb.removeAllListeners("reconnect_error"),bb.removeAllListeners("reconnect_failed"),bb.removeAllListeners("close"),bb.removeAllListeners("error"),bb.close();oa.debug&&console.log("["+oa+"] closing...");return oa.isRegistered()?db.yield(oa.unregister(),2):db.jumpTo(2)}return oa.isOnline()||oa.socket?
bb&&!bb.connected?(oa.debug&&console.log("["+oa+"] socket not connected, considering client closed"),db.return(oa)):db.return(Promise.race([Rf.promise.delay(2E3).then(function(){return bb.removeAllListeners("disconnect")}),new Promise(function(jb){return bb.once("disconnect",jb)})]).then(function(){oa.debug&&console.log("["+oa+"] closed");return oa})):(oa.debug&&(mb=oa.isOnline()?"no socket":"not online",oa.debug&&console.log("["+oa+"] cannot close: "+mb)),db.return(oa))})};nh.prototype.remove=function(){var oa=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(oa);return this.close()};nh.prototype.register=function(){var oa=this,bb,mb,db,jb,gc,Qc,Oc,Xb,Ub,uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:if(oa.isRegistered())return eb.return();if(oa._reconnectState.closed)return oa.debug&&console.log("["+oa+"] not registering this b/c closed"),oa._reconnectState.registerAttempt=0,eb.return();if(oa._reconnectState.registerProcess)return oa.debug&&
console.log("["+oa+"] not registering this b/c register process exists"),eb.return();eb.setCatchFinallyBlocks(2);if(oa.isOnline()){eb.jumpTo(4);break}return eb.yield(oa.open(),4);case 4:return oa.debug&&console.log("["+oa+"] register"),eb.yield(oa.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Rf.isNode?"node":"browser"),location:Rf.determineLocation()},oa.info)),6);case 6:bb=eb.yieldResult;if(!bb.data)throw mb=Error("Register answer is empty!"),oa.emit("error",
mb),mb;if(bb.data.isError)throw db=Error(bb.data.error),oa.emit("error",db),db;oa._reconnectState.registerAttempt=0;jb=bb;gc=jb.data;Qc=gc.trackerId;Oc=gc.messageNumber;oa.trackerId=Qc;oa._incomingOrderNumberingBySenders.set(Qc,Oc||0);oa.emit("registered",{trackerId:Qc});eb.leaveTryBlock(0);break;case 2:Xb=eb.enterCatchBlock(),console.error("Error in register request of "+oa+": "+Xb),Ub=oa._reconnectState.registerAttempt++,uc=Rf.num.backoff(Ub,4,3E5),oa._reconnectState.registerProcess=setTimeout(function(){oa._reconnectState.registerProcess=
null;oa.register()},uc),eb.jumpToEnd()}})};nh.prototype.unregister=function(){var oa=this,bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){switch(mb.nextAddress){case 1:if(!oa.isRegistered())return mb.return();oa.debug&&console.log("["+oa+"] unregister");bb=oa.trackerId;mb.setCatchFinallyBlocks(2);return mb.yield(oa.sendToAndWait(oa.trackerId,"unregister",{}),4);case 4:mb.leaveTryBlock(3);break;case 2:mb.enterCatchBlock();case 3:oa.renameTarget(bb,"tracker"),oa.trackerId=null,oa.emit("unregistered",
oa),mb.jumpToEnd()}})};nh.prototype.whenRegistered=function(oa){var bb=this;return Rf.promise.waitFor(oa,function(){return bb.isRegistered()}).catch(function(mb){return Promise.reject(/timeout/i.test(String(mb))?Error("Timeout in "+bb+".whenRegistered"):mb)})};nh.prototype.send=function(oa,bb){var mb=this,db=$jscomp.makeIterator(this.prepareSend(oa,bb));oa=db.next().value;bb=db.next().value;this.whenOnline().then(function(){var jb=mb.socket,gc=oa,Qc=gc.action;gc=gc.target;if(!jb)throw Error("Trying to send message "+
Qc+" to "+gc+" but cannot find a connection to it!");"function"===typeof bb?jb.emit(Qc,oa,bb):jb.emit(Qc,oa)})};nh.prototype.joinRoom=function(oa){var bb=this;return this.whenOnline().then(function(){return bb.sendToAndWait(bb.trackerId,"[broadcast] join room",{room:oa})})};nh.prototype.leaveRoom=function(oa){var bb=this;return this.whenOnline().then(function(){return bb.sendToAndWait(bb.trackerId,"[broadcast] leave room",{room:oa})})};nh.prototype.broadcast=function(oa,bb,mb,db,jb){var gc=this,Qc=
{action:bb,room:oa,broadcast:mb};if(void 0===db?0:db)Qc.isSystemBroadcast=!0;if(void 0===jb?0:jb)Qc.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return gc.sendToAndWait(gc.trackerId,"[broadcast] send",Qc)})};nh.prototype.listRoomMembers=function(oa){var bb=this,mb,db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jb){if(1==jb.nextAddress)return jb.yield(bb.sendToAndWait(bb.trackerId,"[broadcast] list room members",{room:oa}),2);mb=jb.yieldResult;db=mb.data;return jb.return(db)})};
nh.prototype.joinedRooms=function(){var oa=this,bb,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(db){if(1==db.nextAddress)return db.yield(oa.sendToAndWait(oa.trackerId,"[broadcast] my rooms",{}),2);bb=db.yieldResult;mb=bb.data;return db.return(mb)})};nh.prototype.listRooms=function(){var oa=this,bb,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(db){if(1==db.nextAddress)return db.yield(oa.sendToAndWait(oa.trackerId,"[broadcast] all rooms",{}),2);bb=db.yieldResult;mb=
bb.data;return db.return(mb)})};nh.prototype.listPeers=function(oa){oa=void 0===oa?!1:oa;var bb=this,mb,db,jb,gc,Qc,Oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xb){if(1==Xb.nextAddress)return mb=bb,db=mb._peersCached,jb=Date.now(),!oa&&db&&1E3>jb-db.timestamp?Xb.return(bb._peersCached.sessions):bb.isOnline()?Xb.yield(bb.sendToAndWait(bb.trackerId,"getClients",{}),2):Xb.return([]);gc=Xb.yieldResult;Qc=gc.data;Oc=Qc.map(function(Ub){var uc=$jscomp.makeIterator(Ub);Ub=uc.next().value;
var eb=uc.next().value,Lc=eb.info||{};uc=Lc.userRealm;var Ed=Lc.userToken,pe=Lc.l2lUserToken,vd=Lc.location,ee=Lc.type;Lc=Lc.world;Ub=Object.assign({},Rf.obj.dissoc(eb,["info"]),{id:Ub,world:Lc,location:vd,type:ee});(Ed=Ed||pe)&&"null"!==Ed&&(lively.user?Ub.user=lively.user.ClientUser.fromToken(Ed,uc):(Ub.userToken=Ed,Ub.userRealm=uc));return Ub});bb._peersCached={timestamp:jb,sessions:Oc};return Xb.return(Oc)})};nh.prototype.toString=function(){var oa=this.origin,bb=this.path,mb=this.namespace,db=
this.id,jb=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(db||"").slice(0,5)+" "+oa+bb+" - "+mb+" "+jb+")"};$jscomp.global.Object.defineProperties(nh.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(nh,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});ta("default",nh);Rf.L2LClient=nh;Rf.default=nh}}});