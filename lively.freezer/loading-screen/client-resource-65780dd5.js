System.register(["./__root_module__-89b08ab2.js","kld-intersections","./client-command-16d93993.js"],function(ta){var nb,xb,Ob,Hb,qd,Dc;return{setters:[function(hd){nb=hd.s;xb=hd.$;Ob=hd.a6;Hb=hd.bF;qd=hd.a7},function(){},function(hd){Dc=hd.runCommand}],execute:function(){function hd(Sa,ob){var $b,Sb,Bc,id,Xb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){if(1==Ub.nextAddress)return $b=ad.fileInfoCommandString(Sa,ob),Sb=ad.runCommand($b,ob),Ub.yield(Sb.whenDone(),2);if(Bc=0!=
Sb.exitCode?Sb.output:null)throw Bc;id=$jscomp.makeIterator(ad.parseDirectoryListFromLs(Sb.stdout,ob.rootDirectory||"."));Xb=id.next().value;return Ub.return(Xb)})}function Hc(Sa,ob){return ad.string.lines(Sa).map(function($b){return $b.trim().length?(new ad.FileInfo(ob)).readFromDirectoryListLine($b):null}).filter(Boolean)}function Fc(Sa,ob){var $b,Sb,Bc,id,Xb,Ub,ub,hc,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bd){$b=Object.assign({findFilesGroup:"default-find-files-process"},
ob);Sb=$b.findFilesGroup;Bc=$b.rootDirectory;Xb=id=ad.findFilesProcesses[Sb]||(ad.findFilesProcesses[Sb]={promiseState:null,commands:[]});Ub=Xb.commands;ub=Xb.promiseState;ub||(id.promiseState=ub=ad.promise.deferred());hc=ad.findFilesCommandString(Sa,ob);Ub.forEach(function(cd){return cd.kill()});wc=ad.runCommand(hc,ob);Ub.push(wc);wc.whenDone().then(function(){ad.arr.remove(Ub,wc);if(Ub.some(function(bb){return bb.startTime>wc.startTime}))console.log("[findFiles] command "+wc+" exited but a newer findFiles command was started for group "+
Sb+", discarding output");else{var cd=0!=wc.exitCode?wc.output:null;cd&&console.warn(cd);cd=cd?[]:ad.parseDirectoryListFromLs(wc.stdout,Bc)||[];ub.resolve(cd);Object.assign(id,{promiseState:null,commands:[]})}}).catch(function(cd){return console.error(cd)});return bd.return(ub.promise)})}function Sc(Sa){function ob($b){return Array.prototype.concat.apply([$b],$b.children?$b.children.map(ob):[])}return ob(Sa).map(function($b){var Sb=$b.fullPath.replace(/^\//,"");return{fileName:Sb,path:Sb,rootDirectory:"./",
isDirectory:$b.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var ad=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");ad.fileInfo=hd;ad.fileInfoCommandString=function(Sa,ob){var $b=ob=void 0===ob?{}:ob;ob=$b.rootDirectory;$b=$b.platform;ob=ob||".";var Sb="win32"===$b?"\\":"/";"win32"===$b||ob.endsWith(Sb)||(ob+=Sb);return"win32"===$b?"cd "+ob+' && ls -lLd --time-style=locale "'+Sa+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(ob+' && ls -lLd "$timeformat" "'+Sa+'"')};ad.parseDirectoryListFromLs=Hc;ad.findFiles=Fc;ad.findFilesCommandString=function(Sa,ob){var $b=ob=void 0===ob?{}:ob,Sb=$b.rootDirectory,Bc=$b.exclude,id=$b.depth;$b=$b.platform;Sb=Sb||".";Bc=Bc||"-iname "+ad.defaultExcludes.map(ad.string.print).join(" -o -iname ");var Xb="win32"===$b?"\\":"/";"win32"===$b||Sb.endsWith(Xb)||(Sb+=Xb);Sa=ad.string.format('%s "%s"',ob.re?"-iregex":ob.matchPath?"-ipath":"-iname",Sa);id="number"===typeof id?" -maxdepth "+id:"";
return"win32"===$b?ad.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",Sb,ob.re?"-E ":"",Bc.replace(/"/g,""),Sa.replace(/"/g,""),id):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+ad.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',Sb,ob.re?"-E ":"",Bc,Sa,id)};ad.convertDirectoryUploadEntriesToFileInfos=
Sc;ad.runCommand=Dc;ad.string=nb;ad.promise=xb;ad.arr=Ob;ad.fileInfo=hd;ad.fileInfo=hd;ad.parseDirectoryListFromLs=Hc;ad.parseDirectoryListFromLs=Hc;var Jd=function(Sa){this.rootDirectory=Sa;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};Jd.prototype.readFromDirectoryListLine=function(Sa){var ob=this;if(!Sa.trim().length)return null;var $b=Sa;this.reader.forEach(function(Sb){return $b=
Sb($b,ob)});return this};Jd.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(Jd.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(Sa,ob){var $b=Sa.indexOf(" ");ob.mode=Sa.slice(0,$b);ob.isDirectory="d"===ob.mode[0];return Sa.slice($b+1).trim()},function(Sa,ob){var $b=Sa.indexOf(" ");ob.linkCount=Number(Sa.slice(0,$b));return Sa.slice($b+1).trim()},function(Sa,ob){var $b=Sa.indexOf(" ");ob.user=Sa.slice(0,$b);return Sa.slice($b+1).trim()},
function(Sa,ob){var $b=ad.string.peekRight(Sa,0,/\s+[0-9]/);ob.group=Sa.slice(0,$b).trim();return Sa.slice($b).trim()},function(Sa,ob){var $b=Sa.indexOf(" ");ob.size=Number(Sa.slice(0,$b));return Sa.slice($b+1).trim()},function(Sa,ob){var $b=ad.string.reMatches(Sa,/[^s]+\s+[0-9:\s]+/);if(!$b||!$b[0])return Sa;ob.lastModified=new Date($b[0].match+" GMT");return Sa.slice($b[0].end).trim()},function(Sa,ob){var $b=(Sa=Sa.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&Sa.split(" -> "),Sb=""===Sa?!1:Sa&&
2===$b.length,Bc=($b=Sb?$b[0]:Sa)&&0===$b.indexOf(ob.rootDirectory)?$b.slice(ob.rootDirectory.length):$b;ob.fileName=""===Sa?".":Bc;ob.path=$b;ob.isLink=Sb;return Bc}]}}});ad.FileInfo=Jd;ad.findFilesProcesses={};ad.findFiles=Fc;ad.findFiles=Fc;ad.defaultExcludes=[".svn",".git","node_modules",".module_cache"];ad.convertDirectoryUploadEntriesToFileInfos=Sc;ad.convertDirectoryUploadEntriesToFileInfos=Sc;var ed=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");ed.Resource=Hb;ed.runCommand=
Dc;ed.fileInfo=hd;ed.findFiles=Fc;ed.string=nb;ed.promise=xb;ed.arr=Ob;ed.obj=qd;Jd=function(Sa,ob,$b){$b=void 0===$b?{}:$b;Sa=ed.Resource.call(this,Sa)||this;Sa.options=Object.assign({},$b,{l2lClient:ob||Sa.constructor.defaultL2lClient});return Sa};$jscomp.inherits(Jd,ed.Resource);Jd.prototype.newResource=function(Sa){return new this.constructor(Sa,this.options.l2lClient,this.options)};Jd.prototype.read=function(){var Sa=this,ob=ed.runCommand('cat "'+this.url+'"',this.options);return ob.whenDone().then(function(){if(ob.exitCode)throw Error("Read "+
Sa.url+" failed: "+ob.stderr);return ob.output})};Jd.prototype.write=function(Sa){var ob=this,$b,Sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bc){switch(Bc.nextAddress){case 1:return Sa?Bc.yield(ed.runCommand('touch "'+ob.url+'" && tee "'+ob.url+'"',Object.assign({stdin:String(Sa)},ob.options)).whenDone(),4):Bc.yield(ed.runCommand('echo -n > "'+ob.url+'"',Object.assign({},ob.options)).whenDone(),5);case 4:$b=Bc.yieldResult;Bc.jumpTo(3);break;case 5:$b=Bc.yieldResult;case 3:Sb=$b;
if(Sb.exitCode)throw Error("Write "+ob.url+" failed: "+Sb.stderr);return Bc.return(ob)}})};Jd.prototype.mkdir=function(){var Sa=this,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function($b){if(1==$b.nextAddress)return $b.yield(ed.runCommand('mkdir -p "'+Sa.url+'"',Sa.options).whenDone(),2);ob=$b.yieldResult;if(ob.exitCode)throw Error(Sa+" cannot create directory: "+ob.stderr);return $b.return(Sa)})};Jd.prototype.exists=function(){var Sa=ed.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return Sa.whenDone().then(function(){return 0===Sa.exitCode})};Jd.prototype.remove=function(){var Sa=this,ob=ed.runCommand('rm -rf "'+this.url+'"',this.options);return ob.whenDone().then(function(){if(ob.exitCode)throw Error("Remove of "+Sa.url+" failed: "+ob.stderr);return Sa})};Jd.prototype.gzip=function(Sa){var ob=this,$b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){$b=ed.runCommand('gzip > "'+ob.url+'"',Object.assign({stdin:String(Sa)},ob.options));
return Sb.return($b.whenDone().then(function(){if($b.exitCode)throw Error("Gzip compression of "+ob.url+" failed: "+$b.stderr);return ob}))})};Jd.prototype.brotli=function(Sa){var ob=this,$b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){$b=ed.runCommand('brotli > "'+ob.url+'"',Object.assign({stdin:String(Sa)},ob.options));return Sb.return($b.whenDone().then(function(){if($b.exitCode)throw Error("Brotli compression of "+ob.url+" failed: "+$b.stderr);return ob}))})};Jd.prototype.readProperties=
function(){var Sa=this,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function($b){if(1==$b.nextAddress)return $b.yield(ed.fileInfo(Sa.url,Sa.options),2);ob=$b.yieldResult;Sa.assignProperties(ed.obj.dissoc(ob,["fileName","path","rootDirectory"]));return $b.return(Sa)})};Jd.prototype.dirList=function(Sa,ob){Sa=void 0===Sa?1:Sa;ob=void 0===ob?{}:ob;var $b=this,Sb,Bc,id,Xb,Ub,ub,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){if(1==wc.nextAddress)return Sb=ob,Bc=Sb.exclude,
Array.isArray(Bc)&&(Bc="-iname "+Bc.map(ed.string.print).join(" -o -iname ")),id=$b,Xb=id.url,Ub=id.options,ub=Ub.l2lClient,wc.yield(ed.findFiles("*",{exclude:Bc,depth:Sa,rootDirectory:Xb,l2lClient:ub}),2);hc=wc.yieldResult;hc[0].path.replace(/\/$/,"")===$b.url.replace(/\/$/,"")&&hc.shift();return wc.return(hc.map(function(bd){var cd=bd.path;bd.isDirectory&&(cd=cd.replace(/\/?$/,"/"));cd=new $b.constructor(cd,ub,$b.options);cd.assignProperties(ed.obj.dissoc(bd,["fileName","path","rootDirectory"]));
return cd}))})};$jscomp.global.Object.defineProperties(Jd,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||ed._defaultL2LClient},set:function(Sa){this._defaultL2lClient=ed._defaultL2LClient=Sa}}});ta("default",Jd);ed.ShellClientResource=Jd;ed._defaultL2LClient=ed._defaultL2LClient||void 0;var sc=ta("resourceExtension",{name:"shell-client",matches:function(Sa){return Sa.startsWith("/")||Sa.match(/[a-z]:\\/i)},resourceClass:ed.ShellClientResource});ed.resourceExtension=
sc;ed.resourceExtension=sc;ed.resourceExtension=sc;ed.default=Jd}}});