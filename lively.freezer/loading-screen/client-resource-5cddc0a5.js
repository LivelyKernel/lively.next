System.register(["./__root_module__-b4667baa.js","kld-intersections","./client-command-b8e42a96.js"],function(ta){var lb,yb,Qb,Kb,yd,Cc;return{setters:[function(rd){lb=rd.s;yb=rd.$;Qb=rd.a6;Kb=rd.bE;yd=rd.a7},function(){},function(rd){Cc=rd.runCommand}],execute:function(){function rd(Pa,mb){var Nb,Ub,Ic,wd,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sb){if(1==Sb.nextAddress)return Nb=$c.fileInfoCommandString(Pa,mb),Ub=$c.runCommand(Nb,mb),Sb.yield(Ub.whenDone(),2);if(Ic=0!=
Ub.exitCode?Ub.output:null)throw Ic;wd=$jscomp.makeIterator($c.parseDirectoryListFromLs(Ub.stdout,mb.rootDirectory||"."));Eb=wd.next().value;return Sb.return(Eb)})}function Fc(Pa,mb){return $c.string.lines(Pa).map(function(Nb){return Nb.trim().length?(new $c.FileInfo(mb)).readFromDirectoryListLine(Nb):null}).filter(Boolean)}function Dc(Pa,mb){var Nb,Ub,Ic,wd,Eb,Sb,sb,ec,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){Nb=Object.assign({findFilesGroup:"default-find-files-process"},
mb);Ub=Nb.findFilesGroup;Ic=Nb.rootDirectory;Eb=wd=$c.findFilesProcesses[Ub]||($c.findFilesProcesses[Ub]={promiseState:null,commands:[]});Sb=Eb.commands;sb=Eb.promiseState;sb||(wd.promiseState=sb=$c.promise.deferred());ec=$c.findFilesCommandString(Pa,mb);Sb.forEach(function(Db){return Db.kill()});rc=$c.runCommand(ec,mb);Sb.push(rc);rc.whenDone().then(function(){$c.arr.remove(Sb,rc);if(Sb.some(function(ab){return ab.startTime>rc.startTime}))console.log("[findFiles] command "+rc+" exited but a newer findFiles command was started for group "+
Ub+", discarding output");else{var Db=0!=rc.exitCode?rc.output:null;Db&&console.warn(Db);Db=Db?[]:$c.parseDirectoryListFromLs(rc.stdout,Ic)||[];sb.resolve(Db);Object.assign(wd,{promiseState:null,commands:[]})}}).catch(function(Db){return console.error(Db)});return yc.return(sb.promise)})}function Rc(Pa){function mb(Nb){return Array.prototype.concat.apply([Nb],Nb.children?Nb.children.map(mb):[])}return mb(Pa).map(function(Nb){var Ub=Nb.fullPath.replace(/^\//,"");return{fileName:Ub,path:Ub,rootDirectory:"./",
isDirectory:Nb.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var $c=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");$c.fileInfo=rd;$c.fileInfoCommandString=function(Pa,mb){var Nb=mb=void 0===mb?{}:mb;mb=Nb.rootDirectory;Nb=Nb.platform;mb=mb||".";var Ub="win32"===Nb?"\\":"/";"win32"===Nb||mb.endsWith(Ub)||(mb+=Ub);return"win32"===Nb?"cd "+mb+' && ls -lLd --time-style=locale "'+Pa+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(mb+' && ls -lLd "$timeformat" "'+Pa+'"')};$c.parseDirectoryListFromLs=Fc;$c.findFiles=Dc;$c.findFilesCommandString=function(Pa,mb){var Nb=mb=void 0===mb?{}:mb,Ub=Nb.rootDirectory,Ic=Nb.exclude,wd=Nb.depth;Nb=Nb.platform;Ub=Ub||".";Ic=Ic||"-iname "+$c.defaultExcludes.map($c.string.print).join(" -o -iname ");var Eb="win32"===Nb?"\\":"/";"win32"===Nb||Ub.endsWith(Eb)||(Ub+=Eb);Pa=$c.string.format('%s "%s"',mb.re?"-iregex":mb.matchPath?"-ipath":"-iname",Pa);wd="number"===typeof wd?" -maxdepth "+wd:"";
return"win32"===Nb?$c.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",Ub,mb.re?"-E ":"",Ic.replace(/"/g,""),Pa.replace(/"/g,""),wd):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+$c.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',Ub,mb.re?"-E ":"",Ic,Pa,wd)};$c.convertDirectoryUploadEntriesToFileInfos=
Rc;$c.runCommand=Cc;$c.string=lb;$c.promise=yb;$c.arr=Qb;$c.fileInfo=rd;$c.fileInfo=rd;$c.parseDirectoryListFromLs=Fc;$c.parseDirectoryListFromLs=Fc;var Hd=function(Pa){this.rootDirectory=Pa;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};Hd.prototype.readFromDirectoryListLine=function(Pa){var mb=this;if(!Pa.trim().length)return null;var Nb=Pa;this.reader.forEach(function(Ub){return Nb=
Ub(Nb,mb)});return this};Hd.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(Hd.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(Pa,mb){var Nb=Pa.indexOf(" ");mb.mode=Pa.slice(0,Nb);mb.isDirectory="d"===mb.mode[0];return Pa.slice(Nb+1).trim()},function(Pa,mb){var Nb=Pa.indexOf(" ");mb.linkCount=Number(Pa.slice(0,Nb));return Pa.slice(Nb+1).trim()},function(Pa,mb){var Nb=Pa.indexOf(" ");mb.user=Pa.slice(0,Nb);return Pa.slice(Nb+1).trim()},
function(Pa,mb){var Nb=$c.string.peekRight(Pa,0,/\s+[0-9]/);mb.group=Pa.slice(0,Nb).trim();return Pa.slice(Nb).trim()},function(Pa,mb){var Nb=Pa.indexOf(" ");mb.size=Number(Pa.slice(0,Nb));return Pa.slice(Nb+1).trim()},function(Pa,mb){var Nb=$c.string.reMatches(Pa,/[^s]+\s+[0-9:\s]+/);if(!Nb||!Nb[0])return Pa;mb.lastModified=new Date(Nb[0].match+" GMT");return Pa.slice(Nb[0].end).trim()},function(Pa,mb){var Nb=(Pa=Pa.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&Pa.split(" -> "),Ub=""===Pa?!1:Pa&&
2===Nb.length,Ic=(Nb=Ub?Nb[0]:Pa)&&0===Nb.indexOf(mb.rootDirectory)?Nb.slice(mb.rootDirectory.length):Nb;mb.fileName=""===Pa?".":Ic;mb.path=Nb;mb.isLink=Ub;return Ic}]}}});$c.FileInfo=Hd;$c.findFilesProcesses={};$c.findFiles=Dc;$c.findFiles=Dc;$c.defaultExcludes=[".svn",".git","node_modules",".module_cache"];$c.convertDirectoryUploadEntriesToFileInfos=Rc;$c.convertDirectoryUploadEntriesToFileInfos=Rc;var gd=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");gd.Resource=Kb;gd.runCommand=
Cc;gd.fileInfo=rd;gd.findFiles=Dc;gd.string=lb;gd.promise=yb;gd.arr=Qb;gd.obj=yd;Hd=function(Pa,mb,Nb){Nb=void 0===Nb?{}:Nb;Pa=gd.Resource.call(this,Pa)||this;Pa.options=Object.assign({},Nb,{l2lClient:mb||Pa.constructor.defaultL2lClient});return Pa};$jscomp.inherits(Hd,gd.Resource);Hd.prototype.newResource=function(Pa){return new this.constructor(Pa,this.options.l2lClient,this.options)};Hd.prototype.read=function(){var Pa=this,mb=gd.runCommand('cat "'+this.url+'"',this.options);return mb.whenDone().then(function(){if(mb.exitCode)throw Error("Read "+
Pa.url+" failed: "+mb.stderr);return mb.output})};Hd.prototype.write=function(Pa){var mb=this,Nb,Ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ic){switch(Ic.nextAddress){case 1:return Pa?Ic.yield(gd.runCommand('touch "'+mb.url+'" && tee "'+mb.url+'"',Object.assign({stdin:String(Pa)},mb.options)).whenDone(),4):Ic.yield(gd.runCommand('echo -n > "'+mb.url+'"',Object.assign({},mb.options)).whenDone(),5);case 4:Nb=Ic.yieldResult;Ic.jumpTo(3);break;case 5:Nb=Ic.yieldResult;case 3:Ub=Nb;
if(Ub.exitCode)throw Error("Write "+mb.url+" failed: "+Ub.stderr);return Ic.return(mb)}})};Hd.prototype.mkdir=function(){var Pa=this,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){if(1==Nb.nextAddress)return Nb.yield(gd.runCommand('mkdir -p "'+Pa.url+'"',Pa.options).whenDone(),2);mb=Nb.yieldResult;if(mb.exitCode)throw Error(Pa+" cannot create directory: "+mb.stderr);return Nb.return(Pa)})};Hd.prototype.exists=function(){var Pa=gd.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return Pa.whenDone().then(function(){return 0===Pa.exitCode})};Hd.prototype.remove=function(){var Pa=this,mb=gd.runCommand('rm -rf "'+this.url+'"',this.options);return mb.whenDone().then(function(){if(mb.exitCode)throw Error("Remove of "+Pa.url+" failed: "+mb.stderr);return Pa})};Hd.prototype.gzip=function(Pa){var mb=this,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){Nb=gd.runCommand('gzip > "'+mb.url+'"',Object.assign({stdin:String(Pa)},mb.options));
return Ub.return(Nb.whenDone().then(function(){if(Nb.exitCode)throw Error("Gzip compression of "+mb.url+" failed: "+Nb.stderr);return mb}))})};Hd.prototype.brotli=function(Pa){var mb=this,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){Nb=gd.runCommand('brotli > "'+mb.url+'"',Object.assign({stdin:String(Pa)},mb.options));return Ub.return(Nb.whenDone().then(function(){if(Nb.exitCode)throw Error("Brotli compression of "+mb.url+" failed: "+Nb.stderr);return mb}))})};Hd.prototype.readProperties=
function(){var Pa=this,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){if(1==Nb.nextAddress)return Nb.yield(gd.fileInfo(Pa.url,Pa.options),2);mb=Nb.yieldResult;Pa.assignProperties(gd.obj.dissoc(mb,["fileName","path","rootDirectory"]));return Nb.return(Pa)})};Hd.prototype.dirList=function(Pa,mb){Pa=void 0===Pa?1:Pa;mb=void 0===mb?{}:mb;var Nb=this,Ub,Ic,wd,Eb,Sb,sb,ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==rc.nextAddress)return Ub=mb,Ic=Ub.exclude,
Array.isArray(Ic)&&(Ic="-iname "+Ic.map(gd.string.print).join(" -o -iname ")),wd=Nb,Eb=wd.url,Sb=wd.options,sb=Sb.l2lClient,rc.yield(gd.findFiles("*",{exclude:Ic,depth:Pa,rootDirectory:Eb,l2lClient:sb}),2);ec=rc.yieldResult;ec[0].path.replace(/\/$/,"")===Nb.url.replace(/\/$/,"")&&ec.shift();return rc.return(ec.map(function(yc){var Db=yc.path;yc.isDirectory&&(Db=Db.replace(/\/?$/,"/"));Db=new Nb.constructor(Db,sb,Nb.options);Db.assignProperties(gd.obj.dissoc(yc,["fileName","path","rootDirectory"]));
return Db}))})};$jscomp.global.Object.defineProperties(Hd,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||gd._defaultL2LClient},set:function(Pa){this._defaultL2lClient=gd._defaultL2LClient=Pa}}});ta("default",Hd);gd.ShellClientResource=Hd;gd._defaultL2LClient=gd._defaultL2LClient||void 0;var Uc=ta("resourceExtension",{name:"shell-client",matches:function(Pa){return Pa.startsWith("/")||Pa.match(/[a-z]:\\/i)},resourceClass:gd.ShellClientResource});gd.resourceExtension=
Uc;gd.resourceExtension=Uc;gd.resourceExtension=Uc;gd.default=Hd}}});