System.register(["./__rootModule___commonjs-entry-71573ff5.js","@babel/plugin-syntax-import-meta"],function(Lc){var pd,Nd,Tc,Jc,$d,Bb,rd,Id,Ac,Pc,gd,nd,Fd,ic,vd,sb,Xb,Nb,bc;return{setters:[function(hb){pd=hb.f;Nd=hb.B;Tc=hb.j;Jc=hb.n;$d=hb.k;Bb=hb.aq;rd=hb.l;Id=hb.bM;Ac=hb.bN;Pc=hb.bO;gd=hb.bP;nd=hb.bp;Fd=hb.bQ;ic=hb.bR;vd=hb.bS;sb=hb.i;Xb=hb.y;Nb=hb.x;bc=hb.G},function(){}],execute:function(){var hb=window.lively.FreezerRuntime.recorderFor("lively.serializer2/debugging.js");hb.fun=pd;hb.obj=Nd;hb.arr=
Tc;hb.num=Jc;hb.string=$d;hb.graph=Bb;hb.Path=rd;hb.ObjectPool=Id;hb.lookupPath=Ac;hb.referencesAndClassNamesOfId=Pc;hb.modifyProperty=gd;hb.removeUnreachableObjects=nd;hb.referenceGraph=Fd;hb.findPathFromToId=ic;hb.ClassHelper=vd;var cb=Lc("SnapshotInspector",function(Hb){var ec=window.lively.FreezerRuntime.recorderFor("lively.serializer2/debugging.js"),ub=ec.hasOwnProperty("SnapshotInspector")&&"function"===typeof ec.SnapshotInspector?ec.SnapshotInspector:ec.SnapshotInspector=function(yb){if(!yb||
!yb[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return sb(ub,Hb,[{key:Symbol["for"]("lively-instance-initialize"),value:function(yb){this.snapshot=yb;this.classes={};this.expressions={}}},{key:"processSnapshot",value:function(){var yb=this.snapshot;yb.snapshot&&(yb=yb.snapshot);yb=hb.ObjectPool.fromSnapshot(yb);return this.processPool(yb)}},{key:"processPool",value:function(yb){var ba=this.expressions,wb=this.classes;this.pool=
yb;yb.objectRefs().forEach(function(Xa){var Za=Xa.currentSnapshot,Sb=(Za[hb.ClassHelper.classMetaForSerializationProp]||{}).className,Cb=Object.keys(Za.props);null==Sb&&(Sb=3<Cb.length?"{"+Cb.slice(0,3).join(", ")+", ...}":"{"+Cb.join(", ")+"}");wb[Sb]||(wb[Sb]={count:0,bytes:0,name:Sb,objects:[]});wb[Sb].count++;wb[Sb].bytes+=JSON.stringify(Za).length;wb[Sb].objects.push([Xa.id,Za]);Cb.forEach(function(Da){var zb=Za.props[Da].value;if(zb&&"string"===typeof zb&&yb.expressionSerializer.isSerializedExpression(zb)){var db=
yb.expressionSerializer.exprStringDecode(zb).__expr__,ib=ba[db];ib||(ib=ba[db]={count:0,bytes:0,name:db,objects:[]});ib.count++;ib.bytes+=zb.length;ib.objects.push([[Xa.id,Da],zb])}})});return this}},{key:"explainId",value:function(yb){var ba=this.snapshot;ba.snapshot&&(ba=ba.snapshot);ba=ba[yb];if(!ba)return null;yb=(ba[hb.ClassHelper.classMetaForSerializationProp]||{className:"Object"}).className;ba=Object.keys(ba.props);"Object"==yb&&(yb=3<ba.length?"{"+ba.slice(0,3).join(", ")+", ...}":"{"+ba.join(", ")+
"}");return yb}},{key:"sorted",value:function(yb){var ba=this;return hb.arr.sortBy(Object.keys(this[yb]).map(function(wb){return ba[yb][wb]}),function(wb){return isNaN(wb.bytes)?0:wb.bytes}).reverse()}},{key:"report",value:function(yb){yb=[["#bytes","#objs","avg",yb]].concat(Xb(this.sorted(yb).map(function(ba){return[hb.num.humanReadableByteSize(ba.bytes),ba.count,hb.num.humanReadableByteSize(ba.bytes/ba.count),hb.string.truncate(ba.name,300)]})));return hb.string.printTable(yb,{separator:" | "})}},
{key:"toString",value:function(){var yb=this.snapshot,ba=JSON.stringify(yb).length;yb=Object.keys(yb).length;return hb.string.format("Total: %s (%s objs - %s per obj)",hb.num.humanReadableByteSize(ba),yb,hb.num.humanReadableByteSize(ba/yb))+"\nclasses:\n"+this.report("classes")+"\nexpressions:\n"+this.report("expressions")}},{key:"biggestObjectsOfType",value:function(yb){return hb.arr.sortBy(this.classes[yb].objects.map(function(ba){ba=Nb(ba,2);ba[0];return JSON.stringify(ba[1])}),function(ba){return ba.length}).reverse().map(function(ba){return JSON.parse(ba)})}},
{key:"toCSV",value:function(){var yb=["type,size,size in bytes,count,size per object,size perobject in bytes"];this.sorted("classes").forEach(function(ba){yb.push([ba.name,hb.num.humanReadableByteSize(ba.bytes),ba.bytes,ba.count,hb.num.humanReadableByteSize(ba.bytes/ba.count),ba.bytes/ba.count].join())});return yb.join("\n")}},{key:"findPathFromToId",value:function(yb,ba){var wb=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},Xa=this.snapshot;Xa.snapshot&&(Xa=Xa.snapshot);return hb.findPathFromToId(Xa,
yb,ba,wb)}},{key:"referenceGraph",value:function(){var yb=this.snapshot;yb.snapshot&&(yb=yb.snapshot);return hb.referenceGraph(yb)}},{key:"referenceCounts",value:function(){var yb=hb.graph.invert(this.referenceGraph()),ba={};Object.keys(yb).forEach(function(wb){return ba[wb]=yb[wb].length});return ba}},{key:"lookupPath",value:function(yb,ba){var wb=this.snapshot;wb.snapshot&&(wb=wb.snapshot);return hb.lookupPath(wb,yb,ba)}},{key:"idsReferencingId",value:function(yb){return hb.graph.invert(this.referenceGraph())[yb]}},
{key:"modifyProperty",value:function(yb,ba,wb){var Xa=this.snapshot;Xa.snapshot&&(Xa=Xa.snapshot);return hb.modifyProperty(Xa,yb,ba,wb)}},{key:"replaceReferencesTo",value:function(yb,ba){var wb=hb.graph.invert(this.referenceGraph())[yb];wb=bc(wb);var Xa;try{for(wb.s();!(Xa=wb.n()).done;){var Za=Xa.value,Sb=this.findPathFromToId(Za,yb);this.modifyProperty(Za,Sb,ba)}}catch(Cb){wb.e(Cb)}finally{wb.f()}}},{key:"removeUnreachableObjects",value:function(yb){var ba=this.snapshot;yb||(yb=this.snapshot.id);
if(!yb)throw Error("Cannot find root id");ba.snapshot&&(ba=ba.snapshot);return hb.removeUnreachableObjects([yb],ba)}},{key:"reportAboutObject",value:function(yb,ba,wb){var Xa=this;ba=ba||this.referenceGraph();wb=wb||hb.graph.invert(ba);wb=(wb[yb]||[]).map(function(Za){return[Za,Xa.findPathFromToId(Za,yb),Xa.explainId(Za)]});ba=(ba[yb]||[]).map(function(Za){return[Za,Xa.findPathFromToId(yb,Za),Xa.explainId(Za)]});return"".concat(yb,"\n")+" is a ".concat(this.explainId(yb)," object\n")+" path from root: ".concat(this.findPathFromToId(this.snapshot.id,
yb),"\n")+" references \n".concat(hb.string.indent(hb.string.printTable(ba),"  ",2),"\n")+" referenced by:\n".concat(hb.string.indent(hb.string.printTable(wb),"  ",2),"\n")}},{key:"reportAboutObjects",value:function(yb){var ba=this,wb=this.referenceGraph(),Xa=hb.graph.invert(wb);return yb.map(function(Za){return ba.reportAboutObject(Za,wb,Xa)}).join("\n")}},{key:"rootObjectName",value:function(){var yb=this.snapshot,ba="";if(yb.snapshot){var wb=yb.id;yb=yb.snapshot;yb[wb].props.name&&(ba=yb[wb].props.name.value)}return ba}},
{key:"openSummary",value:function(){var yb=this.rootObjectName();return $world.execCommand("open text window",{content:this.toString(),title:"serialization debug"+(yb?" for "+yb:""),fontFamily:"monospace"})}},{key:"openConnectionsList",value:function(){var yb=this,ba=this.rootObjectName(),wb=((this.classes.AttributeConnection||{}).objects||[]).map(function(Xa){var Za=Nb(Xa,2);Xa=Za[0];var Sb=Za[1].props;Za=Sb.sourceObj;var Cb=Sb.sourceAttrName,Da=Sb.targetObj;Sb=Sb.targetMethodName;return"".concat(yb.explainId(Za.value.id),
".").concat(Cb.value," => ")+"".concat(yb.explainId(Da.value.id),".").concat(Sb.value,"\n")+"  ".concat(Za.value.id," => ").concat(Da.value.id,"\n")+"  connection id: ".concat(Xa,"\n")}).join("\n");return $world.execCommand("open text window",{content:wb,title:"serialized connections"+(ba?" for "+ba:""),fontFamily:"monospace"})}},{key:"openObjectReport",value:function(){var yb=this.snapshot,ba=this.rootObjectName();yb.snapshot&&(yb=yb.snapshot);$world.execCommand("open text window",{title:"object report"+
(ba?" for "+ba:""),content:this.reportAboutObjects(Object.keys(yb)),fontFamily:"monospace"})}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"SnapshotInspector"}},{key:"forSnapshot",value:function(yb){return(new this(yb)).processSnapshot()}},{key:"forPoolAndSnapshot",value:function(yb,ba){return(new this(yb)).processPool(ba)}},{key:"checkForLeaks",value:function(yb){(new this).processPool(yb).referenceCounts();(this.classes.AttributeConnection||{}).objects||[]}}],ec,{pathInPackage:function(){return"./debugging.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.serializer2",version:"0.1.3"}}},{start:3299,end:12122})}(void 0));hb.SnapshotInspector=cb;hb.SnapshotInspector=cb}}});