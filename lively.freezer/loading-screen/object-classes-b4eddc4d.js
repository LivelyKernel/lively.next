System.register(["./__root_module__-11543d52.js","kld-intersections"],function(sa){var lb,Eb,Vb,Wb,qd,Ec,vd,Ic,Jc,Zc,$c,Fd,md,Vc,Ra;return{setters:[function(tb){lb=tb.s;Eb=tb.P;Vb=tb.a4;Wb=tb.p;qd=tb.bD;Ec=tb.B;vd=tb.bE;Ic=tb.r;Jc=tb.aQ;Zc=tb.bF;$c=tb.bG;Fd=tb.bH;md=tb.bI;Vc=tb.bJ;Ra=tb.n},function(){}],execute:function(){function tb($b,zc,Fb,Bb){Bb=void 0===Bb?{}:Bb;Bb=Bb.package||bc.ObjectPackage.lookupPackageForObject($b,Bb);if(!Bb)throw Error("Object is not part of an object package: "+$b);
return Bb.addScript($b,zc,Fb)}function dc($b,zc){zc=bc.normalizeOptions(zc).System;$b=($b=$b[Symbol.for("lively-module-meta")])?$b.package.name:null;return(zc=($b?bc.lookupPackage(zc,$b):{}).pkg)?!!bc.ObjectPackage.forSystemPackage(zc):!1}sa({addScript:tb,isObjectClass:dc});var bc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");bc.normalizeOptions=function($b){$b=Object.assign({baseURL:bc.defaultBaseURL,System:System},$b);$b.baseURL=$b.baseURL.replace(/\/$/,"");return $b};bc.addScript=
tb;bc.isObjectClass=dc;bc.string=lb;bc.Path=Eb;bc.arr=Vb;bc.parse=Wb;bc.isValidIdentifier=qd;bc.stringify=Ec;bc.parseFunction=vd;bc.resource=Ic;bc.runEval=Jc;bc.scripting=Zc;bc.ExportLookup=$c;var Yc=bc.scripting;bc.ensurePackage=Yc.ensurePackage;bc.registerPackage=Yc.registerPackage;bc.importPackage=Yc.importPackage;bc.lookupPackage=Yc.lookupPackage;bc.module=Yc.module;bc.ImportInjector=Yc.ImportInjector;bc.RuntimeSourceDescriptor=Fd;bc.toJsIdentifier=md;bc.adoptObject=Vc;bc.classToFunctionTransform=
Ra;bc.objectPackageSym=Symbol.for("lively-object-package-data");bc.defaultBaseURL="local://lively-object-modules";bc.globalClasses=Object.keys(System.global).map(function($b){$b=System.global[$b];return"function"===typeof $b&&$b.name&&$b}).filter(Boolean);bc.addScript=tb;bc.addScript=tb;bc.isObjectClass=dc;bc.isObjectClass=dc;bc._packageStore=bc._packageStore||{};Yc=function($b,zc){this._id=$b;this.options=bc.normalizeOptions(zc)};Yc.lookupPackageForObject=function($b,zc){return this.lookupPackageForClass($b.constructor,
zc)};Yc.lookupPackageForClass=function($b,zc){zc=bc.normalizeOptions(zc).System;$b=($b=$b[Symbol.for("lively-module-meta")])?$b.package.name:null;return(zc=($b?bc.lookupPackage(zc,$b):{}).pkg)?bc.ObjectPackage.forSystemPackage(zc):null};Yc.forSystemPackage=function($b){return this.packageStore[$b.name]};Yc.withId=function($b,zc){return this.packageStore[$b]||(this.packageStore[$b]=new this($b,zc))};Yc.prototype.resource=function($b){$b=void 0===$b?"":$b;return bc.resource(this.packageURL).join($b)};
Yc.prototype.load=function(){return bc.importPackage(this.System,this.packageURL)};Yc.prototype.ensureExistance=function(){var $b=this,zc,Fb,Bb,pc,Pc,xb,db,Ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){switch(cb.nextAddress){case 1:return zc=$b.resource("/"),cb.yield(zc.exists(),2);case 2:if(cb.yieldResult)return cb.return();Fb=[{resource:zc}];Bb=[{resource:$b.resource("package.json"),content:JSON.stringify($b.config,null,2)}];return cb.yield(Promise.all(Fb.map(function(la){return la.resource.mkdir()})),
3);case 3:return cb.yield(Promise.all(Bb.map(function(la){var La;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fb){switch(fb.nextAddress){case 1:return fb.yield(la.resource.exists(),2);case 2:if(!(La=!fb.yieldResult)){fb.jumpTo(3);break}return fb.yield(la.resource.write(la.content),4);case 4:La=fb.yieldResult;case 3:return fb.return(La)}})})),4);case 4:return cb.yield($b.objectModule.ensureExistance(),5);case 5:return pc=$b,Pc=pc.System,xb=pc.packageURL,db=pc.config,cb.yield(bc.ensurePackage(Pc,
xb),6);case 6:return Ta=cb.yieldResult,Ta.registerWithConfig(db),console.log($b.packageURL+" REGISTERED"),cb.return($b)}})};Yc.prototype.ensureObjectClass=function($b){var zc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return 1==Fb.nextAddress?Fb.yield(zc.ensureExistance(),2):Fb.return(zc.objectModule.ensureObjectClass($b))})};Yc.prototype.adoptObject=function($b){var zc=this,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){if(1==Bb.nextAddress)return zc.objectClass===
$b.constructor?Bb.return():Bb.yield(zc.ensureObjectClass($b.constructor),2);Fb=Bb.yieldResult;bc.adoptObject($b,Fb);Bb.jumpToEnd()})};Yc.prototype.addScript=function($b,zc,Fb){return this.objectModule.addScript($b,zc,Fb)};Yc.prototype.remove=function(){this.systemPackage.remove();delete bc.ObjectPackage.packageStore[this.id];return this.resource().remove()};Yc.prototype.renameObjectClass=function($b,zc){zc=void 0===zc?[]:zc;var Fb=this,Bb,pc,Pc,xb,db,Ta,cb,la,La,fb,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cb){if(1==
Cb.nextAddress){Bb=Fb;pc=Bb.objectClass;Pc=Bb.System;if(!pc||pc.className===$b)return Cb.return(pc);if(!bc.isValidIdentifier($b))throw Error($b+" is not a valid name for a class");db=xb=bc.RuntimeSourceDescriptor.for(pc,Pc);Ta=db.source;cb=db.ast;la=cb.id;La=la.start;fb=la.end;return Cb.yield(xb.changeSource(Ta.slice(0,La)+$b+Ta.slice(fb)),2)}pb=Fb.objectClass;zc.forEach(function(Wa){Wa.constructor=pb;Wa.__proto__=pb.prototype});return Cb.return(pb)})};Yc.prototype.fork=function($b,zc){var Fb=this,
Bb,pc,Pc,xb,db,Ta,cb,la,La,fb,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cb){switch(Cb.nextAddress){case 1:return Bb=Fb,pc=Bb.System,Pc=Bb.baseURL,xb=Bb.objectClass,zc=Object.assign({System:pc,baseURL:Pc},zc),db=bc.RuntimeSourceDescriptor.for(xb),Ta=db._renamedSource($b),cb=Ta.moduleSource,la=bc.ObjectPackage.withId($b,zc),Cb.yield(la.ensureExistance(),2);case 2:return La=la,fb=La.objectModule,pb=fb.systemModule,Cb.yield(pb.load({format:"esm"}),3);case 3:return Cb.yield(pb.changeSource(cb),
4);case 4:return Cb.return(la)}})};$jscomp.global.Object.defineProperties(Yc.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return bc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new bc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(Yc,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=bc._packageStore)}}});sa("default",Yc);bc.ObjectPackage=Yc;var Oc=function($b,zc){if(!$b)throw Error("ObjectModule needs package!");if(!zc)throw Error("ObjectModule needs package!");this._moduleName=$b;this._objectPackage=zc};Oc.prototype.read=function(){return this.resource.read()};Oc.prototype.write=function($b){return this.resource.write($b)};Oc.prototype.ensureExistance=function(){var $b=
this,zc,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){switch(Bb.nextAddress){case 1:return zc=$b.resource,Bb.yield(zc.exists(),2);case 2:if(Bb.yieldResult){Bb.jumpTo(3);break}return Bb.yield(zc.write("'format esm';\n"),4);case 4:Fb={},$b.System.config({meta:(Fb[$b.url]={format:"esm"},Fb)});case 3:return Bb.return($b)}})};Oc.prototype.ensureObjectClass=function($b){var zc=this,Fb=this.objectClass;return Fb&&Fb.prototype.__proto__===$b.prototype?Fb:Promise.resolve(this.ensureObjectClassSource($b)).then(function(Bb){var pc=
Bb.source,Pc=Bb.moduleId,xb=Bb.className,db=Bb.bindings,Ta=zc.System;Bb=bc.module(Ta,Pc);if(db)for(var cb in db)Bb.define(cb,db[cb]);pc=bc.runEval(pc,{classTransform:bc.classToFunctionTransform,sync:!0,targetModule:Pc,System:Ta});if(pc.isError)throw pc.value;pc=Bb.recorder[xb];if(!pc)throw Error("Failed to define class "+xb+" in "+Pc);return pc})};Oc.prototype.ensureObjectClassSource=function($b){return this.createDefaultClassDeclaration($b)};Oc.prototype.createDefaultClassDeclaration=function($b){$b=
void 0===$b?Object:$b;var zc=this,Fb,Bb,pc,Pc,xb,db,Ta,cb,la,La,fb,pb,Cb,Wa,Xa,zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kc){switch(kc.nextAddress){case 1:Fb=zc;Bb=Fb.System;pc=Fb.systemModule;Pc=Fb.objectPackage;xb=bc.string.capitalize(bc.toJsIdentifier(Pc.id));db=$b.className;Ta=!db;cb=bc.globalClasses.includes($b);la="";La=null;if(Ta){db="__anonymous_superclass__";fb={};La=(fb[db]=$b,fb);kc.jumpTo(2);break}if(cb){kc.jumpTo(2);break}return kc.yield(bc.ExportLookup.findExportOfValue($b,
Bb),4);case 4:(pb=kc.yieldResult)?(Cb=bc.ImportInjector.run(Bb,pc.id,pc.package(),"",pb),Wa=Cb.standaloneImport,la+=Wa+"\n\n"):(Xa={},La=(Xa[db]=$b,Xa));case 2:return xb===db&&(xb="Object"+xb),zb="Object"===db?"class "+xb+" {}\n":"class "+xb+" extends "+db+" {}\n",la+="export default "+zb+"\n",kc.yield(pc.changeSource(la),5);case 5:return kc.yield(pc.load(),6);case 6:return kc.return({source:la,className:xb,moduleId:zc.url,bindings:La})}})};Oc.prototype.addScript=function($b,zc,Fb){var Bb=this,pc,
Pc,xb,db,Ta,cb,la,La,fb,pb,Cb,Wa,Xa,zb,kc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){switch(Tb.nextAddress){case 1:if($b.constructor===Bb.objectClass){pc=$b.constructor;Tb.jumpTo(2);break}return Tb.yield(Bb.ensureObjectClass($b.constructor),3);case 3:pc=Tb.yieldResult;case 2:Pc=pc;xb="function"===typeof zc?String(zc):zc;db=bc.parseFunction(xb);Ta=bc.RuntimeSourceDescriptor.for(Pc,Bb.System);Fb||(Fb=bc.Path("id.name").get(db));if(!Fb)throw Error("No name, cannot add "+bc.string.truncate(xb,
30).replace(/\n/g,"")+"!");cb=bc.toJsIdentifier(Fb);console.assert("FunctionExpression"===db.type||"ArrowFunctionExpression"===db.type,"not a function expression but: "+db.type);la=db.params.map(function(qc){return xb.slice(qc.start,qc.end)});La="BlockStatement"===db.body.type?xb.slice(db.body.start,db.body.end):"{ return "+xb.slice(db.body.start,db.body.end)+" }";fb=cb+"("+la.join(",")+") "+La;"ArrowFunctionExpression"===db.type&&(db.type="FunctionExpression");pb=Ta.source;Cb=Ta.ast;if(!Cb)throw Error("cannot find class decl of "+
Ta.module.id);(Wa=Cb.body.body.find(function(qc){return qc.key.name===cb&&!qc.static}))?pb=pb.slice(0,Wa.start)+fb+pb.slice(Wa.end):(Xa=pb.lastIndexOf("}"),zb=pb.slice(0,Xa),kc=pb.slice(Xa),/\n\s*$/m.test(zb)||(zb+="\n"),fb=bc.string.changeIndent(fb,"  ",1),/^[ ]*\n/m.test(kc)||(kc="\n"+kc),pb=zb+fb+kc);return Tb.yield(Ta.changeSource(pb),4);case 4:return Tb.return({script:Pc.prototype[cb],klass:Pc,module:Ta.module.id,methodName:cb})}})};$jscomp.global.Object.defineProperties(Oc.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var $b=this.systemModule;return $b.isLoaded()?$b.System.get($b.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return bc.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});bc.ObjectModule=Oc;bc.default=Yc}}});