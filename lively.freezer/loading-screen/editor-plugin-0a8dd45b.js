System.register("./__rootModule___commonjs-entry-71573ff5.js ./ui.cp-6289a670.js ./editor-modes-5e094c88.js ./index-d18accbd.js @babel/plugin-syntax-import-meta ./loading-indicator.cp-b18e3b89.js ./index-1c08552a.js ./interface-dc23a2c8.js ./index-ca98f65e.js ./index-c79abca0.js ./value-widgets-6cb12552.js ./tooltips.cp-6a2406c0.js ./list.cp-8569fe93.js ./popups.cp-68dc8a4a.js".split(" "),function(Lc,pd){var Nd,Tc,Jc,$d,Bb,rd,Id,Ac,Pc,gd,nd,Fd,ic,vd,sb,Xb,Nb,bc,hb,cb,Hb,ec,ub,yb,ba,wb,Xa,Za,Sb,Cb,
Da,zb;return{setters:[function(db){Nd=db.b;Tc=db.r;Jc=db.C;$d=db.o;Bb=db.S;rd=db.c;Id=db.R;Ac=db.p;Pc=db.w;gd=db.j;nd=db.k;Fd=db.aD;ic=db.i;vd=db.G;sb=db._;Xb=db.x;Nb=db.v;bc=db.aE;hb=db.M;cb=db.aC;Hb=db.aB;ec=db.y;ub=db.f;yb=db.X},function(db){ba=db.I;wb=db.D},function(db){Xa=db.tokenizeDocument;Za=db.modeInfo;Sb=db.visitDocumentTokens;Cb=db.getMode},function(db){Da=db.F;zb=db.L},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},
function(){}],execute:function(){function db(R){var xb=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",Ja=2<arguments.length?arguments[2]:void 0,Ga=xb&&Wb.arr.last(xb.split(".")).toLowerCase(),sa="",Ub=0,vc=Math.pow(2,19);if("string"===typeof R){if(R.length>vc)return null}else if(R.document.stringSize>vc)return null;if("string"===typeof R)sa=R.slice(0,1E3);else{vc=vd(R.document.lines);var Oc;try{for(vc.s();!(Oc=vc.n()).done;){var aa=Oc.value,Ma=aa.stringSize,qb=aa.text,Vb=!0;1E3<Ub+Ma&&
(Vb=!1,Ma=1E3-Ub);sa+=qb.slice(0,Ma)+(Vb?"\n":"");Ub+=Ma;if(1E3<=Ub)break}}catch(tb){vc.e(tb)}finally{vc.f()}}Ub=vd(Wb.modeInfo);var Lb;try{for(Ub.s();!(Lb=Ub.n()).done;){var Kb=Lb.value,Db=Kb.contentTest,Ra=Kb.mode,N=Kb.ext,va=Kb.file;if("function"===typeof Db)try{if(Db(sa))return Ra}catch(tb){}if(va&&va instanceof RegExp&&va.test(xb))return Ra;if(N){var Wa=vd(N),pa;try{for(Wa.s();!(pa=Wa.n()).done;)if(pa.value===Ga)return Ra}catch(tb){Wa.e(tb)}finally{Wa.f()}}}}catch(tb){Ub.e(tb)}finally{Ub.f()}return Ja}
Lc("guessTextModeName",db);var ib=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.cp.js");ib.FilterableList=Da;ib.List=zb;ib.pt=Nd;ib.rect=Tc;ib.Color=Jc;ib.InputLine=$d;ib.ShadowObject=Bb;ib.component=rd;ib.AutocompleteList=ib.component["for"](function(){return ib.component({type:ib.FilterableList,borderWidth:0,name:"autocomplete list",extent:ib.pt(400,360),renderOnGPU:!0,selectedAction:"default",submorphs:[{type:ib.InputLine,name:"input",extent:ib.pt(22,22),fill:ib.Color.rgba(255,
255,255,0),fixedHeight:!1,fixedWidth:!0,fontFamily:'"IBM Plex Mono"',padding:ib.rect(0,3,0,-1),placeholder:null},{name:"padding",extent:ib.pt(10,0),fill:ib.Color.rgba(0,0,0,0),position:ib.pt(0,21)},{type:ib.List,name:"list",borderColor:ib.Color.rgb(149,165,166),borderRadius:3,clipMode:"auto",dropShadow:new ib.ShadowObject({distance:15,color:ib.Color.rgba(0,0,0,.35),blur:52}),extent:ib.pt(400,339),fill:ib.Color.rgba(255,255,255,.9),fontFamily:"IBM Plex Mono",itemHeight:18,itemPadding:ib.rect(3,2,7,
-1),manualItemHeight:!0,padding:ib.rect(0,0,0,0),position:ib.pt(0,21)}]})},{module:"lively.ide/text/completion.cp.js","export":"AutocompleteList",range:{start:219,end:1251}},ib.AutocompleteList);var Ea=ib.AutocompleteList;ib.AutocompleteList=Ea;var W=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.js");W.Color=Jc;W.Rectangle=Id;W.pt=Nd;W.part=Ac;W.connect=Pc;W.arr=gd;W.string=nd;W.FilterableList=Da;W.Range=Fd;W.AutocompleteList=Ea;Ea=function(R){var xb=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.js"),
Ja=xb.hasOwnProperty("Completer")&&"function"===typeof xb.Completer?xb.Completer:xb.Completer=function(Ga){if(!Ga||!Ga[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return ic(Ja,R,[{key:"compute",value:function(){return[]}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"Completer"}}],xb,{pathInPackage:function(){return"./text/completion.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:374,end:427})}(void 0);W.Completer=Ea;W.Completer=Ea;Ea=function(R){var xb=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.js"),Ja=xb.hasOwnProperty("WordCompleter")&&"function"===typeof xb.WordCompleter?xb.WordCompleter:xb.WordCompleter=function(Ga){if(!Ga||!Ga[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,
arguments)};return ic(Ja,R,[{key:"compute",value:function(Ga,sa){var Ub=[],vc=[],Oc=Ga.document.lineStrings;Ga=Ga.cursorPosition.row;for(var aa=Ga-1;0<=aa;aa--){var Ma=vd(Oc[aa].split(/[^0-9a-z@_]+/i)),qb;try{for(Ma.s();!(qb=Ma.n()).done;){var Vb=qb.value;Vb&&!Ub.includes(Vb)&&Vb!==sa&&(Ub.push(Vb),vc.push({priority:1E3-(Ga-aa),completion:Vb}))}}catch(Db){Ma.e(Db)}finally{Ma.f()}}for(qb=Ga+1;qb<Oc.length;qb++){Vb=vd(Oc[qb].split(/[^0-9a-z_@]+/i));var Lb;try{for(Vb.s();!(Lb=Vb.n()).done;){var Kb=Lb.value;
Kb&&!Ub.includes(Kb)&&Kb!==sa&&(Ub.push(Kb),vc.push({priority:1E3-(qb-Ga),completion:Kb}))}}catch(Db){Vb.e(Db)}finally{Vb.f()}}return vc}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"WordCompleter"}}],xb,{pathInPackage:function(){return"./text/completion.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:435,end:1364})}(void 0);
W.WordCompleter=Ea;W.WordCompleter=Ea;Ea=[new W.WordCompleter];W.defaultCompleters=Ea;W.defaultCompleters=Ea;Ea=function(R){var xb=window.lively.FreezerRuntime.recorderFor("lively.ide/text/completion.js"),Ja=xb.hasOwnProperty("CompletionController")&&"function"===typeof xb.CompletionController?xb.CompletionController:xb.CompletionController=function(Ga){if(!Ga||!Ga[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return ic(Ja,
R,[{key:Symbol["for"]("lively-instance-initialize"),value:function(Ga){var sa=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this.textMorph=Ga;this.completers=sa=Ga.pluginCollect("getCompleters",sa)}},{key:"computeCompletions",value:function(){var Ga=sb(regeneratorRuntime.mark(function vc(Ub){var Oc,aa,Ma,qb,Vb,Lb,Kb,Db,Ra,N,va,Wa,pa;return regeneratorRuntime.wrap(function(tb){for(;;)switch(tb.prev=tb.next){case 0:Oc=[],aa=vd(this.completers),tb.prev=2,aa.s();case 4:if((Ma=aa.n()).done){tb.next=
19;break}qb=Ma.value;tb.prev=6;tb.t0=Oc;tb.next=10;return qb.compute(this.textMorph,Ub);case 10:tb.t1=tb.sent;Oc=tb.t0.concat.call(tb.t0,tb.t1);tb.next=17;break;case 14:tb.prev=14,tb.t2=tb["catch"](6),console.warn("Error in completer ".concat(qb,": ").concat(tb.t2.stack||tb.t2));case 17:tb.next=4;break;case 19:tb.next=24;break;case 21:tb.prev=21,tb.t3=tb["catch"](2),aa.e(tb.t3);case 24:return tb.prev=24,aa.f(),tb.finish(24);case 27:Vb=new Map;Oc.forEach(function(ab){var Ob=Vb.get(ab.completion);Ob||
(Ob=[],Vb.set(ab.completion,Ob));Ob.push(ab)});Lb=[];Kb=vd(Vb.values());try{for(Kb.s();!(Db=Kb.n()).done;)Ra=Db.value,Lb.push(W.arr.last(W.arr.sortByKey(Ra,"priority")))}catch(ab){Kb.e(ab)}finally{Kb.f()}N=0;va=W.arr.sortByKey(Lb,"priority").reverse();Wa=va.length&&va[0].priority||0;pa=va.map(function(ab){ab.highestPriority=Wa;var Ob=ab.completion.replace(/\n/g,""),yc=String((ab.info||"").replace(/\n/g,""));N=Math.max(N,Ob.length+yc.length);return{isListItem:!0,string:Ob,annotation:yc,value:ab}});
return tb.abrupt("return",{items:pa,maxCol:N});case 37:case "end":return tb.stop()}},vc,this,[[2,21,24,27],[6,14]])}));return function(Ub){return Ga.apply(this,arguments)}}()},{key:"computeSortedCompletions",value:function(){var Ga=sb(regeneratorRuntime.mark(function vc(Ub){var Oc=this,aa,Ma,qb,Vb,Lb=arguments;return regeneratorRuntime.wrap(function(Kb){for(;;)switch(Kb.prev=Kb.next){case 0:return aa=1<Lb.length&&void 0!==Lb[1]?Lb[1]:!1,Ma={tokens:[Ub],lowercasedTokens:[Ub],input:Ub},Kb.next=4,this.computeCompletions(Ub);
case 4:return qb=Kb.sent,Vb=W.arr.sortBy(qb.items.filter(function(Db){return Oc.filterFunction(Ma,Db,aa)}),function(Db){return Oc.sortFunction(Ma,Db)}),Kb.abrupt("return",Vb);case 7:case "end":return Kb.stop()}},vc,this)}));return function(Ub){return Ga.apply(this,arguments)}}()},{key:"_printCompletions",value:function(){var Ga=sb(regeneratorRuntime.mark(function vc(Ub){var Oc;return regeneratorRuntime.wrap(function(aa){for(;;)switch(aa.prev=aa.next){case 0:return aa.next=2,this.computeSortedCompletions(Ub);
case 2:return aa.t0=function(Ma){return{completion:Ma.value.completion,priority:Ma.value.priority,maxP:Ma.value.highestPriority,sortVal:Ma._cache[Ub].sortVal,lev:JSON.stringify(Ma._cache[Ub].levenshtein)}},Oc=aa.sent.map(aa.t0),aa.abrupt("return",W.string.printTable(lively.lang.grid.tableFromObjects(Oc)));case 5:case "end":return aa.stop()}},vc,this)}));return function(Ub){return Ga.apply(this,arguments)}}()},{key:"prefix",value:function(){var Ga=this.textMorph,sa=Ga.selection;return(sa.isEmpty()?
Ga.getLine(sa.lead.row).slice(0,sa.lead.column):sa.text).match(/[a-z0-9@_]*$/i)[0]}},{key:"filterFunction",value:function(Ga,sa){var Ub=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1;sa._cache||(sa._cache={});var vc=Ga.tokens,Oc=Ga.lowercasedTokens,aa=Ga.input;aa=sa._cache[aa]||(sa._cache[aa]={});if(aa.hasOwnProperty("filtered"))return aa.filtered;var Ma=sa.value.completion.replace(/\([^\)]*\)$/,""),qb=Ma.toLowerCase();if(Ub&&vc[0]&&!Ma.startsWith(vc[0]))return aa.filtered=!1;if(Oc.every(function(Lb){return qb.includes(Lb)}))return!0;
var Vb=aa.levenshtein||(aa.levenshtein={});Ub=Ub||3>=W.arr.sum(Ga.lowercasedTokens.map(function(Lb){return Vb[Lb]||(Vb[Lb]=W.string.levenshtein(qb,Lb))}));return aa.filtered=Ub}},{key:"sortFunction",value:function(Ga,sa){sa._cache||(sa._cache={});var Ub=sa._cache[Ga.input]||(sa._cache[Ga.input]={});if(Ub.hasOwnProperty("sortVal"))return Ub.sortVal;Ub=sa._cache[Ga.input]={};var vc=sa.value;sa=vc.highestPriority;var Oc=vc.completion;vc=vc.priority;Oc=Oc.replace(/\([^\)]*\)$/,"").toLowerCase();var aa=
0;Ga.lowercasedTokens.forEach(function(qb){Oc.startsWith(qb)?aa+=12:3<=qb.length&&Oc.includes(qb)&&(aa+=5)});sa=-((vc||(aa?sa:0))/Math.pow(10,String(sa).length-2))-aa;var Ma=Ub.levenshtein||(Ub.levenshtein={});Ga=W.arr.sum(Ga.lowercasedTokens.map(function(qb){return Ma[qb]||(Ma[qb]=W.string.levenshtein(Oc,qb))}));aa&&(Ga/=2);return Ub.sortVal=Ga+sa}},{key:"positionForMenu",value:function(){var Ga=this.textMorph,sa=Ga.charBoundsFromTextPosition(Ga.cursorPosition);return Ga.getGlobalTransform().transformRectToRect(sa).topLeft().addXY(-Ga.scroll.x,
-Ga.scroll.y).addPt(W.pt(Ga.borderWidth+4,Ga.borderWidth+4))}},{key:"completionListSpec",value:function(){var Ga=sb(regeneratorRuntime.mark(function Ub(){var vc,Oc,aa,Ma,qb,Vb,Lb,Kb,Db,Ra,N,va,Wa,pa,tb,ab,Ob,yc,Ta;return regeneratorRuntime.wrap(function(Bd){for(;;)switch(Bd.prev=Bd.next){case 0:return vc=this.textMorph,Oc=vc.fontSize,aa=vc.fontFamily,Ma=this.positionForMenu(),qb=this.prefix(),Bd.next=6,this.computeCompletions(qb);case 6:Vb=Bd.sent;Lb=Vb.items;Kb=Vb.maxCol;Db=vc.env.fontMetric.sizeFor(aa,
Oc,"M");Ra=Db.width*Kb;N=vc.document.getLine(0).height;va=Math.max(120,Ra<vc.width?Ra:vc.width);Wa=N*Lb.length+N+10;pa=Math.max(70,Math.min(700,Wa));tb=Ma.extent(W.pt(va,pa));if(ab=vc.world())Ob=ab.visibleBounds().insetBy(5),tb.bottom()>Ob.bottom()&&(yc=tb.bottom()-Ob.bottom(),yc>tb.height-50&&(yc=tb.height-50),tb.height-=yc),tb.right()>Ob.right()&&(Ta=tb.right()-Ob.right(),tb.width=120>tb.width-Ta?120:tb.width-Ta),Ob.containsRect(tb)||(tb=tb.withTopLeft(Ob.translateForInclusion(tb).topLeft())),tb=
tb.translatedBy(Ob.insetBy(-1).topLeft().negated());return Bd.abrupt("return",{type:W.FilterableList,hasFixedPosition:!0,epiMorph:!0,fontSize:Oc,position:tb.topLeft(),extent:tb.extent(),items:Lb,input:qb,name:"text completion menu",historyId:"lively.morphic-text completion",filterFunction:this.filterFunction,sortFunction:this.sortFunction,renderOnGPU:!0,selectedIndex:0,submorphs:[{name:"input",fontColor:vc.fontColor,clipMode:"visible",fill:vc.fill,fixedHeight:!0,fixedWidth:!1,padding:W.Rectangle.inset(0,
0,0,0)},{name:"padding",height:2}]});case 22:case "end":return Bd.stop()}},Ub,this)}));return function(){return Ga.apply(this,arguments)}}()},{key:"removeMenuOnBlur",value:function(Ga){Ga.evt;var sa=Ga.menu;setTimeout(function(){sa.withAllSubmorphsDetect(function(Ub){return Ub.isFocused()})?sa.inputMorph.focus():sa.remove()})}},{key:"openCompletionList",value:function(){var Ga=sb(regeneratorRuntime.mark(function Ub(){var vc,Oc,aa,Ma,qb,Vb,Lb,Kb,Db,Ra;return regeneratorRuntime.wrap(function(N){for(;;)switch(N.prev=
N.next){case 0:return vc=this.textMorph.selection.start,N.next=3,this.completionListSpec();case 3:return Oc=N.sent,aa=W.part(W.AutocompleteList,Oc),Ma=new W.Range({start:vc,end:this.textMorph.selection.start}),qb=this.textMorph.textInRange(Ma),Vb=aa.inputMorph,Lb=aa.listMorph,Kb=Oc.input,Db=aa.addMorph({name:"prefix mask",fill:W.Color.transparent,bounds:Vb.textBounds()},Vb),Ma.isEmpty()||(this.textMorph.deleteText(Ma),Vb.input=qb,Vb.gotoDocumentEnd()),W.connect(Vb,"textString",Db,"setBounds",{converter:"() => input.textBounds()",
varMapping:{input:Vb}}),W.connect(aa,"accepted",this,"insertCompletion",{updater:"function($upd) {\n        let textToInsert, customInsertionFn = null, completion = this.sourceObj.selection;\n        if (completion) {\n          if (completion.prefix) prefix = completion.prefix;\n          textToInsert = completion.completion;\n          customInsertionFn = completion.customInsertionFn;\n        } else {\n          textToInsert = this.sourceObj.inputMorph.textString;\n        }\n        $upd(textToInsert, prefix, customInsertionFn);\n      }",
varMapping:{prefix:Kb}}),W.connect(aa,"accepted",aa,"remove"),W.connect(aa,"canceled",aa,"remove"),W.connect(aa,"remove",this.textMorph,"focus"),W.connect(aa.inputMorph,"onBlur",this,"removeMenuOnBlur",{converter:"evt => ({menu, evt})",varMapping:{menu:aa}}),Ra=this.textMorph.world(),Lb.addStyleClass("hiddenScrollbar"),Vb.height=Lb.itemHeight,Vb.fontSize=Lb.fontSize,aa.relayout(),Vb.focus(),Kb.length&&(Vb.gotoDocumentEnd(),aa.moveBy(W.pt(-Vb.textBounds().width,0))),Ra.addMorph(aa),N.abrupt("return",
aa);case 27:case "end":return N.stop()}},Ub,this)}));return function(){return Ga.apply(this,arguments)}}()},{key:"autoInsertBestMatchingCompletion",value:function(){var Ga=sb(regeneratorRuntime.mark(function vc(Ub){var Oc,aa,Ma,qb,Vb,Lb=arguments;return regeneratorRuntime.wrap(function(Kb){for(;;)switch(Kb.prev=Kb.next){case 0:return Oc=1<Lb.length&&void 0!==Lb[1]?Lb[1]:!0,aa=2<Lb.length?Lb[2]:void 0,Kb.next=4,this.computeSortedCompletions(Ub,Oc);case 4:Ma=Kb.sent,qb=Xb(Ma,1),(Vb=qb[0])&&this.insertCompletion(Vb.value.completion,
Ub,aa);case 8:case "end":return Kb.stop()}},vc,this)}));return function(Ub){return Ga.apply(this,arguments)}}()},{key:"insertCompletion",value:function(Ga,sa,Ub){var vc=this.textMorph,Oc=vc.document,aa=vc.selection.isMultiSelection?vc.selection.selections:[vc.selection];vc.undoManager.group();aa.forEach(function(Ma){Ma.collapseToEnd();var qb=Ma.lead,Vb=sa?Oc.indexToPosition(Oc.positionToIndex(qb)-sa.length):qb;"function"===typeof Ub?Ub(Ga,sa,vc,{start:Vb,end:qb},Ma):vc.replace({start:Vb,end:qb},Ga)});
vc.undoManager.group()}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"CompletionController"}}],xb,{pathInPackage:function(){return"./text/completion.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1488,end:13063})}(void 0);W.CompletionController=Ea;W.CompletionController=Ea;Ea=[{name:"text completion",handlesCount:!0,
multiSelectAction:"single",exec:function(R,xb,Ja){return sb(regeneratorRuntime.mark(function sa(){var Ub;return regeneratorRuntime.wrap(function(vc){for(;;)switch(vc.prev=vc.next){case 0:return Ub=new W.CompletionController(R,W.defaultCompleters),vc.next=3,Ub.openCompletionList();case 3:return vc.abrupt("return",!0);case 4:case "end":return vc.stop()}},sa)}))()}},{name:"text completion first match",handlesCount:!0,multiSelectAction:"single",exec:function(R,xb,Ja){return sb(regeneratorRuntime.mark(function sa(){var Ub;
return regeneratorRuntime.wrap(function(vc){for(;;)switch(vc.prev=vc.next){case 0:return Ub=new W.CompletionController(R,W.defaultCompleters),vc.next=3,Ub.autoInsertBestMatchingCompletion(Ub.prefix());case 3:return vc.abrupt("return",!0);case 4:case "end":return vc.stop()}},sa)}))()}}];W.completionCommands=Ea;W.completionCommands=Ea;var T=window.lively.FreezerRuntime.recorderFor("lively.ide/text/multi-select-commands.js");T.arr=gd;var ia=[{name:"[multi select] add cursor above",multiSelectAction:"single",
exec:function(R){var xb=R.selection.start;0<xb.row&&(xb=R.getPositionAboveOrBelow(1,xb,!0,0,R.charBoundsFromTextPosition(xb).x),R.selection.addRange({start:xb,end:xb}));return!0}},{name:"[multi select] add cursor below",multiSelectAction:"single",exec:function(R){var xb=R.selection.start;xb.row<R.documentEndPosition.row&&(xb=R.getPositionAboveOrBelow(-1,xb,!0,0,R.charBoundsFromTextPosition(xb).x),R.selection.addRange({start:xb,end:xb}));return!0}},{name:"[multi select] all like this",multiSelectAction:"single",
exec:function(R){var xb=R.selection.selections[R.selection.selections.length-1];if(xb.isEmpty())return!0;R.searchForAll(xb.text,{start:{column:0,row:0}}).forEach(function(Ja){return R.selection.addRange(Ja.range,!1)});R.selection.mergeSelections();T.arr.remove(R.selection.selections,xb);R.selection.selections.push(xb);return!0}},{name:"[multi select] more like this forward",multiSelectAction:"single",exec:function(R){var xb=R.selection.selections.length-1,Ja=R.selection.selections[xb];if(Ja.isEmpty())return!0;
var Ga=R.search(Ja.text,{start:Ja.end,backwards:!1});Ga&&(Ja=R.selection.selections.findIndex(function(sa){return sa.range.equals(Ga.range)}),-1<Ja?T.arr.swap(R.selection.selections,Ja,xb):R.selection.addRange(Ga.range));return!0}},{name:"[multi select] more like this backward",multiSelectAction:"single",exec:function(R){var xb=R.selection.selections.length-1,Ja=R.selection.selections[xb];if(Ja.isEmpty())return!0;var Ga=Ja.start,sa=R.search(Ja.text,{start:{row:Ga.row,column:Ga.column-(Ja.text.length-
1)},backwards:!0});sa&&(Ja=R.selection.selections.findIndex(function(Ub){return Ub.range.equals(sa.range)}),-1<Ja?T.arr.swap(R.selection.selections,Ja,xb):R.selection.addRange(sa.range));return!0}},{name:"[multi select] remove focused cursor",multiSelectAction:"single",exec:function(R){var xb=R.selection.selections.length;1<xb&&R.selection.removeSelections(xb-1);return!0}},{name:"[multi select] goto previous focused cursor",multiSelectAction:"single",exec:function(R){R.selection.selections=lively.lang.arr.rotate(R.selection.selections,
-1);return!0}},{name:"[multi select] goto next focused cursor",multiSelectAction:"single",exec:function(R){R.selection.selections=lively.lang.arr.rotate(R.selection.selections,1);return!0}},{name:"[multi select] align cursors",multiSelectAction:"single",exec:function(R){var xb=R.selection.selections;if(1>=xb.length)return!0;var Ja=T.arr.groupBy(xb,function(sa){return sa.range.start.row});xb=Ja.keys().map(function(sa){sa=Ja[sa];var Ub=T.arr.max(sa,function(vc){return vc.range.start.column});T.arr.without(sa,
Ub).forEach(function(vc){return vc.range=Ub.range});return Ub});var Ga=T.arr.max(xb,function(sa){return sa.range.start.column}).range.start.column;xb.forEach(function(sa){var Ub=sa.range.start;sa=Ub.row;Ub=Ub.column;R.insertText(" ".repeat(Ga-Ub),{row:sa,column:Ub})});return!0}},{name:"[multi select] create rectangular selection",multiSelectAction:"single",exec:function(R){R.selection.disableMultiSelect();if(R.selection.isEmpty())var xb=R.lastSavedMark&&R.lastSavedMark.position||(void 0).lineRange().start,
Ja=R.cursorPosition;else xb=R.selection,Ja=xb.lead,xb=xb.anchor;R.selection.collapse();var Ga=xb.column,sa=Ja.column;T.arr.range(xb.row,Ja.row).forEach(function(Ub){return R.getLine(Ub).length>Math.min(sa,Ga)&&R.selection.addRange({end:{row:Ub,column:sa},start:{row:Ub,column:Ga}},!1)});R.selection.mergeSelections();return!0}},{name:"[multi select] count",multiSelectAction:"single",handlesCount:!0,exec:function(R,xb){var Ja=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;R.undoManager.group();
R.selection.selections.forEach(function(Ga,sa){return Ga.text=String(sa+Ja)});R.undoManager.group();return!0}}];T.multiSelectCommands=ia;T.multiSelectCommands=ia;var ka=window.lively.FreezerRuntime.recorderFor("lively.ide/text/code-navigation-commands.js");ka.pToI=function(R,xb){return R.positionToIndex(xb)};ka.iToP=function(R,xb){return R.indexToPosition(xb)};ka.execCodeNavigator=function(R){return function(xb,Ja,Ga){var sa=xb.pluginInvokeFirst("getNavigator");if(!sa)return!0;xb.saveMark();Ga=Ga||
1;for(var Ub=0;Ub<Ga;Ub++)sa[R](xb,Ja);return!0}};ka.once=Nb;var K=[{name:"forwardSexp",bindKey:"Ctrl-Alt-f|Ctrl-Alt-Right",exec:ka.execCodeNavigator("forwardSexp"),multiSelectAction:"forEach",readOnly:!0},{name:"backwardSexp",bindKey:"Ctrl-Alt-b|Ctrl-Alt-Left",exec:ka.execCodeNavigator("backwardSexp"),multiSelectAction:"forEach",readOnly:!0},{name:"backwardUpSexp",bindKey:"Ctrl-Alt-u|Ctrl-Alt-Up",exec:ka.execCodeNavigator("backwardUpSexp"),multiSelectAction:"forEach",readOnly:!0},{name:"forwardDownSexp",
bindKey:"Ctrl-Alt-d|Ctrl-Alt-Down",exec:ka.execCodeNavigator("forwardDownSexp"),multiSelectAction:"forEach",readOnly:!0},{name:"markDefun",bindKey:"Ctrl-Alt-h",exec:ka.execCodeNavigator("markDefun"),multiSelectAction:"forEach",readOnly:!0},{name:"expandRegion",bindKey:{win:"Shift-Ctrl-E|Ctrl-Shift-Space",mac:"Shift-Command-Space|Ctrl-Shift-Space"},exec:function(R,xb){function Ja(){var Ub=R.$expandRegionState,vc=ka.pToI(R,R.cursorPosition);if(Ub&&(Ub.range[0]===vc||Ub.range[1]===vc))return Ub;Ub=R.selection.range;
return R.$expandRegionState={range:[ka.pToI(R,Ub.start),ka.pToI(R,Ub.end)]}}xb=xb||{};var Ga=R.pluginInvokeFirst("getNavigator");if(!Ga)return!0;var sa=xb.start;xb=xb.end;if("number"===typeof sa&&"number"===typeof xb)Ja(),Ga={range:[sa,xb],prev:Ja()};else{sa=Ga.ensureAST(R);if(!sa)return;Ga=Ga.expandRegion(R,R.textString,sa,Ja())}Ga&&Ga.range&&(R.selection={start:ka.iToP(R,Ga.range[0]),end:ka.iToP(R,Ga.range[1])},R.$expandRegionState=Ga);ka.once(R,"selectionChange",function(){return R.$expandRegionState=
null},"call");return!0},multiSelectAction:"forEach",readOnly:!0},{name:"contractRegion",bindKey:{win:"Shift-Ctrl-S|Ctrl-Alt-Space",mac:"Ctrl-Command-space|Ctrl-Alt-Space"},exec:function(R){if(R.selection.isEmpty())return!0;var xb=R.pluginInvokeFirst("getNavigator");if(!xb)return!0;var Ja=xb.ensureAST(R);if(!Ja)return!0;var Ga=R.$expandRegionState;if(!Ga)return!0;(xb=xb.contractRegion(R,R.textString,Ja,Ga))&&xb.range&&(R.selection={start:ka.iToP(R,xb.range[0]),end:ka.iToP(R,xb.range[1])},R.$expandRegionState=
xb);ka.once(R,"selectionChange",function(){return R.$expandRegionState=null},"call");return!0},multiSelectAction:"forEach",readOnly:!0}];ka.commands=K;ka.commands=K;var ya=window.lively.FreezerRuntime.recorderFor("lively.ide/text/generic-code-commands.js");ya.arr=gd;ya.chain=bc;ya.string=nd;var pb=[{name:"toggle comment",exec:function(R){var xb=R.pluginInvokeFirst("getComment");if(!xb)return!0;if(!xb.lineCommentStart)return xb.blockCommentStart?R.execCommand("toggle block comment"):!0;var Ja=xb.lineCommentStart,
Ga=new RegExp("^(\\s*)(".concat(Ja,"\\s?)(.*)"));xb=R.document;var sa=R.selection;sa.isEmpty()||0!==sa.end.column||sa.growRight(-1);var Ub=sa.start.row;xb=xb.lineStrings.slice(sa.start.row,sa.end.row+1);xb=xb.some(function(aa){return!!aa.trim()})?ya.arr.dropWhile(xb,function(aa){return aa.trim()?!1:++Ub&&!0}):xb;var vc=xb.every(function(aa){return aa.trim()&&aa.match(Ga)});R.undoManager.group();if(vc)xb.forEach(function(aa,Ma){if(aa=aa.match(Ga)){aa=Xb(aa,4);aa[0];var qb=aa[1],Vb=aa[2];aa[3];R.deleteText({start:{row:Ub+
Ma,column:qb.length},end:{row:Ub+Ma,column:qb.length+Vb.length}})}});else{var Oc=xb.reduce(function(aa,Ma,qb){return Ma.trim()||sa.isEmpty()&&sa.start.row===sa.end.row?Math.min(aa,Ma.match(/^\s*/)[0].length):aa},Infinity);Oc=Infinity===Oc?0:Oc;xb.forEach(function(aa,Ma){aa=aa.match(/^(\s*)(.*)/);aa=Xb(aa,3);aa[0];aa[1];aa[2];R.insertText("".concat(Ja," "),{row:Ub+Ma,column:Oc})})}R.undoManager.group();return!0}},{name:"toggle block comment",exec:function(R){var xb=R.pluginInvokeFirst("getComment");
if(!xb)return!0;if(!xb.blockCommentStart)return xb.lineCommentStart?R.execCommand("toggle comment"):!0;if(!xb||!xb.blockCommentStart)return!0;var Ja=xb.blockCommentStart;xb=xb.blockCommentEnd;var Ga=new RegExp("^"+Ja.replace(/\*/g,"\\*")),sa=new RegExp(xb.replace(/\*/g,"\\*")+"$"),Ub=R.tokenAt(R.cursorPosition);if(Ub&&"comment"===Ub.token){var vc=R.textInRange(Ub);if(vc.match(Ga)&&vc.match(sa))return R.undoManager.group(),R.replace(Ub,vc.slice(Ja.length,-xb.length)),R.undoManager.group(),!0}R.undoManager.group();
R.insertText(Ja,R.selection.start);R.insertText(xb,R.selection.end);R.undoManager.group();Ja=!R.selection.isEmpty();R.selection.growLeft(xb.length);Ja||R.selection.collapse();return!0}},{name:"comment box",exec:function(R,xb,Ja){xb=R.undoManager.ensureNewGroup(R,"comment box");if(R.selection.isEmpty())return R.insertText("-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-"),R.execCommand("toggle comment"),R.undoManager.group(xb),!0;var Ga=R.selection.range,sa=R.withSelectedLinesDo(function(vc){return vc}),
Ub=ya.arr.min([Ga.start.column].concat(ya.chain(sa).map(function(vc){return vc.match(/^\s*/)}).flat().compact().pluck("length").value()));sa=ya.arr.max(sa.map(function(vc){return vc.length}))-Ub;sa=Array(Math.ceil(sa/2)+1).join("-=")+"-";R.execCommand("toggle comment");R.collapseSelection();R.cursorPosition={row:Ga.start.row,column:0};Ja?R.insertText(ya.string.indent("-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-\n"," ",Ub)):R.insertText(ya.string.indent(sa+"\n"," ",Ub));R.selection.goUp();
R.execCommand("toggle comment");R.cursorPosition={row:Ga.end.row+2,column:0};R.insertText(ya.string.indent(sa+"\n"," ",Ub));R.selection.goUp();R.execCommand("toggle comment");R.selection.range={start:{row:Ga.start.row,column:0},end:R.cursorPosition};R.undoManager.group(xb);return!0},multiSelectAction:"forEach",handlesCount:!0}];ya.commands=pb;ya.commands=pb;var La=window.lively.FreezerRuntime.recorderFor("lively.ide/text/code-evaluation-commands.js");La.Inspector=ba;La.string=nd;La.Morph=hb;La.pt=
Nd;La.Color=Jc;La.runCommand=cb;La.defaultDirectory=Hb;var eb=[{name:"doit",doc:"Evaluates the selected code or the current line and report the result",exec:function(){var R=sb(regeneratorRuntime.mark(function sa(Ja,Ga){var Ub,vc,Oc,aa=arguments;return regeneratorRuntime.wrap(function(Ma){for(;;)switch(Ma.prev=Ma.next){case 0:return Ub=2<aa.length&&void 0!==aa[2]?aa[2]:1,Ja.maybeSelectCommentOrLine(),Ma.prev=2,Ga=Object.assign({},Ga,{logDoit:!0,inspect:!0,inspectDepth:Ub}),Ma.next=6,Ja.doEval(void 0,
Ga);case 6:vc=Ma.sent;Oc=vc.error?vc.error:vc.isError?vc.value:null;Ma.next=13;break;case 10:Ma.prev=10,Ma.t0=Ma["catch"](2),Oc=Ma.t0;case 13:return Oc?Ja.showError(Oc):Ja.setStatusMessage(La.string.truncate(vc.value,1E3)),Ma.abrupt("return",vc);case 15:case "end":return Ma.stop()}},sa,null,[[2,10]])}));return function(Ja,Ga){return R.apply(this,arguments)}}()},{name:"blame selection",doc:"Retrieves complete git blame information for the selected code.",exec:function(){var R=sb(regeneratorRuntime.mark(function Ga(Ja){var sa,
Ub,vc,Oc,aa,Ma,qb,Vb;return regeneratorRuntime.wrap(function(Lb){for(;;)switch(Lb.prev=Lb.next){case 0:sa=Ja.selection.selections[0];Ub=sa.range.start.row+1;vc=sa.range.end.row+1;if(Ja.editorPlugin.evalEnvironment.targetModule){Lb.next=6;break}Ja.showError("Error!");return Lb.abrupt("return");case 6:Oc=Ja.editorPlugin.evalEnvironment.targetModule;if(Oc.match(/http:/)||Oc.match(/file:/)){Lb.next=10;break}Ja.showError("Only available for files located in the file system.");return Lb.abrupt("return");
case 10:return Lb.next=12,La.defaultDirectory();case 12:return aa=Lb.sent,aa=aa.replace("http://localhost:9011/","").replace("/lively.server",""),Oc=Oc.replace("http://localhost:9011/","").replace("file://",""),Ma="git blame --date=short -L ".concat(Ub,",").concat(vc," ").concat(Oc,' | while read hash others;\n        do\n          echo $(git log -1 --pretty=%s $hash) " -- " $others\n        done'),qb=La.runCommand(Ma,{cwd:aa}),Lb.next=19,qb.whenDone();case 19:Vb=qb.output,$world.execCommand("open workspace",
{title:"Blame Info",content:Vb,language:"text"});case 21:case "end":return Lb.stop()}},Ga)}));return function(Ja){return R.apply(this,arguments)}}()},{name:"blame line",doc:"Retrieves git commit message and author name from the last time the line at which the cursor is positioned was changed.",exec:function(){var R=sb(regeneratorRuntime.mark(function Ga(Ja){var sa,Ub,vc,Oc,aa,Ma,qb,Vb,Lb;return regeneratorRuntime.wrap(function(Kb){for(;;)switch(Kb.prev=Kb.next){case 0:sa=Ja.cursorPosition.row+1;if(Ja.editorPlugin.evalEnvironment.targetModule){Kb.next=
4;break}Ja.showError("Error!");return Kb.abrupt("return");case 4:Ub=Ja.editorPlugin.evalEnvironment.targetModule;if(Ub.match(/http:/)||Ub.match(/file:/)){Kb.next=8;break}Ja.showError("Only available for files located in the file system.");return Kb.abrupt("return");case 8:return Kb.next=10,La.defaultDirectory();case 10:return vc=Kb.sent,vc=vc.replace("http://localhost:9011/","").replace("/lively.server",""),Ub=Ub.replace("http://localhost:9011/","").replace("file://",""),Oc="git blame --date=short -L "+
sa+","+sa+" --porcelain "+Ub,aa=La.runCommand(Oc,{cwd:vc}),Kb.next=17,aa.whenDone();case 17:Ma=aa.output,qb=Ma.match(/author (.*)$/m)[1],Vb=Ma.match(/summary (.*)$/m)[1],Lb=Ma.match(/author-time (.*)$/m)[1],Lb=(new Date(1E3*Lb)).toDateString(),"Not Committed Yet"===qb?Ja.setStatusMessage("Line not yet commited."):Ja.setStatusMessage(Vb+" - "+qb+" on "+Lb);case 23:case "end":return Kb.stop()}},Ga)}));return function(Ja){return R.apply(this,arguments)}}()},{name:"eval all",doc:"Evaluates the entire text contents",
scrollCursorIntoView:!1,exec:function(){var R=sb(regeneratorRuntime.mark(function sa(Ja,Ga){var Ub,vc;return regeneratorRuntime.wrap(function(Oc){for(;;)switch(Oc.prev=Oc.next){case 0:return Oc.prev=0,Oc.next=3,Ja.doEval({start:{row:0,column:0},end:Ja.documentEndPosition},Object.assign({},Ga,{logDoit:!0}));case 3:Ub=Oc.sent;vc=Ub.error?Ub.error:Ub.isError?Ub.value:null;Oc.next=10;break;case 7:Oc.prev=7,Oc.t0=Oc["catch"](0),vc=Oc.t0;case 10:return vc?Ja.showError(vc):Ja.setStatusMessage(String(Ub.value)),
Oc.abrupt("return",Ub);case 12:case "end":return Oc.stop()}},sa,null,[[0,7]])}));return function(Ja,Ga){return R.apply(this,arguments)}}()},{name:"printit",doc:"Evaluates selected code or the current line and inserts the result in a printed representation",exec:function(){var R=sb(regeneratorRuntime.mark(function sa(Ja,Ga){var Ub,vc,Oc,aa,Ma,qb,Vb;return regeneratorRuntime.wrap(function(Lb){for(;;)switch(Lb.prev=Lb.next){case 0:return Ja.maybeSelectCommentOrLine(),Lb.prev=1,Ga=Object.assign({},Ga,
{asString:!1,logDoit:!0}),Lb.next=5,Ja.doEval(void 0,Ga);case 5:Ub=Lb.sent;vc=Ub.error?Ub.error:Ub.isError?Ub.value:null;Lb.next=12;break;case 9:Lb.prev=9,Lb.t0=Lb["catch"](1),vc=Lb.t0;case 12:Ja.selection.collapseToEnd();Oc=Ub.value&&Ub.value.isColor;if(!Oc){Lb.next=22;break}Ja.selection.text=String(Ub.value);aa=new La.Morph({fill:La.Color.transparent,extent:La.pt(Ja.fontSize+2,Ja.fontSize+2),submorphs:[{fill:Ub.value,center:La.pt(Ja.fontSize+2,Ja.fontSize+2).scaleBy(.5)}]});Ma=Ja.selection.start;
qb=Ma.column;Vb=Ma.row;Ja.insertText([aa,{}],Ja.selection.start);Ja.selection.start={column:qb,row:Vb};Ja.focus();return Lb.abrupt("return",Ub);case 22:return Ja.insertTextAndSelect(vc?String(vc)+(vc.stack?"\n"+vc.stack:""):String(Ub.value)),Ja.focus(),Lb.abrupt("return",Ub);case 25:case "end":return Lb.stop()}},sa,null,[[1,9]])}));return function(Ja,Ga){return R.apply(this,arguments)}}()},{name:"editit",doc:"Evaluates the expression and opens an object editor on the resulting object.",exec:function(){var R=
sb(regeneratorRuntime.mark(function sa(Ja,Ga){var Ub,vc,Oc,aa;return regeneratorRuntime.wrap(function(Ma){for(;;)switch(Ma.prev=Ma.next){case 0:Ja.maybeSelectCommentOrLine();vc=Ja.textInRange(Ja.selection);Oc=Ja.evalEnvironment||{};aa=Ja.pluginFind(function(qb){return qb.isEditorPlugin&&"function"===typeof qb.runEval});Oc.systemInterface||(Oc.systemInterface=aa.systemInterface(Ga));if("local"!==Oc.systemInterface.name){Ma.next=15;break}Ma.prev=6;Ma.next=9;return Ja.doEval(void 0,Ga);case 9:Ub=Ma.sent;
vc=Ub.value;Ma.next=15;break;case 13:Ma.prev=13,Ma.t0=Ma["catch"](6);case 15:return Ja.world().execCommand("open object editor",{target:vc,evalEnvironment:Oc}),Ma.abrupt("return",Ub);case 17:case "end":return Ma.stop()}},sa,null,[[6,13]])}));return function(Ja,Ga){return R.apply(this,arguments)}}()},{name:"inspectit",doc:"Evaluates the expression and opens an inspector widget on the resulting object.",exec:function(){var R=sb(regeneratorRuntime.mark(function sa(Ja,Ga){var Ub,vc,Oc,aa,Ma;return regeneratorRuntime.wrap(function(qb){for(;;)switch(qb.prev=
qb.next){case 0:Ja.maybeSelectCommentOrLine();Oc=Ja.textInRange(Ja.selection);aa=Ja.evalEnvironment||{};Ma=Ja.pluginFind(function(Vb){return Vb.isEditorPlugin&&"function"===typeof Vb.runEval});aa.systemInterface||(aa.systemInterface=Ma.systemInterface(Ga));if("local"!==aa.systemInterface.name){qb.next=20;break}qb.prev=6;qb.next=9;return Ja.doEval(void 0,Ga);case 9:Ub=qb.sent;vc=Ub.error?Ub.error:Ub.isError?Ub.value:null;Oc=Ub.value;qb.next=17;break;case 14:qb.prev=14,qb.t0=qb["catch"](6),vc=qb.t0;
case 17:La.Inspector.openInWindow({targetObject:vc||Oc});qb.next=21;break;case 20:La.Inspector.openInWindow({remoteTarget:{code:Oc,evalEnvironment:aa}});case 21:return qb.abrupt("return",Ub);case 22:case "end":return qb.stop()}},sa,null,[[6,14]])}));return function(Ja,Ga){return R.apply(this,arguments)}}()},{name:"log it",doc:"Evaluates the expression and `console.log`s the result.",exec:function(){var R=sb(regeneratorRuntime.mark(function sa(Ja,Ga){var Ub,vc,Oc;return regeneratorRuntime.wrap(function(aa){for(;;)switch(aa.prev=
aa.next){case 0:Ja.maybeSelectCommentOrLine();vc=Ja.evalEnvironment||{};Oc=Ja.pluginFind(function(Ma){return Ma.isEditorPlugin&&"function"===typeof Ma.runEval});vc.systemInterface||(vc.systemInterface=Oc.systemInterface(Ga));if("local"!==vc.systemInterface.name){aa.next=8;break}aa.next=7;return Ja.doEval(void 0,Ga);case 7:Ub=aa.sent;case 8:return console.log(Ub.value||Ub.error),aa.abrupt("return",Ub);case 10:case "end":return aa.stop()}},sa)}));return function(Ja,Ga){return R.apply(this,arguments)}}()},
{name:"print inspectit",doc:"Prints a representation of the object showing it's properties. The count argument defines how deep (recursively) objects will be printed.",handlesCount:!0,exec:function(){var R=sb(regeneratorRuntime.mark(function sa(Ja,Ga){var Ub,vc,Oc=arguments;return regeneratorRuntime.wrap(function(aa){for(;;)switch(aa.prev=aa.next){case 0:return Ub=2<Oc.length&&void 0!==Oc[2]?Oc[2]:1,Ja.maybeSelectCommentOrLine(),aa.prev=2,Ga=Object.assign({},Ga,{inspect:!0,inspectDepth:Ub,logDoit:!0}),
aa.next=6,Ja.doEval(void 0,Ga);case 6:vc=aa.sent;aa.next=11;break;case 9:aa.prev=9,aa.t0=aa["catch"](2);case 11:return Ja.selection.collapseToEnd(),Ja.insertTextAndSelect(vc.value),aa.abrupt("return",vc);case 14:case "end":return aa.stop()}},sa,null,[[2,9]])}));return function(Ja,Ga){return R.apply(this,arguments)}}()}];La.codeEvaluationCommands=eb;La.codeEvaluationCommands=eb;var jb=window.lively.FreezerRuntime.recorderFor("lively.ide/text/rich-text-commands.js");jb.changeAttributeInSelectionOrMorph=
function(R,xb,Ja){var Ga=R.selection;R.keepPosAtSameScrollOffsetWhile(function(){Ga.isEmpty()?R[xb]="function"===typeof Ja?Ja(R[xb]):Ja:R.undoManager&&(R.undoManager.group(),R.changeStyleProperty(xb,function(sa){return"function"===typeof Ja?Ja(sa):Ja}),R.undoManager.group())})};var E=[{name:"increase font size",scrollCursorIntoView:!1,exec:function(R){var xb=R.fontSize;jb.changeAttributeInSelectionOrMorph(R,"fontSize",function(Ja){Ja=Ja||xb;return Ja+(18<=Ja?2:1)});return!0}},{name:"decrease font size",
scrollCursorIntoView:!1,exec:function(R){var xb=R.fontSize;jb.changeAttributeInSelectionOrMorph(R,"fontSize",function(Ja){Ja=Ja||xb;return Ja-(18>=Ja?1:2)});return!0}},{name:"change font",scrollCursorIntoView:!1,exec:function(){var R=sb(regeneratorRuntime.mark(function Ga(Ja){var sa,Ub,vc,Oc,aa;return regeneratorRuntime.wrap(function(Ma){for(;;)switch(Ma.prev=Ma.next){case 0:sa=["serif","sans-serif","monospace"];if(Ub=localStorage["lively.morpic/text-change-font-additional-fonts"])Ub=JSON.parse(Ub),
sa.push.apply(sa,ec(Ub));sa.map(function(qb){return qb.toLowerCase()}).includes(Ja.fontFamily.toLowerCase())||(sa.push(Ja.fontFamily),Ub=[].concat(ec(Ub||[]),[Ja.fontFamily]),localStorage["lively.morpic/text-change-font-additional-fonts"]=JSON.stringify(Ub));Ma.next=7;return $world.editListPrompt("choose font",sa,{requester:Ja,preselect:sa.indexOf(Ja.fontFamily),historyId:"lively.morpic/text-change-font-hist"});case 7:vc=Ma.sent;Oc=Xb(vc.selections,1);if(aa=Oc[0])Ja.fontFamily=aa;return Ma.abrupt("return",
!0);case 12:case "end":return Ma.stop()}},Ga)}));return function(Ja){return R.apply(this,arguments)}}()},{name:"set link of selection",scrollCursorIntoView:!1,exec:function(){var R=sb(regeneratorRuntime.mark(function Ga(Ja){var sa,Ub,vc,Oc,aa,Ma=arguments;return regeneratorRuntime.wrap(function(qb){for(;;)switch(qb.prev=qb.next){case 0:sa=1<Ma.length&&void 0!==Ma[1]?Ma[1]:{};if(sa.hasOwnProperty("link")){qb.next=9;break}vc=Ja.selection;Oc=Ja.getStyleInRange(vc);aa=Oc.link;qb.next=6;return Ja.world().prompt("Set link",
{input:aa||"https://",historyId:"lively.morphic-rich-text-link-hist"});case 6:if(Ub=qb.sent){qb.next=9;break}return qb.abrupt("return");case 9:Ja.undoManager.group(),Ja.setStyleInRange({link:Ub||void 0},vc),Ja.undoManager.group();case 12:case "end":return qb.stop()}},Ga)}));return function(Ja){return R.apply(this,arguments)}}()},{name:"set doit of selection",scrollCursorIntoView:!1,exec:function(){var R=sb(regeneratorRuntime.mark(function Ga(Ja){var sa,Ub,vc,Oc;return regeneratorRuntime.wrap(function(aa){for(;;)switch(aa.prev=
aa.next){case 0:return sa=Ja.selection,Ub=Ja.getStyleInRange(sa),vc=Ub.doit,aa.next=5,Ja.world().editPrompt("Enter doit code (runs on clicking the text)",{requester:Ja,input:vc?vc.code:"// empty doit",historyId:"lively.morphic-rich-text-doit-hist",mode:"js",evalEnvironment:Ja.evalEnvForDoit(vc||{})});case 5:Oc=aa.sent,Ja.undoManager.group(),Oc?Ja.addTextAttribute({doit:{code:Oc},nativeCursor:"pointer",textDecoration:"underline"},sa):Ja.removeTextAttribute({doit:null,nativeCursor:"",textDecoration:""},
sa),Ja.undoManager.group();case 9:case "end":return aa.stop()}},Ga)}));return function(Ja){return R.apply(this,arguments)}}()},{name:"reset text style",scrollCursorIntoView:!1,exec:function(R){var xb=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};R.undoManager.group();xb=!xb.onlySelection&&R.selection.isEmpty()?R.documentRange:R.selection.range;R.setStyleInRange(null,xb);R.undoManager.group();return!0}},{name:"open text attribute controls",exec:function(){var R=sb(regeneratorRuntime.mark(function Ga(Ja){var sa,
Ub,vc,Oc;return regeneratorRuntime.wrap(function(aa){for(;;)switch(aa.prev=aa.next){case 0:return aa.next=2,pd.import("./index-ca98f65e.js").then(function(Ma){return Ma.m});case 2:return sa=aa.sent,Ub=sa.module,aa.next=6,Ub("lively.ide/text/ui.js").load();case 6:return vc=aa.sent,Oc=vc.RichTextControl,aa.abrupt("return",Oc.openFor(Ja));case 9:case "end":return aa.stop()}},Ga)}));return function(Ja){return R.apply(this,arguments)}}()}];jb.commands=E;jb.commands=E;var Wb=window.lively.FreezerRuntime.recorderFor("lively.ide/editor-plugin.js");
Wb.guessTextModeName=db;Wb.rangedToken=function(R,xb,Ja,Ga,sa){return{start:{row:R,column:xb},end:{row:R,column:Ja},token:Ga,mode:sa}};Wb.fun=ub;Wb.arr=gd;Wb.connect=Pc;Wb.disconnect=yb;Wb.DefaultTheme=wb;Wb.tokenizeDocument=Xa;Wb.modeInfo=Za;Wb.visitDocumentTokens=Sb;Wb.getMode=Cb;Wb.completionCommands=Ea;Wb.multiSelectCommands=ia;Wb.navCommands=K;Wb.codeCommands=pb;Wb.codeEvaluationCommands=eb;Wb.richTextCommands=E;Wb.Range=Fd;Wb.guessTextModeName=db;Ea=Lc("default",function(R){var xb=window.lively.FreezerRuntime.recorderFor("lively.ide/editor-plugin.js"),
Ja=xb.hasOwnProperty("EditorPlugin")&&"function"===typeof xb.EditorPlugin?xb.EditorPlugin:xb.EditorPlugin=function(Ga){if(!Ga||!Ga[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return ic(Ja,R,[{key:Symbol["for"]("lively-instance-initialize"),value:function(){this.theme=Wb.DefaultTheme.instance;this._ast=this.checker=null;this._tokens=[];this._tokenizerValidBefore=null;this.__dont_serialize__=["mode","_ast","_tokens","_tokenizerValidBefore"]}},
{key:"isEditorPlugin",get:function(){return!0}},{key:"shortName",get:function(){return null}},{key:"longName",get:function(){return this.shortName}},{key:"attach",value:function(Ga){var sa=this;this.textMorph=Ga;Wb.connect(Ga,"textChange",this,"onTextChange");Wb.connect(Ga,"viewChange",this,"onViewChange");this.textMorph.whenRendered().then(function(){return sa.highlight()})}},{key:"detach",value:function(Ga){Wb.disconnect(Ga,"textChange",this,"onTextChange");Wb.disconnect(Ga,"viewChange",this,"onViewChange");
this.textMorph=null}},{key:"onViewChange",value:function(){this.requestHighlight()}},{key:"onTextChange",value:function(Ga){this._ast=null;if(Ga){var sa=this._tokenizerValidBefore;if("replace"===Ga.selector){Wb.__inter0__=Ga.args[0].start;Ga=Wb.__inter0__.row;var Ub=Wb.__inter0__.column}else Ub=Ga=0;if(!sa||Ga<sa.row||Ga===sa.row&&Ub<sa.column)Ga=Math.max(0,Ga),this._tokenizerValidBefore={row:Ga,column:Ub}}this.requestHighlight()}},{key:"requestHighlight",value:function(){var Ga=this;0<arguments.length&&
void 0!==arguments[0]&&arguments[0]?this.highlight():Wb.fun.debounceNamed(this.textMorph.id+"-requestHighlight",300,function(){Ga.highlight()})()}},{key:"highlight",value:function(){var Ga=this.textMorph,sa=this.theme,Ub=this.mode,vc=this._tokenizerValidBefore;if(sa&&Ga&&Ga.document&&Ub){Ga.fill=sa.background;Ga.cursorColor=sa.cursorColor||Ga.fontColor;var Oc=Ga.viewState,aa={};vc=Wb.tokenizeDocument(Ub,Ga.document,Oc.firstVisibleRow,Oc.lastVisibleRow,vc);Ub=vc.lines;vc=vc.tokens;if(Ub.length){Oc=
Ub[0].row;for(var Ma=[],qb=0;qb<vc.length;Oc++,qb++)for(var Vb=vc[qb],Lb=0;Lb<Vb.length;Lb+=5){var Kb=Vb[Lb],Db=Vb[Lb+1],Ra=sa[Vb[Lb+2]]||sa["default"];Ra&&Ma.push({start:{row:Oc,column:Kb},end:{row:Oc,column:Db}},Ra)}Ga.embeddedMorphs.forEach(function(N){var va=Ga.embeddedMorphMap.get(N).anchor;aa[N.id]=Ga.textAttributeAt(va.position)});Ga.setTextAttributesWithSortedRanges(Ma);Ga.embeddedMorphs.forEach(function(N){var va=Ga.embeddedMorphMap.get(N).anchor;va=Wb.Range.at(va.position);va.end.column+=
1;Ga.replace(va,[N,aa[N.id]],!1)});this._tokenizerValidBefore={row:Wb.arr.last(Ub).row+1,column:0}}if(this.checker)this.checker.onDocumentChange({},Ga,this)}}},{key:"visitTokensInRange",value:function(Ga,sa){var Ub=Ga.start,vc=Ga.end,Oc=Ub.row-1;Wb.visitDocumentTokens(this.mode,this.textMorph.document,Ub.row,vc.row,null,function(aa){return Oc++},function(aa,Ma,qb,Vb,Lb,Kb,Db){if(Oc===Ub.row&&0<Ub.column){if(Ub.column>=Vb)return;qb<Ub.column&&Ub.column<Vb&&(qb=Ub.column)}if(Oc===vc.row){if(vc.column<=
qb)return;qb<vc.column&&vc.column<Vb&&(Vb=vc.column)}sa(aa,Ma,Oc,qb,Vb,Lb,Kb,Db)})}},{key:"tokensInRange",value:function(Ga){var sa=[];this.visitTokensInRange(Ga,function(Ub,vc,Oc,aa,Ma,qb,Vb,Lb){return sa.push(Wb.rangedToken(Oc,aa,Ma,Ub,Lb))});return sa}},{key:"tokensOfRow",value:function(Ga){var sa=this.textMorph.getLine(Ga).length;return this.tokensInRange({start:{row:Ga,column:0},end:{row:Ga,column:sa}})}},{key:"tokenAt",value:function(Ga){for(var sa=this.tokensOfRow(Ga.row),Ub=sa.length;Ub--;){var vc=
sa[Ub];if(vc.token&&vc.start.column<=Ga.column&&Ga.column<=vc.end.column)return vc}return null}},{key:"getCommands",value:function(Ga){return[].concat(ec(Ga),ec(Wb.completionCommands),ec(Wb.multiSelectCommands),ec(Wb.navCommands),ec(Wb.codeCommands),ec(Wb.codeEvaluationCommands),ec(Wb.richTextCommands))}},{key:"getComment",value:function(){if(!this.mode)return null;var Ga=this.mode,sa=Ga.lineComment,Ub=Ga.blockCommentStart;Ga=Ga.blockCommentEnd;var vc={};sa&&(vc.lineCommentStart=sa);Ub&&(vc.blockCommentStart=
Ub);Ga&&(vc.blockCommentEnd=Ga);return vc}},{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.textMorph,")")}},{key:"cmd_newline",value:function(Ga,sa,Ub){var vc=this.textMorph,Oc=Ga.row,aa=Ga.column;Ga=sa[aa-1];sa=sa[aa];vc.selection.text="\n";vc.selection.collapseToEnd();"{"===Ga&&"}"===sa&&(vc.selection.text="\n"+" ".repeat(Ub),vc.selection.collapse());vc.execCommand("indent according to mode",{undo:!1,ignoreFollowingText:!1,firstRow:Oc+1,lastRow:Oc+1});return!0}},
{key:"openPairs",get:function(){return{"{":"}","[":"]","(":")",'"':'"',"'":"'","`":"`"}}},{key:"closePairs",get:function(){return{"}":"{","]":"[",")":"(",'"':'"',"'":"'","`":"`"}}},{key:"cmd_delete_backwards",value:function(){var Ga=this.textMorph,sa=this.openPairs,Ub=Ga.selection,vc=Ga.getLine(Ub.end.row),Oc=vc[Ub.end.column-1];vc=vc[Ub.end.column];Ga.autoInsertPairs&&Ub.isEmpty()&&Oc in sa&&vc===sa[Oc]&&(Ub.growRight(1),Ub.growLeft(1));return!1}},{key:"cmd_insertstring",value:function(Ga){var sa=
this.openPairs,Ub=this.closePairs,vc=this.textMorph,Oc=vc.selection,aa=vc.autoInsertPairs&&Ga in sa,Ma=vc.autoInsertPairs&&Ga in Ub;if(!aa&&!Ma)return!1;var qb=vc.getLine(Oc.end.row)[Oc.end.column];if(!Oc.isEmpty()){if(!aa)return!1;Ub=vc.undoManager.ensureNewGroup(vc);vc.insertText(sa[Ga],Oc.end);vc.insertText(Ga,Oc.start);vc.undoManager.group(Ub);Oc.growRight(-1);return!0}if(qb in Ub&&Ga===qb)return Oc.goRight(1),!0;if(Ma&&!aa)return!1;Ub=vc.undoManager.ensureNewGroup(vc);vc.insertText(Ga+sa[Ga]);
vc.undoManager.group(Ub);Oc.goLeft(1);return!0}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"EditorPlugin"}}],xb,{pathInPackage:function(){return"./editor-plugin.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:3236,end:12244})}(void 0));ia=Lc("CodeMirrorEnabledEditorPlugin",function(R){var xb=window.lively.FreezerRuntime.recorderFor("lively.ide/editor-plugin.js"),
Ja=xb.hasOwnProperty("CodeMirrorEnabledEditorPlugin")&&"function"===typeof xb.CodeMirrorEnabledEditorPlugin?xb.CodeMirrorEnabledEditorPlugin:xb.CodeMirrorEnabledEditorPlugin=function(Ga){if(!Ga||!Ga[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return ic(Ja,R,[{key:Symbol["for"]("lively-instance-initialize"),value:function(){ic._get(Object.getPrototypeOf(Ja.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this);
this.mode=null}},{key:"attach",value:function(Ga){this.mode=this.codeMirrorMode(Ga);return ic._get(Object.getPrototypeOf(Ja.prototype),"attach",this).call(this,Ga)}},{key:"__deserialize__",value:function(){this.mode=this.textMorph?this.codeMirrorMode(this.textMorph):null}},{key:"defaultCodeMirrorModeConfig",value:function(Ga){return{indentWithTabs:!Ga.useSoftTabs,indentUnit:Ga.tabWidth,tabSize:4}}},{key:"codeMirrorMode",value:function(Ga){Ga=this.defaultCodeMirrorModeConfig(Ga);return Wb.getMode(Ga,
{name:this.longName})}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"CodeMirrorEnabledEditorPlugin"}}],xb,{pathInPackage:function(){return"./editor-plugin.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:12252,end:12960})}(Wb.EditorPlugin));Wb.CodeMirrorEnabledEditorPlugin=ia;Wb.CodeMirrorEnabledEditorPlugin=
ia;Wb["default"]=Ea}}});