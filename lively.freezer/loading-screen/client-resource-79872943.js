System.register(["./__root_module__-c4d7431e.js","kld-intersections","./client-command-0b4f9bf8.js"],function(ta){var nb,Bb,Vb,Qb,Dd,Ic;return{setters:[function(ud){nb=ud.s;Bb=ud._;Vb=ud.a5;Qb=ud.bD;Dd=ud.a6},function(){},function(ud){Ic=ud.runCommand}],execute:function(){function ud(Ta,sb){var dc,ac,Vc,Hd,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kc){if(1==kc.nextAddress)return dc=id.fileInfoCommandString(Ta,sb),ac=id.runCommand(dc,sb),kc.yield(ac.whenDone(),2);if(Vc=0!=
ac.exitCode?ac.output:null)throw Vc;Hd=$jscomp.makeIterator(id.parseDirectoryListFromLs(ac.stdout,sb.rootDirectory||"."));hc=Hd.next().value;return kc.return(hc)})}function Nc(Ta,sb){return id.string.lines(Ta).map(function(dc){return dc.trim().length?(new id.FileInfo(sb)).readFromDirectoryListLine(dc):null}).filter(Boolean)}function Jc(Ta,sb){var dc,ac,Vc,Hd,hc,kc,xb,yb,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Kc){dc=Object.assign({findFilesGroup:"default-find-files-process"},
sb);ac=dc.findFilesGroup;Vc=dc.rootDirectory;hc=Hd=id.findFilesProcesses[ac]||(id.findFilesProcesses[ac]={promiseState:null,commands:[]});kc=hc.commands;xb=hc.promiseState;xb||(Hd.promiseState=xb=id.promise.deferred());yb=id.findFilesCommandString(Ta,sb);kc.forEach(function(zb){return zb.kill()});wc=id.runCommand(yb,sb);kc.push(wc);wc.whenDone().then(function(){id.arr.remove(kc,wc);if(kc.some(function(ab){return ab.startTime>wc.startTime}))console.log("[findFiles] command "+wc+" exited but a newer findFiles command was started for group "+
ac+", discarding output");else{var zb=0!=wc.exitCode?wc.output:null;zb&&console.warn(zb);zb=zb?[]:id.parseDirectoryListFromLs(wc.stdout,Vc)||[];xb.resolve(zb);Object.assign(Hd,{promiseState:null,commands:[]})}}).catch(function(zb){return console.error(zb)});return Kc.return(xb.promise)})}function Xc(Ta){function sb(dc){return Array.prototype.concat.apply([dc],dc.children?dc.children.map(sb):[])}return sb(Ta).map(function(dc){var ac=dc.fullPath.replace(/^\//,"");return{fileName:ac,path:ac,rootDirectory:"./",
isDirectory:dc.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var id=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");id.fileInfo=ud;id.fileInfoCommandString=function(Ta,sb){var dc=sb=void 0===sb?{}:sb;sb=dc.rootDirectory;dc=dc.platform;sb=sb||".";var ac="win32"===dc?"\\":"/";"win32"===dc||sb.endsWith(ac)||(sb+=ac);return"win32"===dc?"cd "+sb+' && ls -lLd --time-style=locale "'+Ta+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(sb+' && ls -lLd "$timeformat" "'+Ta+'"')};id.parseDirectoryListFromLs=Nc;id.findFiles=Jc;id.findFilesCommandString=function(Ta,sb){var dc=sb=void 0===sb?{}:sb,ac=dc.rootDirectory,Vc=dc.exclude,Hd=dc.depth;dc=dc.platform;ac=ac||".";Vc=Vc||"-iname "+id.defaultExcludes.map(id.string.print).join(" -o -iname ");var hc="win32"===dc?"\\":"/";"win32"===dc||ac.endsWith(hc)||(ac+=hc);Ta=id.string.format('%s "%s"',sb.re?"-iregex":sb.matchPath?"-ipath":"-iname",Ta);Hd="number"===typeof Hd?" -maxdepth "+Hd:"";
return"win32"===dc?id.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",ac,sb.re?"-E ":"",Vc.replace(/"/g,""),Ta.replace(/"/g,""),Hd):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+id.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',ac,sb.re?"-E ":"",Vc,Ta,Hd)};id.convertDirectoryUploadEntriesToFileInfos=
Xc;id.runCommand=Ic;id.string=nb;id.promise=Bb;id.arr=Vb;id.fileInfo=ud;id.fileInfo=ud;id.parseDirectoryListFromLs=Nc;id.parseDirectoryListFromLs=Nc;var Fd=function(Ta){this.rootDirectory=Ta;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};Fd.prototype.readFromDirectoryListLine=function(Ta){var sb=this;if(!Ta.trim().length)return null;var dc=Ta;this.reader.forEach(function(ac){return dc=
ac(dc,sb)});return this};Fd.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(Fd.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(Ta,sb){var dc=Ta.indexOf(" ");sb.mode=Ta.slice(0,dc);sb.isDirectory="d"===sb.mode[0];return Ta.slice(dc+1).trim()},function(Ta,sb){var dc=Ta.indexOf(" ");sb.linkCount=Number(Ta.slice(0,dc));return Ta.slice(dc+1).trim()},function(Ta,sb){var dc=Ta.indexOf(" ");sb.user=Ta.slice(0,dc);return Ta.slice(dc+1).trim()},
function(Ta,sb){var dc=id.string.peekRight(Ta,0,/\s+[0-9]/);sb.group=Ta.slice(0,dc).trim();return Ta.slice(dc).trim()},function(Ta,sb){var dc=Ta.indexOf(" ");sb.size=Number(Ta.slice(0,dc));return Ta.slice(dc+1).trim()},function(Ta,sb){var dc=id.string.reMatches(Ta,/[^s]+\s+[0-9:\s]+/);if(!dc||!dc[0])return Ta;sb.lastModified=new Date(dc[0].match+" GMT");return Ta.slice(dc[0].end).trim()},function(Ta,sb){var dc=(Ta=Ta.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&Ta.split(" -> "),ac=""===Ta?!1:Ta&&
2===dc.length,Vc=(dc=ac?dc[0]:Ta)&&0===dc.indexOf(sb.rootDirectory)?dc.slice(sb.rootDirectory.length):dc;sb.fileName=""===Ta?".":Vc;sb.path=dc;sb.isLink=ac;return Vc}]}}});id.FileInfo=Fd;id.findFilesProcesses={};id.findFiles=Jc;id.findFiles=Jc;id.defaultExcludes=[".svn",".git","node_modules",".module_cache"];id.convertDirectoryUploadEntriesToFileInfos=Xc;id.convertDirectoryUploadEntriesToFileInfos=Xc;var nd=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");nd.Resource=Qb;nd.runCommand=
Ic;nd.fileInfo=ud;nd.findFiles=Jc;nd.string=nb;nd.promise=Bb;nd.arr=Vb;nd.obj=Dd;Fd=function(Ta,sb,dc){dc=void 0===dc?{}:dc;Ta=nd.Resource.call(this,Ta)||this;Ta.options=Object.assign({},dc,{l2lClient:sb||Ta.constructor.defaultL2lClient});return Ta};$jscomp.inherits(Fd,nd.Resource);Fd.prototype.newResource=function(Ta){return new this.constructor(Ta,this.options.l2lClient,this.options)};Fd.prototype.read=function(){var Ta=this,sb=nd.runCommand('cat "'+this.url+'"',this.options);return sb.whenDone().then(function(){if(sb.exitCode)throw Error("Read "+
Ta.url+" failed: "+sb.stderr);return sb.output})};Fd.prototype.write=function(Ta){var sb=this,dc,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vc){switch(Vc.nextAddress){case 1:return Ta?Vc.yield(nd.runCommand('touch "'+sb.url+'" && tee "'+sb.url+'"',Object.assign({stdin:String(Ta)},sb.options)).whenDone(),4):Vc.yield(nd.runCommand('echo -n > "'+sb.url+'"',Object.assign({},sb.options)).whenDone(),5);case 4:dc=Vc.yieldResult;Vc.jumpTo(3);break;case 5:dc=Vc.yieldResult;case 3:ac=dc;
if(ac.exitCode)throw Error("Write "+sb.url+" failed: "+ac.stderr);return Vc.return(sb)}})};Fd.prototype.mkdir=function(){var Ta=this,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){if(1==dc.nextAddress)return dc.yield(nd.runCommand('mkdir -p "'+Ta.url+'"',Ta.options).whenDone(),2);sb=dc.yieldResult;if(sb.exitCode)throw Error(Ta+" cannot create directory: "+sb.stderr);return dc.return(Ta)})};Fd.prototype.exists=function(){var Ta=nd.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return Ta.whenDone().then(function(){return 0===Ta.exitCode})};Fd.prototype.remove=function(){var Ta=this,sb=nd.runCommand('rm -rf "'+this.url+'"',this.options);return sb.whenDone().then(function(){if(sb.exitCode)throw Error("Remove of "+Ta.url+" failed: "+sb.stderr);return Ta})};Fd.prototype.gzip=function(Ta){var sb=this,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){dc=nd.runCommand('gzip > "'+sb.url+'"',Object.assign({stdin:String(Ta)},sb.options));
return ac.return(dc.whenDone().then(function(){if(dc.exitCode)throw Error("Gzip compression of "+sb.url+" failed: "+dc.stderr);return sb}))})};Fd.prototype.brotli=function(Ta){var sb=this,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){dc=nd.runCommand('brotli > "'+sb.url+'"',Object.assign({stdin:String(Ta)},sb.options));return ac.return(dc.whenDone().then(function(){if(dc.exitCode)throw Error("Brotli compression of "+sb.url+" failed: "+dc.stderr);return sb}))})};Fd.prototype.readProperties=
function(){var Ta=this,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){if(1==dc.nextAddress)return dc.yield(nd.fileInfo(Ta.url,Ta.options),2);sb=dc.yieldResult;Ta.assignProperties(nd.obj.dissoc(sb,["fileName","path","rootDirectory"]));return dc.return(Ta)})};Fd.prototype.dirList=function(Ta,sb){Ta=void 0===Ta?1:Ta;sb=void 0===sb?{}:sb;var dc=this,ac,Vc,Hd,hc,kc,xb,yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wc){if(1==wc.nextAddress)return ac=sb,Vc=ac.exclude,
Array.isArray(Vc)&&(Vc="-iname "+Vc.map(nd.string.print).join(" -o -iname ")),Hd=dc,hc=Hd.url,kc=Hd.options,xb=kc.l2lClient,wc.yield(nd.findFiles("*",{exclude:Vc,depth:Ta,rootDirectory:hc,l2lClient:xb}),2);yb=wc.yieldResult;yb[0].path.replace(/\/$/,"")===dc.url.replace(/\/$/,"")&&yb.shift();return wc.return(yb.map(function(Kc){var zb=Kc.path;Kc.isDirectory&&(zb=zb.replace(/\/?$/,"/"));zb=new dc.constructor(zb,xb,dc.options);zb.assignProperties(nd.obj.dissoc(Kc,["fileName","path","rootDirectory"]));
return zb}))})};$jscomp.global.Object.defineProperties(Fd,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||nd._defaultL2LClient},set:function(Ta){this._defaultL2lClient=nd._defaultL2LClient=Ta}}});ta("default",Fd);nd.ShellClientResource=Fd;nd._defaultL2LClient=nd._defaultL2LClient||void 0;var Yc=ta("resourceExtension",{name:"shell-client",matches:function(Ta){return Ta.startsWith("/")||Ta.match(/[a-z]:\\/i)},resourceClass:nd.ShellClientResource});nd.resourceExtension=
Yc;nd.resourceExtension=Yc;nd.resourceExtension=Yc;nd.default=Fd}}});