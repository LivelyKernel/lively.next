System.register(["./__root_module__-f9290433.js","kld-intersections"],function(sa){var db,Eb,Vb,Wb,wd,Ic,Ad,Jc,Mc,bd,ed,Od,qd;return{setters:[function(Xc){db=Xc.bs;Eb=Xc.a4;Vb=Xc.r;Wb=Xc.a5;wd=Xc.bm;Ic=Xc.bt;Ad=Xc.bu;Jc=Xc.T;Mc=Xc.s;bd=Xc.bv;ed=Xc.bw;Od=Xc.n;qd=Xc.bx},function(){}],execute:function(){function Xc(I){try{var T=eval("("+Va.ast.transform.wrapInFunction("var _; _ = ("+I+")")+")()")}catch(qa){return JSON.parse(I)}return"object"!==typeof T?null:T}function Ra(I,T){var qa,Ga,Mb,nb,Ha,
kb,Qc,qc,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){switch(za.nextAddress){case 1:return qa=T.world(),za.yield(qa.prompt("Enter package name",{requester:T,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:Ga=za.yieldResult;if(!Ga)throw"Canceled";za.setCatchFinallyBlocks(3);nb=lb.resource(Ga);Ga=nb.name();Mb=nb.url;za.leaveTryBlock(4);break;case 3:return za.enterCatchBlock(),za.yield(I.getConfig(),5);case 5:return Ha=za.yieldResult.baseURL,kb=
lb.resource(Ha).join(Ga).asDirectory().url,za.yield(I.normalize(kb),6);case 6:Mb=za.yieldResult.replace(/\/\.js$/,"/");case 4:return za.yield(qa.prompt("Confirm or change package location",{requester:T,input:Mb,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Qc=za.yieldResult;if(!Qc)throw"Canceled";qc=lb.resource(Qc).asDirectory();Cb=qc.asFile().url;return za.yield(I.removePackage(Cb),8);case 8:return za.yield(I.resourceCreateFiles(Cb,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
Ga+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+Ga+"\n\nNo description for package "+Ga+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+Ga+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return za.return(lb.loadPackage(I,{name:Ga,address:Cb,configFile:qc.join("package.json").url,main:qc.join("index.js").url,test:qc.join("tests/test.js").url,type:"package"}))}})}function wb(I,T,qa){qa=void 0===qa?
null:qa;var Ga,Mb,nb,Ha,kb,Qc,qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cb){switch(Cb.nextAddress){case 1:return Ga={name:"",address:"",type:"package"},Cb.yield(I.getConfig(),2);case 2:Mb=Cb.yieldResult;if(!qa){Cb.jumpTo(3);break}return Cb.yield(I.getPackage(qa),4);case 4:if(nb=Cb.yieldResult){Cb.jumpTo(5);break}return Cb.yield(I.getPackageForModule(qa),6);case 6:nb=Cb.yieldResult;case 5:Ha=nb;case 3:return Cb.yield(T.world().prompt("What is the package directory?",{requester:T,
input:Ha?Ha.address:Mb.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:kb=Cb.yieldResult;if(!kb)throw"Canceled";Ga.address=kb.replace(/\/$/,"");Ga.url=new URL(Ga.address+"/");Ga.configFile=lb.resource(Ga.url).join("package.json").url;Cb.setCatchFinallyBlocks(8);Qc=JSON;qc=Qc.parse;return Cb.yield(I.moduleRead(Ga.configFile),10);case 10:qc.call(Qc,Cb.yieldResult).name;Cb.leaveTryBlock(9);break;case 8:Cb.enterCatchBlock(),Ga.name=String(Ga.url).replace(/\/$/,""),
I.resourceEnsureExistance(Ga.configFile,'{\n  "name": "'+Ga.name+'",\n  "version": "0.1.0"\n}');case 9:return Cb.return(lb.loadPackage(I,Ga))}})}function mc(I,T,qa){var Ga,Mb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){switch(Ha.nextAddress){case 1:return Ga=lb.resource(qa).asFile().url,Ha.yield(I.getPackage(Ga),2);case 2:if(Mb=Ha.yieldResult){Ha.jumpTo(3);break}return Ha.yield(I.getPackageForModule(Ga),4);case 4:Mb=Ha.yieldResult;case 3:nb=Mb;if(!nb)throw Error("Cannot find package for "+
Ga);return Ha.yield(I.reloadPackage(Ga),5);case 5:if(!T){Ha.jumpTo(0);break}return Ha.yield(T.updateModuleList(),7);case 7:return Ha.yield(T.uiSelect(Ga,!1),8);case 8:return Ha.return(Ha.yieldResult)}})}function dc(I,T,qa,Ga){var Mb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){switch(Ha.nextAddress){case 1:return Ha.yield(I.getPackage(qa),2);case 2:return Mb=Ha.yieldResult,Ha.yield((Ga||$world).confirm("Unload package "+Mb.name+"?",{requester:T}),3);case 3:nb=Ha.yieldResult;
if(!nb)throw"Canceled";return Ha.yield(I.removePackage(qa),4);case 4:if(!T){Ha.jumpTo(0);break}return Ha.yield(T.updateModuleList(),6);case 6:return Ha.yield(T.uiSelect(null),0)}})}function Rc(I,T,qa){var Ga,Mb,nb,Ha,kb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){switch(Qc.nextAddress){case 1:return Ga=T.world(),Qc.yield(I.getPackage(qa),2);case 2:return Mb=Qc.yieldResult,Mb?Qc.yield(Ga.confirm("Really remove package "+Mb.name+"?",{requester:T}),3):($world.inform('No package "'+
qa+'" found!',{requester:T}),Qc.return());case 3:nb=Qc.yieldResult;if(!nb)throw"Canceled";I.removePackage(qa);return Qc.yield(Ga.confirm("Also remove directory "+Mb.name+" including "+Mb.modules.length+" modules?"),4);case 4:Ha=Qc.yieldResult;if(!Ha){Qc.jumpTo(0);break}return Qc.yield(Ga.confirm("REALLY *remove* directory "+Mb.name+"? No undo possible..."),6);case 6:if(kb=Qc.yieldResult)return Qc.yield(I.resourceRemove(Mb.address),0);Qc.jumpTo(0)}})}function Tc(I,T,qa){qa=void 0===qa?$world:qa;var Ga,
Mb,nb,Ha,kb,Qc,qc,Cb,za,Ca,ma;return $jscomp.asyncExecutePromiseGeneratorProgram(function(la){switch(la.nextAddress){case 1:return la.yield(I.getPackage(T),2);case 2:Ga=la.yieldResult;if(!Ga)throw Error("Cannot find package "+T);Mb=[];nb=$jscomp.makeIterator(Ga.modules);Ha=nb.next();case 3:if(Ha.done)return la.yield(qa.execCommand("open text window",{title:"imports and exports of "+T,content:Mb.join("\n\n")}),0);kb=Ha.value;if(!kb.name.match(/\.js$/)){la.jumpTo(4);break}la.setCatchFinallyBlocks(6);
Qc=I;qc=Qc.importsAndExportsOf;Cb=kb.name;return la.yield(I.moduleRead(kb.name),9);case 9:return la.yield(qc.call(Qc,Cb,la.yieldResult),8);case 8:za=la.yieldResult;la.leaveTryBlock(7);break;case 6:Ca=la.enterCatchBlock();qa.logError(Error("Error when getting imports/exports from module "+kb.name+":\n"+Ca.stack));la.jumpTo(4);break;case 7:ma=""+kb.name;if(!za.imports.length&&!za.exports.length){ma+="\n  does not import / export anything";la.jumpTo(4);break}za.imports.length&&(ma+="\n  imports:\n",
ma+=lb.arr.groupByKey(za.imports,"fromModule").mapGroups(function(va,cb){return"from "+va+": "+cb.map(function(fb){return fb.local||fb.imported?fb.imported&&fb.imported!==fb.local?fb.imported+" as "+fb.local:fb.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(va){return"    "+va}).join("\n"));za.exports.length&&(ma+="\n  exports:\n",ma+=za.exports.map(function(va){return va.local?va.local&&va.local!==va.exported?va.local+" as "+va.exported:va.exported:va.exported+
" from "+va.fromModule}).join(", ").split("\n").map(function(va){return"    "+va}).join("\n"));Mb.push(ma);case 4:Ha=nb.next(),la.jumpTo(3)}})}function zc(I,T,qa){qa=qa&&qa.address;if(qa&&0===T.indexOf(qa))var Ga=T.slice(qa.length).replace(/^\//,"");else a:{qa=I.getConfig();if(!qa||qa.constructor!==Promise)try{Ga=String((new URL(T)).relativePathFrom(new URL(I.getConfig().baseURL)));break a}catch(Mb){}Ga=T}return Ga}function Fc(I,T,qa,Ga){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mb){return 1==
Mb.nextAddress?(Ga=Object.assign({targetModule:T},Ga),Mb.yield(I.normalize(T),2)):3!=Mb.nextAddress?(T=Mb.yieldResult,Mb.yield(I.moduleSourceChange(T,qa,Ga),3)):Mb.return(T)})}function Jb(I,T,qa,Ga,Mb){Ga=void 0===Ga?!1:Ga;Mb=void 0===Mb?!1:Mb;var nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){switch(Ha.nextAddress){case 1:return T&&T.setStatusMessage("Reloading "+qa),Ha.setCatchFinallyBlocks(2),Ha.yield(I.reloadModule(qa,{reloadDeps:Ga,resetEnv:Mb}),4);case 4:if(!T){Ha.jumpTo(5);
break}return Ha.yield(T.updateModuleList(),6);case 6:case 5:T&&T.setStatusMessage("Reloded "+qa);Ha.leaveTryBlock(0);break;case 2:nb=Ha.enterCatchBlock();Ha.setCatchFinallyBlocks(7);if(!T){Ha.jumpTo(9);break}return Ha.yield(T.updateEditorWithSourceOf(qa),10);case 10:case 9:Ha.leaveTryBlock(8);break;case 7:Ha.enterCatchBlock();case 8:throw T&&T.showError(nb),nb;}})}function Ac(I,T,qa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){switch(Ga.nextAddress){case 1:return Ga.yield(I.forgetModule(qa,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!T){Ga.jumpTo(3);break}return Ga.yield(T.updateModuleList(),4);case 4:case 3:Ga.jumpToEnd()}})}function Bc(I,T,qa){var Ga,Mb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){switch(Ha.nextAddress){case 1:return Ha.yield(I.normalize(qa),2);case 2:return Ga=Ha.yieldResult,Ha.yield(T.world().confirm("Remove file "+Ga+"?",{requester:T}),3);case 3:Mb=Ha.yieldResult;if(!Mb)throw"Canceled";return Ha.yield(I.forgetModule(Ga),4);case 4:return Ha.yield(I.resourceRemove(Ga),
5);case 5:return Ha.yield(I.getPackageForModule(Ga),6);case 6:return nb=Ha.yieldResult,Ha.return(nb)}})}function fd(I,T,qa){var Ga,Mb,nb,Ha,kb,Qc,qc,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){switch(za.nextAddress){case 1:return Ga=URL,za.yield(I.getConfig(),2);case 2:Mb=new Ga(za.yieldResult.baseURL);nb=T.world();if(!qa){za.jumpTo(3);break}return za.yield(I.getPackage(qa),4);case 4:if(Ha=za.yieldResult){za.jumpTo(5);break}return za.yield(I.getPackageForModule(qa),6);case 6:Ha=
za.yieldResult;case 5:(kb=Ha)&&(Mb=new URL(kb.address));case 3:return za.yield(yb._searchForExistingFiles(T,String(Mb),kb),7);case 7:Qc=za.yieldResult;if(!Qc.includes("[create new module]")){za.jumpTo(8);break}return za.yield(yb._askForModuleName(I,qa||String(Mb),nb),9);case 9:qc=za.yieldResult,Qc=[qc];case 8:return za.yield(yb._createAndLoadModules(I,Qc),10);case 10:return Cb=za.yieldResult,yb.arr.compact(Cb.map(function(Ca){return Ca.error})),za.return(Cb)}})}function Qb(I,T){var qa,Ga,Mb,nb,Ha,
kb,Qc,qc,Cb,za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==Ca.nextAddress)return Ca.yield(I.getPackage(T),2);if(3!=Ca.nextAddress){qa=Ca.yieldResult;if(!qa||!qa.address.match(/^http/))throw Error("Cannot load package "+T);Ga=yb.resource(qa.address);Mb=[];nb=$jscomp;Ha=nb.makeIterator;return Ca.yield(Ga.dirList(5,{exclude:yb.modulesInPackage_defaultExclude}),3)}kb=Ha.call(nb,Ca.yieldResult);for(Qc=kb.next();!Qc.done;Qc=kb.next())Cb=qc=Qc.value,za=Cb.url,za.match(/\.js$/)&&
I.isModuleLoaded(za,!0)&&Mb.push(I.getModule(za));return Ca.return(Mb)})}function xb(I,T){T=void 0===T?[]:T;var qa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){if(1==Ga.nextAddress)return Ga.yield(System.import("mocha-es6/index.js"),2);qa=Ga.yieldResult;return Ga.return(qa.loadTestModuleAndExtractTestState(I,T))})}function eb(I,T,qa,Ga){function Mb(Ca){return new Promise(function(ma,la){var va=Zb.arr.compact(Ca.suite.suites).map(function(fb){return fb.file}),cb=Zb.chain(T).filter(function(fb){return va.includes(fb.file)}).pluck("tests").flatten().value();
if(!cb||!cb.length)return la(Error("Trying to run tests of "+va.join(", ")+" but cannot find them in loaded tests!"));Ca.reporter(function(fb){fb.on("test",function(ec){try{var Nc=cb.find(function(pd){return pd.fullTitle===ec.fullTitle()});Nc.state="running";"function"===typeof qa&&qa(Nc,"test")}catch(pd){"function"===typeof Ga&&Ga(pd,"test")}});fb.on("pass",function(ec){try{var Nc=cb.find(function(pd){return pd.fullTitle===ec.fullTitle()});Nc.state="succeeded";Nc.duration=ec.duration;"function"===
typeof qa&&qa(Nc,"pass")}catch(pd){"function"===typeof Ga&&Ga(pd,"pass")}});fb.on("fail",function(ec,Nc){try{var pd=function(Qd,cd,zb){Qd.state="failed";Qd.duration=Qd.duration;Qd.error=cd},Yd=cb.find(function(Qd){return Qd.fullTitle===ec.fullTitle()});if(Yd)pd(Yd,Nc,ec.duration);else{var uc=Zb.arr.invoke(ec.parent.tests,"fullTitle");cb.filter(function(Qd){return uc.includes(Qd.fullTitle)}).forEach(function(Qd){return pd(Qd,Nc,ec.duration)})}"function"===typeof qa&&qa(Yd,"fail")}catch(Qd){"function"===
typeof Ga&&Ga(Qd,"fail")}})});Ca.run(function(fb){return ma({testsByFile:T,mocha:Ca})})})}var nb,Ha,kb,Qc,qc,Cb,za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){switch(Ca.nextAddress){case 1:nb=$jscomp.makeIterator(T),Ha=nb.next();case 2:if(Ha.done){Ca.jumpTo(4);break}Qc=kb=Ha.value;qc=Qc.file;return Ca.yield(Zb.loadMochaTestFile(qc,T),5);case 5:return Cb=Ca.yieldResult,za=Cb.mocha,I&&(za=za.grep(I)),Ca.yield(Mb(za),3);case 3:Ha=nb.next();Ca.jumpTo(2);break;case 4:return Ca.return({mocha:za,
testsByFile:T})}})}function vb(I){I||(I="local");if(I.isSystemInterface)var T=I;else"string"===typeof I&&I.startsWith("l2l ")&&(I={type:"l2l",id:I.split(" ")[1]}),"string"!==typeof I&&"l2l"===I.type&&(T=Tb.l2lInterfaceFor(I.id,I.info)),"string"!==typeof I&&($world.setStatusMessage("Unknown system interface "+I),I="local"),T||(T=I&&"local"!==I?Tb.serverInterfaceFor(I):Tb.localInterface);return T}sa("systemInterfaceNamed",vb);var Va=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
Va.parseJsonLikeObj=Xc;Va.ast=db;Va.parseJsonLikeObj=Xc;Va.parseJsonLikeObj=Xc;var lb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");lb.loadPackage=function(I,T){var qa,Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mb){switch(Mb.nextAddress){case 1:return Mb.yield(I.importPackage(T.address+"/"),2);case 2:if(!T.main){Mb.jumpTo(3);break}return Mb.yield(I.importModule(T.main.toString()),3);case 3:if(!T.test){Mb.jumpTo(5);break}Mb.setCatchFinallyBlocks(6);
return Mb.yield(I.importPackage("mocha-es6"),8);case 8:return qa=Mb.yieldResult,Mb.yield(qa.installSystemInstantiateHook(),9);case 9:return Mb.yield(I.importModule(T.test.toString()),10);case 10:Mb.leaveTryBlock(5);break;case 6:Ga=Mb.enterCatchBlock(),console.warn("Cannot load test of new package: "+Ga);case 5:return Mb.return(I.getPackage(T.address))}})};lb.interactivelyCreatePackage=Ra;lb.interactivelyLoadPackage=wb;lb.interactivelyReloadPackage=mc;lb.interactivelyUnloadPackage=dc;lb.interactivelyRemovePackage=
Rc;lb.showExportsAndImportsOf=Tc;lb.parseJsonLikeObj=Xc;lb.arr=Eb;lb.resource=Vb;lb.interactivelyCreatePackage=Ra;lb.interactivelyCreatePackage=Ra;lb.interactivelyLoadPackage=wb;lb.interactivelyLoadPackage=wb;lb.interactivelyReloadPackage=mc;lb.interactivelyReloadPackage=mc;lb.interactivelyUnloadPackage=dc;lb.interactivelyUnloadPackage=dc;lb.interactivelyRemovePackage=Rc;lb.interactivelyRemovePackage=Rc;lb.showExportsAndImportsOf=Tc;lb.showExportsAndImportsOf=Tc;var yb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
yb.shortModuleName=zc;yb.interactivelyChangeModule=Fc;yb.interactivelyReloadModule=Jb;yb.interactivelyUnloadModule=Ac;yb.interactivelyRemoveModule=Bc;yb.interactivelyAddModule=fd;yb._askForModuleName=function(I,T,qa){var Ga,Mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){switch(nb.nextAddress){case 1:return nb.yield(qa.prompt("Enter module name",{input:T,historyId:"lively.vm-editor-add-module-name"}),2);case 2:T=nb.yieldResult;if(!T)throw"Canceled";return nb.yield(I.normalize(T),
3);case 3:return Ga=nb.yieldResult,nb.yield(qa.confirm(["Create module \n",{},Ga,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Mb=nb.yieldResult;if(!Mb)throw"Canceled";return nb.return(Ga)}})};yb._searchForExistingFiles=function(I,T,qa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return String(T).match(/^http/)?Ga.return(yb._searchForExistingFilesWeb(I,T,qa)):Ga.return(yb._searchForExistingFilesManually(I,T,qa))})};yb._searchForExistingFilesManually=function(I,T,qa){var Ga,
Mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){switch(nb.nextAddress){case 1:return nb.yield(I.world().multipleChoicePrompt("Add Module",{requester:I,choices:["Create New Module","Load Existing Module"]}),2);case 2:Ga=nb.yieldResult;if("Create New Module"===Ga)return nb.return("[create new module]");if("Load Existing Module"!==Ga){nb.jumpTo(3);break}return nb.yield(I.world().prompt("URL of module?",{input:T,requester:I,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(Mb=nb.yieldResult)return nb.return([Mb]);case 3:throw"Canceled";}})};yb._searchForExistingFilesWeb=function(I,T,qa){function Ga(Cb){Cb.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Cb.name())||qa&&yb.arr.pluck(qa.modules,"name").includes(Cb.url)?!0:!1}var Mb,nb,Ha,kb,Qc,qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cb){switch(Cb.nextAddress){case 1:return(Mb=I.world())&&(nb=Mb.showLoadingIndicatorFor(I,"Loading existing modules...")),
Cb.yield(yb.resource(T).dirList(5,{exclude:Ga}),3);case 3:return Cb.yield(Cb.yieldResult.map(function(za){return za.url}),2);case 2:return Ha=Cb.yieldResult,kb=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Ha.filter(function(za){return za.endsWith(".js")}).map(function(za){return{isListItem:!0,string:qa&&0==za.indexOf(qa.address)?qa.name+za.slice(qa.address.length):za,value:za}})),Cb.yield(Promise.resolve(nb&&nb.remove()).then(function(){return I.world().filterableListPrompt("What module to load?",
kb,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:I},I?{extent:I.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Qc=Cb.yieldResult;if(!Qc||"canceled"===Qc.status||!Qc.selected.length)throw"Canceled";qc=Qc.selected||Qc;Array.isArray(qc)||(qc=[qc]);return Cb.return(qc)}})};yb._createAndLoadModules=function(I,T){var qa,Ga,Mb,nb,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kb){switch(kb.nextAddress){case 1:Array.isArray(T)||(T=[T]),qa=[],Ga=$jscomp.makeIterator(T),
Mb=Ga.next();case 2:if(Mb.done){kb.jumpTo(4);break}nb=Mb.value;return kb.yield(I.forgetModule(nb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return kb.yield(I.resourceEnsureExistance(nb,'"format esm";\n'),6);case 6:return kb.setCatchFinallyBlocks(7),kb.yield(I.importModule(nb),9);case 9:qa.push({name:nb});kb.leaveTryBlock(3);break;case 7:Ha=kb.enterCatchBlock(),qa.push({name:nb,error:Ha});case 3:Mb=Ga.next();kb.jumpTo(2);break;case 4:return kb.return(qa)}})};yb.modulesInPackage_defaultExclude=function(I){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(I.name())?!0:!1};yb.modulesInPackage=Qb;yb.obj=Wb;yb.arr=Eb;yb.resource=Vb;yb.shortModuleName=zc;yb.shortModuleName=zc;yb.interactivelyChangeModule=Fc;yb.interactivelyChangeModule=Fc;yb.interactivelyReloadModule=Jb;yb.interactivelyReloadModule=Jb;yb.interactivelyUnloadModule=Ac;yb.interactivelyUnloadModule=Ac;yb.interactivelyRemoveModule=Bc;yb.interactivelyRemoveModule=Bc;yb.interactivelyAddModule=fd;yb.interactivelyAddModule=fd;
yb.modulesInPackage=Qb;yb.modulesInPackage=Qb;var Zb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");Zb.loadMochaTestFile=xb;Zb.runMochaTests=eb;Zb.arr=Eb;Zb.chain=wd;Zb.loadMochaTestFile=xb;Zb.loadMochaTestFile=xb;Zb.runMochaTests=eb;Zb.runMochaTests=eb;var Sb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");Sb.todo=function(I){throw Error(I+" is not yet implemented!");};Sb.parseJsonLikeObj=Xc;Sb.arr=Eb;Sb.Closure=Ic;Sb.obj=
Wb;Sb.resource=Vb;Sb.transform=Ad;Sb.modules=Jc;var $a=function(){};$a.prototype.dynamicCompletionsForPrefix=function(I,T,qa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){Sb.todo("dynamicCompletionsForPrefix");Ga.jumpToEnd()})};$a.prototype.runEval=function(I,T){Sb.todo("runEval")};$a.prototype.resourceExists=function(I){Sb.todo("resourceExists")};$a.prototype.resourceEnsureExistance=function(I,T){Sb.todo("resourceEnsureExistance")};$a.prototype.resourceMkdir=function(I){Sb.todo("resourceMkdir")};
$a.prototype.resourceRead=function(I){Sb.todo("resourceRead")};$a.prototype.resourceRemove=function(I){Sb.todo("resourceRemove")};$a.prototype.resourceWrite=function(I,T){Sb.todo("resourceWrite")};$a.prototype.resourceCreateFiles=function(I,T){Sb.todo("resourceCreateFiles")};$a.prototype.resourceDirList=function(I,T,qa){Sb.todo("resourceDirList")};$a.prototype.normalizeSync=function(I,T,qa){Sb.todo("normalizeSync")};$a.prototype.normalize=function(I,T,qa){Sb.todo("normalize")};$a.prototype.printSystemConfig=
function(){Sb.todo("printSystemConfig")};$a.prototype.getConfig=function(){Sb.todo("getConfig")};$a.prototype.setConfig=function(I){Sb.todo("setConfig")};$a.prototype.getPackages=function(I){Sb.todo("getPackages")};$a.prototype.isModuleLoaded=function(I,T){Sb.todo("isModuleLoaded")};$a.prototype.doesModuleExist=function(I,T){Sb.todo("doesModuleExist")};$a.prototype.getModules=function(){var I=this,T,qa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return 1==Ga.nextAddress?(T=Sb.arr,
qa=T.flatmap,Ga.yield(I.getPackages(),2)):Ga.return(qa.call(T,Ga.yieldResult,function(Mb){return Mb.modules}))})};$a.prototype.getModule=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qa){return 1==qa.nextAddress?qa.yield(T.getModules(),2):qa.return(qa.yieldResult.find(function(Ga){return Ga.name===I}))})};$a.prototype.getPackage=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qa){return 1==qa.nextAddress?(I=I.replace(/\/+$/,""),
qa.yield(T.getPackages(),2)):qa.return(qa.yieldResult.find(function(Ga){return Ga.address===I||Ga.name===I}))})};$a.prototype.getPackageForModule=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){Sb.todo("getPackageForModule");T.jumpToEnd()})};$a.prototype.systemConfChange=function(I){var T=Sb.parseJsonLikeObj(I);["baseURL"].forEach(function(qa){return delete T[qa]});return this.setConfig(T)};$a.prototype.resourcesOfPackage=function(I,T){return $jscomp.asyncExecutePromiseGeneratorProgram(function(qa){Sb.todo("resourcesOfPackage");
qa.jumpToEnd()})};$a.prototype.registerPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){Sb.todo("registerPackage");T.jumpToEnd()})};$a.prototype.importPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){Sb.todo("importPackage");T.jumpToEnd()})};$a.prototype.removePackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){Sb.todo("removePackage");T.jumpToEnd()})};$a.prototype.reloadPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){Sb.todo("reloadPackage");
T.jumpToEnd()})};$a.prototype.packageConfChange=function(I,T){return $jscomp.asyncExecutePromiseGeneratorProgram(function(qa){Sb.todo("packageConfChange");qa.jumpToEnd()})};$a.prototype.importModule=function(I){Sb.todo("importModule")};$a.prototype.forgetModule=function(I,T){Sb.todo("forgetModule")};$a.prototype.reloadModule=function(I,T){Sb.todo("reloadModule")};$a.prototype.moduleFormat=function(I){Sb.todo("moduleFormat")};$a.prototype.moduleRead=function(I){Sb.todo("moduleRead")};$a.prototype.moduleSourceChange=
function(I,T,qa){Sb.todo("moduleSourceChange")};$a.prototype.importsAndExportsOf=function(I,T){Sb.todo("importsAndExportsOf")};$a.prototype.keyValueListOfVariablesInModule=function(I,T){Sb.todo("keyValueListOfVariablesInModule")};$a.prototype.moduleWrite=function(I,T){return this.moduleSourceChange(I,T)};Sb.AbstractCoreInterface=$a;var bb=function(){var I=Sb.AbstractCoreInterface.call(this)||this;I.currentEval=null;return I};$jscomp.inherits(bb,Sb.AbstractCoreInterface);bb.prototype.runEval=function(I,
T){throw Error("Not yet implemented");};bb.prototype.runEvalAndStringify=function(I,T){var qa=this;return this.currentEval?this.currentEval.then(function(){return qa.runEvalAndStringify(I,T)}):this.currentEval=Promise.resolve().then(function(){var Ga,Mb,nb,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kb){switch(kb.nextAddress){case 1:return kb.yield(qa.runEval("\n        Promise.resolve((async "+Sb.transform.wrapInFunction(I)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},T)),2);case 2:if((Ga=kb.yieldResult)&&Ga.isError)throw Error(String(Ga.value||Ga.error));if(!Ga||!Ga.value)return kb.return(null);if(Mb=Ga.promisedValue){kb.jumpTo(3);break}return kb.yield(Ga.value,4);case 4:Mb=kb.yieldResult;case 3:nb=Mb;if(!nb)return kb.return();if("undefined"===nb)return kb.return(void 0);if("null"===nb)return kb.return(null);if("true"===nb)return kb.return(!0);
if("false"===nb)return kb.return(!1);try{Ha=JSON.parse(nb)}catch(Qc){return kb.return(nb)}if(Ha&&Ha.isError)throw Error(String(Ha.value));return kb.return(Ha)}})}).then(function(Ga){delete qa.currentEval;return Ga},function(Ga){delete qa.currentEval;return Promise.reject(Ga)})};bb.prototype.dynamicCompletionsForPrefix=function(I,T,qa){var Ga=this,Mb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){Mb=Sb.obj.isString(qa.context)?qa.context:!1;qa=Sb.obj.dissoc(qa,["systemInterface",
"System","context"]);nb="\n      var prefix = "+JSON.stringify(T)+",\n          opts = "+JSON.stringify(qa)+";\n      opts.context = "+Mb+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Ha.return(Ga.runEvalAndStringify(nb))})};bb.prototype.evalWithResource=function(I,T,qa){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+I+'").'+T+"("+(qa?JSON.stringify(qa):"")+");\n    ")};bb.prototype.resourceExists=function(I){return this.evalWithResource(I,"exists")};bb.prototype.resourceEnsureExistance=function(I,T){return this.evalWithResource(I,
"ensureExistance",T)};bb.prototype.resourceMkdir=function(I){return this.evalWithResource(I,"mkdir")};bb.prototype.resourceRead=function(I){return this.evalWithResource(I,"read")};bb.prototype.resourceRemove=function(I){return this.evalWithResource(I,"remove")};bb.prototype.resourceWrite=function(I,T){return this.evalWithResource(I,"write",T)};bb.prototype.resourceCreateFiles=function(I,T){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
I+'", '+JSON.stringify(T)+")")};bb.prototype.resourceDirList=function(I,T,qa){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+I+'").dirList('+JSON.stringify(T)+", "+JSON.stringify(qa)+"))\n        .map(({url}) => ({url}))")};bb.prototype.livelySystemAccessor=function(I){I=void 0===I?"livelySystem":I;return"var "+I+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
I+') throw new Error("lively-system-interface not available!");'};bb.prototype.normalizeSync=function(I,T,qa){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(I)+", "+JSON.stringify(T)+", "+qa+")")};bb.prototype.normalize=function(I,T,qa){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(I)+", "+JSON.stringify(T)+", "+JSON.stringify(qa)+")")};bb.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
bb.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};bb.prototype.setConfig=function(I){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(I)+")")};bb.prototype.getPackages=function(I){I=Object.assign({excluded:[]},I);I.excluded=I.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(I)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};bb.prototype.getPackageForModule=function(I){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(I)+")")};bb.prototype.isModuleLoaded=function(I,T){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+I+'", '+T+")")};bb.prototype.doesModuleExist=function(I,T){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+I+'", '+T+")")};bb.prototype.registerPackage=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qa){return qa.return(T.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(I)+")"))})};bb.prototype.importPackage=
function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qa){return qa.return(T.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(I)+")"))})};bb.prototype.removePackage=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qa){return qa.return(T.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(I)+")"))})};bb.prototype.reloadPackage=function(I,T){var qa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return Ga.return(qa.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(I)+", "+JSON.stringify(T)+")"))})};bb.prototype.packageConfChange=function(I,T){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(I)+", "+JSON.stringify(T)+")")};bb.prototype.resourcesOfPackage=function(I,T){T=void 0===T?[".git","node_modules",".module_cache","lively.next-node_modules"]:T;var qa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){I.address&&(I=I.address);
return Ga.return(qa.runEvalAndStringify("\n      "+qa.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(I)+", "+JSON.stringify(T)+");"))})};bb.prototype.getModule=function(I){var T=this,qa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){if(1==Ga.nextAddress)return Ga.yield(T.getModules(),2);qa=Ga.yieldResult.find(function(Mb){return Mb.name===I});return Ga.return(qa?Sb.modules.module(qa.name):null)})};bb.prototype.importModule=function(I){return this.runEvalAndStringify("lively.modules.System.import("+
JSON.stringify(I)+")")};bb.prototype.forgetModule=function(I,T){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").unload("+JSON.stringify(T)+")")};bb.prototype.reloadModule=function(I,T){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").reload("+JSON.stringify(T)+")")};bb.prototype.moduleFormat=function(I){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").format();")};bb.prototype.moduleRead=function(I){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(I)+").source()")};bb.prototype.moduleSourceChange=function(I,T,qa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").changeSource("+JSON.stringify(T)+", "+JSON.stringify(qa)+")")};bb.prototype.keyValueListOfVariablesInModule=function(I,T){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+JSON.stringify(I)+", "+JSON.stringify(T)+")")};bb.prototype.importsAndExportsOf=
function(I,T){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(I)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(I)+").exports()})")};bb.prototype.exportsOfModules=function(I){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(I)+";\n      options.excludedPackages = ["+I.excludedPackages.map(function(T){return"function"===typeof T?T.toString():JSON.stringify(T)}).join(",")+
"]\n      await livelySystem.localInterface.exportsOfModules(options)")};bb.prototype.searchInPackage=function(I,T,qa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(I)+", "+JSON.stringify(T)+", "+JSON.stringify(qa)+")")};bb.prototype.loadMochaTestFile=function(I,T){T=void 0===T?[]:T;var qa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return Ga.return(qa.runEvalAndStringify("\n      "+
qa.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(I)+", "+JSON.stringify(T)+"), result;\n      result = {testsByFile}"))})};bb.prototype.runMochaTests=function(I,T,qa,Ga){var Mb=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){I&&I instanceof RegExp&&(I={isRegExp:!0,value:String(I).replace(/^\/|\/$/g,"")});return nb.return(Mb.runEvalAndStringify("\n      var grep = "+JSON.stringify(I)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Mb.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(T||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Sb.RemoteCoreInterface=bb;var Kb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Kb.obj=Wb;Kb.string=Mc;Kb.arr=Eb;Kb.resource=Vb;Kb.createFiles=bd;Kb.ast=db;Kb.modules=Jc;Kb.vm=ed;Kb.loadMochaTestFile=xb;Kb.runMochaTests=eb;Kb.parseJsonLikeObj=Xc;Kb.AbstractCoreInterface=$a;Kb.classToFunctionTransform=Od;$a=function(){return Kb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits($a,Kb.AbstractCoreInterface);$a.prototype.dynamicCompletionsForPrefix=
function(I,T,qa){var Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mb){if(1==Mb.nextAddress)return Mb.yield(Kb.vm.completions.getCompletions(function(nb){return Kb.vm.runEval(nb.replace("return ",""),Object.assign({targetModule:I,classTransform:Kb.classToFunctionTransform},qa))},T),2);Ga=Mb.yieldResult;if(Ga.isError)throw Ga.value;return Mb.return({completions:Ga.completions,prefix:Ga.startLetters})})};$a.prototype.runEval=function(I,T){return Kb.vm.runEval(I,Object.assign({classTransform:Kb.classToFunctionTransform},
T))};$a.prototype.resourceExists=function(I){return Kb.resource(I).exists()};$a.prototype.resourceEnsureExistance=function(I,T){return Kb.resource(I).ensureExistance(T)};$a.prototype.resourceMkdir=function(I){return Kb.resource(I).mkdir()};$a.prototype.resourceRead=function(I){return Kb.resource(I).read()};$a.prototype.resourceRemove=function(I){return Kb.resource(I).remove()};$a.prototype.resourceWrite=function(I,T){return Kb.resource(I).write(T)};$a.prototype.resourceCreateFiles=function(I,T){return Kb.createFiles(I,
T)};$a.prototype.resourceDirList=function(I,T,qa){return Kb.resource(I).dirList(T,qa)};$a.prototype.normalizeSync=function(I,T,qa){return System.decanonicalize(I,T,qa)};$a.prototype.normalize=function(I,T,qa){return System.normalize(I,T,qa)};$a.prototype.printSystemConfig=function(){return Kb.modules.printSystemConfig()};$a.prototype.getConfig=function(){return System.getConfig()};$a.prototype.setConfig=function(I){Kb.modules.System.config(I)};$a.prototype.getPackages=function(I){I=Object.assign({},
I);I=void 0===I.excluded?[]:I.excluded;var T=I.filter(function(Ga){return"string"===typeof Ga}),qa=I.filter(function(Ga){return"function"===typeof Ga});T=T.concat(T.map(function(Ga){return System.decanonicalize(Ga.replace(/\/?$/,"/")).replace(/\/$/,"")}));return Kb.modules.getPackages().filter(function(Ga){return!T.includes(Ga.url)&&!qa.some(function(Mb){return Mb(Ga.url)})})};$a.prototype.registerPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){return T.return(Kb.modules.registerPackage(I))})};
$a.prototype.importPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){return T.return(Kb.modules.importPackage(I))})};$a.prototype.removePackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){return T.return(Kb.modules.removePackage(I))})};$a.prototype.reloadPackage=function(I,T){return $jscomp.asyncExecutePromiseGeneratorProgram(function(qa){return qa.return(Kb.modules.reloadPackage(I,T))})};$a.prototype.packageConfChange=function(I,T){var qa=
this,Ga,Mb,nb,Ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kb){if(1==kb.nextAddress)return Ga=Kb.modules.System,Mb=Kb.parseJsonLikeObj(I),nb=JSON.stringify(Mb,null,2),kb.yield(Kb.modules.module(T).changeSource(nb,{doEval:!1}),2);if(3!=kb.nextAddress)return Ga.set(T,Ga.newModule(Mb)),kb.yield(qa.getPackageForModule(T),3);(Ha=kb.yieldResult)&&Kb.modules.applyPackageConfig(Mb,Ha.address);kb.jumpToEnd()})};$a.prototype.resourcesOfPackage=function(I,T){T=void 0===T?[".git","node_modules",
".module_cache"]:T;var qa,Ga,Mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){if(1==nb.nextAddress)return nb.setCatchFinallyBlocks(2),qa=I.address?I.address:I,Ga=Kb.modules.getPackage(qa),nb.yield(Ga.resources(void 0,T),4);if(2!=nb.nextAddress)return nb.return(nb.yieldResult.map(function(Ha){return Object.assign(Ha,{package:Ha.package.url})}));Mb=nb.enterCatchBlock();console.warn("resourcesOfPackage error for "+I+": "+Mb);return nb.return([])})};$a.prototype.getPackageForModule=
function(I){return(I=Kb.modules.getPackageOfModule(I))?I.asSpec():I};$a.prototype.isModuleLoaded=function(I,T){return Kb.modules.isModuleLoaded(I,T)};$a.prototype.doesModuleExist=function(I,T){return Kb.modules.isModuleLoaded(I,T)};$a.prototype.getModule=function(I){return Kb.modules.module(I)};$a.prototype.importModule=function(I){return Kb.modules.System.import(I)};$a.prototype.forgetModule=function(I,T){return Kb.modules.module(I).unload(T)};$a.prototype.reloadModule=function(I,T){return Kb.modules.module(I).reload(T)};
$a.prototype.moduleFormat=function(I){return Kb.modules.module(I).format()};$a.prototype.moduleRead=function(I){return Kb.modules.module(I).source()};$a.prototype.moduleSourceChange=function(I,T,qa){return Kb.modules.module(I).changeSource(T,qa)};$a.prototype.keyValueListOfVariablesInModule=function(I,T){var qa=this,Ga,Mb,nb,Ha,kb,Qc,qc,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){switch(za.nextAddress){case 1:if(T){za.jumpTo(2);break}return za.yield(qa.resourceRead(I),3);case 3:T=
za.yieldResult;case 2:return Ga="string"===typeof T?Kb.ast.parse(T):T,Mb=qa.normalizeSync(I),qa.moduleFormat(Mb),nb=Kb.modules.module(Mb).env().recorder,za.yield(qa.importsAndExportsOf(Mb,Ga),4);case 4:return Ha=za.yieldResult,kb=Kb.ast.query.topLevelDeclsAndRefs(Ga),Qc=Kb.arr.sortByKey(Kb.ast.query.declarationsOfScope(kb.scope,!0),"start"),qc=Kb.arr.pluck(kb.scope.importSpecifiers,"name"),Cb=0,za.return(Qc.map(function(Ca){var ma=Ca.name.length,la=Ha.exports.find(function(cb){return cb.local===Ca.name}),
va=Kb.arr.include(qc,Ca.name);la&&(ma+=9);va&&(ma+=9);Cb=Math.max(Cb,ma);return{isExport:la,isImport:va,name:Ca.name,value:nb[Ca.name],node:Ca,printedName:Ca.name+(la?" [export]":"")+(va?" [import]":""),printedValue:Kb.obj.inspect(nb[Ca.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(Ca){return{isListItem:!0,value:Ca,string:Ca.printedName+Kb.string.indent(" = "+Ca.printedValue," ",Cb-Ca.printedName.length)}}))}})};$a.prototype.importsAndExportsOf=function(I,T){var qa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){return 1==
Ga.nextAddress?Ga.yield(Kb.modules.module(I).imports(T),2):3!=Ga.nextAddress?(qa=Ga.yieldResult,Ga.yield(Kb.modules.module(I).exports(T),3)):Ga.return({imports:qa,exports:Ga.yieldResult})})};$a.prototype.exportsOfModules=function(I){return Kb.modules.ExportLookup.run(System,I)};$a.prototype.searchInPackage=function(I,T,qa){return Kb.modules.getPackage(I).search(T,qa)};$a.prototype.runMochaTests=function(I,T,qa,Ga){return Kb.runMochaTests(I,T,qa,Ga)};$a.prototype.loadMochaTestFile=function(I,T){return Kb.loadMochaTestFile(I,
T)};$jscomp.global.Object.defineProperties($a.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});Kb.LocalCoreInterface=$a;var wc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");wc.evalStrategies=qd;wc.RemoteCoreInterface=bb;var fc=function(I){var T=wc.RemoteCoreInterface.call(this)||this;T.currentEval=null;T.url=I;T.server=new wc.evalStrategies.HttpEvalStrategy(I);return T};$jscomp.inherits(fc,wc.RemoteCoreInterface);fc.prototype.runEval=
function(I,T){return this.server.runEval(I,T)};$jscomp.global.Object.defineProperties(fc.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});wc.HTTPCoreInterface=fc;var bc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");bc.evalStrategies=qd;bc.RemoteCoreInterface=bb;bb=function(I,T){var qa=bc.RemoteCoreInterface.call(this)||this;
qa.targetId=I;qa.peer=T;return qa};$jscomp.inherits(bb,bc.RemoteCoreInterface);bb.prototype.isConnected=function(){var I=this,T,qa,Ga,Mb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ha){if(1==Ha.nextAddress)return T=I,qa=T.client,Ga=T.targetId,Ha.yield(qa.sendToAndWait(qa.trackerId,"getClients",{}),2);Mb=Ha.yieldResult;nb=Mb.data;return Ha.return(nb.some(function(kb){kb=$jscomp.makeIterator(kb).next().value;return Ga===kb}))})};bb.prototype.runEval=function(I,T){var qa=this,Ga,Mb;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){Ga=qa.client;if(!Ga)throw Error("No lively.2lively default client available!");Mb=new bc.evalStrategies.L2LEvalStrategy(Ga,qa.targetId);return nb.return(Mb.runEval(I,T))})};$jscomp.global.Object.defineProperties(bb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var I=this.peer,T="l2l "+this.targetId.slice(0,5);if(I){var qa=I.location,
Ga=I.type,Mb=I.user;I=I.world;Ga&&(T+=", "+Ga);qa&&(T+=", "+qa.replace(/^https?:\/\//,"")+(I?"/"+I:""));Mb&&(T+=", "+Mb.name)}return T}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});bc.L2LCoreInterface=bb;var Tb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Tb.systemInterfaceNamed=vb;Tb.interactivelyCreatePackage=Ra;Tb.interactivelyLoadPackage=wb;Tb.interactivelyReloadPackage=
mc;Tb.interactivelyUnloadPackage=dc;Tb.interactivelyRemovePackage=Rc;Tb.showExportsAndImportsOf=Tc;Tb.shortModuleName=zc;Tb.interactivelyChangeModule=Fc;Tb.interactivelyReloadModule=Jb;Tb.interactivelyUnloadModule=Ac;Tb.interactivelyRemoveModule=Bc;Tb.interactivelyAddModule=fd;Tb.modulesInPackage=Qb;Tb.LocalCoreInterface=$a;Tb.HTTPCoreInterface=fc;Tb.L2LCoreInterface=bb;bb=function(I){this.coreInterface=I};bb.prototype.dynamicCompletionsForPrefix=function(I,T,qa){return this.coreInterface.dynamicCompletionsForPrefix(I,
T,qa)};bb.prototype.runEval=function(I,T){return this.coreInterface.runEval(I,T)};bb.prototype.printSystemConfig=function(I,T,qa){return this.coreInterface.printSystemConfig(I,T,qa)};bb.prototype.getConfig=function(I,T,qa){return this.coreInterface.getConfig(I,T,qa)};bb.prototype.getPackages=function(I){return this.coreInterface.getPackages(I)};bb.prototype.getModules=function(I,T,qa){return this.coreInterface.getModules(I,T,qa)};bb.prototype.getModule=function(I,T,qa){return this.coreInterface.getModule(I,
T,qa)};bb.prototype.getPackage=function(I,T,qa){return this.coreInterface.getPackage(I,T,qa)};bb.prototype.getPackageForModule=function(I,T,qa){return this.coreInterface.getPackageForModule(I,T,qa)};bb.prototype.resourcesOfPackage=function(I,T){return this.coreInterface.resourcesOfPackage(I,T)};bb.prototype.systemConfChange=function(I,T,qa){return this.coreInterface.systemConfChange(I,T,qa)};bb.prototype.registerPackage=function(I){return this.coreInterface.registerPackage(I)};bb.prototype.importPackage=
function(I){return this.coreInterface.importPackage(I)};bb.prototype.removePackage=function(I){return this.coreInterface.removePackage(I)};bb.prototype.reloadPackage=function(I){return this.coreInterface.reloadPackage(I)};bb.prototype.packageConfChange=function(I,T){return this.coreInterface.packageConfChange(I,T)};bb.prototype.keyValueListOfVariablesInModule=function(I,T){return this.coreInterface.keyValueListOfVariablesInModule(I,T)};bb.prototype.interactivelyCreatePackage=function(I){return Tb.interactivelyCreatePackage(this.coreInterface,
I)};bb.prototype.interactivelyLoadPackage=function(I,T){return Tb.interactivelyLoadPackage(this.coreInterface,I,T)};bb.prototype.interactivelyReloadPackage=function(I,T){return Tb.interactivelyReloadPackage(this.coreInterface,I,T)};bb.prototype.interactivelyUnloadPackage=function(I,T,qa){return Tb.interactivelyUnloadPackage(this.coreInterface,I,T,qa)};bb.prototype.interactivelyRemovePackage=function(I,T){return Tb.interactivelyRemovePackage(this.coreInterface,I,T)};bb.prototype.isModuleLoaded=function(I,
T){return this.coreInterface.isModuleLoaded(I,T)};bb.prototype.doesModuleExist=function(I,T){return this.coreInterface.doesModuleExist(I,T)};bb.prototype.importModule=function(I){return this.coreInterface.importModule(I)};bb.prototype.forgetModule=function(I,T){return this.coreInterface.forgetModule(I,T)};bb.prototype.reloadModule=function(I,T){return this.coreInterface.reloadModule(I,T)};bb.prototype.moduleFormat=function(I){return this.coreInterface.moduleFormat(I)};bb.prototype.moduleRead=function(I){return this.coreInterface.moduleRead(I)};
bb.prototype.moduleWrite=function(I,T){return this.coreInterface.moduleWrite(I,T)};bb.prototype.getModulesInPackage=function(I){return Tb.modulesInPackage(this.coreInterface,I)};bb.prototype.shortModuleName=function(I,T){return Tb.shortModuleName(this.coreInterface,I,T)};bb.prototype.interactivelyChangeModule=function(I,T,qa){return Tb.interactivelyChangeModule(this.coreInterface,I,T,qa)};bb.prototype.interactivelyReloadModule=function(I,T){return Tb.interactivelyReloadModule(this.coreInterface,I,
T)};bb.prototype.interactivelyUnloadModule=function(I,T){return Tb.interactivelyUnloadModule(this.coreInterface,I,T)};bb.prototype.interactivelyRemoveModule=function(I,T){return Tb.interactivelyRemoveModule(this.coreInterface,I,T)};bb.prototype.interactivelyAddModule=function(I,T){return Tb.interactivelyAddModule(this.coreInterface,I,T)};bb.prototype.showExportsAndImportsOf=function(I,T){return Tb.showExportsAndImportsOf(this.coreInterface,I,T)};bb.prototype.exportsOfModules=function(I){return this.coreInterface.exportsOfModules(I)};
bb.prototype.searchInPackage=function(I,T,qa){return this.coreInterface.searchInPackage(I,T,qa)};bb.prototype.searchInAllPackages=function(I,T){T=void 0===T?{}:T;var qa=this,Ga,Mb,nb,Ha,kb,Qc,qc,Cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(za){switch(za.nextAddress){case 1:return(Ga=T.progress)&&Ga.step("Fetching Packages...",0),za.yield(qa.coreInterface.getPackages({excluded:T.excludedPackages}),2);case 2:Mb=za.yieldResult,nb=[],Ga&&Ga.step("Fetching Packages...",.1),Ha=0;case 3:if(!(Ha<
Mb.length)){za.jumpTo(5);break}kb=Mb[Ha];Qc=kb.url;if(!Qc||"no group"===Qc){za.jumpTo(4);break}Ga&&Ga.step(Qc.replace(System.baseURL,"").slice(0,20),.1+Ha/Mb.length*.9);za.setCatchFinallyBlocks(6);return za.yield(qa.coreInterface.searchInPackage(Qc,I,T),8);case 8:qc=za.yieldResult;nb=nb.concat(qc);za.leaveTryBlock(4);break;case 6:Cb=za.enterCatchBlock(),console.error("Error searching in package "+Qc+":\n"+Cb.stack);case 4:Ha++;za.jumpTo(3);break;case 5:return za.return(nb)}})};bb.prototype.loadMochaTestFile=
function(I,T){return this.coreInterface.loadMochaTestFile(I,T)};bb.prototype.runMochaTests=function(I,T,qa,Ga){return this.coreInterface.runMochaTests(I,T,qa,Ga)};$jscomp.global.Object.defineProperties(bb.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});sa("Interface",bb);Tb.Interface=bb;Tb.systemInterfaceNamed=vb;Tb.systemInterfaceNamed=vb;bb=sa("localInterface",new Tb.Interface(new Tb.LocalCoreInterface));
Tb.localInterface=bb;Tb.localInterface=bb;Tb.localInterface=bb;Tb.httpInterfaces={};bb=sa("serverInterfaceFor",function(I){return Tb.httpInterfaces[I]||(Tb.httpInterfaces[I]=new Tb.Interface(new Tb.HTTPCoreInterface(I)))});Tb.serverInterfaceFor=bb;Tb.serverInterfaceFor=bb;Tb.serverInterfaceFor=bb;Tb.l2lInterfaces={};bb=sa("l2lInterfaceFor",function(I,T){return Tb.l2lInterfaces[I]||(Tb.l2lInterfaces[I]=new Tb.Interface(new Tb.L2LCoreInterface(I,T)))});Tb.l2lInterfaceFor=bb;Tb.l2lInterfaceFor=bb;Tb.l2lInterfaceFor=
bb}}});