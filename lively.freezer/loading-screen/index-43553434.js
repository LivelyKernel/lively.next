System.register(["./__root_module__-2cc1f5a8.js"],function(ya){var wb,Ab,ac,Ob,kd,Cc,qd,Dc,Ic,Qc,Bd,ne,ve;return{setters:[function(Wd){wb=Wd.bu;Ab=Wd.a6;ac=Wd.r;Ob=Wd.a8;kd=Wd.$;Cc=Wd.bv;qd=Wd.bw;Dc=Wd.T;Ic=Wd.a7;Qc=Wd.bx;Bd=Wd.by;ne=Wd.l;ve=Wd.bz}],execute:function(){function Wd(Y){try{var Ba=eval("("+yb.ast.transform.wrapInFunction("var _; _ = ("+Y+")")+")()")}catch(P){return JSON.parse(Y)}return"object"!==typeof Ba?null:Ba}function Tb(Y,Ba){var P,na,Sa,hb,cc,Uc,Xb,Db,vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bd){switch(bd.nextAddress){case 1:return P=
Ba.world(),bd.yield(P.prompt("Enter package name",{requester:Ba,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:na=bd.yieldResult;if(!na)throw"Canceled";bd.setCatchFinallyBlocks(3);hb=Ja.resource(na);na=hb.name();Sa=hb.url;bd.leaveTryBlock(4);break;case 3:return bd.enterCatchBlock(),bd.yield(Y.getConfig(),5);case 5:return cc=bd.yieldResult.baseURL,Uc=Ja.resource(cc).join(na).asDirectory().url,bd.yield(Y.normalize(Uc),6);case 6:Sa=bd.yieldResult.replace(/\/\.js$/,
"/");case 4:return bd.yield(P.prompt("Confirm or change package location",{requester:Ba,input:Sa,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Xb=bd.yieldResult;if(!Xb)throw"Canceled";Db=Ja.resource(Xb).asDirectory();vd=Db.asFile().url;return bd.yield(Y.removePackage(vd),8);case 8:return bd.yield(Y.resourceCreateFiles(vd,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+na+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+na+"\n\nNo description for package "+
na+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+na+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return bd.return(Ja.loadPackage(Y,{name:na,address:vd,configFile:Db.join("package.json").url,main:Db.join("index.js").url,test:Db.join("tests/test.js").url,type:"package"}))}})}function wc(Y,Ba,P){P=void 0===P?null:P;var na,Sa,hb,cc,Uc,Xb,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vd){switch(vd.nextAddress){case 1:return na=
{name:"",address:"",type:"package"},vd.yield(Y.getConfig(),2);case 2:Sa=vd.yieldResult;if(!P){vd.jumpTo(3);break}return vd.yield(Y.getPackage(P),4);case 4:if(hb=vd.yieldResult){vd.jumpTo(5);break}return vd.yield(Y.getPackageForModule(P),6);case 6:hb=vd.yieldResult;case 5:cc=hb;case 3:return vd.yield(Ba.world().prompt("What is the package directory?",{requester:Ba,input:cc?cc.address:Sa.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Uc=vd.yieldResult;if(!Uc)throw"Canceled";
na.address=Uc.replace(/\/$/,"");na.url=new URL(na.address+"/");na.configFile=Ja.resource(na.url).join("package.json").url;vd.setCatchFinallyBlocks(8);Xb=JSON;Db=Xb.parse;return vd.yield(Y.moduleRead(na.configFile),10);case 10:Db.call(Xb,vd.yieldResult).name;vd.leaveTryBlock(9);break;case 8:vd.enterCatchBlock(),na.name=String(na.url).replace(/\/$/,""),Y.resourceEnsureExistance(na.configFile,'{\n  "name": "'+na.name+'",\n  "version": "0.1.0"\n}');case 9:return vd.return(Ja.loadPackage(Y,na))}})}function od(Y,
Ba,P){var na,Sa,hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){switch(cc.nextAddress){case 1:return na=Ja.resource(P).asFile().url,cc.yield(Y.getPackage(na),2);case 2:if(Sa=cc.yieldResult){cc.jumpTo(3);break}return cc.yield(Y.getPackageForModule(na),4);case 4:Sa=cc.yieldResult;case 3:hb=Sa;if(!hb)throw Error("Cannot find package for "+na);return cc.yield(Y.reloadPackage(na),5);case 5:if(!Ba){cc.jumpTo(0);break}return cc.yield(Ba.updateModuleList(),7);case 7:return cc.yield(Ba.uiSelect(na,
!1),8);case 8:return cc.return(cc.yieldResult)}})}function Ub(Y,Ba,P,na){var Sa,hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){switch(cc.nextAddress){case 1:return cc.yield(Y.getPackage(P),2);case 2:return Sa=cc.yieldResult,cc.yield((na||$world).confirm("Unload package "+Sa.name+"?",{requester:Ba}),3);case 3:hb=cc.yieldResult;if(!hb)throw"Canceled";return cc.yield(Y.removePackage(P),4);case 4:if(!Ba){cc.jumpTo(0);break}return cc.yield(Ba.updateModuleList(),6);case 6:return cc.yield(Ba.uiSelect(null),
0)}})}function xd(Y,Ba,P){var na,Sa,hb,cc,Uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xb){switch(Xb.nextAddress){case 1:return na=Ba.world(),Xb.yield(Y.getPackage(P),2);case 2:return Sa=Xb.yieldResult,Sa?Xb.yield(na.confirm("Really remove package "+Sa.name+"?",{requester:Ba}),3):($world.inform('No package "'+P+'" found!',{requester:Ba}),Xb.return());case 3:hb=Xb.yieldResult;if(!hb)throw"Canceled";Y.removePackage(P);return Xb.yield(na.confirm("Also remove directory "+Sa.name+" including "+
Sa.modules.length+" modules?"),4);case 4:cc=Xb.yieldResult;if(!cc){Xb.jumpTo(0);break}return Xb.yield(na.confirm("REALLY *remove* directory "+Sa.name+"? No undo possible..."),6);case 6:if(Uc=Xb.yieldResult)return Xb.yield(Y.resourceRemove(Sa.address),0);Xb.jumpTo(0)}})}function Gd(Y,Ba,P){P=void 0===P?$world:P;var na,Sa,hb,cc,Uc,Xb,Db,vd,bd,cb,xb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bc){switch(Bc.nextAddress){case 1:return Bc.yield(Y.getPackage(Ba),2);case 2:na=Bc.yieldResult;
if(!na)throw Error("Cannot find package "+Ba);Sa=[];hb=$jscomp.makeIterator(na.modules);cc=hb.next();case 3:if(cc.done)return Bc.yield(P.execCommand("open text window",{title:"imports and exports of "+Ba,content:Sa.join("\n\n")}),0);Uc=cc.value;if(!Uc.name.match(/\.js$/)){Bc.jumpTo(4);break}Bc.setCatchFinallyBlocks(6);Xb=Y;Db=Xb.importsAndExportsOf;vd=Uc.name;return Bc.yield(Y.moduleRead(Uc.name),9);case 9:return Bc.yield(Db.call(Xb,vd,Bc.yieldResult),8);case 8:bd=Bc.yieldResult;Bc.leaveTryBlock(7);
break;case 6:cb=Bc.enterCatchBlock();P.logError(Error("Error when getting imports/exports from module "+Uc.name+":\n"+cb.stack));Bc.jumpTo(4);break;case 7:xb=""+Uc.name;if(!bd.imports.length&&!bd.exports.length){xb+="\n  does not import / export anything";Bc.jumpTo(4);break}bd.imports.length&&(xb+="\n  imports:\n",xb+=Ja.arr.groupByKey(bd.imports,"fromModule").mapGroups(function(mb,Ec){return"from "+mb+": "+Ec.map(function(Ac){return Ac.local||Ac.imported?Ac.imported&&Ac.imported!==Ac.local?Ac.imported+
" as "+Ac.local:Ac.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(mb){return"    "+mb}).join("\n"));bd.exports.length&&(xb+="\n  exports:\n",xb+=bd.exports.map(function(mb){return mb.local?mb.local&&mb.local!==mb.exported?mb.local+" as "+mb.exported:mb.exported:mb.exported+" from "+mb.fromModule}).join(", ").split("\n").map(function(mb){return"    "+mb}).join("\n"));Sa.push(xb);case 4:cc=hb.next(),Bc.jumpTo(3)}})}function lc(Y){return Y.match(/import.*['"]mocha(-es6)?['"]/)&&
Y.match(/it\(['"]/)}function rc(Y,Ba,P){P=P&&P.address;if(P&&0===Ba.indexOf(P))var na=Ba.slice(P.length).replace(/^\//,"");else a:{P=Y.getConfig();if(!P||P.constructor!==Promise)try{na=String((new Ta.URL(Ba)).relativePathFrom(new Ta.URL(Y.getConfig().baseURL)));break a}catch(Sa){}na=Ba}return na}function Kb(Y,Ba,P,na){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){return 1==Sa.nextAddress?(na=Object.assign({targetModule:Ba},na),Sa.yield(Y.normalize(Ba),2)):3!=Sa.nextAddress?(Ba=Sa.yieldResult,
Sa.yield(Y.moduleSourceChange(Ba,P,na),3)):Sa.return(Ba)})}function qc(Y,Ba,P,na,Sa){na=void 0===na?!1:na;Sa=void 0===Sa?!1:Sa;var hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){switch(cc.nextAddress){case 1:return Ba&&Ba.setStatusMessage("Reloading "+P),cc.setCatchFinallyBlocks(2),cc.yield(Y.reloadModule(P,{reloadDeps:na,resetEnv:Sa}),4);case 4:if(!Ba){cc.jumpTo(5);break}return cc.yield(Ba.updateModuleList(),6);case 6:case 5:Ba&&Ba.setStatusMessage("Reloded "+P);cc.leaveTryBlock(0);
break;case 2:hb=cc.enterCatchBlock();cc.setCatchFinallyBlocks(7);if(!Ba){cc.jumpTo(9);break}return cc.yield(Ba.updateEditorWithSourceOf(P),10);case 10:case 9:cc.leaveTryBlock(8);break;case 7:cc.enterCatchBlock();case 8:throw Ba&&Ba.showError(hb),hb;}})}function Hc(Y,Ba,P){return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){switch(na.nextAddress){case 1:return na.yield(Y.forgetModule(P,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Ba){na.jumpTo(3);break}return na.yield(Ba.updateModuleList(),
4);case 4:case 3:na.jumpToEnd()}})}function ad(Y,Ba,P){var na,Sa,hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){switch(cc.nextAddress){case 1:return cc.yield(Y.normalize(P),2);case 2:return na=cc.yieldResult,cc.yield(Ba.world().confirm("Remove file "+na+"?",{requester:Ba}),3);case 3:Sa=cc.yieldResult;if(!Sa)throw"Canceled";return cc.yield(Y.forgetModule(na),4);case 4:return cc.yield(Y.resourceRemove(na),5);case 5:return cc.yield(Y.getPackageForModule(na),6);case 6:return hb=cc.yieldResult,
cc.return(hb)}})}function dd(Y,Ba,P){var na,Sa,hb,cc,Uc,Xb,Db,vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bd){switch(bd.nextAddress){case 1:return na=Ta.URL,bd.yield(Y.getConfig(),2);case 2:Sa=new na(bd.yieldResult.baseURL);hb=Ba.world();if(!P){bd.jumpTo(3);break}return bd.yield(Y.getPackage(P),4);case 4:if(cc=bd.yieldResult){bd.jumpTo(5);break}return bd.yield(Y.getPackageForModule(P),6);case 6:cc=bd.yieldResult;case 5:(Uc=cc)&&(Sa=new Ta.URL(Uc.address));case 3:return bd.yield(Ta._searchForExistingFiles(Ba,
String(Sa),Uc),7);case 7:Xb=bd.yieldResult;if(!Xb.includes("[create new module]")){bd.jumpTo(8);break}return bd.yield(Ta._askForModuleName(Y,P||String(Sa),hb),9);case 9:Db=bd.yieldResult,Xb=[Db];case 8:return bd.yield(Ta._createAndLoadModules(Y,Xb),10);case 10:return vd=bd.yieldResult,Ta.arr.compact(vd.map(function(cb){return cb.error})),bd.return(vd)}})}function fc(Y,Ba){var P,na,Sa,hb,cc,Uc,Xb,Db,vd,bd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==cb.nextAddress)return cb.yield(Y.getPackage(Ba),
2);if(3!=cb.nextAddress){P=cb.yieldResult;if(!P||!P.address.match(/^http/))throw Error("Cannot load package "+Ba);na=Ta.resource(P.address);Sa=[];hb=$jscomp;cc=hb.makeIterator;return cb.yield(na.dirList(5,{exclude:Ta.modulesInPackage_defaultExclude}),3)}Uc=cc.call(hb,cb.yieldResult);for(Xb=Uc.next();!Xb.done;Xb=Uc.next())vd=Db=Xb.value,bd=vd.url,bd.match(/\.js$/)&&Y.isModuleLoaded(bd,!0)&&Sa.push(Y.getModule(bd));return cb.return(Sa)})}function jb(Y){Y||(Y="local");if(Y.isSystemInterface)var Ba=Y;
else"string"===typeof Y&&Y.startsWith("l2l ")&&(Y={type:"l2l",id:Y.split(" ")[1]}),"string"!==typeof Y&&"l2l"===Y.type&&(Ba=nb.l2lInterfaceFor(Y.id,Y.info)),"string"!==typeof Y&&($world.setStatusMessage("Unknown system interface "+Y),Y="local"),Ba||(Ba=Y&&"local"!==Y?nb.serverInterfaceFor(Y):nb.localInterface);return Ba}ya("systemInterfaceNamed",jb);var yb=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");yb.parseJsonLikeObj=Wd;yb.ast=wb;yb.parseJsonLikeObj=Wd;yb.parseJsonLikeObj=
Wd;var Ja=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Ja.loadPackage=function(Y,Ba){var P,na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){switch(Sa.nextAddress){case 1:return Sa.yield(Y.importPackage(Ba.address+"/"),2);case 2:if(!Ba.main){Sa.jumpTo(3);break}return Sa.yield(Y.importModule(Ba.main.toString()),3);case 3:if(!Ba.test){Sa.jumpTo(5);break}Sa.setCatchFinallyBlocks(6);return Sa.yield(Y.importPackage("mocha-es6"),8);case 8:return P=Sa.yieldResult,
Sa.yield(P.installSystemInstantiateHook(),9);case 9:return Sa.yield(Y.importModule(Ba.test.toString()),10);case 10:Sa.leaveTryBlock(5);break;case 6:na=Sa.enterCatchBlock(),console.warn("Cannot load test of new package: "+na);case 5:return Sa.return(Y.getPackage(Ba.address))}})};Ja.interactivelyCreatePackage=Tb;Ja.interactivelyLoadPackage=wc;Ja.interactivelyReloadPackage=od;Ja.interactivelyUnloadPackage=Ub;Ja.interactivelyRemovePackage=xd;Ja.showExportsAndImportsOf=Gd;Ja.parseJsonLikeObj=Wd;Ja.arr=
Ab;Ja.resource=ac;Ja.interactivelyCreatePackage=Tb;Ja.interactivelyCreatePackage=Tb;Ja.interactivelyLoadPackage=wc;Ja.interactivelyLoadPackage=wc;Ja.interactivelyReloadPackage=od;Ja.interactivelyReloadPackage=od;Ja.interactivelyUnloadPackage=Ub;Ja.interactivelyUnloadPackage=Ub;Ja.interactivelyRemovePackage=xd;Ja.interactivelyRemovePackage=xd;Ja.showExportsAndImportsOf=Gd;Ja.showExportsAndImportsOf=Gd;var Ta=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");Ta.isTestModule=
lc;Ta.shortModuleName=rc;Ta.interactivelyChangeModule=Kb;Ta.interactivelyReloadModule=qc;Ta.interactivelyUnloadModule=Hc;Ta.interactivelyRemoveModule=ad;Ta.interactivelyAddModule=dd;Ta._askForModuleName=function(Y,Ba,P){var na,Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){switch(hb.nextAddress){case 1:return hb.yield(P.prompt("Enter module name",{input:Ba,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Ba=hb.yieldResult;if(!Ba)throw"Canceled";return hb.yield(Y.normalize(Ba),
3);case 3:return na=hb.yieldResult,hb.yield(P.confirm(["Create module \n",{},na,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Sa=hb.yieldResult;if(!Sa)throw"Canceled";return hb.return(na)}})};Ta._searchForExistingFiles=function(Y,Ba,P){return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){return String(Ba).match(/^http/)?na.return(Ta._searchForExistingFilesWeb(Y,Ba,P)):na.return(Ta._searchForExistingFilesManually(Y,Ba,P))})};Ta._searchForExistingFilesManually=function(Y,Ba,
P){var na,Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){switch(hb.nextAddress){case 1:return hb.yield(Y.world().multipleChoicePrompt("Add Module",{requester:Y,choices:["Create New Module","Load Existing Module"]}),2);case 2:na=hb.yieldResult;if("Create New Module"===na)return hb.return("[create new module]");if("Load Existing Module"!==na){hb.jumpTo(3);break}return hb.yield(Y.world().prompt("URL of module?",{input:Ba,requester:Y,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(Sa=hb.yieldResult)return hb.return([Sa]);case 3:throw"Canceled";}})};Ta._searchForExistingFilesWeb=function(Y,Ba,P){function na(vd){vd.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(vd.name())||P&&Ta.arr.pluck(P.modules,"name").includes(vd.url)?!0:!1}var Sa,hb,cc,Uc,Xb,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vd){switch(vd.nextAddress){case 1:return(Sa=Y.world())&&(hb=Sa.showLoadingIndicatorFor(Y,"Loading existing modules...")),
vd.yield(Ta.resource(Ba).dirList(5,{exclude:na}),3);case 3:return vd.yield(vd.yieldResult.map(function(bd){return bd.url}),2);case 2:return cc=vd.yieldResult,Uc=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(cc.filter(function(bd){return bd.endsWith(".js")}).map(function(bd){return{isListItem:!0,string:P&&0==bd.indexOf(P.address)?P.name+bd.slice(P.address.length):bd,value:bd}})),vd.yield(Promise.resolve(hb&&hb.remove()).then(function(){return Y.world().filterableListPrompt("What module to load?",
Uc,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Y},Y?{extent:Y.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Xb=vd.yieldResult;if(!Xb||"canceled"===Xb.status||!Xb.selected.length)throw"Canceled";Db=Xb.selected||Xb;Array.isArray(Db)||(Db=[Db]);return vd.return(Db)}})};Ta._createAndLoadModules=function(Y,Ba){var P,na,Sa,hb,cc,Uc,Xb,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vd){switch(vd.nextAddress){case 1:Array.isArray(Ba)||(Ba=[Ba]),P=[],na=$jscomp.makeIterator(Ba),
Sa=na.next();case 2:if(Sa.done){vd.jumpTo(4);break}hb=Sa.value;return vd.yield(Y.forgetModule(hb,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return vd.yield(Y.resourceEnsureExistance(hb,'"format esm";\n'),6);case 6:return cc=vd.yieldResult,Uc=Ta,Xb=Uc.isTestModule,vd.yield(cc.read(),7);case 7:if(!Xb.call(Uc,vd.yieldResult)){vd.jumpTo(8);break}if(window.Mocha&&window.chai){vd.jumpTo(8);break}return vd.yield(System.import("mocha-es6"),10);case 10:return vd.yield(Ta.promise.waitFor(function(){return!!window.Mocha&&
!!window.chai}),8);case 8:return vd.setCatchFinallyBlocks(12),vd.yield(Y.importModule(hb),14);case 14:P.push({name:hb});vd.leaveTryBlock(3);break;case 12:Db=vd.enterCatchBlock(),P.push({name:hb,error:Db});case 3:Sa=na.next();vd.jumpTo(2);break;case 4:return vd.return(P)}})};Ta.modulesInPackage_defaultExclude=function(Y){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Y.name())?!0:!1};Ta.modulesInPackage=fc;Ta.obj=Ob;Ta.promise=kd;Ta.arr=Ab;Ta.resource=ac;Ta.isTestModule=
lc;Ta.isTestModule=lc;Ta.shortModuleName=rc;Ta.shortModuleName=rc;Ta.interactivelyChangeModule=Kb;Ta.interactivelyChangeModule=Kb;Ta.interactivelyReloadModule=qc;Ta.interactivelyReloadModule=qc;Ta.interactivelyUnloadModule=Hc;Ta.interactivelyUnloadModule=Hc;Ta.interactivelyRemoveModule=ad;Ta.interactivelyRemoveModule=ad;Ta.interactivelyAddModule=dd;Ta.interactivelyAddModule=dd;Ta.modulesInPackage=fc;Ta.modulesInPackage=fc;var Ka=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
Ka.todo=function(Y){throw Error(Y+" is not yet implemented!");};Ka.parseJsonLikeObj=Wd;Ka.arr=Ab;Ka.Closure=Cc;Ka.obj=Ob;Ka.resource=ac;Ka.transform=qd;Ka.modules=Dc;var Fa=function(){};Fa.prototype.dynamicCompletionsForPrefix=function(Y,Ba,P){return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){Ka.todo("dynamicCompletionsForPrefix");na.jumpToEnd()})};Fa.prototype.runEval=function(Y,Ba){Ka.todo("runEval")};Fa.prototype.resourceExists=function(Y){Ka.todo("resourceExists")};Fa.prototype.resourceEnsureExistance=
function(Y,Ba){Ka.todo("resourceEnsureExistance")};Fa.prototype.resourceMkdir=function(Y){Ka.todo("resourceMkdir")};Fa.prototype.resourceRead=function(Y){Ka.todo("resourceRead")};Fa.prototype.resourceRemove=function(Y){Ka.todo("resourceRemove")};Fa.prototype.resourceWrite=function(Y,Ba){Ka.todo("resourceWrite")};Fa.prototype.resourceCreateFiles=function(Y,Ba){Ka.todo("resourceCreateFiles")};Fa.prototype.resourceDirList=function(Y,Ba,P){Ka.todo("resourceDirList")};Fa.prototype.normalizeSync=function(Y,
Ba,P){Ka.todo("normalizeSync")};Fa.prototype.normalize=function(Y,Ba,P){Ka.todo("normalize")};Fa.prototype.printSystemConfig=function(){Ka.todo("printSystemConfig")};Fa.prototype.getConfig=function(){Ka.todo("getConfig")};Fa.prototype.setConfig=function(Y){Ka.todo("setConfig")};Fa.prototype.getPackages=function(Y){Ka.todo("getPackages")};Fa.prototype.isModuleLoaded=function(Y,Ba){Ka.todo("isModuleLoaded")};Fa.prototype.doesModuleExist=function(Y,Ba){Ka.todo("doesModuleExist")};Fa.prototype.getModules=
function(){var Y=this,Ba,P;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){return 1==na.nextAddress?(Ba=Ka.arr,P=Ba.flatmap,na.yield(Y.getPackages(),2)):na.return(P.call(Ba,na.yieldResult,function(Sa){return Sa.modules}))})};Fa.prototype.getModule=function(Y){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){return 1==P.nextAddress?P.yield(Ba.getModules(),2):P.return(P.yieldResult.find(function(na){return na.name===Y}))})};Fa.prototype.getPackage=function(Y){var Ba=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){return 1==P.nextAddress?(Y=Y.replace(/\/+$/,""),P.yield(Ba.getPackages(),2)):P.return(P.yieldResult.find(function(na){return na.address===Y||na.name===Y}))})};Fa.prototype.getPackageForModule=function(Y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){Ka.todo("getPackageForModule");Ba.jumpToEnd()})};Fa.prototype.systemConfChange=function(Y){var Ba=Ka.parseJsonLikeObj(Y);["baseURL"].forEach(function(P){return delete Ba[P]});
return this.setConfig(Ba)};Fa.prototype.resourcesOfPackage=function(Y,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){Ka.todo("resourcesOfPackage");P.jumpToEnd()})};Fa.prototype.registerPackage=function(Y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){Ka.todo("registerPackage");Ba.jumpToEnd()})};Fa.prototype.importPackage=function(Y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){Ka.todo("importPackage");Ba.jumpToEnd()})};Fa.prototype.removePackage=
function(Y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){Ka.todo("removePackage");Ba.jumpToEnd()})};Fa.prototype.reloadPackage=function(Y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){Ka.todo("reloadPackage");Ba.jumpToEnd()})};Fa.prototype.packageConfChange=function(Y,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){Ka.todo("packageConfChange");P.jumpToEnd()})};Fa.prototype.importModule=function(Y){Ka.todo("importModule")};Fa.prototype.forgetModule=
function(Y,Ba){Ka.todo("forgetModule")};Fa.prototype.reloadModule=function(Y,Ba){Ka.todo("reloadModule")};Fa.prototype.moduleFormat=function(Y){Ka.todo("moduleFormat")};Fa.prototype.moduleRead=function(Y){Ka.todo("moduleRead")};Fa.prototype.moduleSourceChange=function(Y,Ba,P){Ka.todo("moduleSourceChange")};Fa.prototype.importsAndExportsOf=function(Y,Ba){Ka.todo("importsAndExportsOf")};Fa.prototype.keyValueListOfVariablesInModule=function(Y,Ba){Ka.todo("keyValueListOfVariablesInModule")};Fa.prototype.moduleWrite=
function(Y,Ba){return this.moduleSourceChange(Y,Ba)};Ka.AbstractCoreInterface=Fa;var Xa=function(){var Y=Ka.AbstractCoreInterface.call(this)||this;Y.currentEval=null;return Y};$jscomp.inherits(Xa,Ka.AbstractCoreInterface);Xa.prototype.runEval=function(Y,Ba){throw Error("Not yet implemented");};Xa.prototype.runEvalAndStringify=function(Y,Ba){var P=this;return this.currentEval?this.currentEval.then(function(){return P.runEvalAndStringify(Y,Ba)}):this.currentEval=Promise.resolve().then(function(){var na,
Sa,hb,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Uc){switch(Uc.nextAddress){case 1:return Uc.yield(P.runEval("\n        Promise.resolve((async "+Ka.transform.wrapInFunction(Y)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},Ba)),2);case 2:if((na=Uc.yieldResult)&&na.isError)throw Error(String(na.value||na.error));if(!na||!na.value)return Uc.return(null);if(Sa=na.promisedValue){Uc.jumpTo(3);break}return Uc.yield(na.value,4);case 4:Sa=Uc.yieldResult;case 3:hb=Sa;if(!hb)return Uc.return();if("undefined"===hb)return Uc.return(void 0);if("null"===hb)return Uc.return(null);if("true"===hb)return Uc.return(!0);
if("false"===hb)return Uc.return(!1);try{cc=JSON.parse(hb)}catch(Xb){return Uc.return(hb)}if(cc&&cc.isError)throw Error(String(cc.value));return Uc.return(cc)}})}).then(function(na){delete P.currentEval;return na},function(na){delete P.currentEval;return Promise.reject(na)})};Xa.prototype.dynamicCompletionsForPrefix=function(Y,Ba,P){var na=this,Sa,hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){Sa=Ka.obj.isString(P.context)?P.context:!1;P=Ka.obj.dissoc(P,["systemInterface","System",
"context"]);hb="\n      var prefix = "+JSON.stringify(Ba)+",\n          opts = "+JSON.stringify(P)+";\n      opts.context = "+Sa+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return cc.return(na.runEvalAndStringify(hb))})};Xa.prototype.evalWithResource=function(Y,Ba,P){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+Y+'").'+Ba+"("+(P?JSON.stringify(P):"")+");\n    ")};Xa.prototype.resourceExists=function(Y){return this.evalWithResource(Y,"exists")};Xa.prototype.resourceEnsureExistance=function(Y,Ba){return this.evalWithResource(Y,
"ensureExistance",Ba)};Xa.prototype.resourceMkdir=function(Y){return this.evalWithResource(Y,"mkdir")};Xa.prototype.resourceRead=function(Y){return this.evalWithResource(Y,"read")};Xa.prototype.resourceRemove=function(Y){return this.evalWithResource(Y,"remove")};Xa.prototype.resourceWrite=function(Y,Ba){return this.evalWithResource(Y,"write",Ba)};Xa.prototype.resourceCreateFiles=function(Y,Ba){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
Y+'", '+JSON.stringify(Ba)+")")};Xa.prototype.resourceDirList=function(Y,Ba,P){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+Y+'").dirList('+JSON.stringify(Ba)+", "+JSON.stringify(P)+"))\n        .map(({url}) => ({url}))")};Xa.prototype.livelySystemAccessor=function(Y){Y=void 0===Y?"livelySystem":Y;return"var "+Y+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
Y+') throw new Error("lively-system-interface not available!");'};Xa.prototype.normalizeSync=function(Y,Ba,P){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(Y)+", "+JSON.stringify(Ba)+", "+P+")")};Xa.prototype.normalize=function(Y,Ba,P){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(Y)+", "+JSON.stringify(Ba)+", "+JSON.stringify(P)+")")};Xa.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
Xa.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};Xa.prototype.setConfig=function(Y){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(Y)+")")};Xa.prototype.getPackages=function(Y){Y=Object.assign({excluded:[]},Y);Y.excluded=Y.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(Y)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};Xa.prototype.getPackageForModule=function(Y){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(Y)+")")};Xa.prototype.isModuleLoaded=function(Y,Ba){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+Y+'", '+Ba+")")};Xa.prototype.doesModuleExist=function(Y,Ba){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+Y+'", '+Ba+")")};Xa.prototype.registerPackage=function(Y){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){return P.return(Ba.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(Y)+")"))})};Xa.prototype.importPackage=
function(Y){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){return P.return(Ba.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(Y)+")"))})};Xa.prototype.removePackage=function(Y){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){return P.return(Ba.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(Y)+")"))})};Xa.prototype.reloadPackage=function(Y,Ba){var P=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){return na.return(P.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(Y)+", "+JSON.stringify(Ba)+")"))})};Xa.prototype.packageConfChange=function(Y,Ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(Y)+", "+JSON.stringify(Ba)+")")};Xa.prototype.resourcesOfPackage=function(Y,Ba){Ba=void 0===Ba?[".git","node_modules",".module_cache","lively.next-node_modules"]:Ba;var P=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){Y.address&&(Y=
Y.address);return na.return(P.runEvalAndStringify("\n      "+P.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(Y)+", "+JSON.stringify(Ba)+");"))})};Xa.prototype.getModule=function(Y){var Ba=this,P;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){if(1==na.nextAddress)return na.yield(Ba.getModules(),2);P=na.yieldResult.find(function(Sa){return Sa.name===Y});return na.return(P?Ka.modules.module(P.name):null)})};Xa.prototype.importModule=
function(Y){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(Y)+")")};Xa.prototype.forgetModule=function(Y,Ba){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Y)+").unload("+JSON.stringify(Ba)+")")};Xa.prototype.reloadModule=function(Y,Ba){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Y)+").reload("+JSON.stringify(Ba)+")")};Xa.prototype.moduleFormat=function(Y){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(Y)+").format();")};Xa.prototype.moduleRead=function(Y){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Y)+").source()")};Xa.prototype.moduleSourceChange=function(Y,Ba,P){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(Y)+").changeSource("+JSON.stringify(Ba)+", "+JSON.stringify(P)+")")};Xa.prototype.keyValueListOfVariablesInModule=function(Y,Ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(Y)+", "+JSON.stringify(Ba)+")")};Xa.prototype.importsAndExportsOf=function(Y,Ba){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(Y)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(Y)+").exports()})")};Xa.prototype.exportsOfModules=function(Y){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(Y)+";\n      options.excludedPackages = ["+Y.excludedPackages.map(function(Ba){return"function"===
typeof Ba?Ba.toString():JSON.stringify(Ba)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};Xa.prototype.searchInPackage=function(Y,Ba,P){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(Y)+", "+JSON.stringify(Ba)+", "+JSON.stringify(P)+")")};Xa.prototype.loadMochaTestFile=function(Y,Ba){Ba=void 0===Ba?[]:Ba;var P=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){return na.return(P.runEvalAndStringify("\n      "+
P.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(Y)+", "+JSON.stringify(Ba)+"), result;\n      result = {testsByFile}"))})};Xa.prototype.runMochaTests=function(Y,Ba,P,na){var Sa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){Y&&Y instanceof RegExp&&(Y={isRegExp:!0,value:String(Y).replace(/^\/|\/$/g,"")});return hb.return(Sa.runEvalAndStringify("\n      var grep = "+JSON.stringify(Y)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Sa.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(Ba||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Ka.RemoteCoreInterface=Xa;var Hb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Hb.obj=Ob;Hb.string=Ic;Hb.arr=Ab;Hb.resource=ac;Hb.createFiles=Qc;Hb.ast=wb;Hb.modules=Dc;Hb.vm=Bd;Hb.parseJsonLikeObj=Wd;Hb.AbstractCoreInterface=Fa;Hb.classToFunctionTransform=ne;Fa=function(){return Hb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(Fa,Hb.AbstractCoreInterface);Fa.prototype.dynamicCompletionsForPrefix=function(Y,Ba,P){var na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){if(1==
Sa.nextAddress)return Sa.yield(Hb.vm.completions.getCompletions(function(hb){return Hb.vm.runEval(hb.replace("return ",""),Object.assign({targetModule:Y,classTransform:Hb.classToFunctionTransform},P))},Ba),2);na=Sa.yieldResult;if(na.isError)throw na.value;return Sa.return({completions:na.completions,prefix:na.startLetters})})};Fa.prototype.runEval=function(Y,Ba){return Hb.vm.runEval(Y,Object.assign({classTransform:Hb.classToFunctionTransform},Ba))};Fa.prototype.resourceExists=function(Y){return Hb.resource(Y).exists()};
Fa.prototype.resourceEnsureExistance=function(Y,Ba){return Hb.resource(Y).ensureExistance(Ba)};Fa.prototype.resourceMkdir=function(Y){return Hb.resource(Y).mkdir()};Fa.prototype.resourceRead=function(Y){return Hb.resource(Y).read()};Fa.prototype.resourceRemove=function(Y){return Hb.resource(Y).remove()};Fa.prototype.resourceWrite=function(Y,Ba){return Hb.resource(Y).write(Ba)};Fa.prototype.resourceCreateFiles=function(Y,Ba){return Hb.createFiles(Y,Ba)};Fa.prototype.resourceDirList=function(Y,Ba,P){return Hb.resource(Y).dirList(Ba,
P)};Fa.prototype.normalizeSync=function(Y,Ba,P){return System.decanonicalize(Y,Ba,P)};Fa.prototype.normalize=function(Y,Ba,P){return System.normalize(Y,Ba,P)};Fa.prototype.printSystemConfig=function(){return Hb.modules.printSystemConfig()};Fa.prototype.getConfig=function(){return System.getConfig()};Fa.prototype.setConfig=function(Y){Hb.modules.System.config(Y)};Fa.prototype.getPackages=function(Y){Y=Object.assign({},Y);Y=void 0===Y.excluded?[]:Y.excluded;var Ba=Y.filter(function(na){return"string"===
typeof na}),P=Y.filter(function(na){return"function"===typeof na});Ba=Ba.concat(Ba.map(function(na){return System.decanonicalize(na.replace(/\/?$/,"/")).replace(/\/$/,"")}));return Hb.modules.getPackages().filter(function(na){return!Ba.includes(na.url)&&!P.some(function(Sa){return Sa(na.url)})})};Fa.prototype.registerPackage=function(Y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(Hb.modules.registerPackage(Y))})};Fa.prototype.importPackage=function(Y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(Hb.modules.importPackage(Y))})};
Fa.prototype.removePackage=function(Y){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(Hb.modules.removePackage(Y))})};Fa.prototype.reloadPackage=function(Y,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(P){return P.return(Hb.modules.reloadPackage(Y,Ba))})};Fa.prototype.packageConfChange=function(Y,Ba){var P=this,na,Sa,hb,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Uc){if(1==Uc.nextAddress)return na=Hb.modules.System,Sa=Hb.parseJsonLikeObj(Y),
hb=JSON.stringify(Sa,null,2),Uc.yield(Hb.modules.module(Ba).changeSource(hb,{doEval:!1}),2);if(3!=Uc.nextAddress)return na.set(Ba,na.newModule(Sa)),Uc.yield(P.getPackageForModule(Ba),3);(cc=Uc.yieldResult)&&Hb.modules.applyPackageConfig(Sa,cc.address);Uc.jumpToEnd()})};Fa.prototype.resourcesOfPackage=function(Y,Ba){Ba=void 0===Ba?[".git","node_modules",".module_cache"]:Ba;var P,na,Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){if(1==hb.nextAddress)return hb.setCatchFinallyBlocks(2),
P=Y.address?Y.address:Y,na=Hb.modules.getPackage(P),hb.yield(na.resources(void 0,Ba),4);if(2!=hb.nextAddress)return hb.return(hb.yieldResult.map(function(cc){return Object.assign(cc,{package:cc.package.url})}));Sa=hb.enterCatchBlock();console.warn("resourcesOfPackage error for "+Y+": "+Sa);return hb.return([])})};Fa.prototype.getPackageForModule=function(Y){return(Y=Hb.modules.getPackageOfModule(Y))?Y.asSpec():Y};Fa.prototype.isModuleLoaded=function(Y,Ba){return Hb.modules.isModuleLoaded(Y,Ba)};Fa.prototype.doesModuleExist=
function(Y,Ba){return Hb.modules.isModuleLoaded(Y,Ba)};Fa.prototype.getModule=function(Y){return Hb.modules.module(Y)};Fa.prototype.importModule=function(Y){return Hb.modules.System.import(Y)};Fa.prototype.forgetModule=function(Y,Ba){return Hb.modules.module(Y).unload(Ba)};Fa.prototype.reloadModule=function(Y,Ba){return Hb.modules.module(Y).reload(Ba)};Fa.prototype.moduleFormat=function(Y){return Hb.modules.module(Y).format()};Fa.prototype.moduleRead=function(Y){return Hb.modules.module(Y).source()};
Fa.prototype.moduleSourceChange=function(Y,Ba,P){return Hb.modules.module(Y).changeSource(Ba,P)};Fa.prototype.keyValueListOfVariablesInModule=function(Y,Ba){var P=this,na,Sa,hb,cc,Uc,Xb,Db,vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bd){switch(bd.nextAddress){case 1:if(Ba){bd.jumpTo(2);break}return bd.yield(P.resourceRead(Y),3);case 3:Ba=bd.yieldResult;case 2:return na="string"===typeof Ba?Hb.ast.parse(Ba):Ba,Sa=P.normalizeSync(Y),P.moduleFormat(Sa),hb=Hb.modules.module(Sa).env().recorder,
bd.yield(P.importsAndExportsOf(Sa,na),4);case 4:return cc=bd.yieldResult,Uc=Hb.ast.query.topLevelDeclsAndRefs(na),Xb=Hb.arr.sortByKey(Hb.ast.query.declarationsOfScope(Uc.scope,!0),"start"),Db=Hb.arr.pluck(Uc.scope.importSpecifiers,"name"),vd=0,bd.return(Xb.map(function(cb){var xb=cb.name.length,Bc=cc.exports.find(function(Ec){return Ec.local===cb.name}),mb=Hb.arr.include(Db,cb.name);Bc&&(xb+=9);mb&&(xb+=9);vd=Math.max(vd,xb);return{isExport:Bc,isImport:mb,name:cb.name,value:hb[cb.name],node:cb,printedName:cb.name+
(Bc?" [export]":"")+(mb?" [import]":""),printedValue:Hb.obj.inspect(hb[cb.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(cb){return{isListItem:!0,value:cb,string:cb.printedName+Hb.string.indent(" = "+cb.printedValue," ",vd-cb.printedName.length)}}))}})};Fa.prototype.importsAndExportsOf=function(Y,Ba){var P;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){return 1==na.nextAddress?na.yield(Hb.modules.module(Y).imports(Ba),2):3!=na.nextAddress?(P=na.yieldResult,na.yield(Hb.modules.module(Y).exports(Ba),
3)):na.return({imports:P,exports:na.yieldResult})})};Fa.prototype.exportsOfModules=function(Y){return Hb.modules.ExportLookup.run(System,Y)};Fa.prototype.searchInPackage=function(Y,Ba,P){return Hb.modules.getPackage(Y).search(Ba,P)};Fa.prototype.runMochaTests=function(Y,Ba,P,na){var Sa,hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){if(1==cc.nextAddress)return cc.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Sa=cc.yieldResult;hb=Sa.runMochaTests;return cc.return(hb(Y,
Ba,P,na))})};Fa.prototype.loadMochaTestFile=function(Y,Ba){var P,na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){if(1==Sa.nextAddress)return Sa.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);P=Sa.yieldResult;na=P.loadMochaTestFile;return Sa.return(na(Y,Ba))})};$jscomp.global.Object.defineProperties(Fa.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});Hb.LocalCoreInterface=Fa;var ic=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");
ic.evalStrategies=ve;ic.RemoteCoreInterface=Xa;var lb=function(Y){var Ba=ic.RemoteCoreInterface.call(this)||this;Ba.currentEval=null;Ba.url=Y;Ba.server=new ic.evalStrategies.HttpEvalStrategy(Y);return Ba};$jscomp.inherits(lb,ic.RemoteCoreInterface);lb.prototype.runEval=function(Y,Ba){return this.server.runEval(Y,Ba)};$jscomp.global.Object.defineProperties(lb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,
"")}}});ic.HTTPCoreInterface=lb;var tb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");tb.evalStrategies=ve;tb.RemoteCoreInterface=Xa;Xa=function(Y,Ba){var P=tb.RemoteCoreInterface.call(this)||this;P.targetId=Y;P.peer=Ba;return P};$jscomp.inherits(Xa,tb.RemoteCoreInterface);Xa.prototype.isConnected=function(){var Y=this,Ba,P,na,Sa,hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){if(1==cc.nextAddress)return Ba=Y,P=Ba.client,na=Ba.targetId,
cc.yield(P.sendToAndWait(P.trackerId,"getClients",{}),2);Sa=cc.yieldResult;hb=Sa.data;return cc.return(hb.some(function(Uc){Uc=$jscomp.makeIterator(Uc).next().value;return na===Uc}))})};Xa.prototype.runEval=function(Y,Ba){var P=this,na,Sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){na=P.client;if(!na)throw Error("No lively.2lively default client available!");Sa=new tb.evalStrategies.L2LEvalStrategy(na,P.targetId);return hb.return(Sa.runEval(Y,Ba))})};$jscomp.global.Object.defineProperties(Xa.prototype,
{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var Y=this.peer,Ba="l2l "+this.targetId.slice(0,5);if(Y){var P=Y.location,na=Y.type,Sa=Y.user;Y=Y.world;na&&(Ba+=", "+na);P&&(Ba+=", "+P.replace(/^https?:\/\//,"")+(Y?"/"+Y:""));Sa&&(Ba+=", "+Sa.name)}return Ba}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});
tb.L2LCoreInterface=Xa;var nb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");nb.systemInterfaceNamed=jb;nb.interactivelyCreatePackage=Tb;nb.interactivelyLoadPackage=wc;nb.interactivelyReloadPackage=od;nb.interactivelyUnloadPackage=Ub;nb.interactivelyRemovePackage=xd;nb.showExportsAndImportsOf=Gd;nb.shortModuleName=rc;nb.interactivelyChangeModule=Kb;nb.interactivelyReloadModule=qc;nb.interactivelyUnloadModule=Hc;nb.interactivelyRemoveModule=ad;nb.interactivelyAddModule=dd;nb.modulesInPackage=
fc;nb.LocalCoreInterface=Fa;nb.HTTPCoreInterface=lb;nb.L2LCoreInterface=Xa;Xa=function(Y){this.coreInterface=Y};Xa.prototype.dynamicCompletionsForPrefix=function(Y,Ba,P){return this.coreInterface.dynamicCompletionsForPrefix(Y,Ba,P)};Xa.prototype.runEval=function(Y,Ba){return this.coreInterface.runEval(Y,Ba)};Xa.prototype.printSystemConfig=function(Y,Ba,P){return this.coreInterface.printSystemConfig(Y,Ba,P)};Xa.prototype.getConfig=function(Y,Ba,P){return this.coreInterface.getConfig(Y,Ba,P)};Xa.prototype.getPackages=
function(Y){return this.coreInterface.getPackages(Y)};Xa.prototype.getModules=function(Y,Ba,P){return this.coreInterface.getModules(Y,Ba,P)};Xa.prototype.getModule=function(Y,Ba,P){return this.coreInterface.getModule(Y,Ba,P)};Xa.prototype.getPackage=function(Y,Ba,P){return this.coreInterface.getPackage(Y,Ba,P)};Xa.prototype.getPackageForModule=function(Y,Ba,P){return this.coreInterface.getPackageForModule(Y,Ba,P)};Xa.prototype.resourcesOfPackage=function(Y,Ba){return this.coreInterface.resourcesOfPackage(Y,
Ba)};Xa.prototype.systemConfChange=function(Y,Ba,P){return this.coreInterface.systemConfChange(Y,Ba,P)};Xa.prototype.registerPackage=function(Y){return this.coreInterface.registerPackage(Y)};Xa.prototype.importPackage=function(Y){return this.coreInterface.importPackage(Y)};Xa.prototype.removePackage=function(Y){return this.coreInterface.removePackage(Y)};Xa.prototype.reloadPackage=function(Y){return this.coreInterface.reloadPackage(Y)};Xa.prototype.packageConfChange=function(Y,Ba){return this.coreInterface.packageConfChange(Y,
Ba)};Xa.prototype.keyValueListOfVariablesInModule=function(Y,Ba){return this.coreInterface.keyValueListOfVariablesInModule(Y,Ba)};Xa.prototype.interactivelyCreatePackage=function(Y){return nb.interactivelyCreatePackage(this.coreInterface,Y)};Xa.prototype.interactivelyLoadPackage=function(Y,Ba){return nb.interactivelyLoadPackage(this.coreInterface,Y,Ba)};Xa.prototype.interactivelyReloadPackage=function(Y,Ba){return nb.interactivelyReloadPackage(this.coreInterface,Y,Ba)};Xa.prototype.interactivelyUnloadPackage=
function(Y,Ba,P){return nb.interactivelyUnloadPackage(this.coreInterface,Y,Ba,P)};Xa.prototype.interactivelyRemovePackage=function(Y,Ba){return nb.interactivelyRemovePackage(this.coreInterface,Y,Ba)};Xa.prototype.isModuleLoaded=function(Y,Ba){return this.coreInterface.isModuleLoaded(Y,Ba)};Xa.prototype.doesModuleExist=function(Y,Ba){return this.coreInterface.doesModuleExist(Y,Ba)};Xa.prototype.importModule=function(Y){return this.coreInterface.importModule(Y)};Xa.prototype.forgetModule=function(Y,
Ba){return this.coreInterface.forgetModule(Y,Ba)};Xa.prototype.reloadModule=function(Y,Ba){return this.coreInterface.reloadModule(Y,Ba)};Xa.prototype.moduleFormat=function(Y){return this.coreInterface.moduleFormat(Y)};Xa.prototype.moduleRead=function(Y){return this.coreInterface.moduleRead(Y)};Xa.prototype.moduleWrite=function(Y,Ba){return this.coreInterface.moduleWrite(Y,Ba)};Xa.prototype.getModulesInPackage=function(Y){return nb.modulesInPackage(this.coreInterface,Y)};Xa.prototype.shortModuleName=
function(Y,Ba){return nb.shortModuleName(this.coreInterface,Y,Ba)};Xa.prototype.interactivelyChangeModule=function(Y,Ba,P){return nb.interactivelyChangeModule(this.coreInterface,Y,Ba,P)};Xa.prototype.interactivelyReloadModule=function(Y,Ba){return nb.interactivelyReloadModule(this.coreInterface,Y,Ba)};Xa.prototype.interactivelyUnloadModule=function(Y,Ba){return nb.interactivelyUnloadModule(this.coreInterface,Y,Ba)};Xa.prototype.interactivelyRemoveModule=function(Y,Ba){return nb.interactivelyRemoveModule(this.coreInterface,
Y,Ba)};Xa.prototype.interactivelyAddModule=function(Y,Ba){return nb.interactivelyAddModule(this.coreInterface,Y,Ba)};Xa.prototype.showExportsAndImportsOf=function(Y,Ba){return nb.showExportsAndImportsOf(this.coreInterface,Y,Ba)};Xa.prototype.exportsOfModules=function(Y){return this.coreInterface.exportsOfModules(Y)};Xa.prototype.searchInPackage=function(Y,Ba,P){return this.coreInterface.searchInPackage(Y,Ba,P)};Xa.prototype.searchInAllPackages=function(Y,Ba){Ba=void 0===Ba?{}:Ba;var P=this,na,Sa,
hb,cc,Uc,Xb,Db,vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bd){switch(bd.nextAddress){case 1:return(na=Ba.progress)&&na.step("Fetching Packages...",0),bd.yield(P.coreInterface.getPackages({excluded:Ba.excludedPackages}),2);case 2:Sa=bd.yieldResult,hb=[],na&&na.step("Fetching Packages...",.1),cc=0;case 3:if(!(cc<Sa.length)){bd.jumpTo(5);break}Uc=Sa[cc];Xb=Uc.url;if(!Xb||"no group"===Xb){bd.jumpTo(4);break}na&&na.step(Xb.replace(System.baseURL,"").slice(0,20),.1+cc/Sa.length*.9);
bd.setCatchFinallyBlocks(6);return bd.yield(P.coreInterface.searchInPackage(Xb,Y,Ba),8);case 8:Db=bd.yieldResult;hb=hb.concat(Db);bd.leaveTryBlock(4);break;case 6:vd=bd.enterCatchBlock(),console.error("Error searching in package "+Xb+":\n"+vd.stack);case 4:cc++;bd.jumpTo(3);break;case 5:return bd.return(hb)}})};Xa.prototype.loadMochaTestFile=function(Y,Ba){return this.coreInterface.loadMochaTestFile(Y,Ba)};Xa.prototype.runMochaTests=function(Y,Ba,P,na){return this.coreInterface.runMochaTests(Y,Ba,
P,na)};$jscomp.global.Object.defineProperties(Xa.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});ya("Interface",Xa);nb.Interface=Xa;nb.systemInterfaceNamed=jb;nb.systemInterfaceNamed=jb;Xa=ya("localInterface",new nb.Interface(new nb.LocalCoreInterface));nb.localInterface=Xa;nb.localInterface=Xa;nb.localInterface=Xa;nb.httpInterfaces={};Xa=ya("serverInterfaceFor",function(Y){return nb.httpInterfaces[Y]||
(nb.httpInterfaces[Y]=new nb.Interface(new nb.HTTPCoreInterface(Y)))});nb.serverInterfaceFor=Xa;nb.serverInterfaceFor=Xa;nb.serverInterfaceFor=Xa;nb.l2lInterfaces={};Xa=ya("l2lInterfaceFor",function(Y,Ba){return nb.l2lInterfaces[Y]||(nb.l2lInterfaces[Y]=new nb.Interface(new nb.L2LCoreInterface(Y,Ba)))});nb.l2lInterfaceFor=Xa;nb.l2lInterfaceFor=Xa;nb.l2lInterfaceFor=Xa}}});