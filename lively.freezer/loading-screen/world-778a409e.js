System.register(["./__root_module__-884b54f8.js","./index-b01a734e.js","./index-9ec474a0.js","./color-picker-efbd7363.js"],function(za){var cb,mb,Pb,tb,Fc,vc,Qc,mc,ic,zc,Dc,Gd,Hd,Zd,xc,od,qb,kc,Uc,tc,cd,td,nb,cc,wc,dc,Nc,$a,Xa,Gb,ub,db,Xb,Fa,sb,Ya,pb,$b,lc,Jb,Cb,Bb,sa,Ta,O,U,ra,xa,pa,ea,bb,Aa,Rb,Gc,Ab,Hc,fb,ud,je,rc,gb,Id,hb,Za,ua,J,la,La,ib,Ib,hc,Vb,Oc,Pc,Yd,r,Rd,ke,le,ge,vd,Td,Ce,Ae;return{setters:[function(ld){cb=ld.S;mb=ld.R;Pb=ld.$;tb=ld.C;Fc=ld.b;vc=ld.a0;Qc=ld.a1;mc=ld.P;ic=ld.a;zc=ld.s;
Dc=ld.Y;Gd=ld.a2;Hd=ld.e;Zd=ld.m;xc=ld.K;od=ld.g;qb=ld.a3;kc=ld.a4;Uc=ld.n;tc=ld.a5;cd=ld.q;td=ld.j;nb=ld.r;cc=ld.a6;wc=ld.o;dc=ld.a7;Nc=ld.a8;$a=ld.a9;Xa=ld.M;Gb=ld.T;ub=ld.aa;db=ld.ab;Xb=ld.W;Fa=ld.I;sb=ld.ac;Ya=ld.c;pb=ld.d;$b=ld.ad;lc=ld.i;Jb=ld.f;Cb=ld.p;Bb=ld.ae;sa=ld.V;Ta=ld.O;O=ld.Q;U=ld.N;ra=ld.t;xa=ld.af;pa=ld.ag;ea=ld.ah;bb=ld.l;Aa=ld.ai;Rb=ld.aj;Gc=ld.ak;Ab=ld.al;Hc=ld.am;fb=ld.an;ud=ld.ao;je=ld.ap;rc=ld.aq;gb=ld.L;Id=ld.ar;hb=ld.h;Za=ld.as;ua=ld.z;J=ld.Z;la=ld.at;La=ld.au},function(ld){ib=
ld.i},function(ld){Ib=ld.s;hc=ld.a;Vb=ld.r;Oc=ld._;Pc=ld.P;Yd=ld.H;r=ld.M;Rd=ld.S;ke=ld.b;le=ld.c;ge=ld.G;vd=ld.F},function(ld){Td=ld.C;Ce=ld.a;Ae=ld.c}],execute:function(){function ld(){}function nf(N,G,wa){var M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return 1==ha.nextAddress?G.startsWith("image/")?ha.yield(gc.fileReadAsDataURL(N),3):ha.jumpTo(2):2!=ha.nextAddress?(M=ha.yieldResult,ha.return(new gc.Image({imageUrl:M,autoResize:!0,name:N.name}))):ha.return(null)})}var gc=
lively.FreezerRuntime.recorderFor("lively.morphic/events/html-drop-handler.js");gc.uploadItem=ld;gc.uploadFile=nf;gc.fileReadAsDataURL=function(N){return new Promise(function(G,wa){wa=new gc.FileReader;wa.onload=function(M){return G(M.target.result)};wa.readAsDataURL(N)})};gc.Image=cb;gc.uploadItem=ld;gc.uploadItem=ld;gc.uploadFile=nf;gc.uploadFile=nf;var id=lively.FreezerRuntime.recorderFor("lively.ide/world-commands.js");id.Rectangle=mb;id.rect=Pb;id.Color=tb;id.pt=Fc;id.tree=vc;id.date=Qc;id.Path=
mc;id.arr=ic;id.string=zc;id.obj=Dc;id.inspect=Gd;id.easings=Hd;id.morph=Zd;id.Text=xc;id.config=od;id.KeyHandler=qb;id.loadObjectFromPartsbinFolder=kc;id.loadPart=Uc;id.interactivelySaveWorld=tc;id.show=Ib;id.showAndSnapToGuides=hc;id.removeSnapToGuidesOf=Vb;id.LoadingIndicator=cd;id.createMorphSnapshot=td;id.interactivelyFreezeWorld=ib;id.resource=nb;id.BrowserModuleTranslationCache=cc;id.CommentBrowser=Oc;id.once=wc;id.commands=[{name:"clear storage and reload",exec:function(){var N,G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wa){if(1==
wa.nextAddress)return wa.yield($world.confirm(["Caution\n",{},"Proceeding will clear all local storage and reload the page! Make sure if you want to save your world before you continue.",{fontSize:15,fontWeight:"normal"}],{width:400}),2);if(N=wa.yieldResult)localStorage.clear(),G=new id.BrowserModuleTranslationCache("2"),G.closeDb(),G.deleteDb(),window.location.reload(!0);wa.jumpToEnd()})}},{name:"undo",exec:function(N){if(N.focusedMorph&&N.focusedMorph!==N&&N.focusedMorph.undoManager)return!1;N.env.undoManager.undo();
return!0}},{name:"redo",exec:function(N){if(N.focusedMorph&&N.focusedMorph!==N&&N.focusedMorph.undoManager)return!1;N.env.undoManager.redo();return!0}},{name:"run command",handlesCount:!0,exec:function(N,G,wa){var M,ha,va,Ua,eb,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){if(1==Tb.nextAddress)return M=N.focusedMorph||N,ha=id.KeyHandler.generateCommandToKeybindingMap(M,!0).map(function(Yb){var yc=Yb.prettyKeys,md=Yb.command.name,Bd=Yb.target.constructor.name;yc=yc?yc.join(", "):
"";return{isListItem:!0,value:Yb,label:[""+Bd,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+md,null],annotation:[yc,{fontSize:"80%",textStyleClasses:["truncated-text"],paddingRight:"5px",maxWidth:140}]}}),Tb.yield(N.filterableListPrompt("Run command",ha,{historyId:"lively.morphic-run command",requester:M,extent:id.pt(700,900),prompt:N._cachedRunCommandPrompt}),2);va=Tb.yieldResult;Ua=va.prompt;eb=$jscomp.makeIterator(va.selected);ob=eb.next().value;N._cachedRunCommandPrompt=
Ua;return Tb.return(ob?ob.target.execCommand(ob.command,G,wa):!0)})}},{name:"show command history",exec:function(N,G){var wa=N.commandHandler;G=id.arr.sortBy(wa.history,function(M){return-M.time}).map(function(M){return{isListItem:!0,string:wa.printCommand(M),value:M}});$world.editListPrompt("select commands",G,{multiSelect:!0,requester:N});return!0}},{name:"show halo for focused morph",exec:function(N){var G=N.focusedMorph;N.showHaloFor(G.getWindow()||G,N.firstHand.pointerId);return!0}},{name:"show morph",
exec:function(N,G){id.show(G.morph,void 0===G.loop?!1:G.loop)}},{name:"show and snap to guides",exec:function(N,G){id.showAndSnapToGuides(G.target,G.showGuides,G.snap)}},{name:"remove snap to guides",exec:function(N,G){id.removeSnapToGuidesOf(G)}},{name:"copy morph",exec:function(N){var G=N.focusedMorph;if(!G||G===N)return $world.setStatusMessage("no morph selected"),!0;N=G.getWindow()||G;G=N.copy();G.openInWorld(N.globalPosition.addXY(10,10));G.isWindow&&G.activate();return G}},{name:"select morph",
exec:function(N,G){G=void 0===G?{root:N,selectionFn:null,justReturn:!1,requester:N,filterFn:null,prependItems:[],prompt:null,remote:!1}:G;var wa,M,ha,va,Ua,eb,ob,Tb,Yb,yc,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bd){if(1==Bd.nextAddress)return wa=0,M=G.filterFn||function(){return!0},ha=G.selectionFn||function(Wc,Sd,Qd){return N.filterableListPrompt(Wc,Sd,Qd)},Bd.yield(System.import("lively.classes/object-classes.js"),2);if(3!=Bd.nextAddress)return va=Bd.yieldResult,Ua=va.default,
eb=id.arr.compact(id.tree.map(G.root||N,function(Wc,Sd){if(!M(Wc))return null;var Qd=!!Ua.lookupPackageForObject(Wc);return{isListItem:!0,label:[""+String(++wa)+"\u2003".repeat(Sd),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+Wc,{fontWeight:Qd?"bolder":"normal",fontStyle:Qd?"normal":"italic",fontFamily:"Inconsolata",fontSize:16},Qd?" [Object Class]":"",{opacity:.5}],value:Wc}},function(Wc){return M(Wc)?Wc.submorphs:[]})),ob=["show halo","open object editor","open object inspector"],
Bd.yield(ha(G.prompt||"Choose morph",(G.prependItems||[]).concat(eb),{historyId:"lively.morphic-select morph",onSelection:function(Wc){(void 0).lastSelectionHalo&&(void 0).lastSelectionHalo.remove();Wc&&Wc.show&&Tb!=Wc&&((void 0).lastSelectionHalo=Wc.show(),Tb=Wc)},selectedAction:"show halo",actions:ob}),3);Yb=Bd.yieldResult;yc=Yb.selected;md=Yb.action;if(G.justReturn)return Bd.return(yc);yc.forEach(function(Wc){md===ob[0]?N.showHaloFor(Wc):md===ob[1]?N.execCommand("open object editor",{target:Wc}):
md===ob[2]&&N.execCommand("open object inspector",{target:Wc})});return Bd.return(yc)})}},{name:"print morph(s)",exec:function(N){var G,wa,M,ha,va,Ua,eb,ob,Tb,Yb,yc,md,Bd,Wc,Sd,Qd,Ed,yd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ue){switch(ue.nextAddress){case 1:G=!1,wa=[];case 2:if(G)return eb=id.LoadingIndicator.open("printing morph..."),ue.yield(System.import("lively.2lively/client.js"),6);M=$jscomp;ha=M.makeIterator;return ue.yield(N.execCommand("select morph",{justReturn:!0}),
4);case 4:return va=ha.call(M,ue.yieldResult),Ua=va.next().value,wa.push(Ua),ue.yield(N.confirm("Select additional morphs?",{rejectLabel:"NO"}),5);case 5:G=!ue.yieldResult;ue.jumpTo(2);break;case 6:return ob=ue.yieldResult,Tb=ob.default,Yb=Tb.default(),ue.yield(Yb.listPeers(!0),7);case 7:return yc=ue.yieldResult,md=yc.find(function(De){return"pdf printer"===De.type}),Bd={ackTimeout:3E4},Wc=Yb,Sd=Wc.sendToAndWait,Qd=md.id,ue.yield(Promise.all(wa.map(function(De){return id.createMorphSnapshot(De,{addPreview:!1,
testLoad:!1})})),9);case 9:return ue.yield(Sd.call(Wc,Qd,"[PDF printer] print",ue.yieldResult,Bd),8);case 8:Ed=ue.yieldResult;if(yd=Ed.error||Ed.data.error)throw N.showError(yd),yd;N.serveFileAsDownload(Ed.data,{fileName:wa[0].name+(1<wa.length?".etc":"")+".pdf",type:"application/pdf"});eb.remove();ue.jumpToEnd()}})}},{name:"escape",exec:function(N,G,wa,M){G=N.env.eventDispatcher.eventState;G.menu&&G.menu.remove();G=N.halos();G.forEach(function(ha){return ha.remove()});N.hands.forEach(function(ha){return ha.cancelGrab(!0,
M)});N=id.arr.last(G)&&id.arr.last(G).target||N.focusedMorph||N;N.focus();N.isText&&N.selection.disableMultiSelect&&N.selection.disableMultiSelect();return!1}},{name:"move or resize halo target",exec:function(N,G){G=void 0===G?{direction:"left",offset:1,what:"move"}:G;var wa=N.halos()[0];if(!wa||wa.changingName||N.focusedMorph!=wa)return!1;var M=G;N=M.direction;G=M.offset;M=M.what;var ha=wa.target;G=G||1;switch(N){case "left":ha["move"===M?"left":"width"]-=G;break;case "right":ha["move"===M?"left":
"width"]+=G;break;case "up":ha["move"===M?"top":"height"]-=G;break;case "down":ha["move"===M?"top":"height"]+=G}wa.alignWithTarget();return!0}},{name:"close halo target",exec:function(N){N=N.halos()[0];if(!N||N.changingName)return!1;N.target.selectedMorphs?N.target.selectedMorphs.forEach(function(G){return G.abandon()}):N.target.abandon();return!0}},{name:"resize manually",exec:function(N,G){G=void 0===G?{}:G;var wa,M,ha,va,Ua,eb,ob,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){switch(Yb.nextAddress){case 1:ha=
N.windowBounds();va=N.bounds();Ua=Number;if(eb=G.width){Yb.jumpTo(2);break}return Yb.yield(N.prompt("Enter world width",{input:Math.max(va.width,ha.width),requester:N}),3);case 3:eb=Yb.yieldResult;case 2:wa=Ua(eb);if("number"!==typeof wa){Yb.jumpTo(4);break}ob=Number;if(Tb=G.height){Yb.jumpTo(5);break}return Yb.yield(N.prompt("Enter world height",{input:Math.max(va.height,ha.height),requester:N}),6);case 6:Tb=Yb.yieldResult;case 5:M=ob(Tb);case 4:return"number"!==typeof wa||isNaN(wa)||"number"!==
typeof M||isNaN(M)||(N.extent=id.pt(wa,M)),Yb.return(!0)}})}},{name:"resize windows to fit visible world bounds",exec:function(N){var G=N.getWindows().filter(function(va){return!va.minimized});if(!G.length)return!0;N=N.visibleBoundsExcludingTopBar();var wa=G.reduce(function(va,Ua){return Ua.bounds().union(va)},new id.Rectangle(0,0,0,0)),M=N.width/wa.width,ha=N.height/wa.height;G.forEach(function(va){var Ua=va.bounds();va.setBounds(new id.Rectangle(Ua.x*M,Ua.y*ha,Ua.width*M,Ua.height*ha))});return!0}},
{name:"window switcher",exec:function(N){var G,wa,M,ha,va,Ua,eb,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){if(1==Tb.nextAddress){if((G=N.activePrompt())&&"lively.morphic-window switcher"===G.historyId)return G.focus(),Tb.return(G.get("list").execCommand("select down"));wa=N.submorphs.filter(function(Yb){return Yb.isWindow}).reverse().map(function(Yb){return{isListItem:!0,string:Yb.title||String(Yb),value:Yb}});wa.forEach(function(Yb){Yb.value.opacity=.5;Yb.value.blur=1});return Tb.yield(N.filterableListPrompt("Choose window",
wa,{preselect:1,requester:N,historyId:"lively.morphic-window switcher",onSelection:function(Yb){M&&(M.minimized=ha,M.blur=1,M.animate({opacity:.3,duration:200}));if(M=Yb)Yb.animate({opacity:1,duration:200}),Yb.blur=0,ha=Yb.minimized,Yb.minimized=!1},width:1*N.visibleBounds().extent().x/3,itemPadding:id.Rectangle.inset(4)}),2)}Ua=va=Tb.yieldResult;eb=$jscomp.makeIterator(Ua.selected);ob=eb.next().value;wa.forEach(function(Yb){Yb.value.opacity=1;Yb.value.blur=0});ob&&(ob.activate(),ob.minimized=!1);
return Tb.return(!0)})}},{name:"close active window or morph",exec:function(N){var G=N.focusedMorph;if(!G)return!0;var wa=G.getWindow();N.undoStart("window close");wa?wa.close():(id.arr.last(id.arr.without(G.ownerChain(),N)).remove(),(wa=N.activeWindow())&&wa.activate());N.undoStop("window close");return!0}},{name:"toggle minimize active window",exec:function(N){(N=N.activeWindow())&&N.toggleMinimize();return!0}},{name:"toggle minimize all windows",exec:function(N){(N=N.getWindows())&&N.map(function(G){return G.toggleMinimize()});
return!0}},{name:"toggle minimize all except active window",exec:function(N){(N=N.getWindows().filter(function(G){return!G.isActive()}))&&N.map(function(G){return G.toggleMinimize()});return!0}},{name:"close all except active window",exec:function(N){(N=N.getWindows().filter(function(G){return!G.isActive()}))&&N.map(function(G){return G.close()});return!0}},{name:"close all windows",exec:function(N){(N=N.getWindows())&&N.map(function(G){return G.close()});return!0}},{name:"open status message of focused morph",
exec:function(N){var G=N.focusedMorph;if(N=$jscomp.makeIterator(G?N.visibleStatusMessagesFor(G):[]).next().value)N.expand(),N.focus();return N||!0}},{name:"resize active window",exec:function(N,G){function wa(){var md,Bd,Wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sd){if(1==Sd.nextAddress)return Sd.yield(N.filterableListPrompt("How to resize the window?","full center right left bottom top reset".split(" "),{requester:N}),2);md=Sd.yieldResult;Bd=$jscomp.makeIterator(md.selected);
Wc=Bd.next().value;return Sd.return(Wc)})}function M(md,Bd){switch(md){case "full":return ob;case "col1":case "left":return yc.withTopLeft(ob.topLeft());case "col2":case "center":return yc.withCenter(ob.center());case "col3":case "right":return yc.translatedBy(id.pt(ob.width-Yb,0));case "top":return ob.divide([id.rect(0,0,1,.5)])[0];case "bottom":return ob.divide([id.rect(0,.5,1,.5)])[0];case "reset":return eb._normalBounds||id.pt(500,400).extentAsRectangle().withCenter(Bd.center());default:return Bd}}
G=void 0===G?{how:null,window:null}:G;var ha,va,Ua,eb,ob,Tb,Yb,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(md){if(1==md.nextAddress){ha=G;va=ha.window;Ua=ha.how;eb=va||N.activeWindow();if(!eb)return md.return();ob=N.visibleBoundsExcludingTopBar().insetBy(15);Tb=eb.bounds();eb._normalBounds||(eb._normalBounds=Tb);Yb=Math.min(700,Math.max(1E3,ob.width/3));yc=ob.withWidth(Yb);return Ua?md.jumpTo(2):md.yield(wa(),3)}2!=md.nextAddress&&(Ua=md.yieldResult);if(!Ua)return md.return();eb.setBounds(M(Ua,
ob));"reset"===Ua&&delete eb._normalBounds;return md.return(!0)})}},{name:"[recovery] show last object editor saves",exec:function(N,G){return N.execCommand("[recovery] show last doits",Object.assign({},G,{title:"logged ObjectEditor save",logAccessFn:function(){return JSON.parse(localStorage["oe helper"]).saves}}))}},{name:"[recovery] show last doits",description:"browse a list of your last doits",exec:function(N,G){G=void 0===G?{}:G;var wa,M,ha,va,Ua,eb,ob,Tb,Yb,yc,md,Bd,Wc,Sd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qd){if(1==
Qd.nextAddress){wa=G;(M=wa.logAccessFn)||(M=function(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])});try{ha=M()}catch(Ed){}if(!ha)return Qd.return(N.inform("no log yet"));va=id.arr.sortBy(ha.map(function(Ed,yd){var ue="string"===typeof Ed?Ed:Ed.source;Ed="string"===typeof Ed?yd:Ed.time||yd;yd=id.date.format(new Date(Ed),"yy-mm-dd HH:MM");return{time:Ed,source:ue,printedTime:yd}}),function(Ed){return-Ed.time});Ua=va.map(function(Ed,yd){return{isListItem:!0,string:"["+Ed.printedTime+
"] "+Ed.source.slice(0,100).replace(/\n/g,"").trim(),value:Ed}});return Qd.yield(N.filterableListPrompt("select doit code",Ua,{multiSelect:!0,requester:N}),2)}eb=Qd.yieldResult;ob=eb.selected;if(ob.length){Tb=[];Yb=$jscomp.makeIterator(ob);for(yc=Yb.next();!yc.done;yc=Yb.next())Bd=md=yc.value,Wc=Bd.source,Sd=Bd.printedTime,Tb.push("// "+Sd+"\n"+Wc);return Qd.return(N.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},G,{content:Tb.join("\n\n")})))}return Qd.return(!0)})}},
{name:"open loading indicator",exec:function(N,G){N={};"object"===typeof G&&(N=G,G=N.label);return id.LoadingIndicator.open(G,N)}},{name:"open workspace",exec:function(N,G,wa,M){G=void 0===G?{}:G;var ha,va,Ua,eb,ob,Tb,Yb,yc,md,Bd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wc){switch(Wc.nextAddress){case 1:if(ha=M&&N.relayCommandExecutionToFocusedMorph(M))return Wc.return(ha);va=G.language||G.mode||"javascript";Ua={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",
html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",css:"lively.ide/css/workspace.js",text:null};eb=Object.keys(id.config.ide.modes.aliases).reduce(function(Sd,Qd){var Ed={};return Object.assign(Sd,(Ed[id.config.ide.modes.aliases[Qd]]=Qd,Ed))},{});if(!G.askForMode){Wc.jumpTo(2);break}ob=Object.keys(Ua).concat("javascript console");return Wc.yield(N.filterableListPrompt("Open workspace for...",ob),3);case 3:if(Tb=Wc.yieldResult,
Yb=$jscomp.makeIterator(Tb.selected),va=Yb.next().value,!va)return Wc.return(!0);case 2:if("javascript console"===va)return Wc.return(N.execCommand("open console",G));G=Object.assign({content:""},G,{mode:va,language:va});yc=Ua[G.language]||Ua[eb[G.language]];return"text"!==va&&yc?Wc.yield(System.import(yc),4):Wc.return(N.execCommand("open text window",Object.assign({},id.config.codeEditor.modes.text,{},G)));case 4:return md=Wc.yieldResult,Bd=md.default,Wc.return((new Bd({title:G.title||G.language+
" workspace",center:N.center,content:G.content,target:G.target,systemInterface:G.systemInterface||G.backend})).activate())}})}},{name:"open console",exec:function(N,G){var wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress)return M.yield(id.loadObjectFromPartsbinFolder("Console"),2);wa=M.yieldResult;return M.return(wa.openInWorldNearHand())})}},{name:"open shell workspace",exec:function(N,G){return N.execCommand("open workspace",Object.assign({},G,{language:"shell"}))}},
{name:"open javascript workspace",exec:function(N,G){return N.execCommand("open workspace",Object.assign({},G,{language:"javascript"}))}},{name:"open shell terminal",exec:function(N,G){var wa,M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){if(1==ha.nextAddress)return ha.yield(System.import("lively.ide/shell/terminal.js"),2);wa=ha.yieldResult;M=wa.default;return ha.return(M.open(G).openInWorldNearHand())})}},{name:"open text window",exec:function(N,G){var wa=G=void 0===G?{}:G,M=wa.title,
ha=wa.extent,va=wa.content,Ua=wa.mode,eb=wa.name;wa=wa.rangesAndStyles;M=M||"text window";va=va||"";ha=ha||id.pt(500,400);eb=eb||"text workspace";va="string"===typeof va?[va,null]:va;G=new id.Text(Object.assign({padding:id.Rectangle.inset(3)},id.obj.dissoc(G,["title","content"]),{textAndAttributes:va,clipMode:"auto",name:eb,extent:ha}));wa&&G.setTextAttributesWithSortedRanges(wa);Ua&&G.changeEditorMode(Ua);return N.openInWindow(G,{title:M}).activate()}},{name:"merge and open in window",exec:function(N,
G){G=void 0===G?{a:"",b:"",format:null,extent:id.pt(500,600)}:G;var wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress)return M.yield(id.loadObjectFromPartsbinFolder("text merger"),2);wa=M.yieldResult;return M.return(wa.targetMorph.open(G.a,G.b,G))})}},{name:"diff and open in window",exec:function(N,G){var wa,M,ha;function va(Bd,Wc,Sd){var Qd,Ed,yd,ue,De,gg,pg,Tf,Le,Pg,tg,Xg,uf,Hf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wd){if(1==Wd.nextAddress){Qd=
Sd;Ed=Qd.format;yd=null;if("patch"!==Ed)return md=yc[Ed](Bd,Wc,Sd),ue=id.arr.flatmap(md,function(wh){var vb=wh.added;return[wh.value,wh.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:id.Color.red}:vb?{fontWeight:"bold",textDecoration:"",fontColor:id.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:id.Color.darkGray}]}),Wd.jumpTo(2);De=Sd;gg=De.headerA;pg=De.headerB;Tf=De.filenameA;Le=De.filenameB;Pg=De.context;ue=[yc.createTwoFilesPatch(Tf||"a",Le||"b",Bd,Wc,gg,
pg,"number"===typeof Pg?{context:Pg}:void 0),{}];return Wd.yield(System.import("lively.ide/diff/editor-plugin.js"),3)}2!=Wd.nextAddress&&(tg=Wd.yieldResult,Xg=tg.default,yd=new Xg);uf=N.execCommand("open text window",Sd);Hf=uf.targetMorph;uf.extent=Yb||id.pt(300,200).maxPt(Hf.textBounds().extent());Hf.textAndAttributes=ue;yd&&Hf.addPlugin(yd);return Wd.return(Hf)})}G=void 0===G?{a:"",b:"",format:null,extent:id.pt(500,600)}:G;var Ua,eb,ob,Tb,Yb,yc,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bd){if(1==
Bd.nextAddress){Ua=G;eb=Ua.a;ob=Ua.b;Tb=Ua.format;Yb=Ua.extent;if(Tb)eb=String(eb),ob=String(ob);else{a:{var Wc=eb,Sd=ob;if(id.obj.isPrimitive(Wc)||Wc instanceof RegExp||id.obj.isPrimitive(Sd)||Sd instanceof RegExp)Wc=String(Wc),Sd=String(Sd);if("string"!==typeof Wc||"string"!==typeof Sd)try{JSON.stringify(Wc);JSON.stringify(Sd);wa="diffJson";M=Wc;ha=Sd;break a}catch(Qd){Wc=String(Wc),Sd=String(Sd)}wa="diffLines";M=Wc;ha=Sd}eb=M;ob=ha;Tb=wa}return Bd.yield(System.import("https://jspm.dev/diff"),2)}if(3!=
Bd.nextAddress)return yc=Bd.yieldResult,Bd.yield(va(eb,ob,Object.assign({fontFamily:"monospace"},G,{format:Tb})),3);md=Bd.yieldResult;return Bd.return(md)})}},{name:"merge workspaces",exec:function(N,G){return N.execCommand("diff workspace",Object.assign({},G,{merge:!0}))}},{name:"diff workspaces",exec:function(N,G){function wa(Yb,yc){var md=Yb.pluginFind(function(Wc){return Wc.evalEnvironment});md=md&&md.evalEnvironment.targetModule||"no file";var Bd=yc.pluginFind(function(Wc){return Wc.evalEnvironment});
return N.execCommand("diff and open in window",{a:Yb.textString,b:yc.textString,filenameA:md,filenameB:Bd&&Bd.evalEnvironment.targetModule||"no file"})}function M(Yb,yc){var md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bd){if(1==Bd.nextAddress)return Bd.yield(id.loadObjectFromPartsbinFolder("text merger"),2);md=Bd.yieldResult;return Bd.return(md.targetMorph.open(Yb.textString,yc.textString))})}function ha(Yb,yc){var md,Bd,Wc,Sd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qd){if(1==
Qd.nextAddress)return md=Yb.map(function(Ed){return{isListItem:!0,value:Ed,string:Ed.name||String(Ed)}}),Qd.yield(N.filterableListPrompt("choose text: ",md,{onSelection:function(Ed){debugger;Ed&&Ed.show()}}),2);Bd=Qd.yieldResult;Wc=$jscomp.makeIterator(Bd.selected);Sd=Wc.next().value;return Qd.return(Sd)})}G=void 0===G?{}:G;var va,Ua,eb,ob,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){switch(Yb.nextAddress){case 1:va=G;Ua=va.editor1;eb=va.editor2;ob=va.merge;Ua&&eb||(Tb=N.withAllSubmorphsSelect(function(yc){return yc.isText&&
!yc.isInputLine&&!yc.isUsedAsEpiMorph()}).reverse());if(Ua){Yb.jumpTo(2);break}return Yb.yield(ha(Tb),3);case 3:Ua=Yb.yieldResult;case 2:if(!Ua)return Yb.return(N.setStatusMessage("Canceled"));if(eb){Yb.jumpTo(4);break}return Yb.yield(ha(id.arr.without(Tb,Ua)),5);case 5:eb=Yb.yieldResult;case 4:return eb?Yb.return(ob?M(Ua,eb):wa(Ua,eb)):Yb.return(N.setStatusMessage("Canceled"))}})}},{name:"search workspaces",exec:function(){function N(Yb,yc){return Yb.map(function(md){var Bd=md.world()?md.getWindow():
$world.withAllSubmorphsDetect(function(Ed){return Ed.isWindow&&Ed.targetMorph===Zd}),Wc=0,Sd=id.string.lines(md.textString).find(function(Ed,yd){Ed=Ed.toLowerCase();Wc=yd;return yc.every(function(ue){return Ed.includes(ue)})}),Qd=Bd?Bd.title:md.toString();return Sd?{isListItem:!0,string:Qd+" | "+Sd,value:{window:Bd,morph:md,row:Wc}}:null}).filter(Boolean)}function G(Yb){return $world.withAllSubmorphsDo(function(yc){yc.isWindow&&yc.minimized&&yc.targetMorph&&yc.targetMorph.isText&&(yc=yc.targetMorph);
if(!yc.textString||!yc.isText||yc.isUsedAsEpiMorph())return null;var md=yc.textString.toLowerCase();return Yb.every(function(Bd){return md.includes(Bd)})?yc:null}).filter(Boolean)}var wa=this,M,ha,va,Ua,eb,ob,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){if(1==Yb.nextAddress)return Yb.yield($world.filterableListPrompt("search workspaces",[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function(yc){yc.getSubmorphNamed("list").updateFilter=function(){var md=
this.parseInput();if(!(3>md.input.length)){var Bd=G(md.lowercasedTokens);this.listMorph.items=N(Bd,md.lowercasedTokens)}}}}),2);M=Yb.yieldResult;ha=$jscomp.makeIterator(M.selected);return(va=ha.next().value)?(Ua=va,eb=Ua.morph,ob=Ua.window,Tb=Ua.row,ob&&(ob.minimized&&ob.toggleMinimize(),ob.activate()),(ob||eb).show(),wa.cursorPosition={row:Tb,column:0},Yb.return(eb)):Yb.return(null)})}},{name:"open PartsBin",exec:function(N){var G,wa,M,ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==
va.nextAddress)return G=id.LoadingIndicator.open("Loading Partsbin..."),va.yield(System.import("lively.morphic/partsbin.js"),2);if(3!=va.nextAddress)return wa=va.yieldResult,M=wa.loadPart,va.yield(M("PartsBin"),3);ha=va.yieldResult;ha.openInWorldNearHand();ha.targetMorph.selectedCategory="*basics*";ha.focus();G.remove();ha.getWindow().activate();return va.return(ha)})}},{name:"browse and load component",exec:function(N){var G,wa,M,ha,va,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:G=
id.LoadingIndicator.open("loading component browser");if(N._componentsBrowser){eb.jumpTo(2);break}return eb.yield(G.whenRendered(),2);case 2:if(wa=N._componentsBrowser){eb.jumpTo(4);break}ha=M=N;return eb.yield(id.resource("part://SystemDialogs/master component browser").read(),5);case 5:wa=ha._componentsBrowser=eb.yieldResult;case 4:return va=wa,G.remove(),eb.yield(va.activate(),6);case 6:(Ua=eb.yieldResult)&&!Ua.world()&&Ua.openInWorld(),eb.jumpToEnd()}})}},{name:"load object from PartsBin",exec:function(N,
G){G=void 0===G?{}:G;var wa,M,ha,va,Ua,eb,ob,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){switch(Yb.nextAddress){case 1:return M=G,ha=M.name,va=void 0===M.open?!0:M.open,ha?Yb.yield(System.import("lively.morphic/partsbin.js"),6):Yb.yield(System.import("lively.morphic/partsbin.js"),4);case 4:return Ua=Yb.yieldResult,eb=Ua.interactivelyLoadObjectFromPartsBinFolder,Yb.yield(eb(),5);case 5:wa=Yb.yieldResult;Yb.jumpTo(3);break;case 6:return ob=Yb.yieldResult,Tb=ob.loadObjectFromPartsbinFolder,
Yb.yield(Tb(ha),7);case 7:wa=Yb.yieldResult;case 3:return wa&&va&&wa.openInWorldNearHand(),Yb.return(wa)}})}},{name:"open object drawer",exec:function(N){var G,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress)return M.yield(System.import("lively.components/object-drawer.js"),2);G=M.yieldResult;wa=G.default;return M.return((new wa).openInWorldNearHand())})}},{name:"open object editor",exec:function(N,G){G=void 0===G?{target:null,selectedClass:null,selectedMethod:null,
evalEnvironment:null}:G;var wa,M,ha,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress){if(!G.target)return N.setStatusMessage("No target for ObjectEditor"),Ua.return(null);wa=G.loadingIndicator=id.LoadingIndicator.open("Open Object Editor...");return Ua.yield(System.import("lively.ide/js/objecteditor/index.js"),2)}if(3!=Ua.nextAddress)return M=Ua.yieldResult,ha=M.ObjectEditor,Ua.yield(ha.open(G),3);va=Ua.yieldResult;wa.remove();return Ua.return(va)})}},{name:"open object inspector",
exec:function(N,G){G=void 0===G?{target:null}:G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wa){return G.target?wa.return(id.inspect(G.target)):(N.setStatusMessage("no target for Inspector"),wa.return(null))})}},{name:"inspect server",exec:function(N){var G,wa,M,ha,va,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return eb.yield(System.import("lively.ide/js/inspector.js"),2);case 2:return G=eb.yieldResult,wa=G.default,eb.yield(System.import("lively-system-interface"),
3);case 3:return M=eb.yieldResult,ha=M.serverInterfaceFor,va=ha(System.baseURL+"eval"),Ua={format:"esm",context:"global",targetModule:"lively://lively.next-workspace/world",sourceURL:"inspect-server_"+Date.now(),systemInterface:va},eb.yield(va.runEval('\n           import LivelyServer from "lively.server/server.js";\n           let server = LivelyServer.servers.values().next().value;\n        ',Ua),4);case 4:wa.openInWindow({remoteTarget:{code:"server",evalEnvironment:Ua}}),eb.jumpToEnd()}})}},{name:"open scene graph inspector",
exec:function(N,G){G=void 0===G?{target:null}:G;var wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress)return M.yield(id.loadObjectFromPartsbinFolder("scene graph inspector"),2);wa=M.yieldResult;wa.targetMorph=G.target||N;return M.return(wa.openInWindow({title:"morph graph"}))})}},{name:"open browser",progressIndicator:"opening browser...",exec:function(N,G,wa,M){G=void 0===G?{packageName:"lively.morphic",moduleName:"morph.js"}:G;var ha,va,Ua,eb,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){if(1==
Tb.nextAddress)return(ha=M&&N.relayCommandExecutionToFocusedMorph(M))?Tb.return(ha):Tb.yield(System.import("lively.ide/js/browser/index.js"),2);if(3!=Tb.nextAddress)return va=Tb.yieldResult,Ua=va.default,eb=id.obj.select(G,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),Tb.yield(Ua.browse(eb,{extent:id.pt(700,600)}),3);ob=Tb.yieldResult;ob.getWindow().activate();return Tb.return(ob)})}},{name:"choose and browse package resources",progressIndicator:"browsing resources...",
exec:function(N,G,wa,M){G=void 0===G?{browser:null,systemInterface:null}:G;var ha,va,Ua,eb,ob,Tb,Yb,yc,md,Bd,Wc,Sd,Qd,Ed,yd,ue,De,gg,pg,Tf,Le,Pg,tg,Xg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(uf){switch(uf.nextAddress){case 1:if(ha=M&&N.relayCommandExecutionToFocusedMorph(M))return uf.return(ha);va=(va=G.browser||N.focusedMorph&&N.focusedMorph.ownerChain().find(function(Hf){return Hf.isBrowser}))&&va.isBrowser?va.getWindow():null;return uf.yield(System.import("lively-system-interface"),
2);case 2:return Ua=uf.yieldResult,eb=Ua.localInterface,ob=G&&G.systemInterface?G.systemInterface:va?va.systemInterface:eb,uf.yield(ob.getPackages({excluded:id.config.ide.js.ignoredPackages}),3);case 3:Tb=uf.yieldResult,Yb=[],yc={},md=$jscomp.makeIterator(Tb),Bd=md.next();case 4:if(Bd.done)return uf.yield(N.filterableListPrompt("Choose module to open",Yb,{historyId:"lively.morphic-choose and browse package resources",requester:va,width:700,multiSelect:!0,fuzzy:"value.shortName"}),8);yc.$jscomp$loop$prop$p$2710=
Bd.value;yc.$jscomp$loop$prop$excluded$2709=(id.Path("lively.ide.exclude").get(yc.$jscomp$loop$prop$p$2710)||[]).map(function(Hf){return Hf.includes("*")?new RegExp(Hf.replace(/\*/g,".*")):Hf});yc.$jscomp$loop$prop$excluded$2709.push(".git","node_modules",".module_cache");Wc=Yb.push;Sd=Wc.apply;Qd=Yb;Ed=$jscomp;yd=Ed.arrayFromIterable;ue=function(Hf){return function(Wd){return{isListItem:!0,string:"["+Hf.$jscomp$loop$prop$p$2710.name+"] "+Wd.nameInPackage+(Wd.isLoaded?"":" [not loaded]"),value:Wd}}}(yc);
De=function(Hf){return function(Wd){var wh=Wd.url;return!wh.endsWith("/")&&!Hf.$jscomp$loop$prop$excluded$2709.some(function(vb){return vb instanceof RegExp?vb.test(wh):wh.includes(vb)})}}(yc);return uf.yield(ob.resourcesOfPackage(yc.$jscomp$loop$prop$p$2710,yc.$jscomp$loop$prop$excluded$2709),7);case 7:Sd.call(Wc,Qd,yd.call(Ed,uf.yieldResult.filter(De).sort(function(Hf,Wd){return Hf.isLoaded&&!Wd.isLoaded?-1:!Hf.isLoaded&&Wd.isLoaded?1:Hf.nameInPackage.toLowerCase()<Wd.nameInPackage.toLowerCase()?
-1:Hf.nameInPackage.toLowerCase()==Wd.nameInPackage.toLowerCase()?0:1}).map(ue)));yc={$jscomp$loop$prop$excluded$2709:yc.$jscomp$loop$prop$excluded$2709,$jscomp$loop$prop$p$2710:yc.$jscomp$loop$prop$p$2710};Bd=md.next();uf.jumpTo(4);break;case 8:return gg=uf.yieldResult,pg=gg.selected,Tf=$jscomp.makeIterator(id.arr.partition(pg,function(Hf){return Hf.url.match(/\.js(on)?/)})),Le=Tf.next().value,Pg=Tf.next().value,uf.yield(System.import("lively.ide/js/browser/index.js"),9);case 9:return tg=uf.yieldResult,
Xg=tg.default,uf.yield(Promise.all(Le.map(function(Hf){return Xg.browse({packageName:Hf.package,moduleName:Hf.url},va,ob).then(function(Wd){return Wd.activate()})})),10);case 10:if(!Pg.length){uf.jumpTo(11);break}return uf.yield(Promise.all(Pg.map(function(Hf){return N.execCommand("open file",{url:Hf.url})})),11);case 11:return uf.return(!0)}})}},{name:"choose and browse module",progressIndicator:"browsing module...",handlesCount:!0,exec:function(N,G,wa){G=void 0===G?{browser:void 0,systemInterface:void 0}:
G;var M,ha,va,Ua,eb,ob,Tb,Yb,yc,md,Bd,Wc,Sd,Qd,Ed,yd,ue,De,gg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pg){switch(pg.nextAddress){case 1:if(!G.browser&&(ha=(M=N.focusedMorph)&&M.getWindow())&&ha.targetMorph&&ha.targetMorph.isFileBrowser)return pg.return(ha.targetMorph.execCommand("find file and select",G,wa));va=G.browser||M&&M.ownerChain().find(function(Tf){return Tf.isBrowser});return pg.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return Ua=pg.yieldResult,
eb=Ua.default,pg.yield(System.import("lively-system-interface"),3);case 3:return ob=pg.yieldResult,Tb=ob.localInterface,Yb=G&&G.systemInterface?G.systemInterface:va?va.systemInterface:Tb,yc="local"==Yb.name?"":" on ["+id.string.truncate(Yb.name,35,"...")+"]",pg.yield(Yb.getPackages(),4);case 4:md=pg.yieldResult;Bd=[];Wc=$jscomp.makeIterator(md);for(Sd=Wc.next();!Sd.done;Sd=Wc.next())for(Qd=Sd.value,Ed=id.Path("lively.ide.exclude").get(Qd)||[],Ed=Ed.map(function(Tf){return Tf.includes("*")?new RegExp(Tf.replace(/\*/g,
".*")):Tf}),yd={},ue=$jscomp.makeIterator(Qd.modules),De=ue.next();!De.done;yd={$jscomp$loop$prop$m$2712:yd.$jscomp$loop$prop$m$2712},De=ue.next())yd.$jscomp$loop$prop$m$2712=De.value,Ed.some(function(Tf){return function(Le){return Le instanceof RegExp?Le.test(Tf.$jscomp$loop$prop$m$2712.name):Tf.$jscomp$loop$prop$m$2712.name.includes(Le)}}(yd))||(gg=Yb.shortModuleName(yd.$jscomp$loop$prop$m$2712.name,Qd),Bd.push({isListItem:!0,string:"["+Qd.name+"] "+gg,value:{package:Qd,module:yd.$jscomp$loop$prop$m$2712,
shortName:gg}}));Bd=id.arr.sortBy(Bd,function(Tf){return Tf.string});(function(){var Tf,Le,Pg,tg,Xg,uf,Hf,Wd,wh;return $jscomp.asyncExecutePromiseGeneratorProgram(function(vb){switch(vb.nextAddress){case 1:return Tf=va||M,vb.yield(N.filterableListPrompt("Choose module to open"+yc,Bd,{historyId:"lively.morphic-choose and browse module",requester:Tf,height:Math.min(Tf.height,700),width:500,multiSelect:!0,listFontColor:"white",fuzzy:"value.shortName"}),2);case 2:Le=vb.yieldResult,Pg=Le.selected,tg=0;
case 3:if(!(tg<Pg.length)){vb.jumpTo(0);break}Xg=Pg[tg];uf=Xg.package;Hf=Xg.shortName;Wd={packageName:uf.name,moduleName:Hf};return vb.yield(eb.browse(Wd,0===tg?va:void 0,Yb),6);case 6:wh=vb.yieldResult,wh.moveBy(id.pt(20*tg,20*tg)),wh.getWindow().activate(),tg++,vb.jumpTo(3)}})})();return pg.return(!0)}})}},{name:"open code search",progressIndicator:"opening code search...",exec:function(N,G){G=void 0===G?{browser:null,systemInterface:null,input:null}:G;var wa,M,ha,va,Ua,eb,ob,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){if(1==
Yb.nextAddress){wa=N.focusedMorph?N.focusedMorph.ownerChain():[];M=G.browser||wa.find(function(yc){return yc.isBrowser});ha=id.LoadingIndicator.open("loading code search");if(M&&M.isBrowser){if(M.state.associatedSearchPanel)return Yb.return(M.state.associatedSearchPanel.getWindow().activate())}else M=null;return Yb.yield(System.import("lively-system-interface"),2)}if(3!=Yb.nextAddress)return va=Yb.yieldResult,Ua=va.localInterface,eb=G.systemInterface||M&&M.systemInterface,eb||(eb=(ob=wa.find(function(yc){return yc.isText&&
yc.editorPlugin&&yc.editorPlugin.isJSEditorPlugin}))?ob.editorPlugin.systemInterface():Ua),Yb.yield(id.resource("part://SystemIDE/code search").read(),3);Tb=Yb.yieldResult;Object.assign(Tb,{browser:M,input:G.input,systemInterface:eb});Tb.openInWindow();Tb.focus();ha.remove();M&&(M.state.associatedSearchPanel=Tb);return Yb.return(Tb)})}},{name:"open grep search",progressIndicator:"opening code search...",exec:function(N,G){var wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==
M.nextAddress)return M.yield(id.loadObjectFromPartsbinFolder("grep search"),2);wa=M.yieldResult;return M.return(wa.openInWorldNearHand(N).activate())})}},{name:"open test runner",progressIndicator:"opening test runner...",exec:function(N){var G,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return 1==M.nextAddress?M.yield(System.import("lively.ide/test-runner.js"),2):3!=M.nextAddress?(G=M.yieldResult,wa=G.default,M.yield(wa.open(),3)):M.return(M.yieldResult)})}},{name:"open file browser",
progressIndicator:"opening file browser...",exec:function(N,G){G=void 0===G?{}:G;var wa,M,ha,va,Ua,eb,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){if(1==Tb.nextAddress)return Tb.yield(System.import("lively.ide/http-file-browser.js"),2);wa=Tb.yieldResult;M=wa.default;ha=G;va=ha.location;Ua=ha.url;ob=(eb=ha.file)?M.forFile(eb,va):M.forLocation(Ua||va||document.location.origin);return Tb.return(N.openInWindow(ob).activate())})}},{name:"open file",progressIndicator:"opening file...",
exec:function(N,G){G=void 0===G?{url:null,lineNumber:null,reuse:!1}:G;var wa,M,ha,va,Ua,eb,ob,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){switch(Yb.nextAddress){case 1:wa=G;M=wa.url;ha=wa.lineNumber;va=wa.reuse;Ua=N.commandHandler.progressIndicator;if(M){Yb.jumpTo(2);break}Ua.visible=!1;debugger;return Yb.yield(N.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0}),3);case 3:M=Yb.yieldResult,Ua.visible=!0;case 2:if(va&&(N.getWindows().slice(-2),
eb=id.arr.findAndGet(N.getWindows(),function(yc){return(yc=yc.targetMorph)&&yc.isTextEditor&&yc.location.split(":")[0]===M?yc:null})))return"number"===typeof ha&&(eb.lineNumber=ha),Yb.return(eb.getWindow().activate());ha&&(M+=":"+ha);return Yb.yield(System.import("lively.ide/text-editor.js"),4);case 4:return ob=Yb.yieldResult,Tb=ob.default,Yb.return(M?Tb.openURL(M,id.obj.dissoc(G,["url"])):null)}})}},{name:"open file for EDITOR",exec:function(N,G){G=void 0===G?{url:null,lineNumber:null}:G;var wa,
M,ha,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){return 1==Ua.nextAddress?Ua.yield(System.import("lively.ide/text-editor.js"),2):3!=Ua.nextAddress?(wa=Ua.yieldResult,M=wa.default,ha=G,va=ha.url,Ua.yield(M.openAsEDITOR(va,{}),3)):Ua.return(Ua.yieldResult)})}},{name:"open subserver controller",exec:function(N,G){var wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){if(1==M.nextAddress)return M.yield(id.loadPart("subserver controller"),2);wa=M.yieldResult;return M.return(wa.openInWorld())})}},
{name:"[lively.installer] publish new version of a package",exec:function(N){var G,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){switch(M.nextAddress){case 1:return M.yield(lively.modules.registerPackage(document.location.origin+"/lively.installer"),2);case 2:return M.yield(System.import("lively.installer/packages/publish-new-package-version.js"),3);case 3:return G=M.yieldResult,wa=G.default,M.yield(wa(),4);case 4:return M.return(!0)}})}},{name:"report a bug",exec:function(N){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){window.open("https://github.com/LivelyKernel/lively.next/issues/new",
"_blank");return G.return(!0)})}},{name:"fix font metric",exec:function(N){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){N.env.fontMetric.reset();N.withAllSubmorphsDo(function(wa){return wa.isText&&wa.textLayout&&wa.textLayout.reset()});return G.return(!0)})}},{name:"delete change history",exec:function(N){var G=N.env,wa=G.printStatus();G.deleteHistory();N.setStatusMessage(wa);N._componentsBrowser&&N._componentsBrowser.reset();return!0}},{name:"install global inspect and show",exec:function(N){window.show=
id.show;window.inspect=id.inspect;N.setStatusMessage("inspect() and show() are now globally available");return!0}},{name:"save world",exec:function(N,G,wa,M){var ha,va,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){if(1==eb.nextAddress){if(ha=M&&N.relayCommandExecutionToFocusedMorph(M))return eb.return(ha);G=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},G);va=N.focusedMorph;return eb.yield(id.interactivelySaveWorld(N,G),2)}Ua=eb.yieldResult;va&&va.focus();return eb.return(Ua)})}},
{name:"freeze world",exec:function(N){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){return G.yield(id.interactivelyFreezeWorld(N),0)})}},{name:"save this world",exec:function(N,G,wa,M){return N.execCommand("save world",Object.assign({confirmOverwrite:!0},G,{showSaveDialog:!1}))}},{name:"load world",exec:function(N,G){G=void 0===G?{}:G;var wa,M,ha,va,Ua,eb,ob,Tb,Yb,yc,md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bd){switch(Bd.nextAddress){case 1:wa=G;M=wa.id;ha=wa.commit;
va=wa.name;Ua=wa.ref;eb=wa.world;ob=N.constructor;if(eb)return Bd.return(ob.loadWorld(eb,N));if(M||ha)return Bd.return(ob.loadFromCommit(M||ha,N));if(va)return Bd.return(ob.loadFromDB(va,Ua,N));Tb=id.LoadingIndicator.open("loading project browser...");return Bd.yield(Tb.whenRendered(),2);case 2:Yb=id.morph({fill:id.Color.black.withA(.5),extent:N.extent,name:"dark overlay",opacity:0,reactsToPointer:!1,renderOnGPU:!0,halosEnabled:!1});Yb.openInWorld(id.pt(0,0));Yb.animate({opacity:1,duration:300});
if(yc=N.get("a project browser")){Bd.jumpTo(3);break}return Bd.yield(id.resource("part://partial freezing/project browser").read(),4);case 4:yc=Bd.yieldResult;case 3:return md=yc,md.name="a project browser",md.hasFixedPosition=!0,md.epiMorph=!0,md.bringToFront().alignInWorld(N),md.update(),md.focus(),id.once(md,"remove",function(){return Yb.animate({opacity:0}).then(function(){return Yb.remove()})}),Tb.remove(),Bd.return(md)}})}},{name:"add external package dependency to object",exec:function(N,G){G=
void 0===G?{}:G;var wa,M,ha,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress)return wa=G.target||N,M=wa.metadata&&wa.metadata.externalPackages||[],Ua.yield(N.editListPrompt("modify package dependencies of "+wa,M),2);ha=Ua.yieldResult;va=ha.list;if(!va)return Ua.return();va.length?(wa.metadata||(wa.metadata={}),wa.metadata.externalPackages=va):wa.metadata&&delete wa.metadata.externalPackages;return Ua.return(!0)})}},{name:"toggle comment browser",exec:function(N){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){id.CommentBrowser.toggle();
G.jumpToEnd()})}}];var fe=id.commands;id.default=fe;var Ec=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js");Ec.RadialGradient=dc;Ec.Point=Nc;Ec.pt=Fc;Ec.rect=Pb;Ec.Color=tb;Ec.LinearGradient=$a;Ec.Morph=Xa;Ec.Tooltip=Gb;Ec.Image=cb;Ec.VerticalLayout=ub;Ec.GridLayout=db;Ec.Text=xc;Ec.Ellipse=Xb;Ec.morph=Zd;Ec.Icon=Fa;Ec.num=sb;Ec.arr=ic;Ec.connect=Ya;Ec.signal=pb;Ec.Popover=Pc;Ec.ColorPalette=Td;Ec.ColorPicker=Ce;Ec.colorWidgets=Ae;Ec.joinPath=$b;Ec.WHEEL_URL=Ec.joinPath(System.baseURL,
"/lively.ide/assets/color-wheel.png");(function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),wa=G.hasOwnProperty("GradientTypeSelector")&&"function"===typeof G.GradientTypeSelector?G.GradientTypeSelector:G.GradientTypeSelector=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,N,[{key:"defaultLinearGradient",get:function(){return new Ec.LinearGradient({stops:[{color:Ec.Color.white,
offset:0},{color:Ec.Color.black,offset:1}]})}},{key:"defaultRadialGradient",get:function(){return new Ec.RadialGradient({stops:[{color:Ec.Color.white,offset:0},{color:Ec.Color.black,offset:1}],focus:Ec.pt(.5,.5),bounds:Ec.rect(0,0,30,30)})}},{key:"update",value:function(M){var ha=$jscomp.makeIterator(this.submorphs),va=ha.next().value;ha=ha.next().value;va.borderColor=ha.borderColor=Ec.Color.gray.darker();M instanceof Ec.RadialGradient?va.borderColor=Ec.Color.orange:M instanceof Ec.LinearGradient&&
(ha.borderColor=Ec.Color.orange)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientTypeSelector"}},{key:"properties",get:function(){return{fill:{defaultValue:Ec.Color.transparent},layout:{initialize:function(){this.extent=Ec.pt(180,40);this.layout=new Ec.GridLayout({grid:[[null,"radialMode",null,"linearMode",null]],autoAssign:!1,fitToCell:!1})}},submorphs:{initialize:function(){var M=this,ha=$jscomp.makeIterator(this.submorphs=[Ec.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},
name:"radialMode",fill:this.defaultRadialGradient}),Ec.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"linearMode",fill:this.defaultLinearGradient})]),va=ha.next().value;ha=ha.next().value;Ec.connect(va,"onMouseDown",function(){return Ec.signal(M,"radial")});Ec.connect(ha,"onMouseDown",function(){return Ec.signal(M,"linear")})}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:660,end:2566})})(Ec.Morph);var pe=function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),wa=G.hasOwnProperty("GradientEditor")&&"function"===typeof G.GradientEditor?G.GradientEditor:G.GradientEditor=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};
return lc(wa,N,[{key:"remove",value:function(){lc._get(Object.getPrototypeOf(wa.prototype),"remove",this).call(this);this.gradientHandle&&this.gradientHandle.remove()}},{key:"selectRadialGradient",value:function(){var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return 1==ha.nextAddress?(M.get("linearMode").borderColor=Ec.Color.gray.darker(),M.get("radialMode").borderColor=Ec.Color.orange,ha.yield(M.applyGradient(Ec.RadialGradient),2)):ha.yield(M.updateGradientHandles(),
0)})}},{key:"selectLinearGradient",value:function(){var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return 1==ha.nextAddress?(M.get("radialMode").borderColor=Ec.Color.gray.darker(),M.get("linearMode").borderColor=Ec.Color.orange,ha.yield(M.applyGradient(Ec.LinearGradient),2)):ha.yield(M.updateGradientHandles(),0)})}},{key:"applyGradient",value:function(M){var ha=this,va,Ua,eb,ob,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){va=ha.gradientValue;ha.get("gradientEditor");
va&&va.isGradient?(Ua=va,eb=Ua.stops,ob=Ua.focus,Tb=Ua.vector,ha.gradientValue=new M({stops:eb,bounds:ha.gradientBounds,focus:ob,vector:Tb})):ha.gradientValue=new M({stops:[{color:Ec.Color.white,offset:0},{color:Ec.Color.black,offset:1}],bounds:ha.gradientBounds});ha.update(ha.gradientValue);Yb.jumpToEnd()})}},{key:"showGradientHandlesOn",value:function(M){this.handleMorph=M;this.updateGradientHandles()}},{key:"updateGradientHandles",value:function(){var M=this,ha,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==
Ua.nextAddress)return ha=300,va=M.gradientValue.__proto__.constructor,M.handleMorph?M.gradientHandle?Ua.yield(M.gradientHandle.fadeOut(ha),3):Ua.jumpTo(2):Ua.return();va==Ec.RadialGradient?M.gradientHandle=new Ec.GradientFocusHandle({target:M.handleMorph}):va==Ec.LinearGradient&&(M.gradientHandle=new Ec.GradientDirectionHandle({target:M.handleMorph}));M.gradientHandle&&(Ec.signal(M,"openHandle",M.gradientHandle),M.gradientHandle.relayout(),M.gradientHandle.opacity=0,M.gradientHandle.animate({opacity:1,
duration:ha}));Ua.jumpToEnd()})}},{key:"update",value:function(M){(M=void 0===M?this.gradientValue:M)&&M.isGradient&&this.get("gradientEditor").update(M)}},{key:"build",value:function(){var M;this.submorphs=[M=new Ec.GradientTypeSelector({name:"typeSelector"}),this.gradientEditor()];Ec.connect(M,"radial",this,"selectRadialGradient");Ec.connect(M,"linear",this,"selectLinearGradient");Ec.connect(this,"gradientValue",this,"update");this.update(this.gradientValue);M.update(this.gradientValue);this.gradientValue&&
this.updateGradientHandles()}},{key:"gradientEditor",value:function(){return Ec.morph({fill:null,clipMode:"hidden",extent:Ec.pt(190,80),submorphs:[new Ec.GradientStopVisualizer({position:Ec.pt(5,30),name:"gradientEditor",gradientEditor:this})]})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientEditor"}},{key:"properties",get:function(){return{layout:{initialize:function(){this.layout=new Ec.VerticalLayout({spacing:3})}},fill:{defaultValue:Ec.Color.transparent},handleMorph:{},
gradientValue:{set:function(M){M&&M.isGradient||(M=!1);this.setProperty("gradientValue",M)}},submorphs:{initialize:function(){this.build()}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:2575,end:6191})}(Ec.Morph);Ec.GradientEditor=pe;Ec.GradientEditor=pe;Ec.GradientEditor=
pe;(function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),wa=G.hasOwnProperty("StopControlHead")&&"function"===typeof G.StopControlHead?G.StopControlHead:G.StopControlHead=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,N,[{key:"update",value:function(M){var ha=this.getSubmorphNamed("paletteField");this.getSubmorphNamed("pickerField");ha||(this.submorphs=[ha=this.paletteField(Ec.pt(10,
10))]);ha.fill=this.stopColor=M.stops[this.index].color}},{key:"onHoverIn",value:function(){var M=this.targetProperty.stops[this.index].color;this.palette=this.palette||new Ec.Popover({name:"Color Palette",targetMorph:new Ec.ColorPalette({color:M})});Ec.connect(this.palette.targetMorph,"color",this.palette,"color");this.picker=this.picker||new Ec.ColorPicker({color:M});this.picker.color=M;this.scheduleExpand()}},{key:"onHoverOut",value:function(){this.scheduleShrink()}},{key:"scheduleExpand",value:function(){this.queue.pop()||
(this.queue.push(this.expand),this.dequeue())}},{key:"scheduleShrink",value:function(){this.queue.pop()||(this.queue.push(this.shrink),this.dequeue())}},{key:"dequeue",value:function(){var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){if(1==ha.nextAddress){if(M.queueActive)return ha.return();M.queueActive=!0}if(3!=ha.nextAddress)return 0<M.queue.length?ha.yield(M.queue.shift().bind(M)(),2):ha.jumpTo(3);M.queueActive=!1;ha.jumpToEnd()})}},{key:"expand",value:function(){var M=
this,ha,va,Ua,eb,ob,Tb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){if(1<M.submorphs.length)return yc.return();ha=M.get("paletteField");Ua=Ec.pt(2,-14);M.submorphs=[M.closeButton(),ha,M.pickerField()];M.master={auto:"styleguide://SystemWidgets/stop control head/expanded"};va=M.get("gradientEditor");eb=M.transformRectToMorph(va,M.innerBounds());ob=eb.x;Tb=eb.width;Yb=ob+Tb-va.width;ob<M.width/2&&(Ua=Ua.addXY(M.width/3-ob,0));Yb>M.width/2&&(Ua=Ua.addXY(M.width/3-Yb,0));ha.extent=
Ec.pt(15,15);M.center=Ua;M.stopVisualizer.gradientEditor.update();yc.jumpToEnd()})}},{key:"shrink",value:function(){var M=this,ha,va,Ua,eb,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){if(3>M.submorphs.length)return Tb.return();ha=Ec.pt(2,-14);va=$jscomp.makeIterator([M.get("close"),M.get("paletteField"),M.get("pickerField")]);Ua=va.next().value;eb=va.next().value;ob=va.next().value;eb.bringToFront();Ua.remove();ob.remove();M.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"};
M.center=ha;Tb.jumpToEnd()})}},{key:"onWidgetClosed",value:function(){this.palette=this.picker=null;this.shrink()}},{key:"removeStop",value:function(){this.stopVisualizer.removeStop(this.index)&&this.remove()}},{key:"closeButton",value:function(){var M=new Ec.Morph({name:"close",extent:Ec.pt(15,15),fill:Ec.Color.transparent,origin:Ec.pt(0,-3),clipMode:"hidden",submorphs:[Ec.Icon.makeLabel("times",{styleClasses:["closeButton"]})]});Ec.connect(M,"onMouseDown",this,"removeStop");return M}},{key:"updateColor",
value:function(M){this.stopVisualizer.updateStop(this.index,{color:M})}},{key:"openColorWidget",value:function(M){this.stopVisualizer.stopControls.forEach(function(ha){return ha.head.closeAllWidgets()});this[M].topLeft=Ec.pt(0,0);Ec.connect(this[M],"color",this,"updateColor");Ec.connect(this[M],"close",this,"onWidgetClosed");Ec.connect(this.stopVisualizer,"remove",this[M],"remove");Ec.connect(this[M],"onBlur",this,"removeWhenLostFocus",{converter:function(){return M},varMapping:{name:M}});this[M].fadeIntoWorld(this.globalBounds().bottomCenter());
this[M].focus()}},{key:"removeWhenLostFocus",value:function(M){var ha=this;setTimeout(function(){$world.focusedMorph.ownerChain().includes(ha[M])||$world.focusedMorph.isMenuItem?ha[M].focus():ha.closeColorWidget(M)},100)}},{key:"closeColorWidget",value:function(M){this[M]&&this[M].remove()}},{key:"closeAllWidgets",value:function(){this.closeColorWidget("palette");this.closeColorWidget("picker")}},{key:"paletteField",value:function(M){M=Ec.morph({type:"ellipse",name:"paletteField",extent:M,styleClasses:["paletteField"]});
Ec.connect(M,"onMouseDown",this,"openColorWidget",{converter:function(){return"palette"}});return M}},{key:"pickerField",value:function(){var M=new Ec.Image({name:"pickerField",styleClasses:["pickerField"]});Ec.connect(M,"onMouseDown",this,"openColorWidget",{converter:function(){return"picker"}});return M}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"StopControlHead"}},{key:"properties",get:function(){return{stopVisualizer:{},gradientEditor:{},targetProperty:{get:function(){return this.stopVisualizer.targetProperty}},
master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"}}},index:{},queue:{defaultValue:[]},isHaloItem:{defaultValue:!0}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:6193,end:11487})})(Ec.Morph);(function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),
wa=G.hasOwnProperty("GradientStopVisualizer")&&"function"===typeof G.GradientStopVisualizer?G.GradientStopVisualizer:G.GradientStopVisualizer=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,N,[{key:"update",value:function(M){this.fill=new Ec.LinearGradient({stops:M.stops,vector:"eastwest"});this.get("instruction").animate({visible:!1,duration:300});this.renderStopControls(M)}},{key:"onHoverOut",value:function(){this.toggleStopPreview(!1)}},
{key:"onMouseMove",value:function(M){var ha=M.positionIn(this);M=ha.x;this.stopControls&&this.stopControls.find(function(va){return va.bounds().containsPoint(ha)})?this.toggleStopPreview(!1):(this.toggleStopPreview(!0),this.get("stopControlPreview").position=Ec.pt(M,0))}},{key:"onMouseDown",value:function(M){if(this.get("stopControlPreview").visible){var ha=M.positionIn(this).x/this.width;M=this.targetProperty.stops.findIndex(function(va){return va.offset>ha});M=0>M?this.targetProperty.stops.length-
1:M;this.insertStop(M,ha)}}},{key:"toggleStopPreview",value:function(M){this.get("instruction").visible||(this.get("stopControlPreview").visible=M)}},{key:"removeStop",value:function(M){var ha=this.targetProperty;return 2<ha.stops.length?(Ec.arr.removeAt(ha.stops,M),this.targetProperty=ha,!0):!1}},{key:"insertStop",value:function(M,ha){var va=this.targetProperty;Ec.arr.pushAt(va.stops,{offset:ha,color:va.stops[M].color},M);this.targetProperty=va}},{key:"updateStop",value:function(M,ha){var va=this.targetProperty;
va.stops[M]=Object.assign({},va.stops[M],{},ha);this.targetProperty=va}},{key:"renderStopControls",value:function(M){var ha=this;if(!this.stopControls||this.stopControls.length!=M.stops.length){var va=$jscomp.makeIterator(this.submorphs),Ua=va.next().value;va=va.next().value;this.stopControls=M.stops.map(function(eb,ob){return new Ec.GradientStopControl({stopVisualizer:ha,index:ob})});this.submorphs=[Ua,va].concat($jscomp.arrayFromIterable(this.stopControls));Ec.arr.invoke(this.stopControls,"update",
M)}Ec.arr.invoke(this.stopControls,"update",M)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopVisualizer"}},{key:"properties",get:function(){return{fill:{defaultValue:Ec.Color.gray},gradientEditor:{},draggable:{defaultValue:!1},targetProperty:{derived:!0,get:function(){return this.gradientEditor&&this.gradientEditor.gradientValue},set:function(M){this.gradientEditor.gradientValue=M}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop visualizer"}}},
submorphs:{after:["gradientEditor"],initialize:function(){this.submorphs=[{type:"label",name:"instruction",value:"Select Gradient Type",visible:!(this.targetProperty&&this.targetProperty.isGradient)},{name:"stopControlPreview",visible:!1,master:{auto:"styleguide://SystemWidgets/stop control preview"},submorphs:[Ec.Icon.makeLabel("plus-circle",{name:"addStopLabel"})]}]}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:11489,end:14883})})(Ec.Morph);(function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),wa=G.hasOwnProperty("GradientStopControl")&&"function"===typeof G.GradientStopControl?G.GradientStopControl:G.GradientStopControl=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return lc(wa,N,[{key:"update",value:function(M){this.position=this.stopVisualizer.extent.subPt(Ec.pt(10,0)).scaleByPt(Ec.pt(M.stops[this.index].offset,0)).addPt(Ec.pt(5,0));this.head.update(M)}},{key:"onDragStart",value:function(M){this.nativeCursor="-webkit-grabbing";this.stopVisualizer.nativeCursor="-webkit-grabbing";this.offsetView=(new Ec.Tooltip).openInWorld(M.hand.position.addPt(Ec.pt(10,10)))}},{key:"onDrag",value:function(M){var ha=Math.max(0,Math.min(1,(this.position.x-5+M.state.dragDelta.x)/
(this.stopVisualizer.width-10)));this.stopVisualizer.updateStop(this.index,{offset:ha});this.offsetView.description=(100*ha).toFixed(2)+"%";this.offsetView.position=M.hand.position.addPt(Ec.pt(10,10))}},{key:"onDragEnd",value:function(){this.nativeCursor="-webkit-grab";this.stopVisualizer.nativeCursor="auto";this.offsetView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopControl"}},{key:"properties",get:function(){return{index:{},head:{},stopVisualizer:{},styleClasses:{defaultValue:["stopControlLine"]},
nativeCursor:{defaultValue:"-webkit-grab"},draggable:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop control"}}},submorphs:{after:["index","stopVisualizer"],initialize:function(){this.head=new Ec.StopControlHead({name:"stop control head",stopVisualizer:this.stopVisualizer,index:this.index});this.head.stopControl=this;this.addMorph(this.head)}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:14885,end:16661})})(Ec.Morph);(function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),wa=G.hasOwnProperty("FocusHandle")&&"function"===typeof G.FocusHandle?G.FocusHandle:G.FocusHandle=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,
N,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().center()}},{key:"onDragStart",value:function(M){this.tfm=this.gradientHandle.target.getGlobalTransform().inverse();this.focusView=(new Ec.Tooltip).openInWorld(M.hand.position.addPt(Ec.pt(10,10)))}},{key:"onDrag",value:function(M){var ha=M.state.dragDelta,va=this.gradientHandle,Ua=va.target.fill;Ua.focus=Ua.focus.addXY(ha.x/va.target.width,ha.y/va.target.height);this.focusView.description="x: "+(100*Ua.focus.x).toFixed()+
"%, y: "+(100*Ua.focus.y).toFixed()+"%";this.focusView.position=M.hand.position.addPt(Ec.pt(10,10));va.target.makeDirty();va.relayout()}},{key:"onDragEnd",value:function(M){this.focusView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"FocusHandle"}},{key:"properties",get:function(){return{gradientHandle:{},styleClasses:{defaultValue:["focusHandle"]},extent:{defaultValue:Ec.pt(20,20)},fill:{defaultValue:Ec.Color.orange}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:16663,end:17666})})(Ec.Ellipse);(function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),wa=G.hasOwnProperty("BoundsHandle")&&"function"===typeof G.BoundsHandle?G.BoundsHandle:G.BoundsHandle=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return lc(wa,N,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().partNamed(this.side);this.scale=1/this.gradientHandle.target.getGlobalTransform().getScale()}},{key:"onDragStart",value:function(M){this.boundsView=(new Ec.Tooltip).openInWorld(M.hand.position.addPt(Ec.pt(10,10)))}},{key:"onDrag",value:function(M){var ha=this.gradientHandle,va=ha.target.fill,Ua=va.bounds.partNamed(this.side).addPt(M.state.dragDelta.scaleBy(2));va.bounds=va.bounds.withPartNamed(this.side,
Ua);this.boundsView.description="w: "+va.bounds.width.toFixed()+"px h: "+va.bounds.height.toFixed()+"px";this.boundsView.position=M.hand.position.addPt(Ec.pt(10,10));ha.target.makeDirty();ha.relayout()}},{key:"onDragEnd",value:function(M){this.boundsView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"BoundsHandle"}},{key:"properties",get:function(){return{side:{},gradientHandle:{},styleClasses:{after:["side"],initialize:function(){this.styleClasses=["boundsHandle",this.side]}}}}}],
G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:17668,end:18747})})(Ec.Ellipse);var Ga=function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),wa=G.hasOwnProperty("GradientFocusHandle")&&"function"===typeof G.GradientFocusHandle?G.GradientFocusHandle:
G.GradientFocusHandle=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,N,[{key:"relayout",value:function(){var M=this.target.fill,ha=M.focus;this.extent=M.bounds.extent();this.submorphs.forEach(function(va){return va.relayout()});this.rotation=this.target.rotation;this.scale=this.target.scale;this.borderWidth=2/this.scale;this.owner&&(this.center=this.owner.localizePointFrom(this.target.extent.scaleByPt(ha),
this.target))}},{key:"initBoundsHandles",value:function(){var M=this;this.bounds().sides.forEach(function(ha){M.addMorph(new Ec.BoundsHandle({gradientHandle:M,side:ha,name:"bounds handle "+ha.split("C")[0]}))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientFocusHandle"}},{key:"properties",get:function(){return{target:{},isHaloItem:{defaultValue:!0},hasFixedPosition:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient focus handle"}}},
submorphs:{initialize:function(){this.submorps=[];this.initBoundsHandles();this.addMorph(new Ec.FocusHandle({gradientHandle:this}));this.relayout()}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:18756,end:20039})}(Ec.Ellipse);Ec.GradientFocusHandle=Ga;Ec.GradientFocusHandle=
Ga;Ec.GradientFocusHandle=Ga;(function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),wa=G.hasOwnProperty("RotationPoint")&&"function"===typeof G.RotationPoint?G.RotationPoint:G.RotationPoint=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,N,[{key:"relayout",value:function(){this.center=Ec.Point.polar(this.gradientHandle.width/2,this.gradientHandle.target.fill.vectorAsAngle())}},
{key:"onDragStart",value:function(M){this.angleView=(new Ec.Tooltip).openInWorld(M.hand.position.addPt(Ec.pt(10,10)));this.angleView.rotation=0}},{key:"onDrag",value:function(M){var ha=this.gradientHandle;ha.target.fill.vector=M.positionIn(ha).theta();ha.target.makeDirty();ha.relayout();this.angleView.description=(Ec.num.toDegrees(ha.target.fill.vectorAsAngle())+180).toFixed()+"\u00b0";this.angleView.position=M.hand.position.addPt(Ec.pt(10,10))}},{key:"onDragEnd",value:function(M){this.angleView.remove()}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RotationPoint"}},{key:"properties",get:function(){return{gradientHandle:{}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20041,end:20838})})(Ec.Ellipse);(function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),
wa=G.hasOwnProperty("GradientDirectionHandle")&&"function"===typeof G.GradientDirectionHandle?G.GradientDirectionHandle:G.GradientDirectionHandle=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,N,[{key:"isHaloItem",get:function(){return!0}},{key:"relayout",value:function(){this.owner&&(this.position=this.owner.localizePointFrom(this.target.extent.scaleBy(.5),this.target));this.rotationPoint.relayout()}},{key:"initRotationPoint",
value:function(){this.rotationPoint=this.addMorph(new Ec.RotationPoint({gradientHandle:this,name:"rotation point"}))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientDirectionHandle"}},{key:"properties",get:function(){return{target:{},origin:{defaultValue:Ec.pt(25,25)},extent:{defaultValue:Ec.pt(50,50)},hasFixedPosition:{defaultValue:!0},submorphs:{initialize:function(){this.initRotationPoint();this.relayout()}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient direction handle"}}}}}}],
G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20840,end:21812})})(Ec.Ellipse);Ec.colorWidgets.GradientEditor=Ec.GradientEditor;var Oa=lively.FreezerRuntime.recorderFor("lively.components/canvas.js");Oa.pt=Fc;Oa.Point=Nc;Oa.rect=Pb;Oa.Color=tb;Oa.Morph=Xa;Oa.Image=cb;Oa.connect=
Ya;Ga=za("C",function(N){var G=lively.FreezerRuntime.recorderFor("lively.components/canvas.js"),wa=G.hasOwnProperty("Canvas")&&"function"===typeof G.Canvas?G.Canvas:G.Canvas=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,N,[{key:"context",get:function(){if(this._canvas)return this._canvas.getContext(this.contextType);this.world()&&this.env.renderer.getNodeForMorph(this)||console.warn("Context not yet rendered. Please ensure that the Canvas Morph has been rendered first before accessing the context. This can be achieved by waiting for the whenRendered() promise before you proceed accessing the context property.");
return null}},{key:"_canvas",set:function(M){var ha=this.__canvas__;this.__canvas__=M;this.restoreContent(ha,M)}},{key:"_canvas",get:function(){return this.__canvas__}},{key:Symbol.for("lively-instance-initialize"),value:function(M){M=void 0===M?{}:M;lc._get(Object.getPrototypeOf(wa.prototype),Symbol.for("lively-instance-initialize"),this).call(this,M);Oa.connect(this,"extent",this,"onExtentChanged")}},{key:"afterRender",value:function(M,ha){ha?this._canvas=M:"function"===typeof this.__canvas_init__&&
(this.__canvas_init__(),delete this.__canvas_init__)}},{key:"restoreContent",value:function(M,ha){var va=this.contextType,Ua=this.preserveContents;"function"===typeof this.__canvas_init__?(this.__canvas_init__(),delete this.__canvas_init__):Ua&&"2d"==va&&M&&M!==ha&&this.context.drawImage(M,0,0)}},{key:"onExtentChanged",value:function(){var M=this;if(this._canvas&&this.preserveContents&&this.context.getImageData){var ha=this._canvas,va=ha.width;ha=ha.height;if(va&&ha){var Ua=this.context.getImageData(0,
0,va,ha);this.__canvas_init__=function(){M.context.putImageData(Ua,0,0)}}}}},{key:"clear",value:function(M){var ha=this.context;if(ha){var va=this._canvas,Ua=va.width;va=va.height;ha.save();ha.setTransform(1,0,0,1,0,0);M?(M.toCSSString&&(M=M.toCSSString()),ha.fillStyle=M,ha.fillRect(0,0,Ua,va)):ha.clearRect(0,0,Ua,va);ha.restore()}}},{key:"render",value:function(M){return M.renderCanvas(this)}},{key:"withContextDo",value:function(M){var ha=this;this._canvas?M(this.context):this.__canvas_init__=function(){return M(ha.context)}}},
{key:"toDataURI",value:function(){return this._canvas&&this._canvas.toDataURL()}},{key:"fromDataURI",value:function(M){var ha=this,va=new Oa.Image;va.onload=function(){ha._canvas.width=va.width;ha._canvas.height=va.height;ha.context.drawImage(va,0,0)};va.src=M}},{key:"imageData",value:function(M){M||(M=this.canvasBounds);return this.context.getImageData(M.x,M.y,M.width,M.height)}},{key:"nonTransparentArea",value:function(){for(var M=this.imageData(),ha=M.data,va=M.width,Ua=M.height,eb=va,ob=Ua,Tb=
0;Tb<Ua;Tb++)for(var Yb=0;Yb<eb;Yb++)0<ha[4*(Tb*va+Yb)+3]&&(eb=Yb,ob>Tb&&(ob=Tb));if(eb===va)return Oa.rect(0,0,0,0);Tb=eb;Yb=ob;for(--Ua;Ua>ob;Ua--)for(var yc=va-1;yc>Tb;yc--)0<ha[4*(Ua*va+yc)+3]&&(Tb=yc,Yb<Ua&&(Yb=Ua));return{imageData:M,bounds:Oa.rect(eb,ob,Tb-eb+1,Yb-ob+1)}}},{key:"trimNonTransparent",value:function(){var M=this.nonTransparentArea(),ha=M.imageData;M=M.bounds;if(!M.topLeft().equals(Oa.pt(0,0))){var va=M.x,Ua=M.y;this.context.putImageData(ha,-va,-Ua,va,Ua,M.width,M.height);this.position=
this.position.addPt(M.topLeft())}M.extent().equals(this.extent)||(this.extent=M.extent())}},{key:"finishDraw",value:function(M){M=void 0===M?{}:M;var ha=this.context,va=M,Ua=void 0===va.color?"rgba(0,0,0,0.6)":va.color,eb=void 0===va.width?4:va.width;va=void 0===va.fill?!1:va.fill;M=M.fillColor||Ua;Ua.toCSSString&&(Ua=Ua.toCSSString());M.toCSSString&&(M=M.toCSSString());ha.strokeStyle=Ua;ha.lineWidth=eb;ha.stroke();ha.closePath();va&&(ha.fillStyle=M,ha.fill())}},{key:"line",value:function(M,ha,va){va=
void 0===va?{}:va;var Ua=this.context;Ua.beginPath();Ua.moveTo(M.x,M.y);Ua.lineTo(ha.x,ha.y);Ua.lineCap="round";this.finishDraw(va)}},{key:"arc",value:function(M,ha,va,Ua,eb,ob){eb=void 0===eb?!1:eb;ob=void 0===ob?{}:ob;var Tb=this.context;Tb.beginPath();Tb.arc(M.x,M.y,ha,va,Ua,eb);this.finishDraw(ob)}},{key:"polygon",value:function(M,ha){ha=void 0===ha?{}:ha;var va=this.context;va.beginPath();va.moveTo(M[0].x,M[0].y);for(var Ua=0;Ua<M.length;Ua++)va.lineTo(M[Ua].x,M[Ua].y);va.lineTo(M[0].x,M[0].y);
this.finishDraw(ha)}},{key:"text",value:function(M,ha,va){va=void 0===va?{}:va;var Ua=this.context,eb=va,ob=void 0===eb.color?"black":eb.color,Tb=void 0===eb.font?"14px Arial":eb.font,Yb=void 0===eb.align?"start":eb.align;eb=void 0===eb.baseline?"bottom":eb.baseline;Ua.save();Ua.font=Tb;Ua.fillStyle=ob;Ua.textAlign=Yb;Ua.textBaseline=eb;va.angle&&!isNaN(va.angle)&&(Ua.translate(ha.x,ha.y),Ua.rotate(va.angle),Ua.translate(-ha.x,-ha.y));Ua.fillText(M,ha.x,ha.y);Ua.restore()}},{key:"line",value:function(M,
ha,va){va=void 0===va?{}:va;var Ua=this.context,eb=va.color||"rgba(0,0,0,0.6)";va=va.width||4;eb.toCSSString&&(eb=eb.toCSSString());Ua.strokeStyle=eb;Ua.beginPath();Ua.lineWidth=va;Ua.moveTo(M.x,M.y);Ua.lineTo(ha.x,ha.y);Ua.stroke();Ua.closePath()}},{key:"spiral",value:function(){this.clear(Oa.Color.white);for(var M=this.innerBounds().center(),ha=0,va=1,Ua=0;150>Ua;Ua++){var eb=M.addPt(Oa.Point.polar(va,ha));this.line(M,eb,{color:Oa.Color.random()});M=eb;ha+=Math.PI/10;va+=.3}}},{key:"rect",value:function(M,
ha,va){va=void 0===va?{}:va;var Ua=this.context;Ua.beginPath();Ua.rect(M.x,M.y,ha.x,ha.y);this.finishDraw(va)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Canvas"}},{key:"properties",get:function(){return{extent:{defaultValue:Oa.pt(200,200)},fill:{defaultValue:Oa.Color.transparent},contextType:{defaultValue:"2d"},preserveContents:{defaultValue:!0},canvasExtent:{get:function(){return this._canvas&&Oa.pt(this._canvas.width,this._canvas.height)}},canvasBounds:{readOnly:!0,get:function(){return this._canvas&&
this.canvasExtent.extentAsRectangle()}},_serializedContents:{get:function(){return this.preserveContents&&this.toDataURI()},set:function(M){var ha=this;this.withContextDo(function(){return ha.fromDataURI(M)})}}}}}],G,{pathInPackage:function(){return"canvas.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.components",version:"0.1.0"}}},{start:233,end:8699})}(Oa.Morph));
Oa.Canvas=Ga;Oa.Canvas=Ga;Oa.Canvas=Ga;var Ka=lively.FreezerRuntime.recorderFor("lively.ide/world.js");Ka.resource=nb;Ka.Rectangle=mb;Ka.Color=tb;Ka.pt=Fc;Ka.arr=ic;Ka.fun=Jb;Ka.obj=Dc;Ka.promise=Cb;Ka.PropertyPath=mc;Ka.once=wc;Ka.GridLayout=db;Ka.MorphicDB=Bb;Ka.easings=Hd;Ka.HTMLMorph=sa;Ka.Text=xc;Ka.Label=Ta;Ka.Path=O;Ka.Polygon=U;Ka.morph=Zd;Ka.Ellipse=Xb;Ka.touchInputDevice=ra;Ka.Icon=Fa;Ka.Morph=Xa;Ka.VerticalLayout=ub;Ka.HorizontalLayout=xa;Ka.ProportionalLayout=pa;Ka.Tooltip=Gb;Ka.Image=
cb;Ka.inspect=Gd;Ka.config=od;Ka.World=ea;Ka.loadMorphFromSnapshot=bb;Ka.loadObjectFromPartsbinFolder=kc;Ka.loadPart=Uc;Ka.uploadFile=nf;Ka.InformPrompt=Aa;Ka.ConfirmPrompt=Rb;Ka.MultipleChoicePrompt=Gc;Ka.TextPrompt=Ab;Ka.EditPrompt=Hc;Ka.PasswordPrompt=fb;Ka.ListPrompt=ud;Ka.EditListPrompt=je;Ka.LoadingIndicator=cd;Ka.Halo=Yd;Ka.MorphHighlighter=r;Ka.StatusMessage=Rd;Ka.StatusMessageForMorph=ke;Ka.ProportionalLayoutHalo=le;Ka.GridLayoutHalo=ge;Ka.FlexLayoutHalo=vd;Ka.Window=rc;Ka.List=gb;Ka.FilterableList=
Id;Ka.Menu=hb;Ka.worldCommands=fe;Ka.GradientEditor=pe;Ka.completions=Za;Ka.runEval=ua;Ka.getClassName=J;Ka.serialize=la;Ka.Canvas=Ga;Ka.CommentBrowser=Oc;Ka.prefetchCoreStyleguides=La;fe=function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),wa=G.hasOwnProperty("LivelyWorld")&&"function"===typeof G.LivelyWorld?G.LivelyWorld:G.LivelyWorld=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,
N,[{key:"visibleBoundsExcludingTopBar",value:function(){var M=$world.getSubmorphNamed("lively top bar"),ha=this.visibleBounds();return M?new Ka.Rectangle(ha.x,ha.y+M.height,ha.width,ha.height-M.height):ha}},{key:"getListedComponents",value:function(){var M=this,ha=this.withAllSubmorphsSelect(function(va){return va.isComponent&&!M.hiddenComponents.includes(va.name)});return Ka.arr.uniq([].concat($jscomp.arrayFromIterable(ha),$jscomp.arrayFromIterable(this.localComponents)))}},{key:"activeWindow",value:function(){return this.getWindows().reverse().find(function(M){return M.isActive()})}},
{key:"getWindows",value:function(){return this.submorphs.filter(function(M){return M.isWindow})}},{key:"activePrompt",value:function(){return this.getPrompts().reverse().find(function(M){return M.isActive()})}},{key:"getPrompts",value:function(){return this.submorphs.filter(function(M){return M.isPrompt})}},{key:"openInWindow",value:function(M,ha){ha=void 0===ha?{title:M.name,name:"window for "+M.name}:ha;M=(new Ka.Window(Object.assign({},ha,{extent:M.extent.addXY(0,25),targetMorph:M}))).openInWorld();
M.ensureNotOverTheTop();return M}},{key:"withTopBarDo",value:function(M){var ha=this.get("lively top bar");ha&&M(ha)}},{key:"onTopBarLoaded",value:function(){}},{key:"onKeyUp",value:function(M){this.withTopBarDo(function(ha){return ha.onKeyUp(M)})}},{key:"onKeyDown",value:function(M){lc._get(Object.getPrototypeOf(wa.prototype),"onKeyDown",this).call(this,M);M.targetMorph==this&&this.withTopBarDo(function(ha){return ha.onKeyDown(M)})}},{key:"onMouseDown",value:function(M){lc._get(Object.getPrototypeOf(wa.prototype),
"onMouseDown",this).call(this,M);var ha=M.state.clickedOnMorph,va=this.activeWindow();va&&ha==this&&va.deactivate();this.handleHaloCycle(M);M.state.menu&&M.state.menu.remove();this._tooltipViewer.mouseDown(M)}},{key:"onMouseUp",value:function(M){M.isCommandKey()&&M.stop();if(M.isAltDown()&&Ka.config.altClickDefinesThat){var ha=this.morphsContainingPoint(M.position)[0];setTimeout(function(){return System.global.that=ha},100);ha.show();M.stop();console.log('Set global "that" to '+ha)}}},{key:"onDrag",
value:function(M){}},{key:"whenReady",value:function(){var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return 1==ha.nextAddress?ha.yield(M._styleLoading,2):ha.return(!0)})}},{key:"onLoad",value:function(){var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){if(1==ha.nextAddress){M.opacity=0;M.onWindowResize();lively.modules&&lively.modules.removeHook("fetch",window.__logFetch);M.animate({opacity:1,blur:3,duration:1E3,easing:Ka.easings.inOutExpo});if(!M.showsUserFlap&&
!Ka.resource(document.location.href).query().showsUserFlap)return ha.jumpTo(2);M._styleLoading=Ka.prefetchCoreStyleguides(window.worldLoadingIndicator);return ha.yield(M._styleLoading,2)}M.animate({blur:0,duration:1E3,easing:Ka.easings.inOutExpo});document.body.style.overflowX="visible";document.body.style.overflowY="visible";ha.jumpToEnd()})}},{key:"isNotUnique",value:function(M){var ha,va,Ua,eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ob){switch(ob.nextAddress){case 1:return ob.yield(Ka.MorphicDB.default.exists("world",
M),2);case 2:if(ha=ob.yieldResult.exists){ob.jumpTo(3);break}va=M+".json";Ua=Ka;eb=Ua.resource;return ob.yield(System.decanonicalize("lively.morphic/styleguides"),5);case 5:return ob.yield(eb.call(Ua,ob.yieldResult).join(va).exists(),4);case 4:ha=ob.yieldResult;case 3:return ob.return(ha)}})}},{key:"askForName",value:function(){var M=this,ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){switch(va.nextAddress){case 1:return va.yield(M.whenRendered(),3);case 3:if(ha){va.jumpTo(4);
break}return va.yield(M.prompt(["New Project\n",{},"Enter a name for this project:",{fontWeight:"normal"}],{width:400,hasFixedPosition:!0,forceConfirm:!0}),5);case 5:return ha=va.yieldResult,va.yield(M.isNotUnique(ha),6);case 6:if(!va.yieldResult){va.jumpTo(3);break}return va.yield(M.confirm("This Project name is already taken. Please pick a different one!",{hasFixedPosition:!0,width:400}),8);case 8:ha=!1;va.jumpTo(3);break;case 4:return va.return(ha)}})}},{key:"onWindowResize",value:function(M){lc._get(Object.getPrototypeOf(wa.prototype),
"onWindowResize",this).call(this,M);"elastic"===this.resizePolicy&&this.execCommand("resize to fit window")}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var M=this,ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return M._cachedDragIndicator||(M._cachedDragIndicator=Ka.loadObjectFromPartsbinFolder("upload-indicator")),va.yield(M._cachedDragIndicator,2);ha=va.yieldResult;ha.world()||ha.openInWorld();Ka.fun.debounceNamed("remove-upload-indicator",
1E3,function(){M.nativeDrop_removeUploadIndicator()})();va.jumpToEnd()})}},{key:"nativeDrop_removeUploadIndicator",value:function(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(M){return M.remove()})}},{key:"onNativeDragover",value:function(M){M.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},{key:"onNativeDrop",value:function(M){var ha=this,va,Ua,eb,ob,Tb,Yb,yc,md,Bd,Wc,Sd,Qd,Ed,yd,ue,De,gg,pg,Tf,Le,Pg,tg,Xg,uf,Hf,Wd,wh,vb,nc,qd,rd,Pe,hf,Qg,qg,Wi,hl,il,Sk,pj,Tk,
qj,sk,Yj,Eh,Zj;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ze){switch(Ze.nextAddress){case 1:ha.nativeDrop_removeUploadIndicator();if(M.targetMorph!=ha)return Ze.return();va=M;Ua=va.domEvt;eb=Ua.dataTransfer;ob=eb.files;Tb=document.location.origin;if(!ob.length){Ze.jumpTo(2);break}Yb=ha.getCurrentUser();yc=Yb.isGuestUser?"uploads/":"users/"+$world.getCurrentUser().name+"/uploads";if(!M.isAltDown()){Ze.jumpTo(3);break}return Ze.yield(ha.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",
input:yc}),4);case 4:if(yc=Ze.yieldResult,!yc)return Ze.return(ha.setStatusMessage("Canceled upload"));case 3:return Ze.yield(ha.confirm("Upload "+ob.length+" file"+(1<ob.length?"s":"")+"?"),5);case 5:md=Ze.yieldResult;if(!md)return Ze.return();Bd=new Ka.FormData;for(Wc=0;Wc<ob.length;Wc++)Bd.append("file",ob[Wc],ob[Wc].name);Ed=Ka.LoadingIndicator.open("Uploading File");Ze.setCatchFinallyBlocks(6);yd={};ue=function(Th){Th=Th.loaded/Th.total;Ed.progress=Th;Ed.status="Uploaded "+(100*Th).toFixed()+
"%"};Yb.isGuestUser||(yd.Authorization="Bearer "+Yb.token);Sd=Ka.resource(System.baseURL,{headers:yd,onProgress:ue,onLoad:function(Th){return Qd=Th}});Sd=Sd.join("/upload?uploadPath="+encodeURIComponent(yc));return Ze.yield(Sd.write(Bd),8);case 8:Ze.leaveTryBlock(7);break;case 6:return De=Ze.enterCatchBlock(),Ze.return(ha.showError("Upload failed: "+De.message+"\n"));case 7:Ed.remove();Ze.setCatchFinallyBlocks(9);ha.setStatusMessage("Uploaded "+Qd.uploadedFiles.length+" file");gg=Qd.uploadedFiles.map(function(Th){var Xi=
Ka.resource(Tb).join(Th.path);return Object.assign({},Th,{url:Xi.url,name:Xi.name()})});pg=[];Tf=[];Le=[];Pg=$jscomp.makeIterator(gg);for(tg=Pg.next();!tg.done;tg=Pg.next())Xg=tg.value,Xg.type.startsWith("image/")?pg.push(Xg):Xg.type.startsWith("video")?Tf.push(Xg):Le.push(Xg);if(!Tf.length){Ze.jumpTo(11);break}uf=$jscomp.makeIterator(Tf);Hf=uf.next();case 12:if(Hf.done){Ze.jumpTo(11);break}Wd=Hf.value;wh=Object;vb=wh.assign;return Ze.yield(Ka.loadObjectFromPartsbinFolder("video morph"),15);case 15:vb.call(wh,
Ze.yieldResult,{videoURL:Wd.url,name:Wd.name}).openInWorld();Hf=uf.next();Ze.jumpTo(12);break;case 11:pg.length&&pg.forEach(function(Th){var Xi=new Ka.Image({imageUrl:Th.url,autoResize:!0,name:Th.name});Xi.whenLoaded().then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(tk){if(1==tk.nextAddress)return Xi.extent=Xi.naturalExtent.scaleBy(.8*ha.visibleBounds().height/Xi.height),Xi.openInWorld(),tk.yield(Xi.whenRendered(),2);Xi.center=ha.visibleBounds().center();tk.jumpToEnd()})})});
if(!Le.length){Ze.jumpTo(16);break}nc=$jscomp.makeIterator(Le);qd=nc.next();case 17:if(qd.done){Ze.jumpTo(16);break}rd=qd.value;return Ze.yield(ha.confirm("open file "+rd.name+" ("+rd.type+")?"),20);case 20:(Pe=Ze.yieldResult)&&ha.execCommand("open file",{url:rd.url});qd=nc.next();Ze.jumpTo(17);break;case 16:Ze.leaveTryBlock(10);break;case 9:hf=Ze.enterCatchBlock(),ha.showError(hf);case 10:return Ze.return();case 2:Qg=Ua.dataTransfer.types;if(!Qg.includes("text/html")){Ze.jumpTo(21);break}qg=Ua.dataTransfer.getData("text/html");
Wi=(new Ka.DOMParser).parseFromString(qg,"text/html");hl=Wi.querySelectorAll("img");if(1===hl.length&&hl[0].src&&Qg.includes("text/uri-list")){il=hl[0].src;Sk=new Ka.Image({imageUrl:il,autoResize:!0,name:Ka.arr.last(il.split("/"))});Sk.whenLoaded().then(function(){return Sk.openInWorld()});Ze.jumpTo(22);break}pj=Object;Tk=pj.assign;return Ze.yield(Ka.loadObjectFromPartsbinFolder("html-morph"),23);case 23:Tk.call(pj,Ze.yieldResult,{html:qg}).openInWorld();case 22:return Ze.return();case 21:qj=0;case 24:if(!(qj<
Ua.dataTransfer.items.length)){Ze.jumpTo(0);break}sk=Ua.dataTransfer.items[qj];if("file"!==sk.kind){"string"===sk.kind&&sk.getAsString(function(Th){return Ka.inspect(Th)});Ze.jumpTo(25);break}Yj=sk.getAsFile();return Ze.yield(ha.confirm("Upload "+Yj.name+"?"),28);case 28:Eh=Ze.yieldResult;if(!Eh){Ze.jumpTo(25);break}return Ze.yield(Ka.uploadFile(Yj,Yj.type),30);case 30:(Zj=Ze.yieldResult)&&Zj.openInWorld(),Zj.center=ha.visibleBounds().center();case 25:qj++,Ze.jumpTo(24)}})}},{key:"menuItems",value:function(){var M=
this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",target:this},{command:"fix font metric",target:this},{command:"inspect server",target:this}]],["Tools",[{command:"open javascript workspace",target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",
target:this,tooltip:"Opens a workspace like interface\nthat allows you to trigger shell comands\nvia select + eval by pressing either "+(new Ka.Text).keysForCommand("doit")+" or "+(new Ka.Text).keysForCommand("printit")},{command:"open shell terminal",target:this,tooltip:"Opens a classic remote shell interface,\nthat allows you to send commands to a\nbash session running on the server.\nAlso comes with advanced git support."},{command:"open workspace",args:{askForMode:!0},target:this}]],{isDivider:!0},
{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Exported Components",[["Toggle Select All",function(){0==M.getListedComponents().length?M.hiddenComponents=[]:M.hiddenComponents=M.withAllSubmorphsSelect(function(ha){return ha.isComponent}).map(function(ha){return ha.name})}]].concat($jscomp.arrayFromIterable(this.withAllSubmorphsSelect(function(ha){return ha.isComponent}).map(function(ha){var va=M.hiddenComponents.includes(ha.name);
return[[].concat($jscomp.arrayFromIterable(Ka.Icon.textAttribute(va?"square":"check-square")),["  "+ha.name,{}]),function(){M.hiddenComponents=va?Ka.arr.without(M.hiddenComponents,ha.name):[ha.name].concat($jscomp.arrayFromIterable(M.hiddenComponents))}]})))],["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return M.resizePolicy="elastic"}]]:[["switch to manual resizing of world",
function(){return M.resizePolicy="static"}]]],["Troubleshooting",[{command:"report a bug",target:this},{command:"clear storage and reload",target:this}]],{isDivider:!0},["Windows",[{command:"toggle minimize all windows",target:this},{command:"close all windows",target:this}]],{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function(M,ha){var va=this.env.eventDispatcher.eventState;va.menu&&va.menu.remove();return va.menu=ha&&ha.length?
Ka.Menu.openAtHand(ha,{hand:M&&M.hand||this.firstHand}):null}},{key:"onPaste",value:function(M){var ha=this,va,Ua,eb,ob,Tb,Yb,yc,md,Bd,Wc,Sd,Qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ed){switch(Ed.nextAddress){case 1:Ed.setCatchFinallyBlocks(2,3);Ua=M.domEvt.clipboardData;if(!Ua.types.includes("application/morphic")){Ed.jumpTo(3);break}M.stop();eb=JSON.parse(Ua.getData("application/morphic"));ob=[];Array.isArray(eb)||(eb=[eb]);va=Ka.LoadingIndicator.open("pasting morphs...");
Tb=$jscomp.makeIterator(eb);Yb=Tb.next();case 6:if(Yb.done){Ed.jumpTo(8);break}yc=Yb.value;return Ed.yield(Ka.loadMorphFromSnapshot(yc),9);case 9:md=Ed.yieldResult;md.openInWorld(M.hand.position);yc.copyMeta&&yc.copyMeta.offset&&(Bd=yc.copyMeta.offset,Wc=Bd.x,Sd=Bd.y,md.moveBy(Ka.pt(Wc,Sd)));ob.push(md);Yb=Tb.next();Ed.jumpTo(6);break;case 8:ha.showHaloFor(ob);case 3:Ed.enterFinallyBlock();va&&va.remove();Ed.leaveFinallyBlock(0);break;case 2:Qd=Ed.enterCatchBlock(),ha.showError(Qd),Ed.jumpTo(3)}})}},
{key:"commands",get:function(){return Ka.worldCommands.concat(lc._get(Object.getPrototypeOf(wa.prototype),"commands",this)).concat([{name:"open in prototype box",exec:function(M,ha){var va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress)return Ua.yield(Ka.loadPart("prototype box"),2);va=Ua.yieldResult;va.wrapProto(ha.target);Ua.jumpToEnd()})}}])}},{key:"keybindings",get:function(){return lc._get(Object.getPrototypeOf(wa.prototype),"keybindings",this).concat(Ka.config.globalKeyBindings)}},
{key:"keybindings",set:function(M){lc._set(Object.getPrototypeOf(wa.prototype),"keybindings",M,this)}},{key:"halos",value:function(){return this.submorphs.filter(function(M){return M.isHalo})}},{key:"haloForPointerId",value:function(M){return this.submorphs.find(function(ha){return ha.isHalo&&ha.state&&ha.state.pointerId===M})}},{key:"showHaloFor",value:function(M,ha,va){ha=void 0===ha?this.firstHand&&this.firstHand.pointerId:ha;va=void 0===va?!0:va;if(Ka.Halo)return M="function"===typeof M.createHalo?
M.createHalo(Ka.Halo,ha):new Ka.Halo({pointerId:ha,target:M}),this.addMorph(M),va&&M.focus(),M.alignWithTarget(),M}},{key:"showHaloForSelection",value:function(M,ha){return 0<M.length&&this.showHaloFor(M,ha)}},{key:"layoutHaloForPointerId",value:function(M){M=void 0===M?this.firstHand&&this.firstHand.pointerId:M;return this.submorphs.find(function(ha){return ha.isLayoutHalo&&ha.state&&ha.state.pointerId===M})}},{key:"showLayoutHaloFor",value:function(M,ha){ha=void 0===ha?this.firstHand&&this.firstHand.pointerId:
ha;var va=M===this?null:M.owner===this?M:M.ownerChain().slice(-2)[0];va=va?this.submorphs.indexOf(va)+1:this.submorphs.length;switch(M.layout.constructor){case Ka.ProportionalLayout:var Ua=new Ka.ProportionalLayoutHalo({container:M,pointerId:ha});break;case Ka.HorizontalLayout:case Ka.VerticalLayout:Ua=new Ka.FlexLayoutHalo({container:M,pointerId:ha});break;case Ka.GridLayout:Ua=new Ka.GridLayoutHalo({container:this.container,pointerId:ha})}return Ua&&this.addMorphAt(Ua,va)}},{key:"highlightMorph",
value:function(M,ha,va,Ua){Ua=void 0===Ua?[]:Ua;return Ka.MorphHighlighter.for(M,ha,void 0===va?!1:va,Ua)}},{key:"removeHighlighters",value:function(M){return Ka.MorphHighlighter.removeHighlighters(void 0===M?this:M)}},{key:"visibleStatusMessages",value:function(){return this.submorphs.filter(function(M){return M.isStatusMessage})}},{key:"visibleStatusMessagesFor",value:function(M){return this.submorphs.filter(function(ha){return ha.isStatusMessage&&ha.targetMorph===M})}},{key:"logErrorPreperation",
value:function(M){var ha=String(M),va=M.stack||"";va&&M.message!==M.stack&&(va=String(va),0===va.indexOf(ha)&&(va=va.slice(ha.length)),ha+="\n"+va);return ha}},{key:"logError",value:function(M){this.setStatusMessage(this.logErrorPreperation(M),Ka.Color.red)}},{key:"showError",value:function(M){return this.logError(M)}},{key:"showErrorFor",value:function(M,ha){return this.setStatusMessageFor(M,this.logErrorPreperation(ha),Ka.Color.red)}},{key:"setStatusMessageFor",value:function(M,ha,va,Ua,eb){Ua=
void 0===Ua?5E3:Ua;if(Ka.StatusMessageForMorph){this.visibleStatusMessagesFor(M).forEach(function(ob){return ob.remove()});ha=new Ka.StatusMessageForMorph(Object.assign({message:ha,color:va},eb));this.openStatusMessage(ha,Ua);ha.targetMorph=M;ha.fadeIn(300);if(ha.removeOnTargetMorphChange&&M.isText)Ka.once(M,"selectionChange",ha,"fadeOut",{converter:function(){return 200},garbageCollect:!0});return ha}}},{key:"setStatusMessage",value:function(M,ha,va,Ua){va=void 0===va?5E3:va;Ua=void 0===Ua?{}:Ua;
if(Ka.StatusMessage)return console[ha==Ka.Color.red?"error":"log"](M),Ka.config.verboseLogging?this.openStatusMessage(new Ka.StatusMessage(Object.assign({message:M,color:ha,hasFixedPosition:!0},Ua)),va):null}},{key:"openStatusMessage",value:function(M,ha){this.addMorph(M);if(M.slidable){for(var va=this.visibleStatusMessages(),Ua=$jscomp.makeIterator(va),eb=Ua.next();!eb.done;eb=Ua.next()){eb=eb.value;if(va.length<=(Ka.config.maxStatusMessages||0))break;!eb.stayOpen&&eb.slidable&&(eb.remove(),Ka.arr.remove(va,
eb))}Ka.arr.without(va,M).forEach(function(ob){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){!ob.isMaximized&&ob.slidable&&ob.slideTo(ob.position.addPt(Ka.pt(0,-M.extent.y-10)));Tb.jumpToEnd()})});va=this.visibleBounds().bottomRight().addXY(-20,-20);M.align(M.bounds().bottomRight(),va);M.topRight=va.addPt(Ka.pt(0,40));M.animate({bottomRight:va,duration:500})}"number"===typeof ha&&setTimeout(function(){return M.stayOpen||M.fadeOut()},ha);return M}},{key:"addProgressBar",value:function(M){M=
void 0===M?{}:M;var ha=this,va,Ua,eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ob){if(1==ob.nextAddress)return va=M,Ua=void 0===va.location?"center":va.location,ob.yield(Ka.loadObjectFromPartsbinFolder("progress bar"),2);eb=ob.yieldResult;Object.assign(eb,{progress:0},Ka.obj.dissoc(M,["location"]));ha.addMorph(eb);eb.align(eb[Ua],ha.visibleBounds()[Ua]());return ob.return(eb)})}},{key:"withProgressBarDo",value:function(M,ha){var va=this,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return eb.yield(va.addProgressBar(ha),
2);case 2:return Ua=eb.yieldResult,eb.setFinallyBlock(3),eb.yield(M(Ua),5);case 5:return eb.return(eb.yieldResult);case 3:eb.enterFinallyBlock(),Ua.remove(),eb.leaveFinallyBlock(0)}})}},{key:"openPrompt",value:function(M,ha){ha=void 0===ha?{requester:null,animated:!1}:ha;var va=this,Ua,eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ob){Ua=va.focusedMorph;eb=va.visibleBounds();return ob.return(va.withRequesterDo(ha.requester,function(Tb){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){M.openInWorldNear(Tb,
va);M.height>eb.height&&(M.height=eb.height-5);"function"===typeof ha.customize&&ha.customize(M);ha.animated&&va.previousPrompt&&va.previousPrompt.world()&&va.previousPrompt.transitionTo(M);va.previousPrompt=M;return Yb.return(Ka.promise.finally(M.activate(ha),function(){return Ua&&Ua.focus()}))})}))})}},{key:"withRequesterDo",value:function(M,ha){var va=this,Ua,eb,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){switch(Tb.nextAddress){case 1:eb=va.visibleBounds().center();if(!M){Tb.jumpTo(2);
break}eb=M.globalBounds().center();M.isWorld&&(eb=M.visibleBounds().center());if(!(Ua=M.getWindow())){Tb.jumpTo(2);break}return Tb.yield(Ua.toggleFader(!0),4);case 4:eb=Ua.globalBounds().center();case 2:return Tb.yield(ha(eb),5);case 5:return ob=Tb.yieldResult,Ua&&Ua.toggleFader(!1),Tb.return(ob)}})}},{key:"inform",value:function(M,ha){ha=void 0===ha?{fontSize:16,requester:null,animated:!0}:ha;return this.openPrompt(new Ka.InformPrompt(Object.assign({label:void 0===M?"no message":M},ha)),ha)}},{key:"prompt",
value:function(M,ha){ha=void 0===ha?{requester:null,input:"",historyId:null,useLastInput:!1,selectInput:!1}:ha;M=new Ka.TextPrompt(Object.assign({label:M},ha));ha.forceConfirm&&M.get("cancel button").disable();return this.openPrompt(M,ha)}},{key:"editPrompt",value:function(M,ha){ha=void 0===ha?{requester:null,input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null}:ha;return this.openPrompt(new Ka.EditPrompt(Object.assign({label:M},ha)),ha)}},{key:"passwordPrompt",value:function(M,
ha){ha=void 0===ha?{requester:null,input:""}:ha;return this.openPrompt(new Ka.PasswordPrompt(Object.assign({label:M},ha)),ha)}},{key:"confirm",value:function(M,ha){ha=void 0===ha?{requester:null,animated:!0}:ha;return this.openPrompt(new Ka.ConfirmPrompt(Object.assign({label:M},ha)),ha)}},{key:"multipleChoicePrompt",value:function(M,ha){ha=void 0===ha?{requester:null,animated:!0,choices:[]}:ha;return this.openPrompt(new Ka.MultipleChoicePrompt(Object.assign({label:M},ha)),ha)}},{key:"listPrompt",
value:function(M,ha,va){M=void 0===M?"":M;ha=void 0===ha?[]:ha;va=void 0===va?{requester:null,onSelection:null,preselect:0}:va;return this.openPrompt(new Ka.ListPrompt(Object.assign({filterable:!1,padding:Ka.Rectangle.inset(3),label:M,items:ha},va)),va)}},{key:"filterableListPrompt",value:function(M,ha,va){M=void 0===M?"":M;ha=void 0===ha?[]:ha;va=void 0===va?{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"}:
va;return va.prompt?(M=va.prompt.get("list"),M.items=ha,M.selectedIndex=va.preselect||0,this.openPrompt(va.prompt,va)):this.openPrompt(new Ka.ListPrompt(Object.assign({filterable:!0,padding:Ka.Rectangle.inset(3),label:M,items:ha},va)),va)}},{key:"editListPrompt",value:function(M,ha,va){ha=void 0===ha?[]:ha;va=void 0===va?{requester:null,multiSelect:!0,historyId:null}:va;return this.openPrompt(new Ka.EditListPrompt(Object.assign({label:void 0===M?"":M,multiSelect:!0,items:ha,padding:Ka.Rectangle.inset(3)},
va)),va)}},{key:"showLoadingIndicatorFor",value:function(M,ha){return this.addMorph(Ka.LoadingIndicator.open(ha,{center:M.globalBounds().center()}))}},{key:"defaultMenuItems",value:function(M,ha){function va(Wc){var Sd=this,Qd=eb.morphsContainingPoint(Tb.worldPoint(Ka.pt(0,0)));Qd.pop();var Ed=Qd.indexOf(Tb);Qd=Qd.slice(Ed+1);return Qd.map(function(yd){return[String(yd),Wc.bind(Sd,yd)]})}var Ua=this,eb=this,ob=[],Tb=M;this.reset&&"function"===typeof this.reset&&ob.push(["Reset",function(){Ua.reset()}]);
ob.push(["Open in...",[["Window",function(){Tb.openInWindow()}]]]);ob.push(["Add morph to...",{getItems:va.bind(Tb,function(Wc){return Wc.addMorph(Tb)})}]);ob.push(["Get halo on...",{getItems:va.bind(Tb,function(Wc){return Wc.world().showHaloFor(Wc)})}]);Tb.owner&&1<Tb.owner.submorphs.length&&ob.push(["Arrange morph",[["Bring to front",function(){return Tb.owner.addMorph(Tb)}],["Send to back",function(){return Tb.owner.addMorphBack(Tb)}],["Fit to submorphs",function(){var Wc,Sd,Qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ed){if(1==
Ed.nextAddress)return Ed.yield(Tb.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:Tb}),2);if(3!=Ed.nextAddress)return Wc=Ed.yieldResult,"string"!==typeof Wc?Ed.return():Ed.yield(Ka.runEval(Wc,{topLevelVarRecorder:{Rectangle:Ka.Rectangle}}),3);Sd=Ed.yieldResult;Wc=(Qd=Sd.value)&&Qd.isRectangle?Qd:Ka.Rectangle.inset(0);Tb.undoStart("fitToSubmorphs");Tb.fitToSubmorphs(Wc);Tb.undoStop("fitToSubmorphs");Ed.jumpToEnd()})}]].concat($jscomp.arrayFromIterable(Ka.PropertyPath("master.auto").get(Tb)?
[["Adjust to Master Component Submorph Hierarchy",function(){return Tb.master.reconcileSubmorphs()}]]:[]))]);this.submorphs.length&&ob.push(["Select all submorphs",function(){return Tb.world().showHaloFor(Tb.submorphs.slice())}]);var Yb=[];Tb.startSteppingScripts?Yb.push(["Start stepping",function(){Tb.startSteppingScripts()}]):Yb.push(["Start stepping",function(){var Wc,Sd,Qd,Ed,yd,ue,De,gg,pg,Tf,Le,Pg,tg,Xg,uf,Hf,Wd,wh,vb,nc,qd,rd,Pe,hf,Qg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qg){switch(qg.nextAddress){case 1:return Wc=
[],Sd=$jscomp,Qd=Sd.makeIterator,qg.yield(Ka.completions.getCompletions(function(){return Tb},""),2);case 2:Ed=Qd.call(Sd,qg.yieldResult.completions);for(yd=Ed.next();!yd.done;yd=Ed.next())for(ue=yd.value,De=$jscomp.makeIterator(ue),gg=De.next().value,pg=De.next().value,Tf=$jscomp.makeIterator(pg),Le=Tf.next();!Le.done;Le=Tf.next())Pg=Le.value,Pg.startsWith("_")||Pg.startsWith("$")||(tg=$jscomp.makeIterator(Pg.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[]),tg.next(),Xg=tg.next().value,uf=tg.next().value,
Xg&&"function"===typeof Tb[Xg]&&Wc.push({isListItem:!0,string:gg+" "+Pg,value:{selector:Xg,args:uf}}));return qg.yield($world.filterableListPrompt("Select method to start",Wc,{requester:Tb,historyId:"lively.morphic-start-stepping-chooser"}),3);case 3:return Hf=qg.yieldResult,Wd=$jscomp.makeIterator(Hf.selected),(wh=Wd.next().value)?qg.yield($world.prompt("Steptime in ms (how of the method will be called)?",{input:100}),4):qg.return();case 4:vb=qg.yieldResult;vb=Number(vb);if(isNaN(vb))return qg.return();
nc=[vb,wh.selector];if(!wh.args){qg.jumpTo(5);break}qd={targetModule:"lively://lively.morphic-stepping-args/eval.js"};return qg.yield($world.editPrompt("Arguments to pass",{input:"["+wh.args+"]",mode:"js",evalEnvironment:qd}),6);case 6:return rd=qg.yieldResult,qg.yield(Ka.runEval(rd,qd),7);case 7:Pe=qg.yieldResult;hf=Pe.value;if(Qg=Pe.isError)return $world.inform("Error evaluating the arguments: "+hf),qg.return();Array.isArray(hf)&&nc.push.apply(nc,$jscomp.arrayFromIterable(hf));case 5:Tb.startStepping.apply(Tb,
$jscomp.arrayFromIterable(nc)),qg.jumpToEnd()}})}]);0!=Tb.tickingScripts.length&&Yb.push(["Stop stepping",function(){return Tb.stopStepping()}]);0!=Yb.length&&ob.push(["Stepping",Yb]);ob.push(["Change Tooltip",function(){var Wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sd){if(1==Sd.nextAddress)return Wc=Tb,Sd.yield(Tb.world().prompt("Enter Tooltip",{placeholder:"Description",input:Tb.tooltip||""}),2);Wc.tooltip=Sd.yieldResult;Sd.jumpToEnd()})}]);var yc=["Morphic properties",[]];
ob.push(yc);ob.push(["display serialization info",function(){var Wc,Sd,Qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ed){if(1==Ed.nextAddress)return Ed.yield(System.import("lively.serializer2/debugging.js"),2);Wc=Ed.yieldResult;Sd=Wc.SnapshotInspector;Qd=Ka.serialize(Tb);Sd.forSnapshot(Qd).openSummary();Ed.jumpToEnd()})}]);ob.push(["display object report",function(){var Wc,Sd,Qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ed){if(1==Ed.nextAddress)return Ed.yield(System.import("lively.serializer2/debugging.js"),
2);Wc=Ed.yieldResult;Sd=Wc.SnapshotInspector;Qd=Ka.serialize(Tb);Sd.forSnapshot(Qd).openObjectReport();Ed.jumpToEnd()})}]);var md=Ka.Icon.textAttribute("check-square"),Bd=Ka.Icon.textAttribute("square");Object.assign(md[1],{float:"none",display:"inline"});["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(Wc){return yc[1].push([[].concat($jscomp.arrayFromIterable(M[Wc]?md:Bd),[" "+Wc,{float:"none"}]),function(){return M[Wc]=!M[Wc]}])});ob.push(["export to HTML",function(){var Wc,
Sd,Qd,Ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yd){if(1==yd.nextAddress)return yd.yield(System.import("lively.morphic/rendering/html-generator.js"),2);if(3!=yd.nextAddress)return Wc=yd.yieldResult,Sd=Wc.generateHTML,Qd=Ka.HTMLMorph,Ed="exported-"+M.name,yd.yield(Sd(M,null,{isFragment:!0,addStyles:!1}),3);(new Qd({name:Ed,html:yd.yieldResult})).openInWorld();yd.jumpToEnd()})}]);ob.push({isDivider:!0});ob.push(["Add comment",function(){var Wc,Sd,Qd,Ed;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yd){if(1==
yd.nextAddress)return yd.yield($world.prompt("Enter comment"),2);if(4!=yd.nextAddress){Wc=yd.yieldResult;if(!Wc)return $world.setStatusMessage("Comment not saved","red"),yd.jumpTo(0);Sd=Ka.pt(0,0);ha&&!ha.halo&&(Qd=Tb.localize(ha.position).x/Tb.width,Ed=Tb.localize(ha.position).y/Tb.height,Sd=Ka.pt(Qd,Ed));return yd.yield(Tb.addComment(Wc,Sd),4)}$world.setStatusMessage("Comment saved","green");yd.jumpToEnd()})}]);return ob}},{key:"defaultConnectionMenuItems",value:function(M){return M.attributeConnections&&
M.attributeConnections.length?M.attributeConnections.map(function(ha){return[String(ha),[["show",function(){var va,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){if(1==eb.nextAddress)return eb.yield(System.import("lively.ide/fabrik.js"),2);va=eb.yieldResult;Ua=va.interactivelyShowConnection;Ua(ha);eb.jumpToEnd()})}],["edit",function(){var va,Ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){if(1==eb.nextAddress)return eb.yield(System.import("lively.ide/fabrik.js"),
2);va=eb.yieldResult;Ua=va.interactivelyReEvaluateConnection;Ua(ha);eb.jumpToEnd()})}],["disconnect",function(){ha.disconnect();$world.setStatusMessage("disconnected "+ha)}]]]}):null}},{key:"defaultSourceDataBindings",value:function(M){var ha=M.propertiesAndPropertySettings().properties,va=Ka.arr.groupByKey(Object.keys(ha).map(function(eb){eb=Object.assign({name:eb},ha[eb]);return eb.group&&eb.group.startsWith("_")?null:eb}).filter(Boolean),"group");M=["core","geometry","interaction","styling","layouting"];
var Ua=[];M.forEach(function(eb){return Ua.push(va[eb])});Ka.arr.withoutAll(va.keys(),M).forEach(function(eb){return Ua.push(va[eb])});return Ua}},{key:"targetDataBindings",value:function(M){for(var ha=[],va=M;va!==Object.prototype;){var Ua=va===M?String(this):Ka.getClassName(va),eb=null,ob=Ka.obj.getOwnPropertyDescriptors(va),Tb=Object.getPrototypeOf(va),Yb;for(Yb in ob){var yc=ob[Yb].value;"function"!==typeof yc||yc===va.constructor||Yb.startsWith("$")||Yb.startsWith("_")||(eb||(eb=[]),yc=Ka.fun.argumentNames(yc),
eb.push({group:Ua+" methods",signature:Yb+"("+yc.join(", ")+")",name:Yb}))}eb&&ha.push(eb);va=Tb}return this.defaultSourceDataBindings(M).concat(ha)}},{key:"defaultConnectMenuItems",value:function(M,ha){var va=this,Ua=this.defaultSourceDataBindings(ha),eb=ha.world();Ua=Ua.map(function(ob){return[ob[0].group||"uncategorized",ob.map(function(Tb){return[Tb.name,M?function(){return M(Tb.name,ha,Tb)}:function(){var Yb,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(md){if(1==md.nextAddress)return md.yield(System.import("lively.ide/fabrik.js"),
2);Yb=md.yieldResult;yc=Yb.interactiveConnectGivenSource;yc(ha,Tb.name);md.jumpToEnd()})}]})]});eb&&Ua.push(["custom...",M?function(){return M("custom...",ha,null)}:function(){var ob,Tb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){if(1==yc.nextAddress)return yc.yield(System.import("lively.ide/fabrik.js"),2);if(3!=yc.nextAddress)return ob=yc.yieldResult,Tb=ob.interactiveConnectGivenSource,yc.yield(eb.prompt("Enter custom connection point",{requester:ha,historyId:"lively.morphic-custom-connection-points",
useLastInput:!0}),3);(Yb=yc.yieldResult)&&Tb(va,Yb);yc.jumpToEnd()})}]);return Ua}},{key:"handleHaloCycle",value:function(M){var ha=M.state.clickedOnMorph,va=M.isCommandKey(),Ua=M.isShiftDown(),eb;va&&!ha.isHalo&&(va=eb=M.world.morphsContainingPoint(M.position),eb=eb.filter(function(ob){return ob.halosEnabled}),va=va.filter(function(ob){return ob.halosEnabled}),eb=va[0]||eb[0]);Ua&&!ha.isHaloItem&&eb&&M.halo&&M.halo.borderBox!=eb?M.halo.addMorphToSelection(eb):(ha=M.halo&&!M.targetMorphs.find(function(ob){return ob.isHaloItem||
ob.keepHalo&&ob.keepHalo(M)}),Ua=M.layoutHalo&&!M.targetMorphs.find(function(ob){return ob.isHaloItem}),va=(!M.halo||ha)&&eb,Ua&&M.layoutHalo.remove(),ha&&M.halo.remove(),va&&(M.stop(),this.showHaloFor(eb,M.domEvt.pointerId)))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyWorld"}},{key:"properties",get:function(){return{localComponents:{initialize:function(){var M=this;this.whenRendered().then(function(){M.localComponents?M.localComponents.forEach(function(ha){var va,Ua,eb,
ob,Tb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:if(ha.owner){yc.jumpTo(0);break}va=ha.withAllSubmorphsSelect(function(md){return md.master&&!md.master._appliedMaster});Ua=$jscomp.makeIterator(va);eb=Ua.next();case 3:if(eb.done){yc.jumpTo(5);break}ob=eb.value;return yc.yield(ob.master.applyIfNeeded(!0),4);case 4:eb=Ua.next();yc.jumpTo(3);break;case 5:Tb=M.withAllSubmorphsSelect(function(md){return md.master&&md.master.uses(ha)}),Yb=M.localComponents.filter(function(md){return md.master&&
md.master.uses(ha)}),Tb.forEach(function(md){md.requestMasterStyling()}),Yb.forEach(function(md){return md.master.applyIfNeeded(!0)}),yc.jumpToEnd()}})}):M.localComponents=M.withAllSubmorphsSelect(function(ha){return ha.isComponent})})}},name:{set:function(M){this.setProperty("name",M);document.title="lively.next - "+M}},hiddenComponents:{initialize:function(){this.hiddenComponents=[]}},fill:{defaultValue:Ka.Color.rgb(81,90,90)},draggable:{readOnly:!0,get:function(){return!Ka.touchInputDevice}},commentBrowser:{}}}}],
G,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1664,end:42214})}(Ka.World);Ka.LivelyWorld=fe;Ka.LivelyWorld=fe;Ka.LivelyWorld=fe;pe=za("a",function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),wa=G.hasOwnProperty("SelectionElement")&&"function"===typeof G.SelectionElement?
G.SelectionElement:G.SelectionElement=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,N,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SelectionElement"}},{key:"properties",get:function(){return{borderColor:{defaultValue:Ka.Color.red},borderWidth:{defaultValue:1},fill:{defaultValue:Ka.Color.transparent},epiMorph:{defaultValue:!0},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],
G,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42223,end:42585})}(Ka.Morph));Ka.SelectionElement=pe;Ka.SelectionElement=pe;Ka.SelectionElement=pe;Ga=za("S",function(N){var G=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),wa=G.hasOwnProperty("Selection")&&"function"===typeof G.Selection?
G.Selection:G.Selection=function(M){M&&M[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lc(wa,N,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Selection"}},{key:"properties",get:function(){return{fill:{defaultValue:Ka.Color.gray.withA(.2)},borderWidth:{defaultValue:2},borderColor:{defaultValue:Ka.Color.gray},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],G,{pathInPackage:function(){return"world.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42594,end:42914})}(Ka.Morph));Ka.Selection=Ga;Ka.Selection=Ga;Ka.Selection=Ga;fe=Object.freeze({__proto__:null,LivelyWorld:fe,SelectionElement:pe,Selection:Ga});za("w",fe)}}});