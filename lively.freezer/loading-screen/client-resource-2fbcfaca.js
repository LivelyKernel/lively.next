System.register(["./__root_module__-3d4e820f.js","kld-intersections","./client-command-dd287010.js"],function(ra){var kb,zb,Sb,Mb,Fd,Jc;return{setters:[function(wd){kb=wd.s;zb=wd.$;Sb=wd.a6;Mb=wd.bE;Fd=wd.a7},function(){},function(wd){Jc=wd.runCommand}],execute:function(){function wd(Na,nb){var Pb,Wb,Pc,Bd,Hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){if(1==Ub.nextAddress)return Pb=hd.fileInfoCommandString(Na,nb),Wb=hd.runCommand(Pb,nb),Ub.yield(Wb.whenDone(),2);if(Pc=0!=
Wb.exitCode?Wb.output:null)throw Pc;Bd=$jscomp.makeIterator(hd.parseDirectoryListFromLs(Wb.stdout,nb.rootDirectory||"."));Hb=Bd.next().value;return Ub.return(Hb)})}function Kc(Na,nb){return hd.string.lines(Na).map(function(Pb){return Pb.trim().length?(new hd.FileInfo(nb)).readFromDirectoryListLine(Pb):null}).filter(Boolean)}function Fc(Na,nb){var Pb,Wb,Pc,Bd,Hb,Ub,vb,kc,xc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Dc){Pb=Object.assign({findFilesGroup:"default-find-files-process"},
nb);Wb=Pb.findFilesGroup;Pc=Pb.rootDirectory;Hb=Bd=hd.findFilesProcesses[Wb]||(hd.findFilesProcesses[Wb]={promiseState:null,commands:[]});Ub=Hb.commands;vb=Hb.promiseState;vb||(Bd.promiseState=vb=hd.promise.deferred());kc=hd.findFilesCommandString(Na,nb);Ub.forEach(function(Gb){return Gb.kill()});xc=hd.runCommand(kc,nb);Ub.push(xc);xc.whenDone().then(function(){hd.arr.remove(Ub,xc);if(Ub.some(function($a){return $a.startTime>xc.startTime}))console.log("[findFiles] command "+xc+" exited but a newer findFiles command was started for group "+
Wb+", discarding output");else{var Gb=0!=xc.exitCode?xc.output:null;Gb&&console.warn(Gb);Gb=Gb?[]:hd.parseDirectoryListFromLs(xc.stdout,Pc)||[];vb.resolve(Gb);Object.assign(Bd,{promiseState:null,commands:[]})}}).catch(function(Gb){return console.error(Gb)});return Dc.return(vb.promise)})}function Wc(Na){function nb(Pb){return Array.prototype.concat.apply([Pb],Pb.children?Pb.children.map(nb):[])}return nb(Na).map(function(Pb){var Wb=Pb.fullPath.replace(/^\//,"");return{fileName:Wb,path:Wb,rootDirectory:"./",
isDirectory:Pb.isDirectory,isLink:void 0,lastModified:void 0,linkCount:void 0,mode:void 0,size:void 0,group:void 0,user:void 0}})}var hd=lively.FreezerRuntime.recorderFor("lively.shell/client-fs-helper.js");hd.fileInfo=wd;hd.fileInfoCommandString=function(Na,nb){var Pb=nb=void 0===nb?{}:nb;nb=Pb.rootDirectory;Pb=Pb.platform;nb=nb||".";var Wb="win32"===Pb?"\\":"/";"win32"===Pb||nb.endsWith(Wb)||(nb+=Wb);return"win32"===Pb?"cd "+nb+' && ls -lLd --time-style=locale "'+Na+'"':'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && env TZ=GMT LANG=en_US.UTF-8 cd '+
(nb+' && ls -lLd "$timeformat" "'+Na+'"')};hd.parseDirectoryListFromLs=Kc;hd.findFiles=Fc;hd.findFilesCommandString=function(Na,nb){var Pb=nb=void 0===nb?{}:nb,Wb=Pb.rootDirectory,Pc=Pb.exclude,Bd=Pb.depth;Pb=Pb.platform;Wb=Wb||".";Pc=Pc||"-iname "+hd.defaultExcludes.map(hd.string.print).join(" -o -iname ");var Hb="win32"===Pb?"\\":"/";"win32"===Pb||Wb.endsWith(Hb)||(Wb+=Hb);Na=hd.string.format('%s "%s"',nb.re?"-iregex":nb.matchPath?"-ipath":"-iname",Na);Bd="number"===typeof Bd?" -maxdepth "+Bd:"";
return"win32"===Pb?hd.string.format("find %s %s ( %s ) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd --time-style=locale {}",Wb,nb.re?"-E ":"",Pc.replace(/"/g,""),Na.replace(/"/g,""),Bd):'if [ "$(uname)" = "Darwin" ];\n      then timeformat=\'-T\'; else\n      timeformat="--time-style=+%b %d %T %Y";\n    fi && '+hd.string.format('env TZ=GMT LANG=en_US.UTF-8 find %s %s \\( %s \\) -prune -o %s %s -print0 | xargs -0 -I{} ls -lLd "$timeformat" "{}"',Wb,nb.re?"-E ":"",Pc,Na,Bd)};hd.convertDirectoryUploadEntriesToFileInfos=
Wc;hd.runCommand=Jc;hd.string=kb;hd.promise=zb;hd.arr=Sb;hd.fileInfo=wd;hd.fileInfo=wd;hd.parseDirectoryListFromLs=Kc;hd.parseDirectoryListFromLs=Kc;var Id=function(Na){this.rootDirectory=Na;this.fileName=this.path="";this.isDirectory=!1;this.lastModified=null;this.mode="";this.isLink=!1;this.linkCount=0;this.group=this.user="";this.size=0;this.rootDirectory=null};Id.prototype.readFromDirectoryListLine=function(Na){var nb=this;if(!Na.trim().length)return null;var Pb=Na;this.reader.forEach(function(Wb){return Pb=
Wb(Pb,nb)});return this};Id.prototype.toString=function(){return this.path};$jscomp.global.Object.defineProperties(Id.prototype,{reader:{configurable:!0,enumerable:!0,get:function(){return[function(Na,nb){var Pb=Na.indexOf(" ");nb.mode=Na.slice(0,Pb);nb.isDirectory="d"===nb.mode[0];return Na.slice(Pb+1).trim()},function(Na,nb){var Pb=Na.indexOf(" ");nb.linkCount=Number(Na.slice(0,Pb));return Na.slice(Pb+1).trim()},function(Na,nb){var Pb=Na.indexOf(" ");nb.user=Na.slice(0,Pb);return Na.slice(Pb+1).trim()},
function(Na,nb){var Pb=hd.string.peekRight(Na,0,/\s+[0-9]/);nb.group=Na.slice(0,Pb).trim();return Na.slice(Pb).trim()},function(Na,nb){var Pb=Na.indexOf(" ");nb.size=Number(Na.slice(0,Pb));return Na.slice(Pb+1).trim()},function(Na,nb){var Pb=hd.string.reMatches(Na,/[^s]+\s+[0-9:\s]+/);if(!Pb||!Pb[0])return Na;nb.lastModified=new Date(Pb[0].match+" GMT");return Na.slice(Pb[0].end).trim()},function(Na,nb){var Pb=(Na=Na.replace(/^\.\/+/g,"").replace(/\/\//g,"/"))&&Na.split(" -> "),Wb=""===Na?!1:Na&&
2===Pb.length,Pc=(Pb=Wb?Pb[0]:Na)&&0===Pb.indexOf(nb.rootDirectory)?Pb.slice(nb.rootDirectory.length):Pb;nb.fileName=""===Na?".":Pc;nb.path=Pb;nb.isLink=Wb;return Pc}]}}});hd.FileInfo=Id;hd.findFilesProcesses={};hd.findFiles=Fc;hd.findFiles=Fc;hd.defaultExcludes=[".svn",".git","node_modules",".module_cache"];hd.convertDirectoryUploadEntriesToFileInfos=Wc;hd.convertDirectoryUploadEntriesToFileInfos=Wc;var nd=lively.FreezerRuntime.recorderFor("lively.shell/client-resource.js");nd.Resource=Mb;nd.runCommand=
Jc;nd.fileInfo=wd;nd.findFiles=Fc;nd.string=kb;nd.promise=zb;nd.arr=Sb;nd.obj=Fd;Id=function(Na,nb,Pb){Pb=void 0===Pb?{}:Pb;Na=nd.Resource.call(this,Na)||this;Na.options=Object.assign({},Pb,{l2lClient:nb||Na.constructor.defaultL2lClient});return Na};$jscomp.inherits(Id,nd.Resource);Id.prototype.newResource=function(Na){return new this.constructor(Na,this.options.l2lClient,this.options)};Id.prototype.read=function(){var Na=this,nb=nd.runCommand('cat "'+this.url+'"',this.options);return nb.whenDone().then(function(){if(nb.exitCode)throw Error("Read "+
Na.url+" failed: "+nb.stderr);return nb.output})};Id.prototype.write=function(Na){var nb=this,Pb,Wb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pc){switch(Pc.nextAddress){case 1:return Na?Pc.yield(nd.runCommand('touch "'+nb.url+'" && tee "'+nb.url+'"',Object.assign({stdin:String(Na)},nb.options)).whenDone(),4):Pc.yield(nd.runCommand('echo -n > "'+nb.url+'"',Object.assign({},nb.options)).whenDone(),5);case 4:Pb=Pc.yieldResult;Pc.jumpTo(3);break;case 5:Pb=Pc.yieldResult;case 3:Wb=Pb;
if(Wb.exitCode)throw Error("Write "+nb.url+" failed: "+Wb.stderr);return Pc.return(nb)}})};Id.prototype.mkdir=function(){var Na=this,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){if(1==Pb.nextAddress)return Pb.yield(nd.runCommand('mkdir -p "'+Na.url+'"',Na.options).whenDone(),2);nb=Pb.yieldResult;if(nb.exitCode)throw Error(Na+" cannot create directory: "+nb.stderr);return Pb.return(Na)})};Id.prototype.exists=function(){var Na=nd.runCommand('test -d "'+this.url+'" || test -f "'+
this.url+'"',this.options);return Na.whenDone().then(function(){return 0===Na.exitCode})};Id.prototype.remove=function(){var Na=this,nb=nd.runCommand('rm -rf "'+this.url+'"',this.options);return nb.whenDone().then(function(){if(nb.exitCode)throw Error("Remove of "+Na.url+" failed: "+nb.stderr);return Na})};Id.prototype.gzip=function(Na){var nb=this,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wb){Pb=nd.runCommand('gzip > "'+nb.url+'"',Object.assign({stdin:String(Na)},nb.options));
return Wb.return(Pb.whenDone().then(function(){if(Pb.exitCode)throw Error("Gzip compression of "+nb.url+" failed: "+Pb.stderr);return nb}))})};Id.prototype.brotli=function(Na){var nb=this,Pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wb){Pb=nd.runCommand('brotli > "'+nb.url+'"',Object.assign({stdin:String(Na)},nb.options));return Wb.return(Pb.whenDone().then(function(){if(Pb.exitCode)throw Error("Brotli compression of "+nb.url+" failed: "+Pb.stderr);return nb}))})};Id.prototype.readProperties=
function(){var Na=this,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){if(1==Pb.nextAddress)return Pb.yield(nd.fileInfo(Na.url,Na.options),2);nb=Pb.yieldResult;Na.assignProperties(nd.obj.dissoc(nb,["fileName","path","rootDirectory"]));return Pb.return(Na)})};Id.prototype.dirList=function(Na,nb){Na=void 0===Na?1:Na;nb=void 0===nb?{}:nb;var Pb=this,Wb,Pc,Bd,Hb,Ub,vb,kc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xc){if(1==xc.nextAddress)return Wb=nb,Pc=Wb.exclude,
Array.isArray(Pc)&&(Pc="-iname "+Pc.map(nd.string.print).join(" -o -iname ")),Bd=Pb,Hb=Bd.url,Ub=Bd.options,vb=Ub.l2lClient,xc.yield(nd.findFiles("*",{exclude:Pc,depth:Na,rootDirectory:Hb,l2lClient:vb}),2);kc=xc.yieldResult;kc[0].path.replace(/\/$/,"")===Pb.url.replace(/\/$/,"")&&kc.shift();return xc.return(kc.map(function(Dc){var Gb=Dc.path;Dc.isDirectory&&(Gb=Gb.replace(/\/?$/,"/"));Gb=new Pb.constructor(Gb,vb,Pb.options);Gb.assignProperties(nd.obj.dissoc(Dc,["fileName","path","rootDirectory"]));
return Gb}))})};$jscomp.global.Object.defineProperties(Id,{defaultL2lClient:{configurable:!0,enumerable:!0,get:function(){return this._defaultL2lClient||nd._defaultL2LClient},set:function(Na){this._defaultL2lClient=nd._defaultL2LClient=Na}}});ra("default",Id);nd.ShellClientResource=Id;nd._defaultL2LClient=nd._defaultL2LClient||void 0;var Xc=ra("resourceExtension",{name:"shell-client",matches:function(Na){return Na.startsWith("/")||Na.match(/[a-z]:\\/i)},resourceClass:nd.ShellClientResource});nd.resourceExtension=
Xc;nd.resourceExtension=Xc;nd.resourceExtension=Xc;nd.default=Id}}});