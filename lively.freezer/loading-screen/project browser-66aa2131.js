System.register(["./__root_module__-3d4e820f.js","kld-intersections","./user-ui-0b738134.js","./index-da7fb446.js","./index-a37f4074.js"],function(ra,kb){var zb,Sb,Mb,Fd,Jc,wd,Kc,Fc,Wc,hd,Id,nd,Xc,Na,nb,Pb,Wb,Pc,Bd;return{setters:[function(Hb){zb=Hb.ai;Sb=Hb.aB;Mb=Hb.ak;Fd=Hb.an;Jc=Hb.Z;wd=Hb.a6;Kc=Hb.at;Fc=Hb.s;Wc=Hb.C;hd=Hb.a3;Id=Hb.r;nd=Hb.as;Xc=Hb.aA;Na=Hb.a_;nb=Hb.a$;Pb=Hb.aq;Wb=Hb.aX;Pc=Hb.aW},function(){},function(Hb){Bd=Hb.UserUI},function(){},function(){}],execute:function(){var Hb=
lively.FreezerRuntime.recorderFor("WorldDashboard/index.js");Hb.Morph=zb;Hb.HorizontalLayout=Sb;Hb.VerticalLayout=Mb;Hb.morph=Fd;Hb.MorphicDB=Jc;Hb.arr=wd;Hb.fun=Kc;Hb.string=Fc;Hb.Color=Wc;Hb.pt=hd;Hb.UserUI=Bd;Hb.resource=Id;var Ub=function(xc){var Dc=lively.FreezerRuntime.recorderFor("WorldDashboard/index.js"),Gb=Dc.hasOwnProperty("WorldDashboard")&&"function"===typeof Dc.WorldDashboard?Dc.WorldDashboard:Dc.WorldDashboard=function($a){$a&&$a[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return nd(Gb,xc,[{key:"focus",value:function(){this.ui.searchField.focus()}},{key:"update",value:function(){this.displayWorlds()}},{key:"beforePublish",value:function(){this.reset()}},{key:"reset",value:function(){this.ui.worldList.items=[];this.ui.noWorldWarning.visible=!1}},{key:"relayout",value:function(){this.alignInWorld()}},{key:"alignInWorld",value:function($a){$a=void 0===$a?$world:$a;this.owner!=$a&&$a.addMorph(this);this.center=$a.visibleBounds().center()}},{key:"sortAndFilterPreviews",
value:function($a){var dc=Hb.UserUI.getCurrentUser();$a=this.ui.searchField.fuzzyFilter($a,function(oc){return oc._commit.name+oc._commit.description});switch(this.ui.sortSelector.selection){case "RECENT":return Hb.arr.sortBy($a,function(oc){return-oc._commit.timestamp});case "TEMPLATES":return $a;case "MY PROJECTS":return Hb.arr.filter($a,function(oc){return oc._commit.author.name===dc.name});case "PUBLISHED":return $a}}},{key:"updateList",value:function(){var $a=this;this.previews&&Hb.fun.debounceNamed("update world list",
150,function(){$a.ui.worldList.items=$a.sortAndFilterPreviews($a.previews)})()}},{key:"displayWorlds",value:function(){var $a=this,dc,oc,sa,Ca,bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rb){switch(rb.nextAddress){case 1:return $a.reset(),dc=$a.ui,oc=dc.loadingLabel,oc.animate({opacity:1,duration:300}),rb.yield($a.db.latestCommits("world"),2);case 2:return sa=rb.yieldResult,rb.yield(kb.import("./world preview-f2b94d19.js"),4);case 4:if(!(Ca=rb.yieldResult)){rb.jumpTo(5);break}return rb.yield(Hb.resource("part://partial freezing/world preview"),
6);case 6:Ca=rb.yieldResult;case 5:return rb.yield(Ca.read(),3);case 3:return bb=rb.yieldResult,$a.previews=sa.map(function(qb){var Sa=Hb.morph({reactsToPointer:!1,fill:Hb.Color.transparent,extent:bb.extent});Sa._commit=qb;Sa.displayPreview=function(){var Ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){if(1==sb.nextAddress)return Ta=bb.copy(),Ta._commit=qb,Ta.opacity=0,Sa.addMorph(Ta),Ta.displayPreview(),Ta.position=Hb.pt(0,0),sb.yield(Sa.whenRendered(),2);Sa.layout=new Hb.HorizontalLayout({autoResize:!0,
reactToSubmorphAnimations:!0});sb.jumpToEnd()})};return Sa}),rb.yield(oc.animate({opacity:0,duration:300}),7);case 7:$a.updateList(),0==sa.length&&($a.ui.noWorldWarning.center=$a.innerBounds().center(),$a.ui.noWorldWarning.animate({visible:!0,duration:300})),rb.jumpToEnd()}})}},{key:"createNewProject",value:function(){document.location="/worlds/load?name=__newWorld__"}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"WorldDashboard"}},{key:"properties",get:function(){return{showCloseButton:{derived:!0,
get:function(){return this.ui.closeButton.visible},set:function($a){this.ui.closeButton.visible=$a}},db:{serialize:!1,get:function(){return Hb.MorphicDB.default}},ui:{derived:!0,get:function(){return{worldList:this.getSubmorphNamed("world list"),sortSelector:this.getSubmorphNamed("search selector"),searchField:this.getSubmorphNamed("search field"),closeButton:this.getSubmorphNamed("close button"),loadingLabel:this.getSubmorphNamed("loading label"),noWorldWarning:this.getSubmorphNamed("no world warning")}}}}}}],
Dc,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldDashboard",version:"0.1.1-127"}}},{start:330,end:3954})}(Hb.Morph);Ub=Hb.WorldDashboard;Hb.default=Ub;var vb=lively.FreezerRuntime.recorderFor("GrowingWorldList/index.js");vb.Morph=zb;vb.touchInputDevice=Xc;vb.TilingLayout=Na;vb.arr=wd;vb.pt=hd;Ub=function(xc){var Dc=lively.FreezerRuntime.recorderFor("GrowingWorldList/index.js"),
Gb=Dc.hasOwnProperty("GrowingWorldList")&&"function"===typeof Dc.GrowingWorldList?Dc.GrowingWorldList:Dc.GrowingWorldList=function($a){$a&&$a[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return nd(Gb,xc,[{key:"onLoad",value:function(){this.clipMode="auto"}},{key:"onScroll",value:function($a){nd._get(Object.getPrototypeOf(Gb.prototype),"onScroll",this).call(this,$a);this.update()}},{key:"onChange",value:function($a){nd._get(Object.getPrototypeOf(Gb.prototype),
"onChange",this).call(this,$a);"extent"==$a.prop&&this.update(!0)}},{key:"onHoverIn",value:function($a){this.clipMode="auto"}},{key:"onHoverOut",value:function($a){vb.touchInputDevice||(this.clipMode="hidden")}},{key:"update",value:function($a){var dc=this.items;if(dc&&0!=dc.length){var oc=this.scrollContainer,sa=oc.layout.spacing;oc.extent=this.extent;var Ca=this.ui,bb=Ca.bufferTop;Ca=Ca.bufferBottom;bb=bb||oc.addMorph({fill:null,name:"buffer top",height:10});Ca=Ca||oc.addMorph({fill:null,name:"buffer bottom",
height:10});bb.width=Ca.width=this.width-100;oc.layout.disable();var rb=dc[0];sa=dc.slice(0,Math.floor(this.width/(rb.width+sa))*(Math.ceil((this.scroll.y+this.height)/(rb.height+sa))+1)).filter(function(sb){return sb.owner!=oc});rb=this.scroll.y+2*this.height;for(var qb={},Sa=$jscomp.makeIterator(sa),Ta=Sa.next();!Ta.done;qb={$jscomp$loop$prop$item$2278:qb.$jscomp$loop$prop$item$2278},Ta=Sa.next())qb.$jscomp$loop$prop$item$2278=Ta.value,rb++,qb.$jscomp$loop$prop$item$2278.top=rb,oc.addMorph(qb.$jscomp$loop$prop$item$2278),
qb.$jscomp$loop$prop$item$2278._initialized||qb.$jscomp$loop$prop$item$2278.whenRendered().then(function(sb){return function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zb){sb.$jscomp$loop$prop$item$2278._initialized=!0;return Zb.yield(sb.$jscomp$loop$prop$item$2278.displayPreview(),0)})}}(qb));$a&&(bb.position=vb.pt(0,0),dc.forEach(function(sb,Zb){return sb.position=vb.pt(Zb+1,Zb+1)}),Ca.position=vb.pt(dc.length+2,dc.length+2));oc.layout.enable();if($a||0<sa.length)Ca.top=this.submorphBounds().height,
oc.layout.apply()}}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GrowingWorldList"}},{key:"properties",get:function(){return{scrollContainer:{get:function(){return this.getSubmorphNamed("scroll container")||this.addMorph({name:"scroll container",fill:null,reactsToPointer:!1,renderOnGPU:!0,layout:new vb.TilingLayout({spacing:25,align:"center",autoResize:!0})})}},ui:{get:function(){return{bufferTop:this.getSubmorphNamed("buffer top"),bufferBottom:this.getSubmorphNamed("buffer bottom")}}},
items:{after:["layout","scrollContainer"],set:function($a){this.setProperty("items",$a);var dc=this.scrollContainer;dc.layout&&dc.layout.disable();var oc=this.ui,sa=oc.bufferTop;oc=oc.bufferBottom;vb.arr.withoutAll(dc.submorphs,[].concat($jscomp.arrayFromIterable($a),[sa,oc])).forEach(function(Ca){return Ca.remove()});this.update(!0)}}}}}],Dc,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"GrowingWorldList",version:"0.1.1-32"}}},{start:179,end:3777})}(vb.Morph);Ub=vb.GrowingWorldList;vb.default=Ub;var kc=lively.FreezerRuntime.recorderFor("SearchInputLine/index.js");kc.InputLine=nb;kc.Color=Wc;kc.connect=Pb;kc.disconnectAll=Wb;kc.disconnect=Pc;kc.arr=wd;kc.string=Fc;Ub=function(xc){var Dc=lively.FreezerRuntime.recorderFor("SearchInputLine/index.js"),Gb=Dc.hasOwnProperty("SearchInputLine")&&"function"===typeof Dc.SearchInputLine?Dc.SearchInputLine:Dc.SearchInputLine=
function($a){$a&&$a[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return nd(Gb,xc,[{key:"fuzzyMatch",value:function($a,dc){dc=void 0===dc?this.parseInput():dc;if(dc.lowercasedTokens.every(function(sa){return $a.toLowerCase().includes(sa)}))return!0;var oc=$a.toLowerCase();return 3>=kc.arr.sum(dc.lowercasedTokens.map(function(sa){return kc.string.levenshtein(oc,sa)}))}},{key:"fuzzyFilter",value:function($a,dc){var oc=this;dc=void 0===
dc?function(Ca){return Ca}:dc;var sa=this.parseInput();return kc.arr.filter($a,function(Ca){return oc.fuzzyMatch(dc(Ca),sa)})}},{key:"parseInput",value:function(){var $a=Array.from(this.textString).reduce(function(oc,sa){if("\\"===sa&&!oc.escaped)return oc.escaped=!0,oc;" "!==sa||oc.escaped?(oc.spaceSeen=!1,oc.current+=sa):(!oc.spaceSeen&&oc.current&&(oc.tokens.push(oc.current),oc.current=""),oc.spaceSeen=!0);oc.escaped=!1;return oc},{tokens:[],current:"",escaped:!1,spaceSeen:!1});$a.current&&$a.tokens.push($a.current);
var dc=$a.tokens.map(function(oc){return oc.toLowerCase()});return{tokens:$a.tokens,lowercasedTokens:dc}}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SearchInputLine"}}],Dc,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"SearchInputLine",version:"0.1.1-4"}}},{start:239,end:1834})}(kc.InputLine);Ub=kc.SearchInputLine;
kc.default=Ub}}});