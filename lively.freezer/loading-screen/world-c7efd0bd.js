System.register(["./__root_module__-28353364.js","./index-113b6183.js","./index-2245b428.js","./color-picker-93cc3061.js"],function(Ia){var mb,vb,Vb,Eb,Jc,Bc,Uc,tc,oc,sc,Tc,Fd,Rd,ee,Dc,rd,Ab,qc,Xc,zc,ed,wd,xb,hc,Cc,ic,Qc,jb,fb,Ob,Cb,ob,bc,Ma,Db,gb,zb,ec,rc,Qb,Lb,Kb,za,bb,P,X,ya,Ga,wa,ja,lb,Ja,Xb,Kc,Hb,Oc,qb,xd,he,xc,rb,Ld,sb,hb,Ba,J,ta,Ta,tb,Rb,mc,Zb,Rc,Sc,$d,r,Ud,ke,le,ie,yd,Wd,De,Fe;return{setters:[function(md){mb=md.S;vb=md.R;Vb=md.$;Eb=md.C;Jc=md.b;Bc=md.a0;Uc=md.a1;tc=md.P;oc=md.a;sc=md.s;
Tc=md.Y;Fd=md.a2;Rd=md.e;ee=md.m;Dc=md.K;rd=md.g;Ab=md.a3;qc=md.a4;Xc=md.n;zc=md.a5;ed=md.q;wd=md.j;xb=md.r;hc=md.a6;Cc=md.o;ic=md.a7;Qc=md.a8;jb=md.a9;fb=md.M;Ob=md.T;Cb=md.aa;ob=md.ab;bc=md.W;Ma=md.I;Db=md.ac;gb=md.c;zb=md.d;ec=md.ad;rc=md.i;Qb=md.f;Lb=md.p;Kb=md.ae;za=md.V;bb=md.O;P=md.Q;X=md.N;ya=md.t;Ga=md.af;wa=md.ag;ja=md.ah;lb=md.l;Ja=md.ai;Xb=md.aj;Kc=md.ak;Hb=md.al;Oc=md.am;qb=md.an;xd=md.ao;he=md.ap;xc=md.aq;rb=md.L;Ld=md.ar;sb=md.h;hb=md.as;Ba=md.z;J=md.Z;ta=md.at;Ta=md.au},function(md){tb=
md.i},function(md){Rb=md.s;mc=md.a;Zb=md.r;Rc=md._;Sc=md.P;$d=md.H;r=md.M;Ud=md.S;ke=md.b;le=md.c;ie=md.G;yd=md.F},function(md){Wd=md.C;De=md.a;Fe=md.c}],execute:function(){function md(){}function tf(O,G,Ea){var N;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){return 1==oa.nextAddress?G.startsWith("image/")?oa.yield(lc.fileReadAsDataURL(O),3):oa.jumpTo(2):2!=oa.nextAddress?(N=oa.yieldResult,oa.return(new lc.Image({imageUrl:N,autoResize:!0,name:O.name}))):oa.return(null)})}var lc=
lively.FreezerRuntime.recorderFor("lively.morphic/events/html-drop-handler.js");lc.uploadItem=md;lc.uploadFile=tf;lc.fileReadAsDataURL=function(O){return new Promise(function(G,Ea){Ea=new lc.FileReader;Ea.onload=function(N){return G(N.target.result)};Ea.readAsDataURL(O)})};lc.Image=mb;lc.uploadItem=md;lc.uploadItem=md;lc.uploadFile=tf;lc.uploadFile=tf;var kd=lively.FreezerRuntime.recorderFor("lively.ide/world-commands.js");kd.Rectangle=vb;kd.rect=Vb;kd.Color=Eb;kd.pt=Jc;kd.tree=Bc;kd.date=Uc;kd.Path=
tc;kd.arr=oc;kd.string=sc;kd.obj=Tc;kd.inspect=Fd;kd.easings=Rd;kd.morph=ee;kd.Text=Dc;kd.config=rd;kd.KeyHandler=Ab;kd.loadObjectFromPartsbinFolder=qc;kd.loadPart=Xc;kd.interactivelySaveWorld=zc;kd.show=Rb;kd.showAndSnapToGuides=mc;kd.removeSnapToGuidesOf=Zb;kd.LoadingIndicator=ed;kd.createMorphSnapshot=wd;kd.interactivelyFreezeWorld=tb;kd.resource=xb;kd.BrowserModuleTranslationCache=hc;kd.CommentBrowser=Rc;kd.once=Cc;kd.commands=[{name:"clear storage and reload",exec:function(){var O,G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ea){if(1==
Ea.nextAddress)return Ea.yield($world.confirm(["Caution\n",{},"Proceeding will clear all local storage and reload the page! Make sure if you want to save your world before you continue.",{fontSize:15,fontWeight:"normal"}],{width:400}),2);if(O=Ea.yieldResult)localStorage.clear(),G=new kd.BrowserModuleTranslationCache("2"),G.closeDb(),G.deleteDb(),window.location.reload(!0);Ea.jumpToEnd()})}},{name:"undo",exec:function(O){if(O.focusedMorph&&O.focusedMorph!==O&&O.focusedMorph.undoManager)return!1;O.env.undoManager.undo();
return!0}},{name:"redo",exec:function(O){if(O.focusedMorph&&O.focusedMorph!==O&&O.focusedMorph.undoManager)return!1;O.env.undoManager.redo();return!0}},{name:"run command",handlesCount:!0,exec:function(O,G,Ea){var N,oa,Ca,cb,pb,yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){if(1==Yb.nextAddress)return N=O.focusedMorph||O,oa=kd.KeyHandler.generateCommandToKeybindingMap(N,!0).map(function(cc){var Ec=cc.prettyKeys,od=cc.command.name,Dd=cc.target.constructor.name;Ec=Ec?Ec.join(", "):
"";return{isListItem:!0,value:cc,label:[""+Dd,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+od,null],annotation:[Ec,{fontSize:"80%",textStyleClasses:["truncated-text"],paddingRight:"5px",maxWidth:140}]}}),Yb.yield(O.filterableListPrompt("Run command",oa,{historyId:"lively.morphic-run command",requester:N,extent:kd.pt(700,900),prompt:O._cachedRunCommandPrompt}),2);Ca=Yb.yieldResult;cb=Ca.prompt;pb=$jscomp.makeIterator(Ca.selected);yb=pb.next().value;O._cachedRunCommandPrompt=
cb;return Yb.return(yb?yb.target.execCommand(yb.command,G,Ea):!0)})}},{name:"show command history",exec:function(O,G){var Ea=O.commandHandler;G=kd.arr.sortBy(Ea.history,function(N){return-N.time}).map(function(N){return{isListItem:!0,string:Ea.printCommand(N),value:N}});$world.editListPrompt("select commands",G,{multiSelect:!0,requester:O});return!0}},{name:"show halo for focused morph",exec:function(O){var G=O.focusedMorph;O.showHaloFor(G.getWindow()||G,O.firstHand.pointerId);return!0}},{name:"show morph",
exec:function(O,G){kd.show(G.morph,void 0===G.loop?!1:G.loop)}},{name:"show and snap to guides",exec:function(O,G){kd.showAndSnapToGuides(G.target,G.showGuides,G.snap)}},{name:"remove snap to guides",exec:function(O,G){kd.removeSnapToGuidesOf(G)}},{name:"copy morph",exec:function(O){var G=O.focusedMorph;if(!G||G===O)return $world.setStatusMessage("no morph selected"),!0;O=G.getWindow()||G;G=O.copy();G.openInWorld(O.globalPosition.addXY(10,10));G.isWindow&&G.activate();return G}},{name:"select morph",
exec:function(O,G){G=void 0===G?{root:O,selectionFn:null,justReturn:!1,requester:O,filterFn:null,prependItems:[],prompt:null,remote:!1}:G;var Ea,N,oa,Ca,cb,pb,yb,Yb,cc,Ec,od;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Dd){if(1==Dd.nextAddress)return Ea=0,N=G.filterFn||function(){return!0},oa=G.selectionFn||function(ad,Vd,Td){return O.filterableListPrompt(ad,Vd,Td)},Dd.yield(System.import("lively.classes/object-classes.js"),2);if(3!=Dd.nextAddress)return Ca=Dd.yieldResult,cb=Ca.default,
pb=kd.arr.compact(kd.tree.map(G.root||O,function(ad,Vd){if(!N(ad))return null;var Td=!!cb.lookupPackageForObject(ad);return{isListItem:!0,label:[""+String(++Ea)+"\u2003".repeat(Vd),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+ad,{fontWeight:Td?"bolder":"normal",fontStyle:Td?"normal":"italic",fontFamily:"Inconsolata",fontSize:16},Td?" [Object Class]":"",{opacity:.5}],value:ad}},function(ad){return N(ad)?ad.submorphs:[]})),yb=["show halo","open object editor","open object inspector"],
Dd.yield(oa(G.prompt||"Choose morph",(G.prependItems||[]).concat(pb),{historyId:"lively.morphic-select morph",onSelection:function(ad){(void 0).lastSelectionHalo&&(void 0).lastSelectionHalo.remove();ad&&ad.show&&Yb!=ad&&((void 0).lastSelectionHalo=ad.show(),Yb=ad)},selectedAction:"show halo",actions:yb}),3);cc=Dd.yieldResult;Ec=cc.selected;od=cc.action;if(G.justReturn)return Dd.return(Ec);Ec.forEach(function(ad){od===yb[0]?O.showHaloFor(ad):od===yb[1]?O.execCommand("open object editor",{target:ad}):
od===yb[2]&&O.execCommand("open object inspector",{target:ad})});return Dd.return(Ec)})}},{name:"print morph(s)",exec:function(O){var G,Ea,N,oa,Ca,cb,pb,yb,Yb,cc,Ec,od,Dd,ad,Vd,Td,Gd,Cd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ve){switch(ve.nextAddress){case 1:G=!1,Ea=[];case 2:if(G)return pb=kd.LoadingIndicator.open("printing morph..."),ve.yield(System.import("lively.2lively/client.js"),6);N=$jscomp;oa=N.makeIterator;return ve.yield(O.execCommand("select morph",{justReturn:!0}),
4);case 4:return Ca=oa.call(N,ve.yieldResult),cb=Ca.next().value,Ea.push(cb),ve.yield(O.confirm("Select additional morphs?",{rejectLabel:"NO"}),5);case 5:G=!ve.yieldResult;ve.jumpTo(2);break;case 6:return yb=ve.yieldResult,Yb=yb.default,cc=Yb.default(),ve.yield(cc.listPeers(!0),7);case 7:return Ec=ve.yieldResult,od=Ec.find(function(Ge){return"pdf printer"===Ge.type}),Dd={ackTimeout:3E4},ad=cc,Vd=ad.sendToAndWait,Td=od.id,ve.yield(Promise.all(Ea.map(function(Ge){return kd.createMorphSnapshot(Ge,{addPreview:!1,
testLoad:!1})})),9);case 9:return ve.yield(Vd.call(ad,Td,"[PDF printer] print",ve.yieldResult,Dd),8);case 8:Gd=ve.yieldResult;if(Cd=Gd.error||Gd.data.error)throw O.showError(Cd),Cd;O.serveFileAsDownload(Gd.data,{fileName:Ea[0].name+(1<Ea.length?".etc":"")+".pdf",type:"application/pdf"});pb.remove();ve.jumpToEnd()}})}},{name:"escape",exec:function(O,G,Ea,N){G=O.env.eventDispatcher.eventState;G.menu&&G.menu.remove();G=O.halos();G.forEach(function(oa){return oa.remove()});O.hands.forEach(function(oa){return oa.cancelGrab(!0,
N)});O=kd.arr.last(G)&&kd.arr.last(G).target||O.focusedMorph||O;O.focus();O.isText&&O.selection.disableMultiSelect&&O.selection.disableMultiSelect();return!1}},{name:"move or resize halo target",exec:function(O,G){G=void 0===G?{direction:"left",offset:1,what:"move"}:G;var Ea=O.halos()[0];if(!Ea||Ea.changingName||O.focusedMorph!=Ea)return!1;var N=G;O=N.direction;G=N.offset;N=N.what;var oa=Ea.target;G=G||1;switch(O){case "left":oa["move"===N?"left":"width"]-=G;break;case "right":oa["move"===N?"left":
"width"]+=G;break;case "up":oa["move"===N?"top":"height"]-=G;break;case "down":oa["move"===N?"top":"height"]+=G}Ea.alignWithTarget();return!0}},{name:"close halo target",exec:function(O){O=O.halos()[0];if(!O||O.changingName)return!1;O.target.selectedMorphs?O.target.selectedMorphs.forEach(function(G){return G.abandon()}):O.target.abandon();return!0}},{name:"resize manually",exec:function(O,G){G=void 0===G?{}:G;var Ea,N,oa,Ca,cb,pb,yb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){switch(cc.nextAddress){case 1:oa=
O.windowBounds();Ca=O.bounds();cb=Number;if(pb=G.width){cc.jumpTo(2);break}return cc.yield(O.prompt("Enter world width",{input:Math.max(Ca.width,oa.width),requester:O}),3);case 3:pb=cc.yieldResult;case 2:Ea=cb(pb);if("number"!==typeof Ea){cc.jumpTo(4);break}yb=Number;if(Yb=G.height){cc.jumpTo(5);break}return cc.yield(O.prompt("Enter world height",{input:Math.max(Ca.height,oa.height),requester:O}),6);case 6:Yb=cc.yieldResult;case 5:N=yb(Yb);case 4:return"number"!==typeof Ea||isNaN(Ea)||"number"!==
typeof N||isNaN(N)||(O.extent=kd.pt(Ea,N)),cc.return(!0)}})}},{name:"resize windows to fit visible world bounds",exec:function(O){var G=O.getWindows().filter(function(Ca){return!Ca.minimized});if(!G.length)return!0;O=O.visibleBoundsExcludingTopBar();var Ea=G.reduce(function(Ca,cb){return cb.bounds().union(Ca)},new kd.Rectangle(0,0,0,0)),N=O.width/Ea.width,oa=O.height/Ea.height;G.forEach(function(Ca){var cb=Ca.bounds();Ca.setBounds(new kd.Rectangle(cb.x*N,cb.y*oa,cb.width*N,cb.height*oa))});return!0}},
{name:"window switcher",exec:function(O){var G,Ea,N,oa,Ca,cb,pb,yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){if(1==Yb.nextAddress){if((G=O.activePrompt())&&"lively.morphic-window switcher"===G.historyId)return G.focus(),Yb.return(G.get("list").execCommand("select down"));Ea=O.submorphs.filter(function(cc){return cc.isWindow}).reverse().map(function(cc){return{isListItem:!0,string:cc.title||String(cc),value:cc}});Ea.forEach(function(cc){cc.value.opacity=.5;cc.value.blur=1});return Yb.yield(O.filterableListPrompt("Choose window",
Ea,{preselect:1,requester:O,historyId:"lively.morphic-window switcher",onSelection:function(cc){N&&(N.minimized=oa,N.blur=1,N.animate({opacity:.3,duration:200}));if(N=cc)cc.animate({opacity:1,duration:200}),cc.blur=0,oa=cc.minimized,cc.minimized=!1},width:1*O.visibleBounds().extent().x/3,itemPadding:kd.Rectangle.inset(4)}),2)}cb=Ca=Yb.yieldResult;pb=$jscomp.makeIterator(cb.selected);yb=pb.next().value;Ea.forEach(function(cc){cc.value.opacity=1;cc.value.blur=0});yb&&(yb.activate(),yb.minimized=!1);
return Yb.return(!0)})}},{name:"close active window or morph",exec:function(O){var G=O.focusedMorph;if(!G)return!0;var Ea=G.getWindow();O.undoStart("window close");Ea?Ea.close():(kd.arr.last(kd.arr.without(G.ownerChain(),O)).remove(),(Ea=O.activeWindow())&&Ea.activate());O.undoStop("window close");return!0}},{name:"toggle minimize active window",exec:function(O){(O=O.activeWindow())&&O.toggleMinimize();return!0}},{name:"toggle minimize all windows",exec:function(O){(O=O.getWindows())&&O.map(function(G){return G.toggleMinimize()});
return!0}},{name:"toggle minimize all except active window",exec:function(O){(O=O.getWindows().filter(function(G){return!G.isActive()}))&&O.map(function(G){return G.toggleMinimize()});return!0}},{name:"close all except active window",exec:function(O){(O=O.getWindows().filter(function(G){return!G.isActive()}))&&O.map(function(G){return G.close()});return!0}},{name:"close all windows",exec:function(O){(O=O.getWindows())&&O.map(function(G){return G.close()});return!0}},{name:"open status message of focused morph",
exec:function(O){var G=O.focusedMorph;if(O=$jscomp.makeIterator(G?O.visibleStatusMessagesFor(G):[]).next().value)O.expand(),O.focus();return O||!0}},{name:"resize active window",exec:function(O,G){function Ea(){var od,Dd,ad;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vd){if(1==Vd.nextAddress)return Vd.yield(O.filterableListPrompt("How to resize the window?","full center right left bottom top reset".split(" "),{requester:O}),2);od=Vd.yieldResult;Dd=$jscomp.makeIterator(od.selected);
ad=Dd.next().value;return Vd.return(ad)})}function N(od,Dd){switch(od){case "full":return yb;case "col1":case "left":return Ec.withTopLeft(yb.topLeft());case "col2":case "center":return Ec.withCenter(yb.center());case "col3":case "right":return Ec.translatedBy(kd.pt(yb.width-cc,0));case "top":return yb.divide([kd.rect(0,0,1,.5)])[0];case "bottom":return yb.divide([kd.rect(0,.5,1,.5)])[0];case "reset":return pb._normalBounds||kd.pt(500,400).extentAsRectangle().withCenter(Dd.center());default:return Dd}}
G=void 0===G?{how:null,window:null}:G;var oa,Ca,cb,pb,yb,Yb,cc,Ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(od){if(1==od.nextAddress){oa=G;Ca=oa.window;cb=oa.how;pb=Ca||O.activeWindow();if(!pb)return od.return();yb=O.visibleBoundsExcludingTopBar().insetBy(15);Yb=pb.bounds();pb._normalBounds||(pb._normalBounds=Yb);cc=Math.min(700,Math.max(1E3,yb.width/3));Ec=yb.withWidth(cc);return cb?od.jumpTo(2):od.yield(Ea(),3)}2!=od.nextAddress&&(cb=od.yieldResult);if(!cb)return od.return();pb.setBounds(N(cb,
yb));"reset"===cb&&delete pb._normalBounds;return od.return(!0)})}},{name:"[recovery] show last object editor saves",exec:function(O,G){return O.execCommand("[recovery] show last doits",Object.assign({},G,{title:"logged ObjectEditor save",logAccessFn:function(){return JSON.parse(localStorage["oe helper"]).saves}}))}},{name:"[recovery] show last doits",description:"browse a list of your last doits",exec:function(O,G){G=void 0===G?{}:G;var Ea,N,oa,Ca,cb,pb,yb,Yb,cc,Ec,od,Dd,ad,Vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Td){if(1==
Td.nextAddress){Ea=G;(N=Ea.logAccessFn)||(N=function(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])});try{oa=N()}catch(Gd){}if(!oa)return Td.return(O.inform("no log yet"));Ca=kd.arr.sortBy(oa.map(function(Gd,Cd){var ve="string"===typeof Gd?Gd:Gd.source;Gd="string"===typeof Gd?Cd:Gd.time||Cd;Cd=kd.date.format(new Date(Gd),"yy-mm-dd HH:MM");return{time:Gd,source:ve,printedTime:Cd}}),function(Gd){return-Gd.time});cb=Ca.map(function(Gd,Cd){return{isListItem:!0,string:"["+Gd.printedTime+
"] "+Gd.source.slice(0,100).replace(/\n/g,"").trim(),value:Gd}});return Td.yield(O.filterableListPrompt("select doit code",cb,{multiSelect:!0,requester:O}),2)}pb=Td.yieldResult;yb=pb.selected;if(yb.length){Yb=[];cc=$jscomp.makeIterator(yb);for(Ec=cc.next();!Ec.done;Ec=cc.next())Dd=od=Ec.value,ad=Dd.source,Vd=Dd.printedTime,Yb.push("// "+Vd+"\n"+ad);return Td.return(O.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},G,{content:Yb.join("\n\n")})))}return Td.return(!0)})}},
{name:"open loading indicator",exec:function(O,G){O={};"object"===typeof G&&(O=G,G=O.label);return kd.LoadingIndicator.open(G,O)}},{name:"open workspace",exec:function(O,G,Ea,N){G=void 0===G?{}:G;var oa,Ca,cb,pb,yb,Yb,cc,Ec,od,Dd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ad){switch(ad.nextAddress){case 1:if(oa=N&&O.relayCommandExecutionToFocusedMorph(N))return ad.return(oa);Ca=G.language||G.mode||"javascript";cb={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",
html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",css:"lively.ide/css/workspace.js",text:null};pb=Object.keys(kd.config.ide.modes.aliases).reduce(function(Vd,Td){var Gd={};return Object.assign(Vd,(Gd[kd.config.ide.modes.aliases[Td]]=Td,Gd))},{});if(!G.askForMode){ad.jumpTo(2);break}yb=Object.keys(cb).concat("javascript console");return ad.yield(O.filterableListPrompt("Open workspace for...",yb),3);case 3:if(Yb=ad.yieldResult,
cc=$jscomp.makeIterator(Yb.selected),Ca=cc.next().value,!Ca)return ad.return(!0);case 2:if("javascript console"===Ca)return ad.return(O.execCommand("open console",G));G=Object.assign({content:""},G,{mode:Ca,language:Ca});Ec=cb[G.language]||cb[pb[G.language]];return"text"!==Ca&&Ec?ad.yield(System.import(Ec),4):ad.return(O.execCommand("open text window",Object.assign({},kd.config.codeEditor.modes.text,{},G)));case 4:return od=ad.yieldResult,Dd=od.default,ad.return((new Dd({title:G.title||G.language+
" workspace",center:O.center,content:G.content,target:G.target,systemInterface:G.systemInterface||G.backend})).activate())}})}},{name:"open console",exec:function(O,G){var Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){if(1==N.nextAddress)return N.yield(kd.loadObjectFromPartsbinFolder("Console"),2);Ea=N.yieldResult;return N.return(Ea.openInWorldNearHand())})}},{name:"open shell workspace",exec:function(O,G){return O.execCommand("open workspace",Object.assign({},G,{language:"shell"}))}},
{name:"open javascript workspace",exec:function(O,G){return O.execCommand("open workspace",Object.assign({},G,{language:"javascript"}))}},{name:"open shell terminal",exec:function(O,G){var Ea,N;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){if(1==oa.nextAddress)return oa.yield(System.import("lively.ide/shell/terminal.js"),2);Ea=oa.yieldResult;N=Ea.default;return oa.return(N.open(G).openInWorldNearHand())})}},{name:"open text window",exec:function(O,G){var Ea=G=void 0===G?{}:G,N=Ea.title,
oa=Ea.extent,Ca=Ea.content,cb=Ea.mode,pb=Ea.name;Ea=Ea.rangesAndStyles;N=N||"text window";Ca=Ca||"";oa=oa||kd.pt(500,400);pb=pb||"text workspace";Ca="string"===typeof Ca?[Ca,null]:Ca;G=new kd.Text(Object.assign({padding:kd.Rectangle.inset(3)},kd.obj.dissoc(G,["title","content"]),{textAndAttributes:Ca,clipMode:"auto",name:pb,extent:oa}));Ea&&G.setTextAttributesWithSortedRanges(Ea);cb&&G.changeEditorMode(cb);return O.openInWindow(G,{title:N}).activate()}},{name:"merge and open in window",exec:function(O,
G){G=void 0===G?{a:"",b:"",format:null,extent:kd.pt(500,600)}:G;var Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){if(1==N.nextAddress)return N.yield(kd.loadObjectFromPartsbinFolder("text merger"),2);Ea=N.yieldResult;return N.return(Ea.targetMorph.open(G.a,G.b,G))})}},{name:"diff and open in window",exec:function(O,G){var Ea,N,oa;function Ca(Dd,ad,Vd){var Td,Gd,Cd,ve,Ge,ng,Ag,ag,Oe,Yg,Dg,fh,yf,Jf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zd){if(1==Zd.nextAddress){Td=
Vd;Gd=Td.format;Cd=null;if("patch"!==Gd)return od=Ec[Gd](Dd,ad,Vd),ve=kd.arr.flatmap(od,function(Fh){var Fb=Fh.added;return[Fh.value,Fh.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:kd.Color.red}:Fb?{fontWeight:"bold",textDecoration:"",fontColor:kd.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:kd.Color.darkGray}]}),Zd.jumpTo(2);Ge=Vd;ng=Ge.headerA;Ag=Ge.headerB;ag=Ge.filenameA;Oe=Ge.filenameB;Yg=Ge.context;ve=[Ec.createTwoFilesPatch(ag||"a",Oe||"b",Dd,ad,ng,
Ag,"number"===typeof Yg?{context:Yg}:void 0),{}];return Zd.yield(System.import("lively.ide/diff/editor-plugin.js"),3)}2!=Zd.nextAddress&&(Dg=Zd.yieldResult,fh=Dg.default,Cd=new fh);yf=O.execCommand("open text window",Vd);Jf=yf.targetMorph;yf.extent=cc||kd.pt(300,200).maxPt(Jf.textBounds().extent());Jf.textAndAttributes=ve;Cd&&Jf.addPlugin(Cd);return Zd.return(Jf)})}G=void 0===G?{a:"",b:"",format:null,extent:kd.pt(500,600)}:G;var cb,pb,yb,Yb,cc,Ec,od;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Dd){if(1==
Dd.nextAddress){cb=G;pb=cb.a;yb=cb.b;Yb=cb.format;cc=cb.extent;if(Yb)pb=String(pb),yb=String(yb);else{a:{var ad=pb,Vd=yb;if(kd.obj.isPrimitive(ad)||ad instanceof RegExp||kd.obj.isPrimitive(Vd)||Vd instanceof RegExp)ad=String(ad),Vd=String(Vd);if("string"!==typeof ad||"string"!==typeof Vd)try{JSON.stringify(ad);JSON.stringify(Vd);Ea="diffJson";N=ad;oa=Vd;break a}catch(Td){ad=String(ad),Vd=String(Vd)}Ea="diffLines";N=ad;oa=Vd}pb=N;yb=oa;Yb=Ea}return Dd.yield(System.import("https://jspm.dev/diff"),2)}if(3!=
Dd.nextAddress)return Ec=Dd.yieldResult,Dd.yield(Ca(pb,yb,Object.assign({fontFamily:"monospace"},G,{format:Yb})),3);od=Dd.yieldResult;return Dd.return(od)})}},{name:"merge workspaces",exec:function(O,G){return O.execCommand("diff workspace",Object.assign({},G,{merge:!0}))}},{name:"diff workspaces",exec:function(O,G){function Ea(cc,Ec){var od=cc.pluginFind(function(ad){return ad.evalEnvironment});od=od&&od.evalEnvironment.targetModule||"no file";var Dd=Ec.pluginFind(function(ad){return ad.evalEnvironment});
return O.execCommand("diff and open in window",{a:cc.textString,b:Ec.textString,filenameA:od,filenameB:Dd&&Dd.evalEnvironment.targetModule||"no file"})}function N(cc,Ec){var od;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Dd){if(1==Dd.nextAddress)return Dd.yield(kd.loadObjectFromPartsbinFolder("text merger"),2);od=Dd.yieldResult;return Dd.return(od.targetMorph.open(cc.textString,Ec.textString))})}function oa(cc,Ec){var od,Dd,ad,Vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Td){if(1==
Td.nextAddress)return od=cc.map(function(Gd){return{isListItem:!0,value:Gd,string:Gd.name||String(Gd)}}),Td.yield(O.filterableListPrompt("choose text: ",od,{onSelection:function(Gd){debugger;Gd&&Gd.show()}}),2);Dd=Td.yieldResult;ad=$jscomp.makeIterator(Dd.selected);Vd=ad.next().value;return Td.return(Vd)})}G=void 0===G?{}:G;var Ca,cb,pb,yb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){switch(cc.nextAddress){case 1:Ca=G;cb=Ca.editor1;pb=Ca.editor2;yb=Ca.merge;cb&&pb||(Yb=O.withAllSubmorphsSelect(function(Ec){return Ec.isText&&
!Ec.isInputLine&&!Ec.isUsedAsEpiMorph()}).reverse());if(cb){cc.jumpTo(2);break}return cc.yield(oa(Yb),3);case 3:cb=cc.yieldResult;case 2:if(!cb)return cc.return(O.setStatusMessage("Canceled"));if(pb){cc.jumpTo(4);break}return cc.yield(oa(kd.arr.without(Yb,cb)),5);case 5:pb=cc.yieldResult;case 4:return pb?cc.return(yb?N(cb,pb):Ea(cb,pb)):cc.return(O.setStatusMessage("Canceled"))}})}},{name:"search workspaces",exec:function(){function O(cc,Ec){return cc.map(function(od){var Dd=od.world()?od.getWindow():
$world.withAllSubmorphsDetect(function(Gd){return Gd.isWindow&&Gd.targetMorph===ee}),ad=0,Vd=kd.string.lines(od.textString).find(function(Gd,Cd){Gd=Gd.toLowerCase();ad=Cd;return Ec.every(function(ve){return Gd.includes(ve)})}),Td=Dd?Dd.title:od.toString();return Vd?{isListItem:!0,string:Td+" | "+Vd,value:{window:Dd,morph:od,row:ad}}:null}).filter(Boolean)}function G(cc){return $world.withAllSubmorphsDo(function(Ec){Ec.isWindow&&Ec.minimized&&Ec.targetMorph&&Ec.targetMorph.isText&&(Ec=Ec.targetMorph);
if(!Ec.textString||!Ec.isText||Ec.isUsedAsEpiMorph())return null;var od=Ec.textString.toLowerCase();return cc.every(function(Dd){return od.includes(Dd)})?Ec:null}).filter(Boolean)}var Ea=this,N,oa,Ca,cb,pb,yb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){if(1==cc.nextAddress)return cc.yield($world.filterableListPrompt("search workspaces",[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function(Ec){Ec.getSubmorphNamed("list").updateFilter=function(){var od=
this.parseInput();if(!(3>od.input.length)){var Dd=G(od.lowercasedTokens);this.listMorph.items=O(Dd,od.lowercasedTokens)}}}}),2);N=cc.yieldResult;oa=$jscomp.makeIterator(N.selected);return(Ca=oa.next().value)?(cb=Ca,pb=cb.morph,yb=cb.window,Yb=cb.row,yb&&(yb.minimized&&yb.toggleMinimize(),yb.activate()),(yb||pb).show(),Ea.cursorPosition={row:Yb,column:0},cc.return(pb)):cc.return(null)})}},{name:"open PartsBin",exec:function(O){var G,Ea,N,oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==
Ca.nextAddress)return G=kd.LoadingIndicator.open("Loading Partsbin..."),Ca.yield(System.import("lively.morphic/partsbin.js"),2);if(3!=Ca.nextAddress)return Ea=Ca.yieldResult,N=Ea.loadPart,Ca.yield(N("PartsBin"),3);oa=Ca.yieldResult;oa.openInWorldNearHand();oa.targetMorph.selectedCategory="*basics*";oa.focus();G.remove();oa.getWindow().activate();return Ca.return(oa)})}},{name:"browse and load component",exec:function(O){var G,Ea,N,oa,Ca,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pb){switch(pb.nextAddress){case 1:G=
kd.LoadingIndicator.open("loading component browser");if(O._componentsBrowser){pb.jumpTo(2);break}return pb.yield(G.whenRendered(),2);case 2:if(Ea=O._componentsBrowser){pb.jumpTo(4);break}oa=N=O;return pb.yield(kd.resource("part://SystemDialogs/master component browser").read(),5);case 5:Ea=oa._componentsBrowser=pb.yieldResult;case 4:return Ca=Ea,G.remove(),pb.yield(Ca.activate(),6);case 6:(cb=pb.yieldResult)&&!cb.world()&&cb.openInWorld(),pb.jumpToEnd()}})}},{name:"load object from PartsBin",exec:function(O,
G){G=void 0===G?{}:G;var Ea,N,oa,Ca,cb,pb,yb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){switch(cc.nextAddress){case 1:return N=G,oa=N.name,Ca=void 0===N.open?!0:N.open,oa?cc.yield(System.import("lively.morphic/partsbin.js"),6):cc.yield(System.import("lively.morphic/partsbin.js"),4);case 4:return cb=cc.yieldResult,pb=cb.interactivelyLoadObjectFromPartsBinFolder,cc.yield(pb(),5);case 5:Ea=cc.yieldResult;cc.jumpTo(3);break;case 6:return yb=cc.yieldResult,Yb=yb.loadObjectFromPartsbinFolder,
cc.yield(Yb(oa),7);case 7:Ea=cc.yieldResult;case 3:return Ea&&Ca&&Ea.openInWorldNearHand(),cc.return(Ea)}})}},{name:"open object drawer",exec:function(O){var G,Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){if(1==N.nextAddress)return N.yield(System.import("lively.components/object-drawer.js"),2);G=N.yieldResult;Ea=G.default;return N.return((new Ea).openInWorldNearHand())})}},{name:"open object editor",exec:function(O,G){G=void 0===G?{target:null,selectedClass:null,selectedMethod:null,
evalEnvironment:null}:G;var Ea,N,oa,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==cb.nextAddress){if(!G.target)return O.setStatusMessage("No target for ObjectEditor"),cb.return(null);Ea=G.loadingIndicator=kd.LoadingIndicator.open("Open Object Editor...");return cb.yield(System.import("lively.ide/js/objecteditor/index.js"),2)}if(3!=cb.nextAddress)return N=cb.yieldResult,oa=N.ObjectEditor,cb.yield(oa.open(G),3);Ca=cb.yieldResult;Ea.remove();return cb.return(Ca)})}},{name:"open object inspector",
exec:function(O,G){G=void 0===G?{target:null}:G;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ea){return G.target?Ea.return(kd.inspect(G.target)):(O.setStatusMessage("no target for Inspector"),Ea.return(null))})}},{name:"inspect server",exec:function(O){var G,Ea,N,oa,Ca,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pb){switch(pb.nextAddress){case 1:return pb.yield(System.import("lively.ide/js/inspector.js"),2);case 2:return G=pb.yieldResult,Ea=G.default,pb.yield(System.import("lively-system-interface"),
3);case 3:return N=pb.yieldResult,oa=N.serverInterfaceFor,Ca=oa(System.baseURL+"eval"),cb={format:"esm",context:"global",targetModule:"lively://lively.next-workspace/world",sourceURL:"inspect-server_"+Date.now(),systemInterface:Ca},pb.yield(Ca.runEval('\n           import LivelyServer from "lively.server/server.js";\n           let server = LivelyServer.servers.values().next().value;\n        ',cb),4);case 4:Ea.openInWindow({remoteTarget:{code:"server",evalEnvironment:cb}}),pb.jumpToEnd()}})}},{name:"open scene graph inspector",
exec:function(O,G){G=void 0===G?{target:null}:G;var Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){if(1==N.nextAddress)return N.yield(kd.loadObjectFromPartsbinFolder("scene graph inspector"),2);Ea=N.yieldResult;Ea.targetMorph=G.target||O;return N.return(Ea.openInWindow({title:"morph graph"}))})}},{name:"open browser",progressIndicator:"opening browser...",exec:function(O,G,Ea,N){G=void 0===G?{packageName:"lively.morphic",moduleName:"morph.js"}:G;var oa,Ca,cb,pb,yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){if(1==
Yb.nextAddress)return(oa=N&&O.relayCommandExecutionToFocusedMorph(N))?Yb.return(oa):Yb.yield(System.import("lively.ide/js/browser/index.js"),2);if(3!=Yb.nextAddress)return Ca=Yb.yieldResult,cb=Ca.default,pb=kd.obj.select(G,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),Yb.yield(cb.browse(pb,{extent:kd.pt(700,600)}),3);yb=Yb.yieldResult;yb.getWindow().activate();return Yb.return(yb)})}},{name:"choose and browse package resources",progressIndicator:"browsing resources...",
exec:function(O,G,Ea,N){G=void 0===G?{browser:null,systemInterface:null}:G;var oa,Ca,cb,pb,yb,Yb,cc,Ec,od,Dd,ad,Vd,Td,Gd,Cd,ve,Ge,ng,Ag,ag,Oe,Yg,Dg,fh;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yf){switch(yf.nextAddress){case 1:if(oa=N&&O.relayCommandExecutionToFocusedMorph(N))return yf.return(oa);Ca=(Ca=G.browser||O.focusedMorph&&O.focusedMorph.ownerChain().find(function(Jf){return Jf.isBrowser}))&&Ca.isBrowser?Ca.getWindow():null;return yf.yield(System.import("lively-system-interface"),
2);case 2:return cb=yf.yieldResult,pb=cb.localInterface,yb=G&&G.systemInterface?G.systemInterface:Ca?Ca.systemInterface:pb,yf.yield(yb.getPackages({excluded:kd.config.ide.js.ignoredPackages}),3);case 3:Yb=yf.yieldResult,cc=[],Ec={},od=$jscomp.makeIterator(Yb),Dd=od.next();case 4:if(Dd.done)return yf.yield(O.filterableListPrompt("Choose module to open",cc,{historyId:"lively.morphic-choose and browse package resources",requester:Ca,width:700,multiSelect:!0,fuzzy:"value.shortName"}),8);Ec.$jscomp$loop$prop$p$2726=
Dd.value;Ec.$jscomp$loop$prop$excluded$2725=(kd.Path("lively.ide.exclude").get(Ec.$jscomp$loop$prop$p$2726)||[]).map(function(Jf){return Jf.includes("*")?new RegExp(Jf.replace(/\*/g,".*")):Jf});Ec.$jscomp$loop$prop$excluded$2725.push(".git","node_modules",".module_cache");ad=cc.push;Vd=ad.apply;Td=cc;Gd=$jscomp;Cd=Gd.arrayFromIterable;ve=function(Jf){return function(Zd){return{isListItem:!0,string:"["+Jf.$jscomp$loop$prop$p$2726.name+"] "+Zd.nameInPackage+(Zd.isLoaded?"":" [not loaded]"),value:Zd}}}(Ec);
Ge=function(Jf){return function(Zd){var Fh=Zd.url;return!Fh.endsWith("/")&&!Jf.$jscomp$loop$prop$excluded$2725.some(function(Fb){return Fb instanceof RegExp?Fb.test(Fh):Fh.includes(Fb)})}}(Ec);return yf.yield(yb.resourcesOfPackage(Ec.$jscomp$loop$prop$p$2726,Ec.$jscomp$loop$prop$excluded$2725),7);case 7:Vd.call(ad,Td,Cd.call(Gd,yf.yieldResult.filter(Ge).sort(function(Jf,Zd){return Jf.isLoaded&&!Zd.isLoaded?-1:!Jf.isLoaded&&Zd.isLoaded?1:Jf.nameInPackage.toLowerCase()<Zd.nameInPackage.toLowerCase()?
-1:Jf.nameInPackage.toLowerCase()==Zd.nameInPackage.toLowerCase()?0:1}).map(ve)));Ec={$jscomp$loop$prop$excluded$2725:Ec.$jscomp$loop$prop$excluded$2725,$jscomp$loop$prop$p$2726:Ec.$jscomp$loop$prop$p$2726};Dd=od.next();yf.jumpTo(4);break;case 8:return ng=yf.yieldResult,Ag=ng.selected,ag=$jscomp.makeIterator(kd.arr.partition(Ag,function(Jf){return Jf.url.match(/\.js(on)?/)})),Oe=ag.next().value,Yg=ag.next().value,yf.yield(System.import("lively.ide/js/browser/index.js"),9);case 9:return Dg=yf.yieldResult,
fh=Dg.default,yf.yield(Promise.all(Oe.map(function(Jf){return fh.browse({packageName:Jf.package,moduleName:Jf.url},Ca,yb).then(function(Zd){return Zd.activate()})})),10);case 10:if(!Yg.length){yf.jumpTo(11);break}return yf.yield(Promise.all(Yg.map(function(Jf){return O.execCommand("open file",{url:Jf.url})})),11);case 11:return yf.return(!0)}})}},{name:"choose and browse module",progressIndicator:"browsing module...",handlesCount:!0,exec:function(O,G,Ea){G=void 0===G?{browser:void 0,systemInterface:void 0}:
G;var N,oa,Ca,cb,pb,yb,Yb,cc,Ec,od,Dd,ad,Vd,Td,Gd,Cd,ve,Ge,ng;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ag){switch(Ag.nextAddress){case 1:if(!G.browser&&(oa=(N=O.focusedMorph)&&N.getWindow())&&oa.targetMorph&&oa.targetMorph.isFileBrowser)return Ag.return(oa.targetMorph.execCommand("find file and select",G,Ea));Ca=G.browser||N&&N.ownerChain().find(function(ag){return ag.isBrowser});return Ag.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return cb=Ag.yieldResult,
pb=cb.default,Ag.yield(System.import("lively-system-interface"),3);case 3:return yb=Ag.yieldResult,Yb=yb.localInterface,cc=G&&G.systemInterface?G.systemInterface:Ca?Ca.systemInterface:Yb,Ec="local"==cc.name?"":" on ["+kd.string.truncate(cc.name,35,"...")+"]",Ag.yield(cc.getPackages(),4);case 4:od=Ag.yieldResult;Dd=[];ad=$jscomp.makeIterator(od);for(Vd=ad.next();!Vd.done;Vd=ad.next())for(Td=Vd.value,Gd=kd.Path("lively.ide.exclude").get(Td)||[],Gd=Gd.map(function(ag){return ag.includes("*")?new RegExp(ag.replace(/\*/g,
".*")):ag}),Cd={},ve=$jscomp.makeIterator(Td.modules),Ge=ve.next();!Ge.done;Cd={$jscomp$loop$prop$m$2728:Cd.$jscomp$loop$prop$m$2728},Ge=ve.next())Cd.$jscomp$loop$prop$m$2728=Ge.value,Gd.some(function(ag){return function(Oe){return Oe instanceof RegExp?Oe.test(ag.$jscomp$loop$prop$m$2728.name):ag.$jscomp$loop$prop$m$2728.name.includes(Oe)}}(Cd))||(ng=cc.shortModuleName(Cd.$jscomp$loop$prop$m$2728.name,Td),Dd.push({isListItem:!0,string:"["+Td.name+"] "+ng,value:{package:Td,module:Cd.$jscomp$loop$prop$m$2728,
shortName:ng}}));Dd=kd.arr.sortBy(Dd,function(ag){return ag.string});(function(){var ag,Oe,Yg,Dg,fh,yf,Jf,Zd,Fh;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return ag=Ca||N,Fb.yield(O.filterableListPrompt("Choose module to open"+Ec,Dd,{historyId:"lively.morphic-choose and browse module",requester:ag,height:Math.min(ag.height,700),width:500,multiSelect:!0,listFontColor:"white",fuzzy:"value.shortName"}),2);case 2:Oe=Fb.yieldResult,Yg=Oe.selected,Dg=0;
case 3:if(!(Dg<Yg.length)){Fb.jumpTo(0);break}fh=Yg[Dg];yf=fh.package;Jf=fh.shortName;Zd={packageName:yf.name,moduleName:Jf};return Fb.yield(pb.browse(Zd,0===Dg?Ca:void 0,cc),6);case 6:Fh=Fb.yieldResult,Fh.moveBy(kd.pt(20*Dg,20*Dg)),Fh.getWindow().activate(),Dg++,Fb.jumpTo(3)}})})();return Ag.return(!0)}})}},{name:"open code search",progressIndicator:"opening code search...",exec:function(O,G){G=void 0===G?{browser:null,systemInterface:null,input:null}:G;var Ea,N,oa,Ca,cb,pb,yb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){if(1==
cc.nextAddress){Ea=O.focusedMorph?O.focusedMorph.ownerChain():[];N=G.browser||Ea.find(function(Ec){return Ec.isBrowser});oa=kd.LoadingIndicator.open("loading code search");if(N&&N.isBrowser){if(N.state.associatedSearchPanel)return cc.return(N.state.associatedSearchPanel.getWindow().activate())}else N=null;return cc.yield(System.import("lively-system-interface"),2)}if(3!=cc.nextAddress)return Ca=cc.yieldResult,cb=Ca.localInterface,pb=G.systemInterface||N&&N.systemInterface,pb||(pb=(yb=Ea.find(function(Ec){return Ec.isText&&
Ec.editorPlugin&&Ec.editorPlugin.isJSEditorPlugin}))?yb.editorPlugin.systemInterface():cb),cc.yield(kd.resource("part://SystemIDE/code search").read(),3);Yb=cc.yieldResult;Object.assign(Yb,{browser:N,input:G.input,systemInterface:pb});Yb.openInWindow();Yb.focus();oa.remove();N&&(N.state.associatedSearchPanel=Yb);return cc.return(Yb)})}},{name:"open grep search",progressIndicator:"opening code search...",exec:function(O,G){var Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){if(1==
N.nextAddress)return N.yield(kd.loadObjectFromPartsbinFolder("grep search"),2);Ea=N.yieldResult;return N.return(Ea.openInWorldNearHand(O).activate())})}},{name:"open test runner",progressIndicator:"opening test runner...",exec:function(O){var G,Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){return 1==N.nextAddress?N.yield(System.import("lively.ide/test-runner.js"),2):3!=N.nextAddress?(G=N.yieldResult,Ea=G.default,N.yield(Ea.open(),3)):N.return(N.yieldResult)})}},{name:"open file browser",
progressIndicator:"opening file browser...",exec:function(O,G){G=void 0===G?{}:G;var Ea,N,oa,Ca,cb,pb,yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){if(1==Yb.nextAddress)return Yb.yield(System.import("lively.ide/http-file-browser.js"),2);Ea=Yb.yieldResult;N=Ea.default;oa=G;Ca=oa.location;cb=oa.url;yb=(pb=oa.file)?N.forFile(pb,Ca):N.forLocation(cb||Ca||document.location.origin);return Yb.return(O.openInWindow(yb).activate())})}},{name:"open file",progressIndicator:"opening file...",
exec:function(O,G){G=void 0===G?{url:null,lineNumber:null,reuse:!1}:G;var Ea,N,oa,Ca,cb,pb,yb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){switch(cc.nextAddress){case 1:Ea=G;N=Ea.url;oa=Ea.lineNumber;Ca=Ea.reuse;cb=O.commandHandler.progressIndicator;if(N){cc.jumpTo(2);break}cb.visible=!1;debugger;return cc.yield(O.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0}),3);case 3:N=cc.yieldResult,cb.visible=!0;case 2:if(Ca&&(O.getWindows().slice(-2),
pb=kd.arr.findAndGet(O.getWindows(),function(Ec){return(Ec=Ec.targetMorph)&&Ec.isTextEditor&&Ec.location.split(":")[0]===N?Ec:null})))return"number"===typeof oa&&(pb.lineNumber=oa),cc.return(pb.getWindow().activate());oa&&(N+=":"+oa);return cc.yield(System.import("lively.ide/text-editor.js"),4);case 4:return yb=cc.yieldResult,Yb=yb.default,cc.return(N?Yb.openURL(N,kd.obj.dissoc(G,["url"])):null)}})}},{name:"open file for EDITOR",exec:function(O,G){G=void 0===G?{url:null,lineNumber:null}:G;var Ea,
N,oa,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){return 1==cb.nextAddress?cb.yield(System.import("lively.ide/text-editor.js"),2):3!=cb.nextAddress?(Ea=cb.yieldResult,N=Ea.default,oa=G,Ca=oa.url,cb.yield(N.openAsEDITOR(Ca,{}),3)):cb.return(cb.yieldResult)})}},{name:"open subserver controller",exec:function(O,G){var Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){if(1==N.nextAddress)return N.yield(kd.loadPart("subserver controller"),2);Ea=N.yieldResult;return N.return(Ea.openInWorld())})}},
{name:"[lively.installer] publish new version of a package",exec:function(O){var G,Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(N){switch(N.nextAddress){case 1:return N.yield(lively.modules.registerPackage(document.location.origin+"/lively.installer"),2);case 2:return N.yield(System.import("lively.installer/packages/publish-new-package-version.js"),3);case 3:return G=N.yieldResult,Ea=G.default,N.yield(Ea(),4);case 4:return N.return(!0)}})}},{name:"report a bug",exec:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){window.open("https://github.com/LivelyKernel/lively.next/issues/new",
"_blank");return G.return(!0)})}},{name:"fix font metric",exec:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){O.env.fontMetric.reset();O.withAllSubmorphsDo(function(Ea){return Ea.isText&&Ea.textLayout&&Ea.textLayout.reset()});return G.return(!0)})}},{name:"delete change history",exec:function(O){var G=O.env,Ea=G.printStatus();G.deleteHistory();O.setStatusMessage(Ea);O._componentsBrowser&&O._componentsBrowser.reset();return!0}},{name:"install global inspect and show",exec:function(O){window.show=
kd.show;window.inspect=kd.inspect;O.setStatusMessage("inspect() and show() are now globally available");return!0}},{name:"save world",exec:function(O,G,Ea,N){var oa,Ca,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pb){if(1==pb.nextAddress){if(oa=N&&O.relayCommandExecutionToFocusedMorph(N))return pb.return(oa);G=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},G);Ca=O.focusedMorph;return pb.yield(kd.interactivelySaveWorld(O,G),2)}cb=pb.yieldResult;Ca&&Ca.focus();return pb.return(cb)})}},
{name:"freeze world",exec:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){return G.yield(kd.interactivelyFreezeWorld(O),0)})}},{name:"save this world",exec:function(O,G,Ea,N){return O.execCommand("save world",Object.assign({confirmOverwrite:!0},G,{showSaveDialog:!1}))}},{name:"load world",exec:function(O,G){G=void 0===G?{}:G;var Ea,N,oa,Ca,cb,pb,yb,Yb,cc,Ec,od;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Dd){switch(Dd.nextAddress){case 1:Ea=G;N=Ea.id;oa=Ea.commit;
Ca=Ea.name;cb=Ea.ref;pb=Ea.world;yb=O.constructor;if(pb)return Dd.return(yb.loadWorld(pb,O));if(N||oa)return Dd.return(yb.loadFromCommit(N||oa,O));if(Ca)return Dd.return(yb.loadFromDB(Ca,cb,O));Yb=kd.LoadingIndicator.open("loading project browser...");return Dd.yield(Yb.whenRendered(),2);case 2:cc=kd.morph({fill:kd.Color.black.withA(.5),extent:O.extent,name:"dark overlay",opacity:0,reactsToPointer:!1,renderOnGPU:!0,halosEnabled:!1});cc.openInWorld(kd.pt(0,0));cc.animate({opacity:1,duration:300});
if(Ec=O.get("a project browser")){Dd.jumpTo(3);break}return Dd.yield(kd.resource("part://partial freezing/project browser").read(),4);case 4:Ec=Dd.yieldResult;case 3:return od=Ec,od.name="a project browser",od.hasFixedPosition=!0,od.epiMorph=!0,od.bringToFront().alignInWorld(O),od.update(),od.focus(),kd.once(od,"remove",function(){return cc.animate({opacity:0}).then(function(){return cc.remove()})}),Yb.remove(),Dd.return(od)}})}},{name:"add external package dependency to object",exec:function(O,G){G=
void 0===G?{}:G;var Ea,N,oa,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==cb.nextAddress)return Ea=G.target||O,N=Ea.metadata&&Ea.metadata.externalPackages||[],cb.yield(O.editListPrompt("modify package dependencies of "+Ea,N),2);oa=cb.yieldResult;Ca=oa.list;if(!Ca)return cb.return();Ca.length?(Ea.metadata||(Ea.metadata={}),Ea.metadata.externalPackages=Ca):Ea.metadata&&delete Ea.metadata.externalPackages;return cb.return(!0)})}},{name:"toggle comment browser",exec:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(G){kd.CommentBrowser.toggle();
G.jumpToEnd()})}}];var ge=kd.commands;kd.default=ge;var Ic=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js");Ic.RadialGradient=ic;Ic.Point=Qc;Ic.pt=Jc;Ic.rect=Vb;Ic.Color=Eb;Ic.LinearGradient=jb;Ic.Morph=fb;Ic.Tooltip=Ob;Ic.Image=mb;Ic.VerticalLayout=Cb;Ic.GridLayout=ob;Ic.Text=Dc;Ic.Ellipse=bc;Ic.morph=ee;Ic.Icon=Ma;Ic.num=Db;Ic.arr=oc;Ic.connect=gb;Ic.signal=zb;Ic.Popover=Sc;Ic.ColorPalette=Wd;Ic.ColorPicker=De;Ic.colorWidgets=Fe;Ic.joinPath=ec;Ic.WHEEL_URL=Ic.joinPath(System.baseURL,
"/lively.ide/assets/color-wheel.png");(function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ea=G.hasOwnProperty("GradientTypeSelector")&&"function"===typeof G.GradientTypeSelector?G.GradientTypeSelector:G.GradientTypeSelector=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,O,[{key:"defaultLinearGradient",get:function(){return new Ic.LinearGradient({stops:[{color:Ic.Color.white,
offset:0},{color:Ic.Color.black,offset:1}]})}},{key:"defaultRadialGradient",get:function(){return new Ic.RadialGradient({stops:[{color:Ic.Color.white,offset:0},{color:Ic.Color.black,offset:1}],focus:Ic.pt(.5,.5),bounds:Ic.rect(0,0,30,30)})}},{key:"update",value:function(N){var oa=$jscomp.makeIterator(this.submorphs),Ca=oa.next().value;oa=oa.next().value;Ca.borderColor=oa.borderColor=Ic.Color.gray.darker();N instanceof Ic.RadialGradient?Ca.borderColor=Ic.Color.orange:N instanceof Ic.LinearGradient&&
(oa.borderColor=Ic.Color.orange)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientTypeSelector"}},{key:"properties",get:function(){return{fill:{defaultValue:Ic.Color.transparent},layout:{initialize:function(){this.extent=Ic.pt(180,40);this.layout=new Ic.GridLayout({grid:[[null,"radialMode",null,"linearMode",null]],autoAssign:!1,fitToCell:!1})}},submorphs:{initialize:function(){var N=this,oa=$jscomp.makeIterator(this.submorphs=[Ic.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},
name:"radialMode",fill:this.defaultRadialGradient}),Ic.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"linearMode",fill:this.defaultLinearGradient})]),Ca=oa.next().value;oa=oa.next().value;Ic.connect(Ca,"onMouseDown",function(){return Ic.signal(N,"radial")});Ic.connect(oa,"onMouseDown",function(){return Ic.signal(N,"linear")})}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:660,end:2566})})(Ic.Morph);var qe=function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ea=G.hasOwnProperty("GradientEditor")&&"function"===typeof G.GradientEditor?G.GradientEditor:G.GradientEditor=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};
return rc(Ea,O,[{key:"remove",value:function(){rc._get(Object.getPrototypeOf(Ea.prototype),"remove",this).call(this);this.gradientHandle&&this.gradientHandle.remove()}},{key:"selectRadialGradient",value:function(){var N=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){return 1==oa.nextAddress?(N.get("linearMode").borderColor=Ic.Color.gray.darker(),N.get("radialMode").borderColor=Ic.Color.orange,oa.yield(N.applyGradient(Ic.RadialGradient),2)):oa.yield(N.updateGradientHandles(),
0)})}},{key:"selectLinearGradient",value:function(){var N=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){return 1==oa.nextAddress?(N.get("radialMode").borderColor=Ic.Color.gray.darker(),N.get("linearMode").borderColor=Ic.Color.orange,oa.yield(N.applyGradient(Ic.LinearGradient),2)):oa.yield(N.updateGradientHandles(),0)})}},{key:"applyGradient",value:function(N){var oa=this,Ca,cb,pb,yb,Yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){Ca=oa.gradientValue;oa.get("gradientEditor");
Ca&&Ca.isGradient?(cb=Ca,pb=cb.stops,yb=cb.focus,Yb=cb.vector,oa.gradientValue=new N({stops:pb,bounds:oa.gradientBounds,focus:yb,vector:Yb})):oa.gradientValue=new N({stops:[{color:Ic.Color.white,offset:0},{color:Ic.Color.black,offset:1}],bounds:oa.gradientBounds});oa.update(oa.gradientValue);cc.jumpToEnd()})}},{key:"showGradientHandlesOn",value:function(N){this.handleMorph=N;this.updateGradientHandles()}},{key:"updateGradientHandles",value:function(){var N=this,oa,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==
cb.nextAddress)return oa=300,Ca=N.gradientValue.__proto__.constructor,N.handleMorph?N.gradientHandle?cb.yield(N.gradientHandle.fadeOut(oa),3):cb.jumpTo(2):cb.return();Ca==Ic.RadialGradient?N.gradientHandle=new Ic.GradientFocusHandle({target:N.handleMorph}):Ca==Ic.LinearGradient&&(N.gradientHandle=new Ic.GradientDirectionHandle({target:N.handleMorph}));N.gradientHandle&&(Ic.signal(N,"openHandle",N.gradientHandle),N.gradientHandle.relayout(),N.gradientHandle.opacity=0,N.gradientHandle.animate({opacity:1,
duration:oa}));cb.jumpToEnd()})}},{key:"update",value:function(N){(N=void 0===N?this.gradientValue:N)&&N.isGradient&&this.get("gradientEditor").update(N)}},{key:"build",value:function(){var N;this.submorphs=[N=new Ic.GradientTypeSelector({name:"typeSelector"}),this.gradientEditor()];Ic.connect(N,"radial",this,"selectRadialGradient");Ic.connect(N,"linear",this,"selectLinearGradient");Ic.connect(this,"gradientValue",this,"update");this.update(this.gradientValue);N.update(this.gradientValue);this.gradientValue&&
this.updateGradientHandles()}},{key:"gradientEditor",value:function(){return Ic.morph({fill:null,clipMode:"hidden",extent:Ic.pt(190,80),submorphs:[new Ic.GradientStopVisualizer({position:Ic.pt(5,30),name:"gradientEditor",gradientEditor:this})]})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientEditor"}},{key:"properties",get:function(){return{layout:{initialize:function(){this.layout=new Ic.VerticalLayout({spacing:3})}},fill:{defaultValue:Ic.Color.transparent},handleMorph:{},
gradientValue:{set:function(N){N&&N.isGradient||(N=!1);this.setProperty("gradientValue",N)}},submorphs:{initialize:function(){this.build()}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:2575,end:6191})}(Ic.Morph);Ic.GradientEditor=qe;Ic.GradientEditor=qe;Ic.GradientEditor=
qe;(function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ea=G.hasOwnProperty("StopControlHead")&&"function"===typeof G.StopControlHead?G.StopControlHead:G.StopControlHead=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,O,[{key:"update",value:function(N){var oa=this.getSubmorphNamed("paletteField");this.getSubmorphNamed("pickerField");oa||(this.submorphs=[oa=this.paletteField(Ic.pt(10,
10))]);oa.fill=this.stopColor=N.stops[this.index].color}},{key:"onHoverIn",value:function(){var N=this.targetProperty.stops[this.index].color;this.palette=this.palette||new Ic.Popover({name:"Color Palette",targetMorph:new Ic.ColorPalette({color:N})});Ic.connect(this.palette.targetMorph,"color",this.palette,"color");this.picker=this.picker||new Ic.ColorPicker({color:N});this.picker.color=N;this.scheduleExpand()}},{key:"onHoverOut",value:function(){this.scheduleShrink()}},{key:"scheduleExpand",value:function(){this.queue.pop()||
(this.queue.push(this.expand),this.dequeue())}},{key:"scheduleShrink",value:function(){this.queue.pop()||(this.queue.push(this.shrink),this.dequeue())}},{key:"dequeue",value:function(){var N=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){if(1==oa.nextAddress){if(N.queueActive)return oa.return();N.queueActive=!0}if(3!=oa.nextAddress)return 0<N.queue.length?oa.yield(N.queue.shift().bind(N)(),2):oa.jumpTo(3);N.queueActive=!1;oa.jumpToEnd()})}},{key:"expand",value:function(){var N=
this,oa,Ca,cb,pb,yb,Yb,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){if(1<N.submorphs.length)return Ec.return();oa=N.get("paletteField");cb=Ic.pt(2,-14);N.submorphs=[N.closeButton(),oa,N.pickerField()];N.master={auto:"styleguide://SystemWidgets/stop control head/expanded"};Ca=N.get("gradientEditor");pb=N.transformRectToMorph(Ca,N.innerBounds());yb=pb.x;Yb=pb.width;cc=yb+Yb-Ca.width;yb<N.width/2&&(cb=cb.addXY(N.width/3-yb,0));cc>N.width/2&&(cb=cb.addXY(N.width/3-cc,0));oa.extent=
Ic.pt(15,15);N.center=cb;N.stopVisualizer.gradientEditor.update();Ec.jumpToEnd()})}},{key:"shrink",value:function(){var N=this,oa,Ca,cb,pb,yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){if(3>N.submorphs.length)return Yb.return();oa=Ic.pt(2,-14);Ca=$jscomp.makeIterator([N.get("close"),N.get("paletteField"),N.get("pickerField")]);cb=Ca.next().value;pb=Ca.next().value;yb=Ca.next().value;pb.bringToFront();cb.remove();yb.remove();N.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"};
N.center=oa;Yb.jumpToEnd()})}},{key:"onWidgetClosed",value:function(){this.palette=this.picker=null;this.shrink()}},{key:"removeStop",value:function(){this.stopVisualizer.removeStop(this.index)&&this.remove()}},{key:"closeButton",value:function(){var N=new Ic.Morph({name:"close",extent:Ic.pt(15,15),fill:Ic.Color.transparent,origin:Ic.pt(0,-3),clipMode:"hidden",submorphs:[Ic.Icon.makeLabel("times",{styleClasses:["closeButton"]})]});Ic.connect(N,"onMouseDown",this,"removeStop");return N}},{key:"updateColor",
value:function(N){this.stopVisualizer.updateStop(this.index,{color:N})}},{key:"openColorWidget",value:function(N){this.stopVisualizer.stopControls.forEach(function(oa){return oa.head.closeAllWidgets()});this[N].topLeft=Ic.pt(0,0);Ic.connect(this[N],"color",this,"updateColor");Ic.connect(this[N],"close",this,"onWidgetClosed");Ic.connect(this.stopVisualizer,"remove",this[N],"remove");Ic.connect(this[N],"onBlur",this,"removeWhenLostFocus",{converter:function(){return N},varMapping:{name:N}});this[N].fadeIntoWorld(this.globalBounds().bottomCenter());
this[N].focus()}},{key:"removeWhenLostFocus",value:function(N){var oa=this;setTimeout(function(){$world.focusedMorph.ownerChain().includes(oa[N])||$world.focusedMorph.isMenuItem?oa[N].focus():oa.closeColorWidget(N)},100)}},{key:"closeColorWidget",value:function(N){this[N]&&this[N].remove()}},{key:"closeAllWidgets",value:function(){this.closeColorWidget("palette");this.closeColorWidget("picker")}},{key:"paletteField",value:function(N){N=Ic.morph({type:"ellipse",name:"paletteField",extent:N,styleClasses:["paletteField"]});
Ic.connect(N,"onMouseDown",this,"openColorWidget",{converter:function(){return"palette"}});return N}},{key:"pickerField",value:function(){var N=new Ic.Image({name:"pickerField",styleClasses:["pickerField"]});Ic.connect(N,"onMouseDown",this,"openColorWidget",{converter:function(){return"picker"}});return N}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"StopControlHead"}},{key:"properties",get:function(){return{stopVisualizer:{},gradientEditor:{},targetProperty:{get:function(){return this.stopVisualizer.targetProperty}},
master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"}}},index:{},queue:{defaultValue:[]},isHaloItem:{defaultValue:!0}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:6193,end:11487})})(Ic.Morph);(function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),
Ea=G.hasOwnProperty("GradientStopVisualizer")&&"function"===typeof G.GradientStopVisualizer?G.GradientStopVisualizer:G.GradientStopVisualizer=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,O,[{key:"update",value:function(N){this.fill=new Ic.LinearGradient({stops:N.stops,vector:"eastwest"});this.get("instruction").animate({visible:!1,duration:300});this.renderStopControls(N)}},{key:"onHoverOut",value:function(){this.toggleStopPreview(!1)}},
{key:"onMouseMove",value:function(N){var oa=N.positionIn(this);N=oa.x;this.stopControls&&this.stopControls.find(function(Ca){return Ca.bounds().containsPoint(oa)})?this.toggleStopPreview(!1):(this.toggleStopPreview(!0),this.get("stopControlPreview").position=Ic.pt(N,0))}},{key:"onMouseDown",value:function(N){if(this.get("stopControlPreview").visible){var oa=N.positionIn(this).x/this.width;N=this.targetProperty.stops.findIndex(function(Ca){return Ca.offset>oa});N=0>N?this.targetProperty.stops.length-
1:N;this.insertStop(N,oa)}}},{key:"toggleStopPreview",value:function(N){this.get("instruction").visible||(this.get("stopControlPreview").visible=N)}},{key:"removeStop",value:function(N){var oa=this.targetProperty;return 2<oa.stops.length?(Ic.arr.removeAt(oa.stops,N),this.targetProperty=oa,!0):!1}},{key:"insertStop",value:function(N,oa){var Ca=this.targetProperty;Ic.arr.pushAt(Ca.stops,{offset:oa,color:Ca.stops[N].color},N);this.targetProperty=Ca}},{key:"updateStop",value:function(N,oa){var Ca=this.targetProperty;
Ca.stops[N]=Object.assign({},Ca.stops[N],{},oa);this.targetProperty=Ca}},{key:"renderStopControls",value:function(N){var oa=this;if(!this.stopControls||this.stopControls.length!=N.stops.length){var Ca=$jscomp.makeIterator(this.submorphs),cb=Ca.next().value;Ca=Ca.next().value;this.stopControls=N.stops.map(function(pb,yb){return new Ic.GradientStopControl({stopVisualizer:oa,index:yb})});this.submorphs=[cb,Ca].concat($jscomp.arrayFromIterable(this.stopControls));Ic.arr.invoke(this.stopControls,"update",
N)}Ic.arr.invoke(this.stopControls,"update",N)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopVisualizer"}},{key:"properties",get:function(){return{fill:{defaultValue:Ic.Color.gray},gradientEditor:{},draggable:{defaultValue:!1},targetProperty:{derived:!0,get:function(){return this.gradientEditor&&this.gradientEditor.gradientValue},set:function(N){this.gradientEditor.gradientValue=N}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop visualizer"}}},
submorphs:{after:["gradientEditor"],initialize:function(){this.submorphs=[{type:"label",name:"instruction",value:"Select Gradient Type",visible:!(this.targetProperty&&this.targetProperty.isGradient)},{name:"stopControlPreview",visible:!1,master:{auto:"styleguide://SystemWidgets/stop control preview"},submorphs:[Ic.Icon.makeLabel("plus-circle",{name:"addStopLabel"})]}]}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:11489,end:14883})})(Ic.Morph);(function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ea=G.hasOwnProperty("GradientStopControl")&&"function"===typeof G.GradientStopControl?G.GradientStopControl:G.GradientStopControl=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return rc(Ea,O,[{key:"update",value:function(N){this.position=this.stopVisualizer.extent.subPt(Ic.pt(10,0)).scaleByPt(Ic.pt(N.stops[this.index].offset,0)).addPt(Ic.pt(5,0));this.head.update(N)}},{key:"onDragStart",value:function(N){this.nativeCursor="-webkit-grabbing";this.stopVisualizer.nativeCursor="-webkit-grabbing";this.offsetView=(new Ic.Tooltip).openInWorld(N.hand.position.addPt(Ic.pt(10,10)))}},{key:"onDrag",value:function(N){var oa=Math.max(0,Math.min(1,(this.position.x-5+N.state.dragDelta.x)/
(this.stopVisualizer.width-10)));this.stopVisualizer.updateStop(this.index,{offset:oa});this.offsetView.description=(100*oa).toFixed(2)+"%";this.offsetView.position=N.hand.position.addPt(Ic.pt(10,10))}},{key:"onDragEnd",value:function(){this.nativeCursor="-webkit-grab";this.stopVisualizer.nativeCursor="auto";this.offsetView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopControl"}},{key:"properties",get:function(){return{index:{},head:{},stopVisualizer:{},styleClasses:{defaultValue:["stopControlLine"]},
nativeCursor:{defaultValue:"-webkit-grab"},draggable:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop control"}}},submorphs:{after:["index","stopVisualizer"],initialize:function(){this.head=new Ic.StopControlHead({name:"stop control head",stopVisualizer:this.stopVisualizer,index:this.index});this.head.stopControl=this;this.addMorph(this.head)}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:14885,end:16661})})(Ic.Morph);(function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ea=G.hasOwnProperty("FocusHandle")&&"function"===typeof G.FocusHandle?G.FocusHandle:G.FocusHandle=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,
O,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().center()}},{key:"onDragStart",value:function(N){this.tfm=this.gradientHandle.target.getGlobalTransform().inverse();this.focusView=(new Ic.Tooltip).openInWorld(N.hand.position.addPt(Ic.pt(10,10)))}},{key:"onDrag",value:function(N){var oa=N.state.dragDelta,Ca=this.gradientHandle,cb=Ca.target.fill;cb.focus=cb.focus.addXY(oa.x/Ca.target.width,oa.y/Ca.target.height);this.focusView.description="x: "+(100*cb.focus.x).toFixed()+
"%, y: "+(100*cb.focus.y).toFixed()+"%";this.focusView.position=N.hand.position.addPt(Ic.pt(10,10));Ca.target.makeDirty();Ca.relayout()}},{key:"onDragEnd",value:function(N){this.focusView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"FocusHandle"}},{key:"properties",get:function(){return{gradientHandle:{},styleClasses:{defaultValue:["focusHandle"]},extent:{defaultValue:Ic.pt(20,20)},fill:{defaultValue:Ic.Color.orange}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:16663,end:17666})})(Ic.Ellipse);(function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ea=G.hasOwnProperty("BoundsHandle")&&"function"===typeof G.BoundsHandle?G.BoundsHandle:G.BoundsHandle=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return rc(Ea,O,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().partNamed(this.side);this.scale=1/this.gradientHandle.target.getGlobalTransform().getScale()}},{key:"onDragStart",value:function(N){this.boundsView=(new Ic.Tooltip).openInWorld(N.hand.position.addPt(Ic.pt(10,10)))}},{key:"onDrag",value:function(N){var oa=this.gradientHandle,Ca=oa.target.fill,cb=Ca.bounds.partNamed(this.side).addPt(N.state.dragDelta.scaleBy(2));Ca.bounds=Ca.bounds.withPartNamed(this.side,
cb);this.boundsView.description="w: "+Ca.bounds.width.toFixed()+"px h: "+Ca.bounds.height.toFixed()+"px";this.boundsView.position=N.hand.position.addPt(Ic.pt(10,10));oa.target.makeDirty();oa.relayout()}},{key:"onDragEnd",value:function(N){this.boundsView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"BoundsHandle"}},{key:"properties",get:function(){return{side:{},gradientHandle:{},styleClasses:{after:["side"],initialize:function(){this.styleClasses=["boundsHandle",this.side]}}}}}],
G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:17668,end:18747})})(Ic.Ellipse);var Oa=function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ea=G.hasOwnProperty("GradientFocusHandle")&&"function"===typeof G.GradientFocusHandle?G.GradientFocusHandle:
G.GradientFocusHandle=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,O,[{key:"relayout",value:function(){var N=this.target.fill,oa=N.focus;this.extent=N.bounds.extent();this.submorphs.forEach(function(Ca){return Ca.relayout()});this.rotation=this.target.rotation;this.scale=this.target.scale;this.borderWidth=2/this.scale;this.owner&&(this.center=this.owner.localizePointFrom(this.target.extent.scaleByPt(oa),
this.target))}},{key:"initBoundsHandles",value:function(){var N=this;this.bounds().sides.forEach(function(oa){N.addMorph(new Ic.BoundsHandle({gradientHandle:N,side:oa,name:"bounds handle "+oa.split("C")[0]}))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientFocusHandle"}},{key:"properties",get:function(){return{target:{},isHaloItem:{defaultValue:!0},hasFixedPosition:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient focus handle"}}},
submorphs:{initialize:function(){this.submorps=[];this.initBoundsHandles();this.addMorph(new Ic.FocusHandle({gradientHandle:this}));this.relayout()}}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:18756,end:20039})}(Ic.Ellipse);Ic.GradientFocusHandle=Oa;Ic.GradientFocusHandle=
Oa;Ic.GradientFocusHandle=Oa;(function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ea=G.hasOwnProperty("RotationPoint")&&"function"===typeof G.RotationPoint?G.RotationPoint:G.RotationPoint=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,O,[{key:"relayout",value:function(){this.center=Ic.Point.polar(this.gradientHandle.width/2,this.gradientHandle.target.fill.vectorAsAngle())}},
{key:"onDragStart",value:function(N){this.angleView=(new Ic.Tooltip).openInWorld(N.hand.position.addPt(Ic.pt(10,10)));this.angleView.rotation=0}},{key:"onDrag",value:function(N){var oa=this.gradientHandle;oa.target.fill.vector=N.positionIn(oa).theta();oa.target.makeDirty();oa.relayout();this.angleView.description=(Ic.num.toDegrees(oa.target.fill.vectorAsAngle())+180).toFixed()+"\u00b0";this.angleView.position=N.hand.position.addPt(Ic.pt(10,10))}},{key:"onDragEnd",value:function(N){this.angleView.remove()}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RotationPoint"}},{key:"properties",get:function(){return{gradientHandle:{}}}}],G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20041,end:20838})})(Ic.Ellipse);(function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),
Ea=G.hasOwnProperty("GradientDirectionHandle")&&"function"===typeof G.GradientDirectionHandle?G.GradientDirectionHandle:G.GradientDirectionHandle=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,O,[{key:"isHaloItem",get:function(){return!0}},{key:"relayout",value:function(){this.owner&&(this.position=this.owner.localizePointFrom(this.target.extent.scaleBy(.5),this.target));this.rotationPoint.relayout()}},{key:"initRotationPoint",
value:function(){this.rotationPoint=this.addMorph(new Ic.RotationPoint({gradientHandle:this,name:"rotation point"}))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientDirectionHandle"}},{key:"properties",get:function(){return{target:{},origin:{defaultValue:Ic.pt(25,25)},extent:{defaultValue:Ic.pt(50,50)},hasFixedPosition:{defaultValue:!0},submorphs:{initialize:function(){this.initRotationPoint();this.relayout()}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient direction handle"}}}}}}],
G,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20840,end:21812})})(Ic.Ellipse);Ic.colorWidgets.GradientEditor=Ic.GradientEditor;var Xa=lively.FreezerRuntime.recorderFor("lively.components/canvas.js");Xa.pt=Jc;Xa.Point=Qc;Xa.rect=Vb;Xa.Color=Eb;Xa.Morph=fb;Xa.Image=mb;Xa.connect=
gb;Oa=Ia("C",function(O){var G=lively.FreezerRuntime.recorderFor("lively.components/canvas.js"),Ea=G.hasOwnProperty("Canvas")&&"function"===typeof G.Canvas?G.Canvas:G.Canvas=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,O,[{key:"context",get:function(){if(this._canvas)return this._canvas.getContext(this.contextType);this.world()&&this.env.renderer.getNodeForMorph(this)||console.warn("Context not yet rendered. Please ensure that the Canvas Morph has been rendered first before accessing the context. This can be achieved by waiting for the whenRendered() promise before you proceed accessing the context property.");
return null}},{key:"_canvas",set:function(N){var oa=this.__canvas__;this.__canvas__=N;this.restoreContent(oa,N)}},{key:"_canvas",get:function(){return this.__canvas__}},{key:Symbol.for("lively-instance-initialize"),value:function(N){N=void 0===N?{}:N;rc._get(Object.getPrototypeOf(Ea.prototype),Symbol.for("lively-instance-initialize"),this).call(this,N);Xa.connect(this,"extent",this,"onExtentChanged")}},{key:"afterRender",value:function(N,oa){oa?this._canvas=N:"function"===typeof this.__canvas_init__&&
(this.__canvas_init__(),delete this.__canvas_init__)}},{key:"restoreContent",value:function(N,oa){var Ca=this.contextType,cb=this.preserveContents;"function"===typeof this.__canvas_init__?(this.__canvas_init__(),delete this.__canvas_init__):cb&&"2d"==Ca&&N&&N!==oa&&this.context.drawImage(N,0,0)}},{key:"onExtentChanged",value:function(){var N=this;if(this._canvas&&this.preserveContents&&this.context.getImageData){var oa=this._canvas,Ca=oa.width;oa=oa.height;if(Ca&&oa){var cb=this.context.getImageData(0,
0,Ca,oa);this.__canvas_init__=function(){N.context.putImageData(cb,0,0)}}}}},{key:"clear",value:function(N){var oa=this.context;if(oa){var Ca=this._canvas,cb=Ca.width;Ca=Ca.height;oa.save();oa.setTransform(1,0,0,1,0,0);N?(N.toCSSString&&(N=N.toCSSString()),oa.fillStyle=N,oa.fillRect(0,0,cb,Ca)):oa.clearRect(0,0,cb,Ca);oa.restore()}}},{key:"render",value:function(N){return N.renderCanvas(this)}},{key:"withContextDo",value:function(N){var oa=this;this._canvas?N(this.context):this.__canvas_init__=function(){return N(oa.context)}}},
{key:"toDataURI",value:function(){return this._canvas&&this._canvas.toDataURL()}},{key:"fromDataURI",value:function(N){var oa=this,Ca=new Xa.Image;Ca.onload=function(){oa._canvas.width=Ca.width;oa._canvas.height=Ca.height;oa.context.drawImage(Ca,0,0)};Ca.src=N}},{key:"imageData",value:function(N){N||(N=this.canvasBounds);return this.context.getImageData(N.x,N.y,N.width,N.height)}},{key:"nonTransparentArea",value:function(){for(var N=this.imageData(),oa=N.data,Ca=N.width,cb=N.height,pb=Ca,yb=cb,Yb=
0;Yb<cb;Yb++)for(var cc=0;cc<pb;cc++)0<oa[4*(Yb*Ca+cc)+3]&&(pb=cc,yb>Yb&&(yb=Yb));if(pb===Ca)return Xa.rect(0,0,0,0);Yb=pb;cc=yb;for(--cb;cb>yb;cb--)for(var Ec=Ca-1;Ec>Yb;Ec--)0<oa[4*(cb*Ca+Ec)+3]&&(Yb=Ec,cc<cb&&(cc=cb));return{imageData:N,bounds:Xa.rect(pb,yb,Yb-pb+1,cc-yb+1)}}},{key:"trimNonTransparent",value:function(){var N=this.nonTransparentArea(),oa=N.imageData;N=N.bounds;if(!N.topLeft().equals(Xa.pt(0,0))){var Ca=N.x,cb=N.y;this.context.putImageData(oa,-Ca,-cb,Ca,cb,N.width,N.height);this.position=
this.position.addPt(N.topLeft())}N.extent().equals(this.extent)||(this.extent=N.extent())}},{key:"finishDraw",value:function(N){N=void 0===N?{}:N;var oa=this.context,Ca=N,cb=void 0===Ca.color?"rgba(0,0,0,0.6)":Ca.color,pb=void 0===Ca.width?4:Ca.width;Ca=void 0===Ca.fill?!1:Ca.fill;N=N.fillColor||cb;cb.toCSSString&&(cb=cb.toCSSString());N.toCSSString&&(N=N.toCSSString());oa.strokeStyle=cb;oa.lineWidth=pb;oa.stroke();oa.closePath();Ca&&(oa.fillStyle=N,oa.fill())}},{key:"line",value:function(N,oa,Ca){Ca=
void 0===Ca?{}:Ca;var cb=this.context;cb.beginPath();cb.moveTo(N.x,N.y);cb.lineTo(oa.x,oa.y);cb.lineCap="round";this.finishDraw(Ca)}},{key:"arc",value:function(N,oa,Ca,cb,pb,yb){pb=void 0===pb?!1:pb;yb=void 0===yb?{}:yb;var Yb=this.context;Yb.beginPath();Yb.arc(N.x,N.y,oa,Ca,cb,pb);this.finishDraw(yb)}},{key:"polygon",value:function(N,oa){oa=void 0===oa?{}:oa;var Ca=this.context;Ca.beginPath();Ca.moveTo(N[0].x,N[0].y);for(var cb=0;cb<N.length;cb++)Ca.lineTo(N[cb].x,N[cb].y);Ca.lineTo(N[0].x,N[0].y);
this.finishDraw(oa)}},{key:"text",value:function(N,oa,Ca){Ca=void 0===Ca?{}:Ca;var cb=this.context,pb=Ca,yb=void 0===pb.color?"black":pb.color,Yb=void 0===pb.font?"14px Arial":pb.font,cc=void 0===pb.align?"start":pb.align;pb=void 0===pb.baseline?"bottom":pb.baseline;cb.save();cb.font=Yb;cb.fillStyle=yb;cb.textAlign=cc;cb.textBaseline=pb;Ca.angle&&!isNaN(Ca.angle)&&(cb.translate(oa.x,oa.y),cb.rotate(Ca.angle),cb.translate(-oa.x,-oa.y));cb.fillText(N,oa.x,oa.y);cb.restore()}},{key:"line",value:function(N,
oa,Ca){Ca=void 0===Ca?{}:Ca;var cb=this.context,pb=Ca.color||"rgba(0,0,0,0.6)";Ca=Ca.width||4;pb.toCSSString&&(pb=pb.toCSSString());cb.strokeStyle=pb;cb.beginPath();cb.lineWidth=Ca;cb.moveTo(N.x,N.y);cb.lineTo(oa.x,oa.y);cb.stroke();cb.closePath()}},{key:"spiral",value:function(){this.clear(Xa.Color.white);for(var N=this.innerBounds().center(),oa=0,Ca=1,cb=0;150>cb;cb++){var pb=N.addPt(Xa.Point.polar(Ca,oa));this.line(N,pb,{color:Xa.Color.random()});N=pb;oa+=Math.PI/10;Ca+=.3}}},{key:"rect",value:function(N,
oa,Ca){Ca=void 0===Ca?{}:Ca;var cb=this.context;cb.beginPath();cb.rect(N.x,N.y,oa.x,oa.y);this.finishDraw(Ca)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Canvas"}},{key:"properties",get:function(){return{extent:{defaultValue:Xa.pt(200,200)},fill:{defaultValue:Xa.Color.transparent},contextType:{defaultValue:"2d"},preserveContents:{defaultValue:!0},canvasExtent:{get:function(){return this._canvas&&Xa.pt(this._canvas.width,this._canvas.height)}},canvasBounds:{readOnly:!0,get:function(){return this._canvas&&
this.canvasExtent.extentAsRectangle()}},_serializedContents:{get:function(){return this.preserveContents&&this.toDataURI()},set:function(N){var oa=this;this.withContextDo(function(){return oa.fromDataURI(N)})}}}}}],G,{pathInPackage:function(){return"canvas.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.components",version:"0.1.0"}}},{start:233,end:8699})}(Xa.Morph));
Xa.Canvas=Oa;Xa.Canvas=Oa;Xa.Canvas=Oa;var Sa=lively.FreezerRuntime.recorderFor("lively.ide/world.js");Sa.resource=xb;Sa.Rectangle=vb;Sa.Color=Eb;Sa.pt=Jc;Sa.arr=oc;Sa.fun=Qb;Sa.obj=Tc;Sa.promise=Lb;Sa.PropertyPath=tc;Sa.once=Cc;Sa.GridLayout=ob;Sa.MorphicDB=Kb;Sa.easings=Rd;Sa.HTMLMorph=za;Sa.Text=Dc;Sa.Label=bb;Sa.Path=P;Sa.Polygon=X;Sa.morph=ee;Sa.Ellipse=bc;Sa.touchInputDevice=ya;Sa.Icon=Ma;Sa.Morph=fb;Sa.VerticalLayout=Cb;Sa.HorizontalLayout=Ga;Sa.ProportionalLayout=wa;Sa.Tooltip=Ob;Sa.Image=
mb;Sa.inspect=Fd;Sa.config=rd;Sa.World=ja;Sa.loadMorphFromSnapshot=lb;Sa.loadObjectFromPartsbinFolder=qc;Sa.loadPart=Xc;Sa.uploadFile=tf;Sa.InformPrompt=Ja;Sa.ConfirmPrompt=Xb;Sa.MultipleChoicePrompt=Kc;Sa.TextPrompt=Hb;Sa.EditPrompt=Oc;Sa.PasswordPrompt=qb;Sa.ListPrompt=xd;Sa.EditListPrompt=he;Sa.LoadingIndicator=ed;Sa.Halo=$d;Sa.MorphHighlighter=r;Sa.StatusMessage=Ud;Sa.StatusMessageForMorph=ke;Sa.ProportionalLayoutHalo=le;Sa.GridLayoutHalo=ie;Sa.FlexLayoutHalo=yd;Sa.Window=xc;Sa.List=rb;Sa.FilterableList=
Ld;Sa.Menu=sb;Sa.worldCommands=ge;Sa.GradientEditor=qe;Sa.completions=hb;Sa.runEval=Ba;Sa.getClassName=J;Sa.serialize=ta;Sa.Canvas=Oa;Sa.CommentBrowser=Rc;Sa.prefetchCoreStyleguides=Ta;ge=function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Ea=G.hasOwnProperty("LivelyWorld")&&"function"===typeof G.LivelyWorld?G.LivelyWorld:G.LivelyWorld=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,
O,[{key:"visibleBoundsExcludingTopBar",value:function(){var N=$world.getSubmorphNamed("lively top bar"),oa=this.visibleBounds();return N?new Sa.Rectangle(oa.x,oa.y+N.height,oa.width,oa.height-N.height):oa}},{key:"getListedComponents",value:function(){var N=this,oa=this.withAllSubmorphsSelect(function(Ca){return Ca.isComponent&&!N.hiddenComponents.includes(Ca.name)});return Sa.arr.uniq([].concat($jscomp.arrayFromIterable(oa),$jscomp.arrayFromIterable(this.localComponents)))}},{key:"activeWindow",value:function(){return this.getWindows().reverse().find(function(N){return N.isActive()})}},
{key:"getWindows",value:function(){return this.submorphs.filter(function(N){return N.isWindow})}},{key:"activePrompt",value:function(){return this.getPrompts().reverse().find(function(N){return N.isActive()})}},{key:"getPrompts",value:function(){return this.submorphs.filter(function(N){return N.isPrompt})}},{key:"openInWindow",value:function(N,oa){oa=void 0===oa?{title:N.name,name:"window for "+N.name}:oa;N=(new Sa.Window(Object.assign({},oa,{extent:N.extent.addXY(0,25),targetMorph:N}))).openInWorld();
N.ensureNotOverTheTop();return N}},{key:"withTopBarDo",value:function(N){var oa=this.get("lively top bar");oa&&N(oa)}},{key:"onTopBarLoaded",value:function(){}},{key:"onKeyUp",value:function(N){this.withTopBarDo(function(oa){return oa.onKeyUp(N)})}},{key:"onKeyDown",value:function(N){rc._get(Object.getPrototypeOf(Ea.prototype),"onKeyDown",this).call(this,N);N.targetMorph==this&&this.withTopBarDo(function(oa){return oa.onKeyDown(N)})}},{key:"onMouseDown",value:function(N){rc._get(Object.getPrototypeOf(Ea.prototype),
"onMouseDown",this).call(this,N);var oa=N.state.clickedOnMorph,Ca=this.activeWindow();Ca&&oa==this&&Ca.deactivate();this.handleHaloCycle(N);N.state.menu&&N.state.menu.remove();this._tooltipViewer.mouseDown(N)}},{key:"onMouseUp",value:function(N){N.isCommandKey()&&N.stop();if(N.isAltDown()&&Sa.config.altClickDefinesThat){var oa=this.morphsContainingPoint(N.position)[0];setTimeout(function(){return System.global.that=oa},100);oa.show();N.stop();console.log('Set global "that" to '+oa)}}},{key:"onDrag",
value:function(N){}},{key:"whenReady",value:function(){var N=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){return 1==oa.nextAddress?oa.yield(N._styleLoading,2):oa.return(!0)})}},{key:"onLoad",value:function(){var N=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(oa){if(1==oa.nextAddress){N.opacity=0;N.onWindowResize();lively.modules&&lively.modules.removeHook("fetch",window.__logFetch);N.animate({opacity:1,blur:3,duration:1E3,easing:Sa.easings.inOutExpo});if(!N.showsUserFlap&&
!Sa.resource(document.location.href).query().showsUserFlap)return oa.jumpTo(2);N._styleLoading=Sa.prefetchCoreStyleguides(window.worldLoadingIndicator);return oa.yield(N._styleLoading,2)}N.animate({blur:0,duration:1E3,easing:Sa.easings.inOutExpo});document.body.style.overflowX="visible";document.body.style.overflowY="visible";oa.jumpToEnd()})}},{key:"isNotUnique",value:function(N){var oa,Ca,cb,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yb){switch(yb.nextAddress){case 1:return yb.yield(Sa.MorphicDB.default.exists("world",
N),2);case 2:if(oa=yb.yieldResult.exists){yb.jumpTo(3);break}Ca=N+".json";cb=Sa;pb=cb.resource;return yb.yield(System.decanonicalize("lively.morphic/styleguides"),5);case 5:return yb.yield(pb.call(cb,yb.yieldResult).join(Ca).exists(),4);case 4:oa=yb.yieldResult;case 3:return yb.return(oa)}})}},{key:"askForName",value:function(){var N=this,oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){switch(Ca.nextAddress){case 1:return Ca.yield(N.whenRendered(),3);case 3:if(oa){Ca.jumpTo(4);
break}return Ca.yield(N.prompt(["New Project\n",{},"Enter a name for this project:",{fontWeight:"normal"}],{width:400,hasFixedPosition:!0,forceConfirm:!0}),5);case 5:return oa=Ca.yieldResult,Ca.yield(N.isNotUnique(oa),6);case 6:if(!Ca.yieldResult){Ca.jumpTo(3);break}return Ca.yield(N.confirm("This Project name is already taken. Please pick a different one!",{hasFixedPosition:!0,width:400}),8);case 8:oa=!1;Ca.jumpTo(3);break;case 4:return Ca.return(oa)}})}},{key:"onWindowResize",value:function(N){rc._get(Object.getPrototypeOf(Ea.prototype),
"onWindowResize",this).call(this,N);"elastic"===this.resizePolicy&&this.execCommand("resize to fit window")}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var N=this,oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==Ca.nextAddress)return N._cachedDragIndicator||(N._cachedDragIndicator=Sa.loadObjectFromPartsbinFolder("upload-indicator")),Ca.yield(N._cachedDragIndicator,2);oa=Ca.yieldResult;oa.world()||oa.openInWorld();Sa.fun.debounceNamed("remove-upload-indicator",
1E3,function(){N.nativeDrop_removeUploadIndicator()})();Ca.jumpToEnd()})}},{key:"nativeDrop_removeUploadIndicator",value:function(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(N){return N.remove()})}},{key:"onNativeDragover",value:function(N){N.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},{key:"onNativeDrop",value:function(N){var oa=this,Ca,cb,pb,yb,Yb,cc,Ec,od,Dd,ad,Vd,Td,Gd,Cd,ve,Ge,ng,Ag,ag,Oe,Yg,Dg,fh,yf,Jf,Zd,Fh,Fb,uc,td,ud,Pe,sf,Zg,rg,Wi,yl,Vk,kl,rj,Wk,
sj,vk,bk,Nh,ck;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cf){switch(cf.nextAddress){case 1:oa.nativeDrop_removeUploadIndicator();if(N.targetMorph!=oa)return cf.return();Ca=N;cb=Ca.domEvt;pb=cb.dataTransfer;yb=pb.files;Yb=document.location.origin;if(!yb.length){cf.jumpTo(2);break}cc=oa.getCurrentUser();Ec=cc.isGuestUser?"uploads/":"users/"+$world.getCurrentUser().name+"/uploads";if(!N.isAltDown()){cf.jumpTo(3);break}return cf.yield(oa.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",
input:Ec}),4);case 4:if(Ec=cf.yieldResult,!Ec)return cf.return(oa.setStatusMessage("Canceled upload"));case 3:return cf.yield(oa.confirm("Upload "+yb.length+" file"+(1<yb.length?"s":"")+"?"),5);case 5:od=cf.yieldResult;if(!od)return cf.return();Dd=new Sa.FormData;for(ad=0;ad<yb.length;ad++)Dd.append("file",yb[ad],yb[ad].name);Gd=Sa.LoadingIndicator.open("Uploading File");cf.setCatchFinallyBlocks(6);Cd={};ve=function(ai){ai=ai.loaded/ai.total;Gd.progress=ai;Gd.status="Uploaded "+(100*ai).toFixed()+
"%"};cc.isGuestUser||(Cd.Authorization="Bearer "+cc.token);Vd=Sa.resource(System.baseURL,{headers:Cd,onProgress:ve,onLoad:function(ai){return Td=ai}});Vd=Vd.join("/upload?uploadPath="+encodeURIComponent(Ec));return cf.yield(Vd.write(Dd),8);case 8:cf.leaveTryBlock(7);break;case 6:return Ge=cf.enterCatchBlock(),cf.return(oa.showError("Upload failed: "+Ge.message+"\n"));case 7:Gd.remove();cf.setCatchFinallyBlocks(9);oa.setStatusMessage("Uploaded "+Td.uploadedFiles.length+" file");ng=Td.uploadedFiles.map(function(ai){var Xi=
Sa.resource(Yb).join(ai.path);return Object.assign({},ai,{url:Xi.url,name:Xi.name()})});Ag=[];ag=[];Oe=[];Yg=$jscomp.makeIterator(ng);for(Dg=Yg.next();!Dg.done;Dg=Yg.next())fh=Dg.value,fh.type.startsWith("image/")?Ag.push(fh):fh.type.startsWith("video")?ag.push(fh):Oe.push(fh);if(!ag.length){cf.jumpTo(11);break}yf=$jscomp.makeIterator(ag);Jf=yf.next();case 12:if(Jf.done){cf.jumpTo(11);break}Zd=Jf.value;Fh=Object;Fb=Fh.assign;return cf.yield(Sa.loadObjectFromPartsbinFolder("video morph"),15);case 15:Fb.call(Fh,
cf.yieldResult,{videoURL:Zd.url,name:Zd.name}).openInWorld();Jf=yf.next();cf.jumpTo(12);break;case 11:Ag.length&&Ag.forEach(function(ai){var Xi=new Sa.Image({imageUrl:ai.url,autoResize:!0,name:ai.name});Xi.whenLoaded().then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(wk){if(1==wk.nextAddress)return Xi.extent=Xi.naturalExtent.scaleBy(.8*oa.visibleBounds().height/Xi.height),Xi.openInWorld(),wk.yield(Xi.whenRendered(),2);Xi.center=oa.visibleBounds().center();wk.jumpToEnd()})})});
if(!Oe.length){cf.jumpTo(16);break}uc=$jscomp.makeIterator(Oe);td=uc.next();case 17:if(td.done){cf.jumpTo(16);break}ud=td.value;return cf.yield(oa.confirm("open file "+ud.name+" ("+ud.type+")?"),20);case 20:(Pe=cf.yieldResult)&&oa.execCommand("open file",{url:ud.url});td=uc.next();cf.jumpTo(17);break;case 16:cf.leaveTryBlock(10);break;case 9:sf=cf.enterCatchBlock(),oa.showError(sf);case 10:return cf.return();case 2:Zg=cb.dataTransfer.types;if(!Zg.includes("text/html")){cf.jumpTo(21);break}rg=cb.dataTransfer.getData("text/html");
Wi=(new Sa.DOMParser).parseFromString(rg,"text/html");yl=Wi.querySelectorAll("img");if(1===yl.length&&yl[0].src&&Zg.includes("text/uri-list")){Vk=yl[0].src;kl=new Sa.Image({imageUrl:Vk,autoResize:!0,name:Sa.arr.last(Vk.split("/"))});kl.whenLoaded().then(function(){return kl.openInWorld()});cf.jumpTo(22);break}rj=Object;Wk=rj.assign;return cf.yield(Sa.loadObjectFromPartsbinFolder("html-morph"),23);case 23:Wk.call(rj,cf.yieldResult,{html:rg}).openInWorld();case 22:return cf.return();case 21:sj=0;case 24:if(!(sj<
cb.dataTransfer.items.length)){cf.jumpTo(0);break}vk=cb.dataTransfer.items[sj];if("file"!==vk.kind){"string"===vk.kind&&vk.getAsString(function(ai){return Sa.inspect(ai)});cf.jumpTo(25);break}bk=vk.getAsFile();return cf.yield(oa.confirm("Upload "+bk.name+"?"),28);case 28:Nh=cf.yieldResult;if(!Nh){cf.jumpTo(25);break}return cf.yield(Sa.uploadFile(bk,bk.type),30);case 30:(ck=cf.yieldResult)&&ck.openInWorld(),ck.center=oa.visibleBounds().center();case 25:sj++,cf.jumpTo(24)}})}},{key:"menuItems",value:function(){var N=
this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",target:this},{command:"fix font metric",target:this},{command:"inspect server",target:this}]],["Tools",[{command:"open javascript workspace",target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",
target:this,tooltip:"Opens a workspace like interface\nthat allows you to trigger shell comands\nvia select + eval by pressing either "+(new Sa.Text).keysForCommand("doit")+" or "+(new Sa.Text).keysForCommand("printit")},{command:"open shell terminal",target:this,tooltip:"Opens a classic remote shell interface,\nthat allows you to send commands to a\nbash session running on the server.\nAlso comes with advanced git support."},{command:"open workspace",args:{askForMode:!0},target:this}]],{isDivider:!0},
{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Exported Components",[["Toggle Select All",function(){0==N.getListedComponents().length?N.hiddenComponents=[]:N.hiddenComponents=N.withAllSubmorphsSelect(function(oa){return oa.isComponent}).map(function(oa){return oa.name})}]].concat($jscomp.arrayFromIterable(this.withAllSubmorphsSelect(function(oa){return oa.isComponent}).map(function(oa){var Ca=N.hiddenComponents.includes(oa.name);
return[[].concat($jscomp.arrayFromIterable(Sa.Icon.textAttribute(Ca?"square":"check-square")),["  "+oa.name,{}]),function(){N.hiddenComponents=Ca?Sa.arr.without(N.hiddenComponents,oa.name):[oa.name].concat($jscomp.arrayFromIterable(N.hiddenComponents))}]})))],["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return N.resizePolicy="elastic"}]]:[["switch to manual resizing of world",
function(){return N.resizePolicy="static"}]]],["Troubleshooting",[{command:"report a bug",target:this},{command:"clear storage and reload",target:this}]],{isDivider:!0},["Windows",[{command:"toggle minimize all windows",target:this},{command:"close all windows",target:this}]],{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function(N,oa){var Ca=this.env.eventDispatcher.eventState;Ca.menu&&Ca.menu.remove();return Ca.menu=oa&&oa.length?
Sa.Menu.openAtHand(oa,{hand:N&&N.hand||this.firstHand}):null}},{key:"onPaste",value:function(N){var oa=this,Ca,cb,pb,yb,Yb,cc,Ec,od,Dd,ad,Vd,Td;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gd){switch(Gd.nextAddress){case 1:Gd.setCatchFinallyBlocks(2,3);cb=N.domEvt.clipboardData;if(!cb.types.includes("application/morphic")){Gd.jumpTo(3);break}N.stop();pb=JSON.parse(cb.getData("application/morphic"));yb=[];Array.isArray(pb)||(pb=[pb]);Ca=Sa.LoadingIndicator.open("pasting morphs...");
Yb=$jscomp.makeIterator(pb);cc=Yb.next();case 6:if(cc.done){Gd.jumpTo(8);break}Ec=cc.value;return Gd.yield(Sa.loadMorphFromSnapshot(Ec),9);case 9:od=Gd.yieldResult;od.openInWorld(N.hand.position);Ec.copyMeta&&Ec.copyMeta.offset&&(Dd=Ec.copyMeta.offset,ad=Dd.x,Vd=Dd.y,od.moveBy(Sa.pt(ad,Vd)));yb.push(od);cc=Yb.next();Gd.jumpTo(6);break;case 8:oa.showHaloFor(yb);case 3:Gd.enterFinallyBlock();Ca&&Ca.remove();Gd.leaveFinallyBlock(0);break;case 2:Td=Gd.enterCatchBlock(),oa.showError(Td),Gd.jumpTo(3)}})}},
{key:"commands",get:function(){return Sa.worldCommands.concat(rc._get(Object.getPrototypeOf(Ea.prototype),"commands",this)).concat([{name:"open in prototype box",exec:function(N,oa){var Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==cb.nextAddress)return cb.yield(Sa.loadPart("prototype box"),2);Ca=cb.yieldResult;Ca.wrapProto(oa.target);cb.jumpToEnd()})}}])}},{key:"keybindings",get:function(){return rc._get(Object.getPrototypeOf(Ea.prototype),"keybindings",this).concat(Sa.config.globalKeyBindings)}},
{key:"keybindings",set:function(N){rc._set(Object.getPrototypeOf(Ea.prototype),"keybindings",N,this)}},{key:"halos",value:function(){return this.submorphs.filter(function(N){return N.isHalo})}},{key:"haloForPointerId",value:function(N){return this.submorphs.find(function(oa){return oa.isHalo&&oa.state&&oa.state.pointerId===N})}},{key:"showHaloFor",value:function(N,oa,Ca){oa=void 0===oa?this.firstHand&&this.firstHand.pointerId:oa;Ca=void 0===Ca?!0:Ca;if(Sa.Halo)return N="function"===typeof N.createHalo?
N.createHalo(Sa.Halo,oa):new Sa.Halo({pointerId:oa,target:N}),this.addMorph(N),Ca&&N.focus(),N.alignWithTarget(),N}},{key:"showHaloForSelection",value:function(N,oa){return 0<N.length&&this.showHaloFor(N,oa)}},{key:"layoutHaloForPointerId",value:function(N){N=void 0===N?this.firstHand&&this.firstHand.pointerId:N;return this.submorphs.find(function(oa){return oa.isLayoutHalo&&oa.state&&oa.state.pointerId===N})}},{key:"showLayoutHaloFor",value:function(N,oa){oa=void 0===oa?this.firstHand&&this.firstHand.pointerId:
oa;var Ca=N===this?null:N.owner===this?N:N.ownerChain().slice(-2)[0];Ca=Ca?this.submorphs.indexOf(Ca)+1:this.submorphs.length;switch(N.layout.constructor){case Sa.ProportionalLayout:var cb=new Sa.ProportionalLayoutHalo({container:N,pointerId:oa});break;case Sa.HorizontalLayout:case Sa.VerticalLayout:cb=new Sa.FlexLayoutHalo({container:N,pointerId:oa});break;case Sa.GridLayout:cb=new Sa.GridLayoutHalo({container:this.container,pointerId:oa})}return cb&&this.addMorphAt(cb,Ca)}},{key:"highlightMorph",
value:function(N,oa,Ca,cb){cb=void 0===cb?[]:cb;return Sa.MorphHighlighter.for(N,oa,void 0===Ca?!1:Ca,cb)}},{key:"removeHighlighters",value:function(N){return Sa.MorphHighlighter.removeHighlighters(void 0===N?this:N)}},{key:"visibleStatusMessages",value:function(){return this.submorphs.filter(function(N){return N.isStatusMessage})}},{key:"visibleStatusMessagesFor",value:function(N){return this.submorphs.filter(function(oa){return oa.isStatusMessage&&oa.targetMorph===N})}},{key:"logErrorPreperation",
value:function(N){var oa=String(N),Ca=N.stack||"";Ca&&N.message!==N.stack&&(Ca=String(Ca),0===Ca.indexOf(oa)&&(Ca=Ca.slice(oa.length)),oa+="\n"+Ca);return oa}},{key:"logError",value:function(N){this.setStatusMessage(this.logErrorPreperation(N),Sa.Color.red)}},{key:"showError",value:function(N){return this.logError(N)}},{key:"showErrorFor",value:function(N,oa){return this.setStatusMessageFor(N,this.logErrorPreperation(oa),Sa.Color.red)}},{key:"setStatusMessageFor",value:function(N,oa,Ca,cb,pb){cb=
void 0===cb?5E3:cb;if(Sa.StatusMessageForMorph){this.visibleStatusMessagesFor(N).forEach(function(yb){return yb.remove()});oa=new Sa.StatusMessageForMorph(Object.assign({message:oa,color:Ca},pb));this.openStatusMessage(oa,cb);oa.targetMorph=N;oa.fadeIn(300);if(oa.removeOnTargetMorphChange&&N.isText)Sa.once(N,"selectionChange",oa,"fadeOut",{converter:function(){return 200},garbageCollect:!0});return oa}}},{key:"setStatusMessage",value:function(N,oa,Ca,cb){Ca=void 0===Ca?5E3:Ca;cb=void 0===cb?{}:cb;
if(Sa.StatusMessage)return console[oa==Sa.Color.red?"error":"log"](N),Sa.config.verboseLogging?this.openStatusMessage(new Sa.StatusMessage(Object.assign({message:N,color:oa,hasFixedPosition:!0},cb)),Ca):null}},{key:"openStatusMessage",value:function(N,oa){this.addMorph(N);if(N.slidable){for(var Ca=this.visibleStatusMessages(),cb=$jscomp.makeIterator(Ca),pb=cb.next();!pb.done;pb=cb.next()){pb=pb.value;if(Ca.length<=(Sa.config.maxStatusMessages||0))break;!pb.stayOpen&&pb.slidable&&(pb.remove(),Sa.arr.remove(Ca,
pb))}Sa.arr.without(Ca,N).forEach(function(yb){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){!yb.isMaximized&&yb.slidable&&yb.slideTo(yb.position.addPt(Sa.pt(0,-N.extent.y-10)));Yb.jumpToEnd()})});Ca=this.visibleBounds().bottomRight().addXY(-20,-20);N.align(N.bounds().bottomRight(),Ca);N.topRight=Ca.addPt(Sa.pt(0,40));N.animate({bottomRight:Ca,duration:500})}"number"===typeof oa&&setTimeout(function(){return N.stayOpen||N.fadeOut()},oa);return N}},{key:"addProgressBar",value:function(N){N=
void 0===N?{}:N;var oa=this,Ca,cb,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yb){if(1==yb.nextAddress)return Ca=N,cb=void 0===Ca.location?"center":Ca.location,yb.yield(Sa.loadObjectFromPartsbinFolder("progress bar"),2);pb=yb.yieldResult;Object.assign(pb,{progress:0},Sa.obj.dissoc(N,["location"]));oa.addMorph(pb);pb.align(pb[cb],oa.visibleBounds()[cb]());return yb.return(pb)})}},{key:"withProgressBarDo",value:function(N,oa){var Ca=this,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pb){switch(pb.nextAddress){case 1:return pb.yield(Ca.addProgressBar(oa),
2);case 2:return cb=pb.yieldResult,pb.setFinallyBlock(3),pb.yield(N(cb),5);case 5:return pb.return(pb.yieldResult);case 3:pb.enterFinallyBlock(),cb.remove(),pb.leaveFinallyBlock(0)}})}},{key:"openPrompt",value:function(N,oa){oa=void 0===oa?{requester:null,animated:!1}:oa;var Ca=this,cb,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yb){cb=Ca.focusedMorph;pb=Ca.visibleBounds();return yb.return(Ca.withRequesterDo(oa.requester,function(Yb){return $jscomp.asyncExecutePromiseGeneratorProgram(function(cc){N.openInWorldNear(Yb,
Ca);N.height>pb.height&&(N.height=pb.height-5);"function"===typeof oa.customize&&oa.customize(N);oa.animated&&Ca.previousPrompt&&Ca.previousPrompt.world()&&Ca.previousPrompt.transitionTo(N);Ca.previousPrompt=N;return cc.return(Sa.promise.finally(N.activate(oa),function(){return cb&&cb.focus()}))})}))})}},{key:"withRequesterDo",value:function(N,oa){var Ca=this,cb,pb,yb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){switch(Yb.nextAddress){case 1:pb=Ca.visibleBounds().center();if(!N){Yb.jumpTo(2);
break}pb=N.globalBounds().center();N.isWorld&&(pb=N.visibleBounds().center());if(!(cb=N.getWindow())){Yb.jumpTo(2);break}return Yb.yield(cb.toggleFader(!0),4);case 4:pb=cb.globalBounds().center();case 2:return Yb.yield(oa(pb),5);case 5:return yb=Yb.yieldResult,cb&&cb.toggleFader(!1),Yb.return(yb)}})}},{key:"inform",value:function(N,oa){oa=void 0===oa?{fontSize:16,requester:null,animated:!0}:oa;return this.openPrompt(new Sa.InformPrompt(Object.assign({label:void 0===N?"no message":N},oa)),oa)}},{key:"prompt",
value:function(N,oa){oa=void 0===oa?{requester:null,input:"",historyId:null,useLastInput:!1}:oa;N=new Sa.TextPrompt(Object.assign({label:N},oa));oa.forceConfirm&&N.get("cancel button").disable();return this.openPrompt(N,oa)}},{key:"editPrompt",value:function(N,oa){oa=void 0===oa?{requester:null,input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null}:oa;return this.openPrompt(new Sa.EditPrompt(Object.assign({label:N},oa)),oa)}},{key:"passwordPrompt",value:function(N,
oa){oa=void 0===oa?{requester:null,input:""}:oa;return this.openPrompt(new Sa.PasswordPrompt(Object.assign({label:N},oa)),oa)}},{key:"confirm",value:function(N,oa){oa=void 0===oa?{requester:null,animated:!0}:oa;return this.openPrompt(new Sa.ConfirmPrompt(Object.assign({label:N},oa)),oa)}},{key:"multipleChoicePrompt",value:function(N,oa){oa=void 0===oa?{requester:null,animated:!0,choices:[]}:oa;return this.openPrompt(new Sa.MultipleChoicePrompt(Object.assign({label:N},oa)),oa)}},{key:"listPrompt",
value:function(N,oa,Ca){N=void 0===N?"":N;oa=void 0===oa?[]:oa;Ca=void 0===Ca?{requester:null,onSelection:null,preselect:0}:Ca;return this.openPrompt(new Sa.ListPrompt(Object.assign({filterable:!1,padding:Sa.Rectangle.inset(3),label:N,items:oa},Ca)),Ca)}},{key:"filterableListPrompt",value:function(N,oa,Ca){N=void 0===N?"":N;oa=void 0===oa?[]:oa;Ca=void 0===Ca?{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"}:
Ca;return Ca.prompt?(N=Ca.prompt.get("list"),N.items=oa,N.selectedIndex=Ca.preselect||0,this.openPrompt(Ca.prompt,Ca)):this.openPrompt(new Sa.ListPrompt(Object.assign({filterable:!0,padding:Sa.Rectangle.inset(3),label:N,items:oa},Ca)),Ca)}},{key:"editListPrompt",value:function(N,oa,Ca){oa=void 0===oa?[]:oa;Ca=void 0===Ca?{requester:null,multiSelect:!0,historyId:null}:Ca;return this.openPrompt(new Sa.EditListPrompt(Object.assign({label:void 0===N?"":N,multiSelect:!0,items:oa,padding:Sa.Rectangle.inset(3)},
Ca)),Ca)}},{key:"showLoadingIndicatorFor",value:function(N,oa){return this.addMorph(Sa.LoadingIndicator.open(oa,{center:N.globalBounds().center()}))}},{key:"defaultMenuItems",value:function(N,oa){function Ca(ad){var Vd=this,Td=pb.morphsContainingPoint(Yb.worldPoint(Sa.pt(0,0)));Td.pop();var Gd=Td.indexOf(Yb);Td=Td.slice(Gd+1);return Td.map(function(Cd){return[String(Cd),ad.bind(Vd,Cd)]})}var cb=this,pb=this,yb=[],Yb=N;this.reset&&"function"===typeof this.reset&&yb.push(["Reset",function(){cb.reset()}]);
yb.push(["Open in...",[["Window",function(){Yb.openInWindow()}]]]);yb.push(["Add morph to...",{getItems:Ca.bind(Yb,function(ad){return ad.addMorph(Yb)})}]);yb.push(["Get halo on...",{getItems:Ca.bind(Yb,function(ad){return ad.world().showHaloFor(ad)})}]);Yb.owner&&1<Yb.owner.submorphs.length&&yb.push(["Arrange morph",[["Bring to front",function(){return Yb.owner.addMorph(Yb)}],["Send to back",function(){return Yb.owner.addMorphBack(Yb)}],["Fit to submorphs",function(){var ad,Vd,Td;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gd){if(1==
Gd.nextAddress)return Gd.yield(Yb.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:Yb}),2);if(3!=Gd.nextAddress)return ad=Gd.yieldResult,"string"!==typeof ad?Gd.return():Gd.yield(Sa.runEval(ad,{topLevelVarRecorder:{Rectangle:Sa.Rectangle}}),3);Vd=Gd.yieldResult;ad=(Td=Vd.value)&&Td.isRectangle?Td:Sa.Rectangle.inset(0);Yb.undoStart("fitToSubmorphs");Yb.fitToSubmorphs(ad);Yb.undoStop("fitToSubmorphs");Gd.jumpToEnd()})}]].concat($jscomp.arrayFromIterable(Sa.PropertyPath("master.auto").get(Yb)?
[["Adjust to Master Component Submorph Hierarchy",function(){return Yb.master.reconcileSubmorphs()}]]:[]))]);this.submorphs.length&&yb.push(["Select all submorphs",function(){return Yb.world().showHaloFor(Yb.submorphs.slice())}]);var cc=[];Yb.startSteppingScripts?cc.push(["Start stepping",function(){Yb.startSteppingScripts()}]):cc.push(["Start stepping",function(){var ad,Vd,Td,Gd,Cd,ve,Ge,ng,Ag,ag,Oe,Yg,Dg,fh,yf,Jf,Zd,Fh,Fb,uc,td,ud,Pe,sf,Zg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rg){switch(rg.nextAddress){case 1:return ad=
[],Vd=$jscomp,Td=Vd.makeIterator,rg.yield(Sa.completions.getCompletions(function(){return Yb},""),2);case 2:Gd=Td.call(Vd,rg.yieldResult.completions);for(Cd=Gd.next();!Cd.done;Cd=Gd.next())for(ve=Cd.value,Ge=$jscomp.makeIterator(ve),ng=Ge.next().value,Ag=Ge.next().value,ag=$jscomp.makeIterator(Ag),Oe=ag.next();!Oe.done;Oe=ag.next())Yg=Oe.value,Yg.startsWith("_")||Yg.startsWith("$")||(Dg=$jscomp.makeIterator(Yg.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[]),Dg.next(),fh=Dg.next().value,yf=Dg.next().value,
fh&&"function"===typeof Yb[fh]&&ad.push({isListItem:!0,string:ng+" "+Yg,value:{selector:fh,args:yf}}));return rg.yield($world.filterableListPrompt("Select method to start",ad,{requester:Yb,historyId:"lively.morphic-start-stepping-chooser"}),3);case 3:return Jf=rg.yieldResult,Zd=$jscomp.makeIterator(Jf.selected),(Fh=Zd.next().value)?rg.yield($world.prompt("Steptime in ms (how of the method will be called)?",{input:100}),4):rg.return();case 4:Fb=rg.yieldResult;Fb=Number(Fb);if(isNaN(Fb))return rg.return();
uc=[Fb,Fh.selector];if(!Fh.args){rg.jumpTo(5);break}td={targetModule:"lively://lively.morphic-stepping-args/eval.js"};return rg.yield($world.editPrompt("Arguments to pass",{input:"["+Fh.args+"]",mode:"js",evalEnvironment:td}),6);case 6:return ud=rg.yieldResult,rg.yield(Sa.runEval(ud,td),7);case 7:Pe=rg.yieldResult;sf=Pe.value;if(Zg=Pe.isError)return $world.inform("Error evaluating the arguments: "+sf),rg.return();Array.isArray(sf)&&uc.push.apply(uc,$jscomp.arrayFromIterable(sf));case 5:Yb.startStepping.apply(Yb,
$jscomp.arrayFromIterable(uc)),rg.jumpToEnd()}})}]);0!=Yb.tickingScripts.length&&cc.push(["Stop stepping",function(){return Yb.stopStepping()}]);0!=cc.length&&yb.push(["Stepping",cc]);yb.push(["Change Tooltip",function(){var ad;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vd){if(1==Vd.nextAddress)return ad=Yb,Vd.yield(Yb.world().prompt("Enter Tooltip",{placeholder:"Description",input:Yb.tooltip||""}),2);ad.tooltip=Vd.yieldResult;Vd.jumpToEnd()})}]);var Ec=["Morphic properties",[]];
yb.push(Ec);yb.push(["display serialization info",function(){var ad,Vd,Td;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gd){if(1==Gd.nextAddress)return Gd.yield(System.import("lively.serializer2/debugging.js"),2);ad=Gd.yieldResult;Vd=ad.SnapshotInspector;Td=Sa.serialize(Yb);Vd.forSnapshot(Td).openSummary();Gd.jumpToEnd()})}]);yb.push(["display object report",function(){var ad,Vd,Td;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gd){if(1==Gd.nextAddress)return Gd.yield(System.import("lively.serializer2/debugging.js"),
2);ad=Gd.yieldResult;Vd=ad.SnapshotInspector;Td=Sa.serialize(Yb);Vd.forSnapshot(Td).openObjectReport();Gd.jumpToEnd()})}]);var od=Sa.Icon.textAttribute("check-square"),Dd=Sa.Icon.textAttribute("square");Object.assign(od[1],{float:"none",display:"inline"});["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(ad){return Ec[1].push([[].concat($jscomp.arrayFromIterable(N[ad]?od:Dd),[" "+ad,{float:"none"}]),function(){return N[ad]=!N[ad]}])});yb.push(["export to HTML",function(){var ad,
Vd,Td,Gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cd){if(1==Cd.nextAddress)return Cd.yield(System.import("lively.morphic/rendering/html-generator.js"),2);if(3!=Cd.nextAddress)return ad=Cd.yieldResult,Vd=ad.generateHTML,Td=Sa.HTMLMorph,Gd="exported-"+N.name,Cd.yield(Vd(N,null,{isFragment:!0,addStyles:!1}),3);(new Td({name:Gd,html:Cd.yieldResult})).openInWorld();Cd.jumpToEnd()})}]);yb.push({isDivider:!0});yb.push(["Add comment",function(){var ad,Vd,Td,Gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cd){if(1==
Cd.nextAddress)return Cd.yield($world.prompt("Enter comment"),2);if(4!=Cd.nextAddress){ad=Cd.yieldResult;if(!ad)return $world.setStatusMessage("Comment not saved","red"),Cd.jumpTo(0);Vd=Sa.pt(0,0);oa&&!oa.halo&&(Td=Yb.localize(oa.position).x/Yb.width,Gd=Yb.localize(oa.position).y/Yb.height,Vd=Sa.pt(Td,Gd));return Cd.yield(Yb.addComment(ad,Vd),4)}$world.setStatusMessage("Comment saved","green");Cd.jumpToEnd()})}]);return yb}},{key:"defaultConnectionMenuItems",value:function(N){return N.attributeConnections&&
N.attributeConnections.length?N.attributeConnections.map(function(oa){return[String(oa),[["show",function(){var Ca,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pb){if(1==pb.nextAddress)return pb.yield(System.import("lively.ide/fabrik.js"),2);Ca=pb.yieldResult;cb=Ca.interactivelyShowConnection;cb(oa);pb.jumpToEnd()})}],["edit",function(){var Ca,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pb){if(1==pb.nextAddress)return pb.yield(System.import("lively.ide/fabrik.js"),
2);Ca=pb.yieldResult;cb=Ca.interactivelyReEvaluateConnection;cb(oa);pb.jumpToEnd()})}],["disconnect",function(){oa.disconnect();$world.setStatusMessage("disconnected "+oa)}]]]}):null}},{key:"defaultSourceDataBindings",value:function(N){var oa=N.propertiesAndPropertySettings().properties,Ca=Sa.arr.groupByKey(Object.keys(oa).map(function(pb){pb=Object.assign({name:pb},oa[pb]);return pb.group&&pb.group.startsWith("_")?null:pb}).filter(Boolean),"group");N=["core","geometry","interaction","styling","layouting"];
var cb=[];N.forEach(function(pb){return cb.push(Ca[pb])});Sa.arr.withoutAll(Ca.keys(),N).forEach(function(pb){return cb.push(Ca[pb])});return cb}},{key:"targetDataBindings",value:function(N){for(var oa=[],Ca=N;Ca!==Object.prototype;){var cb=Ca===N?String(this):Sa.getClassName(Ca),pb=null,yb=Sa.obj.getOwnPropertyDescriptors(Ca),Yb=Object.getPrototypeOf(Ca),cc;for(cc in yb){var Ec=yb[cc].value;"function"!==typeof Ec||Ec===Ca.constructor||cc.startsWith("$")||cc.startsWith("_")||(pb||(pb=[]),Ec=Sa.fun.argumentNames(Ec),
pb.push({group:cb+" methods",signature:cc+"("+Ec.join(", ")+")",name:cc}))}pb&&oa.push(pb);Ca=Yb}return this.defaultSourceDataBindings(N).concat(oa)}},{key:"defaultConnectMenuItems",value:function(N,oa){var Ca=this,cb=this.defaultSourceDataBindings(oa),pb=oa.world();cb=cb.map(function(yb){return[yb[0].group||"uncategorized",yb.map(function(Yb){return[Yb.name,N?function(){return N(Yb.name,oa,Yb)}:function(){var cc,Ec;return $jscomp.asyncExecutePromiseGeneratorProgram(function(od){if(1==od.nextAddress)return od.yield(System.import("lively.ide/fabrik.js"),
2);cc=od.yieldResult;Ec=cc.interactiveConnectGivenSource;Ec(oa,Yb.name);od.jumpToEnd()})}]})]});pb&&cb.push(["custom...",N?function(){return N("custom...",oa,null)}:function(){var yb,Yb,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){if(1==Ec.nextAddress)return Ec.yield(System.import("lively.ide/fabrik.js"),2);if(3!=Ec.nextAddress)return yb=Ec.yieldResult,Yb=yb.interactiveConnectGivenSource,Ec.yield(pb.prompt("Enter custom connection point",{requester:oa,historyId:"lively.morphic-custom-connection-points",
useLastInput:!0}),3);(cc=Ec.yieldResult)&&Yb(Ca,cc);Ec.jumpToEnd()})}]);return cb}},{key:"handleHaloCycle",value:function(N){var oa=N.state.clickedOnMorph,Ca=N.isCommandKey(),cb=N.isShiftDown(),pb;Ca&&!oa.isHalo&&(Ca=pb=N.world.morphsContainingPoint(N.position),pb=pb.filter(function(yb){return yb.halosEnabled}),Ca=Ca.filter(function(yb){return yb.halosEnabled}),pb=Ca[0]||pb[0]);cb&&!oa.isHaloItem&&pb&&N.halo&&N.halo.borderBox!=pb?N.halo.addMorphToSelection(pb):(oa=N.halo&&!N.targetMorphs.find(function(yb){return yb.isHaloItem||
yb.keepHalo&&yb.keepHalo(N)}),cb=N.layoutHalo&&!N.targetMorphs.find(function(yb){return yb.isHaloItem}),Ca=(!N.halo||oa)&&pb,cb&&N.layoutHalo.remove(),oa&&N.halo.remove(),Ca&&(N.stop(),this.showHaloFor(pb,N.domEvt.pointerId)))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyWorld"}},{key:"properties",get:function(){return{localComponents:{initialize:function(){var N=this;this.whenRendered().then(function(){N.localComponents?N.localComponents.forEach(function(oa){var Ca,cb,pb,
yb,Yb,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){switch(Ec.nextAddress){case 1:if(oa.owner){Ec.jumpTo(0);break}Ca=oa.withAllSubmorphsSelect(function(od){return od.master&&!od.master._appliedMaster});cb=$jscomp.makeIterator(Ca);pb=cb.next();case 3:if(pb.done){Ec.jumpTo(5);break}yb=pb.value;return Ec.yield(yb.master.applyIfNeeded(!0),4);case 4:pb=cb.next();Ec.jumpTo(3);break;case 5:Yb=N.withAllSubmorphsSelect(function(od){return od.master&&od.master.uses(oa)}),cc=N.localComponents.filter(function(od){return od.master&&
od.master.uses(oa)}),Yb.forEach(function(od){od.requestMasterStyling()}),cc.forEach(function(od){return od.master.applyIfNeeded(!0)}),Ec.jumpToEnd()}})}):N.localComponents=N.withAllSubmorphsSelect(function(oa){return oa.isComponent})})}},name:{set:function(N){this.setProperty("name",N);document.title="lively.next - "+N}},hiddenComponents:{initialize:function(){this.hiddenComponents=[]}},fill:{defaultValue:Sa.Color.rgb(81,90,90)},draggable:{readOnly:!0,get:function(){return!Sa.touchInputDevice}},commentBrowser:{}}}}],
G,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1664,end:42194})}(Sa.World);Sa.LivelyWorld=ge;Sa.LivelyWorld=ge;Sa.LivelyWorld=ge;qe=Ia("a",function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Ea=G.hasOwnProperty("SelectionElement")&&"function"===typeof G.SelectionElement?
G.SelectionElement:G.SelectionElement=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,O,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SelectionElement"}},{key:"properties",get:function(){return{borderColor:{defaultValue:Sa.Color.red},borderWidth:{defaultValue:1},fill:{defaultValue:Sa.Color.transparent},epiMorph:{defaultValue:!0},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],
G,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42203,end:42565})}(Sa.Morph));Sa.SelectionElement=qe;Sa.SelectionElement=qe;Sa.SelectionElement=qe;Oa=Ia("S",function(O){var G=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Ea=G.hasOwnProperty("Selection")&&"function"===typeof G.Selection?
G.Selection:G.Selection=function(N){N&&N[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return rc(Ea,O,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Selection"}},{key:"properties",get:function(){return{fill:{defaultValue:Sa.Color.gray.withA(.2)},borderWidth:{defaultValue:2},borderColor:{defaultValue:Sa.Color.gray},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],G,{pathInPackage:function(){return"world.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42574,end:42894})}(Sa.Morph));Sa.Selection=Oa;Sa.Selection=Oa;Sa.Selection=Oa;ge=Object.freeze({__proto__:null,LivelyWorld:ge,SelectionElement:qe,Selection:Oa});Ia("w",ge)}}});