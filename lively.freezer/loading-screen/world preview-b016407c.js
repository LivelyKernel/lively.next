System.register(["./__root_module__-b4667baa.js","kld-intersections","./index-1bf516c3.js","./index-7dbbd7dc.js"],function(){var ta,lb,yb,Qb,Kb,yd,Cc,rd,Fc,Dc,Rc,$c,Hd,gd,Uc;return{setters:[function(Pa){ta=Pa.aw;lb=Pa.as;yb=Pa.ai;Qb=Pa.aD;Kb=Pa.aB;yd=Pa.an;Cc=Pa.Z;rd=Pa.bO;Fc=Pa.$;Dc=Pa.a5;Rc=Pa.s;$c=Pa.a6;Hd=Pa.C;gd=Pa.a3;Uc=Pa.L},function(){},function(){},function(){}],execute:function(){var Pa=lively.FreezerRuntime.recorderFor("StaticText/index.js");Pa.HTMLMorph=ta;var mb=function(Ub){var Ic=
lively.FreezerRuntime.recorderFor("StaticText/index.js"),wd=Ic.hasOwnProperty("StaticText")&&"function"===typeof Ic.StaticText?Ic.StaticText:Ic.StaticText=function(Eb){Eb&&Eb[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lb(wd,Ub,[{key:"refresh",value:function(){this.html='<span style="line-height: 1.3; font-size: '+this.fontSize+"px; color: "+this.fontColor+"; font-family: "+this.fontFamily+'">'+this.value+"</span>"}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"StaticText"}},{key:"properties",get:function(){return{html:{isStyleProp:!1},fontSize:{type:"Number",set:function(Eb){this.setProperty("fontSize",Eb);this.refresh()}},fontColor:{type:"Color",set:function(Eb){this.setProperty("fontColor",Eb);this.refresh()}},fontFamily:{type:"Enum",set:function(Eb){this.setProperty("fontFamily",Eb);this.refresh()}},value:{set:function(Eb){this.setProperty("value",Eb);this.refresh()}}}}}],Ic,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"StaticText",version:"0.1.1-10"}}},{start:74,end:953})}(Pa.HTMLMorph);mb=Pa.StaticText;Pa.default=mb;var Nb=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js");Nb.Morph=yb;Nb.World=Qb;Nb.HorizontalLayout=Kb;Nb.morph=yd;Nb.MorphicDB=Cc;Nb.graph=rd;Nb.promise=Fc;Nb.date=Dc;Nb.string=Rc;Nb.arr=$c;Nb.Color=Hd;Nb.pt=gd;Nb.LoadingIndicator=Uc;(function(Ub){var Ic=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),
wd=Ic.hasOwnProperty("WorldVersion")&&"function"===typeof Ic.WorldVersion?Ic.WorldVersion:Ic.WorldVersion=function(Eb){Eb&&Eb[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lb(wd,Ub,[{key:"update",value:function(){var Eb=$jscomp.makeIterator(this.submorphs),Sb=Eb.next().value;Eb=Eb.next().value;Sb.imageUrl=this.commit.preview;Eb.textAndAttributes=this.info;Eb.fontColor=this.selected?Nb.Color.white:Nb.Color.darkGray}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"WorldVersion"}},{key:"properties",get:function(){return{commit:{},fill:{defaultValue:Nb.Color.transparent},info:{derived:!0,get:function(){var Eb=this.commit,Sb=Eb.message,sb=Eb.name,ec=Eb.timestamp;return[Eb._id.slice(0,6)+" ",{fontWeight:"bold"},Nb.string.truncate(Sb.split("\n")[0],40)+" ",{}," ("+sb+" ",{},""+Nb.date.format(new Date(ec),"yyyy-mm-dd HH:MM Z"),{}]}},selected:{set:function(Eb){this.setProperty("selected",Eb);this.update()}},layout:{initialize:function(){this.layout=
new Nb.HorizontalLayout({align:"center",spacing:5})}},submorphs:{initialize:function(){this.submorphs=[{type:"image",extent:Nb.pt(30,30),name:"preview",reactsToPointer:!1},{reactsToPointer:!1,type:"label",fill:null,name:"commit info",fontFamily:"Nunito",fontColor:Nb.Color.gray}]}}}}}],Ic,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",
version:"0.1.1-33"}}},{start:274,end:1824})})(Nb.Morph);Pa=function(Ub){var Ic=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),wd=Ic.hasOwnProperty("WorldVersionViewer")&&"function"===typeof Ic.WorldVersionViewer?Ic.WorldVersionViewer:Ic.WorldVersionViewer=function(Eb){Eb&&Eb[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return lb(wd,Ub,[{key:"reset",value:function(){this.getSubmorphNamed("version list").items=[]}},
{key:"onMouseDown",value:function(Eb){switch(Eb.targetMorph.name){case "visit button":this.visitSelectedCommit();break;case "revert button":this.revertToSelectedCommit()}}},{key:"visitSelectedCommit",value:function(){var Eb=this,Sb,sb,ec,rc,yc,Db,ab,Zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kc){switch(kc.nextAddress){case 1:return Sb=Eb.get("version list").selection,sb=Nb.LoadingIndicator.open("Loading "+Sb.name+"..."),ec=$world,rc=Eb.db||Nb.MorphicDB.default,yc=Sb._id,kc.setCatchFinallyBlocks(2,
3),yc?kc.yield(Nb.World.loadFromCommit(yc,void 0,{morphicDB:rc}),8):kc.yield(Nb.World.loadFromDB(Sb.name,Sb.ref,void 0,{morphicDB:rc}),7);case 7:Db=kc.yieldResult;kc.jumpTo(6);break;case 8:Db=kc.yieldResult;case 6:return ab=Db,kc.return(ab);case 3:kc.enterFinallyBlock();sb.remove();kc.leaveFinallyBlock(0);break;case 2:Zb=kc.enterCatchBlock(),console.error(Zb),ec.showError("Error loading world:"+Zb),kc.jumpTo(3)}})}},{key:"revertToSelectedCommit",value:function(){var Eb=this,Sb,sb,ec,rc,yc,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==
ab.nextAddress){Sb=Eb.get("version list").selection;if(!Sb)return ab.return();sb=Eb.db||Nb.MorphicDB.default;ec=Sb;rc=ec._id;yc=ec.name;Db=ec.type;return ab.yield(sb.revert(Db,yc,rc,"HEAD"),2)}return ab.return(Eb.initializeFromStartCommit(Sb,sb,{showRevertButton:!0}))})}},{key:"initializeFromStartCommit",value:function(Eb,Sb,sb){Sb=void 0===Sb?Nb.MorphicDB.default:Sb;sb=void 0===sb?{}:sb;var ec=this,rc,yc,Db,ab,Zb,kc,ua,Ga,cb,rb,pb,Ta,Ua,ob,Wb,lc,Lb,qc,I,V,ra,ya,Gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pb){switch(Pb.nextAddress){case 1:return rc=
sb,yc=void 0===rc.showRefs?!0:rc.showRefs,Db=ec.startCommit=Eb,ab=Db._id,Zb=Db.type,kc=Db.name,ua=ec.getSubmorphNamed("version list spinner"),ua.visible=!0,ua.center=ec.get("version list").center,ec.db=Sb,Pb.yield(Sb.history(Zb,kc),2);case 2:Ga=Pb.yieldResult,cb=Ga.refs,rb=Ga.history,pb=ab,Ta=Nb.graph.invert(rb),Ua=Nb.graph.hull(Ta,ab),ob={_id:!0},Wb=[Eb],lc=$jscomp.makeIterator(Ua),Lb=lc.next();case 3:if(Lb.done)return V=Nb.arr.max(Wb,function(Ca){return Ca.timestamp}),pb=V._id,Pb.yield(Sb.log(pb,
void 0,!0),7);qc=Lb.value;return Pb.yield(Sb.log(qc,void 0,!0,ob),6);case 6:I=Pb.yieldResult;Wb.push.apply(Wb,$jscomp.arrayFromIterable(I));I.forEach(function(Ca){return ob[Ca._id]=!0});Lb=lc.next();Pb.jumpTo(3);break;case 7:ra=Pb.yieldResult;if(yc)for(ya in cb);Gb=ra.map(function(Ca){var Yb=new Nb.WorldVersion({reactsToPointer:!1,commit:Ca});Yb.update();return{isListItem:!0,morph:Yb,value:Ca}});ec.get("version list").items=Gb;ua.visible=!1;Pb.jumpToEnd()}})}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"WorldVersionViewer"}}],Ic,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",version:"0.1.1-33"}}},{start:1841,end:5600})}(Nb.Morph);Pa=Nb.WorldVersionViewer;Nb.default=Pa}}});