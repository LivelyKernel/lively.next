System.register(["./__rootModule___commonjs-entry-71573ff5.js","@babel/plugin-syntax-import-meta"],function(Lc){var pd,Nd,Tc,Jc,$d;return{setters:[function(Bb){pd=Bb.j;Nd=Bb.B;Tc=Bb.b0;Jc=Bb.b1;$d=Bb.i},function(){}],execute:function(){var Bb=window.lively.FreezerRuntime.recorderFor("lively.morphic/text/occur.js");Bb.findOccurPlugin=function(Id){return Id.plugins.slice().reverse().find(function(Ac){return Ac.isOccurPlugin})};Bb.arr=pd;Bb.obj=Nd;Bb.TextSearcher=Tc;Bb.KeyHandler=Jc;Bb.occurKeyHandler=
Object.assign(Bb.KeyHandler.withBindings([{keys:"Escape|Ctrl-G",command:"occur exit"},{keys:"Enter",command:"occur accept"}]),{isOccurHandler:!0});var rd=Lc("occurStartCommand",{name:"occur",exec:function(Id){var Ac=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};Ac.needle&&Id.addPlugin(new Bb.Occur(Ac));return!!Ac.needle}});Bb.occurStartCommand=rd;Bb.occurStartCommand=rd;Bb.occurCommands=[{name:"occur exit",exec:function(Id){var Ac=Bb.findOccurPlugin(Id);if(!Ac)return!1;Ac.options.translatePosition=
!0;Id.removePlugin(Ac);(Id=Bb.findOccurPlugin(Id))&&Id.highlight();return!0},readOnly:!0},{name:"occur accept",bindKey:"Enter",exec:function(Id){var Ac=Bb.findOccurPlugin(Id);if(!Ac)return!1;Ac.options.translatePosition=!0;Id.removePlugin(Ac);(Id=Bb.findOccurPlugin(Id))&&Id.highlight();return!0},readOnly:!0}];rd=Lc("Occur",function(Id){var Ac=window.lively.FreezerRuntime.recorderFor("lively.morphic/text/occur.js"),Pc=Ac.hasOwnProperty("Occur")&&"function"===typeof Ac.Occur?Ac.Occur:Ac.Occur=function(gd){if(!gd||
!gd[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return $d(Pc,Id,[{key:Symbol["for"]("lively-instance-initialize"),value:function(){var gd=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.options=gd;gd.textMorph&&(this.textMorph=gd.textMorph)}},{key:"__serialize__",value:function(){return{__expr__:"new Occur(".concat(Bb.obj.inspect(Bb.obj.dissoc(this.options,["textMorph"])),")"),bindings:{"lively.morphic/text/occur.js":["Occur"]}}}},
{key:"isOccurPlugin",get:function(){return!0}},{key:"attach",value:function(gd){this.textMorph=gd;gd=this.textMorph.cursorPosition;this.displayOccurContent(this.options)&&(gd=this.originalToOccurPosition(gd),this.textMorph.cursorPosition=gd);return this}},{key:"detach",value:function(gd){this.removeHighlight();gd=(gd=this.options.translatePosition&&this.textMorph.cursorPosition)&&this.occurToOriginalPosition(gd);this.displayOriginalContent();gd&&(this.textMorph.cursorPosition=gd);this.textMorph=null;
return this}},{key:"getKeyHandlers",value:function(gd){return gd.concat(Bb.occurKeyHandler)}},{key:"getCommands",value:function(gd){return Bb.occurCommands.concat(gd)}},{key:"matchingLines",value:function(){var gd=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{needle:""};if(!gd.needle)return[];var nd=this.textMorph.document.lineStrings;gd=(new Bb.TextSearcher(this.textMorph)).searchForAll(Object.assign({},gd,{start:{column:0,row:0}}));return Bb.arr.groupBy(gd,function(Fd){return Fd.range.start.row}).mapGroups(function(Fd,
ic){Fd=ic[0].range.start.row;return{row:Fd,ranges:ic.map(function(vd){return vd.range}),line:nd[Fd]}}).toArray()}},{key:"displayOccurContent",value:function(gd){this._originalDocument=this.textMorph.document;var nd=this._originalDocument.constructor,Fd=this.matchingLines(gd),ic=Fd.map(function(vd){return vd.line});nd=this._document=new nd(ic);nd._occurMatchingLines=Fd;return 0<Fd.length?(this.textMorph.changeDocument(nd,!0),this.highlight(gd.needle),!0):!1}},{key:"displayOriginalContent",value:function(){this.textMorph.changeDocument(this._originalDocument)}},
{key:"occurToOriginalPosition",value:function(gd){var nd=this._document._occurMatchingLines;return nd&&nd[gd.row]?{row:nd[gd.row].row,column:gd.column}:gd}},{key:"originalToOccurPosition",value:function(gd){var nd=this._document._occurMatchingLines,Fd={row:0,column:0};if(!nd)return Fd;for(var ic=0;ic<nd.length;ic++)if(nd[ic].row===gd.row)return{row:ic,column:gd.column};return Fd}},{key:"highlight",value:function(gd){var nd=this;this.removeHighlight();var Fd={borderRadius:"4px",backgroundColor:"rgba(87, 255, 8, 0.25)",
position:"absolute","-moz-box-sizing":"border-box","-webkit-box-sizing":"border-box","box-sizing":"border-box","box-shadow":"0 0 4px rgb(91, 255, 50)"};this._document._occurMatchingLines.flatMap(function(ic,vd){return ic.ranges.map(function(sb){return{start:{column:sb.start.column,row:vd},end:{column:sb.end.column,row:vd}}})}).map(function(ic,vd){return{id:"occur-"+vd,range:ic,style:Fd}}).forEach(function(ic){return nd.textMorph.addMarker(ic)})}},{key:"removeHighlight",value:function(){var gd=this;
(this.textMorph.markers||[]).filter(function(nd){return 0===nd.id.indexOf("occur-")}).forEach(function(nd){return gd.textMorph.removeMarker(nd)})}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"Occur"}}],Ac,{pathInPackage:function(){return"./text/occur.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.morphic",version:"0.1.2"}}},{start:1776,
end:6377})}(void 0));Bb.Occur=rd;Bb.Occur=rd}}});