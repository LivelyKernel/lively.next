System.register(["./__root_module__-3c9a1ccb.js","kld-intersections"],function(sa){var lb,Eb,Wb,Qb,Bd,Fc,wd,Kc,Gc,Yc,jd,Dd,od,Zc,Ra;return{setters:[function(tb){lb=tb.s;Eb=tb.P;Wb=tb.a4;Qb=tb.p;Bd=tb.bD;Fc=tb.B;wd=tb.bE;Kc=tb.r;Gc=tb.aQ;Yc=tb.bF;jd=tb.bG;Dd=tb.bH;od=tb.bI;Zc=tb.bJ;Ra=tb.n},function(){}],execute:function(){function tb($b,zc,Fb,Cb){Cb=void 0===Cb?{}:Cb;Cb=Cb.package||bc.ObjectPackage.lookupPackageForObject($b,Cb);if(!Cb)throw Error("Object is not part of an object package: "+$b);
return Cb.addScript($b,zc,Fb)}function dc($b,zc){zc=bc.normalizeOptions(zc).System;$b=($b=$b[Symbol.for("lively-module-meta")])?$b.package.name:null;return(zc=($b?bc.lookupPackage(zc,$b):{}).pkg)?!!bc.ObjectPackage.forSystemPackage(zc):!1}sa({addScript:tb,isObjectClass:dc});var bc=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");bc.normalizeOptions=function($b){$b=Object.assign({baseURL:bc.defaultBaseURL,System:System},$b);$b.baseURL=$b.baseURL.replace(/\/$/,"");return $b};bc.addScript=
tb;bc.isObjectClass=dc;bc.string=lb;bc.Path=Eb;bc.arr=Wb;bc.parse=Qb;bc.isValidIdentifier=Bd;bc.stringify=Fc;bc.parseFunction=wd;bc.resource=Kc;bc.runEval=Gc;bc.scripting=Yc;bc.ExportLookup=jd;var Xc=bc.scripting;bc.ensurePackage=Xc.ensurePackage;bc.registerPackage=Xc.registerPackage;bc.importPackage=Xc.importPackage;bc.lookupPackage=Xc.lookupPackage;bc.module=Xc.module;bc.ImportInjector=Xc.ImportInjector;bc.RuntimeSourceDescriptor=Dd;bc.toJsIdentifier=od;bc.adoptObject=Zc;bc.classToFunctionTransform=
Ra;bc.objectPackageSym=Symbol.for("lively-object-package-data");bc.defaultBaseURL="local://lively-object-modules";bc.globalClasses=Object.keys(System.global).map(function($b){$b=System.global[$b];return"function"===typeof $b&&$b.name&&$b}).filter(Boolean);bc.addScript=tb;bc.addScript=tb;bc.isObjectClass=dc;bc.isObjectClass=dc;bc._packageStore=bc._packageStore||{};Xc=function($b,zc){this._id=$b;this.options=bc.normalizeOptions(zc)};Xc.lookupPackageForObject=function($b,zc){return this.lookupPackageForClass($b.constructor,
zc)};Xc.lookupPackageForClass=function($b,zc){zc=bc.normalizeOptions(zc).System;$b=($b=$b[Symbol.for("lively-module-meta")])?$b.package.name:null;return(zc=($b?bc.lookupPackage(zc,$b):{}).pkg)?bc.ObjectPackage.forSystemPackage(zc):null};Xc.forSystemPackage=function($b){return this.packageStore[$b.name]};Xc.withId=function($b,zc){return this.packageStore[$b]||(this.packageStore[$b]=new this($b,zc))};Xc.prototype.resource=function($b){$b=void 0===$b?"":$b;return bc.resource(this.packageURL).join($b)};
Xc.prototype.load=function(){return bc.importPackage(this.System,this.packageURL)};Xc.prototype.ensureExistance=function(){var $b=this,zc,Fb,Cb,pc,Pc,wb,db,Ta;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){switch(cb.nextAddress){case 1:return zc=$b.resource("/"),cb.yield(zc.exists(),2);case 2:if(cb.yieldResult)return cb.return();Fb=[{resource:zc}];Cb=[{resource:$b.resource("package.json"),content:JSON.stringify($b.config,null,2)}];return cb.yield(Promise.all(Fb.map(function(ma){return ma.resource.mkdir()})),
3);case 3:return cb.yield(Promise.all(Cb.map(function(ma){var La;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fb){switch(fb.nextAddress){case 1:return fb.yield(ma.resource.exists(),2);case 2:if(!(La=!fb.yieldResult)){fb.jumpTo(3);break}return fb.yield(ma.resource.write(ma.content),4);case 4:La=fb.yieldResult;case 3:return fb.return(La)}})})),4);case 4:return cb.yield($b.objectModule.ensureExistance(),5);case 5:return pc=$b,Pc=pc.System,wb=pc.packageURL,db=pc.config,cb.yield(bc.ensurePackage(Pc,
wb),6);case 6:return Ta=cb.yieldResult,Ta.registerWithConfig(db),console.log($b.packageURL+" REGISTERED"),cb.return($b)}})};Xc.prototype.ensureObjectClass=function($b){var zc=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return 1==Fb.nextAddress?Fb.yield(zc.ensureExistance(),2):Fb.return(zc.objectModule.ensureObjectClass($b))})};Xc.prototype.adoptObject=function($b){var zc=this,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cb){if(1==Cb.nextAddress)return zc.objectClass===
$b.constructor?Cb.return():Cb.yield(zc.ensureObjectClass($b.constructor),2);Fb=Cb.yieldResult;bc.adoptObject($b,Fb);Cb.jumpToEnd()})};Xc.prototype.addScript=function($b,zc,Fb){return this.objectModule.addScript($b,zc,Fb)};Xc.prototype.remove=function(){this.systemPackage.remove();delete bc.ObjectPackage.packageStore[this.id];return this.resource().remove()};Xc.prototype.renameObjectClass=function($b,zc){zc=void 0===zc?[]:zc;var Fb=this,Cb,pc,Pc,wb,db,Ta,cb,ma,La,fb,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xb){if(1==
xb.nextAddress){Cb=Fb;pc=Cb.objectClass;Pc=Cb.System;if(!pc||pc.className===$b)return xb.return(pc);if(!bc.isValidIdentifier($b))throw Error($b+" is not a valid name for a class");db=wb=bc.RuntimeSourceDescriptor.for(pc,Pc);Ta=db.source;cb=db.ast;ma=cb.id;La=ma.start;fb=ma.end;return xb.yield(wb.changeSource(Ta.slice(0,La)+$b+Ta.slice(fb)),2)}pb=Fb.objectClass;zc.forEach(function(Wa){Wa.constructor=pb;Wa.__proto__=pb.prototype});return xb.return(pb)})};Xc.prototype.fork=function($b,zc){var Fb=this,
Cb,pc,Pc,wb,db,Ta,cb,ma,La,fb,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xb){switch(xb.nextAddress){case 1:return Cb=Fb,pc=Cb.System,Pc=Cb.baseURL,wb=Cb.objectClass,zc=Object.assign({System:pc,baseURL:Pc},zc),db=bc.RuntimeSourceDescriptor.for(wb),Ta=db._renamedSource($b),cb=Ta.moduleSource,ma=bc.ObjectPackage.withId($b,zc),xb.yield(ma.ensureExistance(),2);case 2:return La=ma,fb=La.objectModule,pb=fb.systemModule,xb.yield(pb.load({format:"esm"}),3);case 3:return xb.yield(pb.changeSource(cb),
4);case 4:return xb.return(ma)}})};$jscomp.global.Object.defineProperties(Xc.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return bc.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new bc.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(Xc,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=bc._packageStore)}}});sa("default",Xc);bc.ObjectPackage=Xc;var Oc=function($b,zc){if(!$b)throw Error("ObjectModule needs package!");if(!zc)throw Error("ObjectModule needs package!");this._moduleName=$b;this._objectPackage=zc};Oc.prototype.read=function(){return this.resource.read()};Oc.prototype.write=function($b){return this.resource.write($b)};Oc.prototype.ensureExistance=function(){var $b=
this,zc,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cb){switch(Cb.nextAddress){case 1:return zc=$b.resource,Cb.yield(zc.exists(),2);case 2:if(Cb.yieldResult){Cb.jumpTo(3);break}return Cb.yield(zc.write("'format esm';\n"),4);case 4:Fb={},$b.System.config({meta:(Fb[$b.url]={format:"esm"},Fb)});case 3:return Cb.return($b)}})};Oc.prototype.ensureObjectClass=function($b){var zc=this,Fb=this.objectClass;return Fb&&Fb.prototype.__proto__===$b.prototype?Fb:Promise.resolve(this.ensureObjectClassSource($b)).then(function(Cb){var pc=
Cb.source,Pc=Cb.moduleId,wb=Cb.className,db=Cb.bindings,Ta=zc.System;Cb=bc.module(Ta,Pc);if(db)for(var cb in db)Cb.define(cb,db[cb]);pc=bc.runEval(pc,{classTransform:bc.classToFunctionTransform,sync:!0,targetModule:Pc,System:Ta});if(pc.isError)throw pc.value;pc=Cb.recorder[wb];if(!pc)throw Error("Failed to define class "+wb+" in "+Pc);return pc})};Oc.prototype.ensureObjectClassSource=function($b){return this.createDefaultClassDeclaration($b)};Oc.prototype.createDefaultClassDeclaration=function($b){$b=
void 0===$b?Object:$b;var zc=this,Fb,Cb,pc,Pc,wb,db,Ta,cb,ma,La,fb,pb,xb,Wa,Xa,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kc){switch(kc.nextAddress){case 1:Fb=zc;Cb=Fb.System;pc=Fb.systemModule;Pc=Fb.objectPackage;wb=bc.string.capitalize(bc.toJsIdentifier(Pc.id));db=$b.className;Ta=!db;cb=bc.globalClasses.includes($b);ma="";La=null;if(Ta){db="__anonymous_superclass__";fb={};La=(fb[db]=$b,fb);kc.jumpTo(2);break}if(cb){kc.jumpTo(2);break}return kc.yield(bc.ExportLookup.findExportOfValue($b,
Cb),4);case 4:(pb=kc.yieldResult)?(xb=bc.ImportInjector.run(Cb,pc.id,pc.package(),"",pb),Wa=xb.standaloneImport,ma+=Wa+"\n\n"):(Xa={},La=(Xa[db]=$b,Xa));case 2:return wb===db&&(wb="Object"+wb),Ab="Object"===db?"class "+wb+" {}\n":"class "+wb+" extends "+db+" {}\n",ma+="export default "+Ab+"\n",kc.yield(pc.changeSource(ma),5);case 5:return kc.yield(pc.load(),6);case 6:return kc.return({source:ma,className:wb,moduleId:zc.url,bindings:La})}})};Oc.prototype.addScript=function($b,zc,Fb){var Cb=this,pc,
Pc,wb,db,Ta,cb,ma,La,fb,pb,xb,Wa,Xa,Ab,kc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){switch(Ub.nextAddress){case 1:if($b.constructor===Cb.objectClass){pc=$b.constructor;Ub.jumpTo(2);break}return Ub.yield(Cb.ensureObjectClass($b.constructor),3);case 3:pc=Ub.yieldResult;case 2:Pc=pc;wb="function"===typeof zc?String(zc):zc;db=bc.parseFunction(wb);Ta=bc.RuntimeSourceDescriptor.for(Pc,Cb.System);Fb||(Fb=bc.Path("id.name").get(db));if(!Fb)throw Error("No name, cannot add "+bc.string.truncate(wb,
30).replace(/\n/g,"")+"!");cb=bc.toJsIdentifier(Fb);console.assert("FunctionExpression"===db.type||"ArrowFunctionExpression"===db.type,"not a function expression but: "+db.type);ma=db.params.map(function(qc){return wb.slice(qc.start,qc.end)});La="BlockStatement"===db.body.type?wb.slice(db.body.start,db.body.end):"{ return "+wb.slice(db.body.start,db.body.end)+" }";fb=cb+"("+ma.join(",")+") "+La;"ArrowFunctionExpression"===db.type&&(db.type="FunctionExpression");pb=Ta.source;xb=Ta.ast;if(!xb)throw Error("cannot find class decl of "+
Ta.module.id);(Wa=xb.body.body.find(function(qc){return qc.key.name===cb&&!qc.static}))?pb=pb.slice(0,Wa.start)+fb+pb.slice(Wa.end):(Xa=pb.lastIndexOf("}"),Ab=pb.slice(0,Xa),kc=pb.slice(Xa),/\n\s*$/m.test(Ab)||(Ab+="\n"),fb=bc.string.changeIndent(fb,"  ",1),/^[ ]*\n/m.test(kc)||(kc="\n"+kc),pb=Ab+fb+kc);return Ub.yield(Ta.changeSource(pb),4);case 4:return Ub.return({script:Pc.prototype[cb],klass:Pc,module:Ta.module.id,methodName:cb})}})};$jscomp.global.Object.defineProperties(Oc.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var $b=this.systemModule;return $b.isLoaded()?$b.System.get($b.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return bc.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});bc.ObjectModule=Oc;bc.default=Xc}}});