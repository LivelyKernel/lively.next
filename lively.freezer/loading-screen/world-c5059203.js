System.register(["./__root_module__-590131e3.js","./index-c8605e13.js","./index-2bc8c0f4.js","./color-picker-88b3ebcc.js"],function(Sa){var Lb,Vb,Fc,jc,sd,kd,Cd,ed,Zc,bd,yd,ke,ue,He,ld,Wd,gc,cd,Bd,hd,Jd,de,Zb,Ic,Ad,Jc,zd,Mb,mb,Bc,xc,ec,Dc,Ta,hc,Eb,tc,Ec,ad,td,fc,zc,ac,Oa,Da,ka,Ba,Ja,Fb,va,Ka,Rb,eb,Vc,Qb,qd,Wc,Mc,Hb,Xd,Tb,Gb,Pa,ca,Ha,cb,Pb,sc,Xc,Nc,Ed,Ld,Ye,Fe,ye,z,Ke,Ie,$d,Ze,hf,kf,yf,hg;return{setters:[function(qc){Lb=qc.S;Vb=qc.R;Fc=qc.$;jc=qc.C;sd=qc.b;kd=qc.a0;Cd=qc.a1;ed=qc.P;Zc=qc.a;bd=
qc.s;yd=qc.Y;ke=qc.a2;ue=qc.e;He=qc.m;ld=qc.K;Wd=qc.g;gc=qc.a3;cd=qc.a4;Bd=qc.n;hd=qc.a5;Jd=qc.q;de=qc.j;Zb=qc.r;Ic=qc.a6;Ad=qc.o;Jc=qc.a7;zd=qc.a8;Mb=qc.a9;mb=qc.M;Bc=qc.T;xc=qc.aa;ec=qc.ab;Dc=qc.W;Ta=qc.I;hc=qc.ac;Eb=qc.c;tc=qc.d;Ec=qc.ad;ad=qc.i;td=qc.f;fc=qc.p;zc=qc.ae;ac=qc.V;Oa=qc.O;Da=qc.Q;ka=qc.N;Ba=qc.t;Ja=qc.af;Fb=qc.ag;va=qc.ah;Ka=qc.l;Rb=qc.ai;eb=qc.aj;Vc=qc.ak;Qb=qc.al;qd=qc.am;Wc=qc.an;Mc=qc.ao;Hb=qc.ap;Xd=qc.aq;Tb=qc.L;Gb=qc.ar;Pa=qc.h;ca=qc.as;Ha=qc.z;cb=qc.Z;Pb=qc.at;sc=qc.au},function(qc){Xc=
qc.i},function(qc){Nc=qc.s;Ed=qc.a;Ld=qc.r;Ye=qc._;Fe=qc.P;ye=qc.H;z=qc.M;Ke=qc.S;Ie=qc.b;$d=qc.c;Ze=qc.G;hf=qc.F},function(qc){kf=qc.C;yf=qc.a;hg=qc.c}],execute:function(){function qc(){}function ji(Na,fa,Db){var sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){return 1==La.nextAddress?fa.startsWith("image/")?La.yield(qf.fileReadAsDataURL(Na),3):La.jumpTo(2):2!=La.nextAddress?(sa=La.yieldResult,La.return(new qf.Image({imageUrl:sa,autoResize:!0,name:Na.name}))):La.return(null)})}
var qf=lively.FreezerRuntime.recorderFor("lively.morphic/events/html-drop-handler.js");qf.uploadItem=qc;qf.uploadFile=ji;qf.fileReadAsDataURL=function(Na){return new Promise(function(fa,Db){Db=new qf.FileReader;Db.onload=function(sa){return fa(sa.target.result)};Db.readAsDataURL(Na)})};qf.Image=Lb;qf.uploadItem=qc;qf.uploadItem=qc;qf.uploadFile=ji;qf.uploadFile=ji;var Sd=lively.FreezerRuntime.recorderFor("lively.ide/world-commands.js");Sd.Rectangle=Vb;Sd.rect=Fc;Sd.Color=jc;Sd.pt=sd;Sd.tree=kd;Sd.date=
Cd;Sd.Path=ed;Sd.arr=Zc;Sd.string=bd;Sd.obj=yd;Sd.inspect=ke;Sd.easings=ue;Sd.morph=He;Sd.Text=ld;Sd.config=Wd;Sd.KeyHandler=gc;Sd.loadObjectFromPartsbinFolder=cd;Sd.loadPart=Bd;Sd.interactivelySaveWorld=hd;Sd.show=Nc;Sd.showAndSnapToGuides=Ed;Sd.removeSnapToGuidesOf=Ld;Sd.LoadingIndicator=Jd;Sd.createMorphSnapshot=de;Sd.interactivelyFreezeWorld=Xc;Sd.resource=Zb;Sd.BrowserModuleTranslationCache=Ic;Sd.CommentBrowser=Ye;Sd.once=Ad;Sd.commands=[{name:"clear storage and reload",exec:function(){var Na,
fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){if(1==Db.nextAddress)return Db.yield($world.confirm(["Caution\n",{},"Proceeding will clear all local storage and reload the page! Make sure if you want to save your world before you continue.",{fontSize:15,fontWeight:"normal"}],{width:400}),2);if(Na=Db.yieldResult)localStorage.clear(),fa=new Sd.BrowserModuleTranslationCache("2"),fa.closeDb(),fa.deleteDb(),window.location.reload(!0);Db.jumpToEnd()})}},{name:"undo",exec:function(Na){if(Na.focusedMorph&&
Na.focusedMorph!==Na&&Na.focusedMorph.undoManager)return!1;Na.env.undoManager.undo();return!0}},{name:"redo",exec:function(Na){if(Na.focusedMorph&&Na.focusedMorph!==Na&&Na.focusedMorph.undoManager)return!1;Na.env.undoManager.redo();return!0}},{name:"run command",handlesCount:!0,exec:function(Na,fa,Db){var sa,La,Wa,Jb,rc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress)return sa=Na.focusedMorph||Na,La=Sd.KeyHandler.generateCommandToKeybindingMap(sa,!0).map(function(Rc){var rd=
Rc.prettyKeys,Vd=Rc.command.name,se=Rc.target.constructor.name;rd=rd?rd.join(", "):"";return{isListItem:!0,value:Rc,label:[""+se,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+Vd,null],annotation:[rd,{fontSize:"80%",textStyleClasses:["truncated-text"],paddingRight:"5px",maxWidth:140}]}}),Sc.yield(Na.filterableListPrompt("Run command",La,{historyId:"lively.morphic-run command",requester:sa,extent:Sd.pt(700,600),prompt:Na._cachedRunCommandPrompt}),2);Wa=Sc.yieldResult;Jb=
Wa.prompt;rc=$jscomp.makeIterator(Wa.selected);Lc=rc.next().value;Na._cachedRunCommandPrompt=Jb;return Sc.return(Lc?Lc.target.execCommand(Lc.command,fa,Db):!0)})}},{name:"show command history",exec:function(Na,fa){var Db=Na.commandHandler;fa=Sd.arr.sortBy(Db.history,function(sa){return-sa.time}).map(function(sa){return{isListItem:!0,string:Db.printCommand(sa),value:sa}});$world.editListPrompt("select commands",fa,{multiSelect:!0,requester:Na});return!0}},{name:"show halo for focused morph",exec:function(Na){var fa=
Na.focusedMorph;Na.showHaloFor(fa.getWindow()||fa,Na.firstHand.pointerId);return!0}},{name:"show morph",exec:function(Na,fa){Sd.show(fa.morph,void 0===fa.loop?!1:fa.loop)}},{name:"show and snap to guides",exec:function(Na,fa){Sd.showAndSnapToGuides(fa.target,fa.showGuides,fa.snap)}},{name:"remove snap to guides",exec:function(Na,fa){Sd.removeSnapToGuidesOf(fa)}},{name:"copy morph",exec:function(Na){var fa=Na.focusedMorph;if(!fa||fa===Na)return $world.setStatusMessage("no morph selected"),!0;Na=fa.getWindow()||
fa;fa=Na.copy();fa.openInWorld(Na.globalPosition.addXY(10,10));fa.isWindow&&fa.activate();return fa}},{name:"select morph",exec:function(Na,fa){fa=void 0===fa?{root:Na,selectionFn:null,justReturn:!1,requester:Na,filterFn:null,prependItems:[],prompt:null,remote:!1}:fa;var Db,sa,La,Wa,Jb,rc,Lc,Sc,Rc,rd,Vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(se){if(1==se.nextAddress)return Db=0,sa=fa.filterFn||function(){return!0},La=fa.selectionFn||function(Kd,Ee,le){return Na.filterableListPrompt(Kd,
Ee,le)},se.yield(System.import("lively.classes/object-classes.js"),2);if(3!=se.nextAddress)return Wa=se.yieldResult,Jb=Wa.default,rc=Sd.arr.compact(Sd.tree.map(fa.root||Na,function(Kd,Ee){if(!sa(Kd))return null;var le=!!Jb.lookupPackageForObject(Kd);return{isListItem:!0,label:[""+String(++Db)+"\u2003".repeat(Ee),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+Kd,{fontWeight:le?"bolder":"normal",fontStyle:le?"normal":"italic",fontFamily:"Inconsolata",fontSize:16},le?" [Object Class]":
"",{opacity:.5}],value:Kd}},function(Kd){return sa(Kd)?Kd.submorphs:[]})),Lc=["show halo","open object editor","open object inspector"],se.yield(La(fa.prompt||"Choose morph",(fa.prependItems||[]).concat(rc),{historyId:"lively.morphic-select morph",onSelection:function(Kd){(void 0).lastSelectionHalo&&(void 0).lastSelectionHalo.remove();Kd&&Kd.show&&Sc!=Kd&&((void 0).lastSelectionHalo=Kd.show(),Sc=Kd)},selectedAction:"show halo",actions:Lc}),3);Rc=se.yieldResult;rd=Rc.selected;Vd=Rc.action;if(fa.justReturn)return se.return(rd);
rd.forEach(function(Kd){Vd===Lc[0]?Na.showHaloFor(Kd):Vd===Lc[1]?Na.execCommand("open object editor",{target:Kd}):Vd===Lc[2]&&Na.execCommand("open object inspector",{target:Kd})});return se.return(rd)})}},{name:"print morph(s)",exec:function(Na){var fa,Db,sa,La,Wa,Jb,rc,Lc,Sc,Rc,rd,Vd,se,Kd,Ee,le,ge,jf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sf){switch(Sf.nextAddress){case 1:fa=!1,Db=[];case 2:if(fa)return rc=Sd.LoadingIndicator.open("printing morph..."),Sf.yield(System.import("lively.2lively/client.js"),
6);sa=$jscomp;La=sa.makeIterator;return Sf.yield(Na.execCommand("select morph",{justReturn:!0}),4);case 4:return Wa=La.call(sa,Sf.yieldResult),Jb=Wa.next().value,Db.push(Jb),Sf.yield(Na.confirm("Select additional morphs?",{rejectLabel:"NO"}),5);case 5:fa=!Sf.yieldResult;Sf.jumpTo(2);break;case 6:return Lc=Sf.yieldResult,Sc=Lc.default,Rc=Sc.default(),Sf.yield(Rc.listPeers(!0),7);case 7:return rd=Sf.yieldResult,Vd=rd.find(function(Ug){return"pdf printer"===Ug.type}),se={ackTimeout:3E4},Kd=Rc,Ee=Kd.sendToAndWait,
le=Vd.id,Sf.yield(Promise.all(Db.map(function(Ug){return Sd.createMorphSnapshot(Ug,{addPreview:!1,testLoad:!1})})),9);case 9:return Sf.yield(Ee.call(Kd,le,"[PDF printer] print",Sf.yieldResult,se),8);case 8:ge=Sf.yieldResult;if(jf=ge.error||ge.data.error)throw Na.showError(jf),jf;Na.serveFileAsDownload(ge.data,{fileName:Db[0].name+(1<Db.length?".etc":"")+".pdf",type:"application/pdf"});rc.remove();Sf.jumpToEnd()}})}},{name:"escape",exec:function(Na,fa,Db,sa){fa=Na.env.eventDispatcher.eventState;fa.menu&&
fa.menu.remove();fa=Na.halos();fa.forEach(function(La){return La.remove()});Na.hands.forEach(function(La){return La.cancelGrab(!0,sa)});Na=Sd.arr.last(fa)&&Sd.arr.last(fa).target||Na.focusedMorph||Na;Na.focus();Na.isText&&Na.selection.disableMultiSelect&&Na.selection.disableMultiSelect();return!1}},{name:"move or resize halo target",exec:function(Na,fa){fa=void 0===fa?{direction:"left",offset:1,what:"move"}:fa;var Db=Na.halos()[0];if(!Db||Db.changingName||Na.focusedMorph!=Db)return!1;var sa=fa;Na=
sa.direction;fa=sa.offset;sa=sa.what;var La=Db.target;fa=fa||1;switch(Na){case "left":La["move"===sa?"left":"width"]-=fa;break;case "right":La["move"===sa?"left":"width"]+=fa;break;case "up":La["move"===sa?"top":"height"]-=fa;break;case "down":La["move"===sa?"top":"height"]+=fa}Db.alignWithTarget();return!0}},{name:"close halo target",exec:function(Na){Na=Na.halos()[0];if(!Na||Na.changingName)return!1;Na.target.selectedMorphs?Na.target.selectedMorphs.forEach(function(fa){return fa.abandon()}):Na.target.abandon();
return!0}},{name:"resize manually",exec:function(Na,fa){fa=void 0===fa?{}:fa;var Db,sa,La,Wa,Jb,rc,Lc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){switch(Rc.nextAddress){case 1:La=Na.windowBounds();Wa=Na.bounds();Jb=Number;if(rc=fa.width){Rc.jumpTo(2);break}return Rc.yield(Na.prompt("Enter world width",{input:Math.max(Wa.width,La.width),requester:Na}),3);case 3:rc=Rc.yieldResult;case 2:Db=Jb(rc);if("number"!==typeof Db){Rc.jumpTo(4);break}Lc=Number;if(Sc=fa.height){Rc.jumpTo(5);
break}return Rc.yield(Na.prompt("Enter world height",{input:Math.max(Wa.height,La.height),requester:Na}),6);case 6:Sc=Rc.yieldResult;case 5:sa=Lc(Sc);case 4:return"number"!==typeof Db||isNaN(Db)||"number"!==typeof sa||isNaN(sa)||(Na.extent=Sd.pt(Db,sa)),Rc.return(!0)}})}},{name:"resize windows to fit visible world bounds",exec:function(Na){var fa=Na.getWindows().filter(function(Wa){return!Wa.minimized});if(!fa.length)return!0;Na=Na.visibleBoundsExcludingTopBar();var Db=fa.reduce(function(Wa,Jb){return Jb.bounds().union(Wa)},
new Sd.Rectangle(0,0,0,0)),sa=Na.width/Db.width,La=Na.height/Db.height;fa.forEach(function(Wa){var Jb=Wa.bounds();Wa.setBounds(new Sd.Rectangle(Jb.x*sa,Jb.y*La,Jb.width*sa,Jb.height*La))});return!0}},{name:"window switcher",exec:function(Na){var fa,Db,sa,La,Wa,Jb,rc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress){if((fa=Na.activePrompt())&&"lively.morphic-window switcher"===fa.historyId)return fa.focus(),Sc.return(fa.get("list").execCommand("select down"));
Db=Na.submorphs.filter(function(Rc){return Rc.isWindow}).reverse().map(function(Rc){return{isListItem:!0,string:Rc.title||String(Rc),value:Rc}});Db.forEach(function(Rc){Rc.value.opacity=.5;Rc.value.blur=1});return Sc.yield(Na.filterableListPrompt("Choose window",Db,{preselect:1,requester:Na,historyId:"lively.morphic-window switcher",onSelection:function(Rc){sa&&(sa.minimized=La,sa.blur=1,sa.animate({opacity:.3,duration:200}));if(sa=Rc)Rc.animate({opacity:1,duration:200}),Rc.blur=0,La=Rc.minimized,
Rc.minimized=!1},width:1*Na.visibleBounds().extent().x/3,itemPadding:Sd.Rectangle.inset(4)}),2)}Jb=Wa=Sc.yieldResult;rc=$jscomp.makeIterator(Jb.selected);Lc=rc.next().value;Db.forEach(function(Rc){Rc.value.opacity=1;Rc.value.blur=0});Lc&&(Lc.activate(),Lc.minimized=!1);return Sc.return(!0)})}},{name:"close active window or morph",exec:function(Na){var fa=Na.focusedMorph;if(!fa)return!0;var Db=fa.getWindow();Na.undoStart("window close");Db?Db.close():(Sd.arr.last(Sd.arr.without(fa.ownerChain(),Na)).remove(),
(Db=Na.activeWindow())&&Db.activate());Na.undoStop("window close");return!0}},{name:"toggle minimize active window",exec:function(Na){(Na=Na.activeWindow())&&Na.toggleMinimize();return!0}},{name:"toggle minimize all windows",exec:function(Na){(Na=Na.getWindows())&&Na.map(function(fa){return fa.toggleMinimize()});return!0}},{name:"toggle minimize all except active window",exec:function(Na){(Na=Na.getWindows().filter(function(fa){return!fa.isActive()}))&&Na.map(function(fa){return fa.toggleMinimize()});
return!0}},{name:"close all except active window",exec:function(Na){(Na=Na.getWindows().filter(function(fa){return!fa.isActive()}))&&Na.map(function(fa){return fa.close()});return!0}},{name:"close all windows",exec:function(Na){(Na=Na.getWindows())&&Na.map(function(fa){return fa.close()});return!0}},{name:"open status message of focused morph",exec:function(Na){var fa=Na.focusedMorph;if(Na=$jscomp.makeIterator(fa?Na.visibleStatusMessagesFor(fa):[]).next().value)Na.expand(),Na.focus();return Na||!0}},
{name:"resize active window",exec:function(Na,fa){function Db(){var Vd,se,Kd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ee){if(1==Ee.nextAddress)return Ee.yield(Na.filterableListPrompt("How to resize the window?","full center right left bottom top reset".split(" "),{requester:Na}),2);Vd=Ee.yieldResult;se=$jscomp.makeIterator(Vd.selected);Kd=se.next().value;return Ee.return(Kd)})}function sa(Vd,se){switch(Vd){case "full":return Lc;case "col1":case "left":return rd.withTopLeft(Lc.topLeft());
case "col2":case "center":return rd.withCenter(Lc.center());case "col3":case "right":return rd.translatedBy(Sd.pt(Lc.width-Rc,0));case "top":return Lc.divide([Sd.rect(0,0,1,.5)])[0];case "bottom":return Lc.divide([Sd.rect(0,.5,1,.5)])[0];case "reset":return rc._normalBounds||Sd.pt(500,400).extentAsRectangle().withCenter(se.center());default:return se}}fa=void 0===fa?{how:null,window:null}:fa;var La,Wa,Jb,rc,Lc,Sc,Rc,rd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vd){if(1==Vd.nextAddress){La=
fa;Wa=La.window;Jb=La.how;rc=Wa||Na.activeWindow();if(!rc)return Vd.return();Lc=Na.visibleBoundsExcludingTopBar().insetBy(15);Sc=rc.bounds();rc._normalBounds||(rc._normalBounds=Sc);Rc=Math.min(700,Math.max(1E3,Lc.width/3));rd=Lc.withWidth(Rc);return Jb?Vd.jumpTo(2):Vd.yield(Db(),3)}2!=Vd.nextAddress&&(Jb=Vd.yieldResult);if(!Jb)return Vd.return();rc.setBounds(sa(Jb,Lc));"reset"===Jb&&delete rc._normalBounds;return Vd.return(!0)})}},{name:"[recovery] show last object editor saves",exec:function(Na,
fa){return Na.execCommand("[recovery] show last doits",Object.assign({},fa,{title:"logged ObjectEditor save",logAccessFn:function(){return JSON.parse(localStorage["oe helper"]).saves}}))}},{name:"[recovery] show last doits",description:"browse a list of your last doits",exec:function(Na,fa){fa=void 0===fa?{}:fa;var Db,sa,La,Wa,Jb,rc,Lc,Sc,Rc,rd,Vd,se,Kd,Ee;return $jscomp.asyncExecutePromiseGeneratorProgram(function(le){if(1==le.nextAddress){Db=fa;(sa=Db.logAccessFn)||(sa=function(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])});
try{La=sa()}catch(ge){}if(!La)return le.return(Na.inform("no log yet"));Wa=Sd.arr.sortBy(La.map(function(ge,jf){var Sf="string"===typeof ge?ge:ge.source;ge="string"===typeof ge?jf:ge.time||jf;jf=Sd.date.format(new Date(ge),"yy-mm-dd HH:MM");return{time:ge,source:Sf,printedTime:jf}}),function(ge){return-ge.time});Jb=Wa.map(function(ge,jf){return{isListItem:!0,string:"["+ge.printedTime+"] "+ge.source.slice(0,100).replace(/\n/g,"").trim(),value:ge}});return le.yield(Na.filterableListPrompt("select doit code",
Jb,{multiSelect:!0,requester:Na}),2)}rc=le.yieldResult;Lc=rc.selected;if(Lc.length){Sc=[];Rc=$jscomp.makeIterator(Lc);for(rd=Rc.next();!rd.done;rd=Rc.next())se=Vd=rd.value,Kd=se.source,Ee=se.printedTime,Sc.push("// "+Ee+"\n"+Kd);return le.return(Na.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},fa,{content:Sc.join("\n\n")})))}return le.return(!0)})}},{name:"open loading indicator",exec:function(Na,fa){Na={};"object"===typeof fa&&(Na=fa,fa=Na.label);return Sd.LoadingIndicator.open(fa,
Na)}},{name:"open workspace",exec:function(Na,fa,Db,sa){fa=void 0===fa?{}:fa;var La,Wa,Jb,rc,Lc,Sc,Rc,rd,Vd,se;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Kd){switch(Kd.nextAddress){case 1:if(La=sa&&Na.relayCommandExecutionToFocusedMorph(sa))return Kd.return(La);Wa=fa.language||fa.mode||"javascript";Jb={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",
css:"lively.ide/css/workspace.js",less:"lively.ide/css/less/workspace.js",text:null};rc=Object.keys(Sd.config.ide.modes.aliases).reduce(function(Ee,le){var ge={};return Object.assign(Ee,(ge[Sd.config.ide.modes.aliases[le]]=le,ge))},{});if(!fa.askForMode){Kd.jumpTo(2);break}Lc=Object.keys(Jb).concat("javascript console");return Kd.yield(Na.filterableListPrompt("Open workspace for...",Lc),3);case 3:if(Sc=Kd.yieldResult,Rc=$jscomp.makeIterator(Sc.selected),Wa=Rc.next().value,!Wa)return Kd.return(!0);
case 2:if("javascript console"===Wa)return Kd.return(Na.execCommand("open console",fa));fa=Object.assign({content:""},fa,{mode:Wa,language:Wa});rd=Jb[fa.language]||Jb[rc[fa.language]];return"text"!==Wa&&rd?Kd.yield(System.import(rd),4):Kd.return(Na.execCommand("open text window",Object.assign({},Sd.config.codeEditor.modes.text,{},fa)));case 4:return Vd=Kd.yieldResult,se=Vd.default,Kd.return((new se({title:fa.title||fa.language+" workspace",center:Na.center,content:fa.content,target:fa.target,systemInterface:fa.systemInterface||
fa.backend})).activate())}})}},{name:"open console",exec:function(Na,fa){var Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){if(1==sa.nextAddress)return sa.yield(Sd.loadObjectFromPartsbinFolder("Console"),2);Db=sa.yieldResult;return sa.return(Db.openInWorldNearHand())})}},{name:"open shell workspace",exec:function(Na,fa){return Na.execCommand("open workspace",Object.assign({},fa,{language:"shell"}))}},{name:"open javascript workspace",exec:function(Na,fa){return Na.execCommand("open workspace",
Object.assign({},fa,{language:"javascript"}))}},{name:"open shell terminal",exec:function(Na,fa){var Db,sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){if(1==La.nextAddress)return La.yield(System.import("lively.ide/shell/terminal.js"),2);Db=La.yieldResult;sa=Db.default;return La.return(sa.open(fa).openInWorldNearHand())})}},{name:"open text window",exec:function(Na,fa){var Db=fa=void 0===fa?{}:fa,sa=Db.title,La=Db.extent,Wa=Db.content,Jb=Db.mode,rc=Db.name;Db=Db.rangesAndStyles;
sa=sa||"text window";Wa=Wa||"";La=La||Sd.pt(500,400);rc=rc||"text workspace";Wa="string"===typeof Wa?[Wa,null]:Wa;fa=new Sd.Text(Object.assign({padding:Sd.Rectangle.inset(3)},Sd.obj.dissoc(fa,["title","content"]),{textAndAttributes:Wa,clipMode:"auto",name:rc,extent:La}));Db&&fa.setTextAttributesWithSortedRanges(Db);Jb&&fa.changeEditorMode(Jb);return Na.openInWindow(fa,{title:sa}).activate()}},{name:"merge and open in window",exec:function(Na,fa){fa=void 0===fa?{a:"",b:"",format:null,extent:Sd.pt(500,
600)}:fa;var Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){if(1==sa.nextAddress)return sa.yield(Sd.loadObjectFromPartsbinFolder("text merger"),2);Db=sa.yieldResult;return sa.return(Db.targetMorph.open(fa.a,fa.b,fa))})}},{name:"diff and open in window",exec:function(Na,fa){var Db,sa,La;function Wa(se,Kd,Ee){var le,ge,jf,Sf,Ug,Mg,Xf,wf,th,gi,Ng,zf,cg,og;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qh){if(1==qh.nextAddress){le=Ee;ge=le.format;jf=null;if("patch"!==
ge)return Vd=rd[ge](se,Kd,Ee),Sf=Sd.arr.flatmap(Vd,function(Le){var hi=Le.added;return[Le.value,Le.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:Sd.Color.red}:hi?{fontWeight:"bold",textDecoration:"",fontColor:Sd.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:Sd.Color.darkGray}]}),qh.jumpTo(2);Ug=Ee;Mg=Ug.headerA;Xf=Ug.headerB;wf=Ug.filenameA;th=Ug.filenameB;gi=Ug.context;Sf=[rd.createTwoFilesPatch(wf||"a",th||"b",se,Kd,Mg,Xf,"number"===typeof gi?{context:gi}:
void 0),{}];return qh.yield(System.import("lively.ide/diff/editor-plugin.js"),3)}2!=qh.nextAddress&&(Ng=qh.yieldResult,zf=Ng.default,jf=new zf);cg=Na.execCommand("open text window",Ee);og=cg.targetMorph;cg.extent=Rc||Sd.pt(300,200).maxPt(og.textBounds().extent());og.textAndAttributes=Sf;jf&&og.addPlugin(jf);return qh.return(og)})}fa=void 0===fa?{a:"",b:"",format:null,extent:Sd.pt(500,600)}:fa;var Jb,rc,Lc,Sc,Rc,rd,Vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(se){if(1==se.nextAddress){Jb=
fa;rc=Jb.a;Lc=Jb.b;Sc=Jb.format;Rc=Jb.extent;if(Sc)rc=String(rc),Lc=String(Lc);else{a:{var Kd=rc,Ee=Lc;if(Sd.obj.isPrimitive(Kd)||Kd instanceof RegExp||Sd.obj.isPrimitive(Ee)||Ee instanceof RegExp)Kd=String(Kd),Ee=String(Ee);if("string"!==typeof Kd||"string"!==typeof Ee)try{JSON.stringify(Kd);JSON.stringify(Ee);Db="diffJson";sa=Kd;La=Ee;break a}catch(le){Kd=String(Kd),Ee=String(Ee)}Db="diffLines";sa=Kd;La=Ee}rc=sa;Lc=La;Sc=Db}return se.yield(System.import("https://jspm.dev/diff"),2)}if(3!=se.nextAddress)return rd=
se.yieldResult,se.yield(Wa(rc,Lc,Object.assign({fontFamily:"monospace"},fa,{format:Sc})),3);Vd=se.yieldResult;return se.return(Vd)})}},{name:"merge workspaces",exec:function(Na,fa){return Na.execCommand("diff workspace",Object.assign({},fa,{merge:!0}))}},{name:"diff workspaces",exec:function(Na,fa){function Db(Rc,rd){var Vd=Rc.pluginFind(function(Kd){return Kd.evalEnvironment});Vd=Vd&&Vd.evalEnvironment.targetModule||"no file";var se=rd.pluginFind(function(Kd){return Kd.evalEnvironment});return Na.execCommand("diff and open in window",
{a:Rc.textString,b:rd.textString,filenameA:Vd,filenameB:se&&se.evalEnvironment.targetModule||"no file"})}function sa(Rc,rd){var Vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(se){if(1==se.nextAddress)return se.yield(Sd.loadObjectFromPartsbinFolder("text merger"),2);Vd=se.yieldResult;return se.return(Vd.targetMorph.open(Rc.textString,rd.textString))})}function La(Rc,rd){var Vd,se,Kd,Ee;return $jscomp.asyncExecutePromiseGeneratorProgram(function(le){if(1==le.nextAddress)return Vd=Rc.map(function(ge){return{isListItem:!0,
value:ge,string:ge.name||String(ge)}}),le.yield(Na.filterableListPrompt("choose text: ",Vd,{onSelection:function(ge){ge&&ge.show()}}),2);se=le.yieldResult;Kd=$jscomp.makeIterator(se.selected);Ee=Kd.next().value;return le.return(Ee)})}fa=void 0===fa?{}:fa;var Wa,Jb,rc,Lc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){switch(Rc.nextAddress){case 1:Wa=fa;Jb=Wa.editor1;rc=Wa.editor2;Lc=Wa.merge;Jb&&rc||(Sc=Na.withAllSubmorphsSelect(function(rd){return rd.isText&&!rd.isInputLine&&!rd.isUsedAsEpiMorph()}).reverse());
if(Jb){Rc.jumpTo(2);break}return Rc.yield(La(Sc),3);case 3:Jb=Rc.yieldResult;case 2:if(!Jb)return Rc.return(Na.setStatusMessage("Canceled"));if(rc){Rc.jumpTo(4);break}return Rc.yield(La(Sd.arr.without(Sc,Jb)),5);case 5:rc=Rc.yieldResult;case 4:return rc?Rc.return(Lc?sa(Jb,rc):Db(Jb,rc)):Rc.return(Na.setStatusMessage("Canceled"))}})}},{name:"search workspaces",exec:function(){function Na(Rc,rd){return Rc.map(function(Vd){var se=Vd.world()?Vd.getWindow():$world.withAllSubmorphsDetect(function(ge){return ge.isWindow&&
ge.targetMorph===He}),Kd=0,Ee=Sd.string.lines(Vd.textString).find(function(ge,jf){ge=ge.toLowerCase();Kd=jf;return rd.every(function(Sf){return ge.includes(Sf)})}),le=se?se.title:Vd.toString();return Ee?{isListItem:!0,string:le+" | "+Ee,value:{window:se,morph:Vd,row:Kd}}:null}).filter(Boolean)}function fa(Rc){return $world.withAllSubmorphsDo(function(rd){rd.isWindow&&rd.minimized&&rd.targetMorph&&rd.targetMorph.isText&&(rd=rd.targetMorph);if(!rd.textString||!rd.isText||rd.isUsedAsEpiMorph())return null;
var Vd=rd.textString.toLowerCase();return Rc.every(function(se){return Vd.includes(se)})?rd:null}).filter(Boolean)}var Db=this,sa,La,Wa,Jb,rc,Lc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){if(1==Rc.nextAddress)return Rc.yield($world.filterableListPrompt("search workspaces",[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function(rd){rd.getSubmorphNamed("list").updateFilter=function(){var Vd=this.parseInput();if(!(3>Vd.input.length)){var se=fa(Vd.lowercasedTokens);
this.listMorph.items=Na(se,Vd.lowercasedTokens)}}}}),2);sa=Rc.yieldResult;La=$jscomp.makeIterator(sa.selected);return(Wa=La.next().value)?(Jb=Wa,rc=Jb.morph,Lc=Jb.window,Sc=Jb.row,Lc&&(Lc.minimized&&Lc.toggleMinimize(),Lc.activate()),(Lc||rc).show(),Db.cursorPosition={row:Sc,column:0},Rc.return(rc)):Rc.return(null)})}},{name:"open PartsBin",exec:function(Na){var fa,Db,sa,La;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==Wa.nextAddress)return fa=Sd.LoadingIndicator.open("Loading Partsbin..."),
Wa.yield(System.import("lively.morphic/partsbin.js"),2);if(3!=Wa.nextAddress)return Db=Wa.yieldResult,sa=Db.loadPart,Wa.yield(sa("PartsBin"),3);La=Wa.yieldResult;La.openInWorldNearHand();La.targetMorph.selectedCategory="*basics*";La.focus();fa.remove();La.getWindow().activate();return Wa.return(La)})}},{name:"browse and load component",exec:function(Na){var fa,Db,sa,La,Wa,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:fa=Sd.LoadingIndicator.open("loading component browser");
if(Na._componentsBrowser){rc.jumpTo(2);break}return rc.yield(fa.whenRendered(),2);case 2:if(Db=Na._componentsBrowser){rc.jumpTo(4);break}La=sa=Na;return rc.yield(Sd.resource("part://SystemDialogs/master component browser").read(),5);case 5:Db=La._componentsBrowser=rc.yieldResult;case 4:return Wa=Db,fa.remove(),rc.yield(Wa.activate(),6);case 6:(Jb=rc.yieldResult)&&!Jb.world()&&Jb.openInWorld(),rc.jumpToEnd()}})}},{name:"load object from PartsBin",exec:function(Na,fa){fa=void 0===fa?{}:fa;var Db,sa,
La,Wa,Jb,rc,Lc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){switch(Rc.nextAddress){case 1:return sa=fa,La=sa.name,Wa=void 0===sa.open?!0:sa.open,La?Rc.yield(System.import("lively.morphic/partsbin.js"),6):Rc.yield(System.import("lively.morphic/partsbin.js"),4);case 4:return Jb=Rc.yieldResult,rc=Jb.interactivelyLoadObjectFromPartsBinFolder,Rc.yield(rc(),5);case 5:Db=Rc.yieldResult;Rc.jumpTo(3);break;case 6:return Lc=Rc.yieldResult,Sc=Lc.loadObjectFromPartsbinFolder,Rc.yield(Sc(La),
7);case 7:Db=Rc.yieldResult;case 3:return Db&&Wa&&Db.openInWorldNearHand(),Rc.return(Db)}})}},{name:"open object drawer",exec:function(Na){var fa,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){if(1==sa.nextAddress)return sa.yield(System.import("lively.components/object-drawer.js"),2);fa=sa.yieldResult;Db=fa.default;return sa.return((new Db).openInWorldNearHand())})}},{name:"open object editor",exec:function(Na,fa){fa=void 0===fa?{target:null,selectedClass:null,selectedMethod:null,
evalEnvironment:null}:fa;var Db,sa,La,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jb){if(1==Jb.nextAddress){if(!fa.target)return Na.setStatusMessage("No target for ObjectEditor"),Jb.return(null);Db=fa.loadingIndicator=Sd.LoadingIndicator.open("Open Object Editor...");return Jb.yield(System.import("lively.ide/js/objecteditor/index.js"),2)}if(3!=Jb.nextAddress)return sa=Jb.yieldResult,La=sa.ObjectEditor,Jb.yield(La.open(fa),3);Wa=Jb.yieldResult;Db.remove();return Jb.return(Wa)})}},
{name:"open object inspector",exec:function(Na,fa){fa=void 0===fa?{target:null}:fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Db){return fa.target?Db.return(Sd.inspect(fa.target)):(Na.setStatusMessage("no target for Inspector"),Db.return(null))})}},{name:"inspect server",exec:function(Na){var fa,Db,sa,La,Wa,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:return rc.yield(System.import("lively.ide/js/inspector.js"),2);case 2:return fa=
rc.yieldResult,Db=fa.default,rc.yield(System.import("lively-system-interface"),3);case 3:return sa=rc.yieldResult,La=sa.serverInterfaceFor,Wa=La(System.baseURL+"eval"),Jb={format:"esm",context:"global",targetModule:"lively://lively.next-workspace/world",sourceURL:"inspect-server_"+Date.now(),systemInterface:Wa},rc.yield(Wa.runEval('\n           import LivelyServer from "lively.server/server.js";\n           let server = LivelyServer.servers.values().next().value;\n        ',Jb),4);case 4:Db.openInWindow({remoteTarget:{code:"server",
evalEnvironment:Jb}}),rc.jumpToEnd()}})}},{name:"open scene graph inspector",exec:function(Na,fa){fa=void 0===fa?{target:null}:fa;var Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){if(1==sa.nextAddress)return sa.yield(Sd.loadObjectFromPartsbinFolder("scene graph inspector"),2);Db=sa.yieldResult;Db.targetMorph=fa.target||Na;return sa.return(Db.openInWindow({title:"morph graph"}))})}},{name:"open browser",progressIndicator:"opening browser...",exec:function(Na,fa,Db,sa){fa=void 0===
fa?{packageName:"lively.morphic",moduleName:"morph.js"}:fa;var La,Wa,Jb,rc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){switch(Sc.nextAddress){case 1:return(La=sa&&Na.relayCommandExecutionToFocusedMorph(sa))?Sc.return(La):Sc.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return Wa=Sc.yieldResult,Jb=Wa.default,fa?(Lc=Sd.obj.select(fa,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),Sc.yield(Jb.browse(Lc,{extent:Sd.pt(700,600)}),6)):
Sc.yield(Jb.open(),5);case 5:rc=Sc.yieldResult;Sc.jumpTo(4);break;case 6:rc=Sc.yieldResult;case 4:return rc.getWindow().activate(),Sc.return(rc)}})}},{name:"choose and browse package resources",progressIndicator:"browsing resources...",exec:function(Na,fa,Db,sa){fa=void 0===fa?{browser:null,systemInterface:null}:fa;var La,Wa,Jb,rc,Lc,Sc,Rc,rd,Vd,se,Kd,Ee,le,ge,jf,Sf,Ug,Mg,Xf,wf,th,gi,Ng,zf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cg){switch(cg.nextAddress){case 1:if(La=sa&&Na.relayCommandExecutionToFocusedMorph(sa))return cg.return(La);
Wa=(Wa=fa.browser||Na.focusedMorph&&Na.focusedMorph.ownerChain().find(function(og){return og.isBrowser}))&&Wa.isBrowser?Wa.getWindow():null;return cg.yield(System.import("lively-system-interface"),2);case 2:return Jb=cg.yieldResult,rc=Jb.localInterface,Lc=fa&&fa.systemInterface?fa.systemInterface:Wa?Wa.systemInterface:rc,cg.yield(Lc.getPackages({excluded:Sd.config.ide.js.ignoredPackages}),3);case 3:Sc=cg.yieldResult,Rc=[],rd={},Vd=$jscomp.makeIterator(Sc),se=Vd.next();case 4:if(se.done)return cg.yield(Na.filterableListPrompt("Choose module to open",
Rc,{historyId:"lively.morphic-choose and browse package resources",requester:Wa,width:700,multiSelect:!0,fuzzy:"value.shortName"}),8);rd.$jscomp$loop$prop$p$2954=se.value;rd.$jscomp$loop$prop$excluded$2953=(Sd.Path("lively.ide.exclude").get(rd.$jscomp$loop$prop$p$2954)||[]).map(function(og){return og.includes("*")?new RegExp(og.replace(/\*/g,".*")):og});rd.$jscomp$loop$prop$excluded$2953.push(".git","node_modules",".module_cache");Kd=Rc.push;Ee=Kd.apply;le=Rc;ge=$jscomp;jf=ge.arrayFromIterable;Sf=
function(og){return function(qh){return{isListItem:!0,string:"["+og.$jscomp$loop$prop$p$2954.name+"] "+qh.nameInPackage+(qh.isLoaded?"":" [not loaded]"),value:qh}}}(rd);Ug=function(og){return function(qh){var Le=qh.url;return!Le.endsWith("/")&&!og.$jscomp$loop$prop$excluded$2953.some(function(hi){return hi instanceof RegExp?hi.test(Le):Le.includes(hi)})}}(rd);return cg.yield(Lc.resourcesOfPackage(rd.$jscomp$loop$prop$p$2954,rd.$jscomp$loop$prop$excluded$2953),7);case 7:Ee.call(Kd,le,jf.call(ge,cg.yieldResult.filter(Ug).sort(function(og,
qh){return og.isLoaded&&!qh.isLoaded?-1:!og.isLoaded&&qh.isLoaded?1:og.nameInPackage.toLowerCase()<qh.nameInPackage.toLowerCase()?-1:og.nameInPackage.toLowerCase()==qh.nameInPackage.toLowerCase()?0:1}).map(Sf)));rd={$jscomp$loop$prop$excluded$2953:rd.$jscomp$loop$prop$excluded$2953,$jscomp$loop$prop$p$2954:rd.$jscomp$loop$prop$p$2954};se=Vd.next();cg.jumpTo(4);break;case 8:return Mg=cg.yieldResult,Xf=Mg.selected,wf=$jscomp.makeIterator(Sd.arr.partition(Xf,function(og){return og.url.match(/\.js(on)?/)})),
th=wf.next().value,gi=wf.next().value,cg.yield(System.import("lively.ide/js/browser/index.js"),9);case 9:return Ng=cg.yieldResult,zf=Ng.default,cg.yield(Promise.all(th.map(function(og){return zf.browse({packageName:og.package,moduleName:og.url},Wa,Lc).then(function(qh){return qh.activate()})})),10);case 10:if(!gi.length){cg.jumpTo(11);break}return cg.yield(Promise.all(gi.map(function(og){return Na.execCommand("open file",{url:og.url})})),11);case 11:return cg.return(!0)}})}},{name:"choose and browse module",
progressIndicator:"browsing module...",handlesCount:!0,exec:function(Na,fa,Db){fa=void 0===fa?{browser:void 0,systemInterface:void 0}:fa;var sa,La,Wa,Jb,rc,Lc,Sc,Rc,rd,Vd,se,Kd,Ee,le,ge,jf,Sf,Ug,Mg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xf){switch(Xf.nextAddress){case 1:if(!fa.browser&&(La=(sa=Na.focusedMorph)&&sa.getWindow())&&La.targetMorph&&La.targetMorph.isFileBrowser)return Xf.return(La.targetMorph.execCommand("find file and select",fa,Db));Wa=fa.browser||sa&&sa.ownerChain().find(function(wf){return wf.isBrowser});
return Xf.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return Jb=Xf.yieldResult,rc=Jb.default,Xf.yield(System.import("lively-system-interface"),3);case 3:return Lc=Xf.yieldResult,Sc=Lc.localInterface,Rc=fa&&fa.systemInterface?fa.systemInterface:Wa?Wa.systemInterface:Sc,rd="local"==Rc.name?"":" on ["+Sd.string.truncate(Rc.name,35,"...")+"]",Xf.yield(Rc.getPackages(),4);case 4:Vd=Xf.yieldResult;se=[];Kd=$jscomp.makeIterator(Vd);for(Ee=Kd.next();!Ee.done;Ee=Kd.next())for(le=Ee.value,
ge=Sd.Path("lively.ide.exclude").get(le)||[],ge=ge.map(function(wf){return wf.includes("*")?new RegExp(wf.replace(/\*/g,".*")):wf}),jf={},Sf=$jscomp.makeIterator(le.modules),Ug=Sf.next();!Ug.done;jf={$jscomp$loop$prop$m$2956:jf.$jscomp$loop$prop$m$2956},Ug=Sf.next())jf.$jscomp$loop$prop$m$2956=Ug.value,ge.some(function(wf){return function(th){return th instanceof RegExp?th.test(wf.$jscomp$loop$prop$m$2956.name):wf.$jscomp$loop$prop$m$2956.name.includes(th)}}(jf))||(Mg=Rc.shortModuleName(jf.$jscomp$loop$prop$m$2956.name,
le),se.push({isListItem:!0,string:"["+le.name+"] "+Mg,value:{package:le,module:jf.$jscomp$loop$prop$m$2956,shortName:Mg}}));se=Sd.arr.sortBy(se,function(wf){return wf.string});(function(){var wf,th,gi,Ng,zf,cg,og,qh,Le;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hi){switch(hi.nextAddress){case 1:return wf=Wa||sa,hi.yield(Na.filterableListPrompt("Choose module to open"+rd,se,{historyId:"lively.morphic-choose and browse module",requester:wf,height:Math.min(wf.height,700),width:500,multiSelect:!0,
listFontColor:"white",fuzzy:"value.shortName"}),2);case 2:th=hi.yieldResult,gi=th.selected,Ng=0;case 3:if(!(Ng<gi.length)){hi.jumpTo(0);break}zf=gi[Ng];cg=zf.package;og=zf.shortName;qh={packageName:cg.name,moduleName:og};return hi.yield(rc.browse(qh,0===Ng?Wa:void 0,Rc),6);case 6:Le=hi.yieldResult,Le.moveBy(Sd.pt(20*Ng,20*Ng)),Le.getWindow().activate(),Ng++,hi.jumpTo(3)}})})();return Xf.return(!0)}})}},{name:"open code search",progressIndicator:"opening code search...",exec:function(Na,fa){fa=void 0===
fa?{browser:null,systemInterface:null,input:null}:fa;var Db,sa,La,Wa,Jb,rc,Lc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){if(1==Rc.nextAddress){Db=Na.focusedMorph?Na.focusedMorph.ownerChain():[];sa=fa.browser||Db.find(function(rd){return rd.isBrowser});La=Sd.LoadingIndicator.open("loading code search");if(sa&&sa.isBrowser){if(sa.state.associatedSearchPanel)return Rc.return(sa.state.associatedSearchPanel.getWindow().activate())}else sa=null;return Rc.yield(System.import("lively-system-interface"),
2)}if(3!=Rc.nextAddress)return Wa=Rc.yieldResult,Jb=Wa.localInterface,rc=fa.systemInterface||sa&&sa.systemInterface,rc||(rc=(Lc=Db.find(function(rd){return rd.isText&&rd.editorPlugin&&rd.editorPlugin.isJSEditorPlugin}))?Lc.editorPlugin.systemInterface():Jb),Rc.yield(Sd.resource("part://SystemIDE/code search").read(),3);Sc=Rc.yieldResult;Object.assign(Sc,{browser:sa,input:fa.input,systemInterface:rc});Sc.openInWindow();Sc.focus();La.remove();sa&&(sa.state.associatedSearchPanel=Sc);return Rc.return(Sc)})}},
{name:"open grep search",progressIndicator:"opening code search...",exec:function(Na,fa){var Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){if(1==sa.nextAddress)return sa.yield(Sd.loadObjectFromPartsbinFolder("grep search"),2);Db=sa.yieldResult;return sa.return(Db.openInWorldNearHand(Na).activate())})}},{name:"open test runner",progressIndicator:"opening test runner...",exec:function(Na){var fa,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){return 1==sa.nextAddress?
sa.yield(System.import("lively.ide/test-runner.js"),2):3!=sa.nextAddress?(fa=sa.yieldResult,Db=fa.default,sa.yield(Db.open(),3)):sa.return(sa.yieldResult)})}},{name:"open file browser",progressIndicator:"opening file browser...",exec:function(Na,fa){fa=void 0===fa?{}:fa;var Db,sa,La,Wa,Jb,rc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(1==Sc.nextAddress)return Sc.yield(System.import("lively.ide/http-file-browser.js"),2);Db=Sc.yieldResult;sa=Db.default;La=fa;Wa=La.location;
Jb=La.url;Lc=(rc=La.file)?sa.forFile(rc,Wa):sa.forLocation(Jb||Wa||document.location.origin);return Sc.return(Na.openInWindow(Lc).activate())})}},{name:"open file",progressIndicator:"opening file...",exec:function(Na,fa){fa=void 0===fa?{url:null,lineNumber:null,reuse:!1}:fa;var Db,sa,La,Wa,Jb,rc,Lc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){switch(Rc.nextAddress){case 1:Db=fa;sa=Db.url;La=Db.lineNumber;Wa=Db.reuse;Jb=Na.commandHandler.progressIndicator;if(sa){Rc.jumpTo(2);
break}Jb.visible=!1;return Rc.yield(Na.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0}),3);case 3:sa=Rc.yieldResult,Jb.visible=!0;case 2:if(Wa&&(Na.getWindows().slice(-2),rc=Sd.arr.findAndGet(Na.getWindows(),function(rd){return(rd=rd.targetMorph)&&rd.isTextEditor&&rd.location.split(":")[0]===sa?rd:null})))return"number"===typeof La&&(rc.lineNumber=La),Rc.return(rc.getWindow().activate());La&&(sa+=":"+La);return Rc.yield(System.import("lively.ide/text-editor.js"),
4);case 4:return Lc=Rc.yieldResult,Sc=Lc.default,Rc.return(sa?Sc.openURL(sa,Sd.obj.dissoc(fa,["url"])):null)}})}},{name:"open file for EDITOR",exec:function(Na,fa){fa=void 0===fa?{url:null,lineNumber:null}:fa;var Db,sa,La,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jb){return 1==Jb.nextAddress?Jb.yield(System.import("lively.ide/text-editor.js"),2):3!=Jb.nextAddress?(Db=Jb.yieldResult,sa=Db.default,La=fa,Wa=La.url,Jb.yield(sa.openAsEDITOR(Wa,{}),3)):Jb.return(Jb.yieldResult)})}},
{name:"open subserver controller",exec:function(Na,fa){var Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){if(1==sa.nextAddress)return sa.yield(Sd.loadPart("subserver controller"),2);Db=sa.yieldResult;return sa.return(Db.openInWorld())})}},{name:"[lively.installer] publish new version of a package",exec:function(Na){var fa,Db;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sa){switch(sa.nextAddress){case 1:return sa.yield(lively.modules.registerPackage(document.location.origin+
"/lively.installer"),2);case 2:return sa.yield(System.import("lively.installer/packages/publish-new-package-version.js"),3);case 3:return fa=sa.yieldResult,Db=fa.default,sa.yield(Db(),4);case 4:return sa.return(!0)}})}},{name:"report a bug",exec:function(Na){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){window.open("https://github.com/LivelyKernel/lively.next/issues/new","_blank");return fa.return(!0)})}},{name:"fix font metric",exec:function(Na){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Na.env.fontMetric.reset();
Na.withAllSubmorphsDo(function(Db){return Db.isText&&Db.textLayout&&Db.textLayout.reset()});return fa.return(!0)})}},{name:"delete change history",exec:function(Na){var fa=Na.env,Db=fa.printStatus();fa.deleteHistory();Na.setStatusMessage(Db);Na._componentsBrowser&&Na._componentsBrowser.reset();return!0}},{name:"install global inspect and show",exec:function(Na){window.show=Sd.show;window.inspect=Sd.inspect;Na.setStatusMessage("inspect() and show() are now globally available");return!0}},{name:"save world",
exec:function(Na,fa,Db,sa){var La,Wa,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==rc.nextAddress){if(La=sa&&Na.relayCommandExecutionToFocusedMorph(sa))return rc.return(La);fa=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},fa);Wa=Na.focusedMorph;return rc.yield(Sd.interactivelySaveWorld(Na,fa),2)}Jb=rc.yieldResult;Wa&&Wa.focus();return rc.return(Jb)})}},{name:"freeze world",exec:function(Na){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){return fa.yield(Sd.interactivelyFreezeWorld(Na),
0)})}},{name:"save this world",exec:function(Na,fa,Db,sa){return Na.execCommand("save world",Object.assign({confirmOverwrite:!0},fa,{showSaveDialog:!1}))}},{name:"load world",exec:function(Na,fa){fa=void 0===fa?{}:fa;var Db,sa,La,Wa,Jb,rc,Lc,Sc,Rc,rd,Vd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(se){switch(se.nextAddress){case 1:Db=fa;sa=Db.id;La=Db.commit;Wa=Db.name;Jb=Db.ref;rc=Db.world;Lc=Na.constructor;if(rc)return se.return(Lc.loadWorld(rc,Na));if(sa||La)return se.return(Lc.loadFromCommit(sa||
La,Na));if(Wa)return se.return(Lc.loadFromDB(Wa,Jb,Na));Sc=Sd.LoadingIndicator.open("loading project browser...");return se.yield(Sc.whenRendered(),2);case 2:Rc=Sd.morph({fill:Sd.Color.black.withA(.5),extent:Na.extent,name:"dark overlay",opacity:0,reactsToPointer:!1,renderOnGPU:!0,halosEnabled:!1});Rc.openInWorld(Sd.pt(0,0));Rc.animate({opacity:1,duration:300});if(rd=Na.get("a project browser")){se.jumpTo(3);break}return se.yield(Sd.resource("part://partial freezing/project browser").read(),4);case 4:rd=
se.yieldResult;case 3:return Vd=rd,Vd.name="a project browser",Vd.hasFixedPosition=!0,Vd.epiMorph=!0,Vd.bringToFront().alignInWorld(Na),Vd.update(),Vd.focus(),Sd.once(Vd,"remove",function(){return Rc.animate({opacity:0}).then(function(){return Rc.remove()})}),Sc.remove(),se.return(Vd)}})}},{name:"add external package dependency to object",exec:function(Na,fa){fa=void 0===fa?{}:fa;var Db,sa,La,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jb){if(1==Jb.nextAddress)return Db=fa.target||
Na,sa=Db.metadata&&Db.metadata.externalPackages||[],Jb.yield(Na.editListPrompt("modify package dependencies of "+Db,sa),2);La=Jb.yieldResult;Wa=La.list;if(!Wa)return Jb.return();Wa.length?(Db.metadata||(Db.metadata={}),Db.metadata.externalPackages=Wa):Db.metadata&&delete Db.metadata.externalPackages;return Jb.return(!0)})}},{name:"toggle comment browser",exec:function(Na){return $jscomp.asyncExecutePromiseGeneratorProgram(function(fa){Sd.CommentBrowser.toggle();fa.jumpToEnd()})}}];var oe=Sd.commands;
Sd.default=oe;var Ma=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js");Ma.RadialGradient=Jc;Ma.Point=zd;Ma.pt=sd;Ma.rect=Fc;Ma.Color=jc;Ma.LinearGradient=Mb;Ma.Morph=mb;Ma.Tooltip=Bc;Ma.Image=Lb;Ma.VerticalLayout=xc;Ma.GridLayout=ec;Ma.Text=ld;Ma.Ellipse=Dc;Ma.morph=He;Ma.Icon=Ta;Ma.num=hc;Ma.arr=Zc;Ma.connect=Eb;Ma.signal=tc;Ma.Popover=Fe;Ma.ColorPalette=kf;Ma.ColorPicker=yf;Ma.colorWidgets=hg;Ma.joinPath=Ec;Ma.WHEEL_URL=Ma.joinPath(System.baseURL,"/lively.ide/assets/color-wheel.png");
(function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("GradientTypeSelector")&&"function"===typeof fa.GradientTypeSelector?fa.GradientTypeSelector:fa.GradientTypeSelector=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,[{key:"defaultLinearGradient",get:function(){return new Ma.LinearGradient({stops:[{color:Ma.Color.white,offset:0},{color:Ma.Color.black,
offset:1}]})}},{key:"defaultRadialGradient",get:function(){return new Ma.RadialGradient({stops:[{color:Ma.Color.white,offset:0},{color:Ma.Color.black,offset:1}],focus:Ma.pt(.5,.5),bounds:Ma.rect(0,0,30,30)})}},{key:"update",value:function(sa){var La=$jscomp.makeIterator(this.submorphs),Wa=La.next().value;La=La.next().value;Wa.borderColor=La.borderColor=Ma.Color.gray.darker();sa instanceof Ma.RadialGradient?Wa.borderColor=Ma.Color.orange:sa instanceof Ma.LinearGradient&&(La.borderColor=Ma.Color.orange)}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientTypeSelector"}},{key:"properties",get:function(){return{fill:{defaultValue:Ma.Color.transparent},layout:{initialize:function(){this.extent=Ma.pt(180,40);this.layout=new Ma.GridLayout({grid:[[null,"radialMode",null,"linearMode",null]],autoAssign:!1,fitToCell:!1})}},submorphs:{initialize:function(){var sa=this,La=$jscomp.makeIterator(this.submorphs=[Ma.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},
name:"radialMode",fill:this.defaultRadialGradient}),Ma.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"linearMode",fill:this.defaultLinearGradient})]),Wa=La.next().value;La=La.next().value;Ma.connect(Wa,"onMouseDown",function(){return Ma.signal(sa,"radial")});Ma.connect(La,"onMouseDown",function(){return Ma.signal(sa,"linear")})}}}}}],fa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:660,end:2566})})(Ma.Morph);var fb=function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("GradientEditor")&&"function"===typeof fa.GradientEditor?fa.GradientEditor:fa.GradientEditor=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return ad(Db,Na,[{key:"remove",value:function(){ad._get(Object.getPrototypeOf(Db.prototype),"remove",this).call(this);this.gradientHandle&&this.gradientHandle.remove()}},{key:"selectRadialGradient",value:function(){var sa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){return 1==La.nextAddress?(sa.get("linearMode").borderColor=Ma.Color.gray.darker(),sa.get("radialMode").borderColor=Ma.Color.orange,La.yield(sa.applyGradient(Ma.RadialGradient),2)):La.yield(sa.updateGradientHandles(),
0)})}},{key:"selectLinearGradient",value:function(){var sa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){return 1==La.nextAddress?(sa.get("radialMode").borderColor=Ma.Color.gray.darker(),sa.get("linearMode").borderColor=Ma.Color.orange,La.yield(sa.applyGradient(Ma.LinearGradient),2)):La.yield(sa.updateGradientHandles(),0)})}},{key:"applyGradient",value:function(sa){var La=this,Wa,Jb,rc,Lc,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){Wa=La.gradientValue;
La.get("gradientEditor");Wa&&Wa.isGradient?(Jb=Wa,rc=Jb.stops,Lc=Jb.focus,Sc=Jb.vector,La.gradientValue=new sa({stops:rc,bounds:La.gradientBounds,focus:Lc,vector:Sc})):La.gradientValue=new sa({stops:[{color:Ma.Color.white,offset:0},{color:Ma.Color.black,offset:1}],bounds:La.gradientBounds});La.update(La.gradientValue);Rc.jumpToEnd()})}},{key:"showGradientHandlesOn",value:function(sa){this.handleMorph=sa;this.updateGradientHandles()}},{key:"updateGradientHandles",value:function(){var sa=this,La,Wa;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jb){if(1==Jb.nextAddress)return La=300,Wa=sa.gradientValue.__proto__.constructor,sa.handleMorph?sa.gradientHandle?Jb.yield(sa.gradientHandle.fadeOut(La),3):Jb.jumpTo(2):Jb.return();Wa==Ma.RadialGradient?sa.gradientHandle=new Ma.GradientFocusHandle({target:sa.handleMorph}):Wa==Ma.LinearGradient&&(sa.gradientHandle=new Ma.GradientDirectionHandle({target:sa.handleMorph}));sa.gradientHandle&&(Ma.signal(sa,"openHandle",sa.gradientHandle),sa.gradientHandle.relayout(),
sa.gradientHandle.opacity=0,sa.gradientHandle.animate({opacity:1,duration:La}));Jb.jumpToEnd()})}},{key:"update",value:function(sa){(sa=void 0===sa?this.gradientValue:sa)&&sa.isGradient&&this.get("gradientEditor").update(sa)}},{key:"build",value:function(){var sa;this.submorphs=[sa=new Ma.GradientTypeSelector({name:"typeSelector"}),this.gradientEditor()];Ma.connect(sa,"radial",this,"selectRadialGradient");Ma.connect(sa,"linear",this,"selectLinearGradient");Ma.connect(this,"gradientValue",this,"update");
this.update(this.gradientValue);sa.update(this.gradientValue);this.gradientValue&&this.updateGradientHandles()}},{key:"gradientEditor",value:function(){return Ma.morph({fill:null,clipMode:"hidden",extent:Ma.pt(190,80),submorphs:[new Ma.GradientStopVisualizer({position:Ma.pt(5,30),name:"gradientEditor",gradientEditor:this})]})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientEditor"}},{key:"properties",get:function(){return{layout:{initialize:function(){this.layout=new Ma.VerticalLayout({spacing:3})}},
fill:{defaultValue:Ma.Color.transparent},handleMorph:{},gradientValue:{set:function(sa){sa&&sa.isGradient||(sa=!1);this.setProperty("gradientValue",sa)}},submorphs:{initialize:function(){this.build()}}}}}],fa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:2575,end:6191})}(Ma.Morph);
Ma.GradientEditor=fb;Ma.GradientEditor=fb;Ma.GradientEditor=fb;(function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("StopControlHead")&&"function"===typeof fa.StopControlHead?fa.StopControlHead:fa.StopControlHead=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,[{key:"update",value:function(sa){var La=this.getSubmorphNamed("paletteField");
this.getSubmorphNamed("pickerField");La||(this.submorphs=[La=this.paletteField(Ma.pt(10,10))]);La.fill=this.stopColor=sa.stops[this.index].color}},{key:"onHoverIn",value:function(){var sa=this.targetProperty.stops[this.index].color;this.palette=this.palette||new Ma.Popover({name:"Color Palette",targetMorph:new Ma.ColorPalette({color:sa})});Ma.connect(this.palette.targetMorph,"color",this.palette,"color");this.picker=this.picker||new Ma.ColorPicker({color:sa});this.picker.color=sa;this.scheduleExpand()}},
{key:"onHoverOut",value:function(){this.scheduleShrink()}},{key:"scheduleExpand",value:function(){this.queue.pop()||(this.queue.push(this.expand),this.dequeue())}},{key:"scheduleShrink",value:function(){this.queue.pop()||(this.queue.push(this.shrink),this.dequeue())}},{key:"dequeue",value:function(){var sa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){if(1==La.nextAddress){if(sa.queueActive)return La.return();sa.queueActive=!0}if(3!=La.nextAddress)return 0<sa.queue.length?La.yield(sa.queue.shift().bind(sa)(),
2):La.jumpTo(3);sa.queueActive=!1;La.jumpToEnd()})}},{key:"expand",value:function(){var sa=this,La,Wa,Jb,rc,Lc,Sc,Rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){if(1<sa.submorphs.length)return rd.return();La=sa.get("paletteField");Jb=Ma.pt(2,-14);sa.submorphs=[sa.closeButton(),La,sa.pickerField()];sa.master={auto:"styleguide://SystemWidgets/stop control head/expanded"};Wa=sa.get("gradientEditor");rc=sa.transformRectToMorph(Wa,sa.innerBounds());Lc=rc.x;Sc=rc.width;Rc=Lc+Sc-Wa.width;
Lc<sa.width/2&&(Jb=Jb.addXY(sa.width/3-Lc,0));Rc>sa.width/2&&(Jb=Jb.addXY(sa.width/3-Rc,0));La.extent=Ma.pt(15,15);sa.center=Jb;sa.stopVisualizer.gradientEditor.update();rd.jumpToEnd()})}},{key:"shrink",value:function(){var sa=this,La,Wa,Jb,rc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){if(3>sa.submorphs.length)return Sc.return();La=Ma.pt(2,-14);Wa=$jscomp.makeIterator([sa.get("close"),sa.get("paletteField"),sa.get("pickerField")]);Jb=Wa.next().value;rc=Wa.next().value;Lc=Wa.next().value;
rc.bringToFront();Jb.remove();Lc.remove();sa.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"};sa.center=La;Sc.jumpToEnd()})}},{key:"onWidgetClosed",value:function(){this.palette=this.picker=null;this.shrink()}},{key:"removeStop",value:function(){this.stopVisualizer.removeStop(this.index)&&this.remove()}},{key:"closeButton",value:function(){var sa=new Ma.Morph({name:"close",extent:Ma.pt(15,15),fill:Ma.Color.transparent,origin:Ma.pt(0,-3),clipMode:"hidden",submorphs:[Ma.Icon.makeLabel("times",
{styleClasses:["closeButton"]})]});Ma.connect(sa,"onMouseDown",this,"removeStop");return sa}},{key:"updateColor",value:function(sa){this.stopVisualizer.updateStop(this.index,{color:sa})}},{key:"openColorWidget",value:function(sa){this.stopVisualizer.stopControls.forEach(function(La){return La.head.closeAllWidgets()});this[sa].topLeft=Ma.pt(0,0);Ma.connect(this[sa],"color",this,"updateColor");Ma.connect(this[sa],"close",this,"onWidgetClosed");Ma.connect(this.stopVisualizer,"remove",this[sa],"remove");
Ma.connect(this[sa],"onBlur",this,"removeWhenLostFocus",{converter:function(){return sa},varMapping:{name:sa}});this[sa].fadeIntoWorld(this.globalBounds().bottomCenter());this[sa].focus()}},{key:"removeWhenLostFocus",value:function(sa){var La=this;setTimeout(function(){$world.focusedMorph.ownerChain().includes(La[sa])||$world.focusedMorph.isMenuItem?La[sa].focus():La.closeColorWidget(sa)},100)}},{key:"closeColorWidget",value:function(sa){this[sa]&&this[sa].remove()}},{key:"closeAllWidgets",value:function(){this.closeColorWidget("palette");
this.closeColorWidget("picker")}},{key:"paletteField",value:function(sa){sa=Ma.morph({type:"ellipse",name:"paletteField",extent:sa,styleClasses:["paletteField"]});Ma.connect(sa,"onMouseDown",this,"openColorWidget",{converter:function(){return"palette"}});return sa}},{key:"pickerField",value:function(){var sa=new Ma.Image({name:"pickerField",styleClasses:["pickerField"]});Ma.connect(sa,"onMouseDown",this,"openColorWidget",{converter:function(){return"picker"}});return sa}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"StopControlHead"}},{key:"properties",get:function(){return{stopVisualizer:{},gradientEditor:{},targetProperty:{get:function(){return this.stopVisualizer.targetProperty}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"}}},index:{},queue:{defaultValue:[]},isHaloItem:{defaultValue:!0}}}}],fa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:6193,end:11487})})(Ma.Morph);(function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("GradientStopVisualizer")&&"function"===typeof fa.GradientStopVisualizer?fa.GradientStopVisualizer:fa.GradientStopVisualizer=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return ad(Db,Na,[{key:"update",value:function(sa){this.fill=new Ma.LinearGradient({stops:sa.stops,vector:"eastwest"});this.get("instruction").animate({visible:!1,duration:300});this.renderStopControls(sa)}},{key:"onHoverOut",value:function(){this.toggleStopPreview(!1)}},{key:"onMouseMove",value:function(sa){var La=sa.positionIn(this);sa=La.x;this.stopControls&&this.stopControls.find(function(Wa){return Wa.bounds().containsPoint(La)})?this.toggleStopPreview(!1):(this.toggleStopPreview(!0),
this.get("stopControlPreview").position=Ma.pt(sa,0))}},{key:"onMouseDown",value:function(sa){if(this.get("stopControlPreview").visible){var La=sa.positionIn(this).x/this.width;sa=this.targetProperty.stops.findIndex(function(Wa){return Wa.offset>La});sa=0>sa?this.targetProperty.stops.length-1:sa;this.insertStop(sa,La)}}},{key:"toggleStopPreview",value:function(sa){this.get("instruction").visible||(this.get("stopControlPreview").visible=sa)}},{key:"removeStop",value:function(sa){var La=this.targetProperty;
return 2<La.stops.length?(Ma.arr.removeAt(La.stops,sa),this.targetProperty=La,!0):!1}},{key:"insertStop",value:function(sa,La){var Wa=this.targetProperty;Ma.arr.pushAt(Wa.stops,{offset:La,color:Wa.stops[sa].color},sa);this.targetProperty=Wa}},{key:"updateStop",value:function(sa,La){var Wa=this.targetProperty;Wa.stops[sa]=Object.assign({},Wa.stops[sa],{},La);this.targetProperty=Wa}},{key:"renderStopControls",value:function(sa){var La=this;if(!this.stopControls||this.stopControls.length!=sa.stops.length){var Wa=
$jscomp.makeIterator(this.submorphs),Jb=Wa.next().value;Wa=Wa.next().value;this.stopControls=sa.stops.map(function(rc,Lc){return new Ma.GradientStopControl({stopVisualizer:La,index:Lc})});this.submorphs=[Jb,Wa].concat($jscomp.arrayFromIterable(this.stopControls));Ma.arr.invoke(this.stopControls,"update",sa)}Ma.arr.invoke(this.stopControls,"update",sa)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopVisualizer"}},{key:"properties",get:function(){return{fill:{defaultValue:Ma.Color.gray},
gradientEditor:{},draggable:{defaultValue:!1},targetProperty:{derived:!0,get:function(){return this.gradientEditor&&this.gradientEditor.gradientValue},set:function(sa){this.gradientEditor.gradientValue=sa}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop visualizer"}}},submorphs:{after:["gradientEditor"],initialize:function(){this.submorphs=[{type:"label",name:"instruction",value:"Select Gradient Type",visible:!(this.targetProperty&&this.targetProperty.isGradient)},
{name:"stopControlPreview",visible:!1,master:{auto:"styleguide://SystemWidgets/stop control preview"},submorphs:[Ma.Icon.makeLabel("plus-circle",{name:"addStopLabel"})]}]}}}}}],fa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:11489,end:14883})})(Ma.Morph);(function(Na){var fa=
lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("GradientStopControl")&&"function"===typeof fa.GradientStopControl?fa.GradientStopControl:fa.GradientStopControl=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,[{key:"update",value:function(sa){this.position=this.stopVisualizer.extent.subPt(Ma.pt(10,0)).scaleByPt(Ma.pt(sa.stops[this.index].offset,0)).addPt(Ma.pt(5,
0));this.head.update(sa)}},{key:"onDragStart",value:function(sa){this.nativeCursor="-webkit-grabbing";this.stopVisualizer.nativeCursor="-webkit-grabbing";this.offsetView=(new Ma.Tooltip).openInWorld(sa.hand.position.addPt(Ma.pt(10,10)))}},{key:"onDrag",value:function(sa){var La=Math.max(0,Math.min(1,(this.position.x-5+sa.state.dragDelta.x)/(this.stopVisualizer.width-10)));this.stopVisualizer.updateStop(this.index,{offset:La});this.offsetView.description=(100*La).toFixed(2)+"%";this.offsetView.position=
sa.hand.position.addPt(Ma.pt(10,10))}},{key:"onDragEnd",value:function(){this.nativeCursor="-webkit-grab";this.stopVisualizer.nativeCursor="auto";this.offsetView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopControl"}},{key:"properties",get:function(){return{index:{},head:{},stopVisualizer:{},styleClasses:{defaultValue:["stopControlLine"]},nativeCursor:{defaultValue:"-webkit-grab"},draggable:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop control"}}},
submorphs:{after:["index","stopVisualizer"],initialize:function(){this.head=new Ma.StopControlHead({name:"stop control head",stopVisualizer:this.stopVisualizer,index:this.index});this.head.stopControl=this;this.addMorph(this.head)}}}}}],fa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},
{start:14885,end:16661})})(Ma.Morph);(function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("FocusHandle")&&"function"===typeof fa.FocusHandle?fa.FocusHandle:fa.FocusHandle=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().center()}},{key:"onDragStart",value:function(sa){this.tfm=
this.gradientHandle.target.getGlobalTransform().inverse();this.focusView=(new Ma.Tooltip).openInWorld(sa.hand.position.addPt(Ma.pt(10,10)))}},{key:"onDrag",value:function(sa){var La=sa.state.dragDelta,Wa=this.gradientHandle,Jb=Wa.target.fill;Jb.focus=Jb.focus.addXY(La.x/Wa.target.width,La.y/Wa.target.height);this.focusView.description="x: "+(100*Jb.focus.x).toFixed()+"%, y: "+(100*Jb.focus.y).toFixed()+"%";this.focusView.position=sa.hand.position.addPt(Ma.pt(10,10));Wa.target.makeDirty();Wa.relayout()}},
{key:"onDragEnd",value:function(sa){this.focusView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"FocusHandle"}},{key:"properties",get:function(){return{gradientHandle:{},styleClasses:{defaultValue:["focusHandle"]},extent:{defaultValue:Ma.pt(20,20)},fill:{defaultValue:Ma.Color.orange}}}}],fa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:16663,end:17666})})(Ma.Ellipse);(function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("BoundsHandle")&&"function"===typeof fa.BoundsHandle?fa.BoundsHandle:fa.BoundsHandle=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().partNamed(this.side);
this.scale=1/this.gradientHandle.target.getGlobalTransform().getScale()}},{key:"onDragStart",value:function(sa){this.boundsView=(new Ma.Tooltip).openInWorld(sa.hand.position.addPt(Ma.pt(10,10)))}},{key:"onDrag",value:function(sa){var La=this.gradientHandle,Wa=La.target.fill,Jb=Wa.bounds.partNamed(this.side).addPt(sa.state.dragDelta.scaleBy(2));Wa.bounds=Wa.bounds.withPartNamed(this.side,Jb);this.boundsView.description="w: "+Wa.bounds.width.toFixed()+"px h: "+Wa.bounds.height.toFixed()+"px";this.boundsView.position=
sa.hand.position.addPt(Ma.pt(10,10));La.target.makeDirty();La.relayout()}},{key:"onDragEnd",value:function(sa){this.boundsView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"BoundsHandle"}},{key:"properties",get:function(){return{side:{},gradientHandle:{},styleClasses:{after:["side"],initialize:function(){this.styleClasses=["boundsHandle",this.side]}}}}}],fa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:17668,end:18747})})(Ma.Ellipse);var dc=function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("GradientFocusHandle")&&"function"===typeof fa.GradientFocusHandle?fa.GradientFocusHandle:fa.GradientFocusHandle=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return ad(Db,Na,[{key:"relayout",value:function(){var sa=this.target.fill,La=sa.focus;this.extent=sa.bounds.extent();this.submorphs.forEach(function(Wa){return Wa.relayout()});this.rotation=this.target.rotation;this.scale=this.target.scale;this.borderWidth=2/this.scale;this.owner&&(this.center=this.owner.localizePointFrom(this.target.extent.scaleByPt(La),this.target))}},{key:"initBoundsHandles",value:function(){var sa=this;this.bounds().sides.forEach(function(La){sa.addMorph(new Ma.BoundsHandle({gradientHandle:sa,
side:La,name:"bounds handle "+La.split("C")[0]}))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientFocusHandle"}},{key:"properties",get:function(){return{target:{},isHaloItem:{defaultValue:!0},hasFixedPosition:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient focus handle"}}},submorphs:{initialize:function(){this.submorps=[];this.initBoundsHandles();this.addMorph(new Ma.FocusHandle({gradientHandle:this}));this.relayout()}}}}}],
fa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:18756,end:20039})}(Ma.Ellipse);Ma.GradientFocusHandle=dc;Ma.GradientFocusHandle=dc;Ma.GradientFocusHandle=dc;(function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("RotationPoint")&&
"function"===typeof fa.RotationPoint?fa.RotationPoint:fa.RotationPoint=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,[{key:"relayout",value:function(){this.center=Ma.Point.polar(this.gradientHandle.width/2,this.gradientHandle.target.fill.vectorAsAngle())}},{key:"onDragStart",value:function(sa){this.angleView=(new Ma.Tooltip).openInWorld(sa.hand.position.addPt(Ma.pt(10,10)));this.angleView.rotation=
0}},{key:"onDrag",value:function(sa){var La=this.gradientHandle;La.target.fill.vector=sa.positionIn(La).theta();La.target.makeDirty();La.relayout();this.angleView.description=(Ma.num.toDegrees(La.target.fill.vectorAsAngle())+180).toFixed()+"\u00b0";this.angleView.position=sa.hand.position.addPt(Ma.pt(10,10))}},{key:"onDragEnd",value:function(sa){this.angleView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RotationPoint"}},{key:"properties",get:function(){return{gradientHandle:{}}}}],
fa,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20041,end:20838})})(Ma.Ellipse);(function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Db=fa.hasOwnProperty("GradientDirectionHandle")&&"function"===typeof fa.GradientDirectionHandle?
fa.GradientDirectionHandle:fa.GradientDirectionHandle=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,[{key:"isHaloItem",get:function(){return!0}},{key:"relayout",value:function(){this.owner&&(this.position=this.owner.localizePointFrom(this.target.extent.scaleBy(.5),this.target));this.rotationPoint.relayout()}},{key:"initRotationPoint",value:function(){this.rotationPoint=this.addMorph(new Ma.RotationPoint({gradientHandle:this,
name:"rotation point"}))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientDirectionHandle"}},{key:"properties",get:function(){return{target:{},origin:{defaultValue:Ma.pt(25,25)},extent:{defaultValue:Ma.pt(50,50)},hasFixedPosition:{defaultValue:!0},submorphs:{initialize:function(){this.initRotationPoint();this.relayout()}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient direction handle"}}}}}}],fa,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20840,end:21812})})(Ma.Ellipse);Ma.colorWidgets.GradientEditor=Ma.GradientEditor;var za=lively.FreezerRuntime.recorderFor("lively.components/canvas.js");za.pt=sd;za.Point=zd;za.rect=Fc;za.Color=jc;za.Morph=mb;za.Image=Lb;za.connect=Eb;dc=Sa("C",function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.components/canvas.js"),
Db=fa.hasOwnProperty("Canvas")&&"function"===typeof fa.Canvas?fa.Canvas:fa.Canvas=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,[{key:"context",get:function(){if(this._canvas)return this._canvas.getContext(this.contextType);this.world()&&this.env.renderer.getNodeForMorph(this)||console.warn("Context not yet rendered. Please ensure that the Canvas Morph has been rendered first before accessing the context. This can be achieved by waiting for the whenRendered() promise before you proceed accessing the context property.");
return null}},{key:"_canvas",set:function(sa){var La=this.__canvas__;this.__canvas__=sa;this.restoreContent(La,sa)}},{key:"_canvas",get:function(){return this.__canvas__}},{key:Symbol.for("lively-instance-initialize"),value:function(sa){sa=void 0===sa?{}:sa;ad._get(Object.getPrototypeOf(Db.prototype),Symbol.for("lively-instance-initialize"),this).call(this,sa);za.connect(this,"extent",this,"onExtentChanged")}},{key:"afterRender",value:function(sa,La){La?this._canvas=sa:"function"===typeof this.__canvas_init__&&
(this.__canvas_init__(),delete this.__canvas_init__)}},{key:"restoreContent",value:function(sa,La){var Wa=this.contextType,Jb=this.preserveContents;"function"===typeof this.__canvas_init__?(this.__canvas_init__(),delete this.__canvas_init__):Jb&&"2d"==Wa&&sa&&sa!==La&&this.context.drawImage(sa,0,0)}},{key:"onExtentChanged",value:function(){var sa=this;if(this._canvas&&this.preserveContents&&this.context.getImageData){var La=this._canvas,Wa=La.width;La=La.height;if(Wa&&La){var Jb=this.context.getImageData(0,
0,Wa,La);this.__canvas_init__=function(){sa.context.putImageData(Jb,0,0)}}}}},{key:"clear",value:function(sa){var La=this.context;if(La){var Wa=this._canvas,Jb=Wa.width;Wa=Wa.height;La.save();La.setTransform(1,0,0,1,0,0);sa?(sa.toCSSString&&(sa=sa.toCSSString()),La.fillStyle=sa,La.fillRect(0,0,Jb,Wa)):La.clearRect(0,0,Jb,Wa);La.restore()}}},{key:"render",value:function(sa){return sa.renderCanvas(this)}},{key:"withContextDo",value:function(sa){var La=this;this._canvas?sa(this.context):this.__canvas_init__=
function(){return sa(La.context)}}},{key:"toDataURI",value:function(){return this._canvas&&this._canvas.toDataURL()}},{key:"fromDataURI",value:function(sa){var La=this,Wa=new za.Image;Wa.onload=function(){La._canvas.width=Wa.width;La._canvas.height=Wa.height;La.context.drawImage(Wa,0,0)};Wa.src=sa}},{key:"imageData",value:function(sa){sa||(sa=this.canvasBounds);return this.context.getImageData(sa.x,sa.y,sa.width,sa.height)}},{key:"nonTransparentArea",value:function(){for(var sa=this.imageData(),La=
sa.data,Wa=sa.width,Jb=sa.height,rc=Wa,Lc=Jb,Sc=0;Sc<Jb;Sc++)for(var Rc=0;Rc<rc;Rc++)0<La[4*(Sc*Wa+Rc)+3]&&(rc=Rc,Lc>Sc&&(Lc=Sc));if(rc===Wa)return za.rect(0,0,0,0);Sc=rc;Rc=Lc;for(--Jb;Jb>Lc;Jb--)for(var rd=Wa-1;rd>Sc;rd--)0<La[4*(Jb*Wa+rd)+3]&&(Sc=rd,Rc<Jb&&(Rc=Jb));return{imageData:sa,bounds:za.rect(rc,Lc,Sc-rc+1,Rc-Lc+1)}}},{key:"trimNonTransparent",value:function(){var sa=this.nonTransparentArea(),La=sa.imageData;sa=sa.bounds;if(!sa.topLeft().equals(za.pt(0,0))){var Wa=sa.x,Jb=sa.y;this.context.putImageData(La,
-Wa,-Jb,Wa,Jb,sa.width,sa.height);this.position=this.position.addPt(sa.topLeft())}sa.extent().equals(this.extent)||(this.extent=sa.extent())}},{key:"finishDraw",value:function(sa){sa=void 0===sa?{}:sa;var La=this.context,Wa=sa,Jb=void 0===Wa.color?"rgba(0,0,0,0.6)":Wa.color,rc=void 0===Wa.width?4:Wa.width;Wa=void 0===Wa.fill?!1:Wa.fill;sa=sa.fillColor||Jb;Jb.toCSSString&&(Jb=Jb.toCSSString());sa.toCSSString&&(sa=sa.toCSSString());La.strokeStyle=Jb;La.lineWidth=rc;La.stroke();La.closePath();Wa&&(La.fillStyle=
sa,La.fill())}},{key:"line",value:function(sa,La,Wa){Wa=void 0===Wa?{}:Wa;var Jb=this.context;Jb.beginPath();Jb.moveTo(sa.x,sa.y);Jb.lineTo(La.x,La.y);Jb.lineCap="round";this.finishDraw(Wa)}},{key:"arc",value:function(sa,La,Wa,Jb,rc,Lc){rc=void 0===rc?!1:rc;Lc=void 0===Lc?{}:Lc;var Sc=this.context;Sc.beginPath();Sc.arc(sa.x,sa.y,La,Wa,Jb,rc);this.finishDraw(Lc)}},{key:"polygon",value:function(sa,La){La=void 0===La?{}:La;var Wa=this.context;Wa.beginPath();Wa.moveTo(sa[0].x,sa[0].y);for(var Jb=0;Jb<
sa.length;Jb++)Wa.lineTo(sa[Jb].x,sa[Jb].y);Wa.lineTo(sa[0].x,sa[0].y);this.finishDraw(La)}},{key:"text",value:function(sa,La,Wa){Wa=void 0===Wa?{}:Wa;var Jb=this.context,rc=Wa,Lc=void 0===rc.color?"black":rc.color,Sc=void 0===rc.font?"14px Arial":rc.font,Rc=void 0===rc.align?"start":rc.align;rc=void 0===rc.baseline?"bottom":rc.baseline;Jb.save();Jb.font=Sc;Jb.fillStyle=Lc;Jb.textAlign=Rc;Jb.textBaseline=rc;Wa.angle&&!isNaN(Wa.angle)&&(Jb.translate(La.x,La.y),Jb.rotate(Wa.angle),Jb.translate(-La.x,
-La.y));Jb.fillText(sa,La.x,La.y);Jb.restore()}},{key:"line",value:function(sa,La,Wa){Wa=void 0===Wa?{}:Wa;var Jb=this.context,rc=Wa.color||"rgba(0,0,0,0.6)";Wa=Wa.width||4;rc.toCSSString&&(rc=rc.toCSSString());Jb.strokeStyle=rc;Jb.beginPath();Jb.lineWidth=Wa;Jb.moveTo(sa.x,sa.y);Jb.lineTo(La.x,La.y);Jb.stroke();Jb.closePath()}},{key:"spiral",value:function(){this.clear(za.Color.white);for(var sa=this.innerBounds().center(),La=0,Wa=1,Jb=0;150>Jb;Jb++){var rc=sa.addPt(za.Point.polar(Wa,La));this.line(sa,
rc,{color:za.Color.random()});sa=rc;La+=Math.PI/10;Wa+=.3}}},{key:"rect",value:function(sa,La,Wa){Wa=void 0===Wa?{}:Wa;var Jb=this.context;Jb.beginPath();Jb.rect(sa.x,sa.y,La.x,La.y);this.finishDraw(Wa)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Canvas"}},{key:"properties",get:function(){return{extent:{defaultValue:za.pt(200,200)},fill:{defaultValue:za.Color.transparent},contextType:{defaultValue:"2d"},preserveContents:{defaultValue:!0},canvasExtent:{get:function(){return this._canvas&&
za.pt(this._canvas.width,this._canvas.height)}},canvasBounds:{readOnly:!0,get:function(){return this._canvas&&this.canvasExtent.extentAsRectangle()}},_serializedContents:{get:function(){return this.preserveContents&&this.toDataURI()},set:function(sa){var La=this;this.withContextDo(function(){return La.fromDataURI(sa)})}}}}}],fa,{pathInPackage:function(){return"canvas.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.components",version:"0.1.0"}}},{start:233,end:8699})}(za.Morph));za.Canvas=dc;za.Canvas=dc;za.Canvas=dc;var Fa=lively.FreezerRuntime.recorderFor("lively.ide/world.js");Fa.resource=Zb;Fa.Rectangle=Vb;Fa.Color=jc;Fa.pt=sd;Fa.arr=Zc;Fa.fun=td;Fa.obj=yd;Fa.promise=fc;Fa.PropertyPath=ed;Fa.once=Ad;Fa.GridLayout=ec;Fa.MorphicDB=zc;Fa.easings=ue;Fa.HTMLMorph=ac;Fa.Text=ld;Fa.Label=Oa;Fa.Path=Da;Fa.Polygon=ka;Fa.morph=He;Fa.Ellipse=Dc;Fa.touchInputDevice=Ba;Fa.Icon=
Ta;Fa.Morph=mb;Fa.VerticalLayout=xc;Fa.HorizontalLayout=Ja;Fa.ProportionalLayout=Fb;Fa.Tooltip=Bc;Fa.Image=Lb;Fa.inspect=ke;Fa.config=Wd;Fa.World=va;Fa.loadMorphFromSnapshot=Ka;Fa.loadObjectFromPartsbinFolder=cd;Fa.loadPart=Bd;Fa.uploadFile=ji;Fa.InformPrompt=Rb;Fa.ConfirmPrompt=eb;Fa.MultipleChoicePrompt=Vc;Fa.TextPrompt=Qb;Fa.EditPrompt=qd;Fa.PasswordPrompt=Wc;Fa.ListPrompt=Mc;Fa.EditListPrompt=Hb;Fa.LoadingIndicator=Jd;Fa.Halo=ye;Fa.MorphHighlighter=z;Fa.StatusMessage=Ke;Fa.StatusMessageForMorph=
Ie;Fa.ProportionalLayoutHalo=$d;Fa.GridLayoutHalo=Ze;Fa.FlexLayoutHalo=hf;Fa.Window=Xd;Fa.List=Tb;Fa.FilterableList=Gb;Fa.Menu=Pa;Fa.worldCommands=oe;Fa.GradientEditor=fb;Fa.completions=ca;Fa.runEval=Ha;Fa.getClassName=cb;Fa.serialize=Pb;Fa.Canvas=dc;Fa.CommentBrowser=Ye;Fa.prefetchCoreStyleguides=sc;oe=function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Db=fa.hasOwnProperty("LivelyWorld")&&"function"===typeof fa.LivelyWorld?fa.LivelyWorld:fa.LivelyWorld=function(sa){sa&&
sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,[{key:"visibleBoundsExcludingTopBar",value:function(){var sa=$world.getSubmorphNamed("lively top bar"),La=this.visibleBounds();return sa?new Fa.Rectangle(La.x,La.y+sa.height,La.width,La.height-sa.height):La}},{key:"getListedComponents",value:function(){var sa=this,La=this.withAllSubmorphsSelect(function(Wa){return Wa.isComponent&&!sa.hiddenComponents.includes(Wa.name)});
return Fa.arr.uniq([].concat($jscomp.arrayFromIterable(La),$jscomp.arrayFromIterable(this.localComponents)))}},{key:"activeWindow",value:function(){return this.getWindows().reverse().find(function(sa){return sa.isActive()})}},{key:"getWindows",value:function(){return this.submorphs.filter(function(sa){return sa.isWindow})}},{key:"activePrompt",value:function(){return this.getPrompts().reverse().find(function(sa){return sa.isActive()})}},{key:"getPrompts",value:function(){return this.submorphs.filter(function(sa){return sa.isPrompt})}},
{key:"openInWindow",value:function(sa,La){La=void 0===La?{title:sa.name,name:"window for "+sa.name}:La;sa=(new Fa.Window(Object.assign({},La,{extent:sa.extent.addXY(0,25),targetMorph:sa}))).openInWorld();sa.ensureNotOverTheTop();return sa}},{key:"withTopBarDo",value:function(sa){var La=this.get("lively top bar");La&&sa(La)}},{key:"onTopBarLoaded",value:function(){}},{key:"onKeyUp",value:function(sa){this.withTopBarDo(function(La){return La.onKeyUp(sa)})}},{key:"onKeyDown",value:function(sa){ad._get(Object.getPrototypeOf(Db.prototype),
"onKeyDown",this).call(this,sa);sa.targetMorph==this&&this.withTopBarDo(function(La){return La.onKeyDown(sa)})}},{key:"onMouseDown",value:function(sa){ad._get(Object.getPrototypeOf(Db.prototype),"onMouseDown",this).call(this,sa);var La=sa.state.clickedOnMorph,Wa=this.activeWindow();Wa&&La==this&&Wa.deactivate();this.handleHaloCycle(sa);sa.state.menu&&sa.state.menu.remove();this._tooltipViewer.mouseDown(sa)}},{key:"onMouseUp",value:function(sa){sa.isCommandKey()&&sa.stop();if(sa.isAltDown()&&Fa.config.altClickDefinesThat){var La=
this.morphsContainingPoint(sa.position)[0];setTimeout(function(){return System.global.that=La},100);La.show();sa.stop();console.log('Set global "that" to '+La)}}},{key:"onDrag",value:function(sa){}},{key:"whenReady",value:function(){var sa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){return 1==La.nextAddress?La.yield(sa._styleLoading,2):La.return(!0)})}},{key:"onLoad",value:function(){var sa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(La){if(1==La.nextAddress){sa.opacity=
0;sa.onWindowResize();lively.modules&&lively.modules.removeHook("fetch",window.__logFetch);sa.animate({opacity:1,blur:3,duration:1E3,easing:Fa.easings.inOutExpo}).then(function(){var Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jb){if(1==Jb.nextAddress){if(!window.worldLoadingIndicator)return Jb.jumpTo(0);Wa=window.worldLoadingIndicator.world();if(Wa==sa)return Jb.jumpTo(0);sa.addMorph(window.worldLoadingIndicator);return Jb.yield(Wa.whenRendered(),4)}Wa.env.renderer.stopRenderWorldLoop();
Jb.jumpToEnd()})});if(!sa.showsUserFlap&&!Fa.resource(document.location.href).query().showsUserFlap)return La.jumpTo(2);sa._styleLoading=Fa.prefetchCoreStyleguides(window.worldLoadingIndicator);return La.yield(sa._styleLoading,2)}sa.animate({blur:0,duration:1E3,easing:Fa.easings.inOutExpo});document.body.style.overflowX="visible";document.body.style.overflowY="visible";La.jumpToEnd()})}},{key:"isNotUnique",value:function(sa){var La,Wa,Jb,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){switch(Lc.nextAddress){case 1:return Lc.yield(Fa.MorphicDB.default.exists("world",
sa),2);case 2:if(La=Lc.yieldResult.exists){Lc.jumpTo(3);break}Wa=sa+".json";Jb=Fa;rc=Jb.resource;return Lc.yield(System.decanonicalize("lively.morphic/styleguides"),5);case 5:return Lc.yield(rc.call(Jb,Lc.yieldResult).join(Wa).exists(),4);case 4:La=Lc.yieldResult;case 3:return Lc.return(La)}})}},{key:"askForName",value:function(){var sa=this,La;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return Wa.yield(sa.whenRendered(),3);case 3:if(La){Wa.jumpTo(4);
break}return Wa.yield(sa.prompt(["New Project\n",{},"Enter a name for this project:",{fontWeight:"normal"}],{width:400,hasFixedPosition:!0,forceConfirm:!0}),5);case 5:return La=Wa.yieldResult,Wa.yield(sa.isNotUnique(La),6);case 6:if(!Wa.yieldResult){Wa.jumpTo(3);break}return Wa.yield(sa.confirm("This Project name is already taken. Please pick a different one!",{hasFixedPosition:!0,width:400}),8);case 8:La=!1;Wa.jumpTo(3);break;case 4:return Wa.return(La)}})}},{key:"onWindowResize",value:function(sa){ad._get(Object.getPrototypeOf(Db.prototype),
"onWindowResize",this).call(this,sa);"elastic"===this.resizePolicy&&this.execCommand("resize to fit window")}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var sa=this,La;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==Wa.nextAddress)return sa._cachedDragIndicator||(sa._cachedDragIndicator=Fa.loadObjectFromPartsbinFolder("upload-indicator")),Wa.yield(sa._cachedDragIndicator,2);La=Wa.yieldResult;La.world()||La.openInWorld();Fa.fun.debounceNamed("remove-upload-indicator",
1E3,function(){sa.nativeDrop_removeUploadIndicator()})();Wa.jumpToEnd()})}},{key:"nativeDrop_removeUploadIndicator",value:function(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(sa){return sa.remove()})}},{key:"onNativeDragover",value:function(sa){sa.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},{key:"onNativeDrop",value:function(sa){var La=this,Wa,Jb,rc,Lc,Sc,Rc,rd,Vd,se,Kd,Ee,le,ge,jf,Sf,Ug,Mg,Xf,wf,th,gi,Ng,zf,cg,og,qh,Le,hi,vc,od,be,Hd,sf,$f,dg,pl,al,Oj,ak,
Ck,qm,Rl,rm,Ql,ii,bl;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pf){switch(Pf.nextAddress){case 1:La.nativeDrop_removeUploadIndicator();if(sa.targetMorph!=La)return Pf.return();Wa=sa;Jb=Wa.domEvt;rc=Jb.dataTransfer;Lc=rc.files;Sc=document.location.origin;if(!Lc.length){Pf.jumpTo(2);break}Rc=La.getCurrentUser();rd=Rc.isGuestUser?"uploads/":"users/"+$world.getCurrentUser().name+"/uploads";if(!sa.isAltDown()){Pf.jumpTo(3);break}return Pf.yield(La.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",
input:rd}),4);case 4:if(rd=Pf.yieldResult,!rd)return Pf.return(La.setStatusMessage("Canceled upload"));case 3:return Pf.yield(La.confirm("Upload "+Lc.length+" file"+(1<Lc.length?"s":"")+"?"),5);case 5:Vd=Pf.yieldResult;if(!Vd)return Pf.return();se=new Fa.FormData;for(Kd=0;Kd<Lc.length;Kd++)se.append("file",Lc[Kd],Lc[Kd].name);ge=Fa.LoadingIndicator.open("Uploading File");Pf.setCatchFinallyBlocks(6);jf={};Sf=function(Ui){Ui=Ui.loaded/Ui.total;ge.progress=Ui;ge.status="Uploaded "+(100*Ui).toFixed()+
"%"};Rc.isGuestUser||(jf.Authorization="Bearer "+Rc.token);Ee=Fa.resource(System.baseURL,{headers:jf,onProgress:Sf,onLoad:function(Ui){return le=Ui}});Ee=Ee.join("/upload?uploadPath="+encodeURIComponent(rd));return Pf.yield(Ee.write(se),8);case 8:Pf.leaveTryBlock(7);break;case 6:return Ug=Pf.enterCatchBlock(),Pf.return(La.showError("Upload failed: "+Ug.message+"\n"));case 7:ge.remove();Pf.setCatchFinallyBlocks(9);La.setStatusMessage("Uploaded "+le.uploadedFiles.length+" file");Mg=le.uploadedFiles.map(function(Ui){var Dk=
Fa.resource(Sc).join(Ui.path);return Object.assign({},Ui,{url:Dk.url,name:Dk.name()})});Xf=[];wf=[];th=[];gi=$jscomp.makeIterator(Mg);for(Ng=gi.next();!Ng.done;Ng=gi.next())zf=Ng.value,zf.type.startsWith("image/")?Xf.push(zf):zf.type.startsWith("video")?wf.push(zf):th.push(zf);if(!wf.length){Pf.jumpTo(11);break}cg=$jscomp.makeIterator(wf);og=cg.next();case 12:if(og.done){Pf.jumpTo(11);break}qh=og.value;Le=Object;hi=Le.assign;return Pf.yield(Fa.loadObjectFromPartsbinFolder("video morph"),15);case 15:hi.call(Le,
Pf.yieldResult,{videoURL:qh.url,name:qh.name}).openInWorld();og=cg.next();Pf.jumpTo(12);break;case 11:Xf.length&&Xf.forEach(function(Ui){var Dk=new Fa.Image({imageUrl:Ui.url,autoResize:!0,name:Ui.name});Dk.whenLoaded().then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sl){if(1==Sl.nextAddress)return Dk.extent=Dk.naturalExtent.scaleBy(.8*La.visibleBounds().height/Dk.height),Dk.openInWorld(),Sl.yield(Dk.whenRendered(),2);Dk.center=La.visibleBounds().center();Sl.jumpToEnd()})})});
if(!th.length){Pf.jumpTo(16);break}vc=$jscomp.makeIterator(th);od=vc.next();case 17:if(od.done){Pf.jumpTo(16);break}be=od.value;return Pf.yield(La.confirm("open file "+be.name+" ("+be.type+")?"),20);case 20:(Hd=Pf.yieldResult)&&La.execCommand("open file",{url:be.url});od=vc.next();Pf.jumpTo(17);break;case 16:Pf.leaveTryBlock(10);break;case 9:sf=Pf.enterCatchBlock(),La.showError(sf);case 10:return Pf.return();case 2:$f=Jb.dataTransfer.types;if(!$f.includes("text/html")){Pf.jumpTo(21);break}dg=Jb.dataTransfer.getData("text/html");
pl=(new Fa.DOMParser).parseFromString(dg,"text/html");al=pl.querySelectorAll("img");if(1===al.length&&al[0].src&&$f.includes("text/uri-list")){Oj=al[0].src;ak=new Fa.Image({imageUrl:Oj,autoResize:!0,name:Fa.arr.last(Oj.split("/"))});ak.whenLoaded().then(function(){return ak.openInWorld()});Pf.jumpTo(22);break}Ck=Object;qm=Ck.assign;return Pf.yield(Fa.loadObjectFromPartsbinFolder("html-morph"),23);case 23:qm.call(Ck,Pf.yieldResult,{html:dg}).openInWorld();case 22:return Pf.return();case 21:Rl=0;case 24:if(!(Rl<
Jb.dataTransfer.items.length)){Pf.jumpTo(0);break}rm=Jb.dataTransfer.items[Rl];if("file"!==rm.kind){"string"===rm.kind&&rm.getAsString(function(Ui){return Fa.inspect(Ui)});Pf.jumpTo(25);break}Ql=rm.getAsFile();return Pf.yield(La.confirm("Upload "+Ql.name+"?"),28);case 28:ii=Pf.yieldResult;if(!ii){Pf.jumpTo(25);break}return Pf.yield(Fa.uploadFile(Ql,Ql.type),30);case 30:(bl=Pf.yieldResult)&&bl.openInWorld(),bl.center=La.visibleBounds().center();case 25:Rl++,Pf.jumpTo(24)}})}},{key:"menuItems",value:function(){var sa=
this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",target:this},{command:"fix font metric",target:this},{command:"inspect server",target:this}]],["Tools",[{command:"open javascript workspace",target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",
target:this,tooltip:"Opens a workspace like interface\nthat allows you to trigger shell comands\nvia select + eval by pressing either "+(new Fa.Text).keysForCommand("doit")+" or "+(new Fa.Text).keysForCommand("printit")},{command:"open shell terminal",target:this,tooltip:"Opens a classic remote shell interface,\nthat allows you to send commands to a\nbash session running on the server.\nAlso comes with advanced git support."},{command:"open workspace",args:{askForMode:!0},target:this}]],{isDivider:!0},
{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Exported Components",[["Toggle Select All",function(){0==sa.getListedComponents().length?sa.hiddenComponents=[]:sa.hiddenComponents=sa.withAllSubmorphsSelect(function(La){return La.isComponent}).map(function(La){return La.name})}]].concat($jscomp.arrayFromIterable(this.withAllSubmorphsSelect(function(La){return La.isComponent}).map(function(La){var Wa=sa.hiddenComponents.includes(La.name);
return[[].concat($jscomp.arrayFromIterable(Fa.Icon.textAttribute(Wa?"square":"check-square")),["  "+La.name,{}]),function(){sa.hiddenComponents=Wa?Fa.arr.without(sa.hiddenComponents,La.name):[La.name].concat($jscomp.arrayFromIterable(sa.hiddenComponents))}]})))],["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return sa.resizePolicy="elastic"}]]:[["switch to manual resizing of world",
function(){return sa.resizePolicy="static"}]]],["Troubleshooting",[{command:"report a bug",target:this},{command:"clear storage and reload",target:this}]],{isDivider:!0},["Windows",[{command:"toggle minimize all windows",target:this},{command:"close all windows",target:this}]],{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function(sa,La){var Wa=this.env.eventDispatcher.eventState;Wa.menu&&Wa.menu.remove();return Wa.menu=La&&La.length?
Fa.Menu.openAtHand(La,{hand:sa&&sa.hand||this.firstHand}):null}},{key:"onPaste",value:function(sa){var La=this,Wa,Jb,rc,Lc,Sc,Rc,rd,Vd,se,Kd,Ee,le;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ge){switch(ge.nextAddress){case 1:ge.setCatchFinallyBlocks(2,3);Jb=sa.domEvt.clipboardData;if(!Jb.types.includes("application/morphic")){ge.jumpTo(3);break}sa.stop();rc=JSON.parse(Jb.getData("application/morphic"));Lc=[];Array.isArray(rc)||(rc=[rc]);Wa=Fa.LoadingIndicator.open("pasting morphs...");
Sc=$jscomp.makeIterator(rc);Rc=Sc.next();case 6:if(Rc.done){ge.jumpTo(8);break}rd=Rc.value;return ge.yield(Fa.loadMorphFromSnapshot(rd),9);case 9:Vd=ge.yieldResult;Vd.openInWorld(sa.hand.position);rd.copyMeta&&rd.copyMeta.offset&&(se=rd.copyMeta.offset,Kd=se.x,Ee=se.y,Vd.moveBy(Fa.pt(Kd,Ee)));Lc.push(Vd);Rc=Sc.next();ge.jumpTo(6);break;case 8:La.showHaloFor(Lc);case 3:ge.enterFinallyBlock();Wa&&Wa.remove();ge.leaveFinallyBlock(0);break;case 2:le=ge.enterCatchBlock(),La.showError(le),ge.jumpTo(3)}})}},
{key:"commands",get:function(){return Fa.worldCommands.concat(ad._get(Object.getPrototypeOf(Db.prototype),"commands",this)).concat([{name:"open in prototype box",exec:function(sa,La){var Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Jb){if(1==Jb.nextAddress)return Jb.yield(Fa.loadPart("prototype box"),2);Wa=Jb.yieldResult;Wa.wrapProto(La.target);Jb.jumpToEnd()})}}])}},{key:"keybindings",get:function(){return ad._get(Object.getPrototypeOf(Db.prototype),"keybindings",this).concat(Fa.config.globalKeyBindings)}},
{key:"keybindings",set:function(sa){ad._set(Object.getPrototypeOf(Db.prototype),"keybindings",sa,this)}},{key:"halos",value:function(){return this.submorphs.filter(function(sa){return sa.isHalo})}},{key:"haloForPointerId",value:function(sa){return this.submorphs.find(function(La){return La.isHalo&&La.state&&La.state.pointerId===sa})}},{key:"showHaloFor",value:function(sa,La,Wa){La=void 0===La?this.firstHand&&this.firstHand.pointerId:La;Wa=void 0===Wa?!0:Wa;if(Fa.Halo)return sa="function"===typeof sa.createHalo?
sa.createHalo(Fa.Halo,La):new Fa.Halo({pointerId:La,target:sa}),this.addMorph(sa),Wa&&sa.focus(),sa.alignWithTarget(),sa}},{key:"showHaloForSelection",value:function(sa,La){return 0<sa.length&&this.showHaloFor(sa,La)}},{key:"layoutHaloForPointerId",value:function(sa){sa=void 0===sa?this.firstHand&&this.firstHand.pointerId:sa;return this.submorphs.find(function(La){return La.isLayoutHalo&&La.state&&La.state.pointerId===sa})}},{key:"showLayoutHaloFor",value:function(sa,La){La=void 0===La?this.firstHand&&
this.firstHand.pointerId:La;var Wa=sa===this?null:sa.owner===this?sa:sa.ownerChain().slice(-2)[0];Wa=Wa?this.submorphs.indexOf(Wa)+1:this.submorphs.length;switch(sa.layout.constructor){case Fa.ProportionalLayout:var Jb=new Fa.ProportionalLayoutHalo({container:sa,pointerId:La});break;case Fa.HorizontalLayout:case Fa.VerticalLayout:Jb=new Fa.FlexLayoutHalo({container:sa,pointerId:La});break;case Fa.GridLayout:Jb=new Fa.GridLayoutHalo({container:this.container,pointerId:La})}return Jb&&this.addMorphAt(Jb,
Wa)}},{key:"highlightMorph",value:function(sa,La,Wa,Jb){Jb=void 0===Jb?[]:Jb;return Fa.MorphHighlighter.for(sa,La,void 0===Wa?!1:Wa,Jb)}},{key:"removeHighlighters",value:function(sa){return Fa.MorphHighlighter.removeHighlighters(void 0===sa?this:sa)}},{key:"visibleStatusMessages",value:function(){return this.submorphs.filter(function(sa){return sa.isStatusMessage})}},{key:"visibleStatusMessagesFor",value:function(sa){return this.submorphs.filter(function(La){return La.isStatusMessage&&La.targetMorph===
sa})}},{key:"logErrorPreperation",value:function(sa){var La=String(sa),Wa=sa.stack||"";Wa&&sa.message!==sa.stack&&(Wa=String(Wa),0===Wa.indexOf(La)&&(Wa=Wa.slice(La.length)),La+="\n"+Wa);return La}},{key:"logError",value:function(sa){this.setStatusMessage(this.logErrorPreperation(sa),Fa.Color.red)}},{key:"showError",value:function(sa){return this.logError(sa)}},{key:"showErrorFor",value:function(sa,La){return this.setStatusMessageFor(sa,this.logErrorPreperation(La),Fa.Color.red)}},{key:"setStatusMessageFor",
value:function(sa,La,Wa,Jb,rc){Jb=void 0===Jb?5E3:Jb;if(Fa.StatusMessageForMorph){this.visibleStatusMessagesFor(sa).forEach(function(Lc){return Lc.remove()});La=new Fa.StatusMessageForMorph(Object.assign({message:La,color:Wa},rc));this.openStatusMessage(La,Jb);La.targetMorph=sa;La.fadeIn(300);if(La.removeOnTargetMorphChange&&sa.isText)Fa.once(sa,"selectionChange",La,"fadeOut",{converter:function(){return 200},garbageCollect:!0});return La}}},{key:"setStatusMessage",value:function(sa,La,Wa,Jb){Wa=
void 0===Wa?5E3:Wa;Jb=void 0===Jb?{}:Jb;if(Fa.StatusMessage)return console[La==Fa.Color.red?"error":"log"](sa),Fa.config.verboseLogging?this.openStatusMessage(new Fa.StatusMessage(Object.assign({message:sa,color:La,hasFixedPosition:!0},Jb)),Wa):null}},{key:"openStatusMessage",value:function(sa,La){this.addMorph(sa);if(sa.slidable){for(var Wa=this.visibleStatusMessages(),Jb=$jscomp.makeIterator(Wa),rc=Jb.next();!rc.done;rc=Jb.next()){rc=rc.value;if(Wa.length<=(Fa.config.maxStatusMessages||0))break;
!rc.stayOpen&&rc.slidable&&(rc.remove(),Fa.arr.remove(Wa,rc))}Fa.arr.without(Wa,sa).forEach(function(Lc){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){!Lc.isMaximized&&Lc.slidable&&Lc.slideTo(Lc.position.addPt(Fa.pt(0,-sa.extent.y-10)));Sc.jumpToEnd()})});Wa=this.visibleBounds().bottomRight().addXY(-20,-20);sa.align(sa.bounds().bottomRight(),Wa);sa.topRight=Wa.addPt(Fa.pt(0,40));sa.animate({bottomRight:Wa,duration:500})}"number"===typeof La&&setTimeout(function(){return sa.stayOpen||
sa.fadeOut()},La);return sa}},{key:"addProgressBar",value:function(sa){sa=void 0===sa?{}:sa;var La=this,Wa,Jb,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){if(1==Lc.nextAddress)return Wa=sa,Jb=void 0===Wa.location?"center":Wa.location,Lc.yield(Fa.loadObjectFromPartsbinFolder("progress bar"),2);rc=Lc.yieldResult;Object.assign(rc,{progress:0},Fa.obj.dissoc(sa,["location"]));La.addMorph(rc);rc.align(rc[Jb],La.visibleBounds()[Jb]());return Lc.return(rc)})}},{key:"withProgressBarDo",
value:function(sa,La){var Wa=this,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){switch(rc.nextAddress){case 1:return rc.yield(Wa.addProgressBar(La),2);case 2:return Jb=rc.yieldResult,rc.setFinallyBlock(3),rc.yield(sa(Jb),5);case 5:return rc.return(rc.yieldResult);case 3:rc.enterFinallyBlock(),Jb.remove(),rc.leaveFinallyBlock(0)}})}},{key:"openPrompt",value:function(sa,La){La=void 0===La?{requester:null,animated:!1}:La;var Wa=this,Jb,rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){Jb=
Wa.focusedMorph;rc=Wa.visibleBounds();return Lc.return(Wa.withRequesterDo(La.requester,function(Sc){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rc){sa.openInWorldNear(Sc,Wa);sa.height>rc.height&&(sa.height=rc.height-5);"function"===typeof La.customize&&La.customize(sa);La.animated&&Wa.previousPrompt&&Wa.previousPrompt.world()&&Wa.previousPrompt.transitionTo(sa);Wa.previousPrompt=sa;return Rc.return(Fa.promise.finally(sa.activate(La),function(){return Jb&&Jb.focus()}))})}))})}},{key:"withRequesterDo",
value:function(sa,La){var Wa=this,Jb,rc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){switch(Sc.nextAddress){case 1:rc=Wa.visibleBounds().center();if(!sa){Sc.jumpTo(2);break}rc=sa.globalBounds().center();sa.isWorld&&(rc=sa.visibleBounds().center());if(!(Jb=sa.getWindow())){Sc.jumpTo(2);break}return Sc.yield(Jb.toggleFader(!0),4);case 4:rc=Jb.globalBounds().center();case 2:return Sc.yield(La(rc),5);case 5:return Lc=Sc.yieldResult,Jb&&Jb.toggleFader(!1),Sc.return(Lc)}})}},{key:"inform",
value:function(sa,La){La=void 0===La?{fontSize:16,requester:null,animated:!0}:La;return this.openPrompt(new Fa.InformPrompt(Object.assign({label:void 0===sa?"no message":sa},La)),La)}},{key:"prompt",value:function(sa,La){La=void 0===La?{requester:null,input:"",historyId:null,useLastInput:!1,selectInput:!1}:La;sa=new Fa.TextPrompt(Object.assign({label:sa},La));La.forceConfirm&&sa.get("cancel button").disable();return this.openPrompt(sa,La)}},{key:"editPrompt",value:function(sa,La){La=void 0===La?{requester:null,
input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null}:La;return this.openPrompt(new Fa.EditPrompt(Object.assign({label:sa},La)),La)}},{key:"passwordPrompt",value:function(sa,La){La=void 0===La?{requester:null,input:""}:La;return this.openPrompt(new Fa.PasswordPrompt(Object.assign({label:sa},La)),La)}},{key:"confirm",value:function(sa,La){La=void 0===La?{requester:null,animated:!0}:La;return this.openPrompt(new Fa.ConfirmPrompt(Object.assign({label:sa},La)),La)}},{key:"multipleChoicePrompt",
value:function(sa,La){La=void 0===La?{requester:null,animated:!0,choices:[]}:La;return this.openPrompt(new Fa.MultipleChoicePrompt(Object.assign({label:sa},La)),La)}},{key:"listPrompt",value:function(sa,La,Wa){sa=void 0===sa?"":sa;La=void 0===La?[]:La;Wa=void 0===Wa?{requester:null,onSelection:null,preselect:0}:Wa;return this.openPrompt(new Fa.ListPrompt(Object.assign({filterable:!1,padding:Fa.Rectangle.inset(3),label:sa,items:La},Wa)),Wa)}},{key:"filterableListPrompt",value:function(sa,La,Wa){sa=
void 0===sa?"":sa;La=void 0===La?[]:La;Wa=void 0===Wa?{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"}:Wa;return Wa.prompt?(sa=Wa.prompt.get("list"),sa.items=La,sa.selectedIndex=Wa.preselect||0,this.openPrompt(Wa.prompt,Wa)):this.openPrompt(new Fa.ListPrompt(Object.assign({filterable:!0,padding:Fa.Rectangle.inset(3),label:sa,items:La},Wa)),Wa)}},{key:"editListPrompt",value:function(sa,La,Wa){La=void 0===
La?[]:La;Wa=void 0===Wa?{requester:null,multiSelect:!0,historyId:null}:Wa;return this.openPrompt(new Fa.EditListPrompt(Object.assign({label:void 0===sa?"":sa,multiSelect:!0,items:La,padding:Fa.Rectangle.inset(3)},Wa)),Wa)}},{key:"showLoadingIndicatorFor",value:function(sa,La){return this.addMorph(Fa.LoadingIndicator.open(La,{center:sa.globalBounds().center()}))}},{key:"defaultMenuItems",value:function(sa,La){function Wa(Kd){var Ee=this,le=rc.morphsContainingPoint(Sc.worldPoint(Fa.pt(0,0)));le.pop();
var ge=le.indexOf(Sc);le=le.slice(ge+1);return le.map(function(jf){return[String(jf),Kd.bind(Ee,jf)]})}var Jb=this,rc=this,Lc=[],Sc=sa;this.reset&&"function"===typeof this.reset&&Lc.push(["Reset",function(){Jb.reset()}]);Lc.push(["Open in...",[["Window",function(){Sc.openInWindow()}]]]);Lc.push(["Add morph to...",{getItems:Wa.bind(Sc,function(Kd){return Kd.addMorph(Sc)})}]);Lc.push(["Get halo on...",{getItems:Wa.bind(Sc,function(Kd){return Kd.world().showHaloFor(Kd)})}]);Sc.owner&&1<Sc.owner.submorphs.length&&
Lc.push(["Arrange morph",[["Bring to front",function(){return Sc.owner.addMorph(Sc)}],["Send to back",function(){return Sc.owner.addMorphBack(Sc)}],["Fit to submorphs",function(){var Kd,Ee,le;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ge){if(1==ge.nextAddress)return ge.yield(Sc.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:Sc}),2);if(3!=ge.nextAddress)return Kd=ge.yieldResult,"string"!==typeof Kd?
ge.return():ge.yield(Fa.runEval(Kd,{topLevelVarRecorder:{Rectangle:Fa.Rectangle}}),3);Ee=ge.yieldResult;Kd=(le=Ee.value)&&le.isRectangle?le:Fa.Rectangle.inset(0);Sc.undoStart("fitToSubmorphs");Sc.fitToSubmorphs(Kd);Sc.undoStop("fitToSubmorphs");ge.jumpToEnd()})}]].concat($jscomp.arrayFromIterable(Fa.PropertyPath("master.auto").get(Sc)?[["Adjust to Master Component Submorph Hierarchy",function(){return Sc.master.reconcileSubmorphs()}]]:[]))]);this.submorphs.length&&Lc.push(["Select all submorphs",
function(){return Sc.world().showHaloFor(Sc.submorphs.slice())}]);var Rc=[];Sc.startSteppingScripts?Rc.push(["Start stepping",function(){Sc.startSteppingScripts()}]):Rc.push(["Start stepping",function(){var Kd,Ee,le,ge,jf,Sf,Ug,Mg,Xf,wf,th,gi,Ng,zf,cg,og,qh,Le,hi,vc,od,be,Hd,sf,$f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dg){switch(dg.nextAddress){case 1:return Kd=[],Ee=$jscomp,le=Ee.makeIterator,dg.yield(Fa.completions.getCompletions(function(){return Sc},""),2);case 2:ge=le.call(Ee,
dg.yieldResult.completions);for(jf=ge.next();!jf.done;jf=ge.next())for(Sf=jf.value,Ug=$jscomp.makeIterator(Sf),Mg=Ug.next().value,Xf=Ug.next().value,wf=$jscomp.makeIterator(Xf),th=wf.next();!th.done;th=wf.next())gi=th.value,gi.startsWith("_")||gi.startsWith("$")||(Ng=$jscomp.makeIterator(gi.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[]),Ng.next(),zf=Ng.next().value,cg=Ng.next().value,zf&&"function"===typeof Sc[zf]&&Kd.push({isListItem:!0,string:Mg+" "+gi,value:{selector:zf,args:cg}}));return dg.yield($world.filterableListPrompt("Select method to start",
Kd,{requester:Sc,historyId:"lively.morphic-start-stepping-chooser"}),3);case 3:return og=dg.yieldResult,qh=$jscomp.makeIterator(og.selected),(Le=qh.next().value)?dg.yield($world.prompt("Steptime in ms (how of the method will be called)?",{input:100}),4):dg.return();case 4:hi=dg.yieldResult;hi=Number(hi);if(isNaN(hi))return dg.return();vc=[hi,Le.selector];if(!Le.args){dg.jumpTo(5);break}od={targetModule:"lively://lively.morphic-stepping-args/eval.js"};return dg.yield($world.editPrompt("Arguments to pass",
{input:"["+Le.args+"]",mode:"js",evalEnvironment:od}),6);case 6:return be=dg.yieldResult,dg.yield(Fa.runEval(be,od),7);case 7:Hd=dg.yieldResult;sf=Hd.value;if($f=Hd.isError)return $world.inform("Error evaluating the arguments: "+sf),dg.return();Array.isArray(sf)&&vc.push.apply(vc,$jscomp.arrayFromIterable(sf));case 5:Sc.startStepping.apply(Sc,$jscomp.arrayFromIterable(vc)),dg.jumpToEnd()}})}]);0!=Sc.tickingScripts.length&&Rc.push(["Stop stepping",function(){return Sc.stopStepping()}]);0!=Rc.length&&
Lc.push(["Stepping",Rc]);Lc.push(["Change Tooltip",function(){var Kd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ee){if(1==Ee.nextAddress)return Kd=Sc,Ee.yield(Sc.world().prompt("Enter Tooltip",{placeholder:"Description",input:Sc.tooltip||""}),2);Kd.tooltip=Ee.yieldResult;Ee.jumpToEnd()})}]);var rd=["Morphic properties",[]];Lc.push(rd);Lc.push(["display serialization info",function(){var Kd,Ee,le;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ge){if(1==ge.nextAddress)return ge.yield(System.import("lively.serializer2/debugging.js"),
2);Kd=ge.yieldResult;Ee=Kd.SnapshotInspector;le=Fa.serialize(Sc);Ee.forSnapshot(le).openSummary();ge.jumpToEnd()})}]);Lc.push(["display object report",function(){var Kd,Ee,le;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ge){if(1==ge.nextAddress)return ge.yield(System.import("lively.serializer2/debugging.js"),2);Kd=ge.yieldResult;Ee=Kd.SnapshotInspector;le=Fa.serialize(Sc);Ee.forSnapshot(le).openObjectReport();ge.jumpToEnd()})}]);var Vd=Fa.Icon.textAttribute("check-square"),se=Fa.Icon.textAttribute("square");
Object.assign(Vd[1],{float:"none",display:"inline"});["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(Kd){return rd[1].push([[].concat($jscomp.arrayFromIterable(sa[Kd]?Vd:se),[" "+Kd,{float:"none"}]),function(){return sa[Kd]=!sa[Kd]}])});Lc.push(["export to HTML",function(){var Kd,Ee,le,ge;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jf){if(1==jf.nextAddress)return jf.yield(System.import("lively.morphic/rendering/html-generator.js"),2);if(3!=jf.nextAddress)return Kd=
jf.yieldResult,Ee=Kd.generateHTML,le=Fa.HTMLMorph,ge="exported-"+sa.name,jf.yield(Ee(sa,null,{isFragment:!0,addStyles:!1}),3);(new le({name:ge,html:jf.yieldResult})).openInWorld();jf.jumpToEnd()})}]);Lc.push({isDivider:!0});Lc.push(["Add comment",function(){var Kd,Ee,le,ge;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jf){if(1==jf.nextAddress)return jf.yield($world.prompt("Enter comment"),2);if(4!=jf.nextAddress){Kd=jf.yieldResult;if(!Kd)return $world.setStatusMessage("Comment not saved",
"red"),jf.jumpTo(0);Ee=Fa.pt(0,0);La&&!La.halo&&(le=Sc.localize(La.position).x/Sc.width,ge=Sc.localize(La.position).y/Sc.height,Ee=Fa.pt(le,ge));return jf.yield(Sc.addComment(Kd,Ee),4)}$world.setStatusMessage("Comment saved","green");jf.jumpToEnd()})}]);return Lc}},{key:"defaultConnectionMenuItems",value:function(sa){return sa.attributeConnections&&sa.attributeConnections.length?sa.attributeConnections.map(function(La){return[String(La),[["show",function(){var Wa,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==
rc.nextAddress)return rc.yield(System.import("lively.ide/fabrik.js"),2);Wa=rc.yieldResult;Jb=Wa.interactivelyShowConnection;Jb(La);rc.jumpToEnd()})}],["edit",function(){var Wa,Jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rc){if(1==rc.nextAddress)return rc.yield(System.import("lively.ide/fabrik.js"),2);Wa=rc.yieldResult;Jb=Wa.interactivelyReEvaluateConnection;Jb(La);rc.jumpToEnd()})}],["disconnect",function(){La.disconnect();$world.setStatusMessage("disconnected "+La)}]]]}):null}},
{key:"defaultSourceDataBindings",value:function(sa){var La=sa.propertiesAndPropertySettings().properties,Wa=Fa.arr.groupByKey(Object.keys(La).map(function(rc){rc=Object.assign({name:rc},La[rc]);return rc.group&&rc.group.startsWith("_")?null:rc}).filter(Boolean),"group");sa=["core","geometry","interaction","styling","layouting"];var Jb=[];sa.forEach(function(rc){return Jb.push(Wa[rc])});Fa.arr.withoutAll(Wa.keys(),sa).forEach(function(rc){return Jb.push(Wa[rc])});return Jb}},{key:"targetDataBindings",
value:function(sa){for(var La=[],Wa=sa;Wa!==Object.prototype;){var Jb=Wa===sa?String(this):Fa.getClassName(Wa),rc=null,Lc=Fa.obj.getOwnPropertyDescriptors(Wa),Sc=Object.getPrototypeOf(Wa),Rc;for(Rc in Lc){var rd=Lc[Rc].value;"function"!==typeof rd||rd===Wa.constructor||Rc.startsWith("$")||Rc.startsWith("_")||(rc||(rc=[]),rd=Fa.fun.argumentNames(rd),rc.push({group:Jb+" methods",signature:Rc+"("+rd.join(", ")+")",name:Rc}))}rc&&La.push(rc);Wa=Sc}return this.defaultSourceDataBindings(sa).concat(La)}},
{key:"defaultConnectMenuItems",value:function(sa,La){var Wa=this,Jb=this.defaultSourceDataBindings(La),rc=La.world();Jb=Jb.map(function(Lc){return[Lc[0].group||"uncategorized",Lc.map(function(Sc){return[Sc.name,sa?function(){return sa(Sc.name,La,Sc)}:function(){var Rc,rd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Vd){if(1==Vd.nextAddress)return Vd.yield(System.import("lively.ide/fabrik.js"),2);Rc=Vd.yieldResult;rd=Rc.interactiveConnectGivenSource;rd(La,Sc.name);Vd.jumpToEnd()})}]})]});
rc&&Jb.push(["custom...",sa?function(){return sa("custom...",La,null)}:function(){var Lc,Sc,Rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){if(1==rd.nextAddress)return rd.yield(System.import("lively.ide/fabrik.js"),2);if(3!=rd.nextAddress)return Lc=rd.yieldResult,Sc=Lc.interactiveConnectGivenSource,rd.yield(rc.prompt("Enter custom connection point",{requester:La,historyId:"lively.morphic-custom-connection-points",useLastInput:!0}),3);(Rc=rd.yieldResult)&&Sc(Wa,Rc);rd.jumpToEnd()})}]);
return Jb}},{key:"updateVisibleWindowMorphs",value:function(){var sa=this;ad._get(Object.getPrototypeOf(Db.prototype),"updateVisibleWindowMorphs",this).call(this);this.halos().forEach(function(La){La.maskBounds=sa.visibleBounds()})}},{key:"handleHaloCycle",value:function(sa){var La=sa.state.clickedOnMorph,Wa=sa.isCommandKey(),Jb=sa.isShiftDown(),rc;Wa&&!La.isHalo&&(Wa=rc=sa.world.morphsContainingPoint(sa.position),rc=rc.filter(function(Lc){return Lc.halosEnabled}),Wa=Wa.filter(function(Lc){return Lc.halosEnabled}),
rc=Wa[0]||rc[0]);Jb&&!La.isHaloItem&&rc&&sa.halo&&sa.halo.borderBox!=rc?sa.halo.addMorphToSelection(rc):(La=sa.halo&&!sa.targetMorphs.find(function(Lc){return Lc.isHaloItem||Lc.keepHalo&&Lc.keepHalo(sa)}),Jb=sa.layoutHalo&&!sa.targetMorphs.find(function(Lc){return Lc.isHaloItem}),Wa=(!sa.halo||La)&&rc,Jb&&sa.layoutHalo.remove(),La&&sa.halo.remove(),Wa&&(sa.stop(),this.showHaloFor(rc,sa.domEvt.pointerId)))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyWorld"}},{key:"properties",
get:function(){return{localComponents:{initialize:function(){var sa=this;this.whenRendered().then(function(){sa.localComponents?sa.localComponents.forEach(function(La){var Wa,Jb,rc,Lc,Sc,Rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(rd){switch(rd.nextAddress){case 1:if(La.owner){rd.jumpTo(0);break}Wa=La.withAllSubmorphsSelect(function(Vd){return Vd.master&&!Vd.master._appliedMaster});Jb=$jscomp.makeIterator(Wa);rc=Jb.next();case 3:if(rc.done){rd.jumpTo(5);break}Lc=rc.value;return rd.yield(Lc.master.applyIfNeeded(!0),
4);case 4:rc=Jb.next();rd.jumpTo(3);break;case 5:Sc=sa.withAllSubmorphsSelect(function(Vd){return Vd.master&&Vd.master.uses(La)}),Rc=sa.localComponents.filter(function(Vd){return Vd.master&&Vd.master.uses(La)}),Sc.forEach(function(Vd){Vd.requestMasterStyling()}),Rc.forEach(function(Vd){return Vd.master.applyIfNeeded(!0)}),rd.jumpToEnd()}})}):sa.localComponents=sa.withAllSubmorphsSelect(function(La){return La.isComponent})})}},name:{set:function(sa){this.setProperty("name",sa);document.title="lively.next - "+
sa}},hiddenComponents:{initialize:function(){this.hiddenComponents=[]}},fill:{defaultValue:Fa.Color.rgb(81,90,90)},draggable:{readOnly:!0,get:function(){return!Fa.touchInputDevice}},commentBrowser:{}}}}],fa,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1664,end:42712})}(Fa.World);Fa.LivelyWorld=
oe;Fa.LivelyWorld=oe;Fa.LivelyWorld=oe;fb=Sa("a",function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Db=fa.hasOwnProperty("SelectionElement")&&"function"===typeof fa.SelectionElement?fa.SelectionElement:fa.SelectionElement=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SelectionElement"}},{key:"properties",
get:function(){return{borderColor:{defaultValue:Fa.Color.red},borderWidth:{defaultValue:1},fill:{defaultValue:Fa.Color.transparent},epiMorph:{defaultValue:!0},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],fa,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42721,end:43083})}(Fa.Morph));
Fa.SelectionElement=fb;Fa.SelectionElement=fb;Fa.SelectionElement=fb;dc=Sa("S",function(Na){var fa=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Db=fa.hasOwnProperty("Selection")&&"function"===typeof fa.Selection?fa.Selection:fa.Selection=function(sa){sa&&sa[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ad(Db,Na,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Selection"}},{key:"properties",get:function(){return{fill:{defaultValue:Fa.Color.gray.withA(.2)},
borderWidth:{defaultValue:2},borderColor:{defaultValue:Fa.Color.gray},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],fa,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:43092,end:43412})}(Fa.Morph));Fa.Selection=dc;Fa.Selection=dc;Fa.Selection=dc;oe=Object.freeze({__proto__:null,
LivelyWorld:oe,SelectionElement:fb,Selection:dc});Sa("w",oe)}}});