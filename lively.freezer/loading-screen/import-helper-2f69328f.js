System.register("./__rootModule___commonjs-entry-71573ff5.js ./index-d18accbd.js ./index-ca98f65e.js ./service-worker-8e670339.js ./loading-indicator.cp-b18e3b89.js @babel/plugin-syntax-import-meta ./tooltips.cp-6a2406c0.js".split(" "),function(Lc){var pd,Nd,Tc,Jc,$d,Bb,rd,Id,Ac,Pc,gd,nd,Fd,ic,vd,sb;return{setters:[function(Xb){pd=Xb.j;Nd=Xb.k;Tc=Xb.b;Jc=Xb.A;$d=Xb.ap;Bb=Xb.ag;rd=Xb.i;Id=Xb._;Ac=Xb.x;Pc=Xb.G},function(){},function(Xb){gd=Xb.I;nd=Xb.G;Fd=Xb.f},function(Xb){ic=Xb.c;vd=Xb.P},function(Xb){sb=
Xb.L},function(){},function(){}],execute:function(){function Xb(Da,zb,db){db=(db||{}).recordUndo;db=void 0===db?!0:db;var ib=Da.textString,Ea=Da.editorPlugin.parse();Ea=Cb.GlobalInjector.run(ib,zb,Ea);zb=Ea.status;ib=Ea.generated;var W=Ea.from;Ea.to;Ea=Da.indexToPosition(W);if("not modified"===zb)return null;db&&Da.undoManager.group();zb=Da.insertText(ib,Ea);db&&Da.undoManager.group();return zb}function Nb(Da,zb,db){return bc.apply(this,arguments)}function bc(){bc=Id(regeneratorRuntime.mark(function Ea(zb,
db,ib){var W,T,ia,ka,K,ya,pb,La,eb,jb,E,Wb,R,xb,Ja,Ga,sa,Ub,vc,Oc,aa;return regeneratorRuntime.wrap(function(Ma){for(;;)switch(Ma.prev=Ma.next){case 0:W=Object.assign({gotoImport:!0,insertImportAtCursor:!1,recordUndo:!0,System},ib);T=W.gotoImport;ia=W.insertImportAtCursor;ka=W.recordUndo;K=W.System;if(ya=zb.pluginFind(function(qb){return qb.isJSEditorPlugin})){Ma.next=4;break}throw Error("cannot find js plugin of ".concat(zb));case 4:return pb=ya.evalEnvironment.targetModule,Ma.next=7,ya.systemInterface().getPackageForModule(pb);
case 7:La=Ma.sent,Wb=[],R=[],T&&zb.saveMark(),ka&&zb.undoManager.group(),db=db.slice();case 13:if(!db.length){Ma.next=31;break}xb=db.shift();Ja=zb.textString;Ga=Cb.ImportInjector.run(K,pb,La,Ja,xb);sa=Ga.generated;eb=Ga.from;jb=Ga.to;Ub=Ga.standaloneImport;vc=Ga.importedVarName;E=zb.indexToPosition(eb);sa&&R.push(zb.insertText(sa,E));vc&&Wb.push(vc);if(!Ub){Ma.next=29;break}Ma.prev=21;Ma.next=24;return ya.runEval(Ub);case 24:Ma.next=29;break;case 26:Ma.prev=26,Ma.t0=Ma["catch"](21),console.error("Error when trying to import ".concat(Ub,
": ").concat(Ma.t0.stack));case 29:Ma.next=13;break;case 31:return ia&&(Oc=Wb.join("\n"),aa=zb.cursorPosition,zb.getLine(aa.row).slice(0,aa.col),zb.selection.text=Oc,T||(zb.scrollCursorIntoView(),zb.focus())),ka&&zb.undoManager.group(),T&&(zb.selection=R.length?Cb.arr.last(R):{start:E,end:zb.indexToPosition(jb)},zb.scrollCursorIntoView(),zb.focus()),Ma.abrupt("return",{ranges:R});case 35:case "end":return Ma.stop()}},Ea,null,[[21,26]])}));return bc.apply(this,arguments)}function hb(Da,zb){return cb.apply(this,
arguments)}function cb(){cb=Id(regeneratorRuntime.mark(function ib(zb,db){var Ea,W;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(Ea=zb.pluginFind(function(ia){return ia.isJSEditorPlugin})){T.next=3;break}throw Error("cannot find js plugin of ".concat(zb));case 3:return T.t0=Cb,T.next=6,Ea.systemInterface();case 6:return T.t1=T.sent,T.t2={world:zb.world(),progress:db.progress,requester:db.requester},T.next=10,T.t0.interactivelyChooseImports.call(T.t0,T.t1,T.t2);
case 10:return W=T.sent,T.abrupt("return",W?Cb.injectImportsIntoText(zb,W,db):null);case 12:case "end":return T.stop()}},ib)}));return cb.apply(this,arguments)}function Hb(Da,zb){return ec.apply(this,arguments)}function ec(){ec=Id(regeneratorRuntime.mark(function ib(zb,db){var Ea,W;return regeneratorRuntime.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return db=Object.assign({System,world:$world},db),T.next=3,Cb.LoadingIndicator.runFn(function(ia){var ka=new Cb.ProgressMonitor({handlers:{searchProgress:function(K,
ya){ia.progress=ya;ia.label=K}}});return Cb.config.ide.workerEnabled?Cb.callService("exportsOfModules",{excludedPackages:Cb.config.ide.js.ignoredPackages,livelySystem:zb,progress:new Cb.ProgressMonitor({handlers:{workerProgress:function(K,ya){ia.progress=ya;ia.label=K}}})}):zb.exportsOfModules({excludedPackages:Cb.config.ide.js.ignoredPackages,progress:ka})},"computing imports...");case 3:return Ea=T.sent,T.next=6,Cb.ExportPrompt.run(db.world,Ea,db.requester);case 6:return W=T.sent,T.abrupt("return",
W.length?W:null);case 8:case "end":return T.stop()}},ib)}));return ec.apply(this,arguments)}function ub(Da,zb){zb=zb||[];Da=Cb.fuzzyParse(Da,{withComments:!0});return Cb.query.findGlobalVarRefs(Da,{jslintGlobalComment:!0}).filter(function(db){return!zb.includes(db.name)})}function yb(Da,zb){return ba.apply(this,arguments)}function ba(){ba=Id(regeneratorRuntime.mark(function ib(zb,db){var Ea,W,T,ia,ka,K,ya,pb,La,eb,jb,E,Wb,R,xb,Ja,Ga,sa,Ub,vc,Oc,aa,Ma,qb,Vb,Lb,Kb,Db,Ra,N,va;return regeneratorRuntime.wrap(function(Wa){for(;;)switch(Wa.prev=
Wa.next){case 0:return va=function(){va=Id(regeneratorRuntime.mark(function tb(){return regeneratorRuntime.wrap(function(ab){for(;;)switch(ab.prev=ab.next){case 0:return ab.t0=Cb,ab.next=3,T();case 3:return ab.t1=ab.sent,ab.t2=Wb,ab.t3=function(Ob){return!La.includes(Ob.name)},ab.abrupt("return",R=ab.t0.undeclaredVariables.call(ab.t0,ab.t1,ab.t2).filter(ab.t3));case 7:case "end":return ab.stop()}},tb)}));return va.apply(this,arguments)},N=function(){return va.apply(this,arguments)},Ea=db||{},W=Ea.sourceUpdater,
T=Ea.sourceRetriever,ia=Ea.highlightUndeclared,ka=Ea.requester,K=Ea.keepTextPosition,ya=void 0===K?!0:K,pb=Ea.ignore,La=void 0===pb?[]:pb,eb=Ea.autoApplyIfSingleChoice,jb=void 0===eb?!1:eb,E=Ea.knownGlobals,Wb=void 0===E?zb.evalEnvironment.knownGlobals||[]:E,"function"!==typeof T&&(T=function(){return zb.textString}),"function"!==typeof ia&&(ia=function(pa){var tb=pa.end;pa={start:zb.indexToPosition(pa.start),end:zb.indexToPosition(tb)};zb.selection=pa;zb.centerRange(pa)}),xb=[],Wa.next=8,N();case 8:if(R.length){Wa.next=
10;break}return Wa.abrupt("return",xb);case 10:La=La.slice();if(Ja=zb.pluginFind(function(pa){return pa.isJSEditorPlugin})){Wa.next=14;break}throw Error("cannot find js plugin of ".concat(zb));case 14:return Wa.next=16,Ja.systemInterface();case 16:return Ga=Wa.sent,Wa.next=19,Ga.exportsOfModules({excludedPackages:Cb.config.ide.js.ignoredPackages});case 19:sa=Wa.sent,zb.collapseSelection(),ya&&(Ub=zb.scroll,vc=zb.cursorPosition,Oc=zb.addAnchor(Object.assign({},vc,{id:"fix-undeclared-vars"}))),aa=!1;
case 23:return Wa.next=26,N();case 26:if(R.length){Wa.next=28;break}return Wa.abrupt("break",69);case 28:return Ma=R[0],qb=Ma.name,Vb=Cb.matchingExportsForUndeclared(Ma,sa),Lb=["ignore for now","declare as global"].concat(Vb.map(function(pa){return{isListItem:!0,value:pa,label:Cb.labelForExport(pa)}})),Kb=void 0,Wa.next=35,ia(Ma);case 35:if(!jb||1!==Vb.length){Wa.next=39;break}Kb=Vb[0];Wa.next=46;break;case 39:return Wa.next=41,$world.filterableListPrompt("Found undeclared variable ".concat(qb,".  How should it be handled?"),
Lb,{requester:ka,theme:"dark",preselect:2<Lb.length?2:0});case 41:Cb.__inter0__=Wa.sent;Db=Cb.__inter0__.selected;Ra=Ac(Db,1);if(Kb=Ra[0]){Wa.next=46;break}aa=!0;return Wa.abrupt("break",69);case 46:if(Kb!==Lb[0]){Wa.next=49;break}La.push(qb);return Wa.abrupt("continue",23);case 49:if(Kb!==Lb[1]){Wa.next=59;break}xb.push({type:"global",name:qb});if("function"!==typeof W){Wa.next=56;break}Wa.next=54;return W("global",[qb]);case 54:Wa.next=58;break;case 56:return Wa.next=58,Cb.declareVarNamesAsGlobals(zb,
[qb],{recordUndo:!0,sourceUpdater:W});case 58:return Wa.abrupt("continue",23);case 59:xb.push({type:"import",imported:Kb});if("function"!==typeof W){Wa.next=65;break}Wa.next=63;return W("import",[Kb]);case 63:Wa.next=67;break;case 65:return Wa.next=67,Cb.injectImportsIntoText(zb,[Kb],{gotoImport:!1,insertImportAtCursor:!1,recordUndo:!0});case 67:Wa.next=23;break;case 69:return ya&&(zb.scroll=Ub,zb.cursorPosition=Oc.position,zb.removeAnchor(Oc)),Wa.abrupt("return",aa?null:xb);case 71:case "end":return Wa.stop()}},
ib)}));return ba.apply(this,arguments)}function wb(Da,zb){return Xa.apply(this,arguments)}function Xa(){Xa=Id(regeneratorRuntime.mark(function ib(zb,db){var Ea,W,T,ia,ka,K,ya,pb,La;return regeneratorRuntime.wrap(function(eb){for(;;)switch(eb.prev=eb.next){case 0:return db=Object.assign({world:zb.world()},db),Ea=zb.textString,eb.next=4,Cb.chooseUnusedImports(Ea,db);case 4:if(W=eb.sent){eb.next=7;break}return eb.abrupt("return","canceled");case 7:if(W.changes&&W.changes.length){eb.next=9;break}return eb.abrupt("return",
"nothing to remove");case 9:zb.undoManager.group();T=Pc(W.changes);try{for(T.s();!(ia=T.n()).done;)ka=ia.value,K=ka.replacement,ya=ka.start,pb=ka.end,La={start:zb.indexToPosition(ya),end:zb.indexToPosition(pb)},zb.replace(La,K)}catch(jb){T.e(jb)}finally{T.f()}zb.undoManager.group();return eb.abrupt("return","imports removed");case 14:case "end":return eb.stop()}},ib)}));return Xa.apply(this,arguments)}function Za(Da,zb){return Sb.apply(this,arguments)}function Sb(){Sb=Id(regeneratorRuntime.mark(function ib(zb,
db){var Ea,W,T,ia;return regeneratorRuntime.wrap(function(ka){for(;;)switch(ka.prev=ka.next){case 0:db=Object.assign({world:$world},db);if((Ea=Cb.ImportRemover.findUnusedImports(zb))&&Ea.length){ka.next=4;break}return ka.abrupt("return",null);case 4:return W=Ea.map(function(K){var ya=K.from;return{isListItem:!0,label:["".concat(K.local),{fontWeight:"bold"}," from ",{},"".concat(ya,"\n"),{fontStyle:"italic"}],value:K}}),ka.next=7,db.world.editListPrompt("Which imports should be removed?",W,{multiSelect:!0,
requester:db.requester});case 7:T=ka.sent;if((ia=T.list)&&ia.length){ka.next=11;break}return ka.abrupt("return",[]);case 11:return ka.abrupt("return",Cb.ImportRemover.removeImports(zb,ia));case 12:case "end":return ka.stop()}},ib)}));return Sb.apply(this,arguments)}Lc({chooseUnusedImports:Za,cleanupUnusedImports:wb,declareVarNamesAsGlobals:Xb,injectImportsIntoText:Nb,interactivelyChooseImports:Hb,interactivelyInjectImportIntoText:hb,interactivlyFixUndeclaredVariables:yb,undeclaredVariables:ub});var Cb=
window.lively.FreezerRuntime.recorderFor("lively.ide/js/import-helper.js");Cb.declareVarNamesAsGlobals=Xb;Cb.injectImportsIntoText=Nb;Cb.interactivelyInjectImportIntoText=hb;Cb.interactivelyChooseImports=Hb;Cb.labelForExport=function(Da){var zb=Da.type,db=Da.exported,ib=Da.local,Ea=Da.fromModule,W=Da.pathInPackage,T=Da.packageName;Da=Da.packageVersion;db="default"===db?"".concat(ib," (default)"):db;if(Ea)var ia=" rexported from ".concat(Ea);Ea=" [".concat(T,"/").concat(W);Da&&(Ea+=" ".concat(Da));
Ea+="]";return[db,{},"".concat(zb," ").concat(ia||""," ").concat(Ea),{fontSize:"70%",lineHeight:"175%",textStyleClasses:["truncated-text","annotation"]}]};Cb.ensureFullModuleIdOfFromModule=function(Da){var zb=Da.fromModule;Da=Da.packageURL;return zb?zb.startsWith(".")?Cb.string.joinPath(Da||System.baseURL,zb):zb:null};Cb.matchingExportsForUndeclared=function(Da,zb){var db=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0,ib=zb.filter(function(W){return("default"===W.exported?W.local:W.exported)===
Da.name}),Ea=ib.filter(function(W){return W.fromModule?!0:!ib.some(function(T){return W!==T&&T.fromModule?Cb.ensureFullModuleIdOfFromModule(T)===W.moduleId:!1})});return db?Ea:Cb.arr.withoutAll(ib,Ea)};Cb.undeclaredVariables=ub;Cb.interactivlyFixUndeclaredVariables=yb;Cb.cleanupUnusedImports=wb;Cb.chooseUnusedImports=Za;Cb.arr=pd;Cb.string=Nd;Cb.pt=Tc;Cb.LoadingIndicator=sb;Cb.config=Jc;Cb.fuzzyParse=$d;Cb.query=Bb;Cb.ImportInjector=gd;Cb.GlobalInjector=nd;Cb.ImportRemover=Fd;Cb.callService=ic;Cb.ProgressMonitor=
vd;Cb.declareVarNamesAsGlobals=Xb;Cb.injectImportsIntoText=Nb;Cb.interactivelyInjectImportIntoText=hb;Cb.interactivelyChooseImports=Hb;(function(Da){var zb=window.lively.FreezerRuntime.recorderFor("lively.ide/js/import-helper.js"),db=zb.hasOwnProperty("ExportPrompt")&&"function"===typeof zb.ExportPrompt?zb.ExportPrompt:zb.ExportPrompt=function(ib){if(!ib||!ib[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return rd(db,Da,
[{key:"run",value:function(){var ib=Id(regeneratorRuntime.mark(function ia(W,T){var ka,K,ya,pb=arguments;return regeneratorRuntime.wrap(function(La){for(;;)switch(La.prev=La.next){case 0:return ka=2<pb.length&&void 0!==pb[2]?pb[2]:W,La.next=3,W.filterableListPrompt("Select import",T.map(function(eb){return{isListItem:!0,value:eb,label:Cb.labelForExport(eb)}}),{multiSelect:!0,historyId:"lively.ide/js-interactively-import",extent:Cb.pt(800,500),fuzzy:"value.exported",requester:ka,sortFunction:function(eb,
jb){jb=jb.value;var E=jb.exported;jb=jb.isMain;E=(E||"").toLowerCase();var Wb=jb?-1:0;eb.lowercasedTokens.forEach(function(R){return Wb-=E.startsWith(R)?10:E.includes(R)?5:0});return Cb.arr.sum(eb.lowercasedTokens.map(function(R){return Cb.string.levenshtein(E.toLowerCase(),R)}))+Wb}});case 3:return K=La.sent,ya=K.selected,La.abrupt("return",ya);case 6:case "end":return La.stop()}},ia)}));return function(W,T){return ib.apply(this,arguments)}}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"ExportPrompt"}},
{key:"run",value:function(ib,Ea){var W=2<arguments.length&&void 0!==arguments[2]?arguments[2]:ib;return(new this).run(ib,Ea,W)}}],zb,{pathInPackage:function(){return"./js/import-helper.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:5849,end:6989})})(void 0);Cb.undeclaredVariables=ub;Cb.interactivlyFixUndeclaredVariables=yb;Cb.cleanupUnusedImports=
wb;Cb.chooseUnusedImports=Za}}});