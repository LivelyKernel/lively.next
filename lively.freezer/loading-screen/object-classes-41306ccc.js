System.register(["./__root_module__-7487a13e.js","kld-intersections"],function(ta){var ob,ub,Tb,Jb,rd,yc,vd,zc,Ec,Mc,zd,ne,De,Xd,Qb;return{setters:[function(qc){ob=qc.a7;ub=qc.P;Tb=qc.a6;Jb=qc.p;rd=qc.bE;yc=qc.B;vd=qc.bF;zc=qc.r;Ec=qc.aU;Mc=qc.bG;zd=qc.bH;ne=qc.bI;De=qc.bJ;Xd=qc.bK;Qb=qc.l},function(){}],execute:function(){function qc(vc,ac,Eb,ec){ec=void 0===ec?{}:ec;ec=ec.package||Pb.ObjectPackage.lookupPackageForObject(vc,ec);if(!ec)throw Error("Object is not part of an object package: "+vc);
return ec.addScript(vc,ac,Eb)}function ld(vc,ac){ac=Pb.normalizeOptions(ac).System;vc=(vc=vc[Symbol.for("lively-module-meta")])?vc.package.name:null;return(ac=(vc?Pb.lookupPackage(ac,vc):{}).pkg)?!!Pb.ObjectPackage.forSystemPackage(ac):!1}ta({addScript:qc,isObjectClass:ld});var Pb=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");Pb.normalizeOptions=function(vc){vc=Object.assign({baseURL:Pb.defaultBaseURL,System:System},vc);vc.baseURL=vc.baseURL.replace(/\/$/,"");return vc};Pb.addScript=
qc;Pb.isObjectClass=ld;Pb.string=ob;Pb.Path=ub;Pb.arr=Tb;Pb.parse=Jb;Pb.isValidIdentifier=rd;Pb.stringify=yc;Pb.parseFunction=vd;Pb.resource=zc;Pb.runEval=Ec;Pb.scripting=Mc;Pb.ExportLookup=zd;var ud=Pb.scripting;Pb.ensurePackage=ud.ensurePackage;Pb.registerPackage=ud.registerPackage;Pb.importPackage=ud.importPackage;Pb.lookupPackage=ud.lookupPackage;Pb.module=ud.module;Pb.ImportInjector=ud.ImportInjector;Pb.RuntimeSourceDescriptor=ne;Pb.toJsIdentifier=De;Pb.adoptObject=Xd;Pb.classToFunctionTransform=
Qb;Pb.objectPackageSym=Symbol.for("lively-object-package-data");Pb.defaultBaseURL="local://lively-object-modules";Pb.globalClasses=Object.keys(System.global).map(function(vc){vc=System.global[vc];return"function"===typeof vc&&vc.name&&vc}).filter(Boolean);Pb.addScript=qc;Pb.addScript=qc;Pb.isObjectClass=ld;Pb.isObjectClass=ld;Pb._packageStore=Pb._packageStore||{};ud=function(vc,ac){this._id=vc;this.options=Pb.normalizeOptions(ac)};ud.lookupPackageForObject=function(vc,ac){return this.lookupPackageForClass(vc.constructor,
ac)};ud.lookupPackageForClass=function(vc,ac){ac=Pb.normalizeOptions(ac).System;vc=(vc=vc[Symbol.for("lively-module-meta")])?vc.package.name:null;return(ac=(vc?Pb.lookupPackage(ac,vc):{}).pkg)?Pb.ObjectPackage.forSystemPackage(ac):null};ud.forSystemPackage=function(vc){return this.packageStore[vc.name]};ud.withId=function(vc,ac){return this.packageStore[vc]||(this.packageStore[vc]=new this(vc,ac))};ud.prototype.ensureSubModule=function(vc){vc=void 0===vc?"index":vc;var ac=this,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){return 1==
ec.nextAddress?(Eb=new Pb.ObjectModule(vc,ac),ec.yield(Eb.ensureExistance(),2)):ec.return(Eb)})};ud.prototype.resource=function(vc){vc=void 0===vc?"":vc;return Pb.resource(this.packageURL).join(vc)};ud.prototype.load=function(){return Pb.importPackage(this.System,this.packageURL)};ud.prototype.ensureExistance=function(){var vc=this,ac,Eb,ec,wc,fd,cd,pc,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fb){switch(fb.nextAddress){case 1:return ac=vc.resource("/"),fb.yield(ac.exists(),2);
case 2:if(fb.yieldResult)return fb.return();Eb=[{resource:ac}];ec=[{resource:vc.resource("package.json"),content:JSON.stringify(vc.config,null,2)}];return fb.yield(Promise.all(Eb.map(function(ya){return ya.resource.mkdir()})),3);case 3:return fb.yield(Promise.all(ec.map(function(ya){var Ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){switch(Ba.nextAddress){case 1:return Ba.yield(ya.resource.exists(),2);case 2:if(!(Ea=!Ba.yieldResult)){Ba.jumpTo(3);break}return Ba.yield(ya.resource.write(ya.content),
4);case 4:Ea=Ba.yieldResult;case 3:return Ba.return(Ea)}})})),4);case 4:return fb.yield(vc.objectModule.ensureExistance(),5);case 5:return wc=vc,fd=wc.System,cd=wc.packageURL,pc=wc.config,fb.yield(Pb.ensurePackage(fd,cd),6);case 6:return cb=fb.yieldResult,cb.registerWithConfig(pc),console.log(vc.packageURL+" REGISTERED"),fb.return(vc)}})};ud.prototype.ensureObjectClass=function(vc){var ac=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Eb){return 1==Eb.nextAddress?Eb.yield(ac.ensureExistance(),
2):Eb.return(ac.objectModule.ensureObjectClass(vc))})};ud.prototype.adoptObject=function(vc){var ac=this,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){if(1==ec.nextAddress)return ac.objectClass===vc.constructor?ec.return():ec.yield(ac.ensureObjectClass(vc.constructor),2);Eb=ec.yieldResult;Pb.adoptObject(vc,Eb);ec.jumpToEnd()})};ud.prototype.addScript=function(vc,ac,Eb){return this.objectModule.addScript(vc,ac,Eb)};ud.prototype.remove=function(){this.systemPackage.remove();delete Pb.ObjectPackage.packageStore[this.id];
return this.resource().remove()};ud.prototype.renameObjectClass=function(vc,ac){ac=void 0===ac?[]:ac;var Eb=this,ec,wc,fd,cd,pc,cb,fb,ya,Ea,Ba,xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){if(1==Qa.nextAddress){ec=Eb;wc=ec.objectClass;fd=ec.System;if(!wc||wc[Symbol.for("__LivelyClassName__")]===vc)return Qa.return(wc);if(!Pb.isValidIdentifier(vc))throw Error(vc+" is not a valid name for a class");pc=cd=Pb.RuntimeSourceDescriptor.for(wc,fd);cb=pc.source;fb=pc.ast;ya=fb.id;Ea=ya.start;
Ba=ya.end;return Qa.yield(cd.changeSource(cb.slice(0,Ea)+vc+cb.slice(Ba)),2)}xa=Eb.objectClass;ac.forEach(function(wb){wb.constructor=xa;wb.__proto__=xa.prototype});return Qa.return(xa)})};ud.prototype.fork=function(vc,ac){var Eb=this,ec,wc,fd,cd,pc,cb,fb,ya,Ea,Ba,xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){switch(Qa.nextAddress){case 1:return ec=Eb,wc=ec.System,fd=ec.baseURL,cd=ec.objectClass,ac=Object.assign({System:wc,baseURL:fd},ac),pc=Pb.RuntimeSourceDescriptor.for(cd),
cb=pc._renamedSource(vc),fb=cb.moduleSource,ya=Pb.ObjectPackage.withId(vc,ac),Qa.yield(ya.ensureExistance(),2);case 2:return Ea=ya,Ba=Ea.objectModule,xa=Ba.systemModule,Qa.yield(xa.load({format:"esm"}),3);case 3:return Qa.yield(xa.changeSource(fb),4);case 4:return Qa.return(ya)}})};$jscomp.global.Object.defineProperties(ud.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,
get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return Pb.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,
get:function(){return this._objectModule||(this._objectModule=new Pb.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(ud,{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=Pb._packageStore)}}});ta("default",ud);Pb.ObjectPackage=ud;var Ed=function(vc,ac){if(!vc)throw Error("ObjectModule needs package!");if(!ac)throw Error("ObjectModule needs package!");
this._moduleName=vc;this._objectPackage=ac};Ed.prototype.read=function(){return this.resource.read()};Ed.prototype.write=function(vc){return this.resource.write(vc)};Ed.prototype.ensureExistance=function(){var vc=this,ac,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){switch(ec.nextAddress){case 1:return ac=vc.resource,ec.yield(ac.exists(),2);case 2:if(ec.yieldResult){ec.jumpTo(3);break}return ec.yield(ac.write("'format esm';\n"),4);case 4:Eb={},vc.System.config({meta:(Eb[vc.url]=
{format:"esm"},Eb)});case 3:return ec.return(vc)}})};Ed.prototype.adoptObject=function(vc){var ac=this,Eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){if(1==ec.nextAddress)return ac.objectClass===vc.constructor?ec.return():ec.yield(ac.ensureObjectClass(vc.constructor),2);Eb=ec.yieldResult;Pb.adoptObject(vc,Eb);ec.jumpToEnd()})};Ed.prototype.ensureObjectClass=function(vc){var ac=this,Eb=this.objectClass;return Eb&&Eb.prototype.__proto__===vc.prototype?Eb:Promise.resolve(this.ensureObjectClassSource(vc)).then(function(ec){var wc=
ec.source,fd=ec.moduleId,cd=ec.className,pc=ec.bindings,cb=ac.System;ec=Pb.module(cb,fd);if(pc)for(var fb in pc)ec.define(fb,pc[fb]);wc=Pb.runEval(wc,{classTransform:Pb.classToFunctionTransform,sync:!0,targetModule:fd,System:cb});if(wc.isError)throw wc.value;wc=ec.recorder[cd];if(!wc)throw Error("Failed to define class "+cd+" in "+fd);return wc})};Ed.prototype.ensureObjectClassSource=function(vc){return this.createDefaultClassDeclaration(vc)};Ed.prototype.createDefaultClassDeclaration=function(vc){vc=
void 0===vc?Object:vc;var ac=this,Eb,ec,wc,fd,cd,pc,cb,fb,ya,Ea,Ba,xa,Qa,wb,fc,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ib){switch(ib.nextAddress){case 1:Eb=ac;ec=Eb.System;wc=Eb.systemModule;fd=Eb.objectPackage;cd=Pb.string.capitalize(Pb.toJsIdentifier(fd.id));pc=vc[Symbol.for("__LivelyClassName__")];cb=!pc;fb=Pb.globalClasses.includes(vc);ya="";Ea=null;if(cb){pc="__anonymous_superclass__";Ba={};Ea=(Ba[pc]=vc,Ba);ib.jumpTo(2);break}if(fb){ib.jumpTo(2);break}return ib.yield(Pb.ExportLookup.findExportOfValue(vc,
ec),4);case 4:(xa=ib.yieldResult)?(Qa=Pb.ImportInjector.run(ec,wc.id,wc.package(),"",xa),wb=Qa.standaloneImport,ya+=wb+"\n\n"):(fc={},Ea=(fc[pc]=vc,fc));case 2:return cd===pc&&(cd="Object"+cd),$a="Object"===pc?"class "+cd+" {}\n":"class "+cd+" extends "+pc+" {}\n",ya+="export default "+$a+"\n",ib.yield(wc.changeSource(ya),5);case 5:return ib.yield(wc.load(),6);case 6:return ib.return({source:ya,className:cd,moduleId:ac.url,bindings:Ea})}})};Ed.prototype.addScript=function(vc,ac,Eb){var ec=this,wc,
fd,cd,pc,cb,fb,ya,Ea,Ba,xa,Qa,wb,fc,$a,ib;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){switch(ab.nextAddress){case 1:if(vc.constructor===ec.objectClass){wc=vc.constructor;ab.jumpTo(2);break}return ab.yield(ec.ensureObjectClass(vc.constructor),3);case 3:wc=ab.yieldResult;case 2:fd=wc;cd="function"===typeof ac?String(ac):ac;pc=Pb.parseFunction(cd);cb=Pb.RuntimeSourceDescriptor.for(fd,ec.System);Eb||(Eb=Pb.Path("id.name").get(pc));if(!Eb)throw Error("No name, cannot add "+Pb.string.truncate(cd,
30).replace(/\n/g,"")+"!");fb=Pb.toJsIdentifier(Eb);console.assert("FunctionExpression"===pc.type||"ArrowFunctionExpression"===pc.type,"not a function expression but: "+pc.type);ya=pc.params.map(function(U){return cd.slice(U.start,U.end)});Ea="BlockStatement"===pc.body.type?cd.slice(pc.body.start,pc.body.end):"{ return "+cd.slice(pc.body.start,pc.body.end)+" }";Ba=fb+"("+ya.join(",")+") "+Ea;"ArrowFunctionExpression"===pc.type&&(pc.type="FunctionExpression");xa=cb.source;Qa=cb.ast;if(!Qa)throw Error("cannot find class decl of "+
cb.module.id);(wb=Qa.body.body.find(function(U){return U.key.name===fb&&!U.static}))?xa=xa.slice(0,wb.start)+Ba+xa.slice(wb.end):(fc=xa.lastIndexOf("}"),$a=xa.slice(0,fc),ib=xa.slice(fc),/\n\s*$/m.test($a)||($a+="\n"),Ba=Pb.string.changeIndent(Ba,"  ",1),/^[ ]*\n/m.test(ib)||(ib="\n"+ib),xa=$a+Ba+ib);return ab.yield(cb.changeSource(xa),4);case 4:return ab.return({script:fd.prototype[fb],klass:fd,module:cb.module.id,methodName:fb})}})};$jscomp.global.Object.defineProperties(Ed.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var vc=this.systemModule;return vc.isLoaded()?vc.System.get(vc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return Pb.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});Pb.ObjectModule=Ed;Pb.default=ud}}});