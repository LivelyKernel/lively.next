System.register(["./__root_module__-be0d56fe.js"],function(Pa){var Lb,Vb,Dc,jc,qd,id,Cd,bd,Wc,Zc,zd,me,te,Je;return{setters:[function(jd){Lb=jd.aY;Vb=jd.a;Dc=jd.r;jc=jd.Y;qd=jd.p;id=jd.X;Cd=jd.bt;bd=jd.aX;Wc=jd.i;Zc=jd.s;zd=jd.bu;me=jd.bv;te=jd.J;Je=jd.bw}],execute:function(){function jd(bc){try{var Qa=eval("("+ec.ast.transform.wrapInFunction("var _; _ = ("+bc+")")+")()")}catch(Da){return JSON.parse(bc)}return"object"!==typeof Qa?null:Qa}function Zd(bc,Qa){var Da,ja,Ba,Ja,Fb,wa,Ka,Rb,eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sc){switch(Sc.nextAddress){case 1:return Da=
Qa.world(),Sc.yield(Da.prompt("Enter package name",{requester:Qa,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:ja=Sc.yieldResult;if(!ja)throw"Canceled";Sc.setCatchFinallyBlocks(3);Ja=Bc.resource(ja);ja=Ja.name();Ba=Ja.url;Sc.leaveTryBlock(4);break;case 3:return Sc.enterCatchBlock(),Sc.yield(bc.getConfig(),5);case 5:return Fb=Sc.yieldResult.baseURL,wa=Bc.resource(Fb).join(ja).asDirectory().url,Sc.yield(bc.normalize(wa),6);case 6:Ba=Sc.yieldResult.replace(/\/\.js$/,
"/");case 4:return Sc.yield(Da.prompt("Confirm or change package location",{requester:Qa,input:Ba,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Ka=Sc.yieldResult;if(!Ka)throw"Canceled";Rb=Bc.resource(Ka).asDirectory();eb=Rb.asFile().url;return Sc.yield(bc.removePackage(eb),8);case 8:return Sc.yield(bc.resourceCreateFiles(eb,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+ja+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+ja+"\n\nNo description for package "+
ja+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+ja+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Sc.return(Bc.loadPackage(bc,{name:ja,address:eb,configFile:Rb.join("package.json").url,main:Rb.join("index.js").url,test:Rb.join("tests/test.js").url,type:"package"}))}})}function gc(bc,Qa,Da){Da=void 0===Da?null:Da;var ja,Ba,Ja,Fb,wa,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return ja=
{name:"",address:"",type:"package"},eb.yield(bc.getConfig(),2);case 2:Ba=eb.yieldResult;if(!Da){eb.jumpTo(3);break}return eb.yield(bc.getPackage(Da),4);case 4:if(Ja=eb.yieldResult){eb.jumpTo(5);break}return eb.yield(bc.getPackageForModule(Da),6);case 6:Ja=eb.yieldResult;case 5:Fb=Ja;case 3:return eb.yield(Qa.world().prompt("What is the package directory?",{requester:Qa,input:Fb?Fb.address:Ba.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:wa=eb.yieldResult;if(!wa)throw"Canceled";
ja.address=wa.replace(/\/$/,"");ja.url=new Bc.URL(ja.address+"/");ja.configFile=Bc.resource(ja.url).join("package.json").url;eb.setCatchFinallyBlocks(8);Ka=JSON;Rb=Ka.parse;return eb.yield(bc.moduleRead(ja.configFile),10);case 10:Rb.call(Ka,eb.yieldResult).name;eb.leaveTryBlock(9);break;case 8:eb.enterCatchBlock(),ja.name=String(ja.url).replace(/\/$/,""),bc.resourceEnsureExistance(ja.configFile,'{\n  "name": "'+ja.name+'",\n  "version": "0.1.0"\n}');case 9:return eb.return(Bc.loadPackage(bc,ja))}})}
function $c(bc,Qa,Da){var ja,Ba,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return ja=Bc.resource(Da).asFile().url,Fb.yield(bc.getPackage(ja),2);case 2:if(Ba=Fb.yieldResult){Fb.jumpTo(3);break}return Fb.yield(bc.getPackageForModule(ja),4);case 4:Ba=Fb.yieldResult;case 3:Ja=Ba;if(!Ja)throw Error("Cannot find package for "+ja);return Fb.yield(bc.reloadPackage(ja),5);case 5:if(!Qa){Fb.jumpTo(0);break}return Fb.yield(Qa.updateModuleList(),7);case 7:return Fb.yield(Qa.uiSelect(ja,
!1),8);case 8:return Fb.return(Fb.yieldResult)}})}function Bd(bc,Qa,Da,ja){var Ba,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return Fb.yield(bc.getPackage(Da),2);case 2:return Ba=Fb.yieldResult,Fb.yield((ja||$world).confirm("Unload package "+Ba.name+"?",{requester:Qa}),3);case 3:Ja=Fb.yieldResult;if(!Ja)throw"Canceled";return Fb.yield(bc.removePackage(Da),4);case 4:if(!Qa){Fb.jumpTo(0);break}return Fb.yield(Qa.updateModuleList(),6);case 6:return Fb.yield(Qa.uiSelect(null),
0)}})}function fd(bc,Qa,Da){var ja,Ba,Ja,Fb,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){switch(Ka.nextAddress){case 1:return ja=Qa.world(),Ka.yield(bc.getPackage(Da),2);case 2:return Ba=Ka.yieldResult,Ba?Ka.yield(ja.confirm("Really remove package "+Ba.name+"?",{requester:Qa}),3):($world.inform('No package "'+Da+'" found!',{requester:Qa}),Ka.return());case 3:Ja=Ka.yieldResult;if(!Ja)throw"Canceled";bc.removePackage(Da);return Ka.yield(ja.confirm("Also remove directory "+Ba.name+
" including "+Ba.modules.length+" modules?"),4);case 4:Fb=Ka.yieldResult;if(!Fb){Ka.jumpTo(0);break}return Ka.yield(ja.confirm("REALLY *remove* directory "+Ba.name+"? No undo possible..."),6);case 6:if(wa=Ka.yieldResult)return Ka.yield(bc.resourceRemove(Ba.address),0);Ka.jumpTo(0)}})}function Jd(bc,Qa,Da){Da=void 0===Da?$world:Da;var ja,Ba,Ja,Fb,wa,Ka,Rb,eb,Sc,Ob,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Uc){switch(Uc.nextAddress){case 1:return Uc.yield(bc.getPackage(Qa),2);case 2:ja=
Uc.yieldResult;if(!ja)throw Error("Cannot find package "+Qa);Ba=[];Ja=$jscomp.makeIterator(ja.modules);Fb=Ja.next();case 3:if(Fb.done)return Uc.yield(Da.execCommand("open text window",{title:"imports and exports of "+Qa,content:Ba.join("\n\n")}),0);wa=Fb.value;if(!wa.name.match(/\.js$/)){Uc.jumpTo(4);break}Uc.setCatchFinallyBlocks(6);Ka=bc;Rb=Ka.importsAndExportsOf;eb=wa.name;return Uc.yield(bc.moduleRead(wa.name),9);case 9:return Uc.yield(Rb.call(Ka,eb,Uc.yieldResult),8);case 8:Sc=Uc.yieldResult;
Uc.leaveTryBlock(7);break;case 6:Ob=Uc.enterCatchBlock();Da.logError(Error("Error when getting imports/exports from module "+wa.name+":\n"+Ob.stack));Uc.jumpTo(4);break;case 7:pd=""+wa.name;if(!Sc.imports.length&&!Sc.exports.length){pd+="\n  does not import / export anything";Uc.jumpTo(4);break}Sc.imports.length&&(pd+="\n  imports:\n",pd+=Bc.arr.groupByKey(Sc.imports,"fromModule").mapGroups(function(Kc,Hb){return"from "+Kc+": "+Hb.map(function($d){return $d.local||$d.imported?$d.imported&&$d.imported!==
$d.local?$d.imported+" as "+$d.local:$d.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(Kc){return"    "+Kc}).join("\n"));Sc.exports.length&&(pd+="\n  exports:\n",pd+=Sc.exports.map(function(Kc){return Kc.local?Kc.local&&Kc.local!==Kc.exported?Kc.local+" as "+Kc.exported:Kc.exported:Kc.exported+" from "+Kc.fromModule}).join(", ").split("\n").map(function(Kc){return"    "+Kc}).join("\n"));Ba.push(pd);case 4:Fb=Ja.next(),Uc.jumpTo(3)}})}function fe(bc){return bc.match(/import.*['"]mocha(-es6)?['"]/)&&
bc.match(/it\(['"]/)}function Zb(bc,Qa,Da){Da=Da&&Da.address;if(Da&&0===Qa.indexOf(Da))var ja=Qa.slice(Da.length).replace(/^\//,"");else a:{Da=bc.getConfig();if(!Da||Da.constructor!==Promise)try{ja=String((new Ua.URL(Qa)).relativePathFrom(new Ua.URL(bc.getConfig().baseURL)));break a}catch(Ba){}ja=Qa}return ja}function Gc(bc,Qa,Da,ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return 1==Ba.nextAddress?(ja=Object.assign({targetModule:Qa},ja),Ba.yield(bc.normalize(Qa),2)):3!=Ba.nextAddress?
(Qa=Ba.yieldResult,Ba.yield(bc.moduleSourceChange(Qa,Da,ja),3)):Ba.return(Qa)})}function xd(bc,Qa,Da,ja,Ba){ja=void 0===ja?!1:ja;Ba=void 0===Ba?!1:Ba;var Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return Qa&&Qa.setStatusMessage("Reloading "+Da),Fb.setCatchFinallyBlocks(2),Fb.yield(bc.reloadModule(Da,{reloadDeps:ja,resetEnv:Ba}),4);case 4:if(!Qa){Fb.jumpTo(5);break}return Fb.yield(Qa.updateModuleList(),6);case 6:case 5:Qa&&Qa.setStatusMessage("Reloded "+
Da);Fb.leaveTryBlock(0);break;case 2:Ja=Fb.enterCatchBlock();Fb.setCatchFinallyBlocks(7);if(!Qa){Fb.jumpTo(9);break}return Fb.yield(Qa.updateEditorWithSourceOf(Da),10);case 10:case 9:Fb.leaveTryBlock(8);break;case 7:Fb.enterCatchBlock();case 8:throw Qa&&Qa.showError(Ja),Ja;}})}function Ic(bc,Qa,Da){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){switch(ja.nextAddress){case 1:return ja.yield(bc.forgetModule(Da,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Qa){ja.jumpTo(3);break}return ja.yield(Qa.updateModuleList(),
4);case 4:case 3:ja.jumpToEnd()}})}function Ad(bc,Qa,Da){var ja,Ba,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){switch(Fb.nextAddress){case 1:return Fb.yield(bc.normalize(Da),2);case 2:return ja=Fb.yieldResult,Fb.yield(Qa.world().confirm(["Really remove file:\n",{},ja,{fontStyle:"italic",fontWeight:"bold"}," ?",{}],{requester:Qa,lineWrapping:!1}),3);case 3:Ba=Fb.yieldResult;if(!Ba)throw"Canceled";return Fb.yield(bc.forgetModule(ja),4);case 4:return Fb.yield(bc.resourceRemove(ja),
5);case 5:return Fb.yield(bc.getPackageForModule(ja),6);case 6:return Ja=Fb.yieldResult,Fb.return(Ja)}})}function Mb(bc,Qa){var Da,ja,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){if(1==Ja.nextAddress)return Ja.yield(Ua._createAndLoadModules(bc,[Qa]),2);Da=Ja.yieldResult;ja=Ua.arr.compact(Da.map(function(Fb){return Fb.error}));Ba=!!ja.length;return Ja.return(Ba)})}function mb(bc,Qa,Da){var ja,Ba,Ja,Fb,wa,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return ja=
Ua.URL,eb.yield(bc.getConfig(),2);case 2:Ba=new ja(eb.yieldResult.baseURL);Ja=Qa.world();if(!Da){eb.jumpTo(3);break}return eb.yield(bc.getPackage(Da),4);case 4:if(Fb=eb.yieldResult){eb.jumpTo(5);break}return eb.yield(bc.getPackageForModule(Da),6);case 6:Fb=eb.yieldResult;case 5:(wa=Fb)&&(Ba=new Ua.URL(wa.address));case 3:return eb.yield(Ua._searchForExistingFiles(Qa,String(Ba),wa),7);case 7:Ka=eb.yieldResult;if(!Ka.includes("[create new module]")){eb.jumpTo(8);break}return eb.yield(Ua._askForModuleName(bc,
Da||String(Ba),Ja),9);case 9:Rb=eb.yieldResult,Ka=[Rb];case 8:return eb.yield(Ua._createAndLoadModules(bc,Ka),10);case 10:return eb.return(eb.yieldResult)}})}function Ac(bc,Qa){var Da,ja,Ba,Ja,Fb,wa,Ka,Rb,eb,Sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ob){if(1==Ob.nextAddress)return Ob.yield(bc.getPackage(Qa),2);if(3!=Ob.nextAddress){Da=Ob.yieldResult;if(!Da||!Da.address.match(/^http/))throw Error("Cannot load package "+Qa);ja=Ua.resource(Da.address);Ba=[];Ja=$jscomp;Fb=Ja.makeIterator;
return Ob.yield(ja.dirList(5,{exclude:Ua.modulesInPackage_defaultExclude}),3)}wa=Fb.call(Ja,Ob.yieldResult);for(Ka=wa.next();!Ka.done;Ka=wa.next())eb=Rb=Ka.value,Sc=eb.url,Sc.match(/\.js$/)&&bc.isModuleLoaded(Sc,!0)&&Ba.push(bc.getModule(Sc));return Ob.return(Ba)})}function vc(bc){bc||(bc="local");if(bc.isSystemInterface)var Qa=bc;else"string"===typeof bc&&bc.startsWith("l2l ")&&(bc={type:"l2l",id:bc.split(" ")[1]}),"string"!==typeof bc&&"l2l"===bc.type&&(Qa=xc.l2lInterfaceFor(bc.id,bc.info)),"string"!==
typeof bc&&($world.setStatusMessage("Unknown system interface "+bc),bc="local"),Qa||(Qa=bc&&"local"!==bc?xc.serverInterfaceFor(bc):xc.localInterface);return Qa}Pa("systemInterfaceNamed",vc);var ec=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");ec.parseJsonLikeObj=jd;ec.ast=Lb;ec.parseJsonLikeObj=jd;ec.parseJsonLikeObj=jd;var Bc=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Bc.loadPackage=function(bc,Qa){var Da,ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){switch(Ba.nextAddress){case 1:return Ba.yield(bc.importPackage(Qa.address+
"/"),2);case 2:if(!Qa.main){Ba.jumpTo(3);break}return Ba.yield(bc.importModule(Qa.main.toString()),3);case 3:if(!Qa.test){Ba.jumpTo(5);break}Ba.setCatchFinallyBlocks(6);return Ba.yield(bc.importPackage("mocha-es6"),8);case 8:return Da=Ba.yieldResult,Ba.yield(Da.installSystemInstantiateHook(),9);case 9:return Ba.yield(bc.importModule(Qa.test.toString()),10);case 10:Ba.leaveTryBlock(5);break;case 6:ja=Ba.enterCatchBlock(),console.warn("Cannot load test of new package: "+ja);case 5:return Ba.return(bc.getPackage(Qa.address))}})};
Bc.interactivelyCreatePackage=Zd;Bc.interactivelyLoadPackage=gc;Bc.interactivelyReloadPackage=$c;Bc.interactivelyUnloadPackage=Bd;Bc.interactivelyRemovePackage=fd;Bc.showExportsAndImportsOf=Jd;Bc.parseJsonLikeObj=jd;Bc.arr=Vb;Bc.resource=Dc;Bc.interactivelyCreatePackage=Zd;Bc.interactivelyCreatePackage=Zd;Bc.interactivelyLoadPackage=gc;Bc.interactivelyLoadPackage=gc;Bc.interactivelyReloadPackage=$c;Bc.interactivelyReloadPackage=$c;Bc.interactivelyUnloadPackage=Bd;Bc.interactivelyUnloadPackage=Bd;
Bc.interactivelyRemovePackage=fd;Bc.interactivelyRemovePackage=fd;Bc.showExportsAndImportsOf=Jd;Bc.showExportsAndImportsOf=Jd;var Ua=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");Ua.isTestModule=fe;Ua.shortModuleName=Zb;Ua.interactivelyChangeModule=Gc;Ua.interactivelyReloadModule=xd;Ua.interactivelyUnloadModule=Ic;Ua.interactivelyRemoveModule=Ad;Ua.addModule=Mb;Ua.interactivelyAddModule=mb;Ua._askForModuleName=function(bc,Qa,Da){var ja,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(Da.prompt("Enter module name",
{input:Qa,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Qa=Ja.yieldResult;if(!Qa)throw"Canceled";return Ja.yield(bc.normalize(Qa),3);case 3:return ja=Ja.yieldResult,Ja.yield(Da.confirm(["Create module \n",{},ja,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Ba=Ja.yieldResult;if(!Ba)throw"Canceled";return Ja.return(ja)}})};Ua._searchForExistingFiles=function(bc,Qa,Da){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){return String(Qa).match(/^http/)?ja.return(Ua._searchForExistingFilesWeb(bc,
Qa,Da)):ja.return(Ua._searchForExistingFilesManually(bc,Qa,Da))})};Ua._searchForExistingFilesManually=function(bc,Qa,Da){var ja,Ba;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(bc.world().multipleChoicePrompt("Add Module",{requester:bc,choices:["Create New Module","Load Existing Module"]}),2);case 2:ja=Ja.yieldResult;if("Create New Module"===ja)return Ja.return("[create new module]");if("Load Existing Module"!==ja){Ja.jumpTo(3);break}return Ja.yield(bc.world().prompt("URL of module?",
{input:Qa,requester:bc,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),4);case 4:if(Ba=Ja.yieldResult)return Ja.return([Ba]);case 3:throw"Canceled";}})};Ua._searchForExistingFilesWeb=function(bc,Qa,Da){function ja(eb){eb.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(eb.name())||Da&&Ua.arr.pluck(Da.modules,"name").includes(eb.url)?!0:!1}var Ba,Ja,Fb,wa,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return(Ba=
bc.world())&&(Ja=Ba.showLoadingIndicatorFor(bc,"Loading existing modules...")),eb.yield(Ua.resource(Qa).dirList(5,{exclude:ja}),3);case 3:return eb.yield(eb.yieldResult.map(function(Sc){return Sc.url}),2);case 2:return Fb=eb.yieldResult,wa=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Fb.filter(function(Sc){return Sc.endsWith(".js")}).map(function(Sc){return{isListItem:!0,string:Da&&0==Sc.indexOf(Da.address)?Da.name+Sc.slice(Da.address.length):Sc,value:Sc}})),eb.yield(Promise.resolve(Ja&&
Ja.remove()).then(function(){return bc.world().filterableListPrompt("What module to load?",wa,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:bc},bc?{extent:bc.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Ka=eb.yieldResult;if(!Ka||"canceled"===Ka.status||!Ka.selected.length)throw"Canceled";Rb=Ka.selected||Ka;Array.isArray(Rb)||(Rb=[Rb]);return eb.return(Rb)}})};Ua._createAndLoadModules=function(bc,Qa){var Da,ja,Ba,Ja,Fb,wa,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:Array.isArray(Qa)||
(Qa=[Qa]),Da=[],ja=$jscomp.makeIterator(Qa),Ba=ja.next();case 2:if(Ba.done){eb.jumpTo(4);break}Ja=Ba.value;return eb.yield(bc.forgetModule(Ja,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return eb.yield(bc.resourceEnsureExistance(Ja,'"format esm";\n'),6);case 6:return Fb=eb.yieldResult,wa=Ua,Ka=wa.isTestModule,eb.yield(Fb.read(),7);case 7:if(!Ka.call(wa,eb.yieldResult)){eb.jumpTo(8);break}if(System.global.Mocha&&System.global.chai){eb.jumpTo(8);break}return eb.yield(System.import("mocha-es6"),10);case 10:return eb.yield(Ua.promise.waitFor(function(){return!!System.global.Mocha&&
!!System.global.chai}),8);case 8:return eb.setCatchFinallyBlocks(12),eb.yield(bc.importModule(Ja),14);case 14:Da.push({name:Ja});eb.leaveTryBlock(3);break;case 12:Rb=eb.enterCatchBlock(),Da.push({name:Ja,error:Rb});case 3:Ba=ja.next();eb.jumpTo(2);break;case 4:return eb.return(Da)}})};Ua.modulesInPackage_defaultExclude=function(bc){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(bc.name())?!0:!1};Ua.modulesInPackage=Ac;Ua.obj=jc;Ua.promise=qd;Ua.arr=Vb;Ua.resource=
Dc;Ua.isTestModule=fe;Ua.isTestModule=fe;Ua.shortModuleName=Zb;Ua.shortModuleName=Zb;Ua.interactivelyChangeModule=Gc;Ua.interactivelyChangeModule=Gc;Ua.interactivelyReloadModule=xd;Ua.interactivelyReloadModule=xd;Ua.interactivelyUnloadModule=Ic;Ua.interactivelyUnloadModule=Ic;Ua.interactivelyRemoveModule=Ad;Ua.interactivelyRemoveModule=Ad;Ua.addModule=Mb;Ua.addModule=Mb;Ua.interactivelyAddModule=mb;Ua.interactivelyAddModule=mb;Ua.modulesInPackage=Ac;Ua.modulesInPackage=Ac;var hc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
hc.todo=function(bc){throw Error(bc+" is not yet implemented!");};hc.parseJsonLikeObj=jd;hc.arr=Vb;hc.Closure=id;hc.obj=jc;hc.resource=Dc;hc.transform=Cd;hc.modules=bd;var Eb=function(bc){var Qa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),Da=Qa.hasOwnProperty("AbstractCoreInterface")&&"function"===typeof Qa.AbstractCoreInterface?Qa.AbstractCoreInterface:Qa.AbstractCoreInterface=function(ja){ja&&ja[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Wc(Da,bc,[{key:"dynamicCompletionsForPrefix",value:function(ja,Ba,Ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){hc.todo("dynamicCompletionsForPrefix");Fb.jumpToEnd()})}},{key:"runEval",value:function(ja,Ba){hc.todo("runEval")}},{key:"resourceExists",value:function(ja){hc.todo("resourceExists")}},{key:"resourceEnsureExistance",value:function(ja,Ba){hc.todo("resourceEnsureExistance")}},{key:"resourceMkdir",value:function(ja){hc.todo("resourceMkdir")}},{key:"resourceRead",
value:function(ja){hc.todo("resourceRead")}},{key:"resourceRemove",value:function(ja){hc.todo("resourceRemove")}},{key:"resourceWrite",value:function(ja,Ba){hc.todo("resourceWrite")}},{key:"resourceCreateFiles",value:function(ja,Ba){hc.todo("resourceCreateFiles")}},{key:"resourceDirList",value:function(ja,Ba,Ja){hc.todo("resourceDirList")}},{key:"normalizeSync",value:function(ja,Ba,Ja){hc.todo("normalizeSync")}},{key:"normalize",value:function(ja,Ba,Ja){hc.todo("normalize")}},{key:"printSystemConfig",
value:function(){hc.todo("printSystemConfig")}},{key:"getConfig",value:function(){hc.todo("getConfig")}},{key:"setConfig",value:function(ja){hc.todo("setConfig")}},{key:"getPackages",value:function(ja){hc.todo("getPackages")}},{key:"isModuleLoaded",value:function(ja,Ba){hc.todo("isModuleLoaded")}},{key:"doesModuleExist",value:function(ja,Ba){hc.todo("doesModuleExist")}},{key:"getModules",value:function(){var ja=this,Ba,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return 1==Fb.nextAddress?
(Ba=hc.arr,Ja=Ba.flatmap,Fb.yield(ja.getPackages(),2)):Fb.return(Ja.call(Ba,Fb.yieldResult,function(wa){return wa.modules}))})}},{key:"getModule",value:function(ja){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return 1==Ja.nextAddress?Ja.yield(Ba.getModules(),2):Ja.return(Ja.yieldResult.find(function(Fb){return Fb.name===ja}))})}},{key:"getPackage",value:function(ja){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return 1==Ja.nextAddress?
(ja=ja.replace(/\/+$/,""),Ja.yield(Ba.getPackages(),2)):Ja.return(Ja.yieldResult.find(function(Fb){return Fb.address===ja||Fb.name===ja}))})}},{key:"getPackageForModule",value:function(ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("getPackageForModule");Ba.jumpToEnd()})}},{key:"systemConfChange",value:function(ja){var Ba=hc.parseJsonLikeObj(ja);["baseURL"].forEach(function(Ja){return delete Ba[Ja]});return this.setConfig(Ba)}},{key:"resourcesOfPackage",value:function(ja,
Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){hc.todo("resourcesOfPackage");Ja.jumpToEnd()})}},{key:"registerPackage",value:function(ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("registerPackage");Ba.jumpToEnd()})}},{key:"importPackage",value:function(ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("importPackage");Ba.jumpToEnd()})}},{key:"removePackage",value:function(ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("removePackage");
Ba.jumpToEnd()})}},{key:"reloadPackage",value:function(ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){hc.todo("reloadPackage");Ba.jumpToEnd()})}},{key:"packageConfChange",value:function(ja,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){hc.todo("packageConfChange");Ja.jumpToEnd()})}},{key:"importModule",value:function(ja){hc.todo("importModule")}},{key:"forgetModule",value:function(ja,Ba){hc.todo("forgetModule")}},{key:"reloadModule",value:function(ja,Ba){hc.todo("reloadModule")}},
{key:"moduleFormat",value:function(ja){hc.todo("moduleFormat")}},{key:"moduleRead",value:function(ja){hc.todo("moduleRead")}},{key:"moduleSourceChange",value:function(ja,Ba,Ja){hc.todo("moduleSourceChange")}},{key:"importsAndExportsOf",value:function(ja,Ba){hc.todo("importsAndExportsOf")}},{key:"keyValueListOfVariablesInModule",value:function(ja,Ba){hc.todo("keyValueListOfVariablesInModule")}},{key:"moduleWrite",value:function(ja,Ba){return this.moduleSourceChange(ja,Ba)}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"AbstractCoreInterface"}}],Qa,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:327,end:3944})}(void 0);hc.AbstractCoreInterface=Eb;hc.AbstractCoreInterface=Eb;hc.AbstractCoreInterface=Eb;var qc=function(bc){var Qa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),
Da=Qa.hasOwnProperty("RemoteCoreInterface")&&"function"===typeof Qa.RemoteCoreInterface?Qa.RemoteCoreInterface:Qa.RemoteCoreInterface=function(ja){ja&&ja[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Wc(Da,bc,[{key:Symbol.for("lively-instance-initialize"),value:function(){Wc._get(Object.getPrototypeOf(Da.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null}},{key:"runEval",value:function(ja,
Ba){throw Error("Not yet implemented");}},{key:"runEvalAndStringify",value:function(ja,Ba){var Ja=this;return this.currentEval?this.currentEval.then(function(){return Ja.runEvalAndStringify(ja,Ba)}):this.currentEval=Promise.resolve().then(function(){var Fb,wa,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return eb.yield(Ja.runEval("\n        Promise.resolve((async "+hc.transform.wrapInFunction(ja)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},Ba)),2);case 2:if((Fb=eb.yieldResult)&&Fb.isError)throw Error(String(Fb.value||Fb.error));if(!Fb||!Fb.value)return eb.return(null);if(wa=Fb.promisedValue){eb.jumpTo(3);break}return eb.yield(Fb.value,4);case 4:wa=eb.yieldResult;case 3:Ka=wa;if(!Ka)return eb.return();if("undefined"===Ka)return eb.return(void 0);if("null"===Ka)return eb.return(null);if("true"===Ka)return eb.return(!0);
if("false"===Ka)return eb.return(!1);try{Rb=JSON.parse(Ka)}catch(Sc){return eb.return(Ka)}if(Rb&&Rb.isError)throw Error(String(Rb.value));return eb.return(Rb)}})}).then(function(Fb){delete Ja.currentEval;return Fb},function(Fb){delete Ja.currentEval;return Promise.reject(Fb)})}},{key:"dynamicCompletionsForPrefix",value:function(ja,Ba,Ja){var Fb=this,wa,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){wa=hc.obj.isString(Ja.context)?Ja.context:!1;Ja=hc.obj.dissoc(Ja,["systemInterface",
"System","context"]);Ka="\n      var prefix = "+JSON.stringify(Ba)+",\n          opts = "+JSON.stringify(Ja)+";\n      opts.context = "+wa+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Rb.return(Fb.runEvalAndStringify(Ka))})}},{key:"evalWithResource",value:function(ja,Ba,Ja){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+ja+'").'+Ba+"("+(Ja?JSON.stringify(Ja):"")+");\n    ")}},{key:"resourceExists",value:function(ja){return this.evalWithResource(ja,"exists")}},{key:"resourceEnsureExistance",value:function(ja,Ba){return this.evalWithResource(ja,
"ensureExistance",Ba)}},{key:"resourceMkdir",value:function(ja){return this.evalWithResource(ja,"mkdir")}},{key:"resourceRead",value:function(ja){return this.evalWithResource(ja,"read")}},{key:"resourceRemove",value:function(ja){return this.evalWithResource(ja,"remove")}},{key:"resourceWrite",value:function(ja,Ba){return this.evalWithResource(ja,"write",Ba)}},{key:"resourceCreateFiles",value:function(ja,Ba){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
ja+'", '+JSON.stringify(Ba)+")")}},{key:"resourceDirList",value:function(ja,Ba,Ja){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+ja+'").dirList('+JSON.stringify(Ba)+", "+JSON.stringify(Ja)+"))\n        .map(({url}) => ({url}))")}},{key:"livelySystemAccessor",value:function(ja){ja=void 0===ja?"livelySystem":ja;return"var "+ja+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
ja+') throw new Error("lively-system-interface not available!");'}},{key:"normalizeSync",value:function(ja,Ba,Ja){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(ja)+", "+JSON.stringify(Ba)+", "+Ja+")")}},{key:"normalize",value:function(ja,Ba,Ja){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(ja)+", "+JSON.stringify(Ba)+", "+JSON.stringify(Ja)+")")}},{key:"printSystemConfig",value:function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")}},
{key:"getConfig",value:function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')}},{key:"setConfig",value:function(ja){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(ja)+")")}},{key:"getPackages",value:function(ja){ja=Object.assign({excluded:[]},ja);ja.excluded=ja.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(ja)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')}},{key:"getPackageForModule",value:function(ja){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(ja)+")")}},{key:"isModuleLoaded",value:function(ja,Ba){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+ja+'", '+Ba+")")}},{key:"doesModuleExist",value:function(ja,Ba){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+ja+'", '+Ba+")")}},{key:"registerPackage",value:function(ja){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Ba.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(ja)+")"))})}},
{key:"importPackage",value:function(ja){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Ba.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(ja)+")"))})}},{key:"removePackage",value:function(ja){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Ba.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(ja)+")"))})}},{key:"reloadPackage",value:function(ja,Ba){var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return Fb.return(Ja.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(ja)+", "+JSON.stringify(Ba)+")"))})}},{key:"packageConfChange",value:function(ja,Ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(ja)+", "+JSON.stringify(Ba)+")")}},{key:"resourcesOfPackage",value:function(ja,Ba){Ba=void 0===Ba?[".git","node_modules",".module_cache","lively.next-node_modules"]:Ba;var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){ja.address&&
(ja=ja.address);return Fb.return(Ja.runEvalAndStringify("\n      "+Ja.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(ja)+", "+JSON.stringify(Ba)+");"))})}},{key:"getModule",value:function(ja){var Ba=this,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){if(1==Fb.nextAddress)return Fb.yield(Ba.getModules(),2);Ja=Fb.yieldResult.find(function(wa){return wa.name===ja});return Fb.return(Ja?hc.modules.module(Ja.name):null)})}},{key:"importModule",
value:function(ja){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(ja)+")")}},{key:"forgetModule",value:function(ja,Ba){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ja)+").unload("+JSON.stringify(Ba)+")")}},{key:"reloadModule",value:function(ja,Ba){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ja)+").reload("+JSON.stringify(Ba)+")")}},{key:"moduleFormat",value:function(ja){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(ja)+").format();")}},{key:"moduleRead",value:function(ja){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ja)+").source()")}},{key:"moduleSourceChange",value:function(ja,Ba,Ja){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ja)+").changeSource("+JSON.stringify(Ba)+", "+JSON.stringify(Ja)+")")}},{key:"keyValueListOfVariablesInModule",value:function(ja,Ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(ja)+", "+JSON.stringify(Ba)+")")}},{key:"importsAndExportsOf",value:function(ja,Ba){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(ja)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(ja)+").exports()})")}},{key:"exportsOfModules",value:function(ja){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(ja)+";\n      options.excludedPackages = ["+ja.excludedPackages.map(function(Ba){return"function"===
typeof Ba?Ba.toString():JSON.stringify(Ba)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")}},{key:"searchInPackage",value:function(ja,Ba,Ja){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(ja)+", "+JSON.stringify(Ba)+", "+JSON.stringify(Ja)+")")}},{key:"loadMochaTestFile",value:function(ja,Ba){Ba=void 0===Ba?[]:Ba;var Ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return Fb.return(Ja.runEvalAndStringify("\n      "+
Ja.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(ja)+", "+JSON.stringify(Ba)+"), result;\n      result = {testsByFile}"))})}},{key:"runMochaTests",value:function(ja,Ba,Ja,Fb){var wa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){ja&&ja instanceof RegExp&&(ja={isRegExp:!0,value:String(ja).replace(/^\/|\/$/g,"")});return Ka.return(wa.runEvalAndStringify("\n      var grep = "+JSON.stringify(ja)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
wa.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(Ba||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RemoteCoreInterface"}}],Qa,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:3953,end:16249})}(hc.AbstractCoreInterface);hc.RemoteCoreInterface=qc;hc.RemoteCoreInterface=qc;hc.RemoteCoreInterface=qc;var Cc=
lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");Cc.obj=jc;Cc.string=Zc;Cc.arr=Vb;Cc.resource=Dc;Cc.createFiles=zd;Cc.ast=Lb;Cc.modules=bd;Cc.vm=me;Cc.parseJsonLikeObj=jd;Cc.AbstractCoreInterface=Eb;Cc.classToFunctionTransform=te;Eb=function(bc){var Qa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js"),Da=Qa.hasOwnProperty("LocalCoreInterface")&&"function"===typeof Qa.LocalCoreInterface?Qa.LocalCoreInterface:Qa.LocalCoreInterface=
function(ja){ja&&ja[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Wc(Da,bc,[{key:"name",get:function(){return"local"}},{key:"dynamicCompletionsForPrefix",value:function(ja,Ba,Ja){var Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wa){if(1==wa.nextAddress)return wa.yield(Cc.vm.completions.getCompletions(function(Ka){return Cc.vm.runEval(Ka.replace("return ",""),Object.assign({targetModule:ja,classTransform:Cc.classToFunctionTransform},
Ja))},Ba),2);Fb=wa.yieldResult;if(Fb.isError)throw Fb.value;return wa.return({completions:Fb.completions,prefix:Fb.startLetters})})}},{key:"runEval",value:function(ja,Ba){return Cc.vm.runEval(ja,Object.assign({classTransform:Cc.classToFunctionTransform},Ba))}},{key:"resourceExists",value:function(ja){return Cc.resource(ja).exists()}},{key:"resourceEnsureExistance",value:function(ja,Ba){return Cc.resource(ja).ensureExistance(Ba)}},{key:"resourceMkdir",value:function(ja){return Cc.resource(ja).mkdir()}},
{key:"resourceRead",value:function(ja){return Cc.resource(ja).read()}},{key:"resourceRemove",value:function(ja){return Cc.resource(ja).remove()}},{key:"resourceWrite",value:function(ja,Ba){return Cc.resource(ja).write(Ba)}},{key:"resourceCreateFiles",value:function(ja,Ba){return Cc.createFiles(ja,Ba)}},{key:"resourceDirList",value:function(ja,Ba,Ja){return Cc.resource(ja).dirList(Ba,Ja)}},{key:"normalizeSync",value:function(ja,Ba,Ja){return System.decanonicalize(ja,Ba,Ja)}},{key:"normalize",value:function(ja,
Ba,Ja){return System.normalize(ja,Ba,Ja)}},{key:"printSystemConfig",value:function(){return Cc.modules.printSystemConfig()}},{key:"getConfig",value:function(){return System.getConfig()}},{key:"setConfig",value:function(ja){Cc.modules.System.config(ja)}},{key:"getPackages",value:function(ja){ja=Object.assign({},ja);ja=void 0===ja.excluded?[]:ja.excluded;var Ba=ja.filter(function(Fb){return"string"===typeof Fb}),Ja=ja.filter(function(Fb){return"function"===typeof Fb});Ba=Ba.concat(Ba.map(function(Fb){return System.decanonicalize(Fb.replace(/\/?$/,
"/")).replace(/\/$/,"")}));return Cc.modules.getPackages().filter(function(Fb){return!Ba.includes(Fb.url)&&!Ja.some(function(wa){return wa(Fb.url)})})}},{key:"registerPackage",value:function(ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(Cc.modules.registerPackage(ja))})}},{key:"importPackage",value:function(ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(Cc.modules.importPackage(ja))})}},{key:"removePackage",value:function(ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(Cc.modules.removePackage(ja))})}},
{key:"reloadPackage",value:function(ja,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){return Ja.return(Cc.modules.reloadPackage(ja,Ba))})}},{key:"packageConfChange",value:function(ja,Ba){var Ja=this,Fb,wa,Ka,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){if(1==eb.nextAddress)return Fb=Cc.modules.System,wa=Cc.parseJsonLikeObj(ja),Ka=JSON.stringify(wa,null,2),eb.yield(Cc.modules.module(Ba).changeSource(Ka,{doEval:!1}),2);if(3!=eb.nextAddress)return Fb.set(Ba,
Fb.newModule(wa)),eb.yield(Ja.getPackageForModule(Ba),3);(Rb=eb.yieldResult)&&Cc.modules.applyPackageConfig(wa,Rb.address);eb.jumpToEnd()})}},{key:"resourcesOfPackage",value:function(ja,Ba){Ba=void 0===Ba?[".git","node_modules",".module_cache"]:Ba;var Ja,Fb,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){if(1==Ka.nextAddress)return Ka.setCatchFinallyBlocks(2),Ja=ja.address?ja.address:ja,Fb=Cc.modules.getPackage(Ja),Ka.yield(Fb.resources(void 0,Ba),4);if(2!=Ka.nextAddress)return Ka.return(Ka.yieldResult.map(function(Rb){return Object.assign(Rb,
{package:Rb.package.url})}));wa=Ka.enterCatchBlock();console.warn("resourcesOfPackage error for "+ja+": "+wa);return Ka.return([])})}},{key:"getPackageForModule",value:function(ja){return(ja=Cc.modules.getPackageOfModule(ja))?ja.asSpec():ja}},{key:"isModuleLoaded",value:function(ja,Ba){return Cc.modules.isModuleLoaded(ja,Ba)}},{key:"doesModuleExist",value:function(ja,Ba){return Cc.modules.isModuleLoaded(ja,Ba)}},{key:"getModule",value:function(ja){return Cc.modules.module(ja)}},{key:"importModule",
value:function(ja){return Cc.modules.System.import(ja)}},{key:"forgetModule",value:function(ja,Ba){return Cc.modules.module(ja).unload(Ba)}},{key:"reloadModule",value:function(ja,Ba){return Cc.modules.module(ja).reload(Ba)}},{key:"moduleFormat",value:function(ja){return Cc.modules.module(ja).format()}},{key:"moduleRead",value:function(ja){return Cc.modules.module(ja).source()}},{key:"moduleSourceChange",value:function(ja,Ba,Ja){return Cc.modules.module(ja).changeSource(Ba,Ja)}},{key:"keyValueListOfVariablesInModule",
value:function(ja,Ba){var Ja=this,Fb,wa,Ka,Rb,eb,Sc,Ob,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Uc){switch(Uc.nextAddress){case 1:if(Ba){Uc.jumpTo(2);break}return Uc.yield(Ja.resourceRead(ja),3);case 3:Ba=Uc.yieldResult;case 2:return Fb="string"===typeof Ba?Cc.ast.parse(Ba):Ba,wa=Ja.normalizeSync(ja),Ja.moduleFormat(wa),Ka=Cc.modules.module(wa).env().recorder,Uc.yield(Ja.importsAndExportsOf(wa,Fb),4);case 4:return Rb=Uc.yieldResult,eb=Cc.ast.query.topLevelDeclsAndRefs(Fb),Sc=
Cc.arr.sortByKey(Cc.ast.query.declarationsOfScope(eb.scope,!0),"start"),Ob=Cc.arr.pluck(eb.scope.importSpecifiers,"name"),pd=0,Uc.return(Sc.map(function(Kc){var Hb=Kc.name.length,$d=Rb.exports.find(function(Gb){return Gb.local===Kc.name}),Tb=Cc.arr.include(Ob,Kc.name);$d&&(Hb+=9);Tb&&(Hb+=9);pd=Math.max(pd,Hb);return{isExport:$d,isImport:Tb,name:Kc.name,value:Ka[Kc.name],node:Kc,printedName:Kc.name+($d?" [export]":"")+(Tb?" [import]":""),printedValue:Cc.obj.inspect(Ka[Kc.name],{maxDepth:1}).replace(/\n/g,
"")}}).map(function(Kc){return{isListItem:!0,value:Kc,string:Kc.printedName+Cc.string.indent(" = "+Kc.printedValue," ",pd-Kc.printedName.length)}}))}})}},{key:"importsAndExportsOf",value:function(ja,Ba){var Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){return 1==Fb.nextAddress?Fb.yield(Cc.modules.module(ja).imports(Ba),2):3!=Fb.nextAddress?(Ja=Fb.yieldResult,Fb.yield(Cc.modules.module(ja).exports(Ba),3)):Fb.return({imports:Ja,exports:Fb.yieldResult})})}},{key:"exportsOfModules",
value:function(ja){return Cc.modules.ExportLookup.run(System,ja)}},{key:"searchInPackage",value:function(ja,Ba,Ja){return Cc.modules.getPackage(ja).search(Ba,Ja)}},{key:"runMochaTests",value:function(ja,Ba,Ja,Fb){var wa,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){if(1==Rb.nextAddress)return Rb.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);wa=Rb.yieldResult;Ka=wa.runMochaTests;return Rb.return(Ka(ja,Ba,Ja,Fb))})}},{key:"loadMochaTestFile",value:function(ja,
Ba){var Ja,Fb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wa){if(1==wa.nextAddress)return wa.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Ja=wa.yieldResult;Fb=Ja.loadMochaTestFile;return wa.return(Fb(ja,Ba))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LocalCoreInterface"}}],Qa,{pathInPackage:function(){return"interfaces/local-system.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:411,end:8203})}(Cc.AbstractCoreInterface);Cc.LocalCoreInterface=Eb;Cc.LocalCoreInterface=Eb;Cc.LocalCoreInterface=Eb;var Yc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");Yc.evalStrategies=Je;Yc.RemoteCoreInterface=qc;var rd=function(bc){var Qa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js"),Da=Qa.hasOwnProperty("HTTPCoreInterface")&&
"function"===typeof Qa.HTTPCoreInterface?Qa.HTTPCoreInterface:Qa.HTTPCoreInterface=function(ja){ja&&ja[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Wc(Da,bc,[{key:Symbol.for("lively-instance-initialize"),value:function(ja){Wc._get(Object.getPrototypeOf(Da.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null;this.url=ja;this.server=new Yc.evalStrategies.HttpEvalStrategy(ja)}},{key:"name",
get:function(){return this.url}},{key:"description",get:function(){return this.url.replace(/^https?:\/\//,"")}},{key:"runEval",value:function(ja,Ba){return this.server.runEval(ja,Ba)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"HTTPCoreInterface"}}],Qa,{pathInPackage:function(){return"interfaces/http-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",
version:"0.2.1"}}},{start:106,end:512})}(Yc.RemoteCoreInterface);Yc.HTTPCoreInterface=rd;Yc.HTTPCoreInterface=rd;Yc.HTTPCoreInterface=rd;var fc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");fc.evalStrategies=Je;fc.RemoteCoreInterface=qc;qc=function(bc){var Qa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js"),Da=Qa.hasOwnProperty("L2LCoreInterface")&&"function"===typeof Qa.L2LCoreInterface?Qa.L2LCoreInterface:Qa.L2LCoreInterface=
function(ja){ja&&ja[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Wc(Da,bc,[{key:Symbol.for("lively-instance-initialize"),value:function(ja,Ba){Wc._get(Object.getPrototypeOf(Da.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.targetId=ja;this.peer=Ba}},{key:"name",get:function(){return"l2l "+this.targetId}},{key:"description",get:function(){var ja=this.peer,Ba="l2l "+this.targetId.slice(0,5);if(ja){var Ja=
ja.location,Fb=ja.type,wa=ja.user;ja=ja.world;Fb&&(Ba+=", "+Fb);Ja&&(Ba+=", "+Ja.replace(/^https?:\/\//,"")+(ja?"/"+ja:""));wa&&(Ba+=", "+wa.name)}return Ba}},{key:"client",get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}},{key:"isConnected",value:function(){var ja=this,Ba,Ja,Fb,wa,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){if(1==Rb.nextAddress)return Ba=ja,Ja=Ba.client,Fb=Ba.targetId,Rb.yield(Ja.sendToAndWait(Ja.trackerId,
"getClients",{}),2);wa=Rb.yieldResult;Ka=wa.data;return Rb.return(Ka.some(function(eb){eb=$jscomp.makeIterator(eb).next().value;return Fb===eb}))})}},{key:"runEval",value:function(ja,Ba){var Ja=this,Fb,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){Fb=Ja.client;if(!Fb)throw Error("No lively.2lively default client available!");wa=new fc.evalStrategies.L2LEvalStrategy(Fb,Ja.targetId);return Ka.return(wa.runEval(ja,Ba))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"L2LCoreInterface"}}],
Qa,{pathInPackage:function(){return"interfaces/l2l-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:1449})}(fc.RemoteCoreInterface);fc.L2LCoreInterface=qc;fc.L2LCoreInterface=qc;fc.L2LCoreInterface=qc;var xc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");xc.systemInterfaceNamed=
vc;xc.interactivelyCreatePackage=Zd;xc.interactivelyLoadPackage=gc;xc.interactivelyReloadPackage=$c;xc.interactivelyUnloadPackage=Bd;xc.interactivelyRemovePackage=fd;xc.showExportsAndImportsOf=Jd;xc.shortModuleName=Zb;xc.addModule=Mb;xc.interactivelyChangeModule=Gc;xc.interactivelyReloadModule=xd;xc.interactivelyUnloadModule=Ic;xc.interactivelyRemoveModule=Ad;xc.interactivelyAddModule=mb;xc.modulesInPackage=Ac;xc.LocalCoreInterface=Eb;xc.HTTPCoreInterface=rd;xc.L2LCoreInterface=qc;qc=Pa("Interface",
function(bc){var Qa=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js"),Da=Qa.hasOwnProperty("Interface")&&"function"===typeof Qa.Interface?Qa.Interface:Qa.Interface=function(ja){ja&&ja[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Wc(Da,bc,[{key:Symbol.for("lively-instance-initialize"),value:function(ja){this.coreInterface=ja}},{key:"isSystemInterface",get:function(){return!0}},{key:"name",get:function(){return this.coreInterface.name}},
{key:"dynamicCompletionsForPrefix",value:function(ja,Ba,Ja){return this.coreInterface.dynamicCompletionsForPrefix(ja,Ba,Ja)}},{key:"runEval",value:function(ja,Ba){return this.coreInterface.runEval(ja,Ba)}},{key:"printSystemConfig",value:function(ja,Ba,Ja){return this.coreInterface.printSystemConfig(ja,Ba,Ja)}},{key:"getConfig",value:function(ja,Ba,Ja){return this.coreInterface.getConfig(ja,Ba,Ja)}},{key:"getPackages",value:function(ja){return this.coreInterface.getPackages(ja)}},{key:"getModules",
value:function(ja,Ba,Ja){return this.coreInterface.getModules(ja,Ba,Ja)}},{key:"getModule",value:function(ja,Ba,Ja){return this.coreInterface.getModule(ja,Ba,Ja)}},{key:"getPackage",value:function(ja,Ba,Ja){return this.coreInterface.getPackage(ja,Ba,Ja)}},{key:"getPackageForModule",value:function(ja,Ba,Ja){return this.coreInterface.getPackageForModule(ja,Ba,Ja)}},{key:"resourcesOfPackage",value:function(ja,Ba){return this.coreInterface.resourcesOfPackage(ja,Ba)}},{key:"systemConfChange",value:function(ja,
Ba,Ja){return this.coreInterface.systemConfChange(ja,Ba,Ja)}},{key:"registerPackage",value:function(ja){return this.coreInterface.registerPackage(ja)}},{key:"importPackage",value:function(ja){return this.coreInterface.importPackage(ja)}},{key:"removePackage",value:function(ja){return this.coreInterface.removePackage(ja)}},{key:"reloadPackage",value:function(ja){return this.coreInterface.reloadPackage(ja)}},{key:"packageConfChange",value:function(ja,Ba){return this.coreInterface.packageConfChange(ja,
Ba)}},{key:"keyValueListOfVariablesInModule",value:function(ja,Ba){return this.coreInterface.keyValueListOfVariablesInModule(ja,Ba)}},{key:"interactivelyCreatePackage",value:function(ja){return xc.interactivelyCreatePackage(this.coreInterface,ja)}},{key:"interactivelyLoadPackage",value:function(ja,Ba){return xc.interactivelyLoadPackage(this.coreInterface,ja,Ba)}},{key:"interactivelyReloadPackage",value:function(ja,Ba){return xc.interactivelyReloadPackage(this.coreInterface,ja,Ba)}},{key:"interactivelyUnloadPackage",
value:function(ja,Ba,Ja){return xc.interactivelyUnloadPackage(this.coreInterface,ja,Ba,Ja)}},{key:"interactivelyRemovePackage",value:function(ja,Ba){return xc.interactivelyRemovePackage(this.coreInterface,ja,Ba)}},{key:"isModuleLoaded",value:function(ja,Ba){return this.coreInterface.isModuleLoaded(ja,Ba)}},{key:"doesModuleExist",value:function(ja,Ba){return this.coreInterface.doesModuleExist(ja,Ba)}},{key:"createModule",value:function(ja){return xc.addModule(this.coreInterface,ja)}},{key:"importModule",
value:function(ja){return this.coreInterface.importModule(ja)}},{key:"forgetModule",value:function(ja,Ba){return this.coreInterface.forgetModule(ja,Ba)}},{key:"reloadModule",value:function(ja,Ba){return this.coreInterface.reloadModule(ja,Ba)}},{key:"moduleFormat",value:function(ja){return this.coreInterface.moduleFormat(ja)}},{key:"moduleRead",value:function(ja){return this.coreInterface.moduleRead(ja)}},{key:"moduleWrite",value:function(ja,Ba){return this.coreInterface.moduleWrite(ja,Ba)}},{key:"getModulesInPackage",
value:function(ja){return xc.modulesInPackage(this.coreInterface,ja)}},{key:"shortModuleName",value:function(ja,Ba){return xc.shortModuleName(this.coreInterface,ja,Ba)}},{key:"interactivelyChangeModule",value:function(ja,Ba,Ja){return xc.interactivelyChangeModule(this.coreInterface,ja,Ba,Ja)}},{key:"interactivelyReloadModule",value:function(ja,Ba){return xc.interactivelyReloadModule(this.coreInterface,ja,Ba)}},{key:"interactivelyUnloadModule",value:function(ja,Ba){return xc.interactivelyUnloadModule(this.coreInterface,
ja,Ba)}},{key:"interactivelyRemoveModule",value:function(ja,Ba){return xc.interactivelyRemoveModule(this.coreInterface,ja,Ba)}},{key:"interactivelyAddModule",value:function(ja,Ba){return xc.interactivelyAddModule(this.coreInterface,ja,Ba)}},{key:"showExportsAndImportsOf",value:function(ja,Ba){return xc.showExportsAndImportsOf(this.coreInterface,ja,Ba)}},{key:"exportsOfModules",value:function(ja){return this.coreInterface.exportsOfModules(ja)}},{key:"searchInPackage",value:function(ja,Ba,Ja){return this.coreInterface.searchInPackage(ja,
Ba,Ja)}},{key:"searchInAllPackages",value:function(ja,Ba){Ba=void 0===Ba?{}:Ba;var Ja=this,Fb,wa,Ka,Rb,eb,Sc,Ob,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Uc){switch(Uc.nextAddress){case 1:return(Fb=Ba.progress)&&Fb.step("Fetching Packages...",0),Uc.yield(Ja.coreInterface.getPackages({excluded:Ba.excludedPackages}),2);case 2:wa=Uc.yieldResult,Ka=[],Fb&&Fb.step("Fetching Packages...",.1),Rb=0;case 3:if(!(Rb<wa.length)){Uc.jumpTo(5);break}eb=wa[Rb];Sc=eb.url;if(!Sc||"no group"===
Sc){Uc.jumpTo(4);break}Fb&&Fb.step(Sc.replace(System.baseURL,"").slice(0,20),.1+Rb/wa.length*.9);Uc.setCatchFinallyBlocks(6);return Uc.yield(Ja.coreInterface.searchInPackage(Sc,ja,Ba),8);case 8:Ob=Uc.yieldResult;Ka=Ka.concat(Ob);Uc.leaveTryBlock(4);break;case 6:pd=Uc.enterCatchBlock(),console.error("Error searching in package "+Sc+":\n"+pd.stack);case 4:Rb++;Uc.jumpTo(3);break;case 5:return Uc.return(Ka)}})}},{key:"loadMochaTestFile",value:function(ja,Ba){return this.coreInterface.loadMochaTestFile(ja,
Ba)}},{key:"runMochaTests",value:function(ja,Ba,Ja,Fb){return this.coreInterface.runMochaTests(ja,Ba,Ja,Fb)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Interface"}}],Qa,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:679,end:6188})}(void 0));xc.Interface=qc;xc.Interface=
qc;xc.Interface=qc;xc.systemInterfaceNamed=vc;xc.systemInterfaceNamed=vc;qc=Pa("localInterface",new xc.Interface(new xc.LocalCoreInterface));xc.localInterface=qc;xc.localInterface=qc;xc.localInterface=qc;xc.httpInterfaces={};qc=Pa("serverInterfaceFor",function(bc){return xc.httpInterfaces[bc]||(xc.httpInterfaces[bc]=new xc.Interface(new xc.HTTPCoreInterface(bc)))});xc.serverInterfaceFor=qc;xc.serverInterfaceFor=qc;xc.serverInterfaceFor=qc;xc.l2lInterfaces={};qc=Pa("l2lInterfaceFor",function(bc,Qa){return xc.l2lInterfaces[bc]||
(xc.l2lInterfaces[bc]=new xc.Interface(new xc.L2LCoreInterface(bc,Qa)))});xc.l2lInterfaceFor=qc;xc.l2lInterfaceFor=qc;xc.l2lInterfaceFor=qc}}});