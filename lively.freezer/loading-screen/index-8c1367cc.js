System.register(["./__root_module__-39b2be6e.js","lively.collab","kld-intersections"],function(wa){var bb,ib,Qb,Ib,ed,qc,pd,uc,Ac,dd,Ad,le,Le;return{setters:[function(ae){bb=ae.bo;ib=ae.a6;Qb=ae.r;Ib=ae.a8;ed=ae.$;qc=ae.bp;pd=ae.bq;uc=ae.T;Ac=ae.a7;dd=ae.br;Ad=ae.bs;le=ae.l;Le=ae.bt},function(){},function(){}],execute:function(){function ae(U){try{var Ba=eval("("+jb.ast.transform.wrapInFunction("var _; _ = ("+U+")")+")()")}catch(K){return JSON.parse(U)}return"object"!==typeof Ba?null:Ba}function lc(U,
Ba){var K,V,ra,Ja,hb,dc,na,oa,wb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:return K=Ba.world(),fc.yield(K.prompt("Enter package name",{requester:Ba,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:V=fc.yieldResult;if(!V)throw"Canceled";fc.setCatchFinallyBlocks(3);Ja=Fa.resource(V);V=Ja.name();ra=Ja.url;fc.leaveTryBlock(4);break;case 3:return fc.enterCatchBlock(),fc.yield(U.getConfig(),5);case 5:return hb=fc.yieldResult.baseURL,
dc=Fa.resource(hb).join(V).asDirectory().url,fc.yield(U.normalize(dc),6);case 6:ra=fc.yieldResult.replace(/\/\.js$/,"/");case 4:return fc.yield(K.prompt("Confirm or change package location",{requester:Ba,input:ra,historyId:"lively.vm-editor-add-package-address"}),7);case 7:na=fc.yieldResult;if(!na)throw"Canceled";oa=Fa.resource(na).asDirectory();wb=oa.asFile().url;return fc.yield(U.removePackage(wb),8);case 8:return fc.yield(U.resourceCreateFiles(wb,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
V+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+V+"\n\nNo description for package "+V+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+V+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return fc.return(Fa.loadPackage(U,{name:V,address:wb,configFile:oa.join("package.json").url,main:oa.join("index.js").url,test:oa.join("tests/test.js").url,type:"package"}))}})}function Wc(U,Ba,K){K=void 0===K?null:K;
var V,ra,Ja,hb,dc,na,oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:return V={name:"",address:"",type:"package"},wb.yield(U.getConfig(),2);case 2:ra=wb.yieldResult;if(!K){wb.jumpTo(3);break}return wb.yield(U.getPackage(K),4);case 4:if(Ja=wb.yieldResult){wb.jumpTo(5);break}return wb.yield(U.getPackageForModule(K),6);case 6:Ja=wb.yieldResult;case 5:hb=Ja;case 3:return wb.yield(Ba.world().prompt("What is the package directory?",{requester:Ba,input:hb?
hb.address:ra.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:dc=wb.yieldResult;if(!dc)throw"Canceled";V.address=dc.replace(/\/$/,"");V.url=new URL(V.address+"/");V.configFile=Fa.resource(V.url).join("package.json").url;wb.setCatchFinallyBlocks(8);na=JSON;oa=na.parse;return wb.yield(U.moduleRead(V.configFile),10);case 10:oa.call(na,wb.yieldResult).name;wb.leaveTryBlock(9);break;case 8:wb.enterCatchBlock(),V.name=String(V.url).replace(/\/$/,""),U.resourceEnsureExistance(V.configFile,
'{\n  "name": "'+V.name+'",\n  "version": "0.1.0"\n}');case 9:return wb.return(Fa.loadPackage(U,V))}})}function Ed(U,Ba,K){var V,ra,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){switch(hb.nextAddress){case 1:return V=Fa.resource(K).asFile().url,hb.yield(U.getPackage(V),2);case 2:if(ra=hb.yieldResult){hb.jumpTo(3);break}return hb.yield(U.getPackageForModule(V),4);case 4:ra=hb.yieldResult;case 3:Ja=ra;if(!Ja)throw Error("Cannot find package for "+V);return hb.yield(U.reloadPackage(V),
5);case 5:if(!Ba){hb.jumpTo(0);break}return hb.yield(Ba.updateModuleList(),7);case 7:return hb.yield(Ba.uiSelect(V,!1),8);case 8:return hb.return(hb.yieldResult)}})}function Tb(U,Ba,K,V){var ra,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){switch(hb.nextAddress){case 1:return hb.yield(U.getPackage(K),2);case 2:return ra=hb.yieldResult,hb.yield((V||$world).confirm("Unload package "+ra.name+"?",{requester:Ba}),3);case 3:Ja=hb.yieldResult;if(!Ja)throw"Canceled";return hb.yield(U.removePackage(K),
4);case 4:if(!Ba){hb.jumpTo(0);break}return hb.yield(Ba.updateModuleList(),6);case 6:return hb.yield(Ba.uiSelect(null),0)}})}function Bd(U,Ba,K){var V,ra,Ja,hb,dc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){switch(na.nextAddress){case 1:return V=Ba.world(),na.yield(U.getPackage(K),2);case 2:return ra=na.yieldResult,ra?na.yield(V.confirm("Really remove package "+ra.name+"?",{requester:Ba}),3):($world.inform('No package "'+K+'" found!',{requester:Ba}),na.return());case 3:Ja=na.yieldResult;
if(!Ja)throw"Canceled";U.removePackage(K);return na.yield(V.confirm("Also remove directory "+ra.name+" including "+ra.modules.length+" modules?"),4);case 4:hb=na.yieldResult;if(!hb){na.jumpTo(0);break}return na.yield(V.confirm("REALLY *remove* directory "+ra.name+"? No undo possible..."),6);case 6:if(dc=na.yieldResult)return na.yield(U.resourceRemove(ra.address),0);na.jumpTo(0)}})}function Sd(U,Ba,K){K=void 0===K?$world:K;var V,ra,Ja,hb,dc,na,oa,wb,fc,Qa,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ld){switch(ld.nextAddress){case 1:return ld.yield(U.getPackage(Ba),
2);case 2:V=ld.yieldResult;if(!V)throw Error("Cannot find package "+Ba);ra=[];Ja=$jscomp.makeIterator(V.modules);hb=Ja.next();case 3:if(hb.done)return ld.yield(K.execCommand("open text window",{title:"imports and exports of "+Ba,content:ra.join("\n\n")}),0);dc=hb.value;if(!dc.name.match(/\.js$/)){ld.jumpTo(4);break}ld.setCatchFinallyBlocks(6);na=U;oa=na.importsAndExportsOf;wb=dc.name;return ld.yield(U.moduleRead(dc.name),9);case 9:return ld.yield(oa.call(na,wb,ld.yieldResult),8);case 8:fc=ld.yieldResult;
ld.leaveTryBlock(7);break;case 6:Qa=ld.enterCatchBlock();K.logError(Error("Error when getting imports/exports from module "+dc.name+":\n"+Qa.stack));ld.jumpTo(4);break;case 7:Lc=""+dc.name;if(!fc.imports.length&&!fc.exports.length){Lc+="\n  does not import / export anything";ld.jumpTo(4);break}fc.imports.length&&(Lc+="\n  imports:\n",Lc+=Fa.arr.groupByKey(fc.imports,"fromModule").mapGroups(function(od,Be){return"from "+od+": "+Be.map(function(sd){return sd.local||sd.imported?sd.imported&&sd.imported!==
sd.local?sd.imported+" as "+sd.local:sd.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(od){return"    "+od}).join("\n"));fc.exports.length&&(Lc+="\n  exports:\n",Lc+=fc.exports.map(function(od){return od.local?od.local&&od.local!==od.exported?od.local+" as "+od.exported:od.exported:od.exported+" from "+od.fromModule}).join(", ").split("\n").map(function(od){return"    "+od}).join("\n"));ra.push(Lc);case 4:hb=Ja.next(),ld.jumpTo(3)}})}function hc(U){return U.match(/import.*['"]mocha(-es6)?['"]/)&&
U.match(/it\(['"]/)}function mc(U,Ba,K){K=K&&K.address;if(K&&0===Ba.indexOf(K))var V=Ba.slice(K.length).replace(/^\//,"");else a:{K=U.getConfig();if(!K||K.constructor!==Promise)try{V=String((new Ea.URL(Ba)).relativePathFrom(new Ea.URL(U.getConfig().baseURL)));break a}catch(ra){}V=Ba}return V}function Hb(U,Ba,K,V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return 1==ra.nextAddress?(V=Object.assign({targetModule:Ba},V),ra.yield(U.normalize(Ba),2)):3!=ra.nextAddress?(Ba=ra.yieldResult,
ra.yield(U.moduleSourceChange(Ba,K,V),3)):ra.return(Ba)})}function ec(U,Ba,K,V,ra){V=void 0===V?!1:V;ra=void 0===ra?!1:ra;var Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){switch(hb.nextAddress){case 1:return Ba&&Ba.setStatusMessage("Reloading "+K),hb.setCatchFinallyBlocks(2),hb.yield(U.reloadModule(K,{reloadDeps:V,resetEnv:ra}),4);case 4:if(!Ba){hb.jumpTo(5);break}return hb.yield(Ba.updateModuleList(),6);case 6:case 5:Ba&&Ba.setStatusMessage("Reloded "+K);hb.leaveTryBlock(0);
break;case 2:Ja=hb.enterCatchBlock();hb.setCatchFinallyBlocks(7);if(!Ba){hb.jumpTo(9);break}return hb.yield(Ba.updateEditorWithSourceOf(K),10);case 10:case 9:hb.leaveTryBlock(8);break;case 7:hb.enterCatchBlock();case 8:throw Ba&&Ba.showError(Ja),Ja;}})}function vc(U,Ba,K){return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){switch(V.nextAddress){case 1:return V.yield(U.forgetModule(K,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Ba){V.jumpTo(3);break}return V.yield(Ba.updateModuleList(),4);
case 4:case 3:V.jumpToEnd()}})}function gd(U,Ba,K){var V,ra,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){switch(hb.nextAddress){case 1:return hb.yield(U.normalize(K),2);case 2:return V=hb.yieldResult,hb.yield(Ba.world().confirm("Remove file "+V+"?",{requester:Ba}),3);case 3:ra=hb.yieldResult;if(!ra)throw"Canceled";return hb.yield(U.forgetModule(V),4);case 4:return hb.yield(U.resourceRemove(V),5);case 5:return hb.yield(U.getPackageForModule(V),6);case 6:return Ja=hb.yieldResult,
hb.return(Ja)}})}function Zc(U,Ba,K){var V,ra,Ja,hb,dc,na,oa,wb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:return V=Ea.URL,fc.yield(U.getConfig(),2);case 2:ra=new V(fc.yieldResult.baseURL);Ja=Ba.world();if(!K){fc.jumpTo(3);break}return fc.yield(U.getPackage(K),4);case 4:if(hb=fc.yieldResult){fc.jumpTo(5);break}return fc.yield(U.getPackageForModule(K),6);case 6:hb=fc.yieldResult;case 5:(dc=hb)&&(ra=new Ea.URL(dc.address));case 3:return fc.yield(Ea._searchForExistingFiles(Ba,
String(ra),dc),7);case 7:na=fc.yieldResult;if(!na.includes("[create new module]")){fc.jumpTo(8);break}return fc.yield(Ea._askForModuleName(U,K||String(ra),Ja),9);case 9:oa=fc.yieldResult,na=[oa];case 8:return fc.yield(Ea._createAndLoadModules(U,na),10);case 10:return wb=fc.yieldResult,Ea.arr.compact(wb.map(function(Qa){return Qa.error})),fc.return(wb)}})}function Za(U,Ba){var K,V,ra,Ja,hb,dc,na,oa,wb,fc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qa){if(1==Qa.nextAddress)return Qa.yield(U.getPackage(Ba),
2);if(3!=Qa.nextAddress){K=Qa.yieldResult;if(!K||!K.address.match(/^http/))throw Error("Cannot load package "+Ba);V=Ea.resource(K.address);ra=[];Ja=$jscomp;hb=Ja.makeIterator;return Qa.yield(V.dirList(5,{exclude:Ea.modulesInPackage_defaultExclude}),3)}dc=hb.call(Ja,Qa.yieldResult);for(na=dc.next();!na.done;na=dc.next())wb=oa=na.value,fc=wb.url,fc.match(/\.js$/)&&U.isModuleLoaded(fc,!0)&&ra.push(U.getModule(fc));return Qa.return(ra)})}function Xa(U){U||(U="local");if(U.isSystemInterface)var Ba=U;else"string"===
typeof U&&U.startsWith("l2l ")&&(U={type:"l2l",id:U.split(" ")[1]}),"string"!==typeof U&&"l2l"===U.type&&(Ba=Ua.l2lInterfaceFor(U.id,U.info)),"string"!==typeof U&&($world.setStatusMessage("Unknown system interface "+U),U="local"),Ba||(Ba=U&&"local"!==U?Ua.serverInterfaceFor(U):Ua.localInterface);return Ba}wa("systemInterfaceNamed",Xa);var jb=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");jb.parseJsonLikeObj=ae;jb.ast=bb;jb.parseJsonLikeObj=ae;jb.parseJsonLikeObj=ae;var Fa=
lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Fa.loadPackage=function(U,Ba){var K,V;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){switch(ra.nextAddress){case 1:return ra.yield(U.importPackage(Ba.address+"/"),2);case 2:if(!Ba.main){ra.jumpTo(3);break}return ra.yield(U.importModule(Ba.main.toString()),3);case 3:if(!Ba.test){ra.jumpTo(5);break}ra.setCatchFinallyBlocks(6);return ra.yield(U.importPackage("mocha-es6"),8);case 8:return K=ra.yieldResult,
ra.yield(K.installSystemInstantiateHook(),9);case 9:return ra.yield(U.importModule(Ba.test.toString()),10);case 10:ra.leaveTryBlock(5);break;case 6:V=ra.enterCatchBlock(),console.warn("Cannot load test of new package: "+V);case 5:return ra.return(U.getPackage(Ba.address))}})};Fa.interactivelyCreatePackage=lc;Fa.interactivelyLoadPackage=Wc;Fa.interactivelyReloadPackage=Ed;Fa.interactivelyUnloadPackage=Tb;Fa.interactivelyRemovePackage=Bd;Fa.showExportsAndImportsOf=Sd;Fa.parseJsonLikeObj=ae;Fa.arr=ib;
Fa.resource=Qb;Fa.interactivelyCreatePackage=lc;Fa.interactivelyCreatePackage=lc;Fa.interactivelyLoadPackage=Wc;Fa.interactivelyLoadPackage=Wc;Fa.interactivelyReloadPackage=Ed;Fa.interactivelyReloadPackage=Ed;Fa.interactivelyUnloadPackage=Tb;Fa.interactivelyUnloadPackage=Tb;Fa.interactivelyRemovePackage=Bd;Fa.interactivelyRemovePackage=Bd;Fa.showExportsAndImportsOf=Sd;Fa.showExportsAndImportsOf=Sd;var Ea=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");Ea.isTestModule=
hc;Ea.shortModuleName=mc;Ea.interactivelyChangeModule=Hb;Ea.interactivelyReloadModule=ec;Ea.interactivelyUnloadModule=vc;Ea.interactivelyRemoveModule=gd;Ea.interactivelyAddModule=Zc;Ea._askForModuleName=function(U,Ba,K){var V,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(K.prompt("Enter module name",{input:Ba,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Ba=Ja.yieldResult;if(!Ba)throw"Canceled";return Ja.yield(U.normalize(Ba),
3);case 3:return V=Ja.yieldResult,Ja.yield(K.confirm(["Create module \n",{},V,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:ra=Ja.yieldResult;if(!ra)throw"Canceled";return Ja.return(V)}})};Ea._searchForExistingFiles=function(U,Ba,K){return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){return String(Ba).match(/^http/)?V.return(Ea._searchForExistingFilesWeb(U,Ba,K)):V.return(Ea._searchForExistingFilesManually(U,Ba,K))})};Ea._searchForExistingFilesManually=function(U,Ba,K){var V,
ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(U.world().multipleChoicePrompt("Add Module",{requester:U,choices:["Create New Module","Load Existing Module"]}),2);case 2:V=Ja.yieldResult;if("Create New Module"===V)return Ja.return("[create new module]");if("Load Existing Module"!==V){Ja.jumpTo(3);break}return Ja.yield(U.world().prompt("URL of module?",{input:Ba,requester:U,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(ra=Ja.yieldResult)return Ja.return([ra]);case 3:throw"Canceled";}})};Ea._searchForExistingFilesWeb=function(U,Ba,K){function V(wb){wb.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(wb.name())||K&&Ea.arr.pluck(K.modules,"name").includes(wb.url)?!0:!1}var ra,Ja,hb,dc,na,oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:return(ra=U.world())&&(Ja=ra.showLoadingIndicatorFor(U,"Loading existing modules...")),
wb.yield(Ea.resource(Ba).dirList(5,{exclude:V}),3);case 3:return wb.yield(wb.yieldResult.map(function(fc){return fc.url}),2);case 2:return hb=wb.yieldResult,dc=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(hb.filter(function(fc){return fc.endsWith(".js")}).map(function(fc){return{isListItem:!0,string:K&&0==fc.indexOf(K.address)?K.name+fc.slice(K.address.length):fc,value:fc}})),wb.yield(Promise.resolve(Ja&&Ja.remove()).then(function(){return U.world().filterableListPrompt("What module to load?",
dc,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:U},U?{extent:U.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:na=wb.yieldResult;if(!na||"canceled"===na.status||!na.selected.length)throw"Canceled";oa=na.selected||na;Array.isArray(oa)||(oa=[oa]);return wb.return(oa)}})};Ea._createAndLoadModules=function(U,Ba){var K,V,ra,Ja,hb,dc,na,oa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(wb){switch(wb.nextAddress){case 1:Array.isArray(Ba)||(Ba=[Ba]),K=[],V=$jscomp.makeIterator(Ba),
ra=V.next();case 2:if(ra.done){wb.jumpTo(4);break}Ja=ra.value;return wb.yield(U.forgetModule(Ja,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return wb.yield(U.resourceEnsureExistance(Ja,'"format esm";\n'),6);case 6:return hb=wb.yieldResult,dc=Ea,na=dc.isTestModule,wb.yield(hb.read(),7);case 7:if(!na.call(dc,wb.yieldResult)){wb.jumpTo(8);break}if(window.Mocha&&window.chai){wb.jumpTo(8);break}return wb.yield(System.import("mocha-es6"),10);case 10:return wb.yield(Ea.promise.waitFor(function(){return!!window.Mocha&&
!!window.chai}),8);case 8:return wb.setCatchFinallyBlocks(12),wb.yield(U.importModule(Ja),14);case 14:K.push({name:Ja});wb.leaveTryBlock(3);break;case 12:oa=wb.enterCatchBlock(),K.push({name:Ja,error:oa});case 3:ra=V.next();wb.jumpTo(2);break;case 4:return wb.return(K)}})};Ea.modulesInPackage_defaultExclude=function(U){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(U.name())?!0:!1};Ea.modulesInPackage=Za;Ea.obj=Ib;Ea.promise=ed;Ea.arr=ib;Ea.resource=Qb;Ea.isTestModule=
hc;Ea.isTestModule=hc;Ea.shortModuleName=mc;Ea.shortModuleName=mc;Ea.interactivelyChangeModule=Hb;Ea.interactivelyChangeModule=Hb;Ea.interactivelyReloadModule=ec;Ea.interactivelyReloadModule=ec;Ea.interactivelyUnloadModule=vc;Ea.interactivelyUnloadModule=vc;Ea.interactivelyRemoveModule=gd;Ea.interactivelyRemoveModule=gd;Ea.interactivelyAddModule=Zc;Ea.interactivelyAddModule=Zc;Ea.modulesInPackage=Za;Ea.modulesInPackage=Za;var ka=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
ka.todo=function(U){throw Error(U+" is not yet implemented!");};ka.parseJsonLikeObj=ae;ka.arr=ib;ka.Closure=qc;ka.obj=Ib;ka.resource=Qb;ka.transform=pd;ka.modules=uc;var ja=function(){};ja.prototype.dynamicCompletionsForPrefix=function(U,Ba,K){return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){ka.todo("dynamicCompletionsForPrefix");V.jumpToEnd()})};ja.prototype.runEval=function(U,Ba){ka.todo("runEval")};ja.prototype.resourceExists=function(U){ka.todo("resourceExists")};ja.prototype.resourceEnsureExistance=
function(U,Ba){ka.todo("resourceEnsureExistance")};ja.prototype.resourceMkdir=function(U){ka.todo("resourceMkdir")};ja.prototype.resourceRead=function(U){ka.todo("resourceRead")};ja.prototype.resourceRemove=function(U){ka.todo("resourceRemove")};ja.prototype.resourceWrite=function(U,Ba){ka.todo("resourceWrite")};ja.prototype.resourceCreateFiles=function(U,Ba){ka.todo("resourceCreateFiles")};ja.prototype.resourceDirList=function(U,Ba,K){ka.todo("resourceDirList")};ja.prototype.normalizeSync=function(U,
Ba,K){ka.todo("normalizeSync")};ja.prototype.normalize=function(U,Ba,K){ka.todo("normalize")};ja.prototype.printSystemConfig=function(){ka.todo("printSystemConfig")};ja.prototype.getConfig=function(){ka.todo("getConfig")};ja.prototype.setConfig=function(U){ka.todo("setConfig")};ja.prototype.getPackages=function(U){ka.todo("getPackages")};ja.prototype.isModuleLoaded=function(U,Ba){ka.todo("isModuleLoaded")};ja.prototype.doesModuleExist=function(U,Ba){ka.todo("doesModuleExist")};ja.prototype.getModules=
function(){var U=this,Ba,K;return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){return 1==V.nextAddress?(Ba=ka.arr,K=Ba.flatmap,V.yield(U.getPackages(),2)):V.return(K.call(Ba,V.yieldResult,function(ra){return ra.modules}))})};ja.prototype.getModule=function(U){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){return 1==K.nextAddress?K.yield(Ba.getModules(),2):K.return(K.yieldResult.find(function(V){return V.name===U}))})};ja.prototype.getPackage=function(U){var Ba=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){return 1==K.nextAddress?(U=U.replace(/\/+$/,""),K.yield(Ba.getPackages(),2)):K.return(K.yieldResult.find(function(V){return V.address===U||V.name===U}))})};ja.prototype.getPackageForModule=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){ka.todo("getPackageForModule");Ba.jumpToEnd()})};ja.prototype.systemConfChange=function(U){var Ba=ka.parseJsonLikeObj(U);["baseURL"].forEach(function(K){return delete Ba[K]});
return this.setConfig(Ba)};ja.prototype.resourcesOfPackage=function(U,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){ka.todo("resourcesOfPackage");K.jumpToEnd()})};ja.prototype.registerPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){ka.todo("registerPackage");Ba.jumpToEnd()})};ja.prototype.importPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){ka.todo("importPackage");Ba.jumpToEnd()})};ja.prototype.removePackage=
function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){ka.todo("removePackage");Ba.jumpToEnd()})};ja.prototype.reloadPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){ka.todo("reloadPackage");Ba.jumpToEnd()})};ja.prototype.packageConfChange=function(U,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){ka.todo("packageConfChange");K.jumpToEnd()})};ja.prototype.importModule=function(U){ka.todo("importModule")};ja.prototype.forgetModule=
function(U,Ba){ka.todo("forgetModule")};ja.prototype.reloadModule=function(U,Ba){ka.todo("reloadModule")};ja.prototype.moduleFormat=function(U){ka.todo("moduleFormat")};ja.prototype.moduleRead=function(U){ka.todo("moduleRead")};ja.prototype.moduleSourceChange=function(U,Ba,K){ka.todo("moduleSourceChange")};ja.prototype.importsAndExportsOf=function(U,Ba){ka.todo("importsAndExportsOf")};ja.prototype.keyValueListOfVariablesInModule=function(U,Ba){ka.todo("keyValueListOfVariablesInModule")};ja.prototype.moduleWrite=
function(U,Ba){return this.moduleSourceChange(U,Ba)};ka.AbstractCoreInterface=ja;var Ca=function(){var U=ka.AbstractCoreInterface.call(this)||this;U.currentEval=null;return U};$jscomp.inherits(Ca,ka.AbstractCoreInterface);Ca.prototype.runEval=function(U,Ba){throw Error("Not yet implemented");};Ca.prototype.runEvalAndStringify=function(U,Ba){var K=this;return this.currentEval?this.currentEval.then(function(){return K.runEvalAndStringify(U,Ba)}):this.currentEval=Promise.resolve().then(function(){var V,
ra,Ja,hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){switch(dc.nextAddress){case 1:return dc.yield(K.runEval("\n        Promise.resolve((async "+ka.transform.wrapInFunction(U)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},Ba)),2);case 2:if((V=dc.yieldResult)&&V.isError)throw Error(String(V.value||V.error));if(!V||!V.value)return dc.return(null);if(ra=V.promisedValue){dc.jumpTo(3);break}return dc.yield(V.value,4);case 4:ra=dc.yieldResult;case 3:Ja=ra;if(!Ja)return dc.return();if("undefined"===Ja)return dc.return(void 0);if("null"===Ja)return dc.return(null);if("true"===Ja)return dc.return(!0);if("false"===
Ja)return dc.return(!1);try{hb=JSON.parse(Ja)}catch(na){return dc.return(Ja)}if(hb&&hb.isError)throw Error(String(hb.value));return dc.return(hb)}})}).then(function(V){delete K.currentEval;return V},function(V){delete K.currentEval;return Promise.reject(V)})};Ca.prototype.dynamicCompletionsForPrefix=function(U,Ba,K){var V=this,ra,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){ra=ka.obj.isString(K.context)?K.context:!1;K=ka.obj.dissoc(K,["systemInterface","System","context"]);Ja=
"\n      var prefix = "+JSON.stringify(Ba)+",\n          opts = "+JSON.stringify(K)+";\n      opts.context = "+ra+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return hb.return(V.runEvalAndStringify(Ja))})};Ca.prototype.evalWithResource=function(U,Ba,K){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+U+'").'+Ba+"("+(K?JSON.stringify(K):"")+");\n    ")};Ca.prototype.resourceExists=function(U){return this.evalWithResource(U,"exists")};Ca.prototype.resourceEnsureExistance=function(U,Ba){return this.evalWithResource(U,
"ensureExistance",Ba)};Ca.prototype.resourceMkdir=function(U){return this.evalWithResource(U,"mkdir")};Ca.prototype.resourceRead=function(U){return this.evalWithResource(U,"read")};Ca.prototype.resourceRemove=function(U){return this.evalWithResource(U,"remove")};Ca.prototype.resourceWrite=function(U,Ba){return this.evalWithResource(U,"write",Ba)};Ca.prototype.resourceCreateFiles=function(U,Ba){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
U+'", '+JSON.stringify(Ba)+")")};Ca.prototype.resourceDirList=function(U,Ba,K){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+U+'").dirList('+JSON.stringify(Ba)+", "+JSON.stringify(K)+"))\n        .map(({url}) => ({url}))")};Ca.prototype.livelySystemAccessor=function(U){U=void 0===U?"livelySystem":U;return"var "+U+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
U+') throw new Error("lively-system-interface not available!");'};Ca.prototype.normalizeSync=function(U,Ba,K){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(U)+", "+JSON.stringify(Ba)+", "+K+")")};Ca.prototype.normalize=function(U,Ba,K){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(U)+", "+JSON.stringify(Ba)+", "+JSON.stringify(K)+")")};Ca.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
Ca.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};Ca.prototype.setConfig=function(U){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(U)+")")};Ca.prototype.getPackages=function(U){U=Object.assign({excluded:[]},U);U.excluded=U.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(U)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};Ca.prototype.getPackageForModule=function(U){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(U)+")")};Ca.prototype.isModuleLoaded=function(U,Ba){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+U+'", '+Ba+")")};Ca.prototype.doesModuleExist=function(U,Ba){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+U+'", '+Ba+")")};Ca.prototype.registerPackage=function(U){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){return K.return(Ba.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(U)+")"))})};Ca.prototype.importPackage=
function(U){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){return K.return(Ba.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(U)+")"))})};Ca.prototype.removePackage=function(U){var Ba=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){return K.return(Ba.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(U)+")"))})};Ca.prototype.reloadPackage=function(U,Ba){var K=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){return V.return(K.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(U)+", "+JSON.stringify(Ba)+")"))})};Ca.prototype.packageConfChange=function(U,Ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(U)+", "+JSON.stringify(Ba)+")")};Ca.prototype.resourcesOfPackage=function(U,Ba){Ba=void 0===Ba?[".git","node_modules",".module_cache","lively.next-node_modules"]:Ba;var K=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){U.address&&(U=U.address);
return V.return(K.runEvalAndStringify("\n      "+K.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(U)+", "+JSON.stringify(Ba)+");"))})};Ca.prototype.getModule=function(U){var Ba=this,K;return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){if(1==V.nextAddress)return V.yield(Ba.getModules(),2);K=V.yieldResult.find(function(ra){return ra.name===U});return V.return(K?ka.modules.module(K.name):null)})};Ca.prototype.importModule=function(U){return this.runEvalAndStringify("lively.modules.System.import("+
JSON.stringify(U)+")")};Ca.prototype.forgetModule=function(U,Ba){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(U)+").unload("+JSON.stringify(Ba)+")")};Ca.prototype.reloadModule=function(U,Ba){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(U)+").reload("+JSON.stringify(Ba)+")")};Ca.prototype.moduleFormat=function(U){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(U)+").format();")};Ca.prototype.moduleRead=function(U){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(U)+").source()")};Ca.prototype.moduleSourceChange=function(U,Ba,K){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(U)+").changeSource("+JSON.stringify(Ba)+", "+JSON.stringify(K)+")")};Ca.prototype.keyValueListOfVariablesInModule=function(U,Ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+JSON.stringify(U)+", "+JSON.stringify(Ba)+")")};Ca.prototype.importsAndExportsOf=
function(U,Ba){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(U)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(U)+").exports()})")};Ca.prototype.exportsOfModules=function(U){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(U)+";\n      options.excludedPackages = ["+U.excludedPackages.map(function(Ba){return"function"===typeof Ba?Ba.toString():JSON.stringify(Ba)}).join(",")+
"]\n      await livelySystem.localInterface.exportsOfModules(options)")};Ca.prototype.searchInPackage=function(U,Ba,K){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(U)+", "+JSON.stringify(Ba)+", "+JSON.stringify(K)+")")};Ca.prototype.loadMochaTestFile=function(U,Ba){Ba=void 0===Ba?[]:Ba;var K=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){return V.return(K.runEvalAndStringify("\n      "+
K.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(U)+", "+JSON.stringify(Ba)+"), result;\n      result = {testsByFile}"))})};Ca.prototype.runMochaTests=function(U,Ba,K,V){var ra=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){U&&U instanceof RegExp&&(U={isRegExp:!0,value:String(U).replace(/^\/|\/$/g,"")});return Ja.return(ra.runEvalAndStringify("\n      var grep = "+JSON.stringify(U)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
ra.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(Ba||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
ka.RemoteCoreInterface=Ca;var mb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");mb.obj=Ib;mb.string=Ac;mb.arr=ib;mb.resource=Qb;mb.createFiles=dd;mb.ast=bb;mb.modules=uc;mb.vm=Ad;mb.parseJsonLikeObj=ae;mb.AbstractCoreInterface=ja;mb.classToFunctionTransform=le;ja=function(){return mb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(ja,mb.AbstractCoreInterface);ja.prototype.dynamicCompletionsForPrefix=function(U,Ba,K){var V;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){if(1==
ra.nextAddress)return ra.yield(mb.vm.completions.getCompletions(function(Ja){return mb.vm.runEval(Ja.replace("return ",""),Object.assign({targetModule:U,classTransform:mb.classToFunctionTransform},K))},Ba),2);V=ra.yieldResult;if(V.isError)throw V.value;return ra.return({completions:V.completions,prefix:V.startLetters})})};ja.prototype.runEval=function(U,Ba){return mb.vm.runEval(U,Object.assign({classTransform:mb.classToFunctionTransform},Ba))};ja.prototype.resourceExists=function(U){return mb.resource(U).exists()};
ja.prototype.resourceEnsureExistance=function(U,Ba){return mb.resource(U).ensureExistance(Ba)};ja.prototype.resourceMkdir=function(U){return mb.resource(U).mkdir()};ja.prototype.resourceRead=function(U){return mb.resource(U).read()};ja.prototype.resourceRemove=function(U){return mb.resource(U).remove()};ja.prototype.resourceWrite=function(U,Ba){return mb.resource(U).write(Ba)};ja.prototype.resourceCreateFiles=function(U,Ba){return mb.createFiles(U,Ba)};ja.prototype.resourceDirList=function(U,Ba,K){return mb.resource(U).dirList(Ba,
K)};ja.prototype.normalizeSync=function(U,Ba,K){return System.decanonicalize(U,Ba,K)};ja.prototype.normalize=function(U,Ba,K){return System.normalize(U,Ba,K)};ja.prototype.printSystemConfig=function(){return mb.modules.printSystemConfig()};ja.prototype.getConfig=function(){return System.getConfig()};ja.prototype.setConfig=function(U){mb.modules.System.config(U)};ja.prototype.getPackages=function(U){U=Object.assign({},U);U=void 0===U.excluded?[]:U.excluded;var Ba=U.filter(function(V){return"string"===
typeof V}),K=U.filter(function(V){return"function"===typeof V});Ba=Ba.concat(Ba.map(function(V){return System.decanonicalize(V.replace(/\/?$/,"/")).replace(/\/$/,"")}));return mb.modules.getPackages().filter(function(V){return!Ba.includes(V.url)&&!K.some(function(ra){return ra(V.url)})})};ja.prototype.registerPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(mb.modules.registerPackage(U))})};ja.prototype.importPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(mb.modules.importPackage(U))})};
ja.prototype.removePackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){return Ba.return(mb.modules.removePackage(U))})};ja.prototype.reloadPackage=function(U,Ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(K){return K.return(mb.modules.reloadPackage(U,Ba))})};ja.prototype.packageConfChange=function(U,Ba){var K=this,V,ra,Ja,hb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){if(1==dc.nextAddress)return V=mb.modules.System,ra=mb.parseJsonLikeObj(U),
Ja=JSON.stringify(ra,null,2),dc.yield(mb.modules.module(Ba).changeSource(Ja,{doEval:!1}),2);if(3!=dc.nextAddress)return V.set(Ba,V.newModule(ra)),dc.yield(K.getPackageForModule(Ba),3);(hb=dc.yieldResult)&&mb.modules.applyPackageConfig(ra,hb.address);dc.jumpToEnd()})};ja.prototype.resourcesOfPackage=function(U,Ba){Ba=void 0===Ba?[".git","node_modules",".module_cache"]:Ba;var K,V,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){if(1==Ja.nextAddress)return Ja.setCatchFinallyBlocks(2),
K=U.address?U.address:U,V=mb.modules.getPackage(K),Ja.yield(V.resources(void 0,Ba),4);if(2!=Ja.nextAddress)return Ja.return(Ja.yieldResult.map(function(hb){return Object.assign(hb,{package:hb.package.url})}));ra=Ja.enterCatchBlock();console.warn("resourcesOfPackage error for "+U+": "+ra);return Ja.return([])})};ja.prototype.getPackageForModule=function(U){return(U=mb.modules.getPackageOfModule(U))?U.asSpec():U};ja.prototype.isModuleLoaded=function(U,Ba){return mb.modules.isModuleLoaded(U,Ba)};ja.prototype.doesModuleExist=
function(U,Ba){return mb.modules.isModuleLoaded(U,Ba)};ja.prototype.getModule=function(U){return mb.modules.module(U)};ja.prototype.importModule=function(U){return mb.modules.System.import(U)};ja.prototype.forgetModule=function(U,Ba){return mb.modules.module(U).unload(Ba)};ja.prototype.reloadModule=function(U,Ba){return mb.modules.module(U).reload(Ba)};ja.prototype.moduleFormat=function(U){return mb.modules.module(U).format()};ja.prototype.moduleRead=function(U){return mb.modules.module(U).source()};
ja.prototype.moduleSourceChange=function(U,Ba,K){return mb.modules.module(U).changeSource(Ba,K)};ja.prototype.keyValueListOfVariablesInModule=function(U,Ba){var K=this,V,ra,Ja,hb,dc,na,oa,wb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:if(Ba){fc.jumpTo(2);break}return fc.yield(K.resourceRead(U),3);case 3:Ba=fc.yieldResult;case 2:return V="string"===typeof Ba?mb.ast.parse(Ba):Ba,ra=K.normalizeSync(U),K.moduleFormat(ra),Ja=mb.modules.module(ra).env().recorder,
fc.yield(K.importsAndExportsOf(ra,V),4);case 4:return hb=fc.yieldResult,dc=mb.ast.query.topLevelDeclsAndRefs(V),na=mb.arr.sortByKey(mb.ast.query.declarationsOfScope(dc.scope,!0),"start"),oa=mb.arr.pluck(dc.scope.importSpecifiers,"name"),wb=0,fc.return(na.map(function(Qa){var Lc=Qa.name.length,ld=hb.exports.find(function(Be){return Be.local===Qa.name}),od=mb.arr.include(oa,Qa.name);ld&&(Lc+=9);od&&(Lc+=9);wb=Math.max(wb,Lc);return{isExport:ld,isImport:od,name:Qa.name,value:Ja[Qa.name],node:Qa,printedName:Qa.name+
(ld?" [export]":"")+(od?" [import]":""),printedValue:mb.obj.inspect(Ja[Qa.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(Qa){return{isListItem:!0,value:Qa,string:Qa.printedName+mb.string.indent(" = "+Qa.printedValue," ",wb-Qa.printedName.length)}}))}})};ja.prototype.importsAndExportsOf=function(U,Ba){var K;return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){return 1==V.nextAddress?V.yield(mb.modules.module(U).imports(Ba),2):3!=V.nextAddress?(K=V.yieldResult,V.yield(mb.modules.module(U).exports(Ba),
3)):V.return({imports:K,exports:V.yieldResult})})};ja.prototype.exportsOfModules=function(U){return mb.modules.ExportLookup.run(System,U)};ja.prototype.searchInPackage=function(U,Ba,K){return mb.modules.getPackage(U).search(Ba,K)};ja.prototype.runMochaTests=function(U,Ba,K,V){var ra,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){if(1==hb.nextAddress)return hb.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);ra=hb.yieldResult;Ja=ra.runMochaTests;return hb.return(Ja(U,
Ba,K,V))})};ja.prototype.loadMochaTestFile=function(U,Ba){var K,V;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){if(1==ra.nextAddress)return ra.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);K=ra.yieldResult;V=K.loadMochaTestFile;return ra.return(V(U,Ba))})};$jscomp.global.Object.defineProperties(ja.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});mb.LocalCoreInterface=ja;var Ub=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");
Ub.evalStrategies=Le;Ub.RemoteCoreInterface=Ca;var Ya=function(U){var Ba=Ub.RemoteCoreInterface.call(this)||this;Ba.currentEval=null;Ba.url=U;Ba.server=new Ub.evalStrategies.HttpEvalStrategy(U);return Ba};$jscomp.inherits(Ya,Ub.RemoteCoreInterface);Ya.prototype.runEval=function(U,Ba){return this.server.runEval(U,Ba)};$jscomp.global.Object.defineProperties(Ya.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,
"")}}});Ub.HTTPCoreInterface=Ya;var $a=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");$a.evalStrategies=Le;$a.RemoteCoreInterface=Ca;Ca=function(U,Ba){var K=$a.RemoteCoreInterface.call(this)||this;K.targetId=U;K.peer=Ba;return K};$jscomp.inherits(Ca,$a.RemoteCoreInterface);Ca.prototype.isConnected=function(){var U=this,Ba,K,V,ra,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hb){if(1==hb.nextAddress)return Ba=U,K=Ba.client,V=Ba.targetId,hb.yield(K.sendToAndWait(K.trackerId,
"getClients",{}),2);ra=hb.yieldResult;Ja=ra.data;return hb.return(Ja.some(function(dc){dc=$jscomp.makeIterator(dc).next().value;return V===dc}))})};Ca.prototype.runEval=function(U,Ba){var K=this,V,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){V=K.client;if(!V)throw Error("No lively.2lively default client available!");ra=new $a.evalStrategies.L2LEvalStrategy(V,K.targetId);return Ja.return(ra.runEval(U,Ba))})};$jscomp.global.Object.defineProperties(Ca.prototype,{name:{configurable:!0,
enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var U=this.peer,Ba="l2l "+this.targetId.slice(0,5);if(U){var K=U.location,V=U.type,ra=U.user;U=U.world;V&&(Ba+=", "+V);K&&(Ba+=", "+K.replace(/^https?:\/\//,"")+(U?"/"+U:""));ra&&(Ba+=", "+ra.name)}return Ba}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});$a.L2LCoreInterface=
Ca;var Ua=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Ua.systemInterfaceNamed=Xa;Ua.interactivelyCreatePackage=lc;Ua.interactivelyLoadPackage=Wc;Ua.interactivelyReloadPackage=Ed;Ua.interactivelyUnloadPackage=Tb;Ua.interactivelyRemovePackage=Bd;Ua.showExportsAndImportsOf=Sd;Ua.shortModuleName=mc;Ua.interactivelyChangeModule=Hb;Ua.interactivelyReloadModule=ec;Ua.interactivelyUnloadModule=vc;Ua.interactivelyRemoveModule=gd;Ua.interactivelyAddModule=Zc;Ua.modulesInPackage=Za;
Ua.LocalCoreInterface=ja;Ua.HTTPCoreInterface=Ya;Ua.L2LCoreInterface=Ca;Ca=function(U){this.coreInterface=U};Ca.prototype.dynamicCompletionsForPrefix=function(U,Ba,K){return this.coreInterface.dynamicCompletionsForPrefix(U,Ba,K)};Ca.prototype.runEval=function(U,Ba){return this.coreInterface.runEval(U,Ba)};Ca.prototype.printSystemConfig=function(U,Ba,K){return this.coreInterface.printSystemConfig(U,Ba,K)};Ca.prototype.getConfig=function(U,Ba,K){return this.coreInterface.getConfig(U,Ba,K)};Ca.prototype.getPackages=
function(U){return this.coreInterface.getPackages(U)};Ca.prototype.getModules=function(U,Ba,K){return this.coreInterface.getModules(U,Ba,K)};Ca.prototype.getModule=function(U,Ba,K){return this.coreInterface.getModule(U,Ba,K)};Ca.prototype.getPackage=function(U,Ba,K){return this.coreInterface.getPackage(U,Ba,K)};Ca.prototype.getPackageForModule=function(U,Ba,K){return this.coreInterface.getPackageForModule(U,Ba,K)};Ca.prototype.resourcesOfPackage=function(U,Ba){return this.coreInterface.resourcesOfPackage(U,
Ba)};Ca.prototype.systemConfChange=function(U,Ba,K){return this.coreInterface.systemConfChange(U,Ba,K)};Ca.prototype.registerPackage=function(U){return this.coreInterface.registerPackage(U)};Ca.prototype.importPackage=function(U){return this.coreInterface.importPackage(U)};Ca.prototype.removePackage=function(U){return this.coreInterface.removePackage(U)};Ca.prototype.reloadPackage=function(U){return this.coreInterface.reloadPackage(U)};Ca.prototype.packageConfChange=function(U,Ba){return this.coreInterface.packageConfChange(U,
Ba)};Ca.prototype.keyValueListOfVariablesInModule=function(U,Ba){return this.coreInterface.keyValueListOfVariablesInModule(U,Ba)};Ca.prototype.interactivelyCreatePackage=function(U){return Ua.interactivelyCreatePackage(this.coreInterface,U)};Ca.prototype.interactivelyLoadPackage=function(U,Ba){return Ua.interactivelyLoadPackage(this.coreInterface,U,Ba)};Ca.prototype.interactivelyReloadPackage=function(U,Ba){return Ua.interactivelyReloadPackage(this.coreInterface,U,Ba)};Ca.prototype.interactivelyUnloadPackage=
function(U,Ba,K){return Ua.interactivelyUnloadPackage(this.coreInterface,U,Ba,K)};Ca.prototype.interactivelyRemovePackage=function(U,Ba){return Ua.interactivelyRemovePackage(this.coreInterface,U,Ba)};Ca.prototype.isModuleLoaded=function(U,Ba){return this.coreInterface.isModuleLoaded(U,Ba)};Ca.prototype.doesModuleExist=function(U,Ba){return this.coreInterface.doesModuleExist(U,Ba)};Ca.prototype.importModule=function(U){return this.coreInterface.importModule(U)};Ca.prototype.forgetModule=function(U,
Ba){return this.coreInterface.forgetModule(U,Ba)};Ca.prototype.reloadModule=function(U,Ba){return this.coreInterface.reloadModule(U,Ba)};Ca.prototype.moduleFormat=function(U){return this.coreInterface.moduleFormat(U)};Ca.prototype.moduleRead=function(U){return this.coreInterface.moduleRead(U)};Ca.prototype.moduleWrite=function(U,Ba){return this.coreInterface.moduleWrite(U,Ba)};Ca.prototype.getModulesInPackage=function(U){return Ua.modulesInPackage(this.coreInterface,U)};Ca.prototype.shortModuleName=
function(U,Ba){return Ua.shortModuleName(this.coreInterface,U,Ba)};Ca.prototype.interactivelyChangeModule=function(U,Ba,K){return Ua.interactivelyChangeModule(this.coreInterface,U,Ba,K)};Ca.prototype.interactivelyReloadModule=function(U,Ba){return Ua.interactivelyReloadModule(this.coreInterface,U,Ba)};Ca.prototype.interactivelyUnloadModule=function(U,Ba){return Ua.interactivelyUnloadModule(this.coreInterface,U,Ba)};Ca.prototype.interactivelyRemoveModule=function(U,Ba){return Ua.interactivelyRemoveModule(this.coreInterface,
U,Ba)};Ca.prototype.interactivelyAddModule=function(U,Ba){return Ua.interactivelyAddModule(this.coreInterface,U,Ba)};Ca.prototype.showExportsAndImportsOf=function(U,Ba){return Ua.showExportsAndImportsOf(this.coreInterface,U,Ba)};Ca.prototype.exportsOfModules=function(U){return this.coreInterface.exportsOfModules(U)};Ca.prototype.searchInPackage=function(U,Ba,K){return this.coreInterface.searchInPackage(U,Ba,K)};Ca.prototype.searchInAllPackages=function(U,Ba){Ba=void 0===Ba?{}:Ba;var K=this,V,ra,Ja,
hb,dc,na,oa,wb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fc){switch(fc.nextAddress){case 1:return(V=Ba.progress)&&V.step("Fetching Packages...",0),fc.yield(K.coreInterface.getPackages({excluded:Ba.excludedPackages}),2);case 2:ra=fc.yieldResult,Ja=[],V&&V.step("Fetching Packages...",.1),hb=0;case 3:if(!(hb<ra.length)){fc.jumpTo(5);break}dc=ra[hb];na=dc.url;if(!na||"no group"===na){fc.jumpTo(4);break}V&&V.step(na.replace(System.baseURL,"").slice(0,20),.1+hb/ra.length*.9);fc.setCatchFinallyBlocks(6);
return fc.yield(K.coreInterface.searchInPackage(na,U,Ba),8);case 8:oa=fc.yieldResult;Ja=Ja.concat(oa);fc.leaveTryBlock(4);break;case 6:wb=fc.enterCatchBlock(),console.error("Error searching in package "+na+":\n"+wb.stack);case 4:hb++;fc.jumpTo(3);break;case 5:return fc.return(Ja)}})};Ca.prototype.loadMochaTestFile=function(U,Ba){return this.coreInterface.loadMochaTestFile(U,Ba)};Ca.prototype.runMochaTests=function(U,Ba,K,V){return this.coreInterface.runMochaTests(U,Ba,K,V)};$jscomp.global.Object.defineProperties(Ca.prototype,
{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});wa("Interface",Ca);Ua.Interface=Ca;Ua.systemInterfaceNamed=Xa;Ua.systemInterfaceNamed=Xa;Ca=wa("localInterface",new Ua.Interface(new Ua.LocalCoreInterface));Ua.localInterface=Ca;Ua.localInterface=Ca;Ua.localInterface=Ca;Ua.httpInterfaces={};Ca=wa("serverInterfaceFor",function(U){return Ua.httpInterfaces[U]||(Ua.httpInterfaces[U]=new Ua.Interface(new Ua.HTTPCoreInterface(U)))});
Ua.serverInterfaceFor=Ca;Ua.serverInterfaceFor=Ca;Ua.serverInterfaceFor=Ca;Ua.l2lInterfaces={};Ca=wa("l2lInterfaceFor",function(U,Ba){return Ua.l2lInterfaces[U]||(Ua.l2lInterfaces[U]=new Ua.Interface(new Ua.L2LCoreInterface(U,Ba)))});Ua.l2lInterfaceFor=Ca;Ua.l2lInterfaceFor=Ca;Ua.l2lInterfaceFor=Ca}}});