System.register(["./__root_module__-a4bfb546.js","kld-intersections"],function(ta){var cb,mb,Sb,Jb,sd,vc,wd,wc,Cc,Gc,Cd,pe,Je;return{setters:[function(ce){cb=ce.bu;mb=ce.a6;Sb=ce.r;Jb=ce.a8;sd=ce.$;vc=ce.bv;wd=ce.bw;wc=ce.T;Cc=ce.a7;Gc=ce.bx;Cd=ce.by;pe=ce.l;Je=ce.bz},function(){}],execute:function(){function ce(U){try{var va=eval("("+fb.ast.transform.wrapInFunction("var _; _ = ("+U+")")+")()")}catch(M){return JSON.parse(U)}return"object"!==typeof va?null:va}function Qb(U,va){var M,da,Ia,Wa,Zb,
Oc,Ub,vb,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){switch($c.nextAddress){case 1:return M=va.world(),$c.yield(M.prompt("Enter package name",{requester:va,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:da=$c.yieldResult;if(!da)throw"Canceled";$c.setCatchFinallyBlocks(3);Wa=ya.resource(da);da=Wa.name();Ia=Wa.url;$c.leaveTryBlock(4);break;case 3:return $c.enterCatchBlock(),$c.yield(U.getConfig(),5);case 5:return Zb=$c.yieldResult.baseURL,Oc=
ya.resource(Zb).join(da).asDirectory().url,$c.yield(U.normalize(Oc),6);case 6:Ia=$c.yieldResult.replace(/\/\.js$/,"/");case 4:return $c.yield(M.prompt("Confirm or change package location",{requester:va,input:Ia,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Ub=$c.yieldResult;if(!Ub)throw"Canceled";vb=ya.resource(Ub).asDirectory();pd=vb.asFile().url;return $c.yield(U.removePackage(pd),8);case 8:return $c.yield(U.resourceCreateFiles(pd,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
da+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+da+"\n\nNo description for package "+da+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+da+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return $c.return(ya.loadPackage(U,{name:da,address:pd,configFile:vb.join("package.json").url,main:vb.join("index.js").url,test:vb.join("tests/test.js").url,type:"package"}))}})}function pc(U,va,M){M=void 0===M?null:
M;var da,Ia,Wa,Zb,Oc,Ub,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pd){switch(pd.nextAddress){case 1:return da={name:"",address:"",type:"package"},pd.yield(U.getConfig(),2);case 2:Ia=pd.yieldResult;if(!M){pd.jumpTo(3);break}return pd.yield(U.getPackage(M),4);case 4:if(Wa=pd.yieldResult){pd.jumpTo(5);break}return pd.yield(U.getPackageForModule(M),6);case 6:Wa=pd.yieldResult;case 5:Zb=Wa;case 3:return pd.yield(va.world().prompt("What is the package directory?",{requester:va,input:Zb?
Zb.address:Ia.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Oc=pd.yieldResult;if(!Oc)throw"Canceled";da.address=Oc.replace(/\/$/,"");da.url=new URL(da.address+"/");da.configFile=ya.resource(da.url).join("package.json").url;pd.setCatchFinallyBlocks(8);Ub=JSON;vb=Ub.parse;return pd.yield(U.moduleRead(da.configFile),10);case 10:vb.call(Ub,pd.yieldResult).name;pd.leaveTryBlock(9);break;case 8:pd.enterCatchBlock(),da.name=String(da.url).replace(/\/$/,""),U.resourceEnsureExistance(da.configFile,
'{\n  "name": "'+da.name+'",\n  "version": "0.1.0"\n}');case 9:return pd.return(ya.loadPackage(U,da))}})}function ld(U,va,M){var da,Ia,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zb){switch(Zb.nextAddress){case 1:return da=ya.resource(M).asFile().url,Zb.yield(U.getPackage(da),2);case 2:if(Ia=Zb.yieldResult){Zb.jumpTo(3);break}return Zb.yield(U.getPackageForModule(da),4);case 4:Ia=Zb.yieldResult;case 3:Wa=Ia;if(!Wa)throw Error("Cannot find package for "+da);return Zb.yield(U.reloadPackage(da),
5);case 5:if(!va){Zb.jumpTo(0);break}return Zb.yield(va.updateModuleList(),7);case 7:return Zb.yield(va.uiSelect(da,!1),8);case 8:return Zb.return(Zb.yieldResult)}})}function Rb(U,va,M,da){var Ia,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zb){switch(Zb.nextAddress){case 1:return Zb.yield(U.getPackage(M),2);case 2:return Ia=Zb.yieldResult,Zb.yield((da||$world).confirm("Unload package "+Ia.name+"?",{requester:va}),3);case 3:Wa=Zb.yieldResult;if(!Wa)throw"Canceled";return Zb.yield(U.removePackage(M),
4);case 4:if(!va){Zb.jumpTo(0);break}return Zb.yield(va.updateModuleList(),6);case 6:return Zb.yield(va.uiSelect(null),0)}})}function xd(U,va,M){var da,Ia,Wa,Zb,Oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ub){switch(Ub.nextAddress){case 1:return da=va.world(),Ub.yield(U.getPackage(M),2);case 2:return Ia=Ub.yieldResult,Ia?Ub.yield(da.confirm("Really remove package "+Ia.name+"?",{requester:va}),3):($world.inform('No package "'+M+'" found!',{requester:va}),Ub.return());case 3:Wa=Ub.yieldResult;
if(!Wa)throw"Canceled";U.removePackage(M);return Ub.yield(da.confirm("Also remove directory "+Ia.name+" including "+Ia.modules.length+" modules?"),4);case 4:Zb=Ub.yieldResult;if(!Zb){Ub.jumpTo(0);break}return Ub.yield(da.confirm("REALLY *remove* directory "+Ia.name+"? No undo possible..."),6);case 6:if(Oc=Ub.yieldResult)return Ub.yield(U.resourceRemove(Ia.address),0);Ub.jumpTo(0)}})}function Hd(U,va,M){M=void 0===M?$world:M;var da,Ia,Wa,Zb,Oc,Ub,vb,pd,$c,Sa,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){switch(tc.nextAddress){case 1:return tc.yield(U.getPackage(va),
2);case 2:da=tc.yieldResult;if(!da)throw Error("Cannot find package "+va);Ia=[];Wa=$jscomp.makeIterator(da.modules);Zb=Wa.next();case 3:if(Zb.done)return tc.yield(M.execCommand("open text window",{title:"imports and exports of "+va,content:Ia.join("\n\n")}),0);Oc=Zb.value;if(!Oc.name.match(/\.js$/)){tc.jumpTo(4);break}tc.setCatchFinallyBlocks(6);Ub=U;vb=Ub.importsAndExportsOf;pd=Oc.name;return tc.yield(U.moduleRead(Oc.name),9);case 9:return tc.yield(vb.call(Ub,pd,tc.yieldResult),8);case 8:$c=tc.yieldResult;
tc.leaveTryBlock(7);break;case 6:Sa=tc.enterCatchBlock();M.logError(Error("Error when getting imports/exports from module "+Oc.name+":\n"+Sa.stack));tc.jumpTo(4);break;case 7:nb=""+Oc.name;if(!$c.imports.length&&!$c.exports.length){nb+="\n  does not import / export anything";tc.jumpTo(4);break}$c.imports.length&&(nb+="\n  imports:\n",nb+=ya.arr.groupByKey($c.imports,"fromModule").mapGroups(function(ab,zc){return"from "+ab+": "+zc.map(function(Fc){return Fc.local||Fc.imported?Fc.imported&&Fc.imported!==
Fc.local?Fc.imported+" as "+Fc.local:Fc.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(ab){return"    "+ab}).join("\n"));$c.exports.length&&(nb+="\n  exports:\n",nb+=$c.exports.map(function(ab){return ab.local?ab.local&&ab.local!==ab.exported?ab.local+" as "+ab.exported:ab.exported:ab.exported+" from "+ab.fromModule}).join(", ").split("\n").map(function(ab){return"    "+ab}).join("\n"));Ia.push(nb);case 4:Zb=Wa.next(),tc.jumpTo(3)}})}function Dc(U){return U.match(/import.*['"]mocha(-es6)?['"]/)&&
U.match(/it\(['"]/)}function bc(U,va,M){M=M&&M.address;if(M&&0===va.indexOf(M))var da=va.slice(M.length).replace(/^\//,"");else a:{M=U.getConfig();if(!M||M.constructor!==Promise)try{da=String((new Ca.URL(va)).relativePathFrom(new Ca.URL(U.getConfig().baseURL)));break a}catch(Ia){}da=va}return da}function Ib(U,va,M,da){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){return 1==Ia.nextAddress?(da=Object.assign({targetModule:va},da),Ia.yield(U.normalize(va),2)):3!=Ia.nextAddress?(va=Ia.yieldResult,
Ia.yield(U.moduleSourceChange(va,M,da),3)):Ia.return(va)})}function gc(U,va,M,da,Ia){da=void 0===da?!1:da;Ia=void 0===Ia?!1:Ia;var Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zb){switch(Zb.nextAddress){case 1:return va&&va.setStatusMessage("Reloading "+M),Zb.setCatchFinallyBlocks(2),Zb.yield(U.reloadModule(M,{reloadDeps:da,resetEnv:Ia}),4);case 4:if(!va){Zb.jumpTo(5);break}return Zb.yield(va.updateModuleList(),6);case 6:case 5:va&&va.setStatusMessage("Reloded "+M);Zb.leaveTryBlock(0);
break;case 2:Wa=Zb.enterCatchBlock();Zb.setCatchFinallyBlocks(7);if(!va){Zb.jumpTo(9);break}return Zb.yield(va.updateEditorWithSourceOf(M),10);case 10:case 9:Zb.leaveTryBlock(8);break;case 7:Zb.enterCatchBlock();case 8:throw va&&va.showError(Wa),Wa;}})}function sc(U,va,M){return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){switch(da.nextAddress){case 1:return da.yield(U.forgetModule(M,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!va){da.jumpTo(3);break}return da.yield(va.updateModuleList(),
4);case 4:case 3:da.jumpToEnd()}})}function dd(U,va,M){var da,Ia,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zb){switch(Zb.nextAddress){case 1:return Zb.yield(U.normalize(M),2);case 2:return da=Zb.yieldResult,Zb.yield(va.world().confirm("Remove file "+da+"?",{requester:va}),3);case 3:Ia=Zb.yieldResult;if(!Ia)throw"Canceled";return Zb.yield(U.forgetModule(da),4);case 4:return Zb.yield(U.resourceRemove(da),5);case 5:return Zb.yield(U.getPackageForModule(da),6);case 6:return Wa=Zb.yieldResult,
Zb.return(Wa)}})}function bd(U,va,M){var da,Ia,Wa,Zb,Oc,Ub,vb,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){switch($c.nextAddress){case 1:return da=Ca.URL,$c.yield(U.getConfig(),2);case 2:Ia=new da($c.yieldResult.baseURL);Wa=va.world();if(!M){$c.jumpTo(3);break}return $c.yield(U.getPackage(M),4);case 4:if(Zb=$c.yieldResult){$c.jumpTo(5);break}return $c.yield(U.getPackageForModule(M),6);case 6:Zb=$c.yieldResult;case 5:(Oc=Zb)&&(Ia=new Ca.URL(Oc.address));case 3:return $c.yield(Ca._searchForExistingFiles(va,
String(Ia),Oc),7);case 7:Ub=$c.yieldResult;if(!Ub.includes("[create new module]")){$c.jumpTo(8);break}return $c.yield(Ca._askForModuleName(U,M||String(Ia),Wa),9);case 9:vb=$c.yieldResult,Ub=[vb];case 8:return $c.yield(Ca._createAndLoadModules(U,Ub),10);case 10:return pd=$c.yieldResult,Ca.arr.compact(pd.map(function(Sa){return Sa.error})),$c.return(pd)}})}function oc(U,va){var M,da,Ia,Wa,Zb,Oc,Ub,vb,pd,$c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sa){if(1==Sa.nextAddress)return Sa.yield(U.getPackage(va),
2);if(3!=Sa.nextAddress){M=Sa.yieldResult;if(!M||!M.address.match(/^http/))throw Error("Cannot load package "+va);da=Ca.resource(M.address);Ia=[];Wa=$jscomp;Zb=Wa.makeIterator;return Sa.yield(da.dirList(5,{exclude:Ca.modulesInPackage_defaultExclude}),3)}Oc=Zb.call(Wa,Sa.yieldResult);for(Ub=Oc.next();!Ub.done;Ub=Oc.next())pd=vb=Ub.value,$c=pd.url,$c.match(/\.js$/)&&U.isModuleLoaded($c,!0)&&Ia.push(U.getModule($c));return Sa.return(Ia)})}function $a(U){U||(U="local");if(U.isSystemInterface)var va=U;
else"string"===typeof U&&U.startsWith("l2l ")&&(U={type:"l2l",id:U.split(" ")[1]}),"string"!==typeof U&&"l2l"===U.type&&(va=Za.l2lInterfaceFor(U.id,U.info)),"string"!==typeof U&&($world.setStatusMessage("Unknown system interface "+U),U="local"),va||(va=U&&"local"!==U?Za.serverInterfaceFor(U):Za.localInterface);return va}ta("systemInterfaceNamed",$a);var fb=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");fb.parseJsonLikeObj=ce;fb.ast=cb;fb.parseJsonLikeObj=ce;fb.parseJsonLikeObj=
ce;var ya=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");ya.loadPackage=function(U,va){var M,da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){switch(Ia.nextAddress){case 1:return Ia.yield(U.importPackage(va.address+"/"),2);case 2:if(!va.main){Ia.jumpTo(3);break}return Ia.yield(U.importModule(va.main.toString()),3);case 3:if(!va.test){Ia.jumpTo(5);break}Ia.setCatchFinallyBlocks(6);return Ia.yield(U.importPackage("mocha-es6"),8);case 8:return M=Ia.yieldResult,
Ia.yield(M.installSystemInstantiateHook(),9);case 9:return Ia.yield(U.importModule(va.test.toString()),10);case 10:Ia.leaveTryBlock(5);break;case 6:da=Ia.enterCatchBlock(),console.warn("Cannot load test of new package: "+da);case 5:return Ia.return(U.getPackage(va.address))}})};ya.interactivelyCreatePackage=Qb;ya.interactivelyLoadPackage=pc;ya.interactivelyReloadPackage=ld;ya.interactivelyUnloadPackage=Rb;ya.interactivelyRemovePackage=xd;ya.showExportsAndImportsOf=Hd;ya.parseJsonLikeObj=ce;ya.arr=
mb;ya.resource=Sb;ya.interactivelyCreatePackage=Qb;ya.interactivelyCreatePackage=Qb;ya.interactivelyLoadPackage=pc;ya.interactivelyLoadPackage=pc;ya.interactivelyReloadPackage=ld;ya.interactivelyReloadPackage=ld;ya.interactivelyUnloadPackage=Rb;ya.interactivelyUnloadPackage=Rb;ya.interactivelyRemovePackage=xd;ya.interactivelyRemovePackage=xd;ya.showExportsAndImportsOf=Hd;ya.showExportsAndImportsOf=Hd;var Ca=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");Ca.isTestModule=
Dc;Ca.shortModuleName=bc;Ca.interactivelyChangeModule=Ib;Ca.interactivelyReloadModule=gc;Ca.interactivelyUnloadModule=sc;Ca.interactivelyRemoveModule=dd;Ca.interactivelyAddModule=bd;Ca._askForModuleName=function(U,va,M){var da,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return Wa.yield(M.prompt("Enter module name",{input:va,historyId:"lively.vm-editor-add-module-name"}),2);case 2:va=Wa.yieldResult;if(!va)throw"Canceled";return Wa.yield(U.normalize(va),
3);case 3:return da=Wa.yieldResult,Wa.yield(M.confirm(["Create module \n",{},da,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Ia=Wa.yieldResult;if(!Ia)throw"Canceled";return Wa.return(da)}})};Ca._searchForExistingFiles=function(U,va,M){return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){return String(va).match(/^http/)?da.return(Ca._searchForExistingFilesWeb(U,va,M)):da.return(Ca._searchForExistingFilesManually(U,va,M))})};Ca._searchForExistingFilesManually=function(U,va,
M){var da,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){switch(Wa.nextAddress){case 1:return Wa.yield(U.world().multipleChoicePrompt("Add Module",{requester:U,choices:["Create New Module","Load Existing Module"]}),2);case 2:da=Wa.yieldResult;if("Create New Module"===da)return Wa.return("[create new module]");if("Load Existing Module"!==da){Wa.jumpTo(3);break}return Wa.yield(U.world().prompt("URL of module?",{input:va,requester:U,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(Ia=Wa.yieldResult)return Wa.return([Ia]);case 3:throw"Canceled";}})};Ca._searchForExistingFilesWeb=function(U,va,M){function da(pd){pd.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(pd.name())||M&&Ca.arr.pluck(M.modules,"name").includes(pd.url)?!0:!1}var Ia,Wa,Zb,Oc,Ub,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pd){switch(pd.nextAddress){case 1:return(Ia=U.world())&&(Wa=Ia.showLoadingIndicatorFor(U,"Loading existing modules...")),
pd.yield(Ca.resource(va).dirList(5,{exclude:da}),3);case 3:return pd.yield(pd.yieldResult.map(function($c){return $c.url}),2);case 2:return Zb=pd.yieldResult,Oc=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Zb.filter(function($c){return $c.endsWith(".js")}).map(function($c){return{isListItem:!0,string:M&&0==$c.indexOf(M.address)?M.name+$c.slice(M.address.length):$c,value:$c}})),pd.yield(Promise.resolve(Wa&&Wa.remove()).then(function(){return U.world().filterableListPrompt("What module to load?",
Oc,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:U},U?{extent:U.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Ub=pd.yieldResult;if(!Ub||"canceled"===Ub.status||!Ub.selected.length)throw"Canceled";vb=Ub.selected||Ub;Array.isArray(vb)||(vb=[vb]);return pd.return(vb)}})};Ca._createAndLoadModules=function(U,va){var M,da,Ia,Wa,Zb,Oc,Ub,vb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pd){switch(pd.nextAddress){case 1:Array.isArray(va)||(va=[va]),M=[],da=$jscomp.makeIterator(va),
Ia=da.next();case 2:if(Ia.done){pd.jumpTo(4);break}Wa=Ia.value;return pd.yield(U.forgetModule(Wa,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return pd.yield(U.resourceEnsureExistance(Wa,'"format esm";\n'),6);case 6:return Zb=pd.yieldResult,Oc=Ca,Ub=Oc.isTestModule,pd.yield(Zb.read(),7);case 7:if(!Ub.call(Oc,pd.yieldResult)){pd.jumpTo(8);break}if(window.Mocha&&window.chai){pd.jumpTo(8);break}return pd.yield(System.import("mocha-es6"),10);case 10:return pd.yield(Ca.promise.waitFor(function(){return!!window.Mocha&&
!!window.chai}),8);case 8:return pd.setCatchFinallyBlocks(12),pd.yield(U.importModule(Wa),14);case 14:M.push({name:Wa});pd.leaveTryBlock(3);break;case 12:vb=pd.enterCatchBlock(),M.push({name:Wa,error:vb});case 3:Ia=da.next();pd.jumpTo(2);break;case 4:return pd.return(M)}})};Ca.modulesInPackage_defaultExclude=function(U){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(U.name())?!0:!1};Ca.modulesInPackage=oc;Ca.obj=Jb;Ca.promise=sd;Ca.arr=mb;Ca.resource=Sb;Ca.isTestModule=
Dc;Ca.isTestModule=Dc;Ca.shortModuleName=bc;Ca.shortModuleName=bc;Ca.interactivelyChangeModule=Ib;Ca.interactivelyChangeModule=Ib;Ca.interactivelyReloadModule=gc;Ca.interactivelyReloadModule=gc;Ca.interactivelyUnloadModule=sc;Ca.interactivelyUnloadModule=sc;Ca.interactivelyRemoveModule=dd;Ca.interactivelyRemoveModule=dd;Ca.interactivelyAddModule=bd;Ca.interactivelyAddModule=bd;Ca.modulesInPackage=oc;Ca.modulesInPackage=oc;var Aa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
Aa.todo=function(U){throw Error(U+" is not yet implemented!");};Aa.parseJsonLikeObj=ce;Aa.arr=mb;Aa.Closure=vc;Aa.obj=Jb;Aa.resource=Sb;Aa.transform=wd;Aa.modules=wc;var xa=function(){};xa.prototype.dynamicCompletionsForPrefix=function(U,va,M){return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){Aa.todo("dynamicCompletionsForPrefix");da.jumpToEnd()})};xa.prototype.runEval=function(U,va){Aa.todo("runEval")};xa.prototype.resourceExists=function(U){Aa.todo("resourceExists")};xa.prototype.resourceEnsureExistance=
function(U,va){Aa.todo("resourceEnsureExistance")};xa.prototype.resourceMkdir=function(U){Aa.todo("resourceMkdir")};xa.prototype.resourceRead=function(U){Aa.todo("resourceRead")};xa.prototype.resourceRemove=function(U){Aa.todo("resourceRemove")};xa.prototype.resourceWrite=function(U,va){Aa.todo("resourceWrite")};xa.prototype.resourceCreateFiles=function(U,va){Aa.todo("resourceCreateFiles")};xa.prototype.resourceDirList=function(U,va,M){Aa.todo("resourceDirList")};xa.prototype.normalizeSync=function(U,
va,M){Aa.todo("normalizeSync")};xa.prototype.normalize=function(U,va,M){Aa.todo("normalize")};xa.prototype.printSystemConfig=function(){Aa.todo("printSystemConfig")};xa.prototype.getConfig=function(){Aa.todo("getConfig")};xa.prototype.setConfig=function(U){Aa.todo("setConfig")};xa.prototype.getPackages=function(U){Aa.todo("getPackages")};xa.prototype.isModuleLoaded=function(U,va){Aa.todo("isModuleLoaded")};xa.prototype.doesModuleExist=function(U,va){Aa.todo("doesModuleExist")};xa.prototype.getModules=
function(){var U=this,va,M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){return 1==da.nextAddress?(va=Aa.arr,M=va.flatmap,da.yield(U.getPackages(),2)):da.return(M.call(va,da.yieldResult,function(Ia){return Ia.modules}))})};xa.prototype.getModule=function(U){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return 1==M.nextAddress?M.yield(va.getModules(),2):M.return(M.yieldResult.find(function(da){return da.name===U}))})};xa.prototype.getPackage=function(U){var va=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return 1==M.nextAddress?(U=U.replace(/\/+$/,""),M.yield(va.getPackages(),2)):M.return(M.yieldResult.find(function(da){return da.address===U||da.name===U}))})};xa.prototype.getPackageForModule=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){Aa.todo("getPackageForModule");va.jumpToEnd()})};xa.prototype.systemConfChange=function(U){var va=Aa.parseJsonLikeObj(U);["baseURL"].forEach(function(M){return delete va[M]});
return this.setConfig(va)};xa.prototype.resourcesOfPackage=function(U,va){return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){Aa.todo("resourcesOfPackage");M.jumpToEnd()})};xa.prototype.registerPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){Aa.todo("registerPackage");va.jumpToEnd()})};xa.prototype.importPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){Aa.todo("importPackage");va.jumpToEnd()})};xa.prototype.removePackage=
function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){Aa.todo("removePackage");va.jumpToEnd()})};xa.prototype.reloadPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){Aa.todo("reloadPackage");va.jumpToEnd()})};xa.prototype.packageConfChange=function(U,va){return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){Aa.todo("packageConfChange");M.jumpToEnd()})};xa.prototype.importModule=function(U){Aa.todo("importModule")};xa.prototype.forgetModule=
function(U,va){Aa.todo("forgetModule")};xa.prototype.reloadModule=function(U,va){Aa.todo("reloadModule")};xa.prototype.moduleFormat=function(U){Aa.todo("moduleFormat")};xa.prototype.moduleRead=function(U){Aa.todo("moduleRead")};xa.prototype.moduleSourceChange=function(U,va,M){Aa.todo("moduleSourceChange")};xa.prototype.importsAndExportsOf=function(U,va){Aa.todo("importsAndExportsOf")};xa.prototype.keyValueListOfVariablesInModule=function(U,va){Aa.todo("keyValueListOfVariablesInModule")};xa.prototype.moduleWrite=
function(U,va){return this.moduleSourceChange(U,va)};Aa.AbstractCoreInterface=xa;var Oa=function(){var U=Aa.AbstractCoreInterface.call(this)||this;U.currentEval=null;return U};$jscomp.inherits(Oa,Aa.AbstractCoreInterface);Oa.prototype.runEval=function(U,va){throw Error("Not yet implemented");};Oa.prototype.runEvalAndStringify=function(U,va){var M=this;return this.currentEval?this.currentEval.then(function(){return M.runEvalAndStringify(U,va)}):this.currentEval=Promise.resolve().then(function(){var da,
Ia,Wa,Zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oc){switch(Oc.nextAddress){case 1:return Oc.yield(M.runEval("\n        Promise.resolve((async "+Aa.transform.wrapInFunction(U)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},va)),2);case 2:if((da=Oc.yieldResult)&&da.isError)throw Error(String(da.value||da.error));if(!da||!da.value)return Oc.return(null);if(Ia=da.promisedValue){Oc.jumpTo(3);break}return Oc.yield(da.value,4);case 4:Ia=Oc.yieldResult;case 3:Wa=Ia;if(!Wa)return Oc.return();if("undefined"===Wa)return Oc.return(void 0);if("null"===Wa)return Oc.return(null);if("true"===Wa)return Oc.return(!0);
if("false"===Wa)return Oc.return(!1);try{Zb=JSON.parse(Wa)}catch(Ub){return Oc.return(Wa)}if(Zb&&Zb.isError)throw Error(String(Zb.value));return Oc.return(Zb)}})}).then(function(da){delete M.currentEval;return da},function(da){delete M.currentEval;return Promise.reject(da)})};Oa.prototype.dynamicCompletionsForPrefix=function(U,va,M){var da=this,Ia,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zb){Ia=Aa.obj.isString(M.context)?M.context:!1;M=Aa.obj.dissoc(M,["systemInterface","System",
"context"]);Wa="\n      var prefix = "+JSON.stringify(va)+",\n          opts = "+JSON.stringify(M)+";\n      opts.context = "+Ia+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Zb.return(da.runEvalAndStringify(Wa))})};Oa.prototype.evalWithResource=function(U,va,M){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+U+'").'+va+"("+(M?JSON.stringify(M):"")+");\n    ")};Oa.prototype.resourceExists=function(U){return this.evalWithResource(U,"exists")};Oa.prototype.resourceEnsureExistance=function(U,va){return this.evalWithResource(U,
"ensureExistance",va)};Oa.prototype.resourceMkdir=function(U){return this.evalWithResource(U,"mkdir")};Oa.prototype.resourceRead=function(U){return this.evalWithResource(U,"read")};Oa.prototype.resourceRemove=function(U){return this.evalWithResource(U,"remove")};Oa.prototype.resourceWrite=function(U,va){return this.evalWithResource(U,"write",va)};Oa.prototype.resourceCreateFiles=function(U,va){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
U+'", '+JSON.stringify(va)+")")};Oa.prototype.resourceDirList=function(U,va,M){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+U+'").dirList('+JSON.stringify(va)+", "+JSON.stringify(M)+"))\n        .map(({url}) => ({url}))")};Oa.prototype.livelySystemAccessor=function(U){U=void 0===U?"livelySystem":U;return"var "+U+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
U+') throw new Error("lively-system-interface not available!");'};Oa.prototype.normalizeSync=function(U,va,M){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(U)+", "+JSON.stringify(va)+", "+M+")")};Oa.prototype.normalize=function(U,va,M){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(U)+", "+JSON.stringify(va)+", "+JSON.stringify(M)+")")};Oa.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
Oa.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};Oa.prototype.setConfig=function(U){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(U)+")")};Oa.prototype.getPackages=function(U){U=Object.assign({excluded:[]},U);U.excluded=U.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(U)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};Oa.prototype.getPackageForModule=function(U){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(U)+")")};Oa.prototype.isModuleLoaded=function(U,va){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+U+'", '+va+")")};Oa.prototype.doesModuleExist=function(U,va){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+U+'", '+va+")")};Oa.prototype.registerPackage=function(U){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return M.return(va.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(U)+")"))})};Oa.prototype.importPackage=
function(U){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return M.return(va.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(U)+")"))})};Oa.prototype.removePackage=function(U){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return M.return(va.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(U)+")"))})};Oa.prototype.reloadPackage=function(U,va){var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){return da.return(M.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(U)+", "+JSON.stringify(va)+")"))})};Oa.prototype.packageConfChange=function(U,va){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(U)+", "+JSON.stringify(va)+")")};Oa.prototype.resourcesOfPackage=function(U,va){va=void 0===va?[".git","node_modules",".module_cache","lively.next-node_modules"]:va;var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){U.address&&(U=
U.address);return da.return(M.runEvalAndStringify("\n      "+M.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(U)+", "+JSON.stringify(va)+");"))})};Oa.prototype.getModule=function(U){var va=this,M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){if(1==da.nextAddress)return da.yield(va.getModules(),2);M=da.yieldResult.find(function(Ia){return Ia.name===U});return da.return(M?Aa.modules.module(M.name):null)})};Oa.prototype.importModule=
function(U){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(U)+")")};Oa.prototype.forgetModule=function(U,va){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(U)+").unload("+JSON.stringify(va)+")")};Oa.prototype.reloadModule=function(U,va){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(U)+").reload("+JSON.stringify(va)+")")};Oa.prototype.moduleFormat=function(U){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(U)+").format();")};Oa.prototype.moduleRead=function(U){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(U)+").source()")};Oa.prototype.moduleSourceChange=function(U,va,M){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(U)+").changeSource("+JSON.stringify(va)+", "+JSON.stringify(M)+")")};Oa.prototype.keyValueListOfVariablesInModule=function(U,va){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(U)+", "+JSON.stringify(va)+")")};Oa.prototype.importsAndExportsOf=function(U,va){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(U)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(U)+").exports()})")};Oa.prototype.exportsOfModules=function(U){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(U)+";\n      options.excludedPackages = ["+U.excludedPackages.map(function(va){return"function"===
typeof va?va.toString():JSON.stringify(va)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};Oa.prototype.searchInPackage=function(U,va,M){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(U)+", "+JSON.stringify(va)+", "+JSON.stringify(M)+")")};Oa.prototype.loadMochaTestFile=function(U,va){va=void 0===va?[]:va;var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){return da.return(M.runEvalAndStringify("\n      "+
M.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(U)+", "+JSON.stringify(va)+"), result;\n      result = {testsByFile}"))})};Oa.prototype.runMochaTests=function(U,va,M,da){var Ia=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){U&&U instanceof RegExp&&(U={isRegExp:!0,value:String(U).replace(/^\/|\/$/g,"")});return Wa.return(Ia.runEvalAndStringify("\n      var grep = "+JSON.stringify(U)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Ia.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(va||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Aa.RemoteCoreInterface=Oa;var wb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");wb.obj=Jb;wb.string=Cc;wb.arr=mb;wb.resource=Sb;wb.createFiles=Gc;wb.ast=cb;wb.modules=wc;wb.vm=Cd;wb.parseJsonLikeObj=ce;wb.AbstractCoreInterface=xa;wb.classToFunctionTransform=pe;xa=function(){return wb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(xa,wb.AbstractCoreInterface);xa.prototype.dynamicCompletionsForPrefix=function(U,va,M){var da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){if(1==
Ia.nextAddress)return Ia.yield(wb.vm.completions.getCompletions(function(Wa){return wb.vm.runEval(Wa.replace("return ",""),Object.assign({targetModule:U,classTransform:wb.classToFunctionTransform},M))},va),2);da=Ia.yieldResult;if(da.isError)throw da.value;return Ia.return({completions:da.completions,prefix:da.startLetters})})};xa.prototype.runEval=function(U,va){return wb.vm.runEval(U,Object.assign({classTransform:wb.classToFunctionTransform},va))};xa.prototype.resourceExists=function(U){return wb.resource(U).exists()};
xa.prototype.resourceEnsureExistance=function(U,va){return wb.resource(U).ensureExistance(va)};xa.prototype.resourceMkdir=function(U){return wb.resource(U).mkdir()};xa.prototype.resourceRead=function(U){return wb.resource(U).read()};xa.prototype.resourceRemove=function(U){return wb.resource(U).remove()};xa.prototype.resourceWrite=function(U,va){return wb.resource(U).write(va)};xa.prototype.resourceCreateFiles=function(U,va){return wb.createFiles(U,va)};xa.prototype.resourceDirList=function(U,va,M){return wb.resource(U).dirList(va,
M)};xa.prototype.normalizeSync=function(U,va,M){return System.decanonicalize(U,va,M)};xa.prototype.normalize=function(U,va,M){return System.normalize(U,va,M)};xa.prototype.printSystemConfig=function(){return wb.modules.printSystemConfig()};xa.prototype.getConfig=function(){return System.getConfig()};xa.prototype.setConfig=function(U){wb.modules.System.config(U)};xa.prototype.getPackages=function(U){U=Object.assign({},U);U=void 0===U.excluded?[]:U.excluded;var va=U.filter(function(da){return"string"===
typeof da}),M=U.filter(function(da){return"function"===typeof da});va=va.concat(va.map(function(da){return System.decanonicalize(da.replace(/\/?$/,"/")).replace(/\/$/,"")}));return wb.modules.getPackages().filter(function(da){return!va.includes(da.url)&&!M.some(function(Ia){return Ia(da.url)})})};xa.prototype.registerPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){return va.return(wb.modules.registerPackage(U))})};xa.prototype.importPackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){return va.return(wb.modules.importPackage(U))})};
xa.prototype.removePackage=function(U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){return va.return(wb.modules.removePackage(U))})};xa.prototype.reloadPackage=function(U,va){return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return M.return(wb.modules.reloadPackage(U,va))})};xa.prototype.packageConfChange=function(U,va){var M=this,da,Ia,Wa,Zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oc){if(1==Oc.nextAddress)return da=wb.modules.System,Ia=wb.parseJsonLikeObj(U),
Wa=JSON.stringify(Ia,null,2),Oc.yield(wb.modules.module(va).changeSource(Wa,{doEval:!1}),2);if(3!=Oc.nextAddress)return da.set(va,da.newModule(Ia)),Oc.yield(M.getPackageForModule(va),3);(Zb=Oc.yieldResult)&&wb.modules.applyPackageConfig(Ia,Zb.address);Oc.jumpToEnd()})};xa.prototype.resourcesOfPackage=function(U,va){va=void 0===va?[".git","node_modules",".module_cache"]:va;var M,da,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){if(1==Wa.nextAddress)return Wa.setCatchFinallyBlocks(2),
M=U.address?U.address:U,da=wb.modules.getPackage(M),Wa.yield(da.resources(void 0,va),4);if(2!=Wa.nextAddress)return Wa.return(Wa.yieldResult.map(function(Zb){return Object.assign(Zb,{package:Zb.package.url})}));Ia=Wa.enterCatchBlock();console.warn("resourcesOfPackage error for "+U+": "+Ia);return Wa.return([])})};xa.prototype.getPackageForModule=function(U){return(U=wb.modules.getPackageOfModule(U))?U.asSpec():U};xa.prototype.isModuleLoaded=function(U,va){return wb.modules.isModuleLoaded(U,va)};xa.prototype.doesModuleExist=
function(U,va){return wb.modules.isModuleLoaded(U,va)};xa.prototype.getModule=function(U){return wb.modules.module(U)};xa.prototype.importModule=function(U){return wb.modules.System.import(U)};xa.prototype.forgetModule=function(U,va){return wb.modules.module(U).unload(va)};xa.prototype.reloadModule=function(U,va){return wb.modules.module(U).reload(va)};xa.prototype.moduleFormat=function(U){return wb.modules.module(U).format()};xa.prototype.moduleRead=function(U){return wb.modules.module(U).source()};
xa.prototype.moduleSourceChange=function(U,va,M){return wb.modules.module(U).changeSource(va,M)};xa.prototype.keyValueListOfVariablesInModule=function(U,va){var M=this,da,Ia,Wa,Zb,Oc,Ub,vb,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){switch($c.nextAddress){case 1:if(va){$c.jumpTo(2);break}return $c.yield(M.resourceRead(U),3);case 3:va=$c.yieldResult;case 2:return da="string"===typeof va?wb.ast.parse(va):va,Ia=M.normalizeSync(U),M.moduleFormat(Ia),Wa=wb.modules.module(Ia).env().recorder,
$c.yield(M.importsAndExportsOf(Ia,da),4);case 4:return Zb=$c.yieldResult,Oc=wb.ast.query.topLevelDeclsAndRefs(da),Ub=wb.arr.sortByKey(wb.ast.query.declarationsOfScope(Oc.scope,!0),"start"),vb=wb.arr.pluck(Oc.scope.importSpecifiers,"name"),pd=0,$c.return(Ub.map(function(Sa){var nb=Sa.name.length,tc=Zb.exports.find(function(zc){return zc.local===Sa.name}),ab=wb.arr.include(vb,Sa.name);tc&&(nb+=9);ab&&(nb+=9);pd=Math.max(pd,nb);return{isExport:tc,isImport:ab,name:Sa.name,value:Wa[Sa.name],node:Sa,printedName:Sa.name+
(tc?" [export]":"")+(ab?" [import]":""),printedValue:wb.obj.inspect(Wa[Sa.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(Sa){return{isListItem:!0,value:Sa,string:Sa.printedName+wb.string.indent(" = "+Sa.printedValue," ",pd-Sa.printedName.length)}}))}})};xa.prototype.importsAndExportsOf=function(U,va){var M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(da){return 1==da.nextAddress?da.yield(wb.modules.module(U).imports(va),2):3!=da.nextAddress?(M=da.yieldResult,da.yield(wb.modules.module(U).exports(va),
3)):da.return({imports:M,exports:da.yieldResult})})};xa.prototype.exportsOfModules=function(U){return wb.modules.ExportLookup.run(System,U)};xa.prototype.searchInPackage=function(U,va,M){return wb.modules.getPackage(U).search(va,M)};xa.prototype.runMochaTests=function(U,va,M,da){var Ia,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zb){if(1==Zb.nextAddress)return Zb.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Ia=Zb.yieldResult;Wa=Ia.runMochaTests;return Zb.return(Wa(U,
va,M,da))})};xa.prototype.loadMochaTestFile=function(U,va){var M,da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ia){if(1==Ia.nextAddress)return Ia.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);M=Ia.yieldResult;da=M.loadMochaTestFile;return Ia.return(da(U,va))})};$jscomp.global.Object.defineProperties(xa.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});wb.LocalCoreInterface=xa;var dc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");
dc.evalStrategies=Je;dc.RemoteCoreInterface=Oa;var Ya=function(U){var va=dc.RemoteCoreInterface.call(this)||this;va.currentEval=null;va.url=U;va.server=new dc.evalStrategies.HttpEvalStrategy(U);return va};$jscomp.inherits(Ya,dc.RemoteCoreInterface);Ya.prototype.runEval=function(U,va){return this.server.runEval(U,va)};$jscomp.global.Object.defineProperties(Ya.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,
"")}}});dc.HTTPCoreInterface=Ya;var jb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");jb.evalStrategies=Je;jb.RemoteCoreInterface=Oa;Oa=function(U,va){var M=jb.RemoteCoreInterface.call(this)||this;M.targetId=U;M.peer=va;return M};$jscomp.inherits(Oa,jb.RemoteCoreInterface);Oa.prototype.isConnected=function(){var U=this,va,M,da,Ia,Wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zb){if(1==Zb.nextAddress)return va=U,M=va.client,da=va.targetId,
Zb.yield(M.sendToAndWait(M.trackerId,"getClients",{}),2);Ia=Zb.yieldResult;Wa=Ia.data;return Zb.return(Wa.some(function(Oc){Oc=$jscomp.makeIterator(Oc).next().value;return da===Oc}))})};Oa.prototype.runEval=function(U,va){var M=this,da,Ia;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wa){da=M.client;if(!da)throw Error("No lively.2lively default client available!");Ia=new jb.evalStrategies.L2LEvalStrategy(da,M.targetId);return Wa.return(Ia.runEval(U,va))})};$jscomp.global.Object.defineProperties(Oa.prototype,
{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var U=this.peer,va="l2l "+this.targetId.slice(0,5);if(U){var M=U.location,da=U.type,Ia=U.user;U=U.world;da&&(va+=", "+da);M&&(va+=", "+M.replace(/^https?:\/\//,"")+(U?"/"+U:""));Ia&&(va+=", "+Ia.name)}return va}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});
jb.L2LCoreInterface=Oa;var Za=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Za.systemInterfaceNamed=$a;Za.interactivelyCreatePackage=Qb;Za.interactivelyLoadPackage=pc;Za.interactivelyReloadPackage=ld;Za.interactivelyUnloadPackage=Rb;Za.interactivelyRemovePackage=xd;Za.showExportsAndImportsOf=Hd;Za.shortModuleName=bc;Za.interactivelyChangeModule=Ib;Za.interactivelyReloadModule=gc;Za.interactivelyUnloadModule=sc;Za.interactivelyRemoveModule=dd;Za.interactivelyAddModule=bd;Za.modulesInPackage=
oc;Za.LocalCoreInterface=xa;Za.HTTPCoreInterface=Ya;Za.L2LCoreInterface=Oa;Oa=function(U){this.coreInterface=U};Oa.prototype.dynamicCompletionsForPrefix=function(U,va,M){return this.coreInterface.dynamicCompletionsForPrefix(U,va,M)};Oa.prototype.runEval=function(U,va){return this.coreInterface.runEval(U,va)};Oa.prototype.printSystemConfig=function(U,va,M){return this.coreInterface.printSystemConfig(U,va,M)};Oa.prototype.getConfig=function(U,va,M){return this.coreInterface.getConfig(U,va,M)};Oa.prototype.getPackages=
function(U){return this.coreInterface.getPackages(U)};Oa.prototype.getModules=function(U,va,M){return this.coreInterface.getModules(U,va,M)};Oa.prototype.getModule=function(U,va,M){return this.coreInterface.getModule(U,va,M)};Oa.prototype.getPackage=function(U,va,M){return this.coreInterface.getPackage(U,va,M)};Oa.prototype.getPackageForModule=function(U,va,M){return this.coreInterface.getPackageForModule(U,va,M)};Oa.prototype.resourcesOfPackage=function(U,va){return this.coreInterface.resourcesOfPackage(U,
va)};Oa.prototype.systemConfChange=function(U,va,M){return this.coreInterface.systemConfChange(U,va,M)};Oa.prototype.registerPackage=function(U){return this.coreInterface.registerPackage(U)};Oa.prototype.importPackage=function(U){return this.coreInterface.importPackage(U)};Oa.prototype.removePackage=function(U){return this.coreInterface.removePackage(U)};Oa.prototype.reloadPackage=function(U){return this.coreInterface.reloadPackage(U)};Oa.prototype.packageConfChange=function(U,va){return this.coreInterface.packageConfChange(U,
va)};Oa.prototype.keyValueListOfVariablesInModule=function(U,va){return this.coreInterface.keyValueListOfVariablesInModule(U,va)};Oa.prototype.interactivelyCreatePackage=function(U){return Za.interactivelyCreatePackage(this.coreInterface,U)};Oa.prototype.interactivelyLoadPackage=function(U,va){return Za.interactivelyLoadPackage(this.coreInterface,U,va)};Oa.prototype.interactivelyReloadPackage=function(U,va){return Za.interactivelyReloadPackage(this.coreInterface,U,va)};Oa.prototype.interactivelyUnloadPackage=
function(U,va,M){return Za.interactivelyUnloadPackage(this.coreInterface,U,va,M)};Oa.prototype.interactivelyRemovePackage=function(U,va){return Za.interactivelyRemovePackage(this.coreInterface,U,va)};Oa.prototype.isModuleLoaded=function(U,va){return this.coreInterface.isModuleLoaded(U,va)};Oa.prototype.doesModuleExist=function(U,va){return this.coreInterface.doesModuleExist(U,va)};Oa.prototype.importModule=function(U){return this.coreInterface.importModule(U)};Oa.prototype.forgetModule=function(U,
va){return this.coreInterface.forgetModule(U,va)};Oa.prototype.reloadModule=function(U,va){return this.coreInterface.reloadModule(U,va)};Oa.prototype.moduleFormat=function(U){return this.coreInterface.moduleFormat(U)};Oa.prototype.moduleRead=function(U){return this.coreInterface.moduleRead(U)};Oa.prototype.moduleWrite=function(U,va){return this.coreInterface.moduleWrite(U,va)};Oa.prototype.getModulesInPackage=function(U){return Za.modulesInPackage(this.coreInterface,U)};Oa.prototype.shortModuleName=
function(U,va){return Za.shortModuleName(this.coreInterface,U,va)};Oa.prototype.interactivelyChangeModule=function(U,va,M){return Za.interactivelyChangeModule(this.coreInterface,U,va,M)};Oa.prototype.interactivelyReloadModule=function(U,va){return Za.interactivelyReloadModule(this.coreInterface,U,va)};Oa.prototype.interactivelyUnloadModule=function(U,va){return Za.interactivelyUnloadModule(this.coreInterface,U,va)};Oa.prototype.interactivelyRemoveModule=function(U,va){return Za.interactivelyRemoveModule(this.coreInterface,
U,va)};Oa.prototype.interactivelyAddModule=function(U,va){return Za.interactivelyAddModule(this.coreInterface,U,va)};Oa.prototype.showExportsAndImportsOf=function(U,va){return Za.showExportsAndImportsOf(this.coreInterface,U,va)};Oa.prototype.exportsOfModules=function(U){return this.coreInterface.exportsOfModules(U)};Oa.prototype.searchInPackage=function(U,va,M){return this.coreInterface.searchInPackage(U,va,M)};Oa.prototype.searchInAllPackages=function(U,va){va=void 0===va?{}:va;var M=this,da,Ia,
Wa,Zb,Oc,Ub,vb,pd;return $jscomp.asyncExecutePromiseGeneratorProgram(function($c){switch($c.nextAddress){case 1:return(da=va.progress)&&da.step("Fetching Packages...",0),$c.yield(M.coreInterface.getPackages({excluded:va.excludedPackages}),2);case 2:Ia=$c.yieldResult,Wa=[],da&&da.step("Fetching Packages...",.1),Zb=0;case 3:if(!(Zb<Ia.length)){$c.jumpTo(5);break}Oc=Ia[Zb];Ub=Oc.url;if(!Ub||"no group"===Ub){$c.jumpTo(4);break}da&&da.step(Ub.replace(System.baseURL,"").slice(0,20),.1+Zb/Ia.length*.9);
$c.setCatchFinallyBlocks(6);return $c.yield(M.coreInterface.searchInPackage(Ub,U,va),8);case 8:vb=$c.yieldResult;Wa=Wa.concat(vb);$c.leaveTryBlock(4);break;case 6:pd=$c.enterCatchBlock(),console.error("Error searching in package "+Ub+":\n"+pd.stack);case 4:Zb++;$c.jumpTo(3);break;case 5:return $c.return(Wa)}})};Oa.prototype.loadMochaTestFile=function(U,va){return this.coreInterface.loadMochaTestFile(U,va)};Oa.prototype.runMochaTests=function(U,va,M,da){return this.coreInterface.runMochaTests(U,va,
M,da)};$jscomp.global.Object.defineProperties(Oa.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});ta("Interface",Oa);Za.Interface=Oa;Za.systemInterfaceNamed=$a;Za.systemInterfaceNamed=$a;Oa=ta("localInterface",new Za.Interface(new Za.LocalCoreInterface));Za.localInterface=Oa;Za.localInterface=Oa;Za.localInterface=Oa;Za.httpInterfaces={};Oa=ta("serverInterfaceFor",function(U){return Za.httpInterfaces[U]||
(Za.httpInterfaces[U]=new Za.Interface(new Za.HTTPCoreInterface(U)))});Za.serverInterfaceFor=Oa;Za.serverInterfaceFor=Oa;Za.serverInterfaceFor=Oa;Za.l2lInterfaces={};Oa=ta("l2lInterfaceFor",function(U,va){return Za.l2lInterfaces[U]||(Za.l2lInterfaces[U]=new Za.Interface(new Za.L2LCoreInterface(U,va)))});Za.l2lInterfaceFor=Oa;Za.l2lInterfaceFor=Oa;Za.l2lInterfaceFor=Oa}}});