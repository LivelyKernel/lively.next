System.register(["./__rootModule___commonjs-entry-71573ff5.js"],function(Lc,pd){var Nd,Tc,Jc,$d,Bb,rd,Id,Ac,Pc,gd,nd,Fd,ic,vd,sb,Xb,Nb,bc,hb,cb,Hb,ec,ub,yb,ba,wb,Xa,Za,Sb,Cb,Da,zb,db,ib,Ea,W,T,ia,ka;return{setters:[function(K){Nd=K.j;Tc=K.f;Jc=K.l;$d=K.ae;Bb=K.af;rd=K.ag;Id=K.ah;Ac=K.ai;Pc=K.aj;gd=K.ak;nd=K.ad;Fd=K.ac;ic=K.al;vd=K.am;sb=K.y;Xb=K.x;Nb=K.z;bc=K.an;hb=K.a0;cb=K.ao;Hb=K._;ec=K.G;ub=K.k;yb=K.B;ba=K.d;wb=K.g;Xa=K.ap;Za=K.aq;Sb=K.ar;Cb=K.as;Da=K.at;zb=K.a6;db=K.au;ib=K.av;Ea=K.U;W=K.aw;
T=K.ax;ia=K.D;ka=K.ay}],execute:function(){function K(y,A,H){var Z=3<arguments.length&&void 0!==arguments[3]?arguments[3]:H.name;(y[A]=yf.fun.wrap(y[A],H)).hookFunc=H;H.hookName=Z}function ya(y,A,H){for(var Z=[],M=y[A];M;)Z.push(M),M=M.originalFunction;M="string"===typeof H?Z.find(function(qa){return qa.hookFunc&&qa.hookFunc.hookName===H}):Z.find(function(qa){return qa.hookFunc===H});if(!M)return!1;yf.arr.remove(Z,M);y[A]=Z.reduceRight(function(qa,Pa){return yf.fun.wrap(qa,Pa.hookFunc||Pa)});return!0}
function pb(y,A,H){for(y=y[A];y;){if(y.hookFunc&&("string"===typeof H&&y.hookFunc.hookName===H||y.hookFunc===H))return!0;y=y.originalFunction}return!1}function La(y,A){y="string"===typeof y?Ld.parse(y):y;A.scope=Ld.query.resolveReferences(Ld.query.scopes(y));return Ld.ClassReplaceVisitor.run(y,A)}function eb(y){if(y.loads){var A=y.loads;return Pe.arr.uniq(Object.keys(Pe.loadedModules(y)).concat(Object.keys(A))).reduce(function(H,Z){var M=A[Z]?A[Z].depMap:{};H[Z]=Object.keys(M).map(function(qa){var Pa=
M[qa];return"@empty"===Pa?"".concat(Pa,"/").concat(qa):Pa});return H},{})}return Object.keys(y._loader.moduleRecords).reduce(function(H,Z){H[Z]=y._loader.moduleRecords[Z].dependencies.filter(Boolean).map(function(M){return M.name});return H},{})}function jb(y,A,H,Z,M){var qa=y.get("@lively-env").pendingExportChanges;(y=Gf.module(y,A).record())&&(H in y.exports||M)&&((qa[A]||(qa[A]={}))[H]=Z)}function E(y,A){var H=y.get("@lively-env").pendingExportChanges[A];H&&(Gf.clearPendingModuleExportChanges(y,
A),Gf.updateModuleExports(y,A,H))}function Wb(){Wb=Hb(regeneratorRuntime.mark(function qa(A,H,Z,M){var Pa,Yb,$b,zc,id,jd,kd,be,te,Ce,me,ve,qg,Eg,Wf;return regeneratorRuntime.wrap(function($f){for(;;)switch($f.prev=$f.next){case 0:return Pa=A.debug,Yb={status:"loading",source:Z,name:H,address:H,linkSets:[],dependencies:[],metadata:{format:"esm"}},$f.next=4,Vf.instrumentSourceOfEsmModuleLoad(A,Yb);case 4:$b=$f.sent,zc=function(Lf,jf){return Vf.scheduleModuleExportsChange(A,Yb.name,Lf,jf,!0)},id=$b.declare(zc),
Pa&&console.log("[lively.vm es6] sourceChange of %s with deps",Yb.name,$b.localDeps),jd=[],kd=ec($b.localDeps),$f.prev=10,kd.s();case 12:if((be=kd.n()).done){$f.next=24;break}te=be.value;$f.next=16;return A.normalize(te,Yb.name);case 16:return Ce=$f.sent,me=Vf.classHolder.module(A,Ce),$f.next=20,me.load();case 20:ve=$f.sent,jd.push({name:te,fullname:Ce,module:me,exports:ve});case 22:$f.next=12;break;case 24:$f.next=29;break;case 26:$f.prev=26,$f.t0=$f["catch"](10),kd.e($f.t0);case 29:return $f.prev=
29,kd.f(),$f.finish(29);case 32:if(qg=A.loads&&A.loads[Yb.name])qg.deps=jd.map(function(Lf){return Lf.name}),qg.depMap=jd.reduce(function(Lf,jf){Lf[jf.name]=jf.fullname;return Lf},{}),qg.metadata&&qg.metadata.entry&&(qg.metadata.entry.deps=qg.deps,qg.metadata.entry.normalizedDeps=jd.map(function(Lf){return Lf.fullname}),qg.metadata.entry.declare=$b.declare);Eg=Vf.classHolder.module(A,Yb.name);Wf=Eg.record();jd.forEach(function(Lf,jf){return Eg.addDependencyToModuleRecord(Lf.module,id.setters[jf])});
Wf&&(Wf.execute=id.execute);jd.forEach(function(Lf,jf){return id.setters[jf](Lf.exports)});return $f.abrupt("return",id.execute());case 40:case "end":return $f.stop()}},qa,null,[[10,26,29,32]])}));return Wb.apply(this,arguments)}function R(){R=Hb(regeneratorRuntime.mark(function qa(A,H,Z,M){var Pa,Yb,$b;return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:Pa={status:"loading",source:Z,name:H,address:H,linkSets:[],dependencies:[],metadata:{format:"global"}};if(A.get(H)){zc.next=
4;break}zc.next=4;return pd.import(H);case 4:return zc.next=6,Vf.instrumentSourceOfGlobalModuleLoad(A,Pa);case 6:return Yb=zc.sent,Pa.source=Yb.translated,$b=Vf.doInstantiateGlobalModule(A,Pa),A["delete"](H),A.set($b.name,$b.esModule),zc.abrupt("return",$b.module);case 12:case "end":return zc.stop()}},qa)}));return R.apply(this,arguments)}function xb(y,A,H,Z,M){return Ja.apply(this,arguments)}function Ja(){Ja=Hb(regeneratorRuntime.mark(function Pa(A,H,Z,M,qa){var Yb;return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=
$b.next){case 0:$b.prev=0;A.debug&&console.log("[module change] ".concat(H," ").concat(Z.slice(0,50).replace(/\n/g,"")," ").concat(M));if(M&&"es6"!==M&&"esm"!==M&&"register"!==M&&"defined"!==M){$b.next=8;break}$b.next=5;return Vf.moduleSourceChangeEsm(A,H,Z,qa);case 5:Yb=$b.sent;$b.next=15;break;case 8:if("global"!==M){$b.next=14;break}$b.next=11;return Vf.moduleSourceChangeGlobal(A,H,Z,qa);case 11:Yb=$b.sent;$b.next=15;break;case 14:throw Error("moduleSourceChange is not supported for module ".concat(H,
" with format ").concat(M));case 15:return Vf.emit("lively.modules/modulechanged",{module:H,newSource:Z,options:qa},Date.now(),A),$b.abrupt("return",Yb);case 19:throw $b.prev=19,$b.t0=$b["catch"](0),Vf.emit("lively.modules/modulechanged",{module:H,newSource:Z,error:$b.t0,options:qa},Date.now(),A),$b.t0;case 23:case "end":return $b.stop()}},Pa,null,[[0,19]])}));return Ja.apply(this,arguments)}function Ga(y){return/\.js/i.test(y)}function sa(y){return cd.isJsFile(y)?y.replace(/\/[^\/]*$/,""):y.replace(/\/$/,
"")}function Ub(y){return/^[^:\\]+:\/\//.test(y)}function vc(y){var A=y.match(/^([^:]+:\/\/)(.*)/);if(!A)return y;y=A[1];var H=A=A[2];do A=H,H=A.replace(/\/[^\/]+\/\.\./,"");while(H!==A);H=H.replace(/(^|[^:])[\/]+/g,"$1/");H=H.replace(/\/\.\//g,"/");return y+H}function Oc(){return aa.apply(this,arguments)}function aa(){aa=Hb(regeneratorRuntime.mark(function A(){var H;return regeneratorRuntime.wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return H=System.decanonicalize("lively.installer/packages-config.json"),
Z.t0=JSON,Z.next=4,Ca.resource(H).read();case 4:return Z.t1=Z.sent,Z.abrupt("return",Z.t0.parse.call(Z.t0,Z.t1));case 6:case "end":return Z.stop()}},A)}));return aa.apply(this,arguments)}function Ma(y,A){var H=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1,Z=Ca.classHolder.PackageRegistry.ofSystem(y),M=Z.allPackageURLs();H=H?A:Ca.normalizePackageURL(y,A,M);return{pkg:Z.findPackageWithURL(H),url:H,allPackageURLs:M,registry:Z}}function qb(y,A){var H=Ca.lookupPackage(y,A,2<arguments.length&&
void 0!==arguments[2]?arguments[2]:!1),Z=H.url,M=H.registry;return H.pkg||M.addPackageAt(Z,"devPackageDirs")}function Vb(y,A){var H=Ca.lookupPackage(y,A,2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1),Z=H.pkg;H=H.url;if(Z)return Z;throw Error("[getPackage] package ".concat(A," (as ").concat(H,") not found"));}function Lb(y,A,H){return Ca.getPackage(y,H).updateConfig(A)}function Kb(y,A){return Promise.resolve(Ca.ensurePackage(y,A)).then(function(H){return H["import"]()})}function Db(y,A){return(y=
Ca.lookupPackage(y,A).pkg)?y.remove():null}function Ra(y,A,H){return Ca.getPackage(y,A).reload(H)}function N(y,A,H){return Promise.resolve(Ca.ensurePackage(y,A)).then(function(Z){return Z.register(H)})}function va(y){return Ca.Package.allPackages(y).map(function(A){return A.asSpec()})}function Wa(y,A,H){H=xe.ensureParent(y,A);var Z=y.System._nodeRequire("module");A.startsWith(".")&&(A=xe.relative(y,A));return Z._load(A,H)}function pa(y,A,H){H=xe.ensureParent(y,A);var Z=y.System._nodeRequire("module");
A.startsWith(".")&&(A=xe.relative(y,A));return Z._resolveFilename(A,H)}function tb(y,A,H){var Z=qd.livelySystemEnv(y);A=y.decanonicalize(A,H);return Z.loadedModules[A]||(Z.loadedModules[A]=new qd.ModuleInterface(y,A))}function ab(y,A){var H=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1,Z=qd.livelySystemEnv(y);return(H?A:y.normalizeSync(A))in Z.loadedModules}function Ob(y,A){return yc.apply(this,arguments)}function yc(){yc=Hb(regeneratorRuntime.mark(function Z(A,H){var M,qa,Pa,Yb=arguments;
return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=$b.next){case 0:qa=(M=2<Yb.length&&void 0!==Yb[2]?Yb[2]:!1)?H:A.normalizeSync(H);if(!qd.isModuleLoaded(A,qa,!0)){$b.next=4;break}return $b.abrupt("return",!0);case 4:if((Pa=qd.Package.forModuleId(A,qa))&&"no group"!==Pa.name){$b.next=9;break}$b.t0=A.resource(qa).exists();$b.next=12;break;case 9:return $b.next=11,Pa.hasResource(qa);case 11:$b.t0=$b.sent;case 12:return $b.abrupt("return",$b.t0);case 13:case "end":return $b.stop()}},Z)}));
return yc.apply(this,arguments)}function Ta(){return Nc.exceptions}function Bd(y){return Nc.exceptions=y}function Eb(y,A,H,Z,M){A=String(A);y=Z.sourceAccessorName;var qa=Z.recorder,Pa=Z.recorderName,Yb=Z.dontTransform,$b=Z.varDefinitionCallbackName,zc=Z.embedOriginalCode;y=(zc=void 0===zc?!0:zc)?y:void 0;Z={topLevelVarRecorder:qa,varRecorderName:Pa,sourceAccessorName:y,dontTransform:Yb,jsx:H.endsWith(".jsx"),recordGlobals:!0,keepPreviouslyDeclaredValues:!0,declarationWrapperName:$b,evalId:Z.nextEvalId(),
classTransform:Nc.classToFunctionTransform,currentModuleAccessor:Nc.funcCall(Nc.member(Nc.funcCall(Nc.member(Nc.member("__lvVarRecorder","System"),"get"),Nc.literal("@lively-env")),"moduleEnv"),Nc.literal(H))};qa="System.global"===Pa;Yb=M?'console.log("[lively.modules] executing module '.concat(H,'");\n'):"";$b="";qa?delete Z.declarationWrapperName:(Yb+='SystemJS.get("@lively-env").evaluationStart("'.concat(H,'");\n')+"var ".concat(Pa,' = SystemJS.get("@lively-env").moduleEnv("').concat(H,'").recorder;\n')+
(zc?"\nvar ".concat(y," = ").concat(JSON.stringify(A),";\n"):""),$b+='\nSystemJS.get("@lively-env").evaluationEnd("'.concat(H,'");'));try{var id=Yb+Nc.evalCodeTransform(A,Z)+$b;M&&"undefined"!==typeof $world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=id);return{source:id,options:Z}}catch(jd){return console.error("Error in prepareCodeForCustomCompile of ".concat(H," ").concat(jd.stack)),{source:A,options:Z}}}function fe(y,A,H,Z,M,qa){A=String(A);y=Object.assign({},
M,{classTransform:Nc.classToFunctionTransform,topLevelVarRecorder:Z.recorder,varRecorderName:Z.recorderName,dontTransform:Z.dontTransform,recordGlobals:!0,declarationWrapperName:Z.varDefinitionCallbackName,currentModuleAccessor:Nc.funcCall(Nc.member(Nc.funcCall(Nc.member(Nc.member("__lvVarRecorder","System"),"get"),Nc.literal("@lively-env")),"moduleEnv"),Nc.literal(H))});try{var Pa=Nc.evalCodeTransformOfSystemRegisterSetters(A,y);qa&&"undefined"!==typeof $world&&$world.get("log")&&$world.get("log").isText&&
($world.get("log").textString+=Pa);return Pa}catch(Yb){return console.error("Error in prepareTranslatedCodeForSetterCapture",Yb.stack),A}}function Od(){Od=Hb(regeneratorRuntime.mark(function Z(A,H){var M,qa,Pa,Yb,$b,zc,id,jd,kd,be,te,Ce,me,ve,qg,Eg,Wf,$f;return regeneratorRuntime.wrap(function(Lf){for(;;)switch(Lf.prev=Lf.next){case 0:M=this;qa=M.debug;Yb=(Pa=H.metadata)&&Pa.hasOwnProperty("instrument")&&!Pa.instrument||Nc.exceptions.some(function(jf){return jf(H.name)});if(!Yb){Lf.next=7;break}qa&&
console.log("[lively.modules customTranslate ignoring] %s",H.name);return Lf.abrupt("return",A(H));case 7:if(!Nc.isNode||!Nc.addNodejsWrapperSource(M,H)){Lf.next=10;break}qa&&console.log("[lively.modules] loaded %s from nodejs cache",H.name);return Lf.abrupt("return",A(H));case 10:$b=Date.now();zc=Nc.detectModuleFormat(H.source,Pa);id=Nc.module(M,H.name);jd=!1;kd="esm"===zc;id.setSource(H.source);Lf.prev=16;be=M.useModuleTranslationCache;te=M.global.indexedDB;Ce=be&&String(Nc.string.hashCode(H.source));
if(!(be&&te&&kd)){Lf.next=33;break}me=M._livelyModulesTranslationCache||(M._livelyModulesTranslationCache=new Nc.BrowserModuleTranslationCache);Lf.next=24;return me.fetchStoredModuleSource(H.name);case 24:ve=Lf.sent;if(!(ve&&ve.hash===Ce&&ve.timestamp>=Nc.BrowserModuleTranslationCache.earliestDate)){Lf.next=31;break}if(!ve.source){Lf.next=31;break}Pa.format="register";Pa.deps=[];qa&&console.log("[lively.modules customTranslate] loaded %s from browser cache after %sms",H.name,Date.now()-$b);return Lf.abrupt("return",
Promise.resolve(ve.source));case 31:Lf.next=44;break;case 33:if(!(Nc.isNode&&be&&kd)){Lf.next=44;break}qg=M._livelyModulesTranslationCache||(M._livelyModulesTranslationCache=new Nc.NodeModuleTranslationCache);Lf.next=37;return qg.fetchStoredModuleSource(H.name);case 37:Eg=Lf.sent;if(!(Eg&&Eg.hash===Ce&&Eg.timestamp>=Nc.NodeModuleTranslationCache.earliestDate)){Lf.next=44;break}if(!Eg.source){Lf.next=44;break}Pa.format="register";Pa.deps=[];qa&&console.log("[lively.modules customTranslate] loaded %s from filesystem cache after %sms",
H.name,Date.now()-$b);return Lf.abrupt("return",Promise.resolve(Eg.source));case 44:Lf.next=49;break;case 46:Lf.prev=46,Lf.t0=Lf["catch"](16),console.error("[lively.modules customTranslate] error reading module translation cache: ".concat(Lf.t0.stack));case 49:return Wf={},$f=H.source,kd?(id.recorderName="__lvVarRecorder",id.recorder===M.global&&id.unloadEnv(),H.metadata.format="esm",Nc.__inter0__=Nc.prepareCodeForCustomCompile(M,$f,H.name,id,qa),Wf=Nc.__inter0__.options,$f=Nc.__inter0__.source,H.source=
$f,jd=H.metadata["lively.modules instrumented"]=!0,qa&&console.log("[lively.modules] loaded %s as es6 module",H.name)):"global"===H.metadata.format&&(id.recorderName="System.global",id.recorder=M.global,H.metadata.format="global",Nc.__inter1__=Nc.prepareCodeForCustomCompile(M,$f,H.name,id,qa),Wf=Nc.__inter1__.options,$f=Nc.__inter1__.source,H.source=$f,jd=H.metadata["lively.modules instrumented"]=!0,qa&&console.log("[lively.modules] loaded %s as instrumented global module",H.name)),jd||qa&&console.log("[lively.modules] customTranslate ignoring %s b/c don't know how to handle format %s",
H.name,H.metadata.format),Lf.abrupt("return",A(H).then(function(){var jf=Hb(regeneratorRuntime.mark(function Gg(yg){var zf,Kh;return regeneratorRuntime.wrap(function(cg){for(;;)switch(cg.prev=cg.next){case 0:0===yg.indexOf("System.register(")&&(qa&&console.log("[lively.modules customTranslate] Installing System.register setter captures for %s",H.name),yg=Nc.prepareTranslatedCodeForSetterCapture(M,yg,H.name,id,Wf,qa));if(!(Nc.isNode&&be&&kd)){cg.next=14;break}zf=M._livelyModulesTranslationCache||(M._livelyModulesTranslationCache=
new Nc.NodeModuleTranslationCache);cg.prev=3;cg.next=6;return zf.cacheModuleSource(H.name,Ce,yg);case 6:qa&&console.log("[lively.modules customTranslate] stored cached version in filesystem for %s",H.name);cg.next=12;break;case 9:cg.prev=9,cg.t0=cg["catch"](3),console.error("[lively.modules customTranslate] failed storing module cache: ".concat(cg.t0.stack));case 12:cg.next=25;break;case 14:if(!(be&&te&&kd)){cg.next=25;break}Kh=M._livelyModulesTranslationCache||(M._livelyModulesTranslationCache=new Nc.BrowserModuleTranslationCache);
cg.prev=16;cg.next=19;return Kh.cacheModuleSource(H.name,Ce,yg);case 19:qa&&console.log("[lively.modules customTranslate] stored cached version for %s",H.name);cg.next=25;break;case 22:cg.prev=22,cg.t1=cg["catch"](16),console.error("[lively.modules customTranslate] failed storing module cache: ".concat(cg.t1.stack));case 25:return qa&&console.log("[lively.modules customTranslate] done %s after %sms",H.name,Date.now()-$b),cg.abrupt("return",yg);case 27:case "end":return cg.stop()}},Gg,null,[[3,9],
[16,22]])}));return function(yg){return jf.apply(this,arguments)}}()));case 54:case "end":return Lf.stop()}},Z,this,[[16,46]])}));return Od.apply(this,arguments)}function Hd(y,A){return y.translate(A).then(function(H){var Z=Nc.parse(H).body.find(function(qa){return qa.expression&&"CallExpression"===qa.expression.type&&"register"===qa.expression.callee.property.name});if(!Z)throw Error("Cannot find register call in translated source of ".concat(A.name));var M=Z.expression;Z=M.arguments[0].elements.map(function(qa){return qa.value});
M=M.arguments[1];H=H.slice(M.start,M.end);H=eval('var SystemJS = System; var __moduleName = "'.concat(A.name,'";\n(').concat(H,");\n//# sourceURL=").concat(A.name,"\n"));y.debug&&"undefined"!==$world&&$world.get("log")&&$world.get("log").isText&&($world.get("log").textString=H);return{localDeps:Z,declare:H}})}function Qc(y,A){return y.translate(A).then(function(H){return{translated:H}})}function Xd(y){Nc.isHookInstalled(y,"translate","lively_modules_translate_hook")||Nc.installHook(y,"translate",
function(A,H){return Nc.customTranslate.call(y,A,H)},"lively_modules_translate_hook")}function oc(y){Nc.removeHook(y,"translate","lively_modules_translate_hook")}function rf(){rf=Hb(regeneratorRuntime.mark(function Z(A,H){var M,qa,Pa,Yb,$b,zc,id,jd,kd,be,te,Ce;return regeneratorRuntime.wrap(function(me){for(;;)switch(me.prev=me.next){case 0:M=this;qa=25E4;Pa=M.resource(H.name);Yb=M.get("@system-env").node&&!Pa.isNodeJSFileResource&&!Pa.isESMResource;if(!Yb){me.next=8;break}me.next=7;return bf(H.name);
case 7:Pa=me.sent;case 8:if(Pa){me.next=10;break}return me.abrupt("return",A(H));case 10:if(ue.jsFileHashMap||M.get("@system-env").node){me.next=14;break}me.next=13;return M.resource(M.baseURL).join("__JS_FILE_HASHES__").readJson();case 13:ue.jsFileHashMap=me.sent;case 14:id=M.useModuleTranslationCache;jd=M.global.indexedDB;kd=M._livelyModulesTranslationCache;if(M.get("@system-env").node||!id||!jd||!kd){me.next=24;break}me.next=20;return kd.fetchStoredModuleSource(H.name);case 20:be=me.sent;if(!be||
ue.jsFileHashMap[H.name.replace(M.baseURL,"/")]!==be.hash&&!H.name.includes("jspm")){me.next=24;break}H.metadata.instrument=!1;return me.abrupt("return",be.source);case 24:if(!(Pa.isResource&&Pa.ext()&&Pa.ext().startsWith("css"))){me.next=26;break}return me.abrupt("return","");case 26:me.prev=26;if(!Pa.isResource){me.next=33;break}me.next=30;return Pa.read();case 30:me.t0=me.sent;me.next=34;break;case 33:me.t0=Pa;case 34:$b=me.t0;me.next=40;break;case 37:me.prev=37,me.t1=me["catch"](26),zc=me.t1;
case 40:if(!zc||!M.get("@system-env").browser){me.next=53;break}te=Pa.url.startsWith("http");Ce=!Pa.url.startsWith(document.location.origin);if(!te||!Ce){me.next=53;break}me.prev=44;me.next=47;return Pa.makeProxied(M.baseURL).read();case 47:$b=me.sent;zc=null;me.next=53;break;case 51:me.prev=51,me.t2=me["catch"](44);case 53:if(!zc){me.next=55;break}throw zc;case 55:if(!Yb){me.next=59;break}me.next=58;return $b.text();case 58:$b=me.sent;case 59:if(!($b.length>qa&&"undefined"!==typeof $world)||M._loadingIndicator){me.next=
66;break}M._loadingIndicator=$world.execCommand("open loading indicator",{label:"loading module",status:H.name.replace(M.baseURL,"")});me.next=63;return ue.promise.delay(500);case 63:if(!M._loadingIndicator){me.next=66;break}me.next=66;return M._loadingIndicator.whenRendered();case 66:return me.abrupt("return",$b);case 67:case "end":return me.stop()}},Z,this,[[26,37],[44,51]])}));return rf.apply(this,arguments)}function Dd(y){y.resource=ue.resource;ue.isHookInstalled(y,"fetch",ue.fetchResource)&&
ue.removeHook(y,"fetch","fetchResource");ue.installHook(y,"fetch",ue.fetchResource);ue.isHookInstalled(y,"resource","livelyProtocol")&&ue.removeHook(y,"fetch","livelyProtocol");ue.installHook(y,"resource",ue.livelyProtocol)}function ld(y){ue.removeHook(y,"fetch","fetchResource");ue.removeHook(y,"resource","livelyProtocol");delete y.resource}function Td(y){Zd.isHookInstalled(y,"normalize","normalizeHook")||Zd.installHook(y,"normalize",Zd.normalizeHook,"normalizeHook");Zd.isHookInstalled(y,"decanonicalize",
"decanonicalizeHook")||Zd.installHook(y,"decanonicalize",Zd.decanonicalizeHook,"decanonicalizeHook");Zd.isHookInstalled(y,"locate","locateHook")||Zd.installHook(y,"locate",Zd.locateHook,"locateHook");Zd.isHookInstalled(y,"normalizeSync","decanonicalizeHook")||Zd.installHook(y,"normalizeSync",Zd.decanonicalizeHook,"decanonicalizeHook");Zd.isHookInstalled(y,"newModule","newModule_volatile")||Zd.installHook(y,"newModule",Zd.newModule_volatile,"newModule_volatile");Zd.isHookInstalled(y,"instantiate",
"instantiate_triggerOnLoadCallbacks")||Zd.installHook(y,"instantiate",Zd.instantiate_triggerOnLoadCallbacks,"instantiate_triggerOnLoadCallbacks");y._loader.modules||(y._loader.modules={});if(!y._loader.modules._originalModules){var A=Proxy.revocable(y._loader.modules,{set:function(Z,M,qa){Zd.moduleLoadPromises[M]&&Zd.moduleLoadPromises[M].resolve(qa);Z[M]=qa;return!0}}),H=A.proxy;H._revoke=A.revoke;H._originalModules=y._loader.modules;y._loader.modules=H}}function gb(y){Zd.removeHook(y,"normalize",
"normalizeHook");Zd.removeHook(y,"decanonicalize","decanonicalizeHook");Zd.removeHook(y,"normalizeSync","decanonicalizeHook");Zd.removeHook(y,"newModule","newModule_volatile");Zd.removeHook(y,"instantiate","instantiate_triggerOnLoadCallbacks");Zd.removeHook(y,"locate","locateHook");var A=y._loader.modules;A._originalModules&&(y._loader.modules=A._originalModules,A._revoke(),delete y._loader.modules._revoke,delete y._loader.modules._originalModules)}function Vc(y){return{moduleEnv:function(A){return Zd.classHolder.module(y,
A)},get itself(){return y.get(y.decanonicalize("lively.modules/index.js"))},evaluationStart:function(A){Zd.classHolder.module(y,A).evaluationStart()},evaluationEnd:function(A){Zd.classHolder.module(y,A).evaluationEnd()},dumpConfig:function(){return JSON.stringify({baseURL:y.baseURL,transpiler:y.transpiler,defaultJSExtensions:y.defaultJSExtensions,map:y.map,meta:y.meta,packages:y.packages,paths:y.paths,packageConfigPaths:y.packageConfigPaths},null,2)},get packageRegistry(){return y["__lively.modules__packageRegistry"]},
set packageRegistry(A){y["__lively.modules__packageRegistry"]=A},packages:y["__lively.modules__packages"]||(y["__lively.modules__packages"]={}),loadedModules:y["__lively.modules__loadedModules"]||(y["__lively.modules__loadedModules"]={}),pendingExportChanges:y["__lively.modules__pendingExportChanges"]||(y["__lively.modules__pendingExportChanges"]={}),notifications:y["__lively.modules__notifications"]||(y["__lively.modules__notifications"]=[]),notificationSubscribers:y["__lively.modules__notificationSubscribers"]||
(y["__lively.modules__notificationSubscribers"]={}),options:y["__lively.modules__options"]||(y["__lively.modules__options"]=Zd.obj.deepCopy(Zd.defaultOptions)),onLoadCallbacks:y["__lively.modules__onLoadCallbacks"]||(y["__lively.modules__onLoadCallbacks"]=[]),modulePackageMapCache:y["__lively.modules__modulePackageMapCache"]}}function vb(y,A){return y&&"string"!==typeof y?y:Zd.systems()[y]||(Zd.systems()[y]=Zd.makeSystem(A))}function cc(y){y=y&&"string"!==typeof y?Zd.nameOfSystem(y):y;delete Zd.systems()[y]}
function ob(y,A){y.trace=!0;A=A||{};var H=A.hasOwnProperty("useModuleTranslationCache")?A.useModuleTranslationCache:!Zd.urlQuery().noModuleCache;y.useModuleTranslationCache=H;A._nodeRequire&&(y._nodeRequire=A._nodeRequire);y.set("@lively-env",y.newModule(Zd.livelySystemEnv(y)));"undefined"!==typeof WorkerGlobalScope&&y.set("@system-env",y.newModule(Object.assign({},y.get("@system-env"),{browser:!0,worker:!0,location})));(H="undefined"!==typeof process&&process.versions&&process.versions.electron)&&
y.set("@system-env",y.newModule(Object.assign({electron:H},y.get("@system-env"))));Zd.wrapResource(y);Zd.wrapModuleLoad(y);Zd.wrapModuleResolution(y);H&&(H=["electron"].reduce(function(Z,M){Z[M]="@node/"+M;return Z},{}),A.map=Zd.obj.merge(H,A.map));Zd.isNode&&(H="addons assert buffer child_process cluster console crypto dgram dns domain events fs http https module net os path punycode querystring readline repl stream stringdecoder timers tls tty url util v8 vm zlib constants worker_threads process".split(" ").reduce(function(Z,
M){Z[M]=Z["node:"+M]="@node/"+M;return Z},{}),A.map=Zd.obj.merge(H,A.map));A.packageConfigPaths=A.packageConfigPaths||["./node_modules/*/package.json"];A.transpiler||"traceur"!==y.transpiler||(H=Zd.GLOBAL.System,"lively.transpiler"===H.transpiler?(y.set("lively.transpiler",H.get("lively.transpiler")),y._loader.transpilerPromise=H._loader.transpilerPromise,y.config({transpiler:"lively.transpiler",babelOptions:Object.assign(H.babelOptions||{},A.babelOptions)})):y.config({map:{"plugin-babel":H.map["plugin-babel"],
"systemjs-babel-build":H.map["systemjs-babel-build"]},transpiler:H.transpiler,babelOptions:Object.assign(H.babelOptions||{},A.babelOptions)}));y.config(A);return y}function ac(){ac=Hb(regeneratorRuntime.mark(function Z(A,H){var M;return regeneratorRuntime.wrap(function(qa){for(;;)switch(qa.prev=qa.next){case 0:H._fileCheckMap=H._fileCheckMap||{};if(!(A in H._fileCheckMap)){qa.next=3;break}return qa.abrupt("return",H._fileCheckMap[A]);case 3:M=H._livelyModulesTranslationCache;qa.t0=M;if(!qa.t0){qa.next=
9;break}qa.next=8;return M.fetchStoredModuleSource(A);case 8:qa.t0=qa.sent;case 9:if(!qa.t0){qa.next=11;break}return qa.abrupt("return",H._fileCheckMap[A]=!0);case 11:return qa.next=13,Zd.resource(A).exists();case 13:return qa.abrupt("return",H._fileCheckMap[A]=qa.sent);case 14:case "end":return qa.stop()}},Z)}));return ac.apply(this,arguments)}function ae(){ae=Hb(regeneratorRuntime.mark(function qa(A,H,Z,M){var Pa,Yb,$b,zc,id,jd;return regeneratorRuntime.wrap(function(kd){for(;;)switch(kd.prev=kd.next){case 0:if(!Z||
"cjs"!==H){kd.next=2;break}return kd.abrupt("return","cjs");case 2:if("@system-env"!==H){kd.next=4;break}return kd.abrupt("return",H);case 4:return Pa=this,Yb=Zd.preNormalize(Pa,H,Z),kd.next=8,A(Yb,Z,!0);case 8:$b=kd.sent;zc=Zd.postNormalize(Pa,$b||Yb,!1);id=zc.startsWith("file:");Pa.debug&&console.log("[normalize] ".concat(H," => ").concat(zc));if(Zd.jsExtRe.test(H)||Zd.jsxExtRe.test(H)||Zd.cjsExtRe.test(H)||Zd.jsonExtRe.test(zc)||Zd.nodeModRe.test(zc)||Zd.nodeExtRe.test(zc)||Pa.loads&&Pa.loads[zc]){kd.next=
38;break}if(!Zd.jsExtRe.test(zc)){kd.next=29;break}kd.next=16;return Zd.checkExistence(zc,Pa);case 16:if(!kd.sent){kd.next=18;break}return kd.abrupt("return",zc);case 18:return jd=zc.replace(".js","/index.js"),kd.next=21,Zd.checkExistence(jd,Pa);case 21:kd.t0=kd.sent;if(kd.t0){kd.next=24;break}kd.t0=!id;case 24:if(!kd.t0){kd.next=26;break}return kd.abrupt("return",jd);case 26:return kd.abrupt("return",zc.replace(".js","/index.node"));case 29:if(zc.includes("jspm.dev")||"@empty"===zc){kd.next=38;break}kd.next=
32;return Zd.checkExistence(zc+".js",Pa);case 32:if(!kd.sent){kd.next=34;break}return kd.abrupt("return",zc+".js");case 34:return kd.next=36,Zd.checkExistence(zc+"/index.js",Pa);case 36:if(!kd.sent){kd.next=38;break}return kd.abrupt("return",zc+"/index.js");case 38:return Zd.jsxJsExtRe.test(zc)&&(zc=zc.replace(".jsx.js",".jsx")),kd.abrupt("return",zc);case 40:case "end":return kd.stop()}},qa,this)}));return ae.apply(this,arguments)}function qe(){qe=Hb(regeneratorRuntime.mark(function Z(A,H){var M,
qa,Pa,Yb;return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=$b.next){case 0:return M=H.name.split("!"),qa=Xb(M,2),Pa=qa[0],H.name=Pa,$b.next=4,A(H);case 4:return Yb=$b.sent,$b.abrupt("return",Yb);case 6:case "end":return $b.stop()}},Z)}));return qe.apply(this,arguments)}function lc(){lc=Hb(regeneratorRuntime.mark(function H(A){return regeneratorRuntime.wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:return Z.abrupt("return",System.get(A)||(Zd.moduleLoadPromises[A]||(Zd.moduleLoadPromises[A]=
Zd.promise.deferred())).promise);case 1:case "end":return Z.stop()}},H)}));return lc.apply(this,arguments)}function nc(y){y=Zd.getSystem(y);return JSON.stringify({baseURL:y.baseURL,transpiler:y.transpiler,defaultJSExtensions:y.defaultJSExtensions,defaultExtension:y.defaultExtension,map:y.map,meta:y.meta,packages:y.packages,paths:y.paths,packageConfigPaths:y.packageConfigPaths,bundles:y.bundles},null,2)}function Yc(y,A,H){var Z=y.decanonicalize(A);if(y.get(Z))try{H(Zd.classHolder.module(y,Z))}catch(M){console.error(M)}else y.get("@lively-env").onLoadCallbacks.push({moduleName:A,
resolved:!1,callback:H})}function fd(y){return y.get("@lively-env").loadedModules}function ua(y){var A=y.loads?Object.keys(y.loads):Object.keys(y._loader.moduleRecords);return Zd.arr.uniq(A.concat(Object.keys(Zd.loadedModules(y))))}function Ab(y,A,H){return Promise.all(Zd.obj.values(Zd.loadedModules(y)).map(function(Z){return Z.search(A,H)})).then(function(Z){return Z.flat()})}function Fa(y){return za.apply(this,arguments)}function za(){za=Hb(regeneratorRuntime.mark(function H(A){var Z,M,qa,Pa,Yb,
$b,zc,id,jd,kd,be,te=arguments;return regeneratorRuntime.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:Z=1<te.length&&void 0!==te[1]?te[1]:{maxDepth:0,excludes:[]};M=2<te.length&&void 0!==te[2]?te[2]:{};qa=3<te.length&&void 0!==te[3]?te[3]:0;Pa=Z.maxDepth;Yb=Z.excludes;if(!(0<Pa&&qa>Pa)){Ce.next=6;break}return Ce.abrupt("return",M);case 6:return Ce.prev=6,Ce.t0=JSON,Ce.next=10,Xg.resource(A).join("package.json").read();case 10:Ce.t1=Ce.sent;$b=Ce.t0.parse.call(Ce.t0,Ce.t1);zc="".concat($b.name,
"@").concat($b.version);if(!M[zc]&&!Yb.includes($b.name)){Ce.next=15;break}return Ce.abrupt("return",M);case 15:M[zc]=Object.assign({url:A},Xg.obj.select($b,["name","version","dependencies","devDependencies","main"]));Ce.next=21;break;case 18:return Ce.prev=18,Ce.t2=Ce["catch"](6),Ce.abrupt("return",M);case 21:return Ce.prev=21,Ce.next=24,Xg.resource(A).join("node_modules").dirList(1);case 24:id=Ce.sent;Ce.next=30;break;case 27:return Ce.prev=27,Ce.t3=Ce["catch"](21),Ce.abrupt("return",M);case 30:jd=
ec(id),Ce.prev=31,jd.s();case 33:if((kd=jd.n()).done){Ce.next=40;break}be=kd.value.url;Ce.next=37;return Fa(be,Z,M,qa+1);case 37:M=Ce.sent;case 38:Ce.next=33;break;case 40:Ce.next=45;break;case 42:Ce.prev=42,Ce.t4=Ce["catch"](31),jd.e(Ce.t4);case 45:return Ce.prev=45,jd.f(),Ce.finish(45);case 48:return Ce.abrupt("return",M);case 49:case "end":return Ce.stop()}},H,null,[[6,18],[21,27],[31,42,45,48]])}));return za.apply(this,arguments)}function Ka(y,A){var H=Object.assign({},y.dependencies,{},y.devDependencies);
return Object.keys(H).reduce(function(Z,M){var qa=H[M],Pa=Xg.obj.values(A).find(function($b){var zc=$b.version;return $b.name===M&&lively.modules.semver.satisfies(zc,qa)})||{},Yb=Pa.name;Pa=Pa.version;Z[M]=Yb?"".concat(Yb,"@").concat(Pa):void 0;return Z},{})}function Ib(y){function A(M,qa){var Pa="".concat(M,"@").concat(qa);if(Pa in Z)return Z[Pa];var Yb=H.find(function(zc){var id=zc.version;return zc.name===M&&lively.modules.semver.satisfies(id,qa)})||{},$b=Yb.name;Yb=Yb.version;return Z[Pa]=$b?
"".concat($b,"@").concat(Yb):void 0}var H=Xg.obj.values(y),Z={};return Object.keys(y).reduce(function(M,qa){var Pa=y[qa],Yb=Object.assign({},Pa.dependencies,{},Pa.devDependencies);M[qa]=Object.keys(Yb).map(function($b){return A($b,Yb[$b])}).filter(function($b){return!!$b});return M},{})}function C(y,A){Md.defaultSystem=y;A&&(Md.GLOBAL.System=y);y._scripting=Md.scripting;return y}function Pb(){Md._wrapModuleResolution(Md.defaultSystem)}function da(){Md._unwrapModuleResolution(Md.defaultSystem)}function wa(){return Object.keys(Md.requireMap())}
function ca(y){return Md._module(Md.defaultSystem,y)}function ma(y,A){return Md._isModuleLoaded(Md.defaultSystem,y,A)}function u(y,A){return Md._doesModuleExist(Md.defaultSystem,y,A)}function O(){return Md._printSystemConfig(Md.defaultSystem)}function P(y,A){return Md._whenLoaded(Md.defaultSystem,y,A)}function fa(y){return Md._importPackage(Md.defaultSystem,y)}function Qa(y,A){return Md._registerPackage(Md.defaultSystem,y,A)}function Ua(y){return Md._removePackage(Md.defaultSystem,y)}function Gb(y,
A){return Md._reloadPackage(Md.defaultSystem,y,A)}function ta(){return Md.getPackageSpecs(Md.defaultSystem)}function mc(y){return Md._getPackage(Md.defaultSystem,y,1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1)}function pc(y){return Md.Package.forModuleId(Md.defaultSystem,y)}function zd(y){return Md._ensurePackage(Md.defaultSystem,y)}function Pd(y,A){return Md._applyPackageConfig(Md.defaultSystem,y,A)}function bd(y){return Md._lookupPackage(Md.defaultSystem,y,1<arguments.length&&void 0!==
arguments[1]?arguments[1]:!1)}function Yd(y,A,H){return Md._moduleSourceChange(Md.defaultSystem,y,A,H)}function le(){return Md.computeRequireMap(Md.defaultSystem)}function Be(y,A){return Md._isHookInstalled(Md.defaultSystem,y,A)}function Ne(y,A){return Md._installHook(Md.defaultSystem,y,A)}function Re(y,A){return Md._removeHook(Md.defaultSystem,y,A)}function nf(){Md._wrapModuleLoad(Md.defaultSystem)}function af(){Md._unwrapModuleLoad(Md.defaultSystem)}Lc({a:ca,c:La,p:Oc});var yf=window.lively.FreezerRuntime.recorderFor("lively.modules/src/hooks.js");
yf.install=K;yf.remove=ya;yf.isInstalled=pb;yf.arr=Nd;yf.fun=Tc;yf.install=K;yf.remove=ya;yf.isInstalled=pb;var Ig=window.lively.FreezerRuntime.recorderFor("lively.modules/src/cycle-breaker.js");Ig.classHolder={};var re=Ig.classHolder;Ig.classHolder=re;var Ld=window.lively.FreezerRuntime.recorderFor("lively.classes/class-to-function-transform.js");Ld.isFunctionNode=function(y){return"ArrowFunctionExpression"===y.type||"FunctionExpression"===y.type||"FunctionDeclaration"===y.type};Ld.ensureIdentifier=
function(y){return y.replace(Ld.firstIdRe,"_").replace(Ld.trailingIdRe,"_")};Ld.classFieldsInitialization=function(y){return y.map(function(A){var H=A.key;A=A.value;var Z=H.name;"PrivateIdentifier"===H.type&&(Z="_"+Z);return Ld.assign(Ld.member("this",Z),A)})};Ld.constructorTemplate=function(y,A){return Ld.funcExpr({id:y?Ld.id(y):null},["__first_arg__"],Ld.ifStmt(Ld.binaryExpr(Ld.id("__first_arg__"),"&&",Ld.member("__first_arg__",Ld.funcCall(Ld.member("Symbol","for"),Ld.literal("lively-instance-restorer")),
!0)),Ld.block(),Ld.block.apply(Ld,sb(Ld.classFieldsInitialization(A)).concat([Ld.returnStmt(Ld.funcCall(Ld.member(Ld.member("this",Ld.funcCall(Ld.member("Symbol","for"),Ld.literal("lively-instance-initialize")),!0),"apply"),Ld.id("this"),Ld.id("arguments")))]))))};Ld.splitExportDefaultWithClass=function(y,A,H,Z){return y.declaration&&y.declaration[Ld.isTransformedClassVarDeclSymbol]?[y.declaration,{declaration:y.declaration.declarations[0].id,type:"ExportDefaultDeclaration"}]:y};Ld.replaceSuper=function(y,
A,H,Z){console.assert("Super"===y.type);(A=A.currentMethod)||console.warn("[lively.classes] Trying to transform es6 class but got super call outside a method! ".concat(Ld.stringify(y)," in ").concat(H.join(".")));H=H.slice(-2);H=Xb(H,2);Z=H[1];return"callee"===H[0]&&"object"===Z||"callee"===Z?y:A&&"static"===A[Ld.methodKindSymbol]?Ld.funcCall(Ld.member("Object","getPrototypeOf"),Ld.id(Ld.tempLivelyClassVar)):Ld.funcCall(Ld.member("Object","getPrototypeOf"),Ld.member(Ld.id(Ld.tempLivelyClassVar),"prototype"))};
Ld.replaceSuperMethodCall=function(y,A,H,Z){console.assert("CallExpression"===y.type);console.assert("Super"===y.callee.object.type);return Ld.funcCall.apply(Ld,[Ld.member(Ld.funcCall(Ld.member(Z.functionNode,"_get"),Ld.replaceSuper(y.callee.object,A,H.concat(["callee","object"]),Z),Ld.literal(y.callee.property.value||y.callee.property.name),Ld.id("this")),"call"),Ld.id("this")].concat(sb(y.arguments)))};Ld.replaceDirectSuperCall=function(y,A,H,Z){console.assert("CallExpression"===y.type);console.assert("Super"===
y.callee.type);return Ld.funcCall.apply(Ld,[Ld.member(Ld.funcCall(Ld.member(Z.functionNode,"_get"),Ld.replaceSuper(y.callee,A,H.concat(["callee"]),Z),Ld.funcCall(Ld.member("Symbol","for"),Ld.literal("lively-instance-initialize")),Ld.id("this")),"call"),Ld.id("this")].concat(sb(y.arguments)))};Ld.replaceSuperGetter=function(y,A,H,Z){console.assert("MemberExpression"===y.type);console.assert("Super"===y.object.type);return Ld.funcCall(Ld.member(Z.functionNode,"_get"),Ld.replaceSuper(y.object,A,H.concat(["object"]),
Z),Ld.literal(y.property.value||y.property.name),Ld.id("this"))};Ld.replaceSuperSetter=function(y,A,H,Z){console.assert("AssignmentExpression"===y.type);console.assert("Super"===y.left.object.type);return Ld.funcCall(Ld.member(Z.functionNode,"_set"),Ld.replaceSuper(y.left.object,A,H.concat(["left","object"]),Z),Ld.literal(y.left.property.value||y.left.property.name),y.right,Ld.id("this"))};Ld.replaceClass=function(y,A,H,Z){console.assert("ClassDeclaration"===y.type||"ClassExpression"===y.type);var M=
y.body.body,qa=y.superClass;H=y.id;var Pa=y.type,Yb=y.start,$b=y.end,zc=Z.addClassNameGetter,id=void 0===zc?!0:zc;zc=Ld.id("undefined");var jd=Ld.id("undefined"),kd=H?H.name:"anonymous_class",be=Z.evalId,te=Z.sourceAccessorName;y=y["x-lively-object-meta"]||{start:Yb,end:$b};var Ce=["Literal","Identifier","PrivateIdentifier","MemberExpression","CallExpression"];M=M.reduce(function(Eg,Wf){var $f=Wf.key,Lf=Wf.kind,jf=Wf.value,wh=Wf["static"],yg=Wf.type;Ce.includes($f.type)||console.warn("Unexpected key in classToFunctionTransform! ".concat(JSON.stringify($f),
" -> ").concat(Ld.stringify(Wf)));if("method"===Lf){Wf=$f.name||$f.value||Ld.Path("property.name").get($f);var Gg=Ld.id(kd+"_"+Ld.ensureIdentifier(Wf||Ld.Path("arguments.0.value").get($f))+"_");$f=["key",Wf?Ld.literal(Wf):$f,"value",Object.assign({},jf,Nb({id:Gg},Ld.methodKindSymbol,wh?"static":"proto"))];Gg=Ld.objectLiteral($f)}else"get"===Lf||"set"===Lf?Gg=Ld.objectLiteral(["key",Ld.literal($f.name||$f.value||Ld.Path("property.name").get($f)),Lf,Object.assign({},jf,Nb({id:Ld.id(Lf)},Ld.methodKindSymbol,
wh?"static":"proto"))]):"constructor"===Lf?($f=["key",Ld.funcCall(Ld.member("Symbol","for"),Ld.literal("lively-instance-initialize")),"value",Object.assign({},jf,Nb({id:Ld.id(kd+"_initialize_")},Ld.methodKindSymbol,"proto"))],Gg=Ld.objectLiteral($f)):"PropertyDefinition"===yg?Eg.fields.push(Wf):console.warn("[lively.classes] classToFunctionTransform encountered unknown class property with kind ".concat(Lf,", ignoring it, ").concat(JSON.stringify(Wf)," -> ").concat(Ld.stringify(Wf)));Gg&&(wh?Eg.clazz:
Eg.inst).push(Gg);return Eg},{inst:[],fields:[],clazz:id?[Ld.parse('({ key: Symbol.for("__LivelyClassName__"), get: function get() { return "'.concat(kd,'"; } })')).body[0].expression]:[]});Yb=M.inst;$b=M.clazz;M=M.fields;Yb.length&&(zc={type:"ArrayExpression",elements:Yb});$b.length&&(jd={type:"ArrayExpression",elements:$b});Yb=Z.scope;if(qa&&Z.currentModuleAccessor)if(Z.classHolder===qa.object){var me=qa;var ve=qa.property.name}else{var qg=Yb&&Yb.resolvedRefMap&&Yb.resolvedRefMap.get(qa);qg&&qg.decl&&
Yb.decls&&Yb.decls.find(function(Eg){return Xb(Eg,1)[0]===qg.decl})&&(me=qa,ve=qa.name)}ve=me?Ld.objectLiteral(["referencedAs",Ld.literal(ve),"value",me]):qa||Ld.id("undefined");me=H&&"ClassDeclaration"===Pa;qa=["start",Ld.literal(y.start),"end",Ld.literal(y.end)];"undefined"!==typeof be&&qa.push("evalId",Ld.literal(be));te&&qa.push("moduleSource",Ld.nodes.id(te));be=Ld.objectLiteral(qa);zc=Ld.funcCall(Ld.funcExpr({},["superclass"],Ld.varDecl(Ld.tempLivelyClassHolderVar,A.classHolder),Ld.varDecl(Ld.tempLivelyClassVar,
me?{type:"ConditionalExpression",test:Ld.binaryExpr(Ld.funcCall(Ld.member(Ld.tempLivelyClassHolderVar,"hasOwnProperty"),Ld.literal(H.name)),"&&",Ld.binaryExpr({argument:Ld.member(Ld.tempLivelyClassHolderVar,H),operator:"typeof",prefix:!0,type:"UnaryExpression"},"===",Ld.literal("function"))),consequent:Ld.member(Ld.tempLivelyClassHolderVar,H),alternate:Ld.assign(Ld.member(Ld.tempLivelyClassHolderVar,H),Ld.constructorTemplate(H.name,M))}:H?Ld.constructorTemplate(H.name,M):Ld.constructorTemplate(null,
M)),Ld.returnStmt(Ld.funcCall(Z.functionNode,Ld.id(Ld.tempLivelyClassVar),Ld.id("superclass"),zc,jd,Ld.id(Ld.tempLivelyClassHolderVar),Z.currentModuleAccessor||Ld.id("undefined"),be))),ve);if("ClassExpression"===Pa)return zc;Pa=zc;Z.declarationWrapper&&A.classHolder===Z.classHolder&&(Pa=Ld.funcCall(Z.declarationWrapper,Ld.literal(H.name),Ld.literal("class"),Pa,Z.classHolder,be));Pa=Ld.varDecl(H,Pa,"var");Pa[Ld.isTransformedClassVarDeclSymbol]=!0;return Pa};Ld.replacePrivateIdentifier=function(y){return Object.assign({},
y,{type:"Identifier",name:"_"+y.name})};Ld.classToFunctionTransform=La;Ld.Path=Jc;Ld.parse=$d;Ld.stringify=Bb;Ld.query=rd;Ld.nodes=Id;Ld.Visitor=Ac;var fc=Ld.nodes;Ld.assign=fc.assign;Ld.member=fc.member;Ld.id=fc.id;Ld.exprStmt=fc.exprStmt;Ld.funcCall=fc.funcCall;Ld.literal=fc.literal;Ld.objectLiteral=fc.objectLiteral;Ld.varDecl=fc.varDecl;Ld.funcExpr=fc.funcExpr;Ld.returnStmt=fc.returnStmt;Ld.binaryExpr=fc.binaryExpr;Ld.ifStmt=fc.ifStmt;Ld.block=fc.block;Ld.firstIdRe=/^[^_a-z]/i;Ld.trailingIdRe=
/[^_a-z0-9]/ig;Ld.isTransformedClassVarDeclSymbol=Symbol();Ld.methodKindSymbol=Symbol();Ld.tempLivelyClassVar="__lively_class__";Ld.tempLivelyClassHolderVar="__lively_classholder__";var wd=function(y){function A(){nd(this,A);return H.apply(this,arguments)}Pc(A,y);var H=gd(A);Fd(A,[{key:"accept",value:function(Z,M,qa){Ld.isFunctionNode(Z)&&(M=Object.assign({},M,{classHolder:Ld.objectLiteral([]),currentMethod:Z[Ld.methodKindSymbol]?Z:M.currentMethod}));if("ClassExpression"===Z.type||"ClassDeclaration"===
Z.type)Z=Ld.replaceClass(Z,M,qa,M.options);"PrivateIdentifier"===Z.type&&(Z=Ld.replacePrivateIdentifier(Z));"Super"===Z.type&&(Z=Ld.replaceSuper(Z,M,qa,M.options));"MemberExpression"===Z.type&&Z.object&&"Super"===Z.object.type&&(Z=Ld.replaceSuperGetter(Z,M,qa,M.options));"AssignmentExpression"===Z.type&&"MemberExpression"===Z.left.type&&"Super"===Z.left.object.type&&(Z=Ld.replaceSuperSetter(Z,M,qa,M.options));"CallExpression"===Z.type&&"Super"===Z.callee.type&&(Z=Ld.replaceDirectSuperCall(Z,M,qa,
M.options));"CallExpression"===Z.type&&Z.callee.object&&"Super"===Z.callee.object.type&&(Z=Ld.replaceSuperMethodCall(Z,M,qa,M.options));Z=ic(vd(A.prototype),"accept",this).call(this,Z,M,qa);return"ExportDefaultDeclaration"===Z.type?Ld.splitExportDefaultWithClass(Z,M,qa,M.options):Z}}],[{key:"run",value:function(Z,M){var qa=new this,Pa=M.classHolder||Ld.objectLiteral([]);return qa.accept(Z,{options:M,classHolder:Pa},[])}}]);return A}(Ld.Visitor);Ld.ClassReplaceVisitor=wd;Ld.classToFunctionTransform=
La;var Ie=window.lively.FreezerRuntime.recorderFor("lively.classes/index.js");Ie.runtime=bc;Ie.classToFunctionTransform=La;Ie.runtime=bc;Ie.classToFunctionTransform=La;var ff=Object.freeze({__proto__:null,runtime:bc,classToFunctionTransform:La});Lc("b",ff);var Pe=window.lively.FreezerRuntime.recorderFor("lively.modules/src/dependencies.js");Pe.computeRequireMap=eb;Pe.arr=Nd;Pe.loadedModules=fd;Pe.computeRequireMap=eb;var Gf=window.lively.FreezerRuntime.recorderFor("lively.modules/src/import-export.js");
Gf.scheduleModuleExportsChange=jb;Gf.clearPendingModuleExportChanges=function(y,A){delete y.get("@lively-env").pendingExportChanges[A]};Gf.updateModuleExports=function(y,A,H){var Z=y.debug;Gf.module(y,A).updateRecord(function(M){var qa=[],Pa=[];Object.keys(H).forEach(function(be){var te=H[be];Z&&console.log("[lively.vm es6 updateModuleExports] %s export %s = %s",A,be,String(te).slice(0,30).replace(/\n/g,"")+"...");var Ce=!(be in M.exports);Ce&&(M.__lively_modules__.evalOnlyExport[be]=!0);M.exports[be]=
te;Ce?qa.push(be):Pa.push(be)});if(qa.length){var Yb=y.get(A);Object.isFrozen(Yb)?(console.warn("[lively.vm es6 updateModuleExports] Since module %s is frozen a new module object was installed in the system. Note that only(!) exisiting module bindings are updated. New exports that were added will only be available in already loaded modules after those are reloaded!",A),y.set(A,y.newModule(M.exports))):(Z&&console.log("[lively.vm es6 updateModuleExports] adding new exports to %s",A),qa.forEach(function(be){Object.defineProperty(Yb,
be,{configurable:!1,enumerable:!0,get:function(){return M.exports[be]},set:function(){throw Error("exports cannot be changed from the outside");}})}))}if(Pa.length){Z&&console.log("[lively.vm es6 updateModuleExports] updating %s dependents of %s",M.importers.length,A);for(var $b=0,zc=M.importers.length;$b<zc;$b++){var id=M.importers[$b],jd=void 0;if(!id.locked&&id.dependencies.some(function(be,te){jd=te;return be&&be.name===M.name})){if(Z){var kd=Gf.module(y,id.name);console.log("[lively.vm es6 updateModuleExports] calling setters of ".concat(kd["package"]().name,
"/").concat(kd.pathInPackage()))}Gf.module(y,id.name).evaluationStart();id.setters[jd](M.exports);Gf.module(y,id.name).evaluationEnd()}}}})};Gf.runScheduledExportChanges=E;Gf.commonjsHelpers=hb;Gf.module=tb;Gf.scheduleModuleExportsChange=jb;Gf.runScheduledExportChanges=E;var Vf=window.lively.FreezerRuntime.recorderFor("lively.modules/src/change.js");Vf.moduleSourceChangeEsm=function(y,A,H,Z){return Wb.apply(this,arguments)};Vf.doInstantiateGlobalModule=function(y,A){var H=Vf.__createEntry();H.name=
A.name;H.esmExports=!0;A.metadata.entry=H;H.deps=[];for(var Z in A.metadata.globals){var M=A.metadata.globals[Z];M&&H.deps.push(M)}H.execute=function(qa,Pa,Yb){(Pa=(Pa=Vf.classHolder.module(y,Yb.id).metadata())&&Pa.entry&&Pa.entry.module&&Pa.entry.module.exports)&&Object.keys(Pa).forEach(function(id){try{delete y.global[id]}catch(jd){console.warn('[lively.modules] executeGlobalModule: Cannot delete global["'.concat(id,'"]'))}});if(A.metadata.globals){var $b={};for(var zc in A.metadata.globals)A.metadata.globals[zc]&&
($b[zc]=qa(A.metadata.globals[zc]))}if(qa=A.metadata.exports)A.source+='\nSystem.global["'.concat(qa,'"] = ').concat(qa,";");Yb=y.get("@@global-helpers").prepareGlobal(Yb.id,qa,$b);Vf.__evaluateGlobalLoadSource(y,A);return Yb()};return Vf.runExecuteOfGlobalModule(y,H)};Vf.moduleSourceChangeGlobal=function(y,A,H,Z){return R.apply(this,arguments)};Vf.moduleSourceChange=xb;Vf.__createEntry=function(){return{name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:!1,declarative:!1,
normalizedDeps:null,groupIndex:null,evaluated:!1,module:null,esModule:null,esmExports:!1}};Vf.__evaluateGlobalLoadSource=function(y,A){function H(){0===--M&&(qa.System=qa.SystemJS=Z)}var Z,M=0,qa=y.global;return function(Pa){try{0===M++&&(Z=qa.System),qa.System=qa.SystemJS=this,(0,eval)(Pa.source),H()}catch(Yb){throw H(),Error("Error evaluating ".concat(Pa.address,":\n").concat(Yb.stack));}}.call(y,A)};Vf.runExecuteOfGlobalModule=function(y,A){var H={},Z=A.module={exports:H,id:A.name};A.evaluated=
!0;if(H=A.execute.call(y.global,function(M){var qa=A.deps.find(function(Pa){return Pa===M});if(qa=qa&&y.get(A.normalizedDeps[A.deps.indexOf(qa)])||y.get(y.decanonicalize(M,A.name)))return qa;throw Error("Module "+M+" not declared as a dependency of "+A.name);},H,Z))Z.exports=H;H=Z.exports;Z=y.get("@system-env").constructor;A.esModule=H&&(H.__esModule||H instanceof Z)?H:A.esmExports&&H!==y.global?y.newModule(H):{"default":H};return A};Vf.emit=cb;Vf.instrumentSourceOfEsmModuleLoad=Hd;Vf.instrumentSourceOfGlobalModuleLoad=
Qc;Vf.scheduleModuleExportsChange=jb;Vf.classHolder=re;Vf.moduleSourceChange=xb;var cd=window.lively.FreezerRuntime.recorderFor("lively.modules/src/url-helpers.js");cd.isJsFile=Ga;cd.asDir=sa;cd.isURL=Ub;cd.urlResolve=vc;cd.string=ub;cd.isJsFile=Ga;cd.asDir=sa;var Y=cd.string.joinPath;cd.join=Y;cd.join=Y;cd.isURL=Ub;cd.urlResolve=vc;var Ba=window.lively.FreezerRuntime.recorderFor("lively.modules/src/packages/configuration.js");Ba.arr=Nd;Ba.obj=yb;Ba.isURL=Ub;Ba.installHook=K;Ba.isHookInstalled=pb;
var mb=function(){function y(A){nd(this,y);this.pkg=A}Fd(y,[{key:"applyConfig",value:function(A){var H=this.System,Z=this.packageURL,M=this.pkg;A=Ba.obj.deepMerge(M.config,A);var qa=A.name||Z.split("/").slice(-1)[0],Pa=A.version,Yb=A.systemjs||{},$b=A.lively,zc=A.main||"index.js";H.config({map:Nb({},qa,Z),packages:Nb({},Z,Object.assign({},Yb,{meta:Object.assign({"package.json":{format:"json"}},Yb.meta),configured:!0}))});H.packages[Z].configured=!0;H=H.getConfig().packages[Z]||{};H.map||(H.map={});
Yb&&($b&&$b.main?zc=$b.main:Yb.main&&(zc=Yb.main),this.applySystemJSConfig(Yb));zc.match(/\.[^\/\.]+/)||(zc+=".js");H.main=zc;M.version=Pa;M.config=A;M._name=qa;M.mergeWithConfig(H);return $b?this.applyLivelyConfig($b):{subPackages:[]}}},{key:"applySystemJSConfig",value:function(A){var H=this.System;A.packageConfigPaths&&H.config({packageConfigPaths:Ba.arr.uniq(H.packageConfigPaths.concat(A.packageConfigPaths))});A.packages&&H.config({packages:A.packages});A.globalmap&&H.config({map:A.globalmap});
A.babelOptions&&H.config({babelOptions:A.babelOptions});A.meta&&H.config({meta:A.meta})}},{key:"applyLivelyConfig",value:function(A){this.applyLivelyConfigMeta(A);this.applyLivelyConfigHooks(A);this.applyLivelyConfigBundles(A)}},{key:"applyLivelyConfigHooks",value:function(A){var H=this;(A.hooks||[]).forEach(function(Z){try{var M=eval("("+Z.source+")");M.name&&Ba.isHookInstalled(H.System,Z.target,M.name)||Ba.installHook(H.System,Z.target,M)}catch(qa){console.error("Error installing hook for %s: %s",
H.packageURL,qa,Z)}})}},{key:"applyLivelyConfigBundles",value:function(A){var H=this;if(!A.bundles)return Promise.resolve();var Z=Object.keys(A.bundles).reduce(function(M,qa){var Pa=H.packageURL+"/"+qa;qa=A.bundles[qa].map(function(Yb){return H.System.decanonicalize(Yb,H.packageURL+"/")});M[Pa]=qa;return M},{});this.System.config({bundles:Z});return Promise.resolve()}},{key:"applyLivelyConfigMeta",value:function(A){if(A.meta){var H=this.System.getConfig().packages[this.packageURL]||{},Z={meta:{},
packages:Nb({},this.packageURL,H)};Object.keys(A.meta).forEach(function(M){var qa=A.meta[M];Ba.isURL(M)?Z.meta[M]=qa:(H.meta||(H.meta={}),H.meta[M]=qa)});this.System.config(Z)}}},{key:"System",get:function(){return this.pkg.System}},{key:"packageURL",get:function(){return this.pkg.url}}]);return y}();Ba.PackageConfiguration=mb;Ba["default"]=mb;var Ca=window.lively.FreezerRuntime.recorderFor("lively.modules/src/packages/package.js");Ca.packagesConfig=Oc;Ca.normalizePackageURL=function(y,A){if((2<arguments.length&&
void 0!==arguments[2]?arguments[2]:[]).some(function(Z){return Z===A}))return A;var H=y.decanonicalize(A.replace(/[\/]+$/,"")+"/");if(!Ca.isURL(H))throw Error("Strange package URL: ".concat(H," is not a valid URL"));H.match(/\.js/)&&(H=-1<H.indexOf(H+".js")?H.replace(/\.js$/,""):H.split("/").slice(0,-1).join("/"));H.match(/\.js$/)&&console.warn("packageURL is expected to point to a directory but seems to be a .js file: "+H);return String(H).replace(/\/$/,"")};Ca.lookupPackage=Ma;Ca.ensurePackage=
qb;Ca.getPackage=Vb;Ca.applyConfig=Lb;Ca.importPackage=Kb;Ca.removePackage=Db;Ca.reloadPackage=Ra;Ca.registerPackage=N;Ca.getPackageSpecs=va;Ca.commonjsHelpers=hb;Ca.arr=Nd;Ca.promise=ba;Ca.obj=yb;Ca.emit=cb;Ca.module=tb;Ca.resource=wb;Ca.PackageConfiguration=mb;Ca.isURL=Ub;Ca.join=Y;Ca.classHolder=re;Ca.packagesConfig=Oc;var Cc=function(){function y(A,H,Z,M){var qa=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};nd(this,y);this.System=A;this.url=H;this.registerProcess=null;this.map={};
this.setConfig(qa)}Fd(y,null,[{key:"allPackages",value:function(A){return Ca.obj.values(Ca.classHolder.PackageRegistry.ofSystem(A).byURL)}},{key:"allPackageURLs",value:function(A){return Ca.classHolder.PackageRegistry.ofSystem(A).allPackageURLs()}},{key:"forModule",value:function(A,H){return this.forModuleId(A,H.id)}},{key:"forModuleId",value:function(A,H){return(H=Ca.classHolder.ModulePackageMapping.forSystem(A).getPackageURLForModuleId(H))?Ca.getPackage(A,H,!0):null}},{key:"fromJSON",value:function(A,
H){return(new Ca.Package(A)).fromJSON(H)}}]);Fd(y,[{key:"setConfig",value:function(A){this._name=A.name;this.version=A.version;this.dependencies=A.dependencies||{};this.devDependencies=A.devDependencies||{};this.main=A.main||"index.js";this.systemjs=A.systemjs;this.lively=A.lively}},{key:"toJSON",value:function(){var A=this.System,H=Ca.obj.select(this,"url _name version map dependencies devDependencies main systemjs lively".split(" "));H.url.startsWith(A.baseURL)&&(H.url=H.url.slice(A.baseURL.length).replace(/^\//,
""));return H}},{key:"fromJSON",value:function(A){var H=this.System;this.url=A.url;this._name=A._name;this.version=A.version;this.map=A.map||{};this.main=A.main;this.dependencies=A.dependencies||{};this.devDependencies=A.devDependencies||{};this.systemjs=A.systemjs;this.lively=A.lively;Ca.isURL(this.url)||(this.url=Ca.join(H.baseURL,this.url));this.registerWithConfig();return this}},{key:"asSpec",value:function(){return Object.assign({},Ca.obj.select(this,"name main map meta url address version lively".split(" ")),
{modules:this.modules().map(function(A){return{name:A.id,deps:A.directRequirements().map(function(H){return H.id})}})})}},{key:"path",value:function(){var A=this.System.baseURL;return 0===this.url.indexOf(A)?this.url.slice(A.length):this.url}},{key:"modules",value:function(){var A=this.url,H=this.System;return Ca.classHolder.ModulePackageMapping.forSystem(H).getModuleIdsForPackageURL(A).map(function(Z){return Ca.module(H,Z)})}},{key:"resources",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa=
this,Pa,Yb,$b,zc,id,jd,kd,be,te=arguments;return regeneratorRuntime.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:return Pa=1<te.length&&void 0!==te[1]?te[1]:[".git","node_modules",".module_cache","lively.next-node_modules"],Yb=this.System,$b=this.url,zc=Ca.Package.allPackageURLs(Yb),id=zc.filter(function(me){return me!==$b&&!$b.startsWith(me)}),Ce.next=6,Ca.resource($b).dirList("infinity",{exclude:Pa});case 6:return jd=Ce.sent,kd=jd.filter(function(me){return!me.isDirectory()&&!id.some(function(ve){return me.url.startsWith(ve)})}).map(function(me){return me.url}),
be=Ca.arr.pluck(this.modules(),"id"),Z&&(kd=kd.filter(Z)),Ce.abrupt("return",kd.map(function(me){var ve=me.replace($b,"").replace(/^\//,"");return{isLoaded:be.includes(me),url:me,nameInPackage:ve,"package":qa}}));case 11:case "end":return Ce.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"hasResource",value:function(A){var H=this.url;return(A.startsWith(H)?Ca.resource(A):Ca.resource(H).join(A)).exists()}},{key:"toString",value:function(){return"Package(".concat(this.name,
" - ").concat(this.path(),"/)")}},{key:"mergeWithConfig",value:function(A){var H=A=Object.assign({},A),Z=H.name;H=H.map;Z&&(delete A.name,this._name=Z);H&&(delete A.map,Object.assign(this.map,H));Object.assign(this,A);return this}},{key:"addMapping",value:function(A,H){this.map[A]=H;this.System.config({packages:Nb({},this.url,{map:Nb({},A,H)})})}},{key:"tryToLoadPackageConfig",value:function(){var A=Hb(regeneratorRuntime.mark(function Z(){var M,qa,Pa,Yb,$b,zc;return regeneratorRuntime.wrap(function(id){for(;;)switch(id.prev=
id.next){case 0:M=this.System;qa=this.url;Pa=qa+"/package.json";M.config({meta:Nb({},Pa,{format:"json"}),packages:Nb({},qa,{meta:{"package.json":{format:"json"}}})});M.debug&&console.log("[lively.modules package reading config] %s",Pa);id.prev=4;id.t0=M.get(Pa);if(id.t0){id.next=10;break}id.next=9;return M["import"](Pa);case 9:id.t0=id.sent;case 10:return Yb=id.t0,$b=sb(M.packageConfigPaths),Ca.arr.pushIfNotIncluded($b,Pa),M.config({packageConfigPaths:$b}),id.abrupt("return",Yb);case 17:return id.prev=
17,id.t1=id["catch"](4),console.log("[lively.modules package] Unable loading package config %s for package: ",Pa,id.t1),delete M.meta[Pa],zc=qa.split("/").slice(-1)[0],id.abrupt("return",{name:zc});case 23:case "end":return id.stop()}},Z,this,[[4,17]])}));return function(){return A.apply(this,arguments)}}()},{key:"import",value:function(){var A=Hb(regeneratorRuntime.mark(function Z(){var M,qa,Pa,Yb,$b;return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:return zc.next=
2,this.register();case 2:return M=this.url,qa=this.System,zc.t0=Ca,zc.t1=qa,zc.next=7,qa.normalize(M);case 7:return zc.t2=zc.sent,Pa=zc.t0.module.call(zc.t0,zc.t1,zc.t2),zc.next=11,qa["import"](Pa.id);case 11:return Yb=zc.sent,$b=Ca.promise.deferred(),Pa.whenLoaded($b.resolve),zc.next=16,$b.promise;case 16:return zc.abrupt("return",Yb);case 17:case "end":return zc.stop()}},Z,this)}));return function(){return A.apply(this,arguments)}}()},{key:"isRegistering",value:function(){return!!this.registerProcess}},
{key:"register",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b;return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:if(!this.isRegistering()){zc.next=2;break}return zc.abrupt("return",this.registerProcess.promise);case 2:qa=this.System;Pa=this.url;this.registerProcess=Ca.promise.deferred();Yb=this.registerProcess.promise;qa.debug&&console.log("[lively.modules package register] %s",Pa);zc.prev=6;zc.t0=Z;if(zc.t0){zc.next=12;break}zc.next=
11;return this.tryToLoadPackageConfig();case 11:zc.t0=zc.sent;case 12:$b=zc.t0;this.registerWithConfig($b);this.registerProcess.resolve($b);zc.next=21;break;case 17:throw zc.prev=17,zc.t1=zc["catch"](6),this.registerProcess.reject(zc.t1),zc.t1;case 21:return zc.prev=21,delete this.registerProcess,zc.finish(21);case 24:return zc.abrupt("return",Yb);case 25:case "end":return zc.stop()}},M,this,[[6,17,21,24]])}));return function(Z){return A.apply(this,arguments)}}()},{key:"updateConfig",value:function(A){A=
Object.assign({},this.runtimeConfig,{},A);var H=this.name,Z=this.version,M=A,qa=M.name;M=M.version;(new Ca.PackageConfiguration(this)).applyConfig(A);if(H!==A.name||Z!==A.version)console.log("[lively.modules] Updating registry ".concat(H,"@").concat(Z," => ").concat(qa,"@").concat(M)),Ca.classHolder.PackageRegistry.ofSystem(this.System).updateNameAndVersionOf(this,H,Z,qa,M)}},{key:"registerWithConfig",value:function(){var A=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.runtimeConfig,
H=this.System,Z=this.url,M=(new Ca.PackageConfiguration(this)).applyConfig(A),qa=Ca.join(Z,"package.json");H.get(qa)||H.set(qa,H.newModule(Object.assign({},A,{"default":A})));Ca.emit("lively.modules/packageregistered",{"package":Z},Date.now(),H);return M}},{key:"remove",value:function(A){A=Object.assign({forgetEnv:!0,forgetDeps:!1,unloadModules:!0},A);var H=this.System,Z=this.url;Z=Z.replace(/\/$/,"");A.unloadModules&&this.modules().forEach(function(Pa){return Pa.unload(A)});Ca.classHolder.PackageRegistry.ofSystem(H).removePackage(this);
var M=H.getConfig(),qa=Z+"/package.json";H["delete"](String(qa));Ca.arr.remove(M.packageConfigPaths||[],qa);H.config({meta:Nb({},qa,{}),packages:Nb({},Z,{}),packageConfigPaths:M.packageConfigPaths});delete H.packages[Z];Ca.emit("lively.modules/packageremoved",{"package":this.url},Date.now(),H)}},{key:"reload",value:function(A){var H=this.url,Z=Ca.classHolder.PackageRegistry.ofSystem(this.System),M=Z.coversDirectory(H);this.remove(A);Z.addPackageAt(H,M||"devPackageDirs",Nb({},H,this));return this["import"]()}},
{key:"fork",value:function(){var A=Hb(regeneratorRuntime.mark(function qa(Z,M){return regeneratorRuntime.wrap(function(Pa){for(;;)switch(Pa.prev=Pa.next){case 0:return M||(M=Ca.resource(this.url).join("../".concat(Z)).withRelativePartsResolved().url),Pa.next=3,this.changeAddress(M,Z,!1);case 3:return Pa.abrupt("return",Pa.sent);case 4:case "end":return Pa.stop()}},qa,this)}));return function(Z,M){return A.apply(this,arguments)}}()},{key:"rename",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa;
return regeneratorRuntime.wrap(function(Pa){for(;;)switch(Pa.prev=Pa.next){case 0:return qa=Ca.resource(this.url).join("../".concat(Z)).withRelativePartsResolved().url,Pa.next=3,this.changeAddress(qa,Z,!0);case 3:return Pa.abrupt("return",Pa.sent);case 4:case "end":return Pa.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"changeAddress",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b,zc,id,jd,kd,be,te,Ce,me,ve,qg,Eg,Wf,$f,Lf,jf,wh,yg,
Gg,zf,Kh,cg,Ag=arguments;return regeneratorRuntime.wrap(function(Uf){for(;;)switch(Uf.prev=Uf.next){case 0:return qa=1<Ag.length&&void 0!==Ag[1]?Ag[1]:null,Pa=2<Ag.length&&void 0!==Ag[2]?Ag[2]:!0,Z=Z.replace(/\/?/,""),Yb=this.System,$b=this.url,Uf.next=6,this.runtimeConfig;case 6:return zc=Uf.sent,id=Ca.resource($b).asDirectory(),jd=new Ca.Package(Yb,Z),Uf.next=11,Ca.resource(Z).asDirectory();case 11:return kd=Uf.sent,zc.name=qa||this.name,be=Ca.classHolder.PackageRegistry.ofSystem(Yb),te=be.coversDirectory($b),
Ca.classHolder.ModulePackageMapping.forSystem(Yb).clearCache(),Yb.packages[$b]&&(Yb.packages[Z]=Yb.packages[$b],Pa&&delete Yb.packages[$b]),Object.assign(jd,Ca.obj.select(this,["_name","map","config"])),Uf.next=20,kd.ensureExistance();case 20:return Uf.next=22,this.resources(void 0,[]);case 22:Uf.t0=function(Lh){return Lh.url},Ce=Uf.sent.map(Uf.t0),me=this.modules(),ve=ec(me),Uf.prev=26,ve.s();case 28:if((qg=ve.n()).done){Uf.next=42;break}Eg=qg.value;Wf=kd.join(Eg.pathInPackage()).url;if(!Pa){Uf.next=
36;break}Uf.next=34;return Eg.renameTo(Wf);case 34:Uf.next=38;break;case 36:return Uf.next=38,Eg.copyTo(Wf);case 38:$f=Ce.indexOf(Eg.id),-1<$f&&Ce.splice($f,1);case 40:Uf.next=28;break;case 42:Uf.next=47;break;case 44:Uf.prev=44,Uf.t1=Uf["catch"](26),ve.e(Uf.t1);case 47:return Uf.prev=47,ve.f(),Uf.finish(47);case 50:Lf=ec(Ce),Uf.prev=51,Lf.s();case 53:if((jf=Lf.n()).done){Uf.next=61;break}wh=jf.value;yg=Ca.resource(wh);Gg=yg.relativePathFrom(id);Uf.next=59;return yg.copyTo(kd.join(Gg));case 59:Uf.next=
53;break;case 61:Uf.next=66;break;case 63:Uf.prev=63,Uf.t2=Uf["catch"](51),Lf.e(Uf.t2);case 66:return Uf.prev=66,Lf.f(),Uf.finish(66);case 69:if(!Pa){Uf.next=74;break}Uf.next=72;return this.remove({forgetEnv:!0,forgetDeps:!1});case 72:return Uf.next=74,id.remove();case 74:if(!qa){Uf.next=95;break}jd.name=qa;jd.config.name=qa;zf=Ca.resource(Z).join("package.json");Uf.prev=78;Uf.next=81;return zf.exists();case 81:if(!Uf.sent){Uf.next=91;break}Uf.next=84;return zf.readJson();case 84:Kh=Uf.sent;if(Kh.name!==
this.name){Uf.next=89;break}Kh.name=qa;Uf.next=89;return zf.writeJson(Kh,!0);case 89:(cg=Yb.get(zf.url))&&Yb.set(zf.url,Yb.newModule(Object.assign({},cg,{name:qa})));case 91:Uf.next=95;break;case 93:Uf.prev=93,Uf.t3=Uf["catch"](78);case 95:return te=te||"individualPackageDirs","individualPackageDirs"!==te&&"devPackageDirs"!==te||be._addPackageDir(Z,te,!0),be._addPackageWithConfig(jd,zc,Z,te),be.resetByURL(),be._updateLatestPackages(),Uf.abrupt("return",jd);case 101:case "end":return Uf.stop()}},M,
this,[[26,44,47,50],[51,63,66,69],[78,93]])}));return function(Z){return A.apply(this,arguments)}}()},{key:"search",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa=this,Pa,Yb,$b=arguments;return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:Pa=1<$b.length&&void 0!==$b[1]?$b[1]:{};if(!Pa.includeUnloaded){zc.next=8;break}zc.next=4;return this.resources(function(id){return id.endsWith(".js")},[".git","node_modules","dist",".module_cache","lively.next-node_modules"].concat(sb(Pa.excludedModules||
[])));case 4:zc.t1=function(id){return Ca.module(qa.System,id.url)};zc.t0=zc.sent.map(zc.t1);zc.next=9;break;case 8:zc.t0=this.modules().filter(function(id){return id.isLoaded()});case 9:return Yb=zc.t0,zc.abrupt("return",Promise.all(Yb.map(function(id){return id.search(Z,Pa)["catch"](function(jd){console.error("Error searching module ".concat(id.name,":\n").concat(jd.stack));return[]})})).then(function(id){return id.flat()}));case 11:case "end":return zc.stop()}},M,this)}));return function(Z){return A.apply(this,
arguments)}}()},{key:"isPackage",get:function(){return!0}},{key:"name",get:function(){if(this._name)return this._name;var A=this.System.get(this.url+"/package.json");return A&&A.name?A.name:Ca.arr.last(this.url.replace(/[\/]+$/,"").split("/"))},set:function(A){return this._name=A}},{key:"nameAndVersion",get:function(){return"".concat(this.name,"@").concat(this.version)}},{key:"address",get:function(){return this.url},set:function(A){return this.url=A}},{key:"runtimeConfig",get:function(){var A=this.main,
H=this.systemjs,Z=this.lively,M={name:this.name,version:this.version,dependencies:this.dependencies||{},devDependencies:this.devDependencies||{}};A&&(M.main=A);H&&(M.systemjs=H);Z&&(M.lively=Z);return M}}]);return y}();Ca.Package=Cc;Ca.ensurePackage=qb;Ca.importPackage=Kb;Ca.removePackage=Db;Ca.reloadPackage=Ra;Ca.registerPackage=N;Ca.getPackage=Vb;Ca.lookupPackage=Ma;Ca.applyConfig=Lb;Ca.getPackageSpecs=va;Ca.Package=Cc;var Fc=window.lively.FreezerRuntime.recorderFor("lively.modules/src/import-modification.js");
Fc.arr=Nd;Fc.Path=Jc;Fc.fuzzyParse=Xa;Fc.query=rd;Fc.stringify=Bb;Fc.resource=wb;var ud=Lc("I",function(){function y(A,H,Z,M,qa,Pa,Yb){nd(this,y);this.System=A;this.intoModuleId=H;this.intoPackage=Z;this.intoModuleSource=M;this.fromModuleId=qa.moduleId;this.importData=qa;this.alias=Pa;this.parsed=Yb||Fc.fuzzyParse(M)}Fd(y,null,[{key:"run",value:function(A,H,Z,M,qa){return(new this(A,H,Z,M,qa,5<arguments.length&&void 0!==arguments[5]?arguments[5]:void 0,6<arguments.length&&void 0!==arguments[6]?arguments[6]:
void 0)).run()}}]);Fd(y,[{key:"run",value:function(){var A=this.generateImportStatement(),H=A.standaloneImport,Z=A.importedVarName,M=this.existingImportsOfFromModule(),qa=M.imports,Pa=M.importsOfFromModule;M=M.importsOfVar;Pa=this.importsToBeReused(Pa,M,A);if(M.length)return{status:"not modified",newSource:this.intoModuleSource,generated:"",importedVarName:"",standaloneImport:H,from:M[0].start,to:M[0].end};if(Pa.length&&(A=this.modifyExistingImport(Pa,H)))return A;qa=Fc.arr.last(qa);return this.insertNewImport(Pa,
H,Z,qa?qa.end:0)}},{key:"importsToBeReused",value:function(A,H,Z){Z.isDefault&&(A=A.filter(function(M){return!M.specifiers.some(function(qa){return"ImportDefaultSpecifier"===qa.type})}));return A}},{key:"generateImportStatement",value:function(){var A=this.intoModuleId,H=this.fromModuleId,Z=this.importData,M=this.intoPackage,qa="default"===Z.exported,Pa=this.alias||(qa?Z.local:Z.exported),Yb=!qa&&Z.exported!==Pa;M=M&&M.name;var $b=H,zc=Z.packageName,id=Z.pathInPackage;if(Z.isMain)$b=zc;else if(M===
zc)try{$b=Fc.resource(H).relativePathFrom(Fc.resource(A)),$b.startsWith(".")||($b="./"+$b)}catch(jd){zc&&"no group"!==zc&&id&&($b=zc+"/"+id)}else zc&&"no group"!==zc&&id&&($b=zc+"/"+id);return{isDefault:qa,standaloneImport:qa?"import ".concat(Pa,' from "').concat($b,'";'):"import { ".concat(Z.exported).concat(Yb?" as ".concat(Pa):"",' } from "').concat($b,'";'),importedVarName:Pa}}},{key:"existingImportsOfFromModule",value:function(){var A=this.System,H=this.fromModuleId,Z=this.intoModuleId,M=this.importData,
qa=M.exported,Pa=M.local,Yb=this.alias,$b="default"===qa;M=this.parsed.body.filter(function(id){return"ImportDeclaration"===id.type});var zc=$b?Yb||Pa:Yb||qa;H=A.decanonicalize(H,Z);Pa=M.filter(function(id){if(!id.source||"string"!==typeof id.source.value)return null;id=A.decanonicalize(id.source.value,Z);return H===id});Yb=Pa.filter(function(id){return(id.specifiers||[]).some(function(jd){return $b?"ImportDefaultSpecifier"===jd.type&&jd.local.name===zc:Fc.Path("imported.name").get(jd)===qa&&Fc.Path("local.name").get(jd)===
zc})});return{imports:M,importsOfFromModule:Pa,importsOfVar:Yb}}},{key:"modifyExistingImport",value:function(A,H){A=A.flatMap(function(zc){return zc.specifiers||[]});if(!A.length)return null;A=Fc.arr.partition(A,function(zc){return"ImportDefaultSpecifier"===zc.type});A=Xb(A,2);var Z=Xb(A[0],1)[0],M=Xb(A[1],1)[0];A=this.alias;var qa=this.intoModuleSource,Pa=this.importData,Yb=Pa.exported;Pa=Pa.local;var $b="default"===Yb;$b?console.assert(!!M,"no ImportSpecifier found"):console.assert(M||Z,"at least one kine of specifier is expected");
if($b){Z=qa.slice(0,M.start).lastIndexOf("{")-1;if(0>Z)return null;M=(A||Pa)+",";Yb=qa.slice(0,Z);qa=qa.slice(Z);Yb.endsWith(" ")&&Yb.endsWith("\n")||(M=" "+M);qa.startsWith(" ")||(M+=" ");return{status:"modified",newSource:"".concat(Yb).concat(M).concat(qa),generated:M,standaloneImport:H,importedVarName:A||Pa,from:Z,to:Z+M.length}}Z=M?M.end:Z.end;$b=(Pa=A&&A!==Yb)?"".concat(Yb," as ").concat(A):Yb;M=M?", ".concat($b):", { ".concat($b," }");return{status:"modified",newSource:"".concat(qa.slice(0,
Z)).concat(M).concat(qa.slice(Z)),generated:M,standaloneImport:H,importedVarName:Pa?A:Yb,from:Z,to:Z+M.length}}},{key:"insertNewImport",value:function(A,H,Z){var M=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;A&&A.length&&(M=Fc.arr.last(A).end);var qa=this.intoModuleSource,Pa=qa.slice(0,M);qa=qa.slice(M);var Yb=H;Pa.length&&!Pa.endsWith("\n")&&(Yb="\n"+Yb);qa.length&&!qa.startsWith("\n")&&(Yb+="\n");return{status:"modified",newSource:Pa+Yb+qa,generated:Yb,standaloneImport:H,importedVarName:Z,
from:M,to:M+Yb.length}}}]);return y}());Fc.ImportInjector=ud;var ke=Lc("G",function(){function y(){nd(this,y)}Fd(y,null,[{key:"getGlobals",value:function(A,H){A=H||Fc.fuzzyParse(A,{withComments:!0});H=(H=A.comments?A.comments.find(function(M){return M.isBlock&&M.text.match(/^\s*global/)}):null)?H.text.replace(/^\s*global\s*/,"").split(",").map(function(M){return M.trim()}).filter(Boolean):[];var Z=[].concat(sb(H),sb(Fc.query.knownGlobals));A=Fc.query.findGlobalVarRefs(A,{jslintGlobalComment:!0}).filter(function(M){return!Z.includes(M.name)}).map(function(M){return M.name});
return Fc.arr.compact([].concat(sb(H),sb(A)))}},{key:"run",value:function(A,H,Z){Z=Z||Fc.fuzzyParse(A,{withComments:!0});var M=(Z=Z.comments?Z.comments.find(function(Pa){return Pa.isBlock&&Pa.text.startsWith("global")}):null)?Z.text.replace(/^global\s*/,"").split(",").map(function(Pa){return Pa.trim()}).filter(Boolean):[],qa=H.filter(function(Pa){return!M.includes(Pa)});if(!qa.length)return{status:"not modified",newSource:A,generated:"",from:0,to:0};if(!Z)return Z="/*global ".concat(qa.join(","),
"*/\n"),{status:"modified",newSource:Z+A,generated:Z,from:0,to:Z.length};H=Z.start+2+Z.text.length;qa=qa.join(",");M.length?qa=","+qa:Z.text.startsWith("global ")||(qa=" "+qa);Z=H+qa.length;return{status:"modified",newSource:A.slice(0,H)+qa+A.slice(H),generated:qa,from:H,to:Z}}}]);return y}());Fc.GlobalInjector=ke;var ze=Lc("f",function(){function y(){nd(this,y)}Fd(y,null,[{key:"removeImports",value:function(A,H,Z){var M=(Z||Fc.fuzzyParse(A)).body.flatMap(function(qa){return"ImportDeclaration"===
qa.type&&qa.specifiers.length?qa.specifiers.map(function(Pa){return{local:Pa.local,importStmt:qa}}):[]}).filter(function(qa){return H.some(function(Pa){return Pa.local===qa.local.name})});Z=M.map(function(qa){return{local:qa.local.name,from:qa.importStmt.source.value}});A=Fc.arr.uniq(M.map(function(qa){var Pa=qa.importStmt.specifiers.find(function(Yb){return qa.local===Yb.local});Fc.arr.remove(qa.importStmt.specifiers,Pa);return qa.importStmt})).slice().reverse().reduce(function(qa,Pa){var Yb=qa.source;
qa=qa.changes;var $b=Pa.start,zc=Pa.end,id=Pa.specifiers,jd=Yb.slice(0,$b),kd=Yb.slice(zc);Yb=Yb.slice($b,zc);(Pa=id.length?Fc.stringify(Pa):"")&&Pa.includes("\n")&&!Yb.includes("\n")&&(Pa=Pa.replace(/\s+/g," "));Yb=jd+Pa+kd;qa=qa.concat({replacement:Pa,start:$b,end:zc});return{source:Yb,changes:qa}},{source:A,changes:[]});return Object.assign({},A,{removedImports:Z})}},{key:"findUnusedImports",value:function(A){var H="string"===typeof A?Fc.fuzzyParse(A):A;A=H.body.flatMap(function(qa){return"ImportDeclaration"===
qa.type&&qa.specifiers.length?qa.specifiers.map(function(Pa){return{local:Pa.local,from:qa.source?qa.source.value:"",importStmt:qa}}):[]});var Z=A.map(function(qa){return qa.local});H=Fc.query.resolveReferences(Fc.query.scopes(H));H=Array.from(H.resolvedRefMap.keys()).filter(function(qa){return!Z.includes(qa)});var M=Fc.arr.uniq(H.map(function(qa){return qa.name}));return A.filter(function(qa){return!M.includes(qa.local.name)}).map(function(qa){return Object.assign({},qa,{local:qa.local.name})})}},
{key:"removeUnusedImports",value:function(A){var H=Fc.fuzzyParse(A);return this.removeImports(A,this.findUnusedImports(H),H)}}]);return y}());Fc.ImportRemover=ze;var xe=window.lively.FreezerRuntime.recorderFor("lively.modules/src/nodejs.js");xe.ensureParent=function(y,A,H){if(H)return H;H=y.id;var Z=y.System;A=H.startsWith("file://")?H.replace("file://",""):H;if(H=Z._nodeRequire("module").Module._cache[H])return H;H={id:A,filename:A,paths:[]};(y=y["package"]())&&H.paths.push(xe.resource(y.url).join("node_modules/").path());
return H};xe.relative=function(y,A){return xe.resource(y.id).parent().join(A).url.replace("file://","")};xe._require=Wa;xe._resolve=pa;xe.resource=wb;xe._require=Wa;xe._resolve=pa;var qd=window.lively.FreezerRuntime.recorderFor("lively.modules/src/module.js");qd.module=tb;qd.isModuleLoaded=ab;qd.doesModuleExist=Ob;qd.arr=Nd;qd.obj=yb;qd.graph=Za;qd.parse=$d;qd.query=rd;qd.computeRequireMap=eb;qd.moduleSourceChange=xb;qd.scheduleModuleExportsChange=jb;qd.runScheduledExportChanges=E;qd.livelySystemEnv=
Vc;qd.Package=Cc;qd.isURL=Ub;qd.emit=cb;qd.subscribe=Sb;qd.defaultClassToFunctionConverterName=Cb;qd.classRuntime=bc;qd.ImportInjector=ud;qd.GlobalInjector=ke;qd.ImportRemover=ze;qd._require=Wa;qd._resolve=pa;qd.classHolder=re;qd.regExpEscape=Da;var We=Lc("d",function(){var y=/['"]format (esm|es6)['"];/,A=/['"]format cjs['"];/,H=/(^\s*|[}\);\n]\s*)(import\s+(['"]|(\*\s+as\s+)?[^"'\(\)\n;]+\s+from\s+['"]|\{)|export\s+\*\s+from\s+["']|export\s+(\{|default|function|class|var|const|let|async\s+function))/;
return function(Z,M){return M&&M.format?("es6"===M.format&&"esm"===M.forma,M.format):y.test(Z.slice(0,5E3))||!A.test(Z.slice(0,5E3))&&H.test(Z)?"esm":A.test(Z.slice(0,5E3))?"cjs":"global"}}());qd.detectModuleFormat=We;qd.detectModuleFormat=We;qd.classHolder.module=qd.module;qd.isModuleLoaded=ab;qd.doesModuleExist=Ob;qd.globalProps={initialized:!1,descriptors:{}};var of=function(){function y(A,H){var Z=this;nd(this,y);if(!qd.isURL(H)&&!/^@/.test(H))throw Error("ModuleInterface constructor called with ".concat(H,
" that does not seem to be a fully normalized module id."));this.System=A;this.id=H;this.recorderName="__lvVarRecorder";this.sourceAccessorName="__lvOriginalCode";this._scope=this._ast=this._source=this._recorder=null;this._observersOfTopLevelState=[];this._evaluationsInProgress=0;this._evalId=1;this.createdAt=this.lastModifiedAt=new Date;qd.subscribe("lively.modules/modulechanged",function(M){M.module===Z.id&&Z.reset()})}Fd(y,[{key:"fullName",value:function(){return this.id}},{key:"shortName",value:function(){return"".concat(this["package"]().name,
"/").concat(this.pathInPackage())}},{key:"source",value:function(){var A=this;return"@empty"===this.id?Promise.resolve(""):this._source?Promise.resolve(this._source):this.System.resource(this.id).read().then(function(H){return A._source=H})}},{key:"setSource",value:function(A){this.sourceAccessorName&&this.recorderName&&A.includes("var "+this.recorderName)&&A.includes("var "+this.sourceAccessorName)||this._source===A||(this.reset(),this._source=A)}},{key:"ast",value:function(){var A=Hb(regeneratorRuntime.mark(function Z(){return regeneratorRuntime.wrap(function(M){for(;;)switch(M.prev=
M.next){case 0:if(!this._ast){M.next=2;break}return M.abrupt("return",this._ast);case 2:return M.t0=qd,M.next=5,this.source();case 5:return M.t1=M.sent,M.abrupt("return",this._ast=M.t0.parse.call(M.t0,M.t1));case 7:case "end":return M.stop()}},Z,this)}));return function(){return A.apply(this,arguments)}}()},{key:"scope",value:function(){var A=Hb(regeneratorRuntime.mark(function Z(){var M;return regeneratorRuntime.wrap(function(qa){for(;;)switch(qa.prev=qa.next){case 0:if(!this._scope){qa.next=2;break}return qa.abrupt("return",
this._scope);case 2:return qa.next=4,this.ast();case 4:return M=qa.sent,qa.abrupt("return",this._scope=qd.query.topLevelDeclsAndRefs(M).scope);case 6:case "end":return qa.stop()}},Z,this)}));return function(){return A.apply(this,arguments)}}()},{key:"resolvedScope",value:function(){var A=Hb(regeneratorRuntime.mark(function Z(){return regeneratorRuntime.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.t0=qd.query,M.next=3,this.scope();case 3:return M.t1=M.sent,M.abrupt("return",this._scope=
M.t0.resolveReferences.call(M.t0,M.t1));case 5:case "end":return M.stop()}},Z,this)}));return function(){return A.apply(this,arguments)}}()},{key:"metadata",value:function(){var A=this.System.loads?this.System.loads[this.id]:null;return A?A.metadata:null}},{key:"addMetadata",value:function(A){var H=this.System,Z=this.id,M=this.metadata();A=M?Object.assign(M,A):A;H.config({meta:Nb({},Z,A)});return H.meta[Z]}},{key:"format",value:function(){var A=this.metadata();return A&&A.format?A.format:this._source?
qd.detectModuleFormat(this._source):"global"}},{key:"setFormat",value:function(A){return this.addMetadata({format:A})}},{key:"reset",value:function(){this._scope=this._ast=this._source=null}},{key:"get",value:function(){return this.System.get(this.id)}},{key:"load",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa;return regeneratorRuntime.wrap(function(Yb){for(;;)switch(Yb.prev=Yb.next){case 0:qa=this.id;Pa=this.System;Z&&this.addMetadata(Z);Yb.t0=Pa.get(qa);if(Yb.t0){Yb.next=
7;break}Yb.next=6;return Pa["import"](qa);case 6:Yb.t0=Yb.sent;case 7:return Yb.abrupt("return",Yb.t0);case 8:case "end":return Yb.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"isLoaded",value:function(){return!!this.System.get(this.id)}},{key:"unloadEnv",value:function(){this._recorder=null;this._observersOfTopLevelState=[];delete qd.livelySystemEnv(this.System).loadedModules[this.id]}},{key:"unloadDeps",value:function(A){var H=this;A=qd.obj.merge({forgetDeps:!0,
forgetEnv:!0},A);this.dependents().forEach(function(Z){H.System["delete"](Z.id);H.System.loads&&delete H.System.loads[Z.id];A.forgetEnv&&Z.unloadEnv()})}},{key:"unload",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb;return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=$b.next){case 0:Z=Object.assign({reset:!0,forgetDeps:!0,forgetEnv:!0},Z);qa=this.System;Pa=this.id;Z.reset&&this.reset();Z.forgetDeps&&this.unloadDeps(Z);this.System["delete"](Pa);qa.loads&&
delete qa.loads[Pa];qa.meta&&delete qa.meta[Pa];Z.forgetEnv&&this.unloadEnv();Yb=qa._livelyModulesTranslationCache;if(!Yb){$b.next=12;break}$b.next=12;return Yb.deleteCachedData(Pa);case 12:qd.emit("lively.modules/moduleunloaded",{module:this.id},Date.now(),this.System);case 13:case "end":return $b.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"reload",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa=this,Pa;return regeneratorRuntime.wrap(function(Yb){for(;;)switch(Yb.prev=
Yb.next){case 0:return Z=qd.obj.merge({reloadDeps:!0,resetEnv:!0},Z),Pa=[this],Z.reloadDeps&&(Pa=this.dependents().concat(Pa)),Yb.next=5,this.unload({forgetDeps:Z.reloadDeps,forgetEnv:Z.resetEnv});case 5:return Yb.next=7,Promise.all(Pa.map(function($b){return $b.id!==qa.id&&$b.load()}));case 7:return Yb.next=9,this.load();case 9:case "end":return Yb.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"copyTo",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,
Pa,Yb;return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=$b.next){case 0:return $b.t0=this.System.resource(Z),$b.next=3,this.source();case 3:return $b.t1=$b.sent,$b.next=6,$b.t0.write.call($b.t0,$b.t1);case 6:return qa=this.System,Pa=qd.module(qa,Z),Yb=qd.obj.select(this,"_observersOfTopLevelState _scope _ast _source _recorder sourceAccessorName recorderName".split(" ")),Object.assign(Pa,Yb),qa.set(Z,qa.newModule(qa.get(this.id))),$b.abrupt("return",Pa);case 12:case "end":return $b.stop()}},
M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"renameTo",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b,zc,id,jd=arguments;return regeneratorRuntime.wrap(function(kd){for(;;)switch(kd.prev=kd.next){case 0:return qa=1<jd.length&&void 0!==jd[1]?jd[1]:{},Pa=qa.unload,Yb=void 0===Pa?!0:Pa,$b=qa.removeFile,zc=void 0===$b?!0:$b,kd.next=4,this.copyTo(Z);case 4:id=kd.sent;if(!Yb){kd.next=8;break}kd.next=8;return this.unload({reset:!0,forgetDeps:!1,
forgetEnv:!0});case 8:if(!zc){kd.next=11;break}kd.next=11;return this.System.resource(this.id).remove();case 11:return kd.abrupt("return",id);case 12:case "end":return kd.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"whenLoaded",value:function(A){if(this.isLoaded())try{A(this)}catch(H){console.error(H)}else qd.livelySystemEnv(this.System).onLoadCallbacks.push({moduleName:this.id,resolved:!0,callback:A})}},{key:"changeSourceAction",value:function(A){var H=this;return Promise.resolve(this.source()).then(function(Z){return A(Z)}).then(function(Z){return H.changeSource(Z)})}},
{key:"changeSource",value:function(A,H){H=Object.assign({doSave:!0,doEval:!0},H);var Z=this.System,M=this.id,qa=this.format(),Pa;this.reset();this.lastModifiedAt=new Date;return Promise.all([H.doSave&&this.System.resource(M).write(A),H.doEval&&qd.moduleSourceChange(Z,M,A,qa,H).then(function(Yb){return Pa=Yb})]).then(function(){return Pa})}},{key:"addDependencyToModuleRecord",value:function(A){var H=this,Z=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},M=this.record(),qa=A.record();
if(M&&qa){var Pa,Yb=M.dependencies.some(function(zc,id){if(zc)return Pa=id,zc&&zc.name===A.id});Yb?qa!==M.dependencies[Pa]&&M.dependencies.splice(Pa,1,qa):M.dependencies.push(qa);Yb&&M.setters[Pa]||(M.setters[Yb?Pa:M.dependencies.length-1]=Z);var $b;qa.importers.some(function(zc,id){if(zc)return $b=id,zc&&zc.name===H.id})?M!==qa.importers[$b]&&qa.importers.splice($b,1,M):qa.importers.push(M)}}},{key:"dependents",value:function(){var A=this;return qd.graph.hull(qd.graph.invert(qd.computeRequireMap(this.System)),
this.id).map(function(H){return qd.module(A.System,H)})}},{key:"requirements",value:function(){var A=this;return qd.graph.hull(qd.computeRequireMap(this.System),this.id).map(function(H){return qd.module(A.System,H)})}},{key:"directRequirements",value:function(){var A=this,H=(this.record()||{}).dependencies||[];return qd.arr.pluck(H.filter(Boolean),"name").map(function(Z){return qd.module(A.System,Z)})}},{key:"isMochaTest",value:function(){if(!this._source)return!1;var A=this._scope||(this._scope=
qd.query.topLevelDeclsAndRefs(qd.parse(this._source)).scope);return qd.query.imports(A).map(function(H){return H.fromModule}).some(function(H){return H.endsWith("mocha-es6")||H.endsWith("mocha-es6/index.js")})?!0:!1}},{key:"define",value:function(A,H){var Z=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0,M=3<arguments.length?arguments[3]:void 0,qa=this.System,Pa=this.id,Yb=this.recorder;qa.debug&&console.log("[lively.modules] ".concat(this.shortName()," defines ").concat(A));var $b=Symbol["for"]("lively-object-meta"),
zc=Symbol["for"]("lively-module-meta");"function"!==typeof H||!M||"function"!==M.kind&&"class"!==M.kind||(H[$b]=M);H&&H[$b]&&!H[zc]&&(M=this.pathInPackage(),$b=this["package"](),H[zc]={"package":$b?{name:$b.name,version:$b.version}:{},pathInPackage:M});Yb[A]=H;qd.scheduleModuleExportsChange(qa,Pa,A,H,!1);this.notifyTopLevelObservers(A);(Z=Z||!this.isEvalutionInProgress())&&qd.runScheduledExportChanges(qa,Pa);return H}},{key:"undefine",value:function(A){delete this.recorder[A]}},{key:"subscribeToToplevelDefinitionChanges",
value:function(A){this._observersOfTopLevelState.push(A);return A}},{key:"notifyTopLevelObservers",value:function(A){var H=this.recorder;["createOrExtendES6ClassForLively","lively.capturing-declaration-wrapper"].includes(A)||this._observersOfTopLevelState.forEach(function(Z){return Z(A,H[A])})}},{key:"unsubscribeFromToplevelDefinitionChanges",value:function(A){this._observersOfTopLevelState="string"===typeof A?this._observersOfTopLevelState.filter(function(H){return H.name!==A}):this._observersOfTopLevelState.filter(function(H){return H!==
A})}},{key:"evaluationStart",value:function(){this._evaluationsInProgress++}},{key:"evaluationEnd",value:function(){this._evaluationsInProgress--;qd.runScheduledExportChanges(this.System,this.id)}},{key:"nextEvalId",value:function(){return this._evalId++}},{key:"isEvalutionInProgress",value:function(){return 0<this._evaluationsInProgress}},{key:"env",value:function(){return this}},{key:"package",value:function(){return qd.Package.forModule(this.System,this)}},{key:"pathInPackage",value:function(){var A=
this["package"]();return A&&0===this.id.indexOf(A.address)?this.id.slice(A.address.length).replace(/^\//,""):this.id}},{key:"imports",value:function(){var A=Hb(regeneratorRuntime.mark(function Z(){return regeneratorRuntime.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.t0=qd.query,M.next=3,this.scope();case 3:return M.t1=M.sent,M.abrupt("return",M.t0.imports.call(M.t0,M.t1));case 5:case "end":return M.stop()}},Z,this)}));return function(){return A.apply(this,arguments)}}()},{key:"exports",
value:function(){var A=Hb(regeneratorRuntime.mark(function Z(){return regeneratorRuntime.wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.t0=qd.query,M.next=3,this.scope();case 3:return M.t1=M.sent,M.abrupt("return",M.t0.exports.call(M.t0,M.t1));case 5:case "end":return M.stop()}},Z,this)}));return function(){return A.apply(this,arguments)}}()},{key:"addImports",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b,zc,id,jd,kd;return regeneratorRuntime.wrap(function(be){for(;;)switch(be.prev=
be.next){case 0:return be.next=2,this.source();case 2:qa=be.sent;Pa=ec(Z);try{for(Pa.s();!(Yb=Pa.n()).done;)$b=Yb.value,zc=qd.module(this.System,$b.from||$b.moduleId),id=zc["package"](),jd={exported:$b.exported||$b.local,moduleId:zc.id,packageName:id.name,packageURL:id.url,pathInPackage:zc.pathInPackage()},kd=$b.local,qd.__inter0__=qd.ImportInjector.run(this.System,this.id,this["package"](),qa,jd,kd),qa=qd.__inter0__.newSource}catch(te){Pa.e(te)}finally{Pa.f()}be.next=7;return this.changeSource(qa);
case 7:case "end":return be.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"addGlobalDeclaration",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b,zc;return regeneratorRuntime.wrap(function(id){for(;;)switch(id.prev=id.next){case 0:return id.next=2,this.source();case 2:qa=id.sent;Pa=qd.GlobalInjector.run(qa,Z);Yb=Pa.status;$b=Pa.newSource;zc="modified"===Yb;if(!zc){id.next=8;break}id.next=8;return this.changeSource($b);case 8:return id.abrupt("return",
zc);case 9:case "end":return id.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"removeImports",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa=this,Pa,Yb,$b,zc;return regeneratorRuntime.wrap(function(id){for(;;)switch(id.prev=id.next){case 0:if(Z.length){id.next=2;break}return id.abrupt("return");case 2:return id.next=4,this.source();case 4:return Pa=id.sent,id.next=7,qd.ImportRemover.removeImports(Pa,Z);case 7:return Yb=id.sent,$b=Yb.source,
zc=Yb.removedImports,id.next=12,this.changeSource($b);case 12:zc.forEach(function(jd){return delete qa.recorder[jd.local]});case 13:case "end":return id.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"_localDeclForRefAt",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa;return regeneratorRuntime.wrap(function(Yb){for(;;)switch(Yb.prev=Yb.next){case 0:return Yb.next=2,this.resolvedScope();case 2:return qa=Yb.sent,Pa=qd.query.refWithDeclAt(Z,
qa),Yb.abrupt("return",Pa&&{decl:Pa.decl,id:Pa.declId,declModule:this});case 5:case "end":return Yb.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"_localDeclForName",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b,zc,id;return regeneratorRuntime.wrap(function(jd){for(;;)switch(jd.prev=jd.next){case 0:return jd.next=2,this.resolvedScope();case 2:qa=jd.sent,Yb=ec(qa.resolvedRefMap.values()),jd.prev=4,Yb.s();case 6:if(($b=Yb.n()).done){jd.next=
14;break}zc=$b.value;id=zc.ref.name;if(Z!==id){jd.next=12;break}Pa=zc;return jd.abrupt("break",14);case 12:jd.next=6;break;case 14:jd.next=19;break;case 16:jd.prev=16,jd.t0=jd["catch"](4),Yb.e(jd.t0);case 19:return jd.prev=19,Yb.f(),jd.finish(19);case 22:return jd.abrupt("return",Pa&&{decl:Pa.decl,id:Pa.declId,declModule:this});case 23:case "end":return jd.stop()}},M,this,[[4,16,19,22]])}));return function(Z){return A.apply(this,arguments)}}()},{key:"_importForNSRefAt",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,
Pa,Yb,$b,zc,id,jd,kd,be;return regeneratorRuntime.wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,this.resolvedScope();case 2:qa=te.sent;Pa=qa.node;Yb=qd.query.nodesAtIndex(Pa,Z);if(!(2>Yb.length)){te.next=7;break}return te.abrupt("return",[null,null]);case 7:$b=Yb[Yb.length-1];zc=Yb[Yb.length-2];if("Identifier"===$b.type&&"MemberExpression"===zc.type&&!zc.computed&&"Identifier"===zc.object.type){te.next=11;break}return te.abrupt("return",[null,null]);case 11:id=qa.resolvedRefMap.get(zc.object)||
{};if((jd=id.decl)&&"ImportDeclaration"===jd.type){te.next=14;break}return te.abrupt("return",[null,null]);case 14:return kd=zc.object.name,be=jd.specifiers.find(function(Ce){return Ce.local.name===kd}),te.abrupt("return","ImportNamespaceSpecifier"!==be.type?[null,null]:[jd,be.local,$b.name]);case 17:case "end":return te.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"_resolveImportedDecl",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,
$b;return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:if(Z){zc.next=2;break}return zc.abrupt("return",[]);case 2:return qa=Z.id.name,zc.next=5,this.imports();case 5:Pa=zc.sent;Yb=Pa.find(function(id){return id.local===qa});if(!Yb){zc.next=14;break}$b=qd.module(this.System,Yb.fromModule,this.id);zc.t0=[Z];zc.next=12;return $b.bindingPathForExport(Yb.imported);case 12:return zc.t1=zc.sent,zc.abrupt("return",zc.t0.concat.call(zc.t0,zc.t1));case 14:return zc.abrupt("return",
[Z]);case 15:case "end":return zc.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"bindingPathFor",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa;return regeneratorRuntime.wrap(function(Pa){for(;;)switch(Pa.prev=Pa.next){case 0:return Pa.next=2,this._localDeclForName(Z);case 2:qa=Pa.sent;if(!qa){Pa.next=7;break}Pa.next=6;return this._resolveImportedDecl(qa);case 6:return Pa.abrupt("return",Pa.sent);case 7:case "end":return Pa.stop()}},M,this)}));
return function(Z){return A.apply(this,arguments)}}()},{key:"bindingPathForExport",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b;return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:return zc.next=2,this.resolvedScope();case 2:return zc.next=4,this.exports();case 4:qa=zc.sent;Pa=qa.find(function(id){return id.exported===Z});if(!Pa.fromModule){zc.next=17;break}Yb=qd.module(this.System,Pa.fromModule,this.id);$b={decl:Pa.node,id:Pa.declId,
declModule:this};zc.t0=[$b];zc.next=13;return Yb.bindingPathForExport(Pa.imported);case 13:return zc.t1=zc.sent,zc.abrupt("return",zc.t0.concat.call(zc.t0,zc.t1));case 17:return zc.abrupt("return",this._resolveImportedDecl({decl:Pa.decl,id:Pa.declId,declModule:Pa&&Pa.decl?this:null}));case 18:case "end":return zc.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"bindingPathForRefAt",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b,zc,id,
jd;return regeneratorRuntime.wrap(function(kd){for(;;)switch(kd.prev=kd.next){case 0:return kd.next=2,this._localDeclForRefAt(Z);case 2:qa=kd.sent;if(!qa){kd.next=7;break}kd.next=6;return this._resolveImportedDecl(qa);case 6:return kd.abrupt("return",kd.sent);case 7:return kd.next=9,this._importForNSRefAt(Z);case 9:Pa=kd.sent;Yb=Xb(Pa,3);$b=Yb[0];zc=Yb[1];id=Yb[2];if($b){kd.next=16;break}return kd.abrupt("return",[]);case 16:return jd=qd.module(this.System,$b.source.value,this.id),kd.t0=[{decl:$b,
declModule:this,id:zc}],kd.next=20,jd.bindingPathForExport(id);case 20:return kd.t1=kd.sent,kd.abrupt("return",kd.t0.concat.call(kd.t0,kd.t1));case 22:case "end":return kd.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"definitionForRefAt",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa;return regeneratorRuntime.wrap(function(Pa){for(;;)switch(Pa.prev=Pa.next){case 0:return Pa.next=2,this.bindingPathForRefAt(Z);case 2:return qa=Pa.sent,Pa.abrupt("return",
1>qa.length?null:qa[qa.length-1].decl);case 4:case "end":return Pa.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"ensureRecord",value:function(){var A=this.System,H=A._loader.moduleRecords;return H[this.id]?H[this.id]:H[this.id]={name:this.id,exports:A.newModule({}),dependencies:[],importers:[],setters:[]}}},{key:"record",value:function(){var A=this.System._loader.moduleRecords[this.id];if(!A)return null;A.hasOwnProperty("__lively_modules__")||(A.__lively_modules__=
{evalOnlyExport:{}});return A}},{key:"updateRecord",value:function(A){var H=this.record();if(!H)throw Error("es6 environment global of ".concat(this.id,": module not loaded, cannot get export object!"));H.locked=!0;try{return A(H)}finally{H.locked=!1}}},{key:"search",value:function(){var A=Hb(regeneratorRuntime.mark(function qa(Z,M){var Pa=this,Yb,$b,zc,id,jd,kd,be,te,Ce,me,ve,qg,Eg,Wf,$f;return regeneratorRuntime.wrap(function(Lf){for(;;)switch(Lf.prev=Lf.next){case 0:M=Object.assign({excludedModules:[]},
M);if(!M.excludedModules.some(function(jf){return"string"===typeof jf?jf===Pa.id:jf instanceof RegExp?jf.test(Pa.id):"function"===typeof jf?jf(Pa.id):!1})){Lf.next=3;break}return Lf.abrupt("return",[]);case 3:return Lf.next=5,this.source();case 5:Yb=Lf.sent;Z instanceof RegExp?(zc="g",Z.ignoreCase&&(zc+="i"),Z.multiline&&(zc+="m"),$b=RegExp(Z.source,zc)):(id="g",M.caseSensitive||(id+="i"),M.regexMode||(Z=qd.regExpEscape(Z)),$b=RegExp(Z,id));for(kd=[];null!==(jd=$b.exec(Yb));)kd.push([jd.index,jd[0].length]);
te=be=0;Ce=1;me=0;case 10:if(!(be<Yb.length&&te<kd.length)){Lf.next=23;break}"\n"===Yb[be]&&(Ce++,me=be+1);ve=Xb(kd[te],2);qg=ve[0];Eg=ve[1];if(be===qg){Lf.next=15;break}return Lf.abrupt("continue",20);case 15:Wf=Yb.slice(me).indexOf("\n"),Wf=-1===Wf?Yb.length:Wf+me,$f=this["package"](),kd[te]={moduleId:this.id,packageName:$f?$f.name:void 0,pathInPackage:$f?this.pathInPackage():this.id,isLoaded:this.isLoaded(),length:Eg,line:Ce,column:be-me,lineString:1E3<Wf-me?"...".concat(Yb.slice(be-10,be+100),
"..."):Yb.slice(me,Wf)},te++;case 20:be++;Lf.next=10;break;case 23:return Lf.abrupt("return",kd);case 24:case "end":return Lf.stop()}},qa,this)}));return function(Z,M){return A.apply(this,arguments)}}()},{key:"toString",value:function(){return"module(".concat(this.id,")")}},{key:"isModule",get:function(){return!0}},{key:"dontTransform",get:function(){return[this.recorderName,this.sourceAccessorName,"global","self","_moduleExport","_moduleImport","localStorage","prompt","alert","fetch","getComputedStyle"].concat(sb(this.isMochaTest()?
[]:qd.GlobalInjector.getGlobals(this._source))).concat(qd.query.knownGlobals)}},{key:"recorder",set:function(A){return this._recorder=A},get:function(){var A;if(this._recorder)return this._recorder;var H=this.System,Z=this;if(!qd.globalProps.initialized){qd.globalProps.initialized=!0;for(var M in H.global)if(H.global.__lookupGetter__(M)||"closed"===M)qd.globalProps.descriptors[M]={value:void 0,configurable:!0,writable:!0}}M={};if(H.get("@system-env").node){var qa=qd._require.bind(null,this);qa.resolve=
qd._resolve.bind(null,this);M.require={configurable:!0,writable:!0,value:qa}}return this._recorder=Object.create(H.global,Object.assign({},qd.globalProps.descriptors,{},M,(A={event:{configurable:!0,writable:!0,value:void 0},System:{configurable:!0,writable:!0,value:H},__currentLivelyModule:{value:Z}},Nb(A,qd.defaultClassToFunctionConverterName,{configurable:!0,writable:!0,value:qd.classRuntime.initializeClass}),Nb(A,this.varDefinitionCallbackName,{value:function(Pa,Yb,$b,zc,id){id=id||{};id.kind=
Yb;return Z.define(Pa,$b,!1,id)}}),Nb(A,"_moduleExport",{value:function(Pa,Yb){qd.scheduleModuleExportsChange(H,Z.id,Pa,Yb,!0)}}),Nb(A,"_moduleImport",{value:function(Pa,Yb){var $b=H.decanonicalize(Pa,Z.id),zc=H.get($b);if(zc){Z.addDependencyToModuleRecord(qd.module(H,$b),function(id){return Object.assign(Z.recorder,id)});if(void 0===Yb)return zc;zc.hasOwnProperty(Yb)||console.warn("import from ".concat(zc,": Has no export ").concat(Yb,"!"));return zc[Yb]}console.warn("import of ".concat(Yb," failed: ").concat(Pa,
" (tried as ").concat(Z.id,") is not loaded!"))}}),A)))}},{key:"varDefinitionCallbackName",get:function(){return"defVar_"+this.id}}]);return y}();qd.ModuleInterface=of;qd["default"]=tb;var Ef=window.lively.FreezerRuntime.recorderFor("lively.modules/src/cache.js");Ef.prepareNodejsCaching=function(){var y=System._nodeRequire("fs"),A=System._nodeRequire("path"),H="win32"===process.platform;A=H||"/"!==process.cwd()?process.cwd():A.join(process.env.HOME,".lively.next");Ef.nodejsCacheDirURL=H?"file:///".concat(A.replace(/\\/g,
"/")):"file://".concat(A);y.existsSync(A)||y.mkdirSync(A)};Ef.resource=wb;var v=function(){function y(){nd(this,y)}Fd(y,[{key:"cacheModuleSource",value:function(A,H,Z){throw Error("not yet implemented");}},{key:"fetchStoredModuleSource",value:function(A){throw Error("not yet implemented");}},{key:"deleteCachedData",value:function(A){throw Error("not yet implemented");}}],[{key:"earliestDate",get:function(){return+new Date("Sun Oct 18 2020 16:00:00 GMT-0800 (PST)")}}]);return y}();Ef.ModuleTranslationCache=
v;Ef.nodejsCacheDirURL=null;var na=function(y){function A(){nd(this,A);return H.apply(this,arguments)}Pc(A,y);var H=gd(A);Fd(A,[{key:"ensurePath",value:function(){var Z=Hb(regeneratorRuntime.mark(function Pa(qa){var Yb,$b,zc,id,jd,kd;return regeneratorRuntime.wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return be.next=2,this.moduleCacheDir.join(qa).exists();case 2:if(!be.sent){be.next=4;break}return be.abrupt("return");case 4:Yb="",id=ec(qa.split("/")),be.prev=6,id.s();case 8:if((jd=id.n()).done){be.next=
35;break}kd=jd.value;Yb+=kd+"/";$b=this.moduleCacheDir.join(Yb);be.next=14;return $b.exists();case 14:if(be.sent){be.next=24;break}be.prev=15;be.next=18;return $b.mkdir();case 18:be.next=24;break;case 20:be.prev=20;be.t0=be["catch"](15);if("EEXIST"===be.t0.code){be.next=24;break}throw be.t0;case 24:return $b=Ef.resource("file://"+Yb+"/package.json"),be.next=27,$b.exists();case 27:if(!be.sent){be.next=33;break}be.next=30;return $b.read();case 30:return zc=be.sent,be.next=33,this.moduleCacheDir.join(Yb+
"/package.json").write(zc);case 33:be.next=8;break;case 35:be.next=40;break;case 37:be.prev=37,be.t1=be["catch"](6),id.e(be.t1);case 40:return be.prev=40,id.f(),be.finish(40);case 43:case "end":return be.stop()}},Pa,this,[[6,37,40,43],[15,20]])}));return function(qa){return Z.apply(this,arguments)}}()},{key:"dumpModuleCache",value:function(){var Z=Hb(regeneratorRuntime.mark(function qa(){var Pa,Yb;return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=$b.next){case 0:$b.t0=regeneratorRuntime.keys(System._nodeRequire("module").Module._cache);
case 1:if(($b.t1=$b.t0()).done){$b.next=16;break}Pa=$b.t1.value;Yb=Ef.resource("file://"+Pa);$b.next=6;return Yb.exists();case 6:if(!$b.sent){$b.next=14;break}$b.t2=this;$b.t3=Pa;$b.next=11;return Yb.read();case 11:return $b.t4=$b.sent,$b.next=14,$b.t2.cacheModuleSource.call($b.t2,$b.t3,"NO_HASH",$b.t4);case 14:$b.next=1;break;case 16:case "end":return $b.stop()}},qa,this)}));return function(){return Z.apply(this,arguments)}}()},{key:"getFileName",value:function(Z){return Z.match(/([^\/]*.)(\.js)?$/)[0]}},
{key:"fetchStoredModuleSource",value:function(){var Z=Hb(regeneratorRuntime.mark(function Pa(qa){var Yb,$b,zc,id,jd,kd,be;return regeneratorRuntime.wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return qa=qa.replace("file://",""),Yb=this.getFileName(qa),$b=qa.replace(Yb,""),zc=this.moduleCacheDir.join(qa),te.next=6,zc.exists();case 6:if(te.sent){te.next=8;break}return te.abrupt("return",null);case 8:return te.next=10,zc.stat();case 10:return id=te.sent,jd=id.birthtime,te.next=14,zc.read();
case 14:return kd=te.sent,te.next=17,this.moduleCacheDir.join($b+"/.hash_"+Yb).read();case 17:return be=te.sent,te.abrupt("return",{source:kd,timestamp:jd,hash:be});case 19:case "end":return te.stop()}},Pa,this)}));return function(qa){return Z.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var Z=Hb(regeneratorRuntime.mark(function $b(qa,Pa,Yb){var zc,id;return regeneratorRuntime.wrap(function(jd){for(;;)switch(jd.prev=jd.next){case 0:return qa=qa.replace("file://",""),zc=this.getFileName(qa),
id=qa.replace(zc,""),jd.next=5,this.ensurePath(id);case 5:return jd.next=7,this.moduleCacheDir.join(qa).write(Yb);case 7:return jd.next=9,this.moduleCacheDir.join(id+"/.hash_"+zc).write(Pa);case 9:case "end":return jd.stop()}},$b,this)}));return function(qa,Pa,Yb){return Z.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var Z=Hb(regeneratorRuntime.mark(function Pa(qa){var Yb;return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=$b.next){case 0:return qa=qa.replace("file://",
""),Yb=this.moduleCacheDir.join(qa),$b.next=4,Yb.exists();case 4:if($b.sent){$b.next=6;break}return $b.abrupt("return",!1);case 6:return $b.next=8,Yb.remove();case 8:return $b.abrupt("return",!0);case 9:case "end":return $b.stop()}},Pa,this)}));return function(qa){return Z.apply(this,arguments)}}()},{key:"moduleCacheDir",get:function(){Ef.nodejsCacheDirURL||Ef.prepareNodejsCaching();return Ef.resource("".concat(Ef.nodejsCacheDirURL,"/.module_cache/"))}}]);return A}(Ef.ModuleTranslationCache);Ef.NodeModuleTranslationCache=
na;var Hc=Lc("B",function(y){function A(){var Z=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"lively.modules-module-translation-cache";nd(this,A);var M=H.call(this);M.version=2;M.sourceCodeCacheStoreName="sourceCodeStore";M.dbName=Z;M.db=M.openDb();return M}Pc(A,y);var H=gd(A);Fd(A,[{key:"openDb",value:function(){var Z=this,M=System.global.indexedDB.open(this.version);return new Promise(function(qa,Pa){M.onsuccess=function(Yb){qa(this.result)};M.onerror=function(Yb){return Pa(Yb.target)};
M.onupgradeneeded=function(Yb){return Yb.currentTarget.result.createObjectStore(Z.sourceCodeCacheStoreName,{keyPath:"moduleId"})}})}},{key:"deleteDb",value:function(){var Z=System.global.indexedDB.deleteDatabase(this.dbName);return new Promise(function(M,qa){Z.onerror=function(Pa){return qa(Pa.target)};Z.onsuccess=function(Pa){return M(Pa)}})}},{key:"closeDb",value:function(){var Z=Hb(regeneratorRuntime.mark(function qa(){var Pa,Yb;return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=
$b.next){case 0:return $b.next=2,this.db;case 2:return Pa=$b.sent,Yb=Pa.close(),$b.abrupt("return",new Promise(function(zc,id){Yb.onsuccess=function(jd){zc(this.result)};Yb.onerror=function(jd){return id(jd.target.errorCode)}}));case 5:case "end":return $b.stop()}},qa,this)}));return function(){return Z.apply(this,arguments)}}()},{key:"cacheModuleSource",value:function(){var Z=Hb(regeneratorRuntime.mark(function $b(qa,Pa,Yb){var zc=this,id;return regeneratorRuntime.wrap(function(jd){for(;;)switch(jd.prev=
jd.next){case 0:return jd.next=2,this.db;case 2:return id=jd.sent,jd.abrupt("return",new Promise(function(kd,be){var te=id.transaction([zc.sourceCodeCacheStoreName],"readwrite"),Ce=te.objectStore(zc.sourceCodeCacheStoreName),me=Date.now();Ce.put({moduleId:qa,hash:Pa,source:Yb,timestamp:me});te.oncomplete=kd;te.onerror=be}));case 4:case "end":return jd.stop()}},$b,this)}));return function(qa,Pa,Yb){return Z.apply(this,arguments)}}()},{key:"fetchStoredModuleSource",value:function(){var Z=Hb(regeneratorRuntime.mark(function Pa(qa){var Yb=
this,$b;return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:return zc.next=2,this.db;case 2:return $b=zc.sent,zc.abrupt("return",new Promise(function(id,jd){var kd=$b.transaction([Yb.sourceCodeCacheStoreName]).objectStore(Yb.sourceCodeCacheStoreName).get(qa);kd.onerror=jd;kd.onsuccess=function(be){return id(kd.result)}}));case 4:case "end":return zc.stop()}},Pa,this)}));return function(qa){return Z.apply(this,arguments)}}()},{key:"deleteCachedData",value:function(){var Z=
Hb(regeneratorRuntime.mark(function Pa(qa){var Yb=this,$b;return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:return zc.next=2,this.db;case 2:return $b=zc.sent,zc.abrupt("return",new Promise(function(id,jd){var kd=$b.transaction([Yb.sourceCodeCacheStoreName],"readwrite").objectStore(Yb.sourceCodeCacheStoreName)["delete"](qa);kd.onerror=jd;kd.onsuccess=function(be){return id(kd.result)}}));case 4:case "end":return zc.stop()}},Pa,this)}));return function(qa){return Z.apply(this,
arguments)}}()}]);return A}(Ef.ModuleTranslationCache));Ef.BrowserModuleTranslationCache=Hc;var Nc=window.lively.FreezerRuntime.recorderFor("lively.modules/src/instrumentation.js");Nc.getExceptions=Ta;Nc.setExceptions=Bd;Nc.prepareCodeForCustomCompile=Eb;Nc.prepareTranslatedCodeForSetterCapture=fe;Nc.getCachedNodejsModule=function(y,A){try{var H=y._nodeRequire("module").Module,Z=H._resolveFilename(A.name.replace(/^file:\/\//,"").replace(/^\/([a-z]:\/)/i,"$1"));return H._cache[Z]}catch(M){y.debug&&
console.log("[lively.modules getCachedNodejsModule] %s unknown to nodejs",A.name)}return null};Nc.addNodejsWrapperSource=function(y,A){var H=Nc.getCachedNodejsModule(y,A);if(H)return A.metadata.format="esm",A.source="var exports = System._nodeRequire('".concat(H.id,"'); export default exports;\n")+Nc.properties.allOwnPropertiesOrFunctions(H.exports).map(function(Z){return Nc.isValidIdentifier(Z)?"export var ".concat(Z," = exports['").concat(Z,"'];"):'/*ignoring export "'.concat(Z,'" b/c it is not a valid identifier*/')}).join("\n"),
y.debug&&console.log("[lively.modules customTranslate] loading %s from nodejs module cache",A.name),!0;y.debug&&console.log("[lively.modules customTranslate] %s not yet in nodejs module cache",A.name);return!1};Nc.customTranslate=function(y,A){return Od.apply(this,arguments)};Nc.instrumentSourceOfEsmModuleLoad=Hd;Nc.instrumentSourceOfGlobalModuleLoad=Qc;Nc.wrapModuleLoad=Xd;Nc.unwrapModuleLoad=oc;Nc.commonjsHelpers=hb;Nc.parse=$d;Nc.nodes=Id;Nc.isValidIdentifier=zb;var Ud=Nc.nodes;Nc.funcCall=Ud.funcCall;
Nc.member=Ud.member;Nc.literal=Ud.literal;Nc.evalCodeTransform=db;Nc.evalCodeTransformOfSystemRegisterSetters=ib;Nc.string=ub;Nc.properties=Ea;Nc.classToFunctionTransform=La;Nc.installHook=K;Nc.removeHook=ya;Nc.isHookInstalled=pb;Nc.module=tb;Nc.detectModuleFormat=We;Nc.BrowserModuleTranslationCache=Hc;Nc.NodeModuleTranslationCache=na;Nc.isNode=System.get("@system-env").node;Nc.node_modulesDir=System.decanonicalize("lively.modules/node_modules/");Nc.exceptions=[function(y){return!y.endsWith(".js")&&
!y.endsWith(".jsx")&&!y.startsWith("https://jspm.dev")&&!y.startsWith("esm://")},function(y){return y.endsWith("dist/acorn.js")||y.endsWith("dist/escodegen.browser.js")||y.endsWith("bowser.js")||y.endsWith("TweenMax.min.js")},function(y){return y.endsWith("babel-core/browser.js")||y.endsWith("system.src.js")||y.includes("systemjs-plugin-babel")}];Nc.prepareCodeForCustomCompile=Eb;Nc.prepareTranslatedCodeForSetterCapture=fe;Nc.wrapModuleLoad=Xd;Nc.unwrapModuleLoad=oc;Nc.getExceptions=Ta;Nc.setExceptions=
Bd;Nc.instrumentSourceOfEsmModuleLoad=Hd;Nc.instrumentSourceOfGlobalModuleLoad=Qc;window.lively.FreezerRuntime.recorderFor("@empty");var ue=window.lively.FreezerRuntime.recorderFor("lively.modules/src/resource.js");ue.fetchResource=function(y,A){return rf.apply(this,arguments)};ue.livelyProtocol=function(y,A){var H=A.match(ue.livelyURLRe);if(!H)return y(A);y=Xb(H,3);y[0];y[1];var Z=y[2];return{read:function(){var M="undefined"!==typeof $world&&$world.getMorphWithId(Z);return Promise.resolve(M?M.textString:
"/*Could not locate ".concat(Z,"*/"))},write:function(M){var qa="undefined"!==typeof $world&&$world.getMorphWithId(Z);if(!qa)return Promise.reject("Could not save morph ".concat(Z));qa.textString=M;return Promise.resolve(this)}}};ue.wrapResource=Dd;ue.unwrapResource=ld;ue.resource=wb;ue.Resource=W;ue.promise=ba;ue.installHook=K;ue.removeHook=ya;ue.isHookInstalled=pb;ue._fetch=void 0;var bf;"undefined"!==typeof System&&System.get("@system-env").node&&(bf=ue._fetch||System._nodeRequire("node-fetch"));
ue.jsFileHashMap=ue.jsFileHashMap||void 0;ue.livelyURLRe=/^lively:\/\/([^\/]+)\/(.*)$/;ue.wrapResource=Dd;ue.unwrapResource=ld;var pf=function(y){function A(){nd(this,A);return H.apply(this,arguments)}Pc(A,y);var H=gd(A);Fd(A,[{key:"read",value:function(){var Z=Hb(regeneratorRuntime.mark(function qa(){var Pa,Yb;return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=$b.next){case 0:return Pa=this.morphId,Yb="undefined"!==typeof $world&&$world.getMorphWithId(Pa),$b.abrupt("return",Promise.resolve(Yb?
Yb.textString:"/*Could not locate ".concat(Pa,"*/")));case 3:case "end":return $b.stop()}},qa,this)}));return function(){return Z.apply(this,arguments)}}()},{key:"write",value:function(){var Z=Hb(regeneratorRuntime.mark(function Pa(qa){var Yb,$b;return regeneratorRuntime.wrap(function(zc){for(;;)switch(zc.prev=zc.next){case 0:Yb=this.morphId;if($b="undefined"!==typeof $world&&$world.getMorphWithId(Yb)){zc.next=4;break}return zc.abrupt("return",Promise.reject("Could not save morph ".concat(Yb)));case 4:return $b.textString=
qa,zc.abrupt("return",Promise.resolve(this));case 6:case "end":return zc.stop()}},Pa,this)}));return function(qa){return Z.apply(this,arguments)}}()},{key:"exists",value:function(){var Z=Hb(regeneratorRuntime.mark(function qa(){return regeneratorRuntime.wrap(function(Pa){for(;;)switch(Pa.prev=Pa.next){case 0:return Pa.abrupt("return","undefined"!==typeof $world&&$world.getMorphWithId(this.morphId));case 1:case "end":return Pa.stop()}},qa,this)}));return function(){return Z.apply(this,arguments)}}()},
{key:"remove",value:function(){var Z=Hb(regeneratorRuntime.mark(function qa(){return regeneratorRuntime.wrap(function(Pa){for(;;)switch(Pa.prev=Pa.next){case 0:return"undefined"!==typeof $world&&$world.getMorphWithId(this.morphId).remove(),Pa.abrupt("return",!0);case 2:case "end":return Pa.stop()}},qa,this)}));return function(){return Z.apply(this,arguments)}}()},{key:"canDealWithJSON",get:function(){return!1}},{key:"morphId",get:function(){var Z=this.url.match(ue.livelyURLRe);Z=Xb(Z,3);Z[0];Z[1];
return Z[2]}}]);return A}(ue.Resource);ue.LivelyResource=pf;var mg={name:"lively.modules",matches:function(y){return y.match(ue.livelyURLRe)},resourceClass:ue.LivelyResource};ue.resourceExtension=mg;ue.resourceExtension=mg;ue.registerExtension=T;ue.registerExtension(ue.resourceExtension);var Zd=window.lively.FreezerRuntime.recorderFor("lively.modules/src/system.js");Zd.wrapModuleResolution=Td;Zd.unwrapModuleResolution=gb;Zd.livelySystemEnv=Vc;Zd.systems=function(){System.constructor.systems||(System.constructor.systems=
{});return System.constructor.systems};Zd.nameOfSystem=function(y){return Object.keys(Zd.systems()).some(function(A){return Zd.systems()[A]===y})};Zd.getSystem=vb;Zd.removeSystem=cc;Zd.makeSystem=function(y){return Zd.prepareSystem(new System.constructor,y)};Zd.prepareSystem=ob;Zd.urlQuery=function(){return"undefined"!==typeof document&&document.location?(document.location.search||"").replace(/^\?/,"").split("&").reduce(function(y,A){var H=A.split("=");A=H[0];H=H[1];"true"===H||"false"===H?H=eval(H):
isNaN(Number(H))||(H=Number(H));y[A]=H;return y},{}):{}};Zd.preNormalize=function(y,A,H){".."===A&&(A="../index.js");A=A.replace(Zd.doubleSlashRe,function(Yb){return":"===Yb[0]?Yb:Yb[0]+"/"});var Z=y.get("@lively-env").packageRegistry;if(Z){var M=H&&Z.findPackageHavingURL(H);if(M){var qa=M.map,Pa=M.url;if(qa=qa&&qa[A]||y.map[A])"object"===ia(qa)&&(qa=Zd.normalize_doMapWithObject(qa,M,y)),"string"===typeof qa&&""!==qa&&(A=qa),A.startsWith(".")&&(A=Zd.urlResolve(Zd.join(Pa,A)))}}Z&&(y=Z.resolvePath(A,
H))&&(y.endsWith("/")&&!A.endsWith("/")&&(y=y.slice(0,-1)),!y.endsWith("/")&&A.endsWith("/")&&(y+="/"),A=y);return A};Zd.postNormalize=function(y,A,H){H=A.replace(Zd.jsExtRe,"");if(A.endsWith("/"))return A;var Z=y.get("@lively-env").packageRegistry;if(Z){if(Z=Z.findPackageWithURL(H))return y=(Z.main||"index.js").replace(Zd.dotSlashStartRe,""),H.replace(Zd.trailingSlashRe,"")+"/"+y}else if(H in y.packages&&(Z=y.packages[H].main))return H.replace(Zd.trailingSlashRe,"")+"/"+Z.replace(Zd.dotSlashStartRe,
"");H=A.match(Zd.jsonJsExtRe);y.debug&&console.log(">> [postNormalize] ".concat(H?H[1]:A));return H?H[1]:A};Zd.checkExistence=function(y,A){return ac.apply(this,arguments)};Zd.normalizeHook=function(y,A,H,Z){return ae.apply(this,arguments)};Zd.decanonicalizeHook=function(y,A,H,Z){if(A&&A.endsWith("!cjs")){A=A.replace("!cjs","");var M="!cjs"}var qa=Zd.preNormalize(this,A,H);y=y(qa,H,Z);y=Zd.postNormalize(this,y,!0);M&&(y+=M);this.debug&&console.log("[normalizeSync] ".concat(A," => ").concat(y));return y};
Zd.locateHook=function(y,A){return qe.apply(this,arguments)};Zd.whenSystemModuleLoaded=function(y){return lc.apply(this,arguments)};Zd.normalize_doMapWithObject=function(y,A,H){A=H.get(A.map["@env"]||"@system-env");var Z;for(Z in y){H="~"===Z[0];var M=H?Z.substr(1):Z;var qa=A;for(M=M.split(".");M.length;)qa=qa[M.shift()];if(!H&&qa||H&&!qa){var Pa=y[Z];break}}if(Pa&&"string"!==typeof Pa)throw Error("Unable to map a package conditional to a package conditional.");return Pa};Zd.normalize_packageOfURL=
function(y,A){var H=Object.keys(A.packages||{}).map(function(Z){return 0===y.indexOf(Z)?{url:Z,penalty:y.slice(Z.length).length}:null}).filter(function(Z){return!!Z});return(A=(H=H.length?H.reduce(function(Z,M){return Z.penalty>M.penalty?M:Z}).url:null)&&A.packages[H])?{systemPackage:A,packageURL:H}:null};Zd.newModule_volatile=function(y,A){var H=Object.freeze;Object.freeze=function(Z){return Z};y=y(A);Object.freeze=H;return y};Zd.printSystemConfig=nc;Zd.instantiate_triggerOnLoadCallbacks=function(y,
A){var H=this;return y(A).then(function(Z){var M={};Zd.whenSystemModuleLoaded(A.name).then(function(qa){if(qa===M)console.warn("[lively.modules] instantiate_triggerOnLoadCallbacks for ".concat(A.name," timed out"));else{qa=A.name;for(var Pa=Zd.classHolder.module(H,qa),Yb=H.get("@lively-env").onLoadCallbacks,$b=Yb.length;$b--;){var zc=Yb[$b],id=zc.moduleName,jd=zc.callback;if((zc.resolved?id:H.decanonicalize(id))===qa){Yb.splice($b,1);try{jd(Pa)}catch(kd){console.error(kd)}}}Zd.emit("lively.modules/moduleloaded",
{module:A.name},Date.now(),H);H._loadingIndicator&&(H._loadingIndicator.remove(),H._loadingIndicator=null)}});return Z})};Zd.whenLoaded=Yc;Zd.loadedModules=fd;Zd.knownModuleNames=ua;Zd.searchLoadedModules=Ab;Zd.arr=Nd;Zd.obj=yb;Zd.promise=ba;Zd.removeHook=ya;Zd.installHook=K;Zd.isHookInstalled=pb;Zd.classHolder=re;Zd.isNode=System.get("@system-env").node;Zd.GLOBAL="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:void 0;Zd.defaultOptions={notificationLimit:null};
Zd.wrapModuleResolution=Td;Zd.unwrapModuleResolution=gb;Zd.wrapModuleLoad=Xd;Zd.wrapResource=Dd;Zd.emit=cb;Zd.join=Y;Zd.urlResolve=vc;Zd.resource=wb;Zd.dotSlashStartRe=/^\.?\//;Zd.trailingSlashRe=/\/$/;Zd.jsExtRe=/\.js$/;Zd.cjsExtRe=/\.cjs$/;Zd.jsxExtRe=/\.jsx$/;Zd.nodeExtRe=/\.node$/;Zd.jsonExtRe=/\.json$/;Zd.jsonJsExtRe=/(.*\.json)\.js$/i;Zd.jsxJsExtRe=/(.*\.jsx)\.js$/i;Zd.doubleSlashRe=/.\/{2,}/g;Zd.nodeModRe=/@node.*/;Zd.moduleLoadPromises={};Zd.whenLoaded=Yc;Zd.getSystem=vb;Zd.removeSystem=cc;
Zd.prepareSystem=ob;Zd.printSystemConfig=nc;Zd.livelySystemEnv=Vc;Zd.loadedModules=fd;Zd.knownModuleNames=ua;Zd.searchLoadedModules=Ab;var tg={exports:{}},Sg=window.lively.FreezerRuntime.recorderFor("lively.next-node_modules/semver/5.3.0/semver.js");Sg.commonjsHelpers=hb;Sg.semverModule=tg;Sg.semver=tg.exports;(function(y,A){function H(Rd,Je){if(Rd instanceof Z)return Rd;if("string"!==typeof Rd||Rd.length>zf||!(Je?cg[Pm]:cg[km]).test(Rd))return null;try{return new Z(Rd,Je)}catch(Ve){return null}}
function Z(Rd,Je){if(Rd instanceof Z){if(Rd.loose===Je)return Rd;Rd=Rd.version}else if("string"!==typeof Rd)throw new TypeError("Invalid Version: "+Rd);if(Rd.length>zf)throw new TypeError("version is longer than "+zf+" characters");if(!(this instanceof Z))return new Z(Rd,Je);Gg("SemVer",Rd,Je);this.loose=Je;Je=Rd.trim().match(Je?cg[Pm]:cg[km]);if(!Je)throw new TypeError("Invalid Version: "+Rd);this.raw=Rd;this.major=+Je[1];this.minor=+Je[2];this.patch=+Je[3];if(this.major>Kh||0>this.major)throw new TypeError("Invalid major version");
if(this.minor>Kh||0>this.minor)throw new TypeError("Invalid minor version");if(this.patch>Kh||0>this.patch)throw new TypeError("Invalid patch version");this.prerelease=Je[4]?Je[4].split(".").map(function(Ve){if(/^[0-9]+$/.test(Ve)){var lf=+Ve;if(0<=lf&&lf<Kh)return lf}return Ve}):[];this.build=Je[5]?Je[5].split("."):[];this.format()}function M(Rd,Je){var Ve=Ql.test(Rd),lf=Ql.test(Je);Ve&&lf&&(Rd=+Rd,Je=+Je);return Ve&&!lf?-1:lf&&!Ve?1:Rd<Je?-1:Rd>Je?1:0}function qa(Rd,Je,Ve){return(new Z(Rd,Ve)).compare(Je)}
function Pa(Rd,Je,Ve){return 0<qa(Rd,Je,Ve)}function Yb(Rd,Je,Ve){return 0>qa(Rd,Je,Ve)}function $b(Rd,Je,Ve){return 0===qa(Rd,Je,Ve)}function zc(Rd,Je,Ve){return 0!==qa(Rd,Je,Ve)}function id(Rd,Je,Ve){return 0<=qa(Rd,Je,Ve)}function jd(Rd,Je,Ve){return 0>=qa(Rd,Je,Ve)}function kd(Rd,Je,Ve,lf){switch(Je){case "===":"object"===ia(Rd)&&(Rd=Rd.version);"object"===ia(Ve)&&(Ve=Ve.version);Rd=Rd===Ve;break;case "!==":"object"===ia(Rd)&&(Rd=Rd.version);"object"===ia(Ve)&&(Ve=Ve.version);Rd=Rd!==Ve;break;
case "":case "=":case "==":Rd=$b(Rd,Ve,lf);break;case "!=":Rd=zc(Rd,Ve,lf);break;case ">":Rd=Pa(Rd,Ve,lf);break;case ">=":Rd=id(Rd,Ve,lf);break;case "<":Rd=Yb(Rd,Ve,lf);break;case "<=":Rd=jd(Rd,Ve,lf);break;default:throw new TypeError("Invalid operator: "+Je);}return Rd}function be(Rd,Je){if(Rd instanceof be){if(Rd.loose===Je)return Rd;Rd=Rd.value}if(!(this instanceof be))return new be(Rd,Je);Gg("comparator",Rd,Je);this.loose=Je;this.parse(Rd);this.value=this.semver===Rl?"":this.operator+this.semver.version;
Gg("comp",this)}function te(Rd,Je){if(Rd instanceof te&&Rd.loose===Je)return Rd;if(!(this instanceof te))return new te(Rd,Je);this.loose=Je;this.raw=Rd;this.set=Rd.split(/\s*\|\|\s*/).map(function(Ve){return this.parseRange(Ve.trim())},this).filter(function(Ve){return Ve.length});if(!this.set.length)throw new TypeError("Invalid SemVer Range: "+Rd);this.format()}function Ce(Rd){return!Rd||"x"===Rd.toLowerCase()||"*"===Rd}function me(Rd,Je){return Rd.trim().split(/\s+/).map(function(Ve){return ve(Ve,
Je)}).join(" ")}function ve(Rd,Je){return Rd.replace(Je?cg[Gn]:cg[Fn],function(Ve,lf,fh,Wh,ki){Gg("tilde",Rd,Ve,lf,fh,Wh,ki);Ce(lf)?Ve="":Ce(fh)?Ve=">="+lf+".0.0 <"+(+lf+1)+".0.0":Ce(Wh)?Ve=">="+lf+"."+fh+".0 <"+lf+"."+(+fh+1)+".0":ki?(Gg("replaceTilde pr",ki),"-"!==ki.charAt(0)&&(ki="-"+ki),Ve=">="+lf+"."+fh+"."+Wh+ki+" <"+lf+"."+(+fh+1)+".0"):Ve=">="+lf+"."+fh+"."+Wh+" <"+lf+"."+(+fh+1)+".0";Gg("tilde return",Ve);return Ve})}function qg(Rd,Je){return Rd.trim().split(/\s+/).map(function(Ve){return Eg(Ve,
Je)}).join(" ")}function Eg(Rd,Je){Gg("caret",Rd,Je);return Rd.replace(Je?cg[nm]:cg[el],function(Ve,lf,fh,Wh,ki){Gg("caret",Rd,Ve,lf,fh,Wh,ki);Ce(lf)?Ve="":Ce(fh)?Ve=">="+lf+".0.0 <"+(+lf+1)+".0.0":Ce(Wh)?Ve="0"===lf?">="+lf+"."+fh+".0 <"+lf+"."+(+fh+1)+".0":">="+lf+"."+fh+".0 <"+(+lf+1)+".0.0":ki?(Gg("replaceCaret pr",ki),"-"!==ki.charAt(0)&&(ki="-"+ki),Ve="0"===lf?"0"===fh?">="+lf+"."+fh+"."+Wh+ki+" <"+lf+"."+fh+"."+(+Wh+1):">="+lf+"."+fh+"."+Wh+ki+" <"+lf+"."+(+fh+1)+".0":">="+lf+"."+fh+"."+Wh+
ki+" <"+(+lf+1)+".0.0"):(Gg("no pr"),Ve="0"===lf?"0"===fh?">="+lf+"."+fh+"."+Wh+" <"+lf+"."+fh+"."+(+Wh+1):">="+lf+"."+fh+"."+Wh+" <"+lf+"."+(+fh+1)+".0":">="+lf+"."+fh+"."+Wh+" <"+(+lf+1)+".0.0");Gg("caret return",Ve);return Ve})}function Wf(Rd,Je){Gg("replaceXRanges",Rd,Je);return Rd.split(/\s+/).map(function(Ve){return $f(Ve,Je)}).join(" ")}function $f(Rd,Je){Rd=Rd.trim();return Rd.replace(Je?cg[mm]:cg[Qm],function(Ve,lf,fh,Wh,ki,qk){Gg("xRange",Rd,Ve,lf,fh,Wh,ki,qk);var Nj=(qk=Ce(fh))||Ce(Wh),
kj=Nj||Ce(ki);"="===lf&&kj&&(lf="");qk?Ve=">"===lf||"<"===lf?"<0.0.0":"*":lf&&kj?(Nj&&(Wh=0),kj&&(ki=0),">"===lf?(lf=">=",Nj?(fh=+fh+1,ki=Wh=0):kj&&(Wh=+Wh+1,ki=0)):"<="===lf&&(lf="<",Nj?fh=+fh+1:Wh=+Wh+1),Ve=lf+fh+"."+Wh+"."+ki):Nj?Ve=">="+fh+".0.0 <"+(+fh+1)+".0.0":kj&&(Ve=">="+fh+"."+Wh+".0 <"+fh+"."+(+Wh+1)+".0");Gg("xRange return",Ve);return Ve})}function Lf(Rd,Je,Ve,lf,fh,Wh,ki,qk,Nj,kj,dk,Tj,Rm){Je=Ce(Ve)?"":Ce(lf)?">="+Ve+".0.0":Ce(fh)?">="+Ve+"."+lf+".0":">="+Je;qk=Ce(Nj)?"":Ce(kj)?"<"+(+Nj+
1)+".0.0":Ce(dk)?"<"+Nj+"."+(+kj+1)+".0":Tj?"<="+Nj+"."+kj+"."+dk+"-"+Tj:"<="+qk;return(Je+" "+qk).trim()}function jf(Rd,Je){for(var Ve=0;Ve<Rd.length;Ve++)if(!Rd[Ve].test(Je))return!1;if(Je.prerelease.length){for(Ve=0;Ve<Rd.length;Ve++)if(Gg(Rd[Ve].semver),Rd[Ve].semver!==Rl&&0<Rd[Ve].semver.prerelease.length){var lf=Rd[Ve].semver;if(lf.major===Je.major&&lf.minor===Je.minor&&lf.patch===Je.patch)return!0}return!1}return!0}function wh(Rd,Je,Ve){try{Je=new te(Je,Ve)}catch(lf){return!1}return Je.test(Rd)}
function yg(Rd,Je,Ve,lf){Rd=new Z(Rd,lf);Je=new te(Je,lf);switch(Ve){case ">":var fh=Pa;Ve=jd;var Wh=Yb;var ki=">";var qk=">=";break;case "<":fh=Yb;Ve=id;Wh=Pa;ki="<";qk="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"');}if(wh(Rd,Je,lf))return!1;for(var Nj=0;Nj<Je.set.length;++Nj){var kj=null,dk=null;Je.set[Nj].forEach(function(Tj){Tj.semver===Rl&&(Tj=new be(">=0.0.0"));kj=kj||Tj;dk=dk||Tj;fh(Tj.semver,kj.semver,lf)?kj=Tj:Wh(Tj.semver,dk.semver,lf)&&(dk=Tj)});if(kj.operator===
ki||kj.operator===qk||(!dk.operator||dk.operator===ki)&&Ve(Rd,dk.semver)||dk.operator===qk&&Wh(Rd,dk.semver))return!1}return!0}A=y.exports=Z;var Gg="object"===("undefined"===typeof process?"undefined":ia(process))&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var Rd=Array.prototype.slice.call(arguments,0);Rd.unshift("SEMVER");console.log.apply(console,Rd)}:function(){};A.SEMVER_SPEC_VERSION="2.0.0";var zf=256,Kh=Number.MAX_SAFE_INTEGER||9007199254740991,
cg=A.re=[];y=A.src=[];var Ag=0,Uf=Ag++;y[Uf]="0|[1-9]\\d*";var Lh=Ag++;y[Lh]="[0-9]+";var Mj=Ag++;y[Mj]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var Dl=Ag++;y[Dl]="("+y[Uf]+")\\.("+y[Uf]+")\\.("+y[Uf]+")";var El=Ag++;y[El]="("+y[Lh]+")\\.("+y[Lh]+")\\.("+y[Lh]+")";var pj=Ag++;y[pj]="(?:"+y[Uf]+"|"+y[Mj]+")";var Dk=Ag++;y[Dk]="(?:"+y[Lh]+"|"+y[Mj]+")";Mj=Ag++;y[Mj]="(?:-("+y[pj]+"(?:\\."+y[pj]+")*))";pj=Ag++;y[pj]="(?:-?("+y[Dk]+"(?:\\."+y[Dk]+")*))";var pk=Ag++;y[pk]="[0-9A-Za-z-]+";Dk=Ag++;y[Dk]="(?:\\+("+y[pk]+
"(?:\\."+y[pk]+")*))";var km=Ag++;Dl="v?"+y[Dl]+y[Mj]+"?"+y[Dk]+"?";y[km]="^"+Dl+"$";El="[v=\\s]*"+y[El]+y[pj]+"?"+y[Dk]+"?";var Pm=Ag++;y[Pm]="^"+El+"$";pk=Ag++;y[pk]="((?:<|>)?=?)";var lm=Ag++;y[lm]=y[Lh]+"|x|X|\\*";Lh=Ag++;y[Lh]=y[Uf]+"|x|X|\\*";Uf=Ag++;y[Uf]="[v=\\s]*("+y[Lh]+")(?:\\.("+y[Lh]+")(?:\\.("+y[Lh]+")(?:"+y[Mj]+")?"+y[Dk]+"?)?)?";Mj=Ag++;y[Mj]="[v=\\s]*("+y[lm]+")(?:\\.("+y[lm]+")(?:\\.("+y[lm]+")(?:"+y[pj]+")?"+y[Dk]+"?)?)?";var Qm=Ag++;y[Qm]="^"+y[pk]+"\\s*"+y[Uf]+"$";var mm=Ag++;
y[mm]="^"+y[pk]+"\\s*"+y[Mj]+"$";pj=Ag++;y[pj]="(?:~>?)";var Pl=Ag++;y[Pl]="(\\s*)"+y[pj]+"\\s+";cg[Pl]=new RegExp(y[Pl],"g");var Fn=Ag++;y[Fn]="^"+y[pj]+y[Uf]+"$";var Gn=Ag++;y[Gn]="^"+y[pj]+y[Mj]+"$";pj=Ag++;y[pj]="(?:\\^)";var dl=Ag++;y[dl]="(\\s*)"+y[pj]+"\\s+";cg[dl]=new RegExp(y[dl],"g");var el=Ag++;y[el]="^"+y[pj]+y[Uf]+"$";var nm=Ag++;y[nm]="^"+y[pj]+y[Mj]+"$";var ol=Ag++;y[ol]="^"+y[pk]+"\\s*("+El+")$|^$";var om=Ag++;y[om]="^"+y[pk]+"\\s*("+Dl+")$|^$";var fl=Ag++;y[fl]="(\\s*)"+y[pk]+"\\s*("+
El+"|"+y[Uf]+")";cg[fl]=new RegExp(y[fl],"g");var Hn=Ag++;y[Hn]="^\\s*("+y[Uf]+")\\s+-\\s+("+y[Uf]+")\\s*$";var pm=Ag++;y[pm]="^\\s*("+y[Mj]+")\\s+-\\s+("+y[Mj]+")\\s*$";var qm=Ag++;y[qm]="(<|>)?=?\\s*\\*";for(Uf=0;Uf<Ag;Uf++)Gg(Uf,y[Uf]),cg[Uf]||(cg[Uf]=new RegExp(y[Uf]));A.parse=H;A.valid=function(Rd,Je){return(Rd=H(Rd,Je))?Rd.version:null};A.clean=function(Rd,Je){return(Rd=H(Rd.trim().replace(/^[=v]+/,""),Je))?Rd.version:null};A.SemVer=Z;Z.prototype.format=function(){this.version=this.major+"."+
this.minor+"."+this.patch;this.prerelease.length&&(this.version+="-"+this.prerelease.join("."));return this.version};Z.prototype.toString=function(){return this.version};Z.prototype.compare=function(Rd){Gg("SemVer.compare",this.version,this.loose,Rd);Rd instanceof Z||(Rd=new Z(Rd,this.loose));return this.compareMain(Rd)||this.comparePre(Rd)};Z.prototype.compareMain=function(Rd){Rd instanceof Z||(Rd=new Z(Rd,this.loose));return M(this.major,Rd.major)||M(this.minor,Rd.minor)||M(this.patch,Rd.patch)};
Z.prototype.comparePre=function(Rd){Rd instanceof Z||(Rd=new Z(Rd,this.loose));if(this.prerelease.length&&!Rd.prerelease.length)return-1;if(!this.prerelease.length&&Rd.prerelease.length)return 1;if(!this.prerelease.length&&!Rd.prerelease.length)return 0;var Je=0;do{var Ve=this.prerelease[Je],lf=Rd.prerelease[Je];Gg("prerelease compare",Je,Ve,lf);if(void 0===Ve&&void 0===lf)return 0;if(void 0===lf)return 1;if(void 0===Ve)return-1;if(Ve!==lf)return M(Ve,lf)}while(++Je)};Z.prototype.inc=function(Rd,
Je){switch(Rd){case "premajor":this.minor=this.patch=this.prerelease.length=0;this.major++;this.inc("pre",Je);break;case "preminor":this.patch=this.prerelease.length=0;this.minor++;this.inc("pre",Je);break;case "prepatch":this.prerelease.length=0;this.inc("patch",Je);this.inc("pre",Je);break;case "prerelease":0===this.prerelease.length&&this.inc("patch",Je);this.inc("pre",Je);break;case "major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++;this.patch=this.minor=0;this.prerelease=
[];break;case "minor":0===this.patch&&0!==this.prerelease.length||this.minor++;this.patch=0;this.prerelease=[];break;case "patch":0===this.prerelease.length&&this.patch++;this.prerelease=[];break;case "pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(Rd=this.prerelease.length;0<=--Rd;)"number"===typeof this.prerelease[Rd]&&(this.prerelease[Rd]++,Rd=-2);-1===Rd&&this.prerelease.push(0)}Je&&(this.prerelease[0]===Je?isNaN(this.prerelease[1])&&(this.prerelease=[Je,0]):this.prerelease=[Je,
0]);break;default:throw Error("invalid increment argument: "+Rd);}this.format();this.raw=this.version;return this};A.inc=function(Rd,Je,Ve,lf){"string"===typeof Ve&&(lf=Ve,Ve=void 0);try{return(new Z(Rd,Ve)).inc(Je,lf).version}catch(fh){return null}};A.diff=function(Rd,Je){if($b(Rd,Je))return null;Rd=H(Rd);Je=H(Je);if(Rd.prerelease.length||Je.prerelease.length){for(var Ve in Rd)if(("major"===Ve||"minor"===Ve||"patch"===Ve)&&Rd[Ve]!==Je[Ve])return"pre"+Ve;return"prerelease"}for(Ve in Rd)if(("major"===
Ve||"minor"===Ve||"patch"===Ve)&&Rd[Ve]!==Je[Ve])return Ve};A.compareIdentifiers=M;var Ql=/^[0-9]+$/;A.rcompareIdentifiers=function(Rd,Je){return M(Je,Rd)};A.major=function(Rd,Je){return(new Z(Rd,Je)).major};A.minor=function(Rd,Je){return(new Z(Rd,Je)).minor};A.patch=function(Rd,Je){return(new Z(Rd,Je)).patch};A.compare=qa;A.compareLoose=function(Rd,Je){return qa(Rd,Je,!0)};A.rcompare=function(Rd,Je,Ve){return qa(Je,Rd,Ve)};A.sort=function(Rd,Je){return Rd.sort(function(Ve,lf){return A.compare(Ve,
lf,Je)})};A.rsort=function(Rd,Je){return Rd.sort(function(Ve,lf){return A.rcompare(Ve,lf,Je)})};A.gt=Pa;A.lt=Yb;A.eq=$b;A.neq=zc;A.gte=id;A.lte=jd;A.cmp=kd;A.Comparator=be;var Rl={};be.prototype.parse=function(Rd){var Je=Rd.match(this.loose?cg[ol]:cg[om]);if(!Je)throw new TypeError("Invalid comparator: "+Rd);this.operator=Je[1];"="===this.operator&&(this.operator="");this.semver=Je[2]?new Z(Je[2],this.loose):Rl};be.prototype.toString=function(){return this.value};be.prototype.test=function(Rd){Gg("Comparator.test",
Rd,this.loose);if(this.semver===Rl)return!0;"string"===typeof Rd&&(Rd=new Z(Rd,this.loose));return kd(Rd,this.operator,this.semver,this.loose)};A.Range=te;te.prototype.format=function(){return this.range=this.set.map(function(Rd){return Rd.join(" ").trim()}).join("||").trim()};te.prototype.toString=function(){return this.range};te.prototype.parseRange=function(Rd){var Je=this.loose;Rd=Rd.trim();Gg("range",Rd,Je);Rd=Rd.replace(Je?cg[pm]:cg[Hn],Lf);Gg("hyphen replace",Rd);Rd=Rd.replace(cg[fl],"$1$2$3");
Gg("comparator trim",Rd,cg[fl]);Rd=Rd.replace(cg[Pl],"$1~");Rd=Rd.replace(cg[dl],"$1^");Rd=Rd.split(/\s+/).join(" ");var Ve=Je?cg[ol]:cg[om];Rd=Rd.split(" ").map(function(lf){Gg("comp",lf);lf=qg(lf,Je);Gg("caret",lf);lf=me(lf,Je);Gg("tildes",lf);lf=Wf(lf,Je);Gg("xrange",lf);Gg("replaceStars",lf,Je);lf=lf.trim().replace(cg[qm],"");Gg("stars",lf);return lf}).join(" ").split(/\s+/);this.loose&&(Rd=Rd.filter(function(lf){return!!lf.match(Ve)}));return Rd=Rd.map(function(lf){return new be(lf,Je)})};A.toComparators=
function(Rd,Je){return(new te(Rd,Je)).set.map(function(Ve){return Ve.map(function(lf){return lf.value}).join(" ").trim().split(" ")})};te.prototype.test=function(Rd){if(!Rd)return!1;"string"===typeof Rd&&(Rd=new Z(Rd,this.loose));for(var Je=0;Je<this.set.length;Je++)if(jf(this.set[Je],Rd))return!0;return!1};A.satisfies=wh;A.maxSatisfying=function(Rd,Je,Ve){return Rd.filter(function(lf){return wh(lf,Je,Ve)}).sort(function(lf,fh){return qa(fh,lf,Ve)})[0]||null};A.minSatisfying=function(Rd,Je,Ve){return Rd.filter(function(lf){return wh(lf,
Je,Ve)}).sort(function(lf,fh){return qa(lf,fh,Ve)})[0]||null};A.validRange=function(Rd,Je){try{return(new te(Rd,Je)).range||"*"}catch(Ve){return null}};A.ltr=function(Rd,Je,Ve){return yg(Rd,Je,"<",Ve)};A.gtr=function(Rd,Je,Ve){return yg(Rd,Je,">",Ve)};A.outside=yg;A.prerelease=function(Rd,Je){return(Rd=H(Rd,Je))&&Rd.prerelease.length?Rd.prerelease:null}})(Sg.semverModule,Sg.semver);var oh=Lc("e",tg.exports);Sg.__moduleExports=tg.exports;Sg.semver=tg.exports;Sg["default"]=tg.exports;var Hf=window.lively.FreezerRuntime.recorderFor("lively.modules/src/packages/package-registry.js");
Hf.isAbsolute=function(y){return y.startsWith("/")||y.startsWith("http:")||y.startsWith("https:")||y.startsWith("file:")||y.match(Hf.urlStartRe)};Hf.ensureResource=function(y){return y.isResource?y:Hf.resource(y)};Hf.semver=oh;Hf.arr=Nd;Hf.obj=yb;Hf.promise=ba;Hf.Package=Cc;Hf.resource=wb;Hf.isURL=Ub;Hf.classHolder=re;Hf.urlStartRe=/^[a-z\.-_\+]+:/i;var Bh=Lc("P",function(){function y(A){var H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};nd(this,y);this.System=A;this.packageBaseDirs=
H.packageBaseDirs||[];this.devPackageDirs=H.devPackageDirs||[];this.individualPackageDirs=H.individualPackageDirs||[];this._readyPromise=null;this.packageMap={};this._byURL=null}Fd(y,null,[{key:"ofSystem",value:function(A){var H=A.get("@lively-env").packageRegistry;H||(H=A["__lively.modules__packageRegistry"]=new this(A));return H}},{key:"forDirectory",value:function(A,H){return new this(A,{packageBaseDirs:[Hf.ensureResource(H)]})}},{key:"fromJSON",value:function(A,H){return(new this(A)).fromJSON(H)}}]);
Fd(y,[{key:"resetByURL",value:function(){this._byURL=null}},{key:"allPackageURLs",value:function(){return Object.keys(this.byURL)}},{key:"toJSON",value:function(){function A(jd){jd=jd.url;return jd.startsWith(H.baseURL)?jd.slice(H.baseURL.length).replace(/^\//,""):jd}var H=this.System,Z=this.packageMap,M=this.individualPackageDirs,qa=this.devPackageDirs,Pa=this.packageBaseDirs,Yb={},$b;for($b in Z){var zc=Z[$b];Yb[$b]={};Yb[$b].latest=zc.latest;Yb[$b].versions={};for(var id in zc.versions)Yb[$b].versions[id]=
zc.versions[id].toJSON()}return{packageMap:Yb,individualPackageDirs:M.map(A),devPackageDirs:qa.map(A),packageBaseDirs:Pa.map(A)}}},{key:"fromJSON",value:function(A){function H(jd){return Hf.isURL(jd)?Hf.resource(jd):Hf.resource(M.baseURL).join(jd)}var Z={},M=this.System,qa=Hf.resource(M.baseURL),Pa;for(Pa in A.packageMap){var Yb=A.packageMap[Pa];Z[Pa]={};Z[Pa].latest=Yb.latest;Z[Pa].versions={};for(var $b in Yb.versions){var zc=Yb.versions[$b],id=zc.url;Hf.isAbsolute(id)||(id=qa.join(id).url);zc=
Hf.Package.fromJSON(M,Object.assign({},zc,{url:id}));Z[Pa].versions[$b]=zc}}this.packageMap=Z;this.individualPackageDirs=A.individualPackageDirs.map(H);this.devPackageDirs=A.devPackageDirs.map(H);this.packageBaseDirs=A.packageBaseDirs.map(H);this.resetByURL();Hf.classHolder.ModulePackageMapping.forSystem(M).clearCache();return this}},{key:"updateFromJSON",value:function(A){var H=this.packageMap,Z;for(Z in A.packageMap){var M=A.packageMap[Z];H[Z]||(H[Z]={});H[Z].latest?Hf.semver.gt(M.latest,H[Z].latest)&&
(H[Z].latest=M.latest):H[Z].latest;H[Z].versions||(H[Z].versions={});var qa=this.System,Pa=Hf.resource(qa.baseURL),Yb;for(Yb in M.versions){var $b=M.versions[Yb],zc=$b.url;Hf.isAbsolute(zc)||(zc=Pa.join(zc).url);$b=new Hf.Package.fromJSON(qa,Object.assign({},$b,{url:zc}));H[Z].versions[Yb]=$b}}this.resetByURL();Hf.classHolder.ModulePackageMapping.forSystem(System).clearCache();return this}},{key:"whenReady",value:function(){return this._readyPromise||Promise.resolve()}},{key:"isReady",value:function(){return!this._readyPromise}},
{key:"withPackagesDo",value:function(A){for(var H in this.packageMap){var Z=this.packageMap[H].versions,M;for(M in Z)A(Z[M])}}},{key:"findPackage",value:function(A){for(var H in this.packageMap){var Z=this.packageMap[H].versions,M;for(M in Z){var qa=Z[M];if(A(qa))return qa}}return null}},{key:"filterPackages",value:function(A){var H=[];this.withPackagesDo(function(Z){return A(Z)&&H.push(Z)});return H}},{key:"allPackages",value:function(){var A=[],H;for(H in this.packageMap){var Z=this.packageMap[H].versions,
M;for(M in Z)A.push(Z[M])}return A}},{key:"sortPackagesByVersion",value:function(A){return A.sort(function(H,Z){return Hf.semver.compare(Z.version,H.version,!0)})}},{key:"matches",value:function(A,H,Z){var M=A.version;return A.name!==H?!1:!Z||Hf.semver.validRange(M||"",!0)&&Hf.semver.satisfies(M,Z,!0)?!0:!1}},{key:"coversDirectory",value:function(A){A=Hf.ensureResource(A).asDirectory();var H=this.packageBaseDirs,Z=this.devPackageDirs;if(this.individualPackageDirs.some(function(qa){return qa.equals(A)}))return"individualPackageDirs";
if(Z.some(function(qa){return qa.equals(A)}))return"devPackageDirs";var M=A.parent().parent();return H.some(function(qa){return qa.equals(M)})?this.allPackages().find(function(qa){return Hf.ensureResource(qa.url).equals(A)})?"packageCollectionDirs":"maybe packageCollectionDirs":null}},{key:"lookup",value:function(A,H){var Z=this,M=this.packageMap[A];if(!M)return null;if(!H||"latest"===H)return M.versions[M.latest];if(!Hf.semver.validRange(H,!0))throw Error("PackageRegistry>>lookup of ".concat(A,": Invalid version - ").concat(H));
M=Hf.obj.values(M.versions).filter(function(qa){return Z.matches(qa,A,H)});return 1>=M.length?M[0]:Hf.arr.last(this.sortPackagesByVersion(M))}},{key:"findPackageDependency",value:function(A,H,Z){Z||(Z=A.dependencies[H]||A.devDependencies[H]);Hf.semver.validRange(Z,!0)||(Z=null);return this.lookup(H,Z)}},{key:"findPackageWithURL",value:function(A){A.isResource&&(A=A.url);A.endsWith("/")&&(A=A.slice(0,-1));return this.byURL[A]}},{key:"findPackageHavingURL",value:function(A){A.isResource&&(A=A.url);
A.endsWith("/")&&(A=A.slice(0,-1));var H=Infinity,Z=null,M=this.byURL,qa;for(qa in M)if(0===A.indexOf(qa)){var Pa=A.slice(qa.length).length;Pa>=H||(H=Pa,Z=M[qa])}return Z}},{key:"findPackageForPath",value:function(A,H){if(Hf.isAbsolute(A))return this.findPackageHavingURL(A);if(A.startsWith("."))return null;A=A.split("/");A=Xb(A,1)[0];if(!A)return null;var Z=A.indexOf("@");if(-1<Z){var M=A.slice(Z+1);A=A.slice(0,Z)}return!M&&H?this.findPackageDependency(H,A):this.lookup(A,M)}},{key:"resolvePath",value:function(A,
H){if(Hf.isAbsolute(A))return A;var Z=H&&H.isPackage||null;if(!Z&&H){if(A.startsWith("."))return H=Hf.resource(H),H.isDirectory()||(H=H.parent()),H.join(A).withRelativePartsResolved().url;Z=this.findPackageHavingURL(H)}H=this.findPackageForPath(A,Z);if(!H)return null;Z=A.indexOf("/");return(A=-1===Z||Z===A.length-1?"":A.slice(Z))?Hf.resource(H.url).join(A).url:H.url}},{key:"update",value:function(){var A=Hb(regeneratorRuntime.mark(function Z(){var M=this,qa,Pa,Yb,$b,zc,id,jd,kd,be,te,Ce,me,ve,qg,
Eg,Wf,$f,Lf,jf,wh,yg,Gg;return regeneratorRuntime.wrap(function(zf){for(;;)switch(zf.prev=zf.next){case 0:if(this.isReady()){zf.next=2;break}return zf.abrupt("return",this.whenReady().then(function(){return M.update()}));case 2:qa=Hf.promise.deferred(),this._readyPromise=qa.promise,this.packageBaseDirs=this.packageBaseDirs.map(function(Kh){return Kh.asDirectory()}),this.individualPackageDirs=this.individualPackageDirs.map(function(Kh){return Kh.asDirectory()}),this.devPackageDirs=this.devPackageDirs.map(function(Kh){return Kh.asDirectory()}),
Pa={},zf.prev=8,Yb=ec(this.packageBaseDirs),zf.prev=10,Yb.s();case 12:if(($b=Yb.n()).done){zf.next=58;break}zc=$b.value;zf.t0=ec;zf.next=17;return zc.dirList(1);case 17:zf.t1=zf.sent,id=(0,zf.t0)(zf.t1),zf.prev=19,id.s();case 21:if((jd=id.n()).done){zf.next=48;break}kd=jd.value;zf.t2=ec;zf.next=26;return kd.dirList(1);case 26:zf.t3=function(Kh){return Kh.isDirectory()},zf.t4=zf.sent.filter(zf.t3),be=(0,zf.t2)(zf.t4),zf.prev=29,be.s();case 31:if((te=be.n()).done){zf.next=38;break}Ce=te.value;zf.next=
35;return this._discoverPackagesIn(Ce,Pa,"packageCollectionDirs");case 35:Pa=zf.sent;case 36:zf.next=31;break;case 38:zf.next=43;break;case 40:zf.prev=40,zf.t5=zf["catch"](29),be.e(zf.t5);case 43:return zf.prev=43,be.f(),zf.finish(43);case 46:zf.next=21;break;case 48:zf.next=53;break;case 50:zf.prev=50,zf.t6=zf["catch"](19),id.e(zf.t6);case 53:return zf.prev=53,id.f(),zf.finish(53);case 56:zf.next=12;break;case 58:zf.next=63;break;case 60:zf.prev=60,zf.t7=zf["catch"](10),Yb.e(zf.t7);case 63:return zf.prev=
63,Yb.f(),zf.finish(63);case 66:me=ec(this.individualPackageDirs),zf.prev=67,me.s();case 69:if((ve=me.n()).done){zf.next=76;break}qg=ve.value;zf.next=73;return this._discoverPackagesIn(qg,Pa,"individualPackageDirs");case 73:Pa=zf.sent;case 74:zf.next=69;break;case 76:zf.next=81;break;case 78:zf.prev=78,zf.t8=zf["catch"](67),me.e(zf.t8);case 81:return zf.prev=81,me.f(),zf.finish(81);case 84:Eg=ec(this.devPackageDirs),zf.prev=85,Eg.s();case 87:if((Wf=Eg.n()).done){zf.next=94;break}$f=Wf.value;zf.next=
91;return this._discoverPackagesIn($f,Pa,"devPackageDirs");case 91:Pa=zf.sent;case 92:zf.next=87;break;case 94:zf.next=99;break;case 96:zf.prev=96,zf.t9=zf["catch"](85),Eg.e(zf.t9);case 99:return zf.prev=99,Eg.f(),zf.finish(99);case 102:for(Lf in Pa)jf=Pa[Lf],wh=jf.pkg,yg=jf.config,Gg=jf.covered,this.System.debug&&console.log("[PackageRegistry] Adding discovered package ".concat(Lf," (from ").concat(Gg,")")),this._addPackageWithConfig(wh,yg,Lf+"/",Gg);this._updateLatestPackages();qa.resolve();zf.next=
110;break;case 107:zf.prev=107,zf.t10=zf["catch"](8),qa.reject(zf.t10);case 110:return zf.prev=110,this._readyPromise=null,this.resetByURL(),Hf.classHolder.ModulePackageMapping.forSystem(this.System).clearCache(),zf.finish(110);case 115:return zf.abrupt("return",this);case 116:case "end":return zf.stop()}},Z,this,[[8,107,110,115],[10,60,63,66],[19,50,53,56],[29,40,43,46],[67,78,81,84],[85,96,99,102]])}));return function(){return A.apply(this,arguments)}}()},{key:"addPackageAt",value:function(){var A=
Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b,zc,id,jd,kd,be,te=arguments;return regeneratorRuntime.wrap(function(Ce){for(;;)switch(Ce.prev=Ce.next){case 0:qa=1<te.length&&void 0!==te[1]?te[1]:"individualPackageDirs";Pa=2<te.length?te[2]:void 0;Yb=Z.isResource?Z.url:Z;Yb.endsWith("/")&&Yb.slice(0,-1);if(!this.byURL[Yb]){Ce.next=6;break}throw Error("package in ".concat(Yb," already added to registry"));case 6:return Ce.next=8,this._discoverPackagesIn(Hf.ensureResource(Z).asDirectory(),{},
void 0,Pa);case 8:$b=Ce.sent,Ce.t0=regeneratorRuntime.keys($b);case 10:if((Ce.t1=Ce.t0()).done){Ce.next=19;break}zc=Ce.t1.value;if(!this.byURL[zc]){Ce.next=14;break}return Ce.abrupt("continue",10);case 14:id=$b[zc];jd=id.pkg;kd=id.config;be=this._addPackageDir(zc,qa,!0);this._addPackageWithConfig(jd,kd,zc+"/",be);Ce.next=10;break;case 19:return this.resetByURL(),Hf.classHolder.ModulePackageMapping.forSystem(this.System).clearCache(),this._updateLatestPackages(),Ce.abrupt("return",this.findPackageWithURL(Z));
case 23:case "end":return Ce.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"removePackage",value:function(A){var H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0,Z=A.name,M=A.version,qa=Hf.ensureResource(A.url),Pa=this.coversDirectory(qa);"devPackageDirs"===Pa?this.devPackageDirs=this.devPackageDirs.filter(function(Yb){return!Yb.equals(qa)}):"individualPackageDirs"===Pa&&(this.individualPackageDirs=this.individualPackageDirs.filter(function(Yb){return!Yb.equals(qa)}));
Pa=this.packageMap;Pa[Z]&&(delete Pa[Z].versions[M],0===Object.keys(Pa[Z].versions).length&&delete Pa[Z]);this.resetByURL();Hf.classHolder.ModulePackageMapping.forSystem(this.System).clearCache();H&&this._updateLatestPackages(A.name)}},{key:"updateNameAndVersionOf",value:function(A,H,Z,M,qa){var Pa=this.packageMap;Pa[H]?Pa[H].versions[Z]||console.warn("[PackageRegistry>>updateNameAndVersionOf] No version entry ".concat(Z," of ").concat(H," found in registry (").concat(A.url,")")):console.warn("[PackageRegistry>>updateNameAndVersionOf] ".concat(H,
"@").concat(Z," not found in registry (").concat(A.url,")"));this._addToPackageMap(A,M,qa);Pa[H]&&Pa[H].versions[Z]&&(delete Pa[H].versions[Z],0===Object.keys(Pa[H].versions).length&&delete Pa[H]);this._updateLatestPackages(A.name)}},{key:"_updateLatestPackages",value:function(A){var H=this.packageMap;if(A&&H[A])H[A].latest=Hf.arr.last(Hf.semver.sort(Object.keys(H[A].versions),!0));else for(var Z in H)H[Z].latest=Hf.arr.last(Hf.semver.sort(Object.keys(H[Z].versions),!0))}},{key:"_discoverPackagesIn",
value:function(){var A=Hb(regeneratorRuntime.mark(function Pa(Z,M,qa){var Yb,$b,zc,id,jd,kd,be=arguments;return regeneratorRuntime.wrap(function(te){for(;;)switch(te.prev=te.next){case 0:Yb=3<be.length&&void 0!==be[3]?be[3]:null;if(Z.isDirectory()){te.next=3;break}return te.abrupt("return",M);case 3:$b=Z.asFile().url;if(!M.hasOwnProperty($b)){te.next=6;break}return te.abrupt("return",M);case 6:return te.prev=6,zc=Yb&&Yb[$b]||new Hf.Package(this.System,$b),te.next=10,zc.tryToLoadPackageConfig();case 10:return id=
te.sent,zc.setConfig(id),M[$b]={pkg:zc,config:id,covered:qa},this.System.debug&&(jd=id.name,kd=id.version,console.log("[lively.modules] package ".concat(jd,"@").concat(kd," discovered in ").concat(Z.url))),te.abrupt("return",M);case 17:return te.prev=17,te.t0=te["catch"](6),te.abrupt("return",M);case 20:case "end":return te.stop()}},Pa,this,[[6,17]])}));return function(Z,M,qa){return A.apply(this,arguments)}}()},{key:"_addToPackageMap",value:function(A,H,Z){var M=3<arguments.length&&void 0!==arguments[3]?
arguments[3]:!0;if(!H)throw Error("Cannot add package without name");Z||(Z="0.0.0");var qa=this.packageMap;qa=qa[H]||(qa[H]={versions:{},latest:null});if(qa.versions[Z]){var Pa="Redefining version ".concat(Z," of package ").concat(A.url);if(M)console.warn(Pa);else throw Error(Pa+" not allowed");}qa.versions[Z]=A}},{key:"_addPackageWithConfig",value:function(A,H,Z){3<arguments.length&&void 0!==arguments[3]&&arguments[3]||this._addPackageDir(Z,"individualPackageDirs",!0);A.registerWithConfig(H);this._addToPackageMap(A,
A.name,A.version);return A}},{key:"_addPackageDir",value:function(A){var H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"individualPackageDirs",Z=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0;A=Hf.ensureResource(A).asDirectory();if(("packageCollectionDirs"===H||"maybe packageCollectionDirs"===H)&&(this.coversDirectory(A)||"").includes("packageCollectionDirs"))return"packageCollectionDirs";var M=this[H].concat(A);this[H]=Z?Hf.arr.uniqBy(M,function(qa,Pa){return qa.equals(Pa)}):
M;return H}},{key:"byURL",get:function(){if(!this._byURL){this._byURL={};var A=ec(this.allPackages()),H;try{for(A.s();!(H=A.n()).done;){var Z=H.value;this._byURL[Z.url]=Z}}catch(M){A.e(M)}finally{A.f()}}return this._byURL}}]);return y}());Hf.PackageRegistry=Bh;var ah=window.lively.FreezerRuntime.recorderFor("lively.modules/src/export-lookup.js");ah.commonjsHelpers=hb;ah.obj=yb;ah.subscribe=Sb;ah.unsubscribe=ka;ah.module=tb;var th=Lc("E",function(){function y(A){nd(this,y);this.System=A;this.subscribeToSystemChanges()}
Fd(y,null,[{key:"forSystem",value:function(A){this._forSystemMap||(this._forSystemMap=new WeakMap);var H=this._forSystemMap.get(A);if(H)return H;H=new this(A);this._forSystemMap.set(A,H);return H}},{key:"run",value:function(){var A=1<arguments.length?arguments[1]:void 0;return this.forSystem(0<arguments.length&&void 0!==arguments[0]?arguments[0]:System).systemExports(A)}},{key:"findExportOfValue",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb=arguments;return regeneratorRuntime.wrap(function($b){for(;;)switch($b.prev=
$b.next){case 0:return qa=1<Yb.length&&void 0!==Yb[1]?Yb[1]:System,$b.next=3,this.run(qa);case 3:return Pa=$b.sent,$b.abrupt("return",Pa.find(function(zc){var id=zc.local;zc=ah.module(qa,zc.moduleId);zc=zc.recorder||qa.get(zc.id)||{};try{return zc[id]===Z}catch(jd){return!1}}));case 5:case "end":return $b.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()}]);Fd(y,[{key:"subscribeToSystemChanges",value:function(){var A=this;if(!this._notificationHandlers){var H=this.System;this._notificationHandlers=
[ah.subscribe("lively.modules/moduleloaded",function(Z){return A.clearCacheFor(Z.module)},H),ah.subscribe("lively.modules/modulechanged",function(Z){return A.clearCacheFor(Z.module)},H),ah.subscribe("lively.vm/doitresult",function(Z){return A.clearCacheFor(Z.targetModule)},H)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var A=this.System;ah.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],A);ah.unsubscribe("lively.modules/modulechanged",
this._notificationHandlers[1],A);ah.unsubscribe("lively.vm/doitresult",this._notificationHandlers[2],A);this._notificationHandlers=null}}},{key:"clearCacheFor",value:function(A){this.exportByModuleCache[A]=null}},{key:"systemExports",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa=this,Pa;return regeneratorRuntime.wrap(function(Yb){for(;;)switch(Yb.prev=Yb.next){case 0:return Yb.next=2,this.rawExportsByModule(Z);case 2:return Pa=Yb.sent,Object.keys(Pa).forEach(function($b){return qa.resolveExportsOfModule($b,
Pa)}),Yb.abrupt("return",Object.keys(Pa).flatMap(function($b){return Pa[$b]?Pa[$b].resolvedExports||Pa[$b].rawExports:[]}));case 5:case "end":return Yb.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"rawExportsByModule",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa=this,Pa,Yb,$b,zc,id;return regeneratorRuntime.wrap(function(jd){for(;;)switch(jd.prev=jd.next){case 0:return Z=Z||{},Pa=this.System,Yb=Pa.get("@lively-env")||{},$b=Object.keys(Yb.loadedModules||
{}),zc={},id=function(kd){1>kd%50&&Z.progress.step&&Z.progress.step("Scanning ...",kd/$b.length)},jd.next=8,Promise.all($b.map(function(kd,be){Z.progress&&id(be);return qa.rawExportsOfModule(kd,Z,zc).then(function(te){return te?zc[kd]=te:null})}));case 8:return jd.abrupt("return",zc);case 9:case "end":return jd.stop()}},M,this)}));return function(Z){return A.apply(this,arguments)}}()},{key:"rawExportsOfModule",value:function(){var A=Hb(regeneratorRuntime.mark(function M(Z){var qa,Pa,Yb,$b,zc,id,jd,
kd,be,te,Ce,me,ve,qg,Eg,Wf,$f,Lf,jf,wh=arguments;return regeneratorRuntime.wrap(function(yg){for(;;)switch(yg.prev=yg.next){case 0:qa=1<wh.length&&void 0!==wh[1]?wh[1]:{};Pa=this.System;Yb=this.exportByModuleCache;$b=qa.excludedPackages||[];zc=qa.excludedURLs||(qa.excludedURLs=$b.filter(function(Gg){return"string"===typeof Gg}));id=qa.excludeFns||(qa.excludeFns=$b.filter(function(Gg){return"function"===typeof Gg}));jd=qa.excludedPackageURLs||(qa.excludedPackageURLs=zc.concat(zc.map(function(Gg){return Pa.decanonicalize(Gg.replace(/\/?$/,
"/")).replace(/\/$/,"")})));if(!Yb[Z]){yg.next=9;break}kd=Yb[Z].rawExports;return yg.abrupt("return",jd.includes(kd.packageURL)||id.some(function(Gg){return Gg(kd.packageURL)})?null:Yb[Z]);case 9:be=ah.module(Pa,Z);te=be.pathInPackage();me=(Ce=be["package"]())&&Ce.main&&te===Ce.main;ve=Ce?Ce.url:"";qg=Ce?Ce.name:"";Eg=Ce?Ce.version:"";Wf={moduleId:Z,isMain:me,pathInPackage:te,packageName:qg,packageURL:ve,packageVersion:Eg,exports:[]};if(!jd.includes(ve)&&!id.some(function(Gg){return Gg(ve)})){yg.next=
19;break}return yg.abrupt("return",null);case 19:yg.prev=19;$f=be.format();if(!["register","es6","esm"].includes($f)){yg.next=27;break}yg.next=24;return be.exports();case 24:Wf.exports=yg.sent;yg.next=39;break;case 27:return yg.next=29,be.load();case 29:Lf=yg.sent,Wf.exports=[],yg.t0=regeneratorRuntime.keys(Lf);case 32:if((yg.t1=yg.t0()).done){yg.next=39;break}jf=yg.t1.value;if("__useDefault"!==jf&&"default"!==jf){yg.next=36;break}return yg.abrupt("continue",32);case 36:Wf.exports.push({exported:jf,
local:jf,type:"id"});yg.next=32;break;case 39:yg.next=44;break;case 41:yg.prev=41,yg.t2=yg["catch"](19),Wf.error=yg.t2;case 44:return yg.abrupt("return",Yb[Z]={rawExports:Wf});case 45:case "end":return yg.stop()}},M,this,[[19,41]])}));return function(Z){return A.apply(this,arguments)}}()},{key:"resolveExportsOfModule",value:function(A,H){var Z=this,M=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!M[A]){M[A]=!0;var qa=H[A];if(qa&&!qa.resolvedExports){var Pa=this.System,Yb=ah.obj.select(qa.rawExports,
"moduleId isMain packageName packageURL packageVersion pathInPackage".split(" "));qa.resolvedExports=qa.rawExports.exports.flatMap(function($b){var zc=$b.type,id=$b.exported,jd=$b.local,kd=$b.fromModule;if("all"!==zc)return[Object.assign({},Yb,{type:zc,exported:id,local:jd,fromModule:kd})];$b=Pa.decanonicalize(kd,A);Z.resolveExportsOfModule($b,H,M);return(H[$b]&&H[$b].resolvedExports||[]).map(function(be){return Object.assign({},Yb,{type:be.type,exported:be.exported,local:be.local,fromModule:be.fromModule||
kd})})});M[A]=!1}}}},{key:"exportByModuleCache",get:function(){return this._exportByModuleCache||(this._exportByModuleCache={})}}]);return y}());ah.ExportLookup=th;ah["default"]=th;var Xg=window.lively.FreezerRuntime.recorderFor("lively.modules/cjs/dependencies.js");Xg.buildPackageMap=Fa;Xg.resolvePackageDependencies=Ka;Xg.dependencyGraph=Ib;Xg.obj=yb;Xg.resource=wb;Xg.buildPackageMap=Fa;Xg.resolvePackageDependencies=Ka;Xg.dependencyGraph=Ib;var ti=Object.freeze({__proto__:null,buildPackageMap:Fa,
resolvePackageDependencies:Ka,dependencyGraph:Ib}),Af=window.lively.FreezerRuntime.recorderFor("lively.modules/src/packages/module-package-mapping.js");Af.arr=Nd;Af.unsubscribe=ka;Af.subscribe=Sb;Af.knownModuleNames=ua;Af.classHolder=re;var vh=function(){function y(A){nd(this,y);this.System=A;this._notificationHandlers=null;this.clearCache();this.subscribeToSystemChanges()}Fd(y,null,[{key:"forSystem",value:function(A){var H=A["__lively.modules__modulePackageMapCache"];if(H)return H;H=new this(A);
return A["__lively.modules__modulePackageMapCache"]=H}}]);Fd(y,[{key:"subscribeToSystemChanges",value:function(){var A=this;if(!this._notificationHandlers){var H=this.System;this._notificationHandlers=[Af.subscribe("lively.modules/moduleloaded",function(Z){return A.addModuleIdToCache(Z.module)},H),Af.subscribe("lively.modules/moduleunloaded",function(Z){return A.removeModuleFromCache(Z.module)},H),Af.subscribe("lively.modules/packageregistered",function(Z){return A.clearCache()},H),Af.subscribe("lively.modules/packageremoved",
function(Z){return A.clearCache()},H)]}}},{key:"unsubscribeFromSystemChanges",value:function(){if(this._notificationHandlers){var A=this.System;Af.unsubscribe("lively.modules/moduleloaded",this._notificationHandlers[0],A);Af.unsubscribe("lively.modules/moduleunloaded",this._notificationHandlers[1],A);Af.unsubscribe("lively.modules/packageregistered",this._notificationHandlers[2],A);Af.unsubscribe("lively.modules/packageremoved",this._notificationHandlers[3],A);this._notificationHandlers=null}}},{key:"clearCache",
value:function(){this._cacheInitialized=!1;this.packageToModule={};this.modulesToPackage={};this.modulesWithoutPackage={}}},{key:"ensureCache",value:function(){var A=this.System,H=this.packageToModule,Z=this.modulesToPackage,M=this.modulesWithoutPackage;if(this._cacheInitialized)return this;for(var qa=Af.classHolder.Package.allPackageURLs(A),Pa=0;Pa<qa.length;Pa++)H[qa[Pa]]=[];A=Af.knownModuleNames(A);for(Pa=0;Pa<A.length;Pa++){for(var Yb=A[Pa],$b=void 0,zc=0;zc<qa.length;zc++){var id=qa[zc];Yb.startsWith(id)&&
(!$b||$b.length<id.length)&&($b=id)}$b?(H[$b].push(Yb),Z[Yb]=$b):M[Yb]={}}this._cacheInitialized=!0;return this}},{key:"addModuleIdToCache",value:function(A){this.ensureCache();var H=this.packageToModule,Z=this.modulesToPackage,M=this.modulesWithoutPackage;if(Z[A])return Z[A];if(M[A])return null;for(var qa=Object.keys(H),Pa,Yb=0;Yb<qa.length;Yb++){var $b=qa[Yb];A.startsWith($b)&&(!Pa||Pa.length<$b.length)&&(Pa=$b)}if(Pa)return(H[Pa]||(H[Pa]=[])).push(A),Z[A]=Pa;M[A]={};return null}},{key:"removeModuleFromCache",
value:function(A){if(this._cacheInitialized){var H=this.packageToModule,Z=this.modulesToPackage,M=this.modulesWithoutPackage;if(M.hasOwnProperty(A))delete M[A];else if(M=Z[A])delete Z[A],H[M]&&Af.arr.remove(H[M],A)}}},{key:"getPackageURLForModuleId",value:function(A){return this.modulesToPackage[A]||this.addModuleIdToCache(A)}},{key:"getModuleIdsForPackageURL",value:function(A){this.ensureCache();return this.packageToModule[A]||[]}}]);return y}();Af.ModulePackageMapping=vh;Af["default"]=vh;var Md=
window.lively.FreezerRuntime.recorderFor("lively.modules/index.js");Md.changeSystem=C;Md.wrapModuleResolution=Pb;Md.unwrapModuleResolution=da;Md.loadedModules=wa;Md.module=ca;Md.isModuleLoaded=ma;Md.doesModuleExist=u;Md.printSystemConfig=O;Md.whenLoaded=P;Md.importPackage=fa;Md.registerPackage=Qa;Md.removePackage=Ua;Md.reloadPackage=Gb;Md.getPackages=ta;Md.getPackage=mc;Md.getPackageOfModule=pc;Md.ensurePackage=zd;Md.applyPackageConfig=Pd;Md.lookupPackage=bd;Md.moduleSourceChange=Yd;Md.requireMap=
le;Md.isHookInstalled=Be;Md.installHook=Ne;Md.removeHook=Re;Md.wrapModuleLoad=nf;Md.unwrapModuleLoad=af;Md.getSystem=vb;Md.removeSystem=cc;Md.prepareSystem=ob;Md._printSystemConfig=nc;Md._unwrapModuleResolution=gb;Md._wrapModuleResolution=Td;Md._whenLoaded=Yc;Md._module=tb;Md._doesModuleExist=Ob;Md._isModuleLoaded=ab;Md.GLOBAL="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:void 0;Md.defaultSystem=Md.defaultSystem||Md.prepareSystem(Md.GLOBAL.System);
var Bf=Md.defaultSystem;Md.System=Bf;Md.defaultSystem=Bf;Md.getSystem=vb;Md.removeSystem=cc;Md.loadedModules=wa;Md.printSystemConfig=O;Md.whenLoaded=P;Md.changeSystem=C;Md.module=ca;Md.doesModuleExist=u;Md.isModuleLoaded=ma;Md.unwrapModuleResolution=da;Md.wrapModuleResolution=Pb;Md.Package=Cc;Md._getPackage=Vb;Md._ensurePackage=qb;Md.getPackageSpecs=va;Md._applyPackageConfig=Lb;Md._importPackage=Kb;Md._removePackage=Db;Md._reloadPackage=Ra;Md._registerPackage=N;Md._lookupPackage=Ma;Md.importPackage=
fa;Md.registerPackage=Qa;Md.removePackage=Ua;Md.reloadPackage=Gb;Md.getPackages=ta;Md.getPackage=mc;Md.getPackageOfModule=pc;Md.ensurePackage=zd;Md.applyPackageConfig=Pd;Md.lookupPackage=bd;Md.PackageRegistry=Bh;Md.PackageRegistry=Bh;Md._moduleSourceChange=xb;Md.moduleSourceChange=Yd;Md.computeRequireMap=eb;Md.requireMap=le;Md._isHookInstalled=pb;Md._installHook=K;Md._removeHook=ya;Md.isHookInstalled=Be;Md.installHook=Ne;Md.removeHook=Re;Md._wrapModuleLoad=Xd;Md._unwrapModuleLoad=oc;Md.wrapModuleLoad=
nf;Md.unwrapModuleLoad=af;Md["default"]=th;Md.ExportLookup=th;Md.cjs=ti;Md.cjs=ti;Md["default"]=oh;Md.semver=oh;Md.ImportInjector=ud;Md.scripting=Md.defaultSystem._scripting={module:Md._module,ensurePackage:Md._ensurePackage,registerPackage:Md._registerPackage,importPackage:Md._importPackage,lookupPackage:Md._lookupPackage,ImportInjector:Md.ImportInjector};Md.defaultClassToFunctionConverterName=Cb;Md.classRuntime=bc;Md.defaultSystem.global[Md.defaultClassToFunctionConverterName]=Md.classRuntime.initializeClass;
Md.classHolder=re;Md.ModulePackageMapping=vh;Md.classHolder.ModulePackageMapping=Md.ModulePackageMapping;Md.classHolder.Package=Md.Package;Md.classHolder.PackageRegistry=Md.PackageRegistry;var xg=Lc("s",Md.scripting);Md.scripting=xg;var df=Object.freeze({__proto__:null,System:Bf,getSystem:vb,removeSystem:cc,loadedModules:wa,printSystemConfig:O,whenLoaded:P,changeSystem:C,module:ca,doesModuleExist:u,isModuleLoaded:ma,unwrapModuleResolution:da,wrapModuleResolution:Pb,importPackage:fa,registerPackage:Qa,
removePackage:Ua,reloadPackage:Gb,getPackages:ta,getPackage:mc,getPackageOfModule:pc,ensurePackage:zd,applyPackageConfig:Pd,lookupPackage:bd,PackageRegistry:Bh,moduleSourceChange:Yd,requireMap:le,isHookInstalled:Be,installHook:Ne,removeHook:Re,wrapModuleLoad:nf,unwrapModuleLoad:af,ExportLookup:th,cjs:ti,semver:oh,scripting:xg});Lc("m",df)}}});