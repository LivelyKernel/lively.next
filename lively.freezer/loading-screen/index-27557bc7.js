System.register(["./__root_module__-884b54f8.js","kld-intersections"],function(za){var cb,mb,Pb,tb,Fc,vc,Qc,mc,ic,zc,Dc,Gd,Hd,Zd;return{setters:[function(xc){cb=xc.a_;mb=xc.a;Pb=xc.r;tb=xc.Y;Fc=xc.p;vc=xc.X;Qc=xc.bv;mc=xc.aZ;ic=xc.i;zc=xc.s;Dc=xc.bw;Gd=xc.bx;Hd=xc.J;Zd=xc.by},function(){}],execute:function(){function xc(Bb){try{var sa=eval("("+ub.ast.transform.wrapInFunction("var _; _ = ("+Bb+")")+")()")}catch(Ta){return JSON.parse(Bb)}return"object"!==typeof sa?null:sa}function od(Bb,sa){var Ta,
O,U,ra,xa,pa,ea,bb,Aa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){switch(Rb.nextAddress){case 1:return Ta=sa.world(),Rb.yield(Ta.prompt("Enter package name",{requester:sa,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:O=Rb.yieldResult;if(!O)throw"Canceled";Rb.setCatchFinallyBlocks(3);ra=db.resource(O);O=ra.name();U=ra.url;Rb.leaveTryBlock(4);break;case 3:return Rb.enterCatchBlock(),Rb.yield(Bb.getConfig(),5);case 5:return xa=Rb.yieldResult.baseURL,
pa=db.resource(xa).join(O).asDirectory().url,Rb.yield(Bb.normalize(pa),6);case 6:U=Rb.yieldResult.replace(/\/\.js$/,"/");case 4:return Rb.yield(Ta.prompt("Confirm or change package location",{requester:sa,input:U,historyId:"lively.vm-editor-add-package-address"}),7);case 7:ea=Rb.yieldResult;if(!ea)throw"Canceled";bb=db.resource(ea).asDirectory();Aa=bb.asFile().url;return Rb.yield(Bb.removePackage(Aa),8);case 8:return Rb.yield(Bb.resourceCreateFiles(Aa,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
O+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+O+"\n\nNo description for package "+O+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+O+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Rb.return(db.loadPackage(Bb,{name:O,address:Aa,configFile:bb.join("package.json").url,main:bb.join("index.js").url,test:bb.join("tests/test.js").url,type:"package"}))}})}function qb(Bb,sa,Ta){Ta=void 0===Ta?null:
Ta;var O,U,ra,xa,pa,ea,bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Aa){switch(Aa.nextAddress){case 1:return O={name:"",address:"",type:"package"},Aa.yield(Bb.getConfig(),2);case 2:U=Aa.yieldResult;if(!Ta){Aa.jumpTo(3);break}return Aa.yield(Bb.getPackage(Ta),4);case 4:if(ra=Aa.yieldResult){Aa.jumpTo(5);break}return Aa.yield(Bb.getPackageForModule(Ta),6);case 6:ra=Aa.yieldResult;case 5:xa=ra;case 3:return Aa.yield(sa.world().prompt("What is the package directory?",{requester:sa,input:xa?
xa.address:U.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:pa=Aa.yieldResult;if(!pa)throw"Canceled";O.address=pa.replace(/\/$/,"");O.url=new db.URL(O.address+"/");O.configFile=db.resource(O.url).join("package.json").url;Aa.setCatchFinallyBlocks(8);ea=JSON;bb=ea.parse;return Aa.yield(Bb.moduleRead(O.configFile),10);case 10:bb.call(ea,Aa.yieldResult).name;Aa.leaveTryBlock(9);break;case 8:Aa.enterCatchBlock(),O.name=String(O.url).replace(/\/$/,""),Bb.resourceEnsureExistance(O.configFile,
'{\n  "name": "'+O.name+'",\n  "version": "0.1.0"\n}');case 9:return Aa.return(db.loadPackage(Bb,O))}})}function kc(Bb,sa,Ta){var O,U,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){switch(xa.nextAddress){case 1:return O=db.resource(Ta).asFile().url,xa.yield(Bb.getPackage(O),2);case 2:if(U=xa.yieldResult){xa.jumpTo(3);break}return xa.yield(Bb.getPackageForModule(O),4);case 4:U=xa.yieldResult;case 3:ra=U;if(!ra)throw Error("Cannot find package for "+O);return xa.yield(Bb.reloadPackage(O),
5);case 5:if(!sa){xa.jumpTo(0);break}return xa.yield(sa.updateModuleList(),7);case 7:return xa.yield(sa.uiSelect(O,!1),8);case 8:return xa.return(xa.yieldResult)}})}function Uc(Bb,sa,Ta,O){var U,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){switch(xa.nextAddress){case 1:return xa.yield(Bb.getPackage(Ta),2);case 2:return U=xa.yieldResult,xa.yield((O||$world).confirm("Unload package "+U.name+"?",{requester:sa}),3);case 3:ra=xa.yieldResult;if(!ra)throw"Canceled";return xa.yield(Bb.removePackage(Ta),
4);case 4:if(!sa){xa.jumpTo(0);break}return xa.yield(sa.updateModuleList(),6);case 6:return xa.yield(sa.uiSelect(null),0)}})}function tc(Bb,sa,Ta){var O,U,ra,xa,pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){switch(ea.nextAddress){case 1:return O=sa.world(),ea.yield(Bb.getPackage(Ta),2);case 2:return U=ea.yieldResult,U?ea.yield(O.confirm("Really remove package "+U.name+"?",{requester:sa}),3):($world.inform('No package "'+Ta+'" found!',{requester:sa}),ea.return());case 3:ra=ea.yieldResult;
if(!ra)throw"Canceled";Bb.removePackage(Ta);return ea.yield(O.confirm("Also remove directory "+U.name+" including "+U.modules.length+" modules?"),4);case 4:xa=ea.yieldResult;if(!xa){ea.jumpTo(0);break}return ea.yield(O.confirm("REALLY *remove* directory "+U.name+"? No undo possible..."),6);case 6:if(pa=ea.yieldResult)return ea.yield(Bb.resourceRemove(U.address),0);ea.jumpTo(0)}})}function cd(Bb,sa,Ta){Ta=void 0===Ta?$world:Ta;var O,U,ra,xa,pa,ea,bb,Aa,Rb,Gc,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){switch(Hc.nextAddress){case 1:return Hc.yield(Bb.getPackage(sa),
2);case 2:O=Hc.yieldResult;if(!O)throw Error("Cannot find package "+sa);U=[];ra=$jscomp.makeIterator(O.modules);xa=ra.next();case 3:if(xa.done)return Hc.yield(Ta.execCommand("open text window",{title:"imports and exports of "+sa,content:U.join("\n\n")}),0);pa=xa.value;if(!pa.name.match(/\.js$/)){Hc.jumpTo(4);break}Hc.setCatchFinallyBlocks(6);ea=Bb;bb=ea.importsAndExportsOf;Aa=pa.name;return Hc.yield(Bb.moduleRead(pa.name),9);case 9:return Hc.yield(bb.call(ea,Aa,Hc.yieldResult),8);case 8:Rb=Hc.yieldResult;
Hc.leaveTryBlock(7);break;case 6:Gc=Hc.enterCatchBlock();Ta.logError(Error("Error when getting imports/exports from module "+pa.name+":\n"+Gc.stack));Hc.jumpTo(4);break;case 7:Ab=""+pa.name;if(!Rb.imports.length&&!Rb.exports.length){Ab+="\n  does not import / export anything";Hc.jumpTo(4);break}Rb.imports.length&&(Ab+="\n  imports:\n",Ab+=db.arr.groupByKey(Rb.imports,"fromModule").mapGroups(function(fb,ud){return"from "+fb+": "+ud.map(function(je){return je.local||je.imported?je.imported&&je.imported!==
je.local?je.imported+" as "+je.local:je.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(fb){return"    "+fb}).join("\n"));Rb.exports.length&&(Ab+="\n  exports:\n",Ab+=Rb.exports.map(function(fb){return fb.local?fb.local&&fb.local!==fb.exported?fb.local+" as "+fb.exported:fb.exported:fb.exported+" from "+fb.fromModule}).join(", ").split("\n").map(function(fb){return"    "+fb}).join("\n"));U.push(Ab);case 4:xa=ra.next(),Hc.jumpTo(3)}})}function td(Bb){return Bb.match(/import.*['"]mocha(-es6)?['"]/)&&
Bb.match(/it\(['"]/)}function nb(Bb,sa,Ta){Ta=Ta&&Ta.address;if(Ta&&0===sa.indexOf(Ta))var O=sa.slice(Ta.length).replace(/^\//,"");else a:{Ta=Bb.getConfig();if(!Ta||Ta.constructor!==Promise)try{O=String((new Xb.URL(sa)).relativePathFrom(new Xb.URL(Bb.getConfig().baseURL)));break a}catch(U){}O=sa}return O}function cc(Bb,sa,Ta,O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){return 1==U.nextAddress?(O=Object.assign({targetModule:sa},O),U.yield(Bb.normalize(sa),2)):3!=U.nextAddress?
(sa=U.yieldResult,U.yield(Bb.moduleSourceChange(sa,Ta,O),3)):U.return(sa)})}function wc(Bb,sa,Ta,O,U){O=void 0===O?!1:O;U=void 0===U?!1:U;var ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){switch(xa.nextAddress){case 1:return sa&&sa.setStatusMessage("Reloading "+Ta),xa.setCatchFinallyBlocks(2),xa.yield(Bb.reloadModule(Ta,{reloadDeps:O,resetEnv:U}),4);case 4:if(!sa){xa.jumpTo(5);break}return xa.yield(sa.updateModuleList(),6);case 6:case 5:sa&&sa.setStatusMessage("Reloded "+Ta);
xa.leaveTryBlock(0);break;case 2:ra=xa.enterCatchBlock();xa.setCatchFinallyBlocks(7);if(!sa){xa.jumpTo(9);break}return xa.yield(sa.updateEditorWithSourceOf(Ta),10);case 10:case 9:xa.leaveTryBlock(8);break;case 7:xa.enterCatchBlock();case 8:throw sa&&sa.showError(ra),ra;}})}function dc(Bb,sa,Ta){return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){switch(O.nextAddress){case 1:return O.yield(Bb.forgetModule(Ta,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!sa){O.jumpTo(3);break}return O.yield(sa.updateModuleList(),
4);case 4:case 3:O.jumpToEnd()}})}function Nc(Bb,sa,Ta){var O,U,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){switch(xa.nextAddress){case 1:return xa.yield(Bb.normalize(Ta),2);case 2:return O=xa.yieldResult,xa.yield(sa.world().confirm("Remove file "+O+"?",{requester:sa}),3);case 3:U=xa.yieldResult;if(!U)throw"Canceled";return xa.yield(Bb.forgetModule(O),4);case 4:return xa.yield(Bb.resourceRemove(O),5);case 5:return xa.yield(Bb.getPackageForModule(O),6);case 6:return ra=xa.yieldResult,
xa.return(ra)}})}function $a(Bb,sa,Ta){var O,U,ra,xa,pa,ea,bb,Aa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){switch(Rb.nextAddress){case 1:return O=Xb.URL,Rb.yield(Bb.getConfig(),2);case 2:U=new O(Rb.yieldResult.baseURL);ra=sa.world();if(!Ta){Rb.jumpTo(3);break}return Rb.yield(Bb.getPackage(Ta),4);case 4:if(xa=Rb.yieldResult){Rb.jumpTo(5);break}return Rb.yield(Bb.getPackageForModule(Ta),6);case 6:xa=Rb.yieldResult;case 5:(pa=xa)&&(U=new Xb.URL(pa.address));case 3:return Rb.yield(Xb._searchForExistingFiles(sa,
String(U),pa),7);case 7:ea=Rb.yieldResult;if(!ea.includes("[create new module]")){Rb.jumpTo(8);break}return Rb.yield(Xb._askForModuleName(Bb,Ta||String(U),ra),9);case 9:bb=Rb.yieldResult,ea=[bb];case 8:return Rb.yield(Xb._createAndLoadModules(Bb,ea),10);case 10:return Aa=Rb.yieldResult,Xb.arr.compact(Aa.map(function(Gc){return Gc.error})),Rb.return(Aa)}})}function Xa(Bb,sa){var Ta,O,U,ra,xa,pa,ea,bb,Aa,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gc){if(1==Gc.nextAddress)return Gc.yield(Bb.getPackage(sa),
2);if(3!=Gc.nextAddress){Ta=Gc.yieldResult;if(!Ta||!Ta.address.match(/^http/))throw Error("Cannot load package "+sa);O=Xb.resource(Ta.address);U=[];ra=$jscomp;xa=ra.makeIterator;return Gc.yield(O.dirList(5,{exclude:Xb.modulesInPackage_defaultExclude}),3)}pa=xa.call(ra,Gc.yieldResult);for(ea=pa.next();!ea.done;ea=pa.next())Aa=bb=ea.value,Rb=Aa.url,Rb.match(/\.js$/)&&Bb.isModuleLoaded(Rb,!0)&&U.push(Bb.getModule(Rb));return Gc.return(U)})}function Gb(Bb){Bb||(Bb="local");if(Bb.isSystemInterface)var sa=
Bb;else"string"===typeof Bb&&Bb.startsWith("l2l ")&&(Bb={type:"l2l",id:Bb.split(" ")[1]}),"string"!==typeof Bb&&"l2l"===Bb.type&&(sa=Cb.l2lInterfaceFor(Bb.id,Bb.info)),"string"!==typeof Bb&&($world.setStatusMessage("Unknown system interface "+Bb),Bb="local"),sa||(sa=Bb&&"local"!==Bb?Cb.serverInterfaceFor(Bb):Cb.localInterface);return sa}za("systemInterfaceNamed",Gb);var ub=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");ub.parseJsonLikeObj=xc;ub.ast=cb;ub.parseJsonLikeObj=
xc;ub.parseJsonLikeObj=xc;var db=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");db.loadPackage=function(Bb,sa){var Ta,O;return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){switch(U.nextAddress){case 1:return U.yield(Bb.importPackage(sa.address+"/"),2);case 2:if(!sa.main){U.jumpTo(3);break}return U.yield(Bb.importModule(sa.main.toString()),3);case 3:if(!sa.test){U.jumpTo(5);break}U.setCatchFinallyBlocks(6);return U.yield(Bb.importPackage("mocha-es6"),8);
case 8:return Ta=U.yieldResult,U.yield(Ta.installSystemInstantiateHook(),9);case 9:return U.yield(Bb.importModule(sa.test.toString()),10);case 10:U.leaveTryBlock(5);break;case 6:O=U.enterCatchBlock(),console.warn("Cannot load test of new package: "+O);case 5:return U.return(Bb.getPackage(sa.address))}})};db.interactivelyCreatePackage=od;db.interactivelyLoadPackage=qb;db.interactivelyReloadPackage=kc;db.interactivelyUnloadPackage=Uc;db.interactivelyRemovePackage=tc;db.showExportsAndImportsOf=cd;db.parseJsonLikeObj=
xc;db.arr=mb;db.resource=Pb;db.interactivelyCreatePackage=od;db.interactivelyCreatePackage=od;db.interactivelyLoadPackage=qb;db.interactivelyLoadPackage=qb;db.interactivelyReloadPackage=kc;db.interactivelyReloadPackage=kc;db.interactivelyUnloadPackage=Uc;db.interactivelyUnloadPackage=Uc;db.interactivelyRemovePackage=tc;db.interactivelyRemovePackage=tc;db.showExportsAndImportsOf=cd;db.showExportsAndImportsOf=cd;var Xb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
Xb.isTestModule=td;Xb.shortModuleName=nb;Xb.interactivelyChangeModule=cc;Xb.interactivelyReloadModule=wc;Xb.interactivelyUnloadModule=dc;Xb.interactivelyRemoveModule=Nc;Xb.interactivelyAddModule=$a;Xb._askForModuleName=function(Bb,sa,Ta){var O,U;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){switch(ra.nextAddress){case 1:return ra.yield(Ta.prompt("Enter module name",{input:sa,historyId:"lively.vm-editor-add-module-name"}),2);case 2:sa=ra.yieldResult;if(!sa)throw"Canceled";return ra.yield(Bb.normalize(sa),
3);case 3:return O=ra.yieldResult,ra.yield(Ta.confirm(["Create module \n",{},O,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:U=ra.yieldResult;if(!U)throw"Canceled";return ra.return(O)}})};Xb._searchForExistingFiles=function(Bb,sa,Ta){return $jscomp.asyncExecutePromiseGeneratorProgram(function(O){return String(sa).match(/^http/)?O.return(Xb._searchForExistingFilesWeb(Bb,sa,Ta)):O.return(Xb._searchForExistingFilesManually(Bb,sa,Ta))})};Xb._searchForExistingFilesManually=function(Bb,sa,
Ta){var O,U;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){switch(ra.nextAddress){case 1:return ra.yield(Bb.world().multipleChoicePrompt("Add Module",{requester:Bb,choices:["Create New Module","Load Existing Module"]}),2);case 2:O=ra.yieldResult;if("Create New Module"===O)return ra.return("[create new module]");if("Load Existing Module"!==O){ra.jumpTo(3);break}return ra.yield(Bb.world().prompt("URL of module?",{input:sa,requester:Bb,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(U=ra.yieldResult)return ra.return([U]);case 3:throw"Canceled";}})};Xb._searchForExistingFilesWeb=function(Bb,sa,Ta){function O(Aa){Aa.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Aa.name())||Ta&&Xb.arr.pluck(Ta.modules,"name").includes(Aa.url)?!0:!1}var U,ra,xa,pa,ea,bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Aa){switch(Aa.nextAddress){case 1:return(U=Bb.world())&&(ra=U.showLoadingIndicatorFor(Bb,"Loading existing modules...")),
Aa.yield(Xb.resource(sa).dirList(5,{exclude:O}),3);case 3:return Aa.yield(Aa.yieldResult.map(function(Rb){return Rb.url}),2);case 2:return xa=Aa.yieldResult,pa=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(xa.filter(function(Rb){return Rb.endsWith(".js")}).map(function(Rb){return{isListItem:!0,string:Ta&&0==Rb.indexOf(Ta.address)?Ta.name+Rb.slice(Ta.address.length):Rb,value:Rb}})),Aa.yield(Promise.resolve(ra&&ra.remove()).then(function(){return Bb.world().filterableListPrompt("What module to load?",
pa,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:Bb},Bb?{extent:Bb.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:ea=Aa.yieldResult;if(!ea||"canceled"===ea.status||!ea.selected.length)throw"Canceled";bb=ea.selected||ea;Array.isArray(bb)||(bb=[bb]);return Aa.return(bb)}})};Xb._createAndLoadModules=function(Bb,sa){var Ta,O,U,ra,xa,pa,ea,bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Aa){switch(Aa.nextAddress){case 1:Array.isArray(sa)||(sa=[sa]),Ta=[],O=$jscomp.makeIterator(sa),
U=O.next();case 2:if(U.done){Aa.jumpTo(4);break}ra=U.value;return Aa.yield(Bb.forgetModule(ra,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return Aa.yield(Bb.resourceEnsureExistance(ra,'"format esm";\n'),6);case 6:return xa=Aa.yieldResult,pa=Xb,ea=pa.isTestModule,Aa.yield(xa.read(),7);case 7:if(!ea.call(pa,Aa.yieldResult)){Aa.jumpTo(8);break}if(window.Mocha&&window.chai){Aa.jumpTo(8);break}return Aa.yield(System.import("mocha-es6"),10);case 10:return Aa.yield(Xb.promise.waitFor(function(){return!!window.Mocha&&
!!window.chai}),8);case 8:return Aa.setCatchFinallyBlocks(12),Aa.yield(Bb.importModule(ra),14);case 14:Ta.push({name:ra});Aa.leaveTryBlock(3);break;case 12:bb=Aa.enterCatchBlock(),Ta.push({name:ra,error:bb});case 3:U=O.next();Aa.jumpTo(2);break;case 4:return Aa.return(Ta)}})};Xb.modulesInPackage_defaultExclude=function(Bb){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(Bb.name())?!0:!1};Xb.modulesInPackage=Xa;Xb.obj=tb;Xb.promise=Fc;Xb.arr=mb;Xb.resource=Pb;Xb.isTestModule=
td;Xb.isTestModule=td;Xb.shortModuleName=nb;Xb.shortModuleName=nb;Xb.interactivelyChangeModule=cc;Xb.interactivelyChangeModule=cc;Xb.interactivelyReloadModule=wc;Xb.interactivelyReloadModule=wc;Xb.interactivelyUnloadModule=dc;Xb.interactivelyUnloadModule=dc;Xb.interactivelyRemoveModule=Nc;Xb.interactivelyRemoveModule=Nc;Xb.interactivelyAddModule=$a;Xb.interactivelyAddModule=$a;Xb.modulesInPackage=Xa;Xb.modulesInPackage=Xa;var Fa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
Fa.todo=function(Bb){throw Error(Bb+" is not yet implemented!");};Fa.parseJsonLikeObj=xc;Fa.arr=mb;Fa.Closure=vc;Fa.obj=tb;Fa.resource=Pb;Fa.transform=Qc;Fa.modules=mc;var sb=function(Bb){var sa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),Ta=sa.hasOwnProperty("AbstractCoreInterface")&&"function"===typeof sa.AbstractCoreInterface?sa.AbstractCoreInterface:sa.AbstractCoreInterface=function(O){O&&O[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return ic(Ta,Bb,[{key:"dynamicCompletionsForPrefix",value:function(O,U,ra){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){Fa.todo("dynamicCompletionsForPrefix");xa.jumpToEnd()})}},{key:"runEval",value:function(O,U){Fa.todo("runEval")}},{key:"resourceExists",value:function(O){Fa.todo("resourceExists")}},{key:"resourceEnsureExistance",value:function(O,U){Fa.todo("resourceEnsureExistance")}},{key:"resourceMkdir",value:function(O){Fa.todo("resourceMkdir")}},{key:"resourceRead",
value:function(O){Fa.todo("resourceRead")}},{key:"resourceRemove",value:function(O){Fa.todo("resourceRemove")}},{key:"resourceWrite",value:function(O,U){Fa.todo("resourceWrite")}},{key:"resourceCreateFiles",value:function(O,U){Fa.todo("resourceCreateFiles")}},{key:"resourceDirList",value:function(O,U,ra){Fa.todo("resourceDirList")}},{key:"normalizeSync",value:function(O,U,ra){Fa.todo("normalizeSync")}},{key:"normalize",value:function(O,U,ra){Fa.todo("normalize")}},{key:"printSystemConfig",value:function(){Fa.todo("printSystemConfig")}},
{key:"getConfig",value:function(){Fa.todo("getConfig")}},{key:"setConfig",value:function(O){Fa.todo("setConfig")}},{key:"getPackages",value:function(O){Fa.todo("getPackages")}},{key:"isModuleLoaded",value:function(O,U){Fa.todo("isModuleLoaded")}},{key:"doesModuleExist",value:function(O,U){Fa.todo("doesModuleExist")}},{key:"getModules",value:function(){var O=this,U,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return 1==xa.nextAddress?(U=Fa.arr,ra=U.flatmap,xa.yield(O.getPackages(),
2)):xa.return(ra.call(U,xa.yieldResult,function(pa){return pa.modules}))})}},{key:"getModule",value:function(O){var U=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return 1==ra.nextAddress?ra.yield(U.getModules(),2):ra.return(ra.yieldResult.find(function(xa){return xa.name===O}))})}},{key:"getPackage",value:function(O){var U=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return 1==ra.nextAddress?(O=O.replace(/\/+$/,""),ra.yield(U.getPackages(),2)):ra.return(ra.yieldResult.find(function(xa){return xa.address===
O||xa.name===O}))})}},{key:"getPackageForModule",value:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){Fa.todo("getPackageForModule");U.jumpToEnd()})}},{key:"systemConfChange",value:function(O){var U=Fa.parseJsonLikeObj(O);["baseURL"].forEach(function(ra){return delete U[ra]});return this.setConfig(U)}},{key:"resourcesOfPackage",value:function(O,U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){Fa.todo("resourcesOfPackage");ra.jumpToEnd()})}},{key:"registerPackage",
value:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){Fa.todo("registerPackage");U.jumpToEnd()})}},{key:"importPackage",value:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){Fa.todo("importPackage");U.jumpToEnd()})}},{key:"removePackage",value:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){Fa.todo("removePackage");U.jumpToEnd()})}},{key:"reloadPackage",value:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){Fa.todo("reloadPackage");
U.jumpToEnd()})}},{key:"packageConfChange",value:function(O,U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){Fa.todo("packageConfChange");ra.jumpToEnd()})}},{key:"importModule",value:function(O){Fa.todo("importModule")}},{key:"forgetModule",value:function(O,U){Fa.todo("forgetModule")}},{key:"reloadModule",value:function(O,U){Fa.todo("reloadModule")}},{key:"moduleFormat",value:function(O){Fa.todo("moduleFormat")}},{key:"moduleRead",value:function(O){Fa.todo("moduleRead")}},{key:"moduleSourceChange",
value:function(O,U,ra){Fa.todo("moduleSourceChange")}},{key:"importsAndExportsOf",value:function(O,U){Fa.todo("importsAndExportsOf")}},{key:"keyValueListOfVariablesInModule",value:function(O,U){Fa.todo("keyValueListOfVariablesInModule")}},{key:"moduleWrite",value:function(O,U){return this.moduleSourceChange(O,U)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"AbstractCoreInterface"}}],sa,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:327,end:3944})}(void 0);Fa.AbstractCoreInterface=sb;Fa.AbstractCoreInterface=sb;Fa.AbstractCoreInterface=sb;var Ya=function(Bb){var sa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),Ta=sa.hasOwnProperty("RemoteCoreInterface")&&"function"===typeof sa.RemoteCoreInterface?sa.RemoteCoreInterface:sa.RemoteCoreInterface=
function(O){O&&O[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ic(Ta,Bb,[{key:Symbol.for("lively-instance-initialize"),value:function(){ic._get(Object.getPrototypeOf(Ta.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null}},{key:"runEval",value:function(O,U){throw Error("Not yet implemented");}},{key:"runEvalAndStringify",value:function(O,U){var ra=this;return this.currentEval?this.currentEval.then(function(){return ra.runEvalAndStringify(O,
U)}):this.currentEval=Promise.resolve().then(function(){var xa,pa,ea,bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Aa){switch(Aa.nextAddress){case 1:return Aa.yield(ra.runEval("\n        Promise.resolve((async "+Fa.transform.wrapInFunction(O)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},U)),2);case 2:if((xa=Aa.yieldResult)&&xa.isError)throw Error(String(xa.value||xa.error));if(!xa||!xa.value)return Aa.return(null);if(pa=xa.promisedValue){Aa.jumpTo(3);break}return Aa.yield(xa.value,4);case 4:pa=Aa.yieldResult;case 3:ea=pa;if(!ea)return Aa.return();if("undefined"===ea)return Aa.return(void 0);if("null"===ea)return Aa.return(null);if("true"===ea)return Aa.return(!0);
if("false"===ea)return Aa.return(!1);try{bb=JSON.parse(ea)}catch(Rb){return Aa.return(ea)}if(bb&&bb.isError)throw Error(String(bb.value));return Aa.return(bb)}})}).then(function(xa){delete ra.currentEval;return xa},function(xa){delete ra.currentEval;return Promise.reject(xa)})}},{key:"dynamicCompletionsForPrefix",value:function(O,U,ra){var xa=this,pa,ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bb){pa=Fa.obj.isString(ra.context)?ra.context:!1;ra=Fa.obj.dissoc(ra,["systemInterface",
"System","context"]);ea="\n      var prefix = "+JSON.stringify(U)+",\n          opts = "+JSON.stringify(ra)+";\n      opts.context = "+pa+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return bb.return(xa.runEvalAndStringify(ea))})}},{key:"evalWithResource",value:function(O,U,ra){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+O+'").'+U+"("+(ra?JSON.stringify(ra):"")+");\n    ")}},{key:"resourceExists",value:function(O){return this.evalWithResource(O,"exists")}},{key:"resourceEnsureExistance",value:function(O,U){return this.evalWithResource(O,
"ensureExistance",U)}},{key:"resourceMkdir",value:function(O){return this.evalWithResource(O,"mkdir")}},{key:"resourceRead",value:function(O){return this.evalWithResource(O,"read")}},{key:"resourceRemove",value:function(O){return this.evalWithResource(O,"remove")}},{key:"resourceWrite",value:function(O,U){return this.evalWithResource(O,"write",U)}},{key:"resourceCreateFiles",value:function(O,U){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
O+'", '+JSON.stringify(U)+")")}},{key:"resourceDirList",value:function(O,U,ra){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+O+'").dirList('+JSON.stringify(U)+", "+JSON.stringify(ra)+"))\n        .map(({url}) => ({url}))")}},{key:"livelySystemAccessor",value:function(O){O=void 0===O?"livelySystem":O;return"var "+O+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
O+') throw new Error("lively-system-interface not available!");'}},{key:"normalizeSync",value:function(O,U,ra){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(O)+", "+JSON.stringify(U)+", "+ra+")")}},{key:"normalize",value:function(O,U,ra){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(O)+", "+JSON.stringify(U)+", "+JSON.stringify(ra)+")")}},{key:"printSystemConfig",value:function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")}},
{key:"getConfig",value:function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')}},{key:"setConfig",value:function(O){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(O)+")")}},{key:"getPackages",value:function(O){O=Object.assign({excluded:[]},O);O.excluded=O.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(O)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')}},{key:"getPackageForModule",value:function(O){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(O)+")")}},{key:"isModuleLoaded",value:function(O,U){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+O+'", '+U+")")}},{key:"doesModuleExist",value:function(O,U){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+O+'", '+U+")")}},{key:"registerPackage",value:function(O){var U=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return ra.return(U.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(O)+")"))})}},{key:"importPackage",
value:function(O){var U=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return ra.return(U.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(O)+")"))})}},{key:"removePackage",value:function(O){var U=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return ra.return(U.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(O)+")"))})}},{key:"reloadPackage",value:function(O,U){var ra=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return xa.return(ra.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(O)+", "+JSON.stringify(U)+")"))})}},{key:"packageConfChange",value:function(O,U){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(O)+", "+JSON.stringify(U)+")")}},{key:"resourcesOfPackage",value:function(O,U){U=void 0===U?[".git","node_modules",".module_cache","lively.next-node_modules"]:U;var ra=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){O.address&&(O=O.address);
return xa.return(ra.runEvalAndStringify("\n      "+ra.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(O)+", "+JSON.stringify(U)+");"))})}},{key:"getModule",value:function(O){var U=this,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){if(1==xa.nextAddress)return xa.yield(U.getModules(),2);ra=xa.yieldResult.find(function(pa){return pa.name===O});return xa.return(ra?Fa.modules.module(ra.name):null)})}},{key:"importModule",value:function(O){return this.runEvalAndStringify("lively.modules.System.import("+
JSON.stringify(O)+")")}},{key:"forgetModule",value:function(O,U){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(O)+").unload("+JSON.stringify(U)+")")}},{key:"reloadModule",value:function(O,U){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(O)+").reload("+JSON.stringify(U)+")")}},{key:"moduleFormat",value:function(O){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(O)+").format();")}},{key:"moduleRead",value:function(O){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(O)+").source()")}},{key:"moduleSourceChange",value:function(O,U,ra){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(O)+").changeSource("+JSON.stringify(U)+", "+JSON.stringify(ra)+")")}},{key:"keyValueListOfVariablesInModule",value:function(O,U){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+JSON.stringify(O)+", "+JSON.stringify(U)+")")}},{key:"importsAndExportsOf",
value:function(O,U){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(O)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(O)+").exports()})")}},{key:"exportsOfModules",value:function(O){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(O)+";\n      options.excludedPackages = ["+O.excludedPackages.map(function(U){return"function"===typeof U?U.toString():JSON.stringify(U)}).join(",")+
"]\n      await livelySystem.localInterface.exportsOfModules(options)")}},{key:"searchInPackage",value:function(O,U,ra){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(O)+", "+JSON.stringify(U)+", "+JSON.stringify(ra)+")")}},{key:"loadMochaTestFile",value:function(O,U){U=void 0===U?[]:U;var ra=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return xa.return(ra.runEvalAndStringify("\n      "+
ra.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(O)+", "+JSON.stringify(U)+"), result;\n      result = {testsByFile}"))})}},{key:"runMochaTests",value:function(O,U,ra,xa){var pa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){O&&O instanceof RegExp&&(O={isRegExp:!0,value:String(O).replace(/^\/|\/$/g,"")});return ea.return(pa.runEvalAndStringify("\n      var grep = "+JSON.stringify(O)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
pa.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(U||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RemoteCoreInterface"}}],sa,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:3953,end:16249})}(Fa.AbstractCoreInterface);Fa.RemoteCoreInterface=Ya;Fa.RemoteCoreInterface=Ya;Fa.RemoteCoreInterface=Ya;var pb=
lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");pb.obj=tb;pb.string=zc;pb.arr=mb;pb.resource=Pb;pb.createFiles=Dc;pb.ast=cb;pb.modules=mc;pb.vm=Gd;pb.parseJsonLikeObj=xc;pb.AbstractCoreInterface=sb;pb.classToFunctionTransform=Hd;sb=function(Bb){var sa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js"),Ta=sa.hasOwnProperty("LocalCoreInterface")&&"function"===typeof sa.LocalCoreInterface?sa.LocalCoreInterface:sa.LocalCoreInterface=
function(O){O&&O[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ic(Ta,Bb,[{key:"name",get:function(){return"local"}},{key:"dynamicCompletionsForPrefix",value:function(O,U,ra){var xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pa){if(1==pa.nextAddress)return pa.yield(pb.vm.completions.getCompletions(function(ea){return pb.vm.runEval(ea.replace("return ",""),Object.assign({targetModule:O,classTransform:pb.classToFunctionTransform},
ra))},U),2);xa=pa.yieldResult;if(xa.isError)throw xa.value;return pa.return({completions:xa.completions,prefix:xa.startLetters})})}},{key:"runEval",value:function(O,U){return pb.vm.runEval(O,Object.assign({classTransform:pb.classToFunctionTransform},U))}},{key:"resourceExists",value:function(O){return pb.resource(O).exists()}},{key:"resourceEnsureExistance",value:function(O,U){return pb.resource(O).ensureExistance(U)}},{key:"resourceMkdir",value:function(O){return pb.resource(O).mkdir()}},{key:"resourceRead",
value:function(O){return pb.resource(O).read()}},{key:"resourceRemove",value:function(O){return pb.resource(O).remove()}},{key:"resourceWrite",value:function(O,U){return pb.resource(O).write(U)}},{key:"resourceCreateFiles",value:function(O,U){return pb.createFiles(O,U)}},{key:"resourceDirList",value:function(O,U,ra){return pb.resource(O).dirList(U,ra)}},{key:"normalizeSync",value:function(O,U,ra){return System.decanonicalize(O,U,ra)}},{key:"normalize",value:function(O,U,ra){return System.normalize(O,
U,ra)}},{key:"printSystemConfig",value:function(){return pb.modules.printSystemConfig()}},{key:"getConfig",value:function(){return System.getConfig()}},{key:"setConfig",value:function(O){pb.modules.System.config(O)}},{key:"getPackages",value:function(O){O=Object.assign({},O);O=void 0===O.excluded?[]:O.excluded;var U=O.filter(function(xa){return"string"===typeof xa}),ra=O.filter(function(xa){return"function"===typeof xa});U=U.concat(U.map(function(xa){return System.decanonicalize(xa.replace(/\/?$/,
"/")).replace(/\/$/,"")}));return pb.modules.getPackages().filter(function(xa){return!U.includes(xa.url)&&!ra.some(function(pa){return pa(xa.url)})})}},{key:"registerPackage",value:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){return U.return(pb.modules.registerPackage(O))})}},{key:"importPackage",value:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){return U.return(pb.modules.importPackage(O))})}},{key:"removePackage",value:function(O){return $jscomp.asyncExecutePromiseGeneratorProgram(function(U){return U.return(pb.modules.removePackage(O))})}},
{key:"reloadPackage",value:function(O,U){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return ra.return(pb.modules.reloadPackage(O,U))})}},{key:"packageConfChange",value:function(O,U){var ra=this,xa,pa,ea,bb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Aa){if(1==Aa.nextAddress)return xa=pb.modules.System,pa=pb.parseJsonLikeObj(O),ea=JSON.stringify(pa,null,2),Aa.yield(pb.modules.module(U).changeSource(ea,{doEval:!1}),2);if(3!=Aa.nextAddress)return xa.set(U,xa.newModule(pa)),
Aa.yield(ra.getPackageForModule(U),3);(bb=Aa.yieldResult)&&pb.modules.applyPackageConfig(pa,bb.address);Aa.jumpToEnd()})}},{key:"resourcesOfPackage",value:function(O,U){U=void 0===U?[".git","node_modules",".module_cache"]:U;var ra,xa,pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){if(1==ea.nextAddress)return ea.setCatchFinallyBlocks(2),ra=O.address?O.address:O,xa=pb.modules.getPackage(ra),ea.yield(xa.resources(void 0,U),4);if(2!=ea.nextAddress)return ea.return(ea.yieldResult.map(function(bb){return Object.assign(bb,
{package:bb.package.url})}));pa=ea.enterCatchBlock();console.warn("resourcesOfPackage error for "+O+": "+pa);return ea.return([])})}},{key:"getPackageForModule",value:function(O){return(O=pb.modules.getPackageOfModule(O))?O.asSpec():O}},{key:"isModuleLoaded",value:function(O,U){return pb.modules.isModuleLoaded(O,U)}},{key:"doesModuleExist",value:function(O,U){return pb.modules.isModuleLoaded(O,U)}},{key:"getModule",value:function(O){return pb.modules.module(O)}},{key:"importModule",value:function(O){return pb.modules.System.import(O)}},
{key:"forgetModule",value:function(O,U){return pb.modules.module(O).unload(U)}},{key:"reloadModule",value:function(O,U){return pb.modules.module(O).reload(U)}},{key:"moduleFormat",value:function(O){return pb.modules.module(O).format()}},{key:"moduleRead",value:function(O){return pb.modules.module(O).source()}},{key:"moduleSourceChange",value:function(O,U,ra){return pb.modules.module(O).changeSource(U,ra)}},{key:"keyValueListOfVariablesInModule",value:function(O,U){var ra=this,xa,pa,ea,bb,Aa,Rb,Gc,
Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){switch(Hc.nextAddress){case 1:if(U){Hc.jumpTo(2);break}return Hc.yield(ra.resourceRead(O),3);case 3:U=Hc.yieldResult;case 2:return xa="string"===typeof U?pb.ast.parse(U):U,pa=ra.normalizeSync(O),ra.moduleFormat(pa),ea=pb.modules.module(pa).env().recorder,Hc.yield(ra.importsAndExportsOf(pa,xa),4);case 4:return bb=Hc.yieldResult,Aa=pb.ast.query.topLevelDeclsAndRefs(xa),Rb=pb.arr.sortByKey(pb.ast.query.declarationsOfScope(Aa.scope,!0),
"start"),Gc=pb.arr.pluck(Aa.scope.importSpecifiers,"name"),Ab=0,Hc.return(Rb.map(function(fb){var ud=fb.name.length,je=bb.exports.find(function(gb){return gb.local===fb.name}),rc=pb.arr.include(Gc,fb.name);je&&(ud+=9);rc&&(ud+=9);Ab=Math.max(Ab,ud);return{isExport:je,isImport:rc,name:fb.name,value:ea[fb.name],node:fb,printedName:fb.name+(je?" [export]":"")+(rc?" [import]":""),printedValue:pb.obj.inspect(ea[fb.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(fb){return{isListItem:!0,value:fb,
string:fb.printedName+pb.string.indent(" = "+fb.printedValue," ",Ab-fb.printedName.length)}}))}})}},{key:"importsAndExportsOf",value:function(O,U){var ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return 1==xa.nextAddress?xa.yield(pb.modules.module(O).imports(U),2):3!=xa.nextAddress?(ra=xa.yieldResult,xa.yield(pb.modules.module(O).exports(U),3)):xa.return({imports:ra,exports:xa.yieldResult})})}},{key:"exportsOfModules",value:function(O){return pb.modules.ExportLookup.run(System,
O)}},{key:"searchInPackage",value:function(O,U,ra){return pb.modules.getPackage(O).search(U,ra)}},{key:"runMochaTests",value:function(O,U,ra,xa){var pa,ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bb){if(1==bb.nextAddress)return bb.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);pa=bb.yieldResult;ea=pa.runMochaTests;return bb.return(ea(O,U,ra,xa))})}},{key:"loadMochaTestFile",value:function(O,U){var ra,xa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pa){if(1==
pa.nextAddress)return pa.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);ra=pa.yieldResult;xa=ra.loadMochaTestFile;return pa.return(xa(O,U))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LocalCoreInterface"}}],sa,{pathInPackage:function(){return"interfaces/local-system.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",
version:"0.2.1"}}},{start:411,end:8203})}(pb.AbstractCoreInterface);pb.LocalCoreInterface=sb;pb.LocalCoreInterface=sb;pb.LocalCoreInterface=sb;var $b=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");$b.evalStrategies=Zd;$b.RemoteCoreInterface=Ya;var lc=function(Bb){var sa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js"),Ta=sa.hasOwnProperty("HTTPCoreInterface")&&"function"===typeof sa.HTTPCoreInterface?sa.HTTPCoreInterface:
sa.HTTPCoreInterface=function(O){O&&O[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ic(Ta,Bb,[{key:Symbol.for("lively-instance-initialize"),value:function(O){ic._get(Object.getPrototypeOf(Ta.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null;this.url=O;this.server=new $b.evalStrategies.HttpEvalStrategy(O)}},{key:"name",get:function(){return this.url}},{key:"description",get:function(){return this.url.replace(/^https?:\/\//,
"")}},{key:"runEval",value:function(O,U){return this.server.runEval(O,U)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"HTTPCoreInterface"}}],sa,{pathInPackage:function(){return"interfaces/http-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:512})}($b.RemoteCoreInterface);$b.HTTPCoreInterface=
lc;$b.HTTPCoreInterface=lc;$b.HTTPCoreInterface=lc;var Jb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");Jb.evalStrategies=Zd;Jb.RemoteCoreInterface=Ya;Ya=function(Bb){var sa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js"),Ta=sa.hasOwnProperty("L2LCoreInterface")&&"function"===typeof sa.L2LCoreInterface?sa.L2LCoreInterface:sa.L2LCoreInterface=function(O){O&&O[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return ic(Ta,Bb,[{key:Symbol.for("lively-instance-initialize"),value:function(O,U){ic._get(Object.getPrototypeOf(Ta.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.targetId=O;this.peer=U}},{key:"name",get:function(){return"l2l "+this.targetId}},{key:"description",get:function(){var O=this.peer,U="l2l "+this.targetId.slice(0,5);if(O){var ra=O.location,xa=O.type,pa=O.user;O=O.world;xa&&(U+=", "+xa);ra&&(U+=", "+ra.replace(/^https?:\/\//,"")+(O?"/"+O:""));pa&&(U+=
", "+pa.name)}return U}},{key:"client",get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}},{key:"isConnected",value:function(){var O=this,U,ra,xa,pa,ea;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bb){if(1==bb.nextAddress)return U=O,ra=U.client,xa=U.targetId,bb.yield(ra.sendToAndWait(ra.trackerId,"getClients",{}),2);pa=bb.yieldResult;ea=pa.data;return bb.return(ea.some(function(Aa){Aa=$jscomp.makeIterator(Aa).next().value;
return xa===Aa}))})}},{key:"runEval",value:function(O,U){var ra=this,xa,pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ea){xa=ra.client;if(!xa)throw Error("No lively.2lively default client available!");pa=new Jb.evalStrategies.L2LEvalStrategy(xa,ra.targetId);return ea.return(pa.runEval(O,U))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"L2LCoreInterface"}}],sa,{pathInPackage:function(){return"interfaces/l2l-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:1449})}(Jb.RemoteCoreInterface);Jb.L2LCoreInterface=Ya;Jb.L2LCoreInterface=Ya;Jb.L2LCoreInterface=Ya;var Cb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Cb.systemInterfaceNamed=Gb;Cb.interactivelyCreatePackage=od;Cb.interactivelyLoadPackage=qb;Cb.interactivelyReloadPackage=kc;Cb.interactivelyUnloadPackage=Uc;Cb.interactivelyRemovePackage=
tc;Cb.showExportsAndImportsOf=cd;Cb.shortModuleName=nb;Cb.interactivelyChangeModule=cc;Cb.interactivelyReloadModule=wc;Cb.interactivelyUnloadModule=dc;Cb.interactivelyRemoveModule=Nc;Cb.interactivelyAddModule=$a;Cb.modulesInPackage=Xa;Cb.LocalCoreInterface=sb;Cb.HTTPCoreInterface=lc;Cb.L2LCoreInterface=Ya;Ya=za("Interface",function(Bb){var sa=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js"),Ta=sa.hasOwnProperty("Interface")&&"function"===typeof sa.Interface?sa.Interface:sa.Interface=
function(O){O&&O[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ic(Ta,Bb,[{key:Symbol.for("lively-instance-initialize"),value:function(O){this.coreInterface=O}},{key:"isSystemInterface",get:function(){return!0}},{key:"name",get:function(){return this.coreInterface.name}},{key:"dynamicCompletionsForPrefix",value:function(O,U,ra){return this.coreInterface.dynamicCompletionsForPrefix(O,U,ra)}},{key:"runEval",value:function(O,U){return this.coreInterface.runEval(O,
U)}},{key:"printSystemConfig",value:function(O,U,ra){return this.coreInterface.printSystemConfig(O,U,ra)}},{key:"getConfig",value:function(O,U,ra){return this.coreInterface.getConfig(O,U,ra)}},{key:"getPackages",value:function(O){return this.coreInterface.getPackages(O)}},{key:"getModules",value:function(O,U,ra){return this.coreInterface.getModules(O,U,ra)}},{key:"getModule",value:function(O,U,ra){return this.coreInterface.getModule(O,U,ra)}},{key:"getPackage",value:function(O,U,ra){return this.coreInterface.getPackage(O,
U,ra)}},{key:"getPackageForModule",value:function(O,U,ra){return this.coreInterface.getPackageForModule(O,U,ra)}},{key:"resourcesOfPackage",value:function(O,U){return this.coreInterface.resourcesOfPackage(O,U)}},{key:"systemConfChange",value:function(O,U,ra){return this.coreInterface.systemConfChange(O,U,ra)}},{key:"registerPackage",value:function(O){return this.coreInterface.registerPackage(O)}},{key:"importPackage",value:function(O){return this.coreInterface.importPackage(O)}},{key:"removePackage",
value:function(O){return this.coreInterface.removePackage(O)}},{key:"reloadPackage",value:function(O){return this.coreInterface.reloadPackage(O)}},{key:"packageConfChange",value:function(O,U){return this.coreInterface.packageConfChange(O,U)}},{key:"keyValueListOfVariablesInModule",value:function(O,U){return this.coreInterface.keyValueListOfVariablesInModule(O,U)}},{key:"interactivelyCreatePackage",value:function(O){return Cb.interactivelyCreatePackage(this.coreInterface,O)}},{key:"interactivelyLoadPackage",
value:function(O,U){return Cb.interactivelyLoadPackage(this.coreInterface,O,U)}},{key:"interactivelyReloadPackage",value:function(O,U){return Cb.interactivelyReloadPackage(this.coreInterface,O,U)}},{key:"interactivelyUnloadPackage",value:function(O,U,ra){return Cb.interactivelyUnloadPackage(this.coreInterface,O,U,ra)}},{key:"interactivelyRemovePackage",value:function(O,U){return Cb.interactivelyRemovePackage(this.coreInterface,O,U)}},{key:"isModuleLoaded",value:function(O,U){return this.coreInterface.isModuleLoaded(O,
U)}},{key:"doesModuleExist",value:function(O,U){return this.coreInterface.doesModuleExist(O,U)}},{key:"importModule",value:function(O){return this.coreInterface.importModule(O)}},{key:"forgetModule",value:function(O,U){return this.coreInterface.forgetModule(O,U)}},{key:"reloadModule",value:function(O,U){return this.coreInterface.reloadModule(O,U)}},{key:"moduleFormat",value:function(O){return this.coreInterface.moduleFormat(O)}},{key:"moduleRead",value:function(O){return this.coreInterface.moduleRead(O)}},
{key:"moduleWrite",value:function(O,U){return this.coreInterface.moduleWrite(O,U)}},{key:"getModulesInPackage",value:function(O){return Cb.modulesInPackage(this.coreInterface,O)}},{key:"shortModuleName",value:function(O,U){return Cb.shortModuleName(this.coreInterface,O,U)}},{key:"interactivelyChangeModule",value:function(O,U,ra){return Cb.interactivelyChangeModule(this.coreInterface,O,U,ra)}},{key:"interactivelyReloadModule",value:function(O,U){return Cb.interactivelyReloadModule(this.coreInterface,
O,U)}},{key:"interactivelyUnloadModule",value:function(O,U){return Cb.interactivelyUnloadModule(this.coreInterface,O,U)}},{key:"interactivelyRemoveModule",value:function(O,U){return Cb.interactivelyRemoveModule(this.coreInterface,O,U)}},{key:"interactivelyAddModule",value:function(O,U){return Cb.interactivelyAddModule(this.coreInterface,O,U)}},{key:"showExportsAndImportsOf",value:function(O,U){return Cb.showExportsAndImportsOf(this.coreInterface,O,U)}},{key:"exportsOfModules",value:function(O){return this.coreInterface.exportsOfModules(O)}},
{key:"searchInPackage",value:function(O,U,ra){return this.coreInterface.searchInPackage(O,U,ra)}},{key:"searchInAllPackages",value:function(O,U){U=void 0===U?{}:U;var ra=this,xa,pa,ea,bb,Aa,Rb,Gc,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){switch(Hc.nextAddress){case 1:return(xa=U.progress)&&xa.step("Fetching Packages...",0),Hc.yield(ra.coreInterface.getPackages({excluded:U.excludedPackages}),2);case 2:pa=Hc.yieldResult,ea=[],xa&&xa.step("Fetching Packages...",.1),bb=0;case 3:if(!(bb<
pa.length)){Hc.jumpTo(5);break}Aa=pa[bb];Rb=Aa.url;if(!Rb||"no group"===Rb){Hc.jumpTo(4);break}xa&&xa.step(Rb.replace(System.baseURL,"").slice(0,20),.1+bb/pa.length*.9);Hc.setCatchFinallyBlocks(6);return Hc.yield(ra.coreInterface.searchInPackage(Rb,O,U),8);case 8:Gc=Hc.yieldResult;ea=ea.concat(Gc);Hc.leaveTryBlock(4);break;case 6:Ab=Hc.enterCatchBlock(),console.error("Error searching in package "+Rb+":\n"+Ab.stack);case 4:bb++;Hc.jumpTo(3);break;case 5:return Hc.return(ea)}})}},{key:"loadMochaTestFile",
value:function(O,U){return this.coreInterface.loadMochaTestFile(O,U)}},{key:"runMochaTests",value:function(O,U,ra,xa){return this.coreInterface.runMochaTests(O,U,ra,xa)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Interface"}}],sa,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},
{start:668,end:6107})}(void 0));Cb.Interface=Ya;Cb.Interface=Ya;Cb.Interface=Ya;Cb.systemInterfaceNamed=Gb;Cb.systemInterfaceNamed=Gb;Ya=za("localInterface",new Cb.Interface(new Cb.LocalCoreInterface));Cb.localInterface=Ya;Cb.localInterface=Ya;Cb.localInterface=Ya;Cb.httpInterfaces={};Ya=za("serverInterfaceFor",function(Bb){return Cb.httpInterfaces[Bb]||(Cb.httpInterfaces[Bb]=new Cb.Interface(new Cb.HTTPCoreInterface(Bb)))});Cb.serverInterfaceFor=Ya;Cb.serverInterfaceFor=Ya;Cb.serverInterfaceFor=
Ya;Cb.l2lInterfaces={};Ya=za("l2lInterfaceFor",function(Bb,sa){return Cb.l2lInterfaces[Bb]||(Cb.l2lInterfaces[Bb]=new Cb.Interface(new Cb.L2LCoreInterface(Bb,sa)))});Cb.l2lInterfaceFor=Ya;Cb.l2lInterfaceFor=Ya;Cb.l2lInterfaceFor=Ya}}});