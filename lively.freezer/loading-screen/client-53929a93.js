System.register(["./__root_module__-11543d52.js","kld-intersections"],function(sa){var lb,Eb,Vb,Wb,qd,Ec,vd,Ic;return{setters:[function(Jc){lb=Jc.s;Eb=Jc._;Vb=Jc.bi;Wb=Jc.bj;qd=Jc.ar;Ec=Jc.a5;vd=Jc.bk;Ic=Jc.an},function(){}],execute:function(){function Jc(){function pa(ab,mb){var ic={};mb.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Nc,Lc,Xb){Lc&&(ic[Lc]=Xb)});return ic}if($a)return nc;$a=!0;var eb=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
nb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return nc=function(ab){var mb=ab,ic=ab.indexOf("["),Nc=ab.indexOf("]");-1!=ic&&-1!=Nc&&(ab=ab.substring(0,ic)+ab.substring(ic,Nc).replace(/:/g,";")+ab.substring(Nc,ab.length));var Lc=eb.exec(ab||"");ab={};for(var Xb=14;Xb--;)ab[nb[Xb]]=Lc[Xb]||"";-1!=ic&&-1!=Nc&&(ab.source=mb,ab.host=ab.host.substring(1,ab.host.length-1).replace(/;/g,":"),ab.authority=ab.authority.replace("[","").replace("]",
"").replace(/;/g,":"),ab.ipv6uri=!0);mb=ab.path;ic=mb.replace(/\/{2,9}/g,"/").split("/");"/"!=mb.substr(0,1)&&0!==mb.length||ic.splice(0,1);"/"==mb.substr(mb.length-1,1)&&ic.splice(ic.length-1,1);ab.pathNames=ic;ab.queryKey=pa(ab,ab.query);return ab}}function Zc(){function pa(mb){mb=String(mb);if(!(100<mb.length)&&(mb=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(mb))){var ic=parseFloat(mb[1]);switch((mb[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return ic*
ab;case "days":case "day":case "d":return ic*nb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*ic;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*ic;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*ic;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return ic}}}function eb(mb,ic,Nc){if(!(mb<ic))return mb<1.5*ic?Math.floor(mb/ic)+" "+Nc:Math.ceil(mb/ic)+" "+Nc+"s"}if(Oa)return Pa;Oa=!0;var nb=864E5,ab=365.25*
nb;return Pa=function(mb,ic){ic=ic||{};var Nc=typeof mb;if("string"===Nc&&0<mb.length)return pa(mb);if("number"===Nc&&!1===isNaN(mb))return ic.long?eb(mb,nb,"day")||eb(mb,36E5,"hour")||eb(mb,6E4,"minute")||eb(mb,1E3,"second")||mb+" ms":mb>=nb?Math.round(mb/nb)+"d":36E5<=mb?Math.round(mb/36E5)+"h":6E4<=mb?Math.round(mb/6E4)+"m":1E3<=mb?Math.round(mb/1E3)+"s":mb+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(mb));}}function $c(){function pa(ab){var mb=0,ic;for(ic in ab)mb=
(mb<<5)-mb+ab.charCodeAt(ic),mb|=0;return Kb.colors[Math.abs(mb)%Kb.colors.length]}function eb(ab){function mb(){if(mb.enabled){var Nc=+new Date;mb.diff=Nc-(ic||Nc);mb.prev=ic;ic=mb.curr=Nc;var Lc=Array(arguments.length);for(Nc=0;Nc<Lc.length;Nc++)Lc[Nc]=arguments[Nc];Lc[0]=Kb.coerce(Lc[0]);"string"!==typeof Lc[0]&&Lc.unshift("%O");var Xb=0;Lc[0]=Lc[0].replace(/%([a-zA-Z%])/g,function(Rb,tc){if("%%"===Rb)return Rb;Xb++;tc=Kb.formatters[tc];"function"===typeof tc&&(Rb=tc.call(mb,Lc[Xb]),Lc.splice(Xb,
1),Xb--);return Rb});Kb.formatArgs.call(mb,Lc);(mb.log||Kb.log||console.log.bind(console)).apply(mb,Lc)}}var ic;mb.namespace=ab;mb.enabled=Kb.enabled(ab);mb.useColors=Kb.useColors();mb.color=pa(ab);mb.destroy=nb;"function"===typeof Kb.init&&Kb.init(mb);Kb.instances.push(mb);return mb}function nb(){var ab=Kb.instances.indexOf(this||cd);return-1!==ab?(Kb.instances.splice(ab,1),!0):!1}if(Ib)return Kb;Ib=!0;Kb=Kb=eb.debug=eb["default"]=eb;Kb.coerce=function(ab){return ab instanceof Error?ab.stack||ab.message:
ab};Kb.disable=function(){Kb.enable("")};Kb.enable=function(ab){Kb.save(ab);Kb.names=[];Kb.skips=[];var mb,ic=("string"===typeof ab?ab:"").split(/[\s,]+/),Nc=ic.length;for(mb=0;mb<Nc;mb++)ic[mb]&&(ab=ic[mb].replace(/\*/g,".*?"),"-"===ab[0]?Kb.skips.push(new RegExp("^"+ab.substr(1)+"$")):Kb.names.push(new RegExp("^"+ab+"$")));for(mb=0;mb<Kb.instances.length;mb++)ab=Kb.instances[mb],ab.enabled=Kb.enabled(ab.namespace)};Kb.enabled=function(ab){if("*"===ab[ab.length-1])return!0;var mb;var ic=0;for(mb=
Kb.skips.length;ic<mb;ic++)if(Kb.skips[ic].test(ab))return!1;ic=0;for(mb=Kb.names.length;ic<mb;ic++)if(Kb.names[ic].test(ab))return!0;return!1};Kb.humanize=Zc();Kb.instances=[];Kb.names=[];Kb.skips=[];Kb.formatters={};return Kb}function Fd(){function pa(){try{var mb=Od.storage.debug}catch(ic){}!mb&&"undefined"!==typeof eb&&"env"in eb&&(mb=eb.env.DEBUG);return mb}if(Zd)return Od;Zd=!0;var eb=Vb;Od=Od=$c();Od.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};Od.formatArgs=function(mb){var ic=(this||Te).useColors;mb[0]=(ic?"%c":"")+(this||Te).namespace+(ic?" %c":" ")+mb[0]+(ic?"%c ":" ")+"+"+Od.humanize((this||Te).diff);if(ic){ic="color: "+(this||Te).color;mb.splice(1,0,ic,"color: inherit");var Nc=0,Lc=0;mb[0].replace(/%[a-zA-Z%]/g,function(Xb){"%%"!==Xb&&(Nc++,"%c"===Xb&&(Lc=Nc))});mb.splice(Lc,0,ic)}};Od.save=function(mb){try{null==mb?Od.storage.removeItem("debug"):Od.storage.debug=mb}catch(ic){}};Od.load=pa;Od.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var nb=Od;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var ab=chrome.storage.local;else a:{try{ab=window.localStorage;break a}catch(mb){}ab=void 0}nb.storage=ab;Od.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
Od.formatters.j=function(mb){try{return JSON.stringify(mb)}catch(ic){return"[UnexpectedJSONParseError]: "+ic.message}};Od.enable(pa());return Od}function md(){if(Xd)return Qc;Xd=!0;var pa=Jc(),eb=Fd()("socket.io-client:url");return Qc=function(nb,ab){var mb=nb;ab=ab||"undefined"!==typeof location&&location;null==nb&&(nb=ab.protocol+"//"+ab.host);"string"===typeof nb&&("/"===nb.charAt(0)&&(nb="/"===nb.charAt(1)?ab.protocol+nb:ab.host+nb),/^(https?|wss?):\/\//.test(nb)||(eb("protocol-less url %s",nb),
nb="undefined"!==typeof ab?ab.protocol+"//"+nb:"https://"+nb),eb("parse %s",nb),mb=pa(nb));mb.port||(/^(http|ws)$/.test(mb.protocol)?mb.port="80":/^(http|ws)s$/.test(mb.protocol)&&(mb.port="443"));mb.path=mb.path||"/";nb=-1!==mb.host.indexOf(":")?"["+mb.host+"]":mb.host;mb.id=mb.protocol+"://"+nb+":"+mb.port;mb.href=mb.protocol+"://"+nb+(ab&&ab.port===mb.port?"":":"+mb.port);return mb}}function Vc(){function pa(eb){if(eb){for(var nb in pa.prototype)eb[nb]=pa.prototype[nb];return eb}}if(Ab)return kd;
Ab=!0;kd=pa;pa.prototype.on=pa.prototype.addEventListener=function(eb,nb){(this||da)._callbacks=(this||da)._callbacks||{};((this||da)._callbacks["$"+eb]=(this||da)._callbacks["$"+eb]||[]).push(nb);return this||da};pa.prototype.once=function(eb,nb){function ab(){this.off(eb,ab);nb.apply(this||da,arguments)}ab.fn=nb;this.on(eb,ab);return this||da};pa.prototype.off=pa.prototype.removeListener=pa.prototype.removeAllListeners=pa.prototype.removeEventListener=function(eb,nb){(this||da)._callbacks=(this||
da)._callbacks||{};if(0==arguments.length)return(this||da)._callbacks={},this||da;var ab=(this||da)._callbacks["$"+eb];if(!ab)return this||da;if(1==arguments.length)return delete (this||da)._callbacks["$"+eb],this||da;for(var mb,ic=0;ic<ab.length;ic++)if(mb=ab[ic],mb===nb||mb.fn===nb){ab.splice(ic,1);break}0===ab.length&&delete (this||da)._callbacks["$"+eb];return this||da};pa.prototype.emit=function(eb){(this||da)._callbacks=(this||da)._callbacks||{};for(var nb=Array(arguments.length-1),ab=(this||
da)._callbacks["$"+eb],mb=1;mb<arguments.length;mb++)nb[mb-1]=arguments[mb];if(ab){ab=ab.slice(0);mb=0;for(var ic=ab.length;mb<ic;++mb)ab[mb].apply(this||da,nb)}return this||da};pa.prototype.listeners=function(eb){(this||da)._callbacks=(this||da)._callbacks||{};return(this||da)._callbacks["$"+eb]||[]};pa.prototype.hasListeners=function(eb){return!!this.listeners(eb).length};return kd}function Ra(){if(ub)return qa;ub=!0;var pa={}.toString;return qa=Array.isArray||function(eb){return"[object Array]"==
pa.call(eb)}}function tb(){if(ia)return H;ia=!0;var pa=Wb.Buffer;H=function(ab){var mb;!(mb=eb&&pa.isBuffer(ab))&&(mb=nb)&&((mb=ab instanceof ArrayBuffer)||(mb="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(ab):ab.buffer instanceof ArrayBuffer));return mb};var eb="function"===typeof pa&&"function"===typeof pa.isBuffer,nb="function"===typeof ArrayBuffer;return H}function dc(){function pa(Lc,Xb){if(!Lc)return Lc;if(ab(Lc)){var Rb={_placeholder:!0,num:Xb.length};Xb.push(Lc);return Rb}if(nb(Lc)){Rb=
Array(Lc.length);for(var tc=0;tc<Lc.length;tc++)Rb[tc]=pa(Lc[tc],Xb);return Rb}if("object"===typeof Lc&&!(Lc instanceof Date)){Rb={};for(tc in Lc)Rb[tc]=pa(Lc[tc],Xb);return Rb}return Lc}function eb(Lc,Xb){if(!Lc)return Lc;if(Lc&&Lc._placeholder)return Xb[Lc.num];if(nb(Lc))for(var Rb=0;Rb<Lc.length;Rb++)Lc[Rb]=eb(Lc[Rb],Xb);else if("object"===typeof Lc)for(Rb in Lc)Lc[Rb]=eb(Lc[Rb],Xb);return Lc}if(rb)return Ba;rb=!0;var nb=Ra(),ab=tb(),mb=Object.prototype.toString,ic="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===mb.call(Blob),Nc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===mb.call(File);Ba.deconstructPacket=function(Lc){var Xb=[];Lc.data=pa(Lc.data,Xb);Lc.attachments=Xb.length;return{packet:Lc,buffers:Xb}};Ba.reconstructPacket=function(Lc,Xb){Lc.data=eb(Lc.data,Xb);Lc.attachments=void 0;return Lc};Ba.removeBlobs=function(Lc,Xb){function Rb(Gc,Cd,fe){if(!Gc)return Gc;if(ic&&Gc instanceof Blob||Nc&&Gc instanceof File){tc++;var rd=
new FileReader;rd.onload=function(){fe?fe[Cd]=(this||sc).result:gb=(this||sc).result;--tc||Xb(gb)};rd.readAsArrayBuffer(Gc)}else if(nb(Gc))for(rd=0;rd<Gc.length;rd++)Rb(Gc[rd],rd,Gc);else if("object"===typeof Gc&&!ab(Gc))for(rd in Gc)Rb(Gc[rd],rd,Gc)}var tc=0,gb=Lc;Rb(gb);tc||Xb(gb)};return Ba}function bc(){function pa(){}function eb(gb){var Gc=""+gb.type;if(yc.BINARY_EVENT===gb.type||yc.BINARY_ACK===gb.type)Gc+=gb.attachments+"-";gb.nsp&&"/"!==gb.nsp&&(Gc+=gb.nsp+",");null!=gb.id&&(Gc+=gb.id);if(null!=
gb.data){try{var Cd=JSON.stringify(gb.data)}catch(fe){Cd=!1}if(!1!==Cd)Gc+=Cd;else return tc}ic("encoded %j as %s",gb,Gc);return Gc}function nb(gb,Gc){Lc.removeBlobs(gb,function(Cd){var fe=Lc.deconstructPacket(Cd);Cd=eb(fe.packet);fe=fe.buffers;fe.unshift(Cd);Gc(fe)})}function ab(){(this||Ld).reconstructor=null}function mb(gb){(this||Ld).reconPack=gb;(this||Ld).buffers=[]}if(Gd)return yc;Gd=!0;var ic=Fd()("socket.io-parser"),Nc=Vc(),Lc=dc(),Xb=Ra(),Rb=tb();yc.protocol=4;yc.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
yc.CONNECT=0;yc.DISCONNECT=1;yc.EVENT=2;yc.ACK=3;yc.ERROR=4;yc.BINARY_EVENT=5;yc.BINARY_ACK=6;yc.Encoder=pa;yc.Decoder=ab;var tc=yc.ERROR+'"encode error"';pa.prototype.encode=function(gb,Gc){ic("encoding packet %j",gb);yc.BINARY_EVENT===gb.type||yc.BINARY_ACK===gb.type?nb(gb,Gc):(gb=eb(gb),Gc([gb]))};Nc(ab.prototype);ab.prototype.add=function(gb){if("string"===typeof gb){a:{var Gc=0,Cd={type:Number(gb.charAt(0))};if(null==yc.types[Cd.type])gb={type:yc.ERROR,data:"parser error: unknown packet type "+
Cd.type};else{if(yc.BINARY_EVENT===Cd.type||yc.BINARY_ACK===Cd.type){for(var fe="";"-"!==gb.charAt(++Gc)&&(fe+=gb.charAt(Gc),Gc!=gb.length););if(fe!=Number(fe)||"-"!==gb.charAt(Gc))throw Error("Illegal attachments");Cd.attachments=Number(fe)}if("/"===gb.charAt(Gc+1))for(Cd.nsp="";++Gc;){fe=gb.charAt(Gc);if(","===fe)break;Cd.nsp+=fe;if(Gc===gb.length)break}else Cd.nsp="/";fe=gb.charAt(Gc+1);if(""!==fe&&Number(fe)==fe){for(Cd.id="";++Gc;){fe=gb.charAt(Gc);if(null==fe||Number(fe)!=fe){--Gc;break}Cd.id+=
gb.charAt(Gc);if(Gc===gb.length)break}Cd.id=Number(Cd.id)}if(gb.charAt(++Gc)){Gc=gb.substr(Gc);try{var rd=JSON.parse(Gc)}catch(ge){rd=!1}if(!1===rd||Cd.type!==yc.ERROR&&!Xb(rd)){gb={type:yc.ERROR,data:"parser error: invalid payload"};break a}else Cd.data=rd}ic("decoded %s as %j",gb,Cd);gb=Cd}}yc.BINARY_EVENT===gb.type||yc.BINARY_ACK===gb.type?((this||Ld).reconstructor=new mb(gb),0===(this||Ld).reconstructor.reconPack.attachments&&this.emit("decoded",gb)):this.emit("decoded",gb)}else if(Rb(gb)||gb.base64)if((this||
Ld).reconstructor){if(gb=(this||Ld).reconstructor.takeBinaryData(gb))(this||Ld).reconstructor=null,this.emit("decoded",gb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+gb);};ab.prototype.destroy=function(){(this||Ld).reconstructor&&(this||Ld).reconstructor.finishedReconstruction()};mb.prototype.takeBinaryData=function(gb){(this||Ld).buffers.push(gb);return(this||Ld).buffers.length===(this||Ld).reconPack.attachments?(gb=Lc.reconstructPacket((this||
Ld).reconPack,(this||Ld).buffers),this.finishedReconstruction(),gb):null};mb.prototype.finishedReconstruction=function(){(this||Ld).reconPack=null;(this||Ld).buffers=[]};return yc}function Yc(){if(ze)return Md;ze=!0;return Md="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function Oc(){if(yf)return Ne;yf=!0;if(!id){id=!0;try{Ke="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(nb){Ke=!1}}var pa=Ke;var eb=Yc();return Ne=function(nb){var ab=
nb.xdomain,mb=nb.xscheme;nb=nb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!ab||pa))return new XMLHttpRequest}catch(ic){}try{if("undefined"!==typeof XDomainRequest&&!mb&&nb)return new XDomainRequest}catch(ic){}if(!ab)try{return new (eb[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(ic){}}}function $b(){if(vc)return tf;vc=!0;return tf=Object.keys||function(pa){var eb=[],nb=Object.prototype.hasOwnProperty,ab;for(ab in pa)nb.call(pa,ab)&&eb.push(ab);return eb}}function zc(){function pa(Nc){if(!Nc||
"object"!==typeof Nc)return!1;if(nb(Nc)){for(var Lc=0,Xb=Nc.length;Lc<Xb;Lc++)if(pa(Nc[Lc]))return!0;return!1}if("function"===typeof eb&&eb.isBuffer&&eb.isBuffer(Nc)||"function"===typeof ArrayBuffer&&Nc instanceof ArrayBuffer||mb&&Nc instanceof Blob||ic&&Nc instanceof File)return!0;if(Nc.toJSON&&"function"===typeof Nc.toJSON&&1===arguments.length)return pa(Nc.toJSON(),!0);for(Lc in Nc)if(Object.prototype.hasOwnProperty.call(Nc,Lc)&&pa(Nc[Lc]))return!0;return!1}if(mf)return Fe;mf=!0;var eb=Wb.Buffer,
nb=Ra(),ab=Object.prototype.toString,mb="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===ab.call(Blob),ic="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===ab.call(File);return Fe=pa}function Fb(){if(ye)return Jf;ye=!0;return Jf=function(pa,eb,nb){var ab=pa.byteLength;eb=eb||0;nb=nb||ab;if(pa.slice)return pa.slice(eb,nb);0>eb&&(eb+=ab);0>nb&&(nb+=ab);nb>ab&&(nb=ab);if(eb>=ab||eb>=nb||0===ab)return new ArrayBuffer(0);pa=new Uint8Array(pa);
ab=new Uint8Array(nb-eb);for(var mb=0;eb<nb;eb++,mb++)ab[mb]=pa[eb];return ab.buffer}}function Bb(){function pa(){}if(Ka)return va;Ka=!0;return va=function(eb,nb,ab){function mb(Nc,Lc){if(0>=mb.count)throw Error("after called too many times");--mb.count;Nc?(ic=!0,nb(Nc),nb=ab):0!==mb.count||ic||nb(null,Lc)}var ic=!1;ab=ab||pa;mb.count=eb;return 0===eb?nb():mb}}function pc(){function pa(Xb){for(var Rb=[],tc=0,gb=Xb.length,Gc,Cd;tc<gb;)Gc=Xb.charCodeAt(tc++),55296<=Gc&&56319>=Gc&&tc<gb?(Cd=Xb.charCodeAt(tc++),
56320==(Cd&64512)?Rb.push(((Gc&1023)<<10)+(Cd&1023)+65536):(Rb.push(Gc),tc--)):Rb.push(Gc);return Rb}function eb(Xb,Rb){if(55296<=Xb&&57343>=Xb){if(Rb)throw Error("Lone surrogate U+"+Xb.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function nb(){if(Lc>=Nc)throw Error("Invalid byte index");var Xb=ic[Lc]&255;Lc++;if(128==(Xb&192))return Xb&63;throw Error("Invalid continuation byte");}function ab(Xb){if(Lc>Nc)throw Error("Invalid byte index");if(Lc==Nc)return!1;var Rb=ic[Lc]&
255;Lc++;if(0==(Rb&128))return Rb;if(192==(Rb&224)){var tc=nb();Rb=(Rb&31)<<6|tc;if(128<=Rb)return Rb;throw Error("Invalid continuation byte");}if(224==(Rb&240)){tc=nb();var gb=nb();Rb=(Rb&15)<<12|tc<<6|gb;if(2048<=Rb)return eb(Rb,Xb)?Rb:65533;throw Error("Invalid continuation byte");}if(240==(Rb&248)&&(tc=nb(),gb=nb(),Xb=nb(),Rb=(Rb&7)<<18|tc<<12|gb<<6|Xb,65536<=Rb&&1114111>=Rb))return Rb;throw Error("Invalid UTF-8 detected");}if(Q)return sb;Q=!0;var mb=String.fromCharCode,ic,Nc,Lc;return sb={version:"2.1.2",
encode:function(Xb,Rb){Rb=Rb||{};Rb=!1!==Rb.strict;Xb=pa(Xb);for(var tc=Xb.length,gb=-1,Gc,Cd="";++gb<tc;){Gc=Xb[gb];var fe=Rb;if(0==(Gc&4294967168))Gc=mb(Gc);else{var rd="";0==(Gc&4294965248)?rd=mb(Gc>>6&31|192):0==(Gc&4294901760)?(eb(Gc,fe)||(Gc=65533),rd=mb(Gc>>12&15|224),rd+=mb(Gc>>6&63|128)):0==(Gc&4292870144)&&(rd=mb(Gc>>18&7|240),rd+=mb(Gc>>12&63|128),rd+=mb(Gc>>6&63|128));Gc=rd+=mb(Gc&63|128)}Cd+=Gc}return Cd},decode:function(Xb,Rb){Rb=Rb||{};Rb=!1!==Rb.strict;ic=pa(Xb);Nc=ic.length;Lc=0;
Xb=[];for(var tc;!1!==(tc=ab(Rb));)Xb.push(tc);Rb=Xb.length;tc=-1;for(var gb,Gc="";++tc<Rb;)gb=Xb[tc],65535<gb&&(gb-=65536,Gc+=mb(gb>>>10&1023|55296),gb=56320|gb&1023),Gc+=mb(gb);return Gc}}}function Pc(){if(Za)return ua;Za=!0;(function(pa){ua.encode=function(eb){eb=new Uint8Array(eb);var nb,ab=eb.length,mb="";for(nb=0;nb<ab;nb+=3)mb+=pa[eb[nb]>>2],mb+=pa[(eb[nb]&3)<<4|eb[nb+1]>>4],mb+=pa[(eb[nb+1]&15)<<2|eb[nb+2]>>6],mb+=pa[eb[nb+2]&63];2===ab%3?mb=mb.substring(0,mb.length-1)+"=":1===ab%3&&(mb=mb.substring(0,
mb.length-2)+"==");return mb};ua.decode=function(eb){var nb=.75*eb.length,ab=eb.length,mb=0;"="===eb[eb.length-1]&&(nb--,"="===eb[eb.length-2]&&nb--);var ic=new ArrayBuffer(nb),Nc=new Uint8Array(ic);for(nb=0;nb<ab;nb+=4){var Lc=pa.indexOf(eb[nb]);var Xb=pa.indexOf(eb[nb+1]);var Rb=pa.indexOf(eb[nb+2]);var tc=pa.indexOf(eb[nb+3]);Nc[mb++]=Lc<<2|Xb>>4;Nc[mb++]=(Xb&15)<<4|Rb>>2;Nc[mb++]=(Rb&3)<<6|tc&63}return ic}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return ua}function xb(){function pa(Lc){return Lc.map(function(Xb){if(Xb.buffer instanceof
ArrayBuffer){var Rb=Xb.buffer;if(Xb.byteLength!==Rb.byteLength){var tc=new Uint8Array(Xb.byteLength);tc.set(new Uint8Array(Rb,Xb.byteOffset,Xb.byteLength));Rb=tc.buffer}return Rb}return Xb})}function eb(Lc,Xb){Xb=Xb||{};var Rb=new ab;pa(Lc).forEach(function(tc){Rb.append(tc)});return Xb.type?Rb.getBlob(Xb.type):Rb.getBlob()}function nb(Lc,Xb){return new Blob(pa(Lc),Xb||{})}if(oc)return ib;oc=!0;var ab="undefined"!==typeof ab?ab:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var mb=2===(new Blob(["hi"])).size}catch(Lc){mb=!1}var ic;if(ic=mb)try{ic=2===(new Blob([new Uint8Array([1,2])])).size}catch(Lc){ic=!1}var Nc=ab&&ab.prototype.append&&ab.prototype.getBlob;"undefined"!==typeof Blob&&(eb.prototype=Blob.prototype,nb.prototype=Blob.prototype);ib=mb?ic?Blob:nb:Nc?eb:void 0;return ib}function db(){function pa(rd,ge,se){if(!ge)return cc.encodeBase64Packet(rd,se);var Se=new FileReader;
Se.onload=function(){cc.encodePacket({type:rd.type,data:Se.result},ge,!0,se)};return Se.readAsArrayBuffer(rd.data)}function eb(rd,ge,se){var Se=Array(rd.length);se=ic(rd.length,se);for(var Ue=function(eg,We,li){ge(We,function(ca,za){Se[eg]=za;li(ca,Se)})},Kf=0;Kf<rd.length;Kf++)Ue(Kf,rd[Kf],se)}if(bd)return cc;bd=!0;var nb=$b(),ab=zc(),mb=Fb(),ic=Bb(),Nc=pc(),Lc;"undefined"!==typeof ArrayBuffer&&(Lc=Pc());var Xb="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),Rb="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),tc=Xb||Rb;cc.protocol=3;var gb=cc.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},Gc=nb(gb),Cd={type:"error",data:"parser error"},fe=xb();cc.encodePacket=function(rd,ge,se,Se){"function"===typeof ge&&(Se=ge,ge=!1);"function"===typeof se&&(Se=se,se=null);var Ue=void 0===rd.data?void 0:rd.data.buffer||rd.data;if("undefined"!==typeof ArrayBuffer&&Ue instanceof ArrayBuffer){if(ge){se=rd.data;ge=new Uint8Array(se);se=new Uint8Array(1+
se.byteLength);se[0]=gb[rd.type];for(rd=0;rd<ge.length;rd++)se[rd+1]=ge[rd];rd=Se(se.buffer)}else rd=cc.encodeBase64Packet(rd,Se);return rd}if("undefined"!==typeof fe&&Ue instanceof fe)return ge?tc?rd=pa(rd,ge,Se):(ge=new Uint8Array(1),ge[0]=gb[rd.type],rd=new fe([ge.buffer,rd.data]),rd=Se(rd)):rd=cc.encodeBase64Packet(rd,Se),rd;if(Ue&&Ue.base64)return Se("b"+cc.packets[rd.type]+rd.data.data);ge=gb[rd.type];void 0!==rd.data&&(ge+=se?Nc.encode(String(rd.data),{strict:!1}):String(rd.data));return Se(""+
ge)};cc.encodeBase64Packet=function(rd,ge){var se="b"+cc.packets[rd.type];if("undefined"!==typeof fe&&rd.data instanceof fe){var Se=new FileReader;Se.onload=function(){var eg=Se.result.split(",")[1];ge(se+eg)};return Se.readAsDataURL(rd.data)}try{var Ue=String.fromCharCode.apply(null,new Uint8Array(rd.data))}catch(eg){rd=new Uint8Array(rd.data);Ue=Array(rd.length);for(var Kf=0;Kf<rd.length;Kf++)Ue[Kf]=rd[Kf];Ue=String.fromCharCode.apply(null,Ue)}se+=btoa(Ue);return ge(se)};cc.decodePacket=function(rd,
ge,se){if(void 0===rd)return Cd;if("string"===typeof rd){if("b"===rd.charAt(0))return cc.decodeBase64Packet(rd.substr(1),ge);if(se){a:{ge=rd;try{ge=Nc.decode(ge,{strict:!1})}catch(Se){rd=!1;break a}rd=ge}if(!1===rd)return Cd}se=rd.charAt(0);return Number(se)==se&&Gc[se]?1<rd.length?{type:Gc[se],data:rd.substring(1)}:{type:Gc[se]}:Cd}se=(new Uint8Array(rd))[0];rd=mb(rd,1);fe&&"blob"===ge&&(rd=new fe([rd]));return{type:Gc[se],data:rd}};cc.decodeBase64Packet=function(rd,ge){var se=Gc[rd.charAt(0)];if(!Lc)return{type:se,
data:{base64:!0,data:rd.substr(1)}};rd=Lc.decode(rd.substr(1));"blob"===ge&&fe&&(rd=new fe([rd]));return{type:se,data:rd}};cc.encodePayload=function(rd,ge,se){"function"===typeof ge&&(se=ge,ge=null);var Se=ab(rd);if(ge&&Se)return fe&&!tc?cc.encodePayloadAsBlob(rd,se):cc.encodePayloadAsArrayBuffer(rd,se);if(!rd.length)return se("0:");eb(rd,function(Ue,Kf){cc.encodePacket(Ue,Se?ge:!1,!1,function(eg){Kf(null,eg.length+":"+eg)})},function(Ue,Kf){return se(Kf.join(""))})};cc.decodePayload=function(rd,
ge,se){if("string"!==typeof rd)return cc.decodePayloadAsBinary(rd,ge,se);"function"===typeof ge&&(se=ge,ge=null);if(""===rd)return se(Cd,0,1);var Se="";for(var Ue,Kf,eg=0,We=rd.length;eg<We;eg++)if(Kf=rd.charAt(eg),":"!==Kf)Se+=Kf;else{if(""===Se||Se!=(Ue=Number(Se)))return se(Cd,0,1);Kf=rd.substr(eg+1,Ue);if(Se!=Kf.length)return se(Cd,0,1);if(Kf.length){Se=cc.decodePacket(Kf,ge,!1);if(Cd.type===Se.type&&Cd.data===Se.data)return se(Cd,0,1);if(!1===se(Se,eg+Ue,We))return}eg+=Ue;Se=""}if(""!==Se)return se(Cd,
0,1)};cc.encodePayloadAsArrayBuffer=function(rd,ge){if(!rd.length)return ge(new ArrayBuffer(0));eb(rd,function(se,Se){cc.encodePacket(se,!0,!0,function(Ue){return Se(null,Ue)})},function(se,Se){se=Se.reduce(function(eg,We){We="string"===typeof We?We.length:We.byteLength;return eg+We.toString().length+We+2},0);var Ue=new Uint8Array(se),Kf=0;Se.forEach(function(eg){var We="string"===typeof eg,li=eg;if(We){li=new Uint8Array(eg.length);for(var ca=0;ca<eg.length;ca++)li[ca]=eg.charCodeAt(ca);li=li.buffer}We?
Ue[Kf++]=0:Ue[Kf++]=1;eg=li.byteLength.toString();for(ca=0;ca<eg.length;ca++)Ue[Kf++]=parseInt(eg[ca]);Ue[Kf++]=255;li=new Uint8Array(li);for(ca=0;ca<li.length;ca++)Ue[Kf++]=li[ca]});return ge(Ue.buffer)})};cc.encodePayloadAsBlob=function(rd,ge){eb(rd,function(se,Se){cc.encodePacket(se,!0,!0,function(Ue){var Kf=new Uint8Array(1);Kf[0]=1;if("string"===typeof Ue){for(var eg=new Uint8Array(Ue.length),We=0;We<Ue.length;We++)eg[We]=Ue.charCodeAt(We);Ue=eg.buffer;Kf[0]=0}eg=(Ue instanceof ArrayBuffer?Ue.byteLength:
Ue.size).toString();var li=new Uint8Array(eg.length+1);for(We=0;We<eg.length;We++)li[We]=parseInt(eg[We]);li[eg.length]=255;fe&&(Ue=new fe([Kf.buffer,li.buffer,Ue]),Se(null,Ue))})},function(se,Se){return ge(new fe(Se))})};cc.decodePayloadAsBinary=function(rd,ge,se){"function"===typeof ge&&(se=ge,ge=null);for(var Se=[];0<rd.byteLength;){for(var Ue=new Uint8Array(rd),Kf=0===Ue[0],eg="",We=1;255!==Ue[We];We++){if(310<eg.length)return se(Cd,0,1);eg+=Ue[We]}rd=mb(rd,2+eg.length);eg=parseInt(eg);Ue=mb(rd,
0,eg);if(Kf)try{Ue=String.fromCharCode.apply(null,new Uint8Array(Ue))}catch(ca){for(Kf=new Uint8Array(Ue),Ue="",We=0;We<Kf.length;We++)Ue+=String.fromCharCode(Kf[We])}Se.push(Ue);rd=mb(rd,eg)}var li=Se.length;Se.forEach(function(ca,za){se(cc.decodePacket(ca,ge,!0),za,li)})};return cc}function Ta(){function pa(ab){(this||Yd).path=ab.path;(this||Yd).hostname=ab.hostname;(this||Yd).port=ab.port;(this||Yd).secure=ab.secure;(this||Yd).query=ab.query;(this||Yd).timestampParam=ab.timestampParam;(this||Yd).timestampRequests=
ab.timestampRequests;(this||Yd).readyState="";(this||Yd).agent=ab.agent||!1;(this||Yd).socket=ab.socket;(this||Yd).enablesXDR=ab.enablesXDR;(this||Yd).withCredentials=ab.withCredentials;(this||Yd).pfx=ab.pfx;(this||Yd).key=ab.key;(this||Yd).passphrase=ab.passphrase;(this||Yd).cert=ab.cert;(this||Yd).ca=ab.ca;(this||Yd).ciphers=ab.ciphers;(this||Yd).rejectUnauthorized=ab.rejectUnauthorized;(this||Yd).forceNode=ab.forceNode;(this||Yd).isReactNative=ab.isReactNative;(this||Yd).extraHeaders=ab.extraHeaders;
(this||Yd).localAddress=ab.localAddress}if(Wc)return Tc;Wc=!0;var eb=db(),nb=Vc();Tc=pa;nb(pa.prototype);pa.prototype.onError=function(ab,mb){ab=Error(ab);ab.type="TransportError";ab.description=mb;this.emit("error",ab);return this||Yd};pa.prototype.open=function(){if("closed"===(this||Yd).readyState||""===(this||Yd).readyState)(this||Yd).readyState="opening",this.doOpen();return this||Yd};pa.prototype.close=function(){if("opening"===(this||Yd).readyState||"open"===(this||Yd).readyState)this.doClose(),
this.onClose();return this||Yd};pa.prototype.send=function(ab){if("open"===(this||Yd).readyState)this.write(ab);else throw Error("Transport not open");};pa.prototype.onOpen=function(){(this||Yd).readyState="open";(this||Yd).writable=!0;this.emit("open")};pa.prototype.onData=function(ab){ab=eb.decodePacket(ab,(this||Yd).socket.binaryType);this.onPacket(ab)};pa.prototype.onPacket=function(ab){this.emit("packet",ab)};pa.prototype.onClose=function(){(this||Yd).readyState="closed";this.emit("close")};
return Tc}function cb(){if(Bf)return Mf;Bf=!0;Mf.encode=function(pa){var eb="",nb;for(nb in pa)pa.hasOwnProperty(nb)&&(eb.length&&(eb+="&"),eb+=encodeURIComponent(nb)+"="+encodeURIComponent(pa[nb]));return eb};Mf.decode=function(pa){var eb={};pa=pa.split("&");for(var nb=0,ab=pa.length;nb<ab;nb++){var mb=pa[nb].split("=");eb[decodeURIComponent(mb[0])]=decodeURIComponent(mb[1])}return eb};return Mf}function la(){if(df)return Hg;df=!0;return Hg=function(pa,eb){var nb=function(){};nb.prototype=eb.prototype;
pa.prototype=new nb;pa.prototype.constructor=pa}}function La(){function pa(Lc){var Xb="";do Xb=nb[Lc%64]+Xb,Lc=Math.floor(Lc/64);while(0<Lc);return Xb}function eb(){var Lc=pa(+new Date);return Lc!==Nc?(mb=0,Nc=Lc):Lc+"."+pa(mb++)}if(Di)return Bg;Di=!0;for(var nb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ab={},mb=0,ic=0,Nc;64>ic;ic++)ab[nb[ic]]=ic;eb.encode=pa;eb.decode=function(Lc){var Xb=0;for(ic=0;ic<Lc.length;ic++)Xb=64*Xb+ab[Lc.charAt(ic)];return Xb};return Bg=
eb}function fb(){function pa(Xb){var Rb=Xb&&Xb.forceBase64;if(!Lc||Rb)(this||Oe).supportsBinary=!1;eb.call(this||Oe,Xb)}if(Nj)return Pg;Nj=!0;var eb=Ta(),nb=cb(),ab=db(),mb=la(),ic=La(),Nc=Fd()("engine.io-client:polling");Pg=pa;var Lc=null!=(new (Oc())({xdomain:!1})).responseType;mb(pa,eb);pa.prototype.name="polling";pa.prototype.doOpen=function(){this.poll()};pa.prototype.pause=function(Xb){function Rb(){Nc("paused");tc.readyState="paused";Xb()}var tc=this||Oe;(this||Oe).readyState="pausing";if((this||
Oe).polling||!(this||Oe).writable){var gb=0;(this||Oe).polling&&(Nc("we are currently polling - waiting to pause"),gb++,this.once("pollComplete",function(){Nc("pre-pause polling complete");--gb||Rb()}));(this||Oe).writable||(Nc("we are currently writing - waiting to pause"),gb++,this.once("drain",function(){Nc("pre-pause writing complete");--gb||Rb()}))}else Rb()};pa.prototype.poll=function(){Nc("polling");(this||Oe).polling=!0;this.doPoll();this.emit("poll")};pa.prototype.onData=function(Xb){var Rb=
this||Oe;Nc("polling got data %s",Xb);ab.decodePayload(Xb,(this||Oe).socket.binaryType,function(tc,gb,Gc){if("opening"===Rb.readyState)Rb.onOpen();if("close"===tc.type)return Rb.onClose(),!1;Rb.onPacket(tc)});"closed"!==(this||Oe).readyState&&((this||Oe).polling=!1,this.emit("pollComplete"),"open"===(this||Oe).readyState?this.poll():Nc('ignoring poll - transport state "%s"',(this||Oe).readyState))};pa.prototype.doClose=function(){function Xb(){Nc("writing close packet");Rb.write([{type:"close"}])}
var Rb=this||Oe;"open"===(this||Oe).readyState?(Nc("transport open - closing"),Xb()):(Nc("transport not open - deferring close"),this.once("open",Xb))};pa.prototype.write=function(Xb){var Rb=this||Oe;(this||Oe).writable=!1;var tc=function(){Rb.writable=!0;Rb.emit("drain")};ab.encodePayload(Xb,(this||Oe).supportsBinary,function(gb){Rb.doWrite(gb,tc)})};pa.prototype.uri=function(){var Xb=(this||Oe).query||{},Rb=(this||Oe).secure?"https":"http",tc="";!1!==(this||Oe).timestampRequests&&(Xb[(this||Oe).timestampParam]=
ic());(this||Oe).supportsBinary||Xb.sid||(Xb.b64=1);Xb=nb.encode(Xb);(this||Oe).port&&("https"===Rb&&443!==Number((this||Oe).port)||"http"===Rb&&80!==Number((this||Oe).port))&&(tc=":"+(this||Oe).port);Xb.length&&(Xb="?"+Xb);var gb=-1!==(this||Oe).hostname.indexOf(":");return Rb+"://"+(gb?"["+(this||Oe).hostname+"]":(this||Oe).hostname)+tc+(this||Oe).path+Xb};return Pg}function pb(){function pa(){}function eb(tc){ic.call(this||be,tc);(this||be).requestTimeout=tc.requestTimeout;(this||be).extraHeaders=
tc.extraHeaders;if("undefined"!==typeof location){var gb="https:"===location.protocol,Gc=location.port;Gc||(Gc=gb?443:80);(this||be).xd="undefined"!==typeof location&&tc.hostname!==location.hostname||Gc!==tc.port;(this||be).xs=tc.secure!==gb}}function nb(tc){(this||be).method=tc.method||"GET";(this||be).uri=tc.uri;(this||be).xd=!!tc.xd;(this||be).xs=!!tc.xs;(this||be).async=!1!==tc.async;(this||be).data=void 0!==tc.data?tc.data:null;(this||be).agent=tc.agent;(this||be).isBinary=tc.isBinary;(this||
be).supportsBinary=tc.supportsBinary;(this||be).enablesXDR=tc.enablesXDR;(this||be).withCredentials=tc.withCredentials;(this||be).requestTimeout=tc.requestTimeout;(this||be).pfx=tc.pfx;(this||be).key=tc.key;(this||be).passphrase=tc.passphrase;(this||be).cert=tc.cert;(this||be).ca=tc.ca;(this||be).ciphers=tc.ciphers;(this||be).rejectUnauthorized=tc.rejectUnauthorized;(this||be).extraHeaders=tc.extraHeaders;this.create()}function ab(){for(var tc in nb.requests)nb.requests.hasOwnProperty(tc)&&nb.requests[tc].abort()}
if(Kh)return ki;Kh=!0;var mb=Oc(),ic=fb(),Nc=Vc(),Lc=la(),Xb=Fd()("engine.io-client:polling-xhr"),Rb=Yc();ki=eb;ki.Request=nb;Lc(eb,ic);eb.prototype.supportsBinary=!0;eb.prototype.request=function(tc){tc=tc||{};tc.uri=this.uri();tc.xd=(this||be).xd;tc.xs=(this||be).xs;tc.agent=(this||be).agent||!1;tc.supportsBinary=(this||be).supportsBinary;tc.enablesXDR=(this||be).enablesXDR;tc.withCredentials=(this||be).withCredentials;tc.pfx=(this||be).pfx;tc.key=(this||be).key;tc.passphrase=(this||be).passphrase;
tc.cert=(this||be).cert;tc.ca=(this||be).ca;tc.ciphers=(this||be).ciphers;tc.rejectUnauthorized=(this||be).rejectUnauthorized;tc.requestTimeout=(this||be).requestTimeout;tc.extraHeaders=(this||be).extraHeaders;return new nb(tc)};eb.prototype.doWrite=function(tc,gb){tc=this.request({method:"POST",data:tc,isBinary:"string"!==typeof tc&&void 0!==tc});var Gc=this||be;tc.on("success",gb);tc.on("error",function(Cd){Gc.onError("xhr post error",Cd)});(this||be).sendXhr=tc};eb.prototype.doPoll=function(){Xb("xhr poll");
var tc=this.request(),gb=this||be;tc.on("data",function(Gc){gb.onData(Gc)});tc.on("error",function(Gc){gb.onError("xhr poll error",Gc)});(this||be).pollXhr=tc};Nc(nb.prototype);nb.prototype.create=function(){var tc={agent:(this||be).agent,xdomain:(this||be).xd,xscheme:(this||be).xs,enablesXDR:(this||be).enablesXDR};tc.pfx=(this||be).pfx;tc.key=(this||be).key;tc.passphrase=(this||be).passphrase;tc.cert=(this||be).cert;tc.ca=(this||be).ca;tc.ciphers=(this||be).ciphers;tc.rejectUnauthorized=(this||be).rejectUnauthorized;
var gb=(this||be).xhr=new mb(tc),Gc=this||be;try{Xb("xhr open %s: %s",(this||be).method,(this||be).uri);gb.open((this||be).method,(this||be).uri,(this||be).async);try{if((this||be).extraHeaders){gb.setDisableHeaderCheck&&gb.setDisableHeaderCheck(!0);for(var Cd in(this||be).extraHeaders)(this||be).extraHeaders.hasOwnProperty(Cd)&&gb.setRequestHeader(Cd,(this||be).extraHeaders[Cd])}}catch(fe){}if("POST"===(this||be).method)try{(this||be).isBinary?gb.setRequestHeader("Content-type","application/octet-stream"):
gb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(fe){}try{gb.setRequestHeader("Accept","*/*")}catch(fe){}"withCredentials"in gb&&(gb.withCredentials=(this||be).withCredentials);(this||be).requestTimeout&&(gb.timeout=(this||be).requestTimeout);this.hasXDR()?(gb.onload=function(){Gc.onLoad()},gb.onerror=function(){Gc.onError(gb.responseText)}):gb.onreadystatechange=function(){if(2===gb.readyState)try{var fe=gb.getResponseHeader("Content-Type");if(Gc.supportsBinary&&"application/octet-stream"===
fe||"application/octet-stream; charset=UTF-8"===fe)gb.responseType="arraybuffer"}catch(rd){}if(4===gb.readyState)if(200===gb.status||1223===gb.status)Gc.onLoad();else setTimeout(function(){Gc.onError("number"===typeof gb.status?gb.status:0)},0)};Xb("xhr data %s",(this||be).data);gb.send((this||be).data)}catch(fe){setTimeout(function(){Gc.onError(fe)},0);return}"undefined"!==typeof document&&((this||be).index=nb.requestsCount++,nb.requests[(this||be).index]=this||be)};nb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};nb.prototype.onData=function(tc){this.emit("data",tc);this.onSuccess()};nb.prototype.onError=function(tc){this.emit("error",tc);this.cleanup(!0)};nb.prototype.cleanup=function(tc){if("undefined"!==typeof(this||be).xhr&&null!==(this||be).xhr){this.hasXDR()?(this||be).xhr.onload=(this||be).xhr.onerror=pa:(this||be).xhr.onreadystatechange=pa;if(tc)try{(this||be).xhr.abort()}catch(gb){}"undefined"!==typeof document&&delete nb.requests[(this||be).index];(this||be).xhr=null}};nb.prototype.onLoad=
function(){try{try{var tc=(this||be).xhr.getResponseHeader("Content-Type")}catch(Gc){}var gb="application/octet-stream"===tc||"application/octet-stream; charset=UTF-8"===tc?(this||be).xhr.response||(this||be).xhr.responseText:(this||be).xhr.responseText}catch(Gc){this.onError(Gc)}if(null!=gb)this.onData(gb)};nb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||be).xs&&(this||be).enablesXDR};nb.prototype.abort=function(){this.cleanup()};nb.requestsCount=0;nb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",ab):"function"===typeof addEventListener&&addEventListener("onpagehide"in Rb?"pagehide":"unload",ab,!1));return ki}function Cb(){function pa(){}function eb(Xb){nb.call(this||lg,Xb);(this||lg).query=(this||lg).query||{};Lc||(Lc=mb.___eio=mb.___eio||[]);(this||lg).index=Lc.length;var Rb=this||lg;Lc.push(function(tc){Rb.onData(tc)});(this||lg).query.j=(this||lg).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){Rb.script&&(Rb.script.onerror=pa)},!1)}if(Mj)return gj;Mj=!0;var nb=fb(),ab=la(),mb=Yc();gj=eb;var ic=/\n/g,Nc=/\\n/g,Lc;ab(eb,nb);eb.prototype.supportsBinary=!1;eb.prototype.doClose=function(){(this||lg).script&&((this||lg).script.parentNode.removeChild((this||lg).script),(this||lg).script=null);(this||lg).form&&((this||lg).form.parentNode.removeChild((this||lg).form),(this||lg).form=null,(this||lg).iframe=null);nb.prototype.doClose.call(this||lg)};eb.prototype.doPoll=function(){var Xb=
this||lg,Rb=document.createElement("script");(this||lg).script&&((this||lg).script.parentNode.removeChild((this||lg).script),(this||lg).script=null);Rb.async=!0;Rb.src=this.uri();Rb.onerror=function(gb){Xb.onError("jsonp poll error",gb)};var tc=document.getElementsByTagName("script")[0];tc?tc.parentNode.insertBefore(Rb,tc):(document.head||document.body).appendChild(Rb);(this||lg).script=Rb;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var gb=document.createElement("iframe");
document.body.appendChild(gb);document.body.removeChild(gb)},100)};eb.prototype.doWrite=function(Xb,Rb){function tc(){gb();Rb()}function gb(){if(Gc.iframe)try{Gc.form.removeChild(Gc.iframe)}catch(se){Gc.onError("jsonp polling iframe removal error",se)}try{ge=document.createElement('<iframe src="javascript:0" name="'+Gc.iframeId+'">')}catch(se){ge=document.createElement("iframe"),ge.name=Gc.iframeId,ge.src="javascript:0"}ge.id=Gc.iframeId;Gc.form.appendChild(ge);Gc.iframe=ge}var Gc=this||lg;if(!(this||
lg).form){var Cd=document.createElement("form"),fe=document.createElement("textarea"),rd=(this||lg).iframeId="eio_iframe_"+(this||lg).index,ge;Cd.className="socketio";Cd.style.position="absolute";Cd.style.top="-1000px";Cd.style.left="-1000px";Cd.target=rd;Cd.method="POST";Cd.setAttribute("accept-charset","utf-8");fe.name="d";Cd.appendChild(fe);document.body.appendChild(Cd);(this||lg).form=Cd;(this||lg).area=fe}(this||lg).form.action=this.uri();gb();Xb=Xb.replace(Nc,"\\\n");(this||lg).area.value=Xb.replace(ic,
"\\n");try{(this||lg).form.submit()}catch(se){}(this||lg).iframe.attachEvent?(this||lg).iframe.onreadystatechange=function(){"complete"===Gc.iframe.readyState&&tc()}:(this||lg).iframe.onload=tc};return gj}function Wa(){if(Tj)return yk;Tj=!0;return yk=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function Xa(){function pa(gb){gb&&gb.forceBase64&&((this||zf).supportsBinary=!1);(this||zf).perMessageDeflate=gb.perMessageDeflate;(this||
zf).usingBrowserWebSocket=Xb&&!gb.forceNode;(this||zf).protocols=gb.protocols;(this||zf).usingBrowserWebSocket||(tc=Rb);nb.call(this||zf,gb)}if(Bh)return Bj;Bh=!0;var eb=Wb.Buffer,nb=Ta(),ab=db(),mb=cb(),ic=la(),Nc=La(),Lc=Fd()("engine.io-client:websocket"),Xb;"undefined"!==typeof WebSocket?Xb=WebSocket:"undefined"!==typeof self&&(Xb=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var Rb=Wa()}catch(gb){}var tc=Xb||Rb;Bj=pa;ic(pa,nb);pa.prototype.name="websocket";pa.prototype.supportsBinary=
!0;pa.prototype.doOpen=function(){if(this.check()){var gb=this.uri(),Gc=(this||zf).protocols,Cd={};(this||zf).isReactNative||(Cd.agent=(this||zf).agent,Cd.perMessageDeflate=(this||zf).perMessageDeflate,Cd.pfx=(this||zf).pfx,Cd.key=(this||zf).key,Cd.passphrase=(this||zf).passphrase,Cd.cert=(this||zf).cert,Cd.ca=(this||zf).ca,Cd.ciphers=(this||zf).ciphers,Cd.rejectUnauthorized=(this||zf).rejectUnauthorized);(this||zf).extraHeaders&&(Cd.headers=(this||zf).extraHeaders);(this||zf).localAddress&&(Cd.localAddress=
(this||zf).localAddress);try{(this||zf).ws=(this||zf).usingBrowserWebSocket&&!(this||zf).isReactNative?Gc?new tc(gb,Gc):new tc(gb):new tc(gb,Gc,Cd)}catch(fe){return this.emit("error",fe)}void 0===(this||zf).ws.binaryType&&((this||zf).supportsBinary=!1);(this||zf).ws.supports&&(this||zf).ws.supports.binary?((this||zf).supportsBinary=!0,(this||zf).ws.binaryType="nodebuffer"):(this||zf).ws.binaryType="arraybuffer";this.addEventListeners()}};pa.prototype.addEventListeners=function(){var gb=this||zf;(this||
zf).ws.onopen=function(){gb.onOpen()};(this||zf).ws.onclose=function(){gb.onClose()};(this||zf).ws.onmessage=function(Gc){gb.onData(Gc.data)};(this||zf).ws.onerror=function(Gc){gb.onError("websocket error",Gc)}};pa.prototype.write=function(gb){function Gc(){Cd.emit("flush");setTimeout(function(){Cd.writable=!0;Cd.emit("drain")},0)}var Cd=this||zf;(this||zf).writable=!1;for(var fe=gb.length,rd=0,ge=fe;rd<ge;rd++)(function(se){ab.encodePacket(se,Cd.supportsBinary,function(Se){if(!Cd.usingBrowserWebSocket){var Ue=
{};se.options&&(Ue.compress=se.options.compress);Cd.perMessageDeflate&&("string"===typeof Se?eb.byteLength(Se):Se.length)<Cd.perMessageDeflate.threshold&&(Ue.compress=!1)}try{Cd.usingBrowserWebSocket?Cd.ws.send(Se):Cd.ws.send(Se,Ue)}catch(Kf){Lc("websocket closed before onclose event")}--fe||Gc()})})(gb[rd])};pa.prototype.onClose=function(){nb.prototype.onClose.call(this||zf)};pa.prototype.doClose=function(){"undefined"!==typeof(this||zf).ws&&(this||zf).ws.close()};pa.prototype.uri=function(){var gb=
(this||zf).query||{},Gc=(this||zf).secure?"wss":"ws",Cd="";(this||zf).port&&("wss"===Gc&&443!==Number((this||zf).port)||"ws"===Gc&&80!==Number((this||zf).port))&&(Cd=":"+(this||zf).port);(this||zf).timestampRequests&&(gb[(this||zf).timestampParam]=Nc());(this||zf).supportsBinary||(gb.b64=1);gb=mb.encode(gb);gb.length&&(gb="?"+gb);var fe=-1!==(this||zf).hostname.indexOf(":");return Gc+"://"+(fe?"["+(this||zf).hostname+"]":(this||zf).hostname)+Cd+(this||zf).path+gb};pa.prototype.check=function(){return!!tc&&
!("__initialize"in tc&&(this||zf).name===pa.prototype.name)};return Bj}function zb(){if(ll)return $e;ll=!0;var pa=Oc(),eb=pb(),nb=Cb(),ab=Xa();$e.polling=function(mb){var ic=!1,Nc=!1,Lc=!1!==mb.jsonp;"undefined"!==typeof location&&(Nc="https:"===location.protocol,(ic=location.port)||(ic=Nc?443:80),ic=mb.hostname!==location.hostname||ic!==mb.port,Nc=mb.secure!==Nc);mb.xdomain=ic;mb.xscheme=Nc;if("open"in new pa(mb)&&!mb.forceJSONP)return new eb(mb);if(!Lc)throw Error("JSONP disabled");return new nb(mb)};
$e.websocket=ab;return $e}function kc(){if(Xc)return Sa;Xc=!0;var pa=[].indexOf;return Sa=function(eb,nb){if(pa)return eb.indexOf(nb);for(var ab=0;ab<eb.length;++ab)if(eb[ab]===nb)return ab;return-1}}function Tb(){function pa(Xb,Rb){if(!((this||Hc)instanceof pa))return new pa(Xb,Rb);Rb=Rb||{};Xb&&"object"===typeof Xb&&(Rb=Xb,Xb=null);Xb?(Xb=Nc(Xb),Rb.hostname=Xb.host,Rb.secure="https"===Xb.protocol||"wss"===Xb.protocol,Rb.port=Xb.port,Xb.query&&(Rb.query=Xb.query)):Rb.host&&(Rb.hostname=Nc(Rb.host).host);
(this||Hc).secure=null!=Rb.secure?Rb.secure:"undefined"!==typeof location&&"https:"===location.protocol;Rb.hostname&&!Rb.port&&(Rb.port=(this||Hc).secure?"443":"80");(this||Hc).agent=Rb.agent||!1;(this||Hc).hostname=Rb.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||Hc).port=Rb.port||("undefined"!==typeof location&&location.port?location.port:(this||Hc).secure?443:80);(this||Hc).query=Rb.query||{};"string"===typeof(this||Hc).query&&((this||Hc).query=Lc.decode((this||
Hc).query));(this||Hc).upgrade=!1!==Rb.upgrade;(this||Hc).path=(Rb.path||"/engine.io").replace(/\/$/,"")+"/";(this||Hc).forceJSONP=!!Rb.forceJSONP;(this||Hc).jsonp=!1!==Rb.jsonp;(this||Hc).forceBase64=!!Rb.forceBase64;(this||Hc).enablesXDR=!!Rb.enablesXDR;(this||Hc).withCredentials=!1!==Rb.withCredentials;(this||Hc).timestampParam=Rb.timestampParam||"t";(this||Hc).timestampRequests=Rb.timestampRequests;(this||Hc).transports=Rb.transports||["polling","websocket"];(this||Hc).transportOptions=Rb.transportOptions||
{};(this||Hc).readyState="";(this||Hc).writeBuffer=[];(this||Hc).prevBufferLen=0;(this||Hc).policyPort=Rb.policyPort||843;(this||Hc).rememberUpgrade=Rb.rememberUpgrade||!1;(this||Hc).binaryType=null;(this||Hc).onlyBinaryUpgrades=Rb.onlyBinaryUpgrades;(this||Hc).perMessageDeflate=!1!==Rb.perMessageDeflate?Rb.perMessageDeflate||{}:!1;!0===(this||Hc).perMessageDeflate&&((this||Hc).perMessageDeflate={});(this||Hc).perMessageDeflate&&null==(this||Hc).perMessageDeflate.threshold&&((this||Hc).perMessageDeflate.threshold=
1024);(this||Hc).pfx=Rb.pfx||null;(this||Hc).key=Rb.key||null;(this||Hc).passphrase=Rb.passphrase||null;(this||Hc).cert=Rb.cert||null;(this||Hc).ca=Rb.ca||null;(this||Hc).ciphers=Rb.ciphers||null;(this||Hc).rejectUnauthorized=void 0===Rb.rejectUnauthorized?!0:Rb.rejectUnauthorized;(this||Hc).forceNode=!!Rb.forceNode;(this||Hc).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||Hc).isReactNative)Rb.extraHeaders&&
0<Object.keys(Rb.extraHeaders).length&&((this||Hc).extraHeaders=Rb.extraHeaders),Rb.localAddress&&((this||Hc).localAddress=Rb.localAddress);(this||Hc).id=null;(this||Hc).upgrades=null;(this||Hc).pingInterval=null;(this||Hc).pingTimeout=null;(this||Hc).pingIntervalTimer=null;(this||Hc).pingTimeoutTimer=null;this.open()}if(Td)return Wd;Td=!0;var eb=zb(),nb=Vc(),ab=Fd()("engine.io-client:socket"),mb=kc(),ic=db(),Nc=Jc(),Lc=cb();Wd=pa;pa.priorWebsocketSuccess=!1;nb(pa.prototype);pa.protocol=ic.protocol;
pa.Socket=pa;pa.Transport=Ta();pa.transports=zb();pa.parser=db();pa.prototype.createTransport=function(Xb){ab('creating transport "%s"',Xb);var Rb=(this||Hc).query,tc={},gb;for(gb in Rb)Rb.hasOwnProperty(gb)&&(tc[gb]=Rb[gb]);tc.EIO=ic.protocol;tc.transport=Xb;Rb=(this||Hc).transportOptions[Xb]||{};(this||Hc).id&&(tc.sid=(this||Hc).id);return new eb[Xb]({query:tc,socket:this||Hc,agent:Rb.agent||(this||Hc).agent,hostname:Rb.hostname||(this||Hc).hostname,port:Rb.port||(this||Hc).port,secure:Rb.secure||
(this||Hc).secure,path:Rb.path||(this||Hc).path,forceJSONP:Rb.forceJSONP||(this||Hc).forceJSONP,jsonp:Rb.jsonp||(this||Hc).jsonp,forceBase64:Rb.forceBase64||(this||Hc).forceBase64,enablesXDR:Rb.enablesXDR||(this||Hc).enablesXDR,withCredentials:Rb.withCredentials||(this||Hc).withCredentials,timestampRequests:Rb.timestampRequests||(this||Hc).timestampRequests,timestampParam:Rb.timestampParam||(this||Hc).timestampParam,policyPort:Rb.policyPort||(this||Hc).policyPort,pfx:Rb.pfx||(this||Hc).pfx,key:Rb.key||
(this||Hc).key,passphrase:Rb.passphrase||(this||Hc).passphrase,cert:Rb.cert||(this||Hc).cert,ca:Rb.ca||(this||Hc).ca,ciphers:Rb.ciphers||(this||Hc).ciphers,rejectUnauthorized:Rb.rejectUnauthorized||(this||Hc).rejectUnauthorized,perMessageDeflate:Rb.perMessageDeflate||(this||Hc).perMessageDeflate,extraHeaders:Rb.extraHeaders||(this||Hc).extraHeaders,forceNode:Rb.forceNode||(this||Hc).forceNode,localAddress:Rb.localAddress||(this||Hc).localAddress,requestTimeout:Rb.requestTimeout||(this||Hc).requestTimeout,
protocols:Rb.protocols||void 0,isReactNative:(this||Hc).isReactNative})};pa.prototype.open=function(){if((this||Hc).rememberUpgrade&&pa.priorWebsocketSuccess&&-1!==(this||Hc).transports.indexOf("websocket"))var Xb="websocket";else{if(0===(this||Hc).transports.length){var Rb=this||Hc;setTimeout(function(){Rb.emit("error","No transports available")},0);return}Xb=(this||Hc).transports[0]}(this||Hc).readyState="opening";try{Xb=this.createTransport(Xb)}catch(tc){(this||Hc).transports.shift();this.open();
return}Xb.open();this.setTransport(Xb)};pa.prototype.setTransport=function(Xb){ab("setting transport %s",Xb.name);var Rb=this||Hc;(this||Hc).transport&&(ab("clearing existing transport %s",(this||Hc).transport.name),(this||Hc).transport.removeAllListeners());(this||Hc).transport=Xb;Xb.on("drain",function(){Rb.onDrain()}).on("packet",function(tc){Rb.onPacket(tc)}).on("error",function(tc){Rb.onError(tc)}).on("close",function(){Rb.onClose("transport close")})};pa.prototype.probe=function(Xb){function Rb(){if(Se.onlyBinaryUpgrades){var Ue=
!(this||Hc).supportsBinary&&Se.transport.supportsBinary;se=se||Ue}se||(ab('probe transport "%s" opened',Xb),ge.send([{type:"ping",data:"probe"}]),ge.once("packet",function(Kf){se||("pong"===Kf.type&&"probe"===Kf.data?(ab('probe transport "%s" pong',Xb),Se.upgrading=!0,Se.emit("upgrading",ge),ge&&(pa.priorWebsocketSuccess="websocket"===ge.name,ab('pausing current transport "%s"',Se.transport.name),Se.transport.pause(function(){se||"closed"===Se.readyState||(ab("changing transport and sending upgrade packet"),
rd(),Se.setTransport(ge),ge.send([{type:"upgrade"}]),Se.emit("upgrade",ge),ge=null,Se.upgrading=!1,Se.flush())}))):(ab('probe transport "%s" failed',Xb),Kf=Error("probe error"),Kf.transport=ge.name,Se.emit("upgradeError",Kf)))}))}function tc(){se||(se=!0,rd(),ge.close(),ge=null)}function gb(Ue){var Kf=Error("probe error: "+Ue);Kf.transport=ge.name;tc();ab('probe transport "%s" failed because of error: %s',Xb,Ue);Se.emit("upgradeError",Kf)}function Gc(){gb("transport closed")}function Cd(){gb("socket closed")}
function fe(Ue){ge&&Ue.name!==ge.name&&(ab('"%s" works - aborting "%s"',Ue.name,ge.name),tc())}function rd(){ge.removeListener("open",Rb);ge.removeListener("error",gb);ge.removeListener("close",Gc);Se.removeListener("close",Cd);Se.removeListener("upgrading",fe)}ab('probing transport "%s"',Xb);var ge=this.createTransport(Xb,{probe:1}),se=!1,Se=this||Hc;pa.priorWebsocketSuccess=!1;ge.once("open",Rb);ge.once("error",gb);ge.once("close",Gc);this.once("close",Cd);this.once("upgrading",fe);ge.open()};pa.prototype.onOpen=
function(){ab("socket open");(this||Hc).readyState="open";pa.priorWebsocketSuccess="websocket"===(this||Hc).transport.name;this.emit("open");this.flush();if("open"===(this||Hc).readyState&&(this||Hc).upgrade&&(this||Hc).transport.pause){ab("starting upgrade probes");for(var Xb=0,Rb=(this||Hc).upgrades.length;Xb<Rb;Xb++)this.probe((this||Hc).upgrades[Xb])}};pa.prototype.onPacket=function(Xb){if("opening"===(this||Hc).readyState||"open"===(this||Hc).readyState||"closing"===(this||Hc).readyState)switch(ab('socket receive: type "%s", data "%s"',
Xb.type,Xb.data),this.emit("packet",Xb),this.emit("heartbeat"),Xb.type){case "open":this.onHandshake(JSON.parse(Xb.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var Rb=Error("server error");Rb.code=Xb.data;this.onError(Rb);break;case "message":this.emit("data",Xb.data),this.emit("message",Xb.data)}else ab('packet received with socket readyState "%s"',(this||Hc).readyState)};pa.prototype.onHandshake=function(Xb){this.emit("handshake",Xb);(this||Hc).id=Xb.sid;(this||Hc).transport.query.sid=
Xb.sid;(this||Hc).upgrades=this.filterUpgrades(Xb.upgrades);(this||Hc).pingInterval=Xb.pingInterval;(this||Hc).pingTimeout=Xb.pingTimeout;this.onOpen();"closed"!==(this||Hc).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||Hc).onHeartbeat),this.on("heartbeat",(this||Hc).onHeartbeat))};pa.prototype.onHeartbeat=function(Xb){clearTimeout((this||Hc).pingTimeoutTimer);var Rb=this||Hc;Rb.pingTimeoutTimer=setTimeout(function(){if("closed"!==Rb.readyState)Rb.onClose("ping timeout")},Xb||
Rb.pingInterval+Rb.pingTimeout)};pa.prototype.setPing=function(){var Xb=this||Hc;clearTimeout(Xb.pingIntervalTimer);Xb.pingIntervalTimer=setTimeout(function(){ab("writing ping packet - expecting pong within %sms",Xb.pingTimeout);Xb.ping();Xb.onHeartbeat(Xb.pingTimeout)},Xb.pingInterval)};pa.prototype.ping=function(){var Xb=this||Hc;this.sendPacket("ping",function(){Xb.emit("ping")})};pa.prototype.onDrain=function(){(this||Hc).writeBuffer.splice(0,(this||Hc).prevBufferLen);(this||Hc).prevBufferLen=
0;0===(this||Hc).writeBuffer.length?this.emit("drain"):this.flush()};pa.prototype.flush=function(){"closed"!==(this||Hc).readyState&&(this||Hc).transport.writable&&!(this||Hc).upgrading&&(this||Hc).writeBuffer.length&&(ab("flushing %d packets in socket",(this||Hc).writeBuffer.length),(this||Hc).transport.send((this||Hc).writeBuffer),(this||Hc).prevBufferLen=(this||Hc).writeBuffer.length,this.emit("flush"))};pa.prototype.write=pa.prototype.send=function(Xb,Rb,tc){this.sendPacket("message",Xb,Rb,tc);
return this||Hc};pa.prototype.sendPacket=function(Xb,Rb,tc,gb){"function"===typeof Rb&&(gb=Rb,Rb=void 0);"function"===typeof tc&&(gb=tc,tc=null);if("closing"!==(this||Hc).readyState&&"closed"!==(this||Hc).readyState){tc=tc||{};tc.compress=!1!==tc.compress;Xb={type:Xb,data:Rb,options:tc};this.emit("packetCreate",Xb);(this||Hc).writeBuffer.push(Xb);if(gb)this.once("flush",gb);this.flush()}};pa.prototype.close=function(){function Xb(){gb.onClose("forced close");ab("socket closing - telling transport to close");
gb.transport.close()}function Rb(){gb.removeListener("upgrade",Rb);gb.removeListener("upgradeError",Rb);Xb()}function tc(){gb.once("upgrade",Rb);gb.once("upgradeError",Rb)}if("opening"===(this||Hc).readyState||"open"===(this||Hc).readyState){(this||Hc).readyState="closing";var gb=this||Hc;if((this||Hc).writeBuffer.length)this.once("drain",function(){(this||Hc).upgrading?tc():Xb()});else(this||Hc).upgrading?tc():Xb()}return this||Hc};pa.prototype.onError=function(Xb){ab("socket error %j",Xb);pa.priorWebsocketSuccess=
!1;this.emit("error",Xb);this.onClose("transport error",Xb)};pa.prototype.onClose=function(Xb,Rb){if("opening"===(this||Hc).readyState||"open"===(this||Hc).readyState||"closing"===(this||Hc).readyState){ab('socket close with reason: "%s"',Xb);var tc=this||Hc;clearTimeout((this||Hc).pingIntervalTimer);clearTimeout((this||Hc).pingTimeoutTimer);(this||Hc).transport.removeAllListeners("close");(this||Hc).transport.close();(this||Hc).transport.removeAllListeners();(this||Hc).readyState="closed";(this||
Hc).id=null;this.emit("close",Xb,Rb);tc.writeBuffer=[];tc.prevBufferLen=0}};pa.prototype.filterUpgrades=function(Xb){for(var Rb=[],tc=0,gb=Xb.length;tc<gb;tc++)~mb((this||Hc).transports,Xb[tc])&&Rb.push(Xb[tc]);return Rb};return Wd}function qc(){if(Cm)return Rk;Cm=!0;return Rk=function(pa,eb){for(var nb=[],ab=(eb=eb||0)||0;ab<pa.length;ab++)nb[ab-eb]=pa[ab];return nb}}function wc(){if(hj)return Um;hj=!0;return Um=function(pa,eb,nb){pa.on(eb,nb);return{destroy:function(){pa.removeListener(eb,nb)}}}}
function I(){if(Pk)return Jl;Pk=!0;var pa=[].slice;return Jl=function(eb,nb){"string"==typeof nb&&(nb=eb[nb]);if("function"!=typeof nb)throw Error("bind() requires a function");var ab=pa.call(arguments,2);return function(){return nb.apply(eb,ab.concat(pa.call(arguments)))}}}function T(){function pa(gb,Gc,Cd){(this||Ee).io=gb;(this||Ee).nsp=Gc;(this||Ee).json=this||Ee;(this||Ee).ids=0;(this||Ee).acks={};(this||Ee).receiveBuffer=[];(this||Ee).sendBuffer=[];(this||Ee).connected=!1;(this||Ee).disconnected=
!0;(this||Ee).flags={};Cd&&Cd.query&&((this||Ee).query=Cd.query);(this||Ee).io.autoConnect&&this.open()}if(Kl)return zk;Kl=!0;var eb=bc(),nb=Vc(),ab=qc(),mb=wc(),ic=I(),Nc=Fd()("socket.io-client:socket"),Lc=cb(),Xb=zc();zk=zk=pa;var Rb={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},tc=nb.prototype.emit;nb(pa.prototype);pa.prototype.subEvents=function(){if(!(this||Ee).subs){var gb=
(this||Ee).io;(this||Ee).subs=[mb(gb,"open",ic(this||Ee,"onopen")),mb(gb,"packet",ic(this||Ee,"onpacket")),mb(gb,"close",ic(this||Ee,"onclose"))]}};pa.prototype.open=pa.prototype.connect=function(){if((this||Ee).connected)return this||Ee;this.subEvents();(this||Ee).io.reconnecting||(this||Ee).io.open();if("open"===(this||Ee).io.readyState)this.onopen();this.emit("connecting");return this||Ee};pa.prototype.send=function(){var gb=ab(arguments);gb.unshift("message");(this||Ee).emit.apply(this||Ee,gb);
return this||Ee};pa.prototype.emit=function(gb){if(Rb.hasOwnProperty(gb))return tc.apply(this||Ee,arguments),this||Ee;var Gc=ab(arguments),Cd={type:(void 0!==(this||Ee).flags.binary?(this||Ee).flags.binary:Xb(Gc))?eb.BINARY_EVENT:eb.EVENT,data:Gc,options:{}};Cd.options.compress=!(this||Ee).flags||!1!==(this||Ee).flags.compress;"function"===typeof Gc[Gc.length-1]&&(Nc("emitting packet with ack id %d",(this||Ee).ids),(this||Ee).acks[(this||Ee).ids]=Gc.pop(),Cd.id=(this||Ee).ids++);(this||Ee).connected?
this.packet(Cd):(this||Ee).sendBuffer.push(Cd);(this||Ee).flags={};return this||Ee};pa.prototype.packet=function(gb){gb.nsp=(this||Ee).nsp;(this||Ee).io.packet(gb)};pa.prototype.onopen=function(){Nc("transport is open - connecting");if("/"!==(this||Ee).nsp)if((this||Ee).query){var gb="object"===typeof(this||Ee).query?Lc.encode((this||Ee).query):(this||Ee).query;Nc("sending connect packet with query %s",gb);this.packet({type:eb.CONNECT,query:gb})}else this.packet({type:eb.CONNECT})};pa.prototype.onclose=
function(gb){Nc("close (%s)",gb);(this||Ee).connected=!1;(this||Ee).disconnected=!0;delete (this||Ee).id;this.emit("disconnect",gb)};pa.prototype.onpacket=function(gb){var Gc=gb.type===eb.ERROR&&"/"===gb.nsp;if(gb.nsp===(this||Ee).nsp||Gc)switch(gb.type){case eb.CONNECT:this.onconnect();break;case eb.EVENT:this.onevent(gb);break;case eb.BINARY_EVENT:this.onevent(gb);break;case eb.ACK:this.onack(gb);break;case eb.BINARY_ACK:this.onack(gb);break;case eb.DISCONNECT:this.ondisconnect();break;case eb.ERROR:this.emit("error",
gb.data)}};pa.prototype.onevent=function(gb){var Gc=gb.data||[];Nc("emitting event %j",Gc);null!=gb.id&&(Nc("attaching ack callback to event"),Gc.push(this.ack(gb.id)));(this||Ee).connected?tc.apply(this||Ee,Gc):(this||Ee).receiveBuffer.push(Gc)};pa.prototype.ack=function(gb){var Gc=this||Ee,Cd=!1;return function(){if(!Cd){Cd=!0;var fe=ab(arguments);Nc("sending ack %j",fe);Gc.packet({type:Xb(fe)?eb.BINARY_ACK:eb.ACK,id:gb,data:fe})}}};pa.prototype.onack=function(gb){var Gc=(this||Ee).acks[gb.id];
"function"===typeof Gc?(Nc("calling ack %s with %j",gb.id,gb.data),Gc.apply(this||Ee,gb.data),delete (this||Ee).acks[gb.id]):Nc("bad ack %s",gb.id)};pa.prototype.onconnect=function(){(this||Ee).connected=!0;(this||Ee).disconnected=!1;this.emit("connect");this.emitBuffered()};pa.prototype.emitBuffered=function(){var gb;for(gb=0;gb<(this||Ee).receiveBuffer.length;gb++)tc.apply(this||Ee,(this||Ee).receiveBuffer[gb]);(this||Ee).receiveBuffer=[];for(gb=0;gb<(this||Ee).sendBuffer.length;gb++)this.packet((this||
Ee).sendBuffer[gb]);(this||Ee).sendBuffer=[]};pa.prototype.ondisconnect=function(){Nc("server disconnect (%s)",(this||Ee).nsp);this.destroy();this.onclose("io server disconnect")};pa.prototype.destroy=function(){if((this||Ee).subs){for(var gb=0;gb<(this||Ee).subs.length;gb++)(this||Ee).subs[gb].destroy();(this||Ee).subs=null}(this||Ee).io.destroy(this||Ee)};pa.prototype.close=pa.prototype.disconnect=function(){(this||Ee).connected&&(Nc("performing disconnect (%s)",(this||Ee).nsp),this.packet({type:eb.DISCONNECT}));
this.destroy();if((this||Ee).connected)this.onclose("io client disconnect");return this||Ee};pa.prototype.compress=function(gb){(this||Ee).flags.compress=gb;return this||Ee};pa.prototype.binary=function(gb){(this||Ee).flags.binary=gb;return this||Ee};return zk}function ta(){function pa(eb){eb=eb||{};(this||ij).ms=eb.min||100;(this||ij).max=eb.max||1E4;(this||ij).factor=eb.factor||2;(this||ij).jitter=0<eb.jitter&&1>=eb.jitter?eb.jitter:0;(this||ij).attempts=0}if(im)return Ik;im=!0;Ik=pa;pa.prototype.duration=
function(){var eb=(this||ij).ms*Math.pow((this||ij).factor,(this||ij).attempts++);if((this||ij).jitter){var nb=Math.random(),ab=Math.floor(nb*(this||ij).jitter*eb);eb=0==(Math.floor(10*nb)&1)?eb-ab:eb+ab}return Math.min(eb,(this||ij).max)|0};pa.prototype.reset=function(){(this||ij).attempts=0};pa.prototype.setMin=function(eb){(this||ij).ms=eb};pa.prototype.setMax=function(eb){(this||ij).max=eb};pa.prototype.setJitter=function(eb){(this||ij).jitter=eb};return Ik}function Ca(){function pa(gb,Gc){if(!((this||
Hd)instanceof pa))return new pa(gb,Gc);gb&&"object"===typeof gb&&(Gc=gb,gb=void 0);Gc=Gc||{};Gc.path=Gc.path||"/socket.io";(this||Hd).nsps={};(this||Hd).subs=[];(this||Hd).opts=Gc;this.reconnection(!1!==Gc.reconnection);this.reconnectionAttempts(Gc.reconnectionAttempts||Infinity);this.reconnectionDelay(Gc.reconnectionDelay||1E3);this.reconnectionDelayMax(Gc.reconnectionDelayMax||5E3);this.randomizationFactor(Gc.randomizationFactor||.5);(this||Hd).backoff=new Rb({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==Gc.timeout?2E4:Gc.timeout);(this||Hd).readyState="closed";(this||Hd).uri=gb;(this||Hd).connecting=[];(this||Hd).lastPing=null;(this||Hd).encoding=!1;(this||Hd).packetBuffer=[];gb=Gc.parser||mb;(this||Hd).encoder=new gb.Encoder;(this||Hd).decoder=new gb.Decoder;(this||Hd).autoConnect=!1!==Gc.autoConnect;(this||Hd).autoConnect&&this.open()}if(ck)return Li;ck=!0;ji||(ji=!0,dg=Tb(),dg.parser=db());var eb=dg;var nb=T(),ab=Vc(),mb=bc(),ic=wc(),Nc=I(),
Lc=Fd()("socket.io-client:manager"),Xb=kc(),Rb=ta(),tc=Object.prototype.hasOwnProperty;Li=pa;pa.prototype.emitAll=function(){(this||Hd).emit.apply(this||Hd,arguments);for(var gb in(this||Hd).nsps)tc.call((this||Hd).nsps,gb)&&(this||Hd).nsps[gb].emit.apply((this||Hd).nsps[gb],arguments)};pa.prototype.updateSocketIds=function(){for(var gb in(this||Hd).nsps)tc.call((this||Hd).nsps,gb)&&((this||Hd).nsps[gb].id=this.generateId(gb))};pa.prototype.generateId=function(gb){return("/"===gb?"":gb+"#")+(this||
Hd).engine.id};ab(pa.prototype);pa.prototype.reconnection=function(gb){if(!arguments.length)return(this||Hd)._reconnection;(this||Hd)._reconnection=!!gb;return this||Hd};pa.prototype.reconnectionAttempts=function(gb){if(!arguments.length)return(this||Hd)._reconnectionAttempts;(this||Hd)._reconnectionAttempts=gb;return this||Hd};pa.prototype.reconnectionDelay=function(gb){if(!arguments.length)return(this||Hd)._reconnectionDelay;(this||Hd)._reconnectionDelay=gb;(this||Hd).backoff&&(this||Hd).backoff.setMin(gb);
return this||Hd};pa.prototype.randomizationFactor=function(gb){if(!arguments.length)return(this||Hd)._randomizationFactor;(this||Hd)._randomizationFactor=gb;(this||Hd).backoff&&(this||Hd).backoff.setJitter(gb);return this||Hd};pa.prototype.reconnectionDelayMax=function(gb){if(!arguments.length)return(this||Hd)._reconnectionDelayMax;(this||Hd)._reconnectionDelayMax=gb;(this||Hd).backoff&&(this||Hd).backoff.setMax(gb);return this||Hd};pa.prototype.timeout=function(gb){if(!arguments.length)return(this||
Hd)._timeout;(this||Hd)._timeout=gb;return this||Hd};pa.prototype.maybeReconnectOnOpen=function(){!(this||Hd).reconnecting&&(this||Hd)._reconnection&&0===(this||Hd).backoff.attempts&&this.reconnect()};pa.prototype.open=pa.prototype.connect=function(gb,Gc){Lc("readyState %s",(this||Hd).readyState);if(~(this||Hd).readyState.indexOf("open"))return this||Hd;Lc("opening %s",(this||Hd).uri);(this||Hd).engine=eb((this||Hd).uri,(this||Hd).opts);var Cd=(this||Hd).engine,fe=this||Hd;(this||Hd).readyState="opening";
(this||Hd).skipReconnect=!1;var rd=ic(Cd,"open",function(){fe.onopen();gb&&gb()});Gc=ic(Cd,"error",function(Se){Lc("connect_error");fe.cleanup();fe.readyState="closed";fe.emitAll("connect_error",Se);if(gb){var Ue=Error("Connection error");Ue.data=Se;gb(Ue)}else fe.maybeReconnectOnOpen()});if(!1!==(this||Hd)._timeout){var ge=(this||Hd)._timeout;Lc("connect attempt will timeout after %d",ge);0===ge&&rd.destroy();var se=setTimeout(function(){Lc("connect attempt timed out after %d",ge);rd.destroy();Cd.close();
Cd.emit("error","timeout");fe.emitAll("connect_timeout",ge)},ge);(this||Hd).subs.push({destroy:function(){clearTimeout(se)}})}(this||Hd).subs.push(rd);(this||Hd).subs.push(Gc);return this||Hd};pa.prototype.onopen=function(){Lc("open");this.cleanup();(this||Hd).readyState="open";this.emit("open");var gb=(this||Hd).engine;(this||Hd).subs.push(ic(gb,"data",Nc(this||Hd,"ondata")));(this||Hd).subs.push(ic(gb,"ping",Nc(this||Hd,"onping")));(this||Hd).subs.push(ic(gb,"pong",Nc(this||Hd,"onpong")));(this||
Hd).subs.push(ic(gb,"error",Nc(this||Hd,"onerror")));(this||Hd).subs.push(ic(gb,"close",Nc(this||Hd,"onclose")));(this||Hd).subs.push(ic((this||Hd).decoder,"decoded",Nc(this||Hd,"ondecoded")))};pa.prototype.onping=function(){(this||Hd).lastPing=new Date;this.emitAll("ping")};pa.prototype.onpong=function(){this.emitAll("pong",new Date-(this||Hd).lastPing)};pa.prototype.ondata=function(gb){(this||Hd).decoder.add(gb)};pa.prototype.ondecoded=function(gb){this.emit("packet",gb)};pa.prototype.onerror=function(gb){Lc("error",
gb);this.emitAll("error",gb)};pa.prototype.socket=function(gb,Gc){function Cd(){~Xb(rd.connecting,fe)||rd.connecting.push(fe)}var fe=(this||Hd).nsps[gb];if(!fe){fe=new nb(this||Hd,gb,Gc);(this||Hd).nsps[gb]=fe;var rd=this||Hd;fe.on("connecting",Cd);fe.on("connect",function(){fe.id=rd.generateId(gb)});(this||Hd).autoConnect&&Cd()}return fe};pa.prototype.destroy=function(gb){gb=Xb((this||Hd).connecting,gb);~gb&&(this||Hd).connecting.splice(gb,1);(this||Hd).connecting.length||this.close()};pa.prototype.packet=
function(gb){Lc("writing packet %j",gb);var Gc=this||Hd;gb.query&&0===gb.type&&(gb.nsp+="?"+gb.query);Gc.encoding?Gc.packetBuffer.push(gb):(Gc.encoding=!0,(this||Hd).encoder.encode(gb,function(Cd){for(var fe=0;fe<Cd.length;fe++)Gc.engine.write(Cd[fe],gb.options);Gc.encoding=!1;Gc.processPacketQueue()}))};pa.prototype.processPacketQueue=function(){if(0<(this||Hd).packetBuffer.length&&!(this||Hd).encoding){var gb=(this||Hd).packetBuffer.shift();this.packet(gb)}};pa.prototype.cleanup=function(){Lc("cleanup");
for(var gb=(this||Hd).subs.length,Gc=0;Gc<gb;Gc++)(this||Hd).subs.shift().destroy();(this||Hd).packetBuffer=[];(this||Hd).encoding=!1;(this||Hd).lastPing=null;(this||Hd).decoder.destroy()};pa.prototype.close=pa.prototype.disconnect=function(){Lc("disconnect");(this||Hd).skipReconnect=!0;(this||Hd).reconnecting=!1;"opening"===(this||Hd).readyState&&this.cleanup();(this||Hd).backoff.reset();(this||Hd).readyState="closed";(this||Hd).engine&&(this||Hd).engine.close()};pa.prototype.onclose=function(gb){Lc("onclose");
this.cleanup();(this||Hd).backoff.reset();(this||Hd).readyState="closed";this.emit("close",gb);(this||Hd)._reconnection&&!(this||Hd).skipReconnect&&this.reconnect()};pa.prototype.reconnect=function(){if((this||Hd).reconnecting||(this||Hd).skipReconnect)return this||Hd;var gb=this||Hd;if((this||Hd).backoff.attempts>=(this||Hd)._reconnectionAttempts)Lc("reconnect failed"),(this||Hd).backoff.reset(),this.emitAll("reconnect_failed"),(this||Hd).reconnecting=!1;else{var Gc=(this||Hd).backoff.duration();
Lc("will wait %dms before reconnect attempt",Gc);(this||Hd).reconnecting=!0;var Cd=setTimeout(function(){gb.skipReconnect||(Lc("attempting reconnect"),gb.emitAll("reconnect_attempt",gb.backoff.attempts),gb.emitAll("reconnecting",gb.backoff.attempts),gb.skipReconnect||gb.open(function(fe){fe?(Lc("reconnect attempt error"),gb.reconnecting=!1,gb.reconnect(),gb.emitAll("reconnect_error",fe.data)):(Lc("reconnect success"),gb.onreconnect())}))},Gc);(this||Hd).subs.push({destroy:function(){clearTimeout(Cd)}})}};
pa.prototype.onreconnect=function(){var gb=(this||Hd).backoff.attempts;(this||Hd).reconnecting=!1;(this||Hd).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",gb)};return Li}var Mb=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");Mb.nyi=function(pa){throw Error("Not yet implemented: "+pa);};Mb.string=lb;Mb.promise=Eb;Mb.debugMessageOrder=!1;var vb=function(pa){this.id=Mb.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};vb.prototype.isOnline=function(){Mb.nyi("isOnline")};vb.prototype.open=function(){Mb.nyi("isOnline")};vb.prototype.close=function(){Mb.nyi("close")};vb.prototype.remove=function(){Mb.nyi("remove")};vb.prototype.whenOnline=function(pa){var eb=this;return Mb.promise.waitFor(pa,function(){return eb.isOnline()}).then(function(){return eb}).catch(function(nb){return Promise.reject(/timeout/i.test(String(nb))?
Error("Timeout in "+eb+".whenOnline"):nb)})};vb.prototype.onError=function(pa){this.debug&&console.log("["+this+"] error: "+pa)};vb.prototype.removeService=function(pa){delete this.actions[pa]};vb.prototype.removeServices=function(pa){var eb=this;pa.forEach(function(nb){return eb.removeService(nb)})};vb.prototype.addService=function(pa,eb){this.actions[pa]=eb};vb.prototype.addServices=function(pa){var eb=this;Object.keys(pa).forEach(function(nb){return eb.addService(nb,pa[nb])})};vb.prototype.ping=
function(pa){var eb=this,nb,ab,mb,ic,Nc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){if(1==Lc.nextAddress)return nb=Date.now(),Lc.yield(eb.sendToAndWait(pa,"l2l-ping",{timestamp:nb}),2);ab=Lc.yieldResult;mb=ab.data;ic=mb.timestamp;Nc=Date.now();return Lc.return({to:ic-nb,from:Nc-ic,roundtrip:Nc-nb})})};vb.prototype.send=function(pa,eb){Mb.nyi("send")};vb.prototype.sendAndWait=function(pa){var eb=this,nb,ab,mb,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nc){switch(Nc.nextAddress){case 1:return nb=
new Promise(function(Lc,Xb){return eb.send(pa,Lc)}),ab={},mb=eb.options.ackTimeout+400,"ackTimeout"in pa&&(mb=!pa.ackTimeout||0>pa.ackTimeout?null:pa.ackTimeout+400),mb?Nc.yield(Promise.race([Mb.promise.delay(mb,ab),nb]),5):Nc.yield(nb,4);case 4:ic=Nc.yieldResult;Nc.jumpTo(3);break;case 5:ic=Nc.yieldResult;case 3:if(ic===ab)throw Error("Timeout sending "+pa.action);return Nc.return(ic)}})};vb.prototype.sendTo=function(pa,eb,nb,ab){return this.send({target:pa,action:eb,data:nb},ab)};vb.prototype.sendToAndWait=
function(pa,eb,nb,ab){return this.sendAndWait(Object.assign({target:pa,action:eb,data:nb},ab))};vb.prototype.prepareSend=function(pa,eb){var nb=pa.target,ab=pa.action,mb=pa.messageId,ic=pa.sender;if(!ab)throw Error("Trying to send a message without specifying action!");if(!nb)throw Error("Trying to send message "+ab+" without specifying target!");mb||(pa.messageId=Mb.string.newUUID());ic||(pa.sender=this.id);ab=pa.n=this._outgoingOrderNumberingByTargets.get(nb)||0;this._outgoingOrderNumberingByTargets.set(nb,
ab+1);if("function"===typeof eb){ic=this;var Nc=eb;eb=function(Lc){var Xb=ic._incomingOrderNumberingBySenders.get(Lc.sender)||0;ic.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+ic+" received ack for "+Lc.action+" as msg "+Xb);try{Nc.apply(null,arguments)}catch(Rb){console.error("Error in ack fn of "+ic+": "+Rb.stack)}ic._incomingOrderNumberingBySenders.set(Lc.sender,Xb+1);setTimeout(function(){return ic.invokeOutOfOrderMessages(Lc.sender)},0)}}this.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+ab+" ("+pa.action+") to "+nb);return[pa,eb]};vb.prototype.prepareAnswerMessage=function(pa,eb){return{action:pa.action+"-response",inResponseTo:pa.messageId,target:pa.sender,data:eb,sender:this.id}};vb.prototype.installEventToMessageTranslator=function(pa){var eb=this,nb=pa.onevent;pa.onevent=function(ab){var mb=ab.data||[];nb.call(this,ab);ab.data=["*"].concat(mb);nb.call(this,ab)};pa.on("*",function(ab,mb){ab&&"object"===typeof ab&&ab.action&&(mb=ab,ab=mb.action);var ic=arguments[arguments.length-
1];ic="function"===typeof ic?ic:null;(mb=mb===ic?null:mb)&&mb.data&&("number"===typeof mb.n||mb.broadcast)&&mb.sender?eb.receive(mb,pa,ic):(console.warn(eb+" received non-conformant message "+ab+":",arguments),"function"===typeof ic&&ic({data:{error:"invalid l2l message"}}))})};vb.prototype.receive=function(pa,eb,nb){this.dispatchL2LMessageToSelf(pa,eb,nb)};vb.prototype.dispatchL2LMessageToSelf=function(pa,eb,nb){var ab=this,mb=pa.action;if(pa.broadcast)this.safeInvokeServiceHandler(mb,pa,nb,eb);
else try{var ic=this._incomingOrderNumberingBySenders.get(pa.sender)||0,Nc="register"===mb||"unregister";if(!Nc&&pa.n<ic)console.error("[MSG ORDER] ["+this+"] received message no. "+pa.n+" but expected >= "+ic+", dropping "+mb);else if(!Nc&&pa.n>ic){this.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+mb+" ("+pa.n+") for later invocation");var Lc=this._outOfOrderCacheBySenders.get(pa.sender);Lc||(Lc=[],this._outOfOrderCacheBySenders.set(pa.sender,Lc));
Lc.push([mb,pa,nb,eb])}else this.safeInvokeServiceHandler(mb,pa,nb,eb),setTimeout(function(){return ab.invokeOutOfOrderMessages(pa.sender)},0)}catch(Xb){console.error("Error message ordering when handling "+mb+": "+(Xb.stack||Xb)),"function"===typeof nb&&nb(this.prepareAnswerMessage(pa,{isError:!0,error:String(Xb.stack||Xb)}))}};vb.prototype.invokeOutOfOrderMessages=function(pa){var eb=this._outOfOrderCacheBySenders.get(pa);if(eb&&eb.length){var nb=this._incomingOrderNumberingBySenders.get(pa)||0;
pa=eb.findIndex(function(ab){ab=$jscomp.makeIterator(ab);ab.next();return ab.next().value.n===nb});-1!==pa&&(eb.splice(pa,1),this.invokeServiceHandler.apply(this,eb[pa]))}};vb.prototype.renameTarget=function(pa,eb){if(pa!==eb){var nb=this._outgoingOrderNumberingByTargets.get(pa);this._outgoingOrderNumberingByTargets.delete(pa);this._outgoingOrderNumberingByTargets.set(eb,nb)}};vb.prototype.safeInvokeServiceHandler=function(pa,eb,nb,ab){try{"function"===typeof this.actions[pa]?this.invokeServiceHandler(pa,
eb,nb,ab):ab._events&&Object.keys(ab._events).includes(pa)||(console.warn("WARNING ["+this+"] Unhandled message: "+pa),"function"===typeof nb&&nb(this.prepareAnswerMessage(eb,{isError:!0,error:"message not understood: "+pa})))}catch(mb){console.error("Error when handling "+pa+": "+(mb.stack||mb)),"function"===typeof nb&&nb(this.prepareAnswerMessage(eb,{isError:!0,error:String(mb.stack||mb)}))}};vb.prototype.invokeServiceHandler=function(pa,eb,nb,ab){var mb=this;this.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+eb.n+" ("+eb.action+") from "+eb.sender);this._incomingOrderNumberingBySenders.set(eb.sender,eb.n+1);if("function"===typeof nb){var ic=!1,Nc=!1,Lc="ackTimeout"in eb?eb.ackTimeout:this.options.ackTimeout,Xb=this._outgoingOrderNumberingByTargets.get(eb.sender)||0;this._outgoingOrderNumberingByTargets.set(eb.sender,Xb+1);var Rb=function(tc){Nc?console.warn("["+mb+"] ackFn for "+eb.action+" called after it timed out, dropping answer!"):ic?console.warn("["+mb+"] ack function called repeatedly when handling "+
eb.action):(ic=!0,nb(mb.prepareAnswerMessage(eb,tc)),mb.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+mb+" sending "+Xb+" (ack for "+eb.action+")"))};Lc&&setTimeout(function(){ic||(Rb({isError:!0,error:"Timeout error: "+mb+" did not send answer for "+eb.action+" after "+Lc+"ms"}),Nc=!0)},Lc)}try{this.actions[pa].call(this,this,eb,Rb,ab)}catch(tc){console.error("["+this+"] Error handling "+pa+": "+(tc.stack||tc)),Rb&&Rb({error:tc.stack})}};$jscomp.global.Object.defineProperties(vb.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(pa){this.options.debug=pa}}});Mb.L2LConnection=vb;Mb.default=vb;var Ia=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),Qb={"l2l-ping":function(pa,eb,nb,ab){ab=eb.sender;eb=eb.data.timestamp;var mb=Date.now();"function"===typeof nb&&nb({timestamp:mb});pa.debug&&console.log("[undefined] got ping from "+ab+", time: "+(mb-eb)+"ms")},"remote-eval":function(pa,eb,nb,ab){var mb=eb.data.source;
Promise.resolve().then(function(){return eval(mb)}).then(function(ic){return nb({value:ic})}).catch(function(ic){ic.originalErr&&(ic=ic.originalErr);console.error("eval error: "+ic);"function"===typeof nb&&nb({isError:!0,value:String(ic.stack||ic)})})},"remote-eval-2":function(pa,eb,nb,ab){var mb=eb.data.source;Promise.resolve().then(function(){var ic=eval(mb);if(!(ic instanceof Promise))throw console.error("unexpected eval result:"+ic),Error("unexpected eval result:"+ic);return ic}).then(function(ic){return nb(ic)}).catch(function(ic){console.error("eval error: "+
ic);ic.originalErr&&(ic=ic.originalErr);"function"===typeof nb&&nb({isError:!0,value:String(ic.stack||ic)})})}};Ia.defaultActions=Qb;Ia.defaultActions=Qb;Ia.defaultActions=Qb;var Kc={},Rc=(Kc["[broadcast] send"]=function(pa,eb,nb,ab){var mb=eb.sender,ic=eb.data,Nc,Lc,Xb,Rb,tc,gb,Gc,Cd,fe,rd,ge,se;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Se){Nc=ic;Lc=Nc.action;Xb=Nc.broadcast;Rb=Nc.room;tc=Nc.namespace;gb=Nc.isSystemBroadcast;Gc=Nc.isMultiServerBroadcast;Cd=[];Gc?(console.log(".......isMultiServerBroadcast"),
fe=pa,rd=fe.id,ge=pa.getTrackerList(),console.log(ge),Cd=ge.map(function(Ue){return Ue.id!=rd?Ue.io.nsps["/"+Ue.namespace]:ab.broadcast})):(gb&&(tc=pa.namespace),Cd.push(tc?pa.io.nsps["/"+tc]:ab.broadcast));Cd.forEach(function(Ue){return Ue.to(Rb).emit({action:Lc,sender:mb,broadcast:!0,data:Xb})});nb&&"function"===typeof nb&&(se="message broadcasted to "+Rb,tc&&(se+=" in namespace "+tc),1<Cd.length&&(se+=" "+Cd.length+" trackers"),console.log(se),nb({status:se}));Se.jumpToEnd()})},Kc["[broadcast] join room"]=
function(pa,eb,nb,ab){var mb=eb.sender,ic=eb.data.room,Nc,Lc,Xb,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return Lc=!1,Xb=pa.io.nsps["/"+pa.namespace].adapter.rooms,(Rb=Xb[ic]&&Xb[ic].sockets&&Xb[ic].sockets[ab.id])?(Nc=mb+" already in "+ic,tc.jumpTo(2)):tc.yield(new Promise(function(gb,Gc){return ab.join(ic,function(Cd){return Cd?Gc(Cd):gb()})}),3);2!=tc.nextAddress&&(Nc=mb+" joined "+ic,Lc=!0);nb&&"function"===typeof nb&&nb({status:Nc,joined:Lc});tc.jumpToEnd()})},
Kc["[broadcast] leave room"]=function(pa,eb,nb,ab){var mb=eb.sender,ic=eb.data.room,Nc,Lc,Xb,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return Lc=!1,Xb=pa.io.nsps["/"+pa.namespace].adapter.rooms,Rb=Xb[ic]&&Xb[ic].sockets&&Xb[ic].sockets[ab.id],Rb?tc.yield(new Promise(function(gb,Gc){return ab.leave(ic,function(Cd){return Cd?Gc(Cd):gb()})}),3):(Nc=mb+" not in "+ic,tc.jumpTo(2));2!=tc.nextAddress&&(Nc=mb+" left room "+ic,Lc=!0);console.log(Nc);nb&&"function"===
typeof nb&&nb({left:Lc,status:Nc});tc.jumpToEnd()})},Kc["[broadcast] my rooms"]=function(pa,eb,nb,ab){nb(ab.rooms)},Kc["[broadcast] all rooms"]=function(pa,eb,nb,ab){nb(pa.io.nsps["/"+pa.namespace].adapter.rooms)},Kc["[broadcast] list room members"]=function(pa,eb,nb,ab){eb=eb.data.room;ab=pa.io;eb?(pa=ab.nsps["/"+pa.namespace].adapter.rooms[eb],nb({room:eb,sockets:pa?pa.sockets:{},length:pa?pa.length:0})):nb({isError:!0,error:"`room` paramerter missing!"})},Kc.getClients=function(pa,eb,nb){pa.removeDisconnectedClients();
nb(Array.from(pa.clients))},Kc);Ia.defaultTrackerActions=Rc;Ia.defaultTrackerActions=Rc;Ia.defaultTrackerActions=Rc;var xc={},Fa=(xc.getRoomList=function(pa){var eb=pa.client,nb=pa.ackFn,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){ab=eb._socketioClient.rooms;nb(ab);mb.jumpToEnd()})},xc["ask for"]=function(pa,eb,nb,ab){var mb=eb.sender,ic=eb.data.query,Nc=this,Lc,Xb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){if(1==Rb.nextAddress)return Lc=ic.match(/password|sudo/i)?
"passwordPrompt":"prompt",Rb.yield($world[Lc](ic),2);Xb=Rb.yieldResult;"function"===typeof nb&&nb({answer:Xb});pa.debug&&console.log("["+Nc+"] message 'ask for' from "+mb+", query: "+ic);Rb.jumpToEnd()})},xc["open editor"]=function(pa,eb,nb,ab){var mb=eb.data.args,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nc){if(1==Nc.nextAddress)return mb.length?Nc.yield($world.execCommand("open file for EDITOR",{url:mb[0]}),2):(nb({error:"no file specified"}),Nc.return());ic=Nc.yieldResult;
"function"===typeof nb&&nb("aborted"===ic?{error:String(ic)}:{status:ic});Nc.jumpToEnd()})},xc.changeWorkingDirectory=function(pa,eb,nb,ab){var mb=eb.data.args,ic,Nc,Lc,Xb,Rb,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){ic=$jscomp.makeIterator(mb||[]);Nc=ic.next().value;Lc=ic.next().value;Xb="OK";try{if(Nc)if(Lc){if(Rb=$world.getMorphWithId(Lc))if(Rb.__lookupSetter__("cwd"))Rb.cwd=Nc;else if("function"===typeof Rb.changeWorkingDirectory)Rb.changeWorkingDirectory(Nc);else if("function"===
typeof Rb.pluginFind){if(tc=Rb.pluginFind(function(Gc){return Gc.isShellEditorPlugin}))tc.cwd=Nc}else Xb="[changeWorkingDirectory] cannot figure pout how to set dir"}else Xb="[changeWorkingDirectory] No command morph";else Xb="[changeWorkingDirectory] No directory received"}catch(Gc){Xb=String(Gc)}"OK"!==Xb&&console.warn(Xb);"function"===typeof nb&&nb(Xb);gb.jumpToEnd()})},xc);Ia.defaultClientActions=Fa;Ia.defaultClientActions=Fa;Ia.defaultClientActions=Fa;var nc={},$a=!1,Pa={},Oa=!1,Kb={},Ib=!1,
cd="undefined"!==typeof self?self:global,Od={},Zd=!1,Te="undefined"!==typeof self?self:global,Qc={},Xd=!1,kd={},Ab=!1,da="undefined"!==typeof self?self:global,qa={},ub=!1,H={},ia=!1,Ba={},rb=!1,sc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,yc={},Gd=!1,Ld="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ke={},id=!1,Md={},ze=!1,Ne={},yf=!1,tf={},vc=!1,Fe={},mf=!1,Jf={},ye=!1,va={},Ka=!1,sb={},Q=!1,ua={},Za=!1,ib={},oc=!1,cc={},bd=
!1,Tc={},Wc=!1,Yd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Mf={},Bf=!1,Hg={},df=!1,Bg={},Di=!1,Pg={},Nj=!1,Oe="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ki={},Kh=!1,be="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,gj={},Mj=!1,lg="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,yk={},Tj=!1,Bj={},Bh=!1,zf="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,$e={},ll=!1,Sa={},Xc=!1,Wd={},Td=!1,Hc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,dg={},ji=!1,Rk={},Cm=!1,Um={},hj=!1,Jl={},Pk=!1,zk={},Kl=!1,Ee="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ik={},im=!1,ij="undefined"!==typeof self?self:global,Li={},ck=!1,Hd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Aj={},jj=!1,Qk=function(){function pa(Nc,Lc){"object"===typeof Nc&&
(Lc=Nc,Nc=void 0);Lc=Lc||{};Nc=eb(Nc);var Xb=Nc.source,Rb=Nc.id,tc=Nc.path;tc=ic[Rb]&&tc in ic[Rb].nsps;Lc.forceNew||Lc["force new connection"]||!1===Lc.multiplex||tc?(mb("ignoring socket cache for %s",Xb),Xb=ab(Xb,Lc)):(ic[Rb]||(mb("new io instance for %s",Xb),ic[Rb]=ab(Xb,Lc)),Xb=ic[Rb]);Nc.query&&!Lc.query&&(Lc.query=Nc.query);return Xb.socket(Nc.path,Lc)}if(jj)return Aj;jj=!0;var eb=md(),nb=bc(),ab=Ca(),mb=Fd()("socket.io-client");Aj=Aj=pa;var ic=Aj.managers={};Aj.protocol=nb.protocol;Aj.connect=
pa;Aj.Manager=Ca();Aj.Socket=T();return Aj}(),Lf=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Lf.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Lf.isNode?System._nodeRequire("os").hostname():System.baseURL};Lf.promise=Eb;Lf.fun=qd;Lf.obj=Ec;Lf.events=vd;Lf.num=Ic;Lf.L2LConnection=vb;Lf.defaultActions=Qb;Lf.defaultClientActions=Fa;Lf.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Lf._ioClient=Qk;Lf.ioClient=Lf.ioClient||void 0;Lf.isNode?(Lf.require=System._nodeRequire("module")._load,Lf.ioClient=Lf.require("socket.io-client")):Lf.ioClient=Lf._ioClient;Lf.urlHelper={isRoot:function(pa){return"/"===Lf.urlHelper.path(pa)},root:function(pa){return Lf.urlHelper.isRoot(pa)?pa:pa.slice(0,-Lf.urlHelper.path(pa).length)+"/"},path:function(){var pa=/^[a-z0-9-_\.]+:/,eb=/^\/\/[^\/]+/;return function(nb){nb=nb.replace(pa,"").replace(eb,"");return""===nb?"/":nb}}(),join:function(pa,
eb){pa.endsWith("/")&&(pa=pa.slice(0,-1));eb.startsWith("/")&&(eb=eb.slice(1));return pa+"/"+eb}};var sg=function(pa,eb,nb,ab){var mb=Lf.L2LConnection.call(this)||this;Lf.events.makeEmitter(mb);mb.info=ab;mb.origin=pa;mb.path=eb;mb.namespace=nb.replace(/^\/?/,"/");mb.trackerId=null;mb._socketioClient=null;mb._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Lf.defaultActions).forEach(function(ic){return mb.addService(ic,
Lf.defaultActions[ic])});Object.keys(Lf.defaultClientActions).forEach(function(ic){return mb.addService(ic,Lf.defaultClientActions[ic])});return mb};$jscomp.inherits(sg,Lf.L2LConnection);sg.clientKey=function(pa,eb,nb){pa=pa.replace(/\/$/,"");eb=eb.replace(/^\//,"");nb=nb.replace(/^\//,"");return pa+"-"+eb+"-"+nb};sg.forLivelyInBrowser=function(pa){var eb=!!pa;pa=Object.assign({type:"lively.morphic browser"},pa);var nb=this.default();if(!nb)return Lf.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:pa});eb&&!Lf.obj.equals(nb.info,pa)&&nb.isRegistered()&&(nb.info=pa,nb.unregister().then(function(){return nb.register()}).catch(function(ab){return console.error("l2l re-register on info change errored: "+ab)}));return nb};sg.default=function(){var pa=Lf.L2LClient.clients.keys().next().value;return Lf.L2LClient.clients.get(pa)};sg.create=function(pa){var eb=pa=void 0===pa?{}:pa;pa=void 0===eb.debug?!1:eb.debug;var nb=eb.url,ab=eb.namespace,mb=void 0===eb.autoOpen?
!0:eb.autoOpen;eb=void 0===eb.info?{}:eb.info;if(!nb)throw Error("L2LClient needs server url!");var ic=Lf.urlHelper.root(nb).replace(/\/+$/,"");nb=Lf.urlHelper.path(nb);ab=new this(ic,nb,ab||"",eb);mb&&ab.register();ab.debug=pa;return ab};sg.ensure=function(pa){var eb=pa=void 0===pa?{}:pa,nb=eb.url;eb=eb.namespace;if(!nb)throw Error("L2LClient needs server url!");var ab=Lf.urlHelper.root(nb).replace(/\/+$/,""),mb=Lf.urlHelper.path(nb);ab=this.clientKey(ab,mb,eb||"");(mb=this.clients.get(ab))||this.clients.set(ab,
mb=this.create(Object.assign({},pa,{url:nb,namespace:eb})));return mb};sg.prototype.isOnline=function(){return this.socket&&this.socket.connected};sg.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};sg.prototype.open=function(){var pa=this,eb,nb,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){if(1==mb.nextAddress)return pa.isOnline()||pa._reconnectState.isOpening?mb.return(pa):mb.yield(pa.close(),2);pa._reconnectState.closed=!1;eb=Lf.urlHelper.join(pa.origin,
pa.namespace);nb={path:pa.path,transports:["websocket","polling"]};ab=pa._socketioClient=Lf.ioClient(eb,nb);pa.debug&&console.log("["+pa+"] connecting");ab.on("error",function(ic){pa._reconnectState.isOpening=!1;pa.debug&&console.log("["+pa+"] errored: "+ic)});ab.on("close",function(ic){return pa.debug&&console.log("["+pa+"] closed: "+ic)});ab.on("reconnect_failed",function(){return pa.debug&&console.log("["+pa+"] could not reconnect")});ab.on("reconnect_error",function(ic){return pa.debug&&console.log("["+
pa+"] reconnect error "+ic)});ab.on("connect",function(){pa.debug&&console.log("["+pa+"] connected");pa.emit("connected",pa);pa._reconnectState.isOpening=!1;pa._reconnectState.isReconnecting=!1;pa._reconnectState.isReconnectingViaSocketio=!1});ab.on("disconnect",function(){pa._reconnectState.isOpening=!1;pa.debug&&console.log("["+pa+"] disconnected");pa.emit("disconnected",pa);pa.trackerId?("tracker"!==pa.trackerId&&(pa.renameTarget(pa.trackerId,"tracker"),pa.trackerId=null),pa._reconnectState.closed?
pa.debug&&console.log("["+pa+"] won't reconnect b/c client is marked as closed"):pa._reconnectState.autoReconnect?(pa._reconnectState.isReconnecting=!0,setTimeout(function(){pa._reconnectState.closed?pa.debug&&console.log("["+pa+"] won't reconnect b/c client is marked as closed 2"):pa._reconnectState.isReconnectingViaSocketio?pa.debug&&console.log("["+pa+"] won't reconnect again, client already reconnecting"):(pa.debug&&console.log("["+pa+"] initiating reconnection to tracker"),pa.register())},20)):
pa.debug&&console.log("["+pa+"] won't reconnect b/c client has reconnection disabled")):(pa.debug&&console.log("["+pa+"] disconnect: don't have a tracker id, won't try reconnect"),pa.trackerId="tracker")});ab.on("reconnecting",function(){pa.debug&&console.log("["+pa+"] reconnecting",pa._reconnectState);pa.emit("reconnecting",pa);pa._reconnectState.closed?(pa._reconnectState.isReconnecting=!1,pa._reconnectState.isReconnectingViaSocketio=!1,ab.close(),pa.close()):(pa._reconnectState.isReconnecting=
!0,pa._reconnectState.isReconnectingViaSocketio=!0)});ab.on("reconnect",function(){pa.debug&&console.log("["+pa+"] reconnected");pa._reconnectState.isReconnecting=!1;pa._reconnectState.isReconnectingViaSocketio=!1;pa.register()});pa.installEventToMessageTranslator(ab);pa._reconnectState.isOpening=!0;return mb.return((new Promise(function(ic,Nc){ab.once("error",Nc);ab.once("connect",ic)})).then(function(){return pa}))})};sg.prototype.close=function(){var pa=this,eb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==
ab.nextAddress){pa._reconnectState.closed=!0;if(eb=pa.socket)eb.removeAllListeners("reconnect"),eb.removeAllListeners("reconnecting"),eb.removeAllListeners("disconnect"),eb.removeAllListeners("connect"),eb.removeAllListeners("reconnect_error"),eb.removeAllListeners("reconnect_failed"),eb.removeAllListeners("close"),eb.removeAllListeners("error"),eb.close();pa.debug&&console.log("["+pa+"] closing...");return pa.isRegistered()?ab.yield(pa.unregister(),2):ab.jumpTo(2)}return pa.isOnline()||pa.socket?
eb&&!eb.connected?(pa.debug&&console.log("["+pa+"] socket not connected, considering client closed"),ab.return(pa)):ab.return(Promise.race([Lf.promise.delay(2E3).then(function(){return eb.removeAllListeners("disconnect")}),new Promise(function(mb){return eb.once("disconnect",mb)})]).then(function(){pa.debug&&console.log("["+pa+"] closed");return pa})):(pa.debug&&(nb=pa.isOnline()?"no socket":"not online",pa.debug&&console.log("["+pa+"] cannot close: "+nb)),ab.return(pa))})};sg.prototype.remove=function(){var pa=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(pa);return this.close()};sg.prototype.register=function(){var pa=this,eb,nb,ab,mb,ic,Nc,Lc,Xb,Rb,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:if(pa.isRegistered())return gb.return();if(pa._reconnectState.closed)return pa.debug&&console.log("["+pa+"] not registering this b/c closed"),pa._reconnectState.registerAttempt=0,gb.return();if(pa._reconnectState.registerProcess)return pa.debug&&
console.log("["+pa+"] not registering this b/c register process exists"),gb.return();gb.setCatchFinallyBlocks(2);if(pa.isOnline()){gb.jumpTo(4);break}return gb.yield(pa.open(),4);case 4:return pa.debug&&console.log("["+pa+"] register"),gb.yield(pa.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Lf.isNode?"node":"browser"),location:Lf.determineLocation()},pa.info)),6);case 6:eb=gb.yieldResult;if(!eb.data)throw nb=Error("Register answer is empty!"),pa.emit("error",
nb),nb;if(eb.data.isError)throw ab=Error(eb.data.error),pa.emit("error",ab),ab;pa._reconnectState.registerAttempt=0;mb=eb;ic=mb.data;Nc=ic.trackerId;Lc=ic.messageNumber;pa.trackerId=Nc;pa._incomingOrderNumberingBySenders.set(Nc,Lc||0);pa.emit("registered",{trackerId:Nc});gb.leaveTryBlock(0);break;case 2:Xb=gb.enterCatchBlock(),console.error("Error in register request of "+pa+": "+Xb),Rb=pa._reconnectState.registerAttempt++,tc=Lf.num.backoff(Rb,4,3E5),pa._reconnectState.registerProcess=setTimeout(function(){pa._reconnectState.registerProcess=
null;pa.register()},tc),gb.jumpToEnd()}})};sg.prototype.unregister=function(){var pa=this,eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){switch(nb.nextAddress){case 1:if(!pa.isRegistered())return nb.return();pa.debug&&console.log("["+pa+"] unregister");eb=pa.trackerId;nb.setCatchFinallyBlocks(2);return nb.yield(pa.sendToAndWait(pa.trackerId,"unregister",{}),4);case 4:nb.leaveTryBlock(3);break;case 2:nb.enterCatchBlock();case 3:pa.renameTarget(eb,"tracker"),pa.trackerId=null,pa.emit("unregistered",
pa),nb.jumpToEnd()}})};sg.prototype.whenRegistered=function(pa){var eb=this;return Lf.promise.waitFor(pa,function(){return eb.isRegistered()}).catch(function(nb){return Promise.reject(/timeout/i.test(String(nb))?Error("Timeout in "+eb+".whenRegistered"):nb)})};sg.prototype.send=function(pa,eb){var nb=this,ab=$jscomp.makeIterator(this.prepareSend(pa,eb));pa=ab.next().value;eb=ab.next().value;this.whenOnline().then(function(){var mb=nb.socket,ic=pa,Nc=ic.action;ic=ic.target;if(!mb)throw Error("Trying to send message "+
Nc+" to "+ic+" but cannot find a connection to it!");"function"===typeof eb?mb.emit(Nc,pa,eb):mb.emit(Nc,pa)})};sg.prototype.joinRoom=function(pa){var eb=this;return this.whenOnline().then(function(){return eb.sendToAndWait(eb.trackerId,"[broadcast] join room",{room:pa})})};sg.prototype.leaveRoom=function(pa){var eb=this;return this.whenOnline().then(function(){return eb.sendToAndWait(eb.trackerId,"[broadcast] leave room",{room:pa})})};sg.prototype.broadcast=function(pa,eb,nb,ab,mb){var ic=this,Nc=
{action:eb,room:pa,broadcast:nb};if(void 0===ab?0:ab)Nc.isSystemBroadcast=!0;if(void 0===mb?0:mb)Nc.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return ic.sendToAndWait(ic.trackerId,"[broadcast] send",Nc)})};sg.prototype.listRoomMembers=function(pa){var eb=this,nb,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){if(1==mb.nextAddress)return mb.yield(eb.sendToAndWait(eb.trackerId,"[broadcast] list room members",{room:pa}),2);nb=mb.yieldResult;ab=nb.data;return mb.return(ab)})};
sg.prototype.joinedRooms=function(){var pa=this,eb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==ab.nextAddress)return ab.yield(pa.sendToAndWait(pa.trackerId,"[broadcast] my rooms",{}),2);eb=ab.yieldResult;nb=eb.data;return ab.return(nb)})};sg.prototype.listRooms=function(){var pa=this,eb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==ab.nextAddress)return ab.yield(pa.sendToAndWait(pa.trackerId,"[broadcast] all rooms",{}),2);eb=ab.yieldResult;nb=
eb.data;return ab.return(nb)})};sg.prototype.listPeers=function(pa){pa=void 0===pa?!1:pa;var eb=this,nb,ab,mb,ic,Nc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xb){if(1==Xb.nextAddress)return nb=eb,ab=nb._peersCached,mb=Date.now(),!pa&&ab&&1E3>mb-ab.timestamp?Xb.return(eb._peersCached.sessions):eb.isOnline()?Xb.yield(eb.sendToAndWait(eb.trackerId,"getClients",{}),2):Xb.return([]);ic=Xb.yieldResult;Nc=ic.data;Lc=Nc.map(function(Rb){var tc=$jscomp.makeIterator(Rb);Rb=tc.next().value;
var gb=tc.next().value,Gc=gb.info||{};tc=Gc.userRealm;var Cd=Gc.userToken,fe=Gc.l2lUserToken,rd=Gc.location,ge=Gc.type;Gc=Gc.world;Rb=Object.assign({},Lf.obj.dissoc(gb,["info"]),{id:Rb,world:Gc,location:rd,type:ge});(Cd=Cd||fe)&&"null"!==Cd&&(lively.user?Rb.user=lively.user.ClientUser.fromToken(Cd,tc):(Rb.userToken=Cd,Rb.userRealm=tc));return Rb});eb._peersCached={timestamp:mb,sessions:Lc};return Xb.return(Lc)})};sg.prototype.toString=function(){var pa=this.origin,eb=this.path,nb=this.namespace,ab=
this.id,mb=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(ab||"").slice(0,5)+" "+pa+eb+" - "+nb+" "+mb+")"};$jscomp.global.Object.defineProperties(sg.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(sg,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});sa("default",sg);Lf.L2LClient=sg;Lf.default=sg}}});