System.register(["./__root_module__-c4f77fb9.js","kld-intersections"],function(ra){var jb,pb,Ub,Jb,jd,uc,nd,wc,Cc,Mc,Bd,re,Ce;return{setters:[function(be){jb=be.bu;pb=be.a6;Ub=be.r;Jb=be.a8;jd=be.$;uc=be.bv;nd=be.bw;wc=be.T;Cc=be.a7;Mc=be.bx;Bd=be.by;re=be.l;Ce=be.bz},function(){}],execute:function(){function be(ba){try{var xa=eval("("+tb.ast.transform.wrapInFunction("var _; _ = ("+ba+")")+")()")}catch(M){return JSON.parse(ba)}return"object"!==typeof xa?null:xa}function Sb(ba,xa){var M,ha,Ka,
$a,$b,Tc,Yb,ub,qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Uc){switch(Uc.nextAddress){case 1:return M=xa.world(),Uc.yield(M.prompt("Enter package name",{requester:xa,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:ha=Uc.yieldResult;if(!ha)throw"Canceled";Uc.setCatchFinallyBlocks(3);$a=Aa.resource(ha);ha=$a.name();Ka=$a.url;Uc.leaveTryBlock(4);break;case 3:return Uc.enterCatchBlock(),Uc.yield(ba.getConfig(),5);case 5:return $b=Uc.yieldResult.baseURL,
Tc=Aa.resource($b).join(ha).asDirectory().url,Uc.yield(ba.normalize(Tc),6);case 6:Ka=Uc.yieldResult.replace(/\/\.js$/,"/");case 4:return Uc.yield(M.prompt("Confirm or change package location",{requester:xa,input:Ka,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Yb=Uc.yieldResult;if(!Yb)throw"Canceled";ub=Aa.resource(Yb).asDirectory();qd=ub.asFile().url;return Uc.yield(ba.removePackage(qd),8);case 8:return Uc.yield(ba.resourceCreateFiles(qd,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
ha+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+ha+"\n\nNo description for package "+ha+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+ha+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Uc.return(Aa.loadPackage(ba,{name:ha,address:qd,configFile:ub.join("package.json").url,main:ub.join("index.js").url,test:ub.join("tests/test.js").url,type:"package"}))}})}function qc(ba,xa,M){M=void 0===M?
null:M;var ha,Ka,$a,$b,Tc,Yb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qd){switch(qd.nextAddress){case 1:return ha={name:"",address:"",type:"package"},qd.yield(ba.getConfig(),2);case 2:Ka=qd.yieldResult;if(!M){qd.jumpTo(3);break}return qd.yield(ba.getPackage(M),4);case 4:if($a=qd.yieldResult){qd.jumpTo(5);break}return qd.yield(ba.getPackageForModule(M),6);case 6:$a=qd.yieldResult;case 5:$b=$a;case 3:return qd.yield(xa.world().prompt("What is the package directory?",{requester:xa,
input:$b?$b.address:Ka.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Tc=qd.yieldResult;if(!Tc)throw"Canceled";ha.address=Tc.replace(/\/$/,"");ha.url=new URL(ha.address+"/");ha.configFile=Aa.resource(ha.url).join("package.json").url;qd.setCatchFinallyBlocks(8);Yb=JSON;ub=Yb.parse;return qd.yield(ba.moduleRead(ha.configFile),10);case 10:ub.call(Yb,qd.yieldResult).name;qd.leaveTryBlock(9);break;case 8:qd.enterCatchBlock(),ha.name=String(ha.url).replace(/\/$/,""),
ba.resourceEnsureExistance(ha.configFile,'{\n  "name": "'+ha.name+'",\n  "version": "0.1.0"\n}');case 9:return qd.return(Aa.loadPackage(ba,ha))}})}function od(ba,xa,M){var ha,Ka,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function($b){switch($b.nextAddress){case 1:return ha=Aa.resource(M).asFile().url,$b.yield(ba.getPackage(ha),2);case 2:if(Ka=$b.yieldResult){$b.jumpTo(3);break}return $b.yield(ba.getPackageForModule(ha),4);case 4:Ka=$b.yieldResult;case 3:$a=Ka;if(!$a)throw Error("Cannot find package for "+
ha);return $b.yield(ba.reloadPackage(ha),5);case 5:if(!xa){$b.jumpTo(0);break}return $b.yield(xa.updateModuleList(),7);case 7:return $b.yield(xa.uiSelect(ha,!1),8);case 8:return $b.return($b.yieldResult)}})}function Tb(ba,xa,M,ha){var Ka,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function($b){switch($b.nextAddress){case 1:return $b.yield(ba.getPackage(M),2);case 2:return Ka=$b.yieldResult,$b.yield((ha||$world).confirm("Unload package "+Ka.name+"?",{requester:xa}),3);case 3:$a=$b.yieldResult;
if(!$a)throw"Canceled";return $b.yield(ba.removePackage(M),4);case 4:if(!xa){$b.jumpTo(0);break}return $b.yield(xa.updateModuleList(),6);case 6:return $b.yield(xa.uiSelect(null),0)}})}function wd(ba,xa,M){var ha,Ka,$a,$b,Tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Yb){switch(Yb.nextAddress){case 1:return ha=xa.world(),Yb.yield(ba.getPackage(M),2);case 2:return Ka=Yb.yieldResult,Ka?Yb.yield(ha.confirm("Really remove package "+Ka.name+"?",{requester:xa}),3):($world.inform('No package "'+
M+'" found!',{requester:xa}),Yb.return());case 3:$a=Yb.yieldResult;if(!$a)throw"Canceled";ba.removePackage(M);return Yb.yield(ha.confirm("Also remove directory "+Ka.name+" including "+Ka.modules.length+" modules?"),4);case 4:$b=Yb.yieldResult;if(!$b){Yb.jumpTo(0);break}return Yb.yield(ha.confirm("REALLY *remove* directory "+Ka.name+"? No undo possible..."),6);case 6:if(Tc=Yb.yieldResult)return Yb.yield(ba.resourceRemove(Ka.address),0);Yb.jumpTo(0)}})}function Fd(ba,xa,M){M=void 0===M?$world:M;var ha,
Ka,$a,$b,Tc,Yb,ub,qd,Uc,Ua,lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xc){switch(xc.nextAddress){case 1:return xc.yield(ba.getPackage(xa),2);case 2:ha=xc.yieldResult;if(!ha)throw Error("Cannot find package "+xa);Ka=[];$a=$jscomp.makeIterator(ha.modules);$b=$a.next();case 3:if($b.done)return xc.yield(M.execCommand("open text window",{title:"imports and exports of "+xa,content:Ka.join("\n\n")}),0);Tc=$b.value;if(!Tc.name.match(/\.js$/)){xc.jumpTo(4);break}xc.setCatchFinallyBlocks(6);
Yb=ba;ub=Yb.importsAndExportsOf;qd=Tc.name;return xc.yield(ba.moduleRead(Tc.name),9);case 9:return xc.yield(ub.call(Yb,qd,xc.yieldResult),8);case 8:Uc=xc.yieldResult;xc.leaveTryBlock(7);break;case 6:Ua=xc.enterCatchBlock();M.logError(Error("Error when getting imports/exports from module "+Tc.name+":\n"+Ua.stack));xc.jumpTo(4);break;case 7:lb=""+Tc.name;if(!Uc.imports.length&&!Uc.exports.length){lb+="\n  does not import / export anything";xc.jumpTo(4);break}Uc.imports.length&&(lb+="\n  imports:\n",
lb+=Aa.arr.groupByKey(Uc.imports,"fromModule").mapGroups(function(ab,Dc){return"from "+ab+": "+Dc.map(function(Hc){return Hc.local||Hc.imported?Hc.imported&&Hc.imported!==Hc.local?Hc.imported+" as "+Hc.local:Hc.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(ab){return"    "+ab}).join("\n"));Uc.exports.length&&(lb+="\n  exports:\n",lb+=Uc.exports.map(function(ab){return ab.local?ab.local&&ab.local!==ab.exported?ab.local+" as "+ab.exported:ab.exported:ab.exported+
" from "+ab.fromModule}).join(", ").split("\n").map(function(ab){return"    "+ab}).join("\n"));Ka.push(lb);case 4:$b=$a.next(),xc.jumpTo(3)}})}function fc(ba){return ba.match(/import.*['"]mocha(-es6)?['"]/)&&ba.match(/it\(['"]/)}function ic(ba,xa,M){M=M&&M.address;if(M&&0===xa.indexOf(M))var ha=xa.slice(M.length).replace(/^\//,"");else a:{M=ba.getConfig();if(!M||M.constructor!==Promise)try{ha=String((new Fa.URL(xa)).relativePathFrom(new Fa.URL(ba.getConfig().baseURL)));break a}catch(Ka){}ha=xa}return ha}
function Ab(ba,xa,M,ha){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){return 1==Ka.nextAddress?(ha=Object.assign({targetModule:xa},ha),Ka.yield(ba.normalize(xa),2)):3!=Ka.nextAddress?(xa=Ka.yieldResult,Ka.yield(ba.moduleSourceChange(xa,M,ha),3)):Ka.return(xa)})}function jc(ba,xa,M,ha,Ka){ha=void 0===ha?!1:ha;Ka=void 0===Ka?!1:Ka;var $a;return $jscomp.asyncExecutePromiseGeneratorProgram(function($b){switch($b.nextAddress){case 1:return xa&&xa.setStatusMessage("Reloading "+M),$b.setCatchFinallyBlocks(2),
$b.yield(ba.reloadModule(M,{reloadDeps:ha,resetEnv:Ka}),4);case 4:if(!xa){$b.jumpTo(5);break}return $b.yield(xa.updateModuleList(),6);case 6:case 5:xa&&xa.setStatusMessage("Reloded "+M);$b.leaveTryBlock(0);break;case 2:$a=$b.enterCatchBlock();$b.setCatchFinallyBlocks(7);if(!xa){$b.jumpTo(9);break}return $b.yield(xa.updateEditorWithSourceOf(M),10);case 10:case 9:$b.leaveTryBlock(8);break;case 7:$b.enterCatchBlock();case 8:throw xa&&xa.showError($a),$a;}})}function Bc(ba,xa,M){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){switch(ha.nextAddress){case 1:return ha.yield(ba.forgetModule(M,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!xa){ha.jumpTo(3);break}return ha.yield(xa.updateModuleList(),4);case 4:case 3:ha.jumpToEnd()}})}function ad(ba,xa,M){var ha,Ka,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function($b){switch($b.nextAddress){case 1:return $b.yield(ba.normalize(M),2);case 2:return ha=$b.yieldResult,$b.yield(xa.world().confirm("Remove file "+ha+"?",{requester:xa}),3);case 3:Ka=$b.yieldResult;if(!Ka)throw"Canceled";return $b.yield(ba.forgetModule(ha),4);case 4:return $b.yield(ba.resourceRemove(ha),
5);case 5:return $b.yield(ba.getPackageForModule(ha),6);case 6:return $a=$b.yieldResult,$b.return($a)}})}function bd(ba,xa,M){var ha,Ka,$a,$b,Tc,Yb,ub,qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Uc){switch(Uc.nextAddress){case 1:return ha=Fa.URL,Uc.yield(ba.getConfig(),2);case 2:Ka=new ha(Uc.yieldResult.baseURL);$a=xa.world();if(!M){Uc.jumpTo(3);break}return Uc.yield(ba.getPackage(M),4);case 4:if($b=Uc.yieldResult){Uc.jumpTo(5);break}return Uc.yield(ba.getPackageForModule(M),6);
case 6:$b=Uc.yieldResult;case 5:(Tc=$b)&&(Ka=new Fa.URL(Tc.address));case 3:return Uc.yield(Fa._searchForExistingFiles(xa,String(Ka),Tc),7);case 7:Yb=Uc.yieldResult;if(!Yb.includes("[create new module]")){Uc.jumpTo(8);break}return Uc.yield(Fa._askForModuleName(ba,M||String(Ka),$a),9);case 9:ub=Uc.yieldResult,Yb=[ub];case 8:return Uc.yield(Fa._createAndLoadModules(ba,Yb),10);case 10:return qd=Uc.yieldResult,Fa.arr.compact(qd.map(function(Ua){return Ua.error})),Uc.return(qd)}})}function ob(ba,xa){var M,
ha,Ka,$a,$b,Tc,Yb,ub,qd,Uc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ua){if(1==Ua.nextAddress)return Ua.yield(ba.getPackage(xa),2);if(3!=Ua.nextAddress){M=Ua.yieldResult;if(!M||!M.address.match(/^http/))throw Error("Cannot load package "+xa);ha=Fa.resource(M.address);Ka=[];$a=$jscomp;$b=$a.makeIterator;return Ua.yield(ha.dirList(5,{exclude:Fa.modulesInPackage_defaultExclude}),3)}Tc=$b.call($a,Ua.yieldResult);for(Yb=Tc.next();!Yb.done;Yb=Tc.next())qd=ub=Yb.value,Uc=qd.url,Uc.match(/\.js$/)&&
ba.isModuleLoaded(Uc,!0)&&Ka.push(ba.getModule(Uc));return Ua.return(Ka)})}function kb(ba){ba||(ba="local");if(ba.isSystemInterface)var xa=ba;else"string"===typeof ba&&ba.startsWith("l2l ")&&(ba={type:"l2l",id:ba.split(" ")[1]}),"string"!==typeof ba&&"l2l"===ba.type&&(xa=Bb.l2lInterfaceFor(ba.id,ba.info)),"string"!==typeof ba&&($world.setStatusMessage("Unknown system interface "+ba),ba="local"),xa||(xa=ba&&"local"!==ba?Bb.serverInterfaceFor(ba):Bb.localInterface);return xa}ra("systemInterfaceNamed",
kb);var tb=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");tb.parseJsonLikeObj=be;tb.ast=jb;tb.parseJsonLikeObj=be;tb.parseJsonLikeObj=be;var Aa=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");Aa.loadPackage=function(ba,xa){var M,ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){switch(Ka.nextAddress){case 1:return Ka.yield(ba.importPackage(xa.address+"/"),2);case 2:if(!xa.main){Ka.jumpTo(3);break}return Ka.yield(ba.importModule(xa.main.toString()),
3);case 3:if(!xa.test){Ka.jumpTo(5);break}Ka.setCatchFinallyBlocks(6);return Ka.yield(ba.importPackage("mocha-es6"),8);case 8:return M=Ka.yieldResult,Ka.yield(M.installSystemInstantiateHook(),9);case 9:return Ka.yield(ba.importModule(xa.test.toString()),10);case 10:Ka.leaveTryBlock(5);break;case 6:ha=Ka.enterCatchBlock(),console.warn("Cannot load test of new package: "+ha);case 5:return Ka.return(ba.getPackage(xa.address))}})};Aa.interactivelyCreatePackage=Sb;Aa.interactivelyLoadPackage=qc;Aa.interactivelyReloadPackage=
od;Aa.interactivelyUnloadPackage=Tb;Aa.interactivelyRemovePackage=wd;Aa.showExportsAndImportsOf=Fd;Aa.parseJsonLikeObj=be;Aa.arr=pb;Aa.resource=Ub;Aa.interactivelyCreatePackage=Sb;Aa.interactivelyCreatePackage=Sb;Aa.interactivelyLoadPackage=qc;Aa.interactivelyLoadPackage=qc;Aa.interactivelyReloadPackage=od;Aa.interactivelyReloadPackage=od;Aa.interactivelyUnloadPackage=Tb;Aa.interactivelyUnloadPackage=Tb;Aa.interactivelyRemovePackage=wd;Aa.interactivelyRemovePackage=wd;Aa.showExportsAndImportsOf=Fd;
Aa.showExportsAndImportsOf=Fd;var Fa=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");Fa.isTestModule=fc;Fa.shortModuleName=ic;Fa.interactivelyChangeModule=Ab;Fa.interactivelyReloadModule=jc;Fa.interactivelyUnloadModule=Bc;Fa.interactivelyRemoveModule=ad;Fa.interactivelyAddModule=bd;Fa._askForModuleName=function(ba,xa,M){var ha,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){switch($a.nextAddress){case 1:return $a.yield(M.prompt("Enter module name",
{input:xa,historyId:"lively.vm-editor-add-module-name"}),2);case 2:xa=$a.yieldResult;if(!xa)throw"Canceled";return $a.yield(ba.normalize(xa),3);case 3:return ha=$a.yieldResult,$a.yield(M.confirm(["Create module \n",{},ha,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Ka=$a.yieldResult;if(!Ka)throw"Canceled";return $a.return(ha)}})};Fa._searchForExistingFiles=function(ba,xa,M){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return String(xa).match(/^http/)?ha.return(Fa._searchForExistingFilesWeb(ba,
xa,M)):ha.return(Fa._searchForExistingFilesManually(ba,xa,M))})};Fa._searchForExistingFilesManually=function(ba,xa,M){var ha,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){switch($a.nextAddress){case 1:return $a.yield(ba.world().multipleChoicePrompt("Add Module",{requester:ba,choices:["Create New Module","Load Existing Module"]}),2);case 2:ha=$a.yieldResult;if("Create New Module"===ha)return $a.return("[create new module]");if("Load Existing Module"!==ha){$a.jumpTo(3);break}return $a.yield(ba.world().prompt("URL of module?",
{input:xa,requester:ba,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),4);case 4:if(Ka=$a.yieldResult)return $a.return([Ka]);case 3:throw"Canceled";}})};Fa._searchForExistingFilesWeb=function(ba,xa,M){function ha(qd){qd.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(qd.name())||M&&Fa.arr.pluck(M.modules,"name").includes(qd.url)?!0:!1}var Ka,$a,$b,Tc,Yb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qd){switch(qd.nextAddress){case 1:return(Ka=
ba.world())&&($a=Ka.showLoadingIndicatorFor(ba,"Loading existing modules...")),qd.yield(Fa.resource(xa).dirList(5,{exclude:ha}),3);case 3:return qd.yield(qd.yieldResult.map(function(Uc){return Uc.url}),2);case 2:return $b=qd.yieldResult,Tc=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat($b.filter(function(Uc){return Uc.endsWith(".js")}).map(function(Uc){return{isListItem:!0,string:M&&0==Uc.indexOf(M.address)?M.name+Uc.slice(M.address.length):Uc,value:Uc}})),qd.yield(Promise.resolve($a&&
$a.remove()).then(function(){return ba.world().filterableListPrompt("What module to load?",Tc,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:ba},ba?{extent:ba.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Yb=qd.yieldResult;if(!Yb||"canceled"===Yb.status||!Yb.selected.length)throw"Canceled";ub=Yb.selected||Yb;Array.isArray(ub)||(ub=[ub]);return qd.return(ub)}})};Fa._createAndLoadModules=function(ba,xa){var M,ha,Ka,$a,$b,Tc,Yb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qd){switch(qd.nextAddress){case 1:Array.isArray(xa)||
(xa=[xa]),M=[],ha=$jscomp.makeIterator(xa),Ka=ha.next();case 2:if(Ka.done){qd.jumpTo(4);break}$a=Ka.value;return qd.yield(ba.forgetModule($a,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return qd.yield(ba.resourceEnsureExistance($a,'"format esm";\n'),6);case 6:return $b=qd.yieldResult,Tc=Fa,Yb=Tc.isTestModule,qd.yield($b.read(),7);case 7:if(!Yb.call(Tc,qd.yieldResult)){qd.jumpTo(8);break}if(window.Mocha&&window.chai){qd.jumpTo(8);break}return qd.yield(System.import("mocha-es6"),10);case 10:return qd.yield(Fa.promise.waitFor(function(){return!!window.Mocha&&
!!window.chai}),8);case 8:return qd.setCatchFinallyBlocks(12),qd.yield(ba.importModule($a),14);case 14:M.push({name:$a});qd.leaveTryBlock(3);break;case 12:ub=qd.enterCatchBlock(),M.push({name:$a,error:ub});case 3:Ka=ha.next();qd.jumpTo(2);break;case 4:return qd.return(M)}})};Fa.modulesInPackage_defaultExclude=function(ba){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(ba.name())?!0:!1};Fa.modulesInPackage=ob;Fa.obj=Jb;Fa.promise=jd;Fa.arr=pb;Fa.resource=Ub;Fa.isTestModule=
fc;Fa.isTestModule=fc;Fa.shortModuleName=ic;Fa.shortModuleName=ic;Fa.interactivelyChangeModule=Ab;Fa.interactivelyChangeModule=Ab;Fa.interactivelyReloadModule=jc;Fa.interactivelyReloadModule=jc;Fa.interactivelyUnloadModule=Bc;Fa.interactivelyUnloadModule=Bc;Fa.interactivelyRemoveModule=ad;Fa.interactivelyRemoveModule=ad;Fa.interactivelyAddModule=bd;Fa.interactivelyAddModule=bd;Fa.modulesInPackage=ob;Fa.modulesInPackage=ob;var Ba=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
Ba.todo=function(ba){throw Error(ba+" is not yet implemented!");};Ba.parseJsonLikeObj=be;Ba.arr=pb;Ba.Closure=uc;Ba.obj=Jb;Ba.resource=Ub;Ba.transform=nd;Ba.modules=wc;var wa=function(){};wa.prototype.dynamicCompletionsForPrefix=function(ba,xa,M){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){Ba.todo("dynamicCompletionsForPrefix");ha.jumpToEnd()})};wa.prototype.runEval=function(ba,xa){Ba.todo("runEval")};wa.prototype.resourceExists=function(ba){Ba.todo("resourceExists")};wa.prototype.resourceEnsureExistance=
function(ba,xa){Ba.todo("resourceEnsureExistance")};wa.prototype.resourceMkdir=function(ba){Ba.todo("resourceMkdir")};wa.prototype.resourceRead=function(ba){Ba.todo("resourceRead")};wa.prototype.resourceRemove=function(ba){Ba.todo("resourceRemove")};wa.prototype.resourceWrite=function(ba,xa){Ba.todo("resourceWrite")};wa.prototype.resourceCreateFiles=function(ba,xa){Ba.todo("resourceCreateFiles")};wa.prototype.resourceDirList=function(ba,xa,M){Ba.todo("resourceDirList")};wa.prototype.normalizeSync=
function(ba,xa,M){Ba.todo("normalizeSync")};wa.prototype.normalize=function(ba,xa,M){Ba.todo("normalize")};wa.prototype.printSystemConfig=function(){Ba.todo("printSystemConfig")};wa.prototype.getConfig=function(){Ba.todo("getConfig")};wa.prototype.setConfig=function(ba){Ba.todo("setConfig")};wa.prototype.getPackages=function(ba){Ba.todo("getPackages")};wa.prototype.isModuleLoaded=function(ba,xa){Ba.todo("isModuleLoaded")};wa.prototype.doesModuleExist=function(ba,xa){Ba.todo("doesModuleExist")};wa.prototype.getModules=
function(){var ba=this,xa,M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return 1==ha.nextAddress?(xa=Ba.arr,M=xa.flatmap,ha.yield(ba.getPackages(),2)):ha.return(M.call(xa,ha.yieldResult,function(Ka){return Ka.modules}))})};wa.prototype.getModule=function(ba){var xa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return 1==M.nextAddress?M.yield(xa.getModules(),2):M.return(M.yieldResult.find(function(ha){return ha.name===ba}))})};wa.prototype.getPackage=function(ba){var xa=
this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return 1==M.nextAddress?(ba=ba.replace(/\/+$/,""),M.yield(xa.getPackages(),2)):M.return(M.yieldResult.find(function(ha){return ha.address===ba||ha.name===ba}))})};wa.prototype.getPackageForModule=function(ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){Ba.todo("getPackageForModule");xa.jumpToEnd()})};wa.prototype.systemConfChange=function(ba){var xa=Ba.parseJsonLikeObj(ba);["baseURL"].forEach(function(M){return delete xa[M]});
return this.setConfig(xa)};wa.prototype.resourcesOfPackage=function(ba,xa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){Ba.todo("resourcesOfPackage");M.jumpToEnd()})};wa.prototype.registerPackage=function(ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){Ba.todo("registerPackage");xa.jumpToEnd()})};wa.prototype.importPackage=function(ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){Ba.todo("importPackage");xa.jumpToEnd()})};wa.prototype.removePackage=
function(ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){Ba.todo("removePackage");xa.jumpToEnd()})};wa.prototype.reloadPackage=function(ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){Ba.todo("reloadPackage");xa.jumpToEnd()})};wa.prototype.packageConfChange=function(ba,xa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){Ba.todo("packageConfChange");M.jumpToEnd()})};wa.prototype.importModule=function(ba){Ba.todo("importModule")};wa.prototype.forgetModule=
function(ba,xa){Ba.todo("forgetModule")};wa.prototype.reloadModule=function(ba,xa){Ba.todo("reloadModule")};wa.prototype.moduleFormat=function(ba){Ba.todo("moduleFormat")};wa.prototype.moduleRead=function(ba){Ba.todo("moduleRead")};wa.prototype.moduleSourceChange=function(ba,xa,M){Ba.todo("moduleSourceChange")};wa.prototype.importsAndExportsOf=function(ba,xa){Ba.todo("importsAndExportsOf")};wa.prototype.keyValueListOfVariablesInModule=function(ba,xa){Ba.todo("keyValueListOfVariablesInModule")};wa.prototype.moduleWrite=
function(ba,xa){return this.moduleSourceChange(ba,xa)};Ba.AbstractCoreInterface=wa;var Na=function(){var ba=Ba.AbstractCoreInterface.call(this)||this;ba.currentEval=null;return ba};$jscomp.inherits(Na,Ba.AbstractCoreInterface);Na.prototype.runEval=function(ba,xa){throw Error("Not yet implemented");};Na.prototype.runEvalAndStringify=function(ba,xa){var M=this;return this.currentEval?this.currentEval.then(function(){return M.runEvalAndStringify(ba,xa)}):this.currentEval=Promise.resolve().then(function(){var ha,
Ka,$a,$b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tc){switch(Tc.nextAddress){case 1:return Tc.yield(M.runEval("\n        Promise.resolve((async "+Ba.transform.wrapInFunction(ba)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},xa)),2);case 2:if((ha=Tc.yieldResult)&&ha.isError)throw Error(String(ha.value||ha.error));if(!ha||!ha.value)return Tc.return(null);if(Ka=ha.promisedValue){Tc.jumpTo(3);break}return Tc.yield(ha.value,4);case 4:Ka=Tc.yieldResult;case 3:$a=Ka;if(!$a)return Tc.return();if("undefined"===$a)return Tc.return(void 0);if("null"===$a)return Tc.return(null);if("true"===$a)return Tc.return(!0);
if("false"===$a)return Tc.return(!1);try{$b=JSON.parse($a)}catch(Yb){return Tc.return($a)}if($b&&$b.isError)throw Error(String($b.value));return Tc.return($b)}})}).then(function(ha){delete M.currentEval;return ha},function(ha){delete M.currentEval;return Promise.reject(ha)})};Na.prototype.dynamicCompletionsForPrefix=function(ba,xa,M){var ha=this,Ka,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function($b){Ka=Ba.obj.isString(M.context)?M.context:!1;M=Ba.obj.dissoc(M,["systemInterface","System",
"context"]);$a="\n      var prefix = "+JSON.stringify(xa)+",\n          opts = "+JSON.stringify(M)+";\n      opts.context = "+Ka+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return $b.return(ha.runEvalAndStringify($a))})};Na.prototype.evalWithResource=function(ba,xa,M){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+ba+'").'+xa+"("+(M?JSON.stringify(M):"")+");\n    ")};Na.prototype.resourceExists=function(ba){return this.evalWithResource(ba,"exists")};Na.prototype.resourceEnsureExistance=function(ba,xa){return this.evalWithResource(ba,
"ensureExistance",xa)};Na.prototype.resourceMkdir=function(ba){return this.evalWithResource(ba,"mkdir")};Na.prototype.resourceRead=function(ba){return this.evalWithResource(ba,"read")};Na.prototype.resourceRemove=function(ba){return this.evalWithResource(ba,"remove")};Na.prototype.resourceWrite=function(ba,xa){return this.evalWithResource(ba,"write",xa)};Na.prototype.resourceCreateFiles=function(ba,xa){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
ba+'", '+JSON.stringify(xa)+")")};Na.prototype.resourceDirList=function(ba,xa,M){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+ba+'").dirList('+JSON.stringify(xa)+", "+JSON.stringify(M)+"))\n        .map(({url}) => ({url}))")};Na.prototype.livelySystemAccessor=function(ba){ba=void 0===ba?"livelySystem":ba;return"var "+ba+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
ba+') throw new Error("lively-system-interface not available!");'};Na.prototype.normalizeSync=function(ba,xa,M){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(ba)+", "+JSON.stringify(xa)+", "+M+")")};Na.prototype.normalize=function(ba,xa,M){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(ba)+", "+JSON.stringify(xa)+", "+JSON.stringify(M)+")")};Na.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
Na.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};Na.prototype.setConfig=function(ba){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(ba)+")")};Na.prototype.getPackages=function(ba){ba=Object.assign({excluded:[]},ba);ba.excluded=ba.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(ba)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};Na.prototype.getPackageForModule=function(ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(ba)+")")};Na.prototype.isModuleLoaded=function(ba,xa){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+ba+'", '+xa+")")};Na.prototype.doesModuleExist=function(ba,xa){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+ba+'", '+xa+")")};Na.prototype.registerPackage=function(ba){var xa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return M.return(xa.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(ba)+")"))})};
Na.prototype.importPackage=function(ba){var xa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return M.return(xa.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(ba)+")"))})};Na.prototype.removePackage=function(ba){var xa=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return M.return(xa.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(ba)+")"))})};Na.prototype.reloadPackage=function(ba,xa){var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return ha.return(M.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(ba)+", "+JSON.stringify(xa)+")"))})};Na.prototype.packageConfChange=function(ba,xa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(ba)+", "+JSON.stringify(xa)+")")};Na.prototype.resourcesOfPackage=function(ba,xa){xa=void 0===xa?[".git","node_modules",".module_cache","lively.next-node_modules"]:xa;var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){ba.address&&
(ba=ba.address);return ha.return(M.runEvalAndStringify("\n      "+M.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(ba)+", "+JSON.stringify(xa)+");"))})};Na.prototype.getModule=function(ba){var xa=this,M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){if(1==ha.nextAddress)return ha.yield(xa.getModules(),2);M=ha.yieldResult.find(function(Ka){return Ka.name===ba});return ha.return(M?Ba.modules.module(M.name):null)})};Na.prototype.importModule=
function(ba){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(ba)+")")};Na.prototype.forgetModule=function(ba,xa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ba)+").unload("+JSON.stringify(xa)+")")};Na.prototype.reloadModule=function(ba,xa){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ba)+").reload("+JSON.stringify(xa)+")")};Na.prototype.moduleFormat=function(ba){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(ba)+").format();")};Na.prototype.moduleRead=function(ba){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ba)+").source()")};Na.prototype.moduleSourceChange=function(ba,xa,M){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(ba)+").changeSource("+JSON.stringify(xa)+", "+JSON.stringify(M)+")")};Na.prototype.keyValueListOfVariablesInModule=function(ba,xa){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(ba)+", "+JSON.stringify(xa)+")")};Na.prototype.importsAndExportsOf=function(ba,xa){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(ba)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(ba)+").exports()})")};Na.prototype.exportsOfModules=function(ba){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(ba)+";\n      options.excludedPackages = ["+ba.excludedPackages.map(function(xa){return"function"===
typeof xa?xa.toString():JSON.stringify(xa)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")};Na.prototype.searchInPackage=function(ba,xa,M){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(ba)+", "+JSON.stringify(xa)+", "+JSON.stringify(M)+")")};Na.prototype.loadMochaTestFile=function(ba,xa){xa=void 0===xa?[]:xa;var M=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return ha.return(M.runEvalAndStringify("\n      "+
M.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(ba)+", "+JSON.stringify(xa)+"), result;\n      result = {testsByFile}"))})};Na.prototype.runMochaTests=function(ba,xa,M,ha){var Ka=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){ba&&ba instanceof RegExp&&(ba={isRegExp:!0,value:String(ba).replace(/^\/|\/$/g,"")});return $a.return(Ka.runEvalAndStringify("\n      var grep = "+JSON.stringify(ba)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Ka.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(xa||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
Ba.RemoteCoreInterface=Na;var La=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");La.obj=Jb;La.string=Cc;La.arr=pb;La.resource=Ub;La.createFiles=Mc;La.ast=jb;La.modules=wc;La.vm=Bd;La.parseJsonLikeObj=be;La.AbstractCoreInterface=wa;La.classToFunctionTransform=re;wa=function(){return La.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(wa,La.AbstractCoreInterface);wa.prototype.dynamicCompletionsForPrefix=function(ba,xa,M){var ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){if(1==
Ka.nextAddress)return Ka.yield(La.vm.completions.getCompletions(function($a){return La.vm.runEval($a.replace("return ",""),Object.assign({targetModule:ba,classTransform:La.classToFunctionTransform},M))},xa),2);ha=Ka.yieldResult;if(ha.isError)throw ha.value;return Ka.return({completions:ha.completions,prefix:ha.startLetters})})};wa.prototype.runEval=function(ba,xa){return La.vm.runEval(ba,Object.assign({classTransform:La.classToFunctionTransform},xa))};wa.prototype.resourceExists=function(ba){return La.resource(ba).exists()};
wa.prototype.resourceEnsureExistance=function(ba,xa){return La.resource(ba).ensureExistance(xa)};wa.prototype.resourceMkdir=function(ba){return La.resource(ba).mkdir()};wa.prototype.resourceRead=function(ba){return La.resource(ba).read()};wa.prototype.resourceRemove=function(ba){return La.resource(ba).remove()};wa.prototype.resourceWrite=function(ba,xa){return La.resource(ba).write(xa)};wa.prototype.resourceCreateFiles=function(ba,xa){return La.createFiles(ba,xa)};wa.prototype.resourceDirList=function(ba,
xa,M){return La.resource(ba).dirList(xa,M)};wa.prototype.normalizeSync=function(ba,xa,M){return System.decanonicalize(ba,xa,M)};wa.prototype.normalize=function(ba,xa,M){return System.normalize(ba,xa,M)};wa.prototype.printSystemConfig=function(){return La.modules.printSystemConfig()};wa.prototype.getConfig=function(){return System.getConfig()};wa.prototype.setConfig=function(ba){La.modules.System.config(ba)};wa.prototype.getPackages=function(ba){ba=Object.assign({},ba);ba=void 0===ba.excluded?[]:ba.excluded;
var xa=ba.filter(function(ha){return"string"===typeof ha}),M=ba.filter(function(ha){return"function"===typeof ha});xa=xa.concat(xa.map(function(ha){return System.decanonicalize(ha.replace(/\/?$/,"/")).replace(/\/$/,"")}));return La.modules.getPackages().filter(function(ha){return!xa.includes(ha.url)&&!M.some(function(Ka){return Ka(ha.url)})})};wa.prototype.registerPackage=function(ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return xa.return(La.modules.registerPackage(ba))})};
wa.prototype.importPackage=function(ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return xa.return(La.modules.importPackage(ba))})};wa.prototype.removePackage=function(ba){return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){return xa.return(La.modules.removePackage(ba))})};wa.prototype.reloadPackage=function(ba,xa){return $jscomp.asyncExecutePromiseGeneratorProgram(function(M){return M.return(La.modules.reloadPackage(ba,xa))})};wa.prototype.packageConfChange=function(ba,
xa){var M=this,ha,Ka,$a,$b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tc){if(1==Tc.nextAddress)return ha=La.modules.System,Ka=La.parseJsonLikeObj(ba),$a=JSON.stringify(Ka,null,2),Tc.yield(La.modules.module(xa).changeSource($a,{doEval:!1}),2);if(3!=Tc.nextAddress)return ha.set(xa,ha.newModule(Ka)),Tc.yield(M.getPackageForModule(xa),3);($b=Tc.yieldResult)&&La.modules.applyPackageConfig(Ka,$b.address);Tc.jumpToEnd()})};wa.prototype.resourcesOfPackage=function(ba,xa){xa=void 0===xa?[".git",
"node_modules",".module_cache"]:xa;var M,ha,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){if(1==$a.nextAddress)return $a.setCatchFinallyBlocks(2),M=ba.address?ba.address:ba,ha=La.modules.getPackage(M),$a.yield(ha.resources(void 0,xa),4);if(2!=$a.nextAddress)return $a.return($a.yieldResult.map(function($b){return Object.assign($b,{package:$b.package.url})}));Ka=$a.enterCatchBlock();console.warn("resourcesOfPackage error for "+ba+": "+Ka);return $a.return([])})};wa.prototype.getPackageForModule=
function(ba){return(ba=La.modules.getPackageOfModule(ba))?ba.asSpec():ba};wa.prototype.isModuleLoaded=function(ba,xa){return La.modules.isModuleLoaded(ba,xa)};wa.prototype.doesModuleExist=function(ba,xa){return La.modules.isModuleLoaded(ba,xa)};wa.prototype.getModule=function(ba){return La.modules.module(ba)};wa.prototype.importModule=function(ba){return La.modules.System.import(ba)};wa.prototype.forgetModule=function(ba,xa){return La.modules.module(ba).unload(xa)};wa.prototype.reloadModule=function(ba,
xa){return La.modules.module(ba).reload(xa)};wa.prototype.moduleFormat=function(ba){return La.modules.module(ba).format()};wa.prototype.moduleRead=function(ba){return La.modules.module(ba).source()};wa.prototype.moduleSourceChange=function(ba,xa,M){return La.modules.module(ba).changeSource(xa,M)};wa.prototype.keyValueListOfVariablesInModule=function(ba,xa){var M=this,ha,Ka,$a,$b,Tc,Yb,ub,qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Uc){switch(Uc.nextAddress){case 1:if(xa){Uc.jumpTo(2);
break}return Uc.yield(M.resourceRead(ba),3);case 3:xa=Uc.yieldResult;case 2:return ha="string"===typeof xa?La.ast.parse(xa):xa,Ka=M.normalizeSync(ba),M.moduleFormat(Ka),$a=La.modules.module(Ka).env().recorder,Uc.yield(M.importsAndExportsOf(Ka,ha),4);case 4:return $b=Uc.yieldResult,Tc=La.ast.query.topLevelDeclsAndRefs(ha),Yb=La.arr.sortByKey(La.ast.query.declarationsOfScope(Tc.scope,!0),"start"),ub=La.arr.pluck(Tc.scope.importSpecifiers,"name"),qd=0,Uc.return(Yb.map(function(Ua){var lb=Ua.name.length,
xc=$b.exports.find(function(Dc){return Dc.local===Ua.name}),ab=La.arr.include(ub,Ua.name);xc&&(lb+=9);ab&&(lb+=9);qd=Math.max(qd,lb);return{isExport:xc,isImport:ab,name:Ua.name,value:$a[Ua.name],node:Ua,printedName:Ua.name+(xc?" [export]":"")+(ab?" [import]":""),printedValue:La.obj.inspect($a[Ua.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(Ua){return{isListItem:!0,value:Ua,string:Ua.printedName+La.string.indent(" = "+Ua.printedValue," ",qd-Ua.printedName.length)}}))}})};wa.prototype.importsAndExportsOf=
function(ba,xa){var M;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ha){return 1==ha.nextAddress?ha.yield(La.modules.module(ba).imports(xa),2):3!=ha.nextAddress?(M=ha.yieldResult,ha.yield(La.modules.module(ba).exports(xa),3)):ha.return({imports:M,exports:ha.yieldResult})})};wa.prototype.exportsOfModules=function(ba){return La.modules.ExportLookup.run(System,ba)};wa.prototype.searchInPackage=function(ba,xa,M){return La.modules.getPackage(ba).search(xa,M)};wa.prototype.runMochaTests=function(ba,
xa,M,ha){var Ka,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function($b){if(1==$b.nextAddress)return $b.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);Ka=$b.yieldResult;$a=Ka.runMochaTests;return $b.return($a(ba,xa,M,ha))})};wa.prototype.loadMochaTestFile=function(ba,xa){var M,ha;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ka){if(1==Ka.nextAddress)return Ka.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);M=Ka.yieldResult;
ha=M.loadMochaTestFile;return Ka.return(ha(ba,xa))})};$jscomp.global.Object.defineProperties(wa.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});La.LocalCoreInterface=wa;var Wa=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");Wa.evalStrategies=Ce;Wa.RemoteCoreInterface=Na;var Gb=function(ba){var xa=Wa.RemoteCoreInterface.call(this)||this;xa.currentEval=null;xa.url=ba;xa.server=new Wa.evalStrategies.HttpEvalStrategy(ba);return xa};
$jscomp.inherits(Gb,Wa.RemoteCoreInterface);Gb.prototype.runEval=function(ba,xa){return this.server.runEval(ba,xa)};$jscomp.global.Object.defineProperties(Gb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});Wa.HTTPCoreInterface=Gb;var Rb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");Rb.evalStrategies=Ce;Rb.RemoteCoreInterface=
Na;Na=function(ba,xa){var M=Rb.RemoteCoreInterface.call(this)||this;M.targetId=ba;M.peer=xa;return M};$jscomp.inherits(Na,Rb.RemoteCoreInterface);Na.prototype.isConnected=function(){var ba=this,xa,M,ha,Ka,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function($b){if(1==$b.nextAddress)return xa=ba,M=xa.client,ha=xa.targetId,$b.yield(M.sendToAndWait(M.trackerId,"getClients",{}),2);Ka=$b.yieldResult;$a=Ka.data;return $b.return($a.some(function(Tc){Tc=$jscomp.makeIterator(Tc).next().value;return ha===
Tc}))})};Na.prototype.runEval=function(ba,xa){var M=this,ha,Ka;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){ha=M.client;if(!ha)throw Error("No lively.2lively default client available!");Ka=new Rb.evalStrategies.L2LEvalStrategy(ha,M.targetId);return $a.return(Ka.runEval(ba,xa))})};$jscomp.global.Object.defineProperties(Na.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var ba=this.peer,
xa="l2l "+this.targetId.slice(0,5);if(ba){var M=ba.location,ha=ba.type,Ka=ba.user;ba=ba.world;ha&&(xa+=", "+ha);M&&(xa+=", "+M.replace(/^https?:\/\//,"")+(ba?"/"+ba:""));Ka&&(xa+=", "+Ka.name)}return xa}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});Rb.L2LCoreInterface=Na;var Bb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Bb.systemInterfaceNamed=kb;
Bb.interactivelyCreatePackage=Sb;Bb.interactivelyLoadPackage=qc;Bb.interactivelyReloadPackage=od;Bb.interactivelyUnloadPackage=Tb;Bb.interactivelyRemovePackage=wd;Bb.showExportsAndImportsOf=Fd;Bb.shortModuleName=ic;Bb.interactivelyChangeModule=Ab;Bb.interactivelyReloadModule=jc;Bb.interactivelyUnloadModule=Bc;Bb.interactivelyRemoveModule=ad;Bb.interactivelyAddModule=bd;Bb.modulesInPackage=ob;Bb.LocalCoreInterface=wa;Bb.HTTPCoreInterface=Gb;Bb.L2LCoreInterface=Na;Na=function(ba){this.coreInterface=
ba};Na.prototype.dynamicCompletionsForPrefix=function(ba,xa,M){return this.coreInterface.dynamicCompletionsForPrefix(ba,xa,M)};Na.prototype.runEval=function(ba,xa){return this.coreInterface.runEval(ba,xa)};Na.prototype.printSystemConfig=function(ba,xa,M){return this.coreInterface.printSystemConfig(ba,xa,M)};Na.prototype.getConfig=function(ba,xa,M){return this.coreInterface.getConfig(ba,xa,M)};Na.prototype.getPackages=function(ba){return this.coreInterface.getPackages(ba)};Na.prototype.getModules=
function(ba,xa,M){return this.coreInterface.getModules(ba,xa,M)};Na.prototype.getModule=function(ba,xa,M){return this.coreInterface.getModule(ba,xa,M)};Na.prototype.getPackage=function(ba,xa,M){return this.coreInterface.getPackage(ba,xa,M)};Na.prototype.getPackageForModule=function(ba,xa,M){return this.coreInterface.getPackageForModule(ba,xa,M)};Na.prototype.resourcesOfPackage=function(ba,xa){return this.coreInterface.resourcesOfPackage(ba,xa)};Na.prototype.systemConfChange=function(ba,xa,M){return this.coreInterface.systemConfChange(ba,
xa,M)};Na.prototype.registerPackage=function(ba){return this.coreInterface.registerPackage(ba)};Na.prototype.importPackage=function(ba){return this.coreInterface.importPackage(ba)};Na.prototype.removePackage=function(ba){return this.coreInterface.removePackage(ba)};Na.prototype.reloadPackage=function(ba){return this.coreInterface.reloadPackage(ba)};Na.prototype.packageConfChange=function(ba,xa){return this.coreInterface.packageConfChange(ba,xa)};Na.prototype.keyValueListOfVariablesInModule=function(ba,
xa){return this.coreInterface.keyValueListOfVariablesInModule(ba,xa)};Na.prototype.interactivelyCreatePackage=function(ba){return Bb.interactivelyCreatePackage(this.coreInterface,ba)};Na.prototype.interactivelyLoadPackage=function(ba,xa){return Bb.interactivelyLoadPackage(this.coreInterface,ba,xa)};Na.prototype.interactivelyReloadPackage=function(ba,xa){return Bb.interactivelyReloadPackage(this.coreInterface,ba,xa)};Na.prototype.interactivelyUnloadPackage=function(ba,xa,M){return Bb.interactivelyUnloadPackage(this.coreInterface,
ba,xa,M)};Na.prototype.interactivelyRemovePackage=function(ba,xa){return Bb.interactivelyRemovePackage(this.coreInterface,ba,xa)};Na.prototype.isModuleLoaded=function(ba,xa){return this.coreInterface.isModuleLoaded(ba,xa)};Na.prototype.doesModuleExist=function(ba,xa){return this.coreInterface.doesModuleExist(ba,xa)};Na.prototype.importModule=function(ba){return this.coreInterface.importModule(ba)};Na.prototype.forgetModule=function(ba,xa){return this.coreInterface.forgetModule(ba,xa)};Na.prototype.reloadModule=
function(ba,xa){return this.coreInterface.reloadModule(ba,xa)};Na.prototype.moduleFormat=function(ba){return this.coreInterface.moduleFormat(ba)};Na.prototype.moduleRead=function(ba){return this.coreInterface.moduleRead(ba)};Na.prototype.moduleWrite=function(ba,xa){return this.coreInterface.moduleWrite(ba,xa)};Na.prototype.getModulesInPackage=function(ba){return Bb.modulesInPackage(this.coreInterface,ba)};Na.prototype.shortModuleName=function(ba,xa){return Bb.shortModuleName(this.coreInterface,ba,
xa)};Na.prototype.interactivelyChangeModule=function(ba,xa,M){return Bb.interactivelyChangeModule(this.coreInterface,ba,xa,M)};Na.prototype.interactivelyReloadModule=function(ba,xa){return Bb.interactivelyReloadModule(this.coreInterface,ba,xa)};Na.prototype.interactivelyUnloadModule=function(ba,xa){return Bb.interactivelyUnloadModule(this.coreInterface,ba,xa)};Na.prototype.interactivelyRemoveModule=function(ba,xa){return Bb.interactivelyRemoveModule(this.coreInterface,ba,xa)};Na.prototype.interactivelyAddModule=
function(ba,xa){return Bb.interactivelyAddModule(this.coreInterface,ba,xa)};Na.prototype.showExportsAndImportsOf=function(ba,xa){return Bb.showExportsAndImportsOf(this.coreInterface,ba,xa)};Na.prototype.exportsOfModules=function(ba){return this.coreInterface.exportsOfModules(ba)};Na.prototype.searchInPackage=function(ba,xa,M){return this.coreInterface.searchInPackage(ba,xa,M)};Na.prototype.searchInAllPackages=function(ba,xa){xa=void 0===xa?{}:xa;var M=this,ha,Ka,$a,$b,Tc,Yb,ub,qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Uc){switch(Uc.nextAddress){case 1:return(ha=
xa.progress)&&ha.step("Fetching Packages...",0),Uc.yield(M.coreInterface.getPackages({excluded:xa.excludedPackages}),2);case 2:Ka=Uc.yieldResult,$a=[],ha&&ha.step("Fetching Packages...",.1),$b=0;case 3:if(!($b<Ka.length)){Uc.jumpTo(5);break}Tc=Ka[$b];Yb=Tc.url;if(!Yb||"no group"===Yb){Uc.jumpTo(4);break}ha&&ha.step(Yb.replace(System.baseURL,"").slice(0,20),.1+$b/Ka.length*.9);Uc.setCatchFinallyBlocks(6);return Uc.yield(M.coreInterface.searchInPackage(Yb,ba,xa),8);case 8:ub=Uc.yieldResult;$a=$a.concat(ub);
Uc.leaveTryBlock(4);break;case 6:qd=Uc.enterCatchBlock(),console.error("Error searching in package "+Yb+":\n"+qd.stack);case 4:$b++;Uc.jumpTo(3);break;case 5:return Uc.return($a)}})};Na.prototype.loadMochaTestFile=function(ba,xa){return this.coreInterface.loadMochaTestFile(ba,xa)};Na.prototype.runMochaTests=function(ba,xa,M,ha){return this.coreInterface.runMochaTests(ba,xa,M,ha)};$jscomp.global.Object.defineProperties(Na.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},
name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});ra("Interface",Na);Bb.Interface=Na;Bb.systemInterfaceNamed=kb;Bb.systemInterfaceNamed=kb;Na=ra("localInterface",new Bb.Interface(new Bb.LocalCoreInterface));Bb.localInterface=Na;Bb.localInterface=Na;Bb.localInterface=Na;Bb.httpInterfaces={};Na=ra("serverInterfaceFor",function(ba){return Bb.httpInterfaces[ba]||(Bb.httpInterfaces[ba]=new Bb.Interface(new Bb.HTTPCoreInterface(ba)))});Bb.serverInterfaceFor=Na;Bb.serverInterfaceFor=
Na;Bb.serverInterfaceFor=Na;Bb.l2lInterfaces={};Na=ra("l2lInterfaceFor",function(ba,xa){return Bb.l2lInterfaces[ba]||(Bb.l2lInterfaces[ba]=new Bb.Interface(new Bb.L2LCoreInterface(ba,xa)))});Bb.l2lInterfaceFor=Na;Bb.l2lInterfaceFor=Na;Bb.l2lInterfaceFor=Na}}});