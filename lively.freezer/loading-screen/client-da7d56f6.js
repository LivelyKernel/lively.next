System.register(["./__root_module__-3d4e820f.js","kld-intersections"],function(ra){var kb,zb,Sb,Mb,Fd,Jc,wd,Kc;return{setters:[function(Fc){kb=Fc.s;zb=Fc.$;Sb=Fc.bk;Mb=Fc.bl;Fd=Fc.at;Jc=Fc.a7;wd=Fc.bm;Kc=Fc.ap},function(){}],execute:function(){function Fc(){function na(cb,lb){var cc={};lb.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Qc,Lc,Rb){Lc&&(cc[Lc]=Rb)});return cc}if(Va)return Oc;Va=!0;var ab=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
jb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return Oc=function(cb){var lb=cb,cc=cb.indexOf("["),Qc=cb.indexOf("]");-1!=cc&&-1!=Qc&&(cb=cb.substring(0,cc)+cb.substring(cc,Qc).replace(/:/g,";")+cb.substring(Qc,cb.length));var Lc=ab.exec(cb||"");cb={};for(var Rb=14;Rb--;)cb[jb[Rb]]=Lc[Rb]||"";-1!=cc&&-1!=Qc&&(cb.source=lb,cb.host=cb.host.substring(1,cb.host.length-1).replace(/;/g,":"),cb.authority=cb.authority.replace("[","").replace("]",
"").replace(/;/g,":"),cb.ipv6uri=!0);lb=cb.path;cc=lb.replace(/\/{2,9}/g,"/").split("/");"/"!=lb.substr(0,1)&&0!==lb.length||cc.splice(0,1);"/"==lb.substr(lb.length-1,1)&&cc.splice(cc.length-1,1);cb.pathNames=cc;cb.queryKey=na(cb,cb.query);return cb}}function Wc(){function na(lb){lb=String(lb);if(!(100<lb.length)&&(lb=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(lb))){var cc=parseFloat(lb[1]);switch((lb[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return cc*
cb;case "days":case "day":case "d":return cc*jb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*cc;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*cc;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*cc;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return cc}}}function ab(lb,cc,Qc){if(!(lb<cc))return lb<1.5*cc?Math.floor(lb/cc)+" "+Qc:Math.ceil(lb/cc)+" "+Qc+"s"}if(Ka)return kd;Ka=!0;var jb=864E5,cb=365.25*
jb;return kd=function(lb,cc){cc=cc||{};var Qc=typeof lb;if("string"===Qc&&0<lb.length)return na(lb);if("number"===Qc&&!1===isNaN(lb))return cc.long?ab(lb,jb,"day")||ab(lb,36E5,"hour")||ab(lb,6E4,"minute")||ab(lb,1E3,"second")||lb+" ms":lb>=jb?Math.round(lb/jb)+"d":36E5<=lb?Math.round(lb/36E5)+"h":6E4<=lb?Math.round(lb/6E4)+"m":1E3<=lb?Math.round(lb/1E3)+"s":lb+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(lb));}}function hd(){function na(cb){var lb=0,cc;for(cc in cb)lb=
(lb<<5)-lb+cb.charCodeAt(cc),lb|=0;return Wa.colors[Math.abs(lb)%Wa.colors.length]}function ab(cb){function lb(){if(lb.enabled){var Qc=+new Date;lb.diff=Qc-(cc||Qc);lb.prev=cc;cc=lb.curr=Qc;var Lc=Array(arguments.length);for(Qc=0;Qc<Lc.length;Qc++)Lc[Qc]=arguments[Qc];Lc[0]=Wa.coerce(Lc[0]);"string"!==typeof Lc[0]&&Lc.unshift("%O");var Rb=0;Lc[0]=Lc[0].replace(/%([a-zA-Z%])/g,function(Qb,pc){if("%%"===Qb)return Qb;Rb++;pc=Wa.formatters[pc];"function"===typeof pc&&(Qb=pc.call(lb,Lc[Rb]),Lc.splice(Rb,
1),Rb--);return Qb});Wa.formatArgs.call(lb,Lc);(lb.log||Wa.log||console.log.bind(console)).apply(lb,Lc)}}var cc;lb.namespace=cb;lb.enabled=Wa.enabled(cb);lb.useColors=Wa.useColors();lb.color=na(cb);lb.destroy=jb;"function"===typeof Wa.init&&Wa.init(lb);Wa.instances.push(lb);return lb}function jb(){var cb=Wa.instances.indexOf(this||Zc);return-1!==cb?(Wa.instances.splice(cb,1),!0):!1}if(db)return Wa;db=!0;Wa=Wa=ab.debug=ab["default"]=ab;Wa.coerce=function(cb){return cb instanceof Error?cb.stack||cb.message:
cb};Wa.disable=function(){Wa.enable("")};Wa.enable=function(cb){Wa.save(cb);Wa.names=[];Wa.skips=[];var lb,cc=("string"===typeof cb?cb:"").split(/[\s,]+/),Qc=cc.length;for(lb=0;lb<Qc;lb++)cc[lb]&&(cb=cc[lb].replace(/\*/g,".*?"),"-"===cb[0]?Wa.skips.push(new RegExp("^"+cb.substr(1)+"$")):Wa.names.push(new RegExp("^"+cb+"$")));for(lb=0;lb<Wa.instances.length;lb++)cb=Wa.instances[lb],cb.enabled=Wa.enabled(cb.namespace)};Wa.enabled=function(cb){if("*"===cb[cb.length-1])return!0;var lb;var cc=0;for(lb=
Wa.skips.length;cc<lb;cc++)if(Wa.skips[cc].test(cb))return!1;cc=0;for(lb=Wa.names.length;cc<lb;cc++)if(Wa.names[cc].test(cb))return!0;return!1};Wa.humanize=Wc();Wa.instances=[];Wa.names=[];Wa.skips=[];Wa.formatters={};return Wa}function Id(){function na(){try{var lb=xd.storage.debug}catch(cc){}!lb&&"undefined"!==typeof ab&&"env"in ab&&(lb=ab.env.DEBUG);return lb}if(Wd)return xd;Wd=!0;var ab=Sb;xd=xd=hd();xd.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};xd.formatArgs=function(lb){var cc=(this||le).useColors;lb[0]=(cc?"%c":"")+(this||le).namespace+(cc?" %c":" ")+lb[0]+(cc?"%c ":" ")+"+"+xd.humanize((this||le).diff);if(cc){cc="color: "+(this||le).color;lb.splice(1,0,cc,"color: inherit");var Qc=0,Lc=0;lb[0].replace(/%[a-zA-Z%]/g,function(Rb){"%%"!==Rb&&(Qc++,"%c"===Rb&&(Lc=Qc))});lb.splice(Lc,0,cc)}};xd.save=function(lb){try{null==lb?xd.storage.removeItem("debug"):xd.storage.debug=lb}catch(cc){}};xd.load=na;xd.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var jb=xd;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var cb=chrome.storage.local;else a:{try{cb=window.localStorage;break a}catch(lb){}cb=void 0}jb.storage=cb;xd.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
xd.formatters.j=function(lb){try{return JSON.stringify(lb)}catch(cc){return"[UnexpectedJSONParseError]: "+cc.message}};xd.enable(na());return xd}function nd(){if(Rd)return yc;Rd=!0;var na=Fc(),ab=Id()("socket.io-client:url");return yc=function(jb,cb){var lb=jb;cb=cb||"undefined"!==typeof location&&location;null==jb&&(jb=cb.protocol+"//"+cb.host);"string"===typeof jb&&("/"===jb.charAt(0)&&(jb="/"===jb.charAt(1)?cb.protocol+jb:cb.host+jb),/^(https?|wss?):\/\//.test(jb)||(ab("protocol-less url %s",jb),
jb="undefined"!==typeof cb?cb.protocol+"//"+jb:"https://"+jb),ab("parse %s",jb),lb=na(jb));lb.port||(/^(http|ws)$/.test(lb.protocol)?lb.port="80":/^(http|ws)s$/.test(lb.protocol)&&(lb.port="443"));lb.path=lb.path||"/";jb=-1!==lb.host.indexOf(":")?"["+lb.host+"]":lb.host;lb.id=lb.protocol+"://"+jb+":"+lb.port;lb.href=lb.protocol+"://"+jb+(cb&&cb.port===lb.port?"":":"+lb.port);return lb}}function Xc(){function na(ab){if(ab){for(var jb in na.prototype)ab[jb]=na.prototype[jb];return ab}}if(Fb)return bd;
Fb=!0;bd=na;na.prototype.on=na.prototype.addEventListener=function(ab,jb){(this||ea)._callbacks=(this||ea)._callbacks||{};((this||ea)._callbacks["$"+ab]=(this||ea)._callbacks["$"+ab]||[]).push(jb);return this||ea};na.prototype.once=function(ab,jb){function cb(){this.off(ab,cb);jb.apply(this||ea,arguments)}cb.fn=jb;this.on(ab,cb);return this||ea};na.prototype.off=na.prototype.removeListener=na.prototype.removeAllListeners=na.prototype.removeEventListener=function(ab,jb){(this||ea)._callbacks=(this||
ea)._callbacks||{};if(0==arguments.length)return(this||ea)._callbacks={},this||ea;var cb=(this||ea)._callbacks["$"+ab];if(!cb)return this||ea;if(1==arguments.length)return delete (this||ea)._callbacks["$"+ab],this||ea;for(var lb,cc=0;cc<cb.length;cc++)if(lb=cb[cc],lb===jb||lb.fn===jb){cb.splice(cc,1);break}0===cb.length&&delete (this||ea)._callbacks["$"+ab];return this||ea};na.prototype.emit=function(ab){(this||ea)._callbacks=(this||ea)._callbacks||{};for(var jb=Array(arguments.length-1),cb=(this||
ea)._callbacks["$"+ab],lb=1;lb<arguments.length;lb++)jb[lb-1]=arguments[lb];if(cb){cb=cb.slice(0);lb=0;for(var cc=cb.length;lb<cc;++lb)cb[lb].apply(this||ea,jb)}return this||ea};na.prototype.listeners=function(ab){(this||ea)._callbacks=(this||ea)._callbacks||{};return(this||ea)._callbacks["$"+ab]||[]};na.prototype.hasListeners=function(ab){return!!this.listeners(ab).length};return bd}function Na(){if(tb)return la;tb=!0;var na={}.toString;return la=Array.isArray||function(ab){return"[object Array]"==
na.call(ab)}}function nb(){if(ja)return H;ja=!0;var na=Mb.Buffer;H=function(cb){var lb;!(lb=ab&&na.isBuffer(cb))&&(lb=jb)&&((lb=cb instanceof ArrayBuffer)||(lb="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(cb):cb.buffer instanceof ArrayBuffer));return lb};var ab="function"===typeof na&&"function"===typeof na.isBuffer,jb="function"===typeof ArrayBuffer;return H}function Pb(){function na(Lc,Rb){if(!Lc)return Lc;if(cb(Lc)){var Qb={_placeholder:!0,num:Rb.length};Rb.push(Lc);return Qb}if(jb(Lc)){Qb=
Array(Lc.length);for(var pc=0;pc<Lc.length;pc++)Qb[pc]=na(Lc[pc],Rb);return Qb}if("object"===typeof Lc&&!(Lc instanceof Date)){Qb={};for(pc in Lc)Qb[pc]=na(Lc[pc],Rb);return Qb}return Lc}function ab(Lc,Rb){if(!Lc)return Lc;if(Lc&&Lc._placeholder)return Rb[Lc.num];if(jb(Lc))for(var Qb=0;Qb<Lc.length;Qb++)Lc[Qb]=ab(Lc[Qb],Rb);else if("object"===typeof Lc)for(Qb in Lc)Lc[Qb]=ab(Lc[Qb],Rb);return Lc}if(ub)return Ba;ub=!0;var jb=Na(),cb=nb(),lb=Object.prototype.toString,cc="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===lb.call(Blob),Qc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===lb.call(File);Ba.deconstructPacket=function(Lc){var Rb=[];Lc.data=na(Lc.data,Rb);Lc.attachments=Rb.length;return{packet:Lc,buffers:Rb}};Ba.reconstructPacket=function(Lc,Rb){Lc.data=ab(Lc.data,Rb);Lc.attachments=void 0;return Lc};Ba.removeBlobs=function(Lc,Rb){function Qb(Ic,Ed,oe){if(!Ic)return Ic;if(cc&&Ic instanceof Blob||Qc&&Ic instanceof File){pc++;var ud=
new FileReader;ud.onload=function(){oe?oe[Ed]=(this||jc).result:eb=(this||jc).result;--pc||Rb(eb)};ud.readAsArrayBuffer(Ic)}else if(jb(Ic))for(ud=0;ud<Ic.length;ud++)Qb(Ic[ud],ud,Ic);else if("object"===typeof Ic&&!cb(Ic))for(ud in Ic)Qb(Ic[ud],ud,Ic)}var pc=0,eb=Lc;Qb(eb);pc||Rb(eb)};return Ba}function Wb(){function na(){}function ab(eb){var Ic=""+eb.type;if(vc.BINARY_EVENT===eb.type||vc.BINARY_ACK===eb.type)Ic+=eb.attachments+"-";eb.nsp&&"/"!==eb.nsp&&(Ic+=eb.nsp+",");null!=eb.id&&(Ic+=eb.id);if(null!=
eb.data){try{var Ed=JSON.stringify(eb.data)}catch(oe){Ed=!1}if(!1!==Ed)Ic+=Ed;else return pc}cc("encoded %j as %s",eb,Ic);return Ic}function jb(eb,Ic){Lc.removeBlobs(eb,function(Ed){var oe=Lc.deconstructPacket(Ed);Ed=ab(oe.packet);oe=oe.buffers;oe.unshift(Ed);Ic(oe)})}function cb(){(this||id).reconstructor=null}function lb(eb){(this||id).reconPack=eb;(this||id).buffers=[]}if(Cd)return vc;Cd=!0;var cc=Id()("socket.io-parser"),Qc=Xc(),Lc=Pb(),Rb=Na(),Qb=nb();vc.protocol=4;vc.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
vc.CONNECT=0;vc.DISCONNECT=1;vc.EVENT=2;vc.ACK=3;vc.ERROR=4;vc.BINARY_EVENT=5;vc.BINARY_ACK=6;vc.Encoder=na;vc.Decoder=cb;var pc=vc.ERROR+'"encode error"';na.prototype.encode=function(eb,Ic){cc("encoding packet %j",eb);vc.BINARY_EVENT===eb.type||vc.BINARY_ACK===eb.type?jb(eb,Ic):(eb=ab(eb),Ic([eb]))};Qc(cb.prototype);cb.prototype.add=function(eb){if("string"===typeof eb){a:{var Ic=0,Ed={type:Number(eb.charAt(0))};if(null==vc.types[Ed.type])eb={type:vc.ERROR,data:"parser error: unknown packet type "+
Ed.type};else{if(vc.BINARY_EVENT===Ed.type||vc.BINARY_ACK===Ed.type){for(var oe="";"-"!==eb.charAt(++Ic)&&(oe+=eb.charAt(Ic),Ic!=eb.length););if(oe!=Number(oe)||"-"!==eb.charAt(Ic))throw Error("Illegal attachments");Ed.attachments=Number(oe)}if("/"===eb.charAt(Ic+1))for(Ed.nsp="";++Ic;){oe=eb.charAt(Ic);if(","===oe)break;Ed.nsp+=oe;if(Ic===eb.length)break}else Ed.nsp="/";oe=eb.charAt(Ic+1);if(""!==oe&&Number(oe)==oe){for(Ed.id="";++Ic;){oe=eb.charAt(Ic);if(null==oe||Number(oe)!=oe){--Ic;break}Ed.id+=
eb.charAt(Ic);if(Ic===eb.length)break}Ed.id=Number(Ed.id)}if(eb.charAt(++Ic)){Ic=eb.substr(Ic);try{var ud=JSON.parse(Ic)}catch(fe){ud=!1}if(!1===ud||Ed.type!==vc.ERROR&&!Rb(ud)){eb={type:vc.ERROR,data:"parser error: invalid payload"};break a}else Ed.data=ud}cc("decoded %s as %j",eb,Ed);eb=Ed}}vc.BINARY_EVENT===eb.type||vc.BINARY_ACK===eb.type?((this||id).reconstructor=new lb(eb),0===(this||id).reconstructor.reconPack.attachments&&this.emit("decoded",eb)):this.emit("decoded",eb)}else if(Qb(eb)||eb.base64)if((this||
id).reconstructor){if(eb=(this||id).reconstructor.takeBinaryData(eb))(this||id).reconstructor=null,this.emit("decoded",eb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+eb);};cb.prototype.destroy=function(){(this||id).reconstructor&&(this||id).reconstructor.finishedReconstruction()};lb.prototype.takeBinaryData=function(eb){(this||id).buffers.push(eb);return(this||id).buffers.length===(this||id).reconPack.attachments?(eb=Lc.reconstructPacket((this||
id).reconPack,(this||id).buffers),this.finishedReconstruction(),eb):null};lb.prototype.finishedReconstruction=function(){(this||id).reconPack=null;(this||id).buffers=[]};return vc}function Pc(){if(ie)return Zd;ie=!0;return Zd="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function Bd(){if(wf)return Ne;wf=!0;if(!sd){sd=!0;try{we="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(jb){we=!1}}var na=we;var ab=Pc();return Ne=function(jb){var cb=
jb.xdomain,lb=jb.xscheme;jb=jb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!cb||na))return new XMLHttpRequest}catch(cc){}try{if("undefined"!==typeof XDomainRequest&&!lb&&jb)return new XDomainRequest}catch(cc){}if(!cb)try{return new (ab[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(cc){}}}function Hb(){if(uc)return Ye;uc=!0;return Ye=Object.keys||function(na){var ab=[],jb=Object.prototype.hasOwnProperty,cb;for(cb in na)jb.call(na,cb)&&ab.push(cb);return ab}}function Ub(){function na(Qc){if(!Qc||
"object"!==typeof Qc)return!1;if(jb(Qc)){for(var Lc=0,Rb=Qc.length;Lc<Rb;Lc++)if(na(Qc[Lc]))return!0;return!1}if("function"===typeof ab&&ab.isBuffer&&ab.isBuffer(Qc)||"function"===typeof ArrayBuffer&&Qc instanceof ArrayBuffer||lb&&Qc instanceof Blob||cc&&Qc instanceof File)return!0;if(Qc.toJSON&&"function"===typeof Qc.toJSON&&1===arguments.length)return na(Qc.toJSON(),!0);for(Lc in Qc)if(Object.prototype.hasOwnProperty.call(Qc,Lc)&&na(Qc[Lc]))return!0;return!1}if(If)return Ze;If=!0;var ab=Mb.Buffer,
jb=Na(),cb=Object.prototype.toString,lb="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===cb.call(Blob),cc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===cb.call(File);return Ze=na}function vb(){if(De)return Jf;De=!0;return Jf=function(na,ab,jb){var cb=na.byteLength;ab=ab||0;jb=jb||cb;if(na.slice)return na.slice(ab,jb);0>ab&&(ab+=cb);0>jb&&(jb+=cb);jb>cb&&(jb=cb);if(ab>=cb||ab>=jb||0===cb)return new ArrayBuffer(0);na=new Uint8Array(na);
cb=new Uint8Array(jb-ab);for(var lb=0;ab<jb;ab++,lb++)cb[lb]=na[ab];return cb.buffer}}function kc(){function na(){}if(Ma)return ta;Ma=!0;return ta=function(ab,jb,cb){function lb(Qc,Lc){if(0>=lb.count)throw Error("after called too many times");--lb.count;Qc?(cc=!0,jb(Qc),jb=cb):0!==lb.count||cc||jb(null,Lc)}var cc=!1;cb=cb||na;lb.count=ab;return 0===ab?jb():lb}}function xc(){function na(Rb){for(var Qb=[],pc=0,eb=Rb.length,Ic,Ed;pc<eb;)Ic=Rb.charCodeAt(pc++),55296<=Ic&&56319>=Ic&&pc<eb?(Ed=Rb.charCodeAt(pc++),
56320==(Ed&64512)?Qb.push(((Ic&1023)<<10)+(Ed&1023)+65536):(Qb.push(Ic),pc--)):Qb.push(Ic);return Qb}function ab(Rb,Qb){if(55296<=Rb&&57343>=Rb){if(Qb)throw Error("Lone surrogate U+"+Rb.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function jb(){if(Lc>=Qc)throw Error("Invalid byte index");var Rb=cc[Lc]&255;Lc++;if(128==(Rb&192))return Rb&63;throw Error("Invalid continuation byte");}function cb(Rb){if(Lc>Qc)throw Error("Invalid byte index");if(Lc==Qc)return!1;var Qb=cc[Lc]&
255;Lc++;if(0==(Qb&128))return Qb;if(192==(Qb&224)){var pc=jb();Qb=(Qb&31)<<6|pc;if(128<=Qb)return Qb;throw Error("Invalid continuation byte");}if(224==(Qb&240)){pc=jb();var eb=jb();Qb=(Qb&15)<<12|pc<<6|eb;if(2048<=Qb)return ab(Qb,Rb)?Qb:65533;throw Error("Invalid continuation byte");}if(240==(Qb&248)&&(pc=jb(),eb=jb(),Rb=jb(),Qb=(Qb&7)<<18|pc<<12|eb<<6|Rb,65536<=Qb&&1114111>=Qb))return Qb;throw Error("Invalid UTF-8 detected");}if(R)return ob;R=!0;var lb=String.fromCharCode,cc,Qc,Lc;return ob={version:"2.1.2",
encode:function(Rb,Qb){Qb=Qb||{};Qb=!1!==Qb.strict;Rb=na(Rb);for(var pc=Rb.length,eb=-1,Ic,Ed="";++eb<pc;){Ic=Rb[eb];var oe=Qb;if(0==(Ic&4294967168))Ic=lb(Ic);else{var ud="";0==(Ic&4294965248)?ud=lb(Ic>>6&31|192):0==(Ic&4294901760)?(ab(Ic,oe)||(Ic=65533),ud=lb(Ic>>12&15|224),ud+=lb(Ic>>6&63|128)):0==(Ic&4292870144)&&(ud=lb(Ic>>18&7|240),ud+=lb(Ic>>12&63|128),ud+=lb(Ic>>6&63|128));Ic=ud+=lb(Ic&63|128)}Ed+=Ic}return Ed},decode:function(Rb,Qb){Qb=Qb||{};Qb=!1!==Qb.strict;cc=na(Rb);Qc=cc.length;Lc=0;
Rb=[];for(var pc;!1!==(pc=cb(Qb));)Rb.push(pc);Qb=Rb.length;pc=-1;for(var eb,Ic="";++pc<Qb;)eb=Rb[pc],65535<eb&&(eb-=65536,Ic+=lb(eb>>>10&1023|55296),eb=56320|eb&1023),Ic+=lb(eb);return Ic}}}function Dc(){if(Ya)return va;Ya=!0;(function(na){va.encode=function(ab){ab=new Uint8Array(ab);var jb,cb=ab.length,lb="";for(jb=0;jb<cb;jb+=3)lb+=na[ab[jb]>>2],lb+=na[(ab[jb]&3)<<4|ab[jb+1]>>4],lb+=na[(ab[jb+1]&15)<<2|ab[jb+2]>>6],lb+=na[ab[jb+2]&63];2===cb%3?lb=lb.substring(0,lb.length-1)+"=":1===cb%3&&(lb=lb.substring(0,
lb.length-2)+"==");return lb};va.decode=function(ab){var jb=.75*ab.length,cb=ab.length,lb=0;"="===ab[ab.length-1]&&(jb--,"="===ab[ab.length-2]&&jb--);var cc=new ArrayBuffer(jb),Qc=new Uint8Array(cc);for(jb=0;jb<cb;jb+=4){var Lc=na.indexOf(ab[jb]);var Rb=na.indexOf(ab[jb+1]);var Qb=na.indexOf(ab[jb+2]);var pc=na.indexOf(ab[jb+3]);Qc[lb++]=Lc<<2|Rb>>4;Qc[lb++]=(Rb&15)<<4|Qb>>2;Qc[lb++]=(Qb&3)<<6|pc&63}return cc}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return va}function Gb(){function na(Lc){return Lc.map(function(Rb){if(Rb.buffer instanceof
ArrayBuffer){var Qb=Rb.buffer;if(Rb.byteLength!==Qb.byteLength){var pc=new Uint8Array(Rb.byteLength);pc.set(new Uint8Array(Qb,Rb.byteOffset,Rb.byteLength));Qb=pc.buffer}return Qb}return Rb})}function ab(Lc,Rb){Rb=Rb||{};var Qb=new cb;na(Lc).forEach(function(pc){Qb.append(pc)});return Rb.type?Qb.getBlob(Rb.type):Qb.getBlob()}function jb(Lc,Rb){return new Blob(na(Lc),Rb||{})}if(lc)return gb;lc=!0;var cb="undefined"!==typeof cb?cb:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var lb=2===(new Blob(["hi"])).size}catch(Lc){lb=!1}var cc;if(cc=lb)try{cc=2===(new Blob([new Uint8Array([1,2])])).size}catch(Lc){cc=!1}var Qc=cb&&cb.prototype.append&&cb.prototype.getBlob;"undefined"!==typeof Blob&&(ab.prototype=Blob.prototype,jb.prototype=Blob.prototype);gb=lb?cc?Blob:jb:Qc?ab:void 0;return gb}function $a(){function na(ud,fe,xe){if(!fe)return $b.encodeBase64Packet(ud,xe);var Se=new FileReader;
Se.onload=function(){$b.encodePacket({type:ud.type,data:Se.result},fe,!0,xe)};return Se.readAsArrayBuffer(ud.data)}function ab(ud,fe,xe){var Se=Array(ud.length);xe=cc(ud.length,xe);for(var Me=function(Uf,hg,qi){fe(hg,function(ca,Aa){Se[Uf]=Aa;qi(ca,Se)})},Bf=0;Bf<ud.length;Bf++)Me(Bf,ud[Bf],xe)}if(Yc)return $b;Yc=!0;var jb=Hb(),cb=Ub(),lb=vb(),cc=kc(),Qc=xc(),Lc;"undefined"!==typeof ArrayBuffer&&(Lc=Dc());var Rb="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),Qb="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),pc=Rb||Qb;$b.protocol=3;var eb=$b.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},Ic=jb(eb),Ed={type:"error",data:"parser error"},oe=Gb();$b.encodePacket=function(ud,fe,xe,Se){"function"===typeof fe&&(Se=fe,fe=!1);"function"===typeof xe&&(Se=xe,xe=null);var Me=void 0===ud.data?void 0:ud.data.buffer||ud.data;if("undefined"!==typeof ArrayBuffer&&Me instanceof ArrayBuffer){if(fe){xe=ud.data;fe=new Uint8Array(xe);xe=new Uint8Array(1+
xe.byteLength);xe[0]=eb[ud.type];for(ud=0;ud<fe.length;ud++)xe[ud+1]=fe[ud];ud=Se(xe.buffer)}else ud=$b.encodeBase64Packet(ud,Se);return ud}if("undefined"!==typeof oe&&Me instanceof oe)return fe?pc?ud=na(ud,fe,Se):(fe=new Uint8Array(1),fe[0]=eb[ud.type],ud=new oe([fe.buffer,ud.data]),ud=Se(ud)):ud=$b.encodeBase64Packet(ud,Se),ud;if(Me&&Me.base64)return Se("b"+$b.packets[ud.type]+ud.data.data);fe=eb[ud.type];void 0!==ud.data&&(fe+=xe?Qc.encode(String(ud.data),{strict:!1}):String(ud.data));return Se(""+
fe)};$b.encodeBase64Packet=function(ud,fe){var xe="b"+$b.packets[ud.type];if("undefined"!==typeof oe&&ud.data instanceof oe){var Se=new FileReader;Se.onload=function(){var Uf=Se.result.split(",")[1];fe(xe+Uf)};return Se.readAsDataURL(ud.data)}try{var Me=String.fromCharCode.apply(null,new Uint8Array(ud.data))}catch(Uf){ud=new Uint8Array(ud.data);Me=Array(ud.length);for(var Bf=0;Bf<ud.length;Bf++)Me[Bf]=ud[Bf];Me=String.fromCharCode.apply(null,Me)}xe+=btoa(Me);return fe(xe)};$b.decodePacket=function(ud,
fe,xe){if(void 0===ud)return Ed;if("string"===typeof ud){if("b"===ud.charAt(0))return $b.decodeBase64Packet(ud.substr(1),fe);if(xe){a:{fe=ud;try{fe=Qc.decode(fe,{strict:!1})}catch(Se){ud=!1;break a}ud=fe}if(!1===ud)return Ed}xe=ud.charAt(0);return Number(xe)==xe&&Ic[xe]?1<ud.length?{type:Ic[xe],data:ud.substring(1)}:{type:Ic[xe]}:Ed}xe=(new Uint8Array(ud))[0];ud=lb(ud,1);oe&&"blob"===fe&&(ud=new oe([ud]));return{type:Ic[xe],data:ud}};$b.decodeBase64Packet=function(ud,fe){var xe=Ic[ud.charAt(0)];if(!Lc)return{type:xe,
data:{base64:!0,data:ud.substr(1)}};ud=Lc.decode(ud.substr(1));"blob"===fe&&oe&&(ud=new oe([ud]));return{type:xe,data:ud}};$b.encodePayload=function(ud,fe,xe){"function"===typeof fe&&(xe=fe,fe=null);var Se=cb(ud);if(fe&&Se)return oe&&!pc?$b.encodePayloadAsBlob(ud,xe):$b.encodePayloadAsArrayBuffer(ud,xe);if(!ud.length)return xe("0:");ab(ud,function(Me,Bf){$b.encodePacket(Me,Se?fe:!1,!1,function(Uf){Bf(null,Uf.length+":"+Uf)})},function(Me,Bf){return xe(Bf.join(""))})};$b.decodePayload=function(ud,
fe,xe){if("string"!==typeof ud)return $b.decodePayloadAsBinary(ud,fe,xe);"function"===typeof fe&&(xe=fe,fe=null);if(""===ud)return xe(Ed,0,1);var Se="";for(var Me,Bf,Uf=0,hg=ud.length;Uf<hg;Uf++)if(Bf=ud.charAt(Uf),":"!==Bf)Se+=Bf;else{if(""===Se||Se!=(Me=Number(Se)))return xe(Ed,0,1);Bf=ud.substr(Uf+1,Me);if(Se!=Bf.length)return xe(Ed,0,1);if(Bf.length){Se=$b.decodePacket(Bf,fe,!1);if(Ed.type===Se.type&&Ed.data===Se.data)return xe(Ed,0,1);if(!1===xe(Se,Uf+Me,hg))return}Uf+=Me;Se=""}if(""!==Se)return xe(Ed,
0,1)};$b.encodePayloadAsArrayBuffer=function(ud,fe){if(!ud.length)return fe(new ArrayBuffer(0));ab(ud,function(xe,Se){$b.encodePacket(xe,!0,!0,function(Me){return Se(null,Me)})},function(xe,Se){xe=Se.reduce(function(Uf,hg){hg="string"===typeof hg?hg.length:hg.byteLength;return Uf+hg.toString().length+hg+2},0);var Me=new Uint8Array(xe),Bf=0;Se.forEach(function(Uf){var hg="string"===typeof Uf,qi=Uf;if(hg){qi=new Uint8Array(Uf.length);for(var ca=0;ca<Uf.length;ca++)qi[ca]=Uf.charCodeAt(ca);qi=qi.buffer}hg?
Me[Bf++]=0:Me[Bf++]=1;Uf=qi.byteLength.toString();for(ca=0;ca<Uf.length;ca++)Me[Bf++]=parseInt(Uf[ca]);Me[Bf++]=255;qi=new Uint8Array(qi);for(ca=0;ca<qi.length;ca++)Me[Bf++]=qi[ca]});return fe(Me.buffer)})};$b.encodePayloadAsBlob=function(ud,fe){ab(ud,function(xe,Se){$b.encodePacket(xe,!0,!0,function(Me){var Bf=new Uint8Array(1);Bf[0]=1;if("string"===typeof Me){for(var Uf=new Uint8Array(Me.length),hg=0;hg<Me.length;hg++)Uf[hg]=Me.charCodeAt(hg);Me=Uf.buffer;Bf[0]=0}Uf=(Me instanceof ArrayBuffer?Me.byteLength:
Me.size).toString();var qi=new Uint8Array(Uf.length+1);for(hg=0;hg<Uf.length;hg++)qi[hg]=parseInt(Uf[hg]);qi[Uf.length]=255;oe&&(Me=new oe([Bf.buffer,qi.buffer,Me]),Se(null,Me))})},function(xe,Se){return fe(new oe(Se))})};$b.decodePayloadAsBinary=function(ud,fe,xe){"function"===typeof fe&&(xe=fe,fe=null);for(var Se=[];0<ud.byteLength;){for(var Me=new Uint8Array(ud),Bf=0===Me[0],Uf="",hg=1;255!==Me[hg];hg++){if(310<Uf.length)return xe(Ed,0,1);Uf+=Me[hg]}ud=lb(ud,2+Uf.length);Uf=parseInt(Uf);Me=lb(ud,
0,Uf);if(Bf)try{Me=String.fromCharCode.apply(null,new Uint8Array(Me))}catch(ca){for(Bf=new Uint8Array(Me),Me="",hg=0;hg<Bf.length;hg++)Me+=String.fromCharCode(Bf[hg])}Se.push(Me);ud=lb(ud,Uf)}var qi=Se.length;Se.forEach(function(ca,Aa){xe($b.decodePacket(ca,fe,!0),Aa,qi)})};return $b}function dc(){function na(cb){(this||Xd).path=cb.path;(this||Xd).hostname=cb.hostname;(this||Xd).port=cb.port;(this||Xd).secure=cb.secure;(this||Xd).query=cb.query;(this||Xd).timestampParam=cb.timestampParam;(this||Xd).timestampRequests=
cb.timestampRequests;(this||Xd).readyState="";(this||Xd).agent=cb.agent||!1;(this||Xd).socket=cb.socket;(this||Xd).enablesXDR=cb.enablesXDR;(this||Xd).withCredentials=cb.withCredentials;(this||Xd).pfx=cb.pfx;(this||Xd).key=cb.key;(this||Xd).passphrase=cb.passphrase;(this||Xd).cert=cb.cert;(this||Xd).ca=cb.ca;(this||Xd).ciphers=cb.ciphers;(this||Xd).rejectUnauthorized=cb.rejectUnauthorized;(this||Xd).forceNode=cb.forceNode;(this||Xd).isReactNative=cb.isReactNative;(this||Xd).extraHeaders=cb.extraHeaders;
(this||Xd).localAddress=cb.localAddress}if(Uc)return Sc;Uc=!0;var ab=$a(),jb=Xc();Sc=na;jb(na.prototype);na.prototype.onError=function(cb,lb){cb=Error(cb);cb.type="TransportError";cb.description=lb;this.emit("error",cb);return this||Xd};na.prototype.open=function(){if("closed"===(this||Xd).readyState||""===(this||Xd).readyState)(this||Xd).readyState="opening",this.doOpen();return this||Xd};na.prototype.close=function(){if("opening"===(this||Xd).readyState||"open"===(this||Xd).readyState)this.doClose(),
this.onClose();return this||Xd};na.prototype.send=function(cb){if("open"===(this||Xd).readyState)this.write(cb);else throw Error("Transport not open");};na.prototype.onOpen=function(){(this||Xd).readyState="open";(this||Xd).writable=!0;this.emit("open")};na.prototype.onData=function(cb){cb=ab.decodePacket(cb,(this||Xd).socket.binaryType);this.onPacket(cb)};na.prototype.onPacket=function(cb){this.emit("packet",cb)};na.prototype.onClose=function(){(this||Xd).readyState="closed";this.emit("close")};
return Sc}function oc(){if(tf)return qe;tf=!0;qe.encode=function(na){var ab="",jb;for(jb in na)na.hasOwnProperty(jb)&&(ab.length&&(ab+="&"),ab+=encodeURIComponent(jb)+"="+encodeURIComponent(na[jb]));return ab};qe.decode=function(na){var ab={};na=na.split("&");for(var jb=0,cb=na.length;jb<cb;jb++){var lb=na[jb].split("=");ab[decodeURIComponent(lb[0])]=decodeURIComponent(lb[1])}return ab};return qe}function sa(){if(yh)return Ag;yh=!0;return Ag=function(na,ab){var jb=function(){};jb.prototype=ab.prototype;
na.prototype=new jb;na.prototype.constructor=na}}function Ca(){function na(Lc){var Rb="";do Rb=jb[Lc%64]+Rb,Lc=Math.floor(Lc/64);while(0<Lc);return Rb}function ab(){var Lc=na(+new Date);return Lc!==Qc?(lb=0,Qc=Lc):Lc+"."+na(lb++)}if(pi)return Lg;pi=!0;for(var jb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),cb={},lb=0,cc=0,Qc;64>cc;cc++)cb[jb[cc]]=cc;ab.encode=na;ab.decode=function(Lc){var Rb=0;for(cc=0;cc<Lc.length;cc++)Rb=64*Rb+cb[Lc.charAt(cc)];return Rb};return Lg=
ab}function bb(){function na(Rb){var Qb=Rb&&Rb.forceBase64;if(!Lc||Qb)(this||Ve).supportsBinary=!1;ab.call(this||Ve,Rb)}if(Dj)return Bg;Dj=!0;var ab=dc(),jb=oc(),cb=$a(),lb=sa(),cc=Ca(),Qc=Id()("engine.io-client:polling");Bg=na;var Lc=null!=(new (Bd())({xdomain:!1})).responseType;lb(na,ab);na.prototype.name="polling";na.prototype.doOpen=function(){this.poll()};na.prototype.pause=function(Rb){function Qb(){Qc("paused");pc.readyState="paused";Rb()}var pc=this||Ve;(this||Ve).readyState="pausing";if((this||
Ve).polling||!(this||Ve).writable){var eb=0;(this||Ve).polling&&(Qc("we are currently polling - waiting to pause"),eb++,this.once("pollComplete",function(){Qc("pre-pause polling complete");--eb||Qb()}));(this||Ve).writable||(Qc("we are currently writing - waiting to pause"),eb++,this.once("drain",function(){Qc("pre-pause writing complete");--eb||Qb()}))}else Qb()};na.prototype.poll=function(){Qc("polling");(this||Ve).polling=!0;this.doPoll();this.emit("poll")};na.prototype.onData=function(Rb){var Qb=
this||Ve;Qc("polling got data %s",Rb);cb.decodePayload(Rb,(this||Ve).socket.binaryType,function(pc,eb,Ic){if("opening"===Qb.readyState)Qb.onOpen();if("close"===pc.type)return Qb.onClose(),!1;Qb.onPacket(pc)});"closed"!==(this||Ve).readyState&&((this||Ve).polling=!1,this.emit("pollComplete"),"open"===(this||Ve).readyState?this.poll():Qc('ignoring poll - transport state "%s"',(this||Ve).readyState))};na.prototype.doClose=function(){function Rb(){Qc("writing close packet");Qb.write([{type:"close"}])}
var Qb=this||Ve;"open"===(this||Ve).readyState?(Qc("transport open - closing"),Rb()):(Qc("transport not open - deferring close"),this.once("open",Rb))};na.prototype.write=function(Rb){var Qb=this||Ve;(this||Ve).writable=!1;var pc=function(){Qb.writable=!0;Qb.emit("drain")};cb.encodePayload(Rb,(this||Ve).supportsBinary,function(eb){Qb.doWrite(eb,pc)})};na.prototype.uri=function(){var Rb=(this||Ve).query||{},Qb=(this||Ve).secure?"https":"http",pc="";!1!==(this||Ve).timestampRequests&&(Rb[(this||Ve).timestampParam]=
cc());(this||Ve).supportsBinary||Rb.sid||(Rb.b64=1);Rb=jb.encode(Rb);(this||Ve).port&&("https"===Qb&&443!==Number((this||Ve).port)||"http"===Qb&&80!==Number((this||Ve).port))&&(pc=":"+(this||Ve).port);Rb.length&&(Rb="?"+Rb);var eb=-1!==(this||Ve).hostname.indexOf(":");return Qb+"://"+(eb?"["+(this||Ve).hostname+"]":(this||Ve).hostname)+pc+(this||Ve).path+Rb};return Bg}function rb(){function na(){}function ab(pc){cc.call(this||Yd,pc);(this||Yd).requestTimeout=pc.requestTimeout;(this||Yd).extraHeaders=
pc.extraHeaders;if("undefined"!==typeof location){var eb="https:"===location.protocol,Ic=location.port;Ic||(Ic=eb?443:80);(this||Yd).xd="undefined"!==typeof location&&pc.hostname!==location.hostname||Ic!==pc.port;(this||Yd).xs=pc.secure!==eb}}function jb(pc){(this||Yd).method=pc.method||"GET";(this||Yd).uri=pc.uri;(this||Yd).xd=!!pc.xd;(this||Yd).xs=!!pc.xs;(this||Yd).async=!1!==pc.async;(this||Yd).data=void 0!==pc.data?pc.data:null;(this||Yd).agent=pc.agent;(this||Yd).isBinary=pc.isBinary;(this||
Yd).supportsBinary=pc.supportsBinary;(this||Yd).enablesXDR=pc.enablesXDR;(this||Yd).withCredentials=pc.withCredentials;(this||Yd).requestTimeout=pc.requestTimeout;(this||Yd).pfx=pc.pfx;(this||Yd).key=pc.key;(this||Yd).passphrase=pc.passphrase;(this||Yd).cert=pc.cert;(this||Yd).ca=pc.ca;(this||Yd).ciphers=pc.ciphers;(this||Yd).rejectUnauthorized=pc.rejectUnauthorized;(this||Yd).extraHeaders=pc.extraHeaders;this.create()}function cb(){for(var pc in jb.requests)jb.requests.hasOwnProperty(pc)&&jb.requests[pc].abort()}
if(ch)return yi;ch=!0;var lb=Bd(),cc=bb(),Qc=Xc(),Lc=sa(),Rb=Id()("engine.io-client:polling-xhr"),Qb=Pc();yi=ab;yi.Request=jb;Lc(ab,cc);ab.prototype.supportsBinary=!0;ab.prototype.request=function(pc){pc=pc||{};pc.uri=this.uri();pc.xd=(this||Yd).xd;pc.xs=(this||Yd).xs;pc.agent=(this||Yd).agent||!1;pc.supportsBinary=(this||Yd).supportsBinary;pc.enablesXDR=(this||Yd).enablesXDR;pc.withCredentials=(this||Yd).withCredentials;pc.pfx=(this||Yd).pfx;pc.key=(this||Yd).key;pc.passphrase=(this||Yd).passphrase;
pc.cert=(this||Yd).cert;pc.ca=(this||Yd).ca;pc.ciphers=(this||Yd).ciphers;pc.rejectUnauthorized=(this||Yd).rejectUnauthorized;pc.requestTimeout=(this||Yd).requestTimeout;pc.extraHeaders=(this||Yd).extraHeaders;return new jb(pc)};ab.prototype.doWrite=function(pc,eb){pc=this.request({method:"POST",data:pc,isBinary:"string"!==typeof pc&&void 0!==pc});var Ic=this||Yd;pc.on("success",eb);pc.on("error",function(Ed){Ic.onError("xhr post error",Ed)});(this||Yd).sendXhr=pc};ab.prototype.doPoll=function(){Rb("xhr poll");
var pc=this.request(),eb=this||Yd;pc.on("data",function(Ic){eb.onData(Ic)});pc.on("error",function(Ic){eb.onError("xhr poll error",Ic)});(this||Yd).pollXhr=pc};Qc(jb.prototype);jb.prototype.create=function(){var pc={agent:(this||Yd).agent,xdomain:(this||Yd).xd,xscheme:(this||Yd).xs,enablesXDR:(this||Yd).enablesXDR};pc.pfx=(this||Yd).pfx;pc.key=(this||Yd).key;pc.passphrase=(this||Yd).passphrase;pc.cert=(this||Yd).cert;pc.ca=(this||Yd).ca;pc.ciphers=(this||Yd).ciphers;pc.rejectUnauthorized=(this||Yd).rejectUnauthorized;
var eb=(this||Yd).xhr=new lb(pc),Ic=this||Yd;try{Rb("xhr open %s: %s",(this||Yd).method,(this||Yd).uri);eb.open((this||Yd).method,(this||Yd).uri,(this||Yd).async);try{if((this||Yd).extraHeaders){eb.setDisableHeaderCheck&&eb.setDisableHeaderCheck(!0);for(var Ed in(this||Yd).extraHeaders)(this||Yd).extraHeaders.hasOwnProperty(Ed)&&eb.setRequestHeader(Ed,(this||Yd).extraHeaders[Ed])}}catch(oe){}if("POST"===(this||Yd).method)try{(this||Yd).isBinary?eb.setRequestHeader("Content-type","application/octet-stream"):
eb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(oe){}try{eb.setRequestHeader("Accept","*/*")}catch(oe){}"withCredentials"in eb&&(eb.withCredentials=(this||Yd).withCredentials);(this||Yd).requestTimeout&&(eb.timeout=(this||Yd).requestTimeout);this.hasXDR()?(eb.onload=function(){Ic.onLoad()},eb.onerror=function(){Ic.onError(eb.responseText)}):eb.onreadystatechange=function(){if(2===eb.readyState)try{var oe=eb.getResponseHeader("Content-Type");if(Ic.supportsBinary&&"application/octet-stream"===
oe||"application/octet-stream; charset=UTF-8"===oe)eb.responseType="arraybuffer"}catch(ud){}if(4===eb.readyState)if(200===eb.status||1223===eb.status)Ic.onLoad();else setTimeout(function(){Ic.onError("number"===typeof eb.status?eb.status:0)},0)};Rb("xhr data %s",(this||Yd).data);eb.send((this||Yd).data)}catch(oe){setTimeout(function(){Ic.onError(oe)},0);return}"undefined"!==typeof document&&((this||Yd).index=jb.requestsCount++,jb.requests[(this||Yd).index]=this||Yd)};jb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};jb.prototype.onData=function(pc){this.emit("data",pc);this.onSuccess()};jb.prototype.onError=function(pc){this.emit("error",pc);this.cleanup(!0)};jb.prototype.cleanup=function(pc){if("undefined"!==typeof(this||Yd).xhr&&null!==(this||Yd).xhr){this.hasXDR()?(this||Yd).xhr.onload=(this||Yd).xhr.onerror=na:(this||Yd).xhr.onreadystatechange=na;if(pc)try{(this||Yd).xhr.abort()}catch(eb){}"undefined"!==typeof document&&delete jb.requests[(this||Yd).index];(this||Yd).xhr=null}};jb.prototype.onLoad=
function(){try{try{var pc=(this||Yd).xhr.getResponseHeader("Content-Type")}catch(Ic){}var eb="application/octet-stream"===pc||"application/octet-stream; charset=UTF-8"===pc?(this||Yd).xhr.response||(this||Yd).xhr.responseText:(this||Yd).xhr.responseText}catch(Ic){this.onError(Ic)}if(null!=eb)this.onData(eb)};jb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||Yd).xs&&(this||Yd).enablesXDR};jb.prototype.abort=function(){this.cleanup()};jb.requestsCount=0;jb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",cb):"function"===typeof addEventListener&&addEventListener("onpagehide"in Qb?"pagehide":"unload",cb,!1));return yi}function qb(){function na(){}function ab(Rb){jb.call(this||ag,Rb);(this||ag).query=(this||ag).query||{};Lc||(Lc=lb.___eio=lb.___eio||[]);(this||ag).index=Lc.length;var Qb=this||ag;Lc.push(function(pc){Qb.onData(pc)});(this||ag).query.j=(this||ag).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){Qb.script&&(Qb.script.onerror=na)},!1)}if(vk)return lj;vk=!0;var jb=bb(),cb=sa(),lb=Pc();lj=ab;var cc=/\n/g,Qc=/\\n/g,Lc;cb(ab,jb);ab.prototype.supportsBinary=!1;ab.prototype.doClose=function(){(this||ag).script&&((this||ag).script.parentNode.removeChild((this||ag).script),(this||ag).script=null);(this||ag).form&&((this||ag).form.parentNode.removeChild((this||ag).form),(this||ag).form=null,(this||ag).iframe=null);jb.prototype.doClose.call(this||ag)};ab.prototype.doPoll=function(){var Rb=
this||ag,Qb=document.createElement("script");(this||ag).script&&((this||ag).script.parentNode.removeChild((this||ag).script),(this||ag).script=null);Qb.async=!0;Qb.src=this.uri();Qb.onerror=function(eb){Rb.onError("jsonp poll error",eb)};var pc=document.getElementsByTagName("script")[0];pc?pc.parentNode.insertBefore(Qb,pc):(document.head||document.body).appendChild(Qb);(this||ag).script=Qb;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var eb=document.createElement("iframe");
document.body.appendChild(eb);document.body.removeChild(eb)},100)};ab.prototype.doWrite=function(Rb,Qb){function pc(){eb();Qb()}function eb(){if(Ic.iframe)try{Ic.form.removeChild(Ic.iframe)}catch(xe){Ic.onError("jsonp polling iframe removal error",xe)}try{fe=document.createElement('<iframe src="javascript:0" name="'+Ic.iframeId+'">')}catch(xe){fe=document.createElement("iframe"),fe.name=Ic.iframeId,fe.src="javascript:0"}fe.id=Ic.iframeId;Ic.form.appendChild(fe);Ic.iframe=fe}var Ic=this||ag;if(!(this||
ag).form){var Ed=document.createElement("form"),oe=document.createElement("textarea"),ud=(this||ag).iframeId="eio_iframe_"+(this||ag).index,fe;Ed.className="socketio";Ed.style.position="absolute";Ed.style.top="-1000px";Ed.style.left="-1000px";Ed.target=ud;Ed.method="POST";Ed.setAttribute("accept-charset","utf-8");oe.name="d";Ed.appendChild(oe);document.body.appendChild(Ed);(this||ag).form=Ed;(this||ag).area=oe}(this||ag).form.action=this.uri();eb();Rb=Rb.replace(Qc,"\\\n");(this||ag).area.value=Rb.replace(cc,
"\\n");try{(this||ag).form.submit()}catch(xe){}(this||ag).iframe.attachEvent?(this||ag).iframe.onreadystatechange=function(){"complete"===Ic.iframe.readyState&&pc()}:(this||ag).iframe.onload=pc};return lj}function Sa(){if(ck)return Ri;ck=!0;return Ri=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function Ta(){function na(eb){eb&&eb.forceBase64&&((this||xf).supportsBinary=!1);(this||xf).perMessageDeflate=eb.perMessageDeflate;(this||
xf).usingBrowserWebSocket=Rb&&!eb.forceNode;(this||xf).protocols=eb.protocols;(this||xf).usingBrowserWebSocket||(pc=Qb);jb.call(this||xf,eb)}if(Mi)return dk;Mi=!0;var ab=Mb.Buffer,jb=dc(),cb=$a(),lb=oc(),cc=sa(),Qc=Ca(),Lc=Id()("engine.io-client:websocket"),Rb;"undefined"!==typeof WebSocket?Rb=WebSocket:"undefined"!==typeof self&&(Rb=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var Qb=Sa()}catch(eb){}var pc=Rb||Qb;dk=na;cc(na,jb);na.prototype.name="websocket";na.prototype.supportsBinary=
!0;na.prototype.doOpen=function(){if(this.check()){var eb=this.uri(),Ic=(this||xf).protocols,Ed={};(this||xf).isReactNative||(Ed.agent=(this||xf).agent,Ed.perMessageDeflate=(this||xf).perMessageDeflate,Ed.pfx=(this||xf).pfx,Ed.key=(this||xf).key,Ed.passphrase=(this||xf).passphrase,Ed.cert=(this||xf).cert,Ed.ca=(this||xf).ca,Ed.ciphers=(this||xf).ciphers,Ed.rejectUnauthorized=(this||xf).rejectUnauthorized);(this||xf).extraHeaders&&(Ed.headers=(this||xf).extraHeaders);(this||xf).localAddress&&(Ed.localAddress=
(this||xf).localAddress);try{(this||xf).ws=(this||xf).usingBrowserWebSocket&&!(this||xf).isReactNative?Ic?new pc(eb,Ic):new pc(eb):new pc(eb,Ic,Ed)}catch(oe){return this.emit("error",oe)}void 0===(this||xf).ws.binaryType&&((this||xf).supportsBinary=!1);(this||xf).ws.supports&&(this||xf).ws.supports.binary?((this||xf).supportsBinary=!0,(this||xf).ws.binaryType="nodebuffer"):(this||xf).ws.binaryType="arraybuffer";this.addEventListeners()}};na.prototype.addEventListeners=function(){var eb=this||xf;(this||
xf).ws.onopen=function(){eb.onOpen()};(this||xf).ws.onclose=function(){eb.onClose()};(this||xf).ws.onmessage=function(Ic){eb.onData(Ic.data)};(this||xf).ws.onerror=function(Ic){eb.onError("websocket error",Ic)}};na.prototype.write=function(eb){function Ic(){Ed.emit("flush");setTimeout(function(){Ed.writable=!0;Ed.emit("drain")},0)}var Ed=this||xf;(this||xf).writable=!1;for(var oe=eb.length,ud=0,fe=oe;ud<fe;ud++)(function(xe){cb.encodePacket(xe,Ed.supportsBinary,function(Se){if(!Ed.usingBrowserWebSocket){var Me=
{};xe.options&&(Me.compress=xe.options.compress);Ed.perMessageDeflate&&("string"===typeof Se?ab.byteLength(Se):Se.length)<Ed.perMessageDeflate.threshold&&(Me.compress=!1)}try{Ed.usingBrowserWebSocket?Ed.ws.send(Se):Ed.ws.send(Se,Me)}catch(Bf){Lc("websocket closed before onclose event")}--oe||Ic()})})(eb[ud])};na.prototype.onClose=function(){jb.prototype.onClose.call(this||xf)};na.prototype.doClose=function(){"undefined"!==typeof(this||xf).ws&&(this||xf).ws.close()};na.prototype.uri=function(){var eb=
(this||xf).query||{},Ic=(this||xf).secure?"wss":"ws",Ed="";(this||xf).port&&("wss"===Ic&&443!==Number((this||xf).port)||"ws"===Ic&&80!==Number((this||xf).port))&&(Ed=":"+(this||xf).port);(this||xf).timestampRequests&&(eb[(this||xf).timestampParam]=Qc());(this||xf).supportsBinary||(eb.b64=1);eb=lb.encode(eb);eb.length&&(eb="?"+eb);var oe=-1!==(this||xf).hostname.indexOf(":");return Ic+"://"+(oe?"["+(this||xf).hostname+"]":(this||xf).hostname)+Ed+(this||xf).path+eb};na.prototype.check=function(){return!!pc&&
!("__initialize"in pc&&(this||xf).name===na.prototype.name)};return dk}function sb(){if(nl)return cf;nl=!0;var na=Bd(),ab=rb(),jb=qb(),cb=Ta();cf.polling=function(lb){var cc=!1,Qc=!1,Lc=!1!==lb.jsonp;"undefined"!==typeof location&&(Qc="https:"===location.protocol,(cc=location.port)||(cc=Qc?443:80),cc=lb.hostname!==location.hostname||cc!==lb.port,Qc=lb.secure!==Qc);lb.xdomain=cc;lb.xscheme=Qc;if("open"in new na(lb)&&!lb.forceJSONP)return new ab(lb);if(!Lc)throw Error("JSONP disabled");return new jb(lb)};
cf.websocket=cb;return cf}function Zb(){if(Vc)return Cb;Vc=!0;var na=[].indexOf;return Cb=function(ab,jb){if(na)return ab.indexOf(jb);for(var cb=0;cb<ab.length;++cb)if(ab[cb]===jb)return cb;return-1}}function rc(){function na(Rb,Qb){if(!((this||Hc)instanceof na))return new na(Rb,Qb);Qb=Qb||{};Rb&&"object"===typeof Rb&&(Qb=Rb,Rb=null);Rb?(Rb=Qc(Rb),Qb.hostname=Rb.host,Qb.secure="https"===Rb.protocol||"wss"===Rb.protocol,Qb.port=Rb.port,Rb.query&&(Qb.query=Rb.query)):Qb.host&&(Qb.hostname=Qc(Qb.host).host);
(this||Hc).secure=null!=Qb.secure?Qb.secure:"undefined"!==typeof location&&"https:"===location.protocol;Qb.hostname&&!Qb.port&&(Qb.port=(this||Hc).secure?"443":"80");(this||Hc).agent=Qb.agent||!1;(this||Hc).hostname=Qb.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||Hc).port=Qb.port||("undefined"!==typeof location&&location.port?location.port:(this||Hc).secure?443:80);(this||Hc).query=Qb.query||{};"string"===typeof(this||Hc).query&&((this||Hc).query=Lc.decode((this||
Hc).query));(this||Hc).upgrade=!1!==Qb.upgrade;(this||Hc).path=(Qb.path||"/engine.io").replace(/\/$/,"")+"/";(this||Hc).forceJSONP=!!Qb.forceJSONP;(this||Hc).jsonp=!1!==Qb.jsonp;(this||Hc).forceBase64=!!Qb.forceBase64;(this||Hc).enablesXDR=!!Qb.enablesXDR;(this||Hc).withCredentials=!1!==Qb.withCredentials;(this||Hc).timestampParam=Qb.timestampParam||"t";(this||Hc).timestampRequests=Qb.timestampRequests;(this||Hc).transports=Qb.transports||["polling","websocket"];(this||Hc).transportOptions=Qb.transportOptions||
{};(this||Hc).readyState="";(this||Hc).writeBuffer=[];(this||Hc).prevBufferLen=0;(this||Hc).policyPort=Qb.policyPort||843;(this||Hc).rememberUpgrade=Qb.rememberUpgrade||!1;(this||Hc).binaryType=null;(this||Hc).onlyBinaryUpgrades=Qb.onlyBinaryUpgrades;(this||Hc).perMessageDeflate=!1!==Qb.perMessageDeflate?Qb.perMessageDeflate||{}:!1;!0===(this||Hc).perMessageDeflate&&((this||Hc).perMessageDeflate={});(this||Hc).perMessageDeflate&&null==(this||Hc).perMessageDeflate.threshold&&((this||Hc).perMessageDeflate.threshold=
1024);(this||Hc).pfx=Qb.pfx||null;(this||Hc).key=Qb.key||null;(this||Hc).passphrase=Qb.passphrase||null;(this||Hc).cert=Qb.cert||null;(this||Hc).ca=Qb.ca||null;(this||Hc).ciphers=Qb.ciphers||null;(this||Hc).rejectUnauthorized=void 0===Qb.rejectUnauthorized?!0:Qb.rejectUnauthorized;(this||Hc).forceNode=!!Qb.forceNode;(this||Hc).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||Hc).isReactNative)Qb.extraHeaders&&
0<Object.keys(Qb.extraHeaders).length&&((this||Hc).extraHeaders=Qb.extraHeaders),Qb.localAddress&&((this||Hc).localAddress=Qb.localAddress);(this||Hc).id=null;(this||Hc).upgrades=null;(this||Hc).pingInterval=null;(this||Hc).pingTimeout=null;(this||Hc).pingIntervalTimer=null;(this||Hc).pingTimeoutTimer=null;this.open()}if(Sd)return mc;Sd=!0;var ab=sb(),jb=Xc(),cb=Id()("engine.io-client:socket"),lb=Zb(),cc=$a(),Qc=Fc(),Lc=oc();mc=na;na.priorWebsocketSuccess=!1;jb(na.prototype);na.protocol=cc.protocol;
na.Socket=na;na.Transport=dc();na.transports=sb();na.parser=$a();na.prototype.createTransport=function(Rb){cb('creating transport "%s"',Rb);var Qb=(this||Hc).query,pc={},eb;for(eb in Qb)Qb.hasOwnProperty(eb)&&(pc[eb]=Qb[eb]);pc.EIO=cc.protocol;pc.transport=Rb;Qb=(this||Hc).transportOptions[Rb]||{};(this||Hc).id&&(pc.sid=(this||Hc).id);return new ab[Rb]({query:pc,socket:this||Hc,agent:Qb.agent||(this||Hc).agent,hostname:Qb.hostname||(this||Hc).hostname,port:Qb.port||(this||Hc).port,secure:Qb.secure||
(this||Hc).secure,path:Qb.path||(this||Hc).path,forceJSONP:Qb.forceJSONP||(this||Hc).forceJSONP,jsonp:Qb.jsonp||(this||Hc).jsonp,forceBase64:Qb.forceBase64||(this||Hc).forceBase64,enablesXDR:Qb.enablesXDR||(this||Hc).enablesXDR,withCredentials:Qb.withCredentials||(this||Hc).withCredentials,timestampRequests:Qb.timestampRequests||(this||Hc).timestampRequests,timestampParam:Qb.timestampParam||(this||Hc).timestampParam,policyPort:Qb.policyPort||(this||Hc).policyPort,pfx:Qb.pfx||(this||Hc).pfx,key:Qb.key||
(this||Hc).key,passphrase:Qb.passphrase||(this||Hc).passphrase,cert:Qb.cert||(this||Hc).cert,ca:Qb.ca||(this||Hc).ca,ciphers:Qb.ciphers||(this||Hc).ciphers,rejectUnauthorized:Qb.rejectUnauthorized||(this||Hc).rejectUnauthorized,perMessageDeflate:Qb.perMessageDeflate||(this||Hc).perMessageDeflate,extraHeaders:Qb.extraHeaders||(this||Hc).extraHeaders,forceNode:Qb.forceNode||(this||Hc).forceNode,localAddress:Qb.localAddress||(this||Hc).localAddress,requestTimeout:Qb.requestTimeout||(this||Hc).requestTimeout,
protocols:Qb.protocols||void 0,isReactNative:(this||Hc).isReactNative})};na.prototype.open=function(){if((this||Hc).rememberUpgrade&&na.priorWebsocketSuccess&&-1!==(this||Hc).transports.indexOf("websocket"))var Rb="websocket";else{if(0===(this||Hc).transports.length){var Qb=this||Hc;setTimeout(function(){Qb.emit("error","No transports available")},0);return}Rb=(this||Hc).transports[0]}(this||Hc).readyState="opening";try{Rb=this.createTransport(Rb)}catch(pc){(this||Hc).transports.shift();this.open();
return}Rb.open();this.setTransport(Rb)};na.prototype.setTransport=function(Rb){cb("setting transport %s",Rb.name);var Qb=this||Hc;(this||Hc).transport&&(cb("clearing existing transport %s",(this||Hc).transport.name),(this||Hc).transport.removeAllListeners());(this||Hc).transport=Rb;Rb.on("drain",function(){Qb.onDrain()}).on("packet",function(pc){Qb.onPacket(pc)}).on("error",function(pc){Qb.onError(pc)}).on("close",function(){Qb.onClose("transport close")})};na.prototype.probe=function(Rb){function Qb(){if(Se.onlyBinaryUpgrades){var Me=
!(this||Hc).supportsBinary&&Se.transport.supportsBinary;xe=xe||Me}xe||(cb('probe transport "%s" opened',Rb),fe.send([{type:"ping",data:"probe"}]),fe.once("packet",function(Bf){xe||("pong"===Bf.type&&"probe"===Bf.data?(cb('probe transport "%s" pong',Rb),Se.upgrading=!0,Se.emit("upgrading",fe),fe&&(na.priorWebsocketSuccess="websocket"===fe.name,cb('pausing current transport "%s"',Se.transport.name),Se.transport.pause(function(){xe||"closed"===Se.readyState||(cb("changing transport and sending upgrade packet"),
ud(),Se.setTransport(fe),fe.send([{type:"upgrade"}]),Se.emit("upgrade",fe),fe=null,Se.upgrading=!1,Se.flush())}))):(cb('probe transport "%s" failed',Rb),Bf=Error("probe error"),Bf.transport=fe.name,Se.emit("upgradeError",Bf)))}))}function pc(){xe||(xe=!0,ud(),fe.close(),fe=null)}function eb(Me){var Bf=Error("probe error: "+Me);Bf.transport=fe.name;pc();cb('probe transport "%s" failed because of error: %s',Rb,Me);Se.emit("upgradeError",Bf)}function Ic(){eb("transport closed")}function Ed(){eb("socket closed")}
function oe(Me){fe&&Me.name!==fe.name&&(cb('"%s" works - aborting "%s"',Me.name,fe.name),pc())}function ud(){fe.removeListener("open",Qb);fe.removeListener("error",eb);fe.removeListener("close",Ic);Se.removeListener("close",Ed);Se.removeListener("upgrading",oe)}cb('probing transport "%s"',Rb);var fe=this.createTransport(Rb,{probe:1}),xe=!1,Se=this||Hc;na.priorWebsocketSuccess=!1;fe.once("open",Qb);fe.once("error",eb);fe.once("close",Ic);this.once("close",Ed);this.once("upgrading",oe);fe.open()};na.prototype.onOpen=
function(){cb("socket open");(this||Hc).readyState="open";na.priorWebsocketSuccess="websocket"===(this||Hc).transport.name;this.emit("open");this.flush();if("open"===(this||Hc).readyState&&(this||Hc).upgrade&&(this||Hc).transport.pause){cb("starting upgrade probes");for(var Rb=0,Qb=(this||Hc).upgrades.length;Rb<Qb;Rb++)this.probe((this||Hc).upgrades[Rb])}};na.prototype.onPacket=function(Rb){if("opening"===(this||Hc).readyState||"open"===(this||Hc).readyState||"closing"===(this||Hc).readyState)switch(cb('socket receive: type "%s", data "%s"',
Rb.type,Rb.data),this.emit("packet",Rb),this.emit("heartbeat"),Rb.type){case "open":this.onHandshake(JSON.parse(Rb.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var Qb=Error("server error");Qb.code=Rb.data;this.onError(Qb);break;case "message":this.emit("data",Rb.data),this.emit("message",Rb.data)}else cb('packet received with socket readyState "%s"',(this||Hc).readyState)};na.prototype.onHandshake=function(Rb){this.emit("handshake",Rb);(this||Hc).id=Rb.sid;(this||Hc).transport.query.sid=
Rb.sid;(this||Hc).upgrades=this.filterUpgrades(Rb.upgrades);(this||Hc).pingInterval=Rb.pingInterval;(this||Hc).pingTimeout=Rb.pingTimeout;this.onOpen();"closed"!==(this||Hc).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||Hc).onHeartbeat),this.on("heartbeat",(this||Hc).onHeartbeat))};na.prototype.onHeartbeat=function(Rb){clearTimeout((this||Hc).pingTimeoutTimer);var Qb=this||Hc;Qb.pingTimeoutTimer=setTimeout(function(){if("closed"!==Qb.readyState)Qb.onClose("ping timeout")},Rb||
Qb.pingInterval+Qb.pingTimeout)};na.prototype.setPing=function(){var Rb=this||Hc;clearTimeout(Rb.pingIntervalTimer);Rb.pingIntervalTimer=setTimeout(function(){cb("writing ping packet - expecting pong within %sms",Rb.pingTimeout);Rb.ping();Rb.onHeartbeat(Rb.pingTimeout)},Rb.pingInterval)};na.prototype.ping=function(){var Rb=this||Hc;this.sendPacket("ping",function(){Rb.emit("ping")})};na.prototype.onDrain=function(){(this||Hc).writeBuffer.splice(0,(this||Hc).prevBufferLen);(this||Hc).prevBufferLen=
0;0===(this||Hc).writeBuffer.length?this.emit("drain"):this.flush()};na.prototype.flush=function(){"closed"!==(this||Hc).readyState&&(this||Hc).transport.writable&&!(this||Hc).upgrading&&(this||Hc).writeBuffer.length&&(cb("flushing %d packets in socket",(this||Hc).writeBuffer.length),(this||Hc).transport.send((this||Hc).writeBuffer),(this||Hc).prevBufferLen=(this||Hc).writeBuffer.length,this.emit("flush"))};na.prototype.write=na.prototype.send=function(Rb,Qb,pc){this.sendPacket("message",Rb,Qb,pc);
return this||Hc};na.prototype.sendPacket=function(Rb,Qb,pc,eb){"function"===typeof Qb&&(eb=Qb,Qb=void 0);"function"===typeof pc&&(eb=pc,pc=null);if("closing"!==(this||Hc).readyState&&"closed"!==(this||Hc).readyState){pc=pc||{};pc.compress=!1!==pc.compress;Rb={type:Rb,data:Qb,options:pc};this.emit("packetCreate",Rb);(this||Hc).writeBuffer.push(Rb);if(eb)this.once("flush",eb);this.flush()}};na.prototype.close=function(){function Rb(){eb.onClose("forced close");cb("socket closing - telling transport to close");
eb.transport.close()}function Qb(){eb.removeListener("upgrade",Qb);eb.removeListener("upgradeError",Qb);Rb()}function pc(){eb.once("upgrade",Qb);eb.once("upgradeError",Qb)}if("opening"===(this||Hc).readyState||"open"===(this||Hc).readyState){(this||Hc).readyState="closing";var eb=this||Hc;if((this||Hc).writeBuffer.length)this.once("drain",function(){(this||Hc).upgrading?pc():Rb()});else(this||Hc).upgrading?pc():Rb()}return this||Hc};na.prototype.onError=function(Rb){cb("socket error %j",Rb);na.priorWebsocketSuccess=
!1;this.emit("error",Rb);this.onClose("transport error",Rb)};na.prototype.onClose=function(Rb,Qb){if("opening"===(this||Hc).readyState||"open"===(this||Hc).readyState||"closing"===(this||Hc).readyState){cb('socket close with reason: "%s"',Rb);var pc=this||Hc;clearTimeout((this||Hc).pingIntervalTimer);clearTimeout((this||Hc).pingTimeoutTimer);(this||Hc).transport.removeAllListeners("close");(this||Hc).transport.close();(this||Hc).transport.removeAllListeners();(this||Hc).readyState="closed";(this||
Hc).id=null;this.emit("close",Rb,Qb);pc.writeBuffer=[];pc.prevBufferLen=0}};na.prototype.filterUpgrades=function(Rb){for(var Qb=[],pc=0,eb=Rb.length;pc<eb;pc++)~lb((this||Hc).transports,Rb[pc])&&Qb.push(Rb[pc]);return Qb};return mc}function Xb(){if(kl)return Vk;kl=!0;return Vk=function(na,ab){for(var jb=[],cb=(ab=ab||0)||0;cb<na.length;cb++)jb[cb-ab]=na[cb];return jb}}function wc(){if(mm)return $m;mm=!0;return $m=function(na,ab,jb){na.on(ab,jb);return{destroy:function(){na.removeListener(ab,jb)}}}}
function I(){if(Ti)return Fm;Ti=!0;var na=[].slice;return Fm=function(ab,jb){"string"==typeof jb&&(jb=ab[jb]);if("function"!=typeof jb)throw Error("bind() requires a function");var cb=na.call(arguments,2);return function(){return jb.apply(ab,cb.concat(na.call(arguments)))}}}function T(){function na(eb,Ic,Ed){(this||Ge).io=eb;(this||Ge).nsp=Ic;(this||Ge).json=this||Ge;(this||Ge).ids=0;(this||Ge).acks={};(this||Ge).receiveBuffer=[];(this||Ge).sendBuffer=[];(this||Ge).connected=!1;(this||Ge).disconnected=
!0;(this||Ge).flags={};Ed&&Ed.query&&((this||Ge).query=Ed.query);(this||Ge).io.autoConnect&&this.open()}if(ll)return Hk;ll=!0;var ab=Wb(),jb=Xc(),cb=Xb(),lb=wc(),cc=I(),Qc=Id()("socket.io-client:socket"),Lc=oc(),Rb=Ub();Hk=Hk=na;var Qb={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},pc=jb.prototype.emit;jb(na.prototype);na.prototype.subEvents=function(){if(!(this||Ge).subs){var eb=
(this||Ge).io;(this||Ge).subs=[lb(eb,"open",cc(this||Ge,"onopen")),lb(eb,"packet",cc(this||Ge,"onpacket")),lb(eb,"close",cc(this||Ge,"onclose"))]}};na.prototype.open=na.prototype.connect=function(){if((this||Ge).connected)return this||Ge;this.subEvents();(this||Ge).io.reconnecting||(this||Ge).io.open();if("open"===(this||Ge).io.readyState)this.onopen();this.emit("connecting");return this||Ge};na.prototype.send=function(){var eb=cb(arguments);eb.unshift("message");(this||Ge).emit.apply(this||Ge,eb);
return this||Ge};na.prototype.emit=function(eb){if(Qb.hasOwnProperty(eb))return pc.apply(this||Ge,arguments),this||Ge;var Ic=cb(arguments),Ed={type:(void 0!==(this||Ge).flags.binary?(this||Ge).flags.binary:Rb(Ic))?ab.BINARY_EVENT:ab.EVENT,data:Ic,options:{}};Ed.options.compress=!(this||Ge).flags||!1!==(this||Ge).flags.compress;"function"===typeof Ic[Ic.length-1]&&(Qc("emitting packet with ack id %d",(this||Ge).ids),(this||Ge).acks[(this||Ge).ids]=Ic.pop(),Ed.id=(this||Ge).ids++);(this||Ge).connected?
this.packet(Ed):(this||Ge).sendBuffer.push(Ed);(this||Ge).flags={};return this||Ge};na.prototype.packet=function(eb){eb.nsp=(this||Ge).nsp;(this||Ge).io.packet(eb)};na.prototype.onopen=function(){Qc("transport is open - connecting");if("/"!==(this||Ge).nsp)if((this||Ge).query){var eb="object"===typeof(this||Ge).query?Lc.encode((this||Ge).query):(this||Ge).query;Qc("sending connect packet with query %s",eb);this.packet({type:ab.CONNECT,query:eb})}else this.packet({type:ab.CONNECT})};na.prototype.onclose=
function(eb){Qc("close (%s)",eb);(this||Ge).connected=!1;(this||Ge).disconnected=!0;delete (this||Ge).id;this.emit("disconnect",eb)};na.prototype.onpacket=function(eb){var Ic=eb.type===ab.ERROR&&"/"===eb.nsp;if(eb.nsp===(this||Ge).nsp||Ic)switch(eb.type){case ab.CONNECT:this.onconnect();break;case ab.EVENT:this.onevent(eb);break;case ab.BINARY_EVENT:this.onevent(eb);break;case ab.ACK:this.onack(eb);break;case ab.BINARY_ACK:this.onack(eb);break;case ab.DISCONNECT:this.ondisconnect();break;case ab.ERROR:this.emit("error",
eb.data)}};na.prototype.onevent=function(eb){var Ic=eb.data||[];Qc("emitting event %j",Ic);null!=eb.id&&(Qc("attaching ack callback to event"),Ic.push(this.ack(eb.id)));(this||Ge).connected?pc.apply(this||Ge,Ic):(this||Ge).receiveBuffer.push(Ic)};na.prototype.ack=function(eb){var Ic=this||Ge,Ed=!1;return function(){if(!Ed){Ed=!0;var oe=cb(arguments);Qc("sending ack %j",oe);Ic.packet({type:Rb(oe)?ab.BINARY_ACK:ab.ACK,id:eb,data:oe})}}};na.prototype.onack=function(eb){var Ic=(this||Ge).acks[eb.id];
"function"===typeof Ic?(Qc("calling ack %s with %j",eb.id,eb.data),Ic.apply(this||Ge,eb.data),delete (this||Ge).acks[eb.id]):Qc("bad ack %s",eb.id)};na.prototype.onconnect=function(){(this||Ge).connected=!0;(this||Ge).disconnected=!1;this.emit("connect");this.emitBuffered()};na.prototype.emitBuffered=function(){var eb;for(eb=0;eb<(this||Ge).receiveBuffer.length;eb++)pc.apply(this||Ge,(this||Ge).receiveBuffer[eb]);(this||Ge).receiveBuffer=[];for(eb=0;eb<(this||Ge).sendBuffer.length;eb++)this.packet((this||
Ge).sendBuffer[eb]);(this||Ge).sendBuffer=[]};na.prototype.ondisconnect=function(){Qc("server disconnect (%s)",(this||Ge).nsp);this.destroy();this.onclose("io server disconnect")};na.prototype.destroy=function(){if((this||Ge).subs){for(var eb=0;eb<(this||Ge).subs.length;eb++)(this||Ge).subs[eb].destroy();(this||Ge).subs=null}(this||Ge).io.destroy(this||Ge)};na.prototype.close=na.prototype.disconnect=function(){(this||Ge).connected&&(Qc("performing disconnect (%s)",(this||Ge).nsp),this.packet({type:ab.DISCONNECT}));
this.destroy();if((this||Ge).connected)this.onclose("io client disconnect");return this||Ge};na.prototype.compress=function(eb){(this||Ge).flags.compress=eb;return this||Ge};na.prototype.binary=function(eb){(this||Ge).flags.binary=eb;return this||Ge};return Hk}function ua(){function na(ab){ab=ab||{};(this||xi).ms=ab.min||100;(this||xi).max=ab.max||1E4;(this||xi).factor=ab.factor||2;(this||xi).jitter=0<ab.jitter&&1>=ab.jitter?ab.jitter:0;(this||xi).attempts=0}if(nm)return Ik;nm=!0;Ik=na;na.prototype.duration=
function(){var ab=(this||xi).ms*Math.pow((this||xi).factor,(this||xi).attempts++);if((this||xi).jitter){var jb=Math.random(),cb=Math.floor(jb*(this||xi).jitter*ab);ab=0==(Math.floor(10*jb)&1)?ab-cb:ab+cb}return Math.min(ab,(this||xi).max)|0};na.prototype.reset=function(){(this||xi).attempts=0};na.prototype.setMin=function(ab){(this||xi).ms=ab};na.prototype.setMax=function(ab){(this||xi).max=ab};na.prototype.setJitter=function(ab){(this||xi).jitter=ab};return Ik}function Da(){function na(eb,Ic){if(!((this||
yd)instanceof na))return new na(eb,Ic);eb&&"object"===typeof eb&&(Ic=eb,eb=void 0);Ic=Ic||{};Ic.path=Ic.path||"/socket.io";(this||yd).nsps={};(this||yd).subs=[];(this||yd).opts=Ic;this.reconnection(!1!==Ic.reconnection);this.reconnectionAttempts(Ic.reconnectionAttempts||Infinity);this.reconnectionDelay(Ic.reconnectionDelay||1E3);this.reconnectionDelayMax(Ic.reconnectionDelayMax||5E3);this.randomizationFactor(Ic.randomizationFactor||.5);(this||yd).backoff=new Qb({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==Ic.timeout?2E4:Ic.timeout);(this||yd).readyState="closed";(this||yd).uri=eb;(this||yd).connecting=[];(this||yd).lastPing=null;(this||yd).encoding=!1;(this||yd).packetBuffer=[];eb=Ic.parser||lb;(this||yd).encoder=new eb.Encoder;(this||yd).decoder=new eb.Decoder;(this||yd).autoConnect=!1!==Ic.autoConnect;(this||yd).autoConnect&&this.open()}if(Jk)return xk;Jk=!0;Si||(Si=!0,Xf=rc(),Xf.parser=$a());var ab=Xf;var jb=T(),cb=Xc(),lb=Wb(),cc=wc(),Qc=I(),
Lc=Id()("socket.io-client:manager"),Rb=Zb(),Qb=ua(),pc=Object.prototype.hasOwnProperty;xk=na;na.prototype.emitAll=function(){(this||yd).emit.apply(this||yd,arguments);for(var eb in(this||yd).nsps)pc.call((this||yd).nsps,eb)&&(this||yd).nsps[eb].emit.apply((this||yd).nsps[eb],arguments)};na.prototype.updateSocketIds=function(){for(var eb in(this||yd).nsps)pc.call((this||yd).nsps,eb)&&((this||yd).nsps[eb].id=this.generateId(eb))};na.prototype.generateId=function(eb){return("/"===eb?"":eb+"#")+(this||
yd).engine.id};cb(na.prototype);na.prototype.reconnection=function(eb){if(!arguments.length)return(this||yd)._reconnection;(this||yd)._reconnection=!!eb;return this||yd};na.prototype.reconnectionAttempts=function(eb){if(!arguments.length)return(this||yd)._reconnectionAttempts;(this||yd)._reconnectionAttempts=eb;return this||yd};na.prototype.reconnectionDelay=function(eb){if(!arguments.length)return(this||yd)._reconnectionDelay;(this||yd)._reconnectionDelay=eb;(this||yd).backoff&&(this||yd).backoff.setMin(eb);
return this||yd};na.prototype.randomizationFactor=function(eb){if(!arguments.length)return(this||yd)._randomizationFactor;(this||yd)._randomizationFactor=eb;(this||yd).backoff&&(this||yd).backoff.setJitter(eb);return this||yd};na.prototype.reconnectionDelayMax=function(eb){if(!arguments.length)return(this||yd)._reconnectionDelayMax;(this||yd)._reconnectionDelayMax=eb;(this||yd).backoff&&(this||yd).backoff.setMax(eb);return this||yd};na.prototype.timeout=function(eb){if(!arguments.length)return(this||
yd)._timeout;(this||yd)._timeout=eb;return this||yd};na.prototype.maybeReconnectOnOpen=function(){!(this||yd).reconnecting&&(this||yd)._reconnection&&0===(this||yd).backoff.attempts&&this.reconnect()};na.prototype.open=na.prototype.connect=function(eb,Ic){Lc("readyState %s",(this||yd).readyState);if(~(this||yd).readyState.indexOf("open"))return this||yd;Lc("opening %s",(this||yd).uri);(this||yd).engine=ab((this||yd).uri,(this||yd).opts);var Ed=(this||yd).engine,oe=this||yd;(this||yd).readyState="opening";
(this||yd).skipReconnect=!1;var ud=cc(Ed,"open",function(){oe.onopen();eb&&eb()});Ic=cc(Ed,"error",function(Se){Lc("connect_error");oe.cleanup();oe.readyState="closed";oe.emitAll("connect_error",Se);if(eb){var Me=Error("Connection error");Me.data=Se;eb(Me)}else oe.maybeReconnectOnOpen()});if(!1!==(this||yd)._timeout){var fe=(this||yd)._timeout;Lc("connect attempt will timeout after %d",fe);0===fe&&ud.destroy();var xe=setTimeout(function(){Lc("connect attempt timed out after %d",fe);ud.destroy();Ed.close();
Ed.emit("error","timeout");oe.emitAll("connect_timeout",fe)},fe);(this||yd).subs.push({destroy:function(){clearTimeout(xe)}})}(this||yd).subs.push(ud);(this||yd).subs.push(Ic);return this||yd};na.prototype.onopen=function(){Lc("open");this.cleanup();(this||yd).readyState="open";this.emit("open");var eb=(this||yd).engine;(this||yd).subs.push(cc(eb,"data",Qc(this||yd,"ondata")));(this||yd).subs.push(cc(eb,"ping",Qc(this||yd,"onping")));(this||yd).subs.push(cc(eb,"pong",Qc(this||yd,"onpong")));(this||
yd).subs.push(cc(eb,"error",Qc(this||yd,"onerror")));(this||yd).subs.push(cc(eb,"close",Qc(this||yd,"onclose")));(this||yd).subs.push(cc((this||yd).decoder,"decoded",Qc(this||yd,"ondecoded")))};na.prototype.onping=function(){(this||yd).lastPing=new Date;this.emitAll("ping")};na.prototype.onpong=function(){this.emitAll("pong",new Date-(this||yd).lastPing)};na.prototype.ondata=function(eb){(this||yd).decoder.add(eb)};na.prototype.ondecoded=function(eb){this.emit("packet",eb)};na.prototype.onerror=function(eb){Lc("error",
eb);this.emitAll("error",eb)};na.prototype.socket=function(eb,Ic){function Ed(){~Rb(ud.connecting,oe)||ud.connecting.push(oe)}var oe=(this||yd).nsps[eb];if(!oe){oe=new jb(this||yd,eb,Ic);(this||yd).nsps[eb]=oe;var ud=this||yd;oe.on("connecting",Ed);oe.on("connect",function(){oe.id=ud.generateId(eb)});(this||yd).autoConnect&&Ed()}return oe};na.prototype.destroy=function(eb){eb=Rb((this||yd).connecting,eb);~eb&&(this||yd).connecting.splice(eb,1);(this||yd).connecting.length||this.close()};na.prototype.packet=
function(eb){Lc("writing packet %j",eb);var Ic=this||yd;eb.query&&0===eb.type&&(eb.nsp+="?"+eb.query);Ic.encoding?Ic.packetBuffer.push(eb):(Ic.encoding=!0,(this||yd).encoder.encode(eb,function(Ed){for(var oe=0;oe<Ed.length;oe++)Ic.engine.write(Ed[oe],eb.options);Ic.encoding=!1;Ic.processPacketQueue()}))};na.prototype.processPacketQueue=function(){if(0<(this||yd).packetBuffer.length&&!(this||yd).encoding){var eb=(this||yd).packetBuffer.shift();this.packet(eb)}};na.prototype.cleanup=function(){Lc("cleanup");
for(var eb=(this||yd).subs.length,Ic=0;Ic<eb;Ic++)(this||yd).subs.shift().destroy();(this||yd).packetBuffer=[];(this||yd).encoding=!1;(this||yd).lastPing=null;(this||yd).decoder.destroy()};na.prototype.close=na.prototype.disconnect=function(){Lc("disconnect");(this||yd).skipReconnect=!0;(this||yd).reconnecting=!1;"opening"===(this||yd).readyState&&this.cleanup();(this||yd).backoff.reset();(this||yd).readyState="closed";(this||yd).engine&&(this||yd).engine.close()};na.prototype.onclose=function(eb){Lc("onclose");
this.cleanup();(this||yd).backoff.reset();(this||yd).readyState="closed";this.emit("close",eb);(this||yd)._reconnection&&!(this||yd).skipReconnect&&this.reconnect()};na.prototype.reconnect=function(){if((this||yd).reconnecting||(this||yd).skipReconnect)return this||yd;var eb=this||yd;if((this||yd).backoff.attempts>=(this||yd)._reconnectionAttempts)Lc("reconnect failed"),(this||yd).backoff.reset(),this.emitAll("reconnect_failed"),(this||yd).reconnecting=!1;else{var Ic=(this||yd).backoff.duration();
Lc("will wait %dms before reconnect attempt",Ic);(this||yd).reconnecting=!0;var Ed=setTimeout(function(){eb.skipReconnect||(Lc("attempting reconnect"),eb.emitAll("reconnect_attempt",eb.backoff.attempts),eb.emitAll("reconnecting",eb.backoff.attempts),eb.skipReconnect||eb.open(function(oe){oe?(Lc("reconnect attempt error"),eb.reconnecting=!1,eb.reconnect(),eb.emitAll("reconnect_error",oe.data)):(Lc("reconnect success"),eb.onreconnect())}))},Ic);(this||yd).subs.push({destroy:function(){clearTimeout(Ed)}})}};
na.prototype.onreconnect=function(){var eb=(this||yd).backoff.attempts;(this||yd).reconnecting=!1;(this||yd).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",eb)};return xk}var Kb=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");Kb.nyi=function(na){throw Error("Not yet implemented: "+na);};Kb.string=kb;Kb.promise=zb;Kb.debugMessageOrder=!1;var Db=function(na){this.id=Kb.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};Db.prototype.isOnline=function(){Kb.nyi("isOnline")};Db.prototype.open=function(){Kb.nyi("isOnline")};Db.prototype.close=function(){Kb.nyi("close")};Db.prototype.remove=function(){Kb.nyi("remove")};Db.prototype.whenOnline=function(na){var ab=this;return Kb.promise.waitFor(na,function(){return ab.isOnline()}).then(function(){return ab}).catch(function(jb){return Promise.reject(/timeout/i.test(String(jb))?
Error("Timeout in "+ab+".whenOnline"):jb)})};Db.prototype.onError=function(na){this.debug&&console.log("["+this+"] error: "+na)};Db.prototype.removeService=function(na){delete this.actions[na]};Db.prototype.removeServices=function(na){var ab=this;na.forEach(function(jb){return ab.removeService(jb)})};Db.prototype.addService=function(na,ab){this.actions[na]=ab};Db.prototype.addServices=function(na){var ab=this;Object.keys(na).forEach(function(jb){return ab.addService(jb,na[jb])})};Db.prototype.ping=
function(na){var ab=this,jb,cb,lb,cc,Qc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){if(1==Lc.nextAddress)return jb=Date.now(),Lc.yield(ab.sendToAndWait(na,"l2l-ping",{timestamp:jb}),2);cb=Lc.yieldResult;lb=cb.data;cc=lb.timestamp;Qc=Date.now();return Lc.return({to:cc-jb,from:Qc-cc,roundtrip:Qc-jb})})};Db.prototype.send=function(na,ab){Kb.nyi("send")};Db.prototype.sendAndWait=function(na){var ab=this,jb,cb,lb,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){switch(Qc.nextAddress){case 1:return jb=
new Promise(function(Lc,Rb){return ab.send(na,Lc)}),cb={},lb=ab.options.ackTimeout+400,"ackTimeout"in na&&(lb=!na.ackTimeout||0>na.ackTimeout?null:na.ackTimeout+400),lb?Qc.yield(Promise.race([Kb.promise.delay(lb,cb),jb]),5):Qc.yield(jb,4);case 4:cc=Qc.yieldResult;Qc.jumpTo(3);break;case 5:cc=Qc.yieldResult;case 3:if(cc===cb)throw Error("Timeout sending "+na.action);return Qc.return(cc)}})};Db.prototype.sendTo=function(na,ab,jb,cb){return this.send({target:na,action:ab,data:jb},cb)};Db.prototype.sendToAndWait=
function(na,ab,jb,cb){return this.sendAndWait(Object.assign({target:na,action:ab,data:jb},cb))};Db.prototype.prepareSend=function(na,ab){var jb=na.target,cb=na.action,lb=na.messageId,cc=na.sender;if(!cb)throw Error("Trying to send a message without specifying action!");if(!jb)throw Error("Trying to send message "+cb+" without specifying target!");lb||(na.messageId=Kb.string.newUUID());cc||(na.sender=this.id);cb=na.n=this._outgoingOrderNumberingByTargets.get(jb)||0;this._outgoingOrderNumberingByTargets.set(jb,
cb+1);if("function"===typeof ab){cc=this;var Qc=ab;ab=function(Lc){var Rb=cc._incomingOrderNumberingBySenders.get(Lc.sender)||0;cc.debug&&Kb.debugMessageOrder&&console.log("[MSG ORDER] "+cc+" received ack for "+Lc.action+" as msg "+Rb);try{Qc.apply(null,arguments)}catch(Qb){console.error("Error in ack fn of "+cc+": "+Qb.stack)}cc._incomingOrderNumberingBySenders.set(Lc.sender,Rb+1);setTimeout(function(){return cc.invokeOutOfOrderMessages(Lc.sender)},0)}}this.debug&&Kb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+cb+" ("+na.action+") to "+jb);return[na,ab]};Db.prototype.prepareAnswerMessage=function(na,ab){return{action:na.action+"-response",inResponseTo:na.messageId,target:na.sender,data:ab,sender:this.id}};Db.prototype.installEventToMessageTranslator=function(na){var ab=this,jb=na.onevent;na.onevent=function(cb){var lb=cb.data||[];jb.call(this,cb);cb.data=["*"].concat(lb);jb.call(this,cb)};na.on("*",function(cb,lb){cb&&"object"===typeof cb&&cb.action&&(lb=cb,cb=lb.action);var cc=arguments[arguments.length-
1];cc="function"===typeof cc?cc:null;(lb=lb===cc?null:lb)&&lb.data&&("number"===typeof lb.n||lb.broadcast)&&lb.sender?ab.receive(lb,na,cc):(console.warn(ab+" received non-conformant message "+cb+":",arguments),"function"===typeof cc&&cc({data:{error:"invalid l2l message"}}))})};Db.prototype.receive=function(na,ab,jb){this.dispatchL2LMessageToSelf(na,ab,jb)};Db.prototype.dispatchL2LMessageToSelf=function(na,ab,jb){var cb=this,lb=na.action;if(na.broadcast)this.safeInvokeServiceHandler(lb,na,jb,ab);
else try{var cc=this._incomingOrderNumberingBySenders.get(na.sender)||0,Qc="register"===lb||"unregister";if(!Qc&&na.n<cc)console.error("[MSG ORDER] ["+this+"] received message no. "+na.n+" but expected >= "+cc+", dropping "+lb);else if(!Qc&&na.n>cc){this.debug&&Kb.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+lb+" ("+na.n+") for later invocation");var Lc=this._outOfOrderCacheBySenders.get(na.sender);Lc||(Lc=[],this._outOfOrderCacheBySenders.set(na.sender,Lc));
Lc.push([lb,na,jb,ab])}else this.safeInvokeServiceHandler(lb,na,jb,ab),setTimeout(function(){return cb.invokeOutOfOrderMessages(na.sender)},0)}catch(Rb){console.error("Error message ordering when handling "+lb+": "+(Rb.stack||Rb)),"function"===typeof jb&&jb(this.prepareAnswerMessage(na,{isError:!0,error:String(Rb.stack||Rb)}))}};Db.prototype.invokeOutOfOrderMessages=function(na){var ab=this._outOfOrderCacheBySenders.get(na);if(ab&&ab.length){var jb=this._incomingOrderNumberingBySenders.get(na)||0;
na=ab.findIndex(function(cb){cb=$jscomp.makeIterator(cb);cb.next();return cb.next().value.n===jb});-1!==na&&(ab.splice(na,1),this.invokeServiceHandler.apply(this,ab[na]))}};Db.prototype.renameTarget=function(na,ab){if(na!==ab){var jb=this._outgoingOrderNumberingByTargets.get(na);this._outgoingOrderNumberingByTargets.delete(na);this._outgoingOrderNumberingByTargets.set(ab,jb)}};Db.prototype.safeInvokeServiceHandler=function(na,ab,jb,cb){try{"function"===typeof this.actions[na]?this.invokeServiceHandler(na,
ab,jb,cb):cb._events&&Object.keys(cb._events).includes(na)||(console.warn("WARNING ["+this+"] Unhandled message: "+na),"function"===typeof jb&&jb(this.prepareAnswerMessage(ab,{isError:!0,error:"message not understood: "+na})))}catch(lb){console.error("Error when handling "+na+": "+(lb.stack||lb)),"function"===typeof jb&&jb(this.prepareAnswerMessage(ab,{isError:!0,error:String(lb.stack||lb)}))}};Db.prototype.invokeServiceHandler=function(na,ab,jb,cb){var lb=this;this.debug&&Kb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+ab.n+" ("+ab.action+") from "+ab.sender);this._incomingOrderNumberingBySenders.set(ab.sender,ab.n+1);if("function"===typeof jb){var cc=!1,Qc=!1,Lc="ackTimeout"in ab?ab.ackTimeout:this.options.ackTimeout,Rb=this._outgoingOrderNumberingByTargets.get(ab.sender)||0;this._outgoingOrderNumberingByTargets.set(ab.sender,Rb+1);var Qb=function(pc){Qc?console.warn("["+lb+"] ackFn for "+ab.action+" called after it timed out, dropping answer!"):cc?console.warn("["+lb+"] ack function called repeatedly when handling "+
ab.action):(cc=!0,jb(lb.prepareAnswerMessage(ab,pc)),lb.debug&&Kb.debugMessageOrder&&console.log("[MSG ORDER] "+lb+" sending "+Rb+" (ack for "+ab.action+")"))};Lc&&setTimeout(function(){cc||(Qb({isError:!0,error:"Timeout error: "+lb+" did not send answer for "+ab.action+" after "+Lc+"ms"}),Qc=!0)},Lc)}try{this.actions[na].call(this,this,ab,Qb,cb)}catch(pc){console.error("["+this+"] Error handling "+na+": "+(pc.stack||pc)),Qb&&Qb({error:pc.stack})}};$jscomp.global.Object.defineProperties(Db.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(na){this.options.debug=na}}});Kb.L2LConnection=Db;Kb.default=Db;var Fa=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),ac={"l2l-ping":function(na,ab,jb,cb){cb=ab.sender;ab=ab.data.timestamp;var lb=Date.now();"function"===typeof jb&&jb({timestamp:lb});na.debug&&console.log("[undefined] got ping from "+cb+", time: "+(lb-ab)+"ms")},"remote-eval":function(na,ab,jb,cb){var lb=ab.data.source;
Promise.resolve().then(function(){return eval(lb)}).then(function(cc){return jb({value:cc})}).catch(function(cc){cc.originalErr&&(cc=cc.originalErr);console.error("eval error: "+cc);"function"===typeof jb&&jb({isError:!0,value:String(cc.stack||cc)})})},"remote-eval-2":function(na,ab,jb,cb){var lb=ab.data.source;Promise.resolve().then(function(){var cc=eval(lb);if(!(cc instanceof Promise))throw console.error("unexpected eval result:"+cc),Error("unexpected eval result:"+cc);return cc}).then(function(cc){return jb(cc)}).catch(function(cc){console.error("eval error: "+
cc);cc.originalErr&&(cc=cc.originalErr);"function"===typeof jb&&jb({isError:!0,value:String(cc.stack||cc)})})}};Fa.defaultActions=ac;Fa.defaultActions=ac;Fa.defaultActions=ac;var Gd={},fd=(Gd["[broadcast] send"]=function(na,ab,jb,cb){var lb=ab.sender,cc=ab.data,Qc,Lc,Rb,Qb,pc,eb,Ic,Ed,oe,ud,fe,xe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Se){Qc=cc;Lc=Qc.action;Rb=Qc.broadcast;Qb=Qc.room;pc=Qc.namespace;eb=Qc.isSystemBroadcast;Ic=Qc.isMultiServerBroadcast;Ed=[];Ic?(console.log(".......isMultiServerBroadcast"),
oe=na,ud=oe.id,fe=na.getTrackerList(),console.log(fe),Ed=fe.map(function(Me){return Me.id!=ud?Me.io.nsps["/"+Me.namespace]:cb.broadcast})):(eb&&(pc=na.namespace),Ed.push(pc?na.io.nsps["/"+pc]:cb.broadcast));Ed.forEach(function(Me){return Me.to(Qb).emit({action:Lc,sender:lb,broadcast:!0,data:Rb})});jb&&"function"===typeof jb&&(xe="message broadcasted to "+Qb,pc&&(xe+=" in namespace "+pc),1<Ed.length&&(xe+=" "+Ed.length+" trackers"),console.log(xe),jb({status:xe}));Se.jumpToEnd()})},Gd["[broadcast] join room"]=
function(na,ab,jb,cb){var lb=ab.sender,cc=ab.data.room,Qc,Lc,Rb,Qb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pc){if(1==pc.nextAddress)return Lc=!1,Rb=na.io.nsps["/"+na.namespace].adapter.rooms,(Qb=Rb[cc]&&Rb[cc].sockets&&Rb[cc].sockets[cb.id])?(Qc=lb+" already in "+cc,pc.jumpTo(2)):pc.yield(new Promise(function(eb,Ic){return cb.join(cc,function(Ed){return Ed?Ic(Ed):eb()})}),3);2!=pc.nextAddress&&(Qc=lb+" joined "+cc,Lc=!0);jb&&"function"===typeof jb&&jb({status:Qc,joined:Lc});pc.jumpToEnd()})},
Gd["[broadcast] leave room"]=function(na,ab,jb,cb){var lb=ab.sender,cc=ab.data.room,Qc,Lc,Rb,Qb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pc){if(1==pc.nextAddress)return Lc=!1,Rb=na.io.nsps["/"+na.namespace].adapter.rooms,Qb=Rb[cc]&&Rb[cc].sockets&&Rb[cc].sockets[cb.id],Qb?pc.yield(new Promise(function(eb,Ic){return cb.leave(cc,function(Ed){return Ed?Ic(Ed):eb()})}),3):(Qc=lb+" not in "+cc,pc.jumpTo(2));2!=pc.nextAddress&&(Qc=lb+" left room "+cc,Lc=!0);console.log(Qc);jb&&"function"===
typeof jb&&jb({left:Lc,status:Qc});pc.jumpToEnd()})},Gd["[broadcast] my rooms"]=function(na,ab,jb,cb){jb(cb.rooms)},Gd["[broadcast] all rooms"]=function(na,ab,jb,cb){jb(na.io.nsps["/"+na.namespace].adapter.rooms)},Gd["[broadcast] list room members"]=function(na,ab,jb,cb){ab=ab.data.room;cb=na.io;ab?(na=cb.nsps["/"+na.namespace].adapter.rooms[ab],jb({room:ab,sockets:na?na.sockets:{},length:na?na.length:0})):jb({isError:!0,error:"`room` paramerter missing!"})},Gd.getClients=function(na,ab,jb){na.removeDisconnectedClients();
jb(Array.from(na.clients))},Gd);Fa.defaultTrackerActions=fd;Fa.defaultTrackerActions=fd;Fa.defaultTrackerActions=fd;var Gc={},Ea=(Gc.getRoomList=function(na){var ab=na.client,jb=na.ackFn,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lb){cb=ab._socketioClient.rooms;jb(cb);lb.jumpToEnd()})},Gc["ask for"]=function(na,ab,jb,cb){var lb=ab.sender,cc=ab.data.query,Qc=this,Lc,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qb){if(1==Qb.nextAddress)return Lc=cc.match(/password|sudo/i)?
"passwordPrompt":"prompt",Qb.yield($world[Lc](cc),2);Rb=Qb.yieldResult;"function"===typeof jb&&jb({answer:Rb});na.debug&&console.log("["+Qc+"] message 'ask for' from "+lb+", query: "+cc);Qb.jumpToEnd()})},Gc["open editor"]=function(na,ab,jb,cb){var lb=ab.data.args,cc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qc){if(1==Qc.nextAddress)return lb.length?Qc.yield($world.execCommand("open file for EDITOR",{url:lb[0]}),2):(jb({error:"no file specified"}),Qc.return());cc=Qc.yieldResult;
"function"===typeof jb&&jb("aborted"===cc?{error:String(cc)}:{status:cc});Qc.jumpToEnd()})},Gc.changeWorkingDirectory=function(na,ab,jb,cb){var lb=ab.data.args,cc,Qc,Lc,Rb,Qb,pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){cc=$jscomp.makeIterator(lb||[]);Qc=cc.next().value;Lc=cc.next().value;Rb="OK";try{if(Qc)if(Lc){if(Qb=$world.getMorphWithId(Lc))if(Qb.__lookupSetter__("cwd"))Qb.cwd=Qc;else if("function"===typeof Qb.changeWorkingDirectory)Qb.changeWorkingDirectory(Qc);else if("function"===
typeof Qb.pluginFind){if(pc=Qb.pluginFind(function(Ic){return Ic.isShellEditorPlugin}))pc.cwd=Qc}else Rb="[changeWorkingDirectory] cannot figure pout how to set dir"}else Rb="[changeWorkingDirectory] No command morph";else Rb="[changeWorkingDirectory] No directory received"}catch(Ic){Rb=String(Ic)}"OK"!==Rb&&console.warn(Rb);"function"===typeof jb&&jb(Rb);eb.jumpToEnd()})},Gc);Fa.defaultClientActions=Ea;Fa.defaultClientActions=Ea;Fa.defaultClientActions=Ea;var Oc={},Va=!1,kd={},Ka=!1,Wa={},db=!1,
Zc="undefined"!==typeof self?self:global,xd={},Wd=!1,le="undefined"!==typeof self?self:global,yc={},Rd=!1,bd={},Fb=!1,ea="undefined"!==typeof self?self:global,la={},tb=!1,H={},ja=!1,Ba={},ub=!1,jc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,vc={},Cd=!1,id="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,we={},sd=!1,Zd={},ie=!1,Ne={},wf=!1,Ye={},uc=!1,Ze={},If=!1,Jf={},De=!1,ta={},Ma=!1,ob={},R=!1,va={},Ya=!1,gb={},lc=!1,$b={},Yc=
!1,Sc={},Uc=!1,Xd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,qe={},tf=!1,Ag={},yh=!1,Lg={},pi=!1,Bg={},Dj=!1,Ve="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,yi={},ch=!1,Yd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,lj={},vk=!1,ag="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ri={},ck=!1,dk={},Mi=!1,xf="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,cf={},nl=!1,Cb={},Vc=!1,mc={},Sd=!1,Hc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Xf={},Si=!1,Vk={},kl=!1,$m={},mm=!1,Fm={},Ti=!1,Hk={},ll=!1,Ge="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ik={},nm=!1,xi="undefined"!==typeof self?self:global,xk={},Jk=!1,yd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ui={},Cj=!1,ml=function(){function na(Qc,Lc){"object"===typeof Qc&&
(Lc=Qc,Qc=void 0);Lc=Lc||{};Qc=ab(Qc);var Rb=Qc.source,Qb=Qc.id,pc=Qc.path;pc=cc[Qb]&&pc in cc[Qb].nsps;Lc.forceNew||Lc["force new connection"]||!1===Lc.multiplex||pc?(lb("ignoring socket cache for %s",Rb),Rb=cb(Rb,Lc)):(cc[Qb]||(lb("new io instance for %s",Rb),cc[Qb]=cb(Rb,Lc)),Rb=cc[Qb]);Qc.query&&!Lc.query&&(Lc.query=Qc.query);return Rb.socket(Qc.path,Lc)}if(Cj)return Ui;Cj=!0;var ab=nd(),jb=Wb(),cb=Da(),lb=Id()("socket.io-client");Ui=Ui=na;var cc=Ui.managers={};Ui.protocol=jb.protocol;Ui.connect=
na;Ui.Manager=Da();Ui.Socket=T();return Ui}(),Hf=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Hf.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Hf.isNode?System._nodeRequire("os").hostname():System.baseURL};Hf.promise=zb;Hf.fun=Fd;Hf.obj=Jc;Hf.events=wd;Hf.num=Kc;Hf.L2LConnection=Db;Hf.defaultActions=ac;Hf.defaultClientActions=Ea;Hf.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Hf._ioClient=ml;Hf.ioClient=Hf.ioClient||void 0;Hf.isNode?(Hf.require=System._nodeRequire("module")._load,Hf.ioClient=Hf.require("socket.io-client")):Hf.ioClient=Hf._ioClient;Hf.urlHelper={isRoot:function(na){return"/"===Hf.urlHelper.path(na)},root:function(na){return Hf.urlHelper.isRoot(na)?na:na.slice(0,-Hf.urlHelper.path(na).length)+"/"},path:function(){var na=/^[a-z0-9-_\.]+:/,ab=/^\/\/[^\/]+/;return function(jb){jb=jb.replace(na,"").replace(ab,"");return""===jb?"/":jb}}(),join:function(na,
ab){na.endsWith("/")&&(na=na.slice(0,-1));ab.startsWith("/")&&(ab=ab.slice(1));return na+"/"+ab}};var rh=function(na,ab,jb,cb){var lb=Hf.L2LConnection.call(this)||this;Hf.events.makeEmitter(lb);lb.info=cb;lb.origin=na;lb.path=ab;lb.namespace=jb.replace(/^\/?/,"/");lb.trackerId=null;lb._socketioClient=null;lb._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Hf.defaultActions).forEach(function(cc){return lb.addService(cc,
Hf.defaultActions[cc])});Object.keys(Hf.defaultClientActions).forEach(function(cc){return lb.addService(cc,Hf.defaultClientActions[cc])});return lb};$jscomp.inherits(rh,Hf.L2LConnection);rh.clientKey=function(na,ab,jb){na=na.replace(/\/$/,"");ab=ab.replace(/^\//,"");jb=jb.replace(/^\//,"");return na+"-"+ab+"-"+jb};rh.forLivelyInBrowser=function(na){var ab=!!na;na=Object.assign({type:"lively.morphic browser"},na);var jb=this.default();if(!jb)return Hf.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:na});ab&&!Hf.obj.equals(jb.info,na)&&jb.isRegistered()&&(jb.info=na,jb.unregister().then(function(){return jb.register()}).catch(function(cb){return console.error("l2l re-register on info change errored: "+cb)}));return jb};rh.default=function(){var na=Hf.L2LClient.clients.keys().next().value;return Hf.L2LClient.clients.get(na)};rh.create=function(na){var ab=na=void 0===na?{}:na;na=void 0===ab.debug?!1:ab.debug;var jb=ab.url,cb=ab.namespace,lb=void 0===ab.autoOpen?
!0:ab.autoOpen;ab=void 0===ab.info?{}:ab.info;if(!jb)throw Error("L2LClient needs server url!");var cc=Hf.urlHelper.root(jb).replace(/\/+$/,"");jb=Hf.urlHelper.path(jb);cb=new this(cc,jb,cb||"",ab);lb&&cb.register();cb.debug=na;return cb};rh.ensure=function(na){var ab=na=void 0===na?{}:na,jb=ab.url;ab=ab.namespace;if(!jb)throw Error("L2LClient needs server url!");var cb=Hf.urlHelper.root(jb).replace(/\/+$/,""),lb=Hf.urlHelper.path(jb);cb=this.clientKey(cb,lb,ab||"");(lb=this.clients.get(cb))||this.clients.set(cb,
lb=this.create(Object.assign({},na,{url:jb,namespace:ab})));return lb};rh.prototype.isOnline=function(){return this.socket&&this.socket.connected};rh.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};rh.prototype.open=function(){var na=this,ab,jb,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lb){if(1==lb.nextAddress)return na.isOnline()||na._reconnectState.isOpening?lb.return(na):lb.yield(na.close(),2);na._reconnectState.closed=!1;ab=Hf.urlHelper.join(na.origin,
na.namespace);jb={path:na.path,transports:["websocket","polling"]};cb=na._socketioClient=Hf.ioClient(ab,jb);na.debug&&console.log("["+na+"] connecting");cb.on("error",function(cc){na._reconnectState.isOpening=!1;na.debug&&console.log("["+na+"] errored: "+cc)});cb.on("close",function(cc){return na.debug&&console.log("["+na+"] closed: "+cc)});cb.on("reconnect_failed",function(){return na.debug&&console.log("["+na+"] could not reconnect")});cb.on("reconnect_error",function(cc){return na.debug&&console.log("["+
na+"] reconnect error "+cc)});cb.on("connect",function(){na.debug&&console.log("["+na+"] connected");na.emit("connected",na);na._reconnectState.isOpening=!1;na._reconnectState.isReconnecting=!1;na._reconnectState.isReconnectingViaSocketio=!1});cb.on("disconnect",function(){na._reconnectState.isOpening=!1;na.debug&&console.log("["+na+"] disconnected");na.emit("disconnected",na);na.trackerId?("tracker"!==na.trackerId&&(na.renameTarget(na.trackerId,"tracker"),na.trackerId=null),na._reconnectState.closed?
na.debug&&console.log("["+na+"] won't reconnect b/c client is marked as closed"):na._reconnectState.autoReconnect?(na._reconnectState.isReconnecting=!0,setTimeout(function(){na._reconnectState.closed?na.debug&&console.log("["+na+"] won't reconnect b/c client is marked as closed 2"):na._reconnectState.isReconnectingViaSocketio?na.debug&&console.log("["+na+"] won't reconnect again, client already reconnecting"):(na.debug&&console.log("["+na+"] initiating reconnection to tracker"),na.register())},20)):
na.debug&&console.log("["+na+"] won't reconnect b/c client has reconnection disabled")):(na.debug&&console.log("["+na+"] disconnect: don't have a tracker id, won't try reconnect"),na.trackerId="tracker")});cb.on("reconnecting",function(){na.debug&&console.log("["+na+"] reconnecting",na._reconnectState);na.emit("reconnecting",na);na._reconnectState.closed?(na._reconnectState.isReconnecting=!1,na._reconnectState.isReconnectingViaSocketio=!1,cb.close(),na.close()):(na._reconnectState.isReconnecting=
!0,na._reconnectState.isReconnectingViaSocketio=!0)});cb.on("reconnect",function(){na.debug&&console.log("["+na+"] reconnected");na._reconnectState.isReconnecting=!1;na._reconnectState.isReconnectingViaSocketio=!1;na.register()});na.installEventToMessageTranslator(cb);na._reconnectState.isOpening=!0;return lb.return((new Promise(function(cc,Qc){cb.once("error",Qc);cb.once("connect",cc)})).then(function(){return na}))})};rh.prototype.close=function(){var na=this,ab,jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==
cb.nextAddress){na._reconnectState.closed=!0;if(ab=na.socket)ab.removeAllListeners("reconnect"),ab.removeAllListeners("reconnecting"),ab.removeAllListeners("disconnect"),ab.removeAllListeners("connect"),ab.removeAllListeners("reconnect_error"),ab.removeAllListeners("reconnect_failed"),ab.removeAllListeners("close"),ab.removeAllListeners("error"),ab.close();na.debug&&console.log("["+na+"] closing...");return na.isRegistered()?cb.yield(na.unregister(),2):cb.jumpTo(2)}return na.isOnline()||na.socket?
ab&&!ab.connected?(na.debug&&console.log("["+na+"] socket not connected, considering client closed"),cb.return(na)):cb.return(Promise.race([Hf.promise.delay(2E3).then(function(){return ab.removeAllListeners("disconnect")}),new Promise(function(lb){return ab.once("disconnect",lb)})]).then(function(){na.debug&&console.log("["+na+"] closed");return na})):(na.debug&&(jb=na.isOnline()?"no socket":"not online",na.debug&&console.log("["+na+"] cannot close: "+jb)),cb.return(na))})};rh.prototype.remove=function(){var na=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(na);return this.close()};rh.prototype.register=function(){var na=this,ab,jb,cb,lb,cc,Qc,Lc,Rb,Qb,pc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:if(na.isRegistered())return eb.return();if(na._reconnectState.closed)return na.debug&&console.log("["+na+"] not registering this b/c closed"),na._reconnectState.registerAttempt=0,eb.return();if(na._reconnectState.registerProcess)return na.debug&&
console.log("["+na+"] not registering this b/c register process exists"),eb.return();eb.setCatchFinallyBlocks(2);if(na.isOnline()){eb.jumpTo(4);break}return eb.yield(na.open(),4);case 4:return na.debug&&console.log("["+na+"] register"),eb.yield(na.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Hf.isNode?"node":"browser"),location:Hf.determineLocation()},na.info)),6);case 6:ab=eb.yieldResult;if(!ab.data)throw jb=Error("Register answer is empty!"),na.emit("error",
jb),jb;if(ab.data.isError)throw cb=Error(ab.data.error),na.emit("error",cb),cb;na._reconnectState.registerAttempt=0;lb=ab;cc=lb.data;Qc=cc.trackerId;Lc=cc.messageNumber;na.trackerId=Qc;na._incomingOrderNumberingBySenders.set(Qc,Lc||0);na.emit("registered",{trackerId:Qc});eb.leaveTryBlock(0);break;case 2:Rb=eb.enterCatchBlock(),console.error("Error in register request of "+na+": "+Rb),Qb=na._reconnectState.registerAttempt++,pc=Hf.num.backoff(Qb,4,3E5),na._reconnectState.registerProcess=setTimeout(function(){na._reconnectState.registerProcess=
null;na.register()},pc),eb.jumpToEnd()}})};rh.prototype.unregister=function(){var na=this,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jb){switch(jb.nextAddress){case 1:if(!na.isRegistered())return jb.return();na.debug&&console.log("["+na+"] unregister");ab=na.trackerId;jb.setCatchFinallyBlocks(2);return jb.yield(na.sendToAndWait(na.trackerId,"unregister",{}),4);case 4:jb.leaveTryBlock(3);break;case 2:jb.enterCatchBlock();case 3:na.renameTarget(ab,"tracker"),na.trackerId=null,na.emit("unregistered",
na),jb.jumpToEnd()}})};rh.prototype.whenRegistered=function(na){var ab=this;return Hf.promise.waitFor(na,function(){return ab.isRegistered()}).catch(function(jb){return Promise.reject(/timeout/i.test(String(jb))?Error("Timeout in "+ab+".whenRegistered"):jb)})};rh.prototype.send=function(na,ab){var jb=this,cb=$jscomp.makeIterator(this.prepareSend(na,ab));na=cb.next().value;ab=cb.next().value;this.whenOnline().then(function(){var lb=jb.socket,cc=na,Qc=cc.action;cc=cc.target;if(!lb)throw Error("Trying to send message "+
Qc+" to "+cc+" but cannot find a connection to it!");"function"===typeof ab?lb.emit(Qc,na,ab):lb.emit(Qc,na)})};rh.prototype.joinRoom=function(na){var ab=this;return this.whenOnline().then(function(){return ab.sendToAndWait(ab.trackerId,"[broadcast] join room",{room:na})})};rh.prototype.leaveRoom=function(na){var ab=this;return this.whenOnline().then(function(){return ab.sendToAndWait(ab.trackerId,"[broadcast] leave room",{room:na})})};rh.prototype.broadcast=function(na,ab,jb,cb,lb){var cc=this,Qc=
{action:ab,room:na,broadcast:jb};if(void 0===cb?0:cb)Qc.isSystemBroadcast=!0;if(void 0===lb?0:lb)Qc.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return cc.sendToAndWait(cc.trackerId,"[broadcast] send",Qc)})};rh.prototype.listRoomMembers=function(na){var ab=this,jb,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lb){if(1==lb.nextAddress)return lb.yield(ab.sendToAndWait(ab.trackerId,"[broadcast] list room members",{room:na}),2);jb=lb.yieldResult;cb=jb.data;return lb.return(cb)})};
rh.prototype.joinedRooms=function(){var na=this,ab,jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==cb.nextAddress)return cb.yield(na.sendToAndWait(na.trackerId,"[broadcast] my rooms",{}),2);ab=cb.yieldResult;jb=ab.data;return cb.return(jb)})};rh.prototype.listRooms=function(){var na=this,ab,jb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==cb.nextAddress)return cb.yield(na.sendToAndWait(na.trackerId,"[broadcast] all rooms",{}),2);ab=cb.yieldResult;jb=
ab.data;return cb.return(jb)})};rh.prototype.listPeers=function(na){na=void 0===na?!1:na;var ab=this,jb,cb,lb,cc,Qc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){if(1==Rb.nextAddress)return jb=ab,cb=jb._peersCached,lb=Date.now(),!na&&cb&&1E3>lb-cb.timestamp?Rb.return(ab._peersCached.sessions):ab.isOnline()?Rb.yield(ab.sendToAndWait(ab.trackerId,"getClients",{}),2):Rb.return([]);cc=Rb.yieldResult;Qc=cc.data;Lc=Qc.map(function(Qb){var pc=$jscomp.makeIterator(Qb);Qb=pc.next().value;
var eb=pc.next().value,Ic=eb.info||{};pc=Ic.userRealm;var Ed=Ic.userToken,oe=Ic.l2lUserToken,ud=Ic.location,fe=Ic.type;Ic=Ic.world;Qb=Object.assign({},Hf.obj.dissoc(eb,["info"]),{id:Qb,world:Ic,location:ud,type:fe});(Ed=Ed||oe)&&"null"!==Ed&&(lively.user?Qb.user=lively.user.ClientUser.fromToken(Ed,pc):(Qb.userToken=Ed,Qb.userRealm=pc));return Qb});ab._peersCached={timestamp:lb,sessions:Lc};return Rb.return(Lc)})};rh.prototype.toString=function(){var na=this.origin,ab=this.path,jb=this.namespace,cb=
this.id,lb=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(cb||"").slice(0,5)+" "+na+ab+" - "+jb+" "+lb+")"};$jscomp.global.Object.defineProperties(rh.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(rh,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});ra("default",rh);Hf.L2LClient=rh;Hf.default=rh}}});