System.register(["./__root_module__-89b08ab2.js","kld-intersections","./index-08f1886d.js","./index-4f78f9ac.js"],function(){var ta,nb,xb,Ob,Hb,qd,Dc,hd,Hc,Fc,Sc,ad,Jd,ed;return{setters:[function(sc){ta=sc.aj;nb=sc.aE;xb=sc.aC;Ob=sc.ao;Hb=sc.Z;qd=sc.bQ;Dc=sc.$;hd=sc.a5;Hc=sc.s;Fc=sc.a6;Sc=sc.C;ad=sc.a3;Jd=sc.L;ed=sc.at},function(){},function(){},function(){}],execute:function(){var sc=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js");sc.Morph=ta;sc.World=nb;sc.HorizontalLayout=
xb;sc.morph=Ob;sc.MorphicDB=Hb;sc.graph=qd;sc.promise=Dc;sc.date=hd;sc.string=Hc;sc.arr=Fc;sc.Color=Sc;sc.pt=ad;sc.LoadingIndicator=Jd;(function(ob){var $b=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),Sb=$b.hasOwnProperty("WorldVersion")&&"function"===typeof $b.WorldVersion?$b.WorldVersion:$b.WorldVersion=function(Bc){Bc&&Bc[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ed(Sb,ob,[{key:"update",value:function(){var Bc=
$jscomp.makeIterator(this.submorphs),id=Bc.next().value;Bc=Bc.next().value;id.imageUrl=this.commit.preview;Bc.textAndAttributes=this.info;Bc.fontColor=this.selected?sc.Color.white:sc.Color.darkGray}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"WorldVersion"}},{key:"properties",get:function(){return{commit:{},fill:{defaultValue:sc.Color.transparent},info:{derived:!0,get:function(){var Bc=this.commit,id=Bc.message,Xb=Bc.name,Ub=Bc.timestamp;return[Bc._id.slice(0,6)+" ",{fontWeight:"bold"},
sc.string.truncate(id.split("\n")[0],40)+" ",{}," ("+Xb+" ",{},""+sc.date.format(new Date(Ub),"yyyy-mm-dd HH:MM Z"),{}]}},selected:{set:function(Bc){this.setProperty("selected",Bc);this.update()}},layout:{initialize:function(){this.layout=new sc.HorizontalLayout({align:"center",spacing:5})}},submorphs:{initialize:function(){this.submorphs=[{type:"image",extent:sc.pt(30,30),name:"preview",reactsToPointer:!1},{reactsToPointer:!1,type:"label",fill:null,name:"commit info",fontFamily:"Nunito",fontColor:sc.Color.gray}]}}}}}],
$b,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",version:"0.1.1-34"}}},{start:274,end:1824})})(sc.Morph);var Sa=function(ob){var $b=lively.FreezerRuntime.recorderFor("WorldVersionViewer/index.js"),Sb=$b.hasOwnProperty("WorldVersionViewer")&&"function"===typeof $b.WorldVersionViewer?$b.WorldVersionViewer:$b.WorldVersionViewer=
function(Bc){Bc&&Bc[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return ed(Sb,ob,[{key:"reset",value:function(){this.getSubmorphNamed("version list").items=[];this.getSubmorphNamed("version list spinner").visible=!1}},{key:"onMouseDown",value:function(Bc){switch(Bc.targetMorph.name){case "visit button":this.visitSelectedCommit();break;case "revert button":this.revertToSelectedCommit()}}},{key:"visitSelectedCommit",value:function(){var Bc=
this,id,Xb,Ub,ub,hc,wc,bd,cd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bb){switch(bb.nextAddress){case 1:return id=Bc.get("version list").selection,Xb=sc.LoadingIndicator.open("Loading "+id.name+"..."),Ub=$world,ub=Bc.db||sc.MorphicDB.default,hc=id._id,bb.setCatchFinallyBlocks(2,3),hc?bb.yield(sc.World.loadFromCommit(hc,void 0,{morphicDB:ub}),8):bb.yield(sc.World.loadFromDB(id.name,id.ref,void 0,{morphicDB:ub}),7);case 7:wc=bb.yieldResult;bb.jumpTo(6);break;case 8:wc=bb.yieldResult;
case 6:return bd=wc,bb.return(bd);case 3:bb.enterFinallyBlock();Xb.remove();bb.leaveFinallyBlock(0);break;case 2:cd=bb.enterCatchBlock(),console.error(cd),Ub.showError("Error loading world:"+cd),bb.jumpTo(3)}})}},{key:"revertToSelectedCommit",value:function(){var Bc=this,id,Xb,Ub,ub,hc,wc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(bd){if(1==bd.nextAddress){id=Bc.get("version list").selection;if(!id)return bd.return();Xb=Bc.db||sc.MorphicDB.default;Ub=id;ub=Ub._id;hc=Ub.name;wc=Ub.type;
return bd.yield(Xb.revert(wc,hc,ub,"HEAD"),2)}return bd.return(Bc.initializeFromStartCommit(id,Xb,{showRevertButton:!0}))})}},{key:"initializeFromStartCommit",value:function(Bc,id,Xb){id=void 0===id?sc.MorphicDB.default:id;Xb=void 0===Xb?{}:Xb;var Ub=this,ub,hc,wc,bd,cd,bb,pb,pc,ab,cb,Pa,Za,eb,Na,Da,mb,Zb,dc,Mb,Yb,I,W,sa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xa){switch(xa.nextAddress){case 1:return ub=Xb,hc=void 0===ub.showRefs?!0:ub.showRefs,wc=Ub.startCommit=Bc,bd=wc._id,cd=
wc.type,bb=wc.name,pb=Ub.getSubmorphNamed("version list spinner"),pb.visible=!0,pb.center=Ub.get("version list").center,Ub.db=id,xa.yield(id.history(cd,bb),2);case 2:pc=xa.yieldResult,ab=pc.refs,cb=pc.history,Pa=bd,Za=sc.graph.invert(cb),eb=sc.graph.hull(Za,bd),Na={_id:!0},Da=[Bc],mb=$jscomp.makeIterator(eb),Zb=mb.next();case 3:if(Zb.done)return Yb=sc.arr.max(Da,function(Eb){return Eb.timestamp}),Pa=Yb._id,xa.yield(id.log(Pa,void 0,!0),7);dc=Zb.value;return xa.yield(id.log(dc,void 0,!0,Na),6);case 6:Mb=
xa.yieldResult;Da.push.apply(Da,$jscomp.arrayFromIterable(Mb));Mb.forEach(function(Eb){return Na[Eb._id]=!0});Zb=mb.next();xa.jumpTo(3);break;case 7:I=xa.yieldResult;if(hc)for(W in ab);sa=I.map(function(Eb){var Pb=new sc.WorldVersion({reactsToPointer:!1,commit:Eb});Pb.update();return{isListItem:!0,morph:Pb,value:Eb}});Ub.get("version list").items=sa;pb.visible=!1;xa.jumpToEnd()}})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"WorldVersionViewer"}}],$b,{pathInPackage:function(){return"index.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"WorldVersionViewer",version:"0.1.1-34"}}},{start:1841,end:5718})}(sc.Morph);Sa=sc.WorldVersionViewer;sc.default=Sa}}});