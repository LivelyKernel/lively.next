System.register(["./__root_module__-3c9a1ccb.js","kld-intersections"],function(sa){var lb,Eb,Wb,Qb,Bd,Fc,wd,Kc;return{setters:[function(Gc){lb=Gc.s;Eb=Gc._;Wb=Gc.bi;Qb=Gc.bj;Bd=Gc.ar;Fc=Gc.a5;wd=Gc.bk;Kc=Gc.an},function(){}],execute:function(){function Gc(){function qa(ab,mb){var ic={};mb.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Nc,Lc,Xb){Lc&&(ic[Lc]=Xb)});return ic}if($a)return nc;$a=!0;var eb=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
nb="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");return nc=function(ab){var mb=ab,ic=ab.indexOf("["),Nc=ab.indexOf("]");-1!=ic&&-1!=Nc&&(ab=ab.substring(0,ic)+ab.substring(ic,Nc).replace(/:/g,";")+ab.substring(Nc,ab.length));var Lc=eb.exec(ab||"");ab={};for(var Xb=14;Xb--;)ab[nb[Xb]]=Lc[Xb]||"";-1!=ic&&-1!=Nc&&(ab.source=mb,ab.host=ab.host.substring(1,ab.host.length-1).replace(/;/g,":"),ab.authority=ab.authority.replace("[","").replace("]",
"").replace(/;/g,":"),ab.ipv6uri=!0);mb=ab.path;ic=mb.replace(/\/{2,9}/g,"/").split("/");"/"!=mb.substr(0,1)&&0!==mb.length||ic.splice(0,1);"/"==mb.substr(mb.length-1,1)&&ic.splice(ic.length-1,1);ab.pathNames=ic;ab.queryKey=qa(ab,ab.query);return ab}}function Yc(){function qa(mb){mb=String(mb);if(!(100<mb.length)&&(mb=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(mb))){var ic=parseFloat(mb[1]);switch((mb[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return ic*
ab;case "days":case "day":case "d":return ic*nb;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*ic;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*ic;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*ic;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return ic}}}function eb(mb,ic,Nc){if(!(mb<ic))return mb<1.5*ic?Math.floor(mb/ic)+" "+Nc:Math.ceil(mb/ic)+" "+Nc+"s"}if(Oa)return Pa;Oa=!0;var nb=864E5,ab=365.25*
nb;return Pa=function(mb,ic){ic=ic||{};var Nc=typeof mb;if("string"===Nc&&0<mb.length)return qa(mb);if("number"===Nc&&!1===isNaN(mb))return ic.long?eb(mb,nb,"day")||eb(mb,36E5,"hour")||eb(mb,6E4,"minute")||eb(mb,1E3,"second")||mb+" ms":mb>=nb?Math.round(mb/nb)+"d":36E5<=mb?Math.round(mb/36E5)+"h":6E4<=mb?Math.round(mb/6E4)+"m":1E3<=mb?Math.round(mb/1E3)+"s":mb+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(mb));}}function jd(){function qa(ab){var mb=0,ic;for(ic in ab)mb=
(mb<<5)-mb+ab.charCodeAt(ic),mb|=0;return Kb.colors[Math.abs(mb)%Kb.colors.length]}function eb(ab){function mb(){if(mb.enabled){var Nc=+new Date;mb.diff=Nc-(ic||Nc);mb.prev=ic;ic=mb.curr=Nc;var Lc=Array(arguments.length);for(Nc=0;Nc<Lc.length;Nc++)Lc[Nc]=arguments[Nc];Lc[0]=Kb.coerce(Lc[0]);"string"!==typeof Lc[0]&&Lc.unshift("%O");var Xb=0;Lc[0]=Lc[0].replace(/%([a-zA-Z%])/g,function(Tb,tc){if("%%"===Tb)return Tb;Xb++;tc=Kb.formatters[tc];"function"===typeof tc&&(Tb=tc.call(mb,Lc[Xb]),Lc.splice(Xb,
1),Xb--);return Tb});Kb.formatArgs.call(mb,Lc);(mb.log||Kb.log||console.log.bind(console)).apply(mb,Lc)}}var ic;mb.namespace=ab;mb.enabled=Kb.enabled(ab);mb.useColors=Kb.useColors();mb.color=qa(ab);mb.destroy=nb;"function"===typeof Kb.init&&Kb.init(mb);Kb.instances.push(mb);return mb}function nb(){var ab=Kb.instances.indexOf(this||bd);return-1!==ab?(Kb.instances.splice(ab,1),!0):!1}if(Ib)return Kb;Ib=!0;Kb=Kb=eb.debug=eb["default"]=eb;Kb.coerce=function(ab){return ab instanceof Error?ab.stack||ab.message:
ab};Kb.disable=function(){Kb.enable("")};Kb.enable=function(ab){Kb.save(ab);Kb.names=[];Kb.skips=[];var mb,ic=("string"===typeof ab?ab:"").split(/[\s,]+/),Nc=ic.length;for(mb=0;mb<Nc;mb++)ic[mb]&&(ab=ic[mb].replace(/\*/g,".*?"),"-"===ab[0]?Kb.skips.push(new RegExp("^"+ab.substr(1)+"$")):Kb.names.push(new RegExp("^"+ab+"$")));for(mb=0;mb<Kb.instances.length;mb++)ab=Kb.instances[mb],ab.enabled=Kb.enabled(ab.namespace)};Kb.enabled=function(ab){if("*"===ab[ab.length-1])return!0;var mb;var ic=0;for(mb=
Kb.skips.length;ic<mb;ic++)if(Kb.skips[ic].test(ab))return!1;ic=0;for(mb=Kb.names.length;ic<mb;ic++)if(Kb.names[ic].test(ab))return!0;return!1};Kb.humanize=Yc();Kb.instances=[];Kb.names=[];Kb.skips=[];Kb.formatters={};return Kb}function Dd(){function qa(){try{var mb=Od.storage.debug}catch(ic){}!mb&&"undefined"!==typeof eb&&"env"in eb&&(mb=eb.env.DEBUG);return mb}if(Zd)return Od;Zd=!0;var eb=Wb;Od=Od=jd();Od.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,
console,arguments)};Od.formatArgs=function(mb){var ic=(this||Te).useColors;mb[0]=(ic?"%c":"")+(this||Te).namespace+(ic?" %c":" ")+mb[0]+(ic?"%c ":" ")+"+"+Od.humanize((this||Te).diff);if(ic){ic="color: "+(this||Te).color;mb.splice(1,0,ic,"color: inherit");var Nc=0,Lc=0;mb[0].replace(/%[a-zA-Z%]/g,function(Xb){"%%"!==Xb&&(Nc++,"%c"===Xb&&(Lc=Nc))});mb.splice(Lc,0,ic)}};Od.save=function(mb){try{null==mb?Od.storage.removeItem("debug"):Od.storage.debug=mb}catch(ic){}};Od.load=qa;Od.useColors=function(){return"undefined"!==
typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&
31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var nb=Od;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var ab=chrome.storage.local;else a:{try{ab=window.localStorage;break a}catch(mb){}ab=void 0}nb.storage=ab;Od.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
Od.formatters.j=function(mb){try{return JSON.stringify(mb)}catch(ic){return"[UnexpectedJSONParseError]: "+ic.message}};Od.enable(qa());return Od}function od(){if(Xd)return Qc;Xd=!0;var qa=Gc(),eb=Dd()("socket.io-client:url");return Qc=function(nb,ab){var mb=nb;ab=ab||"undefined"!==typeof location&&location;null==nb&&(nb=ab.protocol+"//"+ab.host);"string"===typeof nb&&("/"===nb.charAt(0)&&(nb="/"===nb.charAt(1)?ab.protocol+nb:ab.host+nb),/^(https?|wss?):\/\//.test(nb)||(eb("protocol-less url %s",nb),
nb="undefined"!==typeof ab?ab.protocol+"//"+nb:"https://"+nb),eb("parse %s",nb),mb=qa(nb));mb.port||(/^(http|ws)$/.test(mb.protocol)?mb.port="80":/^(http|ws)s$/.test(mb.protocol)&&(mb.port="443"));mb.path=mb.path||"/";nb=-1!==mb.host.indexOf(":")?"["+mb.host+"]":mb.host;mb.id=mb.protocol+"://"+nb+":"+mb.port;mb.href=mb.protocol+"://"+nb+(ab&&ab.port===mb.port?"":":"+mb.port);return mb}}function Zc(){function qa(eb){if(eb){for(var nb in qa.prototype)eb[nb]=qa.prototype[nb];return eb}}if(Bb)return kd;
Bb=!0;kd=qa;qa.prototype.on=qa.prototype.addEventListener=function(eb,nb){(this||da)._callbacks=(this||da)._callbacks||{};((this||da)._callbacks["$"+eb]=(this||da)._callbacks["$"+eb]||[]).push(nb);return this||da};qa.prototype.once=function(eb,nb){function ab(){this.off(eb,ab);nb.apply(this||da,arguments)}ab.fn=nb;this.on(eb,ab);return this||da};qa.prototype.off=qa.prototype.removeListener=qa.prototype.removeAllListeners=qa.prototype.removeEventListener=function(eb,nb){(this||da)._callbacks=(this||
da)._callbacks||{};if(0==arguments.length)return(this||da)._callbacks={},this||da;var ab=(this||da)._callbacks["$"+eb];if(!ab)return this||da;if(1==arguments.length)return delete (this||da)._callbacks["$"+eb],this||da;for(var mb,ic=0;ic<ab.length;ic++)if(mb=ab[ic],mb===nb||mb.fn===nb){ab.splice(ic,1);break}0===ab.length&&delete (this||da)._callbacks["$"+eb];return this||da};qa.prototype.emit=function(eb){(this||da)._callbacks=(this||da)._callbacks||{};for(var nb=Array(arguments.length-1),ab=(this||
da)._callbacks["$"+eb],mb=1;mb<arguments.length;mb++)nb[mb-1]=arguments[mb];if(ab){ab=ab.slice(0);mb=0;for(var ic=ab.length;mb<ic;++mb)ab[mb].apply(this||da,nb)}return this||da};qa.prototype.listeners=function(eb){(this||da)._callbacks=(this||da)._callbacks||{};return(this||da)._callbacks["$"+eb]||[]};qa.prototype.hasListeners=function(eb){return!!this.listeners(eb).length};return kd}function Ra(){if(ub)return ra;ub=!0;var qa={}.toString;return ra=Array.isArray||function(eb){return"[object Array]"==
qa.call(eb)}}function tb(){if(ia)return H;ia=!0;var qa=Qb.Buffer;H=function(ab){var mb;!(mb=eb&&qa.isBuffer(ab))&&(mb=nb)&&((mb=ab instanceof ArrayBuffer)||(mb="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(ab):ab.buffer instanceof ArrayBuffer));return mb};var eb="function"===typeof qa&&"function"===typeof qa.isBuffer,nb="function"===typeof ArrayBuffer;return H}function dc(){function qa(Lc,Xb){if(!Lc)return Lc;if(ab(Lc)){var Tb={_placeholder:!0,num:Xb.length};Xb.push(Lc);return Tb}if(nb(Lc)){Tb=
Array(Lc.length);for(var tc=0;tc<Lc.length;tc++)Tb[tc]=qa(Lc[tc],Xb);return Tb}if("object"===typeof Lc&&!(Lc instanceof Date)){Tb={};for(tc in Lc)Tb[tc]=qa(Lc[tc],Xb);return Tb}return Lc}function eb(Lc,Xb){if(!Lc)return Lc;if(Lc&&Lc._placeholder)return Xb[Lc.num];if(nb(Lc))for(var Tb=0;Tb<Lc.length;Tb++)Lc[Tb]=eb(Lc[Tb],Xb);else if("object"===typeof Lc)for(Tb in Lc)Lc[Tb]=eb(Lc[Tb],Xb);return Lc}if(rb)return Ba;rb=!0;var nb=Ra(),ab=tb(),mb=Object.prototype.toString,ic="function"===typeof Blob||"undefined"!==
typeof Blob&&"[object BlobConstructor]"===mb.call(Blob),Nc="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===mb.call(File);Ba.deconstructPacket=function(Lc){var Xb=[];Lc.data=qa(Lc.data,Xb);Lc.attachments=Xb.length;return{packet:Lc,buffers:Xb}};Ba.reconstructPacket=function(Lc,Xb){Lc.data=eb(Lc.data,Xb);Lc.attachments=void 0;return Lc};Ba.removeBlobs=function(Lc,Xb){function Tb(Hc,Cd,fe){if(!Hc)return Hc;if(ic&&Hc instanceof Blob||Nc&&Hc instanceof File){tc++;var qd=
new FileReader;qd.onload=function(){fe?fe[Cd]=(this||sc).result:gb=(this||sc).result;--tc||Xb(gb)};qd.readAsArrayBuffer(Hc)}else if(nb(Hc))for(qd=0;qd<Hc.length;qd++)Tb(Hc[qd],qd,Hc);else if("object"===typeof Hc&&!ab(Hc))for(qd in Hc)Tb(Hc[qd],qd,Hc)}var tc=0,gb=Lc;Tb(gb);tc||Xb(gb)};return Ba}function bc(){function qa(){}function eb(gb){var Hc=""+gb.type;if(yc.BINARY_EVENT===gb.type||yc.BINARY_ACK===gb.type)Hc+=gb.attachments+"-";gb.nsp&&"/"!==gb.nsp&&(Hc+=gb.nsp+",");null!=gb.id&&(Hc+=gb.id);if(null!=
gb.data){try{var Cd=JSON.stringify(gb.data)}catch(fe){Cd=!1}if(!1!==Cd)Hc+=Cd;else return tc}ic("encoded %j as %s",gb,Hc);return Hc}function nb(gb,Hc){Lc.removeBlobs(gb,function(Cd){var fe=Lc.deconstructPacket(Cd);Cd=eb(fe.packet);fe=fe.buffers;fe.unshift(Cd);Hc(fe)})}function ab(){(this||Ld).reconstructor=null}function mb(gb){(this||Ld).reconPack=gb;(this||Ld).buffers=[]}if(Gd)return yc;Gd=!0;var ic=Dd()("socket.io-parser"),Nc=Zc(),Lc=dc(),Xb=Ra(),Tb=tb();yc.protocol=4;yc.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");
yc.CONNECT=0;yc.DISCONNECT=1;yc.EVENT=2;yc.ACK=3;yc.ERROR=4;yc.BINARY_EVENT=5;yc.BINARY_ACK=6;yc.Encoder=qa;yc.Decoder=ab;var tc=yc.ERROR+'"encode error"';qa.prototype.encode=function(gb,Hc){ic("encoding packet %j",gb);yc.BINARY_EVENT===gb.type||yc.BINARY_ACK===gb.type?nb(gb,Hc):(gb=eb(gb),Hc([gb]))};Nc(ab.prototype);ab.prototype.add=function(gb){if("string"===typeof gb){a:{var Hc=0,Cd={type:Number(gb.charAt(0))};if(null==yc.types[Cd.type])gb={type:yc.ERROR,data:"parser error: unknown packet type "+
Cd.type};else{if(yc.BINARY_EVENT===Cd.type||yc.BINARY_ACK===Cd.type){for(var fe="";"-"!==gb.charAt(++Hc)&&(fe+=gb.charAt(Hc),Hc!=gb.length););if(fe!=Number(fe)||"-"!==gb.charAt(Hc))throw Error("Illegal attachments");Cd.attachments=Number(fe)}if("/"===gb.charAt(Hc+1))for(Cd.nsp="";++Hc;){fe=gb.charAt(Hc);if(","===fe)break;Cd.nsp+=fe;if(Hc===gb.length)break}else Cd.nsp="/";fe=gb.charAt(Hc+1);if(""!==fe&&Number(fe)==fe){for(Cd.id="";++Hc;){fe=gb.charAt(Hc);if(null==fe||Number(fe)!=fe){--Hc;break}Cd.id+=
gb.charAt(Hc);if(Hc===gb.length)break}Cd.id=Number(Cd.id)}if(gb.charAt(++Hc)){Hc=gb.substr(Hc);try{var qd=JSON.parse(Hc)}catch(ge){qd=!1}if(!1===qd||Cd.type!==yc.ERROR&&!Xb(qd)){gb={type:yc.ERROR,data:"parser error: invalid payload"};break a}else Cd.data=qd}ic("decoded %s as %j",gb,Cd);gb=Cd}}yc.BINARY_EVENT===gb.type||yc.BINARY_ACK===gb.type?((this||Ld).reconstructor=new mb(gb),0===(this||Ld).reconstructor.reconPack.attachments&&this.emit("decoded",gb)):this.emit("decoded",gb)}else if(Tb(gb)||gb.base64)if((this||
Ld).reconstructor){if(gb=(this||Ld).reconstructor.takeBinaryData(gb))(this||Ld).reconstructor=null,this.emit("decoded",gb)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+gb);};ab.prototype.destroy=function(){(this||Ld).reconstructor&&(this||Ld).reconstructor.finishedReconstruction()};mb.prototype.takeBinaryData=function(gb){(this||Ld).buffers.push(gb);return(this||Ld).buffers.length===(this||Ld).reconPack.attachments?(gb=Lc.reconstructPacket((this||
Ld).reconPack,(this||Ld).buffers),this.finishedReconstruction(),gb):null};mb.prototype.finishedReconstruction=function(){(this||Ld).reconPack=null;(this||Ld).buffers=[]};return yc}function Xc(){if(ze)return Md;ze=!0;return Md="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()}function Oc(){if(yf)return Ne;yf=!0;if(!hd){hd=!0;try{Ke="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(nb){Ke=!1}}var qa=Ke;var eb=Xc();return Ne=function(nb){var ab=
nb.xdomain,mb=nb.xscheme;nb=nb.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!ab||qa))return new XMLHttpRequest}catch(ic){}try{if("undefined"!==typeof XDomainRequest&&!mb&&nb)return new XDomainRequest}catch(ic){}if(!ab)try{return new (eb[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(ic){}}}function $b(){if(vc)return tf;vc=!0;return tf=Object.keys||function(qa){var eb=[],nb=Object.prototype.hasOwnProperty,ab;for(ab in qa)nb.call(qa,ab)&&eb.push(ab);return eb}}function zc(){function qa(Nc){if(!Nc||
"object"!==typeof Nc)return!1;if(nb(Nc)){for(var Lc=0,Xb=Nc.length;Lc<Xb;Lc++)if(qa(Nc[Lc]))return!0;return!1}if("function"===typeof eb&&eb.isBuffer&&eb.isBuffer(Nc)||"function"===typeof ArrayBuffer&&Nc instanceof ArrayBuffer||mb&&Nc instanceof Blob||ic&&Nc instanceof File)return!0;if(Nc.toJSON&&"function"===typeof Nc.toJSON&&1===arguments.length)return qa(Nc.toJSON(),!0);for(Lc in Nc)if(Object.prototype.hasOwnProperty.call(Nc,Lc)&&qa(Nc[Lc]))return!0;return!1}if(mf)return Fe;mf=!0;var eb=Qb.Buffer,
nb=Ra(),ab=Object.prototype.toString,mb="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===ab.call(Blob),ic="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===ab.call(File);return Fe=qa}function Fb(){if(ye)return Jf;ye=!0;return Jf=function(qa,eb,nb){var ab=qa.byteLength;eb=eb||0;nb=nb||ab;if(qa.slice)return qa.slice(eb,nb);0>eb&&(eb+=ab);0>nb&&(nb+=ab);nb>ab&&(nb=ab);if(eb>=ab||eb>=nb||0===ab)return new ArrayBuffer(0);qa=new Uint8Array(qa);
ab=new Uint8Array(nb-eb);for(var mb=0;eb<nb;eb++,mb++)ab[mb]=qa[eb];return ab.buffer}}function Cb(){function qa(){}if(Ka)return va;Ka=!0;return va=function(eb,nb,ab){function mb(Nc,Lc){if(0>=mb.count)throw Error("after called too many times");--mb.count;Nc?(ic=!0,nb(Nc),nb=ab):0!==mb.count||ic||nb(null,Lc)}var ic=!1;ab=ab||qa;mb.count=eb;return 0===eb?nb():mb}}function pc(){function qa(Xb){for(var Tb=[],tc=0,gb=Xb.length,Hc,Cd;tc<gb;)Hc=Xb.charCodeAt(tc++),55296<=Hc&&56319>=Hc&&tc<gb?(Cd=Xb.charCodeAt(tc++),
56320==(Cd&64512)?Tb.push(((Hc&1023)<<10)+(Cd&1023)+65536):(Tb.push(Hc),tc--)):Tb.push(Hc);return Tb}function eb(Xb,Tb){if(55296<=Xb&&57343>=Xb){if(Tb)throw Error("Lone surrogate U+"+Xb.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function nb(){if(Lc>=Nc)throw Error("Invalid byte index");var Xb=ic[Lc]&255;Lc++;if(128==(Xb&192))return Xb&63;throw Error("Invalid continuation byte");}function ab(Xb){if(Lc>Nc)throw Error("Invalid byte index");if(Lc==Nc)return!1;var Tb=ic[Lc]&
255;Lc++;if(0==(Tb&128))return Tb;if(192==(Tb&224)){var tc=nb();Tb=(Tb&31)<<6|tc;if(128<=Tb)return Tb;throw Error("Invalid continuation byte");}if(224==(Tb&240)){tc=nb();var gb=nb();Tb=(Tb&15)<<12|tc<<6|gb;if(2048<=Tb)return eb(Tb,Xb)?Tb:65533;throw Error("Invalid continuation byte");}if(240==(Tb&248)&&(tc=nb(),gb=nb(),Xb=nb(),Tb=(Tb&7)<<18|tc<<12|gb<<6|Xb,65536<=Tb&&1114111>=Tb))return Tb;throw Error("Invalid UTF-8 detected");}if(Q)return sb;Q=!0;var mb=String.fromCharCode,ic,Nc,Lc;return sb={version:"2.1.2",
encode:function(Xb,Tb){Tb=Tb||{};Tb=!1!==Tb.strict;Xb=qa(Xb);for(var tc=Xb.length,gb=-1,Hc,Cd="";++gb<tc;){Hc=Xb[gb];var fe=Tb;if(0==(Hc&4294967168))Hc=mb(Hc);else{var qd="";0==(Hc&4294965248)?qd=mb(Hc>>6&31|192):0==(Hc&4294901760)?(eb(Hc,fe)||(Hc=65533),qd=mb(Hc>>12&15|224),qd+=mb(Hc>>6&63|128)):0==(Hc&4292870144)&&(qd=mb(Hc>>18&7|240),qd+=mb(Hc>>12&63|128),qd+=mb(Hc>>6&63|128));Hc=qd+=mb(Hc&63|128)}Cd+=Hc}return Cd},decode:function(Xb,Tb){Tb=Tb||{};Tb=!1!==Tb.strict;ic=qa(Xb);Nc=ic.length;Lc=0;
Xb=[];for(var tc;!1!==(tc=ab(Tb));)Xb.push(tc);Tb=Xb.length;tc=-1;for(var gb,Hc="";++tc<Tb;)gb=Xb[tc],65535<gb&&(gb-=65536,Hc+=mb(gb>>>10&1023|55296),gb=56320|gb&1023),Hc+=mb(gb);return Hc}}}function Pc(){if(Za)return ua;Za=!0;(function(qa){ua.encode=function(eb){eb=new Uint8Array(eb);var nb,ab=eb.length,mb="";for(nb=0;nb<ab;nb+=3)mb+=qa[eb[nb]>>2],mb+=qa[(eb[nb]&3)<<4|eb[nb+1]>>4],mb+=qa[(eb[nb+1]&15)<<2|eb[nb+2]>>6],mb+=qa[eb[nb+2]&63];2===ab%3?mb=mb.substring(0,mb.length-1)+"=":1===ab%3&&(mb=mb.substring(0,
mb.length-2)+"==");return mb};ua.decode=function(eb){var nb=.75*eb.length,ab=eb.length,mb=0;"="===eb[eb.length-1]&&(nb--,"="===eb[eb.length-2]&&nb--);var ic=new ArrayBuffer(nb),Nc=new Uint8Array(ic);for(nb=0;nb<ab;nb+=4){var Lc=qa.indexOf(eb[nb]);var Xb=qa.indexOf(eb[nb+1]);var Tb=qa.indexOf(eb[nb+2]);var tc=qa.indexOf(eb[nb+3]);Nc[mb++]=Lc<<2|Xb>>4;Nc[mb++]=(Xb&15)<<4|Tb>>2;Nc[mb++]=(Tb&3)<<6|tc&63}return ic}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");return ua}function wb(){function qa(Lc){return Lc.map(function(Xb){if(Xb.buffer instanceof
ArrayBuffer){var Tb=Xb.buffer;if(Xb.byteLength!==Tb.byteLength){var tc=new Uint8Array(Xb.byteLength);tc.set(new Uint8Array(Tb,Xb.byteOffset,Xb.byteLength));Tb=tc.buffer}return Tb}return Xb})}function eb(Lc,Xb){Xb=Xb||{};var Tb=new ab;qa(Lc).forEach(function(tc){Tb.append(tc)});return Xb.type?Tb.getBlob(Xb.type):Tb.getBlob()}function nb(Lc,Xb){return new Blob(qa(Lc),Xb||{})}if(oc)return ib;oc=!0;var ab="undefined"!==typeof ab?ab:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==
typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var mb=2===(new Blob(["hi"])).size}catch(Lc){mb=!1}var ic;if(ic=mb)try{ic=2===(new Blob([new Uint8Array([1,2])])).size}catch(Lc){ic=!1}var Nc=ab&&ab.prototype.append&&ab.prototype.getBlob;"undefined"!==typeof Blob&&(eb.prototype=Blob.prototype,nb.prototype=Blob.prototype);ib=mb?ic?Blob:nb:Nc?eb:void 0;return ib}function db(){function qa(qd,ge,se){if(!ge)return cc.encodeBase64Packet(qd,se);var Se=new FileReader;
Se.onload=function(){cc.encodePacket({type:qd.type,data:Se.result},ge,!0,se)};return Se.readAsArrayBuffer(qd.data)}function eb(qd,ge,se){var Se=Array(qd.length);se=ic(qd.length,se);for(var Ue=function(eg,We,li){ge(We,function(ca,za){Se[eg]=za;li(ca,Se)})},Kf=0;Kf<qd.length;Kf++)Ue(Kf,qd[Kf],se)}if(ad)return cc;ad=!0;var nb=$b(),ab=zc(),mb=Fb(),ic=Cb(),Nc=pc(),Lc;"undefined"!==typeof ArrayBuffer&&(Lc=Pc());var Xb="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),Tb="undefined"!==
typeof navigator&&/PhantomJS/i.test(navigator.userAgent),tc=Xb||Tb;cc.protocol=3;var gb=cc.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},Hc=nb(gb),Cd={type:"error",data:"parser error"},fe=wb();cc.encodePacket=function(qd,ge,se,Se){"function"===typeof ge&&(Se=ge,ge=!1);"function"===typeof se&&(Se=se,se=null);var Ue=void 0===qd.data?void 0:qd.data.buffer||qd.data;if("undefined"!==typeof ArrayBuffer&&Ue instanceof ArrayBuffer){if(ge){se=qd.data;ge=new Uint8Array(se);se=new Uint8Array(1+
se.byteLength);se[0]=gb[qd.type];for(qd=0;qd<ge.length;qd++)se[qd+1]=ge[qd];qd=Se(se.buffer)}else qd=cc.encodeBase64Packet(qd,Se);return qd}if("undefined"!==typeof fe&&Ue instanceof fe)return ge?tc?qd=qa(qd,ge,Se):(ge=new Uint8Array(1),ge[0]=gb[qd.type],qd=new fe([ge.buffer,qd.data]),qd=Se(qd)):qd=cc.encodeBase64Packet(qd,Se),qd;if(Ue&&Ue.base64)return Se("b"+cc.packets[qd.type]+qd.data.data);ge=gb[qd.type];void 0!==qd.data&&(ge+=se?Nc.encode(String(qd.data),{strict:!1}):String(qd.data));return Se(""+
ge)};cc.encodeBase64Packet=function(qd,ge){var se="b"+cc.packets[qd.type];if("undefined"!==typeof fe&&qd.data instanceof fe){var Se=new FileReader;Se.onload=function(){var eg=Se.result.split(",")[1];ge(se+eg)};return Se.readAsDataURL(qd.data)}try{var Ue=String.fromCharCode.apply(null,new Uint8Array(qd.data))}catch(eg){qd=new Uint8Array(qd.data);Ue=Array(qd.length);for(var Kf=0;Kf<qd.length;Kf++)Ue[Kf]=qd[Kf];Ue=String.fromCharCode.apply(null,Ue)}se+=btoa(Ue);return ge(se)};cc.decodePacket=function(qd,
ge,se){if(void 0===qd)return Cd;if("string"===typeof qd){if("b"===qd.charAt(0))return cc.decodeBase64Packet(qd.substr(1),ge);if(se){a:{ge=qd;try{ge=Nc.decode(ge,{strict:!1})}catch(Se){qd=!1;break a}qd=ge}if(!1===qd)return Cd}se=qd.charAt(0);return Number(se)==se&&Hc[se]?1<qd.length?{type:Hc[se],data:qd.substring(1)}:{type:Hc[se]}:Cd}se=(new Uint8Array(qd))[0];qd=mb(qd,1);fe&&"blob"===ge&&(qd=new fe([qd]));return{type:Hc[se],data:qd}};cc.decodeBase64Packet=function(qd,ge){var se=Hc[qd.charAt(0)];if(!Lc)return{type:se,
data:{base64:!0,data:qd.substr(1)}};qd=Lc.decode(qd.substr(1));"blob"===ge&&fe&&(qd=new fe([qd]));return{type:se,data:qd}};cc.encodePayload=function(qd,ge,se){"function"===typeof ge&&(se=ge,ge=null);var Se=ab(qd);if(ge&&Se)return fe&&!tc?cc.encodePayloadAsBlob(qd,se):cc.encodePayloadAsArrayBuffer(qd,se);if(!qd.length)return se("0:");eb(qd,function(Ue,Kf){cc.encodePacket(Ue,Se?ge:!1,!1,function(eg){Kf(null,eg.length+":"+eg)})},function(Ue,Kf){return se(Kf.join(""))})};cc.decodePayload=function(qd,
ge,se){if("string"!==typeof qd)return cc.decodePayloadAsBinary(qd,ge,se);"function"===typeof ge&&(se=ge,ge=null);if(""===qd)return se(Cd,0,1);var Se="";for(var Ue,Kf,eg=0,We=qd.length;eg<We;eg++)if(Kf=qd.charAt(eg),":"!==Kf)Se+=Kf;else{if(""===Se||Se!=(Ue=Number(Se)))return se(Cd,0,1);Kf=qd.substr(eg+1,Ue);if(Se!=Kf.length)return se(Cd,0,1);if(Kf.length){Se=cc.decodePacket(Kf,ge,!1);if(Cd.type===Se.type&&Cd.data===Se.data)return se(Cd,0,1);if(!1===se(Se,eg+Ue,We))return}eg+=Ue;Se=""}if(""!==Se)return se(Cd,
0,1)};cc.encodePayloadAsArrayBuffer=function(qd,ge){if(!qd.length)return ge(new ArrayBuffer(0));eb(qd,function(se,Se){cc.encodePacket(se,!0,!0,function(Ue){return Se(null,Ue)})},function(se,Se){se=Se.reduce(function(eg,We){We="string"===typeof We?We.length:We.byteLength;return eg+We.toString().length+We+2},0);var Ue=new Uint8Array(se),Kf=0;Se.forEach(function(eg){var We="string"===typeof eg,li=eg;if(We){li=new Uint8Array(eg.length);for(var ca=0;ca<eg.length;ca++)li[ca]=eg.charCodeAt(ca);li=li.buffer}We?
Ue[Kf++]=0:Ue[Kf++]=1;eg=li.byteLength.toString();for(ca=0;ca<eg.length;ca++)Ue[Kf++]=parseInt(eg[ca]);Ue[Kf++]=255;li=new Uint8Array(li);for(ca=0;ca<li.length;ca++)Ue[Kf++]=li[ca]});return ge(Ue.buffer)})};cc.encodePayloadAsBlob=function(qd,ge){eb(qd,function(se,Se){cc.encodePacket(se,!0,!0,function(Ue){var Kf=new Uint8Array(1);Kf[0]=1;if("string"===typeof Ue){for(var eg=new Uint8Array(Ue.length),We=0;We<Ue.length;We++)eg[We]=Ue.charCodeAt(We);Ue=eg.buffer;Kf[0]=0}eg=(Ue instanceof ArrayBuffer?Ue.byteLength:
Ue.size).toString();var li=new Uint8Array(eg.length+1);for(We=0;We<eg.length;We++)li[We]=parseInt(eg[We]);li[eg.length]=255;fe&&(Ue=new fe([Kf.buffer,li.buffer,Ue]),Se(null,Ue))})},function(se,Se){return ge(new fe(Se))})};cc.decodePayloadAsBinary=function(qd,ge,se){"function"===typeof ge&&(se=ge,ge=null);for(var Se=[];0<qd.byteLength;){for(var Ue=new Uint8Array(qd),Kf=0===Ue[0],eg="",We=1;255!==Ue[We];We++){if(310<eg.length)return se(Cd,0,1);eg+=Ue[We]}qd=mb(qd,2+eg.length);eg=parseInt(eg);Ue=mb(qd,
0,eg);if(Kf)try{Ue=String.fromCharCode.apply(null,new Uint8Array(Ue))}catch(ca){for(Kf=new Uint8Array(Ue),Ue="",We=0;We<Kf.length;We++)Ue+=String.fromCharCode(Kf[We])}Se.push(Ue);qd=mb(qd,eg)}var li=Se.length;Se.forEach(function(ca,za){se(cc.decodePacket(ca,ge,!0),za,li)})};return cc}function Ta(){function qa(ab){(this||Yd).path=ab.path;(this||Yd).hostname=ab.hostname;(this||Yd).port=ab.port;(this||Yd).secure=ab.secure;(this||Yd).query=ab.query;(this||Yd).timestampParam=ab.timestampParam;(this||Yd).timestampRequests=
ab.timestampRequests;(this||Yd).readyState="";(this||Yd).agent=ab.agent||!1;(this||Yd).socket=ab.socket;(this||Yd).enablesXDR=ab.enablesXDR;(this||Yd).withCredentials=ab.withCredentials;(this||Yd).pfx=ab.pfx;(this||Yd).key=ab.key;(this||Yd).passphrase=ab.passphrase;(this||Yd).cert=ab.cert;(this||Yd).ca=ab.ca;(this||Yd).ciphers=ab.ciphers;(this||Yd).rejectUnauthorized=ab.rejectUnauthorized;(this||Yd).forceNode=ab.forceNode;(this||Yd).isReactNative=ab.isReactNative;(this||Yd).extraHeaders=ab.extraHeaders;
(this||Yd).localAddress=ab.localAddress}if(Vc)return Tc;Vc=!0;var eb=db(),nb=Zc();Tc=qa;nb(qa.prototype);qa.prototype.onError=function(ab,mb){ab=Error(ab);ab.type="TransportError";ab.description=mb;this.emit("error",ab);return this||Yd};qa.prototype.open=function(){if("closed"===(this||Yd).readyState||""===(this||Yd).readyState)(this||Yd).readyState="opening",this.doOpen();return this||Yd};qa.prototype.close=function(){if("opening"===(this||Yd).readyState||"open"===(this||Yd).readyState)this.doClose(),
this.onClose();return this||Yd};qa.prototype.send=function(ab){if("open"===(this||Yd).readyState)this.write(ab);else throw Error("Transport not open");};qa.prototype.onOpen=function(){(this||Yd).readyState="open";(this||Yd).writable=!0;this.emit("open")};qa.prototype.onData=function(ab){ab=eb.decodePacket(ab,(this||Yd).socket.binaryType);this.onPacket(ab)};qa.prototype.onPacket=function(ab){this.emit("packet",ab)};qa.prototype.onClose=function(){(this||Yd).readyState="closed";this.emit("close")};
return Tc}function cb(){if(Bf)return Mf;Bf=!0;Mf.encode=function(qa){var eb="",nb;for(nb in qa)qa.hasOwnProperty(nb)&&(eb.length&&(eb+="&"),eb+=encodeURIComponent(nb)+"="+encodeURIComponent(qa[nb]));return eb};Mf.decode=function(qa){var eb={};qa=qa.split("&");for(var nb=0,ab=qa.length;nb<ab;nb++){var mb=qa[nb].split("=");eb[decodeURIComponent(mb[0])]=decodeURIComponent(mb[1])}return eb};return Mf}function ma(){if(df)return Hg;df=!0;return Hg=function(qa,eb){var nb=function(){};nb.prototype=eb.prototype;
qa.prototype=new nb;qa.prototype.constructor=qa}}function La(){function qa(Lc){var Xb="";do Xb=nb[Lc%64]+Xb,Lc=Math.floor(Lc/64);while(0<Lc);return Xb}function eb(){var Lc=qa(+new Date);return Lc!==Nc?(mb=0,Nc=Lc):Lc+"."+qa(mb++)}if(Di)return Bg;Di=!0;for(var nb="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ab={},mb=0,ic=0,Nc;64>ic;ic++)ab[nb[ic]]=ic;eb.encode=qa;eb.decode=function(Lc){var Xb=0;for(ic=0;ic<Lc.length;ic++)Xb=64*Xb+ab[Lc.charAt(ic)];return Xb};return Bg=
eb}function fb(){function qa(Xb){var Tb=Xb&&Xb.forceBase64;if(!Lc||Tb)(this||Oe).supportsBinary=!1;eb.call(this||Oe,Xb)}if(Nj)return Pg;Nj=!0;var eb=Ta(),nb=cb(),ab=db(),mb=ma(),ic=La(),Nc=Dd()("engine.io-client:polling");Pg=qa;var Lc=null!=(new (Oc())({xdomain:!1})).responseType;mb(qa,eb);qa.prototype.name="polling";qa.prototype.doOpen=function(){this.poll()};qa.prototype.pause=function(Xb){function Tb(){Nc("paused");tc.readyState="paused";Xb()}var tc=this||Oe;(this||Oe).readyState="pausing";if((this||
Oe).polling||!(this||Oe).writable){var gb=0;(this||Oe).polling&&(Nc("we are currently polling - waiting to pause"),gb++,this.once("pollComplete",function(){Nc("pre-pause polling complete");--gb||Tb()}));(this||Oe).writable||(Nc("we are currently writing - waiting to pause"),gb++,this.once("drain",function(){Nc("pre-pause writing complete");--gb||Tb()}))}else Tb()};qa.prototype.poll=function(){Nc("polling");(this||Oe).polling=!0;this.doPoll();this.emit("poll")};qa.prototype.onData=function(Xb){var Tb=
this||Oe;Nc("polling got data %s",Xb);ab.decodePayload(Xb,(this||Oe).socket.binaryType,function(tc,gb,Hc){if("opening"===Tb.readyState)Tb.onOpen();if("close"===tc.type)return Tb.onClose(),!1;Tb.onPacket(tc)});"closed"!==(this||Oe).readyState&&((this||Oe).polling=!1,this.emit("pollComplete"),"open"===(this||Oe).readyState?this.poll():Nc('ignoring poll - transport state "%s"',(this||Oe).readyState))};qa.prototype.doClose=function(){function Xb(){Nc("writing close packet");Tb.write([{type:"close"}])}
var Tb=this||Oe;"open"===(this||Oe).readyState?(Nc("transport open - closing"),Xb()):(Nc("transport not open - deferring close"),this.once("open",Xb))};qa.prototype.write=function(Xb){var Tb=this||Oe;(this||Oe).writable=!1;var tc=function(){Tb.writable=!0;Tb.emit("drain")};ab.encodePayload(Xb,(this||Oe).supportsBinary,function(gb){Tb.doWrite(gb,tc)})};qa.prototype.uri=function(){var Xb=(this||Oe).query||{},Tb=(this||Oe).secure?"https":"http",tc="";!1!==(this||Oe).timestampRequests&&(Xb[(this||Oe).timestampParam]=
ic());(this||Oe).supportsBinary||Xb.sid||(Xb.b64=1);Xb=nb.encode(Xb);(this||Oe).port&&("https"===Tb&&443!==Number((this||Oe).port)||"http"===Tb&&80!==Number((this||Oe).port))&&(tc=":"+(this||Oe).port);Xb.length&&(Xb="?"+Xb);var gb=-1!==(this||Oe).hostname.indexOf(":");return Tb+"://"+(gb?"["+(this||Oe).hostname+"]":(this||Oe).hostname)+tc+(this||Oe).path+Xb};return Pg}function pb(){function qa(){}function eb(tc){ic.call(this||be,tc);(this||be).requestTimeout=tc.requestTimeout;(this||be).extraHeaders=
tc.extraHeaders;if("undefined"!==typeof location){var gb="https:"===location.protocol,Hc=location.port;Hc||(Hc=gb?443:80);(this||be).xd="undefined"!==typeof location&&tc.hostname!==location.hostname||Hc!==tc.port;(this||be).xs=tc.secure!==gb}}function nb(tc){(this||be).method=tc.method||"GET";(this||be).uri=tc.uri;(this||be).xd=!!tc.xd;(this||be).xs=!!tc.xs;(this||be).async=!1!==tc.async;(this||be).data=void 0!==tc.data?tc.data:null;(this||be).agent=tc.agent;(this||be).isBinary=tc.isBinary;(this||
be).supportsBinary=tc.supportsBinary;(this||be).enablesXDR=tc.enablesXDR;(this||be).withCredentials=tc.withCredentials;(this||be).requestTimeout=tc.requestTimeout;(this||be).pfx=tc.pfx;(this||be).key=tc.key;(this||be).passphrase=tc.passphrase;(this||be).cert=tc.cert;(this||be).ca=tc.ca;(this||be).ciphers=tc.ciphers;(this||be).rejectUnauthorized=tc.rejectUnauthorized;(this||be).extraHeaders=tc.extraHeaders;this.create()}function ab(){for(var tc in nb.requests)nb.requests.hasOwnProperty(tc)&&nb.requests[tc].abort()}
if(Kh)return ki;Kh=!0;var mb=Oc(),ic=fb(),Nc=Zc(),Lc=ma(),Xb=Dd()("engine.io-client:polling-xhr"),Tb=Xc();ki=eb;ki.Request=nb;Lc(eb,ic);eb.prototype.supportsBinary=!0;eb.prototype.request=function(tc){tc=tc||{};tc.uri=this.uri();tc.xd=(this||be).xd;tc.xs=(this||be).xs;tc.agent=(this||be).agent||!1;tc.supportsBinary=(this||be).supportsBinary;tc.enablesXDR=(this||be).enablesXDR;tc.withCredentials=(this||be).withCredentials;tc.pfx=(this||be).pfx;tc.key=(this||be).key;tc.passphrase=(this||be).passphrase;
tc.cert=(this||be).cert;tc.ca=(this||be).ca;tc.ciphers=(this||be).ciphers;tc.rejectUnauthorized=(this||be).rejectUnauthorized;tc.requestTimeout=(this||be).requestTimeout;tc.extraHeaders=(this||be).extraHeaders;return new nb(tc)};eb.prototype.doWrite=function(tc,gb){tc=this.request({method:"POST",data:tc,isBinary:"string"!==typeof tc&&void 0!==tc});var Hc=this||be;tc.on("success",gb);tc.on("error",function(Cd){Hc.onError("xhr post error",Cd)});(this||be).sendXhr=tc};eb.prototype.doPoll=function(){Xb("xhr poll");
var tc=this.request(),gb=this||be;tc.on("data",function(Hc){gb.onData(Hc)});tc.on("error",function(Hc){gb.onError("xhr poll error",Hc)});(this||be).pollXhr=tc};Nc(nb.prototype);nb.prototype.create=function(){var tc={agent:(this||be).agent,xdomain:(this||be).xd,xscheme:(this||be).xs,enablesXDR:(this||be).enablesXDR};tc.pfx=(this||be).pfx;tc.key=(this||be).key;tc.passphrase=(this||be).passphrase;tc.cert=(this||be).cert;tc.ca=(this||be).ca;tc.ciphers=(this||be).ciphers;tc.rejectUnauthorized=(this||be).rejectUnauthorized;
var gb=(this||be).xhr=new mb(tc),Hc=this||be;try{Xb("xhr open %s: %s",(this||be).method,(this||be).uri);gb.open((this||be).method,(this||be).uri,(this||be).async);try{if((this||be).extraHeaders){gb.setDisableHeaderCheck&&gb.setDisableHeaderCheck(!0);for(var Cd in(this||be).extraHeaders)(this||be).extraHeaders.hasOwnProperty(Cd)&&gb.setRequestHeader(Cd,(this||be).extraHeaders[Cd])}}catch(fe){}if("POST"===(this||be).method)try{(this||be).isBinary?gb.setRequestHeader("Content-type","application/octet-stream"):
gb.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(fe){}try{gb.setRequestHeader("Accept","*/*")}catch(fe){}"withCredentials"in gb&&(gb.withCredentials=(this||be).withCredentials);(this||be).requestTimeout&&(gb.timeout=(this||be).requestTimeout);this.hasXDR()?(gb.onload=function(){Hc.onLoad()},gb.onerror=function(){Hc.onError(gb.responseText)}):gb.onreadystatechange=function(){if(2===gb.readyState)try{var fe=gb.getResponseHeader("Content-Type");if(Hc.supportsBinary&&"application/octet-stream"===
fe||"application/octet-stream; charset=UTF-8"===fe)gb.responseType="arraybuffer"}catch(qd){}if(4===gb.readyState)if(200===gb.status||1223===gb.status)Hc.onLoad();else setTimeout(function(){Hc.onError("number"===typeof gb.status?gb.status:0)},0)};Xb("xhr data %s",(this||be).data);gb.send((this||be).data)}catch(fe){setTimeout(function(){Hc.onError(fe)},0);return}"undefined"!==typeof document&&((this||be).index=nb.requestsCount++,nb.requests[(this||be).index]=this||be)};nb.prototype.onSuccess=function(){this.emit("success");
this.cleanup()};nb.prototype.onData=function(tc){this.emit("data",tc);this.onSuccess()};nb.prototype.onError=function(tc){this.emit("error",tc);this.cleanup(!0)};nb.prototype.cleanup=function(tc){if("undefined"!==typeof(this||be).xhr&&null!==(this||be).xhr){this.hasXDR()?(this||be).xhr.onload=(this||be).xhr.onerror=qa:(this||be).xhr.onreadystatechange=qa;if(tc)try{(this||be).xhr.abort()}catch(gb){}"undefined"!==typeof document&&delete nb.requests[(this||be).index];(this||be).xhr=null}};nb.prototype.onLoad=
function(){try{try{var tc=(this||be).xhr.getResponseHeader("Content-Type")}catch(Hc){}var gb="application/octet-stream"===tc||"application/octet-stream; charset=UTF-8"===tc?(this||be).xhr.response||(this||be).xhr.responseText:(this||be).xhr.responseText}catch(Hc){this.onError(Hc)}if(null!=gb)this.onData(gb)};nb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||be).xs&&(this||be).enablesXDR};nb.prototype.abort=function(){this.cleanup()};nb.requestsCount=0;nb.requests={};
"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",ab):"function"===typeof addEventListener&&addEventListener("onpagehide"in Tb?"pagehide":"unload",ab,!1));return ki}function xb(){function qa(){}function eb(Xb){nb.call(this||lg,Xb);(this||lg).query=(this||lg).query||{};Lc||(Lc=mb.___eio=mb.___eio||[]);(this||lg).index=Lc.length;var Tb=this||lg;Lc.push(function(tc){Tb.onData(tc)});(this||lg).query.j=(this||lg).index;"function"===typeof addEventListener&&addEventListener("beforeunload",
function(){Tb.script&&(Tb.script.onerror=qa)},!1)}if(Mj)return gj;Mj=!0;var nb=fb(),ab=ma(),mb=Xc();gj=eb;var ic=/\n/g,Nc=/\\n/g,Lc;ab(eb,nb);eb.prototype.supportsBinary=!1;eb.prototype.doClose=function(){(this||lg).script&&((this||lg).script.parentNode.removeChild((this||lg).script),(this||lg).script=null);(this||lg).form&&((this||lg).form.parentNode.removeChild((this||lg).form),(this||lg).form=null,(this||lg).iframe=null);nb.prototype.doClose.call(this||lg)};eb.prototype.doPoll=function(){var Xb=
this||lg,Tb=document.createElement("script");(this||lg).script&&((this||lg).script.parentNode.removeChild((this||lg).script),(this||lg).script=null);Tb.async=!0;Tb.src=this.uri();Tb.onerror=function(gb){Xb.onError("jsonp poll error",gb)};var tc=document.getElementsByTagName("script")[0];tc?tc.parentNode.insertBefore(Tb,tc):(document.head||document.body).appendChild(Tb);(this||lg).script=Tb;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var gb=document.createElement("iframe");
document.body.appendChild(gb);document.body.removeChild(gb)},100)};eb.prototype.doWrite=function(Xb,Tb){function tc(){gb();Tb()}function gb(){if(Hc.iframe)try{Hc.form.removeChild(Hc.iframe)}catch(se){Hc.onError("jsonp polling iframe removal error",se)}try{ge=document.createElement('<iframe src="javascript:0" name="'+Hc.iframeId+'">')}catch(se){ge=document.createElement("iframe"),ge.name=Hc.iframeId,ge.src="javascript:0"}ge.id=Hc.iframeId;Hc.form.appendChild(ge);Hc.iframe=ge}var Hc=this||lg;if(!(this||
lg).form){var Cd=document.createElement("form"),fe=document.createElement("textarea"),qd=(this||lg).iframeId="eio_iframe_"+(this||lg).index,ge;Cd.className="socketio";Cd.style.position="absolute";Cd.style.top="-1000px";Cd.style.left="-1000px";Cd.target=qd;Cd.method="POST";Cd.setAttribute("accept-charset","utf-8");fe.name="d";Cd.appendChild(fe);document.body.appendChild(Cd);(this||lg).form=Cd;(this||lg).area=fe}(this||lg).form.action=this.uri();gb();Xb=Xb.replace(Nc,"\\\n");(this||lg).area.value=Xb.replace(ic,
"\\n");try{(this||lg).form.submit()}catch(se){}(this||lg).iframe.attachEvent?(this||lg).iframe.onreadystatechange=function(){"complete"===Hc.iframe.readyState&&tc()}:(this||lg).iframe.onload=tc};return gj}function Wa(){if(Tj)return yk;Tj=!0;return yk=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object");}}function Xa(){function qa(gb){gb&&gb.forceBase64&&((this||zf).supportsBinary=!1);(this||zf).perMessageDeflate=gb.perMessageDeflate;(this||
zf).usingBrowserWebSocket=Xb&&!gb.forceNode;(this||zf).protocols=gb.protocols;(this||zf).usingBrowserWebSocket||(tc=Tb);nb.call(this||zf,gb)}if(Bh)return Bj;Bh=!0;var eb=Qb.Buffer,nb=Ta(),ab=db(),mb=cb(),ic=ma(),Nc=La(),Lc=Dd()("engine.io-client:websocket"),Xb;"undefined"!==typeof WebSocket?Xb=WebSocket:"undefined"!==typeof self&&(Xb=self.WebSocket||self.MozWebSocket);if("undefined"===typeof window)try{var Tb=Wa()}catch(gb){}var tc=Xb||Tb;Bj=qa;ic(qa,nb);qa.prototype.name="websocket";qa.prototype.supportsBinary=
!0;qa.prototype.doOpen=function(){if(this.check()){var gb=this.uri(),Hc=(this||zf).protocols,Cd={};(this||zf).isReactNative||(Cd.agent=(this||zf).agent,Cd.perMessageDeflate=(this||zf).perMessageDeflate,Cd.pfx=(this||zf).pfx,Cd.key=(this||zf).key,Cd.passphrase=(this||zf).passphrase,Cd.cert=(this||zf).cert,Cd.ca=(this||zf).ca,Cd.ciphers=(this||zf).ciphers,Cd.rejectUnauthorized=(this||zf).rejectUnauthorized);(this||zf).extraHeaders&&(Cd.headers=(this||zf).extraHeaders);(this||zf).localAddress&&(Cd.localAddress=
(this||zf).localAddress);try{(this||zf).ws=(this||zf).usingBrowserWebSocket&&!(this||zf).isReactNative?Hc?new tc(gb,Hc):new tc(gb):new tc(gb,Hc,Cd)}catch(fe){return this.emit("error",fe)}void 0===(this||zf).ws.binaryType&&((this||zf).supportsBinary=!1);(this||zf).ws.supports&&(this||zf).ws.supports.binary?((this||zf).supportsBinary=!0,(this||zf).ws.binaryType="nodebuffer"):(this||zf).ws.binaryType="arraybuffer";this.addEventListeners()}};qa.prototype.addEventListeners=function(){var gb=this||zf;(this||
zf).ws.onopen=function(){gb.onOpen()};(this||zf).ws.onclose=function(){gb.onClose()};(this||zf).ws.onmessage=function(Hc){gb.onData(Hc.data)};(this||zf).ws.onerror=function(Hc){gb.onError("websocket error",Hc)}};qa.prototype.write=function(gb){function Hc(){Cd.emit("flush");setTimeout(function(){Cd.writable=!0;Cd.emit("drain")},0)}var Cd=this||zf;(this||zf).writable=!1;for(var fe=gb.length,qd=0,ge=fe;qd<ge;qd++)(function(se){ab.encodePacket(se,Cd.supportsBinary,function(Se){if(!Cd.usingBrowserWebSocket){var Ue=
{};se.options&&(Ue.compress=se.options.compress);Cd.perMessageDeflate&&("string"===typeof Se?eb.byteLength(Se):Se.length)<Cd.perMessageDeflate.threshold&&(Ue.compress=!1)}try{Cd.usingBrowserWebSocket?Cd.ws.send(Se):Cd.ws.send(Se,Ue)}catch(Kf){Lc("websocket closed before onclose event")}--fe||Hc()})})(gb[qd])};qa.prototype.onClose=function(){nb.prototype.onClose.call(this||zf)};qa.prototype.doClose=function(){"undefined"!==typeof(this||zf).ws&&(this||zf).ws.close()};qa.prototype.uri=function(){var gb=
(this||zf).query||{},Hc=(this||zf).secure?"wss":"ws",Cd="";(this||zf).port&&("wss"===Hc&&443!==Number((this||zf).port)||"ws"===Hc&&80!==Number((this||zf).port))&&(Cd=":"+(this||zf).port);(this||zf).timestampRequests&&(gb[(this||zf).timestampParam]=Nc());(this||zf).supportsBinary||(gb.b64=1);gb=mb.encode(gb);gb.length&&(gb="?"+gb);var fe=-1!==(this||zf).hostname.indexOf(":");return Hc+"://"+(fe?"["+(this||zf).hostname+"]":(this||zf).hostname)+Cd+(this||zf).path+gb};qa.prototype.check=function(){return!!tc&&
!("__initialize"in tc&&(this||zf).name===qa.prototype.name)};return Bj}function Ab(){if(ll)return $e;ll=!0;var qa=Oc(),eb=pb(),nb=xb(),ab=Xa();$e.polling=function(mb){var ic=!1,Nc=!1,Lc=!1!==mb.jsonp;"undefined"!==typeof location&&(Nc="https:"===location.protocol,(ic=location.port)||(ic=Nc?443:80),ic=mb.hostname!==location.hostname||ic!==mb.port,Nc=mb.secure!==Nc);mb.xdomain=ic;mb.xscheme=Nc;if("open"in new qa(mb)&&!mb.forceJSONP)return new eb(mb);if(!Lc)throw Error("JSONP disabled");return new nb(mb)};
$e.websocket=ab;return $e}function kc(){if(Wc)return Sa;Wc=!0;var qa=[].indexOf;return Sa=function(eb,nb){if(qa)return eb.indexOf(nb);for(var ab=0;ab<eb.length;++ab)if(eb[ab]===nb)return ab;return-1}}function Ub(){function qa(Xb,Tb){if(!((this||Ic)instanceof qa))return new qa(Xb,Tb);Tb=Tb||{};Xb&&"object"===typeof Xb&&(Tb=Xb,Xb=null);Xb?(Xb=Nc(Xb),Tb.hostname=Xb.host,Tb.secure="https"===Xb.protocol||"wss"===Xb.protocol,Tb.port=Xb.port,Xb.query&&(Tb.query=Xb.query)):Tb.host&&(Tb.hostname=Nc(Tb.host).host);
(this||Ic).secure=null!=Tb.secure?Tb.secure:"undefined"!==typeof location&&"https:"===location.protocol;Tb.hostname&&!Tb.port&&(Tb.port=(this||Ic).secure?"443":"80");(this||Ic).agent=Tb.agent||!1;(this||Ic).hostname=Tb.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||Ic).port=Tb.port||("undefined"!==typeof location&&location.port?location.port:(this||Ic).secure?443:80);(this||Ic).query=Tb.query||{};"string"===typeof(this||Ic).query&&((this||Ic).query=Lc.decode((this||
Ic).query));(this||Ic).upgrade=!1!==Tb.upgrade;(this||Ic).path=(Tb.path||"/engine.io").replace(/\/$/,"")+"/";(this||Ic).forceJSONP=!!Tb.forceJSONP;(this||Ic).jsonp=!1!==Tb.jsonp;(this||Ic).forceBase64=!!Tb.forceBase64;(this||Ic).enablesXDR=!!Tb.enablesXDR;(this||Ic).withCredentials=!1!==Tb.withCredentials;(this||Ic).timestampParam=Tb.timestampParam||"t";(this||Ic).timestampRequests=Tb.timestampRequests;(this||Ic).transports=Tb.transports||["polling","websocket"];(this||Ic).transportOptions=Tb.transportOptions||
{};(this||Ic).readyState="";(this||Ic).writeBuffer=[];(this||Ic).prevBufferLen=0;(this||Ic).policyPort=Tb.policyPort||843;(this||Ic).rememberUpgrade=Tb.rememberUpgrade||!1;(this||Ic).binaryType=null;(this||Ic).onlyBinaryUpgrades=Tb.onlyBinaryUpgrades;(this||Ic).perMessageDeflate=!1!==Tb.perMessageDeflate?Tb.perMessageDeflate||{}:!1;!0===(this||Ic).perMessageDeflate&&((this||Ic).perMessageDeflate={});(this||Ic).perMessageDeflate&&null==(this||Ic).perMessageDeflate.threshold&&((this||Ic).perMessageDeflate.threshold=
1024);(this||Ic).pfx=Tb.pfx||null;(this||Ic).key=Tb.key||null;(this||Ic).passphrase=Tb.passphrase||null;(this||Ic).cert=Tb.cert||null;(this||Ic).ca=Tb.ca||null;(this||Ic).ciphers=Tb.ciphers||null;(this||Ic).rejectUnauthorized=void 0===Tb.rejectUnauthorized?!0:Tb.rejectUnauthorized;(this||Ic).forceNode=!!Tb.forceNode;(this||Ic).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||Ic).isReactNative)Tb.extraHeaders&&
0<Object.keys(Tb.extraHeaders).length&&((this||Ic).extraHeaders=Tb.extraHeaders),Tb.localAddress&&((this||Ic).localAddress=Tb.localAddress);(this||Ic).id=null;(this||Ic).upgrades=null;(this||Ic).pingInterval=null;(this||Ic).pingTimeout=null;(this||Ic).pingIntervalTimer=null;(this||Ic).pingTimeoutTimer=null;this.open()}if(Td)return Wd;Td=!0;var eb=Ab(),nb=Zc(),ab=Dd()("engine.io-client:socket"),mb=kc(),ic=db(),Nc=Gc(),Lc=cb();Wd=qa;qa.priorWebsocketSuccess=!1;nb(qa.prototype);qa.protocol=ic.protocol;
qa.Socket=qa;qa.Transport=Ta();qa.transports=Ab();qa.parser=db();qa.prototype.createTransport=function(Xb){ab('creating transport "%s"',Xb);var Tb=(this||Ic).query,tc={},gb;for(gb in Tb)Tb.hasOwnProperty(gb)&&(tc[gb]=Tb[gb]);tc.EIO=ic.protocol;tc.transport=Xb;Tb=(this||Ic).transportOptions[Xb]||{};(this||Ic).id&&(tc.sid=(this||Ic).id);return new eb[Xb]({query:tc,socket:this||Ic,agent:Tb.agent||(this||Ic).agent,hostname:Tb.hostname||(this||Ic).hostname,port:Tb.port||(this||Ic).port,secure:Tb.secure||
(this||Ic).secure,path:Tb.path||(this||Ic).path,forceJSONP:Tb.forceJSONP||(this||Ic).forceJSONP,jsonp:Tb.jsonp||(this||Ic).jsonp,forceBase64:Tb.forceBase64||(this||Ic).forceBase64,enablesXDR:Tb.enablesXDR||(this||Ic).enablesXDR,withCredentials:Tb.withCredentials||(this||Ic).withCredentials,timestampRequests:Tb.timestampRequests||(this||Ic).timestampRequests,timestampParam:Tb.timestampParam||(this||Ic).timestampParam,policyPort:Tb.policyPort||(this||Ic).policyPort,pfx:Tb.pfx||(this||Ic).pfx,key:Tb.key||
(this||Ic).key,passphrase:Tb.passphrase||(this||Ic).passphrase,cert:Tb.cert||(this||Ic).cert,ca:Tb.ca||(this||Ic).ca,ciphers:Tb.ciphers||(this||Ic).ciphers,rejectUnauthorized:Tb.rejectUnauthorized||(this||Ic).rejectUnauthorized,perMessageDeflate:Tb.perMessageDeflate||(this||Ic).perMessageDeflate,extraHeaders:Tb.extraHeaders||(this||Ic).extraHeaders,forceNode:Tb.forceNode||(this||Ic).forceNode,localAddress:Tb.localAddress||(this||Ic).localAddress,requestTimeout:Tb.requestTimeout||(this||Ic).requestTimeout,
protocols:Tb.protocols||void 0,isReactNative:(this||Ic).isReactNative})};qa.prototype.open=function(){if((this||Ic).rememberUpgrade&&qa.priorWebsocketSuccess&&-1!==(this||Ic).transports.indexOf("websocket"))var Xb="websocket";else{if(0===(this||Ic).transports.length){var Tb=this||Ic;setTimeout(function(){Tb.emit("error","No transports available")},0);return}Xb=(this||Ic).transports[0]}(this||Ic).readyState="opening";try{Xb=this.createTransport(Xb)}catch(tc){(this||Ic).transports.shift();this.open();
return}Xb.open();this.setTransport(Xb)};qa.prototype.setTransport=function(Xb){ab("setting transport %s",Xb.name);var Tb=this||Ic;(this||Ic).transport&&(ab("clearing existing transport %s",(this||Ic).transport.name),(this||Ic).transport.removeAllListeners());(this||Ic).transport=Xb;Xb.on("drain",function(){Tb.onDrain()}).on("packet",function(tc){Tb.onPacket(tc)}).on("error",function(tc){Tb.onError(tc)}).on("close",function(){Tb.onClose("transport close")})};qa.prototype.probe=function(Xb){function Tb(){if(Se.onlyBinaryUpgrades){var Ue=
!(this||Ic).supportsBinary&&Se.transport.supportsBinary;se=se||Ue}se||(ab('probe transport "%s" opened',Xb),ge.send([{type:"ping",data:"probe"}]),ge.once("packet",function(Kf){se||("pong"===Kf.type&&"probe"===Kf.data?(ab('probe transport "%s" pong',Xb),Se.upgrading=!0,Se.emit("upgrading",ge),ge&&(qa.priorWebsocketSuccess="websocket"===ge.name,ab('pausing current transport "%s"',Se.transport.name),Se.transport.pause(function(){se||"closed"===Se.readyState||(ab("changing transport and sending upgrade packet"),
qd(),Se.setTransport(ge),ge.send([{type:"upgrade"}]),Se.emit("upgrade",ge),ge=null,Se.upgrading=!1,Se.flush())}))):(ab('probe transport "%s" failed',Xb),Kf=Error("probe error"),Kf.transport=ge.name,Se.emit("upgradeError",Kf)))}))}function tc(){se||(se=!0,qd(),ge.close(),ge=null)}function gb(Ue){var Kf=Error("probe error: "+Ue);Kf.transport=ge.name;tc();ab('probe transport "%s" failed because of error: %s',Xb,Ue);Se.emit("upgradeError",Kf)}function Hc(){gb("transport closed")}function Cd(){gb("socket closed")}
function fe(Ue){ge&&Ue.name!==ge.name&&(ab('"%s" works - aborting "%s"',Ue.name,ge.name),tc())}function qd(){ge.removeListener("open",Tb);ge.removeListener("error",gb);ge.removeListener("close",Hc);Se.removeListener("close",Cd);Se.removeListener("upgrading",fe)}ab('probing transport "%s"',Xb);var ge=this.createTransport(Xb,{probe:1}),se=!1,Se=this||Ic;qa.priorWebsocketSuccess=!1;ge.once("open",Tb);ge.once("error",gb);ge.once("close",Hc);this.once("close",Cd);this.once("upgrading",fe);ge.open()};qa.prototype.onOpen=
function(){ab("socket open");(this||Ic).readyState="open";qa.priorWebsocketSuccess="websocket"===(this||Ic).transport.name;this.emit("open");this.flush();if("open"===(this||Ic).readyState&&(this||Ic).upgrade&&(this||Ic).transport.pause){ab("starting upgrade probes");for(var Xb=0,Tb=(this||Ic).upgrades.length;Xb<Tb;Xb++)this.probe((this||Ic).upgrades[Xb])}};qa.prototype.onPacket=function(Xb){if("opening"===(this||Ic).readyState||"open"===(this||Ic).readyState||"closing"===(this||Ic).readyState)switch(ab('socket receive: type "%s", data "%s"',
Xb.type,Xb.data),this.emit("packet",Xb),this.emit("heartbeat"),Xb.type){case "open":this.onHandshake(JSON.parse(Xb.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var Tb=Error("server error");Tb.code=Xb.data;this.onError(Tb);break;case "message":this.emit("data",Xb.data),this.emit("message",Xb.data)}else ab('packet received with socket readyState "%s"',(this||Ic).readyState)};qa.prototype.onHandshake=function(Xb){this.emit("handshake",Xb);(this||Ic).id=Xb.sid;(this||Ic).transport.query.sid=
Xb.sid;(this||Ic).upgrades=this.filterUpgrades(Xb.upgrades);(this||Ic).pingInterval=Xb.pingInterval;(this||Ic).pingTimeout=Xb.pingTimeout;this.onOpen();"closed"!==(this||Ic).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||Ic).onHeartbeat),this.on("heartbeat",(this||Ic).onHeartbeat))};qa.prototype.onHeartbeat=function(Xb){clearTimeout((this||Ic).pingTimeoutTimer);var Tb=this||Ic;Tb.pingTimeoutTimer=setTimeout(function(){if("closed"!==Tb.readyState)Tb.onClose("ping timeout")},Xb||
Tb.pingInterval+Tb.pingTimeout)};qa.prototype.setPing=function(){var Xb=this||Ic;clearTimeout(Xb.pingIntervalTimer);Xb.pingIntervalTimer=setTimeout(function(){ab("writing ping packet - expecting pong within %sms",Xb.pingTimeout);Xb.ping();Xb.onHeartbeat(Xb.pingTimeout)},Xb.pingInterval)};qa.prototype.ping=function(){var Xb=this||Ic;this.sendPacket("ping",function(){Xb.emit("ping")})};qa.prototype.onDrain=function(){(this||Ic).writeBuffer.splice(0,(this||Ic).prevBufferLen);(this||Ic).prevBufferLen=
0;0===(this||Ic).writeBuffer.length?this.emit("drain"):this.flush()};qa.prototype.flush=function(){"closed"!==(this||Ic).readyState&&(this||Ic).transport.writable&&!(this||Ic).upgrading&&(this||Ic).writeBuffer.length&&(ab("flushing %d packets in socket",(this||Ic).writeBuffer.length),(this||Ic).transport.send((this||Ic).writeBuffer),(this||Ic).prevBufferLen=(this||Ic).writeBuffer.length,this.emit("flush"))};qa.prototype.write=qa.prototype.send=function(Xb,Tb,tc){this.sendPacket("message",Xb,Tb,tc);
return this||Ic};qa.prototype.sendPacket=function(Xb,Tb,tc,gb){"function"===typeof Tb&&(gb=Tb,Tb=void 0);"function"===typeof tc&&(gb=tc,tc=null);if("closing"!==(this||Ic).readyState&&"closed"!==(this||Ic).readyState){tc=tc||{};tc.compress=!1!==tc.compress;Xb={type:Xb,data:Tb,options:tc};this.emit("packetCreate",Xb);(this||Ic).writeBuffer.push(Xb);if(gb)this.once("flush",gb);this.flush()}};qa.prototype.close=function(){function Xb(){gb.onClose("forced close");ab("socket closing - telling transport to close");
gb.transport.close()}function Tb(){gb.removeListener("upgrade",Tb);gb.removeListener("upgradeError",Tb);Xb()}function tc(){gb.once("upgrade",Tb);gb.once("upgradeError",Tb)}if("opening"===(this||Ic).readyState||"open"===(this||Ic).readyState){(this||Ic).readyState="closing";var gb=this||Ic;if((this||Ic).writeBuffer.length)this.once("drain",function(){(this||Ic).upgrading?tc():Xb()});else(this||Ic).upgrading?tc():Xb()}return this||Ic};qa.prototype.onError=function(Xb){ab("socket error %j",Xb);qa.priorWebsocketSuccess=
!1;this.emit("error",Xb);this.onClose("transport error",Xb)};qa.prototype.onClose=function(Xb,Tb){if("opening"===(this||Ic).readyState||"open"===(this||Ic).readyState||"closing"===(this||Ic).readyState){ab('socket close with reason: "%s"',Xb);var tc=this||Ic;clearTimeout((this||Ic).pingIntervalTimer);clearTimeout((this||Ic).pingTimeoutTimer);(this||Ic).transport.removeAllListeners("close");(this||Ic).transport.close();(this||Ic).transport.removeAllListeners();(this||Ic).readyState="closed";(this||
Ic).id=null;this.emit("close",Xb,Tb);tc.writeBuffer=[];tc.prevBufferLen=0}};qa.prototype.filterUpgrades=function(Xb){for(var Tb=[],tc=0,gb=Xb.length;tc<gb;tc++)~mb((this||Ic).transports,Xb[tc])&&Tb.push(Xb[tc]);return Tb};return Wd}function qc(){if(Cm)return Rk;Cm=!0;return Rk=function(qa,eb){for(var nb=[],ab=(eb=eb||0)||0;ab<qa.length;ab++)nb[ab-eb]=qa[ab];return nb}}function wc(){if(hj)return Um;hj=!0;return Um=function(qa,eb,nb){qa.on(eb,nb);return{destroy:function(){qa.removeListener(eb,nb)}}}}
function I(){if(Pk)return Jl;Pk=!0;var qa=[].slice;return Jl=function(eb,nb){"string"==typeof nb&&(nb=eb[nb]);if("function"!=typeof nb)throw Error("bind() requires a function");var ab=qa.call(arguments,2);return function(){return nb.apply(eb,ab.concat(qa.call(arguments)))}}}function T(){function qa(gb,Hc,Cd){(this||Ee).io=gb;(this||Ee).nsp=Hc;(this||Ee).json=this||Ee;(this||Ee).ids=0;(this||Ee).acks={};(this||Ee).receiveBuffer=[];(this||Ee).sendBuffer=[];(this||Ee).connected=!1;(this||Ee).disconnected=
!0;(this||Ee).flags={};Cd&&Cd.query&&((this||Ee).query=Cd.query);(this||Ee).io.autoConnect&&this.open()}if(Kl)return zk;Kl=!0;var eb=bc(),nb=Zc(),ab=qc(),mb=wc(),ic=I(),Nc=Dd()("socket.io-client:socket"),Lc=cb(),Xb=zc();zk=zk=qa;var Tb={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},tc=nb.prototype.emit;nb(qa.prototype);qa.prototype.subEvents=function(){if(!(this||Ee).subs){var gb=
(this||Ee).io;(this||Ee).subs=[mb(gb,"open",ic(this||Ee,"onopen")),mb(gb,"packet",ic(this||Ee,"onpacket")),mb(gb,"close",ic(this||Ee,"onclose"))]}};qa.prototype.open=qa.prototype.connect=function(){if((this||Ee).connected)return this||Ee;this.subEvents();(this||Ee).io.reconnecting||(this||Ee).io.open();if("open"===(this||Ee).io.readyState)this.onopen();this.emit("connecting");return this||Ee};qa.prototype.send=function(){var gb=ab(arguments);gb.unshift("message");(this||Ee).emit.apply(this||Ee,gb);
return this||Ee};qa.prototype.emit=function(gb){if(Tb.hasOwnProperty(gb))return tc.apply(this||Ee,arguments),this||Ee;var Hc=ab(arguments),Cd={type:(void 0!==(this||Ee).flags.binary?(this||Ee).flags.binary:Xb(Hc))?eb.BINARY_EVENT:eb.EVENT,data:Hc,options:{}};Cd.options.compress=!(this||Ee).flags||!1!==(this||Ee).flags.compress;"function"===typeof Hc[Hc.length-1]&&(Nc("emitting packet with ack id %d",(this||Ee).ids),(this||Ee).acks[(this||Ee).ids]=Hc.pop(),Cd.id=(this||Ee).ids++);(this||Ee).connected?
this.packet(Cd):(this||Ee).sendBuffer.push(Cd);(this||Ee).flags={};return this||Ee};qa.prototype.packet=function(gb){gb.nsp=(this||Ee).nsp;(this||Ee).io.packet(gb)};qa.prototype.onopen=function(){Nc("transport is open - connecting");if("/"!==(this||Ee).nsp)if((this||Ee).query){var gb="object"===typeof(this||Ee).query?Lc.encode((this||Ee).query):(this||Ee).query;Nc("sending connect packet with query %s",gb);this.packet({type:eb.CONNECT,query:gb})}else this.packet({type:eb.CONNECT})};qa.prototype.onclose=
function(gb){Nc("close (%s)",gb);(this||Ee).connected=!1;(this||Ee).disconnected=!0;delete (this||Ee).id;this.emit("disconnect",gb)};qa.prototype.onpacket=function(gb){var Hc=gb.type===eb.ERROR&&"/"===gb.nsp;if(gb.nsp===(this||Ee).nsp||Hc)switch(gb.type){case eb.CONNECT:this.onconnect();break;case eb.EVENT:this.onevent(gb);break;case eb.BINARY_EVENT:this.onevent(gb);break;case eb.ACK:this.onack(gb);break;case eb.BINARY_ACK:this.onack(gb);break;case eb.DISCONNECT:this.ondisconnect();break;case eb.ERROR:this.emit("error",
gb.data)}};qa.prototype.onevent=function(gb){var Hc=gb.data||[];Nc("emitting event %j",Hc);null!=gb.id&&(Nc("attaching ack callback to event"),Hc.push(this.ack(gb.id)));(this||Ee).connected?tc.apply(this||Ee,Hc):(this||Ee).receiveBuffer.push(Hc)};qa.prototype.ack=function(gb){var Hc=this||Ee,Cd=!1;return function(){if(!Cd){Cd=!0;var fe=ab(arguments);Nc("sending ack %j",fe);Hc.packet({type:Xb(fe)?eb.BINARY_ACK:eb.ACK,id:gb,data:fe})}}};qa.prototype.onack=function(gb){var Hc=(this||Ee).acks[gb.id];
"function"===typeof Hc?(Nc("calling ack %s with %j",gb.id,gb.data),Hc.apply(this||Ee,gb.data),delete (this||Ee).acks[gb.id]):Nc("bad ack %s",gb.id)};qa.prototype.onconnect=function(){(this||Ee).connected=!0;(this||Ee).disconnected=!1;this.emit("connect");this.emitBuffered()};qa.prototype.emitBuffered=function(){var gb;for(gb=0;gb<(this||Ee).receiveBuffer.length;gb++)tc.apply(this||Ee,(this||Ee).receiveBuffer[gb]);(this||Ee).receiveBuffer=[];for(gb=0;gb<(this||Ee).sendBuffer.length;gb++)this.packet((this||
Ee).sendBuffer[gb]);(this||Ee).sendBuffer=[]};qa.prototype.ondisconnect=function(){Nc("server disconnect (%s)",(this||Ee).nsp);this.destroy();this.onclose("io server disconnect")};qa.prototype.destroy=function(){if((this||Ee).subs){for(var gb=0;gb<(this||Ee).subs.length;gb++)(this||Ee).subs[gb].destroy();(this||Ee).subs=null}(this||Ee).io.destroy(this||Ee)};qa.prototype.close=qa.prototype.disconnect=function(){(this||Ee).connected&&(Nc("performing disconnect (%s)",(this||Ee).nsp),this.packet({type:eb.DISCONNECT}));
this.destroy();if((this||Ee).connected)this.onclose("io client disconnect");return this||Ee};qa.prototype.compress=function(gb){(this||Ee).flags.compress=gb;return this||Ee};qa.prototype.binary=function(gb){(this||Ee).flags.binary=gb;return this||Ee};return zk}function ta(){function qa(eb){eb=eb||{};(this||ij).ms=eb.min||100;(this||ij).max=eb.max||1E4;(this||ij).factor=eb.factor||2;(this||ij).jitter=0<eb.jitter&&1>=eb.jitter?eb.jitter:0;(this||ij).attempts=0}if(im)return Ik;im=!0;Ik=qa;qa.prototype.duration=
function(){var eb=(this||ij).ms*Math.pow((this||ij).factor,(this||ij).attempts++);if((this||ij).jitter){var nb=Math.random(),ab=Math.floor(nb*(this||ij).jitter*eb);eb=0==(Math.floor(10*nb)&1)?eb-ab:eb+ab}return Math.min(eb,(this||ij).max)|0};qa.prototype.reset=function(){(this||ij).attempts=0};qa.prototype.setMin=function(eb){(this||ij).ms=eb};qa.prototype.setMax=function(eb){(this||ij).max=eb};qa.prototype.setJitter=function(eb){(this||ij).jitter=eb};return Ik}function Ca(){function qa(gb,Hc){if(!((this||
Hd)instanceof qa))return new qa(gb,Hc);gb&&"object"===typeof gb&&(Hc=gb,gb=void 0);Hc=Hc||{};Hc.path=Hc.path||"/socket.io";(this||Hd).nsps={};(this||Hd).subs=[];(this||Hd).opts=Hc;this.reconnection(!1!==Hc.reconnection);this.reconnectionAttempts(Hc.reconnectionAttempts||Infinity);this.reconnectionDelay(Hc.reconnectionDelay||1E3);this.reconnectionDelayMax(Hc.reconnectionDelayMax||5E3);this.randomizationFactor(Hc.randomizationFactor||.5);(this||Hd).backoff=new Tb({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),
jitter:this.randomizationFactor()});this.timeout(null==Hc.timeout?2E4:Hc.timeout);(this||Hd).readyState="closed";(this||Hd).uri=gb;(this||Hd).connecting=[];(this||Hd).lastPing=null;(this||Hd).encoding=!1;(this||Hd).packetBuffer=[];gb=Hc.parser||mb;(this||Hd).encoder=new gb.Encoder;(this||Hd).decoder=new gb.Decoder;(this||Hd).autoConnect=!1!==Hc.autoConnect;(this||Hd).autoConnect&&this.open()}if(ck)return Li;ck=!0;ji||(ji=!0,dg=Ub(),dg.parser=db());var eb=dg;var nb=T(),ab=Zc(),mb=bc(),ic=wc(),Nc=I(),
Lc=Dd()("socket.io-client:manager"),Xb=kc(),Tb=ta(),tc=Object.prototype.hasOwnProperty;Li=qa;qa.prototype.emitAll=function(){(this||Hd).emit.apply(this||Hd,arguments);for(var gb in(this||Hd).nsps)tc.call((this||Hd).nsps,gb)&&(this||Hd).nsps[gb].emit.apply((this||Hd).nsps[gb],arguments)};qa.prototype.updateSocketIds=function(){for(var gb in(this||Hd).nsps)tc.call((this||Hd).nsps,gb)&&((this||Hd).nsps[gb].id=this.generateId(gb))};qa.prototype.generateId=function(gb){return("/"===gb?"":gb+"#")+(this||
Hd).engine.id};ab(qa.prototype);qa.prototype.reconnection=function(gb){if(!arguments.length)return(this||Hd)._reconnection;(this||Hd)._reconnection=!!gb;return this||Hd};qa.prototype.reconnectionAttempts=function(gb){if(!arguments.length)return(this||Hd)._reconnectionAttempts;(this||Hd)._reconnectionAttempts=gb;return this||Hd};qa.prototype.reconnectionDelay=function(gb){if(!arguments.length)return(this||Hd)._reconnectionDelay;(this||Hd)._reconnectionDelay=gb;(this||Hd).backoff&&(this||Hd).backoff.setMin(gb);
return this||Hd};qa.prototype.randomizationFactor=function(gb){if(!arguments.length)return(this||Hd)._randomizationFactor;(this||Hd)._randomizationFactor=gb;(this||Hd).backoff&&(this||Hd).backoff.setJitter(gb);return this||Hd};qa.prototype.reconnectionDelayMax=function(gb){if(!arguments.length)return(this||Hd)._reconnectionDelayMax;(this||Hd)._reconnectionDelayMax=gb;(this||Hd).backoff&&(this||Hd).backoff.setMax(gb);return this||Hd};qa.prototype.timeout=function(gb){if(!arguments.length)return(this||
Hd)._timeout;(this||Hd)._timeout=gb;return this||Hd};qa.prototype.maybeReconnectOnOpen=function(){!(this||Hd).reconnecting&&(this||Hd)._reconnection&&0===(this||Hd).backoff.attempts&&this.reconnect()};qa.prototype.open=qa.prototype.connect=function(gb,Hc){Lc("readyState %s",(this||Hd).readyState);if(~(this||Hd).readyState.indexOf("open"))return this||Hd;Lc("opening %s",(this||Hd).uri);(this||Hd).engine=eb((this||Hd).uri,(this||Hd).opts);var Cd=(this||Hd).engine,fe=this||Hd;(this||Hd).readyState="opening";
(this||Hd).skipReconnect=!1;var qd=ic(Cd,"open",function(){fe.onopen();gb&&gb()});Hc=ic(Cd,"error",function(Se){Lc("connect_error");fe.cleanup();fe.readyState="closed";fe.emitAll("connect_error",Se);if(gb){var Ue=Error("Connection error");Ue.data=Se;gb(Ue)}else fe.maybeReconnectOnOpen()});if(!1!==(this||Hd)._timeout){var ge=(this||Hd)._timeout;Lc("connect attempt will timeout after %d",ge);0===ge&&qd.destroy();var se=setTimeout(function(){Lc("connect attempt timed out after %d",ge);qd.destroy();Cd.close();
Cd.emit("error","timeout");fe.emitAll("connect_timeout",ge)},ge);(this||Hd).subs.push({destroy:function(){clearTimeout(se)}})}(this||Hd).subs.push(qd);(this||Hd).subs.push(Hc);return this||Hd};qa.prototype.onopen=function(){Lc("open");this.cleanup();(this||Hd).readyState="open";this.emit("open");var gb=(this||Hd).engine;(this||Hd).subs.push(ic(gb,"data",Nc(this||Hd,"ondata")));(this||Hd).subs.push(ic(gb,"ping",Nc(this||Hd,"onping")));(this||Hd).subs.push(ic(gb,"pong",Nc(this||Hd,"onpong")));(this||
Hd).subs.push(ic(gb,"error",Nc(this||Hd,"onerror")));(this||Hd).subs.push(ic(gb,"close",Nc(this||Hd,"onclose")));(this||Hd).subs.push(ic((this||Hd).decoder,"decoded",Nc(this||Hd,"ondecoded")))};qa.prototype.onping=function(){(this||Hd).lastPing=new Date;this.emitAll("ping")};qa.prototype.onpong=function(){this.emitAll("pong",new Date-(this||Hd).lastPing)};qa.prototype.ondata=function(gb){(this||Hd).decoder.add(gb)};qa.prototype.ondecoded=function(gb){this.emit("packet",gb)};qa.prototype.onerror=function(gb){Lc("error",
gb);this.emitAll("error",gb)};qa.prototype.socket=function(gb,Hc){function Cd(){~Xb(qd.connecting,fe)||qd.connecting.push(fe)}var fe=(this||Hd).nsps[gb];if(!fe){fe=new nb(this||Hd,gb,Hc);(this||Hd).nsps[gb]=fe;var qd=this||Hd;fe.on("connecting",Cd);fe.on("connect",function(){fe.id=qd.generateId(gb)});(this||Hd).autoConnect&&Cd()}return fe};qa.prototype.destroy=function(gb){gb=Xb((this||Hd).connecting,gb);~gb&&(this||Hd).connecting.splice(gb,1);(this||Hd).connecting.length||this.close()};qa.prototype.packet=
function(gb){Lc("writing packet %j",gb);var Hc=this||Hd;gb.query&&0===gb.type&&(gb.nsp+="?"+gb.query);Hc.encoding?Hc.packetBuffer.push(gb):(Hc.encoding=!0,(this||Hd).encoder.encode(gb,function(Cd){for(var fe=0;fe<Cd.length;fe++)Hc.engine.write(Cd[fe],gb.options);Hc.encoding=!1;Hc.processPacketQueue()}))};qa.prototype.processPacketQueue=function(){if(0<(this||Hd).packetBuffer.length&&!(this||Hd).encoding){var gb=(this||Hd).packetBuffer.shift();this.packet(gb)}};qa.prototype.cleanup=function(){Lc("cleanup");
for(var gb=(this||Hd).subs.length,Hc=0;Hc<gb;Hc++)(this||Hd).subs.shift().destroy();(this||Hd).packetBuffer=[];(this||Hd).encoding=!1;(this||Hd).lastPing=null;(this||Hd).decoder.destroy()};qa.prototype.close=qa.prototype.disconnect=function(){Lc("disconnect");(this||Hd).skipReconnect=!0;(this||Hd).reconnecting=!1;"opening"===(this||Hd).readyState&&this.cleanup();(this||Hd).backoff.reset();(this||Hd).readyState="closed";(this||Hd).engine&&(this||Hd).engine.close()};qa.prototype.onclose=function(gb){Lc("onclose");
this.cleanup();(this||Hd).backoff.reset();(this||Hd).readyState="closed";this.emit("close",gb);(this||Hd)._reconnection&&!(this||Hd).skipReconnect&&this.reconnect()};qa.prototype.reconnect=function(){if((this||Hd).reconnecting||(this||Hd).skipReconnect)return this||Hd;var gb=this||Hd;if((this||Hd).backoff.attempts>=(this||Hd)._reconnectionAttempts)Lc("reconnect failed"),(this||Hd).backoff.reset(),this.emitAll("reconnect_failed"),(this||Hd).reconnecting=!1;else{var Hc=(this||Hd).backoff.duration();
Lc("will wait %dms before reconnect attempt",Hc);(this||Hd).reconnecting=!0;var Cd=setTimeout(function(){gb.skipReconnect||(Lc("attempting reconnect"),gb.emitAll("reconnect_attempt",gb.backoff.attempts),gb.emitAll("reconnecting",gb.backoff.attempts),gb.skipReconnect||gb.open(function(fe){fe?(Lc("reconnect attempt error"),gb.reconnecting=!1,gb.reconnect(),gb.emitAll("reconnect_error",fe.data)):(Lc("reconnect success"),gb.onreconnect())}))},Hc);(this||Hd).subs.push({destroy:function(){clearTimeout(Cd)}})}};
qa.prototype.onreconnect=function(){var gb=(this||Hd).backoff.attempts;(this||Hd).reconnecting=!1;(this||Hd).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",gb)};return Li}var Mb=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");Mb.nyi=function(qa){throw Error("Not yet implemented: "+qa);};Mb.string=lb;Mb.promise=Eb;Mb.debugMessageOrder=!1;var vb=function(qa){this.id=Mb.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=
new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};vb.prototype.isOnline=function(){Mb.nyi("isOnline")};vb.prototype.open=function(){Mb.nyi("isOnline")};vb.prototype.close=function(){Mb.nyi("close")};vb.prototype.remove=function(){Mb.nyi("remove")};vb.prototype.whenOnline=function(qa){var eb=this;return Mb.promise.waitFor(qa,function(){return eb.isOnline()}).then(function(){return eb}).catch(function(nb){return Promise.reject(/timeout/i.test(String(nb))?
Error("Timeout in "+eb+".whenOnline"):nb)})};vb.prototype.onError=function(qa){this.debug&&console.log("["+this+"] error: "+qa)};vb.prototype.removeService=function(qa){delete this.actions[qa]};vb.prototype.removeServices=function(qa){var eb=this;qa.forEach(function(nb){return eb.removeService(nb)})};vb.prototype.addService=function(qa,eb){this.actions[qa]=eb};vb.prototype.addServices=function(qa){var eb=this;Object.keys(qa).forEach(function(nb){return eb.addService(nb,qa[nb])})};vb.prototype.ping=
function(qa){var eb=this,nb,ab,mb,ic,Nc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){if(1==Lc.nextAddress)return nb=Date.now(),Lc.yield(eb.sendToAndWait(qa,"l2l-ping",{timestamp:nb}),2);ab=Lc.yieldResult;mb=ab.data;ic=mb.timestamp;Nc=Date.now();return Lc.return({to:ic-nb,from:Nc-ic,roundtrip:Nc-nb})})};vb.prototype.send=function(qa,eb){Mb.nyi("send")};vb.prototype.sendAndWait=function(qa){var eb=this,nb,ab,mb,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nc){switch(Nc.nextAddress){case 1:return nb=
new Promise(function(Lc,Xb){return eb.send(qa,Lc)}),ab={},mb=eb.options.ackTimeout+400,"ackTimeout"in qa&&(mb=!qa.ackTimeout||0>qa.ackTimeout?null:qa.ackTimeout+400),mb?Nc.yield(Promise.race([Mb.promise.delay(mb,ab),nb]),5):Nc.yield(nb,4);case 4:ic=Nc.yieldResult;Nc.jumpTo(3);break;case 5:ic=Nc.yieldResult;case 3:if(ic===ab)throw Error("Timeout sending "+qa.action);return Nc.return(ic)}})};vb.prototype.sendTo=function(qa,eb,nb,ab){return this.send({target:qa,action:eb,data:nb},ab)};vb.prototype.sendToAndWait=
function(qa,eb,nb,ab){return this.sendAndWait(Object.assign({target:qa,action:eb,data:nb},ab))};vb.prototype.prepareSend=function(qa,eb){var nb=qa.target,ab=qa.action,mb=qa.messageId,ic=qa.sender;if(!ab)throw Error("Trying to send a message without specifying action!");if(!nb)throw Error("Trying to send message "+ab+" without specifying target!");mb||(qa.messageId=Mb.string.newUUID());ic||(qa.sender=this.id);ab=qa.n=this._outgoingOrderNumberingByTargets.get(nb)||0;this._outgoingOrderNumberingByTargets.set(nb,
ab+1);if("function"===typeof eb){ic=this;var Nc=eb;eb=function(Lc){var Xb=ic._incomingOrderNumberingBySenders.get(Lc.sender)||0;ic.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+ic+" received ack for "+Lc.action+" as msg "+Xb);try{Nc.apply(null,arguments)}catch(Tb){console.error("Error in ack fn of "+ic+": "+Tb.stack)}ic._incomingOrderNumberingBySenders.set(Lc.sender,Xb+1);setTimeout(function(){return ic.invokeOutOfOrderMessages(Lc.sender)},0)}}this.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" sending "+ab+" ("+qa.action+") to "+nb);return[qa,eb]};vb.prototype.prepareAnswerMessage=function(qa,eb){return{action:qa.action+"-response",inResponseTo:qa.messageId,target:qa.sender,data:eb,sender:this.id}};vb.prototype.installEventToMessageTranslator=function(qa){var eb=this,nb=qa.onevent;qa.onevent=function(ab){var mb=ab.data||[];nb.call(this,ab);ab.data=["*"].concat(mb);nb.call(this,ab)};qa.on("*",function(ab,mb){ab&&"object"===typeof ab&&ab.action&&(mb=ab,ab=mb.action);var ic=arguments[arguments.length-
1];ic="function"===typeof ic?ic:null;(mb=mb===ic?null:mb)&&mb.data&&("number"===typeof mb.n||mb.broadcast)&&mb.sender?eb.receive(mb,qa,ic):(console.warn(eb+" received non-conformant message "+ab+":",arguments),"function"===typeof ic&&ic({data:{error:"invalid l2l message"}}))})};vb.prototype.receive=function(qa,eb,nb){this.dispatchL2LMessageToSelf(qa,eb,nb)};vb.prototype.dispatchL2LMessageToSelf=function(qa,eb,nb){var ab=this,mb=qa.action;if(qa.broadcast)this.safeInvokeServiceHandler(mb,qa,nb,eb);
else try{var ic=this._incomingOrderNumberingBySenders.get(qa.sender)||0,Nc="register"===mb||"unregister";if(!Nc&&qa.n<ic)console.error("[MSG ORDER] ["+this+"] received message no. "+qa.n+" but expected >= "+ic+", dropping "+mb);else if(!Nc&&qa.n>ic){this.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+mb+" ("+qa.n+") for later invocation");var Lc=this._outOfOrderCacheBySenders.get(qa.sender);Lc||(Lc=[],this._outOfOrderCacheBySenders.set(qa.sender,Lc));
Lc.push([mb,qa,nb,eb])}else this.safeInvokeServiceHandler(mb,qa,nb,eb),setTimeout(function(){return ab.invokeOutOfOrderMessages(qa.sender)},0)}catch(Xb){console.error("Error message ordering when handling "+mb+": "+(Xb.stack||Xb)),"function"===typeof nb&&nb(this.prepareAnswerMessage(qa,{isError:!0,error:String(Xb.stack||Xb)}))}};vb.prototype.invokeOutOfOrderMessages=function(qa){var eb=this._outOfOrderCacheBySenders.get(qa);if(eb&&eb.length){var nb=this._incomingOrderNumberingBySenders.get(qa)||0;
qa=eb.findIndex(function(ab){ab=$jscomp.makeIterator(ab);ab.next();return ab.next().value.n===nb});-1!==qa&&(eb.splice(qa,1),this.invokeServiceHandler.apply(this,eb[qa]))}};vb.prototype.renameTarget=function(qa,eb){if(qa!==eb){var nb=this._outgoingOrderNumberingByTargets.get(qa);this._outgoingOrderNumberingByTargets.delete(qa);this._outgoingOrderNumberingByTargets.set(eb,nb)}};vb.prototype.safeInvokeServiceHandler=function(qa,eb,nb,ab){try{"function"===typeof this.actions[qa]?this.invokeServiceHandler(qa,
eb,nb,ab):ab._events&&Object.keys(ab._events).includes(qa)||(console.warn("WARNING ["+this+"] Unhandled message: "+qa),"function"===typeof nb&&nb(this.prepareAnswerMessage(eb,{isError:!0,error:"message not understood: "+qa})))}catch(mb){console.error("Error when handling "+qa+": "+(mb.stack||mb)),"function"===typeof nb&&nb(this.prepareAnswerMessage(eb,{isError:!0,error:String(mb.stack||mb)}))}};vb.prototype.invokeServiceHandler=function(qa,eb,nb,ab){var mb=this;this.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+
this+" received "+eb.n+" ("+eb.action+") from "+eb.sender);this._incomingOrderNumberingBySenders.set(eb.sender,eb.n+1);if("function"===typeof nb){var ic=!1,Nc=!1,Lc="ackTimeout"in eb?eb.ackTimeout:this.options.ackTimeout,Xb=this._outgoingOrderNumberingByTargets.get(eb.sender)||0;this._outgoingOrderNumberingByTargets.set(eb.sender,Xb+1);var Tb=function(tc){Nc?console.warn("["+mb+"] ackFn for "+eb.action+" called after it timed out, dropping answer!"):ic?console.warn("["+mb+"] ack function called repeatedly when handling "+
eb.action):(ic=!0,nb(mb.prepareAnswerMessage(eb,tc)),mb.debug&&Mb.debugMessageOrder&&console.log("[MSG ORDER] "+mb+" sending "+Xb+" (ack for "+eb.action+")"))};Lc&&setTimeout(function(){ic||(Tb({isError:!0,error:"Timeout error: "+mb+" did not send answer for "+eb.action+" after "+Lc+"ms"}),Nc=!0)},Lc)}try{this.actions[qa].call(this,this,eb,Tb,ab)}catch(tc){console.error("["+this+"] Error handling "+qa+": "+(tc.stack||tc)),Tb&&Tb({error:tc.stack})}};$jscomp.global.Object.defineProperties(vb.prototype,
{debug:{configurable:!0,enumerable:!0,get:function(){return this.options.debug},set:function(qa){this.options.debug=qa}}});Mb.L2LConnection=vb;Mb.default=vb;var Ia=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),Rb={"l2l-ping":function(qa,eb,nb,ab){ab=eb.sender;eb=eb.data.timestamp;var mb=Date.now();"function"===typeof nb&&nb({timestamp:mb});qa.debug&&console.log("[undefined] got ping from "+ab+", time: "+(mb-eb)+"ms")},"remote-eval":function(qa,eb,nb,ab){var mb=eb.data.source;
Promise.resolve().then(function(){return eval(mb)}).then(function(ic){return nb({value:ic})}).catch(function(ic){ic.originalErr&&(ic=ic.originalErr);console.error("eval error: "+ic);"function"===typeof nb&&nb({isError:!0,value:String(ic.stack||ic)})})},"remote-eval-2":function(qa,eb,nb,ab){var mb=eb.data.source;Promise.resolve().then(function(){var ic=eval(mb);if(!(ic instanceof Promise))throw console.error("unexpected eval result:"+ic),Error("unexpected eval result:"+ic);return ic}).then(function(ic){return nb(ic)}).catch(function(ic){console.error("eval error: "+
ic);ic.originalErr&&(ic=ic.originalErr);"function"===typeof nb&&nb({isError:!0,value:String(ic.stack||ic)})})}};Ia.defaultActions=Rb;Ia.defaultActions=Rb;Ia.defaultActions=Rb;var Jc={},Rc=(Jc["[broadcast] send"]=function(qa,eb,nb,ab){var mb=eb.sender,ic=eb.data,Nc,Lc,Xb,Tb,tc,gb,Hc,Cd,fe,qd,ge,se;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Se){Nc=ic;Lc=Nc.action;Xb=Nc.broadcast;Tb=Nc.room;tc=Nc.namespace;gb=Nc.isSystemBroadcast;Hc=Nc.isMultiServerBroadcast;Cd=[];Hc?(console.log(".......isMultiServerBroadcast"),
fe=qa,qd=fe.id,ge=qa.getTrackerList(),console.log(ge),Cd=ge.map(function(Ue){return Ue.id!=qd?Ue.io.nsps["/"+Ue.namespace]:ab.broadcast})):(gb&&(tc=qa.namespace),Cd.push(tc?qa.io.nsps["/"+tc]:ab.broadcast));Cd.forEach(function(Ue){return Ue.to(Tb).emit({action:Lc,sender:mb,broadcast:!0,data:Xb})});nb&&"function"===typeof nb&&(se="message broadcasted to "+Tb,tc&&(se+=" in namespace "+tc),1<Cd.length&&(se+=" "+Cd.length+" trackers"),console.log(se),nb({status:se}));Se.jumpToEnd()})},Jc["[broadcast] join room"]=
function(qa,eb,nb,ab){var mb=eb.sender,ic=eb.data.room,Nc,Lc,Xb,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return Lc=!1,Xb=qa.io.nsps["/"+qa.namespace].adapter.rooms,(Tb=Xb[ic]&&Xb[ic].sockets&&Xb[ic].sockets[ab.id])?(Nc=mb+" already in "+ic,tc.jumpTo(2)):tc.yield(new Promise(function(gb,Hc){return ab.join(ic,function(Cd){return Cd?Hc(Cd):gb()})}),3);2!=tc.nextAddress&&(Nc=mb+" joined "+ic,Lc=!0);nb&&"function"===typeof nb&&nb({status:Nc,joined:Lc});tc.jumpToEnd()})},
Jc["[broadcast] leave room"]=function(qa,eb,nb,ab){var mb=eb.sender,ic=eb.data.room,Nc,Lc,Xb,Tb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tc){if(1==tc.nextAddress)return Lc=!1,Xb=qa.io.nsps["/"+qa.namespace].adapter.rooms,Tb=Xb[ic]&&Xb[ic].sockets&&Xb[ic].sockets[ab.id],Tb?tc.yield(new Promise(function(gb,Hc){return ab.leave(ic,function(Cd){return Cd?Hc(Cd):gb()})}),3):(Nc=mb+" not in "+ic,tc.jumpTo(2));2!=tc.nextAddress&&(Nc=mb+" left room "+ic,Lc=!0);console.log(Nc);nb&&"function"===
typeof nb&&nb({left:Lc,status:Nc});tc.jumpToEnd()})},Jc["[broadcast] my rooms"]=function(qa,eb,nb,ab){nb(ab.rooms)},Jc["[broadcast] all rooms"]=function(qa,eb,nb,ab){nb(qa.io.nsps["/"+qa.namespace].adapter.rooms)},Jc["[broadcast] list room members"]=function(qa,eb,nb,ab){eb=eb.data.room;ab=qa.io;eb?(qa=ab.nsps["/"+qa.namespace].adapter.rooms[eb],nb({room:eb,sockets:qa?qa.sockets:{},length:qa?qa.length:0})):nb({isError:!0,error:"`room` paramerter missing!"})},Jc.getClients=function(qa,eb,nb){qa.removeDisconnectedClients();
nb(Array.from(qa.clients))},Jc);Ia.defaultTrackerActions=Rc;Ia.defaultTrackerActions=Rc;Ia.defaultTrackerActions=Rc;var xc={},Fa=(xc.getRoomList=function(qa){var eb=qa.client,nb=qa.ackFn,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){ab=eb._socketioClient.rooms;nb(ab);mb.jumpToEnd()})},xc["ask for"]=function(qa,eb,nb,ab){var mb=eb.sender,ic=eb.data.query,Nc=this,Lc,Xb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tb){if(1==Tb.nextAddress)return Lc=ic.match(/password|sudo/i)?
"passwordPrompt":"prompt",Tb.yield($world[Lc](ic),2);Xb=Tb.yieldResult;"function"===typeof nb&&nb({answer:Xb});qa.debug&&console.log("["+Nc+"] message 'ask for' from "+mb+", query: "+ic);Tb.jumpToEnd()})},xc["open editor"]=function(qa,eb,nb,ab){var mb=eb.data.args,ic;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nc){if(1==Nc.nextAddress)return mb.length?Nc.yield($world.execCommand("open file for EDITOR",{url:mb[0]}),2):(nb({error:"no file specified"}),Nc.return());ic=Nc.yieldResult;
"function"===typeof nb&&nb("aborted"===ic?{error:String(ic)}:{status:ic});Nc.jumpToEnd()})},xc.changeWorkingDirectory=function(qa,eb,nb,ab){var mb=eb.data.args,ic,Nc,Lc,Xb,Tb,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){ic=$jscomp.makeIterator(mb||[]);Nc=ic.next().value;Lc=ic.next().value;Xb="OK";try{if(Nc)if(Lc){if(Tb=$world.getMorphWithId(Lc))if(Tb.__lookupSetter__("cwd"))Tb.cwd=Nc;else if("function"===typeof Tb.changeWorkingDirectory)Tb.changeWorkingDirectory(Nc);else if("function"===
typeof Tb.pluginFind){if(tc=Tb.pluginFind(function(Hc){return Hc.isShellEditorPlugin}))tc.cwd=Nc}else Xb="[changeWorkingDirectory] cannot figure pout how to set dir"}else Xb="[changeWorkingDirectory] No command morph";else Xb="[changeWorkingDirectory] No directory received"}catch(Hc){Xb=String(Hc)}"OK"!==Xb&&console.warn(Xb);"function"===typeof nb&&nb(Xb);gb.jumpToEnd()})},xc);Ia.defaultClientActions=Fa;Ia.defaultClientActions=Fa;Ia.defaultClientActions=Fa;var nc={},$a=!1,Pa={},Oa=!1,Kb={},Ib=!1,
bd="undefined"!==typeof self?self:global,Od={},Zd=!1,Te="undefined"!==typeof self?self:global,Qc={},Xd=!1,kd={},Bb=!1,da="undefined"!==typeof self?self:global,ra={},ub=!1,H={},ia=!1,Ba={},rb=!1,sc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,yc={},Gd=!1,Ld="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ke={},hd=!1,Md={},ze=!1,Ne={},yf=!1,tf={},vc=!1,Fe={},mf=!1,Jf={},ye=!1,va={},Ka=!1,sb={},Q=!1,ua={},Za=!1,ib={},oc=!1,cc={},ad=
!1,Tc={},Vc=!1,Yd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Mf={},Bf=!1,Hg={},df=!1,Bg={},Di=!1,Pg={},Nj=!1,Oe="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ki={},Kh=!1,be="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,gj={},Mj=!1,lg="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,yk={},Tj=!1,Bj={},Bh=!1,zf="undefined"!==typeof globalThis?globalThis:"undefined"!==
typeof self?self:global,$e={},ll=!1,Sa={},Wc=!1,Wd={},Td=!1,Ic="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,dg={},ji=!1,Rk={},Cm=!1,Um={},hj=!1,Jl={},Pk=!1,zk={},Kl=!1,Ee="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ik={},im=!1,ij="undefined"!==typeof self?self:global,Li={},ck=!1,Hd="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Aj={},jj=!1,Qk=function(){function qa(Nc,Lc){"object"===typeof Nc&&
(Lc=Nc,Nc=void 0);Lc=Lc||{};Nc=eb(Nc);var Xb=Nc.source,Tb=Nc.id,tc=Nc.path;tc=ic[Tb]&&tc in ic[Tb].nsps;Lc.forceNew||Lc["force new connection"]||!1===Lc.multiplex||tc?(mb("ignoring socket cache for %s",Xb),Xb=ab(Xb,Lc)):(ic[Tb]||(mb("new io instance for %s",Xb),ic[Tb]=ab(Xb,Lc)),Xb=ic[Tb]);Nc.query&&!Lc.query&&(Lc.query=Nc.query);return Xb.socket(Nc.path,Lc)}if(jj)return Aj;jj=!0;var eb=od(),nb=bc(),ab=Ca(),mb=Dd()("socket.io-client");Aj=Aj=qa;var ic=Aj.managers={};Aj.protocol=nb.protocol;Aj.connect=
qa;Aj.Manager=Ca();Aj.Socket=T();return Aj}(),Lf=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Lf.determineLocation=function(){return"undefined"!==typeof document&&document.location?document.location.origin:Lf.isNode?System._nodeRequire("os").hostname():System.baseURL};Lf.promise=Eb;Lf.fun=Bd;Lf.obj=Fc;Lf.events=wd;Lf.num=Kc;Lf.L2LConnection=vb;Lf.defaultActions=Rb;Lf.defaultClientActions=Fa;Lf.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&
process.env;Lf._ioClient=Qk;Lf.ioClient=Lf.ioClient||void 0;Lf.isNode?(Lf.require=System._nodeRequire("module")._load,Lf.ioClient=Lf.require("socket.io-client")):Lf.ioClient=Lf._ioClient;Lf.urlHelper={isRoot:function(qa){return"/"===Lf.urlHelper.path(qa)},root:function(qa){return Lf.urlHelper.isRoot(qa)?qa:qa.slice(0,-Lf.urlHelper.path(qa).length)+"/"},path:function(){var qa=/^[a-z0-9-_\.]+:/,eb=/^\/\/[^\/]+/;return function(nb){nb=nb.replace(qa,"").replace(eb,"");return""===nb?"/":nb}}(),join:function(qa,
eb){qa.endsWith("/")&&(qa=qa.slice(0,-1));eb.startsWith("/")&&(eb=eb.slice(1));return qa+"/"+eb}};var sg=function(qa,eb,nb,ab){var mb=Lf.L2LConnection.call(this)||this;Lf.events.makeEmitter(mb);mb.info=ab;mb.origin=qa;mb.path=eb;mb.namespace=nb.replace(/^\/?/,"/");mb.trackerId=null;mb._socketioClient=null;mb._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Lf.defaultActions).forEach(function(ic){return mb.addService(ic,
Lf.defaultActions[ic])});Object.keys(Lf.defaultClientActions).forEach(function(ic){return mb.addService(ic,Lf.defaultClientActions[ic])});return mb};$jscomp.inherits(sg,Lf.L2LConnection);sg.clientKey=function(qa,eb,nb){qa=qa.replace(/\/$/,"");eb=eb.replace(/^\//,"");nb=nb.replace(/^\//,"");return qa+"-"+eb+"-"+nb};sg.forLivelyInBrowser=function(qa){var eb=!!qa;qa=Object.assign({type:"lively.morphic browser"},qa);var nb=this.default();if(!nb)return Lf.L2LClient.ensure({url:document.location.origin+
"/lively-socket.io",namespace:"l2l",info:qa});eb&&!Lf.obj.equals(nb.info,qa)&&nb.isRegistered()&&(nb.info=qa,nb.unregister().then(function(){return nb.register()}).catch(function(ab){return console.error("l2l re-register on info change errored: "+ab)}));return nb};sg.default=function(){var qa=Lf.L2LClient.clients.keys().next().value;return Lf.L2LClient.clients.get(qa)};sg.create=function(qa){var eb=qa=void 0===qa?{}:qa;qa=void 0===eb.debug?!1:eb.debug;var nb=eb.url,ab=eb.namespace,mb=void 0===eb.autoOpen?
!0:eb.autoOpen;eb=void 0===eb.info?{}:eb.info;if(!nb)throw Error("L2LClient needs server url!");var ic=Lf.urlHelper.root(nb).replace(/\/+$/,"");nb=Lf.urlHelper.path(nb);ab=new this(ic,nb,ab||"",eb);mb&&ab.register();ab.debug=qa;return ab};sg.ensure=function(qa){var eb=qa=void 0===qa?{}:qa,nb=eb.url;eb=eb.namespace;if(!nb)throw Error("L2LClient needs server url!");var ab=Lf.urlHelper.root(nb).replace(/\/+$/,""),mb=Lf.urlHelper.path(nb);ab=this.clientKey(ab,mb,eb||"");(mb=this.clients.get(ab))||this.clients.set(ab,
mb=this.create(Object.assign({},qa,{url:nb,namespace:eb})));return mb};sg.prototype.isOnline=function(){return this.socket&&this.socket.connected};sg.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};sg.prototype.open=function(){var qa=this,eb,nb,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){if(1==mb.nextAddress)return qa.isOnline()||qa._reconnectState.isOpening?mb.return(qa):mb.yield(qa.close(),2);qa._reconnectState.closed=!1;eb=Lf.urlHelper.join(qa.origin,
qa.namespace);nb={path:qa.path,transports:["websocket","polling"]};ab=qa._socketioClient=Lf.ioClient(eb,nb);qa.debug&&console.log("["+qa+"] connecting");ab.on("error",function(ic){qa._reconnectState.isOpening=!1;qa.debug&&console.log("["+qa+"] errored: "+ic)});ab.on("close",function(ic){return qa.debug&&console.log("["+qa+"] closed: "+ic)});ab.on("reconnect_failed",function(){return qa.debug&&console.log("["+qa+"] could not reconnect")});ab.on("reconnect_error",function(ic){return qa.debug&&console.log("["+
qa+"] reconnect error "+ic)});ab.on("connect",function(){qa.debug&&console.log("["+qa+"] connected");qa.emit("connected",qa);qa._reconnectState.isOpening=!1;qa._reconnectState.isReconnecting=!1;qa._reconnectState.isReconnectingViaSocketio=!1});ab.on("disconnect",function(){qa._reconnectState.isOpening=!1;qa.debug&&console.log("["+qa+"] disconnected");qa.emit("disconnected",qa);qa.trackerId?("tracker"!==qa.trackerId&&(qa.renameTarget(qa.trackerId,"tracker"),qa.trackerId=null),qa._reconnectState.closed?
qa.debug&&console.log("["+qa+"] won't reconnect b/c client is marked as closed"):qa._reconnectState.autoReconnect?(qa._reconnectState.isReconnecting=!0,setTimeout(function(){qa._reconnectState.closed?qa.debug&&console.log("["+qa+"] won't reconnect b/c client is marked as closed 2"):qa._reconnectState.isReconnectingViaSocketio?qa.debug&&console.log("["+qa+"] won't reconnect again, client already reconnecting"):(qa.debug&&console.log("["+qa+"] initiating reconnection to tracker"),qa.register())},20)):
qa.debug&&console.log("["+qa+"] won't reconnect b/c client has reconnection disabled")):(qa.debug&&console.log("["+qa+"] disconnect: don't have a tracker id, won't try reconnect"),qa.trackerId="tracker")});ab.on("reconnecting",function(){qa.debug&&console.log("["+qa+"] reconnecting",qa._reconnectState);qa.emit("reconnecting",qa);qa._reconnectState.closed?(qa._reconnectState.isReconnecting=!1,qa._reconnectState.isReconnectingViaSocketio=!1,ab.close(),qa.close()):(qa._reconnectState.isReconnecting=
!0,qa._reconnectState.isReconnectingViaSocketio=!0)});ab.on("reconnect",function(){qa.debug&&console.log("["+qa+"] reconnected");qa._reconnectState.isReconnecting=!1;qa._reconnectState.isReconnectingViaSocketio=!1;qa.register()});qa.installEventToMessageTranslator(ab);qa._reconnectState.isOpening=!0;return mb.return((new Promise(function(ic,Nc){ab.once("error",Nc);ab.once("connect",ic)})).then(function(){return qa}))})};sg.prototype.close=function(){var qa=this,eb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==
ab.nextAddress){qa._reconnectState.closed=!0;if(eb=qa.socket)eb.removeAllListeners("reconnect"),eb.removeAllListeners("reconnecting"),eb.removeAllListeners("disconnect"),eb.removeAllListeners("connect"),eb.removeAllListeners("reconnect_error"),eb.removeAllListeners("reconnect_failed"),eb.removeAllListeners("close"),eb.removeAllListeners("error"),eb.close();qa.debug&&console.log("["+qa+"] closing...");return qa.isRegistered()?ab.yield(qa.unregister(),2):ab.jumpTo(2)}return qa.isOnline()||qa.socket?
eb&&!eb.connected?(qa.debug&&console.log("["+qa+"] socket not connected, considering client closed"),ab.return(qa)):ab.return(Promise.race([Lf.promise.delay(2E3).then(function(){return eb.removeAllListeners("disconnect")}),new Promise(function(mb){return eb.once("disconnect",mb)})]).then(function(){qa.debug&&console.log("["+qa+"] closed");return qa})):(qa.debug&&(nb=qa.isOnline()?"no socket":"not online",qa.debug&&console.log("["+qa+"] cannot close: "+nb)),ab.return(qa))})};sg.prototype.remove=function(){var qa=
this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(qa);return this.close()};sg.prototype.register=function(){var qa=this,eb,nb,ab,mb,ic,Nc,Lc,Xb,Tb,tc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:if(qa.isRegistered())return gb.return();if(qa._reconnectState.closed)return qa.debug&&console.log("["+qa+"] not registering this b/c closed"),qa._reconnectState.registerAttempt=0,gb.return();if(qa._reconnectState.registerProcess)return qa.debug&&
console.log("["+qa+"] not registering this b/c register process exists"),gb.return();gb.setCatchFinallyBlocks(2);if(qa.isOnline()){gb.jumpTo(4);break}return gb.yield(qa.open(),4);case 4:return qa.debug&&console.log("["+qa+"] register"),gb.yield(qa.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Lf.isNode?"node":"browser"),location:Lf.determineLocation()},qa.info)),6);case 6:eb=gb.yieldResult;if(!eb.data)throw nb=Error("Register answer is empty!"),qa.emit("error",
nb),nb;if(eb.data.isError)throw ab=Error(eb.data.error),qa.emit("error",ab),ab;qa._reconnectState.registerAttempt=0;mb=eb;ic=mb.data;Nc=ic.trackerId;Lc=ic.messageNumber;qa.trackerId=Nc;qa._incomingOrderNumberingBySenders.set(Nc,Lc||0);qa.emit("registered",{trackerId:Nc});gb.leaveTryBlock(0);break;case 2:Xb=gb.enterCatchBlock(),console.error("Error in register request of "+qa+": "+Xb),Tb=qa._reconnectState.registerAttempt++,tc=Lf.num.backoff(Tb,4,3E5),qa._reconnectState.registerProcess=setTimeout(function(){qa._reconnectState.registerProcess=
null;qa.register()},tc),gb.jumpToEnd()}})};sg.prototype.unregister=function(){var qa=this,eb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(nb){switch(nb.nextAddress){case 1:if(!qa.isRegistered())return nb.return();qa.debug&&console.log("["+qa+"] unregister");eb=qa.trackerId;nb.setCatchFinallyBlocks(2);return nb.yield(qa.sendToAndWait(qa.trackerId,"unregister",{}),4);case 4:nb.leaveTryBlock(3);break;case 2:nb.enterCatchBlock();case 3:qa.renameTarget(eb,"tracker"),qa.trackerId=null,qa.emit("unregistered",
qa),nb.jumpToEnd()}})};sg.prototype.whenRegistered=function(qa){var eb=this;return Lf.promise.waitFor(qa,function(){return eb.isRegistered()}).catch(function(nb){return Promise.reject(/timeout/i.test(String(nb))?Error("Timeout in "+eb+".whenRegistered"):nb)})};sg.prototype.send=function(qa,eb){var nb=this,ab=$jscomp.makeIterator(this.prepareSend(qa,eb));qa=ab.next().value;eb=ab.next().value;this.whenOnline().then(function(){var mb=nb.socket,ic=qa,Nc=ic.action;ic=ic.target;if(!mb)throw Error("Trying to send message "+
Nc+" to "+ic+" but cannot find a connection to it!");"function"===typeof eb?mb.emit(Nc,qa,eb):mb.emit(Nc,qa)})};sg.prototype.joinRoom=function(qa){var eb=this;return this.whenOnline().then(function(){return eb.sendToAndWait(eb.trackerId,"[broadcast] join room",{room:qa})})};sg.prototype.leaveRoom=function(qa){var eb=this;return this.whenOnline().then(function(){return eb.sendToAndWait(eb.trackerId,"[broadcast] leave room",{room:qa})})};sg.prototype.broadcast=function(qa,eb,nb,ab,mb){var ic=this,Nc=
{action:eb,room:qa,broadcast:nb};if(void 0===ab?0:ab)Nc.isSystemBroadcast=!0;if(void 0===mb?0:mb)Nc.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return ic.sendToAndWait(ic.trackerId,"[broadcast] send",Nc)})};sg.prototype.listRoomMembers=function(qa){var eb=this,nb,ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(mb){if(1==mb.nextAddress)return mb.yield(eb.sendToAndWait(eb.trackerId,"[broadcast] list room members",{room:qa}),2);nb=mb.yieldResult;ab=nb.data;return mb.return(ab)})};
sg.prototype.joinedRooms=function(){var qa=this,eb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==ab.nextAddress)return ab.yield(qa.sendToAndWait(qa.trackerId,"[broadcast] my rooms",{}),2);eb=ab.yieldResult;nb=eb.data;return ab.return(nb)})};sg.prototype.listRooms=function(){var qa=this,eb,nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ab){if(1==ab.nextAddress)return ab.yield(qa.sendToAndWait(qa.trackerId,"[broadcast] all rooms",{}),2);eb=ab.yieldResult;nb=
eb.data;return ab.return(nb)})};sg.prototype.listPeers=function(qa){qa=void 0===qa?!1:qa;var eb=this,nb,ab,mb,ic,Nc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Xb){if(1==Xb.nextAddress)return nb=eb,ab=nb._peersCached,mb=Date.now(),!qa&&ab&&1E3>mb-ab.timestamp?Xb.return(eb._peersCached.sessions):eb.isOnline()?Xb.yield(eb.sendToAndWait(eb.trackerId,"getClients",{}),2):Xb.return([]);ic=Xb.yieldResult;Nc=ic.data;Lc=Nc.map(function(Tb){var tc=$jscomp.makeIterator(Tb);Tb=tc.next().value;
var gb=tc.next().value,Hc=gb.info||{};tc=Hc.userRealm;var Cd=Hc.userToken,fe=Hc.l2lUserToken,qd=Hc.location,ge=Hc.type;Hc=Hc.world;Tb=Object.assign({},Lf.obj.dissoc(gb,["info"]),{id:Tb,world:Hc,location:qd,type:ge});(Cd=Cd||fe)&&"null"!==Cd&&(lively.user?Tb.user=lively.user.ClientUser.fromToken(Cd,tc):(Tb.userToken=Cd,Tb.userRealm=tc));return Tb});eb._peersCached={timestamp:mb,sessions:Lc};return Xb.return(Lc)})};sg.prototype.toString=function(){var qa=this.origin,eb=this.path,nb=this.namespace,ab=
this.id,mb=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+(ab||"").slice(0,5)+" "+qa+eb+" - "+nb+" "+mb+")"};$jscomp.global.Object.defineProperties(sg.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(sg,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});sa("default",sg);Lf.L2LClient=sg;Lf.default=sg}}});