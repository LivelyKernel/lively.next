System.register(["./__root_module__-b4667baa.js","kld-intersections"],function(ta){var lb,yb,Qb,Kb,yd,Cc,rd,Fc,Dc,Rc,$c,Hd,gd,Uc,Pa;return{setters:[function(mb){lb=mb.s;yb=mb.P;Qb=mb.a6;Kb=mb.p;yd=mb.bF;Cc=mb.D;rd=mb.bG;Fc=mb.r;Dc=mb.aS;Rc=mb.bH;$c=mb.bI;Hd=mb.bJ;gd=mb.bK;Uc=mb.bL;Pa=mb.n},function(){}],execute:function(){function mb(Eb,Sb,sb,ec){ec=void 0===ec?{}:ec;ec=ec.package||Ub.ObjectPackage.lookupPackageForObject(Eb,ec);if(!ec)throw Error("Object is not part of an object package: "+Eb);
return ec.addScript(Eb,Sb,sb)}function Nb(Eb,Sb){Sb=Ub.normalizeOptions(Sb).System;Eb=(Eb=Eb[Symbol.for("lively-module-meta")])?Eb.package.name:null;return(Sb=(Eb?Ub.lookupPackage(Sb,Eb):{}).pkg)?!!Ub.ObjectPackage.forSystemPackage(Sb):!1}ta({addScript:mb,isObjectClass:Nb});var Ub=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");Ub.normalizeOptions=function(Eb){Eb=Object.assign({baseURL:Ub.defaultBaseURL,System:System},Eb);Eb.baseURL=Eb.baseURL.replace(/\/$/,"");return Eb};Ub.addScript=
mb;Ub.isObjectClass=Nb;Ub.string=lb;Ub.Path=yb;Ub.arr=Qb;Ub.parse=Kb;Ub.isValidIdentifier=yd;Ub.stringify=Cc;Ub.parseFunction=rd;Ub.resource=Fc;Ub.runEval=Dc;Ub.scripting=Rc;Ub.ExportLookup=$c;var Ic=Ub.scripting;Ub.ensurePackage=Ic.ensurePackage;Ub.registerPackage=Ic.registerPackage;Ub.importPackage=Ic.importPackage;Ub.lookupPackage=Ic.lookupPackage;Ub.module=Ic.module;Ub.ImportInjector=Ic.ImportInjector;Ub.RuntimeSourceDescriptor=Hd;Ub.toJsIdentifier=gd;Ub.adoptObject=Uc;Ub.classToFunctionTransform=
Pa;Ub.objectPackageSym=Symbol.for("lively-object-package-data");Ub.defaultBaseURL="local://lively-object-modules";Ub.globalClasses=Object.keys(System.global).map(function(Eb){Eb=System.global[Eb];return"function"===typeof Eb&&Eb.name&&Eb}).filter(Boolean);Ub.addScript=mb;Ub.addScript=mb;Ub.isObjectClass=Nb;Ub.isObjectClass=Nb;Ub._packageStore=Ub._packageStore||{};Ic=function(Eb,Sb){this._id=Eb;this.options=Ub.normalizeOptions(Sb)};Ic.lookupPackageForObject=function(Eb,Sb){return this.lookupPackageForClass(Eb.constructor,
Sb)};Ic.lookupPackageForClass=function(Eb,Sb){Sb=Ub.normalizeOptions(Sb).System;Eb=(Eb=Eb[Symbol.for("lively-module-meta")])?Eb.package.name:null;return(Sb=(Eb?Ub.lookupPackage(Sb,Eb):{}).pkg)?Ub.ObjectPackage.forSystemPackage(Sb):null};Ic.forSystemPackage=function(Eb){return this.packageStore[Eb.name]};Ic.withId=function(Eb,Sb){return this.packageStore[Eb]||(this.packageStore[Eb]=new this(Eb,Sb))};Ic.prototype.resource=function(Eb){Eb=void 0===Eb?"":Eb;return Ub.resource(this.packageURL).join(Eb)};
Ic.prototype.load=function(){return Ub.importPackage(this.System,this.packageURL)};Ic.prototype.ensureExistance=function(){var Eb=this,Sb,sb,ec,rc,yc,Db,ab,Zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kc){switch(kc.nextAddress){case 1:return Sb=Eb.resource("/"),kc.yield(Sb.exists(),2);case 2:if(kc.yieldResult)return kc.return();sb=[{resource:Sb}];ec=[{resource:Eb.resource("package.json"),content:JSON.stringify(Eb.config,null,2)}];return kc.yield(Promise.all(sb.map(function(ua){return ua.resource.mkdir()})),
3);case 3:return kc.yield(Promise.all(ec.map(function(ua){var Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){switch(cb.nextAddress){case 1:return cb.yield(ua.resource.exists(),2);case 2:if(!(Ga=!cb.yieldResult)){cb.jumpTo(3);break}return cb.yield(ua.resource.write(ua.content),4);case 4:Ga=cb.yieldResult;case 3:return cb.return(Ga)}})})),4);case 4:return kc.yield(Eb.objectModule.ensureExistance(),5);case 5:return rc=Eb,yc=rc.System,Db=rc.packageURL,ab=rc.config,kc.yield(Ub.ensurePackage(yc,
Db),6);case 6:return Zb=kc.yieldResult,Zb.registerWithConfig(ab),console.log(Eb.packageURL+" REGISTERED"),kc.return(Eb)}})};Ic.prototype.ensureObjectClass=function(Eb){var Sb=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(sb){return 1==sb.nextAddress?sb.yield(Sb.ensureExistance(),2):sb.return(Sb.objectModule.ensureObjectClass(Eb))})};Ic.prototype.adoptObject=function(Eb){var Sb=this,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){if(1==ec.nextAddress)return Sb.objectClass===
Eb.constructor?ec.return():ec.yield(Sb.ensureObjectClass(Eb.constructor),2);sb=ec.yieldResult;Ub.adoptObject(Eb,sb);ec.jumpToEnd()})};Ic.prototype.addScript=function(Eb,Sb,sb){return this.objectModule.addScript(Eb,Sb,sb)};Ic.prototype.remove=function(){this.systemPackage.remove();delete Ub.ObjectPackage.packageStore[this.id];return this.resource().remove()};Ic.prototype.renameObjectClass=function(Eb,Sb){Sb=void 0===Sb?[]:Sb;var sb=this,ec,rc,yc,Db,ab,Zb,kc,ua,Ga,cb,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pb){if(1==
pb.nextAddress){ec=sb;rc=ec.objectClass;yc=ec.System;if(!rc||rc[Symbol.for("__LivelyClassName__")]===Eb)return pb.return(rc);if(!Ub.isValidIdentifier(Eb))throw Error(Eb+" is not a valid name for a class");ab=Db=Ub.RuntimeSourceDescriptor.for(rc,yc);Zb=ab.source;kc=ab.ast;ua=kc.id;Ga=ua.start;cb=ua.end;return pb.yield(Db.changeSource(Zb.slice(0,Ga)+Eb+Zb.slice(cb)),2)}rb=sb.objectClass;Sb.forEach(function(Ta){Ta.constructor=rb;Ta.__proto__=rb.prototype});return pb.return(rb)})};Ic.prototype.fork=function(Eb,
Sb){var sb=this,ec,rc,yc,Db,ab,Zb,kc,ua,Ga,cb,rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pb){switch(pb.nextAddress){case 1:return ec=sb,rc=ec.System,yc=ec.baseURL,Db=ec.objectClass,Sb=Object.assign({System:rc,baseURL:yc},Sb),ab=Ub.RuntimeSourceDescriptor.for(Db),Zb=ab._renamedSource(Eb),kc=Zb.moduleSource,ua=Ub.ObjectPackage.withId(Eb,Sb),pb.yield(ua.ensureExistance(),2);case 2:return Ga=ua,cb=Ga.objectModule,rb=cb.systemModule,pb.yield(rb.load({format:"esm"}),3);case 3:return pb.yield(rb.changeSource(kc),
4);case 4:return pb.return(ua)}})};$jscomp.global.Object.defineProperties(Ic.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return Ub.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new Ub.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(Ic,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=Ub._packageStore)}}});ta("default",Ic);Ub.ObjectPackage=Ic;var wd=function(Eb,Sb){if(!Eb)throw Error("ObjectModule needs package!");if(!Sb)throw Error("ObjectModule needs package!");this._moduleName=Eb;this._objectPackage=Sb};wd.prototype.read=function(){return this.resource.read()};wd.prototype.write=function(Eb){return this.resource.write(Eb)};wd.prototype.ensureExistance=function(){var Eb=
this,Sb,sb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ec){switch(ec.nextAddress){case 1:return Sb=Eb.resource,ec.yield(Sb.exists(),2);case 2:if(ec.yieldResult){ec.jumpTo(3);break}return ec.yield(Sb.write("'format esm';\n"),4);case 4:sb={},Eb.System.config({meta:(sb[Eb.url]={format:"esm"},sb)});case 3:return ec.return(Eb)}})};wd.prototype.ensureObjectClass=function(Eb){var Sb=this,sb=this.objectClass;return sb&&sb.prototype.__proto__===Eb.prototype?sb:Promise.resolve(this.ensureObjectClassSource(Eb)).then(function(ec){var rc=
ec.source,yc=ec.moduleId,Db=ec.className,ab=ec.bindings,Zb=Sb.System;ec=Ub.module(Zb,yc);if(ab)for(var kc in ab)ec.define(kc,ab[kc]);rc=Ub.runEval(rc,{classTransform:Ub.classToFunctionTransform,sync:!0,targetModule:yc,System:Zb});if(rc.isError)throw rc.value;rc=ec.recorder[Db];if(!rc)throw Error("Failed to define class "+Db+" in "+yc);return rc})};wd.prototype.ensureObjectClassSource=function(Eb){return this.createDefaultClassDeclaration(Eb)};wd.prototype.createDefaultClassDeclaration=function(Eb){Eb=
void 0===Eb?Object:Eb;var Sb=this,sb,ec,rc,yc,Db,ab,Zb,kc,ua,Ga,cb,rb,pb,Ta,Ua,ob;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wb){switch(Wb.nextAddress){case 1:sb=Sb;ec=sb.System;rc=sb.systemModule;yc=sb.objectPackage;Db=Ub.string.capitalize(Ub.toJsIdentifier(yc.id));ab=Eb[Symbol.for("__LivelyClassName__")];Zb=!ab;kc=Ub.globalClasses.includes(Eb);ua="";Ga=null;if(Zb){ab="__anonymous_superclass__";cb={};Ga=(cb[ab]=Eb,cb);Wb.jumpTo(2);break}if(kc){Wb.jumpTo(2);break}return Wb.yield(Ub.ExportLookup.findExportOfValue(Eb,
ec),4);case 4:(rb=Wb.yieldResult)?(pb=Ub.ImportInjector.run(ec,rc.id,rc.package(),"",rb),Ta=pb.standaloneImport,ua+=Ta+"\n\n"):(Ua={},Ga=(Ua[ab]=Eb,Ua));case 2:return Db===ab&&(Db="Object"+Db),ob="Object"===ab?"class "+Db+" {}\n":"class "+Db+" extends "+ab+" {}\n",ua+="export default "+ob+"\n",Wb.yield(rc.changeSource(ua),5);case 5:return Wb.yield(rc.load(),6);case 6:return Wb.return({source:ua,className:Db,moduleId:Sb.url,bindings:Ga})}})};wd.prototype.addScript=function(Eb,Sb,sb){var ec=this,rc,
yc,Db,ab,Zb,kc,ua,Ga,cb,rb,pb,Ta,Ua,ob,Wb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lc){switch(lc.nextAddress){case 1:if(Eb.constructor===ec.objectClass){rc=Eb.constructor;lc.jumpTo(2);break}return lc.yield(ec.ensureObjectClass(Eb.constructor),3);case 3:rc=lc.yieldResult;case 2:yc=rc;Db="function"===typeof Sb?String(Sb):Sb;ab=Ub.parseFunction(Db);Zb=Ub.RuntimeSourceDescriptor.for(yc,ec.System);sb||(sb=Ub.Path("id.name").get(ab));if(!sb)throw Error("No name, cannot add "+Ub.string.truncate(Db,
30).replace(/\n/g,"")+"!");kc=Ub.toJsIdentifier(sb);console.assert("FunctionExpression"===ab.type||"ArrowFunctionExpression"===ab.type,"not a function expression but: "+ab.type);ua=ab.params.map(function(Lb){return Db.slice(Lb.start,Lb.end)});Ga="BlockStatement"===ab.body.type?Db.slice(ab.body.start,ab.body.end):"{ return "+Db.slice(ab.body.start,ab.body.end)+" }";cb=kc+"("+ua.join(",")+") "+Ga;"ArrowFunctionExpression"===ab.type&&(ab.type="FunctionExpression");rb=Zb.source;pb=Zb.ast;if(!pb)throw Error("cannot find class decl of "+
Zb.module.id);(Ta=pb.body.body.find(function(Lb){return Lb.key.name===kc&&!Lb.static}))?rb=rb.slice(0,Ta.start)+cb+rb.slice(Ta.end):(Ua=rb.lastIndexOf("}"),ob=rb.slice(0,Ua),Wb=rb.slice(Ua),/\n\s*$/m.test(ob)||(ob+="\n"),cb=Ub.string.changeIndent(cb,"  ",1),/^[ ]*\n/m.test(Wb)||(Wb="\n"+Wb),rb=ob+cb+Wb);return lc.yield(Zb.changeSource(rb),4);case 4:return lc.return({script:yc.prototype[kc],klass:yc,module:Zb.module.id,methodName:kc})}})};$jscomp.global.Object.defineProperties(wd.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var Eb=this.systemModule;return Eb.isLoaded()?Eb.System.get(Eb.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return Ub.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});Ub.ObjectModule=wd;Ub.default=Ic}}});