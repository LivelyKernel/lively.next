System.register(["./__rootModule___commonjs-entry-71573ff5.js"],function(Lc){var pd,Nd,Tc,Jc,$d,Bb,rd,Id;return{setters:[function(Ac){pd=Ac.b;Nd=Ac.aQ;Tc=Ac.r;Jc=Ac.C;$d=Ac.M;Bb=Ac.a$;rd=Ac.w;Id=Ac.i}],execute:function(){var Ac=window.lively.FreezerRuntime.recorderFor("lively.components/canvas.js");Ac.pt=pd;Ac.Point=Nd;Ac.rect=Tc;Ac.Color=Jc;Ac.Morph=$d;Ac.Image=Bb;Ac.connect=rd;var Pc=Lc("C",function(gd){var nd=window.lively.FreezerRuntime.recorderFor("lively.components/canvas.js"),Fd=nd.hasOwnProperty("Canvas")&&
"function"===typeof nd.Canvas?nd.Canvas:nd.Canvas=function(ic){if(!ic||!ic[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return Id(Fd,gd,[{key:"context",get:function(){if(this._canvas)return this._canvas.getContext(this.contextType);this.world()&&this.env.renderer.getNodeForMorph(this)||console.warn("Context not yet rendered. Please ensure that the Canvas Morph has been rendered first before accessing the context. This can be achieved by waiting for the whenRendered() promise before you proceed accessing the context property.");
return null}},{key:"_canvas",set:function(ic){var vd=this.__canvas__;this.__canvas__=ic;this.restoreContent(vd,ic)}},{key:"_canvas",get:function(){return this.__canvas__}},{key:Symbol["for"]("lively-instance-initialize"),value:function(){var ic=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Id._get(Object.getPrototypeOf(Fd.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this,ic);Ac.connect(this,"extent",this,"onExtentChanged")}},{key:"afterRender",value:function(ic,vd){vd?
this._canvas=ic:"function"===typeof this.__canvas_init__&&(this.__canvas_init__(),delete this.__canvas_init__)}},{key:"restoreContent",value:function(ic,vd){var sb=this.contextType,Xb=this.preserveContents;"function"===typeof this.__canvas_init__?(this.__canvas_init__(),delete this.__canvas_init__):Xb&&"2d"===sb&&ic&&ic!==vd&&this.context.drawImage(ic,0,0)}},{key:"onExtentChanged",value:function(){var ic=this;if(this._canvas&&this.preserveContents&&this.context.getImageData){var vd=this._canvas,sb=
vd.width;vd=vd.height;if(sb&&vd){var Xb=this.context.getImageData(0,0,sb,vd);this.__canvas_init__=function(){ic.context.putImageData(Xb,0,0)}}}}},{key:"clear",value:function(ic){var vd=this.context;if(vd){var sb=this._canvas,Xb=sb.width;sb=sb.height;vd.save();vd.setTransform(1,0,0,1,0,0);ic?(ic.toCSSString&&(ic=ic.toCSSString()),vd.fillStyle=ic,vd.fillRect(0,0,Xb,sb)):vd.clearRect(0,0,Xb,sb);vd.restore()}}},{key:"render",value:function(ic){return ic.renderCanvas(this)}},{key:"withContextDo",value:function(ic){var vd=
this;this._canvas?ic(this.context):this.__canvas_init__=function(){return ic(vd.context)}}},{key:"toDataURI",value:function(){return this._canvas&&this._canvas.toDataURL()}},{key:"fromDataURI",value:function(ic){var vd=this,sb=new Ac.Image;sb.onload=function(){vd._canvas.width=sb.width;vd._canvas.height=sb.height;vd.context.drawImage(sb,0,0)};sb.src=ic}},{key:"imageData",value:function(ic){ic||(ic=this.canvasBounds);return this.context.getImageData(ic.x,ic.y,ic.width,ic.height)}},{key:"nonTransparentArea",
value:function(){for(var ic=this.imageData(),vd=ic.data,sb=ic.width,Xb=ic.height,Nb=sb,bc=Xb,hb=0;hb<Xb;hb++)for(var cb=0;cb<Nb;cb++)0<vd[4*(hb*sb+cb)+3]&&(Nb=cb,bc>hb&&(bc=hb));if(Nb===sb)return Ac.rect(0,0,0,0);hb=Nb;cb=bc;for(--Xb;Xb>bc;Xb--)for(var Hb=sb-1;Hb>hb;Hb--)0<vd[4*(Xb*sb+Hb)+3]&&(hb=Hb,cb<Xb&&(cb=Xb));return{imageData:ic,bounds:Ac.rect(Nb,bc,hb-Nb+1,cb-bc+1)}}},{key:"trimNonTransparent",value:function(){var ic=this.nonTransparentArea(),vd=ic.imageData;ic=ic.bounds;if(!ic.topLeft().equals(Ac.pt(0,
0))){var sb=ic.x,Xb=ic.y;this.context.putImageData(vd,-sb,-Xb,sb,Xb,ic.width,ic.height);this.position=this.position.addPt(ic.topLeft())}ic.extent().equals(this.extent)||(this.extent=ic.extent())}},{key:"finishDraw",value:function(){var ic=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},vd=this.context,sb=ic.color;sb=void 0===sb?"rgba(0,0,0,0.6)":sb;var Xb=ic.width;Xb=void 0===Xb?4:Xb;var Nb=ic.fill;Nb=void 0===Nb?!1:Nb;ic=ic.fillColor||sb;sb.toCSSString&&(sb=sb.toCSSString());ic.toCSSString&&
(ic=ic.toCSSString());vd.strokeStyle=sb;vd.lineWidth=Xb;vd.stroke();vd.closePath();Nb&&(vd.fillStyle=ic,vd.fill())}},{key:"arc",value:function(ic,vd,sb,Xb){var Nb=4<arguments.length&&void 0!==arguments[4]?arguments[4]:!1,bc=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{},hb=this.context;hb.beginPath();hb.arc(ic.x,ic.y,vd,sb,Xb,Nb);this.finishDraw(bc)}},{key:"polygon",value:function(ic){var vd=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},sb=this.context;sb.beginPath();sb.moveTo(ic[0].x,
ic[0].y);for(var Xb=0;Xb<ic.length;Xb++)sb.lineTo(ic[Xb].x,ic[Xb].y);sb.lineTo(ic[0].x,ic[0].y);this.finishDraw(vd)}},{key:"text",value:function(ic,vd){var sb=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},Xb=this.context,Nb=sb.color;Nb=void 0===Nb?"black":Nb;var bc=sb.font;bc=void 0===bc?"14px Arial":bc;var hb=sb.align;hb=void 0===hb?"start":hb;var cb=sb.baseline;cb=void 0===cb?"bottom":cb;Xb.save();Xb.font=bc;Xb.fillStyle=Nb;Xb.textAlign=hb;Xb.textBaseline=cb;sb.angle&&!isNaN(sb.angle)&&
(Xb.translate(vd.x,vd.y),Xb.rotate(sb.angle),Xb.translate(-vd.x,-vd.y));Xb.fillText(ic,vd.x,vd.y);Xb.restore()}},{key:"line",value:function(ic,vd){var sb=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},Xb=this.context,Nb=sb.color||"rgba(0,0,0,0.6)";sb=sb.width||4;Nb.toCSSString&&(Nb=Nb.toCSSString());Xb.strokeStyle=Nb;Xb.beginPath();Xb.lineWidth=sb;Xb.moveTo(ic.x,ic.y);Xb.lineTo(vd.x,vd.y);Xb.stroke();Xb.closePath()}},{key:"spiral",value:function(){this.clear(Ac.Color.white);for(var ic=
this.innerBounds().center(),vd=0,sb=1,Xb=0;150>Xb;Xb++){var Nb=ic.addPt(Ac.Point.polar(sb,vd));this.line(ic,Nb,{color:Ac.Color.random()});ic=Nb;vd+=Math.PI/10;sb+=.3}}},{key:"rect",value:function(ic,vd){var sb=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},Xb=this.context;Xb.beginPath();Xb.rect(ic.x,ic.y,vd.x,vd.y);this.finishDraw(sb)}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"Canvas"}},{key:"properties",get:function(){return{extent:{defaultValue:Ac.pt(200,200)},
fill:{defaultValue:Ac.Color.transparent},contextType:{defaultValue:"2d"},preserveContents:{defaultValue:!0},canvasExtent:{get:function(){return this._canvas&&Ac.pt(this._canvas.width,this._canvas.height)}},canvasBounds:{readOnly:!0,get:function(){return this._canvas&&this.canvasExtent.extentAsRectangle()}},_serializedContents:{get:function(){return this.preserveContents&&this.toDataURI()},set:function(ic){var vd=this;this.withContextDo(function(){return vd.fromDataURI(ic)})}}}}}],nd,{pathInPackage:function(){return"./canvas.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.components",version:"0.1.0"}}},{start:232,end:8717})}(Ac.Morph));Ac.Canvas=Pc;Ac.Canvas=Pc}}});