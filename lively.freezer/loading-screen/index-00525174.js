System.register(["./__root_module__-7d3cbdeb.js","kld-intersections"],function(Ka){var wb,Ab,gc,Kb,Zc,Kc,md,Fc,Bc,Nc,Uc,ce,Zd,pe;return{setters:[function(Mc){wb=Mc.aY;Ab=Mc.a;gc=Mc.r;Kb=Mc.Y;Zc=Mc.p;Kc=Mc.X;md=Mc.bt;Fc=Mc.aX;Bc=Mc.i;Nc=Mc.s;Uc=Mc.bu;ce=Mc.bv;Zd=Mc.J;pe=Mc.bw},function(){}],execute:function(){function Mc(sb){try{var Ea=eval("("+Hb.ast.transform.wrapInFunction("var _; _ = ("+sb+")")+")()")}catch(ua){return JSON.parse(sb)}return"object"!==typeof Ea?null:Ea}function Kd(sb,Ea){var ua,
V,ra,ja,Ca,va,cb,hc,gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Oc){switch(Oc.nextAddress){case 1:return ua=Ea.world(),Oc.yield(ua.prompt("Enter package name",{requester:Ea,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:V=Oc.yieldResult;if(!V)throw"Canceled";Oc.setCatchFinallyBlocks(3);ja=pc.resource(V);V=ja.name();ra=ja.url;Oc.leaveTryBlock(4);break;case 3:return Oc.enterCatchBlock(),Oc.yield(sb.getConfig(),5);case 5:return Ca=Oc.yieldResult.baseURL,
va=pc.resource(Ca).join(V).asDirectory().url,Oc.yield(sb.normalize(va),6);case 6:ra=Oc.yieldResult.replace(/\/\.js$/,"/");case 4:return Oc.yield(ua.prompt("Confirm or change package location",{requester:Ea,input:ra,historyId:"lively.vm-editor-add-package-address"}),7);case 7:cb=Oc.yieldResult;if(!cb)throw"Canceled";hc=pc.resource(cb).asDirectory();gb=hc.asFile().url;return Oc.yield(sb.removePackage(gb),8);case 8:return Oc.yield(sb.resourceCreateFiles(gb,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
V+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+V+"\n\nNo description for package "+V+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+V+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Oc.return(pc.loadPackage(sb,{name:V,address:gb,configFile:hc.join("package.json").url,main:hc.join("index.js").url,test:hc.join("tests/test.js").url,type:"package"}))}})}function Jb(sb,Ea,ua){ua=void 0===ua?null:
ua;var V,ra,ja,Ca,va,cb,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:return V={name:"",address:"",type:"package"},gb.yield(sb.getConfig(),2);case 2:ra=gb.yieldResult;if(!ua){gb.jumpTo(3);break}return gb.yield(sb.getPackage(ua),4);case 4:if(ja=gb.yieldResult){gb.jumpTo(5);break}return gb.yield(sb.getPackageForModule(ua),6);case 6:ja=gb.yieldResult;case 5:Ca=ja;case 3:return gb.yield(Ea.world().prompt("What is the package directory?",{requester:Ea,
input:Ca?Ca.address:ra.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:va=gb.yieldResult;if(!va)throw"Canceled";V.address=va.replace(/\/$/,"");V.url=new pc.URL(V.address+"/");V.configFile=pc.resource(V.url).join("package.json").url;gb.setCatchFinallyBlocks(8);cb=JSON;hc=cb.parse;return gb.yield(sb.moduleRead(V.configFile),10);case 10:hc.call(cb,gb.yieldResult).name;gb.leaveTryBlock(9);break;case 8:gb.enterCatchBlock(),V.name=String(V.url).replace(/\/$/,""),sb.resourceEnsureExistance(V.configFile,
'{\n  "name": "'+V.name+'",\n  "version": "0.1.0"\n}');case 9:return gb.return(pc.loadPackage(sb,V))}})}function Dc(sb,Ea,ua){var V,ra,ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){switch(Ca.nextAddress){case 1:return V=pc.resource(ua).asFile().url,Ca.yield(sb.getPackage(V),2);case 2:if(ra=Ca.yieldResult){Ca.jumpTo(3);break}return Ca.yield(sb.getPackageForModule(V),4);case 4:ra=Ca.yieldResult;case 3:ja=ra;if(!ja)throw Error("Cannot find package for "+V);return Ca.yield(sb.reloadPackage(V),
5);case 5:if(!Ea){Ca.jumpTo(0);break}return Ca.yield(Ea.updateModuleList(),7);case 7:return Ca.yield(Ea.uiSelect(V,!1),8);case 8:return Ca.return(Ca.yieldResult)}})}function nd(sb,Ea,ua,V){var ra,ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){switch(Ca.nextAddress){case 1:return Ca.yield(sb.getPackage(ua),2);case 2:return ra=Ca.yieldResult,Ca.yield((V||$world).confirm("Unload package "+ra.name+"?",{requester:Ea}),3);case 3:ja=Ca.yieldResult;if(!ja)throw"Canceled";return Ca.yield(sb.removePackage(ua),
4);case 4:if(!Ea){Ca.jumpTo(0);break}return Ca.yield(Ea.updateModuleList(),6);case 6:return Ca.yield(Ea.uiSelect(null),0)}})}function Hc(sb,Ea,ua){var V,ra,ja,Ca,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){switch(cb.nextAddress){case 1:return V=Ea.world(),cb.yield(sb.getPackage(ua),2);case 2:return ra=cb.yieldResult,ra?cb.yield(V.confirm("Really remove package "+ra.name+"?",{requester:Ea}),3):($world.inform('No package "'+ua+'" found!',{requester:Ea}),cb.return());case 3:ja=
cb.yieldResult;if(!ja)throw"Canceled";sb.removePackage(ua);return cb.yield(V.confirm("Also remove directory "+ra.name+" including "+ra.modules.length+" modules?"),4);case 4:Ca=cb.yieldResult;if(!Ca){cb.jumpTo(0);break}return cb.yield(V.confirm("REALLY *remove* directory "+ra.name+"? No undo possible..."),6);case 6:if(va=cb.yieldResult)return cb.yield(sb.resourceRemove(ra.address),0);cb.jumpTo(0)}})}function wd(sb,Ea,ua){ua=void 0===ua?$world:ua;var V,ra,ja,Ca,va,cb,hc,gb,Oc,Cb,Gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){switch(Ec.nextAddress){case 1:return Ec.yield(sb.getPackage(Ea),
2);case 2:V=Ec.yieldResult;if(!V)throw Error("Cannot find package "+Ea);ra=[];ja=$jscomp.makeIterator(V.modules);Ca=ja.next();case 3:if(Ca.done)return Ec.yield(ua.execCommand("open text window",{title:"imports and exports of "+Ea,content:ra.join("\n\n")}),0);va=Ca.value;if(!va.name.match(/\.js$/)){Ec.jumpTo(4);break}Ec.setCatchFinallyBlocks(6);cb=sb;hc=cb.importsAndExportsOf;gb=va.name;return Ec.yield(sb.moduleRead(va.name),9);case 9:return Ec.yield(hc.call(cb,gb,Ec.yieldResult),8);case 8:Oc=Ec.yieldResult;
Ec.leaveTryBlock(7);break;case 6:Cb=Ec.enterCatchBlock();ua.logError(Error("Error when getting imports/exports from module "+va.name+":\n"+Cb.stack));Ec.jumpTo(4);break;case 7:Gd=""+va.name;if(!Oc.imports.length&&!Oc.exports.length){Gd+="\n  does not import / export anything";Ec.jumpTo(4);break}Oc.imports.length&&(Gd+="\n  imports:\n",Gd+=pc.arr.groupByKey(Oc.imports,"fromModule").mapGroups(function(oc,rb){return"from "+oc+": "+rb.map(function(Md){return Md.local||Md.imported?Md.imported&&Md.imported!==
Md.local?Md.imported+" as "+Md.local:Md.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(oc){return"    "+oc}).join("\n"));Oc.exports.length&&(Gd+="\n  exports:\n",Gd+=Oc.exports.map(function(oc){return oc.local?oc.local&&oc.local!==oc.exported?oc.local+" as "+oc.exported:oc.exported:oc.exported+" from "+oc.fromModule}).join(", ").split("\n").map(function(oc){return"    "+oc}).join("\n"));ra.push(Gd);case 4:Ca=ja.next(),Ec.jumpTo(3)}})}function Qd(sb){return sb.match(/import.*['"]mocha(-es6)?['"]/)&&
sb.match(/it\(['"]/)}function Eb(sb,Ea,ua){ua=ua&&ua.address;if(ua&&0===Ea.indexOf(ua))var V=Ea.slice(ua.length).replace(/^\//,"");else a:{ua=sb.getConfig();if(!ua||ua.constructor!==Promise)try{V=String((new Ma.URL(Ea)).relativePathFrom(new Ma.URL(sb.getConfig().baseURL)));break a}catch(ra){}V=Ea}return V}function ic(sb,Ea,ua,V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return 1==ra.nextAddress?(V=Object.assign({targetModule:Ea},V),ra.yield(sb.normalize(Ea),2)):3!=ra.nextAddress?
(Ea=ra.yieldResult,ra.yield(sb.moduleSourceChange(Ea,ua,V),3)):ra.return(Ea)})}function jd(sb,Ea,ua,V,ra){V=void 0===V?!1:V;ra=void 0===ra?!1:ra;var ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){switch(Ca.nextAddress){case 1:return Ea&&Ea.setStatusMessage("Reloading "+ua),Ca.setCatchFinallyBlocks(2),Ca.yield(sb.reloadModule(ua,{reloadDeps:V,resetEnv:ra}),4);case 4:if(!Ea){Ca.jumpTo(5);break}return Ca.yield(Ea.updateModuleList(),6);case 6:case 5:Ea&&Ea.setStatusMessage("Reloded "+
ua);Ca.leaveTryBlock(0);break;case 2:ja=Ca.enterCatchBlock();Ca.setCatchFinallyBlocks(7);if(!Ea){Ca.jumpTo(9);break}return Ca.yield(Ea.updateEditorWithSourceOf(ua),10);case 10:case 9:Ca.leaveTryBlock(8);break;case 7:Ca.enterCatchBlock();case 8:throw Ea&&Ea.showError(ja),ja;}})}function jc(sb,Ea,ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){switch(V.nextAddress){case 1:return V.yield(sb.forgetModule(ua,{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!Ea){V.jumpTo(3);break}return V.yield(Ea.updateModuleList(),
4);case 4:case 3:V.jumpToEnd()}})}function kd(sb,Ea,ua){var V,ra,ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){switch(Ca.nextAddress){case 1:return Ca.yield(sb.normalize(ua),2);case 2:return V=Ca.yieldResult,Ca.yield(Ea.world().confirm(["Really remove file:\n",{},V,{fontStyle:"italic",fontWeight:"bold"}," ?",{}],{requester:Ea,lineWrapping:!1}),3);case 3:ra=Ca.yieldResult;if(!ra)throw"Canceled";return Ca.yield(sb.forgetModule(V),4);case 4:return Ca.yield(sb.resourceRemove(V),5);
case 5:return Ca.yield(sb.getPackageForModule(V),6);case 6:return ja=Ca.yieldResult,Ca.return(ja)}})}function vb(sb,Ea){var ua,V,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){if(1==ja.nextAddress)return ja.yield(Ma._createAndLoadModules(sb,[Ea]),2);ua=ja.yieldResult;V=Ma.arr.compact(ua.map(function(Ca){return Ca.error}));ra=!!V.length;return ja.return(ra)})}function db(sb,Ea,ua){var V,ra,ja,Ca,va,cb,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:return V=
Ma.URL,gb.yield(sb.getConfig(),2);case 2:ra=new V(gb.yieldResult.baseURL);ja=Ea.world();if(!ua){gb.jumpTo(3);break}return gb.yield(sb.getPackage(ua),4);case 4:if(Ca=gb.yieldResult){gb.jumpTo(5);break}return gb.yield(sb.getPackageForModule(ua),6);case 6:Ca=gb.yieldResult;case 5:(va=Ca)&&(ra=new Ma.URL(va.address));case 3:return gb.yield(Ma._searchForExistingFiles(Ea,String(ra),va),7);case 7:cb=gb.yieldResult;if(!cb.includes("[create new module]")){gb.jumpTo(8);break}return gb.yield(Ma._askForModuleName(sb,
ua||String(ra),ja),9);case 9:hc=gb.yieldResult,cb=[hc];case 8:return gb.yield(Ma._createAndLoadModules(sb,cb),10);case 10:return gb.return(gb.yieldResult)}})}function ec(sb,Ea){var ua,V,ra,ja,Ca,va,cb,hc,gb,Oc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Cb){if(1==Cb.nextAddress)return Cb.yield(sb.getPackage(Ea),2);if(3!=Cb.nextAddress){ua=Cb.yieldResult;if(!ua||!ua.address.match(/^http/))throw Error("Cannot load package "+Ea);V=Ma.resource(ua.address);ra=[];ja=$jscomp;Ca=ja.makeIterator;
return Cb.yield(V.dirList(5,{exclude:Ma.modulesInPackage_defaultExclude}),3)}va=Ca.call(ja,Cb.yieldResult);for(cb=va.next();!cb.done;cb=va.next())gb=hc=cb.value,Oc=gb.url,Oc.match(/\.js$/)&&sb.isModuleLoaded(Oc,!0)&&ra.push(sb.getModule(Oc));return Cb.return(ra)})}function Mb(sb){sb||(sb="local");if(sb.isSystemInterface)var Ea=sb;else"string"===typeof sb&&sb.startsWith("l2l ")&&(sb={type:"l2l",id:sb.split(" ")[1]}),"string"!==typeof sb&&"l2l"===sb.type&&(Ea=Fb.l2lInterfaceFor(sb.id,sb.info)),"string"!==
typeof sb&&($world.setStatusMessage("Unknown system interface "+sb),sb="local"),Ea||(Ea=sb&&"local"!==sb?Fb.serverInterfaceFor(sb):Fb.localInterface);return Ea}Ka("systemInterfaceNamed",Mb);var Hb=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");Hb.parseJsonLikeObj=Mc;Hb.ast=wb;Hb.parseJsonLikeObj=Mc;Hb.parseJsonLikeObj=Mc;var pc=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");pc.loadPackage=function(sb,Ea){var ua,V;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){switch(ra.nextAddress){case 1:return ra.yield(sb.importPackage(Ea.address+
"/"),2);case 2:if(!Ea.main){ra.jumpTo(3);break}return ra.yield(sb.importModule(Ea.main.toString()),3);case 3:if(!Ea.test){ra.jumpTo(5);break}ra.setCatchFinallyBlocks(6);return ra.yield(sb.importPackage("mocha-es6"),8);case 8:return ua=ra.yieldResult,ra.yield(ua.installSystemInstantiateHook(),9);case 9:return ra.yield(sb.importModule(Ea.test.toString()),10);case 10:ra.leaveTryBlock(5);break;case 6:V=ra.enterCatchBlock(),console.warn("Cannot load test of new package: "+V);case 5:return ra.return(sb.getPackage(Ea.address))}})};
pc.interactivelyCreatePackage=Kd;pc.interactivelyLoadPackage=Jb;pc.interactivelyReloadPackage=Dc;pc.interactivelyUnloadPackage=nd;pc.interactivelyRemovePackage=Hc;pc.showExportsAndImportsOf=wd;pc.parseJsonLikeObj=Mc;pc.arr=Ab;pc.resource=gc;pc.interactivelyCreatePackage=Kd;pc.interactivelyCreatePackage=Kd;pc.interactivelyLoadPackage=Jb;pc.interactivelyLoadPackage=Jb;pc.interactivelyReloadPackage=Dc;pc.interactivelyReloadPackage=Dc;pc.interactivelyUnloadPackage=nd;pc.interactivelyUnloadPackage=nd;
pc.interactivelyRemovePackage=Hc;pc.interactivelyRemovePackage=Hc;pc.showExportsAndImportsOf=wd;pc.showExportsAndImportsOf=wd;var Ma=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");Ma.isTestModule=Qd;Ma.shortModuleName=Eb;Ma.interactivelyChangeModule=ic;Ma.interactivelyReloadModule=jd;Ma.interactivelyUnloadModule=jc;Ma.interactivelyRemoveModule=kd;Ma.addModule=vb;Ma.interactivelyAddModule=db;Ma._askForModuleName=function(sb,Ea,ua){var V,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){switch(ja.nextAddress){case 1:return ja.yield(ua.prompt("Enter module name",
{input:Ea,historyId:"lively.vm-editor-add-module-name"}),2);case 2:Ea=ja.yieldResult;if(!Ea)throw"Canceled";return ja.yield(sb.normalize(Ea),3);case 3:return V=ja.yieldResult,ja.yield(ua.confirm(["Create module \n",{},V,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:ra=ja.yieldResult;if(!ra)throw"Canceled";return ja.return(V)}})};Ma._searchForExistingFiles=function(sb,Ea,ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(V){return String(Ea).match(/^http/)?V.return(Ma._searchForExistingFilesWeb(sb,
Ea,ua)):V.return(Ma._searchForExistingFilesManually(sb,Ea,ua))})};Ma._searchForExistingFilesManually=function(sb,Ea,ua){var V,ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){switch(ja.nextAddress){case 1:return ja.yield(sb.world().multipleChoicePrompt("Add Module",{requester:sb,choices:["Create New Module","Load Existing Module"]}),2);case 2:V=ja.yieldResult;if("Create New Module"===V)return ja.return("[create new module]");if("Load Existing Module"!==V){ja.jumpTo(3);break}return ja.yield(sb.world().prompt("URL of module?",
{input:Ea,requester:sb,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),4);case 4:if(ra=ja.yieldResult)return ja.return([ra]);case 3:throw"Canceled";}})};Ma._searchForExistingFilesWeb=function(sb,Ea,ua){function V(gb){gb.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(gb.name())||ua&&Ma.arr.pluck(ua.modules,"name").includes(gb.url)?!0:!1}var ra,ja,Ca,va,cb,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:return(ra=
sb.world())&&(ja=ra.showLoadingIndicatorFor(sb,"Loading existing modules...")),gb.yield(Ma.resource(Ea).dirList(5,{exclude:V}),3);case 3:return gb.yield(gb.yieldResult.map(function(Oc){return Oc.url}),2);case 2:return Ca=gb.yieldResult,va=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Ca.filter(function(Oc){return Oc.endsWith(".js")}).map(function(Oc){return{isListItem:!0,string:ua&&0==Oc.indexOf(ua.address)?ua.name+Oc.slice(ua.address.length):Oc,value:Oc}})),gb.yield(Promise.resolve(ja&&
ja.remove()).then(function(){return sb.world().filterableListPrompt("What module to load?",va,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:sb},sb?{extent:sb.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:cb=gb.yieldResult;if(!cb||"canceled"===cb.status||!cb.selected.length)throw"Canceled";hc=cb.selected||cb;Array.isArray(hc)||(hc=[hc]);return gb.return(hc)}})};Ma._createAndLoadModules=function(sb,Ea){var ua,V,ra,ja,Ca,va,cb,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:Array.isArray(Ea)||
(Ea=[Ea]),ua=[],V=$jscomp.makeIterator(Ea),ra=V.next();case 2:if(ra.done){gb.jumpTo(4);break}ja=ra.value;return gb.yield(sb.forgetModule(ja,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return gb.yield(sb.resourceEnsureExistance(ja,'"format esm";\n'),6);case 6:return Ca=gb.yieldResult,va=Ma,cb=va.isTestModule,gb.yield(Ca.read(),7);case 7:if(!cb.call(va,gb.yieldResult)){gb.jumpTo(8);break}if(System.global.Mocha&&System.global.chai){gb.jumpTo(8);break}return gb.yield(System.import("mocha-es6"),10);case 10:return gb.yield(Ma.promise.waitFor(function(){return!!System.global.Mocha&&
!!System.global.chai}),8);case 8:return gb.setCatchFinallyBlocks(12),gb.yield(sb.importModule(ja),14);case 14:ua.push({name:ja});gb.leaveTryBlock(3);break;case 12:hc=gb.enterCatchBlock(),ua.push({name:ja,error:hc});case 3:ra=V.next();gb.jumpTo(2);break;case 4:return gb.return(ua)}})};Ma.modulesInPackage_defaultExclude=function(sb){return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(sb.name())?!0:!1};Ma.modulesInPackage=ec;Ma.obj=Kb;Ma.promise=Zc;Ma.arr=Ab;Ma.resource=
gc;Ma.isTestModule=Qd;Ma.isTestModule=Qd;Ma.shortModuleName=Eb;Ma.shortModuleName=Eb;Ma.interactivelyChangeModule=ic;Ma.interactivelyChangeModule=ic;Ma.interactivelyReloadModule=jd;Ma.interactivelyReloadModule=jd;Ma.interactivelyUnloadModule=jc;Ma.interactivelyUnloadModule=jc;Ma.interactivelyRemoveModule=kd;Ma.interactivelyRemoveModule=kd;Ma.addModule=vb;Ma.addModule=vb;Ma.interactivelyAddModule=db;Ma.interactivelyAddModule=db;Ma.modulesInPackage=ec;Ma.modulesInPackage=ec;var Ib=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");
Ib.todo=function(sb){throw Error(sb+" is not yet implemented!");};Ib.parseJsonLikeObj=Mc;Ib.arr=Ab;Ib.Closure=Kc;Ib.obj=Kb;Ib.resource=gc;Ib.transform=md;Ib.modules=Fc;var pb=function(sb){var Ea=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),ua=Ea.hasOwnProperty("AbstractCoreInterface")&&"function"===typeof Ea.AbstractCoreInterface?Ea.AbstractCoreInterface:Ea.AbstractCoreInterface=function(V){V&&V[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Bc(ua,sb,[{key:"dynamicCompletionsForPrefix",value:function(V,ra,ja){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){Ib.todo("dynamicCompletionsForPrefix");Ca.jumpToEnd()})}},{key:"runEval",value:function(V,ra){Ib.todo("runEval")}},{key:"resourceExists",value:function(V){Ib.todo("resourceExists")}},{key:"resourceEnsureExistance",value:function(V,ra){Ib.todo("resourceEnsureExistance")}},{key:"resourceMkdir",value:function(V){Ib.todo("resourceMkdir")}},{key:"resourceRead",
value:function(V){Ib.todo("resourceRead")}},{key:"resourceRemove",value:function(V){Ib.todo("resourceRemove")}},{key:"resourceWrite",value:function(V,ra){Ib.todo("resourceWrite")}},{key:"resourceCreateFiles",value:function(V,ra){Ib.todo("resourceCreateFiles")}},{key:"resourceDirList",value:function(V,ra,ja){Ib.todo("resourceDirList")}},{key:"normalizeSync",value:function(V,ra,ja){Ib.todo("normalizeSync")}},{key:"normalize",value:function(V,ra,ja){Ib.todo("normalize")}},{key:"printSystemConfig",value:function(){Ib.todo("printSystemConfig")}},
{key:"getConfig",value:function(){Ib.todo("getConfig")}},{key:"setConfig",value:function(V){Ib.todo("setConfig")}},{key:"getPackages",value:function(V){Ib.todo("getPackages")}},{key:"isModuleLoaded",value:function(V,ra){Ib.todo("isModuleLoaded")}},{key:"doesModuleExist",value:function(V,ra){Ib.todo("doesModuleExist")}},{key:"getModules",value:function(){var V=this,ra,ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){return 1==Ca.nextAddress?(ra=Ib.arr,ja=ra.flatmap,Ca.yield(V.getPackages(),
2)):Ca.return(ja.call(ra,Ca.yieldResult,function(va){return va.modules}))})}},{key:"getModule",value:function(V){var ra=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){return 1==ja.nextAddress?ja.yield(ra.getModules(),2):ja.return(ja.yieldResult.find(function(Ca){return Ca.name===V}))})}},{key:"getPackage",value:function(V){var ra=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){return 1==ja.nextAddress?(V=V.replace(/\/+$/,""),ja.yield(ra.getPackages(),2)):
ja.return(ja.yieldResult.find(function(Ca){return Ca.address===V||Ca.name===V}))})}},{key:"getPackageForModule",value:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){Ib.todo("getPackageForModule");ra.jumpToEnd()})}},{key:"systemConfChange",value:function(V){var ra=Ib.parseJsonLikeObj(V);["baseURL"].forEach(function(ja){return delete ra[ja]});return this.setConfig(ra)}},{key:"resourcesOfPackage",value:function(V,ra){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){Ib.todo("resourcesOfPackage");
ja.jumpToEnd()})}},{key:"registerPackage",value:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){Ib.todo("registerPackage");ra.jumpToEnd()})}},{key:"importPackage",value:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){Ib.todo("importPackage");ra.jumpToEnd()})}},{key:"removePackage",value:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){Ib.todo("removePackage");ra.jumpToEnd()})}},{key:"reloadPackage",value:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){Ib.todo("reloadPackage");
ra.jumpToEnd()})}},{key:"packageConfChange",value:function(V,ra){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){Ib.todo("packageConfChange");ja.jumpToEnd()})}},{key:"importModule",value:function(V){Ib.todo("importModule")}},{key:"forgetModule",value:function(V,ra){Ib.todo("forgetModule")}},{key:"reloadModule",value:function(V,ra){Ib.todo("reloadModule")}},{key:"moduleFormat",value:function(V){Ib.todo("moduleFormat")}},{key:"moduleRead",value:function(V){Ib.todo("moduleRead")}},{key:"moduleSourceChange",
value:function(V,ra,ja){Ib.todo("moduleSourceChange")}},{key:"importsAndExportsOf",value:function(V,ra){Ib.todo("importsAndExportsOf")}},{key:"keyValueListOfVariablesInModule",value:function(V,ra){Ib.todo("keyValueListOfVariablesInModule")}},{key:"moduleWrite",value:function(V,ra){return this.moduleSourceChange(V,ra)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"AbstractCoreInterface"}}],Ea,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:327,end:3944})}(void 0);Ib.AbstractCoreInterface=pb;Ib.AbstractCoreInterface=pb;Ib.AbstractCoreInterface=pb;var Ub=function(sb){var Ea=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js"),ua=Ea.hasOwnProperty("RemoteCoreInterface")&&"function"===typeof Ea.RemoteCoreInterface?Ea.RemoteCoreInterface:Ea.RemoteCoreInterface=
function(V){V&&V[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Bc(ua,sb,[{key:Symbol.for("lively-instance-initialize"),value:function(){Bc._get(Object.getPrototypeOf(ua.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null}},{key:"runEval",value:function(V,ra){throw Error("Not yet implemented");}},{key:"runEvalAndStringify",value:function(V,ra){var ja=this;return this.currentEval?this.currentEval.then(function(){return ja.runEvalAndStringify(V,
ra)}):this.currentEval=Promise.resolve().then(function(){var Ca,va,cb,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){switch(gb.nextAddress){case 1:return gb.yield(ja.runEval("\n        Promise.resolve((async "+Ib.transform.wrapInFunction(V)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},ra)),2);case 2:if((Ca=gb.yieldResult)&&Ca.isError)throw Error(String(Ca.value||Ca.error));if(!Ca||!Ca.value)return gb.return(null);if(va=Ca.promisedValue){gb.jumpTo(3);break}return gb.yield(Ca.value,4);case 4:va=gb.yieldResult;case 3:cb=va;if(!cb)return gb.return();if("undefined"===cb)return gb.return(void 0);if("null"===cb)return gb.return(null);if("true"===cb)return gb.return(!0);
if("false"===cb)return gb.return(!1);try{hc=JSON.parse(cb)}catch(Oc){return gb.return(cb)}if(hc&&hc.isError)throw Error(String(hc.value));return gb.return(hc)}})}).then(function(Ca){delete ja.currentEval;return Ca},function(Ca){delete ja.currentEval;return Promise.reject(Ca)})}},{key:"dynamicCompletionsForPrefix",value:function(V,ra,ja){var Ca=this,va,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hc){va=Ib.obj.isString(ja.context)?ja.context:!1;ja=Ib.obj.dissoc(ja,["systemInterface",
"System","context"]);cb="\n      var prefix = "+JSON.stringify(ra)+",\n          opts = "+JSON.stringify(ja)+";\n      opts.context = "+va+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return hc.return(Ca.runEvalAndStringify(cb))})}},{key:"evalWithResource",value:function(V,ra,ja){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+V+'").'+ra+"("+(ja?JSON.stringify(ja):"")+");\n    ")}},{key:"resourceExists",value:function(V){return this.evalWithResource(V,"exists")}},{key:"resourceEnsureExistance",value:function(V,ra){return this.evalWithResource(V,
"ensureExistance",ra)}},{key:"resourceMkdir",value:function(V){return this.evalWithResource(V,"mkdir")}},{key:"resourceRead",value:function(V){return this.evalWithResource(V,"read")}},{key:"resourceRemove",value:function(V){return this.evalWithResource(V,"remove")}},{key:"resourceWrite",value:function(V,ra){return this.evalWithResource(V,"write",ra)}},{key:"resourceCreateFiles",value:function(V,ra){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
V+'", '+JSON.stringify(ra)+")")}},{key:"resourceDirList",value:function(V,ra,ja){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+V+'").dirList('+JSON.stringify(ra)+", "+JSON.stringify(ja)+"))\n        .map(({url}) => ({url}))")}},{key:"livelySystemAccessor",value:function(V){V=void 0===V?"livelySystem":V;return"var "+V+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
V+') throw new Error("lively-system-interface not available!");'}},{key:"normalizeSync",value:function(V,ra,ja){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(V)+", "+JSON.stringify(ra)+", "+ja+")")}},{key:"normalize",value:function(V,ra,ja){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(V)+", "+JSON.stringify(ra)+", "+JSON.stringify(ja)+")")}},{key:"printSystemConfig",value:function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")}},
{key:"getConfig",value:function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')}},{key:"setConfig",value:function(V){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(V)+")")}},{key:"getPackages",value:function(V){V=Object.assign({excluded:[]},V);V.excluded=V.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(V)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')}},{key:"getPackageForModule",value:function(V){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(V)+")")}},{key:"isModuleLoaded",value:function(V,ra){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+V+'", '+ra+")")}},{key:"doesModuleExist",value:function(V,ra){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+V+'", '+ra+")")}},{key:"registerPackage",value:function(V){var ra=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){return ja.return(ra.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(V)+")"))})}},{key:"importPackage",
value:function(V){var ra=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){return ja.return(ra.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(V)+")"))})}},{key:"removePackage",value:function(V){var ra=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){return ja.return(ra.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(V)+")"))})}},{key:"reloadPackage",value:function(V,ra){var ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){return Ca.return(ja.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(V)+", "+JSON.stringify(ra)+")"))})}},{key:"packageConfChange",value:function(V,ra){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(V)+", "+JSON.stringify(ra)+")")}},{key:"resourcesOfPackage",value:function(V,ra){ra=void 0===ra?[".git","node_modules",".module_cache","lively.next-node_modules"]:ra;var ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){V.address&&
(V=V.address);return Ca.return(ja.runEvalAndStringify("\n      "+ja.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(V)+", "+JSON.stringify(ra)+");"))})}},{key:"getModule",value:function(V){var ra=this,ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){if(1==Ca.nextAddress)return Ca.yield(ra.getModules(),2);ja=Ca.yieldResult.find(function(va){return va.name===V});return Ca.return(ja?Ib.modules.module(ja.name):null)})}},{key:"importModule",
value:function(V){return this.runEvalAndStringify("lively.modules.System.import("+JSON.stringify(V)+")")}},{key:"forgetModule",value:function(V,ra){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(V)+").unload("+JSON.stringify(ra)+")")}},{key:"reloadModule",value:function(V,ra){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(V)+").reload("+JSON.stringify(ra)+")")}},{key:"moduleFormat",value:function(V){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(V)+").format();")}},{key:"moduleRead",value:function(V){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(V)+").source()")}},{key:"moduleSourceChange",value:function(V,ra,ja){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(V)+").changeSource("+JSON.stringify(ra)+", "+JSON.stringify(ja)+")")}},{key:"keyValueListOfVariablesInModule",value:function(V,ra){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+
JSON.stringify(V)+", "+JSON.stringify(ra)+")")}},{key:"importsAndExportsOf",value:function(V,ra){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(V)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(V)+").exports()})")}},{key:"exportsOfModules",value:function(V){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(V)+";\n      options.excludedPackages = ["+V.excludedPackages.map(function(ra){return"function"===
typeof ra?ra.toString():JSON.stringify(ra)}).join(",")+"]\n      await livelySystem.localInterface.exportsOfModules(options)")}},{key:"searchInPackage",value:function(V,ra,ja){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(V)+", "+JSON.stringify(ra)+", "+JSON.stringify(ja)+")")}},{key:"loadMochaTestFile",value:function(V,ra){ra=void 0===ra?[]:ra;var ja=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){return Ca.return(ja.runEvalAndStringify("\n      "+
ja.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(V)+", "+JSON.stringify(ra)+"), result;\n      result = {testsByFile}"))})}},{key:"runMochaTests",value:function(V,ra,ja,Ca){var va=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){V&&V instanceof RegExp&&(V={isRegExp:!0,value:String(V).replace(/^\/|\/$/g,"")});return cb.return(va.runEvalAndStringify("\n      var grep = "+JSON.stringify(V)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
va.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(ra||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RemoteCoreInterface"}}],Ea,{pathInPackage:function(){return"interfaces/interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:3953,end:16249})}(Ib.AbstractCoreInterface);Ib.RemoteCoreInterface=Ub;Ib.RemoteCoreInterface=Ub;Ib.RemoteCoreInterface=Ub;var dc=
lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");dc.obj=Kb;dc.string=Nc;dc.arr=Ab;dc.resource=gc;dc.createFiles=Uc;dc.ast=wb;dc.modules=Fc;dc.vm=ce;dc.parseJsonLikeObj=Mc;dc.AbstractCoreInterface=pb;dc.classToFunctionTransform=Zd;pb=function(sb){var Ea=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js"),ua=Ea.hasOwnProperty("LocalCoreInterface")&&"function"===typeof Ea.LocalCoreInterface?Ea.LocalCoreInterface:Ea.LocalCoreInterface=
function(V){V&&V[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Bc(ua,sb,[{key:"name",get:function(){return"local"}},{key:"dynamicCompletionsForPrefix",value:function(V,ra,ja){var Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==va.nextAddress)return va.yield(dc.vm.completions.getCompletions(function(cb){return dc.vm.runEval(cb.replace("return ",""),Object.assign({targetModule:V,classTransform:dc.classToFunctionTransform},
ja))},ra),2);Ca=va.yieldResult;if(Ca.isError)throw Ca.value;return va.return({completions:Ca.completions,prefix:Ca.startLetters})})}},{key:"runEval",value:function(V,ra){return dc.vm.runEval(V,Object.assign({classTransform:dc.classToFunctionTransform},ra))}},{key:"resourceExists",value:function(V){return dc.resource(V).exists()}},{key:"resourceEnsureExistance",value:function(V,ra){return dc.resource(V).ensureExistance(ra)}},{key:"resourceMkdir",value:function(V){return dc.resource(V).mkdir()}},{key:"resourceRead",
value:function(V){return dc.resource(V).read()}},{key:"resourceRemove",value:function(V){return dc.resource(V).remove()}},{key:"resourceWrite",value:function(V,ra){return dc.resource(V).write(ra)}},{key:"resourceCreateFiles",value:function(V,ra){return dc.createFiles(V,ra)}},{key:"resourceDirList",value:function(V,ra,ja){return dc.resource(V).dirList(ra,ja)}},{key:"normalizeSync",value:function(V,ra,ja){return System.decanonicalize(V,ra,ja)}},{key:"normalize",value:function(V,ra,ja){return System.normalize(V,
ra,ja)}},{key:"printSystemConfig",value:function(){return dc.modules.printSystemConfig()}},{key:"getConfig",value:function(){return System.getConfig()}},{key:"setConfig",value:function(V){dc.modules.System.config(V)}},{key:"getPackages",value:function(V){V=Object.assign({},V);V=void 0===V.excluded?[]:V.excluded;var ra=V.filter(function(Ca){return"string"===typeof Ca}),ja=V.filter(function(Ca){return"function"===typeof Ca});ra=ra.concat(ra.map(function(Ca){return System.decanonicalize(Ca.replace(/\/?$/,
"/")).replace(/\/$/,"")}));return dc.modules.getPackages().filter(function(Ca){return!ra.includes(Ca.url)&&!ja.some(function(va){return va(Ca.url)})})}},{key:"registerPackage",value:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return ra.return(dc.modules.registerPackage(V))})}},{key:"importPackage",value:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return ra.return(dc.modules.importPackage(V))})}},{key:"removePackage",value:function(V){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ra){return ra.return(dc.modules.removePackage(V))})}},
{key:"reloadPackage",value:function(V,ra){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ja){return ja.return(dc.modules.reloadPackage(V,ra))})}},{key:"packageConfChange",value:function(V,ra){var ja=this,Ca,va,cb,hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gb){if(1==gb.nextAddress)return Ca=dc.modules.System,va=dc.parseJsonLikeObj(V),cb=JSON.stringify(va,null,2),gb.yield(dc.modules.module(ra).changeSource(cb,{doEval:!1}),2);if(3!=gb.nextAddress)return Ca.set(ra,Ca.newModule(va)),
gb.yield(ja.getPackageForModule(ra),3);(hc=gb.yieldResult)&&dc.modules.applyPackageConfig(va,hc.address);gb.jumpToEnd()})}},{key:"resourcesOfPackage",value:function(V,ra){ra=void 0===ra?[".git","node_modules",".module_cache"]:ra;var ja,Ca,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){if(1==cb.nextAddress)return cb.setCatchFinallyBlocks(2),ja=V.address?V.address:V,Ca=dc.modules.getPackage(ja),cb.yield(Ca.resources(void 0,ra),4);if(2!=cb.nextAddress)return cb.return(cb.yieldResult.map(function(hc){return Object.assign(hc,
{package:hc.package.url})}));va=cb.enterCatchBlock();console.warn("resourcesOfPackage error for "+V+": "+va);return cb.return([])})}},{key:"getPackageForModule",value:function(V){return(V=dc.modules.getPackageOfModule(V))?V.asSpec():V}},{key:"isModuleLoaded",value:function(V,ra){return dc.modules.isModuleLoaded(V,ra)}},{key:"doesModuleExist",value:function(V,ra){return dc.modules.isModuleLoaded(V,ra)}},{key:"getModule",value:function(V){return dc.modules.module(V)}},{key:"importModule",value:function(V){return dc.modules.System.import(V)}},
{key:"forgetModule",value:function(V,ra){return dc.modules.module(V).unload(ra)}},{key:"reloadModule",value:function(V,ra){return dc.modules.module(V).reload(ra)}},{key:"moduleFormat",value:function(V){return dc.modules.module(V).format()}},{key:"moduleRead",value:function(V){return dc.modules.module(V).source()}},{key:"moduleSourceChange",value:function(V,ra,ja){return dc.modules.module(V).changeSource(ra,ja)}},{key:"keyValueListOfVariablesInModule",value:function(V,ra){var ja=this,Ca,va,cb,hc,gb,
Oc,Cb,Gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){switch(Ec.nextAddress){case 1:if(ra){Ec.jumpTo(2);break}return Ec.yield(ja.resourceRead(V),3);case 3:ra=Ec.yieldResult;case 2:return Ca="string"===typeof ra?dc.ast.parse(ra):ra,va=ja.normalizeSync(V),ja.moduleFormat(va),cb=dc.modules.module(va).env().recorder,Ec.yield(ja.importsAndExportsOf(va,Ca),4);case 4:return hc=Ec.yieldResult,gb=dc.ast.query.topLevelDeclsAndRefs(Ca),Oc=dc.arr.sortByKey(dc.ast.query.declarationsOfScope(gb.scope,
!0),"start"),Cb=dc.arr.pluck(gb.scope.importSpecifiers,"name"),Gd=0,Ec.return(Oc.map(function(oc){var rb=oc.name.length,Md=hc.exports.find(function(qb){return qb.local===oc.name}),yb=dc.arr.include(Cb,oc.name);Md&&(rb+=9);yb&&(rb+=9);Gd=Math.max(Gd,rb);return{isExport:Md,isImport:yb,name:oc.name,value:cb[oc.name],node:oc,printedName:oc.name+(Md?" [export]":"")+(yb?" [import]":""),printedValue:dc.obj.inspect(cb[oc.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(oc){return{isListItem:!0,value:oc,
string:oc.printedName+dc.string.indent(" = "+oc.printedValue," ",Gd-oc.printedName.length)}}))}})}},{key:"importsAndExportsOf",value:function(V,ra){var ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ca){return 1==Ca.nextAddress?Ca.yield(dc.modules.module(V).imports(ra),2):3!=Ca.nextAddress?(ja=Ca.yieldResult,Ca.yield(dc.modules.module(V).exports(ra),3)):Ca.return({imports:ja,exports:Ca.yieldResult})})}},{key:"exportsOfModules",value:function(V){return dc.modules.ExportLookup.run(System,
V)}},{key:"searchInPackage",value:function(V,ra,ja){return dc.modules.getPackage(V).search(ra,ja)}},{key:"runMochaTests",value:function(V,ra,ja,Ca){var va,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hc){if(1==hc.nextAddress)return hc.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);va=hc.yieldResult;cb=va.runMochaTests;return hc.return(cb(V,ra,ja,Ca))})}},{key:"loadMochaTestFile",value:function(V,ra){var ja,Ca;return $jscomp.asyncExecutePromiseGeneratorProgram(function(va){if(1==
va.nextAddress)return va.yield(System.import("lively-system-interface/commands/mocha-tests.js"),2);ja=va.yieldResult;Ca=ja.loadMochaTestFile;return va.return(Ca(V,ra))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LocalCoreInterface"}}],Ea,{pathInPackage:function(){return"interfaces/local-system.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",
version:"0.2.1"}}},{start:411,end:8203})}(dc.AbstractCoreInterface);dc.LocalCoreInterface=pb;dc.LocalCoreInterface=pb;dc.LocalCoreInterface=pb;var vc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");vc.evalStrategies=pe;vc.RemoteCoreInterface=Ub;var gd=function(sb){var Ea=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js"),ua=Ea.hasOwnProperty("HTTPCoreInterface")&&"function"===typeof Ea.HTTPCoreInterface?Ea.HTTPCoreInterface:
Ea.HTTPCoreInterface=function(V){V&&V[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Bc(ua,sb,[{key:Symbol.for("lively-instance-initialize"),value:function(V){Bc._get(Object.getPrototypeOf(ua.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.currentEval=null;this.url=V;this.server=new vc.evalStrategies.HttpEvalStrategy(V)}},{key:"name",get:function(){return this.url}},{key:"description",get:function(){return this.url.replace(/^https?:\/\//,
"")}},{key:"runEval",value:function(V,ra){return this.server.runEval(V,ra)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"HTTPCoreInterface"}}],Ea,{pathInPackage:function(){return"interfaces/http-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:512})}(vc.RemoteCoreInterface);vc.HTTPCoreInterface=
gd;vc.HTTPCoreInterface=gd;vc.HTTPCoreInterface=gd;var Nb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");Nb.evalStrategies=pe;Nb.RemoteCoreInterface=Ub;Ub=function(sb){var Ea=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js"),ua=Ea.hasOwnProperty("L2LCoreInterface")&&"function"===typeof Ea.L2LCoreInterface?Ea.L2LCoreInterface:Ea.L2LCoreInterface=function(V){V&&V[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Bc(ua,sb,[{key:Symbol.for("lively-instance-initialize"),value:function(V,ra){Bc._get(Object.getPrototypeOf(ua.prototype),Symbol.for("lively-instance-initialize"),this).call(this);this.targetId=V;this.peer=ra}},{key:"name",get:function(){return"l2l "+this.targetId}},{key:"description",get:function(){var V=this.peer,ra="l2l "+this.targetId.slice(0,5);if(V){var ja=V.location,Ca=V.type,va=V.user;V=V.world;Ca&&(ra+=", "+Ca);ja&&(ra+=", "+ja.replace(/^https?:\/\//,"")+(V?"/"+V:""));va&&
(ra+=", "+va.name)}return ra}},{key:"client",get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}},{key:"isConnected",value:function(){var V=this,ra,ja,Ca,va,cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hc){if(1==hc.nextAddress)return ra=V,ja=ra.client,Ca=ra.targetId,hc.yield(ja.sendToAndWait(ja.trackerId,"getClients",{}),2);va=hc.yieldResult;cb=va.data;return hc.return(cb.some(function(gb){gb=$jscomp.makeIterator(gb).next().value;
return Ca===gb}))})}},{key:"runEval",value:function(V,ra){var ja=this,Ca,va;return $jscomp.asyncExecutePromiseGeneratorProgram(function(cb){Ca=ja.client;if(!Ca)throw Error("No lively.2lively default client available!");va=new Nb.evalStrategies.L2LEvalStrategy(Ca,ja.targetId);return cb.return(va.runEval(V,ra))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"L2LCoreInterface"}}],Ea,{pathInPackage:function(){return"interfaces/l2l-interface.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:106,end:1449})}(Nb.RemoteCoreInterface);Nb.L2LCoreInterface=Ub;Nb.L2LCoreInterface=Ub;Nb.L2LCoreInterface=Ub;var Fb=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");Fb.systemInterfaceNamed=Mb;Fb.interactivelyCreatePackage=Kd;Fb.interactivelyLoadPackage=Jb;Fb.interactivelyReloadPackage=Dc;Fb.interactivelyUnloadPackage=nd;Fb.interactivelyRemovePackage=
Hc;Fb.showExportsAndImportsOf=wd;Fb.shortModuleName=Eb;Fb.addModule=vb;Fb.interactivelyChangeModule=ic;Fb.interactivelyReloadModule=jd;Fb.interactivelyUnloadModule=jc;Fb.interactivelyRemoveModule=kd;Fb.interactivelyAddModule=db;Fb.modulesInPackage=ec;Fb.LocalCoreInterface=pb;Fb.HTTPCoreInterface=gd;Fb.L2LCoreInterface=Ub;Ub=Ka("Interface",function(sb){var Ea=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js"),ua=Ea.hasOwnProperty("Interface")&&"function"===typeof Ea.Interface?Ea.Interface:
Ea.Interface=function(V){V&&V[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Bc(ua,sb,[{key:Symbol.for("lively-instance-initialize"),value:function(V){this.coreInterface=V}},{key:"isSystemInterface",get:function(){return!0}},{key:"name",get:function(){return this.coreInterface.name}},{key:"dynamicCompletionsForPrefix",value:function(V,ra,ja){return this.coreInterface.dynamicCompletionsForPrefix(V,ra,ja)}},{key:"runEval",value:function(V,
ra){return this.coreInterface.runEval(V,ra)}},{key:"printSystemConfig",value:function(V,ra,ja){return this.coreInterface.printSystemConfig(V,ra,ja)}},{key:"getConfig",value:function(V,ra,ja){return this.coreInterface.getConfig(V,ra,ja)}},{key:"getPackages",value:function(V){return this.coreInterface.getPackages(V)}},{key:"getModules",value:function(V,ra,ja){return this.coreInterface.getModules(V,ra,ja)}},{key:"getModule",value:function(V,ra,ja){return this.coreInterface.getModule(V,ra,ja)}},{key:"getPackage",
value:function(V,ra,ja){return this.coreInterface.getPackage(V,ra,ja)}},{key:"getPackageForModule",value:function(V,ra,ja){return this.coreInterface.getPackageForModule(V,ra,ja)}},{key:"resourcesOfPackage",value:function(V,ra){return this.coreInterface.resourcesOfPackage(V,ra)}},{key:"systemConfChange",value:function(V,ra,ja){return this.coreInterface.systemConfChange(V,ra,ja)}},{key:"registerPackage",value:function(V){return this.coreInterface.registerPackage(V)}},{key:"importPackage",value:function(V){return this.coreInterface.importPackage(V)}},
{key:"removePackage",value:function(V){return this.coreInterface.removePackage(V)}},{key:"reloadPackage",value:function(V){return this.coreInterface.reloadPackage(V)}},{key:"packageConfChange",value:function(V,ra){return this.coreInterface.packageConfChange(V,ra)}},{key:"keyValueListOfVariablesInModule",value:function(V,ra){return this.coreInterface.keyValueListOfVariablesInModule(V,ra)}},{key:"interactivelyCreatePackage",value:function(V){return Fb.interactivelyCreatePackage(this.coreInterface,V)}},
{key:"interactivelyLoadPackage",value:function(V,ra){return Fb.interactivelyLoadPackage(this.coreInterface,V,ra)}},{key:"interactivelyReloadPackage",value:function(V,ra){return Fb.interactivelyReloadPackage(this.coreInterface,V,ra)}},{key:"interactivelyUnloadPackage",value:function(V,ra,ja){return Fb.interactivelyUnloadPackage(this.coreInterface,V,ra,ja)}},{key:"interactivelyRemovePackage",value:function(V,ra){return Fb.interactivelyRemovePackage(this.coreInterface,V,ra)}},{key:"isModuleLoaded",value:function(V,
ra){return this.coreInterface.isModuleLoaded(V,ra)}},{key:"doesModuleExist",value:function(V,ra){return this.coreInterface.doesModuleExist(V,ra)}},{key:"createModule",value:function(V){return Fb.addModule(this.coreInterface,V)}},{key:"importModule",value:function(V){return this.coreInterface.importModule(V)}},{key:"forgetModule",value:function(V,ra){return this.coreInterface.forgetModule(V,ra)}},{key:"reloadModule",value:function(V,ra){return this.coreInterface.reloadModule(V,ra)}},{key:"moduleFormat",
value:function(V){return this.coreInterface.moduleFormat(V)}},{key:"moduleRead",value:function(V){return this.coreInterface.moduleRead(V)}},{key:"moduleWrite",value:function(V,ra){return this.coreInterface.moduleWrite(V,ra)}},{key:"getModulesInPackage",value:function(V){return Fb.modulesInPackage(this.coreInterface,V)}},{key:"shortModuleName",value:function(V,ra){return Fb.shortModuleName(this.coreInterface,V,ra)}},{key:"interactivelyChangeModule",value:function(V,ra,ja){return Fb.interactivelyChangeModule(this.coreInterface,
V,ra,ja)}},{key:"interactivelyReloadModule",value:function(V,ra){return Fb.interactivelyReloadModule(this.coreInterface,V,ra)}},{key:"interactivelyUnloadModule",value:function(V,ra){return Fb.interactivelyUnloadModule(this.coreInterface,V,ra)}},{key:"interactivelyRemoveModule",value:function(V,ra){return Fb.interactivelyRemoveModule(this.coreInterface,V,ra)}},{key:"interactivelyAddModule",value:function(V,ra){return Fb.interactivelyAddModule(this.coreInterface,V,ra)}},{key:"showExportsAndImportsOf",
value:function(V,ra){return Fb.showExportsAndImportsOf(this.coreInterface,V,ra)}},{key:"exportsOfModules",value:function(V){return this.coreInterface.exportsOfModules(V)}},{key:"searchInPackage",value:function(V,ra,ja){return this.coreInterface.searchInPackage(V,ra,ja)}},{key:"searchInAllPackages",value:function(V,ra){ra=void 0===ra?{}:ra;var ja=this,Ca,va,cb,hc,gb,Oc,Cb,Gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ec){switch(Ec.nextAddress){case 1:return(Ca=ra.progress)&&Ca.step("Fetching Packages...",
0),Ec.yield(ja.coreInterface.getPackages({excluded:ra.excludedPackages}),2);case 2:va=Ec.yieldResult,cb=[],Ca&&Ca.step("Fetching Packages...",.1),hc=0;case 3:if(!(hc<va.length)){Ec.jumpTo(5);break}gb=va[hc];Oc=gb.url;if(!Oc||"no group"===Oc){Ec.jumpTo(4);break}Ca&&Ca.step(Oc.replace(System.baseURL,"").slice(0,20),.1+hc/va.length*.9);Ec.setCatchFinallyBlocks(6);return Ec.yield(ja.coreInterface.searchInPackage(Oc,V,ra),8);case 8:Cb=Ec.yieldResult;cb=cb.concat(Cb);Ec.leaveTryBlock(4);break;case 6:Gd=
Ec.enterCatchBlock(),console.error("Error searching in package "+Oc+":\n"+Gd.stack);case 4:hc++;Ec.jumpTo(3);break;case 5:return Ec.return(cb)}})}},{key:"loadMochaTestFile",value:function(V,ra){return this.coreInterface.loadMochaTestFile(V,ra)}},{key:"runMochaTests",value:function(V,ra,ja,Ca){return this.coreInterface.runMochaTests(V,ra,ja,Ca)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Interface"}}],Ea,{pathInPackage:function(){return"index.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively-system-interface",version:"0.2.1"}}},{start:679,end:6188})}(void 0));Fb.Interface=Ub;Fb.Interface=Ub;Fb.Interface=Ub;Fb.systemInterfaceNamed=Mb;Fb.systemInterfaceNamed=Mb;Ub=Ka("localInterface",new Fb.Interface(new Fb.LocalCoreInterface));Fb.localInterface=Ub;Fb.localInterface=Ub;Fb.localInterface=Ub;Fb.httpInterfaces={};Ub=Ka("serverInterfaceFor",function(sb){return Fb.httpInterfaces[sb]||
(Fb.httpInterfaces[sb]=new Fb.Interface(new Fb.HTTPCoreInterface(sb)))});Fb.serverInterfaceFor=Ub;Fb.serverInterfaceFor=Ub;Fb.serverInterfaceFor=Ub;Fb.l2lInterfaces={};Ub=Ka("l2lInterfaceFor",function(sb,Ea){return Fb.l2lInterfaces[sb]||(Fb.l2lInterfaces[sb]=new Fb.Interface(new Fb.L2LCoreInterface(sb,Ea)))});Fb.l2lInterfaceFor=Ub;Fb.l2lInterfaceFor=Ub;Fb.l2lInterfaceFor=Ub}}});