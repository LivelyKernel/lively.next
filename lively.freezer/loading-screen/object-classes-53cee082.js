System.register(["./__root_module__-89b08ab2.js","kld-intersections"],function(ta){var nb,xb,Ob,Hb,qd,Dc,hd,Hc,Fc,Sc,ad,Jd,ed,sc,Sa;return{setters:[function(ob){nb=ob.s;xb=ob.P;Ob=ob.a6;Hb=ob.p;qd=ob.bG;Dc=ob.D;hd=ob.bH;Hc=ob.r;Fc=ob.aT;Sc=ob.bI;ad=ob.bJ;Jd=ob.bK;ed=ob.bL;sc=ob.bM;Sa=ob.n},function(){}],execute:function(){function ob(Xb,Ub,ub,hc){hc=void 0===hc?{}:hc;hc=hc.package||Sb.ObjectPackage.lookupPackageForObject(Xb,hc);if(!hc)throw Error("Object is not part of an object package: "+Xb);
return hc.addScript(Xb,Ub,ub)}function $b(Xb,Ub){Ub=Sb.normalizeOptions(Ub).System;Xb=(Xb=Xb[Symbol.for("lively-module-meta")])?Xb.package.name:null;return(Ub=(Xb?Sb.lookupPackage(Ub,Xb):{}).pkg)?!!Sb.ObjectPackage.forSystemPackage(Ub):!1}ta({addScript:ob,isObjectClass:$b});var Sb=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");Sb.normalizeOptions=function(Xb){Xb=Object.assign({baseURL:Sb.defaultBaseURL,System:System},Xb);Xb.baseURL=Xb.baseURL.replace(/\/$/,"");return Xb};Sb.addScript=
ob;Sb.isObjectClass=$b;Sb.string=nb;Sb.Path=xb;Sb.arr=Ob;Sb.parse=Hb;Sb.isValidIdentifier=qd;Sb.stringify=Dc;Sb.parseFunction=hd;Sb.resource=Hc;Sb.runEval=Fc;Sb.scripting=Sc;Sb.ExportLookup=ad;var Bc=Sb.scripting;Sb.ensurePackage=Bc.ensurePackage;Sb.registerPackage=Bc.registerPackage;Sb.importPackage=Bc.importPackage;Sb.lookupPackage=Bc.lookupPackage;Sb.module=Bc.module;Sb.ImportInjector=Bc.ImportInjector;Sb.RuntimeSourceDescriptor=Jd;Sb.toJsIdentifier=ed;Sb.adoptObject=sc;Sb.classToFunctionTransform=
Sa;Sb.objectPackageSym=Symbol.for("lively-object-package-data");Sb.defaultBaseURL="local://lively-object-modules";Sb.globalClasses=Object.keys(System.global).map(function(Xb){Xb=System.global[Xb];return"function"===typeof Xb&&Xb.name&&Xb}).filter(Boolean);Sb.addScript=ob;Sb.addScript=ob;Sb.isObjectClass=$b;Sb.isObjectClass=$b;Sb._packageStore=Sb._packageStore||{};Bc=function(Xb,Ub){this._id=Xb;this.options=Sb.normalizeOptions(Ub)};Bc.lookupPackageForObject=function(Xb,Ub){return this.lookupPackageForClass(Xb.constructor,
Ub)};Bc.lookupPackageForClass=function(Xb,Ub){Ub=Sb.normalizeOptions(Ub).System;Xb=(Xb=Xb[Symbol.for("lively-module-meta")])?Xb.package.name:null;return(Ub=(Xb?Sb.lookupPackage(Ub,Xb):{}).pkg)?Sb.ObjectPackage.forSystemPackage(Ub):null};Bc.forSystemPackage=function(Xb){return this.packageStore[Xb.name]};Bc.withId=function(Xb,Ub){return this.packageStore[Xb]||(this.packageStore[Xb]=new this(Xb,Ub))};Bc.prototype.resource=function(Xb){Xb=void 0===Xb?"":Xb;return Sb.resource(this.packageURL).join(Xb)};
Bc.prototype.load=function(){return Sb.importPackage(this.System,this.packageURL)};Bc.prototype.ensureExistance=function(){var Xb=this,Ub,ub,hc,wc,bd,cd,bb,pb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pc){switch(pc.nextAddress){case 1:return Ub=Xb.resource("/"),pc.yield(Ub.exists(),2);case 2:if(pc.yieldResult)return pc.return();ub=[{resource:Ub}];hc=[{resource:Xb.resource("package.json"),content:JSON.stringify(Xb.config,null,2)}];return pc.yield(Promise.all(ub.map(function(ab){return ab.resource.mkdir()})),
3);case 3:return pc.yield(Promise.all(hc.map(function(ab){var cb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){switch(Pa.nextAddress){case 1:return Pa.yield(ab.resource.exists(),2);case 2:if(!(cb=!Pa.yieldResult)){Pa.jumpTo(3);break}return Pa.yield(ab.resource.write(ab.content),4);case 4:cb=Pa.yieldResult;case 3:return Pa.return(cb)}})})),4);case 4:return pc.yield(Xb.objectModule.ensureExistance(),5);case 5:return wc=Xb,bd=wc.System,cd=wc.packageURL,bb=wc.config,pc.yield(Sb.ensurePackage(bd,
cd),6);case 6:return pb=pc.yieldResult,pb.registerWithConfig(bb),console.log(Xb.packageURL+" REGISTERED"),pc.return(Xb)}})};Bc.prototype.ensureObjectClass=function(Xb){var Ub=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){return 1==ub.nextAddress?ub.yield(Ub.ensureExistance(),2):ub.return(Ub.objectModule.ensureObjectClass(Xb))})};Bc.prototype.adoptObject=function(Xb){var Ub=this,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hc){if(1==hc.nextAddress)return Ub.objectClass===
Xb.constructor?hc.return():hc.yield(Ub.ensureObjectClass(Xb.constructor),2);ub=hc.yieldResult;Sb.adoptObject(Xb,ub);hc.jumpToEnd()})};Bc.prototype.addScript=function(Xb,Ub,ub){return this.objectModule.addScript(Xb,Ub,ub)};Bc.prototype.remove=function(){this.systemPackage.remove();delete Sb.ObjectPackage.packageStore[this.id];return this.resource().remove()};Bc.prototype.renameObjectClass=function(Xb,Ub){Ub=void 0===Ub?[]:Ub;var ub=this,hc,wc,bd,cd,bb,pb,pc,ab,cb,Pa,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){if(1==
eb.nextAddress){hc=ub;wc=hc.objectClass;bd=hc.System;if(!wc||wc[Symbol.for("__LivelyClassName__")]===Xb)return eb.return(wc);if(!Sb.isValidIdentifier(Xb))throw Error(Xb+" is not a valid name for a class");bb=cd=Sb.RuntimeSourceDescriptor.for(wc,bd);pb=bb.source;pc=bb.ast;ab=pc.id;cb=ab.start;Pa=ab.end;return eb.yield(cd.changeSource(pb.slice(0,cb)+Xb+pb.slice(Pa)),2)}Za=ub.objectClass;Ub.forEach(function(Na){Na.constructor=Za;Na.__proto__=Za.prototype});return eb.return(Za)})};Bc.prototype.fork=function(Xb,
Ub){var ub=this,hc,wc,bd,cd,bb,pb,pc,ab,cb,Pa,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(eb){switch(eb.nextAddress){case 1:return hc=ub,wc=hc.System,bd=hc.baseURL,cd=hc.objectClass,Ub=Object.assign({System:wc,baseURL:bd},Ub),bb=Sb.RuntimeSourceDescriptor.for(cd),pb=bb._renamedSource(Xb),pc=pb.moduleSource,ab=Sb.ObjectPackage.withId(Xb,Ub),eb.yield(ab.ensureExistance(),2);case 2:return cb=ab,Pa=cb.objectModule,Za=Pa.systemModule,eb.yield(Za.load({format:"esm"}),3);case 3:return eb.yield(Za.changeSource(pc),
4);case 4:return eb.return(ab)}})};$jscomp.global.Object.defineProperties(Bc.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return Sb.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new Sb.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(Bc,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=Sb._packageStore)}}});ta("default",Bc);Sb.ObjectPackage=Bc;var id=function(Xb,Ub){if(!Xb)throw Error("ObjectModule needs package!");if(!Ub)throw Error("ObjectModule needs package!");this._moduleName=Xb;this._objectPackage=Ub};id.prototype.read=function(){return this.resource.read()};id.prototype.write=function(Xb){return this.resource.write(Xb)};id.prototype.ensureExistance=function(){var Xb=
this,Ub,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(hc){switch(hc.nextAddress){case 1:return Ub=Xb.resource,hc.yield(Ub.exists(),2);case 2:if(hc.yieldResult){hc.jumpTo(3);break}return hc.yield(Ub.write("'format esm';\n"),4);case 4:ub={},Xb.System.config({meta:(ub[Xb.url]={format:"esm"},ub)});case 3:return hc.return(Xb)}})};id.prototype.ensureObjectClass=function(Xb){var Ub=this,ub=this.objectClass;return ub&&ub.prototype.__proto__===Xb.prototype?ub:Promise.resolve(this.ensureObjectClassSource(Xb)).then(function(hc){var wc=
hc.source,bd=hc.moduleId,cd=hc.className,bb=hc.bindings,pb=Ub.System;hc=Sb.module(pb,bd);if(bb)for(var pc in bb)hc.define(pc,bb[pc]);wc=Sb.runEval(wc,{classTransform:Sb.classToFunctionTransform,sync:!0,targetModule:bd,System:pb});if(wc.isError)throw wc.value;wc=hc.recorder[cd];if(!wc)throw Error("Failed to define class "+cd+" in "+bd);return wc})};id.prototype.ensureObjectClassSource=function(Xb){return this.createDefaultClassDeclaration(Xb)};id.prototype.createDefaultClassDeclaration=function(Xb){Xb=
void 0===Xb?Object:Xb;var Ub=this,ub,hc,wc,bd,cd,bb,pb,pc,ab,cb,Pa,Za,eb,Na,Da,mb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Zb){switch(Zb.nextAddress){case 1:ub=Ub;hc=ub.System;wc=ub.systemModule;bd=ub.objectPackage;cd=Sb.string.capitalize(Sb.toJsIdentifier(bd.id));bb=Xb[Symbol.for("__LivelyClassName__")];pb=!bb;pc=Sb.globalClasses.includes(Xb);ab="";cb=null;if(pb){bb="__anonymous_superclass__";Pa={};cb=(Pa[bb]=Xb,Pa);Zb.jumpTo(2);break}if(pc){Zb.jumpTo(2);break}return Zb.yield(Sb.ExportLookup.findExportOfValue(Xb,
hc),4);case 4:(Za=Zb.yieldResult)?(eb=Sb.ImportInjector.run(hc,wc.id,wc.package(),"",Za),Na=eb.standaloneImport,ab+=Na+"\n\n"):(Da={},cb=(Da[bb]=Xb,Da));case 2:return cd===bb&&(cd="Object"+cd),mb="Object"===bb?"class "+cd+" {}\n":"class "+cd+" extends "+bb+" {}\n",ab+="export default "+mb+"\n",Zb.yield(wc.changeSource(ab),5);case 5:return Zb.yield(wc.load(),6);case 6:return Zb.return({source:ab,className:cd,moduleId:Ub.url,bindings:cb})}})};id.prototype.addScript=function(Xb,Ub,ub){var hc=this,wc,
bd,cd,bb,pb,pc,ab,cb,Pa,Za,eb,Na,Da,mb,Zb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dc){switch(dc.nextAddress){case 1:if(Xb.constructor===hc.objectClass){wc=Xb.constructor;dc.jumpTo(2);break}return dc.yield(hc.ensureObjectClass(Xb.constructor),3);case 3:wc=dc.yieldResult;case 2:bd=wc;cd="function"===typeof Ub?String(Ub):Ub;bb=Sb.parseFunction(cd);pb=Sb.RuntimeSourceDescriptor.for(bd,hc.System);ub||(ub=Sb.Path("id.name").get(bb));if(!ub)throw Error("No name, cannot add "+Sb.string.truncate(cd,
30).replace(/\n/g,"")+"!");pc=Sb.toJsIdentifier(ub);console.assert("FunctionExpression"===bb.type||"ArrowFunctionExpression"===bb.type,"not a function expression but: "+bb.type);ab=bb.params.map(function(Mb){return cd.slice(Mb.start,Mb.end)});cb="BlockStatement"===bb.body.type?cd.slice(bb.body.start,bb.body.end):"{ return "+cd.slice(bb.body.start,bb.body.end)+" }";Pa=pc+"("+ab.join(",")+") "+cb;"ArrowFunctionExpression"===bb.type&&(bb.type="FunctionExpression");Za=pb.source;eb=pb.ast;if(!eb)throw Error("cannot find class decl of "+
pb.module.id);(Na=eb.body.body.find(function(Mb){return Mb.key.name===pc&&!Mb.static}))?Za=Za.slice(0,Na.start)+Pa+Za.slice(Na.end):(Da=Za.lastIndexOf("}"),mb=Za.slice(0,Da),Zb=Za.slice(Da),/\n\s*$/m.test(mb)||(mb+="\n"),Pa=Sb.string.changeIndent(Pa,"  ",1),/^[ ]*\n/m.test(Zb)||(Zb="\n"+Zb),Za=mb+Pa+Zb);return dc.yield(pb.changeSource(Za),4);case 4:return dc.return({script:bd.prototype[pc],klass:bd,module:pb.module.id,methodName:pc})}})};$jscomp.global.Object.defineProperties(id.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var Xb=this.systemModule;return Xb.isLoaded()?Xb.System.get(Xb.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return Sb.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});Sb.ObjectModule=id;Sb.default=Bc}}});