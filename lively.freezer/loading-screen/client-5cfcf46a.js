System.register(["./__root_module__-b4667baa.js","kld-intersections"],function(ta){var lb,yb,Qb,Kb,yd,Cc,rd,Fc;return{setters:[function(Dc){lb=Dc.s;yb=Dc.$;Qb=Dc.bk;Kb=Dc.bl;yd=Dc.at;Cc=Dc.a7;rd=Dc.bm;Fc=Dc.ap},function(){}],execute:function(){function Dc(J,W){var pa={};W.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function($a,Fb,sc){Fb&&(pa[Fb]=sc)});return pa}function Rc(J){J=String(J);if(!(100<J.length)&&(J=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(J))){var W=
parseFloat(J[1]);switch((J[2]||"ms").toLowerCase()){case "years":case "year":case "yrs":case "yr":case "y":return W*tc;case "days":case "day":case "d":return W*ae;case "hours":case "hour":case "hrs":case "hr":case "h":return 36E5*W;case "minutes":case "minute":case "mins":case "min":case "m":return 6E4*W;case "seconds":case "second":case "secs":case "sec":case "s":return 1E3*W;case "milliseconds":case "millisecond":case "msecs":case "msec":case "ms":return W}}}function $c(J,W,pa){if(!(J<W))return J<
1.5*W?Math.floor(J/W)+" "+pa:Math.ceil(J/W)+" "+pa+"s"}function Hd(J){var W=0,pa;for(pa in J)W=(W<<5)-W+J.charCodeAt(pa),W|=0;return ub.colors[Math.abs(W)%ub.colors.length]}function gd(J){function W(){if(W.enabled){var $a=+new Date;W.diff=$a-(pa||$a);W.prev=pa;pa=W.curr=$a;var Fb=Array(arguments.length);for($a=0;$a<Fb.length;$a++)Fb[$a]=arguments[$a];Fb[0]=ub.coerce(Fb[0]);"string"!==typeof Fb[0]&&Fb.unshift("%O");var sc=0;Fb[0]=Fb[0].replace(/%([a-zA-Z%])/g,function(ad,Qd){if("%%"===ad)return ad;
sc++;Qd=ub.formatters[Qd];"function"===typeof Qd&&(ad=Qd.call(W,Fb[sc]),Fb.splice(sc,1),sc--);return ad});ub.formatArgs.call(W,Fb);(W.log||ub.log||console.log.bind(console)).apply(W,Fb)}}var pa;W.namespace=J;W.enabled=ub.enabled(J);W.useColors=ub.useColors();W.color=Hd(J);W.destroy=Uc;"function"===typeof ub.init&&ub.init(W);ub.instances.push(W);return W}function Uc(){var J=ub.instances.indexOf(this||Yc);return-1!==J?(ub.instances.splice(J,1),!0):!1}function Pa(){try{var J=oa.storage.debug}catch(W){}!J&&
"undefined"!==typeof tb&&"env"in tb&&(J=tb.env.DEBUG);return J}function mb(J){if(J){for(var W in mb.prototype)J[W]=mb.prototype[W];return J}}function Nb(J,W){if(!J)return J;if(rf(J)){var pa={_placeholder:!0,num:W.length};W.push(J);return pa}if(Ie(J)){pa=Array(J.length);for(var $a=0;$a<J.length;$a++)pa[$a]=Nb(J[$a],W);return pa}if("object"===typeof J&&!(J instanceof Date)){pa={};for($a in J)pa[$a]=Nb(J[$a],W);return pa}return J}function Ub(J,W){if(!J)return J;if(J&&J._placeholder)return W[J.num];if(Ie(J))for(var pa=
0;pa<J.length;pa++)J[pa]=Ub(J[pa],W);else if("object"===typeof J)for(pa in J)J[pa]=Ub(J[pa],W);return J}function Ic(){}function wd(J){var W=""+J.type;if(jb.BINARY_EVENT===J.type||jb.BINARY_ACK===J.type)W+=J.attachments+"-";J.nsp&&"/"!==J.nsp&&(W+=J.nsp+",");null!=J.id&&(W+=J.id);if(null!=J.data){try{var pa=JSON.stringify(J.data)}catch($a){pa=!1}if(!1!==pa)W+=pa;else return Za}R("encoded %j as %s",J,W);return W}function Eb(J,W){wa.removeBlobs(J,function(pa){var $a=wa.deconstructPacket(pa);pa=wd($a.packet);
$a=$a.buffers;$a.unshift(pa);W($a)})}function Sb(){(this||Ma).reconstructor=null}function sb(J){(this||Ma).reconPack=J;(this||Ma).buffers=[]}function ec(J){if(!J||"object"!==typeof J)return!1;if(df(J)){for(var W=0,pa=J.length;W<pa;W++)if(ec(J[W]))return!0;return!1}if("function"===typeof ie&&ie.isBuffer&&ie.isBuffer(J)||"function"===typeof ArrayBuffer&&J instanceof ArrayBuffer||rh&&J instanceof Blob||Cg&&J instanceof File)return!0;if(J.toJSON&&"function"===typeof J.toJSON&&1===arguments.length)return ec(J.toJSON(),
!0);for(W in J)if(Object.prototype.hasOwnProperty.call(J,W)&&ec(J[W]))return!0;return!1}function rc(){}function yc(J){return J.map(function(W){if(W.buffer instanceof ArrayBuffer){var pa=W.buffer;if(W.byteLength!==pa.byteLength){var $a=new Uint8Array(W.byteLength);$a.set(new Uint8Array(pa,W.byteOffset,W.byteLength));pa=$a.buffer}return pa}return W})}function Db(J,W){W=W||{};var pa=new wi;yc(J).forEach(function($a){pa.append($a)});return W.type?pa.getBlob(W.type):pa.getBlob()}function ab(J,W){return new Blob(yc(J),
W||{})}function Zb(J){for(var W=[],pa=0,$a=J.length,Fb,sc;pa<$a;)Fb=J.charCodeAt(pa++),55296<=Fb&&56319>=Fb&&pa<$a?(sc=J.charCodeAt(pa++),56320==(sc&64512)?W.push(((Fb&1023)<<10)+(sc&1023)+65536):(W.push(Fb),pa--)):W.push(Fb);return W}function kc(J,W){if(55296<=J&&57343>=J){if(W)throw Error("Lone surrogate U+"+J.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function ua(){if(gc>=Mc)throw Error("Invalid byte index");var J=Bb[gc]&255;gc++;if(128==(J&192))return J&63;throw Error("Invalid continuation byte");
}function Ga(J){if(gc>Mc)throw Error("Invalid byte index");if(gc==Mc)return!1;var W=Bb[gc]&255;gc++;if(0==(W&128))return W;if(192==(W&224)){var pa=ua();W=(W&31)<<6|pa;if(128<=W)return W;throw Error("Invalid continuation byte");}if(224==(W&240)){pa=ua();var $a=ua();W=(W&15)<<12|pa<<6|$a;if(2048<=W)return kc(W,J)?W:65533;throw Error("Invalid continuation byte");}if(240==(W&248)&&(pa=ua(),$a=ua(),J=ua(),W=(W&7)<<18|pa<<12|$a<<6|J,65536<=W&&1114111>=W))return W;throw Error("Invalid UTF-8 detected");}
function cb(J,W,pa){if(!W)return id.encodeBase64Packet(J,pa);var $a=new FileReader;$a.onload=function(){id.encodePacket({type:J.type,data:$a.result},W,!0,pa)};return $a.readAsArrayBuffer(J.data)}function rb(J,W,pa){var $a=Array(J.length);pa=Cf(J.length,pa);for(var Fb=function(ad,Qd,Md){W(Qd,function(Me,tf){$a[ad]=tf;Md(Me,$a)})},sc=0;sc<J.length;sc++)Fb(sc,J[sc],pa)}function pb(J){var W="";do W=ym[J%64]+W,J=Math.floor(J/64);while(0<J);return W}function Ta(){var J=pb(+new Date);return J!==rj?(Jk=0,
rj=J):J+"."+pb(Jk++)}function Ua(J){(this||Gf).path=J.path;(this||Gf).hostname=J.hostname;(this||Gf).port=J.port;(this||Gf).secure=J.secure;(this||Gf).query=J.query;(this||Gf).timestampParam=J.timestampParam;(this||Gf).timestampRequests=J.timestampRequests;(this||Gf).readyState="";(this||Gf).agent=J.agent||!1;(this||Gf).socket=J.socket;(this||Gf).enablesXDR=J.enablesXDR;(this||Gf).withCredentials=J.withCredentials;(this||Gf).pfx=J.pfx;(this||Gf).key=J.key;(this||Gf).passphrase=J.passphrase;(this||
Gf).cert=J.cert;(this||Gf).ca=J.ca;(this||Gf).ciphers=J.ciphers;(this||Gf).rejectUnauthorized=J.rejectUnauthorized;(this||Gf).forceNode=J.forceNode;(this||Gf).isReactNative=J.isReactNative;(this||Gf).extraHeaders=J.extraHeaders;(this||Gf).localAddress=J.localAddress}function ob(J){var W=J&&J.forceBase64;if(!jj||W)(this||gf).supportsBinary=!1;Zj.call(this||gf,J)}function Wb(){}function lc(J){qn.call(this||me,J);(this||me).requestTimeout=J.requestTimeout;(this||me).extraHeaders=J.extraHeaders;if("undefined"!==
typeof location){var W="https:"===location.protocol,pa=location.port;pa||(pa=W?443:80);(this||me).xd="undefined"!==typeof location&&J.hostname!==location.hostname||pa!==J.port;(this||me).xs=J.secure!==W}}function Lb(J){(this||me).method=J.method||"GET";(this||me).uri=J.uri;(this||me).xd=!!J.xd;(this||me).xs=!!J.xs;(this||me).async=!1!==J.async;(this||me).data=void 0!==J.data?J.data:null;(this||me).agent=J.agent;(this||me).isBinary=J.isBinary;(this||me).supportsBinary=J.supportsBinary;(this||me).enablesXDR=
J.enablesXDR;(this||me).withCredentials=J.withCredentials;(this||me).requestTimeout=J.requestTimeout;(this||me).pfx=J.pfx;(this||me).key=J.key;(this||me).passphrase=J.passphrase;(this||me).cert=J.cert;(this||me).ca=J.ca;(this||me).ciphers=J.ciphers;(this||me).rejectUnauthorized=J.rejectUnauthorized;(this||me).extraHeaders=J.extraHeaders;this.create()}function qc(){for(var J in Lb.requests)Lb.requests.hasOwnProperty(J)&&Lb.requests[J].abort()}function I(){}function V(J){yk.call(this||Dg,J);(this||
Dg).query=(this||Dg).query||{};ck||(ck=sl.___eio=sl.___eio||[]);(this||Dg).index=ck.length;var W=this||Dg;ck.push(function(pa){W.onData(pa)});(this||Dg).query.j=(this||Dg).index;"function"===typeof addEventListener&&addEventListener("beforeunload",function(){W.script&&(W.script.onerror=I)},!1)}function ra(J){J&&J.forceBase64&&((this||ca).supportsBinary=!1);(this||ca).perMessageDeflate=J.perMessageDeflate;(this||ca).usingBrowserWebSocket=dc&&!J.forceNode;(this||ca).protocols=J.protocols;(this||ca).usingBrowserWebSocket||
(ed=nc);La.call(this||ca,J)}function ya(J,W){if(!((this||Jc)instanceof ya))return new ya(J,W);W=W||{};J&&"object"===typeof J&&(W=J,J=null);J?(J=Oj(J),W.hostname=J.host,W.secure="https"===J.protocol||"wss"===J.protocol,W.port=J.port,J.query&&(W.query=J.query)):W.host&&(W.hostname=Oj(W.host).host);(this||Jc).secure=null!=W.secure?W.secure:"undefined"!==typeof location&&"https:"===location.protocol;W.hostname&&!W.port&&(W.port=(this||Jc).secure?"443":"80");(this||Jc).agent=W.agent||!1;(this||Jc).hostname=
W.hostname||("undefined"!==typeof location?location.hostname:"localhost");(this||Jc).port=W.port||("undefined"!==typeof location&&location.port?location.port:(this||Jc).secure?443:80);(this||Jc).query=W.query||{};"string"===typeof(this||Jc).query&&((this||Jc).query=zm.decode((this||Jc).query));(this||Jc).upgrade=!1!==W.upgrade;(this||Jc).path=(W.path||"/engine.io").replace(/\/$/,"")+"/";(this||Jc).forceJSONP=!!W.forceJSONP;(this||Jc).jsonp=!1!==W.jsonp;(this||Jc).forceBase64=!!W.forceBase64;(this||
Jc).enablesXDR=!!W.enablesXDR;(this||Jc).withCredentials=!1!==W.withCredentials;(this||Jc).timestampParam=W.timestampParam||"t";(this||Jc).timestampRequests=W.timestampRequests;(this||Jc).transports=W.transports||["polling","websocket"];(this||Jc).transportOptions=W.transportOptions||{};(this||Jc).readyState="";(this||Jc).writeBuffer=[];(this||Jc).prevBufferLen=0;(this||Jc).policyPort=W.policyPort||843;(this||Jc).rememberUpgrade=W.rememberUpgrade||!1;(this||Jc).binaryType=null;(this||Jc).onlyBinaryUpgrades=
W.onlyBinaryUpgrades;(this||Jc).perMessageDeflate=!1!==W.perMessageDeflate?W.perMessageDeflate||{}:!1;!0===(this||Jc).perMessageDeflate&&((this||Jc).perMessageDeflate={});(this||Jc).perMessageDeflate&&null==(this||Jc).perMessageDeflate.threshold&&((this||Jc).perMessageDeflate.threshold=1024);(this||Jc).pfx=W.pfx||null;(this||Jc).key=W.key||null;(this||Jc).passphrase=W.passphrase||null;(this||Jc).cert=W.cert||null;(this||Jc).ca=W.ca||null;(this||Jc).ciphers=W.ciphers||null;(this||Jc).rejectUnauthorized=
void 0===W.rejectUnauthorized?!0:W.rejectUnauthorized;(this||Jc).forceNode=!!W.forceNode;(this||Jc).isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();if("undefined"===typeof self||(this||Jc).isReactNative)W.extraHeaders&&0<Object.keys(W.extraHeaders).length&&((this||Jc).extraHeaders=W.extraHeaders),W.localAddress&&((this||Jc).localAddress=W.localAddress);(this||Jc).id=null;(this||Jc).upgrades=null;(this||Jc).pingInterval=
null;(this||Jc).pingTimeout=null;(this||Jc).pingIntervalTimer=null;(this||Jc).pingTimeoutTimer=null;this.open()}function Gb(J,W,pa){(this||De).io=J;(this||De).nsp=W;(this||De).json=this||De;(this||De).ids=0;(this||De).acks={};(this||De).receiveBuffer=[];(this||De).sendBuffer=[];(this||De).connected=!1;(this||De).disconnected=!0;(this||De).flags={};pa&&pa.query&&((this||De).query=pa.query);(this||De).io.autoConnect&&this.open()}function Pb(J){J=J||{};(this||Dj).ms=J.min||100;(this||Dj).max=J.max||
1E4;(this||Dj).factor=J.factor||2;(this||Dj).jitter=0<J.jitter&&1>=J.jitter?J.jitter:0;(this||Dj).attempts=0}function Ca(J,W){if(!((this||ud)instanceof Ca))return new Ca(J,W);J&&"object"===typeof J&&(W=J,J=void 0);W=W||{};W.path=W.path||"/socket.io";(this||ud).nsps={};(this||ud).subs=[];(this||ud).opts=W;this.reconnection(!1!==W.reconnection);this.reconnectionAttempts(W.reconnectionAttempts||Infinity);this.reconnectionDelay(W.reconnectionDelay||1E3);this.reconnectionDelayMax(W.reconnectionDelayMax||
5E3);this.randomizationFactor(W.randomizationFactor||.5);(this||ud).backoff=new xp({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==W.timeout?2E4:W.timeout);(this||ud).readyState="closed";(this||ud).uri=J;(this||ud).connecting=[];(this||ud).lastPing=null;(this||ud).encoding=!1;(this||ud).packetBuffer=[];J=W.parser||No;(this||ud).encoder=new J.Encoder;(this||ud).decoder=new J.Decoder;(this||ud).autoConnect=!1!==W.autoConnect;(this||
ud).autoConnect&&this.open()}function Yb(J,W){"object"===typeof J&&(W=J,J=void 0);W=W||{};J=yp(J);var pa=J.source,$a=J.id,Fb=J.path;Fb=Wm[$a]&&Fb in Wm[$a].nsps;W.forceNew||W["force new connection"]||!1===W.multiplex||Fb?(Kq("ignoring socket cache for %s",pa),pa=Jq(pa,W)):(Wm[$a]||(Kq("new io instance for %s",pa),Wm[$a]=Jq(pa,W)),pa=Wm[$a]);J.query&&!W.query&&(W.query=J.query);return pa.socket(J.path,W)}var jd=lively.FreezerRuntime.recorderFor("lively.2lively/interface.js");jd.nyi=function(J){throw Error("Not yet implemented: "+
J);};jd.string=lb;jd.promise=yb;jd.debugMessageOrder=!1;var Kc=function(J){this.id=jd.string.newUUID();this.actions={};this.options={ackTimeout:3500,debug:!1};this._incomingOrderNumberingBySenders=new Map;this._outgoingOrderNumberingByTargets=new Map;this._outOfOrderCacheBySenders=new Map};Kc.prototype.isOnline=function(){jd.nyi("isOnline")};Kc.prototype.open=function(){jd.nyi("isOnline")};Kc.prototype.close=function(){jd.nyi("close")};Kc.prototype.remove=function(){jd.nyi("remove")};Kc.prototype.whenOnline=
function(J){var W=this;return jd.promise.waitFor(J,function(){return W.isOnline()}).then(function(){return W}).catch(function(pa){return Promise.reject(/timeout/i.test(String(pa))?Error("Timeout in "+W+".whenOnline"):pa)})};Kc.prototype.onError=function(J){this.debug&&console.log("["+this+"] error: "+J)};Kc.prototype.removeService=function(J){delete this.actions[J]};Kc.prototype.removeServices=function(J){var W=this;J.forEach(function(pa){return W.removeService(pa)})};Kc.prototype.addService=function(J,
W){this.actions[J]=W};Kc.prototype.addServices=function(J){var W=this;Object.keys(J).forEach(function(pa){return W.addService(pa,J[pa])})};Kc.prototype.ping=function(J){var W=this,pa,$a,Fb,sc,ad;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qd){if(1==Qd.nextAddress)return pa=Date.now(),Qd.yield(W.sendToAndWait(J,"l2l-ping",{timestamp:pa}),2);$a=Qd.yieldResult;Fb=$a.data;sc=Fb.timestamp;ad=Date.now();return Qd.return({to:sc-pa,from:ad-sc,roundtrip:ad-pa})})};Kc.prototype.send=function(J,
W){jd.nyi("send")};Kc.prototype.sendAndWait=function(J){var W=this,pa,$a,Fb,sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ad){switch(ad.nextAddress){case 1:return pa=new Promise(function(Qd,Md){return W.send(J,Qd)}),$a={},Fb=W.options.ackTimeout+400,"ackTimeout"in J&&(Fb=!J.ackTimeout||0>J.ackTimeout?null:J.ackTimeout+400),Fb?ad.yield(Promise.race([jd.promise.delay(Fb,$a),pa]),5):ad.yield(pa,4);case 4:sc=ad.yieldResult;ad.jumpTo(3);break;case 5:sc=ad.yieldResult;case 3:if(sc===$a)throw Error("Timeout sending "+
J.action);return ad.return(sc)}})};Kc.prototype.sendTo=function(J,W,pa,$a){return this.send({target:J,action:W,data:pa},$a)};Kc.prototype.sendToAndWait=function(J,W,pa,$a){return this.sendAndWait(Object.assign({target:J,action:W,data:pa},$a))};Kc.prototype.prepareSend=function(J,W){var pa=J.target,$a=J.action,Fb=J.messageId,sc=J.sender;if(!$a)throw Error("Trying to send a message without specifying action!");if(!pa)throw Error("Trying to send message "+$a+" without specifying target!");Fb||(J.messageId=
jd.string.newUUID());sc||(J.sender=this.id);$a=J.n=this._outgoingOrderNumberingByTargets.get(pa)||0;this._outgoingOrderNumberingByTargets.set(pa,$a+1);if("function"===typeof W){sc=this;var ad=W;W=function(Qd){var Md=sc._incomingOrderNumberingBySenders.get(Qd.sender)||0;sc.debug&&jd.debugMessageOrder&&console.log("[MSG ORDER] "+sc+" received ack for "+Qd.action+" as msg "+Md);try{ad.apply(null,arguments)}catch(Me){console.error("Error in ack fn of "+sc+": "+Me.stack)}sc._incomingOrderNumberingBySenders.set(Qd.sender,
Md+1);setTimeout(function(){return sc.invokeOutOfOrderMessages(Qd.sender)},0)}}this.debug&&jd.debugMessageOrder&&console.log("[MSG ORDER] "+this+" sending "+$a+" ("+J.action+") to "+pa);return[J,W]};Kc.prototype.prepareAnswerMessage=function(J,W){return{action:J.action+"-response",inResponseTo:J.messageId,target:J.sender,data:W,sender:this.id}};Kc.prototype.installEventToMessageTranslator=function(J){var W=this,pa=J.onevent;J.onevent=function($a){var Fb=$a.data||[];pa.call(this,$a);$a.data=["*"].concat(Fb);
pa.call(this,$a)};J.on("*",function($a,Fb){$a&&"object"===typeof $a&&$a.action&&(Fb=$a,$a=Fb.action);var sc=arguments[arguments.length-1];sc="function"===typeof sc?sc:null;(Fb=Fb===sc?null:Fb)&&Fb.data&&("number"===typeof Fb.n||Fb.broadcast)&&Fb.sender?W.receive(Fb,J,sc):(console.warn(W+" received non-conformant message "+$a+":",arguments),"function"===typeof sc&&sc({data:{error:"invalid l2l message"}}))})};Kc.prototype.receive=function(J,W,pa){this.dispatchL2LMessageToSelf(J,W,pa)};Kc.prototype.dispatchL2LMessageToSelf=
function(J,W,pa){var $a=this,Fb=J.action;if(J.broadcast)this.safeInvokeServiceHandler(Fb,J,pa,W);else try{var sc=this._incomingOrderNumberingBySenders.get(J.sender)||0,ad="register"===Fb||"unregister";if(!ad&&J.n<sc)console.error("[MSG ORDER] ["+this+"] received message no. "+J.n+" but expected >= "+sc+", dropping "+Fb);else if(!ad&&J.n>sc){this.debug&&jd.debugMessageOrder&&console.log("[MSG ORDER] ["+this+"] storing out of order message "+Fb+" ("+J.n+") for later invocation");var Qd=this._outOfOrderCacheBySenders.get(J.sender);
Qd||(Qd=[],this._outOfOrderCacheBySenders.set(J.sender,Qd));Qd.push([Fb,J,pa,W])}else this.safeInvokeServiceHandler(Fb,J,pa,W),setTimeout(function(){return $a.invokeOutOfOrderMessages(J.sender)},0)}catch(Md){console.error("Error message ordering when handling "+Fb+": "+(Md.stack||Md)),"function"===typeof pa&&pa(this.prepareAnswerMessage(J,{isError:!0,error:String(Md.stack||Md)}))}};Kc.prototype.invokeOutOfOrderMessages=function(J){var W=this._outOfOrderCacheBySenders.get(J);if(W&&W.length){var pa=
this._incomingOrderNumberingBySenders.get(J)||0;J=W.findIndex(function($a){$a=$jscomp.makeIterator($a);$a.next();return $a.next().value.n===pa});-1!==J&&(W.splice(J,1),this.invokeServiceHandler.apply(this,W[J]))}};Kc.prototype.renameTarget=function(J,W){if(J!==W){var pa=this._outgoingOrderNumberingByTargets.get(J);this._outgoingOrderNumberingByTargets.delete(J);this._outgoingOrderNumberingByTargets.set(W,pa)}};Kc.prototype.safeInvokeServiceHandler=function(J,W,pa,$a){try{"function"===typeof this.actions[J]?
this.invokeServiceHandler(J,W,pa,$a):$a._events&&Object.keys($a._events).includes(J)||(console.warn("WARNING ["+this+"] Unhandled message: "+J),"function"===typeof pa&&pa(this.prepareAnswerMessage(W,{isError:!0,error:"message not understood: "+J})))}catch(Fb){console.error("Error when handling "+J+": "+(Fb.stack||Fb)),"function"===typeof pa&&pa(this.prepareAnswerMessage(W,{isError:!0,error:String(Fb.stack||Fb)}))}};Kc.prototype.invokeServiceHandler=function(J,W,pa,$a){var Fb=this;this.debug&&jd.debugMessageOrder&&
console.log("[MSG ORDER] "+this+" received "+W.n+" ("+W.action+") from "+W.sender);this._incomingOrderNumberingBySenders.set(W.sender,W.n+1);if("function"===typeof pa){var sc=!1,ad=!1,Qd="ackTimeout"in W?W.ackTimeout:this.options.ackTimeout,Md=this._outgoingOrderNumberingByTargets.get(W.sender)||0;this._outgoingOrderNumberingByTargets.set(W.sender,Md+1);var Me=function(tf){ad?console.warn("["+Fb+"] ackFn for "+W.action+" called after it timed out, dropping answer!"):sc?console.warn("["+Fb+"] ack function called repeatedly when handling "+
W.action):(sc=!0,pa(Fb.prepareAnswerMessage(W,tf)),Fb.debug&&jd.debugMessageOrder&&console.log("[MSG ORDER] "+Fb+" sending "+Md+" (ack for "+W.action+")"))};Qd&&setTimeout(function(){sc||(Me({isError:!0,error:"Timeout error: "+Fb+" did not send answer for "+W.action+" after "+Qd+"ms"}),ad=!0)},Qd)}try{this.actions[J].call(this,this,W,Me,$a)}catch(tf){console.error("["+this+"] Error handling "+J+": "+(tf.stack||tf)),Me&&Me({error:tf.stack})}};$jscomp.global.Object.defineProperties(Kc.prototype,{debug:{configurable:!0,
enumerable:!0,get:function(){return this.options.debug},set:function(J){this.options.debug=J}}});jd.L2LConnection=Kc;jd.default=Kc;var zc=lively.FreezerRuntime.recorderFor("lively.2lively/default-actions.js"),Ha={"l2l-ping":function(J,W,pa,$a){$a=W.sender;W=W.data.timestamp;var Fb=Date.now();"function"===typeof pa&&pa({timestamp:Fb});J.debug&&console.log("[undefined] got ping from "+$a+", time: "+(Fb-W)+"ms")},"remote-eval":function(J,W,pa,$a){var Fb=W.data.source;Promise.resolve().then(function(){return eval(Fb)}).then(function(sc){return pa({value:sc})}).catch(function(sc){sc.originalErr&&
(sc=sc.originalErr);console.error("eval error: "+sc);"function"===typeof pa&&pa({isError:!0,value:String(sc.stack||sc)})})},"remote-eval-2":function(J,W,pa,$a){var Fb=W.data.source;Promise.resolve().then(function(){var sc=eval(Fb);if(!(sc instanceof Promise))throw console.error("unexpected eval result:"+sc),Error("unexpected eval result:"+sc);return sc}).then(function(sc){return pa(sc)}).catch(function(sc){console.error("eval error: "+sc);sc.originalErr&&(sc=sc.originalErr);"function"===typeof pa&&
pa({isError:!0,value:String(sc.stack||sc)})})}};zc.defaultActions=Ha;zc.defaultActions=Ha;zc.defaultActions=Ha;var Ec={},Wa=(Ec["[broadcast] send"]=function(J,W,pa,$a){var Fb=W.sender,sc=W.data,ad,Qd,Md,Me,tf,Rg,Dh,Oi,Xm,ao,Yl,Dm;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Em){ad=sc;Qd=ad.action;Md=ad.broadcast;Me=ad.room;tf=ad.namespace;Rg=ad.isSystemBroadcast;Dh=ad.isMultiServerBroadcast;Oi=[];Dh?(console.log(".......isMultiServerBroadcast"),Xm=J,ao=Xm.id,Yl=J.getTrackerList(),console.log(Yl),
Oi=Yl.map(function(Fm){return Fm.id!=ao?Fm.io.nsps["/"+Fm.namespace]:$a.broadcast})):(Rg&&(tf=J.namespace),Oi.push(tf?J.io.nsps["/"+tf]:$a.broadcast));Oi.forEach(function(Fm){return Fm.to(Me).emit({action:Qd,sender:Fb,broadcast:!0,data:Md})});pa&&"function"===typeof pa&&(Dm="message broadcasted to "+Me,tf&&(Dm+=" in namespace "+tf),1<Oi.length&&(Dm+=" "+Oi.length+" trackers"),console.log(Dm),pa({status:Dm}));Em.jumpToEnd()})},Ec["[broadcast] join room"]=function(J,W,pa,$a){var Fb=W.sender,sc=W.data.room,
ad,Qd,Md,Me;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tf){if(1==tf.nextAddress)return Qd=!1,Md=J.io.nsps["/"+J.namespace].adapter.rooms,(Me=Md[sc]&&Md[sc].sockets&&Md[sc].sockets[$a.id])?(ad=Fb+" already in "+sc,tf.jumpTo(2)):tf.yield(new Promise(function(Rg,Dh){return $a.join(sc,function(Oi){return Oi?Dh(Oi):Rg()})}),3);2!=tf.nextAddress&&(ad=Fb+" joined "+sc,Qd=!0);pa&&"function"===typeof pa&&pa({status:ad,joined:Qd});tf.jumpToEnd()})},Ec["[broadcast] leave room"]=function(J,W,
pa,$a){var Fb=W.sender,sc=W.data.room,ad,Qd,Md,Me;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tf){if(1==tf.nextAddress)return Qd=!1,Md=J.io.nsps["/"+J.namespace].adapter.rooms,Me=Md[sc]&&Md[sc].sockets&&Md[sc].sockets[$a.id],Me?tf.yield(new Promise(function(Rg,Dh){return $a.leave(sc,function(Oi){return Oi?Dh(Oi):Rg()})}),3):(ad=Fb+" not in "+sc,tf.jumpTo(2));2!=tf.nextAddress&&(ad=Fb+" left room "+sc,Qd=!0);console.log(ad);pa&&"function"===typeof pa&&pa({left:Qd,status:ad});tf.jumpToEnd()})},
Ec["[broadcast] my rooms"]=function(J,W,pa,$a){pa($a.rooms)},Ec["[broadcast] all rooms"]=function(J,W,pa,$a){pa(J.io.nsps["/"+J.namespace].adapter.rooms)},Ec["[broadcast] list room members"]=function(J,W,pa,$a){W=W.data.room;$a=J.io;W?(J=$a.nsps["/"+J.namespace].adapter.rooms[W],pa({room:W,sockets:J?J.sockets:{},length:J?J.length:0})):pa({isError:!0,error:"`room` paramerter missing!"})},Ec.getClients=function(J,W,pa){J.removeDisconnectedClients();pa(Array.from(J.clients))},Ec);zc.defaultTrackerActions=
Wa;zc.defaultTrackerActions=Wa;zc.defaultTrackerActions=Wa;var cd={},Na=(cd.getRoomList=function(J){var W=J.client,pa=J.ackFn,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){$a=W._socketioClient.rooms;pa($a);Fb.jumpToEnd()})},cd["ask for"]=function(J,W,pa,$a){var Fb=W.sender,sc=W.data.query,ad=this,Qd,Md;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Me){if(1==Me.nextAddress)return Qd=sc.match(/password|sudo/i)?"passwordPrompt":"prompt",Me.yield($world[Qd](sc),2);Md=
Me.yieldResult;"function"===typeof pa&&pa({answer:Md});J.debug&&console.log("["+ad+"] message 'ask for' from "+Fb+", query: "+sc);Me.jumpToEnd()})},cd["open editor"]=function(J,W,pa,$a){var Fb=W.data.args,sc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ad){if(1==ad.nextAddress)return Fb.length?ad.yield($world.execCommand("open file for EDITOR",{url:Fb[0]}),2):(pa({error:"no file specified"}),ad.return());sc=ad.yieldResult;"function"===typeof pa&&pa("aborted"===sc?{error:String(sc)}:
{status:sc});ad.jumpToEnd()})},cd.changeWorkingDirectory=function(J,W,pa,$a){var Fb=W.data.args,sc,ad,Qd,Md,Me,tf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rg){sc=$jscomp.makeIterator(Fb||[]);ad=sc.next().value;Qd=sc.next().value;Md="OK";try{if(ad)if(Qd){if(Me=$world.getMorphWithId(Qd))if(Me.__lookupSetter__("cwd"))Me.cwd=ad;else if("function"===typeof Me.changeWorkingDirectory)Me.changeWorkingDirectory(ad);else if("function"===typeof Me.pluginFind){if(tf=Me.pluginFind(function(Dh){return Dh.isShellEditorPlugin}))tf.cwd=
ad}else Md="[changeWorkingDirectory] cannot figure pout how to set dir"}else Md="[changeWorkingDirectory] No command morph";else Md="[changeWorkingDirectory] No directory received"}catch(Dh){Md=String(Dh)}"OK"!==Md&&console.warn(Md);"function"===typeof pa&&pa(Md);Rg.jumpToEnd()})},cd);zc.defaultClientActions=Na;zc.defaultClientActions=Na;zc.defaultClientActions=Na;var bb={},db=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
Sc="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),Fd=bb=function(J){var W=J,pa=J.indexOf("["),$a=J.indexOf("]");-1!=pa&&-1!=$a&&(J=J.substring(0,pa)+J.substring(pa,$a).replace(/:/g,";")+J.substring($a,J.length));var Fb=db.exec(J||"");J={};for(var sc=14;sc--;)J[Sc[sc]]=Fb[sc]||"";-1!=pa&&-1!=$a&&(J.source=W,J.host=J.host.substring(1,J.host.length-1).replace(/;/g,":"),J.authority=J.authority.replace("[","").replace("]","").replace(/;/g,
":"),J.ipv6uri=!0);W=J.path;pa=W.replace(/\/{2,9}/g,"/").split("/");"/"!=W.substr(0,1)&&0!==W.length||pa.splice(0,1);"/"==W.substr(W.length-1,1)&&pa.splice(pa.length-1,1);J.pathNames=pa;J.queryKey=Dc(J,J.query);return J},Pd={},ae=864E5,tc=365.25*ae,Kd=Pd=function(J,W){W=W||{};var pa=typeof J;if("string"===pa&&0<J.length)return Rc(J);if("number"===pa&&!1===isNaN(J))return W.long?$c(J,ae,"day")||$c(J,36E5,"hour")||$c(J,6E4,"minute")||$c(J,1E3,"second")||J+" ms":J>=ae?Math.round(J/ae)+"d":36E5<=J?Math.round(J/
36E5)+"h":6E4<=J?Math.round(J/6E4)+"m":1E3<=J?Math.round(J/1E3)+"s":J+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(J));},Yc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,ub={};ub=ub=gd.debug=gd["default"]=gd;ub.coerce=function(J){return J instanceof Error?J.stack||J.message:J};ub.disable=function(){ub.enable("")};ub.enable=function(J){ub.save(J);ub.names=[];ub.skips=[];var W,pa=("string"===typeof J?J:"").split(/[\s,]+/),
$a=pa.length;for(W=0;W<$a;W++)pa[W]&&(J=pa[W].replace(/\*/g,".*?"),"-"===J[0]?ub.skips.push(new RegExp("^"+J.substr(1)+"$")):ub.names.push(new RegExp("^"+J+"$")));for(W=0;W<ub.instances.length;W++)J=ub.instances[W],J.enabled=ub.enabled(J.namespace)};ub.enabled=function(J){if("*"===J[J.length-1])return!0;var W;var pa=0;for(W=ub.skips.length;pa<W;pa++)if(ub.skips[pa].test(J))return!1;pa=0;for(W=ub.names.length;pa<W;pa++)if(ub.names[pa].test(J))return!0;return!1};ub.humanize=Kd;ub.instances=[];ub.names=
[];ub.skips=[];ub.formatters={};var ja="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,oa={},tb=Qb;oa=oa=ub;oa.log=function(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)};oa.formatArgs=function(J){var W=(this||ja).useColors;J[0]=(W?"%c":"")+(this||ja).namespace+(W?" %c":" ")+J[0]+(W?"%c ":" ")+"+"+oa.humanize((this||ja).diff);if(W){W="color: "+(this||ja).color;J.splice(1,0,W,"color: inherit");var pa=0,
$a=0;J[0].replace(/%[a-zA-Z%]/g,function(Fb){"%%"!==Fb&&(pa++,"%c"===Fb&&($a=pa))});J.splice($a,0,W)}};oa.save=function(J){try{null==J?oa.storage.removeItem("debug"):oa.storage.debug=J}catch(W){}};oa.load=Pa;oa.useColors=function(){return"undefined"!==typeof window&&window.process&&"renderer"===window.process.type?!0:"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&
document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var H=oa;if("undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage)var la=
chrome.storage.local;else a:{try{la=window.localStorage;break a}catch(J){}la=void 0}H.storage=la;oa.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
oa.formatters.j=function(J){try{return JSON.stringify(J)}catch(W){return"[UnexpectedJSONParseError]: "+W.message}};oa.enable(Pa());var Fa=oa,kb="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,fc={};fc=mb;mb.prototype.on=mb.prototype.addEventListener=function(J,W){(this||kb)._callbacks=(this||kb)._callbacks||{};((this||kb)._callbacks["$"+J]=(this||kb)._callbacks["$"+J]||[]).push(W);return this||kb};mb.prototype.once=function(J,W){function pa(){this.off(J,pa);W.apply(this||
kb,arguments)}pa.fn=W;this.on(J,pa);return this||kb};mb.prototype.off=mb.prototype.removeListener=mb.prototype.removeAllListeners=mb.prototype.removeEventListener=function(J,W){(this||kb)._callbacks=(this||kb)._callbacks||{};if(0==arguments.length)return(this||kb)._callbacks={},this||kb;var pa=(this||kb)._callbacks["$"+J];if(!pa)return this||kb;if(1==arguments.length)return delete (this||kb)._callbacks["$"+J],this||kb;for(var $a,Fb=0;Fb<pa.length;Fb++)if($a=pa[Fb],$a===W||$a.fn===W){pa.splice(Fb,
1);break}0===pa.length&&delete (this||kb)._callbacks["$"+J];return this||kb};mb.prototype.emit=function(J){(this||kb)._callbacks=(this||kb)._callbacks||{};for(var W=Array(arguments.length-1),pa=(this||kb)._callbacks["$"+J],$a=1;$a<arguments.length;$a++)W[$a-1]=arguments[$a];if(pa){pa=pa.slice(0);$a=0;for(var Fb=pa.length;$a<Fb;++$a)pa[$a].apply(this||kb,W)}return this||kb};mb.prototype.listeners=function(J){(this||kb)._callbacks=(this||kb)._callbacks||{};return(this||kb)._callbacks["$"+J]||[]};mb.prototype.hasListeners=
function(J){return!!this.listeners(J).length};var Bc=fc,xd={},pd={}.toString,le=xd=Array.isArray||function(J){return"[object Array]"==pd.call(J)},nd={},Rd=Kb.Buffer;nd=function(J){var W;!(W=be&&Rd.isBuffer(J))&&(W=Ce)&&((W=J instanceof ArrayBuffer)||(W="function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(J):J.buffer instanceof ArrayBuffer));return W};var be="function"===typeof Rd&&"function"===typeof Rd.isBuffer,Ce="function"===typeof ArrayBuffer,hf=nd,Le="undefined"!==typeof globalThis?globalThis:
"undefined"!==typeof self?self:global,pc={},Ie=le,rf=hf,sf=Object.prototype.toString,re="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===sf.call(Blob),va="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===sf.call(File);pc.deconstructPacket=function(J){var W=[];J.data=Nb(J.data,W);J.attachments=W.length;return{packet:J,buffers:W}};pc.reconstructPacket=function(J,W){J.data=Ub(J.data,W);J.attachments=void 0;return J};pc.removeBlobs=function(J,
W){function pa(sc,ad,Qd){if(!sc)return sc;if(re&&sc instanceof Blob||va&&sc instanceof File){$a++;var Md=new FileReader;Md.onload=function(){Qd?Qd[ad]=(this||Le).result:Fb=(this||Le).result;--$a||W(Fb)};Md.readAsArrayBuffer(sc)}else if(Ie(sc))for(Md=0;Md<sc.length;Md++)pa(sc[Md],Md,sc);else if("object"===typeof sc&&!rf(sc))for(Md in sc)pa(sc[Md],Md,sc)}var $a=0,Fb=J;pa(Fb);$a||W(Fb)};var Ma="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,jb={},R=Fa("socket.io-parser"),
wa=pc;jb.protocol=4;jb.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" ");jb.CONNECT=0;jb.DISCONNECT=1;jb.EVENT=2;jb.ACK=3;jb.ERROR=4;jb.BINARY_EVENT=5;jb.BINARY_ACK=6;jb.Encoder=Ic;jb.Decoder=Sb;var Za=jb.ERROR+'"encode error"';Ic.prototype.encode=function(J,W){R("encoding packet %j",J);jb.BINARY_EVENT===J.type||jb.BINARY_ACK===J.type?Eb(J,W):(J=wd(J),W([J]))};Bc(Sb.prototype);Sb.prototype.add=function(J){if("string"===typeof J){a:{var W=0,pa={type:Number(J.charAt(0))};
if(null==jb.types[pa.type])J={type:jb.ERROR,data:"parser error: unknown packet type "+pa.type};else{if(jb.BINARY_EVENT===pa.type||jb.BINARY_ACK===pa.type){for(var $a="";"-"!==J.charAt(++W)&&($a+=J.charAt(W),W!=J.length););if($a!=Number($a)||"-"!==J.charAt(W))throw Error("Illegal attachments");pa.attachments=Number($a)}if("/"===J.charAt(W+1))for(pa.nsp="";++W;){$a=J.charAt(W);if(","===$a)break;pa.nsp+=$a;if(W===J.length)break}else pa.nsp="/";$a=J.charAt(W+1);if(""!==$a&&Number($a)==$a){for(pa.id="";++W;){$a=
J.charAt(W);if(null==$a||Number($a)!=$a){--W;break}pa.id+=J.charAt(W);if(W===J.length)break}pa.id=Number(pa.id)}if(J.charAt(++W)){W=J.substr(W);try{var Fb=JSON.parse(W)}catch(sc){Fb=!1}if(!1===Fb||pa.type!==jb.ERROR&&!le(Fb)){J={type:jb.ERROR,data:"parser error: invalid payload"};break a}else pa.data=Fb}R("decoded %s as %j",J,pa);J=pa}}jb.BINARY_EVENT===J.type||jb.BINARY_ACK===J.type?((this||Ma).reconstructor=new sb(J),0===(this||Ma).reconstructor.reconPack.attachments&&this.emit("decoded",J)):this.emit("decoded",
J)}else if(hf(J)||J.base64)if((this||Ma).reconstructor){if(J=(this||Ma).reconstructor.takeBinaryData(J))(this||Ma).reconstructor=null,this.emit("decoded",J)}else throw Error("got binary data when not reconstructing a packet");else throw Error("Unknown type: "+J);};Sb.prototype.destroy=function(){(this||Ma).reconstructor&&(this||Ma).reconstructor.finishedReconstruction()};sb.prototype.takeBinaryData=function(J){(this||Ma).buffers.push(J);return(this||Ma).buffers.length===(this||Ma).reconPack.attachments?
(J=wa.reconstructPacket((this||Ma).reconPack,(this||Ma).buffers),this.finishedReconstruction(),J):null};sb.prototype.finishedReconstruction=function(){(this||Ma).reconPack=null;(this||Ma).buffers=[]};var eb={};try{eb="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(J){eb=!1}var hc=eb,ic={},Qc=ic="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")(),Pc={},Nc=Pc=function(J){var W=J.xdomain,pa=J.xscheme;J=J.enablesXDR;try{if("undefined"!==
typeof XMLHttpRequest&&(!W||hc))return new XMLHttpRequest}catch($a){}try{if("undefined"!==typeof XDomainRequest&&!pa&&J)return new XDomainRequest}catch($a){}if(!W)try{return new (Qc[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch($a){}},He={},ie=Kb.Buffer,df=le,lg=Object.prototype.toString,rh="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===lg.call(Blob),Cg="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===lg.call(File),
Wh=He=ec,wg={},Zi=wg=function(J,W,pa){var $a=J.byteLength;W=W||0;pa=pa||$a;if(J.slice)return J.slice(W,pa);0>W&&(W+=$a);0>pa&&(pa+=$a);pa>$a&&(pa=$a);if(W>=$a||W>=pa||0===$a)return new ArrayBuffer(0);J=new Uint8Array(J);$a=new Uint8Array(pa-W);for(var Fb=0;W<pa;W++,Fb++)$a[Fb]=J[W];return $a.buffer},Mf={},Ei=Mf=function(J,W,pa){function $a(sc,ad){if(0>=$a.count)throw Error("after called too many times");--$a.count;sc?(Fb=!0,W(sc),W=pa):0!==$a.count||Fb||W(null,ad)}var Fb=!1;pa=pa||rc;$a.count=J;return 0===
J?W():$a},Gg={};(function(J){Gg.encode=function(W){W=new Uint8Array(W);var pa,$a=W.length,Fb="";for(pa=0;pa<$a;pa+=3)Fb+=J[W[pa]>>2],Fb+=J[(W[pa]&3)<<4|W[pa+1]>>4],Fb+=J[(W[pa+1]&15)<<2|W[pa+2]>>6],Fb+=J[W[pa+2]&63];2===$a%3?Fb=Fb.substring(0,Fb.length-1)+"=":1===$a%3&&(Fb=Fb.substring(0,Fb.length-2)+"==");return Fb};Gg.decode=function(W){var pa=.75*W.length,$a=W.length,Fb=0;"="===W[W.length-1]&&(pa--,"="===W[W.length-2]&&pa--);var sc=new ArrayBuffer(pa),ad=new Uint8Array(sc);for(pa=0;pa<$a;pa+=4){var Qd=
J.indexOf(W[pa]);var Md=J.indexOf(W[pa+1]);var Me=J.indexOf(W[pa+2]);var tf=J.indexOf(W[pa+3]);ad[Fb++]=Qd<<2|Md>>4;ad[Fb++]=(Md&15)<<4|Me>>2;ad[Fb++]=(Me&3)<<6|tf&63}return sc}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/");var ri={},wi="undefined"!==typeof wi?wi:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!==typeof MSBlobBuilder?MSBlobBuilder:"undefined"!==typeof MozBlobBuilder?MozBlobBuilder:!1;try{var mk=2===(new Blob(["hi"])).size}catch(J){mk=!1}var pj;
if(pj=mk)try{pj=2===(new Blob([new Uint8Array([1,2])])).size}catch(J){pj=!1}var Ni=pj,nk=wi&&wi.prototype.append&&wi.prototype.getBlob;"undefined"!==typeof Blob&&(Db.prototype=Blob.prototype,ab.prototype=Blob.prototype);ri=mk?Ni?Blob:ab:nk?Db:void 0;var ii=ri,Di={},Xl=Di=Object.keys||function(J){var W=[],pa=Object.prototype.hasOwnProperty,$a;for($a in J)pa.call(J,$a)&&W.push($a);return W},Ue={},sj=String.fromCharCode,Bb,Mc,gc;Ue={version:"2.1.2",encode:function(J,W){W=W||{};W=!1!==W.strict;J=Zb(J);
for(var pa=J.length,$a=-1,Fb,sc="";++$a<pa;){Fb=J[$a];var ad=W;if(0==(Fb&4294967168))Fb=sj(Fb);else{var Qd="";0==(Fb&4294965248)?Qd=sj(Fb>>6&31|192):0==(Fb&4294901760)?(kc(Fb,ad)||(Fb=65533),Qd=sj(Fb>>12&15|224),Qd+=sj(Fb>>6&63|128)):0==(Fb&4292870144)&&(Qd=sj(Fb>>18&7|240),Qd+=sj(Fb>>12&63|128),Qd+=sj(Fb>>6&63|128));Fb=Qd+=sj(Fb&63|128)}sc+=Fb}return sc},decode:function(J,W){W=W||{};W=!1!==W.strict;Bb=Zb(J);Mc=Bb.length;gc=0;J=[];for(var pa;!1!==(pa=Ga(W));)J.push(pa);W=J.length;pa=-1;for(var $a,
Fb="";++pa<W;)$a=J[pa],65535<$a&&($a-=65536,Fb+=sj($a>>>10&1023|55296),$a=56320|$a&1023),Fb+=sj($a);return Fb}};var id={},Cf=Ei,Lf=Ue,xi;"undefined"!==typeof ArrayBuffer&&(xi=Gg);var rl="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),Tl="undefined"!==typeof navigator&&/PhantomJS/i.test(navigator.userAgent),pn=rl||Tl;id.protocol=3;var nl=id.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},ol=Xl(nl),yh={type:"error",data:"parser error"};id.encodePacket=function(J,
W,pa,$a){"function"===typeof W&&($a=W,W=!1);"function"===typeof pa&&($a=pa,pa=null);var Fb=void 0===J.data?void 0:J.data.buffer||J.data;if("undefined"!==typeof ArrayBuffer&&Fb instanceof ArrayBuffer){if(W){pa=J.data;W=new Uint8Array(pa);pa=new Uint8Array(1+pa.byteLength);pa[0]=nl[J.type];for(J=0;J<W.length;J++)pa[J+1]=W[J];J=$a(pa.buffer)}else J=id.encodeBase64Packet(J,$a);return J}if("undefined"!==typeof ii&&Fb instanceof ii)return W?pn?J=cb(J,W,$a):(W=new Uint8Array(1),W[0]=nl[J.type],J=new ii([W.buffer,
J.data]),J=$a(J)):J=id.encodeBase64Packet(J,$a),J;if(Fb&&Fb.base64)return $a("b"+id.packets[J.type]+J.data.data);W=nl[J.type];void 0!==J.data&&(W+=pa?Lf.encode(String(J.data),{strict:!1}):String(J.data));return $a(""+W)};id.encodeBase64Packet=function(J,W){var pa="b"+id.packets[J.type];if("undefined"!==typeof ii&&J.data instanceof ii){var $a=new FileReader;$a.onload=function(){var ad=$a.result.split(",")[1];W(pa+ad)};return $a.readAsDataURL(J.data)}try{var Fb=String.fromCharCode.apply(null,new Uint8Array(J.data))}catch(ad){J=
new Uint8Array(J.data);Fb=Array(J.length);for(var sc=0;sc<J.length;sc++)Fb[sc]=J[sc];Fb=String.fromCharCode.apply(null,Fb)}pa+=btoa(Fb);return W(pa)};id.decodePacket=function(J,W,pa){if(void 0===J)return yh;if("string"===typeof J){if("b"===J.charAt(0))return id.decodeBase64Packet(J.substr(1),W);if(pa){a:{W=J;try{W=Lf.decode(W,{strict:!1})}catch($a){J=!1;break a}J=W}if(!1===J)return yh}pa=J.charAt(0);return Number(pa)==pa&&ol[pa]?1<J.length?{type:ol[pa],data:J.substring(1)}:{type:ol[pa]}:yh}pa=(new Uint8Array(J))[0];
J=Zi(J,1);ii&&"blob"===W&&(J=new ii([J]));return{type:ol[pa],data:J}};id.decodeBase64Packet=function(J,W){var pa=ol[J.charAt(0)];if(!xi)return{type:pa,data:{base64:!0,data:J.substr(1)}};J=xi.decode(J.substr(1));"blob"===W&&ii&&(J=new ii([J]));return{type:pa,data:J}};id.encodePayload=function(J,W,pa){"function"===typeof W&&(pa=W,W=null);var $a=Wh(J);if(W&&$a)return ii&&!pn?id.encodePayloadAsBlob(J,pa):id.encodePayloadAsArrayBuffer(J,pa);if(!J.length)return pa("0:");rb(J,function(Fb,sc){id.encodePacket(Fb,
$a?W:!1,!1,function(ad){sc(null,ad.length+":"+ad)})},function(Fb,sc){return pa(sc.join(""))})};id.decodePayload=function(J,W,pa){if("string"!==typeof J)return id.decodePayloadAsBinary(J,W,pa);"function"===typeof W&&(pa=W,W=null);if(""===J)return pa(yh,0,1);var $a="";for(var Fb,sc,ad=0,Qd=J.length;ad<Qd;ad++)if(sc=J.charAt(ad),":"!==sc)$a+=sc;else{if(""===$a||$a!=(Fb=Number($a)))return pa(yh,0,1);sc=J.substr(ad+1,Fb);if($a!=sc.length)return pa(yh,0,1);if(sc.length){$a=id.decodePacket(sc,W,!1);if(yh.type===
$a.type&&yh.data===$a.data)return pa(yh,0,1);if(!1===pa($a,ad+Fb,Qd))return}ad+=Fb;$a=""}if(""!==$a)return pa(yh,0,1)};id.encodePayloadAsArrayBuffer=function(J,W){if(!J.length)return W(new ArrayBuffer(0));rb(J,function(pa,$a){id.encodePacket(pa,!0,!0,function(Fb){return $a(null,Fb)})},function(pa,$a){pa=$a.reduce(function(ad,Qd){Qd="string"===typeof Qd?Qd.length:Qd.byteLength;return ad+Qd.toString().length+Qd+2},0);var Fb=new Uint8Array(pa),sc=0;$a.forEach(function(ad){var Qd="string"===typeof ad,
Md=ad;if(Qd){Md=new Uint8Array(ad.length);for(var Me=0;Me<ad.length;Me++)Md[Me]=ad.charCodeAt(Me);Md=Md.buffer}Qd?Fb[sc++]=0:Fb[sc++]=1;ad=Md.byteLength.toString();for(Me=0;Me<ad.length;Me++)Fb[sc++]=parseInt(ad[Me]);Fb[sc++]=255;Md=new Uint8Array(Md);for(Me=0;Me<Md.length;Me++)Fb[sc++]=Md[Me]});return W(Fb.buffer)})};id.encodePayloadAsBlob=function(J,W){rb(J,function(pa,$a){id.encodePacket(pa,!0,!0,function(Fb){var sc=new Uint8Array(1);sc[0]=1;if("string"===typeof Fb){for(var ad=new Uint8Array(Fb.length),
Qd=0;Qd<Fb.length;Qd++)ad[Qd]=Fb.charCodeAt(Qd);Fb=ad.buffer;sc[0]=0}ad=(Fb instanceof ArrayBuffer?Fb.byteLength:Fb.size).toString();var Md=new Uint8Array(ad.length+1);for(Qd=0;Qd<ad.length;Qd++)Md[Qd]=parseInt(ad[Qd]);Md[ad.length]=255;ii&&(Fb=new ii([sc.buffer,Md.buffer,Fb]),$a(null,Fb))})},function(pa,$a){return W(new ii($a))})};id.decodePayloadAsBinary=function(J,W,pa){"function"===typeof W&&(pa=W,W=null);for(var $a=[];0<J.byteLength;){for(var Fb=new Uint8Array(J),sc=0===Fb[0],ad="",Qd=1;255!==
Fb[Qd];Qd++){if(310<ad.length)return pa(yh,0,1);ad+=Fb[Qd]}J=Zi(J,2+ad.length);ad=parseInt(ad);Fb=Zi(J,0,ad);if(sc)try{Fb=String.fromCharCode.apply(null,new Uint8Array(Fb))}catch(Me){for(sc=new Uint8Array(Fb),Fb="",Qd=0;Qd<sc.length;Qd++)Fb+=String.fromCharCode(sc[Qd])}$a.push(Fb);J=Zi(J,ad)}var Md=$a.length;$a.forEach(function(Me,tf){pa(id.decodePacket(Me,W,!0),tf,Md)})};for(var Hk={encode:function(J){var W="",pa;for(pa in J)J.hasOwnProperty(pa)&&(W.length&&(W+="&"),W+=encodeURIComponent(pa)+"="+
encodeURIComponent(J[pa]));return W},decode:function(J){var W={};J=J.split("&");for(var pa=0,$a=J.length;pa<$a;pa++){var Fb=J[pa].split("=");W[decodeURIComponent(Fb[0])]=decodeURIComponent(Fb[1])}return W}},Ul={},ql=Ul=function(J,W){var pa=function(){};pa.prototype=W.prototype;J.prototype=new pa;J.prototype.constructor=J},pl={},ym="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ik={},Jk=0,qj=0,rj;64>qj;qj++)Ik[ym[qj]]=qj;Ta.encode=pb;Ta.decode=function(J){var W=0;for(qj=
0;qj<J.length;qj++)W=64*W+Ik[J.charAt(qj)];return W};var ak=pl=Ta,Gf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Vk={},Wk=id;Vk=Ua;Bc(Ua.prototype);Ua.prototype.onError=function(J,W){J=Error(J);J.type="TransportError";J.description=W;this.emit("error",J);return this||Gf};Ua.prototype.open=function(){if("closed"===(this||Gf).readyState||""===(this||Gf).readyState)(this||Gf).readyState="opening",this.doOpen();return this||Gf};Ua.prototype.close=function(){if("opening"===
(this||Gf).readyState||"open"===(this||Gf).readyState)this.doClose(),this.onClose();return this||Gf};Ua.prototype.send=function(J){if("open"===(this||Gf).readyState)this.write(J);else throw Error("Transport not open");};Ua.prototype.onOpen=function(){(this||Gf).readyState="open";(this||Gf).writable=!0;this.emit("open")};Ua.prototype.onData=function(J){J=Wk.decodePacket(J,(this||Gf).socket.binaryType);this.onPacket(J)};Ua.prototype.onPacket=function(J){this.emit("packet",J)};Ua.prototype.onClose=function(){(this||
Gf).readyState="closed";this.emit("close")};var Vl=Vk,gf="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Pj={},Zj=Vl,Yi=id,Ih=Fa("engine.io-client:polling");Pj=ob;var jj=null!=(new Nc({xdomain:!1})).responseType;ql(ob,Zj);ob.prototype.name="polling";ob.prototype.doOpen=function(){this.poll()};ob.prototype.pause=function(J){function W(){Ih("paused");pa.readyState="paused";J()}var pa=this||gf;(this||gf).readyState="pausing";if((this||gf).polling||!(this||gf).writable){var $a=
0;(this||gf).polling&&(Ih("we are currently polling - waiting to pause"),$a++,this.once("pollComplete",function(){Ih("pre-pause polling complete");--$a||W()}));(this||gf).writable||(Ih("we are currently writing - waiting to pause"),$a++,this.once("drain",function(){Ih("pre-pause writing complete");--$a||W()}))}else W()};ob.prototype.poll=function(){Ih("polling");(this||gf).polling=!0;this.doPoll();this.emit("poll")};ob.prototype.onData=function(J){var W=this||gf;Ih("polling got data %s",J);Yi.decodePayload(J,
(this||gf).socket.binaryType,function(pa,$a,Fb){if("opening"===W.readyState)W.onOpen();if("close"===pa.type)return W.onClose(),!1;W.onPacket(pa)});"closed"!==(this||gf).readyState&&((this||gf).polling=!1,this.emit("pollComplete"),"open"===(this||gf).readyState?this.poll():Ih('ignoring poll - transport state "%s"',(this||gf).readyState))};ob.prototype.doClose=function(){function J(){Ih("writing close packet");W.write([{type:"close"}])}var W=this||gf;"open"===(this||gf).readyState?(Ih("transport open - closing"),
J()):(Ih("transport not open - deferring close"),this.once("open",J))};ob.prototype.write=function(J){var W=this||gf;(this||gf).writable=!1;var pa=function(){W.writable=!0;W.emit("drain")};Yi.encodePayload(J,(this||gf).supportsBinary,function($a){W.doWrite($a,pa)})};ob.prototype.uri=function(){var J=(this||gf).query||{},W=(this||gf).secure?"https":"http",pa="";!1!==(this||gf).timestampRequests&&(J[(this||gf).timestampParam]=ak());(this||gf).supportsBinary||J.sid||(J.b64=1);J=Hk.encode(J);(this||gf).port&&
("https"===W&&443!==Number((this||gf).port)||"http"===W&&80!==Number((this||gf).port))&&(pa=":"+(this||gf).port);J.length&&(J="?"+J);var $a=-1!==(this||gf).hostname.indexOf(":");return W+"://"+($a?"["+(this||gf).hostname+"]":(this||gf).hostname)+pa+(this||gf).path+J};var Xk=Pj,me="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,xk={},qn=Xk,Wl=Fa("engine.io-client:polling-xhr");xk=lc;xk.Request=Lb;ql(lc,qn);lc.prototype.supportsBinary=!0;lc.prototype.request=function(J){J=
J||{};J.uri=this.uri();J.xd=(this||me).xd;J.xs=(this||me).xs;J.agent=(this||me).agent||!1;J.supportsBinary=(this||me).supportsBinary;J.enablesXDR=(this||me).enablesXDR;J.withCredentials=(this||me).withCredentials;J.pfx=(this||me).pfx;J.key=(this||me).key;J.passphrase=(this||me).passphrase;J.cert=(this||me).cert;J.ca=(this||me).ca;J.ciphers=(this||me).ciphers;J.rejectUnauthorized=(this||me).rejectUnauthorized;J.requestTimeout=(this||me).requestTimeout;J.extraHeaders=(this||me).extraHeaders;return new Lb(J)};
lc.prototype.doWrite=function(J,W){J=this.request({method:"POST",data:J,isBinary:"string"!==typeof J&&void 0!==J});var pa=this||me;J.on("success",W);J.on("error",function($a){pa.onError("xhr post error",$a)});(this||me).sendXhr=J};lc.prototype.doPoll=function(){Wl("xhr poll");var J=this.request(),W=this||me;J.on("data",function(pa){W.onData(pa)});J.on("error",function(pa){W.onError("xhr poll error",pa)});(this||me).pollXhr=J};Bc(Lb.prototype);Lb.prototype.create=function(){var J={agent:(this||me).agent,
xdomain:(this||me).xd,xscheme:(this||me).xs,enablesXDR:(this||me).enablesXDR};J.pfx=(this||me).pfx;J.key=(this||me).key;J.passphrase=(this||me).passphrase;J.cert=(this||me).cert;J.ca=(this||me).ca;J.ciphers=(this||me).ciphers;J.rejectUnauthorized=(this||me).rejectUnauthorized;var W=(this||me).xhr=new Nc(J),pa=this||me;try{Wl("xhr open %s: %s",(this||me).method,(this||me).uri);W.open((this||me).method,(this||me).uri,(this||me).async);try{if((this||me).extraHeaders){W.setDisableHeaderCheck&&W.setDisableHeaderCheck(!0);
for(var $a in(this||me).extraHeaders)(this||me).extraHeaders.hasOwnProperty($a)&&W.setRequestHeader($a,(this||me).extraHeaders[$a])}}catch(Fb){}if("POST"===(this||me).method)try{(this||me).isBinary?W.setRequestHeader("Content-type","application/octet-stream"):W.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(Fb){}try{W.setRequestHeader("Accept","*/*")}catch(Fb){}"withCredentials"in W&&(W.withCredentials=(this||me).withCredentials);(this||me).requestTimeout&&(W.timeout=(this||me).requestTimeout);
this.hasXDR()?(W.onload=function(){pa.onLoad()},W.onerror=function(){pa.onError(W.responseText)}):W.onreadystatechange=function(){if(2===W.readyState)try{var Fb=W.getResponseHeader("Content-Type");if(pa.supportsBinary&&"application/octet-stream"===Fb||"application/octet-stream; charset=UTF-8"===Fb)W.responseType="arraybuffer"}catch(sc){}if(4===W.readyState)if(200===W.status||1223===W.status)pa.onLoad();else setTimeout(function(){pa.onError("number"===typeof W.status?W.status:0)},0)};Wl("xhr data %s",
(this||me).data);W.send((this||me).data)}catch(Fb){setTimeout(function(){pa.onError(Fb)},0);return}"undefined"!==typeof document&&((this||me).index=Lb.requestsCount++,Lb.requests[(this||me).index]=this||me)};Lb.prototype.onSuccess=function(){this.emit("success");this.cleanup()};Lb.prototype.onData=function(J){this.emit("data",J);this.onSuccess()};Lb.prototype.onError=function(J){this.emit("error",J);this.cleanup(!0)};Lb.prototype.cleanup=function(J){if("undefined"!==typeof(this||me).xhr&&null!==(this||
me).xhr){this.hasXDR()?(this||me).xhr.onload=(this||me).xhr.onerror=Wb:(this||me).xhr.onreadystatechange=Wb;if(J)try{(this||me).xhr.abort()}catch(W){}"undefined"!==typeof document&&delete Lb.requests[(this||me).index];(this||me).xhr=null}};Lb.prototype.onLoad=function(){try{try{var J=(this||me).xhr.getResponseHeader("Content-Type")}catch(pa){}var W="application/octet-stream"===J||"application/octet-stream; charset=UTF-8"===J?(this||me).xhr.response||(this||me).xhr.responseText:(this||me).xhr.responseText}catch(pa){this.onError(pa)}if(null!=
W)this.onData(W)};Lb.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!(this||me).xs&&(this||me).enablesXDR};Lb.prototype.abort=function(){this.cleanup()};Lb.requestsCount=0;Lb.requests={};"undefined"!==typeof document&&("function"===typeof attachEvent?attachEvent("onunload",qc):"function"===typeof addEventListener&&addEventListener("onpagehide"in Qc?"pagehide":"unload",qc,!1));var bk=xk,Um={},rn=[].indexOf,sn=Um=function(J,W){if(rn)return J.indexOf(W);for(var pa=0;pa<J.length;++pa)if(J[pa]===
W)return pa;return-1},Dg="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,tn={},yk=Xk,sl=Qc;tn=V;var ok=/\n/g,Qj=/\\n/g,ck;ql(V,yk);V.prototype.supportsBinary=!1;V.prototype.doClose=function(){(this||Dg).script&&((this||Dg).script.parentNode.removeChild((this||Dg).script),(this||Dg).script=null);(this||Dg).form&&((this||Dg).form.parentNode.removeChild((this||Dg).form),(this||Dg).form=null,(this||Dg).iframe=null);yk.prototype.doClose.call(this||Dg)};V.prototype.doPoll=
function(){var J=this||Dg,W=document.createElement("script");(this||Dg).script&&((this||Dg).script.parentNode.removeChild((this||Dg).script),(this||Dg).script=null);W.async=!0;W.src=this.uri();W.onerror=function($a){J.onError("jsonp poll error",$a)};var pa=document.getElementsByTagName("script")[0];pa?pa.parentNode.insertBefore(W,pa):(document.head||document.body).appendChild(W);(this||Dg).script=W;"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var $a=document.createElement("iframe");
document.body.appendChild($a);document.body.removeChild($a)},100)};V.prototype.doWrite=function(J,W){function pa(){$a();W()}function $a(){if(Fb.iframe)try{Fb.form.removeChild(Fb.iframe)}catch(Me){Fb.onError("jsonp polling iframe removal error",Me)}try{Md=document.createElement('<iframe src="javascript:0" name="'+Fb.iframeId+'">')}catch(Me){Md=document.createElement("iframe"),Md.name=Fb.iframeId,Md.src="javascript:0"}Md.id=Fb.iframeId;Fb.form.appendChild(Md);Fb.iframe=Md}var Fb=this||Dg;if(!(this||
Dg).form){var sc=document.createElement("form"),ad=document.createElement("textarea"),Qd=(this||Dg).iframeId="eio_iframe_"+(this||Dg).index,Md;sc.className="socketio";sc.style.position="absolute";sc.style.top="-1000px";sc.style.left="-1000px";sc.target=Qd;sc.method="POST";sc.setAttribute("accept-charset","utf-8");ad.name="d";sc.appendChild(ad);document.body.appendChild(sc);(this||Dg).form=sc;(this||Dg).area=ad}(this||Dg).form.action=this.uri();$a();J=J.replace(Qj,"\\\n");(this||Dg).area.value=J.replace(ok,
"\\n");try{(this||Dg).form.submit()}catch(Me){}(this||Dg).iframe.attachEvent?(this||Dg).iframe.onreadystatechange=function(){"complete"===Fb.iframe.readyState&&pa()}:(this||Dg).iframe.onload=pa};var Rj=tn,tl=Object.freeze({}),ca="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Ea={},Qa=Kb.Buffer,La=Vl,Tb=id,Mb=Fa("engine.io-client:websocket"),dc;"undefined"!==typeof WebSocket?dc=WebSocket:"undefined"!==typeof self&&(dc=self.WebSocket||self.MozWebSocket);if("undefined"===
typeof window)try{var nc=tl}catch(J){}var ed=dc||nc;Ea=ra;ql(ra,La);ra.prototype.name="websocket";ra.prototype.supportsBinary=!0;ra.prototype.doOpen=function(){if(this.check()){var J=this.uri(),W=(this||ca).protocols,pa={};(this||ca).isReactNative||(pa.agent=(this||ca).agent,pa.perMessageDeflate=(this||ca).perMessageDeflate,pa.pfx=(this||ca).pfx,pa.key=(this||ca).key,pa.passphrase=(this||ca).passphrase,pa.cert=(this||ca).cert,pa.ca=(this||ca).ca,pa.ciphers=(this||ca).ciphers,pa.rejectUnauthorized=
(this||ca).rejectUnauthorized);(this||ca).extraHeaders&&(pa.headers=(this||ca).extraHeaders);(this||ca).localAddress&&(pa.localAddress=(this||ca).localAddress);try{(this||ca).ws=(this||ca).usingBrowserWebSocket&&!(this||ca).isReactNative?W?new ed(J,W):new ed(J):new ed(J,W,pa)}catch($a){return this.emit("error",$a)}void 0===(this||ca).ws.binaryType&&((this||ca).supportsBinary=!1);(this||ca).ws.supports&&(this||ca).ws.supports.binary?((this||ca).supportsBinary=!0,(this||ca).ws.binaryType="nodebuffer"):
(this||ca).ws.binaryType="arraybuffer";this.addEventListeners()}};ra.prototype.addEventListeners=function(){var J=this||ca;(this||ca).ws.onopen=function(){J.onOpen()};(this||ca).ws.onclose=function(){J.onClose()};(this||ca).ws.onmessage=function(W){J.onData(W.data)};(this||ca).ws.onerror=function(W){J.onError("websocket error",W)}};ra.prototype.write=function(J){function W(){pa.emit("flush");setTimeout(function(){pa.writable=!0;pa.emit("drain")},0)}var pa=this||ca;(this||ca).writable=!1;for(var $a=
J.length,Fb=0,sc=$a;Fb<sc;Fb++)(function(ad){Tb.encodePacket(ad,pa.supportsBinary,function(Qd){if(!pa.usingBrowserWebSocket){var Md={};ad.options&&(Md.compress=ad.options.compress);pa.perMessageDeflate&&("string"===typeof Qd?Qa.byteLength(Qd):Qd.length)<pa.perMessageDeflate.threshold&&(Md.compress=!1)}try{pa.usingBrowserWebSocket?pa.ws.send(Qd):pa.ws.send(Qd,Md)}catch(Me){Mb("websocket closed before onclose event")}--$a||W()})})(J[Fb])};ra.prototype.onClose=function(){La.prototype.onClose.call(this||
ca)};ra.prototype.doClose=function(){"undefined"!==typeof(this||ca).ws&&(this||ca).ws.close()};ra.prototype.uri=function(){var J=(this||ca).query||{},W=(this||ca).secure?"wss":"ws",pa="";(this||ca).port&&("wss"===W&&443!==Number((this||ca).port)||"ws"===W&&80!==Number((this||ca).port))&&(pa=":"+(this||ca).port);(this||ca).timestampRequests&&(J[(this||ca).timestampParam]=ak());(this||ca).supportsBinary||(J.b64=1);J=Hk.encode(J);J.length&&(J="?"+J);var $a=-1!==(this||ca).hostname.indexOf(":");return W+
"://"+($a?"["+(this||ca).hostname+"]":(this||ca).hostname)+pa+(this||ca).path+J};ra.prototype.check=function(){return!!ed&&!("__initialize"in ed&&(this||ca).name===ra.prototype.name)};var Ke={},Ze=Ea;Ke.polling=function(J){var W=!1,pa=!1,$a=!1!==J.jsonp;"undefined"!==typeof location&&(pa="https:"===location.protocol,(W=location.port)||(W=pa?443:80),W=J.hostname!==location.hostname||W!==J.port,pa=J.secure!==pa);J.xdomain=W;J.xscheme=pa;if("open"in new Nc(J)&&!J.forceJSONP)return new bk(J);if(!$a)throw Error("JSONP disabled");
return new Rj(J)};Ke.websocket=Ze;var Jc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,yf={},uf=Fa("engine.io-client:socket"),yi=id,Oj=Fd,zm=Hk;yf=ya;ya.priorWebsocketSuccess=!1;Bc(ya.prototype);ya.protocol=yi.protocol;ya.Socket=ya;ya.Transport=Vl;ya.transports=Ke;ya.parser=id;ya.prototype.createTransport=function(J){uf('creating transport "%s"',J);var W=(this||Jc).query,pa={},$a;for($a in W)W.hasOwnProperty($a)&&(pa[$a]=W[$a]);pa.EIO=yi.protocol;pa.transport=J;
W=(this||Jc).transportOptions[J]||{};(this||Jc).id&&(pa.sid=(this||Jc).id);return new Ke[J]({query:pa,socket:this||Jc,agent:W.agent||(this||Jc).agent,hostname:W.hostname||(this||Jc).hostname,port:W.port||(this||Jc).port,secure:W.secure||(this||Jc).secure,path:W.path||(this||Jc).path,forceJSONP:W.forceJSONP||(this||Jc).forceJSONP,jsonp:W.jsonp||(this||Jc).jsonp,forceBase64:W.forceBase64||(this||Jc).forceBase64,enablesXDR:W.enablesXDR||(this||Jc).enablesXDR,withCredentials:W.withCredentials||(this||
Jc).withCredentials,timestampRequests:W.timestampRequests||(this||Jc).timestampRequests,timestampParam:W.timestampParam||(this||Jc).timestampParam,policyPort:W.policyPort||(this||Jc).policyPort,pfx:W.pfx||(this||Jc).pfx,key:W.key||(this||Jc).key,passphrase:W.passphrase||(this||Jc).passphrase,cert:W.cert||(this||Jc).cert,ca:W.ca||(this||Jc).ca,ciphers:W.ciphers||(this||Jc).ciphers,rejectUnauthorized:W.rejectUnauthorized||(this||Jc).rejectUnauthorized,perMessageDeflate:W.perMessageDeflate||(this||Jc).perMessageDeflate,
extraHeaders:W.extraHeaders||(this||Jc).extraHeaders,forceNode:W.forceNode||(this||Jc).forceNode,localAddress:W.localAddress||(this||Jc).localAddress,requestTimeout:W.requestTimeout||(this||Jc).requestTimeout,protocols:W.protocols||void 0,isReactNative:(this||Jc).isReactNative})};ya.prototype.open=function(){if((this||Jc).rememberUpgrade&&ya.priorWebsocketSuccess&&-1!==(this||Jc).transports.indexOf("websocket"))var J="websocket";else{if(0===(this||Jc).transports.length){var W=this||Jc;setTimeout(function(){W.emit("error",
"No transports available")},0);return}J=(this||Jc).transports[0]}(this||Jc).readyState="opening";try{J=this.createTransport(J)}catch(pa){(this||Jc).transports.shift();this.open();return}J.open();this.setTransport(J)};ya.prototype.setTransport=function(J){uf("setting transport %s",J.name);var W=this||Jc;(this||Jc).transport&&(uf("clearing existing transport %s",(this||Jc).transport.name),(this||Jc).transport.removeAllListeners());(this||Jc).transport=J;J.on("drain",function(){W.onDrain()}).on("packet",
function(pa){W.onPacket(pa)}).on("error",function(pa){W.onError(pa)}).on("close",function(){W.onClose("transport close")})};ya.prototype.probe=function(J){function W(){if(tf.onlyBinaryUpgrades){var Rg=!(this||Jc).supportsBinary&&tf.transport.supportsBinary;Me=Me||Rg}Me||(uf('probe transport "%s" opened',J),Md.send([{type:"ping",data:"probe"}]),Md.once("packet",function(Dh){Me||("pong"===Dh.type&&"probe"===Dh.data?(uf('probe transport "%s" pong',J),tf.upgrading=!0,tf.emit("upgrading",Md),Md&&(ya.priorWebsocketSuccess=
"websocket"===Md.name,uf('pausing current transport "%s"',tf.transport.name),tf.transport.pause(function(){Me||"closed"===tf.readyState||(uf("changing transport and sending upgrade packet"),Qd(),tf.setTransport(Md),Md.send([{type:"upgrade"}]),tf.emit("upgrade",Md),Md=null,tf.upgrading=!1,tf.flush())}))):(uf('probe transport "%s" failed',J),Dh=Error("probe error"),Dh.transport=Md.name,tf.emit("upgradeError",Dh)))}))}function pa(){Me||(Me=!0,Qd(),Md.close(),Md=null)}function $a(Rg){var Dh=Error("probe error: "+
Rg);Dh.transport=Md.name;pa();uf('probe transport "%s" failed because of error: %s',J,Rg);tf.emit("upgradeError",Dh)}function Fb(){$a("transport closed")}function sc(){$a("socket closed")}function ad(Rg){Md&&Rg.name!==Md.name&&(uf('"%s" works - aborting "%s"',Rg.name,Md.name),pa())}function Qd(){Md.removeListener("open",W);Md.removeListener("error",$a);Md.removeListener("close",Fb);tf.removeListener("close",sc);tf.removeListener("upgrading",ad)}uf('probing transport "%s"',J);var Md=this.createTransport(J,
{probe:1}),Me=!1,tf=this||Jc;ya.priorWebsocketSuccess=!1;Md.once("open",W);Md.once("error",$a);Md.once("close",Fb);this.once("close",sc);this.once("upgrading",ad);Md.open()};ya.prototype.onOpen=function(){uf("socket open");(this||Jc).readyState="open";ya.priorWebsocketSuccess="websocket"===(this||Jc).transport.name;this.emit("open");this.flush();if("open"===(this||Jc).readyState&&(this||Jc).upgrade&&(this||Jc).transport.pause){uf("starting upgrade probes");for(var J=0,W=(this||Jc).upgrades.length;J<
W;J++)this.probe((this||Jc).upgrades[J])}};ya.prototype.onPacket=function(J){if("opening"===(this||Jc).readyState||"open"===(this||Jc).readyState||"closing"===(this||Jc).readyState)switch(uf('socket receive: type "%s", data "%s"',J.type,J.data),this.emit("packet",J),this.emit("heartbeat"),J.type){case "open":this.onHandshake(JSON.parse(J.data));break;case "pong":this.setPing();this.emit("pong");break;case "error":var W=Error("server error");W.code=J.data;this.onError(W);break;case "message":this.emit("data",
J.data),this.emit("message",J.data)}else uf('packet received with socket readyState "%s"',(this||Jc).readyState)};ya.prototype.onHandshake=function(J){this.emit("handshake",J);(this||Jc).id=J.sid;(this||Jc).transport.query.sid=J.sid;(this||Jc).upgrades=this.filterUpgrades(J.upgrades);(this||Jc).pingInterval=J.pingInterval;(this||Jc).pingTimeout=J.pingTimeout;this.onOpen();"closed"!==(this||Jc).readyState&&(this.setPing(),this.removeListener("heartbeat",(this||Jc).onHeartbeat),this.on("heartbeat",
(this||Jc).onHeartbeat))};ya.prototype.onHeartbeat=function(J){clearTimeout((this||Jc).pingTimeoutTimer);var W=this||Jc;W.pingTimeoutTimer=setTimeout(function(){if("closed"!==W.readyState)W.onClose("ping timeout")},J||W.pingInterval+W.pingTimeout)};ya.prototype.setPing=function(){var J=this||Jc;clearTimeout(J.pingIntervalTimer);J.pingIntervalTimer=setTimeout(function(){uf("writing ping packet - expecting pong within %sms",J.pingTimeout);J.ping();J.onHeartbeat(J.pingTimeout)},J.pingInterval)};ya.prototype.ping=
function(){var J=this||Jc;this.sendPacket("ping",function(){J.emit("ping")})};ya.prototype.onDrain=function(){(this||Jc).writeBuffer.splice(0,(this||Jc).prevBufferLen);(this||Jc).prevBufferLen=0;0===(this||Jc).writeBuffer.length?this.emit("drain"):this.flush()};ya.prototype.flush=function(){"closed"!==(this||Jc).readyState&&(this||Jc).transport.writable&&!(this||Jc).upgrading&&(this||Jc).writeBuffer.length&&(uf("flushing %d packets in socket",(this||Jc).writeBuffer.length),(this||Jc).transport.send((this||
Jc).writeBuffer),(this||Jc).prevBufferLen=(this||Jc).writeBuffer.length,this.emit("flush"))};ya.prototype.write=ya.prototype.send=function(J,W,pa){this.sendPacket("message",J,W,pa);return this||Jc};ya.prototype.sendPacket=function(J,W,pa,$a){"function"===typeof W&&($a=W,W=void 0);"function"===typeof pa&&($a=pa,pa=null);if("closing"!==(this||Jc).readyState&&"closed"!==(this||Jc).readyState){pa=pa||{};pa.compress=!1!==pa.compress;J={type:J,data:W,options:pa};this.emit("packetCreate",J);(this||Jc).writeBuffer.push(J);
if($a)this.once("flush",$a);this.flush()}};ya.prototype.close=function(){function J(){$a.onClose("forced close");uf("socket closing - telling transport to close");$a.transport.close()}function W(){$a.removeListener("upgrade",W);$a.removeListener("upgradeError",W);J()}function pa(){$a.once("upgrade",W);$a.once("upgradeError",W)}if("opening"===(this||Jc).readyState||"open"===(this||Jc).readyState){(this||Jc).readyState="closing";var $a=this||Jc;if((this||Jc).writeBuffer.length)this.once("drain",function(){(this||
Jc).upgrading?pa():J()});else(this||Jc).upgrading?pa():J()}return this||Jc};ya.prototype.onError=function(J){uf("socket error %j",J);ya.priorWebsocketSuccess=!1;this.emit("error",J);this.onClose("transport error",J)};ya.prototype.onClose=function(J,W){if("opening"===(this||Jc).readyState||"open"===(this||Jc).readyState||"closing"===(this||Jc).readyState){uf('socket close with reason: "%s"',J);var pa=this||Jc;clearTimeout((this||Jc).pingIntervalTimer);clearTimeout((this||Jc).pingTimeoutTimer);(this||
Jc).transport.removeAllListeners("close");(this||Jc).transport.close();(this||Jc).transport.removeAllListeners();(this||Jc).readyState="closed";(this||Jc).id=null;this.emit("close",J,W);pa.writeBuffer=[];pa.prevBufferLen=0}};ya.prototype.filterUpgrades=function(J){for(var W=[],pa=0,$a=J.length;pa<$a;pa++)~sn((this||Jc).transports,J[pa])&&W.push(J[pa]);return W};var Uk={};Uk=yf;Uk.parser=id;var Eq=Uk,Fq={},Am=Fq=function(J,W){for(var pa=[],$a=(W=W||0)||0;$a<J.length;$a++)pa[$a-W]=J[$a];return pa},
up={},Bm=[].slice,ul=up=function(J,W){"string"==typeof W&&(W=J[W]);if("function"!=typeof W)throw Error("bind() requires a function");var pa=Bm.call(arguments,2);return function(){return W.apply(J,pa.concat(Bm.call(arguments)))}},vp={},Kk=vp=function(J,W,pa){J.on(W,pa);return{destroy:function(){J.removeListener(W,pa)}}},De="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,wp={},dk=jb,ek=Fa("socket.io-client:socket");wp=wp=Gb;var Yn={connect:1,connect_error:1,connect_timeout:1,
connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},Zn=Bc.prototype.emit;Bc(Gb.prototype);Gb.prototype.subEvents=function(){if(!(this||De).subs){var J=(this||De).io;(this||De).subs=[Kk(J,"open",ul(this||De,"onopen")),Kk(J,"packet",ul(this||De,"onpacket")),Kk(J,"close",ul(this||De,"onclose"))]}};Gb.prototype.open=Gb.prototype.connect=function(){if((this||De).connected)return this||De;this.subEvents();(this||De).io.reconnecting||
(this||De).io.open();if("open"===(this||De).io.readyState)this.onopen();this.emit("connecting");return this||De};Gb.prototype.send=function(){var J=Am(arguments);J.unshift("message");(this||De).emit.apply(this||De,J);return this||De};Gb.prototype.emit=function(J){if(Yn.hasOwnProperty(J))return Zn.apply(this||De,arguments),this||De;var W=Am(arguments),pa={type:(void 0!==(this||De).flags.binary?(this||De).flags.binary:Wh(W))?dk.BINARY_EVENT:dk.EVENT,data:W,options:{}};pa.options.compress=!(this||De).flags||
!1!==(this||De).flags.compress;"function"===typeof W[W.length-1]&&(ek("emitting packet with ack id %d",(this||De).ids),(this||De).acks[(this||De).ids]=W.pop(),pa.id=(this||De).ids++);(this||De).connected?this.packet(pa):(this||De).sendBuffer.push(pa);(this||De).flags={};return this||De};Gb.prototype.packet=function(J){J.nsp=(this||De).nsp;(this||De).io.packet(J)};Gb.prototype.onopen=function(){ek("transport is open - connecting");if("/"!==(this||De).nsp)if((this||De).query){var J="object"===typeof(this||
De).query?Hk.encode((this||De).query):(this||De).query;ek("sending connect packet with query %s",J);this.packet({type:dk.CONNECT,query:J})}else this.packet({type:dk.CONNECT})};Gb.prototype.onclose=function(J){ek("close (%s)",J);(this||De).connected=!1;(this||De).disconnected=!0;delete (this||De).id;this.emit("disconnect",J)};Gb.prototype.onpacket=function(J){var W=J.type===dk.ERROR&&"/"===J.nsp;if(J.nsp===(this||De).nsp||W)switch(J.type){case dk.CONNECT:this.onconnect();break;case dk.EVENT:this.onevent(J);
break;case dk.BINARY_EVENT:this.onevent(J);break;case dk.ACK:this.onack(J);break;case dk.BINARY_ACK:this.onack(J);break;case dk.DISCONNECT:this.ondisconnect();break;case dk.ERROR:this.emit("error",J.data)}};Gb.prototype.onevent=function(J){var W=J.data||[];ek("emitting event %j",W);null!=J.id&&(ek("attaching ack callback to event"),W.push(this.ack(J.id)));(this||De).connected?Zn.apply(this||De,W):(this||De).receiveBuffer.push(W)};Gb.prototype.ack=function(J){var W=this||De,pa=!1;return function(){if(!pa){pa=
!0;var $a=Am(arguments);ek("sending ack %j",$a);W.packet({type:Wh($a)?dk.BINARY_ACK:dk.ACK,id:J,data:$a})}}};Gb.prototype.onack=function(J){var W=(this||De).acks[J.id];"function"===typeof W?(ek("calling ack %s with %j",J.id,J.data),W.apply(this||De,J.data),delete (this||De).acks[J.id]):ek("bad ack %s",J.id)};Gb.prototype.onconnect=function(){(this||De).connected=!0;(this||De).disconnected=!1;this.emit("connect");this.emitBuffered()};Gb.prototype.emitBuffered=function(){var J;for(J=0;J<(this||De).receiveBuffer.length;J++)Zn.apply(this||
De,(this||De).receiveBuffer[J]);(this||De).receiveBuffer=[];for(J=0;J<(this||De).sendBuffer.length;J++)this.packet((this||De).sendBuffer[J]);(this||De).sendBuffer=[]};Gb.prototype.ondisconnect=function(){ek("server disconnect (%s)",(this||De).nsp);this.destroy();this.onclose("io server disconnect")};Gb.prototype.destroy=function(){if((this||De).subs){for(var J=0;J<(this||De).subs.length;J++)(this||De).subs[J].destroy();(this||De).subs=null}(this||De).io.destroy(this||De)};Gb.prototype.close=Gb.prototype.disconnect=
function(){(this||De).connected&&(ek("performing disconnect (%s)",(this||De).nsp),this.packet({type:dk.DISCONNECT}));this.destroy();if((this||De).connected)this.onclose("io client disconnect");return this||De};Gb.prototype.compress=function(J){(this||De).flags.compress=J;return this||De};Gb.prototype.binary=function(J){(this||De).flags.binary=J;return this||De};var $n=wp,Dj="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Cm={};Cm=Pb;Pb.prototype.duration=function(){var J=
(this||Dj).ms*Math.pow((this||Dj).factor,(this||Dj).attempts++);if((this||Dj).jitter){var W=Math.random(),pa=Math.floor(W*(this||Dj).jitter*J);J=0==(Math.floor(10*W)&1)?J-pa:J+pa}return Math.min(J,(this||Dj).max)|0};Pb.prototype.reset=function(){(this||Dj).attempts=0};Pb.prototype.setMin=function(J){(this||Dj).ms=J};Pb.prototype.setMax=function(J){(this||Dj).max=J};Pb.prototype.setJitter=function(J){(this||Dj).jitter=J};var Gq=Cm,Lo={},un=Fa("socket.io-client:url"),Vm=Lo=function(J,W){var pa=J;W=
W||"undefined"!==typeof location&&location;null==J&&(J=W.protocol+"//"+W.host);"string"===typeof J&&("/"===J.charAt(0)&&(J="/"===J.charAt(1)?W.protocol+J:W.host+J),/^(https?|wss?):\/\//.test(J)||(un("protocol-less url %s",J),J="undefined"!==typeof W?W.protocol+"//"+J:"https://"+J),un("parse %s",J),pa=Fd(J));pa.port||(/^(http|ws)$/.test(pa.protocol)?pa.port="80":/^(http|ws)s$/.test(pa.protocol)&&(pa.port="443"));pa.path=pa.path||"/";J=-1!==pa.host.indexOf(":")?"["+pa.host+"]":pa.host;pa.id=pa.protocol+
"://"+J+":"+pa.port;pa.href=pa.protocol+"://"+J+(W&&W.port===pa.port?"":":"+pa.port);return pa},ud="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global,Mo={},No=jb,Ej=Fa("socket.io-client:manager"),xp=Gq,Hq=Object.prototype.hasOwnProperty;Mo=Ca;Ca.prototype.emitAll=function(){(this||ud).emit.apply(this||ud,arguments);for(var J in(this||ud).nsps)Hq.call((this||ud).nsps,J)&&(this||ud).nsps[J].emit.apply((this||ud).nsps[J],arguments)};Ca.prototype.updateSocketIds=function(){for(var J in(this||
ud).nsps)Hq.call((this||ud).nsps,J)&&((this||ud).nsps[J].id=this.generateId(J))};Ca.prototype.generateId=function(J){return("/"===J?"":J+"#")+(this||ud).engine.id};Bc(Ca.prototype);Ca.prototype.reconnection=function(J){if(!arguments.length)return(this||ud)._reconnection;(this||ud)._reconnection=!!J;return this||ud};Ca.prototype.reconnectionAttempts=function(J){if(!arguments.length)return(this||ud)._reconnectionAttempts;(this||ud)._reconnectionAttempts=J;return this||ud};Ca.prototype.reconnectionDelay=
function(J){if(!arguments.length)return(this||ud)._reconnectionDelay;(this||ud)._reconnectionDelay=J;(this||ud).backoff&&(this||ud).backoff.setMin(J);return this||ud};Ca.prototype.randomizationFactor=function(J){if(!arguments.length)return(this||ud)._randomizationFactor;(this||ud)._randomizationFactor=J;(this||ud).backoff&&(this||ud).backoff.setJitter(J);return this||ud};Ca.prototype.reconnectionDelayMax=function(J){if(!arguments.length)return(this||ud)._reconnectionDelayMax;(this||ud)._reconnectionDelayMax=
J;(this||ud).backoff&&(this||ud).backoff.setMax(J);return this||ud};Ca.prototype.timeout=function(J){if(!arguments.length)return(this||ud)._timeout;(this||ud)._timeout=J;return this||ud};Ca.prototype.maybeReconnectOnOpen=function(){!(this||ud).reconnecting&&(this||ud)._reconnection&&0===(this||ud).backoff.attempts&&this.reconnect()};Ca.prototype.open=Ca.prototype.connect=function(J,W){Ej("readyState %s",(this||ud).readyState);if(~(this||ud).readyState.indexOf("open"))return this||ud;Ej("opening %s",
(this||ud).uri);(this||ud).engine=Eq((this||ud).uri,(this||ud).opts);var pa=(this||ud).engine,$a=this||ud;(this||ud).readyState="opening";(this||ud).skipReconnect=!1;var Fb=Kk(pa,"open",function(){$a.onopen();J&&J()});W=Kk(pa,"error",function(Qd){Ej("connect_error");$a.cleanup();$a.readyState="closed";$a.emitAll("connect_error",Qd);if(J){var Md=Error("Connection error");Md.data=Qd;J(Md)}else $a.maybeReconnectOnOpen()});if(!1!==(this||ud)._timeout){var sc=(this||ud)._timeout;Ej("connect attempt will timeout after %d",
sc);0===sc&&Fb.destroy();var ad=setTimeout(function(){Ej("connect attempt timed out after %d",sc);Fb.destroy();pa.close();pa.emit("error","timeout");$a.emitAll("connect_timeout",sc)},sc);(this||ud).subs.push({destroy:function(){clearTimeout(ad)}})}(this||ud).subs.push(Fb);(this||ud).subs.push(W);return this||ud};Ca.prototype.onopen=function(){Ej("open");this.cleanup();(this||ud).readyState="open";this.emit("open");var J=(this||ud).engine;(this||ud).subs.push(Kk(J,"data",ul(this||ud,"ondata")));(this||
ud).subs.push(Kk(J,"ping",ul(this||ud,"onping")));(this||ud).subs.push(Kk(J,"pong",ul(this||ud,"onpong")));(this||ud).subs.push(Kk(J,"error",ul(this||ud,"onerror")));(this||ud).subs.push(Kk(J,"close",ul(this||ud,"onclose")));(this||ud).subs.push(Kk((this||ud).decoder,"decoded",ul(this||ud,"ondecoded")))};Ca.prototype.onping=function(){(this||ud).lastPing=new Date;this.emitAll("ping")};Ca.prototype.onpong=function(){this.emitAll("pong",new Date-(this||ud).lastPing)};Ca.prototype.ondata=function(J){(this||
ud).decoder.add(J)};Ca.prototype.ondecoded=function(J){this.emit("packet",J)};Ca.prototype.onerror=function(J){Ej("error",J);this.emitAll("error",J)};Ca.prototype.socket=function(J,W){function pa(){~sn(Fb.connecting,$a)||Fb.connecting.push($a)}var $a=(this||ud).nsps[J];if(!$a){$a=new $n(this||ud,J,W);(this||ud).nsps[J]=$a;var Fb=this||ud;$a.on("connecting",pa);$a.on("connect",function(){$a.id=Fb.generateId(J)});(this||ud).autoConnect&&pa()}return $a};Ca.prototype.destroy=function(J){J=sn((this||ud).connecting,
J);~J&&(this||ud).connecting.splice(J,1);(this||ud).connecting.length||this.close()};Ca.prototype.packet=function(J){Ej("writing packet %j",J);var W=this||ud;J.query&&0===J.type&&(J.nsp+="?"+J.query);W.encoding?W.packetBuffer.push(J):(W.encoding=!0,(this||ud).encoder.encode(J,function(pa){for(var $a=0;$a<pa.length;$a++)W.engine.write(pa[$a],J.options);W.encoding=!1;W.processPacketQueue()}))};Ca.prototype.processPacketQueue=function(){if(0<(this||ud).packetBuffer.length&&!(this||ud).encoding){var J=
(this||ud).packetBuffer.shift();this.packet(J)}};Ca.prototype.cleanup=function(){Ej("cleanup");for(var J=(this||ud).subs.length,W=0;W<J;W++)(this||ud).subs.shift().destroy();(this||ud).packetBuffer=[];(this||ud).encoding=!1;(this||ud).lastPing=null;(this||ud).decoder.destroy()};Ca.prototype.close=Ca.prototype.disconnect=function(){Ej("disconnect");(this||ud).skipReconnect=!0;(this||ud).reconnecting=!1;"opening"===(this||ud).readyState&&this.cleanup();(this||ud).backoff.reset();(this||ud).readyState=
"closed";(this||ud).engine&&(this||ud).engine.close()};Ca.prototype.onclose=function(J){Ej("onclose");this.cleanup();(this||ud).backoff.reset();(this||ud).readyState="closed";this.emit("close",J);(this||ud)._reconnection&&!(this||ud).skipReconnect&&this.reconnect()};Ca.prototype.reconnect=function(){if((this||ud).reconnecting||(this||ud).skipReconnect)return this||ud;var J=this||ud;if((this||ud).backoff.attempts>=(this||ud)._reconnectionAttempts)Ej("reconnect failed"),(this||ud).backoff.reset(),this.emitAll("reconnect_failed"),
(this||ud).reconnecting=!1;else{var W=(this||ud).backoff.duration();Ej("will wait %dms before reconnect attempt",W);(this||ud).reconnecting=!0;var pa=setTimeout(function(){J.skipReconnect||(Ej("attempting reconnect"),J.emitAll("reconnect_attempt",J.backoff.attempts),J.emitAll("reconnecting",J.backoff.attempts),J.skipReconnect||J.open(function($a){$a?(Ej("reconnect attempt error"),J.reconnecting=!1,J.reconnect(),J.emitAll("reconnect_error",$a.data)):(Ej("reconnect success"),J.onreconnect())}))},W);
(this||ud).subs.push({destroy:function(){clearTimeout(pa)}})}};Ca.prototype.onreconnect=function(){var J=(this||ud).backoff.attempts;(this||ud).reconnecting=!1;(this||ud).backoff.reset();this.updateSocketIds();this.emitAll("reconnect",J)};var Iq=Mo,vl={},yp=Vm,zp=jb,Jq=Iq,Kq=Fa("socket.io-client");vl=vl=Yb;var Wm=vl.managers={};vl.protocol=zp.protocol;vl.connect=Yb;vl.Manager=Iq;vl.Socket=$n;var Lq=vl,Jf=lively.FreezerRuntime.recorderFor("lively.2lively/client.js");Jf.determineLocation=function(){return"undefined"!==
typeof document&&document.location?document.location.origin:Jf.isNode?System._nodeRequire("os").hostname():System.baseURL};Jf.promise=yb;Jf.fun=yd;Jf.obj=Cc;Jf.events=rd;Jf.num=Fc;Jf.L2LConnection=Kc;Jf.defaultActions=Ha;Jf.defaultClientActions=Na;Jf.isNode="undefined"!==typeof System?System.get("@system-env").node:"undefined"!==typeof process&&process.env;Jf._ioClient=Lq;Jf.ioClient=Jf.ioClient||void 0;Jf.isNode?(Jf.require=System._nodeRequire("module")._load,Jf.ioClient=Jf.require("socket.io-client")):
Jf.ioClient=Jf._ioClient;Jf.urlHelper={isRoot:function(J){return"/"===Jf.urlHelper.path(J)},root:function(J){return Jf.urlHelper.isRoot(J)?J:J.slice(0,-Jf.urlHelper.path(J).length)+"/"},path:function(){var J=/^[a-z0-9-_\.]+:/,W=/^\/\/[^\/]+/;return function(pa){pa=pa.replace(J,"").replace(W,"");return""===pa?"/":pa}}(),join:function(J,W){J.endsWith("/")&&(J=J.slice(0,-1));W.startsWith("/")&&(W=W.slice(1));return J+"/"+W}};var Ch=function(J,W,pa,$a){var Fb=Jf.L2LConnection.call(this)||this;Jf.events.makeEmitter(Fb);
Fb.info=$a;Fb.origin=J;Fb.path=W;Fb.namespace=pa.replace(/^\/?/,"/");Fb.trackerId=null;Fb._socketioClient=null;Fb._reconnectState={closed:!1,autoReconnect:!0,isReconnecting:!1,isReconnectingViaSocketio:!1,registerAttempt:0,registerProcess:null,isOpening:!1};Object.keys(Jf.defaultActions).forEach(function(sc){return Fb.addService(sc,Jf.defaultActions[sc])});Object.keys(Jf.defaultClientActions).forEach(function(sc){return Fb.addService(sc,Jf.defaultClientActions[sc])});return Fb};$jscomp.inherits(Ch,
Jf.L2LConnection);Ch.clientKey=function(J,W,pa){J=J.replace(/\/$/,"");W=W.replace(/^\//,"");pa=pa.replace(/^\//,"");return J+"-"+W+"-"+pa};Ch.forLivelyInBrowser=function(J){var W=!!J;J=Object.assign({type:"lively.morphic browser"},J);var pa=this.default();if(!pa)return Jf.L2LClient.ensure({url:document.location.origin+"/lively-socket.io",namespace:"l2l",info:J});W&&!Jf.obj.equals(pa.info,J)&&pa.isRegistered()&&(pa.info=J,pa.unregister().then(function(){return pa.register()}).catch(function($a){return console.error("l2l re-register on info change errored: "+
$a)}));return pa};Ch.default=function(){var J=Jf.L2LClient.clients.keys().next().value;return Jf.L2LClient.clients.get(J)};Ch.create=function(J){var W=J=void 0===J?{}:J;J=void 0===W.debug?!1:W.debug;var pa=W.url,$a=W.namespace,Fb=void 0===W.autoOpen?!0:W.autoOpen;W=void 0===W.info?{}:W.info;if(!pa)throw Error("L2LClient needs server url!");var sc=Jf.urlHelper.root(pa).replace(/\/+$/,"");pa=Jf.urlHelper.path(pa);$a=new this(sc,pa,$a||"",W);Fb&&$a.register();$a.debug=J;return $a};Ch.ensure=function(J){var W=
J=void 0===J?{}:J,pa=W.url;W=W.namespace;if(!pa)throw Error("L2LClient needs server url!");var $a=Jf.urlHelper.root(pa).replace(/\/+$/,""),Fb=Jf.urlHelper.path(pa);$a=this.clientKey($a,Fb,W||"");(Fb=this.clients.get($a))||this.clients.set($a,Fb=this.create(Object.assign({},J,{url:pa,namespace:W})));return Fb};Ch.prototype.isOnline=function(){return this.socket&&this.socket.connected};Ch.prototype.isRegistered=function(){return this.isOnline()&&!!this.trackerId};Ch.prototype.open=function(){var J=
this,W,pa,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){if(1==Fb.nextAddress)return J.isOnline()||J._reconnectState.isOpening?Fb.return(J):Fb.yield(J.close(),2);J._reconnectState.closed=!1;W=Jf.urlHelper.join(J.origin,J.namespace);pa={path:J.path,transports:["websocket","polling"]};$a=J._socketioClient=Jf.ioClient(W,pa);J.debug&&console.log("["+J+"] connecting");$a.on("error",function(sc){J._reconnectState.isOpening=!1;J.debug&&console.log("["+J+"] errored: "+sc)});$a.on("close",
function(sc){return J.debug&&console.log("["+J+"] closed: "+sc)});$a.on("reconnect_failed",function(){return J.debug&&console.log("["+J+"] could not reconnect")});$a.on("reconnect_error",function(sc){return J.debug&&console.log("["+J+"] reconnect error "+sc)});$a.on("connect",function(){J.debug&&console.log("["+J+"] connected");J.emit("connected",J);J._reconnectState.isOpening=!1;J._reconnectState.isReconnecting=!1;J._reconnectState.isReconnectingViaSocketio=!1});$a.on("disconnect",function(){J._reconnectState.isOpening=
!1;J.debug&&console.log("["+J+"] disconnected");J.emit("disconnected",J);J.trackerId?("tracker"!==J.trackerId&&(J.renameTarget(J.trackerId,"tracker"),J.trackerId=null),J._reconnectState.closed?J.debug&&console.log("["+J+"] won't reconnect b/c client is marked as closed"):J._reconnectState.autoReconnect?(J._reconnectState.isReconnecting=!0,setTimeout(function(){J._reconnectState.closed?J.debug&&console.log("["+J+"] won't reconnect b/c client is marked as closed 2"):J._reconnectState.isReconnectingViaSocketio?
J.debug&&console.log("["+J+"] won't reconnect again, client already reconnecting"):(J.debug&&console.log("["+J+"] initiating reconnection to tracker"),J.register())},20)):J.debug&&console.log("["+J+"] won't reconnect b/c client has reconnection disabled")):(J.debug&&console.log("["+J+"] disconnect: don't have a tracker id, won't try reconnect"),J.trackerId="tracker")});$a.on("reconnecting",function(){J.debug&&console.log("["+J+"] reconnecting",J._reconnectState);J.emit("reconnecting",J);J._reconnectState.closed?
(J._reconnectState.isReconnecting=!1,J._reconnectState.isReconnectingViaSocketio=!1,$a.close(),J.close()):(J._reconnectState.isReconnecting=!0,J._reconnectState.isReconnectingViaSocketio=!0)});$a.on("reconnect",function(){J.debug&&console.log("["+J+"] reconnected");J._reconnectState.isReconnecting=!1;J._reconnectState.isReconnectingViaSocketio=!1;J.register()});J.installEventToMessageTranslator($a);J._reconnectState.isOpening=!0;return Fb.return((new Promise(function(sc,ad){$a.once("error",ad);$a.once("connect",
sc)})).then(function(){return J}))})};Ch.prototype.close=function(){var J=this,W,pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){if(1==$a.nextAddress){J._reconnectState.closed=!0;if(W=J.socket)W.removeAllListeners("reconnect"),W.removeAllListeners("reconnecting"),W.removeAllListeners("disconnect"),W.removeAllListeners("connect"),W.removeAllListeners("reconnect_error"),W.removeAllListeners("reconnect_failed"),W.removeAllListeners("close"),W.removeAllListeners("error"),W.close();
J.debug&&console.log("["+J+"] closing...");return J.isRegistered()?$a.yield(J.unregister(),2):$a.jumpTo(2)}return J.isOnline()||J.socket?W&&!W.connected?(J.debug&&console.log("["+J+"] socket not connected, considering client closed"),$a.return(J)):$a.return(Promise.race([Jf.promise.delay(2E3).then(function(){return W.removeAllListeners("disconnect")}),new Promise(function(Fb){return W.once("disconnect",Fb)})]).then(function(){J.debug&&console.log("["+J+"] closed");return J})):(J.debug&&(pa=J.isOnline()?
"no socket":"not online",J.debug&&console.log("["+J+"] cannot close: "+pa)),$a.return(J))})};Ch.prototype.remove=function(){var J=this.constructor.clientKey(this.origin,this.path,this.namespace);this.constructor.clients.delete(J);return this.close()};Ch.prototype.register=function(){var J=this,W,pa,$a,Fb,sc,ad,Qd,Md,Me,tf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rg){switch(Rg.nextAddress){case 1:if(J.isRegistered())return Rg.return();if(J._reconnectState.closed)return J.debug&&
console.log("["+J+"] not registering this b/c closed"),J._reconnectState.registerAttempt=0,Rg.return();if(J._reconnectState.registerProcess)return J.debug&&console.log("["+J+"] not registering this b/c register process exists"),Rg.return();Rg.setCatchFinallyBlocks(2);if(J.isOnline()){Rg.jumpTo(4);break}return Rg.yield(J.open(),4);case 4:return J.debug&&console.log("["+J+"] register"),Rg.yield(J.sendToAndWait("tracker","register",Object.assign({userName:"unknown",type:"l2l "+(Jf.isNode?"node":"browser"),
location:Jf.determineLocation()},J.info)),6);case 6:W=Rg.yieldResult;if(!W.data)throw pa=Error("Register answer is empty!"),J.emit("error",pa),pa;if(W.data.isError)throw $a=Error(W.data.error),J.emit("error",$a),$a;J._reconnectState.registerAttempt=0;Fb=W;sc=Fb.data;ad=sc.trackerId;Qd=sc.messageNumber;J.trackerId=ad;J._incomingOrderNumberingBySenders.set(ad,Qd||0);J.emit("registered",{trackerId:ad});Rg.leaveTryBlock(0);break;case 2:Md=Rg.enterCatchBlock(),console.error("Error in register request of "+
J+": "+Md),Me=J._reconnectState.registerAttempt++,tf=Jf.num.backoff(Me,4,3E5),J._reconnectState.registerProcess=setTimeout(function(){J._reconnectState.registerProcess=null;J.register()},tf),Rg.jumpToEnd()}})};Ch.prototype.unregister=function(){var J=this,W;return $jscomp.asyncExecutePromiseGeneratorProgram(function(pa){switch(pa.nextAddress){case 1:if(!J.isRegistered())return pa.return();J.debug&&console.log("["+J+"] unregister");W=J.trackerId;pa.setCatchFinallyBlocks(2);return pa.yield(J.sendToAndWait(J.trackerId,
"unregister",{}),4);case 4:pa.leaveTryBlock(3);break;case 2:pa.enterCatchBlock();case 3:J.renameTarget(W,"tracker"),J.trackerId=null,J.emit("unregistered",J),pa.jumpToEnd()}})};Ch.prototype.whenRegistered=function(J){var W=this;return Jf.promise.waitFor(J,function(){return W.isRegistered()}).catch(function(pa){return Promise.reject(/timeout/i.test(String(pa))?Error("Timeout in "+W+".whenRegistered"):pa)})};Ch.prototype.send=function(J,W){var pa=this,$a=$jscomp.makeIterator(this.prepareSend(J,W));
J=$a.next().value;W=$a.next().value;this.whenOnline().then(function(){var Fb=pa.socket,sc=J,ad=sc.action;sc=sc.target;if(!Fb)throw Error("Trying to send message "+ad+" to "+sc+" but cannot find a connection to it!");"function"===typeof W?Fb.emit(ad,J,W):Fb.emit(ad,J)})};Ch.prototype.joinRoom=function(J){var W=this;return this.whenOnline().then(function(){return W.sendToAndWait(W.trackerId,"[broadcast] join room",{room:J})})};Ch.prototype.leaveRoom=function(J){var W=this;return this.whenOnline().then(function(){return W.sendToAndWait(W.trackerId,
"[broadcast] leave room",{room:J})})};Ch.prototype.broadcast=function(J,W,pa,$a,Fb){var sc=this,ad={action:W,room:J,broadcast:pa};if(void 0===$a?0:$a)ad.isSystemBroadcast=!0;if(void 0===Fb?0:Fb)ad.isMultiServerBroadcast=!0;return this.whenOnline().then(function(){return sc.sendToAndWait(sc.trackerId,"[broadcast] send",ad)})};Ch.prototype.listRoomMembers=function(J){var W=this,pa,$a;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fb){if(1==Fb.nextAddress)return Fb.yield(W.sendToAndWait(W.trackerId,
"[broadcast] list room members",{room:J}),2);pa=Fb.yieldResult;$a=pa.data;return Fb.return($a)})};Ch.prototype.joinedRooms=function(){var J=this,W,pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){if(1==$a.nextAddress)return $a.yield(J.sendToAndWait(J.trackerId,"[broadcast] my rooms",{}),2);W=$a.yieldResult;pa=W.data;return $a.return(pa)})};Ch.prototype.listRooms=function(){var J=this,W,pa;return $jscomp.asyncExecutePromiseGeneratorProgram(function($a){if(1==$a.nextAddress)return $a.yield(J.sendToAndWait(J.trackerId,
"[broadcast] all rooms",{}),2);W=$a.yieldResult;pa=W.data;return $a.return(pa)})};Ch.prototype.listPeers=function(J){J=void 0===J?!1:J;var W=this,pa,$a,Fb,sc,ad,Qd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Md){if(1==Md.nextAddress)return pa=W,$a=pa._peersCached,Fb=Date.now(),!J&&$a&&1E3>Fb-$a.timestamp?Md.return(W._peersCached.sessions):W.isOnline()?Md.yield(W.sendToAndWait(W.trackerId,"getClients",{}),2):Md.return([]);sc=Md.yieldResult;ad=sc.data;Qd=ad.map(function(Me){var tf=$jscomp.makeIterator(Me);
Me=tf.next().value;var Rg=tf.next().value,Dh=Rg.info||{};tf=Dh.userRealm;var Oi=Dh.userToken,Xm=Dh.l2lUserToken,ao=Dh.location,Yl=Dh.type;Dh=Dh.world;Me=Object.assign({},Jf.obj.dissoc(Rg,["info"]),{id:Me,world:Dh,location:ao,type:Yl});(Oi=Oi||Xm)&&"null"!==Oi&&(lively.user?Me.user=lively.user.ClientUser.fromToken(Oi,tf):(Me.userToken=Oi,Me.userRealm=tf));return Me});W._peersCached={timestamp:Fb,sessions:Qd};return Md.return(Qd)})};Ch.prototype.toString=function(){var J=this.origin,W=this.path,pa=
this.namespace,$a=this.id,Fb=this.isOnline()?this.isRegistered()?"registered":"unregistered":"disconnected";return"L2LClient("+($a||"").slice(0,5)+" "+J+W+" - "+pa+" "+Fb+")"};$jscomp.global.Object.defineProperties(Ch.prototype,{socket:{configurable:!0,enumerable:!0,get:function(){return this._socketioClient}},socketId:{configurable:!0,enumerable:!0,get:function(){return this.socket?this.socket.id:null}}});$jscomp.global.Object.defineProperties(Ch,{clients:{configurable:!0,enumerable:!0,get:function(){return this._clients||
(this._clients=new Map)}}});ta("default",Ch);Jf.L2LClient=Ch;Jf.default=Ch}}});