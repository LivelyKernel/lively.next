System.register(["./__root_module__-c4f77fb9.js","kld-intersections"],function(ra){var jb,pb,Ub,Jb,jd,uc,nd,wc,Cc,Mc,Bd,re,Ce,be,Sb;return{setters:[function(qc){jb=qc.a7;pb=qc.P;Ub=qc.a6;Jb=qc.p;jd=qc.bE;uc=qc.B;nd=qc.bF;wc=qc.r;Cc=qc.aU;Mc=qc.bG;Bd=qc.bH;re=qc.bI;Ce=qc.bJ;be=qc.bK;Sb=qc.l},function(){}],execute:function(){function qc(fc,ic,Ab,jc){jc=void 0===jc?{}:jc;jc=jc.package||Tb.ObjectPackage.lookupPackageForObject(fc,jc);if(!jc)throw Error("Object is not part of an object package: "+fc);
return jc.addScript(fc,ic,Ab)}function od(fc,ic){ic=Tb.normalizeOptions(ic).System;fc=(fc=fc[Symbol.for("lively-module-meta")])?fc.package.name:null;return(ic=(fc?Tb.lookupPackage(ic,fc):{}).pkg)?!!Tb.ObjectPackage.forSystemPackage(ic):!1}ra({addScript:qc,isObjectClass:od});var Tb=lively.FreezerRuntime.recorderFor("lively.classes/object-classes.js");Tb.normalizeOptions=function(fc){fc=Object.assign({baseURL:Tb.defaultBaseURL,System:System},fc);fc.baseURL=fc.baseURL.replace(/\/$/,"");return fc};Tb.addScript=
qc;Tb.isObjectClass=od;Tb.string=jb;Tb.Path=pb;Tb.arr=Ub;Tb.parse=Jb;Tb.isValidIdentifier=jd;Tb.stringify=uc;Tb.parseFunction=nd;Tb.resource=wc;Tb.runEval=Cc;Tb.scripting=Mc;Tb.ExportLookup=Bd;var wd=Tb.scripting;Tb.ensurePackage=wd.ensurePackage;Tb.registerPackage=wd.registerPackage;Tb.importPackage=wd.importPackage;Tb.lookupPackage=wd.lookupPackage;Tb.module=wd.module;Tb.ImportInjector=wd.ImportInjector;Tb.RuntimeSourceDescriptor=re;Tb.toJsIdentifier=Ce;Tb.adoptObject=be;Tb.classToFunctionTransform=
Sb;Tb.objectPackageSym=Symbol.for("lively-object-package-data");Tb.defaultBaseURL="local://lively-object-modules";Tb.globalClasses=Object.keys(System.global).map(function(fc){fc=System.global[fc];return"function"===typeof fc&&fc.name&&fc}).filter(Boolean);Tb.addScript=qc;Tb.addScript=qc;Tb.isObjectClass=od;Tb.isObjectClass=od;Tb._packageStore=Tb._packageStore||{};wd=function(fc,ic){this._id=fc;this.options=Tb.normalizeOptions(ic)};wd.lookupPackageForObject=function(fc,ic){return this.lookupPackageForClass(fc.constructor,
ic)};wd.lookupPackageForClass=function(fc,ic){ic=Tb.normalizeOptions(ic).System;fc=(fc=fc[Symbol.for("lively-module-meta")])?fc.package.name:null;return(ic=(fc?Tb.lookupPackage(ic,fc):{}).pkg)?Tb.ObjectPackage.forSystemPackage(ic):null};wd.forSystemPackage=function(fc){return this.packageStore[fc.name]};wd.withId=function(fc,ic){return this.packageStore[fc]||(this.packageStore[fc]=new this(fc,ic))};wd.prototype.resource=function(fc){fc=void 0===fc?"":fc;return Tb.resource(this.packageURL).join(fc)};
wd.prototype.load=function(){return Tb.importPackage(this.System,this.packageURL)};wd.prototype.ensureExistance=function(){var fc=this,ic,Ab,jc,Bc,ad,bd,ob,kb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(tb){switch(tb.nextAddress){case 1:return ic=fc.resource("/"),tb.yield(ic.exists(),2);case 2:if(tb.yieldResult)return tb.return();Ab=[{resource:ic}];jc=[{resource:fc.resource("package.json"),content:JSON.stringify(fc.config,null,2)}];return tb.yield(Promise.all(Ab.map(function(Aa){return Aa.resource.mkdir()})),
3);case 3:return tb.yield(Promise.all(jc.map(function(Aa){var Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ba){switch(Ba.nextAddress){case 1:return Ba.yield(Aa.resource.exists(),2);case 2:if(!(Fa=!Ba.yieldResult)){Ba.jumpTo(3);break}return Ba.yield(Aa.resource.write(Aa.content),4);case 4:Fa=Ba.yieldResult;case 3:return Ba.return(Fa)}})})),4);case 4:return tb.yield(fc.objectModule.ensureExistance(),5);case 5:return Bc=fc,ad=Bc.System,bd=Bc.packageURL,ob=Bc.config,tb.yield(Tb.ensurePackage(ad,
bd),6);case 6:return kb=tb.yieldResult,kb.registerWithConfig(ob),console.log(fc.packageURL+" REGISTERED"),tb.return(fc)}})};wd.prototype.ensureObjectClass=function(fc){var ic=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ab){return 1==Ab.nextAddress?Ab.yield(ic.ensureExistance(),2):Ab.return(ic.objectModule.ensureObjectClass(fc))})};wd.prototype.adoptObject=function(fc){var ic=this,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jc){if(1==jc.nextAddress)return ic.objectClass===
fc.constructor?jc.return():jc.yield(ic.ensureObjectClass(fc.constructor),2);Ab=jc.yieldResult;Tb.adoptObject(fc,Ab);jc.jumpToEnd()})};wd.prototype.addScript=function(fc,ic,Ab){return this.objectModule.addScript(fc,ic,Ab)};wd.prototype.remove=function(){this.systemPackage.remove();delete Tb.ObjectPackage.packageStore[this.id];return this.resource().remove()};wd.prototype.renameObjectClass=function(fc,ic){ic=void 0===ic?[]:ic;var Ab=this,jc,Bc,ad,bd,ob,kb,tb,Aa,Fa,Ba,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){if(1==
Na.nextAddress){jc=Ab;Bc=jc.objectClass;ad=jc.System;if(!Bc||Bc[Symbol.for("__LivelyClassName__")]===fc)return Na.return(Bc);if(!Tb.isValidIdentifier(fc))throw Error(fc+" is not a valid name for a class");ob=bd=Tb.RuntimeSourceDescriptor.for(Bc,ad);kb=ob.source;tb=ob.ast;Aa=tb.id;Fa=Aa.start;Ba=Aa.end;return Na.yield(bd.changeSource(kb.slice(0,Fa)+fc+kb.slice(Ba)),2)}wa=Ab.objectClass;ic.forEach(function(La){La.constructor=wa;La.__proto__=wa.prototype});return Na.return(wa)})};wd.prototype.fork=function(fc,
ic){var Ab=this,jc,Bc,ad,bd,ob,kb,tb,Aa,Fa,Ba,wa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Na){switch(Na.nextAddress){case 1:return jc=Ab,Bc=jc.System,ad=jc.baseURL,bd=jc.objectClass,ic=Object.assign({System:Bc,baseURL:ad},ic),ob=Tb.RuntimeSourceDescriptor.for(bd),kb=ob._renamedSource(fc),tb=kb.moduleSource,Aa=Tb.ObjectPackage.withId(fc,ic),Na.yield(Aa.ensureExistance(),2);case 2:return Fa=Aa,Ba=Fa.objectModule,wa=Ba.systemModule,Na.yield(wa.load({format:"esm"}),3);case 3:return Na.yield(wa.changeSource(tb),
4);case 4:return Na.return(Aa)}})};$jscomp.global.Object.defineProperties(wd.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this._id}},name:{configurable:!0,enumerable:!0,get:function(){return this.id}},System:{configurable:!0,enumerable:!0,get:function(){return this.options.System}},baseURL:{configurable:!0,enumerable:!0,get:function(){return this.options.baseURL}},packageURL:{configurable:!0,enumerable:!0,get:function(){return this.baseURL+("/"+this.id)}},config:{configurable:!0,
enumerable:!0,get:function(){return{name:this.name,version:"0.1.0",lively:{isObjectPackage:!0}}}},systemPackage:{configurable:!0,enumerable:!0,get:function(){return Tb.lookupPackage(this.System,this.packageURL,!0).pkg}},objectModule:{configurable:!0,enumerable:!0,get:function(){return this._objectModule||(this._objectModule=new Tb.ObjectModule("index.js",this))}},objectClass:{configurable:!0,enumerable:!0,get:function(){return this.objectModule.objectClass}}});$jscomp.global.Object.defineProperties(wd,
{packageStore:{configurable:!0,enumerable:!0,get:function(){return this._packageStore||(this._packageStore=Tb._packageStore)}}});ra("default",wd);Tb.ObjectPackage=wd;var Fd=function(fc,ic){if(!fc)throw Error("ObjectModule needs package!");if(!ic)throw Error("ObjectModule needs package!");this._moduleName=fc;this._objectPackage=ic};Fd.prototype.read=function(){return this.resource.read()};Fd.prototype.write=function(fc){return this.resource.write(fc)};Fd.prototype.ensureExistance=function(){var fc=
this,ic,Ab;return $jscomp.asyncExecutePromiseGeneratorProgram(function(jc){switch(jc.nextAddress){case 1:return ic=fc.resource,jc.yield(ic.exists(),2);case 2:if(jc.yieldResult){jc.jumpTo(3);break}return jc.yield(ic.write("'format esm';\n"),4);case 4:Ab={},fc.System.config({meta:(Ab[fc.url]={format:"esm"},Ab)});case 3:return jc.return(fc)}})};Fd.prototype.ensureObjectClass=function(fc){var ic=this,Ab=this.objectClass;return Ab&&Ab.prototype.__proto__===fc.prototype?Ab:Promise.resolve(this.ensureObjectClassSource(fc)).then(function(jc){var Bc=
jc.source,ad=jc.moduleId,bd=jc.className,ob=jc.bindings,kb=ic.System;jc=Tb.module(kb,ad);if(ob)for(var tb in ob)jc.define(tb,ob[tb]);Bc=Tb.runEval(Bc,{classTransform:Tb.classToFunctionTransform,sync:!0,targetModule:ad,System:kb});if(Bc.isError)throw Bc.value;Bc=jc.recorder[bd];if(!Bc)throw Error("Failed to define class "+bd+" in "+ad);return Bc})};Fd.prototype.ensureObjectClassSource=function(fc){return this.createDefaultClassDeclaration(fc)};Fd.prototype.createDefaultClassDeclaration=function(fc){fc=
void 0===fc?Object:fc;var ic=this,Ab,jc,Bc,ad,bd,ob,kb,tb,Aa,Fa,Ba,wa,Na,La,Wa,Gb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){switch(Rb.nextAddress){case 1:Ab=ic;jc=Ab.System;Bc=Ab.systemModule;ad=Ab.objectPackage;bd=Tb.string.capitalize(Tb.toJsIdentifier(ad.id));ob=fc[Symbol.for("__LivelyClassName__")];kb=!ob;tb=Tb.globalClasses.includes(fc);Aa="";Fa=null;if(kb){ob="__anonymous_superclass__";Ba={};Fa=(Ba[ob]=fc,Ba);Rb.jumpTo(2);break}if(tb){Rb.jumpTo(2);break}return Rb.yield(Tb.ExportLookup.findExportOfValue(fc,
jc),4);case 4:(wa=Rb.yieldResult)?(Na=Tb.ImportInjector.run(jc,Bc.id,Bc.package(),"",wa),La=Na.standaloneImport,Aa+=La+"\n\n"):(Wa={},Fa=(Wa[ob]=fc,Wa));case 2:return bd===ob&&(bd="Object"+bd),Gb="Object"===ob?"class "+bd+" {}\n":"class "+bd+" extends "+ob+" {}\n",Aa+="export default "+Gb+"\n",Rb.yield(Bc.changeSource(Aa),5);case 5:return Rb.yield(Bc.load(),6);case 6:return Rb.return({source:Aa,className:bd,moduleId:ic.url,bindings:Fa})}})};Fd.prototype.addScript=function(fc,ic,Ab){var jc=this,Bc,
ad,bd,ob,kb,tb,Aa,Fa,Ba,wa,Na,La,Wa,Gb,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Bb){switch(Bb.nextAddress){case 1:if(fc.constructor===jc.objectClass){Bc=fc.constructor;Bb.jumpTo(2);break}return Bb.yield(jc.ensureObjectClass(fc.constructor),3);case 3:Bc=Bb.yieldResult;case 2:ad=Bc;bd="function"===typeof ic?String(ic):ic;ob=Tb.parseFunction(bd);kb=Tb.RuntimeSourceDescriptor.for(ad,jc.System);Ab||(Ab=Tb.Path("id.name").get(ob));if(!Ab)throw Error("No name, cannot add "+Tb.string.truncate(bd,
30).replace(/\n/g,"")+"!");tb=Tb.toJsIdentifier(Ab);console.assert("FunctionExpression"===ob.type||"ArrowFunctionExpression"===ob.type,"not a function expression but: "+ob.type);Aa=ob.params.map(function(ba){return bd.slice(ba.start,ba.end)});Fa="BlockStatement"===ob.body.type?bd.slice(ob.body.start,ob.body.end):"{ return "+bd.slice(ob.body.start,ob.body.end)+" }";Ba=tb+"("+Aa.join(",")+") "+Fa;"ArrowFunctionExpression"===ob.type&&(ob.type="FunctionExpression");wa=kb.source;Na=kb.ast;if(!Na)throw Error("cannot find class decl of "+
kb.module.id);(La=Na.body.body.find(function(ba){return ba.key.name===tb&&!ba.static}))?wa=wa.slice(0,La.start)+Ba+wa.slice(La.end):(Wa=wa.lastIndexOf("}"),Gb=wa.slice(0,Wa),Rb=wa.slice(Wa),/\n\s*$/m.test(Gb)||(Gb+="\n"),Ba=Tb.string.changeIndent(Ba,"  ",1),/^[ ]*\n/m.test(Rb)||(Rb="\n"+Rb),wa=Gb+Ba+Rb);return Bb.yield(kb.changeSource(wa),4);case 4:return Bb.return({script:ad.prototype[tb],klass:ad,module:kb.module.id,methodName:tb})}})};$jscomp.global.Object.defineProperties(Fd.prototype,{objectPackage:{configurable:!0,
enumerable:!0,get:function(){return this._objectPackage}},objectClass:{configurable:!0,enumerable:!0,get:function(){var fc=this.systemModule;return fc.isLoaded()?fc.System.get(fc.id).default:null}},moduleName:{configurable:!0,enumerable:!0,get:function(){return this._moduleName}},systemModule:{configurable:!0,enumerable:!0,get:function(){return Tb.module(this.System,this.url)}},System:{configurable:!0,enumerable:!0,get:function(){return this.objectPackage.System}},resource:{configurable:!0,enumerable:!0,
get:function(){return this.objectPackage.resource(this.moduleName)}},url:{configurable:!0,enumerable:!0,get:function(){return this.resource.url}}});Tb.ObjectModule=Fd;Tb.default=wd}}});