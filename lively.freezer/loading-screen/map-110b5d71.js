System.register(["./__rootModule___commonjs-entry-71573ff5.js","./canvas-6b603812.js","@babel/plugin-syntax-import-meta"],function(Lc){var pd,Nd,Tc,Jc,$d,Bb,rd,Id,Ac;return{setters:[function(Pc){pd=Pc.w;Nd=Pc.f;Tc=Pc.d;Jc=Pc.b;$d=Pc.C;Bb=Pc.Z;rd=Pc.i;Id=Pc.G},function(Pc){Ac=Pc.C},function(){}],execute:function(){var Pc=window.lively.FreezerRuntime.recorderFor("lively.morphic/text/map.js");Pc.Canvas=Ac;Pc.connect=pd;Pc.fun=Nd;Pc.promise=Tc;Pc.pt=Jc;Pc.Color=$d;Pc.addClassMappings=Bb;var gd=Lc("default",
function(nd){var Fd=window.lively.FreezerRuntime.recorderFor("lively.morphic/text/map.js"),ic=Fd.hasOwnProperty("TextMap")&&"function"===typeof Fd.TextMap?Fd.TextMap:Fd.TextMap=function(vd){if(!vd||!vd[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return rd(ic,nd,[{key:"onChange",value:function(vd){"extent"===vd.prop&&this.update();return rd._get(Object.getPrototypeOf(ic.prototype),"onChange",this).call(this,vd)}},{key:"reset",
value:function(){this.border={width:0};this.preserveContents=!0}},{key:"attachTo",value:function(vd){var sb=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;this.textMorph&&this.detachFrom(this.textMorph);this.textMorph=vd;Pc.connect(vd,"viewChange",this,"updateDebounced");Pc.connect(vd,"textChange",this,"updateDebounced");Pc.connect(vd,"selectionChange",this,"updateDebounced");sb&&(this.textMorph.addMorph(this),this.height=this.textMorph.height-this.textMorph.padding.top());this.update();
this.makeDirty()}},{key:"detachFromCurrentTextMorph",value:function(){this.detachFrom(this.textMorph);this.textMorph=null}},{key:"detachFrom",value:function(vd){var sb=this;vd&&vd.attributeConnections.forEach(function(Xb){return Xb.targetObj===sb&&Xb.disconnect()})}},{key:"updateDebounced",value:function(){var vd=this;this.owner===this.textMorph&&(this.topRight=this.textMorph.innerBounds().topRight().addPt(this.textMorph.scroll));Pc.fun.throttleNamed("update-"+this.id,100,function(){return vd.update()})()}},
{key:"measure",get:function(){var vd=this.height;return{width:this.width,height:vd,heightPerLine:Math.min(2,vd/this.textMorph.document.lines.length),widthPerChar:.5}}},{key:"update",value:function(){function vd(W,T){var ia=W.start;W=Math.max((W.end.row-ia.row+1)*cb,1);sb.fillStyle=T;sb.fillRect(0,ia.row*cb,bc,W)}var sb=this.context,Xb=this.textMorph,Nb=this.measure,bc=Nb.width,hb=Nb.height,cb=Nb.heightPerLine,Hb=Nb.widthPerChar,ec=Xb.document;Nb=Xb.markers;var ub=Xb.selections,yb=Xb.textLayout.whatsVisible(Xb),
ba=yb.startRow;yb=yb.endRow;this.owner===Xb&&(this.topRight=this.textMorph.innerBounds().topRight().addPt(this.textMorph.scroll).subXY(this.textMorph.padding.top()));if(sb){this.clear(null);sb.fillStyle="rgba(0,0,0, 0.1)";sb.fillRect(0,0,bc,ba*cb);sb.fillStyle="rgba(0,0,0, 0.1)";sb.fillRect(0,yb*cb,bc,hb-yb*cb);Xb=0;sb.beginPath();sb.lineWidth=Math.max(1,cb-.3);sb.strokeStyle="gray";hb=Id(ec.lines);var wb;try{for(hb.s();!(wb=hb.n()).done;){var Xa=wb.value.text,Za=Xa.length,Sb=Xa.trimLeft().length;
ec=Za-Sb;sb.moveTo(ec,Xb);sb.lineTo(ec+Sb*Hb,Xb);ec=0;Xb+=cb}}catch(W){hb.e(W)}finally{hb.f()}sb.stroke();sb.beginPath();sb.strokeStyle="black";sb.moveTo(0,ba*cb);sb.lineTo(bc,ba*cb);sb.moveTo(0,yb*cb);sb.lineTo(bc,yb*cb);sb.stroke();sb.fillStyle="blue";wb=Id(ub);var Cb;try{for(wb.s();!(Cb=wb.n()).done;){var Da=Cb.value;Da.isEmpty()||vd(Da,"blue",!0)}}catch(W){wb.e(W)}finally{wb.f()}Cb=Id(Nb);var zb;try{for(Cb.s();!(zb=Cb.n()).done;){var db=zb.value,ib=db.style["background-color"]||"red";if("string"===
typeof ib){var Ea=Pc.Color.fromString(ib);Ea&&.5>Ea.a&&(Ea.a=.9,ib=Ea.toRGBAString())}vd(db.range,ib,!0)}}catch(W){Cb.e(W)}finally{Cb.f()}}}},{key:"onMouseDown",value:function(vd){var sb=this,Xb=this.textMorph,Nb=this.measure;Nb.width;Nb.height;Nb=Nb.heightPerLine;vd=vd.positionIn(this);Xb.scrollPositionIntoView({row:Math.round(vd.y/Nb),column:0});Pc.promise.delay(100).then(function(){return sb.update()})}},{key:"onDrag",value:function(vd){this.onMouseDown(vd)}}],[{key:Symbol["for"]("__LivelyClassName__"),
get:function(){return"TextMap"}},{key:"openInside",value:function(vd){var sb=new Pc.TextMap;sb.attachTo(vd);return sb}},{key:"properties",get:function(){return{textMorph:{},relativeBoundsInTextMorph:{},extent:{defaultValue:Pc.pt(60,50)},markers:{},draggable:{defaultValue:!0}}}}],Fd,{pathInPackage:function(){return"./text/map.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.morphic",
version:"0.1.2"}}},{start:251,end:5455})}(Pc.Canvas));Pc.addClassMappings({textmap:Pc.TextMap});Pc["default"]=gd}}});