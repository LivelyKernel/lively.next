System.register(["./__rootModule___commonjs-entry-71573ff5.js","@babel/plugin-syntax-import-meta"],function(Lc){var pd,Nd,Tc;return{setters:[function(Jc){pd=Jc._;Nd=Jc.G;Tc=Jc.x},function(){}],execute:function(){function Jc(Ac){return $d.apply(this,arguments)}function $d(){$d=pd(regeneratorRuntime.mark(function gd(Pc){var nd,Fd,ic,vd,sb,Xb,Nb,bc,hb,cb,Hb,ec,ub,yb,ba,wb,Xa,Za,Sb,Cb,Da,zb,db=arguments;return regeneratorRuntime.wrap(function(ib){for(;;)switch(ib.prev=ib.next){case 0:return nd=1<db.length&&
void 0!==db[1]?db[1]:{},Fd=new Map,Pc.withAllSubmorphsDo(function(Ea){return Ea.isHTMLMorph&&Fd.set(Ea,{domNode:Ea.domNode,parentNode:Ea.domNode.parentNode})}),ic=Pc.renderOnGPU,Pc.renderOnGPU=!0,ib.next=7,Pc.whenRendered();case 7:return vd=Pc.env.domEnv,sb=vd.document,Xb=vd.window,Nb=Pc.renderPreview(Object.assign({},nd,{asNode:!0})),bc=sb.createElement("div"),hb=sb.createElement("div"),cb=nd.width,Hb=nd.height,ec=nd.type,ub=void 0===ec?"svg":ec,System.get("@system-env").node&&Id.fixNodejs(sb,Xb),
ib.prev=13,bc.style.overflow="hidden",bc.style.width="1px",bc.style.height="1px",bc.style.position="absolute",sb.body.appendChild(bc),bc.appendChild(hb),hb.appendChild(Nb),yb=cb&&Hb?null:Nb.getBoundingClientRect(),cb||(hb.style.width=Math.ceil(yb.width+2*Pc.borderWidth)+"px"),Hb||(hb.style.height=Math.ceil(yb.height+2*Pc.borderWidth)+"px"),hb.style.width=cb+"px",hb.style.height=Hb+"px",ba=Id.typeMethodMap[ub]||"toSvg",ib.next=29,Id.domToImage[ba](hb,{style:{transform:"scale(.7)","transform-origin":"center"}});
case 29:return wb=ib.sent,ib.abrupt("return",wb);case 31:ib.prev=31;Pc.renderOnGPU=ic;bc.parentNode&&bc.parentNode.removeChild(bc);Xa=Nd(Fd);try{for(Xa.s();!(Za=Xa.n()).done;)Sb=Tc(Za.value,2),Cb=Sb[1],Da=Cb.domNode,zb=Cb.parentNode,Da&&zb&&Da.parentNode!==zb&&zb.appendChild(Da)}catch(Ea){Xa.e(Ea)}finally{Xa.f()}return ib.finish(31);case 37:case "end":return ib.stop()}},gd,null,[[13,,31,37]])}));return $d.apply(this,arguments)}Lc("renderMorphToDataURI",Jc);var Bb={};(function(Ac){function Pc(ec,ub){ub=
ub||{};gd(ub);return Promise.resolve(ec).then(function(yb){return Fd(yb,ub.filter,!0)}).then(ic).then(vd).then(function(yb){ub.bgcolor&&(yb.style.backgroundColor=ub.bgcolor);ub.width&&(yb.style.width=ub.width+"px");ub.height&&(yb.style.height=ub.height+"px");ub.style&&Object.keys(ub.style).forEach(function(ba){yb.style[ba]=ub.style[ba]});return yb}).then(function(yb){return sb(yb,ub.width||Xb.width(ec),ub.height||Xb.height(ec))})}function gd(ec){Hb.impl.options.imagePlaceholder="undefined"===typeof ec.imagePlaceholder?
cb.imagePlaceholder:ec.imagePlaceholder;Hb.impl.options.cacheBust="undefined"===typeof ec.cacheBust?cb.cacheBust:ec.cacheBust;Hb.impl.options.useCredentials="undefined"===typeof ec.useCredentials?cb.useCredentials:ec.useCredentials}function nd(ec,ub){return Pc(ec,ub).then(Xb.makeImage).then(Xb.delay(100)).then(function(yb){var ba="number"!==typeof ub.scale?1:ub.scale,wb=document.createElement("canvas");wb.width=(ub.width||Xb.width(ec))*ba;wb.height=(ub.height||Xb.height(ec))*ba;if(ub.bgcolor){var Xa=
wb.getContext("2d");Xa.fillStyle=ub.bgcolor;Xa.fillRect(0,0,wb.width,wb.height)}Xa=wb.getContext("2d");yb&&(Xa.scale(ba,ba),Xa.drawImage(yb,0,0));return wb})}function Fd(ec,ub,yb){function ba(Xa,Za,Sb){Xa=Xa.childNodes;return 0===Xa.length?Promise.resolve(Za):function(Cb,Da,zb){var db=Promise.resolve();Da.forEach(function(ib){db=db.then(function(){return Fd(ib,zb)}).then(function(Ea){Ea&&Cb.appendChild(Ea)})});return db}(Za,Xb.asArray(Xa),Sb).then(function(){return Za})}function wb(Xa,Za){return Za instanceof
Element?Promise.resolve().then(function(){(function(Sb,Cb){function Da(zb,db){Xb.asArray(zb).forEach(function(ib){db.setProperty(ib,zb.getPropertyValue(ib),zb.getPropertyPriority(ib))})}Sb.cssText?(Cb.cssText=Sb.cssText,Cb.font=Sb.font):Da(Sb,Cb)})(window.getComputedStyle(Xa),Za.style)}).then(function(){function Sb(Cb){var Da=window.getComputedStyle(Xa,Cb),zb=Da.getPropertyValue("content");if(""!==zb&&"none"!==zb){zb=Xb.uid();var db=Za.getAttribute("class");db&&Za.setAttribute("class",db+" "+zb);
db=document.createElement("style");db.appendChild(function(ib,Ea,W){function T(ka){var K=ka.getPropertyValue("content");return ka.cssText+" content: "+K+";"}function ia(ka){return Xb.asArray(ka).map(function(K){return K+": "+ka.getPropertyValue(K)+(ka.getPropertyPriority(K)?" !important":"")}).join("; ")+";"}ib="."+ib+":"+Ea;W=W.cssText?T(W):ia(W);return document.createTextNode(ib+"{"+W+"}")}(zb,Cb,Da));Za.appendChild(db)}}[":before",":after"].forEach(function(Cb){Sb(Cb)})}).then(function(){Xa instanceof
HTMLTextAreaElement&&(Za.innerHTML=Xa.value);Xa instanceof HTMLInputElement&&Za.setAttribute("value",Xa.value)}).then(function(){Za instanceof SVGElement&&(Za.setAttribute("xmlns","http://www.w3.org/2000/svg"),Za instanceof SVGRectElement&&["width","height"].forEach(function(Sb){var Cb=Za.getAttribute(Sb);Cb&&Za.style.setProperty(Sb,Cb)}))}).then(function(){return Za}):Za}return yb||!ub||ub(ec)?Promise.resolve(ec).then(function(Xa){return Xa instanceof HTMLCanvasElement?Xb.makeImage(Xa.toDataURL()):
Xa.cloneNode(!1)}).then(function(Xa){return ba(ec,Xa,ub)}).then(function(Xa){return wb(ec,Xa)}):Promise.resolve()}function ic(ec){return bc.resolveAll().then(function(ub){var yb=document.createElement("style");ec.appendChild(yb);yb.appendChild(document.createTextNode(ub));return ec})}function vd(ec){return hb.inlineAll(ec).then(function(){return ec})}function sb(ec,ub,yb){return Promise.resolve(ec).then(function(ba){ba.setAttribute("xmlns","http://www.w3.org/1999/xhtml");return(new XMLSerializer).serializeToString(ba)}).then(Xb.escapeXhtml).then(function(ba){return'<foreignObject x="0" y="0" width="100%" height="100%">'+
ba+"</foreignObject>"}).then(function(ba){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+ub+'" height="'+yb+'">'+ba+"</svg>"}).then(function(ba){return"data:image/svg+xml;charset=utf-8,"+ba})}var Xb=function(){function ec(ba){return(ba=/\.([^\.\/]*?)(\?|$)/g.exec(ba))?ba[1]:""}function ub(ba){return new Promise(function(wb){for(var Xa=window.atob(ba.toDataURL().split(",")[1]),Za=Xa.length,Sb=new Uint8Array(Za),Cb=0;Cb<Za;Cb++)Sb[Cb]=Xa.charCodeAt(Cb);wb(new Blob([Sb],{type:"image/png"}))})}
function yb(ba,wb){ba=window.getComputedStyle(ba).getPropertyValue(wb);return parseFloat(ba.replace("px",""))}return{escape:function(ba){return ba.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:ec,mimeType:function(ba){return{woff:"application/font-woff",woff2:"application/font-woff",ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}[ec(ba).toLowerCase()]||""},dataAsUrl:function(ba,
wb){return"data:"+wb+";base64,"+ba},isDataUrl:function(ba){return-1!==ba.search(/^(data:)/)},canvasToBlob:function(ba){return ba.toBlob?new Promise(function(wb){ba.toBlob(wb)}):ub(ba)},resolveUrl:function(ba,wb){var Xa=document.implementation.createHTMLDocument(),Za=Xa.createElement("base");Xa.head.appendChild(Za);var Sb=Xa.createElement("a");Xa.body.appendChild(Sb);Za.href=wb;Sb.href=ba;return Sb.href},getAndEncode:function(ba){Hb.impl.options.cacheBust&&(ba+=(/\?/.test(ba)?"&":"?")+(new Date).getTime());
return new Promise(function(wb){var Xa=new XMLHttpRequest;Xa.onreadystatechange=function(){if(4===Xa.readyState)if(200!==Xa.status)Za?wb(Za):(console.error("cannot fetch resource: "+ba+", status: "+Xa.status),wb(""));else{var Cb=new FileReader;Cb.onloadend=function(){var Da=Cb.result.split(/,/)[1];wb(Da)};Cb.readAsDataURL(Xa.response)}};Xa.ontimeout=function(){Za?wb(Za):(console.error("timeout of 30000ms occured while fetching resource: "+ba),wb(""))};Xa.responseType="blob";Xa.timeout=3E4;Hb.impl.options.useCredentials&&
(Xa.withCredentials=!0);Xa.open("GET",ba,!0);Xa.send();var Za;if(Hb.impl.options.imagePlaceholder){var Sb=Hb.impl.options.imagePlaceholder.split(/,/);Sb&&Sb[1]&&(Za=Sb[1])}})},uid:function(){var ba=0;return function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+ba++}}(),delay:function(ba){return function(wb){return new Promise(function(Xa){setTimeout(function(){Xa(wb)},ba)})}},asArray:function(ba){for(var wb=[],Xa=ba.length,Za=0;Za<Xa;Za++)wb.push(ba[Za]);return wb},
escapeXhtml:function(ba){return ba.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(ba){return"data:,"===ba?Promise.resolve():new Promise(function(wb,Xa){var Za=new Image;Hb.impl.options.useCredentials&&(Za.crossOrigin="use-credentials");Za.onload=function(){wb(Za)};Za.onerror=Xa;Za.src=ba})},width:function(ba){var wb=yb(ba,"border-left-width"),Xa=yb(ba,"border-right-width");return ba.scrollWidth+wb+Xa},height:function(ba){var wb=yb(ba,"border-top-width"),Xa=yb(ba,"border-bottom-width");
return ba.scrollHeight+wb+Xa}}}(),Nb=function(){function ec(wb){return-1!==wb.search(ba)}function ub(wb){for(var Xa=[],Za;null!==(Za=ba.exec(wb));)Xa.push(Za[1]);return Xa.filter(function(Sb){return!Xb.isDataUrl(Sb)})}function yb(wb,Xa,Za,Sb){return Promise.resolve(Xa).then(function(Cb){return Za?Xb.resolveUrl(Cb,Za):Cb}).then(Sb||Xb.getAndEncode).then(function(Cb){return Xb.dataAsUrl(Cb,Xb.mimeType(Xa))}).then(function(Cb){return wb.replace(new RegExp("(url\\(['\"]?)("+Xb.escape(Xa)+")(['\"]?\\))",
"g"),"$1"+Cb+"$3")})}var ba=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(wb,Xa,Za){return ec(wb)?Promise.resolve(wb).then(ub).then(function(Sb){var Cb=Promise.resolve(wb);Sb.forEach(function(Da){Cb=Cb.then(function(zb){return yb(zb,Da,Xa,Za)})});return Cb}):Promise.resolve(wb)},shouldProcess:ec,impl:{readUrls:ub,inline:yb}}}(),bc=function(){function ec(){function ub(yb){return{resolve:function(){return Nb.inlineAll(yb.cssText,(yb.parentStyleSheet||{}).href)},src:function(){return yb.style.getPropertyValue("src")}}}
return Promise.resolve(Xb.asArray(document.styleSheets)).then(function(yb){var ba=[];yb.forEach(function(wb){if(wb.hasOwnProperty("cssRules"))try{Xb.asArray(wb.cssRules||[]).forEach(ba.push.bind(ba))}catch(Xa){console.log("Error while reading CSS rules from "+wb.href,Xa.toString())}});return ba}).then(function(yb){return yb.filter(function(ba){return ba.type===CSSRule.FONT_FACE_RULE}).filter(function(ba){return Nb.shouldProcess(ba.style.getPropertyValue("src"))})}).then(function(yb){return yb.map(ub)})}
return{resolveAll:function(){return ec().then(function(ub){return Promise.all(ub.map(function(yb){return yb.resolve()}))}).then(function(ub){return ub.join("\n")})},impl:{readAll:ec}}}(),hb=function(){function ec(yb){return{inline:function(ba){return Xb.isDataUrl(yb.src)?Promise.resolve():Promise.resolve(yb.src).then(ba||Xb.getAndEncode).then(function(wb){return Xb.dataAsUrl(wb,Xb.mimeType(yb.src))}).then(function(wb){return new Promise(function(Xa,Za){yb.onload=Xa;yb.onerror=Xa;yb.src=wb})})}}}function ub(yb){return yb instanceof
Element?function(ba){var wb=ba.style.getPropertyValue("background");return wb?Nb.inlineAll(wb).then(function(Xa){ba.style.setProperty("background",Xa,ba.style.getPropertyPriority("background"))}).then(function(){return ba}):Promise.resolve(ba)}(yb).then(function(){return yb instanceof HTMLImageElement?ec(yb).inline():Promise.all(Xb.asArray(yb.childNodes).map(function(ba){return ub(ba)}))}):Promise.resolve(yb)}return{inlineAll:ub,impl:{newImage:ec}}}(),cb={imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1},
Hb={toSvg:Pc,toPng:function(ec,ub){return nd(ec,ub||{}).then(function(yb){return yb.toDataURL()})},toJpeg:function(ec,ub){ub=ub||{};return nd(ec,ub).then(function(yb){return yb.toDataURL("image/jpeg",ub.quality||1)})},toBlob:function(ec,ub){return nd(ec,ub||{}).then(Xb.canvasToBlob)},toPixelData:function(ec,ub){return nd(ec,ub||{}).then(function(yb){return yb.getContext("2d").getImageData(0,0,Xb.width(ec),Xb.height(ec)).data})},toCanvas:function(ec,ub){return nd(ec,ub||{})},impl:{fontFaces:bc,images:hb,
util:Xb,inliner:Nb,options:{}}};Bb=Hb})();var rd=Bb,Id=window.lively.FreezerRuntime.recorderFor("lively.morphic/rendering/morph-to-image.js");Id.fixNodejs=function(Ac,Pc){var gd=System.global;Pc.XMLSerializer||(Pc.XMLSerializer=function(){},Pc.XMLSerializer.prototype.serializeToString=function(ic){return ic.outerHTML});gd.window!==Pc&&(gd.window=Pc);gd.document!==Ac&&(gd.document=Ac);Ac=0;for(var nd="HTMLCanvasElement Element HTMLTextAreaElement HTMLInputElement SVGElement SVGRectElement XMLSerializer Blob Image XMLHttpRequest FileReader CSSRule HTMLImageElement".split(" ");Ac<
nd.length;Ac++){var Fd=nd[Ac];Pc[Fd]||(console.log("".concat(Fd," is not available!")),Pc[Fd]=eval("(function ".concat(Fd,'() { throw new Error("').concat(Fd,' not supported"); })')));Pc[Fd]!=gd[Fd]&&(gd[Fd]=Pc[Fd])}};Id.renderMorphToDataURI=Jc;Id.domToImage=rd;Id.typeMethodMap={blob:"toBlob",jpeg:"toJpeg",pixeldata:"toPixelData",png:"toPng",svg:"toSvg"};Id.renderMorphToDataURI=Jc}}});