System.register(["./__root_module__-be0d56fe.js","./index-22c86a41.js","./index-2aae95d3.js","./color-picker-f9089dd8.js"],function(Pa){var Lb,Vb,Dc,jc,qd,id,Cd,bd,Wc,Zc,zd,me,te,Je,jd,Zd,gc,$c,Bd,fd,Jd,fe,Zb,Gc,xd,Ic,Ad,Mb,mb,Ac,vc,ec,Bc,Ua,hc,Eb,qc,Cc,Yc,rd,fc,xc,bc,Qa,Da,ja,Ba,Ja,Fb,wa,Ka,Rb,eb,Sc,Ob,pd,Uc,Kc,Hb,$d,Tb,Gb,La,da,Ha,bb,Qb,uc,Tc,vd,Wd,ed,He,Rd,Fe,z,Ce,Ke,eg,sf,Nd,hf,jf,Bf;return{setters:[function(Xd){Lb=Xd.S;Vb=Xd.R;Dc=Xd.$;jc=Xd.C;qd=Xd.b;id=Xd.a0;Cd=Xd.a1;bd=Xd.P;Wc=Xd.a;Zc=
Xd.s;zd=Xd.Y;me=Xd.a2;te=Xd.e;Je=Xd.m;jd=Xd.K;Zd=Xd.g;gc=Xd.a3;$c=Xd.a4;Bd=Xd.n;fd=Xd.a5;Jd=Xd.q;fe=Xd.j;Zb=Xd.r;Gc=Xd.a6;xd=Xd.o;Ic=Xd.a7;Ad=Xd.a8;Mb=Xd.a9;mb=Xd.M;Ac=Xd.T;vc=Xd.aa;ec=Xd.ab;Bc=Xd.W;Ua=Xd.I;hc=Xd.ac;Eb=Xd.c;qc=Xd.d;Cc=Xd.ad;Yc=Xd.i;rd=Xd.f;fc=Xd.p;xc=Xd.ae;bc=Xd.V;Qa=Xd.O;Da=Xd.Q;ja=Xd.N;Ba=Xd.t;Ja=Xd.af;Fb=Xd.ag;wa=Xd.ah;Ka=Xd.l;Rb=Xd.ai;eb=Xd.aj;Sc=Xd.ak;Ob=Xd.al;pd=Xd.am;Uc=Xd.an;Kc=Xd.ao;Hb=Xd.ap;$d=Xd.aq;Tb=Xd.L;Gb=Xd.ar;La=Xd.h;da=Xd.as;Ha=Xd.z;bb=Xd.Z;Qb=Xd.at;uc=Xd.au},function(Xd){Tc=
Xd.i},function(Xd){vd=Xd.s;Wd=Xd.a;ed=Xd.r;He=Xd._;Rd=Xd.P;Fe=Xd.H;z=Xd.M;Ce=Xd.S;Ke=Xd.b;eg=Xd.c;sf=Xd.G;Nd=Xd.F},function(Xd){hf=Xd.C;jf=Xd.a;Bf=Xd.c}],execute:function(){function Xd(){}function ii(ma,X,Ra){var na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return 1==Fa.nextAddress?X.startsWith("image/")?Fa.yield(Pc.fileReadAsDataURL(ma),3):Fa.jumpTo(2):2!=Fa.nextAddress?(na=Fa.yieldResult,Fa.return(new Pc.Image({imageUrl:na,autoResize:!0,name:ma.name}))):Fa.return(null)})}var Pc=
lively.FreezerRuntime.recorderFor("lively.morphic/events/html-drop-handler.js");Pc.uploadItem=Xd;Pc.uploadFile=ii;Pc.fileReadAsDataURL=function(ma){return new Promise(function(X,Ra){Ra=new Pc.FileReader;Ra.onload=function(na){return X(na.target.result)};Ra.readAsDataURL(ma)})};Pc.Image=Lb;Pc.uploadItem=Xd;Pc.uploadItem=Xd;Pc.uploadFile=ii;Pc.uploadFile=ii;var Ud=lively.FreezerRuntime.recorderFor("lively.ide/world-commands.js");Ud.Rectangle=Vb;Ud.rect=Dc;Ud.Color=jc;Ud.pt=qd;Ud.tree=id;Ud.date=Cd;
Ud.Path=bd;Ud.arr=Wc;Ud.string=Zc;Ud.obj=zd;Ud.inspect=me;Ud.easings=te;Ud.morph=Je;Ud.Text=jd;Ud.config=Zd;Ud.KeyHandler=gc;Ud.loadObjectFromPartsbinFolder=$c;Ud.loadPart=Bd;Ud.interactivelySaveWorld=fd;Ud.show=vd;Ud.showAndSnapToGuides=Wd;Ud.removeSnapToGuidesOf=ed;Ud.LoadingIndicator=Jd;Ud.createMorphSnapshot=fe;Ud.interactivelyFreezeWorld=Tc;Ud.resource=Zb;Ud.BrowserModuleTranslationCache=Gc;Ud.CommentBrowser=He;Ud.once=xd;Ud.commands=[{name:"clear storage and reload",exec:function(){var ma,X;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){if(1==Ra.nextAddress)return Ra.yield($world.confirm(["Caution\n",{},"Proceeding will clear all local storage and reload the page! Make sure if you want to save your world before you continue.",{fontSize:15,fontWeight:"normal"}],{width:400}),2);if(ma=Ra.yieldResult)localStorage.clear(),X=new Ud.BrowserModuleTranslationCache("2"),X.closeDb(),X.deleteDb(),window.location.reload(!0);Ra.jumpToEnd()})}},{name:"undo",exec:function(ma){if(ma.focusedMorph&&
ma.focusedMorph!==ma&&ma.focusedMorph.undoManager)return!1;ma.env.undoManager.undo();return!0}},{name:"redo",exec:function(ma){if(ma.focusedMorph&&ma.focusedMorph!==ma&&ma.focusedMorph.undoManager)return!1;ma.env.undoManager.redo();return!0}},{name:"run command",handlesCount:!0,exec:function(ma,X,Ra){var na,Fa,Ma,lb,Nb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){if(1==Hc.nextAddress)return na=ma.focusedMorph||ma,Fa=Ud.KeyHandler.generateCommandToKeybindingMap(na,!0).map(function(Lc){var kd=
Lc.prettyKeys,Sd=Lc.command.name,ke=Lc.target.constructor.name;kd=kd?kd.join(", "):"";return{isListItem:!0,value:Lc,label:[""+ke,{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+Sd,null],annotation:[kd,{fontSize:"80%",textStyleClasses:["truncated-text"],paddingRight:"5px",maxWidth:140}]}}),Hc.yield(ma.filterableListPrompt("Run command",Fa,{historyId:"lively.morphic-run command",requester:na,extent:Ud.pt(700,600),prompt:ma._cachedRunCommandPrompt}),2);Ma=Hc.yieldResult;lb=
Ma.prompt;Nb=$jscomp.makeIterator(Ma.selected);ac=Nb.next().value;ma._cachedRunCommandPrompt=lb;return Hc.return(ac?ac.target.execCommand(ac.command,X,Ra):!0)})}},{name:"show command history",exec:function(ma,X){var Ra=ma.commandHandler;X=Ud.arr.sortBy(Ra.history,function(na){return-na.time}).map(function(na){return{isListItem:!0,string:Ra.printCommand(na),value:na}});$world.editListPrompt("select commands",X,{multiSelect:!0,requester:ma});return!0}},{name:"show halo for focused morph",exec:function(ma){var X=
ma.focusedMorph;ma.showHaloFor(X.getWindow()||X,ma.firstHand.pointerId);return!0}},{name:"show morph",exec:function(ma,X){Ud.show(X.morph,void 0===X.loop?!1:X.loop)}},{name:"show and snap to guides",exec:function(ma,X){Ud.showAndSnapToGuides(X.target,X.showGuides,X.snap)}},{name:"remove snap to guides",exec:function(ma,X){Ud.removeSnapToGuidesOf(X)}},{name:"copy morph",exec:function(ma){var X=ma.focusedMorph;if(!X||X===ma)return $world.setStatusMessage("no morph selected"),!0;ma=X.getWindow()||X;
X=ma.copy();X.openInWorld(ma.globalPosition.addXY(10,10));X.isWindow&&X.activate();return X}},{name:"select morph",exec:function(ma,X){X=void 0===X?{root:ma,selectionFn:null,justReturn:!1,requester:ma,filterFn:null,prependItems:[],prompt:null,remote:!1}:X;var Ra,na,Fa,Ma,lb,Nb,ac,Hc,Lc,kd,Sd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ke){if(1==ke.nextAddress)return Ra=0,na=X.filterFn||function(){return!0},Fa=X.selectionFn||function(Gd,ye,xe){return ma.filterableListPrompt(Gd,ye,xe)},
ke.yield(System.import("lively.classes/object-classes.js"),2);if(3!=ke.nextAddress)return Ma=ke.yieldResult,lb=Ma.default,Nb=Ud.arr.compact(Ud.tree.map(X.root||ma,function(Gd,ye){if(!na(Gd))return null;var xe=!!lb.lookupPackageForObject(Gd);return{isListItem:!0,label:[""+String(++Ra)+"\u2003".repeat(ye),{fontSize:"80%",textStyleClasses:["v-center-text"],paddingRight:"10px"},""+Gd,{fontWeight:xe?"bolder":"normal",fontStyle:xe?"normal":"italic",fontFamily:"Inconsolata",fontSize:16},xe?" [Object Class]":
"",{opacity:.5}],value:Gd}},function(Gd){return na(Gd)?Gd.submorphs:[]})),ac=["show halo","open object editor","open object inspector"],ke.yield(Fa(X.prompt||"Choose morph",(X.prependItems||[]).concat(Nb),{historyId:"lively.morphic-select morph",onSelection:function(Gd){(void 0).lastSelectionHalo&&(void 0).lastSelectionHalo.remove();Gd&&Gd.show&&Hc!=Gd&&((void 0).lastSelectionHalo=Gd.show(),Hc=Gd)},selectedAction:"show halo",actions:ac}),3);Lc=ke.yieldResult;kd=Lc.selected;Sd=Lc.action;if(X.justReturn)return ke.return(kd);
kd.forEach(function(Gd){Sd===ac[0]?ma.showHaloFor(Gd):Sd===ac[1]?ma.execCommand("open object editor",{target:Gd}):Sd===ac[2]&&ma.execCommand("open object inspector",{target:Gd})});return ke.return(kd)})}},{name:"print morph(s)",exec:function(ma){var X,Ra,na,Fa,Ma,lb,Nb,ac,Hc,Lc,kd,Sd,ke,Gd,ye,xe,le,De;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gf){switch(Gf.nextAddress){case 1:X=!1,Ra=[];case 2:if(X)return Nb=Ud.LoadingIndicator.open("printing morph..."),Gf.yield(System.import("lively.2lively/client.js"),
6);na=$jscomp;Fa=na.makeIterator;return Gf.yield(ma.execCommand("select morph",{justReturn:!0}),4);case 4:return Ma=Fa.call(na,Gf.yieldResult),lb=Ma.next().value,Ra.push(lb),Gf.yield(ma.confirm("Select additional morphs?",{rejectLabel:"NO"}),5);case 5:X=!Gf.yieldResult;Gf.jumpTo(2);break;case 6:return ac=Gf.yieldResult,Hc=ac.default,Lc=Hc.default(),Gf.yield(Lc.listPeers(!0),7);case 7:return kd=Gf.yieldResult,Sd=kd.find(function(cg){return"pdf printer"===cg.type}),ke={ackTimeout:3E4},Gd=Lc,ye=Gd.sendToAndWait,
xe=Sd.id,Gf.yield(Promise.all(Ra.map(function(cg){return Ud.createMorphSnapshot(cg,{addPreview:!1,testLoad:!1})})),9);case 9:return Gf.yield(ye.call(Gd,xe,"[PDF printer] print",Gf.yieldResult,ke),8);case 8:le=Gf.yieldResult;if(De=le.error||le.data.error)throw ma.showError(De),De;ma.serveFileAsDownload(le.data,{fileName:Ra[0].name+(1<Ra.length?".etc":"")+".pdf",type:"application/pdf"});Nb.remove();Gf.jumpToEnd()}})}},{name:"escape",exec:function(ma,X,Ra,na){X=ma.env.eventDispatcher.eventState;X.menu&&
X.menu.remove();X=ma.halos();X.forEach(function(Fa){return Fa.remove()});ma.hands.forEach(function(Fa){return Fa.cancelGrab(!0,na)});ma=Ud.arr.last(X)&&Ud.arr.last(X).target||ma.focusedMorph||ma;ma.focus();ma.isText&&ma.selection.disableMultiSelect&&ma.selection.disableMultiSelect();return!1}},{name:"move or resize halo target",exec:function(ma,X){X=void 0===X?{direction:"left",offset:1,what:"move"}:X;var Ra=ma.halos()[0];if(!Ra||Ra.changingName||ma.focusedMorph!=Ra)return!1;var na=X;ma=na.direction;
X=na.offset;na=na.what;var Fa=Ra.target;X=X||1;switch(ma){case "left":Fa["move"===na?"left":"width"]-=X;break;case "right":Fa["move"===na?"left":"width"]+=X;break;case "up":Fa["move"===na?"top":"height"]-=X;break;case "down":Fa["move"===na?"top":"height"]+=X}Ra.alignWithTarget();return!0}},{name:"close halo target",exec:function(ma){ma=ma.halos()[0];if(!ma||ma.changingName)return!1;ma.target.selectedMorphs?ma.target.selectedMorphs.forEach(function(X){return X.abandon()}):ma.target.abandon();return!0}},
{name:"resize manually",exec:function(ma,X){X=void 0===X?{}:X;var Ra,na,Fa,Ma,lb,Nb,ac,Hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){switch(Lc.nextAddress){case 1:Fa=ma.windowBounds();Ma=ma.bounds();lb=Number;if(Nb=X.width){Lc.jumpTo(2);break}return Lc.yield(ma.prompt("Enter world width",{input:Math.max(Ma.width,Fa.width),requester:ma}),3);case 3:Nb=Lc.yieldResult;case 2:Ra=lb(Nb);if("number"!==typeof Ra){Lc.jumpTo(4);break}ac=Number;if(Hc=X.height){Lc.jumpTo(5);break}return Lc.yield(ma.prompt("Enter world height",
{input:Math.max(Ma.height,Fa.height),requester:ma}),6);case 6:Hc=Lc.yieldResult;case 5:na=ac(Hc);case 4:return"number"!==typeof Ra||isNaN(Ra)||"number"!==typeof na||isNaN(na)||(ma.extent=Ud.pt(Ra,na)),Lc.return(!0)}})}},{name:"resize windows to fit visible world bounds",exec:function(ma){var X=ma.getWindows().filter(function(Ma){return!Ma.minimized});if(!X.length)return!0;ma=ma.visibleBoundsExcludingTopBar();var Ra=X.reduce(function(Ma,lb){return lb.bounds().union(Ma)},new Ud.Rectangle(0,0,0,0)),
na=ma.width/Ra.width,Fa=ma.height/Ra.height;X.forEach(function(Ma){var lb=Ma.bounds();Ma.setBounds(new Ud.Rectangle(lb.x*na,lb.y*Fa,lb.width*na,lb.height*Fa))});return!0}},{name:"window switcher",exec:function(ma){var X,Ra,na,Fa,Ma,lb,Nb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){if(1==Hc.nextAddress){if((X=ma.activePrompt())&&"lively.morphic-window switcher"===X.historyId)return X.focus(),Hc.return(X.get("list").execCommand("select down"));Ra=ma.submorphs.filter(function(Lc){return Lc.isWindow}).reverse().map(function(Lc){return{isListItem:!0,
string:Lc.title||String(Lc),value:Lc}});Ra.forEach(function(Lc){Lc.value.opacity=.5;Lc.value.blur=1});return Hc.yield(ma.filterableListPrompt("Choose window",Ra,{preselect:1,requester:ma,historyId:"lively.morphic-window switcher",onSelection:function(Lc){na&&(na.minimized=Fa,na.blur=1,na.animate({opacity:.3,duration:200}));if(na=Lc)Lc.animate({opacity:1,duration:200}),Lc.blur=0,Fa=Lc.minimized,Lc.minimized=!1},width:1*ma.visibleBounds().extent().x/3,itemPadding:Ud.Rectangle.inset(4)}),2)}lb=Ma=Hc.yieldResult;
Nb=$jscomp.makeIterator(lb.selected);ac=Nb.next().value;Ra.forEach(function(Lc){Lc.value.opacity=1;Lc.value.blur=0});ac&&(ac.activate(),ac.minimized=!1);return Hc.return(!0)})}},{name:"close active window or morph",exec:function(ma){var X=ma.focusedMorph;if(!X)return!0;var Ra=X.getWindow();ma.undoStart("window close");Ra?Ra.close():(Ud.arr.last(Ud.arr.without(X.ownerChain(),ma)).remove(),(Ra=ma.activeWindow())&&Ra.activate());ma.undoStop("window close");return!0}},{name:"toggle minimize active window",
exec:function(ma){(ma=ma.activeWindow())&&ma.toggleMinimize();return!0}},{name:"toggle minimize all windows",exec:function(ma){(ma=ma.getWindows())&&ma.map(function(X){return X.toggleMinimize()});return!0}},{name:"toggle minimize all except active window",exec:function(ma){(ma=ma.getWindows().filter(function(X){return!X.isActive()}))&&ma.map(function(X){return X.toggleMinimize()});return!0}},{name:"close all except active window",exec:function(ma){(ma=ma.getWindows().filter(function(X){return!X.isActive()}))&&
ma.map(function(X){return X.close()});return!0}},{name:"close all windows",exec:function(ma){(ma=ma.getWindows())&&ma.map(function(X){return X.close()});return!0}},{name:"open status message of focused morph",exec:function(ma){var X=ma.focusedMorph;if(ma=$jscomp.makeIterator(X?ma.visibleStatusMessagesFor(X):[]).next().value)ma.expand(),ma.focus();return ma||!0}},{name:"resize active window",exec:function(ma,X){function Ra(){var Sd,ke,Gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ye){if(1==
ye.nextAddress)return ye.yield(ma.filterableListPrompt("How to resize the window?","full center right left bottom top reset".split(" "),{requester:ma}),2);Sd=ye.yieldResult;ke=$jscomp.makeIterator(Sd.selected);Gd=ke.next().value;return ye.return(Gd)})}function na(Sd,ke){switch(Sd){case "full":return ac;case "col1":case "left":return kd.withTopLeft(ac.topLeft());case "col2":case "center":return kd.withCenter(ac.center());case "col3":case "right":return kd.translatedBy(Ud.pt(ac.width-Lc,0));case "top":return ac.divide([Ud.rect(0,
0,1,.5)])[0];case "bottom":return ac.divide([Ud.rect(0,.5,1,.5)])[0];case "reset":return Nb._normalBounds||Ud.pt(500,400).extentAsRectangle().withCenter(ke.center());default:return ke}}X=void 0===X?{how:null,window:null}:X;var Fa,Ma,lb,Nb,ac,Hc,Lc,kd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sd){if(1==Sd.nextAddress){Fa=X;Ma=Fa.window;lb=Fa.how;Nb=Ma||ma.activeWindow();if(!Nb)return Sd.return();ac=ma.visibleBoundsExcludingTopBar().insetBy(15);Hc=Nb.bounds();Nb._normalBounds||(Nb._normalBounds=
Hc);Lc=Math.min(700,Math.max(1E3,ac.width/3));kd=ac.withWidth(Lc);return lb?Sd.jumpTo(2):Sd.yield(Ra(),3)}2!=Sd.nextAddress&&(lb=Sd.yieldResult);if(!lb)return Sd.return();Nb.setBounds(na(lb,ac));"reset"===lb&&delete Nb._normalBounds;return Sd.return(!0)})}},{name:"[recovery] show last object editor saves",exec:function(ma,X){return ma.execCommand("[recovery] show last doits",Object.assign({},X,{title:"logged ObjectEditor save",logAccessFn:function(){return JSON.parse(localStorage["oe helper"]).saves}}))}},
{name:"[recovery] show last doits",description:"browse a list of your last doits",exec:function(ma,X){X=void 0===X?{}:X;var Ra,na,Fa,Ma,lb,Nb,ac,Hc,Lc,kd,Sd,ke,Gd,ye;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xe){if(1==xe.nextAddress){Ra=X;(na=Ra.logAccessFn)||(na=function(){return JSON.parse(localStorage["lively.next-js-ide-doitlog"])});try{Fa=na()}catch(le){}if(!Fa)return xe.return(ma.inform("no log yet"));Ma=Ud.arr.sortBy(Fa.map(function(le,De){var Gf="string"===typeof le?le:le.source;
le="string"===typeof le?De:le.time||De;De=Ud.date.format(new Date(le),"yy-mm-dd HH:MM");return{time:le,source:Gf,printedTime:De}}),function(le){return-le.time});lb=Ma.map(function(le,De){return{isListItem:!0,string:"["+le.printedTime+"] "+le.source.slice(0,100).replace(/\n/g,"").trim(),value:le}});return xe.yield(ma.filterableListPrompt("select doit code",lb,{multiSelect:!0,requester:ma}),2)}Nb=xe.yieldResult;ac=Nb.selected;if(ac.length){Hc=[];Lc=$jscomp.makeIterator(ac);for(kd=Lc.next();!kd.done;kd=
Lc.next())ke=Sd=kd.value,Gd=ke.source,ye=ke.printedTime,Hc.push("// "+ye+"\n"+Gd);return xe.return(ma.execCommand("open workspace",Object.assign({title:"logged doits",mode:"js"},X,{content:Hc.join("\n\n")})))}return xe.return(!0)})}},{name:"open loading indicator",exec:function(ma,X){ma={};"object"===typeof X&&(ma=X,X=ma.label);return Ud.LoadingIndicator.open(X,ma)}},{name:"open workspace",exec:function(ma,X,Ra,na){X=void 0===X?{}:X;var Fa,Ma,lb,Nb,ac,Hc,Lc,kd,Sd,ke;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Gd){switch(Gd.nextAddress){case 1:if(Fa=
na&&ma.relayCommandExecutionToFocusedMorph(na))return Gd.return(Fa);Ma=X.language||X.mode||"javascript";lb={javascript:"lively.ide/js/workspace.js",shell:"lively.ide/shell/workspace.js",html:"lively.ide/html/workspace.js",py:"lively.ide/py/workspace.js",md:"lively.ide/md/workspace.js",sql:"lively.ide/sql/workspace.js",css:"lively.ide/css/workspace.js",less:"lively.ide/css/less/workspace.js",text:null};Nb=Object.keys(Ud.config.ide.modes.aliases).reduce(function(ye,xe){var le={};return Object.assign(ye,
(le[Ud.config.ide.modes.aliases[xe]]=xe,le))},{});if(!X.askForMode){Gd.jumpTo(2);break}ac=Object.keys(lb).concat("javascript console");return Gd.yield(ma.filterableListPrompt("Open workspace for...",ac),3);case 3:if(Hc=Gd.yieldResult,Lc=$jscomp.makeIterator(Hc.selected),Ma=Lc.next().value,!Ma)return Gd.return(!0);case 2:if("javascript console"===Ma)return Gd.return(ma.execCommand("open console",X));X=Object.assign({content:""},X,{mode:Ma,language:Ma});kd=lb[X.language]||lb[Nb[X.language]];return"text"!==
Ma&&kd?Gd.yield(System.import(kd),4):Gd.return(ma.execCommand("open text window",Object.assign({},Ud.config.codeEditor.modes.text,{},X)));case 4:return Sd=Gd.yieldResult,ke=Sd.default,Gd.return((new ke({title:X.title||X.language+" workspace",center:ma.center,content:X.content,target:X.target,systemInterface:X.systemInterface||X.backend})).activate())}})}},{name:"open console",exec:function(ma,X){var Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){if(1==na.nextAddress)return na.yield(Ud.loadObjectFromPartsbinFolder("Console"),
2);Ra=na.yieldResult;return na.return(Ra.openInWorldNearHand())})}},{name:"open shell workspace",exec:function(ma,X){return ma.execCommand("open workspace",Object.assign({},X,{language:"shell"}))}},{name:"open javascript workspace",exec:function(ma,X){return ma.execCommand("open workspace",Object.assign({},X,{language:"javascript"}))}},{name:"open shell terminal",exec:function(ma,X){var Ra,na;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){if(1==Fa.nextAddress)return Fa.yield(System.import("lively.ide/shell/terminal.js"),
2);Ra=Fa.yieldResult;na=Ra.default;return Fa.return(na.open(X).openInWorldNearHand())})}},{name:"open text window",exec:function(ma,X){var Ra=X=void 0===X?{}:X,na=Ra.title,Fa=Ra.extent,Ma=Ra.content,lb=Ra.mode,Nb=Ra.name;Ra=Ra.rangesAndStyles;na=na||"text window";Ma=Ma||"";Fa=Fa||Ud.pt(500,400);Nb=Nb||"text workspace";Ma="string"===typeof Ma?[Ma,null]:Ma;X=new Ud.Text(Object.assign({padding:Ud.Rectangle.inset(3)},Ud.obj.dissoc(X,["title","content"]),{textAndAttributes:Ma,clipMode:"auto",name:Nb,extent:Fa}));
Ra&&X.setTextAttributesWithSortedRanges(Ra);lb&&X.changeEditorMode(lb);return ma.openInWindow(X,{title:na}).activate()}},{name:"merge and open in window",exec:function(ma,X){X=void 0===X?{a:"",b:"",format:null,extent:Ud.pt(500,600)}:X;var Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){if(1==na.nextAddress)return na.yield(Ud.loadObjectFromPartsbinFolder("text merger"),2);Ra=na.yieldResult;return na.return(Ra.targetMorph.open(X.a,X.b,X))})}},{name:"diff and open in window",exec:function(ma,
X){var Ra,na,Fa;function Ma(ke,Gd,ye){var xe,le,De,Gf,cg,ng,Wf,wf,th,fi,Og,xf,dg,qg;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qh){if(1==qh.nextAddress){xe=ye;le=xe.format;De=null;if("patch"!==le)return Sd=kd[le](ke,Gd,ye),Gf=Ud.arr.flatmap(Sd,function(Me){var gi=Me.added;return[Me.value,Me.removed?{fontWeight:"normal",textDecoration:"line-through",fontColor:Ud.Color.red}:gi?{fontWeight:"bold",textDecoration:"",fontColor:Ud.Color.green}:{fontWeight:"normal",textDecoration:"",fontColor:Ud.Color.darkGray}]}),
qh.jumpTo(2);cg=ye;ng=cg.headerA;Wf=cg.headerB;wf=cg.filenameA;th=cg.filenameB;fi=cg.context;Gf=[kd.createTwoFilesPatch(wf||"a",th||"b",ke,Gd,ng,Wf,"number"===typeof fi?{context:fi}:void 0),{}];return qh.yield(System.import("lively.ide/diff/editor-plugin.js"),3)}2!=qh.nextAddress&&(Og=qh.yieldResult,xf=Og.default,De=new xf);dg=ma.execCommand("open text window",ye);qg=dg.targetMorph;dg.extent=Lc||Ud.pt(300,200).maxPt(qg.textBounds().extent());qg.textAndAttributes=Gf;De&&qg.addPlugin(De);return qh.return(qg)})}
X=void 0===X?{a:"",b:"",format:null,extent:Ud.pt(500,600)}:X;var lb,Nb,ac,Hc,Lc,kd,Sd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ke){if(1==ke.nextAddress){lb=X;Nb=lb.a;ac=lb.b;Hc=lb.format;Lc=lb.extent;if(Hc)Nb=String(Nb),ac=String(ac);else{a:{var Gd=Nb,ye=ac;if(Ud.obj.isPrimitive(Gd)||Gd instanceof RegExp||Ud.obj.isPrimitive(ye)||ye instanceof RegExp)Gd=String(Gd),ye=String(ye);if("string"!==typeof Gd||"string"!==typeof ye)try{JSON.stringify(Gd);JSON.stringify(ye);Ra="diffJson";
na=Gd;Fa=ye;break a}catch(xe){Gd=String(Gd),ye=String(ye)}Ra="diffLines";na=Gd;Fa=ye}Nb=na;ac=Fa;Hc=Ra}return ke.yield(System.import("https://jspm.dev/diff"),2)}if(3!=ke.nextAddress)return kd=ke.yieldResult,ke.yield(Ma(Nb,ac,Object.assign({fontFamily:"monospace"},X,{format:Hc})),3);Sd=ke.yieldResult;return ke.return(Sd)})}},{name:"merge workspaces",exec:function(ma,X){return ma.execCommand("diff workspace",Object.assign({},X,{merge:!0}))}},{name:"diff workspaces",exec:function(ma,X){function Ra(Lc,
kd){var Sd=Lc.pluginFind(function(Gd){return Gd.evalEnvironment});Sd=Sd&&Sd.evalEnvironment.targetModule||"no file";var ke=kd.pluginFind(function(Gd){return Gd.evalEnvironment});return ma.execCommand("diff and open in window",{a:Lc.textString,b:kd.textString,filenameA:Sd,filenameB:ke&&ke.evalEnvironment.targetModule||"no file"})}function na(Lc,kd){var Sd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ke){if(1==ke.nextAddress)return ke.yield(Ud.loadObjectFromPartsbinFolder("text merger"),
2);Sd=ke.yieldResult;return ke.return(Sd.targetMorph.open(Lc.textString,kd.textString))})}function Fa(Lc,kd){var Sd,ke,Gd,ye;return $jscomp.asyncExecutePromiseGeneratorProgram(function(xe){if(1==xe.nextAddress)return Sd=Lc.map(function(le){return{isListItem:!0,value:le,string:le.name||String(le)}}),xe.yield(ma.filterableListPrompt("choose text: ",Sd,{onSelection:function(le){le&&le.show()}}),2);ke=xe.yieldResult;Gd=$jscomp.makeIterator(ke.selected);ye=Gd.next().value;return xe.return(ye)})}X=void 0===
X?{}:X;var Ma,lb,Nb,ac,Hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){switch(Lc.nextAddress){case 1:Ma=X;lb=Ma.editor1;Nb=Ma.editor2;ac=Ma.merge;lb&&Nb||(Hc=ma.withAllSubmorphsSelect(function(kd){return kd.isText&&!kd.isInputLine&&!kd.isUsedAsEpiMorph()}).reverse());if(lb){Lc.jumpTo(2);break}return Lc.yield(Fa(Hc),3);case 3:lb=Lc.yieldResult;case 2:if(!lb)return Lc.return(ma.setStatusMessage("Canceled"));if(Nb){Lc.jumpTo(4);break}return Lc.yield(Fa(Ud.arr.without(Hc,lb)),5);case 5:Nb=
Lc.yieldResult;case 4:return Nb?Lc.return(ac?na(lb,Nb):Ra(lb,Nb)):Lc.return(ma.setStatusMessage("Canceled"))}})}},{name:"search workspaces",exec:function(){function ma(Lc,kd){return Lc.map(function(Sd){var ke=Sd.world()?Sd.getWindow():$world.withAllSubmorphsDetect(function(le){return le.isWindow&&le.targetMorph===Je}),Gd=0,ye=Ud.string.lines(Sd.textString).find(function(le,De){le=le.toLowerCase();Gd=De;return kd.every(function(Gf){return le.includes(Gf)})}),xe=ke?ke.title:Sd.toString();return ye?
{isListItem:!0,string:xe+" | "+ye,value:{window:ke,morph:Sd,row:Gd}}:null}).filter(Boolean)}function X(Lc){return $world.withAllSubmorphsDo(function(kd){kd.isWindow&&kd.minimized&&kd.targetMorph&&kd.targetMorph.isText&&(kd=kd.targetMorph);if(!kd.textString||!kd.isText||kd.isUsedAsEpiMorph())return null;var Sd=kd.textString.toLowerCase();return Lc.every(function(ke){return Sd.includes(ke)})?kd:null}).filter(Boolean)}var Ra=this,na,Fa,Ma,lb,Nb,ac,Hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){if(1==
Lc.nextAddress)return Lc.yield($world.filterableListPrompt("search workspaces",[],{historyId:"lively.morphic-ide-search-workspaces-hist",customize:function(kd){kd.getSubmorphNamed("list").updateFilter=function(){var Sd=this.parseInput();if(!(3>Sd.input.length)){var ke=X(Sd.lowercasedTokens);this.listMorph.items=ma(ke,Sd.lowercasedTokens)}}}}),2);na=Lc.yieldResult;Fa=$jscomp.makeIterator(na.selected);return(Ma=Fa.next().value)?(lb=Ma,Nb=lb.morph,ac=lb.window,Hc=lb.row,ac&&(ac.minimized&&ac.toggleMinimize(),
ac.activate()),(ac||Nb).show(),Ra.cursorPosition={row:Hc,column:0},Lc.return(Nb)):Lc.return(null)})}},{name:"open PartsBin",exec:function(ma){var X,Ra,na,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ma){if(1==Ma.nextAddress)return X=Ud.LoadingIndicator.open("Loading Partsbin..."),Ma.yield(System.import("lively.morphic/partsbin.js"),2);if(3!=Ma.nextAddress)return Ra=Ma.yieldResult,na=Ra.loadPart,Ma.yield(na("PartsBin"),3);Fa=Ma.yieldResult;Fa.openInWorldNearHand();Fa.targetMorph.selectedCategory=
"*basics*";Fa.focus();X.remove();Fa.getWindow().activate();return Ma.return(Fa)})}},{name:"browse and load component",exec:function(ma){var X,Ra,na,Fa,Ma,lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:X=Ud.LoadingIndicator.open("loading component browser");if(ma._componentsBrowser){Nb.jumpTo(2);break}return Nb.yield(X.whenRendered(),2);case 2:if(Ra=ma._componentsBrowser){Nb.jumpTo(4);break}Fa=na=ma;return Nb.yield(Ud.resource("part://SystemDialogs/master component browser").read(),
5);case 5:Ra=Fa._componentsBrowser=Nb.yieldResult;case 4:return Ma=Ra,X.remove(),Nb.yield(Ma.activate(),6);case 6:(lb=Nb.yieldResult)&&!lb.world()&&lb.openInWorld(),Nb.jumpToEnd()}})}},{name:"load object from PartsBin",exec:function(ma,X){X=void 0===X?{}:X;var Ra,na,Fa,Ma,lb,Nb,ac,Hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){switch(Lc.nextAddress){case 1:return na=X,Fa=na.name,Ma=void 0===na.open?!0:na.open,Fa?Lc.yield(System.import("lively.morphic/partsbin.js"),6):Lc.yield(System.import("lively.morphic/partsbin.js"),
4);case 4:return lb=Lc.yieldResult,Nb=lb.interactivelyLoadObjectFromPartsBinFolder,Lc.yield(Nb(),5);case 5:Ra=Lc.yieldResult;Lc.jumpTo(3);break;case 6:return ac=Lc.yieldResult,Hc=ac.loadObjectFromPartsbinFolder,Lc.yield(Hc(Fa),7);case 7:Ra=Lc.yieldResult;case 3:return Ra&&Ma&&Ra.openInWorldNearHand(),Lc.return(Ra)}})}},{name:"open object drawer",exec:function(ma){var X,Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){if(1==na.nextAddress)return na.yield(System.import("lively.components/object-drawer.js"),
2);X=na.yieldResult;Ra=X.default;return na.return((new Ra).openInWorldNearHand())})}},{name:"open object editor",exec:function(ma,X){X=void 0===X?{target:null,selectedClass:null,selectedMethod:null,evalEnvironment:null}:X;var Ra,na,Fa,Ma;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lb){if(1==lb.nextAddress){if(!X.target)return ma.setStatusMessage("No target for ObjectEditor"),lb.return(null);Ra=X.loadingIndicator=Ud.LoadingIndicator.open("Open Object Editor...");return lb.yield(System.import("lively.ide/js/objecteditor/index.js"),
2)}if(3!=lb.nextAddress)return na=lb.yieldResult,Fa=na.ObjectEditor,lb.yield(Fa.open(X),3);Ma=lb.yieldResult;Ra.remove();return lb.return(Ma)})}},{name:"open object inspector",exec:function(ma,X){X=void 0===X?{target:null}:X;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ra){return X.target?Ra.return(Ud.inspect(X.target)):(ma.setStatusMessage("no target for Inspector"),Ra.return(null))})}},{name:"inspect server",exec:function(ma){var X,Ra,na,Fa,Ma,lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:return Nb.yield(System.import("lively.ide/js/inspector.js"),
2);case 2:return X=Nb.yieldResult,Ra=X.default,Nb.yield(System.import("lively-system-interface"),3);case 3:return na=Nb.yieldResult,Fa=na.serverInterfaceFor,Ma=Fa(System.baseURL+"eval"),lb={format:"esm",context:"global",targetModule:"lively://lively.next-workspace/world",sourceURL:"inspect-server_"+Date.now(),systemInterface:Ma},Nb.yield(Ma.runEval('\n           import LivelyServer from "lively.server/server.js";\n           let server = LivelyServer.servers.values().next().value;\n        ',lb),
4);case 4:Ra.openInWindow({remoteTarget:{code:"server",evalEnvironment:lb}}),Nb.jumpToEnd()}})}},{name:"open scene graph inspector",exec:function(ma,X){X=void 0===X?{target:null}:X;var Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){if(1==na.nextAddress)return na.yield(Ud.loadObjectFromPartsbinFolder("scene graph inspector"),2);Ra=na.yieldResult;Ra.targetMorph=X.target||ma;return na.return(Ra.openInWindow({title:"morph graph"}))})}},{name:"open browser",progressIndicator:"opening browser...",
exec:function(ma,X,Ra,na){X=void 0===X?{packageName:"lively.morphic",moduleName:"morph.js"}:X;var Fa,Ma,lb,Nb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){switch(Hc.nextAddress){case 1:return(Fa=na&&ma.relayCommandExecutionToFocusedMorph(na))?Hc.return(Fa):Hc.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return Ma=Hc.yieldResult,lb=Ma.default,X?(ac=Ud.obj.select(X,["packageName","moduleName","textPosition","codeEntity","systemInterface"]),Hc.yield(lb.browse(ac,
{extent:Ud.pt(700,600)}),6)):Hc.yield(lb.open(),5);case 5:Nb=Hc.yieldResult;Hc.jumpTo(4);break;case 6:Nb=Hc.yieldResult;case 4:return Nb.getWindow().activate(),Hc.return(Nb)}})}},{name:"choose and browse package resources",progressIndicator:"browsing resources...",exec:function(ma,X,Ra,na){X=void 0===X?{browser:null,systemInterface:null}:X;var Fa,Ma,lb,Nb,ac,Hc,Lc,kd,Sd,ke,Gd,ye,xe,le,De,Gf,cg,ng,Wf,wf,th,fi,Og,xf;return $jscomp.asyncExecutePromiseGeneratorProgram(function(dg){switch(dg.nextAddress){case 1:if(Fa=
na&&ma.relayCommandExecutionToFocusedMorph(na))return dg.return(Fa);Ma=(Ma=X.browser||ma.focusedMorph&&ma.focusedMorph.ownerChain().find(function(qg){return qg.isBrowser}))&&Ma.isBrowser?Ma.getWindow():null;return dg.yield(System.import("lively-system-interface"),2);case 2:return lb=dg.yieldResult,Nb=lb.localInterface,ac=X&&X.systemInterface?X.systemInterface:Ma?Ma.systemInterface:Nb,dg.yield(ac.getPackages({excluded:Ud.config.ide.js.ignoredPackages}),3);case 3:Hc=dg.yieldResult,Lc=[],kd={},Sd=$jscomp.makeIterator(Hc),
ke=Sd.next();case 4:if(ke.done)return dg.yield(ma.filterableListPrompt("Choose module to open",Lc,{historyId:"lively.morphic-choose and browse package resources",requester:Ma,width:700,multiSelect:!0,fuzzy:"value.shortName"}),8);kd.$jscomp$loop$prop$p$2955=ke.value;kd.$jscomp$loop$prop$excluded$2954=(Ud.Path("lively.ide.exclude").get(kd.$jscomp$loop$prop$p$2955)||[]).map(function(qg){return qg.includes("*")?new RegExp(qg.replace(/\*/g,".*")):qg});kd.$jscomp$loop$prop$excluded$2954.push(".git","node_modules",
".module_cache");Gd=Lc.push;ye=Gd.apply;xe=Lc;le=$jscomp;De=le.arrayFromIterable;Gf=function(qg){return function(qh){return{isListItem:!0,string:"["+qg.$jscomp$loop$prop$p$2955.name+"] "+qh.nameInPackage+(qh.isLoaded?"":" [not loaded]"),value:qh}}}(kd);cg=function(qg){return function(qh){var Me=qh.url;return!Me.endsWith("/")&&!qg.$jscomp$loop$prop$excluded$2954.some(function(gi){return gi instanceof RegExp?gi.test(Me):Me.includes(gi)})}}(kd);return dg.yield(ac.resourcesOfPackage(kd.$jscomp$loop$prop$p$2955,
kd.$jscomp$loop$prop$excluded$2954),7);case 7:ye.call(Gd,xe,De.call(le,dg.yieldResult.filter(cg).sort(function(qg,qh){return qg.isLoaded&&!qh.isLoaded?-1:!qg.isLoaded&&qh.isLoaded?1:qg.nameInPackage.toLowerCase()<qh.nameInPackage.toLowerCase()?-1:qg.nameInPackage.toLowerCase()==qh.nameInPackage.toLowerCase()?0:1}).map(Gf)));kd={$jscomp$loop$prop$excluded$2954:kd.$jscomp$loop$prop$excluded$2954,$jscomp$loop$prop$p$2955:kd.$jscomp$loop$prop$p$2955};ke=Sd.next();dg.jumpTo(4);break;case 8:return ng=dg.yieldResult,
Wf=ng.selected,wf=$jscomp.makeIterator(Ud.arr.partition(Wf,function(qg){return qg.url.match(/\.js(on)?/)})),th=wf.next().value,fi=wf.next().value,dg.yield(System.import("lively.ide/js/browser/index.js"),9);case 9:return Og=dg.yieldResult,xf=Og.default,dg.yield(Promise.all(th.map(function(qg){return xf.browse({packageName:qg.package,moduleName:qg.url},Ma,ac).then(function(qh){return qh.activate()})})),10);case 10:if(!fi.length){dg.jumpTo(11);break}return dg.yield(Promise.all(fi.map(function(qg){return ma.execCommand("open file",
{url:qg.url})})),11);case 11:return dg.return(!0)}})}},{name:"choose and browse module",progressIndicator:"browsing module...",handlesCount:!0,exec:function(ma,X,Ra){X=void 0===X?{browser:void 0,systemInterface:void 0}:X;var na,Fa,Ma,lb,Nb,ac,Hc,Lc,kd,Sd,ke,Gd,ye,xe,le,De,Gf,cg,ng;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Wf){switch(Wf.nextAddress){case 1:if(!X.browser&&(Fa=(na=ma.focusedMorph)&&na.getWindow())&&Fa.targetMorph&&Fa.targetMorph.isFileBrowser)return Wf.return(Fa.targetMorph.execCommand("find file and select",
X,Ra));Ma=X.browser||na&&na.ownerChain().find(function(wf){return wf.isBrowser});return Wf.yield(System.import("lively.ide/js/browser/index.js"),2);case 2:return lb=Wf.yieldResult,Nb=lb.default,Wf.yield(System.import("lively-system-interface"),3);case 3:return ac=Wf.yieldResult,Hc=ac.localInterface,Lc=X&&X.systemInterface?X.systemInterface:Ma?Ma.systemInterface:Hc,kd="local"==Lc.name?"":" on ["+Ud.string.truncate(Lc.name,35,"...")+"]",Wf.yield(Lc.getPackages(),4);case 4:Sd=Wf.yieldResult;ke=[];Gd=
$jscomp.makeIterator(Sd);for(ye=Gd.next();!ye.done;ye=Gd.next())for(xe=ye.value,le=Ud.Path("lively.ide.exclude").get(xe)||[],le=le.map(function(wf){return wf.includes("*")?new RegExp(wf.replace(/\*/g,".*")):wf}),De={},Gf=$jscomp.makeIterator(xe.modules),cg=Gf.next();!cg.done;De={$jscomp$loop$prop$m$2957:De.$jscomp$loop$prop$m$2957},cg=Gf.next())De.$jscomp$loop$prop$m$2957=cg.value,le.some(function(wf){return function(th){return th instanceof RegExp?th.test(wf.$jscomp$loop$prop$m$2957.name):wf.$jscomp$loop$prop$m$2957.name.includes(th)}}(De))||
(ng=Lc.shortModuleName(De.$jscomp$loop$prop$m$2957.name,xe),ke.push({isListItem:!0,string:"["+xe.name+"] "+ng,value:{package:xe,module:De.$jscomp$loop$prop$m$2957,shortName:ng}}));ke=Ud.arr.sortBy(ke,function(wf){return wf.string});(function(){var wf,th,fi,Og,xf,dg,qg,qh,Me;return $jscomp.asyncExecutePromiseGeneratorProgram(function(gi){switch(gi.nextAddress){case 1:return wf=Ma||na,gi.yield(ma.filterableListPrompt("Choose module to open"+kd,ke,{historyId:"lively.morphic-choose and browse module",
requester:wf,height:Math.min(wf.height,700),width:500,multiSelect:!0,listFontColor:"white",fuzzy:"value.shortName"}),2);case 2:th=gi.yieldResult,fi=th.selected,Og=0;case 3:if(!(Og<fi.length)){gi.jumpTo(0);break}xf=fi[Og];dg=xf.package;qg=xf.shortName;qh={packageName:dg.name,moduleName:qg};return gi.yield(Nb.browse(qh,0===Og?Ma:void 0,Lc),6);case 6:Me=gi.yieldResult,Me.moveBy(Ud.pt(20*Og,20*Og)),Me.getWindow().activate(),Og++,gi.jumpTo(3)}})})();return Wf.return(!0)}})}},{name:"open code search",progressIndicator:"opening code search...",
exec:function(ma,X){X=void 0===X?{browser:null,systemInterface:null,input:null}:X;var Ra,na,Fa,Ma,lb,Nb,ac,Hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){if(1==Lc.nextAddress){Ra=ma.focusedMorph?ma.focusedMorph.ownerChain():[];na=X.browser||Ra.find(function(kd){return kd.isBrowser});Fa=Ud.LoadingIndicator.open("loading code search");if(na&&na.isBrowser){if(na.state.associatedSearchPanel)return Lc.return(na.state.associatedSearchPanel.getWindow().activate())}else na=null;return Lc.yield(System.import("lively-system-interface"),
2)}if(3!=Lc.nextAddress)return Ma=Lc.yieldResult,lb=Ma.localInterface,Nb=X.systemInterface||na&&na.systemInterface,Nb||(Nb=(ac=Ra.find(function(kd){return kd.isText&&kd.editorPlugin&&kd.editorPlugin.isJSEditorPlugin}))?ac.editorPlugin.systemInterface():lb),Lc.yield(Ud.resource("part://SystemIDE/code search").read(),3);Hc=Lc.yieldResult;Object.assign(Hc,{browser:na,input:X.input,systemInterface:Nb});Hc.openInWindow();Hc.focus();Fa.remove();na&&(na.state.associatedSearchPanel=Hc);return Lc.return(Hc)})}},
{name:"open grep search",progressIndicator:"opening code search...",exec:function(ma,X){var Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){if(1==na.nextAddress)return na.yield(Ud.loadObjectFromPartsbinFolder("grep search"),2);Ra=na.yieldResult;return na.return(Ra.openInWorldNearHand(ma).activate())})}},{name:"open test runner",progressIndicator:"opening test runner...",exec:function(ma){var X,Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){return 1==na.nextAddress?
na.yield(System.import("lively.ide/test-runner.js"),2):3!=na.nextAddress?(X=na.yieldResult,Ra=X.default,na.yield(Ra.open(),3)):na.return(na.yieldResult)})}},{name:"open file browser",progressIndicator:"opening file browser...",exec:function(ma,X){X=void 0===X?{}:X;var Ra,na,Fa,Ma,lb,Nb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){if(1==Hc.nextAddress)return Hc.yield(System.import("lively.ide/http-file-browser.js"),2);Ra=Hc.yieldResult;na=Ra.default;Fa=X;Ma=Fa.location;lb=Fa.url;
ac=(Nb=Fa.file)?na.forFile(Nb,Ma):na.forLocation(lb||Ma||document.location.origin);return Hc.return(ma.openInWindow(ac).activate())})}},{name:"open file",progressIndicator:"opening file...",exec:function(ma,X){X=void 0===X?{url:null,lineNumber:null,reuse:!1}:X;var Ra,na,Fa,Ma,lb,Nb,ac,Hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){switch(Lc.nextAddress){case 1:Ra=X;na=Ra.url;Fa=Ra.lineNumber;Ma=Ra.reuse;lb=ma.commandHandler.progressIndicator;if(na){Lc.jumpTo(2);break}lb.visible=
!1;return Lc.yield(ma.prompt("Enter file location",{historyId:"lively.morphic-text editor url",useLastInput:!0}),3);case 3:na=Lc.yieldResult,lb.visible=!0;case 2:if(Ma&&(ma.getWindows().slice(-2),Nb=Ud.arr.findAndGet(ma.getWindows(),function(kd){return(kd=kd.targetMorph)&&kd.isTextEditor&&kd.location.split(":")[0]===na?kd:null})))return"number"===typeof Fa&&(Nb.lineNumber=Fa),Lc.return(Nb.getWindow().activate());Fa&&(na+=":"+Fa);return Lc.yield(System.import("lively.ide/text-editor.js"),4);case 4:return ac=
Lc.yieldResult,Hc=ac.default,Lc.return(na?Hc.openURL(na,Ud.obj.dissoc(X,["url"])):null)}})}},{name:"open file for EDITOR",exec:function(ma,X){X=void 0===X?{url:null,lineNumber:null}:X;var Ra,na,Fa,Ma;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lb){return 1==lb.nextAddress?lb.yield(System.import("lively.ide/text-editor.js"),2):3!=lb.nextAddress?(Ra=lb.yieldResult,na=Ra.default,Fa=X,Ma=Fa.url,lb.yield(na.openAsEDITOR(Ma,{}),3)):lb.return(lb.yieldResult)})}},{name:"open subserver controller",
exec:function(ma,X){var Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){if(1==na.nextAddress)return na.yield(Ud.loadPart("subserver controller"),2);Ra=na.yieldResult;return na.return(Ra.openInWorld())})}},{name:"[lively.installer] publish new version of a package",exec:function(ma){var X,Ra;return $jscomp.asyncExecutePromiseGeneratorProgram(function(na){switch(na.nextAddress){case 1:return na.yield(lively.modules.registerPackage(document.location.origin+"/lively.installer"),2);
case 2:return na.yield(System.import("lively.installer/packages/publish-new-package-version.js"),3);case 3:return X=na.yieldResult,Ra=X.default,na.yield(Ra(),4);case 4:return na.return(!0)}})}},{name:"report a bug",exec:function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){window.open("https://github.com/LivelyKernel/lively.next/issues/new","_blank");return X.return(!0)})}},{name:"fix font metric",exec:function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){ma.env.fontMetric.reset();
ma.withAllSubmorphsDo(function(Ra){return Ra.isText&&Ra.textLayout&&Ra.textLayout.reset()});return X.return(!0)})}},{name:"delete change history",exec:function(ma){var X=ma.env,Ra=X.printStatus();X.deleteHistory();ma.setStatusMessage(Ra);ma._componentsBrowser&&ma._componentsBrowser.reset();return!0}},{name:"install global inspect and show",exec:function(ma){window.show=Ud.show;window.inspect=Ud.inspect;ma.setStatusMessage("inspect() and show() are now globally available");return!0}},{name:"save world",
exec:function(ma,X,Ra,na){var Fa,Ma,lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){if(1==Nb.nextAddress){if(Fa=na&&ma.relayCommandExecutionToFocusedMorph(na))return Nb.return(Fa);X=Object.assign({confirmOverwrite:!0,showSaveDialog:!0},X);Ma=ma.focusedMorph;return Nb.yield(Ud.interactivelySaveWorld(ma,X),2)}lb=Nb.yieldResult;Ma&&Ma.focus();return Nb.return(lb)})}},{name:"freeze world",exec:function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){return X.yield(Ud.interactivelyFreezeWorld(ma),
0)})}},{name:"save this world",exec:function(ma,X,Ra,na){return ma.execCommand("save world",Object.assign({confirmOverwrite:!0},X,{showSaveDialog:!1}))}},{name:"load world",exec:function(ma,X){X=void 0===X?{}:X;var Ra,na,Fa,Ma,lb,Nb,ac,Hc,Lc,kd,Sd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ke){switch(ke.nextAddress){case 1:Ra=X;na=Ra.id;Fa=Ra.commit;Ma=Ra.name;lb=Ra.ref;Nb=Ra.world;ac=ma.constructor;if(Nb)return ke.return(ac.loadWorld(Nb,ma));if(na||Fa)return ke.return(ac.loadFromCommit(na||
Fa,ma));if(Ma)return ke.return(ac.loadFromDB(Ma,lb,ma));Hc=Ud.LoadingIndicator.open("loading project browser...");return ke.yield(Hc.whenRendered(),2);case 2:Lc=Ud.morph({fill:Ud.Color.black.withA(.5),extent:ma.extent,name:"dark overlay",opacity:0,reactsToPointer:!1,renderOnGPU:!0,halosEnabled:!1});Lc.openInWorld(Ud.pt(0,0));Lc.animate({opacity:1,duration:300});if(kd=ma.get("a project browser")){ke.jumpTo(3);break}return ke.yield(Ud.resource("part://partial freezing/project browser").read(),4);case 4:kd=
ke.yieldResult;case 3:return Sd=kd,Sd.name="a project browser",Sd.hasFixedPosition=!0,Sd.epiMorph=!0,Sd.bringToFront().alignInWorld(ma),Sd.update(),Sd.focus(),Ud.once(Sd,"remove",function(){return Lc.animate({opacity:0}).then(function(){return Lc.remove()})}),Hc.remove(),ke.return(Sd)}})}},{name:"add external package dependency to object",exec:function(ma,X){X=void 0===X?{}:X;var Ra,na,Fa,Ma;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lb){if(1==lb.nextAddress)return Ra=X.target||ma,
na=Ra.metadata&&Ra.metadata.externalPackages||[],lb.yield(ma.editListPrompt("modify package dependencies of "+Ra,na),2);Fa=lb.yieldResult;Ma=Fa.list;if(!Ma)return lb.return();Ma.length?(Ra.metadata||(Ra.metadata={}),Ra.metadata.externalPackages=Ma):Ra.metadata&&delete Ra.metadata.externalPackages;return lb.return(!0)})}},{name:"toggle comment browser",exec:function(ma){return $jscomp.asyncExecutePromiseGeneratorProgram(function(X){Ud.CommentBrowser.toggle();X.jumpToEnd()})}}];var df=Ud.commands;Ud.default=
df;var yd=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js");yd.RadialGradient=Ic;yd.Point=Ad;yd.pt=qd;yd.rect=Dc;yd.Color=jc;yd.LinearGradient=Mb;yd.Morph=mb;yd.Tooltip=Ac;yd.Image=Lb;yd.VerticalLayout=vc;yd.GridLayout=ec;yd.Text=jd;yd.Ellipse=Bc;yd.morph=Je;yd.Icon=Ua;yd.num=hc;yd.arr=Wc;yd.connect=Eb;yd.signal=qc;yd.Popover=Rd;yd.ColorPalette=hf;yd.ColorPicker=jf;yd.colorWidgets=Bf;yd.joinPath=Cc;yd.WHEEL_URL=yd.joinPath(System.baseURL,"/lively.ide/assets/color-wheel.png");
(function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("GradientTypeSelector")&&"function"===typeof X.GradientTypeSelector?X.GradientTypeSelector:X.GradientTypeSelector=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,[{key:"defaultLinearGradient",get:function(){return new yd.LinearGradient({stops:[{color:yd.Color.white,offset:0},{color:yd.Color.black,
offset:1}]})}},{key:"defaultRadialGradient",get:function(){return new yd.RadialGradient({stops:[{color:yd.Color.white,offset:0},{color:yd.Color.black,offset:1}],focus:yd.pt(.5,.5),bounds:yd.rect(0,0,30,30)})}},{key:"update",value:function(na){var Fa=$jscomp.makeIterator(this.submorphs),Ma=Fa.next().value;Fa=Fa.next().value;Ma.borderColor=Fa.borderColor=yd.Color.gray.darker();na instanceof yd.RadialGradient?Ma.borderColor=yd.Color.orange:na instanceof yd.LinearGradient&&(Fa.borderColor=yd.Color.orange)}}],
[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientTypeSelector"}},{key:"properties",get:function(){return{fill:{defaultValue:yd.Color.transparent},layout:{initialize:function(){this.extent=yd.pt(180,40);this.layout=new yd.GridLayout({grid:[[null,"radialMode",null,"linearMode",null]],autoAssign:!1,fitToCell:!1})}},submorphs:{initialize:function(){var na=this,Fa=$jscomp.makeIterator(this.submorphs=[yd.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},
name:"radialMode",fill:this.defaultRadialGradient}),yd.morph({type:"ellipse",master:{auto:"styleguide://SystemWidgets/gradient mode/deselected"},name:"linearMode",fill:this.defaultLinearGradient})]),Ma=Fa.next().value;Fa=Fa.next().value;yd.connect(Ma,"onMouseDown",function(){return yd.signal(na,"radial")});yd.connect(Fa,"onMouseDown",function(){return yd.signal(na,"linear")})}}}}}],X,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:660,end:2566})})(yd.Morph);var Pe=function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("GradientEditor")&&"function"===typeof X.GradientEditor?X.GradientEditor:X.GradientEditor=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};
return Yc(Ra,ma,[{key:"remove",value:function(){Yc._get(Object.getPrototypeOf(Ra.prototype),"remove",this).call(this);this.gradientHandle&&this.gradientHandle.remove()}},{key:"selectRadialGradient",value:function(){var na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return 1==Fa.nextAddress?(na.get("linearMode").borderColor=yd.Color.gray.darker(),na.get("radialMode").borderColor=yd.Color.orange,Fa.yield(na.applyGradient(yd.RadialGradient),2)):Fa.yield(na.updateGradientHandles(),
0)})}},{key:"selectLinearGradient",value:function(){var na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return 1==Fa.nextAddress?(na.get("radialMode").borderColor=yd.Color.gray.darker(),na.get("linearMode").borderColor=yd.Color.orange,Fa.yield(na.applyGradient(yd.LinearGradient),2)):Fa.yield(na.updateGradientHandles(),0)})}},{key:"applyGradient",value:function(na){var Fa=this,Ma,lb,Nb,ac,Hc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){Ma=Fa.gradientValue;
Fa.get("gradientEditor");Ma&&Ma.isGradient?(lb=Ma,Nb=lb.stops,ac=lb.focus,Hc=lb.vector,Fa.gradientValue=new na({stops:Nb,bounds:Fa.gradientBounds,focus:ac,vector:Hc})):Fa.gradientValue=new na({stops:[{color:yd.Color.white,offset:0},{color:yd.Color.black,offset:1}],bounds:Fa.gradientBounds});Fa.update(Fa.gradientValue);Lc.jumpToEnd()})}},{key:"showGradientHandlesOn",value:function(na){this.handleMorph=na;this.updateGradientHandles()}},{key:"updateGradientHandles",value:function(){var na=this,Fa,Ma;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(lb){if(1==lb.nextAddress)return Fa=300,Ma=na.gradientValue.__proto__.constructor,na.handleMorph?na.gradientHandle?lb.yield(na.gradientHandle.fadeOut(Fa),3):lb.jumpTo(2):lb.return();Ma==yd.RadialGradient?na.gradientHandle=new yd.GradientFocusHandle({target:na.handleMorph}):Ma==yd.LinearGradient&&(na.gradientHandle=new yd.GradientDirectionHandle({target:na.handleMorph}));na.gradientHandle&&(yd.signal(na,"openHandle",na.gradientHandle),na.gradientHandle.relayout(),
na.gradientHandle.opacity=0,na.gradientHandle.animate({opacity:1,duration:Fa}));lb.jumpToEnd()})}},{key:"update",value:function(na){(na=void 0===na?this.gradientValue:na)&&na.isGradient&&this.get("gradientEditor").update(na)}},{key:"build",value:function(){var na;this.submorphs=[na=new yd.GradientTypeSelector({name:"typeSelector"}),this.gradientEditor()];yd.connect(na,"radial",this,"selectRadialGradient");yd.connect(na,"linear",this,"selectLinearGradient");yd.connect(this,"gradientValue",this,"update");
this.update(this.gradientValue);na.update(this.gradientValue);this.gradientValue&&this.updateGradientHandles()}},{key:"gradientEditor",value:function(){return yd.morph({fill:null,clipMode:"hidden",extent:yd.pt(190,80),submorphs:[new yd.GradientStopVisualizer({position:yd.pt(5,30),name:"gradientEditor",gradientEditor:this})]})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientEditor"}},{key:"properties",get:function(){return{layout:{initialize:function(){this.layout=new yd.VerticalLayout({spacing:3})}},
fill:{defaultValue:yd.Color.transparent},handleMorph:{},gradientValue:{set:function(na){na&&na.isGradient||(na=!1);this.setProperty("gradientValue",na)}},submorphs:{initialize:function(){this.build()}}}}}],X,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:2575,end:6191})}(yd.Morph);
yd.GradientEditor=Pe;yd.GradientEditor=Pe;yd.GradientEditor=Pe;(function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("StopControlHead")&&"function"===typeof X.StopControlHead?X.StopControlHead:X.StopControlHead=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,[{key:"update",value:function(na){var Fa=this.getSubmorphNamed("paletteField");this.getSubmorphNamed("pickerField");
Fa||(this.submorphs=[Fa=this.paletteField(yd.pt(10,10))]);Fa.fill=this.stopColor=na.stops[this.index].color}},{key:"onHoverIn",value:function(){var na=this.targetProperty.stops[this.index].color;this.palette=this.palette||new yd.Popover({name:"Color Palette",targetMorph:new yd.ColorPalette({color:na})});yd.connect(this.palette.targetMorph,"color",this.palette,"color");this.picker=this.picker||new yd.ColorPicker({color:na});this.picker.color=na;this.scheduleExpand()}},{key:"onHoverOut",value:function(){this.scheduleShrink()}},
{key:"scheduleExpand",value:function(){this.queue.pop()||(this.queue.push(this.expand),this.dequeue())}},{key:"scheduleShrink",value:function(){this.queue.pop()||(this.queue.push(this.shrink),this.dequeue())}},{key:"dequeue",value:function(){var na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){if(1==Fa.nextAddress){if(na.queueActive)return Fa.return();na.queueActive=!0}if(3!=Fa.nextAddress)return 0<na.queue.length?Fa.yield(na.queue.shift().bind(na)(),2):Fa.jumpTo(3);na.queueActive=
!1;Fa.jumpToEnd()})}},{key:"expand",value:function(){var na=this,Fa,Ma,lb,Nb,ac,Hc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){if(1<na.submorphs.length)return kd.return();Fa=na.get("paletteField");lb=yd.pt(2,-14);na.submorphs=[na.closeButton(),Fa,na.pickerField()];na.master={auto:"styleguide://SystemWidgets/stop control head/expanded"};Ma=na.get("gradientEditor");Nb=na.transformRectToMorph(Ma,na.innerBounds());ac=Nb.x;Hc=Nb.width;Lc=ac+Hc-Ma.width;ac<na.width/2&&(lb=lb.addXY(na.width/
3-ac,0));Lc>na.width/2&&(lb=lb.addXY(na.width/3-Lc,0));Fa.extent=yd.pt(15,15);na.center=lb;na.stopVisualizer.gradientEditor.update();kd.jumpToEnd()})}},{key:"shrink",value:function(){var na=this,Fa,Ma,lb,Nb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){if(3>na.submorphs.length)return Hc.return();Fa=yd.pt(2,-14);Ma=$jscomp.makeIterator([na.get("close"),na.get("paletteField"),na.get("pickerField")]);lb=Ma.next().value;Nb=Ma.next().value;ac=Ma.next().value;Nb.bringToFront();lb.remove();
ac.remove();na.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"};na.center=Fa;Hc.jumpToEnd()})}},{key:"onWidgetClosed",value:function(){this.palette=this.picker=null;this.shrink()}},{key:"removeStop",value:function(){this.stopVisualizer.removeStop(this.index)&&this.remove()}},{key:"closeButton",value:function(){var na=new yd.Morph({name:"close",extent:yd.pt(15,15),fill:yd.Color.transparent,origin:yd.pt(0,-3),clipMode:"hidden",submorphs:[yd.Icon.makeLabel("times",{styleClasses:["closeButton"]})]});
yd.connect(na,"onMouseDown",this,"removeStop");return na}},{key:"updateColor",value:function(na){this.stopVisualizer.updateStop(this.index,{color:na})}},{key:"openColorWidget",value:function(na){this.stopVisualizer.stopControls.forEach(function(Fa){return Fa.head.closeAllWidgets()});this[na].topLeft=yd.pt(0,0);yd.connect(this[na],"color",this,"updateColor");yd.connect(this[na],"close",this,"onWidgetClosed");yd.connect(this.stopVisualizer,"remove",this[na],"remove");yd.connect(this[na],"onBlur",this,
"removeWhenLostFocus",{converter:function(){return na},varMapping:{name:na}});this[na].fadeIntoWorld(this.globalBounds().bottomCenter());this[na].focus()}},{key:"removeWhenLostFocus",value:function(na){var Fa=this;setTimeout(function(){$world.focusedMorph.ownerChain().includes(Fa[na])||$world.focusedMorph.isMenuItem?Fa[na].focus():Fa.closeColorWidget(na)},100)}},{key:"closeColorWidget",value:function(na){this[na]&&this[na].remove()}},{key:"closeAllWidgets",value:function(){this.closeColorWidget("palette");
this.closeColorWidget("picker")}},{key:"paletteField",value:function(na){na=yd.morph({type:"ellipse",name:"paletteField",extent:na,styleClasses:["paletteField"]});yd.connect(na,"onMouseDown",this,"openColorWidget",{converter:function(){return"palette"}});return na}},{key:"pickerField",value:function(){var na=new yd.Image({name:"pickerField",styleClasses:["pickerField"]});yd.connect(na,"onMouseDown",this,"openColorWidget",{converter:function(){return"picker"}});return na}}],[{key:Symbol.for("__LivelyClassName__"),
get:function(){return"StopControlHead"}},{key:"properties",get:function(){return{stopVisualizer:{},gradientEditor:{},targetProperty:{get:function(){return this.stopVisualizer.targetProperty}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/stop control head/collapsed"}}},index:{},queue:{defaultValue:[]},isHaloItem:{defaultValue:!0}}}}],X,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:6193,end:11487})})(yd.Morph);(function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("GradientStopVisualizer")&&"function"===typeof X.GradientStopVisualizer?X.GradientStopVisualizer:X.GradientStopVisualizer=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Yc(Ra,ma,[{key:"update",value:function(na){this.fill=new yd.LinearGradient({stops:na.stops,vector:"eastwest"});this.get("instruction").animate({visible:!1,duration:300});this.renderStopControls(na)}},{key:"onHoverOut",value:function(){this.toggleStopPreview(!1)}},{key:"onMouseMove",value:function(na){var Fa=na.positionIn(this);na=Fa.x;this.stopControls&&this.stopControls.find(function(Ma){return Ma.bounds().containsPoint(Fa)})?this.toggleStopPreview(!1):(this.toggleStopPreview(!0),
this.get("stopControlPreview").position=yd.pt(na,0))}},{key:"onMouseDown",value:function(na){if(this.get("stopControlPreview").visible){var Fa=na.positionIn(this).x/this.width;na=this.targetProperty.stops.findIndex(function(Ma){return Ma.offset>Fa});na=0>na?this.targetProperty.stops.length-1:na;this.insertStop(na,Fa)}}},{key:"toggleStopPreview",value:function(na){this.get("instruction").visible||(this.get("stopControlPreview").visible=na)}},{key:"removeStop",value:function(na){var Fa=this.targetProperty;
return 2<Fa.stops.length?(yd.arr.removeAt(Fa.stops,na),this.targetProperty=Fa,!0):!1}},{key:"insertStop",value:function(na,Fa){var Ma=this.targetProperty;yd.arr.pushAt(Ma.stops,{offset:Fa,color:Ma.stops[na].color},na);this.targetProperty=Ma}},{key:"updateStop",value:function(na,Fa){var Ma=this.targetProperty;Ma.stops[na]=Object.assign({},Ma.stops[na],{},Fa);this.targetProperty=Ma}},{key:"renderStopControls",value:function(na){var Fa=this;if(!this.stopControls||this.stopControls.length!=na.stops.length){var Ma=
$jscomp.makeIterator(this.submorphs),lb=Ma.next().value;Ma=Ma.next().value;this.stopControls=na.stops.map(function(Nb,ac){return new yd.GradientStopControl({stopVisualizer:Fa,index:ac})});this.submorphs=[lb,Ma].concat($jscomp.arrayFromIterable(this.stopControls));yd.arr.invoke(this.stopControls,"update",na)}yd.arr.invoke(this.stopControls,"update",na)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopVisualizer"}},{key:"properties",get:function(){return{fill:{defaultValue:yd.Color.gray},
gradientEditor:{},draggable:{defaultValue:!1},targetProperty:{derived:!0,get:function(){return this.gradientEditor&&this.gradientEditor.gradientValue},set:function(na){this.gradientEditor.gradientValue=na}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop visualizer"}}},submorphs:{after:["gradientEditor"],initialize:function(){this.submorphs=[{type:"label",name:"instruction",value:"Select Gradient Type",visible:!(this.targetProperty&&this.targetProperty.isGradient)},
{name:"stopControlPreview",visible:!1,master:{auto:"styleguide://SystemWidgets/stop control preview"},submorphs:[yd.Icon.makeLabel("plus-circle",{name:"addStopLabel"})]}]}}}}}],X,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:11489,end:14883})})(yd.Morph);(function(ma){var X=
lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("GradientStopControl")&&"function"===typeof X.GradientStopControl?X.GradientStopControl:X.GradientStopControl=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,[{key:"update",value:function(na){this.position=this.stopVisualizer.extent.subPt(yd.pt(10,0)).scaleByPt(yd.pt(na.stops[this.index].offset,0)).addPt(yd.pt(5,
0));this.head.update(na)}},{key:"onDragStart",value:function(na){this.nativeCursor="-webkit-grabbing";this.stopVisualizer.nativeCursor="-webkit-grabbing";this.offsetView=(new yd.Tooltip).openInWorld(na.hand.position.addPt(yd.pt(10,10)))}},{key:"onDrag",value:function(na){var Fa=Math.max(0,Math.min(1,(this.position.x-5+na.state.dragDelta.x)/(this.stopVisualizer.width-10)));this.stopVisualizer.updateStop(this.index,{offset:Fa});this.offsetView.description=(100*Fa).toFixed(2)+"%";this.offsetView.position=
na.hand.position.addPt(yd.pt(10,10))}},{key:"onDragEnd",value:function(){this.nativeCursor="-webkit-grab";this.stopVisualizer.nativeCursor="auto";this.offsetView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientStopControl"}},{key:"properties",get:function(){return{index:{},head:{},stopVisualizer:{},styleClasses:{defaultValue:["stopControlLine"]},nativeCursor:{defaultValue:"-webkit-grab"},draggable:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient stop control"}}},
submorphs:{after:["index","stopVisualizer"],initialize:function(){this.head=new yd.StopControlHead({name:"stop control head",stopVisualizer:this.stopVisualizer,index:this.index});this.head.stopControl=this;this.addMorph(this.head)}}}}}],X,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},
{start:14885,end:16661})})(yd.Morph);(function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("FocusHandle")&&"function"===typeof X.FocusHandle?X.FocusHandle:X.FocusHandle=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().center()}},{key:"onDragStart",value:function(na){this.tfm=
this.gradientHandle.target.getGlobalTransform().inverse();this.focusView=(new yd.Tooltip).openInWorld(na.hand.position.addPt(yd.pt(10,10)))}},{key:"onDrag",value:function(na){var Fa=na.state.dragDelta,Ma=this.gradientHandle,lb=Ma.target.fill;lb.focus=lb.focus.addXY(Fa.x/Ma.target.width,Fa.y/Ma.target.height);this.focusView.description="x: "+(100*lb.focus.x).toFixed()+"%, y: "+(100*lb.focus.y).toFixed()+"%";this.focusView.position=na.hand.position.addPt(yd.pt(10,10));Ma.target.makeDirty();Ma.relayout()}},
{key:"onDragEnd",value:function(na){this.focusView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"FocusHandle"}},{key:"properties",get:function(){return{gradientHandle:{},styleClasses:{defaultValue:["focusHandle"]},extent:{defaultValue:yd.pt(20,20)},fill:{defaultValue:yd.Color.orange}}}}],X,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:16663,end:17666})})(yd.Ellipse);(function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("BoundsHandle")&&"function"===typeof X.BoundsHandle?X.BoundsHandle:X.BoundsHandle=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,[{key:"relayout",value:function(){this.center=this.gradientHandle.innerBounds().partNamed(this.side);
this.scale=1/this.gradientHandle.target.getGlobalTransform().getScale()}},{key:"onDragStart",value:function(na){this.boundsView=(new yd.Tooltip).openInWorld(na.hand.position.addPt(yd.pt(10,10)))}},{key:"onDrag",value:function(na){var Fa=this.gradientHandle,Ma=Fa.target.fill,lb=Ma.bounds.partNamed(this.side).addPt(na.state.dragDelta.scaleBy(2));Ma.bounds=Ma.bounds.withPartNamed(this.side,lb);this.boundsView.description="w: "+Ma.bounds.width.toFixed()+"px h: "+Ma.bounds.height.toFixed()+"px";this.boundsView.position=
na.hand.position.addPt(yd.pt(10,10));Fa.target.makeDirty();Fa.relayout()}},{key:"onDragEnd",value:function(na){this.boundsView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"BoundsHandle"}},{key:"properties",get:function(){return{side:{},gradientHandle:{},styleClasses:{after:["side"],initialize:function(){this.styleClasses=["boundsHandle",this.side]}}}}}],X,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},
subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:17668,end:18747})})(yd.Ellipse);var Xa=function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("GradientFocusHandle")&&"function"===typeof X.GradientFocusHandle?X.GradientFocusHandle:X.GradientFocusHandle=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,
arguments)};return Yc(Ra,ma,[{key:"relayout",value:function(){var na=this.target.fill,Fa=na.focus;this.extent=na.bounds.extent();this.submorphs.forEach(function(Ma){return Ma.relayout()});this.rotation=this.target.rotation;this.scale=this.target.scale;this.borderWidth=2/this.scale;this.owner&&(this.center=this.owner.localizePointFrom(this.target.extent.scaleByPt(Fa),this.target))}},{key:"initBoundsHandles",value:function(){var na=this;this.bounds().sides.forEach(function(Fa){na.addMorph(new yd.BoundsHandle({gradientHandle:na,
side:Fa,name:"bounds handle "+Fa.split("C")[0]}))})}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientFocusHandle"}},{key:"properties",get:function(){return{target:{},isHaloItem:{defaultValue:!0},hasFixedPosition:{defaultValue:!0},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient focus handle"}}},submorphs:{initialize:function(){this.submorps=[];this.initBoundsHandles();this.addMorph(new yd.FocusHandle({gradientHandle:this}));this.relayout()}}}}}],
X,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:18756,end:20039})}(yd.Ellipse);yd.GradientFocusHandle=Xa;yd.GradientFocusHandle=Xa;yd.GradientFocusHandle=Xa;(function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("RotationPoint")&&
"function"===typeof X.RotationPoint?X.RotationPoint:X.RotationPoint=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,[{key:"relayout",value:function(){this.center=yd.Point.polar(this.gradientHandle.width/2,this.gradientHandle.target.fill.vectorAsAngle())}},{key:"onDragStart",value:function(na){this.angleView=(new yd.Tooltip).openInWorld(na.hand.position.addPt(yd.pt(10,10)));this.angleView.rotation=0}},
{key:"onDrag",value:function(na){var Fa=this.gradientHandle;Fa.target.fill.vector=na.positionIn(Fa).theta();Fa.target.makeDirty();Fa.relayout();this.angleView.description=(yd.num.toDegrees(Fa.target.fill.vectorAsAngle())+180).toFixed()+"\u00b0";this.angleView.position=na.hand.position.addPt(yd.pt(10,10))}},{key:"onDragEnd",value:function(na){this.angleView.remove()}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"RotationPoint"}},{key:"properties",get:function(){return{gradientHandle:{}}}}],
X,{pathInPackage:function(){return"styling/gradient-editor.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20041,end:20838})})(yd.Ellipse);(function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/styling/gradient-editor.js"),Ra=X.hasOwnProperty("GradientDirectionHandle")&&"function"===typeof X.GradientDirectionHandle?X.GradientDirectionHandle:
X.GradientDirectionHandle=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,[{key:"isHaloItem",get:function(){return!0}},{key:"relayout",value:function(){this.owner&&(this.position=this.owner.localizePointFrom(this.target.extent.scaleBy(.5),this.target));this.rotationPoint.relayout()}},{key:"initRotationPoint",value:function(){this.rotationPoint=this.addMorph(new yd.RotationPoint({gradientHandle:this,
name:"rotation point"}))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"GradientDirectionHandle"}},{key:"properties",get:function(){return{target:{},origin:{defaultValue:yd.pt(25,25)},extent:{defaultValue:yd.pt(50,50)},hasFixedPosition:{defaultValue:!0},submorphs:{initialize:function(){this.initRotationPoint();this.relayout()}},master:{initialize:function(){this.master={auto:"styleguide://SystemWidgets/gradient direction handle"}}}}}}],X,{pathInPackage:function(){return"styling/gradient-editor.js"},
unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:20840,end:21812})})(yd.Ellipse);yd.colorWidgets.GradientEditor=yd.GradientEditor;var hb=lively.FreezerRuntime.recorderFor("lively.components/canvas.js");hb.pt=qd;hb.Point=Ad;hb.rect=Dc;hb.Color=jc;hb.Morph=mb;hb.Image=Lb;hb.connect=Eb;Xa=Pa("C",function(ma){var X=lively.FreezerRuntime.recorderFor("lively.components/canvas.js"),
Ra=X.hasOwnProperty("Canvas")&&"function"===typeof X.Canvas?X.Canvas:X.Canvas=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,[{key:"context",get:function(){if(this._canvas)return this._canvas.getContext(this.contextType);this.world()&&this.env.renderer.getNodeForMorph(this)||console.warn("Context not yet rendered. Please ensure that the Canvas Morph has been rendered first before accessing the context. This can be achieved by waiting for the whenRendered() promise before you proceed accessing the context property.");
return null}},{key:"_canvas",set:function(na){var Fa=this.__canvas__;this.__canvas__=na;this.restoreContent(Fa,na)}},{key:"_canvas",get:function(){return this.__canvas__}},{key:Symbol.for("lively-instance-initialize"),value:function(na){na=void 0===na?{}:na;Yc._get(Object.getPrototypeOf(Ra.prototype),Symbol.for("lively-instance-initialize"),this).call(this,na);hb.connect(this,"extent",this,"onExtentChanged")}},{key:"afterRender",value:function(na,Fa){Fa?this._canvas=na:"function"===typeof this.__canvas_init__&&
(this.__canvas_init__(),delete this.__canvas_init__)}},{key:"restoreContent",value:function(na,Fa){var Ma=this.contextType,lb=this.preserveContents;"function"===typeof this.__canvas_init__?(this.__canvas_init__(),delete this.__canvas_init__):lb&&"2d"==Ma&&na&&na!==Fa&&this.context.drawImage(na,0,0)}},{key:"onExtentChanged",value:function(){var na=this;if(this._canvas&&this.preserveContents&&this.context.getImageData){var Fa=this._canvas,Ma=Fa.width;Fa=Fa.height;if(Ma&&Fa){var lb=this.context.getImageData(0,
0,Ma,Fa);this.__canvas_init__=function(){na.context.putImageData(lb,0,0)}}}}},{key:"clear",value:function(na){var Fa=this.context;if(Fa){var Ma=this._canvas,lb=Ma.width;Ma=Ma.height;Fa.save();Fa.setTransform(1,0,0,1,0,0);na?(na.toCSSString&&(na=na.toCSSString()),Fa.fillStyle=na,Fa.fillRect(0,0,lb,Ma)):Fa.clearRect(0,0,lb,Ma);Fa.restore()}}},{key:"render",value:function(na){return na.renderCanvas(this)}},{key:"withContextDo",value:function(na){var Fa=this;this._canvas?na(this.context):this.__canvas_init__=
function(){return na(Fa.context)}}},{key:"toDataURI",value:function(){return this._canvas&&this._canvas.toDataURL()}},{key:"fromDataURI",value:function(na){var Fa=this,Ma=new hb.Image;Ma.onload=function(){Fa._canvas.width=Ma.width;Fa._canvas.height=Ma.height;Fa.context.drawImage(Ma,0,0)};Ma.src=na}},{key:"imageData",value:function(na){na||(na=this.canvasBounds);return this.context.getImageData(na.x,na.y,na.width,na.height)}},{key:"nonTransparentArea",value:function(){for(var na=this.imageData(),Fa=
na.data,Ma=na.width,lb=na.height,Nb=Ma,ac=lb,Hc=0;Hc<lb;Hc++)for(var Lc=0;Lc<Nb;Lc++)0<Fa[4*(Hc*Ma+Lc)+3]&&(Nb=Lc,ac>Hc&&(ac=Hc));if(Nb===Ma)return hb.rect(0,0,0,0);Hc=Nb;Lc=ac;for(--lb;lb>ac;lb--)for(var kd=Ma-1;kd>Hc;kd--)0<Fa[4*(lb*Ma+kd)+3]&&(Hc=kd,Lc<lb&&(Lc=lb));return{imageData:na,bounds:hb.rect(Nb,ac,Hc-Nb+1,Lc-ac+1)}}},{key:"trimNonTransparent",value:function(){var na=this.nonTransparentArea(),Fa=na.imageData;na=na.bounds;if(!na.topLeft().equals(hb.pt(0,0))){var Ma=na.x,lb=na.y;this.context.putImageData(Fa,
-Ma,-lb,Ma,lb,na.width,na.height);this.position=this.position.addPt(na.topLeft())}na.extent().equals(this.extent)||(this.extent=na.extent())}},{key:"finishDraw",value:function(na){na=void 0===na?{}:na;var Fa=this.context,Ma=na,lb=void 0===Ma.color?"rgba(0,0,0,0.6)":Ma.color,Nb=void 0===Ma.width?4:Ma.width;Ma=void 0===Ma.fill?!1:Ma.fill;na=na.fillColor||lb;lb.toCSSString&&(lb=lb.toCSSString());na.toCSSString&&(na=na.toCSSString());Fa.strokeStyle=lb;Fa.lineWidth=Nb;Fa.stroke();Fa.closePath();Ma&&(Fa.fillStyle=
na,Fa.fill())}},{key:"line",value:function(na,Fa,Ma){Ma=void 0===Ma?{}:Ma;var lb=this.context;lb.beginPath();lb.moveTo(na.x,na.y);lb.lineTo(Fa.x,Fa.y);lb.lineCap="round";this.finishDraw(Ma)}},{key:"arc",value:function(na,Fa,Ma,lb,Nb,ac){Nb=void 0===Nb?!1:Nb;ac=void 0===ac?{}:ac;var Hc=this.context;Hc.beginPath();Hc.arc(na.x,na.y,Fa,Ma,lb,Nb);this.finishDraw(ac)}},{key:"polygon",value:function(na,Fa){Fa=void 0===Fa?{}:Fa;var Ma=this.context;Ma.beginPath();Ma.moveTo(na[0].x,na[0].y);for(var lb=0;lb<
na.length;lb++)Ma.lineTo(na[lb].x,na[lb].y);Ma.lineTo(na[0].x,na[0].y);this.finishDraw(Fa)}},{key:"text",value:function(na,Fa,Ma){Ma=void 0===Ma?{}:Ma;var lb=this.context,Nb=Ma,ac=void 0===Nb.color?"black":Nb.color,Hc=void 0===Nb.font?"14px Arial":Nb.font,Lc=void 0===Nb.align?"start":Nb.align;Nb=void 0===Nb.baseline?"bottom":Nb.baseline;lb.save();lb.font=Hc;lb.fillStyle=ac;lb.textAlign=Lc;lb.textBaseline=Nb;Ma.angle&&!isNaN(Ma.angle)&&(lb.translate(Fa.x,Fa.y),lb.rotate(Ma.angle),lb.translate(-Fa.x,
-Fa.y));lb.fillText(na,Fa.x,Fa.y);lb.restore()}},{key:"line",value:function(na,Fa,Ma){Ma=void 0===Ma?{}:Ma;var lb=this.context,Nb=Ma.color||"rgba(0,0,0,0.6)";Ma=Ma.width||4;Nb.toCSSString&&(Nb=Nb.toCSSString());lb.strokeStyle=Nb;lb.beginPath();lb.lineWidth=Ma;lb.moveTo(na.x,na.y);lb.lineTo(Fa.x,Fa.y);lb.stroke();lb.closePath()}},{key:"spiral",value:function(){this.clear(hb.Color.white);for(var na=this.innerBounds().center(),Fa=0,Ma=1,lb=0;150>lb;lb++){var Nb=na.addPt(hb.Point.polar(Ma,Fa));this.line(na,
Nb,{color:hb.Color.random()});na=Nb;Fa+=Math.PI/10;Ma+=.3}}},{key:"rect",value:function(na,Fa,Ma){Ma=void 0===Ma?{}:Ma;var lb=this.context;lb.beginPath();lb.rect(na.x,na.y,Fa.x,Fa.y);this.finishDraw(Ma)}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Canvas"}},{key:"properties",get:function(){return{extent:{defaultValue:hb.pt(200,200)},fill:{defaultValue:hb.Color.transparent},contextType:{defaultValue:"2d"},preserveContents:{defaultValue:!0},canvasExtent:{get:function(){return this._canvas&&
hb.pt(this._canvas.width,this._canvas.height)}},canvasBounds:{readOnly:!0,get:function(){return this._canvas&&this.canvasExtent.extentAsRectangle()}},_serializedContents:{get:function(){return this.preserveContents&&this.toDataURI()},set:function(na){var Fa=this;this.withContextDo(function(){return Fa.fromDataURI(na)})}}}}}],X,{pathInPackage:function(){return"canvas.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
package:function(){return{name:"lively.components",version:"0.1.0"}}},{start:233,end:8699})}(hb.Morph));hb.Canvas=Xa;hb.Canvas=Xa;hb.Canvas=Xa;var ab=lively.FreezerRuntime.recorderFor("lively.ide/world.js");ab.resource=Zb;ab.Rectangle=Vb;ab.Color=jc;ab.pt=qd;ab.arr=Wc;ab.fun=rd;ab.obj=zd;ab.promise=fc;ab.PropertyPath=bd;ab.once=xd;ab.GridLayout=ec;ab.MorphicDB=xc;ab.easings=te;ab.HTMLMorph=bc;ab.Text=jd;ab.Label=Qa;ab.Path=Da;ab.Polygon=ja;ab.morph=Je;ab.Ellipse=Bc;ab.touchInputDevice=Ba;ab.Icon=
Ua;ab.Morph=mb;ab.VerticalLayout=vc;ab.HorizontalLayout=Ja;ab.ConstraintLayout=Fb;ab.Tooltip=Ac;ab.Image=Lb;ab.inspect=me;ab.config=Zd;ab.World=wa;ab.loadMorphFromSnapshot=Ka;ab.loadObjectFromPartsbinFolder=$c;ab.loadPart=Bd;ab.uploadFile=ii;ab.InformPrompt=Rb;ab.ConfirmPrompt=eb;ab.MultipleChoicePrompt=Sc;ab.TextPrompt=Ob;ab.EditPrompt=pd;ab.PasswordPrompt=Uc;ab.ListPrompt=Kc;ab.EditListPrompt=Hb;ab.LoadingIndicator=Jd;ab.Halo=Fe;ab.MorphHighlighter=z;ab.StatusMessage=Ce;ab.StatusMessageForMorph=
Ke;ab.ConstraintLayoutHalo=eg;ab.GridLayoutHalo=sf;ab.FlexLayoutHalo=Nd;ab.Window=$d;ab.List=Tb;ab.FilterableList=Gb;ab.Menu=La;ab.worldCommands=df;ab.GradientEditor=Pe;ab.completions=da;ab.runEval=Ha;ab.getClassName=bb;ab.serialize=Qb;ab.Canvas=Xa;ab.CommentBrowser=He;ab.prefetchCoreStyleguides=uc;df=function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Ra=X.hasOwnProperty("LivelyWorld")&&"function"===typeof X.LivelyWorld?X.LivelyWorld:X.LivelyWorld=function(na){na&&na[Symbol.for("lively-instance-restorer")]||
this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,[{key:"visibleBoundsExcludingTopBar",value:function(){var na=$world.getSubmorphNamed("lively top bar"),Fa=this.visibleBounds();return na?new ab.Rectangle(Fa.x,Fa.y+na.height,Fa.width,Fa.height-na.height):Fa}},{key:"getListedComponents",value:function(){var na=this,Fa=this.withAllSubmorphsSelect(function(Ma){return Ma.isComponent&&!na.hiddenComponents.includes(Ma.name)});return ab.arr.uniq([].concat($jscomp.arrayFromIterable(Fa),
$jscomp.arrayFromIterable(this.localComponents)))}},{key:"activeWindow",value:function(){return this.getWindows().reverse().find(function(na){return na.isActive()})}},{key:"getWindows",value:function(){return this.submorphs.filter(function(na){return na.isWindow})}},{key:"activePrompt",value:function(){return this.getPrompts().reverse().find(function(na){return na.isActive()})}},{key:"getPrompts",value:function(){return this.submorphs.filter(function(na){return na.isPrompt})}},{key:"openInWindow",
value:function(na,Fa){Fa=void 0===Fa?{title:na.name,name:"window for "+na.name}:Fa;na=(new ab.Window(Object.assign({},Fa,{extent:na.extent.addXY(0,25),targetMorph:na}))).openInWorld();na.ensureNotOverTheTop();return na}},{key:"withTopBarDo",value:function(na){var Fa=this.get("lively top bar");Fa&&na(Fa)}},{key:"onTopBarLoaded",value:function(){}},{key:"onKeyUp",value:function(na){this.withTopBarDo(function(Fa){return Fa.onKeyUp(na)})}},{key:"onKeyDown",value:function(na){Yc._get(Object.getPrototypeOf(Ra.prototype),
"onKeyDown",this).call(this,na);na.targetMorph==this&&this.withTopBarDo(function(Fa){return Fa.onKeyDown(na)})}},{key:"onMouseDown",value:function(na){Yc._get(Object.getPrototypeOf(Ra.prototype),"onMouseDown",this).call(this,na);var Fa=na.state.clickedOnMorph,Ma=this.activeWindow();Ma&&Fa==this&&Ma.deactivate();this.handleHaloCycle(na);na.state.menu&&na.state.menu.remove();this._tooltipViewer.mouseDown(na)}},{key:"onMouseUp",value:function(na){na.isCommandKey()&&na.stop();if(na.isAltDown()&&ab.config.altClickDefinesThat){var Fa=
this.morphsContainingPoint(na.position)[0];setTimeout(function(){return System.global.that=Fa},100);Fa.show();na.stop();console.log('Set global "that" to '+Fa)}}},{key:"onDrag",value:function(na){}},{key:"whenReady",value:function(){var na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){return 1==Fa.nextAddress?Fa.yield(na._styleLoading,2):Fa.return(!0)})}},{key:"onLoad",value:function(){var na=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Fa){if(1==Fa.nextAddress){na.opacity=
0;na.onWindowResize();lively.modules&&lively.modules.removeHook("fetch",window.__logFetch);na.animate({opacity:1,blur:3,duration:1E3,easing:ab.easings.inOutExpo}).then(function(){var Ma,lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){if(1==Nb.nextAddress){if(!(Ma=window.worldLoadingIndicator))return Nb.jumpTo(0);lb=Ma.world();if(lb.env==na.env)return Nb.jumpTo(0);Ma.withAllSubmorphsDo(function(ac){return ac._env=na.env});na.addMorph(Ma);return Nb.yield(lb.whenRendered(),4)}lb.env.renderer.stopRenderWorldLoop();
Nb.jumpToEnd()})});if(!na.showsUserFlap&&!ab.resource(document.location.href).query().showsUserFlap)return Fa.jumpTo(2);na._styleLoading=ab.prefetchCoreStyleguides(window.worldLoadingIndicator);return Fa.yield(na._styleLoading,2)}na.animate({blur:0,duration:1E3,easing:ab.easings.inOutExpo});document.body.style.overflowX="visible";document.body.style.overflowY="visible";Fa.jumpToEnd()})}},{key:"isNotUnique",value:function(na){var Fa,Ma,lb,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){switch(ac.nextAddress){case 1:return ac.yield(ab.MorphicDB.default.exists("world",
na),2);case 2:if(Fa=ac.yieldResult.exists){ac.jumpTo(3);break}Ma=na+".json";lb=ab;Nb=lb.resource;return ac.yield(System.decanonicalize("lively.morphic/styleguides"),5);case 5:return ac.yield(Nb.call(lb,ac.yieldResult).join(Ma).exists(),4);case 4:Fa=ac.yieldResult;case 3:return ac.return(Fa)}})}},{key:"askForName",value:function(){var na=this,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ma){switch(Ma.nextAddress){case 1:return Ma.yield(na.whenRendered(),3);case 3:if(Fa){Ma.jumpTo(4);
break}return Ma.yield(na.prompt(["New Project\n",{},"Enter a name for this project:",{fontWeight:"normal"}],{width:400,hasFixedPosition:!0,forceConfirm:!0}),5);case 5:return Fa=Ma.yieldResult,Ma.yield(na.isNotUnique(Fa),6);case 6:if(!Ma.yieldResult){Ma.jumpTo(3);break}return Ma.yield(na.confirm("This Project name is already taken. Please pick a different one!",{hasFixedPosition:!0,width:400}),8);case 8:Fa=!1;Ma.jumpTo(3);break;case 4:return Ma.return(Fa)}})}},{key:"onWindowResize",value:function(na){Yc._get(Object.getPrototypeOf(Ra.prototype),
"onWindowResize",this).call(this,na);"elastic"===this.resizePolicy&&this.execCommand("resize to fit window")}},{key:"nativeDrop_ensureUploadIndicator",value:function(){var na=this,Fa;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ma){if(1==Ma.nextAddress)return na._cachedDragIndicator||(na._cachedDragIndicator=ab.loadObjectFromPartsbinFolder("upload-indicator")),Ma.yield(na._cachedDragIndicator,2);Fa=Ma.yieldResult;Fa.world()||Fa.openInWorld();ab.fun.debounceNamed("remove-upload-indicator",
1E3,function(){na.nativeDrop_removeUploadIndicator()})();Ma.jumpToEnd()})}},{key:"nativeDrop_removeUploadIndicator",value:function(){this._cachedDragIndicator&&this._cachedDragIndicator.then(function(na){return na.remove()})}},{key:"onNativeDragover",value:function(na){na.targetMorph===this&&this.nativeDrop_ensureUploadIndicator()}},{key:"onNativeDrop",value:function(na){var Fa=this,Ma,lb,Nb,ac,Hc,Lc,kd,Sd,ke,Gd,ye,xe,le,De,Gf,cg,ng,Wf,wf,th,fi,Og,xf,dg,qg,qh,Me,gi,sc,nd,ee,Hd,rf,$f,fg,sl,bl,Oj,Zj,
Ck,qm,Sl,rm,Rl,hi,cl;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Qf){switch(Qf.nextAddress){case 1:Fa.nativeDrop_removeUploadIndicator();if(na.targetMorph!=Fa)return Qf.return();Ma=na;lb=Ma.domEvt;Nb=lb.dataTransfer;ac=Nb.files;Hc=document.location.origin;if(!ac.length){Qf.jumpTo(2);break}Lc=Fa.getCurrentUser();kd=Lc.isGuestUser?"uploads/":"users/"+$world.getCurrentUser().name+"/uploads";if(!na.isAltDown()){Qf.jumpTo(3);break}return Qf.yield(Fa.prompt("Choose upload location",{history:"lively.morphic-html-drop-file-upload-location",
input:kd}),4);case 4:if(kd=Qf.yieldResult,!kd)return Qf.return(Fa.setStatusMessage("Canceled upload"));case 3:return Qf.yield(Fa.confirm("Upload "+ac.length+" file"+(1<ac.length?"s":"")+"?"),5);case 5:Sd=Qf.yieldResult;if(!Sd)return Qf.return();ke=new ab.FormData;for(Gd=0;Gd<ac.length;Gd++)ke.append("file",ac[Gd],ac[Gd].name);le=ab.LoadingIndicator.open("Uploading File");Qf.setCatchFinallyBlocks(6);De={};Gf=function(Ui){Ui=Ui.loaded/Ui.total;le.progress=Ui;le.status="Uploaded "+(100*Ui).toFixed()+
"%"};Lc.isGuestUser||(De.Authorization="Bearer "+Lc.token);ye=ab.resource(System.baseURL,{headers:De,onProgress:Gf,onLoad:function(Ui){return xe=Ui}});ye=ye.join("/upload?uploadPath="+encodeURIComponent(kd));return Qf.yield(ye.write(ke),8);case 8:Qf.leaveTryBlock(7);break;case 6:return cg=Qf.enterCatchBlock(),Qf.return(Fa.showError("Upload failed: "+cg.message+"\n"));case 7:le.remove();Qf.setCatchFinallyBlocks(9);Fa.setStatusMessage("Uploaded "+xe.uploadedFiles.length+" file");ng=xe.uploadedFiles.map(function(Ui){var Dk=
ab.resource(Hc).join(Ui.path);return Object.assign({},Ui,{url:Dk.url,name:Dk.name()})});Wf=[];wf=[];th=[];fi=$jscomp.makeIterator(ng);for(Og=fi.next();!Og.done;Og=fi.next())xf=Og.value,xf.type.startsWith("image/")?Wf.push(xf):xf.type.startsWith("video")?wf.push(xf):th.push(xf);if(!wf.length){Qf.jumpTo(11);break}dg=$jscomp.makeIterator(wf);qg=dg.next();case 12:if(qg.done){Qf.jumpTo(11);break}qh=qg.value;Me=Object;gi=Me.assign;return Qf.yield(ab.loadObjectFromPartsbinFolder("video morph"),15);case 15:gi.call(Me,
Qf.yieldResult,{videoURL:qh.url,name:qh.name}).openInWorld();qg=dg.next();Qf.jumpTo(12);break;case 11:Wf.length&&Wf.forEach(function(Ui){var Dk=new ab.Image({imageUrl:Ui.url,autoResize:!0,name:Ui.name});Dk.whenLoaded().then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Tl){if(1==Tl.nextAddress)return Dk.extent=Dk.naturalExtent.scaleBy(.8*Fa.visibleBounds().height/Dk.height),Dk.openInWorld(),Tl.yield(Dk.whenRendered(),2);Dk.center=Fa.visibleBounds().center();Tl.jumpToEnd()})})});
if(!th.length){Qf.jumpTo(16);break}sc=$jscomp.makeIterator(th);nd=sc.next();case 17:if(nd.done){Qf.jumpTo(16);break}ee=nd.value;return Qf.yield(Fa.confirm("open file "+ee.name+" ("+ee.type+")?"),20);case 20:(Hd=Qf.yieldResult)&&Fa.execCommand("open file",{url:ee.url});nd=sc.next();Qf.jumpTo(17);break;case 16:Qf.leaveTryBlock(10);break;case 9:rf=Qf.enterCatchBlock(),Fa.showError(rf);case 10:return Qf.return();case 2:$f=lb.dataTransfer.types;if(!$f.includes("text/html")){Qf.jumpTo(21);break}fg=lb.dataTransfer.getData("text/html");
sl=(new ab.DOMParser).parseFromString(fg,"text/html");bl=sl.querySelectorAll("img");if(1===bl.length&&bl[0].src&&$f.includes("text/uri-list")){Oj=bl[0].src;Zj=new ab.Image({imageUrl:Oj,autoResize:!0,name:ab.arr.last(Oj.split("/"))});Zj.whenLoaded().then(function(){return Zj.openInWorld()});Qf.jumpTo(22);break}Ck=Object;qm=Ck.assign;return Qf.yield(ab.loadObjectFromPartsbinFolder("html-morph"),23);case 23:qm.call(Ck,Qf.yieldResult,{html:fg}).openInWorld();case 22:return Qf.return();case 21:Sl=0;case 24:if(!(Sl<
lb.dataTransfer.items.length)){Qf.jumpTo(0);break}rm=lb.dataTransfer.items[Sl];if("file"!==rm.kind){"string"===rm.kind&&rm.getAsString(function(Ui){return ab.inspect(Ui)});Qf.jumpTo(25);break}Rl=rm.getAsFile();return Qf.yield(Fa.confirm("Upload "+Rl.name+"?"),28);case 28:hi=Qf.yieldResult;if(!hi){Qf.jumpTo(25);break}return Qf.yield(ab.uploadFile(Rl,Rl.type),30);case 30:(cl=Qf.yieldResult)&&cl.openInWorld(),cl.center=Fa.visibleBounds().center();case 25:Sl++,Qf.jumpTo(24)}})}},{key:"menuItems",value:function(){var na=
this;return[{title:"World menu"},{command:"undo",target:this},{command:"redo",target:this},{isDivider:!0},["Debugging",[{command:"delete change history",target:this},{command:"fix font metric",target:this},{command:"inspect server",target:this}]],["Tools",[{command:"open javascript workspace",target:this},{command:"open browser",target:this},{command:"choose and browse module",target:this},{command:"open code search",target:this},{command:"open file browser",target:this},{command:"open shell workspace",
target:this,tooltip:"Opens a workspace like interface\nthat allows you to trigger shell comands\nvia select + eval by pressing either "+(new ab.Text).keysForCommand("doit")+" or "+(new ab.Text).keysForCommand("printit")},{command:"open shell terminal",target:this,tooltip:"Opens a classic remote shell interface,\nthat allows you to send commands to a\nbash session running on the server.\nAlso comes with advanced git support."},{command:"open workspace",args:{askForMode:!0},target:this}]],{isDivider:!0},
{command:"run command",target:this},{command:"select morph",target:this},{command:"window switcher",target:this},["Exported Components",[["Toggle Select All",function(){0==na.getListedComponents().length?na.hiddenComponents=[]:na.hiddenComponents=na.withAllSubmorphsSelect(function(Fa){return Fa.isComponent}).map(function(Fa){return Fa.name})}]].concat($jscomp.arrayFromIterable(this.withAllSubmorphsSelect(function(Fa){return Fa.isComponent}).map(function(Fa){var Ma=na.hiddenComponents.includes(Fa.name);
return[[].concat($jscomp.arrayFromIterable(ab.Icon.textAttribute(Ma?"square":"check-square")),["  "+Fa.name,{}]),function(){na.hiddenComponents=Ma?ab.arr.without(na.hiddenComponents,Fa.name):[Fa.name].concat($jscomp.arrayFromIterable(na.hiddenComponents))}]})))],["Resize","static"===this.resizePolicy?[{command:"resize to fit window",target:this},{command:"resize manually",target:this},["switch to automatic resizing of world",function(){return na.resizePolicy="elastic"}]]:[["switch to manual resizing of world",
function(){return na.resizePolicy="static"}]]],["Troubleshooting",[{command:"report a bug",target:this},{command:"clear storage and reload",target:this}]],{isDivider:!0},["Windows",[{command:"toggle minimize all windows",target:this},{command:"close all windows",target:this}]],{isDivider:!0},{command:"save world",target:this},{command:"load world",target:this}]}},{key:"openWorldMenu",value:function(na,Fa){var Ma=this.env.eventDispatcher.eventState;Ma.menu&&Ma.menu.remove();return Ma.menu=Fa&&Fa.length?
ab.Menu.openAtHand(Fa,{hand:na&&na.hand||this.firstHand}):null}},{key:"onPaste",value:function(na){var Fa=this,Ma,lb,Nb,ac,Hc,Lc,kd,Sd,ke,Gd,ye,xe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(le){switch(le.nextAddress){case 1:le.setCatchFinallyBlocks(2,3);lb=na.domEvt.clipboardData;if(!lb.types.includes("application/morphic")){le.jumpTo(3);break}na.stop();Nb=JSON.parse(lb.getData("application/morphic"));ac=[];Array.isArray(Nb)||(Nb=[Nb]);Ma=ab.LoadingIndicator.open("pasting morphs...");
Hc=$jscomp.makeIterator(Nb);Lc=Hc.next();case 6:if(Lc.done){le.jumpTo(8);break}kd=Lc.value;return le.yield(ab.loadMorphFromSnapshot(kd),9);case 9:Sd=le.yieldResult;Sd.openInWorld(na.hand.position);kd.copyMeta&&kd.copyMeta.offset&&(ke=kd.copyMeta.offset,Gd=ke.x,ye=ke.y,Sd.moveBy(ab.pt(Gd,ye)));ac.push(Sd);Lc=Hc.next();le.jumpTo(6);break;case 8:Fa.showHaloFor(ac);case 3:le.enterFinallyBlock();Ma&&Ma.remove();le.leaveFinallyBlock(0);break;case 2:xe=le.enterCatchBlock(),Fa.showError(xe),le.jumpTo(3)}})}},
{key:"commands",get:function(){return ab.worldCommands.concat(Yc._get(Object.getPrototypeOf(Ra.prototype),"commands",this)).concat([{name:"open in prototype box",exec:function(na,Fa){var Ma;return $jscomp.asyncExecutePromiseGeneratorProgram(function(lb){if(1==lb.nextAddress)return lb.yield(ab.loadPart("prototype box"),2);Ma=lb.yieldResult;Ma.wrapProto(Fa.target);lb.jumpToEnd()})}}])}},{key:"keybindings",get:function(){return Yc._get(Object.getPrototypeOf(Ra.prototype),"keybindings",this).concat(ab.config.globalKeyBindings)}},
{key:"keybindings",set:function(na){Yc._set(Object.getPrototypeOf(Ra.prototype),"keybindings",na,this)}},{key:"halos",value:function(){return this.submorphs.filter(function(na){return na.isHalo})}},{key:"haloForPointerId",value:function(na){return this.submorphs.find(function(Fa){return Fa.isHalo&&Fa.state&&Fa.state.pointerId===na})}},{key:"showHaloFor",value:function(na,Fa,Ma){Fa=void 0===Fa?this.firstHand&&this.firstHand.pointerId:Fa;Ma=void 0===Ma?!0:Ma;if(ab.Halo)return na="function"===typeof na.createHalo?
na.createHalo(ab.Halo,Fa):new ab.Halo({pointerId:Fa,target:na}),this.addMorph(na),Ma&&na.focus(),na.alignWithTarget(),na}},{key:"showHaloForSelection",value:function(na,Fa){return 0<na.length&&this.showHaloFor(na,Fa)}},{key:"layoutHaloForPointerId",value:function(na){na=void 0===na?this.firstHand&&this.firstHand.pointerId:na;return this.submorphs.find(function(Fa){return Fa.isLayoutHalo&&Fa.state&&Fa.state.pointerId===na})}},{key:"showLayoutHaloFor",value:function(na,Fa){Fa=void 0===Fa?this.firstHand&&
this.firstHand.pointerId:Fa;var Ma=na===this?null:na.owner===this?na:na.ownerChain().slice(-2)[0];Ma=Ma?this.submorphs.indexOf(Ma)+1:this.submorphs.length;switch(na.layout.constructor){case ab.ConstraintLayout:var lb=new ab.ConstraintLayoutHalo({container:na,pointerId:Fa});break;case ab.HorizontalLayout:case ab.VerticalLayout:lb=new ab.FlexLayoutHalo({container:na,pointerId:Fa});break;case ab.GridLayout:lb=new ab.GridLayoutHalo({container:this.container,pointerId:Fa})}return lb&&this.addMorphAt(lb,
Ma)}},{key:"highlightMorph",value:function(na,Fa,Ma,lb){lb=void 0===lb?[]:lb;return ab.MorphHighlighter.for(na,Fa,void 0===Ma?!1:Ma,lb)}},{key:"removeHighlighters",value:function(na){return ab.MorphHighlighter.removeHighlighters(void 0===na?this:na)}},{key:"visibleStatusMessages",value:function(){return this.submorphs.filter(function(na){return na.isStatusMessage})}},{key:"visibleStatusMessagesFor",value:function(na){return this.submorphs.filter(function(Fa){return Fa.isStatusMessage&&Fa.targetMorph===
na})}},{key:"logErrorPreperation",value:function(na){var Fa=String(na),Ma=na.stack||"";Ma&&na.message!==na.stack&&(Ma=String(Ma),0===Ma.indexOf(Fa)&&(Ma=Ma.slice(Fa.length)),Fa+="\n"+Ma);return Fa}},{key:"logError",value:function(na){this.setStatusMessage(this.logErrorPreperation(na),ab.Color.red)}},{key:"showError",value:function(na){return this.logError(na)}},{key:"showErrorFor",value:function(na,Fa){return this.setStatusMessageFor(na,this.logErrorPreperation(Fa),ab.Color.red)}},{key:"setStatusMessageFor",
value:function(na,Fa,Ma,lb,Nb){lb=void 0===lb?5E3:lb;if(ab.StatusMessageForMorph){this.visibleStatusMessagesFor(na).forEach(function(ac){return ac.remove()});Fa=new ab.StatusMessageForMorph(Object.assign({message:Fa,color:Ma},Nb));this.openStatusMessage(Fa,lb);Fa.targetMorph=na;Fa.fadeIn(300);if(Fa.removeOnTargetMorphChange&&na.isText)ab.once(na,"selectionChange",Fa,"fadeOut",{converter:function(){return 200},garbageCollect:!0});return Fa}}},{key:"setStatusMessage",value:function(na,Fa,Ma,lb){Ma=
void 0===Ma?5E3:Ma;lb=void 0===lb?{}:lb;if(ab.StatusMessage)return console[Fa==ab.Color.red?"error":"log"](na),ab.config.verboseLogging?this.openStatusMessage(new ab.StatusMessage(Object.assign({message:na,color:Fa,hasFixedPosition:!0},lb)),Ma):null}},{key:"openStatusMessage",value:function(na,Fa){this.addMorph(na);if(na.slidable){for(var Ma=this.visibleStatusMessages(),lb=$jscomp.makeIterator(Ma),Nb=lb.next();!Nb.done;Nb=lb.next()){Nb=Nb.value;if(Ma.length<=(ab.config.maxStatusMessages||0))break;
!Nb.stayOpen&&Nb.slidable&&(Nb.remove(),ab.arr.remove(Ma,Nb))}ab.arr.without(Ma,na).forEach(function(ac){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){!ac.isMaximized&&ac.slidable&&ac.slideTo(ac.position.addPt(ab.pt(0,-na.extent.y-10)));Hc.jumpToEnd()})});Ma=this.visibleBounds().bottomRight().addXY(-20,-20);na.align(na.bounds().bottomRight(),Ma);na.topRight=Ma.addPt(ab.pt(0,40));na.animate({bottomRight:Ma,duration:500})}"number"===typeof Fa&&setTimeout(function(){return na.stayOpen||
na.fadeOut()},Fa);return na}},{key:"addProgressBar",value:function(na){na=void 0===na?{}:na;var Fa=this,Ma,lb,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){if(1==ac.nextAddress)return Ma=na,lb=void 0===Ma.location?"center":Ma.location,ac.yield(ab.loadObjectFromPartsbinFolder("progress bar"),2);Nb=ac.yieldResult;Object.assign(Nb,{progress:0},ab.obj.dissoc(na,["location"]));Fa.addMorph(Nb);Nb.align(Nb[lb],Fa.visibleBounds()[lb]());return ac.return(Nb)})}},{key:"withProgressBarDo",
value:function(na,Fa){var Ma=this,lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){switch(Nb.nextAddress){case 1:return Nb.yield(Ma.addProgressBar(Fa),2);case 2:return lb=Nb.yieldResult,Nb.setFinallyBlock(3),Nb.yield(na(lb),5);case 5:return Nb.return(Nb.yieldResult);case 3:Nb.enterFinallyBlock(),lb.remove(),Nb.leaveFinallyBlock(0)}})}},{key:"openPrompt",value:function(na,Fa){Fa=void 0===Fa?{requester:null,animated:!1}:Fa;var Ma=this,lb,Nb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ac){lb=
Ma.focusedMorph;Nb=Ma.visibleBounds();return ac.return(Ma.withRequesterDo(Fa.requester,function(Hc){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lc){na.openInWorldNear(Hc,Ma);na.height>Nb.height&&(na.height=Nb.height-5);"function"===typeof Fa.customize&&Fa.customize(na);Fa.animated&&Ma.previousPrompt&&Ma.previousPrompt.world()&&Ma.previousPrompt.transitionTo(na);Ma.previousPrompt=na;return Lc.return(ab.promise.finally(na.activate(Fa),function(){return lb&&lb.focus()}))})}))})}},{key:"withRequesterDo",
value:function(na,Fa){var Ma=this,lb,Nb,ac;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Hc){switch(Hc.nextAddress){case 1:Nb=Ma.visibleBounds().center();if(!na){Hc.jumpTo(2);break}Nb=na.globalBounds().center();na.isWorld&&(Nb=na.visibleBounds().center());if(!(lb=na.getWindow())){Hc.jumpTo(2);break}return Hc.yield(lb.toggleFader(!0),4);case 4:Nb=lb.globalBounds().center();case 2:return Hc.yield(Fa(Nb),5);case 5:return ac=Hc.yieldResult,lb&&lb.toggleFader(!1),Hc.return(ac)}})}},{key:"inform",
value:function(na,Fa){Fa=void 0===Fa?{fontSize:16,requester:null,animated:!0}:Fa;return this.openPrompt(new ab.InformPrompt(Object.assign({label:void 0===na?"no message":na},Fa)),Fa)}},{key:"prompt",value:function(na,Fa){Fa=void 0===Fa?{requester:null,input:"",historyId:null,useLastInput:!1,selectInput:!1}:Fa;na=new ab.TextPrompt(Object.assign({label:na},Fa));Fa.forceConfirm&&na.get("cancel button").disable();return this.openPrompt(na,Fa)}},{key:"editPrompt",value:function(na,Fa){Fa=void 0===Fa?{requester:null,
input:"",historyId:null,useLastInput:!1,textStyle:null,mode:null,evalEnvironment:null}:Fa;return this.openPrompt(new ab.EditPrompt(Object.assign({label:na},Fa)),Fa)}},{key:"passwordPrompt",value:function(na,Fa){Fa=void 0===Fa?{requester:null,input:""}:Fa;return this.openPrompt(new ab.PasswordPrompt(Object.assign({label:na},Fa)),Fa)}},{key:"confirm",value:function(na,Fa){Fa=void 0===Fa?{requester:null,animated:!0}:Fa;return this.openPrompt(new ab.ConfirmPrompt(Object.assign({label:na},Fa)),Fa)}},{key:"multipleChoicePrompt",
value:function(na,Fa){Fa=void 0===Fa?{requester:null,animated:!0,choices:[]}:Fa;return this.openPrompt(new ab.MultipleChoicePrompt(Object.assign({label:na},Fa)),Fa)}},{key:"listPrompt",value:function(na,Fa,Ma){na=void 0===na?"":na;Fa=void 0===Fa?[]:Fa;Ma=void 0===Ma?{requester:null,onSelection:null,preselect:0}:Ma;return this.openPrompt(new ab.ListPrompt(Object.assign({filterable:!1,padding:ab.Rectangle.inset(3),label:na,items:Fa},Ma)),Ma)}},{key:"filterableListPrompt",value:function(na,Fa,Ma){na=
void 0===na?"":na;Fa=void 0===Fa?[]:Fa;Ma=void 0===Ma?{requester:null,onSelection:null,preselect:0,multiSelect:!1,historyId:null,fuzzy:!1,actions:["default"],selectedAction:"default",theme:"dark"}:Ma;return Ma.prompt?(na=Ma.prompt.get("list"),na.items=Fa,na.selectedIndex=Ma.preselect||0,this.openPrompt(Ma.prompt,Ma)):this.openPrompt(new ab.ListPrompt(Object.assign({filterable:!0,padding:ab.Rectangle.inset(3),label:na,items:Fa},Ma)),Ma)}},{key:"editListPrompt",value:function(na,Fa,Ma){Fa=void 0===
Fa?[]:Fa;Ma=void 0===Ma?{requester:null,multiSelect:!0,historyId:null}:Ma;return this.openPrompt(new ab.EditListPrompt(Object.assign({label:void 0===na?"":na,multiSelect:!0,items:Fa,padding:ab.Rectangle.inset(3)},Ma)),Ma)}},{key:"showLoadingIndicatorFor",value:function(na,Fa){return this.addMorph(ab.LoadingIndicator.open(Fa,{center:na.globalBounds().center()}))}},{key:"defaultMenuItems",value:function(na,Fa){function Ma(Gd){var ye=this,xe=Nb.morphsContainingPoint(Hc.worldPoint(ab.pt(0,0)));xe.pop();
var le=xe.indexOf(Hc);xe=xe.slice(le+1);return xe.map(function(De){return[String(De),Gd.bind(ye,De)]})}var lb=this,Nb=this,ac=[],Hc=na;this.reset&&"function"===typeof this.reset&&ac.push(["Reset",function(){lb.reset()}]);ac.push(["Open in...",[["Window",function(){Hc.openInWindow()}]]]);ac.push(["Add morph to...",{getItems:Ma.bind(Hc,function(Gd){return Gd.addMorph(Hc)})}]);ac.push(["Get halo on...",{getItems:Ma.bind(Hc,function(Gd){return Gd.world().showHaloFor(Gd)})}]);Hc.owner&&1<Hc.owner.submorphs.length&&
ac.push(["Arrange morph",[["Bring to front",function(){return Hc.owner.addMorph(Hc)}],["Send to back",function(){return Hc.owner.addMorphBack(Hc)}],["Fit to submorphs",function(){var Gd,ye,xe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(le){if(1==le.nextAddress)return le.yield(Hc.world().prompt("Padding around submorphs:",{input:"Rectangle.inset(5)",historyId:"lively.morphic-fit-to-submorphs-padding-hist",requester:Hc}),2);if(3!=le.nextAddress)return Gd=le.yieldResult,"string"!==typeof Gd?
le.return():le.yield(ab.runEval(Gd,{topLevelVarRecorder:{Rectangle:ab.Rectangle}}),3);ye=le.yieldResult;Gd=(xe=ye.value)&&xe.isRectangle?xe:ab.Rectangle.inset(0);Hc.undoStart("fitToSubmorphs");Hc.fitToSubmorphs(Gd);Hc.undoStop("fitToSubmorphs");le.jumpToEnd()})}]].concat($jscomp.arrayFromIterable(ab.PropertyPath("master.auto").get(Hc)?[["Adjust to Master Component Submorph Hierarchy",function(){return Hc.master.reconcileSubmorphs()}]]:[]))]);this.submorphs.length&&ac.push(["Select all submorphs",
function(){return Hc.world().showHaloFor(Hc.submorphs.slice())}]);var Lc=[];Hc.startSteppingScripts?Lc.push(["Start stepping",function(){Hc.startSteppingScripts()}]):Lc.push(["Start stepping",function(){var Gd,ye,xe,le,De,Gf,cg,ng,Wf,wf,th,fi,Og,xf,dg,qg,qh,Me,gi,sc,nd,ee,Hd,rf,$f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(fg){switch(fg.nextAddress){case 1:return Gd=[],ye=$jscomp,xe=ye.makeIterator,fg.yield(ab.completions.getCompletions(function(){return Hc},""),2);case 2:le=xe.call(ye,
fg.yieldResult.completions);for(De=le.next();!De.done;De=le.next())for(Gf=De.value,cg=$jscomp.makeIterator(Gf),ng=cg.next().value,Wf=cg.next().value,wf=$jscomp.makeIterator(Wf),th=wf.next();!th.done;th=wf.next())fi=th.value,fi.startsWith("_")||fi.startsWith("$")||(Og=$jscomp.makeIterator(fi.match(/^([^\(]+)\(?([^\)]+)?\)?$/)||[]),Og.next(),xf=Og.next().value,dg=Og.next().value,xf&&"function"===typeof Hc[xf]&&Gd.push({isListItem:!0,string:ng+" "+fi,value:{selector:xf,args:dg}}));return fg.yield($world.filterableListPrompt("Select method to start",
Gd,{requester:Hc,historyId:"lively.morphic-start-stepping-chooser"}),3);case 3:return qg=fg.yieldResult,qh=$jscomp.makeIterator(qg.selected),(Me=qh.next().value)?fg.yield($world.prompt("Steptime in ms (how of the method will be called)?",{input:100}),4):fg.return();case 4:gi=fg.yieldResult;gi=Number(gi);if(isNaN(gi))return fg.return();sc=[gi,Me.selector];if(!Me.args){fg.jumpTo(5);break}nd={targetModule:"lively://lively.morphic-stepping-args/eval.js"};return fg.yield($world.editPrompt("Arguments to pass",
{input:"["+Me.args+"]",mode:"js",evalEnvironment:nd}),6);case 6:return ee=fg.yieldResult,fg.yield(ab.runEval(ee,nd),7);case 7:Hd=fg.yieldResult;rf=Hd.value;if($f=Hd.isError)return $world.inform("Error evaluating the arguments: "+rf),fg.return();Array.isArray(rf)&&sc.push.apply(sc,$jscomp.arrayFromIterable(rf));case 5:Hc.startStepping.apply(Hc,$jscomp.arrayFromIterable(sc)),fg.jumpToEnd()}})}]);0!=Hc.tickingScripts.length&&Lc.push(["Stop stepping",function(){return Hc.stopStepping()}]);0!=Lc.length&&
ac.push(["Stepping",Lc]);ac.push(["Change Tooltip",function(){var Gd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ye){if(1==ye.nextAddress)return Gd=Hc,ye.yield(Hc.world().prompt("Enter Tooltip",{placeholder:"Description",input:Hc.tooltip||""}),2);Gd.tooltip=ye.yieldResult;ye.jumpToEnd()})}]);var kd=["Morphic properties",[]];ac.push(kd);ac.push(["display serialization info",function(){var Gd,ye,xe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(le){if(1==le.nextAddress)return le.yield(System.import("lively.serializer2/debugging.js"),
2);Gd=le.yieldResult;ye=Gd.SnapshotInspector;xe=ab.serialize(Hc);ye.forSnapshot(xe).openSummary();le.jumpToEnd()})}]);ac.push(["display object report",function(){var Gd,ye,xe;return $jscomp.asyncExecutePromiseGeneratorProgram(function(le){if(1==le.nextAddress)return le.yield(System.import("lively.serializer2/debugging.js"),2);Gd=le.yieldResult;ye=Gd.SnapshotInspector;xe=ab.serialize(Hc);ye.forSnapshot(xe).openObjectReport();le.jumpToEnd()})}]);var Sd=ab.Icon.textAttribute("check-square"),ke=ab.Icon.textAttribute("square");
Object.assign(Sd[1],{float:"none",display:"inline"});["grabbable","draggable","acceptsDrops","halosEnabled"].forEach(function(Gd){return kd[1].push([[].concat($jscomp.arrayFromIterable(na[Gd]?Sd:ke),[" "+Gd,{float:"none"}]),function(){return na[Gd]=!na[Gd]}])});ac.push(["export to HTML",function(){var Gd,ye,xe,le;return $jscomp.asyncExecutePromiseGeneratorProgram(function(De){if(1==De.nextAddress)return De.yield(System.import("lively.morphic/rendering/html-generator.js"),2);if(3!=De.nextAddress)return Gd=
De.yieldResult,ye=Gd.generateHTML,xe=ab.HTMLMorph,le="exported-"+na.name,De.yield(ye(na,null,{isFragment:!0,addStyles:!1}),3);(new xe({name:le,html:De.yieldResult})).openInWorld();De.jumpToEnd()})}]);ac.push({isDivider:!0});ac.push(["Add comment",function(){var Gd,ye,xe,le;return $jscomp.asyncExecutePromiseGeneratorProgram(function(De){if(1==De.nextAddress)return De.yield($world.prompt("Enter comment"),2);if(4!=De.nextAddress){Gd=De.yieldResult;if(!Gd)return $world.setStatusMessage("Comment not saved",
"red"),De.jumpTo(0);ye=ab.pt(0,0);Fa&&!Fa.halo&&(xe=Hc.localize(Fa.position).x/Hc.width,le=Hc.localize(Fa.position).y/Hc.height,ye=ab.pt(xe,le));return De.yield(Hc.addComment(Gd,ye),4)}$world.setStatusMessage("Comment saved","green");De.jumpToEnd()})}]);return ac}},{key:"defaultConnectionMenuItems",value:function(na){return na.attributeConnections&&na.attributeConnections.length?na.attributeConnections.map(function(Fa){return[String(Fa),[["show",function(){var Ma,lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){if(1==
Nb.nextAddress)return Nb.yield(System.import("lively.ide/fabrik.js"),2);Ma=Nb.yieldResult;lb=Ma.interactivelyShowConnection;lb(Fa);Nb.jumpToEnd()})}],["edit",function(){var Ma,lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Nb){if(1==Nb.nextAddress)return Nb.yield(System.import("lively.ide/fabrik.js"),2);Ma=Nb.yieldResult;lb=Ma.interactivelyReEvaluateConnection;lb(Fa);Nb.jumpToEnd()})}],["disconnect",function(){Fa.disconnect();$world.setStatusMessage("disconnected "+Fa)}]]]}):null}},
{key:"defaultSourceDataBindings",value:function(na){var Fa=na.propertiesAndPropertySettings().properties,Ma=ab.arr.groupByKey(Object.keys(Fa).map(function(Nb){Nb=Object.assign({name:Nb},Fa[Nb]);return Nb.group&&Nb.group.startsWith("_")?null:Nb}).filter(Boolean),"group");na=["core","geometry","interaction","styling","layouting"];var lb=[];na.forEach(function(Nb){return lb.push(Ma[Nb])});ab.arr.withoutAll(Ma.keys(),na).forEach(function(Nb){return lb.push(Ma[Nb])});return lb}},{key:"targetDataBindings",
value:function(na){for(var Fa=[],Ma=na;Ma!==Object.prototype;){var lb=Ma===na?String(this):ab.getClassName(Ma),Nb=null,ac=ab.obj.getOwnPropertyDescriptors(Ma),Hc=Object.getPrototypeOf(Ma),Lc;for(Lc in ac){var kd=ac[Lc].value;"function"!==typeof kd||kd===Ma.constructor||Lc.startsWith("$")||Lc.startsWith("_")||(Nb||(Nb=[]),kd=ab.fun.argumentNames(kd),Nb.push({group:lb+" methods",signature:Lc+"("+kd.join(", ")+")",name:Lc}))}Nb&&Fa.push(Nb);Ma=Hc}return this.defaultSourceDataBindings(na).concat(Fa)}},
{key:"defaultConnectMenuItems",value:function(na,Fa){var Ma=this,lb=this.defaultSourceDataBindings(Fa),Nb=Fa.world();lb=lb.map(function(ac){return[ac[0].group||"uncategorized",ac.map(function(Hc){return[Hc.name,na?function(){return na(Hc.name,Fa,Hc)}:function(){var Lc,kd;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Sd){if(1==Sd.nextAddress)return Sd.yield(System.import("lively.ide/fabrik.js"),2);Lc=Sd.yieldResult;kd=Lc.interactiveConnectGivenSource;kd(Fa,Hc.name);Sd.jumpToEnd()})}]})]});
Nb&&lb.push(["custom...",na?function(){return na("custom...",Fa,null)}:function(){var ac,Hc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){if(1==kd.nextAddress)return kd.yield(System.import("lively.ide/fabrik.js"),2);if(3!=kd.nextAddress)return ac=kd.yieldResult,Hc=ac.interactiveConnectGivenSource,kd.yield(Nb.prompt("Enter custom connection point",{requester:Fa,historyId:"lively.morphic-custom-connection-points",useLastInput:!0}),3);(Lc=kd.yieldResult)&&Hc(Ma,Lc);kd.jumpToEnd()})}]);
return lb}},{key:"updateVisibleWindowMorphs",value:function(){var na=this;Yc._get(Object.getPrototypeOf(Ra.prototype),"updateVisibleWindowMorphs",this).call(this);this.halos().forEach(function(Fa){Fa.maskBounds=na.visibleBounds()})}},{key:"handleHaloCycle",value:function(na){var Fa=na.state.clickedOnMorph,Ma=na.isCommandKey(),lb=na.isShiftDown(),Nb;Ma&&!Fa.isHalo&&(Ma=Nb=na.world.morphsContainingPoint(na.position),Nb=Nb.filter(function(ac){return ac.halosEnabled}),Ma=Ma.filter(function(ac){return ac.halosEnabled}),
Nb=Ma[0]||Nb[0]);lb&&!Fa.isHaloItem&&Nb&&na.halo&&na.halo.borderBox!=Nb?na.halo.addMorphToSelection(Nb):(Fa=na.halo&&!na.targetMorphs.find(function(ac){return ac.isHaloItem||ac.keepHalo&&ac.keepHalo(na)}),lb=na.layoutHalo&&!na.targetMorphs.find(function(ac){return ac.isHaloItem}),Ma=(!na.halo||Fa)&&Nb,lb&&na.layoutHalo.remove(),Fa&&na.halo.remove(),Ma&&(na.stop(),this.showHaloFor(Nb,na.domEvt.pointerId)))}}],[{key:Symbol.for("__LivelyClassName__"),get:function(){return"LivelyWorld"}},{key:"properties",
get:function(){return{localComponents:{initialize:function(){var na=this;this.whenRendered().then(function(){na.localComponents?na.localComponents.forEach(function(Fa){var Ma,lb,Nb,ac,Hc,Lc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(kd){switch(kd.nextAddress){case 1:if(Fa.owner){kd.jumpTo(0);break}Ma=Fa.withAllSubmorphsSelect(function(Sd){return Sd.master&&!Sd.master._appliedMaster});lb=$jscomp.makeIterator(Ma);Nb=lb.next();case 3:if(Nb.done){kd.jumpTo(5);break}ac=Nb.value;return kd.yield(ac.master.applyIfNeeded(!0),
4);case 4:Nb=lb.next();kd.jumpTo(3);break;case 5:Hc=na.withAllSubmorphsSelect(function(Sd){return Sd.master&&Sd.master.uses(Fa)}),Lc=na.localComponents.filter(function(Sd){return Sd.master&&Sd.master.uses(Fa)}),Hc.forEach(function(Sd){Sd.requestMasterStyling()}),Lc.forEach(function(Sd){return Sd.master.applyIfNeeded(!0)}),kd.jumpToEnd()}})}):na.localComponents=na.withAllSubmorphsSelect(function(Fa){return Fa.isComponent})})}},name:{set:function(na){this.setProperty("name",na);document.title="lively.next - "+
na}},hiddenComponents:{initialize:function(){this.hiddenComponents=[]}},fill:{defaultValue:ab.Color.rgb(81,90,90)},draggable:{readOnly:!0,get:function(){return!ab.touchInputDevice}},commentBrowser:{}}}}],X,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:1664,end:42744})}(ab.World);ab.LivelyWorld=
df;ab.LivelyWorld=df;ab.LivelyWorld=df;Pe=Pa("a",function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Ra=X.hasOwnProperty("SelectionElement")&&"function"===typeof X.SelectionElement?X.SelectionElement:X.SelectionElement=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"SelectionElement"}},{key:"properties",get:function(){return{borderColor:{defaultValue:ab.Color.red},
borderWidth:{defaultValue:1},fill:{defaultValue:ab.Color.transparent},epiMorph:{defaultValue:!0},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],X,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:42753,end:43115})}(ab.Morph));ab.SelectionElement=Pe;ab.SelectionElement=Pe;ab.SelectionElement=
Pe;Xa=Pa("S",function(ma){var X=lively.FreezerRuntime.recorderFor("lively.ide/world.js"),Ra=X.hasOwnProperty("Selection")&&"function"===typeof X.Selection?X.Selection:X.Selection=function(na){na&&na[Symbol.for("lively-instance-restorer")]||this[Symbol.for("lively-instance-initialize")].apply(this,arguments)};return Yc(Ra,ma,void 0,[{key:Symbol.for("__LivelyClassName__"),get:function(){return"Selection"}},{key:"properties",get:function(){return{fill:{defaultValue:ab.Color.gray.withA(.2)},borderWidth:{defaultValue:2},
borderColor:{defaultValue:ab.Color.gray},isSelectionElement:{readOnly:!0,get:function(){return!0}}}}}],X,{pathInPackage:function(){return"world.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},package:function(){return{name:"lively.ide",version:"0.1.0"}}},{start:43124,end:43444})}(ab.Morph));ab.Selection=Xa;ab.Selection=Xa;ab.Selection=Xa;df=Object.freeze({__proto__:null,LivelyWorld:df,SelectionElement:Pe,
Selection:Xa});Pa("w",df)}}});