System.register("./__rootModule___commonjs-entry-71573ff5.js ./editor-plugin-0a8dd45b.js ./editor-modes-5e094c88.js ./mode-9e103dc6.js ./editor-plugin-8acb3af6.js ./ui.cp-04e9d052.js ./loading-indicator.cp-b18e3b89.js @babel/plugin-syntax-import-meta ./ui.cp-6289a670.js ./index-d18accbd.js ./tooltips.cp-6a2406c0.js ./index-1c08552a.js ./interface-dc23a2c8.js ./index-ca98f65e.js ./index-c79abca0.js ./value-widgets-6cb12552.js ./list.cp-8569fe93.js ./popups.cp-68dc8a4a.js ./index-02a2847a.js ./editor-plugin-330ed4ee.js ./editor-plugin-00779331.js ./eval-backend-ui-e952986b.js ./index-5053c530.js rollup @rollup/plugin-json ./helpers-ae531c72.js @rollup/plugin-commonjs rollup-plugin-polyfill-node ./test-runner-849f8d86.js ./linter-9c18bc15.js".split(" "),function(Lc){var pd,
Nd,Tc,Jc,$d,Bb,rd,Id,Ac,Pc,gd,nd,Fd,ic,vd,sb,Xb,Nb,bc,hb,cb,Hb,ec,ub,yb,ba,wb,Xa;return{setters:[function(Za){pd=Za.j;Nd=Za.aC;Tc=Za.i;Jc=Za.x;$d=Za._;Bb=Za.k;rd=Za.h;Id=Za.aB;Ac=Za.y;Pc=Za.b;gd=Za.R;nd=Za.C;Fd=Za.w;ic=Za.B;vd=Za.aG;sb=Za.M;Xb=Za.W;Nb=Za.A;bc=Za.o;hb=Za.bW},function(Za){cb=Za.CodeMirrorEnabledEditorPlugin;Hb=Za["default"];ec=Za.guessTextModeName},function(Za){ub=Za.defineMode;yb=Za.defineMIME},function(Za){ba=Za.S},function(Za){wb=Za["default"]},function(){},function(Za){Xa=Za.D},
function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){}],execute:function(){var Za=window.lively.FreezerRuntime.recorderFor("lively.ide/shell/completers.js");Za.arr=pd;Za.runCommand=Nd;(function(db){var ib=window.lively.FreezerRuntime.recorderFor("lively.ide/shell/completers.js"),
Ea=ib.hasOwnProperty("ShellCompleter")&&"function"===typeof ib.ShellCompleter?ib.ShellCompleter:ib.ShellCompleter=function(W){if(!W||!W[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return Tc(Ea,db,[{key:"buildCommand",value:function(W){var T=W.match(/\$([^\s]*)$/i)||[];T=Jc(T,2);T[0];T=T[1];if("string"===typeof T)return{command:'compgen -v -S "[variable]" '.concat(T),prefix:T};T=W.match(/(^|;)\s*([^\s]*)$/i)||[];T=Jc(T,
3);T[0];T[1];T=T[2];if("string"===typeof T)return{command:'compgen -a -S "[alias]" '.concat(T,'\n                        compgen -c -S "[command]" ').concat(T,'\n                        compgen -b -S "[builtin]" ').concat(T),prefix:T};T=Za.arr.last(W.split(/[\s;]/));return{prefix:T,command:'compgen -f -S "[file]" '.concat(T)}}},{key:"compute",value:function(){var W=$d(regeneratorRuntime.mark(function ka(ia){var K,ya,pb,La,eb,jb,E,Wb,R,xb,Ja;return regeneratorRuntime.wrap(function(Ga){for(;;)switch(Ga.prev=
Ga.next){case 0:K=ia.pluginFind(function(sa){return sa.isShellEditorPlugin});ya=ia.cursorPosition;pb=ya.row;La=ya.column;eb=ia.getLine(pb).slice(0,La);jb="";if(K){Ga.next=6;break}return Ga.abrupt("return",[]);case 6:return E=this.buildCommand(eb),Wb=E.command,eb=E.prefix,Ga.prev=7,R=Za.runCommand(Wb,{cwd:K.cwd}),Ga.next=11,R.whenDone();case 11:jb=R.stdout;Ga.next=18;break;case 14:return Ga.prev=14,Ga.t0=Ga["catch"](7),console.warn("shell completer errored: ".concat(Ga.t0.stack||Ga.t0)),Ga.abrupt("return",
[]);case 18:return xb={variable:300,file:400,builtin:400,command:500,alias:200},Ja=jb.split("\n").map(function(sa){sa=sa.match(/(.*)\[([^\]]+)\]$/)||[];var Ub=Jc(sa,3);Ub[0];sa=Ub[1];Ub=Ub[2];return sa?{completion:sa,prefix:eb,info:Ub,priority:1500+(xb[Ub]||0)}:null}).filter(Boolean),Ga.abrupt("return",Ja);case 21:case "end":return Ga.stop()}},ka,this,[[7,14]])}));return function(ia){return W.apply(this,arguments)}}()}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"ShellCompleter"}}],
ib,{pathInPackage:function(){return"./shell/completers.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:87,end:2022})})(void 0);var Sb=[new Za.ShellCompleter];Za.shellCompleters=Sb;Za.shellCompleters=Sb;var Cb=window.lively.FreezerRuntime.recorderFor("lively.ide/shell/mode.js");Cb.defineMode=ub;Cb.defineMIME=yb;Cb.defineMode("shell",
function(){function db(ka,K){K=K.split(" ");for(var ya=0;ya<K.length;ya++)T[K[ya]]=ka}function ib(ka,K){if(ka.eatSpace())return null;var ya=ka.sol(),pb=ka.next();if("\\"===pb)return ka.next(),null;if("'"===pb||'"'===pb||"`"===pb)return K.tokens.unshift(Ea(pb,"`"===pb?"quote":"string")),W(ka,K);if("#"===pb){if(ya&&ka.eat("!"))return ka.skipToEnd(),"meta";ka.skipToEnd();return"comment"}if("$"===pb)return K.tokens.unshift(ia),W(ka,K);if("+"===pb||"="===pb)return"operator";if("-"===pb)return ka.eat("-"),
ka.eatWhile(/\w/),"attribute";if(/\d/.test(pb)&&(ka.eatWhile(/\d/),ka.eol()||!/\w/.test(ka.peek())))return"number";ka.eatWhile(/[\w-]/);K=ka.current();return"="===ka.peek()&&/\w+/.test(K)?"def":T.hasOwnProperty(K)?T[K]:null}function Ea(ka,K){var ya="("==ka?")":"{"==ka?"}":ka;return function(pb,La){for(var eb,jb=!1,E=!1;null!=(eb=pb.next());){if(eb===ya&&!E){jb=!0;break}if("$"===eb&&!E&&"'"!==ka){E=!0;pb.backUp(1);La.tokens.unshift(ia);break}if(!E&&eb===ka&&ka!==ya)return La.tokens.unshift(Ea(ka,K)),
W(pb,La);E=!E&&"\\"===eb}!jb&&E||La.tokens.shift();return K}}function W(ka,K){return(K.tokens[0]||ib)(ka,K)}var T={};db("atom","true false");db("keyword","if then do else elif while until for in esac fi fin fil done exit set unset export function");db("builtin","ab awk bash beep cat cc cd chown chmod chroot clear cp curl cut diff echo find gawk gcc get git grep hg kill killall ln ls make mkdir openssl mv nc node npm ping ps restart rm rmdir sed service sh shopt shred source sort sleep ssh start stop su sudo svn tee telnet top touch vi vim wall wc wget who write yes zsh");
var ia=function(ka,K){1<K.tokens.length&&ka.eat("$");var ya=ka.next();if(/['"({]/.test(ya))return K.tokens[0]=Ea(ya,"("==ya?"quote":"{"==ya?"def":"string"),W(ka,K);/\d/.test(ya)||ka.eatWhile(/\w/);K.tokens.shift();return"def"};return{startState:function(){return{tokens:[]}},token:function(ka,K){return W(ka,K)},closeBrackets:"()[]{}''\"\"``",lineComment:"#",fold:"brace"}});Cb.defineMIME("text/x-sh","shell");var Da=window.lively.FreezerRuntime.recorderFor("lively.ide/shell/editor-plugin.js");Da.arr=
pd;Da.string=Bb;Da.signal=rd;Da.CodeMirrorEnabledEditorPlugin=cb;Da.defaultDirectory=Id;Da.runCommand=Nd;Da.shellCompleters=Sb;Da.Snippet=ba;Da.defaultDir=Da.defaultDir||void 0;Promise.resolve(Da.defaultDirectory()).then(function(db){return Da.defaultDir=db});Sb=function(db){var ib=window.lively.FreezerRuntime.recorderFor("lively.ide/shell/editor-plugin.js"),Ea=ib.hasOwnProperty("ShellEditorPlugin")&&"function"===typeof ib.ShellEditorPlugin?ib.ShellEditorPlugin:ib.ShellEditorPlugin=function(W){if(!W||
!W[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return Tc(Ea,db,[{key:Symbol["for"]("lively-instance-initialize"),value:function(){Tc._get(Object.getPrototypeOf(Ea.prototype),Symbol["for"]("lively-instance-initialize"),this).call(this);this.state={cwd:Da.defaultDir,command:null}}},{key:"isShellEditorPlugin",get:function(){return!0}},{key:"shortName",get:function(){return"shell"}},{key:"options",get:function(){return this.state}},
{key:"options",set:function(W){return this.state=Object.assign(this.state,W)}},{key:"cwd",get:function(){return this.state.cwd||Da.defaultDir||""}},{key:"cwd",set:function(W){this.state.cwd=W;Da.signal(this,"cwd",W)}},{key:"command",get:function(){return this.state.command}},{key:"command",set:function(W){this.state.command=W;Da.signal(this,"command",W)}},{key:"runCommand",value:function(W,T){return this.command=Da.runCommand(W,Object.assign({cwd:this.cwd,owner:this.textMorph.id},T))}},{key:"changeCwdInteractively",
value:function(){var W=$d(regeneratorRuntime.mark(function ia(){var ka,K,ya,pb,La,eb,jb,E;return regeneratorRuntime.wrap(function(Wb){for(;;)switch(Wb.prev=Wb.next){case 0:return K=this.cwd,ya=Da.arr.uniq((ka=[K]).concat.apply(ka,[Da.defaultDir].concat(Ac(this.knownCwds)))).filter(Boolean),Wb.next=4,this.textMorph.world().editListPrompt("Choose working directory:",ya,{requester:this.textMorph.getWindow(),historyId:"lively.morphic-ide/shell-changeCwdInteractively-hist-list",preselect:ya.indexOf(K)});
case 4:Wb.t0=Wb.sent;if(Wb.t0){Wb.next=7;break}Wb.t0={};case 7:pb=Wb.t0;La=pb.status;eb=pb.list;jb=Jc(pb.selections,1);E=jb[0];if("canceled"!==La){Wb.next=14;break}return Wb.abrupt("return");case 14:this.knownCwds=eb;if(E){Wb.next=17;break}return Wb.abrupt("return");case 17:this.textMorph.setStatusMessage(E),this.cwd=E,this.updateWindowTitle();case 20:case "end":return Wb.stop()}},ia,this)}));return function(){return W.apply(this,arguments)}}()},{key:"knownCwds",get:function(){if("undefined"===typeof localStorage)return[];
try{var W=localStorage.getItem("lively.morphic-ide/shell-known-cwds");return W?JSON.parse(W):[]}catch(T){return[]}}},{key:"knownCwds",set:function(W){if("undefined"!==typeof localStorage)try{localStorage.setItem("lively.morphic-ide/shell-known-cwds",JSON.stringify(W))}catch(T){console.error(T)}}},{key:"updateWindowTitle",value:function(){var W=this.textMorph.getWindow();if(W&&W.title.includes("Shell Workspace")){var T=this.command&&this.command.isRunning()?" (running ".concat(this.command.pid,")"):
"",ia=this.cwd?" - ".concat(Da.string.truncateLeft(this.cwd,35)):"";W.title=["Shell Workspace",T,ia].join("")}}},{key:"getCommands",value:function(W){var T=this,ia=this.textMorph;return[{name:"[shell] spawn command from selected text",exec:function(){var ka=$d(regeneratorRuntime.mark(function pb(ya){var La,eb,jb,E,Wb=arguments;return regeneratorRuntime.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:return La=1<Wb.length&&void 0!==Wb[1]?Wb[1]:{printit:!1},eb=ia.selection,eb.isEmpty()&&ia.selectLine(eb.lead.row),
jb=T.runCommand(eb.text,{}),eb.collapseToEnd(),La.printit&&(E=function(xb){var Ja=eb.start;eb.collapseToEnd();ia.insertText(xb);eb.range={start:Ja,end:ia.cursorPosition}},jb.on("stdout",E),jb.on("stderr",E)),T.updateWindowTitle(),R.next=9,jb.whenStarted();case 9:return T.updateWindowTitle(),R.next=12,jb.whenDone();case 12:return T.updateWindowTitle(),La.printit?(jb.removeListener("stdout",E),jb.removeListener("stderr",E)):ia.setStatusMessage(jb.output.trim()),R.abrupt("return",!0);case 15:case "end":return R.stop()}},
pb)}));return function(ya){return ka.apply(this,arguments)}}()},{name:"[shell] kill current command",exec:function(){var ka=$d(regeneratorRuntime.mark(function pb(ya){var La,eb,jb=arguments;return regeneratorRuntime.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:La=1<jb.length&&void 0!==jb[1]?jb[1]:{signal:void 0};if(eb=T.command){E.next=5;break}ia.setStatusMessage("No command running");return E.abrupt("return",!0);case 5:return ia.setStatusMessage("Sending signal ".concat(La.signal||"KILL",
" to command ").concat(eb.pid)),E.next=8,eb.kill(La.signal);case 8:return E.abrupt("return",!0);case 9:case "end":return E.stop()}},pb)}));return function(ya){return ka.apply(this,arguments)}}()},{name:"[shell] change working directory",exec:function(){var ka=$d(regeneratorRuntime.mark(function ya(){return regeneratorRuntime.wrap(function(pb){for(;;)switch(pb.prev=pb.next){case 0:return pb.next=2,T.changeCwdInteractively();case 2:return pb.abrupt("return",!0);case 3:case "end":return pb.stop()}},
ya)}));return function(){return ka.apply(this,arguments)}}()}].concat(W)}},{key:"getKeyBindings",value:function(W){return W.concat([{keys:{mac:"Meta-D",win:"Alt-Enter"},command:{command:"[shell] spawn command from selected text",args:{printit:!1}}},{keys:{mac:"Meta-P",win:"Ctrl-Alt-Enter"},command:{command:"[shell] spawn command from selected text",args:{printit:!0}}},{keys:{mac:"Meta-Shift-L D I R",win:"Ctrl-Shift-L D I R"},command:"[shell] change working directory"}])}},{key:"getSnippets",value:function(W){return W.concat([["findjs",
"find ${0:.} \\( -name ${1:excluded} \\) -prune -o -iname '*.js' -type f -print0 | xargs -0 grep -nH ${2:what}"]].map(function(T){T=Jc(T,2);return new Da.Snippet({trigger:T[0],expansion:T[1]})}))}},{key:"getCompleters",value:function(W){return W.concat(Da.shellCompleters)}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"ShellEditorPlugin"}}],ib,{pathInPackage:function(){return"./shell/editor-plugin.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},
"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:465,end:5892})}(Da.CodeMirrorEnabledEditorPlugin);Da["default"]=Sb;var zb=window.lively.FreezerRuntime.recorderFor("lively.ide/shell/terminal.js");zb.pt=Pc;zb.Rectangle=gd;zb.Color=nd;zb.connect=Fd;zb.arr=pd;zb.obj=ic;zb.defaultDirectory=Id;zb.GridLayout=vd;zb.Morph=sb;zb.World=Xb;zb.config=Nb;zb.InputLine=bc;zb.ShellEditorPlugin=Sb;zb.DiffEditorPlugin=wb;zb.EditorPlugin=Hb;zb.guessTextModeName=ec;zb.packagesOfSnapshot=hb;zb.DarkButton=
Xa;Sb=Lc("default",function(db){var ib=window.lively.FreezerRuntime.recorderFor("lively.ide/shell/terminal.js"),Ea=ib.hasOwnProperty("Terminal")&&"function"===typeof ib.Terminal?ib.Terminal:ib.Terminal=function(W){if(!W||!W[Symbol["for"]("lively-instance-restorer")])return this[Symbol["for"]("lively-instance-initialize")].apply(this,arguments)};return Tc(Ea,db,[{key:Symbol["for"]("lively-instance-initialize"),value:function(W){var T=this;Tc._get(Object.getPrototypeOf(Ea.prototype),Symbol["for"]("lively-instance-initialize"),
this).call(this,W);W.cwd||Promise.resolve(function(){return T.cwd=zb.defaultDirectory()})}},{key:"__additionally_serialize__",value:function(W,T,ia,ka){Tc._get(Object.getPrototypeOf(Ea.prototype),"__additionally_serialize__",this).call(this,W,T,ia,ka);T=ia.ref(this.ui.output);T=T.currentSnapshot.props;T.attributeConnections&&(T.attributeConnections.value=[]);T.plugins&&(T.plugins.value=[]);T.anchors&&(T.anchors.value=T.anchors.value.filter(function(K){return K.id.startsWith("selection-")}));T.savedMarks&&
(T.savedMarks.value=[]);T=ia.ref(this.ui.input);T=T.currentSnapshot.props;T.attributeConnections&&(T.attributeConnections.value=[]);T.plugins&&(T.plugins.value=[]);T.anchors&&(T.anchors.value=T.anchors.value.filter(function(K){return K.id.startsWith("selection-")}));T.savedMarks&&(T.savedMarks.value=[]);W.props._serializedState={verbatim:!0,value:{cwd:this.cwd}}}},{key:"onLoad",value:function(W,T){this._serializedState&&(this.cwd=this._serializedState.cwd,delete this._serializedState);zb.connect(this.ui.input,
"inputAccepted",this,"execCommand",{updater:function(ia,ka){return ia("[shell terminal] run command or send input",{command:ka})}})}},{key:"defaultStyle",get:function(){return Object.assign({},zb.config.codeEditor.defaultStyle)}},{key:"focus",value:function(){this.ui[this.lastFocused].focus()}},{key:"clear",value:function(){this.ui.output.textString=""}},{key:"updateWindowTitle",value:function(){var W=this.getWindow();if(W){var T="Term",ia=this.command;if(ia){var ka=ia.commandString;ia=ia.status;
T+=" - ".concat(ka?ka+" ":"").concat(ia)}W.title=T}}},{key:"updateTextMode",value:function(){var W=this.ui.output,T=zb.guessTextModeName(W),ia=W.plugins.filter(function(K){return K.isEditorPlugin}),ka=[];"diff"===T&&((T=ia.find(function(K){return K instanceof zb.DiffEditorPlugin}))?zb.arr.remove(ia,T):ka.push(new zb.DiffEditorPlugin));W.plugins=zb.arr.withoutAll(W.plugins,ia).concat(ka)}},{key:"keybindings",get:function(){return[{keys:"F1|Alt-Up",command:"focus output"},{keys:"F2|Alt-Down",command:"focus input"},
{keys:"Ctrl-D",command:{command:"[shell] kill current command",args:{signal:"KILL"}}},{keys:"Ctrl-C",command:{command:"[shell] kill current command",args:{signal:"INT"}}},{keys:{mac:"Meta-Shift-L D I R",win:"Ctrl-Shift-L D I R"},command:"[shell] change working directory"}].concat(Tc._get(Object.getPrototypeOf(Ea.prototype),"keybindings",this))}},{key:"commands",get:function(){return Tc._get(Object.getPrototypeOf(Ea.prototype),"commands",this).concat([{name:"focus input",exec:function(W){W.lastFocused=
"input";W=W.ui.input;W.show();W.focus();return!0}},{name:"focus output",exec:function(W){W.lastFocused="output";W=W.ui.output;W.show();W.focus();return!0}},{name:"[shell terminal] run command or send input",exec:function(W){var T=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{command:""};W.command&&W.command.isRunning()?W.command.writeToStdin(T.command+"\n"):(W.clear(),W.runCommand(T.command,zb.obj.dissoc(T,["command"])));return!0}},{name:"[shell] kill current command",exec:function(){var W=
$d(regeneratorRuntime.mark(function ka(ia){var K,ya,pb,La=arguments;return regeneratorRuntime.wrap(function(eb){for(;;)switch(eb.prev=eb.next){case 0:K=1<La.length&&void 0!==La[1]?La[1]:{signal:void 0};if(ya=ia.command){eb.next=5;break}ia.setStatusMessage("No command running");return eb.abrupt("return",!0);case 5:return pb=K.signal||"KILL",ia.addOutput("\nsend signal ".concat(pb)),ia.setStatusMessage("Sending signal ".concat(pb," to command ").concat(ya.pid)),eb.next=10,ya.kill(pb);case 10:return eb.abrupt("return",
!0);case 11:case "end":return eb.stop()}},ka)}));return function(ia){return W.apply(this,arguments)}}()},{name:"[shell] change working directory",exec:function(){var W=$d(regeneratorRuntime.mark(function ka(ia){return regeneratorRuntime.wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return K.next=2,ia.shellPlugin.changeCwdInteractively();case 2:return K.abrupt("return",!0);case 3:case "end":return K.stop()}},ka)}));return function(ia){return W.apply(this,arguments)}}()}])}},{key:"addOutput",
value:function(W){var T=this.ui.output,ia=T.isAtDocumentEnd();T.append(W);ia&&(T.gotoDocumentEnd(),T.scrollCursorIntoView())}},{key:"diffModulesOfSnapshot",value:function(){var W=$d(regeneratorRuntime.mark(function ka(ia){var K=this,ya,pb,La,eb,jb,E,Wb,R;return regeneratorRuntime.wrap(function(xb){for(;;)switch(xb.prev=xb.next){case 0:return ya=this.shellPlugin.runCommand("git diff "+ia),xb.next=3,ya.whenDone();case 3:pb=ya.stdout.split("\n").filter(function(Ja){return 1E3<Ja.length}).map(function(Ja){return JSON.parse(Ja.slice(1))}),
La=Jc(pb,2),eb=La[0],jb=La[1],eb&&jb?(E=zb.packagesOfSnapshot(eb),Wb=zb.packagesOfSnapshot(jb),R=[],zb.arr.zip(E,Wb).forEach(function(Ja){var Ga=Jc(Ja,2);Ja=Ga[0];Ga=Ga[1];Ja&&Ga&&zb.arr.zip(Object.entries(Ja.files),Object.entries(Ga.files)).forEach(function(sa){var Ub=Jc(sa,2),vc=Jc(Ub[0],2);sa=vc[0];vc=vc[1];Ub=Jc(Ub[1],2);Ub[0];Ub=Ub[1];vc!=Ub&&R.push([sa,vc,Ub])})}),R.forEach(function(Ja){var Ga=Jc(Ja,3);Ja=Ga[0];var sa=Ga[1];Ga=Ga[2];K.world().execCommand("diff and open in window",{a:sa,b:Ga,
title:Ja})})):this.world().inform("No Changes!");case 5:case "end":return xb.stop()}},ka,this)}));return function(ia){return W.apply(this,arguments)}}()},{key:"runCommand",value:function(W,T){if(this.command&&this.command.isRunning())throw Error("".concat(this.command," still running"));return W.includes("styleguides")&&W.startsWith("git diff")?this.diffModulesOfSnapshot(W.replace(/git diff\s*/,"")):this.command=this.shellPlugin.runCommand(W,T)}}],[{key:Symbol["for"]("__LivelyClassName__"),get:function(){return"Terminal"}},
{key:"open",value:function(){var W=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},T=new this(W);W=T.openInWindow({name:"ShellTerminal window",title:W.title||"Terminal"});T.whenRendered().then(function(){return T.focus()});return W}},{key:"runCommand",value:function(W,T){var ia=this.open(T);ia.targetMorph.runCommand(W,T);return ia}},{key:"forCommand",value:function(W,T){return this.open(Object.assign({command:W},T))}},{key:"findOrCreateForCommand",value:function(W){var T=zb.World.defaultWorld();
return zb.arr.grep(T.submorphs,/ShellTerminal window/).find(function(ia){return ia.targetMorph.command&&ia.targetMorph.command.pid===W.pid})||this.forCommand(W)}},{key:"properties",get:function(){return{title:{defaultValue:"Terminal"},name:{defaultValue:"terminal"},extent:{defaultValue:zb.pt(600,300)},lastFocused:{defaultValue:"input"},submorphs:{initialize:function(){this.submorphs=[Object.assign({type:"text",name:"output",lineWrapping:!1,textString:""},this.defaultStyle),new zb.InputLine(Object.assign({},
this.defaultStyle,{name:"input",textString:"",clearOnInput:!0,historyId:"lively.shell-terminal-input-history",border:{width:1,color:zb.Color.gray},plugins:[new zb.ShellEditorPlugin,new zb.EditorPlugin],clipMode:"hidden"})),{type:"button",name:"changeCwdButton",label:"cwd...",extent:zb.pt(60,20),borderRadius:3,fontSize:12,master:zb.DarkButton,padding:zb.Rectangle.inset(4,2)}];var W=this.ui,T=W.changeCwdButton;zb.connect(W.input,"inputAccepted",this,"execCommand",{updater:function(ia,ka){return ia("[shell terminal] run command or send input",
{command:ka})}});zb.connect(this,"extent",T,"topRight",{converter:function(ia){return ia.withY(0).addXY(-5,5)}});zb.connect(T,"fire",this,"execCommand",{converter:function(){return"[shell] change working directory"}});this.layout=new zb.GridLayout({grid:[["output"],["input"]],rows:[1,{fixed:25}],groups:{output:{align:"topLeft",resize:!0},input:{align:"topLeft",resize:!0}}})}},ui:{derived:!0,readOnly:!0,after:["submorphs"],get:function(){var W=Jc(this.submorphs,3);return{output:W[0],input:W[1],changeCwdButton:W[2]}}},
command:{derived:!0,after:["shellPlugin"],get:function(){return this.shellPlugin.command},set:function(W){if(this.command&&this.command.isRunning())throw Error("".concat(this.command," still running"));this.shellPlugin.command=W;W.stdout&&this.addOutput(W.stdout);W.stdout&&this.addOutput(W.stderr);zb.connect(W,"stdout",this,"addOutput");zb.connect(W,"stderr",this,"addOutput");zb.connect(W,"error",this,"addOutput");zb.connect(W,"pid",this,"updateWindowTitle");zb.connect(W,"close",this,"updateWindowTitle");
zb.connect(W,"close",this,"updateTextMode");this.updateWindowTitle();this.updateTextMode()}},cwd:{derived:!0,after:["shellPlugin"],get:function(){return this.shellPlugin.cwd},set:function(W){return this.shellPlugin.cwd=W}},shellPlugin:{derived:!0,readOnly:!0,after:["submorphs"],get:function(){var W=this.ui.input,T=W.pluginFind(function(ia){return ia.isShellEditorPlugin});if(T)return T;T=W.addPlugin(new zb.ShellEditorPlugin);zb.connect(T,"cwd",this.ui.changeCwdButton,"label");return T}},input:{derived:!0,
after:["submorphs"],set:function(W){this.ui.input.input=W},get:function(){return this.ui.input.input}}}}}],ib,{pathInPackage:function(){return"./shell/terminal.js"},unsubscribeFromToplevelDefinitionChanges:function(){return function(){}},subscribeToToplevelDefinitionChanges:function(){return function(){}},"package":function(){return{name:"lively.ide",version:"0.1.0"}}},{start:878,end:12474})}(zb.Morph));zb["default"]=Sb}}});