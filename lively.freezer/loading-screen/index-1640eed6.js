System.register(["./__root_module__-c4d7431e.js","kld-intersections"],function(ta){var nb,Bb,Vb,Qb,Dd,Ic,ud,Nc,Jc,Xc,id,Fd,nd;return{setters:[function(Yc){nb=Yc.bt;Bb=Yc.a5;Vb=Yc.r;Qb=Yc.a6;Dd=Yc.bn;Ic=Yc.bu;ud=Yc.bv;Nc=Yc.T;Jc=Yc.s;Xc=Yc.bw;id=Yc.bx;Fd=Yc.n;nd=Yc.by},function(){}],execute:function(){function Yc(I){try{var T=eval("("+da.ast.transform.wrapInFunction("var _; _ = ("+I+")")+")()")}catch(ua){return JSON.parse(I)}return"object"!==typeof T?null:T}function Ta(I,T){var ua,Da,Lb,ub,Ja,
Rb,Mc,Rc,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){switch(Ga.nextAddress){case 1:return ua=T.world(),Ga.yield(ua.prompt("Enter package name",{requester:T,input:"",historyId:"lively.vm-editor-add-package-name",useLastInput:!0}),2);case 2:Da=Ga.yieldResult;if(!Da)throw"Canceled";Ga.setCatchFinallyBlocks(3);ub=qa.resource(Da);Da=ub.name();Lb=ub.url;Ga.leaveTryBlock(4);break;case 3:return Ga.enterCatchBlock(),Ga.yield(I.getConfig(),5);case 5:return Ja=Ga.yieldResult.baseURL,Rb=
qa.resource(Ja).join(Da).asDirectory().url,Ga.yield(I.normalize(Rb),6);case 6:Lb=Ga.yieldResult.replace(/\/\.js$/,"/");case 4:return Ga.yield(ua.prompt("Confirm or change package location",{requester:T,input:Lb,historyId:"lively.vm-editor-add-package-address"}),7);case 7:Mc=Ga.yieldResult;if(!Mc)throw"Canceled";Rc=qa.resource(Mc).asDirectory();yc=Rc.asFile().url;return Ga.yield(I.removePackage(yc),8);case 8:return Ga.yield(I.resourceCreateFiles(yc,{"index.js":"'format esm';\n","package.json":'{\n  "name": "'+
Da+'",\n  "version": "0.1.0"\n}',".gitignore":"node_modules/","README.md":"# "+Da+"\n\nNo description for package "+Da+" yet.\n",tests:{"test.js":'import { expect } from "mocha-es6";\ndescribe("'+Da+'", () => {\n  it("works", () => {\n    expect(1 + 2).equals(3);\n  });\n});'}}),9);case 9:return Ga.return(qa.loadPackage(I,{name:Da,address:yc,configFile:Rc.join("package.json").url,main:Rc.join("index.js").url,test:Rc.join("tests/test.js").url,type:"package"}))}})}function sb(I,T,ua){ua=void 0===ua?
null:ua;var Da,Lb,ub,Ja,Rb,Mc,Rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:return Da={name:"",address:"",type:"package"},yc.yield(I.getConfig(),2);case 2:Lb=yc.yieldResult;if(!ua){yc.jumpTo(3);break}return yc.yield(I.getPackage(ua),4);case 4:if(ub=yc.yieldResult){yc.jumpTo(5);break}return yc.yield(I.getPackageForModule(ua),6);case 6:ub=yc.yieldResult;case 5:Ja=ub;case 3:return yc.yield(T.world().prompt("What is the package directory?",{requester:T,
input:Ja?Ja.address:Lb.baseURL,historyId:"lively.vm-editor-package-load-history",useLastInput:!1}),7);case 7:Rb=yc.yieldResult;if(!Rb)throw"Canceled";Da.address=Rb.replace(/\/$/,"");Da.url=new URL(Da.address+"/");Da.configFile=qa.resource(Da.url).join("package.json").url;yc.setCatchFinallyBlocks(8);Mc=JSON;Rc=Mc.parse;return yc.yield(I.moduleRead(Da.configFile),10);case 10:Rc.call(Mc,yc.yieldResult).name;yc.leaveTryBlock(9);break;case 8:yc.enterCatchBlock(),Da.name=String(Da.url).replace(/\/$/,""),
I.resourceEnsureExistance(Da.configFile,'{\n  "name": "'+Da.name+'",\n  "version": "0.1.0"\n}');case 9:return yc.return(qa.loadPackage(I,Da))}})}function dc(I,T,ua){var Da,Lb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Da=qa.resource(ua).asFile().url,Ja.yield(I.getPackage(Da),2);case 2:if(Lb=Ja.yieldResult){Ja.jumpTo(3);break}return Ja.yield(I.getPackageForModule(Da),4);case 4:Lb=Ja.yieldResult;case 3:ub=Lb;if(!ub)throw Error("Cannot find package for "+
Da);return Ja.yield(I.reloadPackage(Da),5);case 5:if(!T){Ja.jumpTo(0);break}return Ja.yield(T.updateModuleList(),7);case 7:return Ja.yield(T.uiSelect(Da,!1),8);case 8:return Ja.return(Ja.yieldResult)}})}function ac(I,T,ua,Da){var Lb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(I.getPackage(ua),2);case 2:return Lb=Ja.yieldResult,Ja.yield((Da||$world).confirm("Unload package "+Lb.name+"?",{requester:T}),3);case 3:ub=Ja.yieldResult;
if(!ub)throw"Canceled";return Ja.yield(I.removePackage(ua),4);case 4:if(!T){Ja.jumpTo(0);break}return Ja.yield(T.updateModuleList(),6);case 6:return Ja.yield(T.uiSelect(null),0)}})}function Vc(I,T,ua){var Da,Lb,ub,Ja,Rb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Mc){switch(Mc.nextAddress){case 1:return Da=T.world(),Mc.yield(I.getPackage(ua),2);case 2:return Lb=Mc.yieldResult,Lb?Mc.yield(Da.confirm("Really remove package "+Lb.name+"?",{requester:T}),3):($world.inform('No package "'+
ua+'" found!',{requester:T}),Mc.return());case 3:ub=Mc.yieldResult;if(!ub)throw"Canceled";I.removePackage(ua);return Mc.yield(Da.confirm("Also remove directory "+Lb.name+" including "+Lb.modules.length+" modules?"),4);case 4:Ja=Mc.yieldResult;if(!Ja){Mc.jumpTo(0);break}return Mc.yield(Da.confirm("REALLY *remove* directory "+Lb.name+"? No undo possible..."),6);case 6:if(Rb=Mc.yieldResult)return Mc.yield(I.resourceRemove(Lb.address),0);Mc.jumpTo(0)}})}function Hd(I,T,ua){ua=void 0===ua?$world:ua;var Da,
Lb,ub,Ja,Rb,Mc,Rc,yc,Ga,qc,Za;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Pa){switch(Pa.nextAddress){case 1:return Pa.yield(I.getPackage(T),2);case 2:Da=Pa.yieldResult;if(!Da)throw Error("Cannot find package "+T);Lb=[];ub=$jscomp.makeIterator(Da.modules);Ja=ub.next();case 3:if(Ja.done)return Pa.yield(ua.execCommand("open text window",{title:"imports and exports of "+T,content:Lb.join("\n\n")}),0);Rb=Ja.value;if(!Rb.name.match(/\.js$/)){Pa.jumpTo(4);break}Pa.setCatchFinallyBlocks(6);
Mc=I;Rc=Mc.importsAndExportsOf;yc=Rb.name;return Pa.yield(I.moduleRead(Rb.name),9);case 9:return Pa.yield(Rc.call(Mc,yc,Pa.yieldResult),8);case 8:Ga=Pa.yieldResult;Pa.leaveTryBlock(7);break;case 6:qc=Pa.enterCatchBlock();ua.logError(Error("Error when getting imports/exports from module "+Rb.name+":\n"+qc.stack));Pa.jumpTo(4);break;case 7:Za=""+Rb.name;if(!Ga.imports.length&&!Ga.exports.length){Za+="\n  does not import / export anything";Pa.jumpTo(4);break}Ga.imports.length&&(Za+="\n  imports:\n",
Za+=qa.arr.groupByKey(Ga.imports,"fromModule").mapGroups(function(Qa,Hb){return"from "+Qa+": "+Hb.map(function(Gb){return Gb.local||Gb.imported?Gb.imported&&Gb.imported!==Gb.local?Gb.imported+" as "+Gb.local:Gb.local:"nothing imported"}).join(", ")}).toArray().join("\n").split("\n").map(function(Qa){return"    "+Qa}).join("\n"));Ga.exports.length&&(Za+="\n  exports:\n",Za+=Ga.exports.map(function(Qa){return Qa.local?Qa.local&&Qa.local!==Qa.exported?Qa.local+" as "+Qa.exported:Qa.exported:Qa.exported+
" from "+Qa.fromModule}).join(", ").split("\n").map(function(Qa){return"    "+Qa}).join("\n"));Lb.push(Za);case 4:Ja=ub.next(),Pa.jumpTo(3)}})}function hc(I,T,ua){ua=ua&&ua.address;if(ua&&0===T.indexOf(ua))var Da=T.slice(ua.length).replace(/^\//,"");else a:{ua=I.getConfig();if(!ua||ua.constructor!==Promise)try{Da=String((new URL(T)).relativePathFrom(new URL(I.getConfig().baseURL)));break a}catch(Lb){}Da=T}return Da}function kc(I,T,ua,Da){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lb){return 1==
Lb.nextAddress?(Da=Object.assign({targetModule:T},Da),Lb.yield(I.normalize(T),2)):3!=Lb.nextAddress?(T=Lb.yieldResult,Lb.yield(I.moduleSourceChange(T,ua,Da),3)):Lb.return(T)})}function xb(I,T,ua,Da,Lb){Da=void 0===Da?!1:Da;Lb=void 0===Lb?!1:Lb;var ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return T&&T.setStatusMessage("Reloading "+ua),Ja.setCatchFinallyBlocks(2),Ja.yield(I.reloadModule(ua,{reloadDeps:Da,resetEnv:Lb}),4);case 4:if(!T){Ja.jumpTo(5);
break}return Ja.yield(T.updateModuleList(),6);case 6:case 5:T&&T.setStatusMessage("Reloded "+ua);Ja.leaveTryBlock(0);break;case 2:ub=Ja.enterCatchBlock();Ja.setCatchFinallyBlocks(7);if(!T){Ja.jumpTo(9);break}return Ja.yield(T.updateEditorWithSourceOf(ua),10);case 10:case 9:Ja.leaveTryBlock(8);break;case 7:Ja.enterCatchBlock();case 8:throw T&&T.showError(ub),ub;}})}function yb(I,T,ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){switch(Da.nextAddress){case 1:return Da.yield(I.forgetModule(ua,
{forgetEnv:!0,forgetDeps:!0}),2);case 2:if(!T){Da.jumpTo(3);break}return Da.yield(T.updateModuleList(),4);case 4:case 3:Da.jumpToEnd()}})}function wc(I,T,ua){var Da,Lb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){switch(Ja.nextAddress){case 1:return Ja.yield(I.normalize(ua),2);case 2:return Da=Ja.yieldResult,Ja.yield(T.world().confirm("Remove file "+Da+"?",{requester:T}),3);case 3:Lb=Ja.yieldResult;if(!Lb)throw"Canceled";return Ja.yield(I.forgetModule(Da),4);case 4:return Ja.yield(I.resourceRemove(Da),
5);case 5:return Ja.yield(I.getPackageForModule(Da),6);case 6:return ub=Ja.yieldResult,Ja.return(ub)}})}function Kc(I,T,ua){var Da,Lb,ub,Ja,Rb,Mc,Rc,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){switch(Ga.nextAddress){case 1:return Da=URL,Ga.yield(I.getConfig(),2);case 2:Lb=new Da(Ga.yieldResult.baseURL);ub=T.world();if(!ua){Ga.jumpTo(3);break}return Ga.yield(I.getPackage(ua),4);case 4:if(Ja=Ga.yieldResult){Ga.jumpTo(5);break}return Ga.yield(I.getPackageForModule(ua),6);case 6:Ja=
Ga.yieldResult;case 5:(Rb=Ja)&&(Lb=new URL(Rb.address));case 3:return Ga.yield(Va._searchForExistingFiles(T,String(Lb),Rb),7);case 7:Mc=Ga.yieldResult;if(!Mc.includes("[create new module]")){Ga.jumpTo(8);break}return Ga.yield(Va._askForModuleName(I,ua||String(Lb),ub),9);case 9:Rc=Ga.yieldResult,Mc=[Rc];case 8:return Ga.yield(Va._createAndLoadModules(I,Mc),10);case 10:return yc=Ga.yieldResult,Va.arr.compact(yc.map(function(qc){return qc.error})),Ga.return(yc)}})}function zb(I,T){var ua,Da,Lb,ub,Ja,
Rb,Mc,Rc,yc,Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qc){if(1==qc.nextAddress)return qc.yield(I.getPackage(T),2);if(3!=qc.nextAddress){ua=qc.yieldResult;if(!ua||!ua.address.match(/^http/))throw Error("Cannot load package "+T);Da=Va.resource(ua.address);Lb=[];ub=$jscomp;Ja=ub.makeIterator;return qc.yield(Da.dirList(5,{exclude:Va.modulesInPackage_defaultExclude}),3)}Rb=Ja.call(ub,qc.yieldResult);for(Mc=Rb.next();!Mc.done;Mc=Rb.next())yc=Rc=Mc.value,Ga=yc.url,Ga.match(/\.js$/)&&
I.isModuleLoaded(Ga,!0)&&Lb.push(I.getModule(Ga));return qc.return(Lb)})}function ab(I,T){T=void 0===T?[]:T;var ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){if(1==Da.nextAddress)return Da.yield(System.import("mocha-es6/index.js"),2);ua=Da.yieldResult;return Da.return(ua.loadTestModuleAndExtractTestState(I,T))})}function Kb(I,T,ua,Da){function Lb(qc){return new Promise(function(Za,Pa){var Qa=cb.arr.compact(qc.suite.suites).map(function(Gb){return Gb.file}),Hb=cb.chain(T).filter(function(Gb){return Qa.includes(Gb.file)}).pluck("tests").flatten().value();
if(!Hb||!Hb.length)return Pa(Error("Trying to run tests of "+Qa.join(", ")+" but cannot find them in loaded tests!"));qc.reporter(function(Gb){Gb.on("test",function(ad){try{var Td=Hb.find(function(Zd){return Zd.fullTitle===ad.fullTitle()});Td.state="running";"function"===typeof ua&&ua(Td,"test")}catch(Zd){"function"===typeof Da&&Da(Zd,"test")}});Gb.on("pass",function(ad){try{var Td=Hb.find(function(Zd){return Zd.fullTitle===ad.fullTitle()});Td.state="succeeded";Td.duration=ad.duration;"function"===
typeof ua&&ua(Td,"pass")}catch(Zd){"function"===typeof Da&&Da(Zd,"pass")}});Gb.on("fail",function(ad,Td){try{var Zd=function(Md,fd,Ib){Md.state="failed";Md.duration=Md.duration;Md.error=fd},Ue=Hb.find(function(Md){return Md.fullTitle===ad.fullTitle()});if(Ue)Zd(Ue,Td,ad.duration);else{var Fc=cb.arr.invoke(ad.parent.tests,"fullTitle");Hb.filter(function(Md){return Fc.includes(Md.fullTitle)}).forEach(function(Md){return Zd(Md,Td,ad.duration)})}"function"===typeof ua&&ua(Ue,"fail")}catch(Md){"function"===
typeof Da&&Da(Md,"fail")}})});qc.run(function(Gb){return Za({testsByFile:T,mocha:qc})})})}var ub,Ja,Rb,Mc,Rc,yc,Ga;return $jscomp.asyncExecutePromiseGeneratorProgram(function(qc){switch(qc.nextAddress){case 1:ub=$jscomp.makeIterator(T),Ja=ub.next();case 2:if(Ja.done){qc.jumpTo(4);break}Mc=Rb=Ja.value;Rc=Mc.file;return qc.yield(cb.loadMochaTestFile(Rc,T),5);case 5:return yc=qc.yieldResult,Ga=yc.mocha,I&&(Ga=Ga.grep(I)),qc.yield(Lb(Ga),3);case 3:Ja=ub.next();qc.jumpTo(2);break;case 4:return qc.return({mocha:Ga,
testsByFile:T})}})}function nc(I){I||(I="local");if(I.isSystemInterface)var T=I;else"string"===typeof I&&I.startsWith("l2l ")&&(I={type:"l2l",id:I.split(" ")[1]}),"string"!==typeof I&&"l2l"===I.type&&(T=xc.l2lInterfaceFor(I.id,I.info)),"string"!==typeof I&&($world.setStatusMessage("Unknown system interface "+I),I="local"),T||(T=I&&"local"!==I?xc.serverInterfaceFor(I):xc.localInterface);return T}ta("systemInterfaceNamed",nc);var da=lively.FreezerRuntime.recorderFor("lively-system-interface/helpers.js");
da.parseJsonLikeObj=Yc;da.ast=nb;da.parseJsonLikeObj=Yc;da.parseJsonLikeObj=Yc;var qa=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/packages.js");qa.loadPackage=function(I,T){var ua,Da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lb){switch(Lb.nextAddress){case 1:return Lb.yield(I.importPackage(T.address+"/"),2);case 2:if(!T.main){Lb.jumpTo(3);break}return Lb.yield(I.importModule(T.main.toString()),3);case 3:if(!T.test){Lb.jumpTo(5);break}Lb.setCatchFinallyBlocks(6);
return Lb.yield(I.importPackage("mocha-es6"),8);case 8:return ua=Lb.yieldResult,Lb.yield(ua.installSystemInstantiateHook(),9);case 9:return Lb.yield(I.importModule(T.test.toString()),10);case 10:Lb.leaveTryBlock(5);break;case 6:Da=Lb.enterCatchBlock(),console.warn("Cannot load test of new package: "+Da);case 5:return Lb.return(I.getPackage(T.address))}})};qa.interactivelyCreatePackage=Ta;qa.interactivelyLoadPackage=sb;qa.interactivelyReloadPackage=dc;qa.interactivelyUnloadPackage=ac;qa.interactivelyRemovePackage=
Vc;qa.showExportsAndImportsOf=Hd;qa.parseJsonLikeObj=Yc;qa.arr=Bb;qa.resource=Vb;qa.interactivelyCreatePackage=Ta;qa.interactivelyCreatePackage=Ta;qa.interactivelyLoadPackage=sb;qa.interactivelyLoadPackage=sb;qa.interactivelyReloadPackage=dc;qa.interactivelyReloadPackage=dc;qa.interactivelyUnloadPackage=ac;qa.interactivelyUnloadPackage=ac;qa.interactivelyRemovePackage=Vc;qa.interactivelyRemovePackage=Vc;qa.showExportsAndImportsOf=Hd;qa.showExportsAndImportsOf=Hd;var Va=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/modules.js");
Va.shortModuleName=hc;Va.interactivelyChangeModule=kc;Va.interactivelyReloadModule=xb;Va.interactivelyUnloadModule=yb;Va.interactivelyRemoveModule=wc;Va.interactivelyAddModule=Kc;Va._askForModuleName=function(I,T,ua){var Da,Lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){switch(ub.nextAddress){case 1:return ub.yield(ua.prompt("Enter module name",{input:T,historyId:"lively.vm-editor-add-module-name"}),2);case 2:T=ub.yieldResult;if(!T)throw"Canceled";return ub.yield(I.normalize(T),
3);case 3:return Da=ub.yieldResult,ub.yield(ua.confirm(["Create module \n",{},Da,{fontStyle:"italic"}," ?",{}],{lineWrapping:!1}),4);case 4:Lb=ub.yieldResult;if(!Lb)throw"Canceled";return ub.return(Da)}})};Va._searchForExistingFiles=function(I,T,ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return String(T).match(/^http/)?Da.return(Va._searchForExistingFilesWeb(I,T,ua)):Da.return(Va._searchForExistingFilesManually(I,T,ua))})};Va._searchForExistingFilesManually=function(I,T,ua){var Da,
Lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){switch(ub.nextAddress){case 1:return ub.yield(I.world().multipleChoicePrompt("Add Module",{requester:I,choices:["Create New Module","Load Existing Module"]}),2);case 2:Da=ub.yieldResult;if("Create New Module"===Da)return ub.return("[create new module]");if("Load Existing Module"!==Da){ub.jumpTo(3);break}return ub.yield(I.world().prompt("URL of module?",{input:T,requester:I,historyId:"lively.vm._searchForExistingFilesManually.url-of-module"}),
4);case 4:if(Lb=ub.yieldResult)return ub.return([Lb]);case 3:throw"Canceled";}})};Va._searchForExistingFilesWeb=function(I,T,ua){function Da(yc){yc.name();return[".git","node_modules",".optimized-loading-cache",".module_cache"].includes(yc.name())||ua&&Va.arr.pluck(ua.modules,"name").includes(yc.url)?!0:!1}var Lb,ub,Ja,Rb,Mc,Rc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(yc){switch(yc.nextAddress){case 1:return(Lb=I.world())&&(ub=Lb.showLoadingIndicatorFor(I,"Loading existing modules...")),
yc.yield(Va.resource(T).dirList(5,{exclude:Da}),3);case 3:return yc.yield(yc.yieldResult.map(function(Ga){return Ga.url}),2);case 2:return Ja=yc.yieldResult,Rb=[{isListItem:!0,string:"[create new module]",value:"[create new module]"}].concat(Ja.filter(function(Ga){return Ga.endsWith(".js")}).map(function(Ga){return{isListItem:!0,string:ua&&0==Ga.indexOf(ua.address)?ua.name+Ga.slice(ua.address.length):Ga,value:Ga}})),yc.yield(Promise.resolve(ub&&ub.remove()).then(function(){return I.world().filterableListPrompt("What module to load?",
Rb,Object.assign({filterLabel:"filter: ",multiselect:!0,requester:I},I?{extent:I.bounds().extent().withY(400).subXY(50,0)}:{}))}),4);case 4:Mc=yc.yieldResult;if(!Mc||"canceled"===Mc.status||!Mc.selected.length)throw"Canceled";Rc=Mc.selected||Mc;Array.isArray(Rc)||(Rc=[Rc]);return yc.return(Rc)}})};Va._createAndLoadModules=function(I,T){var ua,Da,Lb,ub,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){switch(Rb.nextAddress){case 1:Array.isArray(T)||(T=[T]),ua=[],Da=$jscomp.makeIterator(T),
Lb=Da.next();case 2:if(Lb.done){Rb.jumpTo(4);break}ub=Lb.value;return Rb.yield(I.forgetModule(ub,{forgetDeps:!1,forgetEnv:!1}),5);case 5:return Rb.yield(I.resourceEnsureExistance(ub,'"format esm";\n'),6);case 6:return Rb.setCatchFinallyBlocks(7),Rb.yield(I.importModule(ub),9);case 9:ua.push({name:ub});Rb.leaveTryBlock(3);break;case 7:Ja=Rb.enterCatchBlock(),ua.push({name:ub,error:Ja});case 3:Lb=Da.next();Rb.jumpTo(2);break;case 4:return Rb.return(ua)}})};Va.modulesInPackage_defaultExclude=function(I){return[".git",
"node_modules",".optimized-loading-cache",".module_cache"].includes(I.name())?!0:!1};Va.modulesInPackage=zb;Va.obj=Qb;Va.arr=Bb;Va.resource=Vb;Va.shortModuleName=hc;Va.shortModuleName=hc;Va.interactivelyChangeModule=kc;Va.interactivelyChangeModule=kc;Va.interactivelyReloadModule=xb;Va.interactivelyReloadModule=xb;Va.interactivelyUnloadModule=yb;Va.interactivelyUnloadModule=yb;Va.interactivelyRemoveModule=wc;Va.interactivelyRemoveModule=wc;Va.interactivelyAddModule=Kc;Va.interactivelyAddModule=Kc;
Va.modulesInPackage=zb;Va.modulesInPackage=zb;var cb=lively.FreezerRuntime.recorderFor("lively-system-interface/commands/mocha-tests.js");cb.loadMochaTestFile=ab;cb.runMochaTests=Kb;cb.arr=Bb;cb.chain=Dd;cb.loadMochaTestFile=ab;cb.loadMochaTestFile=ab;cb.runMochaTests=Kb;cb.runMochaTests=Kb;var kb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/interface.js");kb.todo=function(I){throw Error(I+" is not yet implemented!");};kb.parseJsonLikeObj=Yc;kb.arr=Bb;kb.Closure=Ic;kb.obj=
Qb;kb.resource=Vb;kb.transform=ud;kb.modules=Nc;var Ma=function(){};Ma.prototype.dynamicCompletionsForPrefix=function(I,T,ua){return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){kb.todo("dynamicCompletionsForPrefix");Da.jumpToEnd()})};Ma.prototype.runEval=function(I,T){kb.todo("runEval")};Ma.prototype.resourceExists=function(I){kb.todo("resourceExists")};Ma.prototype.resourceEnsureExistance=function(I,T){kb.todo("resourceEnsureExistance")};Ma.prototype.resourceMkdir=function(I){kb.todo("resourceMkdir")};
Ma.prototype.resourceRead=function(I){kb.todo("resourceRead")};Ma.prototype.resourceRemove=function(I){kb.todo("resourceRemove")};Ma.prototype.resourceWrite=function(I,T){kb.todo("resourceWrite")};Ma.prototype.resourceCreateFiles=function(I,T){kb.todo("resourceCreateFiles")};Ma.prototype.resourceDirList=function(I,T,ua){kb.todo("resourceDirList")};Ma.prototype.normalizeSync=function(I,T,ua){kb.todo("normalizeSync")};Ma.prototype.normalize=function(I,T,ua){kb.todo("normalize")};Ma.prototype.printSystemConfig=
function(){kb.todo("printSystemConfig")};Ma.prototype.getConfig=function(){kb.todo("getConfig")};Ma.prototype.setConfig=function(I){kb.todo("setConfig")};Ma.prototype.getPackages=function(I){kb.todo("getPackages")};Ma.prototype.isModuleLoaded=function(I,T){kb.todo("isModuleLoaded")};Ma.prototype.doesModuleExist=function(I,T){kb.todo("doesModuleExist")};Ma.prototype.getModules=function(){var I=this,T,ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return 1==Da.nextAddress?(T=kb.arr,
ua=T.flatmap,Da.yield(I.getPackages(),2)):Da.return(ua.call(T,Da.yieldResult,function(Lb){return Lb.modules}))})};Ma.prototype.getModule=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return 1==ua.nextAddress?ua.yield(T.getModules(),2):ua.return(ua.yieldResult.find(function(Da){return Da.name===I}))})};Ma.prototype.getPackage=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return 1==ua.nextAddress?(I=I.replace(/\/+$/,""),
ua.yield(T.getPackages(),2)):ua.return(ua.yieldResult.find(function(Da){return Da.address===I||Da.name===I}))})};Ma.prototype.getPackageForModule=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){kb.todo("getPackageForModule");T.jumpToEnd()})};Ma.prototype.systemConfChange=function(I){var T=kb.parseJsonLikeObj(I);["baseURL"].forEach(function(ua){return delete T[ua]});return this.setConfig(T)};Ma.prototype.resourcesOfPackage=function(I,T){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){kb.todo("resourcesOfPackage");
ua.jumpToEnd()})};Ma.prototype.registerPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){kb.todo("registerPackage");T.jumpToEnd()})};Ma.prototype.importPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){kb.todo("importPackage");T.jumpToEnd()})};Ma.prototype.removePackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){kb.todo("removePackage");T.jumpToEnd()})};Ma.prototype.reloadPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){kb.todo("reloadPackage");
T.jumpToEnd()})};Ma.prototype.packageConfChange=function(I,T){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){kb.todo("packageConfChange");ua.jumpToEnd()})};Ma.prototype.importModule=function(I){kb.todo("importModule")};Ma.prototype.forgetModule=function(I,T){kb.todo("forgetModule")};Ma.prototype.reloadModule=function(I,T){kb.todo("reloadModule")};Ma.prototype.moduleFormat=function(I){kb.todo("moduleFormat")};Ma.prototype.moduleRead=function(I){kb.todo("moduleRead")};Ma.prototype.moduleSourceChange=
function(I,T,ua){kb.todo("moduleSourceChange")};Ma.prototype.importsAndExportsOf=function(I,T){kb.todo("importsAndExportsOf")};Ma.prototype.keyValueListOfVariablesInModule=function(I,T){kb.todo("keyValueListOfVariablesInModule")};Ma.prototype.moduleWrite=function(I,T){return this.moduleSourceChange(I,T)};kb.AbstractCoreInterface=Ma;var Oa=function(){var I=kb.AbstractCoreInterface.call(this)||this;I.currentEval=null;return I};$jscomp.inherits(Oa,kb.AbstractCoreInterface);Oa.prototype.runEval=function(I,
T){throw Error("Not yet implemented");};Oa.prototype.runEvalAndStringify=function(I,T){var ua=this;return this.currentEval?this.currentEval.then(function(){return ua.runEvalAndStringify(I,T)}):this.currentEval=Promise.resolve().then(function(){var Da,Lb,ub,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){switch(Rb.nextAddress){case 1:return Rb.yield(ua.runEval("\n        Promise.resolve((async "+kb.transform.wrapInFunction(I)+')())\n          .then(function(result) { return JSON.stringify(result); })\n          .catch(function(err) { return {isError: true, value: err}; })\n          .then(function(result) {\n            if (!result || typeof result === "string") return result;\n            return JSON.stringify(result.isError ?\n              {isError: true, value: (result.value + "\\n" + result.value.stack) || String(result.value)} :\n              result)\n          });',
Object.assign({targetModule:"lively://remote-lively-system/runEvalAndStringify",promiseTimeout:3E4,waitForPromise:!0},T)),2);case 2:if((Da=Rb.yieldResult)&&Da.isError)throw Error(String(Da.value||Da.error));if(!Da||!Da.value)return Rb.return(null);if(Lb=Da.promisedValue){Rb.jumpTo(3);break}return Rb.yield(Da.value,4);case 4:Lb=Rb.yieldResult;case 3:ub=Lb;if(!ub)return Rb.return();if("undefined"===ub)return Rb.return(void 0);if("null"===ub)return Rb.return(null);if("true"===ub)return Rb.return(!0);
if("false"===ub)return Rb.return(!1);try{Ja=JSON.parse(ub)}catch(Mc){return Rb.return(ub)}if(Ja&&Ja.isError)throw Error(String(Ja.value));return Rb.return(Ja)}})}).then(function(Da){delete ua.currentEval;return Da},function(Da){delete ua.currentEval;return Promise.reject(Da)})};Oa.prototype.dynamicCompletionsForPrefix=function(I,T,ua){var Da=this,Lb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){Lb=kb.obj.isString(ua.context)?ua.context:!1;ua=kb.obj.dissoc(ua,["systemInterface",
"System","context"]);ub="\n      var prefix = "+JSON.stringify(T)+",\n          opts = "+JSON.stringify(ua)+";\n      opts.context = "+Lb+';\n      opts.classTransform = (await System.import("lively.classes")).classToFunctionTransform;\n      var evalFn = code => lively.vm.runEval(code, opts);\n      if (typeof System === "undefined") delete opts.targetModule;\n      lively.vm.completions.getCompletions(evalFn, prefix).then(function(result) {\n        if (result.isError) throw result.value;\n        return {\n          completions: result.completions,\n          prefix: result.startLetters\n        }\n      });';
return Ja.return(Da.runEvalAndStringify(ub))})};Oa.prototype.evalWithResource=function(I,T,ua){return this.runEvalAndStringify('\n      var {resource} = (typeof lively !== "undefined" && lively.resources)\n                    || await System.import("lively.resources");\n      await resource("'+I+'").'+T+"("+(ua?JSON.stringify(ua):"")+");\n    ")};Oa.prototype.resourceExists=function(I){return this.evalWithResource(I,"exists")};Oa.prototype.resourceEnsureExistance=function(I,T){return this.evalWithResource(I,
"ensureExistance",T)};Oa.prototype.resourceMkdir=function(I){return this.evalWithResource(I,"mkdir")};Oa.prototype.resourceRead=function(I){return this.evalWithResource(I,"read")};Oa.prototype.resourceRemove=function(I){return this.evalWithResource(I,"remove")};Oa.prototype.resourceWrite=function(I,T){return this.evalWithResource(I,"write",T)};Oa.prototype.resourceCreateFiles=function(I,T){return this.runEvalAndStringify('var {createFiles} = await System.import("lively.resources"); await createFiles("'+
I+'", '+JSON.stringify(T)+")")};Oa.prototype.resourceDirList=function(I,T,ua){return this.runEvalAndStringify('\n      var {resource} = await System.import("lively.resources");\n      (await resource("'+I+'").dirList('+JSON.stringify(T)+", "+JSON.stringify(ua)+"))\n        .map(({url}) => ({url}))")};Oa.prototype.livelySystemAccessor=function(I){I=void 0===I?"livelySystem":I;return"var "+I+' = (typeof lively !== "undefined" && lively.systemInterface)\n      || System.get(System.decanonicalize("lively-system-interface"))\n      || (typeof lively !== "undefined" && lively.modules && await lively.modules.importPackage("lively-system-interface"));\n    if (!'+
I+') throw new Error("lively-system-interface not available!");'};Oa.prototype.normalizeSync=function(I,T,ua){return this.runEvalAndStringify("lively.modules.System.decanonicalize("+JSON.stringify(I)+", "+JSON.stringify(T)+", "+ua+")")};Oa.prototype.normalize=function(I,T,ua){return this.runEvalAndStringify("lively.modules.System.normalize("+JSON.stringify(I)+", "+JSON.stringify(T)+", "+JSON.stringify(ua)+")")};Oa.prototype.printSystemConfig=function(){return this.runEvalAndStringify("lively.modules.printSystemConfig()")};
Oa.prototype.getConfig=function(){return this.runEvalAndStringify('var c = Object.assign({}, lively.modules.System.getConfig()); for (var name in c) if (name.indexOf("__lively.modules__") === 0 || name.indexOf("loads") === 0) delete c[name]; c')};Oa.prototype.setConfig=function(I){return this.runEvalAndStringify("lively.modules.System.config("+JSON.stringify(I)+")")};Oa.prototype.getPackages=function(I){I=Object.assign({excluded:[]},I);I.excluded=I.excluded.map(String);return this.runEvalAndStringify("\n      "+
this.livelySystemAccessor()+";\n      var options = "+JSON.stringify(I)+';\n      options.excluded = options.excluded.map(ea => {\n        let evaled = lively.vm.syncEval(ea).value;\n        return typeof evaled === "function" ? evaled : ea;\n      });\n      await livelySystem.localInterface.getPackages(options)\n        .map(ea => Object.assign({}, ea, {System: null}));')};Oa.prototype.getPackageForModule=function(I){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.getPackageForModule("+
JSON.stringify(I)+")")};Oa.prototype.isModuleLoaded=function(I,T){return this.runEvalAndStringify('lively.modules.isModuleLoaded("'+I+'", '+T+")")};Oa.prototype.doesModuleExist=function(I,T){return this.runEvalAndStringify('lively.modules.doesModuleExist("'+I+'", '+T+")")};Oa.prototype.registerPackage=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return ua.return(T.runEvalAndStringify("lively.modules.registerPackage("+JSON.stringify(I)+")"))})};Oa.prototype.importPackage=
function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return ua.return(T.runEvalAndStringify("lively.modules.importPackage("+JSON.stringify(I)+")"))})};Oa.prototype.removePackage=function(I){var T=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return ua.return(T.runEvalAndStringify("lively.modules.removePackage("+JSON.stringify(I)+")"))})};Oa.prototype.reloadPackage=function(I,T){var ua=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return Da.return(ua.runEvalAndStringify("lively.modules.reloadPackage("+
JSON.stringify(I)+", "+JSON.stringify(T)+")"))})};Oa.prototype.packageConfChange=function(I,T){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.packageConfChange("+JSON.stringify(I)+", "+JSON.stringify(T)+")")};Oa.prototype.resourcesOfPackage=function(I,T){T=void 0===T?[".git","node_modules",".module_cache","lively.next-node_modules"]:T;var ua=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){I.address&&(I=I.address);
return Da.return(ua.runEvalAndStringify("\n      "+ua.livelySystemAccessor()+";\n      await livelySystem.localInterface.resourcesOfPackage("+JSON.stringify(I)+", "+JSON.stringify(T)+");"))})};Oa.prototype.getModule=function(I){var T=this,ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){if(1==Da.nextAddress)return Da.yield(T.getModules(),2);ua=Da.yieldResult.find(function(Lb){return Lb.name===I});return Da.return(ua?kb.modules.module(ua.name):null)})};Oa.prototype.importModule=function(I){return this.runEvalAndStringify("lively.modules.System.import("+
JSON.stringify(I)+")")};Oa.prototype.forgetModule=function(I,T){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").unload("+JSON.stringify(T)+")")};Oa.prototype.reloadModule=function(I,T){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").reload("+JSON.stringify(T)+")")};Oa.prototype.moduleFormat=function(I){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").format();")};Oa.prototype.moduleRead=function(I){return this.runEvalAndStringify("lively.modules.module("+
JSON.stringify(I)+").source()")};Oa.prototype.moduleSourceChange=function(I,T,ua){return this.runEvalAndStringify("lively.modules.module("+JSON.stringify(I)+").changeSource("+JSON.stringify(T)+", "+JSON.stringify(ua)+")")};Oa.prototype.keyValueListOfVariablesInModule=function(I,T){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.keyValueListOfVariablesInModule("+JSON.stringify(I)+", "+JSON.stringify(T)+")")};Oa.prototype.importsAndExportsOf=
function(I,T){return this.runEvalAndStringify("({\n      imports: await lively.modules.module("+JSON.stringify(I)+").imports(),\n      exports: await lively.modules.module("+JSON.stringify(I)+").exports()})")};Oa.prototype.exportsOfModules=function(I){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+"\n      const options = "+JSON.stringify(I)+";\n      options.excludedPackages = ["+I.excludedPackages.map(function(T){return"function"===typeof T?T.toString():JSON.stringify(T)}).join(",")+
"]\n      await livelySystem.localInterface.exportsOfModules(options)")};Oa.prototype.searchInPackage=function(I,T,ua){return this.runEvalAndStringify("\n      "+this.livelySystemAccessor()+";\n      await livelySystem.localInterface.searchInPackage("+JSON.stringify(I)+", "+JSON.stringify(T)+", "+JSON.stringify(ua)+")")};Oa.prototype.loadMochaTestFile=function(I,T){T=void 0===T?[]:T;var ua=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return Da.return(ua.runEvalAndStringify("\n      "+
ua.livelySystemAccessor()+";\n      var {testsByFile} = await livelySystem.localInterface.loadMochaTestFile("+JSON.stringify(I)+", "+JSON.stringify(T)+"), result;\n      result = {testsByFile}"))})};Oa.prototype.runMochaTests=function(I,T,ua,Da){var Lb=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){I&&I instanceof RegExp&&(I={isRegExp:!0,value:String(I).replace(/^\/|\/$/g,"")});return ub.return(Lb.runEvalAndStringify("\n      var grep = "+JSON.stringify(I)+";\n      if (grep && grep.isRegExp) grep = new RegExp(grep.value);\n      "+
Lb.livelySystemAccessor()+";\n      var {testsByFile, isError, value: error} = await livelySystem.localInterface.runMochaTests(grep, "+JSON.stringify(T||[])+"), result;\n      error = error ? String(error.stack || error) : null;\n      if (testsByFile) {\n        testsByFile.forEach(ea =>\n          ea.tests.forEach(ea => {\n            if (!ea.error) return;\n            var {message, stack, actual, expected} = ea.error;\n            ea.error = {\n              message: message || String(ea.error),\n              stack: stack,\n              actual, exected\n            }\n          }));\n      }\n      result = {testsByFile, isError, error}"))})};
kb.RemoteCoreInterface=Oa;var lb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/local-system.js");lb.obj=Qb;lb.string=Jc;lb.arr=Bb;lb.resource=Vb;lb.createFiles=Xc;lb.ast=nb;lb.modules=Nc;lb.vm=id;lb.loadMochaTestFile=ab;lb.runMochaTests=Kb;lb.parseJsonLikeObj=Yc;lb.AbstractCoreInterface=Ma;lb.classToFunctionTransform=Fd;Ma=function(){return lb.AbstractCoreInterface.apply(this,arguments)||this};$jscomp.inherits(Ma,lb.AbstractCoreInterface);Ma.prototype.dynamicCompletionsForPrefix=
function(I,T,ua){var Da;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Lb){if(1==Lb.nextAddress)return Lb.yield(lb.vm.completions.getCompletions(function(ub){return lb.vm.runEval(ub.replace("return ",""),Object.assign({targetModule:I,classTransform:lb.classToFunctionTransform},ua))},T),2);Da=Lb.yieldResult;if(Da.isError)throw Da.value;return Lb.return({completions:Da.completions,prefix:Da.startLetters})})};Ma.prototype.runEval=function(I,T){return lb.vm.runEval(I,Object.assign({classTransform:lb.classToFunctionTransform},
T))};Ma.prototype.resourceExists=function(I){return lb.resource(I).exists()};Ma.prototype.resourceEnsureExistance=function(I,T){return lb.resource(I).ensureExistance(T)};Ma.prototype.resourceMkdir=function(I){return lb.resource(I).mkdir()};Ma.prototype.resourceRead=function(I){return lb.resource(I).read()};Ma.prototype.resourceRemove=function(I){return lb.resource(I).remove()};Ma.prototype.resourceWrite=function(I,T){return lb.resource(I).write(T)};Ma.prototype.resourceCreateFiles=function(I,T){return lb.createFiles(I,
T)};Ma.prototype.resourceDirList=function(I,T,ua){return lb.resource(I).dirList(T,ua)};Ma.prototype.normalizeSync=function(I,T,ua){return System.decanonicalize(I,T,ua)};Ma.prototype.normalize=function(I,T,ua){return System.normalize(I,T,ua)};Ma.prototype.printSystemConfig=function(){return lb.modules.printSystemConfig()};Ma.prototype.getConfig=function(){return System.getConfig()};Ma.prototype.setConfig=function(I){lb.modules.System.config(I)};Ma.prototype.getPackages=function(I){I=Object.assign({},
I);I=void 0===I.excluded?[]:I.excluded;var T=I.filter(function(Da){return"string"===typeof Da}),ua=I.filter(function(Da){return"function"===typeof Da});T=T.concat(T.map(function(Da){return System.decanonicalize(Da.replace(/\/?$/,"/")).replace(/\/$/,"")}));return lb.modules.getPackages().filter(function(Da){return!T.includes(Da.url)&&!ua.some(function(Lb){return Lb(Da.url)})})};Ma.prototype.registerPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){return T.return(lb.modules.registerPackage(I))})};
Ma.prototype.importPackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){return T.return(lb.modules.importPackage(I))})};Ma.prototype.removePackage=function(I){return $jscomp.asyncExecutePromiseGeneratorProgram(function(T){return T.return(lb.modules.removePackage(I))})};Ma.prototype.reloadPackage=function(I,T){return $jscomp.asyncExecutePromiseGeneratorProgram(function(ua){return ua.return(lb.modules.reloadPackage(I,T))})};Ma.prototype.packageConfChange=function(I,T){var ua=
this,Da,Lb,ub,Ja;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Rb){if(1==Rb.nextAddress)return Da=lb.modules.System,Lb=lb.parseJsonLikeObj(I),ub=JSON.stringify(Lb,null,2),Rb.yield(lb.modules.module(T).changeSource(ub,{doEval:!1}),2);if(3!=Rb.nextAddress)return Da.set(T,Da.newModule(Lb)),Rb.yield(ua.getPackageForModule(T),3);(Ja=Rb.yieldResult)&&lb.modules.applyPackageConfig(Lb,Ja.address);Rb.jumpToEnd()})};Ma.prototype.resourcesOfPackage=function(I,T){T=void 0===T?[".git","node_modules",
".module_cache"]:T;var ua,Da,Lb;return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){if(1==ub.nextAddress)return ub.setCatchFinallyBlocks(2),ua=I.address?I.address:I,Da=lb.modules.getPackage(ua),ub.yield(Da.resources(void 0,T),4);if(2!=ub.nextAddress)return ub.return(ub.yieldResult.map(function(Ja){return Object.assign(Ja,{package:Ja.package.url})}));Lb=ub.enterCatchBlock();console.warn("resourcesOfPackage error for "+I+": "+Lb);return ub.return([])})};Ma.prototype.getPackageForModule=
function(I){return(I=lb.modules.getPackageOfModule(I))?I.asSpec():I};Ma.prototype.isModuleLoaded=function(I,T){return lb.modules.isModuleLoaded(I,T)};Ma.prototype.doesModuleExist=function(I,T){return lb.modules.isModuleLoaded(I,T)};Ma.prototype.getModule=function(I){return lb.modules.module(I)};Ma.prototype.importModule=function(I){return lb.modules.System.import(I)};Ma.prototype.forgetModule=function(I,T){return lb.modules.module(I).unload(T)};Ma.prototype.reloadModule=function(I,T){return lb.modules.module(I).reload(T)};
Ma.prototype.moduleFormat=function(I){return lb.modules.module(I).format()};Ma.prototype.moduleRead=function(I){return lb.modules.module(I).source()};Ma.prototype.moduleSourceChange=function(I,T,ua){return lb.modules.module(I).changeSource(T,ua)};Ma.prototype.keyValueListOfVariablesInModule=function(I,T){var ua=this,Da,Lb,ub,Ja,Rb,Mc,Rc,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){switch(Ga.nextAddress){case 1:if(T){Ga.jumpTo(2);break}return Ga.yield(ua.resourceRead(I),3);case 3:T=
Ga.yieldResult;case 2:return Da="string"===typeof T?lb.ast.parse(T):T,Lb=ua.normalizeSync(I),ua.moduleFormat(Lb),ub=lb.modules.module(Lb).env().recorder,Ga.yield(ua.importsAndExportsOf(Lb,Da),4);case 4:return Ja=Ga.yieldResult,Rb=lb.ast.query.topLevelDeclsAndRefs(Da),Mc=lb.arr.sortByKey(lb.ast.query.declarationsOfScope(Rb.scope,!0),"start"),Rc=lb.arr.pluck(Rb.scope.importSpecifiers,"name"),yc=0,Ga.return(Mc.map(function(qc){var Za=qc.name.length,Pa=Ja.exports.find(function(Hb){return Hb.local===qc.name}),
Qa=lb.arr.include(Rc,qc.name);Pa&&(Za+=9);Qa&&(Za+=9);yc=Math.max(yc,Za);return{isExport:Pa,isImport:Qa,name:qc.name,value:ub[qc.name],node:qc,printedName:qc.name+(Pa?" [export]":"")+(Qa?" [import]":""),printedValue:lb.obj.inspect(ub[qc.name],{maxDepth:1}).replace(/\n/g,"")}}).map(function(qc){return{isListItem:!0,value:qc,string:qc.printedName+lb.string.indent(" = "+qc.printedValue," ",yc-qc.printedName.length)}}))}})};Ma.prototype.importsAndExportsOf=function(I,T){var ua;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Da){return 1==
Da.nextAddress?Da.yield(lb.modules.module(I).imports(T),2):3!=Da.nextAddress?(ua=Da.yieldResult,Da.yield(lb.modules.module(I).exports(T),3)):Da.return({imports:ua,exports:Da.yieldResult})})};Ma.prototype.exportsOfModules=function(I){return lb.modules.ExportLookup.run(System,I)};Ma.prototype.searchInPackage=function(I,T,ua){return lb.modules.getPackage(I).search(T,ua)};Ma.prototype.runMochaTests=function(I,T,ua,Da){return lb.runMochaTests(I,T,ua,Da)};Ma.prototype.loadMochaTestFile=function(I,T){return lb.loadMochaTestFile(I,
T)};$jscomp.global.Object.defineProperties(Ma.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"local"}}});lb.LocalCoreInterface=Ma;var Wb=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/http-interface.js");Wb.evalStrategies=nd;Wb.RemoteCoreInterface=Oa;var Nb=function(I){var T=Wb.RemoteCoreInterface.call(this)||this;T.currentEval=null;T.url=I;T.server=new Wb.evalStrategies.HttpEvalStrategy(I);return T};$jscomp.inherits(Nb,Wb.RemoteCoreInterface);Nb.prototype.runEval=
function(I,T){return this.server.runEval(I,T)};$jscomp.global.Object.defineProperties(Nb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this.url}},description:{configurable:!0,enumerable:!0,get:function(){return this.url.replace(/^https?:\/\//,"")}}});Wb.HTTPCoreInterface=Nb;var rc=lively.FreezerRuntime.recorderFor("lively-system-interface/interfaces/l2l-interface.js");rc.evalStrategies=nd;rc.RemoteCoreInterface=Oa;Oa=function(I,T){var ua=rc.RemoteCoreInterface.call(this)||this;
ua.targetId=I;ua.peer=T;return ua};$jscomp.inherits(Oa,rc.RemoteCoreInterface);Oa.prototype.isConnected=function(){var I=this,T,ua,Da,Lb,ub;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ja){if(1==Ja.nextAddress)return T=I,ua=T.client,Da=T.targetId,Ja.yield(ua.sendToAndWait(ua.trackerId,"getClients",{}),2);Lb=Ja.yieldResult;ub=Lb.data;return Ja.return(ub.some(function(Rb){Rb=$jscomp.makeIterator(Rb).next().value;return Da===Rb}))})};Oa.prototype.runEval=function(I,T){var ua=this,Da,Lb;
return $jscomp.asyncExecutePromiseGeneratorProgram(function(ub){Da=ua.client;if(!Da)throw Error("No lively.2lively default client available!");Lb=new rc.evalStrategies.L2LEvalStrategy(Da,ua.targetId);return ub.return(Lb.runEval(I,T))})};$jscomp.global.Object.defineProperties(Oa.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"l2l "+this.targetId}},description:{configurable:!0,enumerable:!0,get:function(){var I=this.peer,T="l2l "+this.targetId.slice(0,5);if(I){var ua=I.location,
Da=I.type,Lb=I.user;I=I.world;Da&&(T+=", "+Da);ua&&(T+=", "+ua.replace(/^https?:\/\//,"")+(I?"/"+I:""));Lb&&(T+=", "+Lb.name)}return T}},client:{configurable:!0,enumerable:!0,get:function(){return(lively.modules.module("lively.2lively/client.js").get()||{default:lively.l2l.L2LClient}).default.default()}}});rc.L2LCoreInterface=Oa;var xc=lively.FreezerRuntime.recorderFor("lively-system-interface/index.js");xc.systemInterfaceNamed=nc;xc.interactivelyCreatePackage=Ta;xc.interactivelyLoadPackage=sb;xc.interactivelyReloadPackage=
dc;xc.interactivelyUnloadPackage=ac;xc.interactivelyRemovePackage=Vc;xc.showExportsAndImportsOf=Hd;xc.shortModuleName=hc;xc.interactivelyChangeModule=kc;xc.interactivelyReloadModule=xb;xc.interactivelyUnloadModule=yb;xc.interactivelyRemoveModule=wc;xc.interactivelyAddModule=Kc;xc.modulesInPackage=zb;xc.LocalCoreInterface=Ma;xc.HTTPCoreInterface=Nb;xc.L2LCoreInterface=Oa;Oa=function(I){this.coreInterface=I};Oa.prototype.dynamicCompletionsForPrefix=function(I,T,ua){return this.coreInterface.dynamicCompletionsForPrefix(I,
T,ua)};Oa.prototype.runEval=function(I,T){return this.coreInterface.runEval(I,T)};Oa.prototype.printSystemConfig=function(I,T,ua){return this.coreInterface.printSystemConfig(I,T,ua)};Oa.prototype.getConfig=function(I,T,ua){return this.coreInterface.getConfig(I,T,ua)};Oa.prototype.getPackages=function(I){return this.coreInterface.getPackages(I)};Oa.prototype.getModules=function(I,T,ua){return this.coreInterface.getModules(I,T,ua)};Oa.prototype.getModule=function(I,T,ua){return this.coreInterface.getModule(I,
T,ua)};Oa.prototype.getPackage=function(I,T,ua){return this.coreInterface.getPackage(I,T,ua)};Oa.prototype.getPackageForModule=function(I,T,ua){return this.coreInterface.getPackageForModule(I,T,ua)};Oa.prototype.resourcesOfPackage=function(I,T){return this.coreInterface.resourcesOfPackage(I,T)};Oa.prototype.systemConfChange=function(I,T,ua){return this.coreInterface.systemConfChange(I,T,ua)};Oa.prototype.registerPackage=function(I){return this.coreInterface.registerPackage(I)};Oa.prototype.importPackage=
function(I){return this.coreInterface.importPackage(I)};Oa.prototype.removePackage=function(I){return this.coreInterface.removePackage(I)};Oa.prototype.reloadPackage=function(I){return this.coreInterface.reloadPackage(I)};Oa.prototype.packageConfChange=function(I,T){return this.coreInterface.packageConfChange(I,T)};Oa.prototype.keyValueListOfVariablesInModule=function(I,T){return this.coreInterface.keyValueListOfVariablesInModule(I,T)};Oa.prototype.interactivelyCreatePackage=function(I){return xc.interactivelyCreatePackage(this.coreInterface,
I)};Oa.prototype.interactivelyLoadPackage=function(I,T){return xc.interactivelyLoadPackage(this.coreInterface,I,T)};Oa.prototype.interactivelyReloadPackage=function(I,T){return xc.interactivelyReloadPackage(this.coreInterface,I,T)};Oa.prototype.interactivelyUnloadPackage=function(I,T,ua){return xc.interactivelyUnloadPackage(this.coreInterface,I,T,ua)};Oa.prototype.interactivelyRemovePackage=function(I,T){return xc.interactivelyRemovePackage(this.coreInterface,I,T)};Oa.prototype.isModuleLoaded=function(I,
T){return this.coreInterface.isModuleLoaded(I,T)};Oa.prototype.doesModuleExist=function(I,T){return this.coreInterface.doesModuleExist(I,T)};Oa.prototype.importModule=function(I){return this.coreInterface.importModule(I)};Oa.prototype.forgetModule=function(I,T){return this.coreInterface.forgetModule(I,T)};Oa.prototype.reloadModule=function(I,T){return this.coreInterface.reloadModule(I,T)};Oa.prototype.moduleFormat=function(I){return this.coreInterface.moduleFormat(I)};Oa.prototype.moduleRead=function(I){return this.coreInterface.moduleRead(I)};
Oa.prototype.moduleWrite=function(I,T){return this.coreInterface.moduleWrite(I,T)};Oa.prototype.getModulesInPackage=function(I){return xc.modulesInPackage(this.coreInterface,I)};Oa.prototype.shortModuleName=function(I,T){return xc.shortModuleName(this.coreInterface,I,T)};Oa.prototype.interactivelyChangeModule=function(I,T,ua){return xc.interactivelyChangeModule(this.coreInterface,I,T,ua)};Oa.prototype.interactivelyReloadModule=function(I,T){return xc.interactivelyReloadModule(this.coreInterface,I,
T)};Oa.prototype.interactivelyUnloadModule=function(I,T){return xc.interactivelyUnloadModule(this.coreInterface,I,T)};Oa.prototype.interactivelyRemoveModule=function(I,T){return xc.interactivelyRemoveModule(this.coreInterface,I,T)};Oa.prototype.interactivelyAddModule=function(I,T){return xc.interactivelyAddModule(this.coreInterface,I,T)};Oa.prototype.showExportsAndImportsOf=function(I,T){return xc.showExportsAndImportsOf(this.coreInterface,I,T)};Oa.prototype.exportsOfModules=function(I){return this.coreInterface.exportsOfModules(I)};
Oa.prototype.searchInPackage=function(I,T,ua){return this.coreInterface.searchInPackage(I,T,ua)};Oa.prototype.searchInAllPackages=function(I,T){T=void 0===T?{}:T;var ua=this,Da,Lb,ub,Ja,Rb,Mc,Rc,yc;return $jscomp.asyncExecutePromiseGeneratorProgram(function(Ga){switch(Ga.nextAddress){case 1:return(Da=T.progress)&&Da.step("Fetching Packages...",0),Ga.yield(ua.coreInterface.getPackages({excluded:T.excludedPackages}),2);case 2:Lb=Ga.yieldResult,ub=[],Da&&Da.step("Fetching Packages...",.1),Ja=0;case 3:if(!(Ja<
Lb.length)){Ga.jumpTo(5);break}Rb=Lb[Ja];Mc=Rb.url;if(!Mc||"no group"===Mc){Ga.jumpTo(4);break}Da&&Da.step(Mc.replace(System.baseURL,"").slice(0,20),.1+Ja/Lb.length*.9);Ga.setCatchFinallyBlocks(6);return Ga.yield(ua.coreInterface.searchInPackage(Mc,I,T),8);case 8:Rc=Ga.yieldResult;ub=ub.concat(Rc);Ga.leaveTryBlock(4);break;case 6:yc=Ga.enterCatchBlock(),console.error("Error searching in package "+Mc+":\n"+yc.stack);case 4:Ja++;Ga.jumpTo(3);break;case 5:return Ga.return(ub)}})};Oa.prototype.loadMochaTestFile=
function(I,T){return this.coreInterface.loadMochaTestFile(I,T)};Oa.prototype.runMochaTests=function(I,T,ua,Da){return this.coreInterface.runMochaTests(I,T,ua,Da)};$jscomp.global.Object.defineProperties(Oa.prototype,{isSystemInterface:{configurable:!0,enumerable:!0,get:function(){return!0}},name:{configurable:!0,enumerable:!0,get:function(){return this.coreInterface.name}}});ta("Interface",Oa);xc.Interface=Oa;xc.systemInterfaceNamed=nc;xc.systemInterfaceNamed=nc;Oa=ta("localInterface",new xc.Interface(new xc.LocalCoreInterface));
xc.localInterface=Oa;xc.localInterface=Oa;xc.localInterface=Oa;xc.httpInterfaces={};Oa=ta("serverInterfaceFor",function(I){return xc.httpInterfaces[I]||(xc.httpInterfaces[I]=new xc.Interface(new xc.HTTPCoreInterface(I)))});xc.serverInterfaceFor=Oa;xc.serverInterfaceFor=Oa;xc.serverInterfaceFor=Oa;xc.l2lInterfaces={};Oa=ta("l2lInterfaceFor",function(I,T){return xc.l2lInterfaces[I]||(xc.l2lInterfaces[I]=new xc.Interface(new xc.L2LCoreInterface(I,T)))});xc.l2lInterfaceFor=Oa;xc.l2lInterfaceFor=Oa;xc.l2lInterfaceFor=
Oa}}});